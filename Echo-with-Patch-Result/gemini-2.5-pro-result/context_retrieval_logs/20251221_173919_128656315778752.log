2025-12-21 17:39:19,468 - thread-128656315778752.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Strip unused annotations from count queries

Description: Description
	
The query below produces a SQL statement that includes the Count('chapters'), despite not not being used in any filter operations.
Book.objects.annotate(Count('chapters')).count()
It produces the same results as:
Book.objects.count()
Django could be more intelligent about what annotations to include in the query produced by queryset.count(), stripping out any annotations that are not referenced by filters, other annotations or ordering. This should speed up calls to count() with complex annotations.
There seems to be precedent for this: select_related calls are ignored with count() queries.

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 9735ce10c8..c040e834c6 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -549,8 +549,31 @@ class Query(BaseExpression):
         """
         Perform a COUNT() query using the current filter constraints.
         """
+        # If it's safe to ignore existing annotations, build a fresh query to
+        # avoid carrying over their joins into the COUNT() query.
+        if (
+            not self.has_filters()
+            and not self.order_by
+            and not self.extra_order_by
+            and not self.is_sliced
+            and not self.distinct
+            and not self.distinct_fields
+            and not self.combinator
+            and self.select_related is False
+            and not self.extra
+            and not self.extra_tables
+        ):
+            fresh = self.__class__(self.model)
+            # Ensure base table alias is initialized for the FROM clause.
+            fresh.get_initial_alias()
+            fresh.add_annotation(Count("*"), alias="__count", is_summary=True)
+            fresh.set_annotation_mask(["__count"])  # Only select __count.
+            fresh.set_extra_mask(())  # Exclude any extra(select=...).
+            return fresh.get_aggregation(using, ["__count"])["__count"]
         obj = self.clone()
         obj.add_annotation(Count("*"), alias="__count", is_summary=True)
+        obj.set_annotation_mask(["__count"])  # Only select __count.
+        obj.set_extra_mask(())  # Exclude any extra(select=...).
         return obj.get_aggregation(using, ["__count"])["__count"]
 
     def has_filters(self):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 17:39:19,563 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   ├── custom_sitemap_index.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Strip unused annotations from count queries

Description: Description
	
The query below produces a SQL statement that includes the Count('chapters'), despite not not being used in any filter operations.
Book.objects.annotate(Count('chapters')).count()
It produces the same results as:
Book.objects.count()
Django could be more intelligent about what annotations to include in the query produced by queryset.count(), stripping out any annotations that are not referenced by filters, other annotations or ordering. This should speed up calls to count() with complex annotations.
There seems to be precedent for this: select_related calls are ignored with count() queries.

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 9735ce10c8..c040e834c6 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -549,8 +549,31 @@ class Query(BaseExpression):
         """
         Perform a COUNT() query using the current filter constraints.
         """
+        # If it's safe to ignore existing annotations, build a fresh query to
+        # avoid carrying over their joins into the COUNT() query.
+        if (
+            not self.has_filters()
+            and not self.order_by
+            and not self.extra_order_by
+            and not self.is_sliced
+            and not self.distinct
+            and not self.distinct_fields
+            and not self.combinator
+            and self.select_related is False
+            and not self.extra
+            and not self.extra_tables
+        ):
+            fresh = self.__class__(self.model)
+            # Ensure base table alias is initialized for the FROM clause.
+            fresh.get_initial_alias()
+            fresh.add_annotation(Count("*"), alias="__count", is_summary=True)
+            fresh.set_annotation_mask(["__count"])  # Only select __count.
+            fresh.set_extra_mask(())  # Exclude any extra(select=...).
+            return fresh.get_aggregation(using, ["__count"])["__count"]
         obj = self.clone()
         obj.add_annotation(Count("*"), alias="__count", is_summary=True)
+        obj.set_annotation_mask(["__count"])  # Only select __count.
+        obj.set_extra_mask(())  # Exclude any extra(select=...).
         return obj.get_aggregation(using, ["__count"])["__count"]
 
     def has_filters(self):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 17:39:45,524 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find 3 relevant existing test cases for a bug related to `.count()` on an annotated queryset. The bug involves the `Count` aggregation. The most relevant tests are likely in `tests/aggregation/tests.py` or `tests/annotations/tests.py`. I will start by requesting `tests/aggregation/tests.py` to find tests that use `annotate` with `Count` and then call `count()`.' query='Please provide the full content of `tests/aggregation/tests.py`.' extra_requirements='' purpose='I need to find existing test cases that test the `.count()` method on annotated querysets, and this file is the most likely place to find them.'
2025-12-21 17:39:45,525 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/aggregation/tests.py`.
2025-12-21 17:39:45,525 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 17:39:45,526 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 17:39:45,526 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 17:39:45,526 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/aggregation/tests.py`.
Purpose: I need to find existing test cases that test the `.count()` method on annotated querysets, and this file is the most likely place to find them.
2025-12-21 17:39:47,607 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will fetch the entire content of `tests/aggregation/tests.py` for you. This file likely contains the test cases you are looking for, specifically those related to the `.count()` method on annotated querysets.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2102, 'candidates_token_count': 66, 'total_token_count': 2243, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2102}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 66}], 'thoughts_token_count': 75, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09477212934783011, 'model_name': 'gemini-2.5-pro'} id='run--a252a626-a741-4ecf-8ef9-7b0c8ce31269-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/aggregation/tests.py'}, 'id': '300499b6-499f-4a81-baf6-91277167c20e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2102, 'output_tokens': 66, 'total_tokens': 2243, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 75}}
2025-12-21 17:39:50,339 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the initial part of the file `tests/aggregation/tests.py`. Since the file is quite large, I will now fetch the remaining content to provide you with the complete file.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 9999.0, "relative_path": "tests/aggregation/tests.py", "start_line": 501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9427, 'candidates_token_count': 68, 'total_token_count': 9584, 'cached_content_token_count': 1828, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9427}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1828}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 68}], 'thoughts_token_count': 89}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2167972256155575, 'model_name': 'gemini-2.5-pro'} id='run--8eeba064-55ca-419a-b21d-a31ccd44f0f9-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 9999.0, 'relative_path': 'tests/aggregation/tests.py', 'start_line': 501.0}, 'id': '5e9ba156-524b-4fee-9c0a-8a6249058ceb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9427, 'output_tokens': 68, 'total_tokens': 9584, 'input_token_details': {'cache_read': 1828}, 'output_token_details': {'reasoning': 89}}
2025-12-21 17:40:12,163 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of `tests/aggregation/tests.py` for you in the previous turn. I found several test cases within this file that are relevant to testing the `.count()` method on annotated querysets. The most pertinent examples are `test_sum_distinct_aggregate`, which tests `.count()` on a `distinct()` queryset, and `test_aggregation_subquery_annotation_multivalued`, which directly calls `.count()` after an annotation. Additionally, `test_filtering` and `test_annotation` provide examples of how to filter querysets based on an annotated count.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 2752, 'end_index': 3259, 'uri': 'https://github.com/django/django', 'license_': 'Python-2.0', 'title': ''}, {'start_index': 4684, 'end_index': 5410, 'uri': 'https://github.com/django/django', 'license_': 'Python-2.0', 'title': ''}]}, 'usage_metadata': {'prompt_token_count': 34394, 'candidates_token_count': 125, 'total_token_count': 36918, 'prompt_tokens_details': [{'modality': 1, 'token_count': 34394}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 125}], 'thoughts_token_count': 2399, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.606018798828125, 'model_name': 'gemini-2.5-pro'} id='run--fa3ca1b6-c06d-4626-9de4-f75477b262a3-0' usage_metadata={'input_tokens': 34394, 'output_tokens': 125, 'total_tokens': 36918, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 2399}}
2025-12-21 17:40:12,165 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/aggregation/tests.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find existing test cases that test the `.count()` method on annotated querysets, and this file is the most likely place to find them.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/aggregation/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import math
3. import re
4. from decimal import Decimal
5. 
6. from django.core.exceptions import FieldError
7. from django.db import connection
8. from django.db.models import (
9.     Avg,
10.     Case,
11.     Count,
12.     DateField,
13.     DateTimeField,
14.     DecimalField,
15.     DurationField,
16.     Exists,
17.     F,
18.     FloatField,
19.     IntegerField,
20.     Max,
21.     Min,
22.     OuterRef,
23.     Q,
24.     StdDev,
25.     Subquery,
26.     Sum,
27.     TimeField,
28.     Value,
29.     Variance,
30.     When,
31. )
32. from django.db.models.expressions import Func, RawSQL
33. from django.db.models.functions import (
34.     Cast,
35.     Coalesce,
36.     Greatest,
37.     Now,
38.     Pi,
39.     TruncDate,
40.     TruncHour,
41. )
42. from django.test import TestCase
43. from django.test.testcases import skipUnlessDBFeature
44. from django.test.utils import Approximate, CaptureQueriesContext
45. from django.utils import timezone
46. 
47. from .models import Author, Book, Publisher, Store
48. 
49. 
50. class NowUTC(Now):
51.     template = "CURRENT_TIMESTAMP"
52.     output_field = DateTimeField()
53. 
54.     def as_sql(self, compiler, connection, **extra_context):
55.         if connection.features.test_now_utc_template:
56.             extra_context["template"] = connection.features.test_now_utc_template
57.         return super().as_sql(compiler, connection, **extra_context)
58. 
59. 
60. class AggregateTestCase(TestCase):
61.     @classmethod
62.     def setUpTestData(cls):
63.         cls.a1 = Author.objects.create(name="Adrian Holovaty", age=34)
64.         cls.a2 = Author.objects.create(name="Jacob Kaplan-Moss", age=35)
65.         cls.a3 = Author.objects.create(name="Brad Dayley", age=45)
66.         cls.a4 = Author.objects.create(name="James Bennett", age=29)
67.         cls.a5 = Author.objects.create(name="Jeffrey Forcier", age=37)
68.         cls.a6 = Author.objects.create(name="Paul Bissex", age=29)
69.         cls.a7 = Author.objects.create(name="Wesley J. Chun", age=25)
70.         cls.a8 = Author.objects.create(name="Peter Norvig", age=57)
71.         cls.a9 = Author.objects.create(name="Stuart Russell", age=46)
72.         cls.a1.friends.add(cls.a2, cls.a4)
73.         cls.a2.friends.add(cls.a1, cls.a7)
74.         cls.a4.friends.add(cls.a1)
75.         cls.a5.friends.add(cls.a6, cls.a7)
76.         cls.a6.friends.add(cls.a5, cls.a7)
77.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
78.         cls.a8.friends.add(cls.a9)
79.         cls.a9.friends.add(cls.a8)
80. 
81.         cls.p1 = Publisher.objects.create(
82.             name="Apress", num_awards=3, duration=datetime.timedelta(days=1)
83.         )
84.         cls.p2 = Publisher.objects.create(
85.             name="Sams", num_awards=1, duration=datetime.timedelta(days=2)
86.         )
87.         cls.p3 = Publisher.objects.create(name="Prentice Hall", num_awards=7)
88.         cls.p4 = Publisher.objects.create(name="Morgan Kaufmann", num_awards=9)
89.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
90. 
91.         cls.b1 = Book.objects.create(
92.             isbn="159059725",
93.             name="The Definitive Guide to Django: Web Development Done Right",
94.             pages=447,
95.             rating=4.5,
96.             price=Decimal("30.00"),
97.             contact=cls.a1,
98.             publisher=cls.p1,
99.             pubdate=datetime.date(2007, 12, 6),
100.         )
101.         cls.b2 = Book.objects.create(
102.             isbn="067232959",
103.             name="Sams Teach Yourself Django in 24 Hours",
104.             pages=528,
105.             rating=3.0,
106.             price=Decimal("23.09"),
107.             contact=cls.a3,
108.             publisher=cls.p2,
109.             pubdate=datetime.date(2008, 3, 3),
110.         )
111.         cls.b3 = Book.objects.create(
112.             isbn="159059996",
113.             name="Practical Django Projects",
114.             pages=300,
115.             rating=4.0,
116.             price=Decimal("29.69"),
117.             contact=cls.a4,
118.             publisher=cls.p1,
119.             pubdate=datetime.date(2008, 6, 23),
120.         )
121.         cls.b4 = Book.objects.create(
122.             isbn="013235613",
123.             name="Python Web Development with Django",
124.             pages=350,
125.             rating=4.0,
126.             price=Decimal("29.69"),
127.             contact=cls.a5,
128.             publisher=cls.p3,
129.             pubdate=datetime.date(2008, 11, 3),
130.         )
131.         cls.b5 = Book.objects.create(
132.             isbn="013790395",
133.             name="Artificial Intelligence: A Modern Approach",
134.             pages=1132,
135.             rating=4.0,
136.             price=Decimal("82.80"),
137.             contact=cls.a8,
138.             publisher=cls.p3,
139.             pubdate=datetime.date(1995, 1, 15),
140.         )
141.         cls.b6 = Book.objects.create(
142.             isbn="155860191",
143.             name=(
144.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
145.                 "Common Lisp"
146.             ),
147.             pages=946,
148.             rating=5.0,
149.             price=Decimal("75.00"),
150.             contact=cls.a8,
151.             publisher=cls.p4,
152.             pubdate=datetime.date(1991, 10, 15),
153.         )
154.         cls.b1.authors.add(cls.a1, cls.a2)
155.         cls.b2.authors.add(cls.a3)
156.         cls.b3.authors.add(cls.a4)
157.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
158.         cls.b5.authors.add(cls.a8, cls.a9)
159.         cls.b6.authors.add(cls.a8)
160. 
161.         s1 = Store.objects.create(
162.             name="Amazon.com",
163.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
164.             friday_night_closing=datetime.time(23, 59, 59),
165.         )
166.         s2 = Store.objects.create(
167.             name="Books.com",
168.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
169.             friday_night_closing=datetime.time(23, 59, 59),
170.         )
171.         s3 = Store.objects.create(
172.             name="Mamma and Pappa's Books",
173.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
174.             friday_night_closing=datetime.time(21, 30),
175.         )
176.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
177.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
178.         s3.books.add(cls.b3, cls.b4, cls.b6)
179. 
180.     def test_empty_aggregate(self):
181.         self.assertEqual(Author.objects.aggregate(), {})
182. 
183.     def test_aggregate_in_order_by(self):
184.         msg = (
185.             "Using an aggregate in order_by() without also including it in "
186.             "annotate() is not allowed: Avg(F(book__rating)"
187.         )
188.         with self.assertRaisesMessage(FieldError, msg):
189.             Author.objects.values("age").order_by(Avg("book__rating"))
190. 
191.     def test_single_aggregate(self):
192.         vals = Author.objects.aggregate(Avg("age"))
193.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
194. 
195.     def test_multiple_aggregates(self):
196.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
197.         self.assertEqual(
198.             vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)}
199.         )
200. 
201.     def test_filter_aggregate(self):
202.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
203.         self.assertEqual(vals, {"age__sum": 254})
204. 
205.     def test_related_aggregate(self):
206.         vals = Author.objects.aggregate(Avg("friends__age"))
207.         self.assertEqual(vals, {"friends__age__avg": Approximate(34.07, places=2)})
208. 
209.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
210.         self.assertEqual(vals, {"authors__age__avg": Approximate(38.2857, places=2)})
211. 
212.         vals = Author.objects.filter(name__contains="a").aggregate(Avg("book__rating"))
213.         self.assertEqual(vals, {"book__rating__avg": 4.0})
214. 
215.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
216.         self.assertEqual(vals, {"publisher__num_awards__sum": 30})
217. 
218.         vals = Publisher.objects.aggregate(Sum("book__price"))
219.         self.assertEqual(vals, {"book__price__sum": Decimal("270.27")})
220. 
221.     def test_aggregate_multi_join(self):
222.         vals = Store.objects.aggregate(Max("books__authors__age"))
223.         self.assertEqual(vals, {"books__authors__age__max": 57})
224. 
225.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
226.         self.assertEqual(vals, {"book__publisher__num_awards__min": 1})
227. 
228.     def test_aggregate_alias(self):
229.         vals = Store.objects.filter(name="Amazon.com").aggregate(
230.             amazon_mean=Avg("books__rating")
231.         )
232.         self.assertEqual(vals, {"amazon_mean": Approximate(4.08, places=2)})
233. 
234.     def test_aggregate_transform(self):
235.         vals = Store.objects.aggregate(min_month=Min("original_opening__month"))
236.         self.assertEqual(vals, {"min_month": 3})
237. 
238.     def test_aggregate_join_transform(self):
239.         vals = Publisher.objects.aggregate(min_year=Min("book__pubdate__year"))
240.         self.assertEqual(vals, {"min_year": 1991})
241. 
242.     def test_annotate_basic(self):
243.         self.assertQuerySetEqual(
244.             Book.objects.annotate().order_by("pk"),
245.             [
246.                 "The Definitive Guide to Django: Web Development Done Right",
247.                 "Sams Teach Yourself Django in 24 Hours",
248.                 "Practical Django Projects",
249.                 "Python Web Development with Django",
250.                 "Artificial Intelligence: A Modern Approach",
251.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
252.                 "Common Lisp",
253.             ],
254.             lambda b: b.name,
255.         )
256. 
257.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
258.         b = books.get(pk=self.b1.pk)
259.         self.assertEqual(
260.             b.name, "The Definitive Guide to Django: Web Development Done Right"
261.         )
262.         self.assertEqual(b.mean_age, 34.5)
263. 
264.     def test_annotate_defer(self):
265.         qs = (
266.             Book.objects.annotate(page_sum=Sum("pages"))
267.             .defer("name")
268.             .filter(pk=self.b1.pk)
269.         )
270. 
271.         rows = [
272.             (
273.                 self.b1.id,
274.                 "159059725",
275.                 447,
276.                 "The Definitive Guide to Django: Web Development Done Right",
277.             )
278.         ]
279.         self.assertQuerySetEqual(
280.             qs.order_by("pk"), rows, lambda r: (r.id, r.isbn, r.page_sum, r.name)
281.         )
282. 
283.     def test_annotate_defer_select_related(self):
284.         qs = (
285.             Book.objects.select_related("contact")
286.             .annotate(page_sum=Sum("pages"))
287.             .defer("name")
288.             .filter(pk=self.b1.pk)
289.         )
290. 
291.         rows = [
292.             (
293.                 self.b1.id,
294.                 "159059725",
295.                 447,
296.                 "Adrian Holovaty",
297.                 "The Definitive Guide to Django: Web Development Done Right",
298.             )
299.         ]
300.         self.assertQuerySetEqual(
301.             qs.order_by("pk"),
302.             rows,
303.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name),
304.         )
305. 
306.     def test_annotate_m2m(self):
307.         books = (
308.             Book.objects.filter(rating__lt=4.5)
309.             .annotate(Avg("authors__age"))
310.             .order_by("name")
311.         )
312.         self.assertQuerySetEqual(
313.             books,
314.             [
315.                 ("Artificial Intelligence: A Modern Approach", 51.5),
316.                 ("Practical Django Projects", 29.0),
317.                 ("Python Web Development with Django", Approximate(30.3, places=1)),
318.                 ("Sams Teach Yourself Django in 24 Hours", 45.0),
319.             ],
320.             lambda b: (b.name, b.authors__age__avg),
321.         )
322. 
323.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
324.         self.assertQuerySetEqual(
325.             books,
326.             [
327.                 ("Artificial Intelligence: A Modern Approach", 2),
328.                 (
329.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
330.                     "Common Lisp",
331.                     1,
332.                 ),
333.                 ("Practical Django Projects", 1),
334.                 ("Python Web Development with Django", 3),
335.                 ("Sams Teach Yourself Django in 24 Hours", 1),
336.                 ("The Definitive Guide to Django: Web Development Done Right", 2),
337.             ],
338.             lambda b: (b.name, b.num_authors),
339.         )
340. 
341.     def test_backwards_m2m_annotate(self):
342.         authors = (
343.             Author.objects.filter(name__contains="a")
344.             .annotate(Avg("book__rating"))
345.             .order_by("name")
346.         )
347.         self.assertQuerySetEqual(
348.             authors,
349.             [
350.                 ("Adrian Holovaty", 4.5),
351.                 ("Brad Dayley", 3.0),
352.                 ("Jacob Kaplan-Moss", 4.5),
353.                 ("James Bennett", 4.0),
354.                 ("Paul Bissex", 4.0),
355.                 ("Stuart Russell", 4.0),
356.             ],
357.             lambda a: (a.name, a.book__rating__avg),
358.         )
359. 
360.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
361.         self.assertQuerySetEqual(
362.             authors,
363.             [
364.                 ("Adrian Holovaty", 1),
365.                 ("Brad Dayley", 1),
366.                 ("Jacob Kaplan-Moss", 1),
367.                 ("James Bennett", 1),
368.                 ("Jeffrey Forcier", 1),
369.                 ("Paul Bissex", 1),
370.                 ("Peter Norvig", 2),
371.                 ("Stuart Russell", 1),
372.                 ("Wesley J. Chun", 1),
373.             ],
374.             lambda a: (a.name, a.num_books),
375.         )
376. 
377.     def test_reverse_fkey_annotate(self):
378.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
379.         self.assertQuerySetEqual(
380.             books,
381.             [
382.                 ("Artificial Intelligence: A Modern Approach", 7),
383.                 (
384.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
385.                     "Common Lisp",
386.                     9,
387.                 ),
388.                 ("Practical Django Projects", 3),
389.                 ("Python Web Development with Django", 7),
390.                 ("Sams Teach Yourself Django in 24 Hours", 1),
391.                 ("The Definitive Guide to Django: Web Development Done Right", 3),
392.             ],
393.             lambda b: (b.name, b.publisher__num_awards__sum),
394.         )
395. 
396.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
397.         self.assertQuerySetEqual(
398.             publishers,
399.             [
400.                 ("Apress", Decimal("59.69")),
401.                 ("Jonno's House of Books", None),
402.                 ("Morgan Kaufmann", Decimal("75.00")),
403.                 ("Prentice Hall", Decimal("112.49")),
404.                 ("Sams", Decimal("23.09")),
405.             ],
406.             lambda p: (p.name, p.book__price__sum),
407.         )
408. 
409.     def test_annotate_values(self):
410.         books = list(
411.             Book.objects.filter(pk=self.b1.pk)
412.             .annotate(mean_age=Avg("authors__age"))
413.             .values()
414.         )
415.         self.assertEqual(
416.             books,
417.             [
418.                 {
419.                     "contact_id": self.a1.id,
420.                     "id": self.b1.id,
421.                     "isbn": "159059725",
422.                     "mean_age": 34.5,
423.                     "name": (
424.                         "The Definitive Guide to Django: Web Development Done Right"
425.                     ),
426.                     "pages": 447,
427.                     "price": Approximate(Decimal("30")),
428.                     "pubdate": datetime.date(2007, 12, 6),
429.                     "publisher_id": self.p1.id,
430.                     "rating": 4.5,
431.                 }
432.             ],
433.         )
434. 
435.         books = (
436.             Book.objects.filter(pk=self.b1.pk)
437.             .annotate(mean_age=Avg("authors__age"))
438.             .values("pk", "isbn", "mean_age")
439.         )
440.         self.assertEqual(
441.             list(books),
442.             [
443.                 {
444.                     "pk": self.b1.pk,
445.                     "isbn": "159059725",
446.                     "mean_age": 34.5,
447.                 }
448.             ],
449.         )
450. 
451.         books = (
452.             Book.objects.filter(pk=self.b1.pk)
453.             .annotate(mean_age=Avg("authors__age"))
454.             .values("name")
455.         )
456.         self.assertEqual(
457.             list(books),
458.             [{"name": "The Definitive Guide to Django: Web Development Done Right"}],
459.         )
460. 
461.         books = (
462.             Book.objects.filter(pk=self.b1.pk)
463.             .values()
464.             .annotate(mean_age=Avg("authors__age"))
465.         )
466.         self.assertEqual(
467.             list(books),
468.             [
469.                 {
470.                     "contact_id": self.a1.id,
471.                     "id": self.b1.id,
472.                     "isbn": "159059725",
473.                     "mean_age": 34.5,
474.                     "name": (
475.                         "The Definitive Guide to Django: Web Development Done Right"
476.                     ),
477.                     "pages": 447,
478.                     "price": Approximate(Decimal("30")),
479.                     "pubdate": datetime.date(2007, 12, 6),
480.                     "publisher_id": self.p1.id,
481.                     "rating": 4.5,
482.                 }
483.             ],
484.         )
485. 
486.         books = (
487.             Book.objects.values("rating")
488.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
489.             .order_by("rating")
490.         )
491.         self.assertEqual(
492.             list(books),
493.             [
494.                 {
495.                     "rating": 3.0,
496.                     "n_authors": 1,
497.                     "mean_age": 45.0,
498.                 },
499.                 {
500.                     "rating": 4.0,


File: tests/aggregation/tests.py
Line number range: 501 - 9999
Content:
501.                     "n_authors": 6,
502.                     "mean_age": Approximate(37.16, places=1),
503.                 },
504.                 {
505.                     "rating": 4.5,
506.                     "n_authors": 2,
507.                     "mean_age": 34.5,
508.                 },
509.                 {
510.                     "rating": 5.0,
511.                     "n_authors": 1,
512.                     "mean_age": 57.0,
513.                 },
514.             ],
515.         )
516. 
517.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
518.         self.assertQuerySetEqual(
519.             authors,
520.             [
521.                 ("Adrian Holovaty", 32.0),
522.                 ("Brad Dayley", None),
523.                 ("Jacob Kaplan-Moss", 29.5),
524.                 ("James Bennett", 34.0),
525.                 ("Jeffrey Forcier", 27.0),
526.                 ("Paul Bissex", 31.0),
527.                 ("Peter Norvig", 46.0),
528.                 ("Stuart Russell", 57.0),
529.                 ("Wesley J. Chun", Approximate(33.66, places=1)),
530.             ],
531.             lambda a: (a.name, a.friends__age__avg),
532.         )
533. 
534.     def test_count(self):
535.         vals = Book.objects.aggregate(Count("rating"))
536.         self.assertEqual(vals, {"rating__count": 6})
537. 
538.     def test_count_star(self):
539.         with self.assertNumQueries(1) as ctx:
540.             Book.objects.aggregate(n=Count("*"))
541.         sql = ctx.captured_queries[0]["sql"]
542.         self.assertIn("SELECT COUNT(*) ", sql)
543. 
544.     def test_count_distinct_expression(self):
545.         aggs = Book.objects.aggregate(
546.             distinct_ratings=Count(
547.                 Case(When(pages__gt=300, then="rating")), distinct=True
548.             ),
549.         )
550.         self.assertEqual(aggs["distinct_ratings"], 4)
551. 
552.     def test_distinct_on_aggregate(self):
553.         for aggregate, expected_result in (
554.             (Avg, 4.125),
555.             (Count, 4),
556.             (Sum, 16.5),
557.         ):
558.             with self.subTest(aggregate=aggregate.__name__):
559.                 books = Book.objects.aggregate(
560.                     ratings=aggregate("rating", distinct=True)
561.                 )
562.                 self.assertEqual(books["ratings"], expected_result)
563. 
564.     def test_non_grouped_annotation_not_in_group_by(self):
565.         """
566.         An annotation not included in values() before an aggregate should be
567.         excluded from the group by clause.
568.         """
569.         qs = (
570.             Book.objects.annotate(xprice=F("price"))
571.             .filter(rating=4.0)
572.             .values("rating")
573.             .annotate(count=Count("publisher_id", distinct=True))
574.             .values("count", "rating")
575.             .order_by("count")
576.         )
577.         self.assertEqual(list(qs), [{"rating": 4.0, "count": 2}])
578. 
579.     def test_grouped_annotation_in_group_by(self):
580.         """
581.         An annotation included in values() before an aggregate should be
582.         included in the group by clause.
583.         """
584.         qs = (
585.             Book.objects.annotate(xprice=F("price"))
586.             .filter(rating=4.0)
587.             .values("rating", "xprice")
588.             .annotate(count=Count("publisher_id", distinct=True))
589.             .values("count", "rating")
590.             .order_by("count")
591.         )
592.         self.assertEqual(
593.             list(qs),
594.             [
595.                 {"rating": 4.0, "count": 1},
596.                 {"rating": 4.0, "count": 2},
597.             ],
598.         )
599. 
600.     def test_fkey_aggregate(self):
601.         explicit = list(Author.objects.annotate(Count("book__id")))
602.         implicit = list(Author.objects.annotate(Count("book")))
603.         self.assertCountEqual(explicit, implicit)
604. 
605.     def test_annotate_ordering(self):
606.         books = (
607.             Book.objects.values("rating")
608.             .annotate(oldest=Max("authors__age"))
609.             .order_by("oldest", "rating")
610.         )
611.         self.assertEqual(
612.             list(books),
613.             [
614.                 {"rating": 4.5, "oldest": 35},
615.                 {"rating": 3.0, "oldest": 45},
616.                 {"rating": 4.0, "oldest": 57},
617.                 {"rating": 5.0, "oldest": 57},
618.             ],
619.         )
620. 
621.         books = (
622.             Book.objects.values("rating")
623.             .annotate(oldest=Max("authors__age"))
624.             .order_by("-oldest", "-rating")
625.         )
626.         self.assertEqual(
627.             list(books),
628.             [
629.                 {"rating": 5.0, "oldest": 57},
630.                 {"rating": 4.0, "oldest": 57},
631.                 {"rating": 3.0, "oldest": 45},
632.                 {"rating": 4.5, "oldest": 35},
633.             ],
634.         )
635. 
636.     def test_aggregate_annotation(self):
637.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(
638.             Avg("num_authors")
639.         )
640.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
641. 
642.     def test_avg_duration_field(self):
643.         # Explicit `output_field`.
644.         self.assertEqual(
645.             Publisher.objects.aggregate(Avg("duration", output_field=DurationField())),
646.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
647.         )
648.         # Implicit `output_field`.
649.         self.assertEqual(
650.             Publisher.objects.aggregate(Avg("duration")),
651.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
652.         )
653. 
654.     def test_sum_duration_field(self):
655.         self.assertEqual(
656.             Publisher.objects.aggregate(Sum("duration", output_field=DurationField())),
657.             {"duration__sum": datetime.timedelta(days=3)},
658.         )
659. 
660.     def test_sum_distinct_aggregate(self):
661.         """
662.         Sum on a distinct() QuerySet should aggregate only the distinct items.
663.         """
664.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
665.         self.assertEqual(authors.count(), 3)
666. 
667.         distinct_authors = authors.distinct()
668.         self.assertEqual(distinct_authors.count(), 2)
669. 
670.         # Selected author ages are 57 and 46
671.         age_sum = distinct_authors.aggregate(Sum("age"))
672.         self.assertEqual(age_sum["age__sum"], 103)
673. 
674.     def test_filtering(self):
675.         p = Publisher.objects.create(name="Expensive Publisher", num_awards=0)
676.         Book.objects.create(
677.             name="ExpensiveBook1",
678.             pages=1,
679.             isbn="111",
680.             rating=3.5,
681.             price=Decimal("1000"),
682.             publisher=p,
683.             contact_id=self.a1.id,
684.             pubdate=datetime.date(2008, 12, 1),
685.         )
686.         Book.objects.create(
687.             name="ExpensiveBook2",
688.             pages=1,
689.             isbn="222",
690.             rating=4.0,
691.             price=Decimal("1000"),
692.             publisher=p,
693.             contact_id=self.a1.id,
694.             pubdate=datetime.date(2008, 12, 2),
695.         )
696.         Book.objects.create(
697.             name="ExpensiveBook3",
698.             pages=1,
699.             isbn="333",
700.             rating=4.5,
701.             price=Decimal("35"),
702.             publisher=p,
703.             contact_id=self.a1.id,
704.             pubdate=datetime.date(2008, 12, 3),
705.         )
706. 
707.         publishers = (
708.             Publisher.objects.annotate(num_books=Count("book__id"))
709.             .filter(num_books__gt=1)
710.             .order_by("pk")
711.         )
712.         self.assertQuerySetEqual(
713.             publishers,
714.             ["Apress", "Prentice Hall", "Expensive Publisher"],
715.             lambda p: p.name,
716.         )
717. 
718.         publishers = Publisher.objects.filter(book__price__lt=Decimal("40.0")).order_by(
719.             "pk"
720.         )
721.         self.assertQuerySetEqual(
722.             publishers,
723.             [
724.                 "Apress",
725.                 "Apress",
726.                 "Sams",
727.                 "Prentice Hall",
728.                 "Expensive Publisher",
729.             ],
730.             lambda p: p.name,
731.         )
732. 
733.         publishers = (
734.             Publisher.objects.annotate(num_books=Count("book__id"))
735.             .filter(num_books__gt=1, book__price__lt=Decimal("40.0"))
736.             .order_by("pk")
737.         )
738.         self.assertQuerySetEqual(
739.             publishers,
740.             ["Apress", "Prentice Hall", "Expensive Publisher"],
741.             lambda p: p.name,
742.         )
743. 
744.         publishers = (
745.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
746.             .annotate(num_books=Count("book__id"))
747.             .filter(num_books__gt=1)
748.             .order_by("pk")
749.         )
750.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
751. 
752.         publishers = (
753.             Publisher.objects.annotate(num_books=Count("book"))
754.             .filter(num_books__range=[1, 3])
755.             .order_by("pk")
756.         )
757.         self.assertQuerySetEqual(
758.             publishers,
759.             [
760.                 "Apress",
761.                 "Sams",
762.                 "Prentice Hall",
763.                 "Morgan Kaufmann",
764.                 "Expensive Publisher",
765.             ],
766.             lambda p: p.name,
767.         )
768. 
769.         publishers = (
770.             Publisher.objects.annotate(num_books=Count("book"))
771.             .filter(num_books__range=[1, 2])
772.             .order_by("pk")
773.         )
774.         self.assertQuerySetEqual(
775.             publishers,
776.             ["Apress", "Sams", "Prentice Hall", "Morgan Kaufmann"],
777.             lambda p: p.name,
778.         )
779. 
780.         publishers = (
781.             Publisher.objects.annotate(num_books=Count("book"))
782.             .filter(num_books__in=[1, 3])
783.             .order_by("pk")
784.         )
785.         self.assertQuerySetEqual(
786.             publishers,
787.             ["Sams", "Morgan Kaufmann", "Expensive Publisher"],
788.             lambda p: p.name,
789.         )
790. 
791.         publishers = Publisher.objects.annotate(num_books=Count("book")).filter(
792.             num_books__isnull=True
793.         )
794.         self.assertEqual(len(publishers), 0)
795. 
796.     def test_annotation(self):
797.         vals = Author.objects.filter(pk=self.a1.pk).aggregate(Count("friends__id"))
798.         self.assertEqual(vals, {"friends__id__count": 2})
799. 
800.         books = (
801.             Book.objects.annotate(num_authors=Count("authors__name"))
802.             .filter(num_authors__exact=2)
803.             .order_by("pk")
804.         )
805.         self.assertQuerySetEqual(
806.             books,
807.             [
808.                 "The Definitive Guide to Django: Web Development Done Right",
809.                 "Artificial Intelligence: A Modern Approach",
810.             ],
811.             lambda b: b.name,
812.         )
813. 
814.         authors = (
815.             Author.objects.annotate(num_friends=Count("friends__id", distinct=True))
816.             .filter(num_friends=0)
817.             .order_by("pk")
818.         )
819.         self.assertQuerySetEqual(authors, ["Brad Dayley"], lambda a: a.name)
820. 
821.         publishers = (
822.             Publisher.objects.annotate(num_books=Count("book__id"))
823.             .filter(num_books__gt=1)
824.             .order_by("pk")
825.         )
826.         self.assertQuerySetEqual(
827.             publishers, ["Apress", "Prentice Hall"], lambda p: p.name
828.         )
829. 
830.         publishers = (
831.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
832.             .annotate(num_books=Count("book__id"))
833.             .filter(num_books__gt=1)
834.         )
835.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
836. 
837.         books = Book.objects.annotate(num_authors=Count("authors__id")).filter(
838.             authors__name__contains="Norvig", num_authors__gt=1
839.         )
840.         self.assertQuerySetEqual(
841.             books, ["Artificial Intelligence: A Modern Approach"], lambda b: b.name
842.         )
843. 
844.     def test_more_aggregation(self):
845.         a = Author.objects.get(name__contains="Norvig")
846.         b = Book.objects.get(name__contains="Done Right")
847.         b.authors.add(a)
848.         b.save()
849. 
850.         vals = (
851.             Book.objects.annotate(num_authors=Count("authors__id"))
852.             .filter(authors__name__contains="Norvig", num_authors__gt=1)
853.             .aggregate(Avg("rating"))
854.         )
855.         self.assertEqual(vals, {"rating__avg": 4.25})
856. 
857.     def test_even_more_aggregate(self):
858.         publishers = (
859.             Publisher.objects.annotate(
860.                 earliest_book=Min("book__pubdate"),
861.             )
862.             .exclude(earliest_book=None)
863.             .order_by("earliest_book")
864.             .values(
865.                 "earliest_book",
866.                 "num_awards",
867.                 "id",
868.                 "name",
869.             )
870.         )
871.         self.assertEqual(
872.             list(publishers),
873.             [
874.                 {
875.                     "earliest_book": datetime.date(1991, 10, 15),
876.                     "num_awards": 9,
877.                     "id": self.p4.id,
878.                     "name": "Morgan Kaufmann",
879.                 },
880.                 {
881.                     "earliest_book": datetime.date(1995, 1, 15),
882.                     "num_awards": 7,
883.                     "id": self.p3.id,
884.                     "name": "Prentice Hall",
885.                 },
886.                 {
887.                     "earliest_book": datetime.date(2007, 12, 6),
888.                     "num_awards": 3,
889.                     "id": self.p1.id,
890.                     "name": "Apress",
891.                 },
892.                 {
893.                     "earliest_book": datetime.date(2008, 3, 3),
894.                     "num_awards": 1,
895.                     "id": self.p2.id,
896.                     "name": "Sams",
897.                 },
898.             ],
899.         )
900. 
901.         vals = Store.objects.aggregate(
902.             Max("friday_night_closing"), Min("original_opening")
903.         )
904.         self.assertEqual(
905.             vals,
906.             {
907.                 "friday_night_closing__max": datetime.time(23, 59, 59),
908.                 "original_opening__min": datetime.datetime(1945, 4, 25, 16, 24, 14),
909.             },
910.         )
911. 
912.     def test_annotate_values_list(self):
913.         books = (
914.             Book.objects.filter(pk=self.b1.pk)
915.             .annotate(mean_age=Avg("authors__age"))
916.             .values_list("pk", "isbn", "mean_age")
917.         )
918.         self.assertEqual(list(books), [(self.b1.id, "159059725", 34.5)])
919. 
920.         books = (
921.             Book.objects.filter(pk=self.b1.pk)
922.             .annotate(mean_age=Avg("authors__age"))
923.             .values_list("isbn")
924.         )
925.         self.assertEqual(list(books), [("159059725",)])
926. 
927.         books = (
928.             Book.objects.filter(pk=self.b1.pk)
929.             .annotate(mean_age=Avg("authors__age"))
930.             .values_list("mean_age")
931.         )
932.         self.assertEqual(list(books), [(34.5,)])
933. 
934.         books = (
935.             Book.objects.filter(pk=self.b1.pk)
936.             .annotate(mean_age=Avg("authors__age"))
937.             .values_list("mean_age", flat=True)
938.         )
939.         self.assertEqual(list(books), [34.5])
940. 
941.         books = (
942.             Book.objects.values_list("price")
943.             .annotate(count=Count("price"))
944.             .order_by("-count", "price")
945.         )
946.         self.assertEqual(
947.             list(books),
948.             [
949.                 (Decimal("29.69"), 2),
950.                 (Decimal("23.09"), 1),
951.                 (Decimal("30"), 1),
952.                 (Decimal("75"), 1),
953.                 (Decimal("82.8"), 1),
954.             ],
955.         )
956. 
957.     def test_dates_with_aggregation(self):
958.         """
959.         .dates() returns a distinct set of dates when applied to a
960.         QuerySet with aggregation.
961. 
962.         Refs #18056. Previously, .dates() would return distinct (date_kind,
963.         aggregation) sets, in this case (year, num_authors), so 2008 would be
964.         returned twice because there are books from 2008 with a different
965.         number of authors.
966.         """
967.         dates = Book.objects.annotate(num_authors=Count("authors")).dates(
968.             "pubdate", "year"
969.         )
970.         self.assertSequenceEqual(
971.             dates,
972.             [
973.                 datetime.date(1991, 1, 1),
974.                 datetime.date(1995, 1, 1),
975.                 datetime.date(2007, 1, 1),
976.                 datetime.date(2008, 1, 1),
977.             ],
978.         )
979. 
980.     def test_values_aggregation(self):
981.         # Refs #20782
982.         max_rating = Book.objects.values("rating").aggregate(max_rating=Max("rating"))
983.         self.assertEqual(max_rating["max_rating"], 5)
984.         max_books_per_rating = (
985.             Book.objects.values("rating")
986.             .annotate(books_per_rating=Count("id"))
987.             .aggregate(Max("books_per_rating"))
988.         )
989.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3})
990. 
991.     def test_ticket17424(self):
992.         """
993.         Doing exclude() on a foreign model after annotate() doesn't crash.
994.         """
995.         all_books = list(Book.objects.values_list("pk", flat=True).order_by("pk"))
996.         annotated_books = Book.objects.order_by("pk").annotate(one=Count("id"))
997. 
998.         # The value doesn't matter, we just need any negative
999.         # constraint on a related model that's a noop.
1000.         excluded_books = annotated_books.exclude(publisher__name="__UNLIKELY_VALUE__")
1001. 
1002.         # Try to generate query tree
1003.         str(excluded_books.query)
1004. 
1005.         self.assertQuerySetEqual(excluded_books, all_books, lambda x: x.pk)
1006. 
1007.         # Check internal state
1008.         self.assertIsNone(annotated_books.query.alias_map["aggregation_book"].join_type)
1009.         self.assertIsNone(excluded_books.query.alias_map["aggregation_book"].join_type)
1010. 
1011.     def test_ticket12886(self):
1012.         """
1013.         Aggregation over sliced queryset works correctly.
1014.         """
1015.         qs = Book.objects.order_by("-rating")[0:3]
1016.         vals = qs.aggregate(average_top3_rating=Avg("rating"))["average_top3_rating"]
1017.         self.assertAlmostEqual(vals, 4.5, places=2)
1018. 
1019.     def test_ticket11881(self):
1020.         """
1021.         Subqueries do not needlessly contain ORDER BY, SELECT FOR UPDATE or
1022.         select_related() stuff.
1023.         """
1024.         qs = (
1025.             Book.objects.select_for_update()
1026.             .order_by("pk")
1027.             .select_related("publisher")
1028.             .annotate(max_pk=Max("pk"))
1029.         )
1030.         with CaptureQueriesContext(connection) as captured_queries:
1031.             qs.aggregate(avg_pk=Avg("max_pk"))
1032.             self.assertEqual(len(captured_queries), 1)
1033.             qstr = captured_queries[0]["sql"].lower()
1034.             self.assertNotIn("for update", qstr)
1035.             forced_ordering = connection.ops.force_no_ordering()
1036.             if forced_ordering:
1037.                 # If the backend needs to force an ordering we make sure it's
1038.                 # the only "ORDER BY" clause present in the query.
1039.                 self.assertEqual(
1040.                     re.findall(r"order by (\w+)", qstr),
1041.                     [", ".join(f[1][0] for f in forced_ordering).lower()],
1042.                 )
1043.             else:
1044.                 self.assertNotIn("order by", qstr)
1045.             self.assertEqual(qstr.count(" join "), 0)
1046. 
1047.     def test_decimal_max_digits_has_no_effect(self):
1048.         Book.objects.all().delete()
1049.         a1 = Author.objects.first()
1050.         p1 = Publisher.objects.first()
1051.         thedate = timezone.now()
1052.         for i in range(10):
1053.             Book.objects.create(
1054.                 isbn="abcde{}".format(i),
1055.                 name="none",
1056.                 pages=10,
1057.                 rating=4.0,
1058.                 price=9999.98,
1059.                 contact=a1,
1060.                 publisher=p1,
1061.                 pubdate=thedate,
1062.             )
1063. 
1064.         book = Book.objects.aggregate(price_sum=Sum("price"))
1065.         self.assertEqual(book["price_sum"], Decimal("99999.80"))
1066. 
1067.     def test_nonaggregate_aggregation_throws(self):
1068.         with self.assertRaisesMessage(TypeError, "fail is not an aggregate expression"):
1069.             Book.objects.aggregate(fail=F("price"))
1070. 
1071.     def test_nonfield_annotation(self):
1072.         book = Book.objects.annotate(val=Max(Value(2))).first()
1073.         self.assertEqual(book.val, 2)
1074.         book = Book.objects.annotate(
1075.             val=Max(Value(2), output_field=IntegerField())
1076.         ).first()
1077.         self.assertEqual(book.val, 2)
1078.         book = Book.objects.annotate(val=Max(2, output_field=IntegerField())).first()
1079.         self.assertEqual(book.val, 2)
1080. 
1081.     def test_annotation_expressions(self):
1082.         authors = Author.objects.annotate(
1083.             combined_ages=Sum(F("age") + F("friends__age"))
1084.         ).order_by("name")
1085.         authors2 = Author.objects.annotate(
1086.             combined_ages=Sum("age") + Sum("friends__age")
1087.         ).order_by("name")
1088.         for qs in (authors, authors2):
1089.             self.assertQuerySetEqual(
1090.                 qs,
1091.                 [
1092.                     ("Adrian Holovaty", 132),
1093.                     ("Brad Dayley", None),
1094.                     ("Jacob Kaplan-Moss", 129),
1095.                     ("James Bennett", 63),
1096.                     ("Jeffrey Forcier", 128),
1097.                     ("Paul Bissex", 120),
1098.                     ("Peter Norvig", 103),
1099.                     ("Stuart Russell", 103),
1100.                     ("Wesley J. Chun", 176),
1101.                 ],
1102.                 lambda a: (a.name, a.combined_ages),
1103.             )
1104. 
1105.     def test_aggregation_expressions(self):
1106.         a1 = Author.objects.aggregate(av_age=Sum("age") / Count("*"))
1107.         a2 = Author.objects.aggregate(av_age=Sum("age") / Count("age"))
1108.         a3 = Author.objects.aggregate(av_age=Avg("age"))
1109.         self.assertEqual(a1, {"av_age": 37})
1110.         self.assertEqual(a2, {"av_age": 37})
1111.         self.assertEqual(a3, {"av_age": Approximate(37.4, places=1)})
1112. 
1113.     def test_avg_decimal_field(self):
1114.         v = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price")))[
1115.             "avg_price"
1116.         ]
1117.         self.assertIsInstance(v, Decimal)
1118.         self.assertEqual(v, Approximate(Decimal("47.39"), places=2))
1119. 
1120.     def test_order_of_precedence(self):
1121.         p1 = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price") + 2) * 3)
1122.         self.assertEqual(p1, {"avg_price": Approximate(Decimal("148.18"), places=2)})
1123. 
1124.         p2 = Book.objects.filter(rating=4).aggregate(avg_price=Avg("price") + 2 * 3)
1125.         self.assertEqual(p2, {"avg_price": Approximate(Decimal("53.39"), places=2)})
1126. 
1127.     def test_combine_different_types(self):
1128.         msg = (
1129.             "Cannot infer type of '+' expression involving these types: FloatField, "
1130.             "DecimalField. You must set output_field."
1131.         )
1132.         qs = Book.objects.annotate(sums=Sum("rating") + Sum("pages") + Sum("price"))
1133.         with self.assertRaisesMessage(FieldError, msg):
1134.             qs.first()
1135.         with self.assertRaisesMessage(FieldError, msg):
1136.             qs.first()
1137. 
1138.         b1 = Book.objects.annotate(
1139.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=IntegerField())
1140.         ).get(pk=self.b4.pk)
1141.         self.assertEqual(b1.sums, 383)
1142. 
1143.         b2 = Book.objects.annotate(
1144.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=FloatField())
1145.         ).get(pk=self.b4.pk)
1146.         self.assertEqual(b2.sums, 383.69)
1147. 
1148.         b3 = Book.objects.annotate(
1149.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=DecimalField())
1150.         ).get(pk=self.b4.pk)
1151.         self.assertEqual(b3.sums, Approximate(Decimal("383.69"), places=2))
1152. 
1153.     def test_complex_aggregations_require_kwarg(self):
1154.         with self.assertRaisesMessage(
1155.             TypeError, "Complex annotations require an alias"
1156.         ):
1157.             Author.objects.annotate(Sum(F("age") + F("friends__age")))
1158.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1159.             Author.objects.aggregate(Sum("age") / Count("age"))
1160.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1161.             Author.objects.aggregate(Sum(1))
1162. 
1163.     def test_aggregate_over_complex_annotation(self):
1164.         qs = Author.objects.annotate(combined_ages=Sum(F("age") + F("friends__age")))
1165. 
1166.         age = qs.aggregate(max_combined_age=Max("combined_ages"))
1167.         self.assertEqual(age["max_combined_age"], 176)
1168. 
1169.         age = qs.aggregate(max_combined_age_doubled=Max("combined_ages") * 2)
1170.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1171. 
1172.         age = qs.aggregate(
1173.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages")
1174.         )
1175.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1176. 
1177.         age = qs.aggregate(
1178.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1179.             sum_combined_age=Sum("combined_ages"),
1180.         )
1181.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1182.         self.assertEqual(age["sum_combined_age"], 954)
1183. 
1184.         age = qs.aggregate(
1185.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1186.             sum_combined_age_doubled=Sum("combined_ages") + Sum("combined_ages"),
1187.         )
1188.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1189.         self.assertEqual(age["sum_combined_age_doubled"], 954 * 2)
1190. 
1191.     def test_values_annotation_with_expression(self):
1192.         # ensure the F() is promoted to the group by clause
1193.         qs = Author.objects.values("name").annotate(another_age=Sum("age") + F("age"))
1194.         a = qs.get(name="Adrian Holovaty")
1195.         self.assertEqual(a["another_age"], 68)
1196. 
1197.         qs = qs.annotate(friend_count=Count("friends"))
1198.         a = qs.get(name="Adrian Holovaty")
1199.         self.assertEqual(a["friend_count"], 2)
1200. 
1201.         qs = (
1202.             qs.annotate(combined_age=Sum("age") + F("friends__age"))
1203.             .filter(name="Adrian Holovaty")
1204.             .order_by("-combined_age")
1205.         )
1206.         self.assertEqual(
1207.             list(qs),
1208.             [
1209.                 {
1210.                     "name": "Adrian Holovaty",
1211.                     "another_age": 68,
1212.                     "friend_count": 1,
1213.                     "combined_age": 69,
1214.                 },
1215.                 {
1216.                     "name": "Adrian Holovaty",
1217.                     "another_age": 68,
1218.                     "friend_count": 1,
1219.                     "combined_age": 63,
1220.                 },
1221.             ],
1222.         )
1223. 
1224.         vals = qs.values("name", "combined_age")
1225.         self.assertEqual(
1226.             list(vals),
1227.             [
1228.                 {"name": "Adrian Holovaty", "combined_age": 69},
1229.                 {"name": "Adrian Holovaty", "combined_age": 63},
1230.             ],
1231.         )
1232. 
1233.     def test_annotate_values_aggregate(self):
1234.         alias_age = (
1235.             Author.objects.annotate(age_alias=F("age"))
1236.             .values(
1237.                 "age_alias",
1238.             )
1239.             .aggregate(sum_age=Sum("age_alias"))
1240.         )
1241. 
1242.         age = Author.objects.values("age").aggregate(sum_age=Sum("age"))
1243. 
1244.         self.assertEqual(alias_age["sum_age"], age["sum_age"])
1245. 
1246.     def test_annotate_over_annotate(self):
1247.         author = (
1248.             Author.objects.annotate(age_alias=F("age"))
1249.             .annotate(sum_age=Sum("age_alias"))
1250.             .get(name="Adrian Holovaty")
1251.         )
1252. 
1253.         other_author = Author.objects.annotate(sum_age=Sum("age")).get(
1254.             name="Adrian Holovaty"
1255.         )
1256. 
1257.         self.assertEqual(author.sum_age, other_author.sum_age)
1258. 
1259.     def test_aggregate_over_aggregate(self):
1260.         msg = "Cannot compute Avg('age'): 'age' is an aggregate"
1261.         with self.assertRaisesMessage(FieldError, msg):
1262.             Author.objects.annotate(age_alias=F("age"),).aggregate(
1263.                 age=Sum(F("age")),
1264.                 avg_age=Avg(F("age")),
1265.             )
1266. 
1267.     def test_annotated_aggregate_over_annotated_aggregate(self):
1268.         with self.assertRaisesMessage(
1269.             FieldError, "Cannot compute Sum('id__max'): 'id__max' is an aggregate"
1270.         ):
1271.             Book.objects.annotate(Max("id")).annotate(Sum("id__max"))
1272. 
1273.         class MyMax(Max):
1274.             def as_sql(self, compiler, connection):
1275.                 self.set_source_expressions(self.get_source_expressions()[0:1])
1276.                 return super().as_sql(compiler, connection)
1277. 
1278.         with self.assertRaisesMessage(
1279.             FieldError, "Cannot compute Max('id__max'): 'id__max' is an aggregate"
1280.         ):
1281.             Book.objects.annotate(Max("id")).annotate(my_max=MyMax("id__max", "price"))
1282. 
1283.     def test_multi_arg_aggregate(self):
1284.         class MyMax(Max):
1285.             output_field = DecimalField()
1286. 
1287.             def as_sql(self, compiler, connection):
1288.                 copy = self.copy()
1289.                 copy.set_source_expressions(copy.get_source_expressions()[0:1])
1290.                 return super(MyMax, copy).as_sql(compiler, connection)
1291. 
1292.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1293.             Book.objects.aggregate(MyMax("pages", "price"))
1294. 
1295.         with self.assertRaisesMessage(
1296.             TypeError, "Complex annotations require an alias"
1297.         ):
1298.             Book.objects.annotate(MyMax("pages", "price"))
1299. 
1300.         Book.objects.aggregate(max_field=MyMax("pages", "price"))
1301. 
1302.     def test_add_implementation(self):
1303.         class MySum(Sum):
1304.             pass
1305. 
1306.         # test completely changing how the output is rendered
1307.         def lower_case_function_override(self, compiler, connection):
1308.             sql, params = compiler.compile(self.source_expressions[0])
1309.             substitutions = {
1310.                 "function": self.function.lower(),
1311.                 "expressions": sql,
1312.                 "distinct": "",
1313.             }
1314.             substitutions.update(self.extra)
1315.             return self.template % substitutions, params
1316. 
1317.         setattr(MySum, "as_" + connection.vendor, lower_case_function_override)
1318. 
1319.         qs = Book.objects.annotate(
1320.             sums=MySum(
1321.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1322.             )
1323.         )
1324.         self.assertEqual(str(qs.query).count("sum("), 1)
1325.         b1 = qs.get(pk=self.b4.pk)
1326.         self.assertEqual(b1.sums, 383)
1327. 
1328.         # test changing the dict and delegating
1329.         def lower_case_function_super(self, compiler, connection):
1330.             self.extra["function"] = self.function.lower()
1331.             return super(MySum, self).as_sql(compiler, connection)
1332. 
1333.         setattr(MySum, "as_" + connection.vendor, lower_case_function_super)
1334. 
1335.         qs = Book.objects.annotate(
1336.             sums=MySum(
1337.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1338.             )
1339.         )
1340.         self.assertEqual(str(qs.query).count("sum("), 1)
1341.         b1 = qs.get(pk=self.b4.pk)
1342.         self.assertEqual(b1.sums, 383)
1343. 
1344.         # test overriding all parts of the template
1345.         def be_evil(self, compiler, connection):
1346.             substitutions = {"function": "MAX", "expressions": "2", "distinct": ""}
1347.             substitutions.update(self.extra)
1348.             return self.template % substitutions, ()
1349. 
1350.         setattr(MySum, "as_" + connection.vendor, be_evil)
1351. 
1352.         qs = Book.objects.annotate(
1353.             sums=MySum(
1354.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1355.             )
1356.         )
1357.         self.assertEqual(str(qs.query).count("MAX("), 1)
1358.         b1 = qs.get(pk=self.b4.pk)
1359.         self.assertEqual(b1.sums, 2)
1360. 
1361.     def test_complex_values_aggregation(self):
1362.         max_rating = Book.objects.values("rating").aggregate(
1363.             double_max_rating=Max("rating") + Max("rating")
1364.         )
1365.         self.assertEqual(max_rating["double_max_rating"], 5 * 2)
1366. 
1367.         max_books_per_rating = (
1368.             Book.objects.values("rating")
1369.             .annotate(books_per_rating=Count("id") + 5)
1370.             .aggregate(Max("books_per_rating"))
1371.         )
1372.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3 + 5})
1373. 
1374.     def test_expression_on_aggregation(self):
1375.         qs = (
1376.             Publisher.objects.annotate(
1377.                 price_or_median=Greatest(
1378.                     Avg("book__rating", output_field=DecimalField()), Avg("book__price")
1379.                 )
1380.             )
1381.             .filter(price_or_median__gte=F("num_awards"))
1382.             .order_by("num_awards")
1383.         )
1384.         self.assertQuerySetEqual(qs, [1, 3, 7, 9], lambda v: v.num_awards)
1385. 
1386.         qs2 = (
1387.             Publisher.objects.annotate(
1388.                 rating_or_num_awards=Greatest(
1389.                     Avg("book__rating"), F("num_awards"), output_field=FloatField()
1390.                 )
1391.             )
1392.             .filter(rating_or_num_awards__gt=F("num_awards"))
1393.             .order_by("num_awards")
1394.         )
1395.         self.assertQuerySetEqual(qs2, [1, 3], lambda v: v.num_awards)
1396. 
1397.     def test_arguments_must_be_expressions(self):
1398.         msg = "QuerySet.aggregate() received non-expression(s): %s."
1399.         with self.assertRaisesMessage(TypeError, msg % FloatField()):
1400.             Book.objects.aggregate(FloatField())
1401.         with self.assertRaisesMessage(TypeError, msg % True):
1402.             Book.objects.aggregate(is_book=True)
1403.         with self.assertRaisesMessage(
1404.             TypeError, msg % ", ".join([str(FloatField()), "True"])
1405.         ):
1406.             Book.objects.aggregate(FloatField(), Avg("price"), is_book=True)
1407. 
1408.     def test_aggregation_subquery_annotation(self):
1409.         """Subquery annotations are excluded from the GROUP BY if they are
1410.         not explicitly grouped against."""
1411.         latest_book_pubdate_qs = (
1412.             Book.objects.filter(publisher=OuterRef("pk"))
1413.             .order_by("-pubdate")
1414.             .values("pubdate")[:1]
1415.         )
1416.         publisher_qs = Publisher.objects.annotate(
1417.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1418.         ).annotate(count=Count("book"))
1419.         with self.assertNumQueries(1) as ctx:
1420.             list(publisher_qs)
1421.         self.assertEqual(ctx[0]["sql"].count("SELECT"), 2)
1422.         # The GROUP BY should not be by alias either.
1423.         self.assertEqual(ctx[0]["sql"].lower().count("latest_book_pubdate"), 1)
1424. 
1425.     def test_aggregation_subquery_annotation_exists(self):
1426.         latest_book_pubdate_qs = (
1427.             Book.objects.filter(publisher=OuterRef("pk"))
1428.             .order_by("-pubdate")
1429.             .values("pubdate")[:1]
1430.         )
1431.         publisher_qs = Publisher.objects.annotate(
1432.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1433.             count=Count("book"),
1434.         )
1435.         self.assertTrue(publisher_qs.exists())
1436. 
1437.     def test_aggregation_filter_exists(self):
1438.         publishers_having_more_than_one_book_qs = (
1439.             Book.objects.values("publisher")
1440.             .annotate(cnt=Count("isbn"))
1441.             .filter(cnt__gt=1)
1442.         )
1443.         query = publishers_having_more_than_one_book_qs.query.exists()
1444.         _, _, group_by = query.get_compiler(connection=connection).pre_sql_setup()
1445.         self.assertEqual(len(group_by), 1)
1446. 
1447.     def test_aggregation_exists_annotation(self):
1448.         published_books = Book.objects.filter(publisher=OuterRef("pk"))
1449.         publisher_qs = Publisher.objects.annotate(
1450.             published_book=Exists(published_books),
1451.             count=Count("book"),
1452.         ).values_list("name", flat=True)
1453.         self.assertCountEqual(
1454.             list(publisher_qs),
1455.             [
1456.                 "Apress",
1457.                 "Morgan Kaufmann",
1458.                 "Jonno's House of Books",
1459.                 "Prentice Hall",
1460.                 "Sams",
1461.             ],
1462.         )
1463. 
1464.     def test_aggregation_subquery_annotation_values(self):
1465.         """
1466.         Subquery annotations and external aliases are excluded from the GROUP
1467.         BY if they are not selected.
1468.         """
1469.         books_qs = (
1470.             Book.objects.annotate(
1471.                 first_author_the_same_age=Subquery(
1472.                     Author.objects.filter(
1473.                         age=OuterRef("contact__friends__age"),
1474.                     )
1475.                     .order_by("age")
1476.                     .values("id")[:1],
1477.                 )
1478.             )
1479.             .filter(
1480.                 publisher=self.p1,
1481.                 first_author_the_same_age__isnull=False,
1482.             )
1483.             .annotate(
1484.                 min_age=Min("contact__friends__age"),
1485.             )
1486.             .values("name", "min_age")
1487.             .order_by("name")
1488.         )
1489.         self.assertEqual(
1490.             list(books_qs),
1491.             [
1492.                 {"name": "Practical Django Projects", "min_age": 34},
1493.                 {
1494.                     "name": (
1495.                         "The Definitive Guide to Django: Web Development Done Right"
1496.                     ),
1497.                     "min_age": 29,
1498.                 },
1499.             ],
1500.         )
1501. 
1502.     def test_aggregation_subquery_annotation_values_collision(self):
1503.         books_rating_qs = Book.objects.filter(
1504.             publisher=OuterRef("pk"),
1505.             price=Decimal("29.69"),
1506.         ).values("rating")
1507.         publisher_qs = (
1508.             Publisher.objects.filter(
1509.                 book__contact__age__gt=20,
1510.                 name=self.p1.name,
1511.             )
1512.             .annotate(
1513.                 rating=Subquery(books_rating_qs),
1514.                 contacts_count=Count("book__contact"),
1515.             )
1516.             .values("rating")
1517.             .annotate(total_count=Count("rating"))
1518.         )
1519.         self.assertEqual(
1520.             list(publisher_qs),
1521.             [
1522.                 {"rating": 4.0, "total_count": 2},
1523.             ],
1524.         )
1525. 
1526.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1527.     def test_aggregation_subquery_annotation_multivalued(self):
1528.         """
1529.         Subquery annotations must be included in the GROUP BY if they use
1530.         potentially multivalued relations (contain the LOOKUP_SEP).
1531.         """
1532.         subquery_qs = Author.objects.filter(
1533.             pk=OuterRef("pk"),
1534.             book__name=OuterRef("book__name"),
1535.         ).values("pk")
1536.         author_qs = Author.objects.annotate(
1537.             subquery_id=Subquery(subquery_qs),
1538.         ).annotate(count=Count("book"))
1539.         self.assertEqual(author_qs.count(), Author.objects.count())
1540. 
1541.     def test_aggregation_order_by_not_selected_annotation_values(self):
1542.         result_asc = [
1543.             self.b4.pk,
1544.             self.b3.pk,
1545.             self.b1.pk,
1546.             self.b2.pk,
1547.             self.b5.pk,
1548.             self.b6.pk,
1549.         ]
1550.         result_desc = result_asc[::-1]
1551.         tests = [
1552.             ("min_related_age", result_asc),
1553.             ("-min_related_age", result_desc),
1554.             (F("min_related_age"), result_asc),
1555.             (F("min_related_age").asc(), result_asc),
1556.             (F("min_related_age").desc(), result_desc),
1557.         ]
1558.         for ordering, expected_result in tests:
1559.             with self.subTest(ordering=ordering):
1560.                 books_qs = (
1561.                     Book.objects.annotate(
1562.                         min_age=Min("authors__age"),
1563.                     )
1564.                     .annotate(
1565.                         min_related_age=Coalesce("min_age", "contact__age"),
1566.                     )
1567.                     .order_by(ordering)
1568.                     .values_list("pk", flat=True)
1569.                 )
1570.                 self.assertEqual(list(books_qs), expected_result)
1571. 
1572.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1573.     def test_group_by_subquery_annotation(self):
1574.         """
1575.         Subquery annotations are included in the GROUP BY if they are
1576.         grouped against.
1577.         """
1578.         long_books_count_qs = (
1579.             Book.objects.filter(
1580.                 publisher=OuterRef("pk"),
1581.                 pages__gt=400,
1582.             )
1583.             .values("publisher")
1584.             .annotate(count=Count("pk"))
1585.             .values("count")
1586.         )
1587.         groups = [
1588.             Subquery(long_books_count_qs),
1589.             long_books_count_qs,
1590.             long_books_count_qs.query,
1591.         ]
1592.         for group in groups:
1593.             with self.subTest(group=group.__class__.__name__):
1594.                 long_books_count_breakdown = Publisher.objects.values_list(
1595.                     group,
1596.                 ).annotate(total=Count("*"))
1597.                 self.assertEqual(dict(long_books_count_breakdown), {None: 1, 1: 4})
1598. 
1599.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1600.     def test_group_by_exists_annotation(self):
1601.         """
1602.         Exists annotations are included in the GROUP BY if they are
1603.         grouped against.
1604.         """
1605.         long_books_qs = Book.objects.filter(
1606.             publisher=OuterRef("pk"),
1607.             pages__gt=800,
1608.         )
1609.         has_long_books_breakdown = Publisher.objects.values_list(
1610.             Exists(long_books_qs),
1611.         ).annotate(total=Count("*"))
1612.         self.assertEqual(dict(has_long_books_breakdown), {True: 2, False: 3})
1613. 
1614.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1615.     def test_aggregation_subquery_annotation_related_field(self):
1616.         publisher = Publisher.objects.create(name=self.a9.name, num_awards=2)
1617.         book = Book.objects.create(
1618.             isbn="159059999",
1619.             name="Test book.",
1620.             pages=819,
1621.             rating=2.5,
1622.             price=Decimal("14.44"),
1623.             contact=self.a9,
1624.             publisher=publisher,
1625.             pubdate=datetime.date(2019, 12, 6),
1626.         )
1627.         book.authors.add(self.a5, self.a6, self.a7)
1628.         books_qs = (
1629.             Book.objects.annotate(
1630.                 contact_publisher=Subquery(
1631.                     Publisher.objects.filter(
1632.                         pk=OuterRef("publisher"),
1633.                         name=OuterRef("contact__name"),
1634.                     ).values("name")[:1],
1635.                 )
1636.             )
1637.             .filter(
1638.                 contact_publisher__isnull=False,
1639.             )
1640.             .annotate(count=Count("authors"))
1641.         )
1642.         with self.assertNumQueries(1) as ctx:
1643.             self.assertSequenceEqual(books_qs, [book])
1644.         # Outerquery SELECT, annotation SELECT, and WHERE SELECT but GROUP BY
1645.         # selected alias, if allowed.
1646.         if connection.features.allows_group_by_refs:
1647.             self.assertEqual(ctx[0]["sql"].count("SELECT"), 3)
1648. 
1649.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1650.     def test_aggregation_nested_subquery_outerref(self):
1651.         publisher_with_same_name = Publisher.objects.filter(
1652.             id__in=Subquery(
1653.                 Publisher.objects.filter(
1654.                     name=OuterRef(OuterRef("publisher__name")),
1655.                 ).values("id"),
1656.             ),
1657.         ).values(publisher_count=Count("id"))[:1]
1658.         books_breakdown = Book.objects.annotate(
1659.             publisher_count=Subquery(publisher_with_same_name),
1660.             authors_count=Count("authors"),
1661.         ).values_list("publisher_count", flat=True)
1662.         self.assertSequenceEqual(books_breakdown, [1] * 6)
1663. 
1664.     def test_aggregation_exists_multivalued_outeref(self):
1665.         self.assertCountEqual(
1666.             Publisher.objects.annotate(
1667.                 books_exists=Exists(
1668.                     Book.objects.filter(publisher=OuterRef("book__publisher"))
1669.                 ),
1670.                 books_count=Count("book"),
1671.             ),
1672.             Publisher.objects.all(),
1673.         )
1674. 
1675.     def test_filter_in_subquery_or_aggregation(self):
1676.         """
1677.         Filtering against an aggregate requires the usage of the HAVING clause.
1678. 
1679.         If such a filter is unionized to a non-aggregate one the latter will
1680.         also need to be moved to the HAVING clause and have its grouping
1681.         columns used in the GROUP BY.
1682. 
1683.         When this is done with a subquery the specialized logic in charge of
1684.         using outer reference columns to group should be used instead of the
1685.         subquery itself as the latter might return multiple rows.
1686.         """
1687.         authors = Author.objects.annotate(
1688.             Count("book"),
1689.         ).filter(Q(book__count__gt=0) | Q(pk__in=Book.objects.values("authors")))
1690.         self.assertCountEqual(authors, Author.objects.all())
1691. 
1692.     def test_aggregation_random_ordering(self):
1693.         """Random() is not included in the GROUP BY when used for ordering."""
1694.         authors = Author.objects.annotate(contact_count=Count("book")).order_by("?")
1695.         self.assertQuerySetEqual(
1696.             authors,
1697.             [
1698.                 ("Adrian Holovaty", 1),
1699.                 ("Jacob Kaplan-Moss", 1),
1700.                 ("Brad Dayley", 1),
1701.                 ("James Bennett", 1),
1702.                 ("Jeffrey Forcier", 1),
1703.                 ("Paul Bissex", 1),
1704.                 ("Wesley J. Chun", 1),
1705.                 ("Stuart Russell", 1),
1706.                 ("Peter Norvig", 2),
1707.             ],
1708.             lambda a: (a.name, a.contact_count),
1709.             ordered=False,
1710.         )
1711. 
1712.     def test_empty_result_optimization(self):
1713.         with self.assertNumQueries(0):
1714.             self.assertEqual(
1715.                 Publisher.objects.none().aggregate(
1716.                     sum_awards=Sum("num_awards"),
1717.                     books_count=Count("book"),
1718.                 ),
1719.                 {
1720.                     "sum_awards": None,
1721.                     "books_count": 0,
1722.                 },
1723.             )
1724.         # Expression without empty_result_set_value forces queries to be
1725.         # executed even if they would return an empty result set.
1726.         raw_books_count = Func("book", function="COUNT")
1727.         raw_books_count.contains_aggregate = True
1728.         with self.assertNumQueries(1):
1729.             self.assertEqual(
1730.                 Publisher.objects.none().aggregate(
1731.                     sum_awards=Sum("num_awards"),
1732.                     books_count=raw_books_count,
1733.                 ),
1734.                 {
1735.                     "sum_awards": None,
1736.                     "books_count": 0,
1737.                 },
1738.             )
1739. 
1740.     def test_coalesced_empty_result_set(self):
1741.         with self.assertNumQueries(0):
1742.             self.assertEqual(
1743.                 Publisher.objects.none().aggregate(
1744.                     sum_awards=Coalesce(Sum("num_awards"), 0),
1745.                 )["sum_awards"],
1746.                 0,
1747.             )
1748.         # Multiple expressions.
1749.         with self.assertNumQueries(0):
1750.             self.assertEqual(
1751.                 Publisher.objects.none().aggregate(
1752.                     sum_awards=Coalesce(Sum("num_awards"), None, 0),
1753.                 )["sum_awards"],
1754.                 0,
1755.             )
1756.         # Nested coalesce.
1757.         with self.assertNumQueries(0):
1758.             self.assertEqual(
1759.                 Publisher.objects.none().aggregate(
1760.                     sum_awards=Coalesce(Coalesce(Sum("num_awards"), None), 0),
1761.                 )["sum_awards"],
1762.                 0,
1763.             )
1764.         # Expression coalesce.
1765.         with self.assertNumQueries(1):
1766.             self.assertIsInstance(
1767.                 Store.objects.none().aggregate(
1768.                     latest_opening=Coalesce(
1769.                         Max("original_opening"),
1770.                         RawSQL("CURRENT_TIMESTAMP", []),
1771.                     ),
1772.                 )["latest_opening"],
1773.                 datetime.datetime,
1774.             )
1775. 
1776.     def test_aggregation_default_unsupported_by_count(self):
1777.         msg = "Count does not allow default."
1778.         with self.assertRaisesMessage(TypeError, msg):
1779.             Count("age", default=0)
1780. 
1781.     def test_aggregation_default_unset(self):
1782.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1783.             with self.subTest(Aggregate):
1784.                 result = Author.objects.filter(age__gt=100).aggregate(
1785.                     value=Aggregate("age"),
1786.                 )
1787.                 self.assertIsNone(result["value"])
1788. 
1789.     def test_aggregation_default_zero(self):
1790.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1791.             with self.subTest(Aggregate):
1792.                 result = Author.objects.filter(age__gt=100).aggregate(
1793.                     value=Aggregate("age", default=0),
1794.                 )
1795.                 self.assertEqual(result["value"], 0)
1796. 
1797.     def test_aggregation_default_integer(self):
1798.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1799.             with self.subTest(Aggregate):
1800.                 result = Author.objects.filter(age__gt=100).aggregate(
1801.                     value=Aggregate("age", default=21),
1802.                 )
1803.                 self.assertEqual(result["value"], 21)
1804. 
1805.     def test_aggregation_default_expression(self):
1806.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1807.             with self.subTest(Aggregate):
1808.                 result = Author.objects.filter(age__gt=100).aggregate(
1809.                     value=Aggregate("age", default=Value(5) * Value(7)),
1810.                 )
1811.                 self.assertEqual(result["value"], 35)
1812. 
1813.     def test_aggregation_default_group_by(self):
1814.         qs = (
1815.             Publisher.objects.values("name")
1816.             .annotate(
1817.                 books=Count("book"),
1818.                 pages=Sum("book__pages", default=0),
1819.             )
1820.             .filter(books=0)
1821.         )
1822.         self.assertSequenceEqual(
1823.             qs,
1824.             [{"name": "Jonno's House of Books", "books": 0, "pages": 0}],
1825.         )
1826. 
1827.     def test_aggregation_default_compound_expression(self):
1828.         # Scale rating to a percentage; default to 50% if no books published.
1829.         formula = Avg("book__rating", default=2.5) * 20.0
1830.         queryset = Publisher.objects.annotate(rating=formula).order_by("name")
1831.         self.assertSequenceEqual(
1832.             queryset.values("name", "rating"),
1833.             [
1834.                 {"name": "Apress", "rating": 85.0},
1835.                 {"name": "Jonno's House of Books", "rating": 50.0},
1836.                 {"name": "Morgan Kaufmann", "rating": 100.0},
1837.                 {"name": "Prentice Hall", "rating": 80.0},
1838.                 {"name": "Sams", "rating": 60.0},
1839.             ],
1840.         )
1841. 
1842.     def test_aggregation_default_using_time_from_python(self):
1843.         expr = Min(
1844.             "store__friday_night_closing",
1845.             filter=~Q(store__name="Amazon.com"),
1846.             default=datetime.time(17),
1847.         )
1848.         if connection.vendor == "mysql":
1849.             # Workaround for #30224 for MySQL & MariaDB.
1850.             expr.default = Cast(expr.default, TimeField())
1851.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1852.         self.assertSequenceEqual(
1853.             queryset.values("isbn", "oldest_store_opening"),
1854.             [
1855.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1856.                 {
1857.                     "isbn": "013790395",
1858.                     "oldest_store_opening": datetime.time(23, 59, 59),
1859.                 },
1860.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(17)},
1861.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1862.                 {
1863.                     "isbn": "159059725",
1864.                     "oldest_store_opening": datetime.time(23, 59, 59),
1865.                 },
1866.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1867.             ],
1868.         )
1869. 
1870.     def test_aggregation_default_using_time_from_database(self):
1871.         now = timezone.now().astimezone(datetime.timezone.utc)
1872.         expr = Min(
1873.             "store__friday_night_closing",
1874.             filter=~Q(store__name="Amazon.com"),
1875.             default=TruncHour(NowUTC(), output_field=TimeField()),
1876.         )
1877.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1878.         self.assertSequenceEqual(
1879.             queryset.values("isbn", "oldest_store_opening"),
1880.             [
1881.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1882.                 {
1883.                     "isbn": "013790395",
1884.                     "oldest_store_opening": datetime.time(23, 59, 59),
1885.                 },
1886.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(now.hour)},
1887.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1888.                 {
1889.                     "isbn": "159059725",
1890.                     "oldest_store_opening": datetime.time(23, 59, 59),
1891.                 },
1892.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1893.             ],
1894.         )
1895. 
1896.     def test_aggregation_default_using_date_from_python(self):
1897.         expr = Min("book__pubdate", default=datetime.date(1970, 1, 1))
1898.         if connection.vendor == "mysql":
1899.             # Workaround for #30224 for MySQL & MariaDB.
1900.             expr.default = Cast(expr.default, DateField())
1901.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1902.         self.assertSequenceEqual(
1903.             queryset.values("name", "earliest_pubdate"),
1904.             [
1905.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1906.                 {
1907.                     "name": "Jonno's House of Books",
1908.                     "earliest_pubdate": datetime.date(1970, 1, 1),
1909.                 },
1910.                 {
1911.                     "name": "Morgan Kaufmann",
1912.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1913.                 },
1914.                 {
1915.                     "name": "Prentice Hall",
1916.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1917.                 },
1918.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1919.             ],
1920.         )
1921. 
1922.     def test_aggregation_default_using_date_from_database(self):
1923.         now = timezone.now().astimezone(datetime.timezone.utc)
1924.         expr = Min("book__pubdate", default=TruncDate(NowUTC()))
1925.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1926.         self.assertSequenceEqual(
1927.             queryset.values("name", "earliest_pubdate"),
1928.             [
1929.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1930.                 {"name": "Jonno's House of Books", "earliest_pubdate": now.date()},
1931.                 {
1932.                     "name": "Morgan Kaufmann",
1933.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1934.                 },
1935.                 {
1936.                     "name": "Prentice Hall",
1937.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1938.                 },
1939.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1940.             ],
1941.         )
1942. 
1943.     def test_aggregation_default_using_datetime_from_python(self):
1944.         expr = Min(
1945.             "store__original_opening",
1946.             filter=~Q(store__name="Amazon.com"),
1947.             default=datetime.datetime(1970, 1, 1),
1948.         )
1949.         if connection.vendor == "mysql":
1950.             # Workaround for #30224 for MySQL & MariaDB.
1951.             expr.default = Cast(expr.default, DateTimeField())
1952.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1953.         self.assertSequenceEqual(
1954.             queryset.values("isbn", "oldest_store_opening"),
1955.             [
1956.                 {
1957.                     "isbn": "013235613",
1958.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1959.                 },
1960.                 {
1961.                     "isbn": "013790395",
1962.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1963.                 },
1964.                 {
1965.                     "isbn": "067232959",
1966.                     "oldest_store_opening": datetime.datetime(1970, 1, 1),
1967.                 },
1968.                 {
1969.                     "isbn": "155860191",
1970.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1971.                 },
1972.                 {
1973.                     "isbn": "159059725",
1974.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1975.                 },
1976.                 {
1977.                     "isbn": "159059996",
1978.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1979.                 },
1980.             ],
1981.         )
1982. 
1983.     def test_aggregation_default_using_datetime_from_database(self):
1984.         now = timezone.now().astimezone(datetime.timezone.utc)
1985.         expr = Min(
1986.             "store__original_opening",
1987.             filter=~Q(store__name="Amazon.com"),
1988.             default=TruncHour(NowUTC(), output_field=DateTimeField()),
1989.         )
1990.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1991.         self.assertSequenceEqual(
1992.             queryset.values("isbn", "oldest_store_opening"),
1993.             [
1994.                 {
1995.                     "isbn": "013235613",
1996.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1997.                 },
1998.                 {
1999.                     "isbn": "013790395",
2000.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2001.                 },
2002.                 {
2003.                     "isbn": "067232959",
2004.                     "oldest_store_opening": now.replace(
2005.                         minute=0, second=0, microsecond=0, tzinfo=None
2006.                     ),
2007.                 },
2008.                 {
2009.                     "isbn": "155860191",
2010.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2011.                 },
2012.                 {
2013.                     "isbn": "159059725",
2014.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2015.                 },
2016.                 {
2017.                     "isbn": "159059996",
2018.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2019.                 },
2020.             ],
2021.         )
2022. 
2023.     def test_aggregation_default_using_duration_from_python(self):
2024.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2025.             value=Sum("duration", default=datetime.timedelta(0)),
2026.         )
2027.         self.assertEqual(result["value"], datetime.timedelta(0))
2028. 
2029.     def test_aggregation_default_using_duration_from_database(self):
2030.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2031.             value=Sum("duration", default=Now() - Now()),
2032.         )
2033.         self.assertEqual(result["value"], datetime.timedelta(0))
2034. 
2035.     def test_aggregation_default_using_decimal_from_python(self):
2036.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2037.             value=Sum("price", default=Decimal("0.00")),
2038.         )
2039.         self.assertEqual(result["value"], Decimal("0.00"))
2040. 
2041.     def test_aggregation_default_using_decimal_from_database(self):
2042.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2043.             value=Sum("price", default=Pi()),
2044.         )
2045.         self.assertAlmostEqual(result["value"], Decimal.from_float(math.pi), places=6)
2046. 
2047.     def test_aggregation_default_passed_another_aggregate(self):
2048.         result = Book.objects.aggregate(
2049.             value=Sum("price", filter=Q(rating__lt=3.0), default=Avg("pages") / 10.0),
2050.         )
2051.         self.assertAlmostEqual(result["value"], Decimal("61.72"), places=2)
2052. 
2053.     def test_aggregation_default_after_annotation(self):
2054.         result = Publisher.objects.annotate(
2055.             double_num_awards=F("num_awards") * 2,
2056.         ).aggregate(value=Sum("double_num_awards", default=0))
2057.         self.assertEqual(result["value"], 40)
2058. 
2059.     def test_aggregation_default_not_in_aggregate(self):
2060.         result = Publisher.objects.annotate(
2061.             avg_rating=Avg("book__rating", default=2.5),
2062.         ).aggregate(Sum("num_awards"))
2063.         self.assertEqual(result["num_awards__sum"], 20)
2064. 
2065.     def test_exists_none_with_aggregate(self):
2066.         qs = Book.objects.annotate(
2067.             count=Count("id"),
2068.             exists=Exists(Author.objects.none()),
2069.         )
2070.         self.assertEqual(len(qs), 6)
2071. 
2072.     def test_alias_sql_injection(self):
2073.         crafted_alias = """injected_name" from "aggregation_author"; --"""
2074.         msg = (
2075.             "Column aliases cannot contain whitespace characters, quotation marks, "
2076.             "semicolons, or SQL comments."
2077.         )
2078.         with self.assertRaisesMessage(ValueError, msg):
2079.             Author.objects.aggregate(**{crafted_alias: Avg("age")})
2080. 
2081.     def test_exists_extra_where_with_aggregate(self):
2082.         qs = Book.objects.annotate(
2083.             count=Count("id"),
2084.             exists=Exists(Author.objects.extra(where=["1=0"])),
2085.         )
2086.         self.assertEqual(len(qs), 6)

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 17:40:19,162 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file `tests/aggregation/tests.py`. The provided context contains the content of this file from line 1 to 2086, so the entire content is relevant to the user's query.", relative_path='tests/aggregation/tests.py', start_line=1, end_line=2086)]
2025-12-21 17:40:19,166 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/aggregation/tests.py`.
2025-12-21 17:40:19,166 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 17:40:19,166 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 17:40:19,166 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 17:40:19,166 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 17:40:19,167 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   ├── custom_sitemap_index.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Strip unused annotations from count queries

Description: Description
	
The query below produces a SQL statement that includes the Count('chapters'), despite not not being used in any filter operations.
Book.objects.annotate(Count('chapters')).count()
It produces the same results as:
Book.objects.count()
Django could be more intelligent about what annotations to include in the query produced by queryset.count(), stripping out any annotations that are not referenced by filters, other annotations or ordering. This should speed up calls to count() with complex annotations.
There seems to be precedent for this: select_related calls are ignored with count() queries.

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 9735ce10c8..c040e834c6 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -549,8 +549,31 @@ class Query(BaseExpression):
         """
         Perform a COUNT() query using the current filter constraints.
         """
+        # If it's safe to ignore existing annotations, build a fresh query to
+        # avoid carrying over their joins into the COUNT() query.
+        if (
+            not self.has_filters()
+            and not self.order_by
+            and not self.extra_order_by
+            and not self.is_sliced
+            and not self.distinct
+            and not self.distinct_fields
+            and not self.combinator
+            and self.select_related is False
+            and not self.extra
+            and not self.extra_tables
+        ):
+            fresh = self.__class__(self.model)
+            # Ensure base table alias is initialized for the FROM clause.
+            fresh.get_initial_alias()
+            fresh.add_annotation(Count("*"), alias="__count", is_summary=True)
+            fresh.set_annotation_mask(["__count"])  # Only select __count.
+            fresh.set_extra_mask(())  # Exclude any extra(select=...).
+            return fresh.get_aggregation(using, ["__count"])["__count"]
         obj = self.clone()
         obj.add_annotation(Count("*"), alias="__count", is_summary=True)
+        obj.set_annotation_mask(["__count"])  # Only select __count.
+        obj.set_extra_mask(())  # Exclude any extra(select=...).
         return obj.get_aggregation(using, ["__count"])["__count"]
 
     def has_filters(self):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/aggregation/tests.py`.
Extra Requirements: 
Purpose: I need to find existing test cases that test the `.count()` method on annotated querysets, and this file is the most likely place to find them.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/aggregation/tests.py
Line number range: 1 - 2086
Content:
1. import datetime
2. import math
3. import re
4. from decimal import Decimal
5. 
6. from django.core.exceptions import FieldError
7. from django.db import connection
8. from django.db.models import (
9.     Avg,
10.     Case,
11.     Count,
12.     DateField,
13.     DateTimeField,
14.     DecimalField,
15.     DurationField,
16.     Exists,
17.     F,
18.     FloatField,
19.     IntegerField,
20.     Max,
21.     Min,
22.     OuterRef,
23.     Q,
24.     StdDev,
25.     Subquery,
26.     Sum,
27.     TimeField,
28.     Value,
29.     Variance,
30.     When,
31. )
32. from django.db.models.expressions import Func, RawSQL
33. from django.db.models.functions import (
34.     Cast,
35.     Coalesce,
36.     Greatest,
37.     Now,
38.     Pi,
39.     TruncDate,
40.     TruncHour,
41. )
42. from django.test import TestCase
43. from django.test.testcases import skipUnlessDBFeature
44. from django.test.utils import Approximate, CaptureQueriesContext
45. from django.utils import timezone
46. 
47. from .models import Author, Book, Publisher, Store
48. 
49. 
50. class NowUTC(Now):
51.     template = "CURRENT_TIMESTAMP"
52.     output_field = DateTimeField()
53. 
54.     def as_sql(self, compiler, connection, **extra_context):
55.         if connection.features.test_now_utc_template:
56.             extra_context["template"] = connection.features.test_now_utc_template
57.         return super().as_sql(compiler, connection, **extra_context)
58. 
59. 
60. class AggregateTestCase(TestCase):
61.     @classmethod
62.     def setUpTestData(cls):
63.         cls.a1 = Author.objects.create(name="Adrian Holovaty", age=34)
64.         cls.a2 = Author.objects.create(name="Jacob Kaplan-Moss", age=35)
65.         cls.a3 = Author.objects.create(name="Brad Dayley", age=45)
66.         cls.a4 = Author.objects.create(name="James Bennett", age=29)
67.         cls.a5 = Author.objects.create(name="Jeffrey Forcier", age=37)
68.         cls.a6 = Author.objects.create(name="Paul Bissex", age=29)
69.         cls.a7 = Author.objects.create(name="Wesley J. Chun", age=25)
70.         cls.a8 = Author.objects.create(name="Peter Norvig", age=57)
71.         cls.a9 = Author.objects.create(name="Stuart Russell", age=46)
72.         cls.a1.friends.add(cls.a2, cls.a4)
73.         cls.a2.friends.add(cls.a1, cls.a7)
74.         cls.a4.friends.add(cls.a1)
75.         cls.a5.friends.add(cls.a6, cls.a7)
76.         cls.a6.friends.add(cls.a5, cls.a7)
77.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
78.         cls.a8.friends.add(cls.a9)
79.         cls.a9.friends.add(cls.a8)
80. 
81.         cls.p1 = Publisher.objects.create(
82.             name="Apress", num_awards=3, duration=datetime.timedelta(days=1)
83.         )
84.         cls.p2 = Publisher.objects.create(
85.             name="Sams", num_awards=1, duration=datetime.timedelta(days=2)
86.         )
87.         cls.p3 = Publisher.objects.create(name="Prentice Hall", num_awards=7)
88.         cls.p4 = Publisher.objects.create(name="Morgan Kaufmann", num_awards=9)
89.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
90. 
91.         cls.b1 = Book.objects.create(
92.             isbn="159059725",
93.             name="The Definitive Guide to Django: Web Development Done Right",
94.             pages=447,
95.             rating=4.5,
96.             price=Decimal("30.00"),
97.             contact=cls.a1,
98.             publisher=cls.p1,
99.             pubdate=datetime.date(2007, 12, 6),
100.         )
101.         cls.b2 = Book.objects.create(
102.             isbn="067232959",
103.             name="Sams Teach Yourself Django in 24 Hours",
104.             pages=528,
105.             rating=3.0,
106.             price=Decimal("23.09"),
107.             contact=cls.a3,
108.             publisher=cls.p2,
109.             pubdate=datetime.date(2008, 3, 3),
110.         )
111.         cls.b3 = Book.objects.create(
112.             isbn="159059996",
113.             name="Practical Django Projects",
114.             pages=300,
115.             rating=4.0,
116.             price=Decimal("29.69"),
117.             contact=cls.a4,
118.             publisher=cls.p1,
119.             pubdate=datetime.date(2008, 6, 23),
120.         )
121.         cls.b4 = Book.objects.create(
122.             isbn="013235613",
123.             name="Python Web Development with Django",
124.             pages=350,
125.             rating=4.0,
126.             price=Decimal("29.69"),
127.             contact=cls.a5,
128.             publisher=cls.p3,
129.             pubdate=datetime.date(2008, 11, 3),
130.         )
131.         cls.b5 = Book.objects.create(
132.             isbn="013790395",
133.             name="Artificial Intelligence: A Modern Approach",
134.             pages=1132,
135.             rating=4.0,
136.             price=Decimal("82.80"),
137.             contact=cls.a8,
138.             publisher=cls.p3,
139.             pubdate=datetime.date(1995, 1, 15),
140.         )
141.         cls.b6 = Book.objects.create(
142.             isbn="155860191",
143.             name=(
144.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
145.                 "Common Lisp"
146.             ),
147.             pages=946,
148.             rating=5.0,
149.             price=Decimal("75.00"),
150.             contact=cls.a8,
151.             publisher=cls.p4,
152.             pubdate=datetime.date(1991, 10, 15),
153.         )
154.         cls.b1.authors.add(cls.a1, cls.a2)
155.         cls.b2.authors.add(cls.a3)
156.         cls.b3.authors.add(cls.a4)
157.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
158.         cls.b5.authors.add(cls.a8, cls.a9)
159.         cls.b6.authors.add(cls.a8)
160. 
161.         s1 = Store.objects.create(
162.             name="Amazon.com",
163.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
164.             friday_night_closing=datetime.time(23, 59, 59),
165.         )
166.         s2 = Store.objects.create(
167.             name="Books.com",
168.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
169.             friday_night_closing=datetime.time(23, 59, 59),
170.         )
171.         s3 = Store.objects.create(
172.             name="Mamma and Pappa's Books",
173.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
174.             friday_night_closing=datetime.time(21, 30),
175.         )
176.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
177.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
178.         s3.books.add(cls.b3, cls.b4, cls.b6)
179. 
180.     def test_empty_aggregate(self):
181.         self.assertEqual(Author.objects.aggregate(), {})
182. 
183.     def test_aggregate_in_order_by(self):
184.         msg = (
185.             "Using an aggregate in order_by() without also including it in "
186.             "annotate() is not allowed: Avg(F(book__rating)"
187.         )
188.         with self.assertRaisesMessage(FieldError, msg):
189.             Author.objects.values("age").order_by(Avg("book__rating"))
190. 
191.     def test_single_aggregate(self):
192.         vals = Author.objects.aggregate(Avg("age"))
193.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
194. 
195.     def test_multiple_aggregates(self):
196.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
197.         self.assertEqual(
198.             vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)}
199.         )
200. 
201.     def test_filter_aggregate(self):
202.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
203.         self.assertEqual(vals, {"age__sum": 254})
204. 
205.     def test_related_aggregate(self):
206.         vals = Author.objects.aggregate(Avg("friends__age"))
207.         self.assertEqual(vals, {"friends__age__avg": Approximate(34.07, places=2)})
208. 
209.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
210.         self.assertEqual(vals, {"authors__age__avg": Approximate(38.2857, places=2)})
211. 
212.         vals = Author.objects.filter(name__contains="a").aggregate(Avg("book__rating"))
213.         self.assertEqual(vals, {"book__rating__avg": 4.0})
214. 
215.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
216.         self.assertEqual(vals, {"publisher__num_awards__sum": 30})
217. 
218.         vals = Publisher.objects.aggregate(Sum("book__price"))
219.         self.assertEqual(vals, {"book__price__sum": Decimal("270.27")})
220. 
221.     def test_aggregate_multi_join(self):
222.         vals = Store.objects.aggregate(Max("books__authors__age"))
223.         self.assertEqual(vals, {"books__authors__age__max": 57})
224. 
225.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
226.         self.assertEqual(vals, {"book__publisher__num_awards__min": 1})
227. 
228.     def test_aggregate_alias(self):
229.         vals = Store.objects.filter(name="Amazon.com").aggregate(
230.             amazon_mean=Avg("books__rating")
231.         )
232.         self.assertEqual(vals, {"amazon_mean": Approximate(4.08, places=2)})
233. 
234.     def test_aggregate_transform(self):
235.         vals = Store.objects.aggregate(min_month=Min("original_opening__month"))
236.         self.assertEqual(vals, {"min_month": 3})
237. 
238.     def test_aggregate_join_transform(self):
239.         vals = Publisher.objects.aggregate(min_year=Min("book__pubdate__year"))
240.         self.assertEqual(vals, {"min_year": 1991})
241. 
242.     def test_annotate_basic(self):
243.         self.assertQuerySetEqual(
244.             Book.objects.annotate().order_by("pk"),
245.             [
246.                 "The Definitive Guide to Django: Web Development Done Right",
247.                 "Sams Teach Yourself Django in 24 Hours",
248.                 "Practical Django Projects",
249.                 "Python Web Development with Django",
250.                 "Artificial Intelligence: A Modern Approach",
251.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
252.                 "Common Lisp",
253.             ],
254.             lambda b: b.name,
255.         )
256. 
257.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
258.         b = books.get(pk=self.b1.pk)
259.         self.assertEqual(
260.             b.name, "The Definitive Guide to Django: Web Development Done Right"
261.         )
262.         self.assertEqual(b.mean_age, 34.5)
263. 
264.     def test_annotate_defer(self):
265.         qs = (
266.             Book.objects.annotate(page_sum=Sum("pages"))
267.             .defer("name")
268.             .filter(pk=self.b1.pk)
269.         )
270. 
271.         rows = [
272.             (
273.                 self.b1.id,
274.                 "159059725",
275.                 447,
276.                 "The Definitive Guide to Django: Web Development Done Right",
277.             )
278.         ]
279.         self.assertQuerySetEqual(
280.             qs.order_by("pk"), rows, lambda r: (r.id, r.isbn, r.page_sum, r.name)
281.         )
282. 
283.     def test_annotate_defer_select_related(self):
284.         qs = (
285.             Book.objects.select_related("contact")
286.             .annotate(page_sum=Sum("pages"))
287.             .defer("name")
288.             .filter(pk=self.b1.pk)
289.         )
290. 
291.         rows = [
292.             (
293.                 self.b1.id,
294.                 "159059725",
295.                 447,
296.                 "Adrian Holovaty",
297.                 "The Definitive Guide to Django: Web Development Done Right",
298.             )
299.         ]
300.         self.assertQuerySetEqual(
301.             qs.order_by("pk"),
302.             rows,
303.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name),
304.         )
305. 
306.     def test_annotate_m2m(self):
307.         books = (
308.             Book.objects.filter(rating__lt=4.5)
309.             .annotate(Avg("authors__age"))
310.             .order_by("name")
311.         )
312.         self.assertQuerySetEqual(
313.             books,
314.             [
315.                 ("Artificial Intelligence: A Modern Approach", 51.5),
316.                 ("Practical Django Projects", 29.0),
317.                 ("Python Web Development with Django", Approximate(30.3, places=1)),
318.                 ("Sams Teach Yourself Django in 24 Hours", 45.0),
319.             ],
320.             lambda b: (b.name, b.authors__age__avg),
321.         )
322. 
323.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
324.         self.assertQuerySetEqual(
325.             books,
326.             [
327.                 ("Artificial Intelligence: A Modern Approach", 2),
328.                 (
329.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
330.                     "Common Lisp",
331.                     1,
332.                 ),
333.                 ("Practical Django Projects", 1),
334.                 ("Python Web Development with Django", 3),
335.                 ("Sams Teach Yourself Django in 24 Hours", 1),
336.                 ("The Definitive Guide to Django: Web Development Done Right", 2),
337.             ],
338.             lambda b: (b.name, b.num_authors),
339.         )
340. 
341.     def test_backwards_m2m_annotate(self):
342.         authors = (
343.             Author.objects.filter(name__contains="a")
344.             .annotate(Avg("book__rating"))
345.             .order_by("name")
346.         )
347.         self.assertQuerySetEqual(
348.             authors,
349.             [
350.                 ("Adrian Holovaty", 4.5),
351.                 ("Brad Dayley", 3.0),
352.                 ("Jacob Kaplan-Moss", 4.5),
353.                 ("James Bennett", 4.0),
354.                 ("Paul Bissex", 4.0),
355.                 ("Stuart Russell", 4.0),
356.             ],
357.             lambda a: (a.name, a.book__rating__avg),
358.         )
359. 
360.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
361.         self.assertQuerySetEqual(
362.             authors,
363.             [
364.                 ("Adrian Holovaty", 1),
365.                 ("Brad Dayley", 1),
366.                 ("Jacob Kaplan-Moss", 1),
367.                 ("James Bennett", 1),
368.                 ("Jeffrey Forcier", 1),
369.                 ("Paul Bissex", 1),
370.                 ("Peter Norvig", 2),
371.                 ("Stuart Russell", 1),
372.                 ("Wesley J. Chun", 1),
373.             ],
374.             lambda a: (a.name, a.num_books),
375.         )
376. 
377.     def test_reverse_fkey_annotate(self):
378.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
379.         self.assertQuerySetEqual(
380.             books,
381.             [
382.                 ("Artificial Intelligence: A Modern Approach", 7),
383.                 (
384.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
385.                     "Common Lisp",
386.                     9,
387.                 ),
388.                 ("Practical Django Projects", 3),
389.                 ("Python Web Development with Django", 7),
390.                 ("Sams Teach Yourself Django in 24 Hours", 1),
391.                 ("The Definitive Guide to Django: Web Development Done Right", 3),
392.             ],
393.             lambda b: (b.name, b.publisher__num_awards__sum),
394.         )
395. 
396.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
397.         self.assertQuerySetEqual(
398.             publishers,
399.             [
400.                 ("Apress", Decimal("59.69")),
401.                 ("Jonno's House of Books", None),
402.                 ("Morgan Kaufmann", Decimal("75.00")),
403.                 ("Prentice Hall", Decimal("112.49")),
404.                 ("Sams", Decimal("23.09")),
405.             ],
406.             lambda p: (p.name, p.book__price__sum),
407.         )
408. 
409.     def test_annotate_values(self):
410.         books = list(
411.             Book.objects.filter(pk=self.b1.pk)
412.             .annotate(mean_age=Avg("authors__age"))
413.             .values()
414.         )
415.         self.assertEqual(
416.             books,
417.             [
418.                 {
419.                     "contact_id": self.a1.id,
420.                     "id": self.b1.id,
421.                     "isbn": "159059725",
422.                     "mean_age": 34.5,
423.                     "name": (
424.                         "The Definitive Guide to Django: Web Development Done Right"
425.                     ),
426.                     "pages": 447,
427.                     "price": Approximate(Decimal("30")),
428.                     "pubdate": datetime.date(2007, 12, 6),
429.                     "publisher_id": self.p1.id,
430.                     "rating": 4.5,
431.                 }
432.             ],
433.         )
434. 
435.         books = (
436.             Book.objects.filter(pk=self.b1.pk)
437.             .annotate(mean_age=Avg("authors__age"))
438.             .values("pk", "isbn", "mean_age")
439.         )
440.         self.assertEqual(
441.             list(books),
442.             [
443.                 {
444.                     "pk": self.b1.pk,
445.                     "isbn": "159059725",
446.                     "mean_age": 34.5,
447.                 }
448.             ],
449.         )
450. 
451.         books = (
452.             Book.objects.filter(pk=self.b1.pk)
453.             .annotate(mean_age=Avg("authors__age"))
454.             .values("name")
455.         )
456.         self.assertEqual(
457.             list(books),
458.             [{"name": "The Definitive Guide to Django: Web Development Done Right"}],
459.         )
460. 
461.         books = (
462.             Book.objects.filter(pk=self.b1.pk)
463.             .values()
464.             .annotate(mean_age=Avg("authors__age"))
465.         )
466.         self.assertEqual(
467.             list(books),
468.             [
469.                 {
470.                     "contact_id": self.a1.id,
471.                     "id": self.b1.id,
472.                     "isbn": "159059725",
473.                     "mean_age": 34.5,
474.                     "name": (
475.                         "The Definitive Guide to Django: Web Development Done Right"
476.                     ),
477.                     "pages": 447,
478.                     "price": Approximate(Decimal("30")),
479.                     "pubdate": datetime.date(2007, 12, 6),
480.                     "publisher_id": self.p1.id,
481.                     "rating": 4.5,
482.                 }
483.             ],
484.         )
485. 
486.         books = (
487.             Book.objects.values("rating")
488.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
489.             .order_by("rating")
490.         )
491.         self.assertEqual(
492.             list(books),
493.             [
494.                 {
495.                     "rating": 3.0,
496.                     "n_authors": 1,
497.                     "mean_age": 45.0,
498.                 },
499.                 {
500.                     "rating": 4.0,
501.                     "n_authors": 6,
502.                     "mean_age": Approximate(37.16, places=1),
503.                 },
504.                 {
505.                     "rating": 4.5,
506.                     "n_authors": 2,
507.                     "mean_age": 34.5,
508.                 },
509.                 {
510.                     "rating": 5.0,
511.                     "n_authors": 1,
512.                     "mean_age": 57.0,
513.                 },
514.             ],
515.         )
516. 
517.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
518.         self.assertQuerySetEqual(
519.             authors,
520.             [
521.                 ("Adrian Holovaty", 32.0),
522.                 ("Brad Dayley", None),
523.                 ("Jacob Kaplan-Moss", 29.5),
524.                 ("James Bennett", 34.0),
525.                 ("Jeffrey Forcier", 27.0),
526.                 ("Paul Bissex", 31.0),
527.                 ("Peter Norvig", 46.0),
528.                 ("Stuart Russell", 57.0),
529.                 ("Wesley J. Chun", Approximate(33.66, places=1)),
530.             ],
531.             lambda a: (a.name, a.friends__age__avg),
532.         )
533. 
534.     def test_count(self):
535.         vals = Book.objects.aggregate(Count("rating"))
536.         self.assertEqual(vals, {"rating__count": 6})
537. 
538.     def test_count_star(self):
539.         with self.assertNumQueries(1) as ctx:
540.             Book.objects.aggregate(n=Count("*"))
541.         sql = ctx.captured_queries[0]["sql"]
542.         self.assertIn("SELECT COUNT(*) ", sql)
543. 
544.     def test_count_distinct_expression(self):
545.         aggs = Book.objects.aggregate(
546.             distinct_ratings=Count(
547.                 Case(When(pages__gt=300, then="rating")), distinct=True
548.             ),
549.         )
550.         self.assertEqual(aggs["distinct_ratings"], 4)
551. 
552.     def test_distinct_on_aggregate(self):
553.         for aggregate, expected_result in (
554.             (Avg, 4.125),
555.             (Count, 4),
556.             (Sum, 16.5),
557.         ):
558.             with self.subTest(aggregate=aggregate.__name__):
559.                 books = Book.objects.aggregate(
560.                     ratings=aggregate("rating", distinct=True)
561.                 )
562.                 self.assertEqual(books["ratings"], expected_result)
563. 
564.     def test_non_grouped_annotation_not_in_group_by(self):
565.         """
566.         An annotation not included in values() before an aggregate should be
567.         excluded from the group by clause.
568.         """
569.         qs = (
570.             Book.objects.annotate(xprice=F("price"))
571.             .filter(rating=4.0)
572.             .values("rating")
573.             .annotate(count=Count("publisher_id", distinct=True))
574.             .values("count", "rating")
575.             .order_by("count")
576.         )
577.         self.assertEqual(list(qs), [{"rating": 4.0, "count": 2}])
578. 
579.     def test_grouped_annotation_in_group_by(self):
580.         """
581.         An annotation included in values() before an aggregate should be
582.         included in the group by clause.
583.         """
584.         qs = (
585.             Book.objects.annotate(xprice=F("price"))
586.             .filter(rating=4.0)
587.             .values("rating", "xprice")
588.             .annotate(count=Count("publisher_id", distinct=True))
589.             .values("count", "rating")
590.             .order_by("count")
591.         )
592.         self.assertEqual(
593.             list(qs),
594.             [
595.                 {"rating": 4.0, "count": 1},
596.                 {"rating": 4.0, "count": 2},
597.             ],
598.         )
599. 
600.     def test_fkey_aggregate(self):
601.         explicit = list(Author.objects.annotate(Count("book__id")))
602.         implicit = list(Author.objects.annotate(Count("book")))
603.         self.assertCountEqual(explicit, implicit)
604. 
605.     def test_annotate_ordering(self):
606.         books = (
607.             Book.objects.values("rating")
608.             .annotate(oldest=Max("authors__age"))
609.             .order_by("oldest", "rating")
610.         )
611.         self.assertEqual(
612.             list(books),
613.             [
614.                 {"rating": 4.5, "oldest": 35},
615.                 {"rating": 3.0, "oldest": 45},
616.                 {"rating": 4.0, "oldest": 57},
617.                 {"rating": 5.0, "oldest": 57},
618.             ],
619.         )
620. 
621.         books = (
622.             Book.objects.values("rating")
623.             .annotate(oldest=Max("authors__age"))
624.             .order_by("-oldest", "-rating")
625.         )
626.         self.assertEqual(
627.             list(books),
628.             [
629.                 {"rating": 5.0, "oldest": 57},
630.                 {"rating": 4.0, "oldest": 57},
631.                 {"rating": 3.0, "oldest": 45},
632.                 {"rating": 4.5, "oldest": 35},
633.             ],
634.         )
635. 
636.     def test_aggregate_annotation(self):
637.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(
638.             Avg("num_authors")
639.         )
640.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
641. 
642.     def test_avg_duration_field(self):
643.         # Explicit `output_field`.
644.         self.assertEqual(
645.             Publisher.objects.aggregate(Avg("duration", output_field=DurationField())),
646.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
647.         )
648.         # Implicit `output_field`.
649.         self.assertEqual(
650.             Publisher.objects.aggregate(Avg("duration")),
651.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
652.         )
653. 
654.     def test_sum_duration_field(self):
655.         self.assertEqual(
656.             Publisher.objects.aggregate(Sum("duration", output_field=DurationField())),
657.             {"duration__sum": datetime.timedelta(days=3)},
658.         )
659. 
660.     def test_sum_distinct_aggregate(self):
661.         """
662.         Sum on a distinct() QuerySet should aggregate only the distinct items.
663.         """
664.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
665.         self.assertEqual(authors.count(), 3)
666. 
667.         distinct_authors = authors.distinct()
668.         self.assertEqual(distinct_authors.count(), 2)
669. 
670.         # Selected author ages are 57 and 46
671.         age_sum = distinct_authors.aggregate(Sum("age"))
672.         self.assertEqual(age_sum["age__sum"], 103)
673. 
674.     def test_filtering(self):
675.         p = Publisher.objects.create(name="Expensive Publisher", num_awards=0)
676.         Book.objects.create(
677.             name="ExpensiveBook1",
678.             pages=1,
679.             isbn="111",
680.             rating=3.5,
681.             price=Decimal("1000"),
682.             publisher=p,
683.             contact_id=self.a1.id,
684.             pubdate=datetime.date(2008, 12, 1),
685.         )
686.         Book.objects.create(
687.             name="ExpensiveBook2",
688.             pages=1,
689.             isbn="222",
690.             rating=4.0,
691.             price=Decimal("1000"),
692.             publisher=p,
693.             contact_id=self.a1.id,
694.             pubdate=datetime.date(2008, 12, 2),
695.         )
696.         Book.objects.create(
697.             name="ExpensiveBook3",
698.             pages=1,
699.             isbn="333",
700.             rating=4.5,
701.             price=Decimal("35"),
702.             publisher=p,
703.             contact_id=self.a1.id,
704.             pubdate=datetime.date(2008, 12, 3),
705.         )
706. 
707.         publishers = (
708.             Publisher.objects.annotate(num_books=Count("book__id"))
709.             .filter(num_books__gt=1)
710.             .order_by("pk")
711.         )
712.         self.assertQuerySetEqual(
713.             publishers,
714.             ["Apress", "Prentice Hall", "Expensive Publisher"],
715.             lambda p: p.name,
716.         )
717. 
718.         publishers = Publisher.objects.filter(book__price__lt=Decimal("40.0")).order_by(
719.             "pk"
720.         )
721.         self.assertQuerySetEqual(
722.             publishers,
723.             [
724.                 "Apress",
725.                 "Apress",
726.                 "Sams",
727.                 "Prentice Hall",
728.                 "Expensive Publisher",
729.             ],
730.             lambda p: p.name,
731.         )
732. 
733.         publishers = (
734.             Publisher.objects.annotate(num_books=Count("book__id"))
735.             .filter(num_books__gt=1, book__price__lt=Decimal("40.0"))
736.             .order_by("pk")
737.         )
738.         self.assertQuerySetEqual(
739.             publishers,
740.             ["Apress", "Prentice Hall", "Expensive Publisher"],
741.             lambda p: p.name,
742.         )
743. 
744.         publishers = (
745.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
746.             .annotate(num_books=Count("book__id"))
747.             .filter(num_books__gt=1)
748.             .order_by("pk")
749.         )
750.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
751. 
752.         publishers = (
753.             Publisher.objects.annotate(num_books=Count("book"))
754.             .filter(num_books__range=[1, 3])
755.             .order_by("pk")
756.         )
757.         self.assertQuerySetEqual(
758.             publishers,
759.             [
760.                 "Apress",
761.                 "Sams",
762.                 "Prentice Hall",
763.                 "Morgan Kaufmann",
764.                 "Expensive Publisher",
765.             ],
766.             lambda p: p.name,
767.         )
768. 
769.         publishers = (
770.             Publisher.objects.annotate(num_books=Count("book"))
771.             .filter(num_books__range=[1, 2])
772.             .order_by("pk")
773.         )
774.         self.assertQuerySetEqual(
775.             publishers,
776.             ["Apress", "Sams", "Prentice Hall", "Morgan Kaufmann"],
777.             lambda p: p.name,
778.         )
779. 
780.         publishers = (
781.             Publisher.objects.annotate(num_books=Count("book"))
782.             .filter(num_books__in=[1, 3])
783.             .order_by("pk")
784.         )
785.         self.assertQuerySetEqual(
786.             publishers,
787.             ["Sams", "Morgan Kaufmann", "Expensive Publisher"],
788.             lambda p: p.name,
789.         )
790. 
791.         publishers = Publisher.objects.annotate(num_books=Count("book")).filter(
792.             num_books__isnull=True
793.         )
794.         self.assertEqual(len(publishers), 0)
795. 
796.     def test_annotation(self):
797.         vals = Author.objects.filter(pk=self.a1.pk).aggregate(Count("friends__id"))
798.         self.assertEqual(vals, {"friends__id__count": 2})
799. 
800.         books = (
801.             Book.objects.annotate(num_authors=Count("authors__name"))
802.             .filter(num_authors__exact=2)
803.             .order_by("pk")
804.         )
805.         self.assertQuerySetEqual(
806.             books,
807.             [
808.                 "The Definitive Guide to Django: Web Development Done Right",
809.                 "Artificial Intelligence: A Modern Approach",
810.             ],
811.             lambda b: b.name,
812.         )
813. 
814.         authors = (
815.             Author.objects.annotate(num_friends=Count("friends__id", distinct=True))
816.             .filter(num_friends=0)
817.             .order_by("pk")
818.         )
819.         self.assertQuerySetEqual(authors, ["Brad Dayley"], lambda a: a.name)
820. 
821.         publishers = (
822.             Publisher.objects.annotate(num_books=Count("book__id"))
823.             .filter(num_books__gt=1)
824.             .order_by("pk")
825.         )
826.         self.assertQuerySetEqual(
827.             publishers, ["Apress", "Prentice Hall"], lambda p: p.name
828.         )
829. 
830.         publishers = (
831.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
832.             .annotate(num_books=Count("book__id"))
833.             .filter(num_books__gt=1)
834.         )
835.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
836. 
837.         books = Book.objects.annotate(num_authors=Count("authors__id")).filter(
838.             authors__name__contains="Norvig", num_authors__gt=1
839.         )
840.         self.assertQuerySetEqual(
841.             books, ["Artificial Intelligence: A Modern Approach"], lambda b: b.name
842.         )
843. 
844.     def test_more_aggregation(self):
845.         a = Author.objects.get(name__contains="Norvig")
846.         b = Book.objects.get(name__contains="Done Right")
847.         b.authors.add(a)
848.         b.save()
849. 
850.         vals = (
851.             Book.objects.annotate(num_authors=Count("authors__id"))
852.             .filter(authors__name__contains="Norvig", num_authors__gt=1)
853.             .aggregate(Avg("rating"))
854.         )
855.         self.assertEqual(vals, {"rating__avg": 4.25})
856. 
857.     def test_even_more_aggregate(self):
858.         publishers = (
859.             Publisher.objects.annotate(
860.                 earliest_book=Min("book__pubdate"),
861.             )
862.             .exclude(earliest_book=None)
863.             .order_by("earliest_book")
864.             .values(
865.                 "earliest_book",
866.                 "num_awards",
867.                 "id",
868.                 "name",
869.             )
870.         )
871.         self.assertEqual(
872.             list(publishers),
873.             [
874.                 {
875.                     "earliest_book": datetime.date(1991, 10, 15),
876.                     "num_awards": 9,
877.                     "id": self.p4.id,
878.                     "name": "Morgan Kaufmann",
879.                 },
880.                 {
881.                     "earliest_book": datetime.date(1995, 1, 15),
882.                     "num_awards": 7,
883.                     "id": self.p3.id,
884.                     "name": "Prentice Hall",
885.                 },
886.                 {
887.                     "earliest_book": datetime.date(2007, 12, 6),
888.                     "num_awards": 3,
889.                     "id": self.p1.id,
890.                     "name": "Apress",
891.                 },
892.                 {
893.                     "earliest_book": datetime.date(2008, 3, 3),
894.                     "num_awards": 1,
895.                     "id": self.p2.id,
896.                     "name": "Sams",
897.                 },
898.             ],
899.         )
900. 
901.         vals = Store.objects.aggregate(
902.             Max("friday_night_closing"), Min("original_opening")
903.         )
904.         self.assertEqual(
905.             vals,
906.             {
907.                 "friday_night_closing__max": datetime.time(23, 59, 59),
908.                 "original_opening__min": datetime.datetime(1945, 4, 25, 16, 24, 14),
909.             },
910.         )
911. 
912.     def test_annotate_values_list(self):
913.         books = (
914.             Book.objects.filter(pk=self.b1.pk)
915.             .annotate(mean_age=Avg("authors__age"))
916.             .values_list("pk", "isbn", "mean_age")
917.         )
918.         self.assertEqual(list(books), [(self.b1.id, "159059725", 34.5)])
919. 
920.         books = (
921.             Book.objects.filter(pk=self.b1.pk)
922.             .annotate(mean_age=Avg("authors__age"))
923.             .values_list("isbn")
924.         )
925.         self.assertEqual(list(books), [("159059725",)])
926. 
927.         books = (
928.             Book.objects.filter(pk=self.b1.pk)
929.             .annotate(mean_age=Avg("authors__age"))
930.             .values_list("mean_age")
931.         )
932.         self.assertEqual(list(books), [(34.5,)])
933. 
934.         books = (
935.             Book.objects.filter(pk=self.b1.pk)
936.             .annotate(mean_age=Avg("authors__age"))
937.             .values_list("mean_age", flat=True)
938.         )
939.         self.assertEqual(list(books), [34.5])
940. 
941.         books = (
942.             Book.objects.values_list("price")
943.             .annotate(count=Count("price"))
944.             .order_by("-count", "price")
945.         )
946.         self.assertEqual(
947.             list(books),
948.             [
949.                 (Decimal("29.69"), 2),
950.                 (Decimal("23.09"), 1),
951.                 (Decimal("30"), 1),
952.                 (Decimal("75"), 1),
953.                 (Decimal("82.8"), 1),
954.             ],
955.         )
956. 
957.     def test_dates_with_aggregation(self):
958.         """
959.         .dates() returns a distinct set of dates when applied to a
960.         QuerySet with aggregation.
961. 
962.         Refs #18056. Previously, .dates() would return distinct (date_kind,
963.         aggregation) sets, in this case (year, num_authors), so 2008 would be
964.         returned twice because there are books from 2008 with a different
965.         number of authors.
966.         """
967.         dates = Book.objects.annotate(num_authors=Count("authors")).dates(
968.             "pubdate", "year"
969.         )
970.         self.assertSequenceEqual(
971.             dates,
972.             [
973.                 datetime.date(1991, 1, 1),
974.                 datetime.date(1995, 1, 1),
975.                 datetime.date(2007, 1, 1),
976.                 datetime.date(2008, 1, 1),
977.             ],
978.         )
979. 
980.     def test_values_aggregation(self):
981.         # Refs #20782
982.         max_rating = Book.objects.values("rating").aggregate(max_rating=Max("rating"))
983.         self.assertEqual(max_rating["max_rating"], 5)
984.         max_books_per_rating = (
985.             Book.objects.values("rating")
986.             .annotate(books_per_rating=Count("id"))
987.             .aggregate(Max("books_per_rating"))
988.         )
989.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3})
990. 
991.     def test_ticket17424(self):
992.         """
993.         Doing exclude() on a foreign model after annotate() doesn't crash.
994.         """
995.         all_books = list(Book.objects.values_list("pk", flat=True).order_by("pk"))
996.         annotated_books = Book.objects.order_by("pk").annotate(one=Count("id"))
997. 
998.         # The value doesn't matter, we just need any negative
999.         # constraint on a related model that's a noop.
1000.         excluded_books = annotated_books.exclude(publisher__name="__UNLIKELY_VALUE__")
1001. 
1002.         # Try to generate query tree
1003.         str(excluded_books.query)
1004. 
1005.         self.assertQuerySetEqual(excluded_books, all_books, lambda x: x.pk)
1006. 
1007.         # Check internal state
1008.         self.assertIsNone(annotated_books.query.alias_map["aggregation_book"].join_type)
1009.         self.assertIsNone(excluded_books.query.alias_map["aggregation_book"].join_type)
1010. 
1011.     def test_ticket12886(self):
1012.         """
1013.         Aggregation over sliced queryset works correctly.
1014.         """
1015.         qs = Book.objects.order_by("-rating")[0:3]
1016.         vals = qs.aggregate(average_top3_rating=Avg("rating"))["average_top3_rating"]
1017.         self.assertAlmostEqual(vals, 4.5, places=2)
1018. 
1019.     def test_ticket11881(self):
1020.         """
1021.         Subqueries do not needlessly contain ORDER BY, SELECT FOR UPDATE or
1022.         select_related() stuff.
1023.         """
1024.         qs = (
1025.             Book.objects.select_for_update()
1026.             .order_by("pk")
1027.             .select_related("publisher")
1028.             .annotate(max_pk=Max("pk"))
1029.         )
1030.         with CaptureQueriesContext(connection) as captured_queries:
1031.             qs.aggregate(avg_pk=Avg("max_pk"))
1032.             self.assertEqual(len(captured_queries), 1)
1033.             qstr = captured_queries[0]["sql"].lower()
1034.             self.assertNotIn("for update", qstr)
1035.             forced_ordering = connection.ops.force_no_ordering()
1036.             if forced_ordering:
1037.                 # If the backend needs to force an ordering we make sure it's
1038.                 # the only "ORDER BY" clause present in the query.
1039.                 self.assertEqual(
1040.                     re.findall(r"order by (\w+)", qstr),
1041.                     [", ".join(f[1][0] for f in forced_ordering).lower()],
1042.                 )
1043.             else:
1044.                 self.assertNotIn("order by", qstr)
1045.             self.assertEqual(qstr.count(" join "), 0)
1046. 
1047.     def test_decimal_max_digits_has_no_effect(self):
1048.         Book.objects.all().delete()
1049.         a1 = Author.objects.first()
1050.         p1 = Publisher.objects.first()
1051.         thedate = timezone.now()
1052.         for i in range(10):
1053.             Book.objects.create(
1054.                 isbn="abcde{}".format(i),
1055.                 name="none",
1056.                 pages=10,
1057.                 rating=4.0,
1058.                 price=9999.98,
1059.                 contact=a1,
1060.                 publisher=p1,
1061.                 pubdate=thedate,
1062.             )
1063. 
1064.         book = Book.objects.aggregate(price_sum=Sum("price"))
1065.         self.assertEqual(book["price_sum"], Decimal("99999.80"))
1066. 
1067.     def test_nonaggregate_aggregation_throws(self):
1068.         with self.assertRaisesMessage(TypeError, "fail is not an aggregate expression"):
1069.             Book.objects.aggregate(fail=F("price"))
1070. 
1071.     def test_nonfield_annotation(self):
1072.         book = Book.objects.annotate(val=Max(Value(2))).first()
1073.         self.assertEqual(book.val, 2)
1074.         book = Book.objects.annotate(
1075.             val=Max(Value(2), output_field=IntegerField())
1076.         ).first()
1077.         self.assertEqual(book.val, 2)
1078.         book = Book.objects.annotate(val=Max(2, output_field=IntegerField())).first()
1079.         self.assertEqual(book.val, 2)
1080. 
1081.     def test_annotation_expressions(self):
1082.         authors = Author.objects.annotate(
1083.             combined_ages=Sum(F("age") + F("friends__age"))
1084.         ).order_by("name")
1085.         authors2 = Author.objects.annotate(
1086.             combined_ages=Sum("age") + Sum("friends__age")
1087.         ).order_by("name")
1088.         for qs in (authors, authors2):
1089.             self.assertQuerySetEqual(
1090.                 qs,
1091.                 [
1092.                     ("Adrian Holovaty", 132),
1093.                     ("Brad Dayley", None),
1094.                     ("Jacob Kaplan-Moss", 129),
1095.                     ("James Bennett", 63),
1096.                     ("Jeffrey Forcier", 128),
1097.                     ("Paul Bissex", 120),
1098.                     ("Peter Norvig", 103),
1099.                     ("Stuart Russell", 103),
1100.                     ("Wesley J. Chun", 176),
1101.                 ],
1102.                 lambda a: (a.name, a.combined_ages),
1103.             )
1104. 
1105.     def test_aggregation_expressions(self):
1106.         a1 = Author.objects.aggregate(av_age=Sum("age") / Count("*"))
1107.         a2 = Author.objects.aggregate(av_age=Sum("age") / Count("age"))
1108.         a3 = Author.objects.aggregate(av_age=Avg("age"))
1109.         self.assertEqual(a1, {"av_age": 37})
1110.         self.assertEqual(a2, {"av_age": 37})
1111.         self.assertEqual(a3, {"av_age": Approximate(37.4, places=1)})
1112. 
1113.     def test_avg_decimal_field(self):
1114.         v = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price")))[
1115.             "avg_price"
1116.         ]
1117.         self.assertIsInstance(v, Decimal)
1118.         self.assertEqual(v, Approximate(Decimal("47.39"), places=2))
1119. 
1120.     def test_order_of_precedence(self):
1121.         p1 = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price") + 2) * 3)
1122.         self.assertEqual(p1, {"avg_price": Approximate(Decimal("148.18"), places=2)})
1123. 
1124.         p2 = Book.objects.filter(rating=4).aggregate(avg_price=Avg("price") + 2 * 3)
1125.         self.assertEqual(p2, {"avg_price": Approximate(Decimal("53.39"), places=2)})
1126. 
1127.     def test_combine_different_types(self):
1128.         msg = (
1129.             "Cannot infer type of '+' expression involving these types: FloatField, "
1130.             "DecimalField. You must set output_field."
1131.         )
1132.         qs = Book.objects.annotate(sums=Sum("rating") + Sum("pages") + Sum("price"))
1133.         with self.assertRaisesMessage(FieldError, msg):
1134.             qs.first()
1135.         with self.assertRaisesMessage(FieldError, msg):
1136.             qs.first()
1137. 
1138.         b1 = Book.objects.annotate(
1139.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=IntegerField())
1140.         ).get(pk=self.b4.pk)
1141.         self.assertEqual(b1.sums, 383)
1142. 
1143.         b2 = Book.objects.annotate(
1144.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=FloatField())
1145.         ).get(pk=self.b4.pk)
1146.         self.assertEqual(b2.sums, 383.69)
1147. 
1148.         b3 = Book.objects.annotate(
1149.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=DecimalField())
1150.         ).get(pk=self.b4.pk)
1151.         self.assertEqual(b3.sums, Approximate(Decimal("383.69"), places=2))
1152. 
1153.     def test_complex_aggregations_require_kwarg(self):
1154.         with self.assertRaisesMessage(
1155.             TypeError, "Complex annotations require an alias"
1156.         ):
1157.             Author.objects.annotate(Sum(F("age") + F("friends__age")))
1158.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1159.             Author.objects.aggregate(Sum("age") / Count("age"))
1160.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1161.             Author.objects.aggregate(Sum(1))
1162. 
1163.     def test_aggregate_over_complex_annotation(self):
1164.         qs = Author.objects.annotate(combined_ages=Sum(F("age") + F("friends__age")))
1165. 
1166.         age = qs.aggregate(max_combined_age=Max("combined_ages"))
1167.         self.assertEqual(age["max_combined_age"], 176)
1168. 
1169.         age = qs.aggregate(max_combined_age_doubled=Max("combined_ages") * 2)
1170.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1171. 
1172.         age = qs.aggregate(
1173.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages")
1174.         )
1175.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1176. 
1177.         age = qs.aggregate(
1178.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1179.             sum_combined_age=Sum("combined_ages"),
1180.         )
1181.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1182.         self.assertEqual(age["sum_combined_age"], 954)
1183. 
1184.         age = qs.aggregate(
1185.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1186.             sum_combined_age_doubled=Sum("combined_ages") + Sum("combined_ages"),
1187.         )
1188.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1189.         self.assertEqual(age["sum_combined_age_doubled"], 954 * 2)
1190. 
1191.     def test_values_annotation_with_expression(self):
1192.         # ensure the F() is promoted to the group by clause
1193.         qs = Author.objects.values("name").annotate(another_age=Sum("age") + F("age"))
1194.         a = qs.get(name="Adrian Holovaty")
1195.         self.assertEqual(a["another_age"], 68)
1196. 
1197.         qs = qs.annotate(friend_count=Count("friends"))
1198.         a = qs.get(name="Adrian Holovaty")
1199.         self.assertEqual(a["friend_count"], 2)
1200. 
1201.         qs = (
1202.             qs.annotate(combined_age=Sum("age") + F("friends__age"))
1203.             .filter(name="Adrian Holovaty")
1204.             .order_by("-combined_age")
1205.         )
1206.         self.assertEqual(
1207.             list(qs),
1208.             [
1209.                 {
1210.                     "name": "Adrian Holovaty",
1211.                     "another_age": 68,
1212.                     "friend_count": 1,
1213.                     "combined_age": 69,
1214.                 },
1215.                 {
1216.                     "name": "Adrian Holovaty",
1217.                     "another_age": 68,
1218.                     "friend_count": 1,
1219.                     "combined_age": 63,
1220.                 },
1221.             ],
1222.         )
1223. 
1224.         vals = qs.values("name", "combined_age")
1225.         self.assertEqual(
1226.             list(vals),
1227.             [
1228.                 {"name": "Adrian Holovaty", "combined_age": 69},
1229.                 {"name": "Adrian Holovaty", "combined_age": 63},
1230.             ],
1231.         )
1232. 
1233.     def test_annotate_values_aggregate(self):
1234.         alias_age = (
1235.             Author.objects.annotate(age_alias=F("age"))
1236.             .values(
1237.                 "age_alias",
1238.             )
1239.             .aggregate(sum_age=Sum("age_alias"))
1240.         )
1241. 
1242.         age = Author.objects.values("age").aggregate(sum_age=Sum("age"))
1243. 
1244.         self.assertEqual(alias_age["sum_age"], age["sum_age"])
1245. 
1246.     def test_annotate_over_annotate(self):
1247.         author = (
1248.             Author.objects.annotate(age_alias=F("age"))
1249.             .annotate(sum_age=Sum("age_alias"))
1250.             .get(name="Adrian Holovaty")
1251.         )
1252. 
1253.         other_author = Author.objects.annotate(sum_age=Sum("age")).get(
1254.             name="Adrian Holovaty"
1255.         )
1256. 
1257.         self.assertEqual(author.sum_age, other_author.sum_age)
1258. 
1259.     def test_aggregate_over_aggregate(self):
1260.         msg = "Cannot compute Avg('age'): 'age' is an aggregate"
1261.         with self.assertRaisesMessage(FieldError, msg):
1262.             Author.objects.annotate(age_alias=F("age"),).aggregate(
1263.                 age=Sum(F("age")),
1264.                 avg_age=Avg(F("age")),
1265.             )
1266. 
1267.     def test_annotated_aggregate_over_annotated_aggregate(self):
1268.         with self.assertRaisesMessage(
1269.             FieldError, "Cannot compute Sum('id__max'): 'id__max' is an aggregate"
1270.         ):
1271.             Book.objects.annotate(Max("id")).annotate(Sum("id__max"))
1272. 
1273.         class MyMax(Max):
1274.             def as_sql(self, compiler, connection):
1275.                 self.set_source_expressions(self.get_source_expressions()[0:1])
1276.                 return super().as_sql(compiler, connection)
1277. 
1278.         with self.assertRaisesMessage(
1279.             FieldError, "Cannot compute Max('id__max'): 'id__max' is an aggregate"
1280.         ):
1281.             Book.objects.annotate(Max("id")).annotate(my_max=MyMax("id__max", "price"))
1282. 
1283.     def test_multi_arg_aggregate(self):
1284.         class MyMax(Max):
1285.             output_field = DecimalField()
1286. 
1287.             def as_sql(self, compiler, connection):
1288.                 copy = self.copy()
1289.                 copy.set_source_expressions(copy.get_source_expressions()[0:1])
1290.                 return super(MyMax, copy).as_sql(compiler, connection)
1291. 
1292.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1293.             Book.objects.aggregate(MyMax("pages", "price"))
1294. 
1295.         with self.assertRaisesMessage(
1296.             TypeError, "Complex annotations require an alias"
1297.         ):
1298.             Book.objects.annotate(MyMax("pages", "price"))
1299. 
1300.         Book.objects.aggregate(max_field=MyMax("pages", "price"))
1301. 
1302.     def test_add_implementation(self):
1303.         class MySum(Sum):
1304.             pass
1305. 
1306.         # test completely changing how the output is rendered
1307.         def lower_case_function_override(self, compiler, connection):
1308.             sql, params = compiler.compile(self.source_expressions[0])
1309.             substitutions = {
1310.                 "function": self.function.lower(),
1311.                 "expressions": sql,
1312.                 "distinct": "",
1313.             }
1314.             substitutions.update(self.extra)
1315.             return self.template % substitutions, params
1316. 
1317.         setattr(MySum, "as_" + connection.vendor, lower_case_function_override)
1318. 
1319.         qs = Book.objects.annotate(
1320.             sums=MySum(
1321.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1322.             )
1323.         )
1324.         self.assertEqual(str(qs.query).count("sum("), 1)
1325.         b1 = qs.get(pk=self.b4.pk)
1326.         self.assertEqual(b1.sums, 383)
1327. 
1328.         # test changing the dict and delegating
1329.         def lower_case_function_super(self, compiler, connection):
1330.             self.extra["function"] = self.function.lower()
1331.             return super(MySum, self).as_sql(compiler, connection)
1332. 
1333.         setattr(MySum, "as_" + connection.vendor, lower_case_function_super)
1334. 
1335.         qs = Book.objects.annotate(
1336.             sums=MySum(
1337.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1338.             )
1339.         )
1340.         self.assertEqual(str(qs.query).count("sum("), 1)
1341.         b1 = qs.get(pk=self.b4.pk)
1342.         self.assertEqual(b1.sums, 383)
1343. 
1344.         # test overriding all parts of the template
1345.         def be_evil(self, compiler, connection):
1346.             substitutions = {"function": "MAX", "expressions": "2", "distinct": ""}
1347.             substitutions.update(self.extra)
1348.             return self.template % substitutions, ()
1349. 
1350.         setattr(MySum, "as_" + connection.vendor, be_evil)
1351. 
1352.         qs = Book.objects.annotate(
1353.             sums=MySum(
1354.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1355.             )
1356.         )
1357.         self.assertEqual(str(qs.query).count("MAX("), 1)
1358.         b1 = qs.get(pk=self.b4.pk)
1359.         self.assertEqual(b1.sums, 2)
1360. 
1361.     def test_complex_values_aggregation(self):
1362.         max_rating = Book.objects.values("rating").aggregate(
1363.             double_max_rating=Max("rating") + Max("rating")
1364.         )
1365.         self.assertEqual(max_rating["double_max_rating"], 5 * 2)
1366. 
1367.         max_books_per_rating = (
1368.             Book.objects.values("rating")
1369.             .annotate(books_per_rating=Count("id") + 5)
1370.             .aggregate(Max("books_per_rating"))
1371.         )
1372.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3 + 5})
1373. 
1374.     def test_expression_on_aggregation(self):
1375.         qs = (
1376.             Publisher.objects.annotate(
1377.                 price_or_median=Greatest(
1378.                     Avg("book__rating", output_field=DecimalField()), Avg("book__price")
1379.                 )
1380.             )
1381.             .filter(price_or_median__gte=F("num_awards"))
1382.             .order_by("num_awards")
1383.         )
1384.         self.assertQuerySetEqual(qs, [1, 3, 7, 9], lambda v: v.num_awards)
1385. 
1386.         qs2 = (
1387.             Publisher.objects.annotate(
1388.                 rating_or_num_awards=Greatest(
1389.                     Avg("book__rating"), F("num_awards"), output_field=FloatField()
1390.                 )
1391.             )
1392.             .filter(rating_or_num_awards__gt=F("num_awards"))
1393.             .order_by("num_awards")
1394.         )
1395.         self.assertQuerySetEqual(qs2, [1, 3], lambda v: v.num_awards)
1396. 
1397.     def test_arguments_must_be_expressions(self):
1398.         msg = "QuerySet.aggregate() received non-expression(s): %s."
1399.         with self.assertRaisesMessage(TypeError, msg % FloatField()):
1400.             Book.objects.aggregate(FloatField())
1401.         with self.assertRaisesMessage(TypeError, msg % True):
1402.             Book.objects.aggregate(is_book=True)
1403.         with self.assertRaisesMessage(
1404.             TypeError, msg % ", ".join([str(FloatField()), "True"])
1405.         ):
1406.             Book.objects.aggregate(FloatField(), Avg("price"), is_book=True)
1407. 
1408.     def test_aggregation_subquery_annotation(self):
1409.         """Subquery annotations are excluded from the GROUP BY if they are
1410.         not explicitly grouped against."""
1411.         latest_book_pubdate_qs = (
1412.             Book.objects.filter(publisher=OuterRef("pk"))
1413.             .order_by("-pubdate")
1414.             .values("pubdate")[:1]
1415.         )
1416.         publisher_qs = Publisher.objects.annotate(
1417.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1418.         ).annotate(count=Count("book"))
1419.         with self.assertNumQueries(1) as ctx:
1420.             list(publisher_qs)
1421.         self.assertEqual(ctx[0]["sql"].count("SELECT"), 2)
1422.         # The GROUP BY should not be by alias either.
1423.         self.assertEqual(ctx[0]["sql"].lower().count("latest_book_pubdate"), 1)
1424. 
1425.     def test_aggregation_subquery_annotation_exists(self):
1426.         latest_book_pubdate_qs = (
1427.             Book.objects.filter(publisher=OuterRef("pk"))
1428.             .order_by("-pubdate")
1429.             .values("pubdate")[:1]
1430.         )
1431.         publisher_qs = Publisher.objects.annotate(
1432.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1433.             count=Count("book"),
1434.         )
1435.         self.assertTrue(publisher_qs.exists())
1436. 
1437.     def test_aggregation_filter_exists(self):
1438.         publishers_having_more_than_one_book_qs = (
1439.             Book.objects.values("publisher")
1440.             .annotate(cnt=Count("isbn"))
1441.             .filter(cnt__gt=1)
1442.         )
1443.         query = publishers_having_more_than_one_book_qs.query.exists()
1444.         _, _, group_by = query.get_compiler(connection=connection).pre_sql_setup()
1445.         self.assertEqual(len(group_by), 1)
1446. 
1447.     def test_aggregation_exists_annotation(self):
1448.         published_books = Book.objects.filter(publisher=OuterRef("pk"))
1449.         publisher_qs = Publisher.objects.annotate(
1450.             published_book=Exists(published_books),
1451.             count=Count("book"),
1452.         ).values_list("name", flat=True)
1453.         self.assertCountEqual(
1454.             list(publisher_qs),
1455.             [
1456.                 "Apress",
1457.                 "Morgan Kaufmann",
1458.                 "Jonno's House of Books",
1459.                 "Prentice Hall",
1460.                 "Sams",
1461.             ],
1462.         )
1463. 
1464.     def test_aggregation_subquery_annotation_values(self):
1465.         """
1466.         Subquery annotations and external aliases are excluded from the GROUP
1467.         BY if they are not selected.
1468.         """
1469.         books_qs = (
1470.             Book.objects.annotate(
1471.                 first_author_the_same_age=Subquery(
1472.                     Author.objects.filter(
1473.                         age=OuterRef("contact__friends__age"),
1474.                     )
1475.                     .order_by("age")
1476.                     .values("id")[:1],
1477.                 )
1478.             )
1479.             .filter(
1480.                 publisher=self.p1,
1481.                 first_author_the_same_age__isnull=False,
1482.             )
1483.             .annotate(
1484.                 min_age=Min("contact__friends__age"),
1485.             )
1486.             .values("name", "min_age")
1487.             .order_by("name")
1488.         )
1489.         self.assertEqual(
1490.             list(books_qs),
1491.             [
1492.                 {"name": "Practical Django Projects", "min_age": 34},
1493.                 {
1494.                     "name": (
1495.                         "The Definitive Guide to Django: Web Development Done Right"
1496.                     ),
1497.                     "min_age": 29,
1498.                 },
1499.             ],
1500.         )
1501. 
1502.     def test_aggregation_subquery_annotation_values_collision(self):
1503.         books_rating_qs = Book.objects.filter(
1504.             publisher=OuterRef("pk"),
1505.             price=Decimal("29.69"),
1506.         ).values("rating")
1507.         publisher_qs = (
1508.             Publisher.objects.filter(
1509.                 book__contact__age__gt=20,
1510.                 name=self.p1.name,
1511.             )
1512.             .annotate(
1513.                 rating=Subquery(books_rating_qs),
1514.                 contacts_count=Count("book__contact"),
1515.             )
1516.             .values("rating")
1517.             .annotate(total_count=Count("rating"))
1518.         )
1519.         self.assertEqual(
1520.             list(publisher_qs),
1521.             [
1522.                 {"rating": 4.0, "total_count": 2},
1523.             ],
1524.         )
1525. 
1526.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1527.     def test_aggregation_subquery_annotation_multivalued(self):
1528.         """
1529.         Subquery annotations must be included in the GROUP BY if they use
1530.         potentially multivalued relations (contain the LOOKUP_SEP).
1531.         """
1532.         subquery_qs = Author.objects.filter(
1533.             pk=OuterRef("pk"),
1534.             book__name=OuterRef("book__name"),
1535.         ).values("pk")
1536.         author_qs = Author.objects.annotate(
1537.             subquery_id=Subquery(subquery_qs),
1538.         ).annotate(count=Count("book"))
1539.         self.assertEqual(author_qs.count(), Author.objects.count())
1540. 
1541.     def test_aggregation_order_by_not_selected_annotation_values(self):
1542.         result_asc = [
1543.             self.b4.pk,
1544.             self.b3.pk,
1545.             self.b1.pk,
1546.             self.b2.pk,
1547.             self.b5.pk,
1548.             self.b6.pk,
1549.         ]
1550.         result_desc = result_asc[::-1]
1551.         tests = [
1552.             ("min_related_age", result_asc),
1553.             ("-min_related_age", result_desc),
1554.             (F("min_related_age"), result_asc),
1555.             (F("min_related_age").asc(), result_asc),
1556.             (F("min_related_age").desc(), result_desc),
1557.         ]
1558.         for ordering, expected_result in tests:
1559.             with self.subTest(ordering=ordering):
1560.                 books_qs = (
1561.                     Book.objects.annotate(
1562.                         min_age=Min("authors__age"),
1563.                     )
1564.                     .annotate(
1565.                         min_related_age=Coalesce("min_age", "contact__age"),
1566.                     )
1567.                     .order_by(ordering)
1568.                     .values_list("pk", flat=True)
1569.                 )
1570.                 self.assertEqual(list(books_qs), expected_result)
1571. 
1572.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1573.     def test_group_by_subquery_annotation(self):
1574.         """
1575.         Subquery annotations are included in the GROUP BY if they are
1576.         grouped against.
1577.         """
1578.         long_books_count_qs = (
1579.             Book.objects.filter(
1580.                 publisher=OuterRef("pk"),
1581.                 pages__gt=400,
1582.             )
1583.             .values("publisher")
1584.             .annotate(count=Count("pk"))
1585.             .values("count")
1586.         )
1587.         groups = [
1588.             Subquery(long_books_count_qs),
1589.             long_books_count_qs,
1590.             long_books_count_qs.query,
1591.         ]
1592.         for group in groups:
1593.             with self.subTest(group=group.__class__.__name__):
1594.                 long_books_count_breakdown = Publisher.objects.values_list(
1595.                     group,
1596.                 ).annotate(total=Count("*"))
1597.                 self.assertEqual(dict(long_books_count_breakdown), {None: 1, 1: 4})
1598. 
1599.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1600.     def test_group_by_exists_annotation(self):
1601.         """
1602.         Exists annotations are included in the GROUP BY if they are
1603.         grouped against.
1604.         """
1605.         long_books_qs = Book.objects.filter(
1606.             publisher=OuterRef("pk"),
1607.             pages__gt=800,
1608.         )
1609.         has_long_books_breakdown = Publisher.objects.values_list(
1610.             Exists(long_books_qs),
1611.         ).annotate(total=Count("*"))
1612.         self.assertEqual(dict(has_long_books_breakdown), {True: 2, False: 3})
1613. 
1614.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1615.     def test_aggregation_subquery_annotation_related_field(self):
1616.         publisher = Publisher.objects.create(name=self.a9.name, num_awards=2)
1617.         book = Book.objects.create(
1618.             isbn="159059999",
1619.             name="Test book.",
1620.             pages=819,
1621.             rating=2.5,
1622.             price=Decimal("14.44"),
1623.             contact=self.a9,
1624.             publisher=publisher,
1625.             pubdate=datetime.date(2019, 12, 6),
1626.         )
1627.         book.authors.add(self.a5, self.a6, self.a7)
1628.         books_qs = (
1629.             Book.objects.annotate(
1630.                 contact_publisher=Subquery(
1631.                     Publisher.objects.filter(
1632.                         pk=OuterRef("publisher"),
1633.                         name=OuterRef("contact__name"),
1634.                     ).values("name")[:1],
1635.                 )
1636.             )
1637.             .filter(
1638.                 contact_publisher__isnull=False,
1639.             )
1640.             .annotate(count=Count("authors"))
1641.         )
1642.         with self.assertNumQueries(1) as ctx:
1643.             self.assertSequenceEqual(books_qs, [book])
1644.         # Outerquery SELECT, annotation SELECT, and WHERE SELECT but GROUP BY
1645.         # selected alias, if allowed.
1646.         if connection.features.allows_group_by_refs:
1647.             self.assertEqual(ctx[0]["sql"].count("SELECT"), 3)
1648. 
1649.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1650.     def test_aggregation_nested_subquery_outerref(self):
1651.         publisher_with_same_name = Publisher.objects.filter(
1652.             id__in=Subquery(
1653.                 Publisher.objects.filter(
1654.                     name=OuterRef(OuterRef("publisher__name")),
1655.                 ).values("id"),
1656.             ),
1657.         ).values(publisher_count=Count("id"))[:1]
1658.         books_breakdown = Book.objects.annotate(
1659.             publisher_count=Subquery(publisher_with_same_name),
1660.             authors_count=Count("authors"),
1661.         ).values_list("publisher_count", flat=True)
1662.         self.assertSequenceEqual(books_breakdown, [1] * 6)
1663. 
1664.     def test_aggregation_exists_multivalued_outeref(self):
1665.         self.assertCountEqual(
1666.             Publisher.objects.annotate(
1667.                 books_exists=Exists(
1668.                     Book.objects.filter(publisher=OuterRef("book__publisher"))
1669.                 ),
1670.                 books_count=Count("book"),
1671.             ),
1672.             Publisher.objects.all(),
1673.         )
1674. 
1675.     def test_filter_in_subquery_or_aggregation(self):
1676.         """
1677.         Filtering against an aggregate requires the usage of the HAVING clause.
1678. 
1679.         If such a filter is unionized to a non-aggregate one the latter will
1680.         also need to be moved to the HAVING clause and have its grouping
1681.         columns used in the GROUP BY.
1682. 
1683.         When this is done with a subquery the specialized logic in charge of
1684.         using outer reference columns to group should be used instead of the
1685.         subquery itself as the latter might return multiple rows.
1686.         """
1687.         authors = Author.objects.annotate(
1688.             Count("book"),
1689.         ).filter(Q(book__count__gt=0) | Q(pk__in=Book.objects.values("authors")))
1690.         self.assertCountEqual(authors, Author.objects.all())
1691. 
1692.     def test_aggregation_random_ordering(self):
1693.         """Random() is not included in the GROUP BY when used for ordering."""
1694.         authors = Author.objects.annotate(contact_count=Count("book")).order_by("?")
1695.         self.assertQuerySetEqual(
1696.             authors,
1697.             [
1698.                 ("Adrian Holovaty", 1),
1699.                 ("Jacob Kaplan-Moss", 1),
1700.                 ("Brad Dayley", 1),
1701.                 ("James Bennett", 1),
1702.                 ("Jeffrey Forcier", 1),
1703.                 ("Paul Bissex", 1),
1704.                 ("Wesley J. Chun", 1),
1705.                 ("Stuart Russell", 1),
1706.                 ("Peter Norvig", 2),
1707.             ],
1708.             lambda a: (a.name, a.contact_count),
1709.             ordered=False,
1710.         )
1711. 
1712.     def test_empty_result_optimization(self):
1713.         with self.assertNumQueries(0):
1714.             self.assertEqual(
1715.                 Publisher.objects.none().aggregate(
1716.                     sum_awards=Sum("num_awards"),
1717.                     books_count=Count("book"),
1718.                 ),
1719.                 {
1720.                     "sum_awards": None,
1721.                     "books_count": 0,
1722.                 },
1723.             )
1724.         # Expression without empty_result_set_value forces queries to be
1725.         # executed even if they would return an empty result set.
1726.         raw_books_count = Func("book", function="COUNT")
1727.         raw_books_count.contains_aggregate = True
1728.         with self.assertNumQueries(1):
1729.             self.assertEqual(
1730.                 Publisher.objects.none().aggregate(
1731.                     sum_awards=Sum("num_awards"),
1732.                     books_count=raw_books_count,
1733.                 ),
1734.                 {
1735.                     "sum_awards": None,
1736.                     "books_count": 0,
1737.                 },
1738.             )
1739. 
1740.     def test_coalesced_empty_result_set(self):
1741.         with self.assertNumQueries(0):
1742.             self.assertEqual(
1743.                 Publisher.objects.none().aggregate(
1744.                     sum_awards=Coalesce(Sum("num_awards"), 0),
1745.                 )["sum_awards"],
1746.                 0,
1747.             )
1748.         # Multiple expressions.
1749.         with self.assertNumQueries(0):
1750.             self.assertEqual(
1751.                 Publisher.objects.none().aggregate(
1752.                     sum_awards=Coalesce(Sum("num_awards"), None, 0),
1753.                 )["sum_awards"],
1754.                 0,
1755.             )
1756.         # Nested coalesce.
1757.         with self.assertNumQueries(0):
1758.             self.assertEqual(
1759.                 Publisher.objects.none().aggregate(
1760.                     sum_awards=Coalesce(Coalesce(Sum("num_awards"), None), 0),
1761.                 )["sum_awards"],
1762.                 0,
1763.             )
1764.         # Expression coalesce.
1765.         with self.assertNumQueries(1):
1766.             self.assertIsInstance(
1767.                 Store.objects.none().aggregate(
1768.                     latest_opening=Coalesce(
1769.                         Max("original_opening"),
1770.                         RawSQL("CURRENT_TIMESTAMP", []),
1771.                     ),
1772.                 )["latest_opening"],
1773.                 datetime.datetime,
1774.             )
1775. 
1776.     def test_aggregation_default_unsupported_by_count(self):
1777.         msg = "Count does not allow default."
1778.         with self.assertRaisesMessage(TypeError, msg):
1779.             Count("age", default=0)
1780. 
1781.     def test_aggregation_default_unset(self):
1782.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1783.             with self.subTest(Aggregate):
1784.                 result = Author.objects.filter(age__gt=100).aggregate(
1785.                     value=Aggregate("age"),
1786.                 )
1787.                 self.assertIsNone(result["value"])
1788. 
1789.     def test_aggregation_default_zero(self):
1790.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1791.             with self.subTest(Aggregate):
1792.                 result = Author.objects.filter(age__gt=100).aggregate(
1793.                     value=Aggregate("age", default=0),
1794.                 )
1795.                 self.assertEqual(result["value"], 0)
1796. 
1797.     def test_aggregation_default_integer(self):
1798.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1799.             with self.subTest(Aggregate):
1800.                 result = Author.objects.filter(age__gt=100).aggregate(
1801.                     value=Aggregate("age", default=21),
1802.                 )
1803.                 self.assertEqual(result["value"], 21)
1804. 
1805.     def test_aggregation_default_expression(self):
1806.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1807.             with self.subTest(Aggregate):
1808.                 result = Author.objects.filter(age__gt=100).aggregate(
1809.                     value=Aggregate("age", default=Value(5) * Value(7)),
1810.                 )
1811.                 self.assertEqual(result["value"], 35)
1812. 
1813.     def test_aggregation_default_group_by(self):
1814.         qs = (
1815.             Publisher.objects.values("name")
1816.             .annotate(
1817.                 books=Count("book"),
1818.                 pages=Sum("book__pages", default=0),
1819.             )
1820.             .filter(books=0)
1821.         )
1822.         self.assertSequenceEqual(
1823.             qs,
1824.             [{"name": "Jonno's House of Books", "books": 0, "pages": 0}],
1825.         )
1826. 
1827.     def test_aggregation_default_compound_expression(self):
1828.         # Scale rating to a percentage; default to 50% if no books published.
1829.         formula = Avg("book__rating", default=2.5) * 20.0
1830.         queryset = Publisher.objects.annotate(rating=formula).order_by("name")
1831.         self.assertSequenceEqual(
1832.             queryset.values("name", "rating"),
1833.             [
1834.                 {"name": "Apress", "rating": 85.0},
1835.                 {"name": "Jonno's House of Books", "rating": 50.0},
1836.                 {"name": "Morgan Kaufmann", "rating": 100.0},
1837.                 {"name": "Prentice Hall", "rating": 80.0},
1838.                 {"name": "Sams", "rating": 60.0},
1839.             ],
1840.         )
1841. 
1842.     def test_aggregation_default_using_time_from_python(self):
1843.         expr = Min(
1844.             "store__friday_night_closing",
1845.             filter=~Q(store__name="Amazon.com"),
1846.             default=datetime.time(17),
1847.         )
1848.         if connection.vendor == "mysql":
1849.             # Workaround for #30224 for MySQL & MariaDB.
1850.             expr.default = Cast(expr.default, TimeField())
1851.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1852.         self.assertSequenceEqual(
1853.             queryset.values("isbn", "oldest_store_opening"),
1854.             [
1855.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1856.                 {
1857.                     "isbn": "013790395",
1858.                     "oldest_store_opening": datetime.time(23, 59, 59),
1859.                 },
1860.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(17)},
1861.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1862.                 {
1863.                     "isbn": "159059725",
1864.                     "oldest_store_opening": datetime.time(23, 59, 59),
1865.                 },
1866.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1867.             ],
1868.         )
1869. 
1870.     def test_aggregation_default_using_time_from_database(self):
1871.         now = timezone.now().astimezone(datetime.timezone.utc)
1872.         expr = Min(
1873.             "store__friday_night_closing",
1874.             filter=~Q(store__name="Amazon.com"),
1875.             default=TruncHour(NowUTC(), output_field=TimeField()),
1876.         )
1877.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1878.         self.assertSequenceEqual(
1879.             queryset.values("isbn", "oldest_store_opening"),
1880.             [
1881.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1882.                 {
1883.                     "isbn": "013790395",
1884.                     "oldest_store_opening": datetime.time(23, 59, 59),
1885.                 },
1886.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(now.hour)},
1887.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1888.                 {
1889.                     "isbn": "159059725",
1890.                     "oldest_store_opening": datetime.time(23, 59, 59),
1891.                 },
1892.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1893.             ],
1894.         )
1895. 
1896.     def test_aggregation_default_using_date_from_python(self):
1897.         expr = Min("book__pubdate", default=datetime.date(1970, 1, 1))
1898.         if connection.vendor == "mysql":
1899.             # Workaround for #30224 for MySQL & MariaDB.
1900.             expr.default = Cast(expr.default, DateField())
1901.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1902.         self.assertSequenceEqual(
1903.             queryset.values("name", "earliest_pubdate"),
1904.             [
1905.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1906.                 {
1907.                     "name": "Jonno's House of Books",
1908.                     "earliest_pubdate": datetime.date(1970, 1, 1),
1909.                 },
1910.                 {
1911.                     "name": "Morgan Kaufmann",
1912.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1913.                 },
1914.                 {
1915.                     "name": "Prentice Hall",
1916.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1917.                 },
1918.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1919.             ],
1920.         )
1921. 
1922.     def test_aggregation_default_using_date_from_database(self):
1923.         now = timezone.now().astimezone(datetime.timezone.utc)
1924.         expr = Min("book__pubdate", default=TruncDate(NowUTC()))
1925.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1926.         self.assertSequenceEqual(
1927.             queryset.values("name", "earliest_pubdate"),
1928.             [
1929.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1930.                 {"name": "Jonno's House of Books", "earliest_pubdate": now.date()},
1931.                 {
1932.                     "name": "Morgan Kaufmann",
1933.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1934.                 },
1935.                 {
1936.                     "name": "Prentice Hall",
1937.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1938.                 },
1939.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1940.             ],
1941.         )
1942. 
1943.     def test_aggregation_default_using_datetime_from_python(self):
1944.         expr = Min(
1945.             "store__original_opening",
1946.             filter=~Q(store__name="Amazon.com"),
1947.             default=datetime.datetime(1970, 1, 1),
1948.         )
1949.         if connection.vendor == "mysql":
1950.             # Workaround for #30224 for MySQL & MariaDB.
1951.             expr.default = Cast(expr.default, DateTimeField())
1952.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1953.         self.assertSequenceEqual(
1954.             queryset.values("isbn", "oldest_store_opening"),
1955.             [
1956.                 {
1957.                     "isbn": "013235613",
1958.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1959.                 },
1960.                 {
1961.                     "isbn": "013790395",
1962.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1963.                 },
1964.                 {
1965.                     "isbn": "067232959",
1966.                     "oldest_store_opening": datetime.datetime(1970, 1, 1),
1967.                 },
1968.                 {
1969.                     "isbn": "155860191",
1970.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1971.                 },
1972.                 {
1973.                     "isbn": "159059725",
1974.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1975.                 },
1976.                 {
1977.                     "isbn": "159059996",
1978.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1979.                 },
1980.             ],
1981.         )
1982. 
1983.     def test_aggregation_default_using_datetime_from_database(self):
1984.         now = timezone.now().astimezone(datetime.timezone.utc)
1985.         expr = Min(
1986.             "store__original_opening",
1987.             filter=~Q(store__name="Amazon.com"),
1988.             default=TruncHour(NowUTC(), output_field=DateTimeField()),
1989.         )
1990.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1991.         self.assertSequenceEqual(
1992.             queryset.values("isbn", "oldest_store_opening"),
1993.             [
1994.                 {
1995.                     "isbn": "013235613",
1996.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1997.                 },
1998.                 {
1999.                     "isbn": "013790395",
2000.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2001.                 },
2002.                 {
2003.                     "isbn": "067232959",
2004.                     "oldest_store_opening": now.replace(
2005.                         minute=0, second=0, microsecond=0, tzinfo=None
2006.                     ),
2007.                 },
2008.                 {
2009.                     "isbn": "155860191",
2010.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2011.                 },
2012.                 {
2013.                     "isbn": "159059725",
2014.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2015.                 },
2016.                 {
2017.                     "isbn": "159059996",
2018.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2019.                 },
2020.             ],
2021.         )
2022. 
2023.     def test_aggregation_default_using_duration_from_python(self):
2024.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2025.             value=Sum("duration", default=datetime.timedelta(0)),
2026.         )
2027.         self.assertEqual(result["value"], datetime.timedelta(0))
2028. 
2029.     def test_aggregation_default_using_duration_from_database(self):
2030.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2031.             value=Sum("duration", default=Now() - Now()),
2032.         )
2033.         self.assertEqual(result["value"], datetime.timedelta(0))
2034. 
2035.     def test_aggregation_default_using_decimal_from_python(self):
2036.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2037.             value=Sum("price", default=Decimal("0.00")),
2038.         )
2039.         self.assertEqual(result["value"], Decimal("0.00"))
2040. 
2041.     def test_aggregation_default_using_decimal_from_database(self):
2042.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2043.             value=Sum("price", default=Pi()),
2044.         )
2045.         self.assertAlmostEqual(result["value"], Decimal.from_float(math.pi), places=6)
2046. 
2047.     def test_aggregation_default_passed_another_aggregate(self):
2048.         result = Book.objects.aggregate(
2049.             value=Sum("price", filter=Q(rating__lt=3.0), default=Avg("pages") / 10.0),
2050.         )
2051.         self.assertAlmostEqual(result["value"], Decimal("61.72"), places=2)
2052. 
2053.     def test_aggregation_default_after_annotation(self):
2054.         result = Publisher.objects.annotate(
2055.             double_num_awards=F("num_awards") * 2,
2056.         ).aggregate(value=Sum("double_num_awards", default=0))
2057.         self.assertEqual(result["value"], 40)
2058. 
2059.     def test_aggregation_default_not_in_aggregate(self):
2060.         result = Publisher.objects.annotate(
2061.             avg_rating=Avg("book__rating", default=2.5),
2062.         ).aggregate(Sum("num_awards"))
2063.         self.assertEqual(result["num_awards__sum"], 20)
2064. 
2065.     def test_exists_none_with_aggregate(self):
2066.         qs = Book.objects.annotate(
2067.             count=Count("id"),
2068.             exists=Exists(Author.objects.none()),
2069.         )
2070.         self.assertEqual(len(qs), 6)
2071. 
2072.     def test_alias_sql_injection(self):
2073.         crafted_alias = """injected_name" from "aggregation_author"; --"""
2074.         msg = (
2075.             "Column aliases cannot contain whitespace characters, quotation marks, "
2076.             "semicolons, or SQL comments."
2077.         )
2078.         with self.assertRaisesMessage(ValueError, msg):
2079.             Author.objects.aggregate(**{crafted_alias: Avg("age")})
2080. 
2081.     def test_exists_extra_where_with_aggregate(self):
2082.         qs = Book.objects.annotate(
2083.             count=Count("id"),
2084.             exists=Exists(Author.objects.extra(where=["1=0"])),
2085.         )
2086.         self.assertEqual(len(qs), 6)

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 17:41:02,036 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases for a bug where `.count()` on an annotated queryset is not optimized. The provided context, `tests/aggregation/tests.py`, focuses on aggregation functions but lacks specific tests for the `.count()` method in this scenario. The bug report itself mentions a similar optimization for `select_related().count()`, and tests for such query-level optimizations are more likely to be found in `tests/queries/tests.py`. Therefore, I need to inspect `tests/queries/tests.py` to find relevant test cases.' query='Please provide the full content of `tests/queries/tests.py`.' extra_requirements='' purpose='I need to find test cases that verify query optimizations for `.count()` when used with `annotate()` and `select_related()`.'
2025-12-21 17:41:02,037 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/queries/tests.py`.
2025-12-21 17:41:02,037 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 17:41:02,038 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 17:41:02,038 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 17:41:02,038 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/queries/tests.py`.
Purpose: I need to find test cases that verify query optimizations for `.count()` when used with `annotate()` and `select_related()`.
2025-12-21 17:41:05,001 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will read the full content of `tests/queries/tests.py` to help you find the test cases you are looking for.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/queries/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2098, 'candidates_token_count': 49, 'total_token_count': 2362, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2098}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 49}], 'thoughts_token_count': 215, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17764735708431323, 'model_name': 'gemini-2.5-pro'} id='run--94e46325-24fd-4070-b532-df33c963e835-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/queries/tests.py'}, 'id': '7f75ba54-84dd-48ce-8785-1620e32f68fb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2098, 'output_tokens': 49, 'total_tokens': 2362, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 215}}
2025-12-21 17:41:09,330 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the contents of `tests/queries/tests.py` and will now analyze the code to locate the specific test cases you're interested in. I will be searching for tests that demonstrate the use of `.count()` in combination with `annotate()` and `select_related()` to verify query optimizations. I will let you know what I find." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/queries/tests.py", "text": "annotate"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9869, 'candidates_token_count': 104, 'total_token_count': 10177, 'cached_content_token_count': 1853, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9869}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1853}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 104}], 'thoughts_token_count': 204}, 'finish_reason': 'STOP', 'avg_logprobs': -0.31714886885422927, 'model_name': 'gemini-2.5-pro'} id='run--302d04d6-0d96-40b9-b12d-66524c9a7e19-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/queries/tests.py', 'text': 'annotate'}, 'id': '92a993a4-fe39-44ed-a3fd-ea74b1e6e903', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9869, 'output_tokens': 104, 'total_tokens': 10177, 'input_token_details': {'cache_read': 1853}, 'output_token_details': {'reasoning': 204}}
2025-12-21 17:41:13,044 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have analyzed the file and found several test classes that use `annotate`. I've identified tests for `ordered` querysets, join reuse with `select_related` and `annotate`, subquery functionality, and more. My next step is to pinpoint where `.count()` is used in conjunction with these annotated querysets to find the specific optimization tests you're looking for." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/queries/tests.py", "text": "count"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16491, 'candidates_token_count': 108, 'total_token_count': 16781, 'cached_content_token_count': 9387, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16491}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9387}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 108}], 'thoughts_token_count': 182}, 'finish_reason': 'STOP', 'avg_logprobs': -0.24934238857693142, 'model_name': 'gemini-2.5-pro'} id='run--a9e656cb-9028-4c3b-82f4-7287996ba462-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/queries/tests.py', 'text': 'count'}, 'id': '5c3d5e71-660d-4c54-8758-99aa04e7d1d1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16491, 'output_tokens': 108, 'total_tokens': 16781, 'input_token_details': {'cache_read': 9387}, 'output_token_details': {'reasoning': 182}}
2025-12-21 17:41:15,375 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I've now searched for both `annotate` and `count` within `tests/queries/tests.py`. I found several test classes that use these methods, but I still need to cross-reference these results to find the exact tests where they are used together with `select_related`. The `Ticket21376` test in `ValuesJoinPromotionTests` looks promising as it uses `.count()` on a filtered and joined queryset. I will now investigate this lead further." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/queries/tests.py", "end_line": 4393.0, "start_line": 4368.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18218, 'candidates_token_count': 127, 'total_token_count': 18345, 'cached_content_token_count': 15008, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18218}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15008}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 127}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.16975294698880414, 'model_name': 'gemini-2.5-pro'} id='run--8f0008f6-1461-4d4b-97a4-1c759f6ed279-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/queries/tests.py', 'end_line': 4393.0, 'start_line': 4368.0}, 'id': 'e0046d91-e150-43fd-92a4-1511e26be7e7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18218, 'output_tokens': 127, 'total_tokens': 18345, 'input_token_details': {'cache_read': 15008}}
2025-12-21 17:41:21,619 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have examined the `ValuesJoinPromotionTests` class and the `test_ticket_21376` test case, which uses `.count()` in a complex query involving joins. While this is a good starting point, I still need to find test cases that explicitly use `select_related()` in conjunction with `annotate()` and `.count()`. I will now search for occurrences of `select_related` to find the most relevant examples for you.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/queries/tests.py", "text": "select_related"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18914, 'candidates_token_count': 127, 'total_token_count': 19502, 'cached_content_token_count': 16875, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18914}], 'cache_tokens_details': [{'modality': 1, 'token_count': 16875}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 127}], 'thoughts_token_count': 461}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6106730183278481, 'model_name': 'gemini-2.5-pro'} id='run--150612e4-e67f-4dc8-90b2-088184072e45-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/queries/tests.py', 'text': 'select_related'}, 'id': '538cf459-d3b7-4200-8c37-edfea6e3d106', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18914, 'output_tokens': 127, 'total_tokens': 19502, 'input_token_details': {'cache_read': 16875}, 'output_token_details': {'reasoning': 461}}
2025-12-21 17:41:28,073 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After a thorough investigation of `tests/queries/tests.py`, I have located the test cases relevant to your query. I found the `JoinReuseTest` class, which contains tests for join reuse with `select_related` and `annotate`. I also identified the `test_col_alias_quoted` test in `Queries6Tests`, which demonstrates the use of `.count()` with annotated and aggregated querysets. I will now provide the full content of these test classes.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/queries/tests.py", "end_line": 2194.0, "start_line": 2066.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 22457, 'candidates_token_count': 152, 'total_token_count': 23020, 'cached_content_token_count': 18802, 'prompt_tokens_details': [{'modality': 1, 'token_count': 22457}], 'cache_tokens_details': [{'modality': 1, 'token_count': 18802}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 152}], 'thoughts_token_count': 411}, 'finish_reason': 'STOP', 'avg_logprobs': -0.41964448125738846, 'model_name': 'gemini-2.5-pro'} id='run--c3caabbf-a7a6-48ee-b744-63a73694302b-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 3893.0, 'relative_path': 'tests/queries/tests.py', 'start_line': 3839.0}, 'id': 'b4667dc8-bcb6-42af-8b76-76dfc660d3cc', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/queries/tests.py', 'end_line': 2194.0, 'start_line': 2066.0}, 'id': 'a971626f-db6a-49a2-849f-225734c7f6c0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22457, 'output_tokens': 152, 'total_tokens': 23020, 'input_token_details': {'cache_read': 18802}, 'output_token_details': {'reasoning': 411}}
2025-12-21 17:41:36,330 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have thoroughly searched the `tests/queries/tests.py` file to find test cases related to query optimizations for `.count()` with `annotate()` and `select_related()`. I have located and provided the code for the `JoinReuseTest` and `Queries6Tests` classes. The `JoinReuseTest` class includes tests that verify join reuse when using `select_related` and `annotate`, while `Queries6Tests` contains a test case, `test_col_alias_quoted`, that demonstrates the use of `Count` within an annotated and aggregated query. These examples should provide you with the necessary context to understand how query optimizations are tested in this codebase.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 26030, 'candidates_token_count': 139, 'total_token_count': 26865, 'cached_content_token_count': 20753, 'prompt_tokens_details': [{'modality': 1, 'token_count': 26030}], 'cache_tokens_details': [{'modality': 1, 'token_count': 20753}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 139}], 'thoughts_token_count': 696}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7196679424038894, 'model_name': 'gemini-2.5-pro'} id='run--a379a7fa-5a8b-467c-b36c-64885798c54f-0' usage_metadata={'input_tokens': 26030, 'output_tokens': 139, 'total_tokens': 26865, 'input_token_details': {'cache_read': 20753}, 'output_token_details': {'reasoning': 696}}
2025-12-21 17:41:36,334 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/queries/tests.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find test cases that verify query optimizations for `.count()` when used with `annotate()` and `select_related()`.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/queries/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. import sys
4. import unittest
5. from operator import attrgetter
6. from threading import Lock
7. 
8. from django.core.exceptions import EmptyResultSet, FieldError, FullResultSet
9. from django.db import DEFAULT_DB_ALIAS, connection
10. from django.db.models import CharField, Count, Exists, F, Max, OuterRef, Q
11. from django.db.models.expressions import RawSQL
12. from django.db.models.functions import ExtractYear, Length, LTrim
13. from django.db.models.sql.constants import LOUTER
14. from django.db.models.sql.where import AND, OR, NothingNode, WhereNode
15. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
16. from django.test.utils import CaptureQueriesContext, ignore_warnings, register_lookup
17. from django.utils.deprecation import RemovedInDjango50Warning
18. 
19. from .models import (
20.     FK1,
21.     Annotation,
22.     Article,
23.     Author,
24.     BaseA,
25.     BaseUser,
26.     Book,
27.     CategoryItem,
28.     CategoryRelationship,
29.     Celebrity,
30.     Channel,
31.     Chapter,
32.     Child,
33.     ChildObjectA,
34.     Classroom,
35.     CommonMixedCaseForeignKeys,
36.     Company,
37.     Cover,
38.     CustomPk,
39.     CustomPkTag,
40.     DateTimePK,
41.     Detail,
42.     DumbCategory,
43.     Eaten,
44.     Employment,
45.     ExtraInfo,
46.     Fan,
47.     Food,
48.     Identifier,
49.     Individual,
50.     Item,
51.     Job,
52.     JobResponsibilities,
53.     Join,
54.     LeafA,
55.     LeafB,
56.     LoopX,
57.     LoopZ,
58.     ManagedModel,
59.     Member,
60.     MixedCaseDbColumnCategoryItem,
61.     MixedCaseFieldCategoryItem,
62.     ModelA,
63.     ModelB,
64.     ModelC,
65.     ModelD,
66.     MyObject,
67.     NamedCategory,
68.     Node,
69.     Note,
70.     NullableName,
71.     Number,
72.     ObjectA,
73.     ObjectB,
74.     ObjectC,
75.     OneToOneCategory,
76.     Order,
77.     OrderItem,
78.     Page,
79.     Paragraph,
80.     Person,
81.     Plaything,
82.     PointerA,
83.     Program,
84.     ProxyCategory,
85.     ProxyObjectA,
86.     ProxyObjectB,
87.     Ranking,
88.     Related,
89.     RelatedIndividual,
90.     RelatedObject,
91.     Report,
92.     ReportComment,
93.     ReservedName,
94.     Responsibility,
95.     School,
96.     SharedConnection,
97.     SimpleCategory,
98.     SingleObject,
99.     SpecialCategory,
100.     Staff,
101.     StaffUser,
102.     Student,
103.     Tag,
104.     Task,
105.     Teacher,
106.     Ticket21203Child,
107.     Ticket21203Parent,
108.     Ticket23605A,
109.     Ticket23605B,
110.     Ticket23605C,
111.     TvChef,
112.     Valid,
113.     X,
114. )
115. 
116. 
117. class Queries1Tests(TestCase):
118.     @classmethod
119.     def setUpTestData(cls):
120.         cls.nc1 = generic = NamedCategory.objects.create(name="Generic")
121.         cls.t1 = Tag.objects.create(name="t1", category=generic)
122.         cls.t2 = Tag.objects.create(name="t2", parent=cls.t1, category=generic)
123.         cls.t3 = Tag.objects.create(name="t3", parent=cls.t1)
124.         cls.t4 = Tag.objects.create(name="t4", parent=cls.t3)
125.         cls.t5 = Tag.objects.create(name="t5", parent=cls.t3)
126. 
127.         cls.n1 = Note.objects.create(note="n1", misc="foo", id=1)
128.         cls.n2 = Note.objects.create(note="n2", misc="bar", id=2)
129.         cls.n3 = Note.objects.create(note="n3", misc="foo", id=3, negate=False)
130. 
131.         cls.ann1 = Annotation.objects.create(name="a1", tag=cls.t1)
132.         cls.ann1.notes.add(cls.n1)
133.         ann2 = Annotation.objects.create(name="a2", tag=cls.t4)
134.         ann2.notes.add(cls.n2, cls.n3)
135. 
136.         # Create these out of order so that sorting by 'id' will be different to sorting
137.         # by 'info'. Helps detect some problems later.
138.         cls.e2 = ExtraInfo.objects.create(
139.             info="e2", note=cls.n2, value=41, filterable=False
140.         )
141.         e1 = ExtraInfo.objects.create(info="e1", note=cls.n1, value=42)
142. 
143.         cls.a1 = Author.objects.create(name="a1", num=1001, extra=e1)
144.         cls.a2 = Author.objects.create(name="a2", num=2002, extra=e1)
145.         cls.a3 = Author.objects.create(name="a3", num=3003, extra=cls.e2)
146.         cls.a4 = Author.objects.create(name="a4", num=4004, extra=cls.e2)
147. 
148.         cls.time1 = datetime.datetime(2007, 12, 19, 22, 25, 0)
149.         cls.time2 = datetime.datetime(2007, 12, 19, 21, 0, 0)
150.         time3 = datetime.datetime(2007, 12, 20, 22, 25, 0)
151.         time4 = datetime.datetime(2007, 12, 20, 21, 0, 0)
152.         cls.i1 = Item.objects.create(
153.             name="one",
154.             created=cls.time1,
155.             modified=cls.time1,
156.             creator=cls.a1,
157.             note=cls.n3,
158.         )
159.         cls.i1.tags.set([cls.t1, cls.t2])
160.         cls.i2 = Item.objects.create(
161.             name="two", created=cls.time2, creator=cls.a2, note=cls.n2
162.         )
163.         cls.i2.tags.set([cls.t1, cls.t3])
164.         cls.i3 = Item.objects.create(
165.             name="three", created=time3, creator=cls.a2, note=cls.n3
166.         )
167.         cls.i4 = Item.objects.create(
168.             name="four", created=time4, creator=cls.a4, note=cls.n3
169.         )
170.         cls.i4.tags.set([cls.t4])
171. 
172.         cls.r1 = Report.objects.create(name="r1", creator=cls.a1)
173.         cls.r2 = Report.objects.create(name="r2", creator=cls.a3)
174.         cls.r3 = Report.objects.create(name="r3")
175. 
176.         # Ordering by 'rank' gives us rank2, rank1, rank3. Ordering by the Meta.ordering
177.         # will be rank3, rank2, rank1.
178.         cls.rank1 = Ranking.objects.create(rank=2, author=cls.a2)
179. 
180.         cls.c1 = Cover.objects.create(title="first", item=cls.i4)
181.         cls.c2 = Cover.objects.create(title="second", item=cls.i2)
182. 
183.     def test_subquery_condition(self):
184.         qs1 = Tag.objects.filter(pk__lte=0)
185.         qs2 = Tag.objects.filter(parent__in=qs1)
186.         qs3 = Tag.objects.filter(parent__in=qs2)
187.         self.assertEqual(qs3.query.subq_aliases, {"T", "U", "V"})
188.         self.assertIn("v0", str(qs3.query).lower())
189.         qs4 = qs3.filter(parent__in=qs1)
190.         self.assertEqual(qs4.query.subq_aliases, {"T", "U", "V"})
191.         # It is possible to reuse U for the second subquery, no need to use W.
192.         self.assertNotIn("w0", str(qs4.query).lower())
193.         # So, 'U0."id"' is referenced in SELECT and WHERE twice.
194.         self.assertEqual(str(qs4.query).lower().count("u0."), 4)
195. 
196.     def test_ticket1050(self):
197.         self.assertSequenceEqual(
198.             Item.objects.filter(tags__isnull=True),
199.             [self.i3],
200.         )
201.         self.assertSequenceEqual(
202.             Item.objects.filter(tags__id__isnull=True),
203.             [self.i3],
204.         )
205. 
206.     def test_ticket1801(self):
207.         self.assertSequenceEqual(
208.             Author.objects.filter(item=self.i2),
209.             [self.a2],
210.         )
211.         self.assertSequenceEqual(
212.             Author.objects.filter(item=self.i3),
213.             [self.a2],
214.         )
215.         self.assertSequenceEqual(
216.             Author.objects.filter(item=self.i2) & Author.objects.filter(item=self.i3),
217.             [self.a2],
218.         )
219. 
220.     def test_ticket2306(self):
221.         # Checking that no join types are "left outer" joins.
222.         query = Item.objects.filter(tags=self.t2).query
223.         self.assertNotIn(LOUTER, [x.join_type for x in query.alias_map.values()])
224. 
225.         self.assertSequenceEqual(
226.             Item.objects.filter(Q(tags=self.t1)).order_by("name"),
227.             [self.i1, self.i2],
228.         )
229.         self.assertSequenceEqual(
230.             Item.objects.filter(Q(tags=self.t1)).filter(Q(tags=self.t2)),
231.             [self.i1],
232.         )
233.         self.assertSequenceEqual(
234.             Item.objects.filter(Q(tags=self.t1)).filter(
235.                 Q(creator__name="fred") | Q(tags=self.t2)
236.             ),
237.             [self.i1],
238.         )
239. 
240.         # Each filter call is processed "at once" against a single table, so this is
241.         # different from the previous example as it tries to find tags that are two
242.         # things at once (rather than two tags).
243.         self.assertSequenceEqual(
244.             Item.objects.filter(Q(tags=self.t1) & Q(tags=self.t2)), []
245.         )
246.         self.assertSequenceEqual(
247.             Item.objects.filter(
248.                 Q(tags=self.t1), Q(creator__name="fred") | Q(tags=self.t2)
249.             ),
250.             [],
251.         )
252. 
253.         qs = Author.objects.filter(ranking__rank=2, ranking__id=self.rank1.id)
254.         self.assertSequenceEqual(list(qs), [self.a2])
255.         self.assertEqual(2, qs.query.count_active_tables(), 2)
256.         qs = Author.objects.filter(ranking__rank=2).filter(ranking__id=self.rank1.id)
257.         self.assertEqual(qs.query.count_active_tables(), 3)
258. 
259.     def test_ticket4464(self):
260.         self.assertSequenceEqual(
261.             Item.objects.filter(tags=self.t1).filter(tags=self.t2),
262.             [self.i1],
263.         )
264.         self.assertSequenceEqual(
265.             Item.objects.filter(tags__in=[self.t1, self.t2])
266.             .distinct()
267.             .order_by("name"),
268.             [self.i1, self.i2],
269.         )
270.         self.assertSequenceEqual(
271.             Item.objects.filter(tags__in=[self.t1, self.t2]).filter(tags=self.t3),
272.             [self.i2],
273.         )
274. 
275.         # Make sure .distinct() works with slicing (this was broken in Oracle).
276.         self.assertSequenceEqual(
277.             Item.objects.filter(tags__in=[self.t1, self.t2]).order_by("name")[:3],
278.             [self.i1, self.i1, self.i2],
279.         )
280.         self.assertSequenceEqual(
281.             Item.objects.filter(tags__in=[self.t1, self.t2])
282.             .distinct()
283.             .order_by("name")[:3],
284.             [self.i1, self.i2],
285.         )
286. 
287.     def test_tickets_2080_3592(self):
288.         self.assertSequenceEqual(
289.             Author.objects.filter(item__name="one") | Author.objects.filter(name="a3"),
290.             [self.a1, self.a3],
291.         )
292.         self.assertSequenceEqual(
293.             Author.objects.filter(Q(item__name="one") | Q(name="a3")),
294.             [self.a1, self.a3],
295.         )
296.         self.assertSequenceEqual(
297.             Author.objects.filter(Q(name="a3") | Q(item__name="one")),
298.             [self.a1, self.a3],
299.         )
300.         self.assertSequenceEqual(
301.             Author.objects.filter(Q(item__name="three") | Q(report__name="r3")),
302.             [self.a2],
303.         )
304. 
305.     def test_ticket6074(self):
306.         # Merging two empty result sets shouldn't leave a queryset with no constraints
307.         # (which would match everything).
308.         self.assertSequenceEqual(Author.objects.filter(Q(id__in=[])), [])
309.         self.assertSequenceEqual(Author.objects.filter(Q(id__in=[]) | Q(id__in=[])), [])
310. 
311.     def test_tickets_1878_2939(self):
312.         self.assertEqual(Item.objects.values("creator").distinct().count(), 3)
313. 
314.         # Create something with a duplicate 'name' so that we can test multi-column
315.         # cases (which require some tricky SQL transformations under the covers).
316.         xx = Item(name="four", created=self.time1, creator=self.a2, note=self.n1)
317.         xx.save()
318.         self.assertEqual(
319.             Item.objects.exclude(name="two")
320.             .values("creator", "name")
321.             .distinct()
322.             .count(),
323.             4,
324.         )
325.         self.assertEqual(
326.             (
327.                 Item.objects.exclude(name="two")
328.                 .extra(select={"foo": "%s"}, select_params=(1,))
329.                 .values("creator", "name", "foo")
330.                 .distinct()
331.                 .count()
332.             ),
333.             4,
334.         )
335.         self.assertEqual(
336.             (
337.                 Item.objects.exclude(name="two")
338.                 .extra(select={"foo": "%s"}, select_params=(1,))
339.                 .values("creator", "name")
340.                 .distinct()
341.                 .count()
342.             ),
343.             4,
344.         )
345.         xx.delete()
346. 
347.     def test_ticket7323(self):
348.         self.assertEqual(Item.objects.values("creator", "name").count(), 4)
349. 
350.     def test_ticket2253(self):
351.         q1 = Item.objects.order_by("name")
352.         q2 = Item.objects.filter(id=self.i1.id)
353.         self.assertSequenceEqual(q1, [self.i4, self.i1, self.i3, self.i2])
354.         self.assertSequenceEqual(q2, [self.i1])
355.         self.assertSequenceEqual(
356.             (q1 | q2).order_by("name"),
357.             [self.i4, self.i1, self.i3, self.i2],
358.         )
359.         self.assertSequenceEqual((q1 & q2).order_by("name"), [self.i1])
360. 
361.         q1 = Item.objects.filter(tags=self.t1)
362.         q2 = Item.objects.filter(note=self.n3, tags=self.t2)
363.         q3 = Item.objects.filter(creator=self.a4)
364.         self.assertSequenceEqual(
365.             ((q1 & q2) | q3).order_by("name"),
366.             [self.i4, self.i1],
367.         )
368. 
369.     def test_order_by_tables(self):
370.         q1 = Item.objects.order_by("name")
371.         q2 = Item.objects.filter(id=self.i1.id)
372.         list(q2)
373.         combined_query = (q1 & q2).order_by("name").query
374.         self.assertEqual(
375.             len(
376.                 [
377.                     t
378.                     for t in combined_query.alias_map
379.                     if combined_query.alias_refcount[t]
380.                 ]
381.             ),
382.             1,
383.         )
384. 
385.     def test_order_by_join_unref(self):
386.         """
387.         This test is related to the above one, testing that there aren't
388.         old JOINs in the query.
389.         """
390.         qs = Celebrity.objects.order_by("greatest_fan__fan_of")
391.         self.assertIn("OUTER JOIN", str(qs.query))
392.         qs = qs.order_by("id")
393.         self.assertNotIn("OUTER JOIN", str(qs.query))
394. 
395.     def test_order_by_related_field_transform(self):
396.         extra_12 = ExtraInfo.objects.create(
397.             info="extra 12",
398.             date=DateTimePK.objects.create(date=datetime.datetime(2021, 12, 10)),
399.         )
400.         extra_11 = ExtraInfo.objects.create(
401.             info="extra 11",
402.             date=DateTimePK.objects.create(date=datetime.datetime(2022, 11, 10)),
403.         )
404.         self.assertSequenceEqual(
405.             ExtraInfo.objects.filter(date__isnull=False).order_by("date__month"),
406.             [extra_11, extra_12],
407.         )
408. 
409.     def test_filter_by_related_field_transform(self):
410.         extra_old = ExtraInfo.objects.create(
411.             info="extra 12",
412.             date=DateTimePK.objects.create(date=datetime.datetime(2020, 12, 10)),
413.         )
414.         ExtraInfo.objects.create(info="extra 11", date=DateTimePK.objects.create())
415.         a5 = Author.objects.create(name="a5", num=5005, extra=extra_old)
416. 
417.         fk_field = ExtraInfo._meta.get_field("date")
418.         with register_lookup(fk_field, ExtractYear):
419.             self.assertSequenceEqual(
420.                 ExtraInfo.objects.filter(date__year=2020),
421.                 [extra_old],
422.             )
423.             self.assertSequenceEqual(
424.                 Author.objects.filter(extra__date__year=2020), [a5]
425.             )
426. 
427.     def test_filter_by_related_field_nested_transforms(self):
428.         extra = ExtraInfo.objects.create(info=" extra")
429.         a5 = Author.objects.create(name="a5", num=5005, extra=extra)
430.         info_field = ExtraInfo._meta.get_field("info")
431.         with register_lookup(info_field, Length), register_lookup(CharField, LTrim):
432.             self.assertSequenceEqual(
433.                 Author.objects.filter(extra__info__ltrim__length=5), [a5]
434.             )
435. 
436.     def test_get_clears_ordering(self):
437.         """
438.         get() should clear ordering for optimization purposes.
439.         """
440.         with CaptureQueriesContext(connection) as captured_queries:
441.             Author.objects.order_by("name").get(pk=self.a1.pk)
442.         self.assertNotIn("order by", captured_queries[0]["sql"].lower())
443. 
444.     def test_tickets_4088_4306(self):
445.         self.assertSequenceEqual(Report.objects.filter(creator=1001), [self.r1])
446.         self.assertSequenceEqual(Report.objects.filter(creator__num=1001), [self.r1])
447.         self.assertSequenceEqual(Report.objects.filter(creator__id=1001), [])
448.         self.assertSequenceEqual(
449.             Report.objects.filter(creator__id=self.a1.id), [self.r1]
450.         )
451.         self.assertSequenceEqual(Report.objects.filter(creator__name="a1"), [self.r1])
452. 
453.     def test_ticket4510(self):
454.         self.assertSequenceEqual(
455.             Author.objects.filter(report__name="r1"),
456.             [self.a1],
457.         )
458. 
459.     def test_ticket7378(self):
460.         self.assertSequenceEqual(self.a1.report_set.all(), [self.r1])
461. 
462.     def test_tickets_5324_6704(self):
463.         self.assertSequenceEqual(
464.             Item.objects.filter(tags__name="t4"),
465.             [self.i4],
466.         )
467.         self.assertSequenceEqual(
468.             Item.objects.exclude(tags__name="t4").order_by("name").distinct(),
469.             [self.i1, self.i3, self.i2],
470.         )
471.         self.assertSequenceEqual(
472.             Item.objects.exclude(tags__name="t4").order_by("name").distinct().reverse(),
473.             [self.i2, self.i3, self.i1],
474.         )
475.         self.assertSequenceEqual(
476.             Author.objects.exclude(item__name="one").distinct().order_by("name"),
477.             [self.a2, self.a3, self.a4],
478.         )
479. 
480.         # Excluding across a m2m relation when there is more than one related
481.         # object associated was problematic.
482.         self.assertSequenceEqual(
483.             Item.objects.exclude(tags__name="t1").order_by("name"),
484.             [self.i4, self.i3],
485.         )
486.         self.assertSequenceEqual(
487.             Item.objects.exclude(tags__name="t1").exclude(tags__name="t4"),
488.             [self.i3],
489.         )
490. 
491.         # Excluding from a relation that cannot be NULL should not use outer joins.
492.         query = Item.objects.exclude(creator__in=[self.a1, self.a2]).query
493.         self.assertNotIn(LOUTER, [x.join_type for x in query.alias_map.values()])
494. 
495.         # Similarly, when one of the joins cannot possibly, ever, involve NULL
496.         # values (Author -> ExtraInfo, in the following), it should never be
497.         # promoted to a left outer join. So the following query should only
498.         # involve one "left outer" join (Author -> Item is 0-to-many).
499.         qs = Author.objects.filter(id=self.a1.id).filter(
500.             Q(extra__note=self.n1) | Q(item__note=self.n3)


File: tests/queries/tests.py
Line number range: 1972 - 1978
Content:
class SelectRelatedTests(TestCase):
    def test_tickets_3045_3288(self):
        # Once upon a time, select_related() with circular relations would loop
        # infinitely if you forgot to specify "depth". Now we set an arbitrary
        # default upper bound.
        self.assertSequenceEqual(X.objects.all(), [])
        self.assertSequenceEqual(X.objects.select_related(), [])


File: tests/queries/tests.py
Line number range: 1981 - 1994
Content:
class SubclassFKTests(TestCase):
    def test_ticket7778(self):
        # Model subclasses could not be deleted if a nullable foreign key
        # relates to a model that relates back.

        num_celebs = Celebrity.objects.count()
        tvc = TvChef.objects.create(name="Huey")
        self.assertEqual(Celebrity.objects.count(), num_celebs + 1)
        Fan.objects.create(fan_of=tvc)
        Fan.objects.create(fan_of=tvc)
        tvc.delete()

        # The parent object should have been deleted as well.
        self.assertEqual(Celebrity.objects.count(), num_celebs)


File: tests/queries/tests.py
Line number range: 2066 - 2194
Content:
class Queries6Tests(TestCase):
    @classmethod
    def setUpTestData(cls):
        generic = NamedCategory.objects.create(name="Generic")
        cls.t1 = Tag.objects.create(name="t1", category=generic)
        cls.t2 = Tag.objects.create(name="t2", parent=cls.t1, category=generic)
        cls.t3 = Tag.objects.create(name="t3", parent=cls.t1)
        cls.t4 = Tag.objects.create(name="t4", parent=cls.t3)
        cls.t5 = Tag.objects.create(name="t5", parent=cls.t3)
        n1 = Note.objects.create(note="n1", misc="foo", id=1)
        cls.ann1 = Annotation.objects.create(name="a1", tag=cls.t1)
        cls.ann1.notes.add(n1)
        cls.ann2 = Annotation.objects.create(name="a2", tag=cls.t4)

    def test_parallel_iterators(self):
        # Parallel iterators work.
        qs = Tag.objects.all()
        i1, i2 = iter(qs), iter(qs)
        self.assertEqual(repr(next(i1)), "<Tag: t1>")
        self.assertEqual(repr(next(i1)), "<Tag: t2>")
        self.assertEqual(repr(next(i2)), "<Tag: t1>")
        self.assertEqual(repr(next(i2)), "<Tag: t2>")
        self.assertEqual(repr(next(i2)), "<Tag: t3>")
        self.assertEqual(repr(next(i1)), "<Tag: t3>")

        qs = X.objects.all()
        self.assertFalse(qs)
        self.assertFalse(qs)

    def test_nested_queries_sql(self):
        # Nested queries should not evaluate the inner query as part of constructing the
        # SQL (so we should see a nested query here, indicated by two "SELECT" calls).
        qs = Annotation.objects.filter(notes__in=Note.objects.filter(note="xyzzy"))
        self.assertEqual(qs.query.get_compiler(qs.db).as_sql()[0].count("SELECT"), 2)

    def test_tickets_8921_9188(self):
        # Incorrect SQL was being generated for certain types of exclude()
        # queries that crossed multi-valued relations (#8921, #9188 and some
        # preemptively discovered cases).

        self.assertSequenceEqual(
            PointerA.objects.filter(connection__pointerb__id=1), []
        )
        self.assertSequenceEqual(
            PointerA.objects.exclude(connection__pointerb__id=1), []
        )

        self.assertSequenceEqual(
            Tag.objects.exclude(children=None),
            [self.t1, self.t3],
        )

        # This example is tricky because the parent could be NULL, so only checking
        # parents with annotations omits some results (tag t1, in this case).
        self.assertSequenceEqual(
            Tag.objects.exclude(parent__annotation__name="a1"),
            [self.t1, self.t4, self.t5],
        )

        # The annotation->tag link is single values and tag->children links is
        # multi-valued. So we have to split the exclude filter in the middle
        # and then optimize the inner query without losing results.
        self.assertSequenceEqual(
            Annotation.objects.exclude(tag__children__name="t2"),
            [self.ann2],
        )

        # Nested queries are possible (although should be used with care, since
        # they have performance problems on backends like MySQL.
        self.assertSequenceEqual(
            Annotation.objects.filter(notes__in=Note.objects.filter(note="n1")),
            [self.ann1],
        )

    def test_ticket3739(self):
        # The all() method on querysets returns a copy of the queryset.
        q1 = Tag.objects.order_by("name")
        self.assertIsNot(q1, q1.all())

    def test_ticket_11320(self):
        qs = Tag.objects.exclude(category=None).exclude(category__name="foo")
        self.assertEqual(str(qs.query).count(" INNER JOIN "), 1)

    def test_distinct_ordered_sliced_subquery_aggregation(self):
        self.assertEqual(
            Tag.objects.distinct().order_by("category__name")[:3].count(), 3
        )

    def test_multiple_columns_with_the_same_name_slice(self):
        self.assertEqual(
            list(
                Tag.objects.order_by("name").values_list("name", "category__name")[:2]
            ),
            [("t1", "Generic"), ("t2", "Generic")],
        )
        self.assertSequenceEqual(
            Tag.objects.order_by("name").select_related("category")[:2],
            [self.t1, self.t2],
        )
        self.assertEqual(
            list(Tag.objects.order_by("-name").values_list("name", "parent__name")[:2]),
            [("t5", "t3"), ("t4", "t3")],
        )
        self.assertSequenceEqual(
            Tag.objects.order_by("-name").select_related("parent")[:2],
            [self.t5, self.t4],
        )

    def test_col_alias_quoted(self):
        with CaptureQueriesContext(connection) as captured_queries:
            self.assertEqual(
                Tag.objects.values("parent")
                .annotate(
                    tag_per_parent=Count("pk"),
                )
                .aggregate(Max("tag_per_parent")),
                {"tag_per_parent__max": 2},
            )
        sql = captured_queries[0]["sql"]
        self.assertIn("AS %s" % connection.ops.quote_name("col1"), sql)

    def test_xor_subquery(self):
        self.assertSequenceEqual(
            Tag.objects.filter(
                Exists(Tag.objects.filter(id=OuterRef("id"), name="t3"))
                ^ Exists(Tag.objects.filter(id=OuterRef("id"), parent=self.t1))
            ),
            [self.t2],
        )


File: tests/queries/tests.py
Line number range: 2306 - 2340
Content:
class QuerysetOrderedTests(unittest.TestCase):
    """
    Tests for the Queryset.ordered attribute.
    """

    def test_no_default_or_explicit_ordering(self):
        self.assertIs(Annotation.objects.all().ordered, False)

    def test_cleared_default_ordering(self):
        self.assertIs(Tag.objects.all().ordered, True)
        self.assertIs(Tag.objects.order_by().ordered, False)

    def test_explicit_ordering(self):
        self.assertIs(Annotation.objects.order_by("id").ordered, True)

    def test_empty_queryset(self):
        self.assertIs(Annotation.objects.none().ordered, True)

    def test_order_by_extra(self):
        self.assertIs(Annotation.objects.extra(order_by=["id"]).ordered, True)

    def test_annotated_ordering(self):
        qs = Annotation.objects.annotate(num_notes=Count("notes"))
        self.assertIs(qs.ordered, False)
        self.assertIs(qs.order_by("num_notes").ordered, True)

    def test_annotated_default_ordering(self):
        qs = Tag.objects.annotate(num_notes=Count("pk"))
        self.assertIs(qs.ordered, False)
        self.assertIs(qs.order_by("name").ordered, True)

    def test_annotated_values_default_ordering(self):
        qs = Tag.objects.values("name").annotate(num_notes=Count("pk"))
        self.assertIs(qs.ordered, False)
        self.assertIs(qs.order_by("name").ordered, True)


File: tests/queries/tests.py
Line number range: 2343 - 2460
Content:
@skipUnlessDBFeature("allow_sliced_subqueries_with_in")
class SubqueryTests(TestCase):
    @classmethod
    def setUpTestData(cls):
        NamedCategory.objects.create(id=1, name="first")
        NamedCategory.objects.create(id=2, name="second")
        NamedCategory.objects.create(id=3, name="third")
        NamedCategory.objects.create(id=4, name="fourth")

    def test_ordered_subselect(self):
        "Subselects honor any manual ordering"
        query = DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[0:2]
        )
        self.assertEqual(set(query.values_list("id", flat=True)), {3, 4})

        query = DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[:2]
        )
        self.assertEqual(set(query.values_list("id", flat=True)), {3, 4})

        query = DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[1:2]
        )
        self.assertEqual(set(query.values_list("id", flat=True)), {3})

        query = DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[2:]
        )
        self.assertEqual(set(query.values_list("id", flat=True)), {1, 2})

    def test_slice_subquery_and_query(self):
        """
        Slice a query that has a sliced subquery
        """
        query = DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[0:2]
        )[0:2]
        self.assertEqual({x.id for x in query}, {3, 4})

        query = DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[1:3]
        )[1:3]
        self.assertEqual({x.id for x in query}, {3})

        query = DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[2:]
        )[1:]
        self.assertEqual({x.id for x in query}, {2})

    def test_related_sliced_subquery(self):
        """
        Related objects constraints can safely contain sliced subqueries.
        refs #22434
        """
        generic = NamedCategory.objects.create(id=5, name="Generic")
        t1 = Tag.objects.create(name="t1", category=generic)
        t2 = Tag.objects.create(name="t2", category=generic)
        ManagedModel.objects.create(data="mm1", tag=t1, public=True)
        mm2 = ManagedModel.objects.create(data="mm2", tag=t2, public=True)

        query = ManagedModel.normal_manager.filter(
            tag__in=Tag.objects.order_by("-id")[:1]
        )
        self.assertEqual({x.id for x in query}, {mm2.id})

    def test_sliced_delete(self):
        "Delete queries can safely contain sliced subqueries"
        DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[0:1]
        ).delete()
        self.assertEqual(
            set(DumbCategory.objects.values_list("id", flat=True)), {1, 2, 3}
        )

        DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[1:2]
        ).delete()
        self.assertEqual(set(DumbCategory.objects.values_list("id", flat=True)), {1, 3})

        DumbCategory.objects.filter(
            id__in=DumbCategory.objects.order_by("-id")[1:]
        ).delete()
        self.assertEqual(set(DumbCategory.objects.values_list("id", flat=True)), {3})

    def test_distinct_ordered_sliced_subquery(self):
        # Implicit values('id').
        self.assertSequenceEqual(
            NamedCategory.objects.filter(
                id__in=NamedCategory.objects.distinct().order_by("name")[0:2],
            )
            .order_by("name")
            .values_list("name", flat=True),
            ["first", "fourth"],
        )
        # Explicit values('id').
        self.assertSequenceEqual(
            NamedCategory.objects.filter(
                id__in=NamedCategory.objects.distinct()
                .order_by("-name")
                .values("id")[0:2],
            )
            .order_by("name")
            .values_list("name", flat=True),
            ["second", "third"],
        )
        # Annotated value.
        self.assertSequenceEqual(
            DumbCategory.objects.filter(
                id__in=DumbCategory.objects.annotate(double_id=F("id") * 2)
                .order_by("id")
                .distinct()
                .values("double_id")[0:2],
            )
            .order_by("id")
            .values_list("id", flat=True),
            [2, 4],
        )


File: tests/queries/tests.py
Line number range: 2646 - 2793
Content:
class ValuesQuerysetTests(TestCase):
    @classmethod
    def setUpTestData(cls):
        Number.objects.create(num=72)

    def test_flat_values_list(self):
        qs = Number.objects.values_list("num")
        qs = qs.values_list("num", flat=True)
        self.assertSequenceEqual(qs, [72])

    def test_extra_values(self):
        # testing for ticket 14930 issues
        qs = Number.objects.extra(
            select={"value_plus_x": "num+%s", "value_minus_x": "num-%s"},
            select_params=(1, 2),
        )
        qs = qs.order_by("value_minus_x")
        qs = qs.values("num")
        self.assertSequenceEqual(qs, [{"num": 72}])

    def test_extra_values_order_twice(self):
        # testing for ticket 14930 issues
        qs = Number.objects.extra(
            select={"value_plus_one": "num+1", "value_minus_one": "num-1"}
        )
        qs = qs.order_by("value_minus_one").order_by("value_plus_one")
        qs = qs.values("num")
        self.assertSequenceEqual(qs, [{"num": 72}])

    def test_extra_values_order_multiple(self):
        # Postgres doesn't allow constants in order by, so check for that.
        qs = Number.objects.extra(
            select={
                "value_plus_one": "num+1",
                "value_minus_one": "num-1",
                "constant_value": "1",
            }
        )
        qs = qs.order_by("value_plus_one", "value_minus_one", "constant_value")
        qs = qs.values("num")
        self.assertSequenceEqual(qs, [{"num": 72}])

    def test_extra_values_order_in_extra(self):
        # testing for ticket 14930 issues
        qs = Number.objects.extra(
            select={"value_plus_one": "num+1", "value_minus_one": "num-1"},
            order_by=["value_minus_one"],
        )
        qs = qs.values("num")

    def test_extra_select_params_values_order_in_extra(self):
        # testing for 23259 issue
        qs = Number.objects.extra(
            select={"value_plus_x": "num+%s"},
            select_params=[1],
            order_by=["value_plus_x"],
        )
        qs = qs.filter(num=72)
        qs = qs.values("num")
        self.assertSequenceEqual(qs, [{"num": 72}])

    def test_extra_multiple_select_params_values_order_by(self):
        # testing for 23259 issue
        qs = Number.objects.extra(
            select={"value_plus_x": "num+%s", "value_minus_x": "num-%s"},
            select_params=(72, 72),
        )
        qs = qs.order_by("value_minus_x")
        qs = qs.filter(num=1)
        qs = qs.values("num")
        self.assertSequenceEqual(qs, [])

    def test_extra_values_list(self):
        # testing for ticket 14930 issues
        qs = Number.objects.extra(select={"value_plus_one": "num+1"})
        qs = qs.order_by("value_plus_one")
        qs = qs.values_list("num")
        self.assertSequenceEqual(qs, [(72,)])

    def test_flat_extra_values_list(self):
        # testing for ticket 14930 issues
        qs = Number.objects.extra(select={"value_plus_one": "num+1"})
        qs = qs.order_by("value_plus_one")
        qs = qs.values_list("num", flat=True)
        self.assertSequenceEqual(qs, [72])

    def test_field_error_values_list(self):
        # see #23443
        msg = (
            "Cannot resolve keyword %r into field. Join on 'name' not permitted."
            % "foo"
        )
        with self.assertRaisesMessage(FieldError, msg):
            Tag.objects.values_list("name__foo")

    def test_named_values_list_flat(self):
        msg = "'flat' and 'named' can't be used together."
        with self.assertRaisesMessage(TypeError, msg):
            Number.objects.values_list("num", flat=True, named=True)

    def test_named_values_list_bad_field_name(self):
        msg = "Type names and field names must be valid identifiers: '1'"
        with self.assertRaisesMessage(ValueError, msg):
            Number.objects.extra(select={"1": "num+1"}).values_list(
                "1", named=True
            ).first()

    def test_named_values_list_with_fields(self):
        qs = Number.objects.extra(select={"num2": "num+1"}).annotate(Count("id"))
        values = qs.values_list("num", "num2", named=True).first()
        self.assertEqual(type(values).__name__, "Row")
        self.assertEqual(values._fields, ("num", "num2"))
        self.assertEqual(values.num, 72)
        self.assertEqual(values.num2, 73)

    def test_named_values_list_without_fields(self):
        qs = Number.objects.extra(select={"num2": "num+1"}).annotate(Count("id"))
        values = qs.values_list(named=True).first()
        self.assertEqual(type(values).__name__, "Row")
        self.assertEqual(
            values._fields,
            ("num2", "id", "num", "other_num", "another_num", "id__count"),
        )
        self.assertEqual(values.num, 72)
        self.assertEqual(values.num2, 73)
        self.assertEqual(values.id__count, 1)

    def test_named_values_list_expression_with_default_alias(self):
        expr = Count("id")
        values = (
            Number.objects.annotate(id__count1=expr)
            .values_list(expr, "id__count1", named=True)
            .first()
        )
        self.assertEqual(values._fields, ("id__count2", "id__count1"))

    def test_named_values_list_expression(self):
        expr = F("num") + 1
        qs = Number.objects.annotate(combinedexpression1=expr).values_list(
            expr, "combinedexpression1", named=True
        )
        values = qs.first()
        self.assertEqual(values._fields, ("combinedexpression2", "combinedexpression1"))

    def test_named_values_pickle(self):
        value = Number.objects.values_list("num", "other_num", named=True).get()
        self.assertEqual(value, (72, None))
        self.assertEqual(pickle.loads(pickle.dumps(value)), value)


File: tests/queries/tests.py
Line number range: 3560 - 3570
Content:
class ProxyQueryCleanupTest(TestCase):
    def test_evaluated_proxy_count(self):
        """
        Generating the query string doesn't alter the query's state
        in irreversible ways. Refs #18248.
        """
        ProxyCategory.objects.create()
        qs = ProxyCategory.objects.all()
        self.assertEqual(qs.count(), 1)
        str(qs.query)
        self.assertEqual(qs.count(), 1)


File: tests/queries/tests.py
Line number range: 3839 - 3893
Content:
class JoinReuseTest(TestCase):
    """
    The queries reuse joins sensibly (for example, direct joins
    are always reused).
    """

    def test_fk_reuse(self):
        qs = Annotation.objects.filter(tag__name="foo").filter(tag__name="bar")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_select_related(self):
        qs = Annotation.objects.filter(tag__name="foo").select_related("tag")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_annotation(self):
        qs = Annotation.objects.filter(tag__name="foo").annotate(cnt=Count("tag__name"))
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_disjunction(self):
        qs = Annotation.objects.filter(Q(tag__name="foo") | Q(tag__name="bar"))
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_order_by(self):
        qs = Annotation.objects.filter(tag__name="foo").order_by("tag__name")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_revo2o_reuse(self):
        qs = Detail.objects.filter(member__name="foo").filter(member__name="foo")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_revfk_noreuse(self):
        qs = Author.objects.filter(report__name="r4").filter(report__name="r1")
        self.assertEqual(str(qs.query).count("JOIN"), 2)

    def test_inverted_q_across_relations(self):
        """
        When a trimmable join is specified in the query (here school__), the
        ORM detects it and removes unnecessary joins. The set of reusable joins
        are updated after trimming the query so that other lookups don't
        consider that the outer query's filters are in effect for the subquery
        (#26551).
        """
        springfield_elementary = School.objects.create()
        hogward = School.objects.create()
        Student.objects.create(school=springfield_elementary)
        hp = Student.objects.create(school=hogward)
        Classroom.objects.create(school=hogward, name="Potion")
        Classroom.objects.create(school=springfield_elementary, name="Main")
        qs = Student.objects.filter(
            ~(
                Q(school__classroom__name="Main")
                & Q(school__classroom__has_blackboard=None)
            )
        )
        self.assertSequenceEqual(qs, [hp])


File: tests/queries/tests.py
Line number range: 4149 - 4158
Content:
class Ticket18785Tests(SimpleTestCase):
    def test_ticket_18785(self):
        # Test join trimming from ticket18785
        qs = (
            Item.objects.exclude(note__isnull=False)
            .filter(name="something", creator__extra__isnull=True)
            .order_by()
        )
        self.assertEqual(1, str(qs.query).count("INNER JOIN"))
        self.assertEqual(0, str(qs.query).count("OUTER JOIN"))


File: tests/queries/tests.py
Line number range: 4331 - 4356
Content:
class Ticket20955Tests(TestCase):
    def test_ticket_20955(self):
        jack = Staff.objects.create(name="jackstaff")
        jackstaff = StaffUser.objects.create(staff=jack)
        jill = Staff.objects.create(name="jillstaff")
        jillstaff = StaffUser.objects.create(staff=jill)
        task = Task.objects.create(creator=jackstaff, owner=jillstaff, title="task")
        task_get = Task.objects.get(pk=task.pk)
        # Load data so that assertNumQueries doesn't complain about the get
        # version's queries.
        task_get.creator.staffuser.staff
        task_get.owner.staffuser.staff
        qs = Task.objects.select_related(
            "creator__staffuser__staff", "owner__staffuser__staff"
        )
        self.assertEqual(str(qs.query).count(" JOIN "), 6)
        task_select_related = qs.get(pk=task.pk)
        with self.assertNumQueries(0):
            self.assertEqual(
                task_select_related.creator.staffuser.staff,
                task_get.creator.staffuser.staff,
            )
            self.assertEqual(
                task_select_related.owner.staffuser.staff,
                task_get.owner.staffuser.staff,
            )


File: tests/queries/tests.py
Line number range: 4359 - 4365
Content:
class Ticket21203Tests(TestCase):
    def test_ticket_21203(self):
        p = Ticket21203Parent.objects.create(parent_bool=True)
        c = Ticket21203Child.objects.create(parent=p)
        qs = Ticket21203Child.objects.select_related("parent").defer("parent__created")
        self.assertSequenceEqual(qs, [c])
        self.assertIs(qs[0].parent.parent_bool, True)


File: tests/queries/tests.py
Line number range: 4368 - 4393
Content:
class ValuesJoinPromotionTests(TestCase):
    def test_values_no_promotion_for_existing(self):
        qs = Node.objects.filter(parent__parent__isnull=False)
        self.assertIn(" INNER JOIN ", str(qs.query))
        qs = qs.values("parent__parent__id")
        self.assertIn(" INNER JOIN ", str(qs.query))
        # Make sure there is a left outer join without the filter.
        qs = Node.objects.values("parent__parent__id")
        self.assertIn(" LEFT OUTER JOIN ", str(qs.query))

    def test_non_nullable_fk_not_promoted(self):
        qs = ObjectB.objects.values("objecta__name")
        self.assertIn(" INNER JOIN ", str(qs.query))

    def test_ticket_21376(self):
        a = ObjectA.objects.create()
        ObjectC.objects.create(objecta=a)
        qs = ObjectC.objects.filter(
            Q(objecta=a) | Q(objectb__objecta=a),
        )
        qs = qs.filter(
            Q(objectb=1) | Q(objecta=a),
        )
        self.assertEqual(qs.count(), 1)
        tblname = connection.ops.quote_name(ObjectB._meta.db_table)
        self.assertIn(" LEFT OUTER JOIN %s" % tblname, str(qs.query))

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 17:43:21,367 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of `tests/queries/tests.py`. This context contains the initial imports and the `Queries1Tests` class, which includes various query tests, some of which use `.count()` (e.g., `test_tickets_1878_2939`, `test_ticket7323`) and are relevant to the user's purpose of finding tests for query optimizations.", relative_path='tests/queries/tests.py', start_line=1, end_line=500), ContextOutput(reasoning="The user requested the full content of `tests/queries/tests.py`. This context contains `SelectRelatedTests`, which is relevant to the user's purpose of finding tests for `select_related()` optimizations.", relative_path='tests/queries/tests.py', start_line=1972, end_line=1978), ContextOutput(reasoning='The user requested the full content of `tests/queries/tests.py`. This context contains `SubclassFKTests` which includes a test using `.count()`.', relative_path='tests/queries/tests.py', start_line=1981, end_line=1994), ContextOutput(reasoning="The user requested the full content of `tests/queries/tests.py`. This context contains `Queries6Tests`, which has several tests relevant to the user's purpose, including tests for `.count()` on complex queries (`test_distinct_ordered_sliced_subquery_aggregation`), `select_related()` (`test_multiple_columns_with_the_same_name_slice`), and `annotate()` with `Count()` (`test_col_alias_quoted`).", relative_path='tests/queries/tests.py', start_line=2066, end_line=2194), ContextOutput(reasoning="The user requested the full content of `tests/queries/tests.py`. This context contains `QuerysetOrderedTests`, which is relevant to the user's purpose as it includes tests for querysets with annotations using `Count()` (`test_annotated_ordering`, `test_annotated_default_ordering`).", relative_path='tests/queries/tests.py', start_line=2306, end_line=2340), ContextOutput(reasoning='The user requested the full content of `tests/queries/tests.py`. This context contains `SubqueryTests` which, while focused on subqueries, provides extended context for query construction.', relative_path='tests/queries/tests.py', start_line=2343, end_line=2460), ContextOutput(reasoning='The user requested the full content of `tests/queries/tests.py`. This context contains `ValuesQuerysetTests`, which includes tests using `.annotate(Count(...))` and is relevant for understanding how values and annotations interact.', relative_path='tests/queries/tests.py', start_line=2646, end_line=2793), ContextOutput(reasoning="The user requested the full content of `tests/queries/tests.py`. This context contains `ProxyQueryCleanupTest`, which includes a test for `.count()` (`test_evaluated_proxy_count`) relevant to the user's purpose.", relative_path='tests/queries/tests.py', start_line=3560, end_line=3570), ContextOutput(reasoning="The user requested the full content of `tests/queries/tests.py`. This context contains `JoinReuseTest`, which is highly relevant to the user's purpose as it includes tests for join optimizations with `select_related()` (`test_fk_reuse_select_related`) and `annotate()` (`test_fk_reuse_annotation`).", relative_path='tests/queries/tests.py', start_line=3839, end_line=3893), ContextOutput(reasoning='The user requested the full content of `tests/queries/tests.py`. This context provides extended context on query construction and join trimming.', relative_path='tests/queries/tests.py', start_line=4149, end_line=4158), ContextOutput(reasoning='The user requested the full content of `tests/queries/tests.py`. This context contains `Ticket20955Tests`, which is highly relevant as it tests query optimization for `select_related()` by asserting the number of queries executed.', relative_path='tests/queries/tests.py', start_line=4331, end_line=4356), ContextOutput(reasoning='The user requested the full content of `tests/queries/tests.py`. This context contains `Ticket21203Tests` which includes a test for `select_related()`.', relative_path='tests/queries/tests.py', start_line=4359, end_line=4365), ContextOutput(reasoning='The user requested the full content of `tests/queries/tests.py`. This context contains `ValuesJoinPromotionTests`, which includes a test using `.count()` on a complex query (`test_ticket_21376`) and is relevant to join promotion optimizations.', relative_path='tests/queries/tests.py', start_line=4368, end_line=4393)]
2025-12-21 17:43:21,377 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 13 contexts to memory for query: Please provide the full content of `tests/queries/tests.py`.
2025-12-21 17:43:21,378 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 17:43:21,378 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 17:43:21,378 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 13 new contexts to 1 existing contexts
2025-12-21 17:43:21,379 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 14 total contexts (removed 0 duplicates)
2025-12-21 17:43:21,380 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   ├── custom_sitemap_index.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Strip unused annotations from count queries

Description: Description
	
The query below produces a SQL statement that includes the Count('chapters'), despite not not being used in any filter operations.
Book.objects.annotate(Count('chapters')).count()
It produces the same results as:
Book.objects.count()
Django could be more intelligent about what annotations to include in the query produced by queryset.count(), stripping out any annotations that are not referenced by filters, other annotations or ordering. This should speed up calls to count() with complex annotations.
There seems to be precedent for this: select_related calls are ignored with count() queries.

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 9735ce10c8..c040e834c6 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -549,8 +549,31 @@ class Query(BaseExpression):
         """
         Perform a COUNT() query using the current filter constraints.
         """
+        # If it's safe to ignore existing annotations, build a fresh query to
+        # avoid carrying over their joins into the COUNT() query.
+        if (
+            not self.has_filters()
+            and not self.order_by
+            and not self.extra_order_by
+            and not self.is_sliced
+            and not self.distinct
+            and not self.distinct_fields
+            and not self.combinator
+            and self.select_related is False
+            and not self.extra
+            and not self.extra_tables
+        ):
+            fresh = self.__class__(self.model)
+            # Ensure base table alias is initialized for the FROM clause.
+            fresh.get_initial_alias()
+            fresh.add_annotation(Count("*"), alias="__count", is_summary=True)
+            fresh.set_annotation_mask(["__count"])  # Only select __count.
+            fresh.set_extra_mask(())  # Exclude any extra(select=...).
+            return fresh.get_aggregation(using, ["__count"])["__count"]
         obj = self.clone()
         obj.add_annotation(Count("*"), alias="__count", is_summary=True)
+        obj.set_annotation_mask(["__count"])  # Only select __count.
+        obj.set_extra_mask(())  # Exclude any extra(select=...).
         return obj.get_aggregation(using, ["__count"])["__count"]
 
     def has_filters(self):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/aggregation/tests.py`.
Extra Requirements: 
Purpose: I need to find existing test cases that test the `.count()` method on annotated querysets, and this file is the most likely place to find them.

Previous refined query 2:
Essential Query: Please provide the full content of `tests/queries/tests.py`.
Extra Requirements: 
Purpose: I need to find test cases that verify query optimizations for `.count()` when used with `annotate()` and `select_related()`.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/aggregation/tests.py
Line number range: 1 - 2086
Content:
1. import datetime
2. import math
3. import re
4. from decimal import Decimal
5. 
6. from django.core.exceptions import FieldError
7. from django.db import connection
8. from django.db.models import (
9.     Avg,
10.     Case,
11.     Count,
12.     DateField,
13.     DateTimeField,
14.     DecimalField,
15.     DurationField,
16.     Exists,
17.     F,
18.     FloatField,
19.     IntegerField,
20.     Max,
21.     Min,
22.     OuterRef,
23.     Q,
24.     StdDev,
25.     Subquery,
26.     Sum,
27.     TimeField,
28.     Value,
29.     Variance,
30.     When,
31. )
32. from django.db.models.expressions import Func, RawSQL
33. from django.db.models.functions import (
34.     Cast,
35.     Coalesce,
36.     Greatest,
37.     Now,
38.     Pi,
39.     TruncDate,
40.     TruncHour,
41. )
42. from django.test import TestCase
43. from django.test.testcases import skipUnlessDBFeature
44. from django.test.utils import Approximate, CaptureQueriesContext
45. from django.utils import timezone
46. 
47. from .models import Author, Book, Publisher, Store
48. 
49. 
50. class NowUTC(Now):
51.     template = "CURRENT_TIMESTAMP"
52.     output_field = DateTimeField()
53. 
54.     def as_sql(self, compiler, connection, **extra_context):
55.         if connection.features.test_now_utc_template:
56.             extra_context["template"] = connection.features.test_now_utc_template
57.         return super().as_sql(compiler, connection, **extra_context)
58. 
59. 
60. class AggregateTestCase(TestCase):
61.     @classmethod
62.     def setUpTestData(cls):
63.         cls.a1 = Author.objects.create(name="Adrian Holovaty", age=34)
64.         cls.a2 = Author.objects.create(name="Jacob Kaplan-Moss", age=35)
65.         cls.a3 = Author.objects.create(name="Brad Dayley", age=45)
66.         cls.a4 = Author.objects.create(name="James Bennett", age=29)
67.         cls.a5 = Author.objects.create(name="Jeffrey Forcier", age=37)
68.         cls.a6 = Author.objects.create(name="Paul Bissex", age=29)
69.         cls.a7 = Author.objects.create(name="Wesley J. Chun", age=25)
70.         cls.a8 = Author.objects.create(name="Peter Norvig", age=57)
71.         cls.a9 = Author.objects.create(name="Stuart Russell", age=46)
72.         cls.a1.friends.add(cls.a2, cls.a4)
73.         cls.a2.friends.add(cls.a1, cls.a7)
74.         cls.a4.friends.add(cls.a1)
75.         cls.a5.friends.add(cls.a6, cls.a7)
76.         cls.a6.friends.add(cls.a5, cls.a7)
77.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
78.         cls.a8.friends.add(cls.a9)
79.         cls.a9.friends.add(cls.a8)
80. 
81.         cls.p1 = Publisher.objects.create(
82.             name="Apress", num_awards=3, duration=datetime.timedelta(days=1)
83.         )
84.         cls.p2 = Publisher.objects.create(
85.             name="Sams", num_awards=1, duration=datetime.timedelta(days=2)
86.         )
87.         cls.p3 = Publisher.objects.create(name="Prentice Hall", num_awards=7)
88.         cls.p4 = Publisher.objects.create(name="Morgan Kaufmann", num_awards=9)
89.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
90. 
91.         cls.b1 = Book.objects.create(
92.             isbn="159059725",
93.             name="The Definitive Guide to Django: Web Development Done Right",
94.             pages=447,
95.             rating=4.5,
96.             price=Decimal("30.00"),
97.             contact=cls.a1,
98.             publisher=cls.p1,
99.             pubdate=datetime.date(2007, 12, 6),
100.         )
101.         cls.b2 = Book.objects.create(
102.             isbn="067232959",
103.             name="Sams Teach Yourself Django in 24 Hours",
104.             pages=528,
105.             rating=3.0,
106.             price=Decimal("23.09"),
107.             contact=cls.a3,
108.             publisher=cls.p2,
109.             pubdate=datetime.date(2008, 3, 3),
110.         )
111.         cls.b3 = Book.objects.create(
112.             isbn="159059996",
113.             name="Practical Django Projects",
114.             pages=300,
115.             rating=4.0,
116.             price=Decimal("29.69"),
117.             contact=cls.a4,
118.             publisher=cls.p1,
119.             pubdate=datetime.date(2008, 6, 23),
120.         )
121.         cls.b4 = Book.objects.create(
122.             isbn="013235613",
123.             name="Python Web Development with Django",
124.             pages=350,
125.             rating=4.0,
126.             price=Decimal("29.69"),
127.             contact=cls.a5,
128.             publisher=cls.p3,
129.             pubdate=datetime.date(2008, 11, 3),
130.         )
131.         cls.b5 = Book.objects.create(
132.             isbn="013790395",
133.             name="Artificial Intelligence: A Modern Approach",
134.             pages=1132,
135.             rating=4.0,
136.             price=Decimal("82.80"),
137.             contact=cls.a8,
138.             publisher=cls.p3,
139.             pubdate=datetime.date(1995, 1, 15),
140.         )
141.         cls.b6 = Book.objects.create(
142.             isbn="155860191",
143.             name=(
144.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
145.                 "Common Lisp"
146.             ),
147.             pages=946,
148.             rating=5.0,
149.             price=Decimal("75.00"),
150.             contact=cls.a8,
151.             publisher=cls.p4,
152.             pubdate=datetime.date(1991, 10, 15),
153.         )
154.         cls.b1.authors.add(cls.a1, cls.a2)
155.         cls.b2.authors.add(cls.a3)
156.         cls.b3.authors.add(cls.a4)
157.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
158.         cls.b5.authors.add(cls.a8, cls.a9)
159.         cls.b6.authors.add(cls.a8)
160. 
161.         s1 = Store.objects.create(
162.             name="Amazon.com",
163.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
164.             friday_night_closing=datetime.time(23, 59, 59),
165.         )
166.         s2 = Store.objects.create(
167.             name="Books.com",
168.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
169.             friday_night_closing=datetime.time(23, 59, 59),
170.         )
171.         s3 = Store.objects.create(
172.             name="Mamma and Pappa's Books",
173.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
174.             friday_night_closing=datetime.time(21, 30),
175.         )
176.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
177.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
178.         s3.books.add(cls.b3, cls.b4, cls.b6)
179. 
180.     def test_empty_aggregate(self):
181.         self.assertEqual(Author.objects.aggregate(), {})
182. 
183.     def test_aggregate_in_order_by(self):
184.         msg = (
185.             "Using an aggregate in order_by() without also including it in "
186.             "annotate() is not allowed: Avg(F(book__rating)"
187.         )
188.         with self.assertRaisesMessage(FieldError, msg):
189.             Author.objects.values("age").order_by(Avg("book__rating"))
190. 
191.     def test_single_aggregate(self):
192.         vals = Author.objects.aggregate(Avg("age"))
193.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
194. 
195.     def test_multiple_aggregates(self):
196.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
197.         self.assertEqual(
198.             vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)}
199.         )
200. 
201.     def test_filter_aggregate(self):
202.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
203.         self.assertEqual(vals, {"age__sum": 254})
204. 
205.     def test_related_aggregate(self):
206.         vals = Author.objects.aggregate(Avg("friends__age"))
207.         self.assertEqual(vals, {"friends__age__avg": Approximate(34.07, places=2)})
208. 
209.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
210.         self.assertEqual(vals, {"authors__age__avg": Approximate(38.2857, places=2)})
211. 
212.         vals = Author.objects.filter(name__contains="a").aggregate(Avg("book__rating"))
213.         self.assertEqual(vals, {"book__rating__avg": 4.0})
214. 
215.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
216.         self.assertEqual(vals, {"publisher__num_awards__sum": 30})
217. 
218.         vals = Publisher.objects.aggregate(Sum("book__price"))
219.         self.assertEqual(vals, {"book__price__sum": Decimal("270.27")})
220. 
221.     def test_aggregate_multi_join(self):
222.         vals = Store.objects.aggregate(Max("books__authors__age"))
223.         self.assertEqual(vals, {"books__authors__age__max": 57})
224. 
225.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
226.         self.assertEqual(vals, {"book__publisher__num_awards__min": 1})
227. 
228.     def test_aggregate_alias(self):
229.         vals = Store.objects.filter(name="Amazon.com").aggregate(
230.             amazon_mean=Avg("books__rating")
231.         )
232.         self.assertEqual(vals, {"amazon_mean": Approximate(4.08, places=2)})
233. 
234.     def test_aggregate_transform(self):
235.         vals = Store.objects.aggregate(min_month=Min("original_opening__month"))
236.         self.assertEqual(vals, {"min_month": 3})
237. 
238.     def test_aggregate_join_transform(self):
239.         vals = Publisher.objects.aggregate(min_year=Min("book__pubdate__year"))
240.         self.assertEqual(vals, {"min_year": 1991})
241. 
242.     def test_annotate_basic(self):
243.         self.assertQuerySetEqual(
244.             Book.objects.annotate().order_by("pk"),
245.             [
246.                 "The Definitive Guide to Django: Web Development Done Right",
247.                 "Sams Teach Yourself Django in 24 Hours",
248.                 "Practical Django Projects",
249.                 "Python Web Development with Django",
250.                 "Artificial Intelligence: A Modern Approach",
251.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
252.                 "Common Lisp",
253.             ],
254.             lambda b: b.name,
255.         )
256. 
257.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
258.         b = books.get(pk=self.b1.pk)
259.         self.assertEqual(
260.             b.name, "The Definitive Guide to Django: Web Development Done Right"
261.         )
262.         self.assertEqual(b.mean_age, 34.5)
263. 
264.     def test_annotate_defer(self):
265.         qs = (
266.             Book.objects.annotate(page_sum=Sum("pages"))
267.             .defer("name")
268.             .filter(pk=self.b1.pk)
269.         )
270. 
271.         rows = [
272.             (
273.                 self.b1.id,
274.                 "159059725",
275.                 447,
276.                 "The Definitive Guide to Django: Web Development Done Right",
277.             )
278.         ]
279.         self.assertQuerySetEqual(
280.             qs.order_by("pk"), rows, lambda r: (r.id, r.isbn, r.page_sum, r.name)
281.         )
282. 
283.     def test_annotate_defer_select_related(self):
284.         qs = (
285.             Book.objects.select_related("contact")
286.             .annotate(page_sum=Sum("pages"))
287.             .defer("name")
288.             .filter(pk=self.b1.pk)
289.         )
290. 
291.         rows = [
292.             (
293.                 self.b1.id,
294.                 "159059725",
295.                 447,
296.                 "Adrian Holovaty",
297.                 "The Definitive Guide to Django: Web Development Done Right",
298.             )
299.         ]
300.         self.assertQuerySetEqual(
301.             qs.order_by("pk"),
302.             rows,
303.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name),
304.         )
305. 
306.     def test_annotate_m2m(self):
307.         books = (
308.             Book.objects.filter(rating__lt=4.5)
309.             .annotate(Avg("authors__age"))
310.             .order_by("name")
311.         )
312.         self.assertQuerySetEqual(
313.             books,
314.             [
315.                 ("Artificial Intelligence: A Modern Approach", 51.5),
316.                 ("Practical Django Projects", 29.0),
317.                 ("Python Web Development with Django", Approximate(30.3, places=1)),
318.                 ("Sams Teach Yourself Django in 24 Hours", 45.0),
319.             ],
320.             lambda b: (b.name, b.authors__age__avg),
321.         )
322. 
323.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
324.         self.assertQuerySetEqual(
325.             books,
326.             [
327.                 ("Artificial Intelligence: A Modern Approach", 2),
328.                 (
329.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
330.                     "Common Lisp",
331.                     1,
332.                 ),
333.                 ("Practical Django Projects", 1),
334.                 ("Python Web Development with Django", 3),
335.                 ("Sams Teach Yourself Django in 24 Hours", 1),
336.                 ("The Definitive Guide to Django: Web Development Done Right", 2),
337.             ],
338.             lambda b: (b.name, b.num_authors),
339.         )
340. 
341.     def test_backwards_m2m_annotate(self):
342.         authors = (
343.             Author.objects.filter(name__contains="a")
344.             .annotate(Avg("book__rating"))
345.             .order_by("name")
346.         )
347.         self.assertQuerySetEqual(
348.             authors,
349.             [
350.                 ("Adrian Holovaty", 4.5),
351.                 ("Brad Dayley", 3.0),
352.                 ("Jacob Kaplan-Moss", 4.5),
353.                 ("James Bennett", 4.0),
354.                 ("Paul Bissex", 4.0),
355.                 ("Stuart Russell", 4.0),
356.             ],
357.             lambda a: (a.name, a.book__rating__avg),
358.         )
359. 
360.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
361.         self.assertQuerySetEqual(
362.             authors,
363.             [
364.                 ("Adrian Holovaty", 1),
365.                 ("Brad Dayley", 1),
366.                 ("Jacob Kaplan-Moss", 1),
367.                 ("James Bennett", 1),
368.                 ("Jeffrey Forcier", 1),
369.                 ("Paul Bissex", 1),
370.                 ("Peter Norvig", 2),
371.                 ("Stuart Russell", 1),
372.                 ("Wesley J. Chun", 1),
373.             ],
374.             lambda a: (a.name, a.num_books),
375.         )
376. 
377.     def test_reverse_fkey_annotate(self):
378.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
379.         self.assertQuerySetEqual(
380.             books,
381.             [
382.                 ("Artificial Intelligence: A Modern Approach", 7),
383.                 (
384.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
385.                     "Common Lisp",
386.                     9,
387.                 ),
388.                 ("Practical Django Projects", 3),
389.                 ("Python Web Development with Django", 7),
390.                 ("Sams Teach Yourself Django in 24 Hours", 1),
391.                 ("The Definitive Guide to Django: Web Development Done Right", 3),
392.             ],
393.             lambda b: (b.name, b.publisher__num_awards__sum),
394.         )
395. 
396.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
397.         self.assertQuerySetEqual(
398.             publishers,
399.             [
400.                 ("Apress", Decimal("59.69")),
401.                 ("Jonno's House of Books", None),
402.                 ("Morgan Kaufmann", Decimal("75.00")),
403.                 ("Prentice Hall", Decimal("112.49")),
404.                 ("Sams", Decimal("23.09")),
405.             ],
406.             lambda p: (p.name, p.book__price__sum),
407.         )
408. 
409.     def test_annotate_values(self):
410.         books = list(
411.             Book.objects.filter(pk=self.b1.pk)
412.             .annotate(mean_age=Avg("authors__age"))
413.             .values()
414.         )
415.         self.assertEqual(
416.             books,
417.             [
418.                 {
419.                     "contact_id": self.a1.id,
420.                     "id": self.b1.id,
421.                     "isbn": "159059725",
422.                     "mean_age": 34.5,
423.                     "name": (
424.                         "The Definitive Guide to Django: Web Development Done Right"
425.                     ),
426.                     "pages": 447,
427.                     "price": Approximate(Decimal("30")),
428.                     "pubdate": datetime.date(2007, 12, 6),
429.                     "publisher_id": self.p1.id,
430.                     "rating": 4.5,
431.                 }
432.             ],
433.         )
434. 
435.         books = (
436.             Book.objects.filter(pk=self.b1.pk)
437.             .annotate(mean_age=Avg("authors__age"))
438.             .values("pk", "isbn", "mean_age")
439.         )
440.         self.assertEqual(
441.             list(books),
442.             [
443.                 {
444.                     "pk": self.b1.pk,
445.                     "isbn": "159059725",
446.                     "mean_age": 34.5,
447.                 }
448.             ],
449.         )
450. 
451.         books = (
452.             Book.objects.filter(pk=self.b1.pk)
453.             .annotate(mean_age=Avg("authors__age"))
454.             .values("name")
455.         )
456.         self.assertEqual(
457.             list(books),
458.             [{"name": "The Definitive Guide to Django: Web Development Done Right"}],
459.         )
460. 
461.         books = (
462.             Book.objects.filter(pk=self.b1.pk)
463.             .values()
464.             .annotate(mean_age=Avg("authors__age"))
465.         )
466.         self.assertEqual(
467.             list(books),
468.             [
469.                 {
470.                     "contact_id": self.a1.id,
471.                     "id": self.b1.id,
472.                     "isbn": "159059725",
473.                     "mean_age": 34.5,
474.                     "name": (
475.                         "The Definitive Guide to Django: Web Development Done Right"
476.                     ),
477.                     "pages": 447,
478.                     "price": Approximate(Decimal("30")),
479.                     "pubdate": datetime.date(2007, 12, 6),
480.                     "publisher_id": self.p1.id,
481.                     "rating": 4.5,
482.                 }
483.             ],
484.         )
485. 
486.         books = (
487.             Book.objects.values("rating")
488.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
489.             .order_by("rating")
490.         )
491.         self.assertEqual(
492.             list(books),
493.             [
494.                 {
495.                     "rating": 3.0,
496.                     "n_authors": 1,
497.                     "mean_age": 45.0,
498.                 },
499.                 {
500.                     "rating": 4.0,
501.                     "n_authors": 6,
502.                     "mean_age": Approximate(37.16, places=1),
503.                 },
504.                 {
505.                     "rating": 4.5,
506.                     "n_authors": 2,
507.                     "mean_age": 34.5,
508.                 },
509.                 {
510.                     "rating": 5.0,
511.                     "n_authors": 1,
512.                     "mean_age": 57.0,
513.                 },
514.             ],
515.         )
516. 
517.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
518.         self.assertQuerySetEqual(
519.             authors,
520.             [
521.                 ("Adrian Holovaty", 32.0),
522.                 ("Brad Dayley", None),
523.                 ("Jacob Kaplan-Moss", 29.5),
524.                 ("James Bennett", 34.0),
525.                 ("Jeffrey Forcier", 27.0),
526.                 ("Paul Bissex", 31.0),
527.                 ("Peter Norvig", 46.0),
528.                 ("Stuart Russell", 57.0),
529.                 ("Wesley J. Chun", Approximate(33.66, places=1)),
530.             ],
531.             lambda a: (a.name, a.friends__age__avg),
532.         )
533. 
534.     def test_count(self):
535.         vals = Book.objects.aggregate(Count("rating"))
536.         self.assertEqual(vals, {"rating__count": 6})
537. 
538.     def test_count_star(self):
539.         with self.assertNumQueries(1) as ctx:
540.             Book.objects.aggregate(n=Count("*"))
541.         sql = ctx.captured_queries[0]["sql"]
542.         self.assertIn("SELECT COUNT(*) ", sql)
543. 
544.     def test_count_distinct_expression(self):
545.         aggs = Book.objects.aggregate(
546.             distinct_ratings=Count(
547.                 Case(When(pages__gt=300, then="rating")), distinct=True
548.             ),
549.         )
550.         self.assertEqual(aggs["distinct_ratings"], 4)
551. 
552.     def test_distinct_on_aggregate(self):
553.         for aggregate, expected_result in (
554.             (Avg, 4.125),
555.             (Count, 4),
556.             (Sum, 16.5),
557.         ):
558.             with self.subTest(aggregate=aggregate.__name__):
559.                 books = Book.objects.aggregate(
560.                     ratings=aggregate("rating", distinct=True)
561.                 )
562.                 self.assertEqual(books["ratings"], expected_result)
563. 
564.     def test_non_grouped_annotation_not_in_group_by(self):
565.         """
566.         An annotation not included in values() before an aggregate should be
567.         excluded from the group by clause.
568.         """
569.         qs = (
570.             Book.objects.annotate(xprice=F("price"))
571.             .filter(rating=4.0)
572.             .values("rating")
573.             .annotate(count=Count("publisher_id", distinct=True))
574.             .values("count", "rating")
575.             .order_by("count")
576.         )
577.         self.assertEqual(list(qs), [{"rating": 4.0, "count": 2}])
578. 
579.     def test_grouped_annotation_in_group_by(self):
580.         """
581.         An annotation included in values() before an aggregate should be
582.         included in the group by clause.
583.         """
584.         qs = (
585.             Book.objects.annotate(xprice=F("price"))
586.             .filter(rating=4.0)
587.             .values("rating", "xprice")
588.             .annotate(count=Count("publisher_id", distinct=True))
589.             .values("count", "rating")
590.             .order_by("count")
591.         )
592.         self.assertEqual(
593.             list(qs),
594.             [
595.                 {"rating": 4.0, "count": 1},
596.                 {"rating": 4.0, "count": 2},
597.             ],
598.         )
599. 
600.     def test_fkey_aggregate(self):
601.         explicit = list(Author.objects.annotate(Count("book__id")))
602.         implicit = list(Author.objects.annotate(Count("book")))
603.         self.assertCountEqual(explicit, implicit)
604. 
605.     def test_annotate_ordering(self):
606.         books = (
607.             Book.objects.values("rating")
608.             .annotate(oldest=Max("authors__age"))
609.             .order_by("oldest", "rating")
610.         )
611.         self.assertEqual(
612.             list(books),
613.             [
614.                 {"rating": 4.5, "oldest": 35},
615.                 {"rating": 3.0, "oldest": 45},
616.                 {"rating": 4.0, "oldest": 57},
617.                 {"rating": 5.0, "oldest": 57},
618.             ],
619.         )
620. 
621.         books = (
622.             Book.objects.values("rating")
623.             .annotate(oldest=Max("authors__age"))
624.             .order_by("-oldest", "-rating")
625.         )
626.         self.assertEqual(
627.             list(books),
628.             [
629.                 {"rating": 5.0, "oldest": 57},
630.                 {"rating": 4.0, "oldest": 57},
631.                 {"rating": 3.0, "oldest": 45},
632.                 {"rating": 4.5, "oldest": 35},
633.             ],
634.         )
635. 
636.     def test_aggregate_annotation(self):
637.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(
638.             Avg("num_authors")
639.         )
640.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
641. 
642.     def test_avg_duration_field(self):
643.         # Explicit `output_field`.
644.         self.assertEqual(
645.             Publisher.objects.aggregate(Avg("duration", output_field=DurationField())),
646.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
647.         )
648.         # Implicit `output_field`.
649.         self.assertEqual(
650.             Publisher.objects.aggregate(Avg("duration")),
651.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
652.         )
653. 
654.     def test_sum_duration_field(self):
655.         self.assertEqual(
656.             Publisher.objects.aggregate(Sum("duration", output_field=DurationField())),
657.             {"duration__sum": datetime.timedelta(days=3)},
658.         )
659. 
660.     def test_sum_distinct_aggregate(self):
661.         """
662.         Sum on a distinct() QuerySet should aggregate only the distinct items.
663.         """
664.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
665.         self.assertEqual(authors.count(), 3)
666. 
667.         distinct_authors = authors.distinct()
668.         self.assertEqual(distinct_authors.count(), 2)
669. 
670.         # Selected author ages are 57 and 46
671.         age_sum = distinct_authors.aggregate(Sum("age"))
672.         self.assertEqual(age_sum["age__sum"], 103)
673. 
674.     def test_filtering(self):
675.         p = Publisher.objects.create(name="Expensive Publisher", num_awards=0)
676.         Book.objects.create(
677.             name="ExpensiveBook1",
678.             pages=1,
679.             isbn="111",
680.             rating=3.5,
681.             price=Decimal("1000"),
682.             publisher=p,
683.             contact_id=self.a1.id,
684.             pubdate=datetime.date(2008, 12, 1),
685.         )
686.         Book.objects.create(
687.             name="ExpensiveBook2",
688.             pages=1,
689.             isbn="222",
690.             rating=4.0,
691.             price=Decimal("1000"),
692.             publisher=p,
693.             contact_id=self.a1.id,
694.             pubdate=datetime.date(2008, 12, 2),
695.         )
696.         Book.objects.create(
697.             name="ExpensiveBook3",
698.             pages=1,
699.             isbn="333",
700.             rating=4.5,
701.             price=Decimal("35"),
702.             publisher=p,
703.             contact_id=self.a1.id,
704.             pubdate=datetime.date(2008, 12, 3),
705.         )
706. 
707.         publishers = (
708.             Publisher.objects.annotate(num_books=Count("book__id"))
709.             .filter(num_books__gt=1)
710.             .order_by("pk")
711.         )
712.         self.assertQuerySetEqual(
713.             publishers,
714.             ["Apress", "Prentice Hall", "Expensive Publisher"],
715.             lambda p: p.name,
716.         )
717. 
718.         publishers = Publisher.objects.filter(book__price__lt=Decimal("40.0")).order_by(
719.             "pk"
720.         )
721.         self.assertQuerySetEqual(
722.             publishers,
723.             [
724.                 "Apress",
725.                 "Apress",
726.                 "Sams",
727.                 "Prentice Hall",
728.                 "Expensive Publisher",
729.             ],
730.             lambda p: p.name,
731.         )
732. 
733.         publishers = (
734.             Publisher.objects.annotate(num_books=Count("book__id"))
735.             .filter(num_books__gt=1, book__price__lt=Decimal("40.0"))
736.             .order_by("pk")
737.         )
738.         self.assertQuerySetEqual(
739.             publishers,
740.             ["Apress", "Prentice Hall", "Expensive Publisher"],
741.             lambda p: p.name,
742.         )
743. 
744.         publishers = (
745.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
746.             .annotate(num_books=Count("book__id"))
747.             .filter(num_books__gt=1)
748.             .order_by("pk")
749.         )
750.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
751. 
752.         publishers = (
753.             Publisher.objects.annotate(num_books=Count("book"))
754.             .filter(num_books__range=[1, 3])
755.             .order_by("pk")
756.         )
757.         self.assertQuerySetEqual(
758.             publishers,
759.             [
760.                 "Apress",
761.                 "Sams",
762.                 "Prentice Hall",
763.                 "Morgan Kaufmann",
764.                 "Expensive Publisher",
765.             ],
766.             lambda p: p.name,
767.         )
768. 
769.         publishers = (
770.             Publisher.objects.annotate(num_books=Count("book"))
771.             .filter(num_books__range=[1, 2])
772.             .order_by("pk")
773.         )
774.         self.assertQuerySetEqual(
775.             publishers,
776.             ["Apress", "Sams", "Prentice Hall", "Morgan Kaufmann"],
777.             lambda p: p.name,
778.         )
779. 
780.         publishers = (
781.             Publisher.objects.annotate(num_books=Count("book"))
782.             .filter(num_books__in=[1, 3])
783.             .order_by("pk")
784.         )
785.         self.assertQuerySetEqual(
786.             publishers,
787.             ["Sams", "Morgan Kaufmann", "Expensive Publisher"],
788.             lambda p: p.name,
789.         )
790. 
791.         publishers = Publisher.objects.annotate(num_books=Count("book")).filter(
792.             num_books__isnull=True
793.         )
794.         self.assertEqual(len(publishers), 0)
795. 
796.     def test_annotation(self):
797.         vals = Author.objects.filter(pk=self.a1.pk).aggregate(Count("friends__id"))
798.         self.assertEqual(vals, {"friends__id__count": 2})
799. 
800.         books = (
801.             Book.objects.annotate(num_authors=Count("authors__name"))
802.             .filter(num_authors__exact=2)
803.             .order_by("pk")
804.         )
805.         self.assertQuerySetEqual(
806.             books,
807.             [
808.                 "The Definitive Guide to Django: Web Development Done Right",
809.                 "Artificial Intelligence: A Modern Approach",
810.             ],
811.             lambda b: b.name,
812.         )
813. 
814.         authors = (
815.             Author.objects.annotate(num_friends=Count("friends__id", distinct=True))
816.             .filter(num_friends=0)
817.             .order_by("pk")
818.         )
819.         self.assertQuerySetEqual(authors, ["Brad Dayley"], lambda a: a.name)
820. 
821.         publishers = (
822.             Publisher.objects.annotate(num_books=Count("book__id"))
823.             .filter(num_books__gt=1)
824.             .order_by("pk")
825.         )
826.         self.assertQuerySetEqual(
827.             publishers, ["Apress", "Prentice Hall"], lambda p: p.name
828.         )
829. 
830.         publishers = (
831.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
832.             .annotate(num_books=Count("book__id"))
833.             .filter(num_books__gt=1)
834.         )
835.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
836. 
837.         books = Book.objects.annotate(num_authors=Count("authors__id")).filter(
838.             authors__name__contains="Norvig", num_authors__gt=1
839.         )
840.         self.assertQuerySetEqual(
841.             books, ["Artificial Intelligence: A Modern Approach"], lambda b: b.name
842.         )
843. 
844.     def test_more_aggregation(self):
845.         a = Author.objects.get(name__contains="Norvig")
846.         b = Book.objects.get(name__contains="Done Right")
847.         b.authors.add(a)
848.         b.save()
849. 
850.         vals = (
851.             Book.objects.annotate(num_authors=Count("authors__id"))
852.             .filter(authors__name__contains="Norvig", num_authors__gt=1)
853.             .aggregate(Avg("rating"))
854.         )
855.         self.assertEqual(vals, {"rating__avg": 4.25})
856. 
857.     def test_even_more_aggregate(self):
858.         publishers = (
859.             Publisher.objects.annotate(
860.                 earliest_book=Min("book__pubdate"),
861.             )
862.             .exclude(earliest_book=None)
863.             .order_by("earliest_book")
864.             .values(
865.                 "earliest_book",
866.                 "num_awards",
867.                 "id",
868.                 "name",
869.             )
870.         )
871.         self.assertEqual(
872.             list(publishers),
873.             [
874.                 {
875.                     "earliest_book": datetime.date(1991, 10, 15),
876.                     "num_awards": 9,
877.                     "id": self.p4.id,
878.                     "name": "Morgan Kaufmann",
879.                 },
880.                 {
881.                     "earliest_book": datetime.date(1995, 1, 15),
882.                     "num_awards": 7,
883.                     "id": self.p3.id,
884.                     "name": "Prentice Hall",
885.                 },
886.                 {
887.                     "earliest_book": datetime.date(2007, 12, 6),
888.                     "num_awards": 3,
889.                     "id": self.p1.id,
890.                     "name": "Apress",
891.                 },
892.                 {
893.                     "earliest_book": datetime.date(2008, 3, 3),
894.                     "num_awards": 1,
895.                     "id": self.p2.id,
896.                     "name": "Sams",
897.                 },
898.             ],
899.         )
900. 
901.         vals = Store.objects.aggregate(
902.             Max("friday_night_closing"), Min("original_opening")
903.         )
904.         self.assertEqual(
905.             vals,
906.             {
907.                 "friday_night_closing__max": datetime.time(23, 59, 59),
908.                 "original_opening__min": datetime.datetime(1945, 4, 25, 16, 24, 14),
909.             },
910.         )
911. 
912.     def test_annotate_values_list(self):
913.         books = (
914.             Book.objects.filter(pk=self.b1.pk)
915.             .annotate(mean_age=Avg("authors__age"))
916.             .values_list("pk", "isbn", "mean_age")
917.         )
918.         self.assertEqual(list(books), [(self.b1.id, "159059725", 34.5)])
919. 
920.         books = (
921.             Book.objects.filter(pk=self.b1.pk)
922.             .annotate(mean_age=Avg("authors__age"))
923.             .values_list("isbn")
924.         )
925.         self.assertEqual(list(books), [("159059725",)])
926. 
927.         books = (
928.             Book.objects.filter(pk=self.b1.pk)
929.             .annotate(mean_age=Avg("authors__age"))
930.             .values_list("mean_age")
931.         )
932.         self.assertEqual(list(books), [(34.5,)])
933. 
934.         books = (
935.             Book.objects.filter(pk=self.b1.pk)
936.             .annotate(mean_age=Avg("authors__age"))
937.             .values_list("mean_age", flat=True)
938.         )
939.         self.assertEqual(list(books), [34.5])
940. 
941.         books = (
942.             Book.objects.values_list("price")
943.             .annotate(count=Count("price"))
944.             .order_by("-count", "price")
945.         )
946.         self.assertEqual(
947.             list(books),
948.             [
949.                 (Decimal("29.69"), 2),
950.                 (Decimal("23.09"), 1),
951.                 (Decimal("30"), 1),
952.                 (Decimal("75"), 1),
953.                 (Decimal("82.8"), 1),
954.             ],
955.         )
956. 
957.     def test_dates_with_aggregation(self):
958.         """
959.         .dates() returns a distinct set of dates when applied to a
960.         QuerySet with aggregation.
961. 
962.         Refs #18056. Previously, .dates() would return distinct (date_kind,
963.         aggregation) sets, in this case (year, num_authors), so 2008 would be
964.         returned twice because there are books from 2008 with a different
965.         number of authors.
966.         """
967.         dates = Book.objects.annotate(num_authors=Count("authors")).dates(
968.             "pubdate", "year"
969.         )
970.         self.assertSequenceEqual(
971.             dates,
972.             [
973.                 datetime.date(1991, 1, 1),
974.                 datetime.date(1995, 1, 1),
975.                 datetime.date(2007, 1, 1),
976.                 datetime.date(2008, 1, 1),
977.             ],
978.         )
979. 
980.     def test_values_aggregation(self):
981.         # Refs #20782
982.         max_rating = Book.objects.values("rating").aggregate(max_rating=Max("rating"))
983.         self.assertEqual(max_rating["max_rating"], 5)
984.         max_books_per_rating = (
985.             Book.objects.values("rating")
986.             .annotate(books_per_rating=Count("id"))
987.             .aggregate(Max("books_per_rating"))
988.         )
989.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3})
990. 
991.     def test_ticket17424(self):
992.         """
993.         Doing exclude() on a foreign model after annotate() doesn't crash.
994.         """
995.         all_books = list(Book.objects.values_list("pk", flat=True).order_by("pk"))
996.         annotated_books = Book.objects.order_by("pk").annotate(one=Count("id"))
997. 
998.         # The value doesn't matter, we just need any negative
999.         # constraint on a related model that's a noop.
1000.         excluded_books = annotated_books.exclude(publisher__name="__UNLIKELY_VALUE__")
1001. 
1002.         # Try to generate query tree
1003.         str(excluded_books.query)
1004. 
1005.         self.assertQuerySetEqual(excluded_books, all_books, lambda x: x.pk)
1006. 
1007.         # Check internal state
1008.         self.assertIsNone(annotated_books.query.alias_map["aggregation_book"].join_type)
1009.         self.assertIsNone(excluded_books.query.alias_map["aggregation_book"].join_type)
1010. 
1011.     def test_ticket12886(self):
1012.         """
1013.         Aggregation over sliced queryset works correctly.
1014.         """
1015.         qs = Book.objects.order_by("-rating")[0:3]
1016.         vals = qs.aggregate(average_top3_rating=Avg("rating"))["average_top3_rating"]
1017.         self.assertAlmostEqual(vals, 4.5, places=2)
1018. 
1019.     def test_ticket11881(self):
1020.         """
1021.         Subqueries do not needlessly contain ORDER BY, SELECT FOR UPDATE or
1022.         select_related() stuff.
1023.         """
1024.         qs = (
1025.             Book.objects.select_for_update()
1026.             .order_by("pk")
1027.             .select_related("publisher")
1028.             .annotate(max_pk=Max("pk"))
1029.         )
1030.         with CaptureQueriesContext(connection) as captured_queries:
1031.             qs.aggregate(avg_pk=Avg("max_pk"))
1032.             self.assertEqual(len(captured_queries), 1)
1033.             qstr = captured_queries[0]["sql"].lower()
1034.             self.assertNotIn("for update", qstr)
1035.             forced_ordering = connection.ops.force_no_ordering()
1036.             if forced_ordering:
1037.                 # If the backend needs to force an ordering we make sure it's
1038.                 # the only "ORDER BY" clause present in the query.
1039.                 self.assertEqual(
1040.                     re.findall(r"order by (\w+)", qstr),
1041.                     [", ".join(f[1][0] for f in forced_ordering).lower()],
1042.                 )
1043.             else:
1044.                 self.assertNotIn("order by", qstr)
1045.             self.assertEqual(qstr.count(" join "), 0)
1046. 
1047.     def test_decimal_max_digits_has_no_effect(self):
1048.         Book.objects.all().delete()
1049.         a1 = Author.objects.first()
1050.         p1 = Publisher.objects.first()
1051.         thedate = timezone.now()
1052.         for i in range(10):
1053.             Book.objects.create(
1054.                 isbn="abcde{}".format(i),
1055.                 name="none",
1056.                 pages=10,
1057.                 rating=4.0,
1058.                 price=9999.98,
1059.                 contact=a1,
1060.                 publisher=p1,
1061.                 pubdate=thedate,
1062.             )
1063. 
1064.         book = Book.objects.aggregate(price_sum=Sum("price"))
1065.         self.assertEqual(book["price_sum"], Decimal("99999.80"))
1066. 
1067.     def test_nonaggregate_aggregation_throws(self):
1068.         with self.assertRaisesMessage(TypeError, "fail is not an aggregate expression"):
1069.             Book.objects.aggregate(fail=F("price"))
1070. 
1071.     def test_nonfield_annotation(self):
1072.         book = Book.objects.annotate(val=Max(Value(2))).first()
1073.         self.assertEqual(book.val, 2)
1074.         book = Book.objects.annotate(
1075.             val=Max(Value(2), output_field=IntegerField())
1076.         ).first()
1077.         self.assertEqual(book.val, 2)
1078.         book = Book.objects.annotate(val=Max(2, output_field=IntegerField())).first()
1079.         self.assertEqual(book.val, 2)
1080. 
1081.     def test_annotation_expressions(self):
1082.         authors = Author.objects.annotate(
1083.             combined_ages=Sum(F("age") + F("friends__age"))
1084.         ).order_by("name")
1085.         authors2 = Author.objects.annotate(
1086.             combined_ages=Sum("age") + Sum("friends__age")
1087.         ).order_by("name")
1088.         for qs in (authors, authors2):
1089.             self.assertQuerySetEqual(
1090.                 qs,
1091.                 [
1092.                     ("Adrian Holovaty", 132),
1093.                     ("Brad Dayley", None),
1094.                     ("Jacob Kaplan-Moss", 129),
1095.                     ("James Bennett", 63),
1096.                     ("Jeffrey Forcier", 128),
1097.                     ("Paul Bissex", 120),
1098.                     ("Peter Norvig", 103),
1099.                     ("Stuart Russell", 103),
1100.                     ("Wesley J. Chun", 176),
1101.                 ],
1102.                 lambda a: (a.name, a.combined_ages),
1103.             )
1104. 
1105.     def test_aggregation_expressions(self):
1106.         a1 = Author.objects.aggregate(av_age=Sum("age") / Count("*"))
1107.         a2 = Author.objects.aggregate(av_age=Sum("age") / Count("age"))
1108.         a3 = Author.objects.aggregate(av_age=Avg("age"))
1109.         self.assertEqual(a1, {"av_age": 37})
1110.         self.assertEqual(a2, {"av_age": 37})
1111.         self.assertEqual(a3, {"av_age": Approximate(37.4, places=1)})
1112. 
1113.     def test_avg_decimal_field(self):
1114.         v = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price")))[
1115.             "avg_price"
1116.         ]
1117.         self.assertIsInstance(v, Decimal)
1118.         self.assertEqual(v, Approximate(Decimal("47.39"), places=2))
1119. 
1120.     def test_order_of_precedence(self):
1121.         p1 = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price") + 2) * 3)
1122.         self.assertEqual(p1, {"avg_price": Approximate(Decimal("148.18"), places=2)})
1123. 
1124.         p2 = Book.objects.filter(rating=4).aggregate(avg_price=Avg("price") + 2 * 3)
1125.         self.assertEqual(p2, {"avg_price": Approximate(Decimal("53.39"), places=2)})
1126. 
1127.     def test_combine_different_types(self):
1128.         msg = (
1129.             "Cannot infer type of '+' expression involving these types: FloatField, "
1130.             "DecimalField. You must set output_field."
1131.         )
1132.         qs = Book.objects.annotate(sums=Sum("rating") + Sum("pages") + Sum("price"))
1133.         with self.assertRaisesMessage(FieldError, msg):
1134.             qs.first()
1135.         with self.assertRaisesMessage(FieldError, msg):
1136.             qs.first()
1137. 
1138.         b1 = Book.objects.annotate(
1139.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=IntegerField())
1140.         ).get(pk=self.b4.pk)
1141.         self.assertEqual(b1.sums, 383)
1142. 
1143.         b2 = Book.objects.annotate(
1144.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=FloatField())
1145.         ).get(pk=self.b4.pk)
1146.         self.assertEqual(b2.sums, 383.69)
1147. 
1148.         b3 = Book.objects.annotate(
1149.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=DecimalField())
1150.         ).get(pk=self.b4.pk)
1151.         self.assertEqual(b3.sums, Approximate(Decimal("383.69"), places=2))
1152. 
1153.     def test_complex_aggregations_require_kwarg(self):
1154.         with self.assertRaisesMessage(
1155.             TypeError, "Complex annotations require an alias"
1156.         ):
1157.             Author.objects.annotate(Sum(F("age") + F("friends__age")))
1158.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1159.             Author.objects.aggregate(Sum("age") / Count("age"))
1160.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1161.             Author.objects.aggregate(Sum(1))
1162. 
1163.     def test_aggregate_over_complex_annotation(self):
1164.         qs = Author.objects.annotate(combined_ages=Sum(F("age") + F("friends__age")))
1165. 
1166.         age = qs.aggregate(max_combined_age=Max("combined_ages"))
1167.         self.assertEqual(age["max_combined_age"], 176)
1168. 
1169.         age = qs.aggregate(max_combined_age_doubled=Max("combined_ages") * 2)
1170.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1171. 
1172.         age = qs.aggregate(
1173.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages")
1174.         )
1175.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1176. 
1177.         age = qs.aggregate(
1178.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1179.             sum_combined_age=Sum("combined_ages"),
1180.         )
1181.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1182.         self.assertEqual(age["sum_combined_age"], 954)
1183. 
1184.         age = qs.aggregate(
1185.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1186.             sum_combined_age_doubled=Sum("combined_ages") + Sum("combined_ages"),
1187.         )
1188.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1189.         self.assertEqual(age["sum_combined_age_doubled"], 954 * 2)
1190. 
1191.     def test_values_annotation_with_expression(self):
1192.         # ensure the F() is promoted to the group by clause
1193.         qs = Author.objects.values("name").annotate(another_age=Sum("age") + F("age"))
1194.         a = qs.get(name="Adrian Holovaty")
1195.         self.assertEqual(a["another_age"], 68)
1196. 
1197.         qs = qs.annotate(friend_count=Count("friends"))
1198.         a = qs.get(name="Adrian Holovaty")
1199.         self.assertEqual(a["friend_count"], 2)
1200. 
1201.         qs = (
1202.             qs.annotate(combined_age=Sum("age") + F("friends__age"))
1203.             .filter(name="Adrian Holovaty")
1204.             .order_by("-combined_age")
1205.         )
1206.         self.assertEqual(
1207.             list(qs),
1208.             [
1209.                 {
1210.                     "name": "Adrian Holovaty",
1211.                     "another_age": 68,
1212.                     "friend_count": 1,
1213.                     "combined_age": 69,
1214.                 },
1215.                 {
1216.                     "name": "Adrian Holovaty",
1217.                     "another_age": 68,
1218.                     "friend_count": 1,
1219.                     "combined_age": 63,
1220.                 },
1221.             ],
1222.         )
1223. 
1224.         vals = qs.values("name", "combined_age")
1225.         self.assertEqual(
1226.             list(vals),
1227.             [
1228.                 {"name": "Adrian Holovaty", "combined_age": 69},
1229.                 {"name": "Adrian Holovaty", "combined_age": 63},
1230.             ],
1231.         )
1232. 
1233.     def test_annotate_values_aggregate(self):
1234.         alias_age = (
1235.             Author.objects.annotate(age_alias=F("age"))
1236.             .values(
1237.                 "age_alias",
1238.             )
1239.             .aggregate(sum_age=Sum("age_alias"))
1240.         )
1241. 
1242.         age = Author.objects.values("age").aggregate(sum_age=Sum("age"))
1243. 
1244.         self.assertEqual(alias_age["sum_age"], age["sum_age"])
1245. 
1246.     def test_annotate_over_annotate(self):
1247.         author = (
1248.             Author.objects.annotate(age_alias=F("age"))
1249.             .annotate(sum_age=Sum("age_alias"))
1250.             .get(name="Adrian Holovaty")
1251.         )
1252. 
1253.         other_author = Author.objects.annotate(sum_age=Sum("age")).get(
1254.             name="Adrian Holovaty"
1255.         )
1256. 
1257.         self.assertEqual(author.sum_age, other_author.sum_age)
1258. 
1259.     def test_aggregate_over_aggregate(self):
1260.         msg = "Cannot compute Avg('age'): 'age' is an aggregate"
1261.         with self.assertRaisesMessage(FieldError, msg):
1262.             Author.objects.annotate(age_alias=F("age"),).aggregate(
1263.                 age=Sum(F("age")),
1264.                 avg_age=Avg(F("age")),
1265.             )
1266. 
1267.     def test_annotated_aggregate_over_annotated_aggregate(self):
1268.         with self.assertRaisesMessage(
1269.             FieldError, "Cannot compute Sum('id__max'): 'id__max' is an aggregate"
1270.         ):
1271.             Book.objects.annotate(Max("id")).annotate(Sum("id__max"))
1272. 
1273.         class MyMax(Max):
1274.             def as_sql(self, compiler, connection):
1275.                 self.set_source_expressions(self.get_source_expressions()[0:1])
1276.                 return super().as_sql(compiler, connection)
1277. 
1278.         with self.assertRaisesMessage(
1279.             FieldError, "Cannot compute Max('id__max'): 'id__max' is an aggregate"
1280.         ):
1281.             Book.objects.annotate(Max("id")).annotate(my_max=MyMax("id__max", "price"))
1282. 
1283.     def test_multi_arg_aggregate(self):
1284.         class MyMax(Max):
1285.             output_field = DecimalField()
1286. 
1287.             def as_sql(self, compiler, connection):
1288.                 copy = self.copy()
1289.                 copy.set_source_expressions(copy.get_source_expressions()[0:1])
1290.                 return super(MyMax, copy).as_sql(compiler, connection)
1291. 
1292.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1293.             Book.objects.aggregate(MyMax("pages", "price"))
1294. 
1295.         with self.assertRaisesMessage(
1296.             TypeError, "Complex annotations require an alias"
1297.         ):
1298.             Book.objects.annotate(MyMax("pages", "price"))
1299. 
1300.         Book.objects.aggregate(max_field=MyMax("pages", "price"))
1301. 
1302.     def test_add_implementation(self):
1303.         class MySum(Sum):
1304.             pass
1305. 
1306.         # test completely changing how the output is rendered
1307.         def lower_case_function_override(self, compiler, connection):
1308.             sql, params = compiler.compile(self.source_expressions[0])
1309.             substitutions = {
1310.                 "function": self.function.lower(),
1311.                 "expressions": sql,
1312.                 "distinct": "",
1313.             }
1314.             substitutions.update(self.extra)
1315.             return self.template % substitutions, params
1316. 
1317.         setattr(MySum, "as_" + connection.vendor, lower_case_function_override)
1318. 
1319.         qs = Book.objects.annotate(
1320.             sums=MySum(
1321.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1322.             )
1323.         )
1324.         self.assertEqual(str(qs.query).count("sum("), 1)
1325.         b1 = qs.get(pk=self.b4.pk)
1326.         self.assertEqual(b1.sums, 383)
1327. 
1328.         # test changing the dict and delegating
1329.         def lower_case_function_super(self, compiler, connection):
1330.             self.extra["function"] = self.function.lower()
1331.             return super(MySum, self).as_sql(compiler, connection)
1332. 
1333.         setattr(MySum, "as_" + connection.vendor, lower_case_function_super)
1334. 
1335.         qs = Book.objects.annotate(
1336.             sums=MySum(
1337.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1338.             )
1339.         )
1340.         self.assertEqual(str(qs.query).count("sum("), 1)
1341.         b1 = qs.get(pk=self.b4.pk)
1342.         self.assertEqual(b1.sums, 383)
1343. 
1344.         # test overriding all parts of the template
1345.         def be_evil(self, compiler, connection):
1346.             substitutions = {"function": "MAX", "expressions": "2", "distinct": ""}
1347.             substitutions.update(self.extra)
1348.             return self.template % substitutions, ()
1349. 
1350.         setattr(MySum, "as_" + connection.vendor, be_evil)
1351. 
1352.         qs = Book.objects.annotate(
1353.             sums=MySum(
1354.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1355.             )
1356.         )
1357.         self.assertEqual(str(qs.query).count("MAX("), 1)
1358.         b1 = qs.get(pk=self.b4.pk)
1359.         self.assertEqual(b1.sums, 2)
1360. 
1361.     def test_complex_values_aggregation(self):
1362.         max_rating = Book.objects.values("rating").aggregate(
1363.             double_max_rating=Max("rating") + Max("rating")
1364.         )
1365.         self.assertEqual(max_rating["double_max_rating"], 5 * 2)
1366. 
1367.         max_books_per_rating = (
1368.             Book.objects.values("rating")
1369.             .annotate(books_per_rating=Count("id") + 5)
1370.             .aggregate(Max("books_per_rating"))
1371.         )
1372.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3 + 5})
1373. 
1374.     def test_expression_on_aggregation(self):
1375.         qs = (
1376.             Publisher.objects.annotate(
1377.                 price_or_median=Greatest(
1378.                     Avg("book__rating", output_field=DecimalField()), Avg("book__price")
1379.                 )
1380.             )
1381.             .filter(price_or_median__gte=F("num_awards"))
1382.             .order_by("num_awards")
1383.         )
1384.         self.assertQuerySetEqual(qs, [1, 3, 7, 9], lambda v: v.num_awards)
1385. 
1386.         qs2 = (
1387.             Publisher.objects.annotate(
1388.                 rating_or_num_awards=Greatest(
1389.                     Avg("book__rating"), F("num_awards"), output_field=FloatField()
1390.                 )
1391.             )
1392.             .filter(rating_or_num_awards__gt=F("num_awards"))
1393.             .order_by("num_awards")
1394.         )
1395.         self.assertQuerySetEqual(qs2, [1, 3], lambda v: v.num_awards)
1396. 
1397.     def test_arguments_must_be_expressions(self):
1398.         msg = "QuerySet.aggregate() received non-expression(s): %s."
1399.         with self.assertRaisesMessage(TypeError, msg % FloatField()):
1400.             Book.objects.aggregate(FloatField())
1401.         with self.assertRaisesMessage(TypeError, msg % True):
1402.             Book.objects.aggregate(is_book=True)
1403.         with self.assertRaisesMessage(
1404.             TypeError, msg % ", ".join([str(FloatField()), "True"])
1405.         ):
1406.             Book.objects.aggregate(FloatField(), Avg("price"), is_book=True)
1407. 
1408.     def test_aggregation_subquery_annotation(self):
1409.         """Subquery annotations are excluded from the GROUP BY if they are
1410.         not explicitly grouped against."""
1411.         latest_book_pubdate_qs = (
1412.             Book.objects.filter(publisher=OuterRef("pk"))
1413.             .order_by("-pubdate")
1414.             .values("pubdate")[:1]
1415.         )
1416.         publisher_qs = Publisher.objects.annotate(
1417.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1418.         ).annotate(count=Count("book"))
1419.         with self.assertNumQueries(1) as ctx:
1420.             list(publisher_qs)
1421.         self.assertEqual(ctx[0]["sql"].count("SELECT"), 2)
1422.         # The GROUP BY should not be by alias either.
1423.         self.assertEqual(ctx[0]["sql"].lower().count("latest_book_pubdate"), 1)
1424. 
1425.     def test_aggregation_subquery_annotation_exists(self):
1426.         latest_book_pubdate_qs = (
1427.             Book.objects.filter(publisher=OuterRef("pk"))
1428.             .order_by("-pubdate")
1429.             .values("pubdate")[:1]
1430.         )
1431.         publisher_qs = Publisher.objects.annotate(
1432.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1433.             count=Count("book"),
1434.         )
1435.         self.assertTrue(publisher_qs.exists())
1436. 
1437.     def test_aggregation_filter_exists(self):
1438.         publishers_having_more_than_one_book_qs = (
1439.             Book.objects.values("publisher")
1440.             .annotate(cnt=Count("isbn"))
1441.             .filter(cnt__gt=1)
1442.         )
1443.         query = publishers_having_more_than_one_book_qs.query.exists()
1444.         _, _, group_by = query.get_compiler(connection=connection).pre_sql_setup()
1445.         self.assertEqual(len(group_by), 1)
1446. 
1447.     def test_aggregation_exists_annotation(self):
1448.         published_books = Book.objects.filter(publisher=OuterRef("pk"))
1449.         publisher_qs = Publisher.objects.annotate(
1450.             published_book=Exists(published_books),
1451.             count=Count("book"),
1452.         ).values_list("name", flat=True)
1453.         self.assertCountEqual(
1454.             list(publisher_qs),
1455.             [
1456.                 "Apress",
1457.                 "Morgan Kaufmann",
1458.                 "Jonno's House of Books",
1459.                 "Prentice Hall",
1460.                 "Sams",
1461.             ],
1462.         )
1463. 
1464.     def test_aggregation_subquery_annotation_values(self):
1465.         """
1466.         Subquery annotations and external aliases are excluded from the GROUP
1467.         BY if they are not selected.
1468.         """
1469.         books_qs = (
1470.             Book.objects.annotate(
1471.                 first_author_the_same_age=Subquery(
1472.                     Author.objects.filter(
1473.                         age=OuterRef("contact__friends__age"),
1474.                     )
1475.                     .order_by("age")
1476.                     .values("id")[:1],
1477.                 )
1478.             )
1479.             .filter(
1480.                 publisher=self.p1,
1481.                 first_author_the_same_age__isnull=False,
1482.             )
1483.             .annotate(
1484.                 min_age=Min("contact__friends__age"),
1485.             )
1486.             .values("name", "min_age")
1487.             .order_by("name")
1488.         )
1489.         self.assertEqual(
1490.             list(books_qs),
1491.             [
1492.                 {"name": "Practical Django Projects", "min_age": 34},
1493.                 {
1494.                     "name": (
1495.                         "The Definitive Guide to Django: Web Development Done Right"
1496.                     ),
1497.                     "min_age": 29,
1498.                 },
1499.             ],
1500.         )
1501. 
1502.     def test_aggregation_subquery_annotation_values_collision(self):
1503.         books_rating_qs = Book.objects.filter(
1504.             publisher=OuterRef("pk"),
1505.             price=Decimal("29.69"),
1506.         ).values("rating")
1507.         publisher_qs = (
1508.             Publisher.objects.filter(
1509.                 book__contact__age__gt=20,
1510.                 name=self.p1.name,
1511.             )
1512.             .annotate(
1513.                 rating=Subquery(books_rating_qs),
1514.                 contacts_count=Count("book__contact"),
1515.             )
1516.             .values("rating")
1517.             .annotate(total_count=Count("rating"))
1518.         )
1519.         self.assertEqual(
1520.             list(publisher_qs),
1521.             [
1522.                 {"rating": 4.0, "total_count": 2},
1523.             ],
1524.         )
1525. 
1526.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1527.     def test_aggregation_subquery_annotation_multivalued(self):
1528.         """
1529.         Subquery annotations must be included in the GROUP BY if they use
1530.         potentially multivalued relations (contain the LOOKUP_SEP).
1531.         """
1532.         subquery_qs = Author.objects.filter(
1533.             pk=OuterRef("pk"),
1534.             book__name=OuterRef("book__name"),
1535.         ).values("pk")
1536.         author_qs = Author.objects.annotate(
1537.             subquery_id=Subquery(subquery_qs),
1538.         ).annotate(count=Count("book"))
1539.         self.assertEqual(author_qs.count(), Author.objects.count())
1540. 
1541.     def test_aggregation_order_by_not_selected_annotation_values(self):
1542.         result_asc = [
1543.             self.b4.pk,
1544.             self.b3.pk,
1545.             self.b1.pk,
1546.             self.b2.pk,
1547.             self.b5.pk,
1548.             self.b6.pk,
1549.         ]
1550.         result_desc = result_asc[::-1]
1551.         tests = [
1552.             ("min_related_age", result_asc),
1553.             ("-min_related_age", result_desc),
1554.             (F("min_related_age"), result_asc),
1555.             (F("min_related_age").asc(), result_asc),
1556.             (F("min_related_age").desc(), result_desc),
1557.         ]
1558.         for ordering, expected_result in tests:
1559.             with self.subTest(ordering=ordering):
1560.                 books_qs = (
1561.                     Book.objects.annotate(
1562.                         min_age=Min("authors__age"),
1563.                     )
1564.                     .annotate(
1565.                         min_related_age=Coalesce("min_age", "contact__age"),
1566.                     )
1567.                     .order_by(ordering)
1568.                     .values_list("pk", flat=True)
1569.                 )
1570.                 self.assertEqual(list(books_qs), expected_result)
1571. 
1572.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1573.     def test_group_by_subquery_annotation(self):
1574.         """
1575.         Subquery annotations are included in the GROUP BY if they are
1576.         grouped against.
1577.         """
1578.         long_books_count_qs = (
1579.             Book.objects.filter(
1580.                 publisher=OuterRef("pk"),
1581.                 pages__gt=400,
1582.             )
1583.             .values("publisher")
1584.             .annotate(count=Count("pk"))
1585.             .values("count")
1586.         )
1587.         groups = [
1588.             Subquery(long_books_count_qs),
1589.             long_books_count_qs,
1590.             long_books_count_qs.query,
1591.         ]
1592.         for group in groups:
1593.             with self.subTest(group=group.__class__.__name__):
1594.                 long_books_count_breakdown = Publisher.objects.values_list(
1595.                     group,
1596.                 ).annotate(total=Count("*"))
1597.                 self.assertEqual(dict(long_books_count_breakdown), {None: 1, 1: 4})
1598. 
1599.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1600.     def test_group_by_exists_annotation(self):
1601.         """
1602.         Exists annotations are included in the GROUP BY if they are
1603.         grouped against.
1604.         """
1605.         long_books_qs = Book.objects.filter(
1606.             publisher=OuterRef("pk"),
1607.             pages__gt=800,
1608.         )
1609.         has_long_books_breakdown = Publisher.objects.values_list(
1610.             Exists(long_books_qs),
1611.         ).annotate(total=Count("*"))
1612.         self.assertEqual(dict(has_long_books_breakdown), {True: 2, False: 3})
1613. 
1614.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1615.     def test_aggregation_subquery_annotation_related_field(self):
1616.         publisher = Publisher.objects.create(name=self.a9.name, num_awards=2)
1617.         book = Book.objects.create(
1618.             isbn="159059999",
1619.             name="Test book.",
1620.             pages=819,
1621.             rating=2.5,
1622.             price=Decimal("14.44"),
1623.             contact=self.a9,
1624.             publisher=publisher,
1625.             pubdate=datetime.date(2019, 12, 6),
1626.         )
1627.         book.authors.add(self.a5, self.a6, self.a7)
1628.         books_qs = (
1629.             Book.objects.annotate(
1630.                 contact_publisher=Subquery(
1631.                     Publisher.objects.filter(
1632.                         pk=OuterRef("publisher"),
1633.                         name=OuterRef("contact__name"),
1634.                     ).values("name")[:1],
1635.                 )
1636.             )
1637.             .filter(
1638.                 contact_publisher__isnull=False,
1639.             )
1640.             .annotate(count=Count("authors"))
1641.         )
1642.         with self.assertNumQueries(1) as ctx:
1643.             self.assertSequenceEqual(books_qs, [book])
1644.         # Outerquery SELECT, annotation SELECT, and WHERE SELECT but GROUP BY
1645.         # selected alias, if allowed.
1646.         if connection.features.allows_group_by_refs:
1647.             self.assertEqual(ctx[0]["sql"].count("SELECT"), 3)
1648. 
1649.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1650.     def test_aggregation_nested_subquery_outerref(self):
1651.         publisher_with_same_name = Publisher.objects.filter(
1652.             id__in=Subquery(
1653.                 Publisher.objects.filter(
1654.                     name=OuterRef(OuterRef("publisher__name")),
1655.                 ).values("id"),
1656.             ),
1657.         ).values(publisher_count=Count("id"))[:1]
1658.         books_breakdown = Book.objects.annotate(
1659.             publisher_count=Subquery(publisher_with_same_name),
1660.             authors_count=Count("authors"),
1661.         ).values_list("publisher_count", flat=True)
1662.         self.assertSequenceEqual(books_breakdown, [1] * 6)
1663. 
1664.     def test_aggregation_exists_multivalued_outeref(self):
1665.         self.assertCountEqual(
1666.             Publisher.objects.annotate(
1667.                 books_exists=Exists(
1668.                     Book.objects.filter(publisher=OuterRef("book__publisher"))
1669.                 ),
1670.                 books_count=Count("book"),
1671.             ),
1672.             Publisher.objects.all(),
1673.         )
1674. 
1675.     def test_filter_in_subquery_or_aggregation(self):
1676.         """
1677.         Filtering against an aggregate requires the usage of the HAVING clause.
1678. 
1679.         If such a filter is unionized to a non-aggregate one the latter will
1680.         also need to be moved to the HAVING clause and have its grouping
1681.         columns used in the GROUP BY.
1682. 
1683.         When this is done with a subquery the specialized logic in charge of
1684.         using outer reference columns to group should be used instead of the
1685.         subquery itself as the latter might return multiple rows.
1686.         """
1687.         authors = Author.objects.annotate(
1688.             Count("book"),
1689.         ).filter(Q(book__count__gt=0) | Q(pk__in=Book.objects.values("authors")))
1690.         self.assertCountEqual(authors, Author.objects.all())
1691. 
1692.     def test_aggregation_random_ordering(self):
1693.         """Random() is not included in the GROUP BY when used for ordering."""
1694.         authors = Author.objects.annotate(contact_count=Count("book")).order_by("?")
1695.         self.assertQuerySetEqual(
1696.             authors,
1697.             [
1698.                 ("Adrian Holovaty", 1),
1699.                 ("Jacob Kaplan-Moss", 1),
1700.                 ("Brad Dayley", 1),
1701.                 ("James Bennett", 1),
1702.                 ("Jeffrey Forcier", 1),
1703.                 ("Paul Bissex", 1),
1704.                 ("Wesley J. Chun", 1),
1705.                 ("Stuart Russell", 1),
1706.                 ("Peter Norvig", 2),
1707.             ],
1708.             lambda a: (a.name, a.contact_count),
1709.             ordered=False,
1710.         )
1711. 
1712.     def test_empty_result_optimization(self):
1713.         with self.assertNumQueries(0):
1714.             self.assertEqual(
1715.                 Publisher.objects.none().aggregate(
1716.                     sum_awards=Sum("num_awards"),
1717.                     books_count=Count("book"),
1718.                 ),
1719.                 {
1720.                     "sum_awards": None,
1721.                     "books_count": 0,
1722.                 },
1723.             )
1724.         # Expression without empty_result_set_value forces queries to be
1725.         # executed even if they would return an empty result set.
1726.         raw_books_count = Func("book", function="COUNT")
1727.         raw_books_count.contains_aggregate = True
1728.         with self.assertNumQueries(1):
1729.             self.assertEqual(
1730.                 Publisher.objects.none().aggregate(
1731.                     sum_awards=Sum("num_awards"),
1732.                     books_count=raw_books_count,
1733.                 ),
1734.                 {
1735.                     "sum_awards": None,
1736.                     "books_count": 0,
1737.                 },
1738.             )
1739. 
1740.     def test_coalesced_empty_result_set(self):
1741.         with self.assertNumQueries(0):
1742.             self.assertEqual(
1743.                 Publisher.objects.none().aggregate(
1744.                     sum_awards=Coalesce(Sum("num_awards"), 0),
1745.                 )["sum_awards"],
1746.                 0,
1747.             )
1748.         # Multiple expressions.
1749.         with self.assertNumQueries(0):
1750.             self.assertEqual(
1751.                 Publisher.objects.none().aggregate(
1752.                     sum_awards=Coalesce(Sum("num_awards"), None, 0),
1753.                 )["sum_awards"],
1754.                 0,
1755.             )
1756.         # Nested coalesce.
1757.         with self.assertNumQueries(0):
1758.             self.assertEqual(
1759.                 Publisher.objects.none().aggregate(
1760.                     sum_awards=Coalesce(Coalesce(Sum("num_awards"), None), 0),
1761.                 )["sum_awards"],
1762.                 0,
1763.             )
1764.         # Expression coalesce.
1765.         with self.assertNumQueries(1):
1766.             self.assertIsInstance(
1767.                 Store.objects.none().aggregate(
1768.                     latest_opening=Coalesce(
1769.                         Max("original_opening"),
1770.                         RawSQL("CURRENT_TIMESTAMP", []),
1771.                     ),
1772.                 )["latest_opening"],
1773.                 datetime.datetime,
1774.             )
1775. 
1776.     def test_aggregation_default_unsupported_by_count(self):
1777.         msg = "Count does not allow default."
1778.         with self.assertRaisesMessage(TypeError, msg):
1779.             Count("age", default=0)
1780. 
1781.     def test_aggregation_default_unset(self):
1782.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1783.             with self.subTest(Aggregate):
1784.                 result = Author.objects.filter(age__gt=100).aggregate(
1785.                     value=Aggregate("age"),
1786.                 )
1787.                 self.assertIsNone(result["value"])
1788. 
1789.     def test_aggregation_default_zero(self):
1790.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1791.             with self.subTest(Aggregate):
1792.                 result = Author.objects.filter(age__gt=100).aggregate(
1793.                     value=Aggregate("age", default=0),
1794.                 )
1795.                 self.assertEqual(result["value"], 0)
1796. 
1797.     def test_aggregation_default_integer(self):
1798.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1799.             with self.subTest(Aggregate):
1800.                 result = Author.objects.filter(age__gt=100).aggregate(
1801.                     value=Aggregate("age", default=21),
1802.                 )
1803.                 self.assertEqual(result["value"], 21)
1804. 
1805.     def test_aggregation_default_expression(self):
1806.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1807.             with self.subTest(Aggregate):
1808.                 result = Author.objects.filter(age__gt=100).aggregate(
1809.                     value=Aggregate("age", default=Value(5) * Value(7)),
1810.                 )
1811.                 self.assertEqual(result["value"], 35)
1812. 
1813.     def test_aggregation_default_group_by(self):
1814.         qs = (
1815.             Publisher.objects.values("name")
1816.             .annotate(
1817.                 books=Count("book"),
1818.                 pages=Sum("book__pages", default=0),
1819.             )
1820.             .filter(books=0)
1821.         )
1822.         self.assertSequenceEqual(
1823.             qs,
1824.             [{"name": "Jonno's House of Books", "books": 0, "pages": 0}],
1825.         )
1826. 
1827.     def test_aggregation_default_compound_expression(self):
1828.         # Scale rating to a percentage; default to 50% if no books published.
1829.         formula = Avg("book__rating", default=2.5) * 20.0
1830.         queryset = Publisher.objects.annotate(rating=formula).order_by("name")
1831.         self.assertSequenceEqual(
1832.             queryset.values("name", "rating"),
1833.             [
1834.                 {"name": "Apress", "rating": 85.0},
1835.                 {"name": "Jonno's House of Books", "rating": 50.0},
1836.                 {"name": "Morgan Kaufmann", "rating": 100.0},
1837.                 {"name": "Prentice Hall", "rating": 80.0},
1838.                 {"name": "Sams", "rating": 60.0},
1839.             ],
1840.         )
1841. 
1842.     def test_aggregation_default_using_time_from_python(self):
1843.         expr = Min(
1844.             "store__friday_night_closing",
1845.             filter=~Q(store__name="Amazon.com"),
1846.             default=datetime.time(17),
1847.         )
1848.         if connection.vendor == "mysql":
1849.             # Workaround for #30224 for MySQL & MariaDB.
1850.             expr.default = Cast(expr.default, TimeField())
1851.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1852.         self.assertSequenceEqual(
1853.             queryset.values("isbn", "oldest_store_opening"),
1854.             [
1855.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1856.                 {
1857.                     "isbn": "013790395",
1858.                     "oldest_store_opening": datetime.time(23, 59, 59),
1859.                 },
1860.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(17)},
1861.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1862.                 {
1863.                     "isbn": "159059725",
1864.                     "oldest_store_opening": datetime.time(23, 59, 59),
1865.                 },
1866.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1867.             ],
1868.         )
1869. 
1870.     def test_aggregation_default_using_time_from_database(self):
1871.         now = timezone.now().astimezone(datetime.timezone.utc)
1872.         expr = Min(
1873.             "store__friday_night_closing",
1874.             filter=~Q(store__name="Amazon.com"),
1875.             default=TruncHour(NowUTC(), output_field=TimeField()),
1876.         )
1877.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1878.         self.assertSequenceEqual(
1879.             queryset.values("isbn", "oldest_store_opening"),
1880.             [
1881.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1882.                 {
1883.                     "isbn": "013790395",
1884.                     "oldest_store_opening": datetime.time(23, 59, 59),
1885.                 },
1886.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(now.hour)},
1887.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1888.                 {
1889.                     "isbn": "159059725",
1890.                     "oldest_store_opening": datetime.time(23, 59, 59),
1891.                 },
1892.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1893.             ],
1894.         )
1895. 
1896.     def test_aggregation_default_using_date_from_python(self):
1897.         expr = Min("book__pubdate", default=datetime.date(1970, 1, 1))
1898.         if connection.vendor == "mysql":
1899.             # Workaround for #30224 for MySQL & MariaDB.
1900.             expr.default = Cast(expr.default, DateField())
1901.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1902.         self.assertSequenceEqual(
1903.             queryset.values("name", "earliest_pubdate"),
1904.             [
1905.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1906.                 {
1907.                     "name": "Jonno's House of Books",
1908.                     "earliest_pubdate": datetime.date(1970, 1, 1),
1909.                 },
1910.                 {
1911.                     "name": "Morgan Kaufmann",
1912.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1913.                 },
1914.                 {
1915.                     "name": "Prentice Hall",
1916.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1917.                 },
1918.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1919.             ],
1920.         )
1921. 
1922.     def test_aggregation_default_using_date_from_database(self):
1923.         now = timezone.now().astimezone(datetime.timezone.utc)
1924.         expr = Min("book__pubdate", default=TruncDate(NowUTC()))
1925.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1926.         self.assertSequenceEqual(
1927.             queryset.values("name", "earliest_pubdate"),
1928.             [
1929.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1930.                 {"name": "Jonno's House of Books", "earliest_pubdate": now.date()},
1931.                 {
1932.                     "name": "Morgan Kaufmann",
1933.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1934.                 },
1935.                 {
1936.                     "name": "Prentice Hall",
1937.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1938.                 },
1939.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1940.             ],
1941.         )
1942. 
1943.     def test_aggregation_default_using_datetime_from_python(self):
1944.         expr = Min(
1945.             "store__original_opening",
1946.             filter=~Q(store__name="Amazon.com"),
1947.             default=datetime.datetime(1970, 1, 1),
1948.         )
1949.         if connection.vendor == "mysql":
1950.             # Workaround for #30224 for MySQL & MariaDB.
1951.             expr.default = Cast(expr.default, DateTimeField())
1952.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1953.         self.assertSequenceEqual(
1954.             queryset.values("isbn", "oldest_store_opening"),
1955.             [
1956.                 {
1957.                     "isbn": "013235613",
1958.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1959.                 },
1960.                 {
1961.                     "isbn": "013790395",
1962.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1963.                 },
1964.                 {
1965.                     "isbn": "067232959",
1966.                     "oldest_store_opening": datetime.datetime(1970, 1, 1),
1967.                 },
1968.                 {
1969.                     "isbn": "155860191",
1970.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1971.                 },
1972.                 {
1973.                     "isbn": "159059725",
1974.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1975.                 },
1976.                 {
1977.                     "isbn": "159059996",
1978.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1979.                 },
1980.             ],
1981.         )
1982. 
1983.     def test_aggregation_default_using_datetime_from_database(self):
1984.         now = timezone.now().astimezone(datetime.timezone.utc)
1985.         expr = Min(
1986.             "store__original_opening",
1987.             filter=~Q(store__name="Amazon.com"),
1988.             default=TruncHour(NowUTC(), output_field=DateTimeField()),
1989.         )
1990.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1991.         self.assertSequenceEqual(
1992.             queryset.values("isbn", "oldest_store_opening"),
1993.             [
1994.                 {
1995.                     "isbn": "013235613",
1996.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1997.                 },
1998.                 {
1999.                     "isbn": "013790395",
2000.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2001.                 },
2002.                 {
2003.                     "isbn": "067232959",
2004.                     "oldest_store_opening": now.replace(
2005.                         minute=0, second=0, microsecond=0, tzinfo=None
2006.                     ),
2007.                 },
2008.                 {
2009.                     "isbn": "155860191",
2010.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2011.                 },
2012.                 {
2013.                     "isbn": "159059725",
2014.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2015.                 },
2016.                 {
2017.                     "isbn": "159059996",
2018.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2019.                 },
2020.             ],
2021.         )
2022. 
2023.     def test_aggregation_default_using_duration_from_python(self):
2024.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2025.             value=Sum("duration", default=datetime.timedelta(0)),
2026.         )
2027.         self.assertEqual(result["value"], datetime.timedelta(0))
2028. 
2029.     def test_aggregation_default_using_duration_from_database(self):
2030.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2031.             value=Sum("duration", default=Now() - Now()),
2032.         )
2033.         self.assertEqual(result["value"], datetime.timedelta(0))
2034. 
2035.     def test_aggregation_default_using_decimal_from_python(self):
2036.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2037.             value=Sum("price", default=Decimal("0.00")),
2038.         )
2039.         self.assertEqual(result["value"], Decimal("0.00"))
2040. 
2041.     def test_aggregation_default_using_decimal_from_database(self):
2042.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2043.             value=Sum("price", default=Pi()),
2044.         )
2045.         self.assertAlmostEqual(result["value"], Decimal.from_float(math.pi), places=6)
2046. 
2047.     def test_aggregation_default_passed_another_aggregate(self):
2048.         result = Book.objects.aggregate(
2049.             value=Sum("price", filter=Q(rating__lt=3.0), default=Avg("pages") / 10.0),
2050.         )
2051.         self.assertAlmostEqual(result["value"], Decimal("61.72"), places=2)
2052. 
2053.     def test_aggregation_default_after_annotation(self):
2054.         result = Publisher.objects.annotate(
2055.             double_num_awards=F("num_awards") * 2,
2056.         ).aggregate(value=Sum("double_num_awards", default=0))
2057.         self.assertEqual(result["value"], 40)
2058. 
2059.     def test_aggregation_default_not_in_aggregate(self):
2060.         result = Publisher.objects.annotate(
2061.             avg_rating=Avg("book__rating", default=2.5),
2062.         ).aggregate(Sum("num_awards"))
2063.         self.assertEqual(result["num_awards__sum"], 20)
2064. 
2065.     def test_exists_none_with_aggregate(self):
2066.         qs = Book.objects.annotate(
2067.             count=Count("id"),
2068.             exists=Exists(Author.objects.none()),
2069.         )
2070.         self.assertEqual(len(qs), 6)
2071. 
2072.     def test_alias_sql_injection(self):
2073.         crafted_alias = """injected_name" from "aggregation_author"; --"""
2074.         msg = (
2075.             "Column aliases cannot contain whitespace characters, quotation marks, "
2076.             "semicolons, or SQL comments."
2077.         )
2078.         with self.assertRaisesMessage(ValueError, msg):
2079.             Author.objects.aggregate(**{crafted_alias: Avg("age")})
2080. 
2081.     def test_exists_extra_where_with_aggregate(self):
2082.         qs = Book.objects.annotate(
2083.             count=Count("id"),
2084.             exists=Exists(Author.objects.extra(where=["1=0"])),
2085.         )
2086.         self.assertEqual(len(qs), 6)


File: tests/queries/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. import sys
4. import unittest
5. from operator import attrgetter
6. from threading import Lock
7. 
8. from django.core.exceptions import EmptyResultSet, FieldError, FullResultSet
9. from django.db import DEFAULT_DB_ALIAS, connection
10. from django.db.models import CharField, Count, Exists, F, Max, OuterRef, Q
11. from django.db.models.expressions import RawSQL
12. from django.db.models.functions import ExtractYear, Length, LTrim
13. from django.db.models.sql.constants import LOUTER
14. from django.db.models.sql.where import AND, OR, NothingNode, WhereNode
15. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
16. from django.test.utils import CaptureQueriesContext, ignore_warnings, register_lookup
17. from django.utils.deprecation import RemovedInDjango50Warning
18. 
19. from .models import (
20.     FK1,
21.     Annotation,
22.     Article,
23.     Author,
24.     BaseA,
25.     BaseUser,
26.     Book,
27.     CategoryItem,
28.     CategoryRelationship,
29.     Celebrity,
30.     Channel,
31.     Chapter,
32.     Child,
33.     ChildObjectA,
34.     Classroom,
35.     CommonMixedCaseForeignKeys,
36.     Company,
37.     Cover,
38.     CustomPk,
39.     CustomPkTag,
40.     DateTimePK,
41.     Detail,
42.     DumbCategory,
43.     Eaten,
44.     Employment,
45.     ExtraInfo,
46.     Fan,
47.     Food,
48.     Identifier,
49.     Individual,
50.     Item,
51.     Job,
52.     JobResponsibilities,
53.     Join,
54.     LeafA,
55.     LeafB,
56.     LoopX,
57.     LoopZ,
58.     ManagedModel,
59.     Member,
60.     MixedCaseDbColumnCategoryItem,
61.     MixedCaseFieldCategoryItem,
62.     ModelA,
63.     ModelB,
64.     ModelC,
65.     ModelD,
66.     MyObject,
67.     NamedCategory,
68.     Node,
69.     Note,
70.     NullableName,
71.     Number,
72.     ObjectA,
73.     ObjectB,
74.     ObjectC,
75.     OneToOneCategory,
76.     Order,
77.     OrderItem,
78.     Page,
79.     Paragraph,
80.     Person,
81.     Plaything,
82.     PointerA,
83.     Program,
84.     ProxyCategory,
85.     ProxyObjectA,
86.     ProxyObjectB,
87.     Ranking,
88.     Related,
89.     RelatedIndividual,
90.     RelatedObject,
91.     Report,
92.     ReportComment,
93.     ReservedName,
94.     Responsibility,
95.     School,
96.     SharedConnection,
97.     SimpleCategory,
98.     SingleObject,
99.     SpecialCategory,
100.     Staff,
101.     StaffUser,
102.     Student,
103.     Tag,
104.     Task,
105.     Teacher,
106.     Ticket21203Child,
107.     Ticket21203Parent,
108.     Ticket23605A,
109.     Ticket23605B,
110.     Ticket23605C,
111.     TvChef,
112.     Valid,
113.     X,
114. )
115. 
116. 
117. class Queries1Tests(TestCase):
118.     @classmethod
119.     def setUpTestData(cls):
120.         cls.nc1 = generic = NamedCategory.objects.create(name="Generic")
121.         cls.t1 = Tag.objects.create(name="t1", category=generic)
122.         cls.t2 = Tag.objects.create(name="t2", parent=cls.t1, category=generic)
123.         cls.t3 = Tag.objects.create(name="t3", parent=cls.t1)
124.         cls.t4 = Tag.objects.create(name="t4", parent=cls.t3)
125.         cls.t5 = Tag.objects.create(name="t5", parent=cls.t3)
126. 
127.         cls.n1 = Note.objects.create(note="n1", misc="foo", id=1)
128.         cls.n2 = Note.objects.create(note="n2", misc="bar", id=2)
129.         cls.n3 = Note.objects.create(note="n3", misc="foo", id=3, negate=False)
130. 
131.         cls.ann1 = Annotation.objects.create(name="a1", tag=cls.t1)
132.         cls.ann1.notes.add(cls.n1)
133.         ann2 = Annotation.objects.create(name="a2", tag=cls.t4)
134.         ann2.notes.add(cls.n2, cls.n3)
135. 
136.         # Create these out of order so that sorting by 'id' will be different to sorting
137.         # by 'info'. Helps detect some problems later.
138.         cls.e2 = ExtraInfo.objects.create(
139.             info="e2", note=cls.n2, value=41, filterable=False
140.         )
141.         e1 = ExtraInfo.objects.create(info="e1", note=cls.n1, value=42)
142. 
143.         cls.a1 = Author.objects.create(name="a1", num=1001, extra=e1)
144.         cls.a2 = Author.objects.create(name="a2", num=2002, extra=e1)
145.         cls.a3 = Author.objects.create(name="a3", num=3003, extra=cls.e2)
146.         cls.a4 = Author.objects.create(name="a4", num=4004, extra=cls.e2)
147. 
148.         cls.time1 = datetime.datetime(2007, 12, 19, 22, 25, 0)
149.         cls.time2 = datetime.datetime(2007, 12, 19, 21, 0, 0)
150.         time3 = datetime.datetime(2007, 12, 20, 22, 25, 0)
151.         time4 = datetime.datetime(2007, 12, 20, 21, 0, 0)
152.         cls.i1 = Item.objects.create(
153.             name="one",
154.             created=cls.time1,
155.             modified=cls.time1,
156.             creator=cls.a1,
157.             note=cls.n3,
158.         )
159.         cls.i1.tags.set([cls.t1, cls.t2])
160.         cls.i2 = Item.objects.create(
161.             name="two", created=cls.time2, creator=cls.a2, note=cls.n2
162.         )
163.         cls.i2.tags.set([cls.t1, cls.t3])
164.         cls.i3 = Item.objects.create(
165.             name="three", created=time3, creator=cls.a2, note=cls.n3
166.         )
167.         cls.i4 = Item.objects.create(
168.             name="four", created=time4, creator=cls.a4, note=cls.n3
169.         )
170.         cls.i4.tags.set([cls.t4])
171. 
172.         cls.r1 = Report.objects.create(name="r1", creator=cls.a1)
173.         cls.r2 = Report.objects.create(name="r2", creator=cls.a3)
174.         cls.r3 = Report.objects.create(name="r3")
175. 
176.         # Ordering by 'rank' gives us rank2, rank1, rank3. Ordering by the Meta.ordering
177.         # will be rank3, rank2, rank1.
178.         cls.rank1 = Ranking.objects.create(rank=2, author=cls.a2)
179. 
180.         cls.c1 = Cover.objects.create(title="first", item=cls.i4)
181.         cls.c2 = Cover.objects.create(title="second", item=cls.i2)
182. 
183.     def test_subquery_condition(self):
184.         qs1 = Tag.objects.filter(pk__lte=0)
185.         qs2 = Tag.objects.filter(parent__in=qs1)
186.         qs3 = Tag.objects.filter(parent__in=qs2)
187.         self.assertEqual(qs3.query.subq_aliases, {"T", "U", "V"})
188.         self.assertIn("v0", str(qs3.query).lower())
189.         qs4 = qs3.filter(parent__in=qs1)
190.         self.assertEqual(qs4.query.subq_aliases, {"T", "U", "V"})
191.         # It is possible to reuse U for the second subquery, no need to use W.
192.         self.assertNotIn("w0", str(qs4.query).lower())
193.         # So, 'U0."id"' is referenced in SELECT and WHERE twice.
194.         self.assertEqual(str(qs4.query).lower().count("u0."), 4)
195. 
196.     def test_ticket1050(self):
197.         self.assertSequenceEqual(
198.             Item.objects.filter(tags__isnull=True),
199.             [self.i3],
200.         )
201.         self.assertSequenceEqual(
202.             Item.objects.filter(tags__id__isnull=True),
203.             [self.i3],
204.         )
205. 
206.     def test_ticket1801(self):
207.         self.assertSequenceEqual(
208.             Author.objects.filter(item=self.i2),
209.             [self.a2],
210.         )
211.         self.assertSequenceEqual(
212.             Author.objects.filter(item=self.i3),
213.             [self.a2],
214.         )
215.         self.assertSequenceEqual(
216.             Author.objects.filter(item=self.i2) & Author.objects.filter(item=self.i3),
217.             [self.a2],
218.         )
219. 
220.     def test_ticket2306(self):
221.         # Checking that no join types are "left outer" joins.
222.         query = Item.objects.filter(tags=self.t2).query
223.         self.assertNotIn(LOUTER, [x.join_type for x in query.alias_map.values()])
224. 
225.         self.assertSequenceEqual(
226.             Item.objects.filter(Q(tags=self.t1)).order_by("name"),
227.             [self.i1, self.i2],
228.         )
229.         self.assertSequenceEqual(
230.             Item.objects.filter(Q(tags=self.t1)).filter(Q(tags=self.t2)),
231.             [self.i1],
232.         )
233.         self.assertSequenceEqual(
234.             Item.objects.filter(Q(tags=self.t1)).filter(
235.                 Q(creator__name="fred") | Q(tags=self.t2)
236.             ),
237.             [self.i1],
238.         )
239. 
240.         # Each filter call is processed "at once" against a single table, so this is
241.         # different from the previous example as it tries to find tags that are two
242.         # things at once (rather than two tags).
243.         self.assertSequenceEqual(
244.             Item.objects.filter(Q(tags=self.t1) & Q(tags=self.t2)), []
245.         )
246.         self.assertSequenceEqual(
247.             Item.objects.filter(
248.                 Q(tags=self.t1), Q(creator__name="fred") | Q(tags=self.t2)
249.             ),
250.             [],
251.         )
252. 
253.         qs = Author.objects.filter(ranking__rank=2, ranking__id=self.rank1.id)
254.         self.assertSequenceEqual(list(qs), [self.a2])
255.         self.assertEqual(2, qs.query.count_active_tables(), 2)
256.         qs = Author.objects.filter(ranking__rank=2).filter(ranking__id=self.rank1.id)
257.         self.assertEqual(qs.query.count_active_tables(), 3)
258. 
259.     def test_ticket4464(self):
260.         self.assertSequenceEqual(
261.             Item.objects.filter(tags=self.t1).filter(tags=self.t2),
262.             [self.i1],
263.         )
264.         self.assertSequenceEqual(
265.             Item.objects.filter(tags__in=[self.t1, self.t2])
266.             .distinct()
267.             .order_by("name"),
268.             [self.i1, self.i2],
269.         )
270.         self.assertSequenceEqual(
271.             Item.objects.filter(tags__in=[self.t1, self.t2]).filter(tags=self.t3),
272.             [self.i2],
273.         )
274. 
275.         # Make sure .distinct() works with slicing (this was broken in Oracle).
276.         self.assertSequenceEqual(
277.             Item.objects.filter(tags__in=[self.t1, self.t2]).order_by("name")[:3],
278.             [self.i1, self.i1, self.i2],
279.         )
280.         self.assertSequenceEqual(
281.             Item.objects.filter(tags__in=[self.t1, self.t2])
282.             .distinct()
283.             .order_by("name")[:3],
284.             [self.i1, self.i2],
285.         )
286. 
287.     def test_tickets_2080_3592(self):
288.         self.assertSequenceEqual(
289.             Author.objects.filter(item__name="one") | Author.objects.filter(name="a3"),
290.             [self.a1, self.a3],
291.         )
292.         self.assertSequenceEqual(
293.             Author.objects.filter(Q(item__name="one") | Q(name="a3")),
294.             [self.a1, self.a3],
295.         )
296.         self.assertSequenceEqual(
297.             Author.objects.filter(Q(name="a3") | Q(item__name="one")),
298.             [self.a1, self.a3],
299.         )
300.         self.assertSequenceEqual(
301.             Author.objects.filter(Q(item__name="three") | Q(report__name="r3")),
302.             [self.a2],
303.         )
304. 
305.     def test_ticket6074(self):
306.         # Merging two empty result sets shouldn't leave a queryset with no constraints
307.         # (which would match everything).
308.         self.assertSequenceEqual(Author.objects.filter(Q(id__in=[])), [])
309.         self.assertSequenceEqual(Author.objects.filter(Q(id__in=[]) | Q(id__in=[])), [])
310. 
311.     def test_tickets_1878_2939(self):
312.         self.assertEqual(Item.objects.values("creator").distinct().count(), 3)
313. 
314.         # Create something with a duplicate 'name' so that we can test multi-column
315.         # cases (which require some tricky SQL transformations under the covers).
316.         xx = Item(name="four", created=self.time1, creator=self.a2, note=self.n1)
317.         xx.save()
318.         self.assertEqual(
319.             Item.objects.exclude(name="two")
320.             .values("creator", "name")
321.             .distinct()
322.             .count(),
323.             4,
324.         )
325.         self.assertEqual(
326.             (
327.                 Item.objects.exclude(name="two")
328.                 .extra(select={"foo": "%s"}, select_params=(1,))
329.                 .values("creator", "name", "foo")
330.                 .distinct()
331.                 .count()
332.             ),
333.             4,
334.         )
335.         self.assertEqual(
336.             (
337.                 Item.objects.exclude(name="two")
338.                 .extra(select={"foo": "%s"}, select_params=(1,))
339.                 .values("creator", "name")
340.                 .distinct()
341.                 .count()
342.             ),
343.             4,
344.         )
345.         xx.delete()
346. 
347.     def test_ticket7323(self):
348.         self.assertEqual(Item.objects.values("creator", "name").count(), 4)
349. 
350.     def test_ticket2253(self):
351.         q1 = Item.objects.order_by("name")
352.         q2 = Item.objects.filter(id=self.i1.id)
353.         self.assertSequenceEqual(q1, [self.i4, self.i1, self.i3, self.i2])
354.         self.assertSequenceEqual(q2, [self.i1])
355.         self.assertSequenceEqual(
356.             (q1 | q2).order_by("name"),
357.             [self.i4, self.i1, self.i3, self.i2],
358.         )
359.         self.assertSequenceEqual((q1 & q2).order_by("name"), [self.i1])
360. 
361.         q1 = Item.objects.filter(tags=self.t1)
362.         q2 = Item.objects.filter(note=self.n3, tags=self.t2)
363.         q3 = Item.objects.filter(creator=self.a4)
364.         self.assertSequenceEqual(
365.             ((q1 & q2) | q3).order_by("name"),
366.             [self.i4, self.i1],
367.         )
368. 
369.     def test_order_by_tables(self):
370.         q1 = Item.objects.order_by("name")
371.         q2 = Item.objects.filter(id=self.i1.id)
372.         list(q2)
373.         combined_query = (q1 & q2).order_by("name").query
374.         self.assertEqual(
375.             len(
376.                 [
377.                     t
378.                     for t in combined_query.alias_map
379.                     if combined_query.alias_refcount[t]
380.                 ]
381.             ),
382.             1,
383.         )
384. 
385.     def test_order_by_join_unref(self):
386.         """
387.         This test is related to the above one, testing that there aren't
388.         old JOINs in the query.
389.         """
390.         qs = Celebrity.objects.order_by("greatest_fan__fan_of")
391.         self.assertIn("OUTER JOIN", str(qs.query))
392.         qs = qs.order_by("id")
393.         self.assertNotIn("OUTER JOIN", str(qs.query))
394. 
395.     def test_order_by_related_field_transform(self):
396.         extra_12 = ExtraInfo.objects.create(
397.             info="extra 12",
398.             date=DateTimePK.objects.create(date=datetime.datetime(2021, 12, 10)),
399.         )
400.         extra_11 = ExtraInfo.objects.create(
401.             info="extra 11",
402.             date=DateTimePK.objects.create(date=datetime.datetime(2022, 11, 10)),
403.         )
404.         self.assertSequenceEqual(
405.             ExtraInfo.objects.filter(date__isnull=False).order_by("date__month"),
406.             [extra_11, extra_12],
407.         )
408. 
409.     def test_filter_by_related_field_transform(self):
410.         extra_old = ExtraInfo.objects.create(
411.             info="extra 12",
412.             date=DateTimePK.objects.create(date=datetime.datetime(2020, 12, 10)),
413.         )
414.         ExtraInfo.objects.create(info="extra 11", date=DateTimePK.objects.create())
415.         a5 = Author.objects.create(name="a5", num=5005, extra=extra_old)
416. 
417.         fk_field = ExtraInfo._meta.get_field("date")
418.         with register_lookup(fk_field, ExtractYear):
419.             self.assertSequenceEqual(
420.                 ExtraInfo.objects.filter(date__year=2020),
421.                 [extra_old],
422.             )
423.             self.assertSequenceEqual(
424.                 Author.objects.filter(extra__date__year=2020), [a5]
425.             )
426. 
427.     def test_filter_by_related_field_nested_transforms(self):
428.         extra = ExtraInfo.objects.create(info=" extra")
429.         a5 = Author.objects.create(name="a5", num=5005, extra=extra)
430.         info_field = ExtraInfo._meta.get_field("info")
431.         with register_lookup(info_field, Length), register_lookup(CharField, LTrim):
432.             self.assertSequenceEqual(
433.                 Author.objects.filter(extra__info__ltrim__length=5), [a5]
434.             )
435. 
436.     def test_get_clears_ordering(self):
437.         """
438.         get() should clear ordering for optimization purposes.
439.         """
440.         with CaptureQueriesContext(connection) as captured_queries:
441.             Author.objects.order_by("name").get(pk=self.a1.pk)
442.         self.assertNotIn("order by", captured_queries[0]["sql"].lower())
443. 
444.     def test_tickets_4088_4306(self):
445.         self.assertSequenceEqual(Report.objects.filter(creator=1001), [self.r1])
446.         self.assertSequenceEqual(Report.objects.filter(creator__num=1001), [self.r1])
447.         self.assertSequenceEqual(Report.objects.filter(creator__id=1001), [])
448.         self.assertSequenceEqual(
449.             Report.objects.filter(creator__id=self.a1.id), [self.r1]
450.         )
451.         self.assertSequenceEqual(Report.objects.filter(creator__name="a1"), [self.r1])
452. 
453.     def test_ticket4510(self):
454.         self.assertSequenceEqual(
455.             Author.objects.filter(report__name="r1"),
456.             [self.a1],
457.         )
458. 
459.     def test_ticket7378(self):
460.         self.assertSequenceEqual(self.a1.report_set.all(), [self.r1])
461. 
462.     def test_tickets_5324_6704(self):
463.         self.assertSequenceEqual(
464.             Item.objects.filter(tags__name="t4"),
465.             [self.i4],
466.         )
467.         self.assertSequenceEqual(
468.             Item.objects.exclude(tags__name="t4").order_by("name").distinct(),
469.             [self.i1, self.i3, self.i2],
470.         )
471.         self.assertSequenceEqual(
472.             Item.objects.exclude(tags__name="t4").order_by("name").distinct().reverse(),
473.             [self.i2, self.i3, self.i1],
474.         )
475.         self.assertSequenceEqual(
476.             Author.objects.exclude(item__name="one").distinct().order_by("name"),
477.             [self.a2, self.a3, self.a4],
478.         )
479. 
480.         # Excluding across a m2m relation when there is more than one related
481.         # object associated was problematic.
482.         self.assertSequenceEqual(
483.             Item.objects.exclude(tags__name="t1").order_by("name"),
484.             [self.i4, self.i3],
485.         )
486.         self.assertSequenceEqual(
487.             Item.objects.exclude(tags__name="t1").exclude(tags__name="t4"),
488.             [self.i3],
489.         )
490. 
491.         # Excluding from a relation that cannot be NULL should not use outer joins.
492.         query = Item.objects.exclude(creator__in=[self.a1, self.a2]).query
493.         self.assertNotIn(LOUTER, [x.join_type for x in query.alias_map.values()])
494. 
495.         # Similarly, when one of the joins cannot possibly, ever, involve NULL
496.         # values (Author -> ExtraInfo, in the following), it should never be
497.         # promoted to a left outer join. So the following query should only
498.         # involve one "left outer" join (Author -> Item is 0-to-many).
499.         qs = Author.objects.filter(id=self.a1.id).filter(
500.             Q(extra__note=self.n1) | Q(item__note=self.n3)


File: tests/queries/tests.py
Line number range: 1972 - 1978
Content:
1972. class SelectRelatedTests(TestCase):
1973.     def test_tickets_3045_3288(self):
1974.         # Once upon a time, select_related() with circular relations would loop
1975.         # infinitely if you forgot to specify "depth". Now we set an arbitrary
1976.         # default upper bound.
1977.         self.assertSequenceEqual(X.objects.all(), [])
1978.         self.assertSequenceEqual(X.objects.select_related(), [])


File: tests/queries/tests.py
Line number range: 1981 - 1994
Content:
1981. class SubclassFKTests(TestCase):
1982.     def test_ticket7778(self):
1983.         # Model subclasses could not be deleted if a nullable foreign key
1984.         # relates to a model that relates back.
1985. 
1986.         num_celebs = Celebrity.objects.count()
1987.         tvc = TvChef.objects.create(name="Huey")
1988.         self.assertEqual(Celebrity.objects.count(), num_celebs + 1)
1989.         Fan.objects.create(fan_of=tvc)
1990.         Fan.objects.create(fan_of=tvc)
1991.         tvc.delete()
1992. 
1993.         # The parent object should have been deleted as well.
1994.         self.assertEqual(Celebrity.objects.count(), num_celebs)


File: tests/queries/tests.py
Line number range: 2066 - 2194
Content:
2066. class Queries6Tests(TestCase):
2067.     @classmethod
2068.     def setUpTestData(cls):
2069.         generic = NamedCategory.objects.create(name="Generic")
2070.         cls.t1 = Tag.objects.create(name="t1", category=generic)
2071.         cls.t2 = Tag.objects.create(name="t2", parent=cls.t1, category=generic)
2072.         cls.t3 = Tag.objects.create(name="t3", parent=cls.t1)
2073.         cls.t4 = Tag.objects.create(name="t4", parent=cls.t3)
2074.         cls.t5 = Tag.objects.create(name="t5", parent=cls.t3)
2075.         n1 = Note.objects.create(note="n1", misc="foo", id=1)
2076.         cls.ann1 = Annotation.objects.create(name="a1", tag=cls.t1)
2077.         cls.ann1.notes.add(n1)
2078.         cls.ann2 = Annotation.objects.create(name="a2", tag=cls.t4)
2079. 
2080.     def test_parallel_iterators(self):
2081.         # Parallel iterators work.
2082.         qs = Tag.objects.all()
2083.         i1, i2 = iter(qs), iter(qs)
2084.         self.assertEqual(repr(next(i1)), "<Tag: t1>")
2085.         self.assertEqual(repr(next(i1)), "<Tag: t2>")
2086.         self.assertEqual(repr(next(i2)), "<Tag: t1>")
2087.         self.assertEqual(repr(next(i2)), "<Tag: t2>")
2088.         self.assertEqual(repr(next(i2)), "<Tag: t3>")
2089.         self.assertEqual(repr(next(i1)), "<Tag: t3>")
2090. 
2091.         qs = X.objects.all()
2092.         self.assertFalse(qs)
2093.         self.assertFalse(qs)
2094. 
2095.     def test_nested_queries_sql(self):
2096.         # Nested queries should not evaluate the inner query as part of constructing the
2097.         # SQL (so we should see a nested query here, indicated by two "SELECT" calls).
2098.         qs = Annotation.objects.filter(notes__in=Note.objects.filter(note="xyzzy"))
2099.         self.assertEqual(qs.query.get_compiler(qs.db).as_sql()[0].count("SELECT"), 2)
2100. 
2101.     def test_tickets_8921_9188(self):
2102.         # Incorrect SQL was being generated for certain types of exclude()
2103.         # queries that crossed multi-valued relations (#8921, #9188 and some
2104.         # preemptively discovered cases).
2105. 
2106.         self.assertSequenceEqual(
2107.             PointerA.objects.filter(connection__pointerb__id=1), []
2108.         )
2109.         self.assertSequenceEqual(
2110.             PointerA.objects.exclude(connection__pointerb__id=1), []
2111.         )
2112. 
2113.         self.assertSequenceEqual(
2114.             Tag.objects.exclude(children=None),
2115.             [self.t1, self.t3],
2116.         )
2117. 
2118.         # This example is tricky because the parent could be NULL, so only checking
2119.         # parents with annotations omits some results (tag t1, in this case).
2120.         self.assertSequenceEqual(
2121.             Tag.objects.exclude(parent__annotation__name="a1"),
2122.             [self.t1, self.t4, self.t5],
2123.         )
2124. 
2125.         # The annotation->tag link is single values and tag->children links is
2126.         # multi-valued. So we have to split the exclude filter in the middle
2127.         # and then optimize the inner query without losing results.
2128.         self.assertSequenceEqual(
2129.             Annotation.objects.exclude(tag__children__name="t2"),
2130.             [self.ann2],
2131.         )
2132. 
2133.         # Nested queries are possible (although should be used with care, since
2134.         # they have performance problems on backends like MySQL.
2135.         self.assertSequenceEqual(
2136.             Annotation.objects.filter(notes__in=Note.objects.filter(note="n1")),
2137.             [self.ann1],
2138.         )
2139. 
2140.     def test_ticket3739(self):
2141.         # The all() method on querysets returns a copy of the queryset.
2142.         q1 = Tag.objects.order_by("name")
2143.         self.assertIsNot(q1, q1.all())
2144. 
2145.     def test_ticket_11320(self):
2146.         qs = Tag.objects.exclude(category=None).exclude(category__name="foo")
2147.         self.assertEqual(str(qs.query).count(" INNER JOIN "), 1)
2148. 
2149.     def test_distinct_ordered_sliced_subquery_aggregation(self):
2150.         self.assertEqual(
2151.             Tag.objects.distinct().order_by("category__name")[:3].count(), 3
2152.         )
2153. 
2154.     def test_multiple_columns_with_the_same_name_slice(self):
2155.         self.assertEqual(
2156.             list(
2157.                 Tag.objects.order_by("name").values_list("name", "category__name")[:2]
2158.             ),
2159.             [("t1", "Generic"), ("t2", "Generic")],
2160.         )
2161.         self.assertSequenceEqual(
2162.             Tag.objects.order_by("name").select_related("category")[:2],
2163.             [self.t1, self.t2],
2164.         )
2165.         self.assertEqual(
2166.             list(Tag.objects.order_by("-name").values_list("name", "parent__name")[:2]),
2167.             [("t5", "t3"), ("t4", "t3")],
2168.         )
2169.         self.assertSequenceEqual(
2170.             Tag.objects.order_by("-name").select_related("parent")[:2],
2171.             [self.t5, self.t4],
2172.         )
2173. 
2174.     def test_col_alias_quoted(self):
2175.         with CaptureQueriesContext(connection) as captured_queries:
2176.             self.assertEqual(
2177.                 Tag.objects.values("parent")
2178.                 .annotate(
2179.                     tag_per_parent=Count("pk"),
2180.                 )
2181.                 .aggregate(Max("tag_per_parent")),
2182.                 {"tag_per_parent__max": 2},
2183.             )
2184.         sql = captured_queries[0]["sql"]
2185.         self.assertIn("AS %s" % connection.ops.quote_name("col1"), sql)
2186. 
2187.     def test_xor_subquery(self):
2188.         self.assertSequenceEqual(
2189.             Tag.objects.filter(
2190.                 Exists(Tag.objects.filter(id=OuterRef("id"), name="t3"))
2191.                 ^ Exists(Tag.objects.filter(id=OuterRef("id"), parent=self.t1))
2192.             ),
2193.             [self.t2],
2194.         )


File: tests/queries/tests.py
Line number range: 2306 - 2340
Content:
2306. class QuerysetOrderedTests(unittest.TestCase):
2307.     """
2308.     Tests for the Queryset.ordered attribute.
2309.     """
2310. 
2311.     def test_no_default_or_explicit_ordering(self):
2312.         self.assertIs(Annotation.objects.all().ordered, False)
2313. 
2314.     def test_cleared_default_ordering(self):
2315.         self.assertIs(Tag.objects.all().ordered, True)
2316.         self.assertIs(Tag.objects.order_by().ordered, False)
2317. 
2318.     def test_explicit_ordering(self):
2319.         self.assertIs(Annotation.objects.order_by("id").ordered, True)
2320. 
2321.     def test_empty_queryset(self):
2322.         self.assertIs(Annotation.objects.none().ordered, True)
2323. 
2324.     def test_order_by_extra(self):
2325.         self.assertIs(Annotation.objects.extra(order_by=["id"]).ordered, True)
2326. 
2327.     def test_annotated_ordering(self):
2328.         qs = Annotation.objects.annotate(num_notes=Count("notes"))
2329.         self.assertIs(qs.ordered, False)
2330.         self.assertIs(qs.order_by("num_notes").ordered, True)
2331. 
2332.     def test_annotated_default_ordering(self):
2333.         qs = Tag.objects.annotate(num_notes=Count("pk"))
2334.         self.assertIs(qs.ordered, False)
2335.         self.assertIs(qs.order_by("name").ordered, True)
2336. 
2337.     def test_annotated_values_default_ordering(self):
2338.         qs = Tag.objects.values("name").annotate(num_notes=Count("pk"))
2339.         self.assertIs(qs.ordered, False)
2340.         self.assertIs(qs.order_by("name").ordered, True)


File: tests/queries/tests.py
Line number range: 2343 - 2460
Content:
2343. @skipUnlessDBFeature("allow_sliced_subqueries_with_in")
2344. class SubqueryTests(TestCase):
2345.     @classmethod
2346.     def setUpTestData(cls):
2347.         NamedCategory.objects.create(id=1, name="first")
2348.         NamedCategory.objects.create(id=2, name="second")
2349.         NamedCategory.objects.create(id=3, name="third")
2350.         NamedCategory.objects.create(id=4, name="fourth")
2351. 
2352.     def test_ordered_subselect(self):
2353.         "Subselects honor any manual ordering"
2354.         query = DumbCategory.objects.filter(
2355.             id__in=DumbCategory.objects.order_by("-id")[0:2]
2356.         )
2357.         self.assertEqual(set(query.values_list("id", flat=True)), {3, 4})
2358. 
2359.         query = DumbCategory.objects.filter(
2360.             id__in=DumbCategory.objects.order_by("-id")[:2]
2361.         )
2362.         self.assertEqual(set(query.values_list("id", flat=True)), {3, 4})
2363. 
2364.         query = DumbCategory.objects.filter(
2365.             id__in=DumbCategory.objects.order_by("-id")[1:2]
2366.         )
2367.         self.assertEqual(set(query.values_list("id", flat=True)), {3})
2368. 
2369.         query = DumbCategory.objects.filter(
2370.             id__in=DumbCategory.objects.order_by("-id")[2:]
2371.         )
2372.         self.assertEqual(set(query.values_list("id", flat=True)), {1, 2})
2373. 
2374.     def test_slice_subquery_and_query(self):
2375.         """
2376.         Slice a query that has a sliced subquery
2377.         """
2378.         query = DumbCategory.objects.filter(
2379.             id__in=DumbCategory.objects.order_by("-id")[0:2]
2380.         )[0:2]
2381.         self.assertEqual({x.id for x in query}, {3, 4})
2382. 
2383.         query = DumbCategory.objects.filter(
2384.             id__in=DumbCategory.objects.order_by("-id")[1:3]
2385.         )[1:3]
2386.         self.assertEqual({x.id for x in query}, {3})
2387. 
2388.         query = DumbCategory.objects.filter(
2389.             id__in=DumbCategory.objects.order_by("-id")[2:]
2390.         )[1:]
2391.         self.assertEqual({x.id for x in query}, {2})
2392. 
2393.     def test_related_sliced_subquery(self):
2394.         """
2395.         Related objects constraints can safely contain sliced subqueries.
2396.         refs #22434
2397.         """
2398.         generic = NamedCategory.objects.create(id=5, name="Generic")
2399.         t1 = Tag.objects.create(name="t1", category=generic)
2400.         t2 = Tag.objects.create(name="t2", category=generic)
2401.         ManagedModel.objects.create(data="mm1", tag=t1, public=True)
2402.         mm2 = ManagedModel.objects.create(data="mm2", tag=t2, public=True)
2403. 
2404.         query = ManagedModel.normal_manager.filter(
2405.             tag__in=Tag.objects.order_by("-id")[:1]
2406.         )
2407.         self.assertEqual({x.id for x in query}, {mm2.id})
2408. 
2409.     def test_sliced_delete(self):
2410.         "Delete queries can safely contain sliced subqueries"
2411.         DumbCategory.objects.filter(
2412.             id__in=DumbCategory.objects.order_by("-id")[0:1]
2413.         ).delete()
2414.         self.assertEqual(
2415.             set(DumbCategory.objects.values_list("id", flat=True)), {1, 2, 3}
2416.         )
2417. 
2418.         DumbCategory.objects.filter(
2419.             id__in=DumbCategory.objects.order_by("-id")[1:2]
2420.         ).delete()
2421.         self.assertEqual(set(DumbCategory.objects.values_list("id", flat=True)), {1, 3})
2422. 
2423.         DumbCategory.objects.filter(
2424.             id__in=DumbCategory.objects.order_by("-id")[1:]
2425.         ).delete()
2426.         self.assertEqual(set(DumbCategory.objects.values_list("id", flat=True)), {3})
2427. 
2428.     def test_distinct_ordered_sliced_subquery(self):
2429.         # Implicit values('id').
2430.         self.assertSequenceEqual(
2431.             NamedCategory.objects.filter(
2432.                 id__in=NamedCategory.objects.distinct().order_by("name")[0:2],
2433.             )
2434.             .order_by("name")
2435.             .values_list("name", flat=True),
2436.             ["first", "fourth"],
2437.         )
2438.         # Explicit values('id').
2439.         self.assertSequenceEqual(
2440.             NamedCategory.objects.filter(
2441.                 id__in=NamedCategory.objects.distinct()
2442.                 .order_by("-name")
2443.                 .values("id")[0:2],
2444.             )
2445.             .order_by("name")
2446.             .values_list("name", flat=True),
2447.             ["second", "third"],
2448.         )
2449.         # Annotated value.
2450.         self.assertSequenceEqual(
2451.             DumbCategory.objects.filter(
2452.                 id__in=DumbCategory.objects.annotate(double_id=F("id") * 2)
2453.                 .order_by("id")
2454.                 .distinct()
2455.                 .values("double_id")[0:2],
2456.             )
2457.             .order_by("id")
2458.             .values_list("id", flat=True),
2459.             [2, 4],
2460.         )


File: tests/queries/tests.py
Line number range: 2646 - 2793
Content:
2646. class ValuesQuerysetTests(TestCase):
2647.     @classmethod
2648.     def setUpTestData(cls):
2649.         Number.objects.create(num=72)
2650. 
2651.     def test_flat_values_list(self):
2652.         qs = Number.objects.values_list("num")
2653.         qs = qs.values_list("num", flat=True)
2654.         self.assertSequenceEqual(qs, [72])
2655. 
2656.     def test_extra_values(self):
2657.         # testing for ticket 14930 issues
2658.         qs = Number.objects.extra(
2659.             select={"value_plus_x": "num+%s", "value_minus_x": "num-%s"},
2660.             select_params=(1, 2),
2661.         )
2662.         qs = qs.order_by("value_minus_x")
2663.         qs = qs.values("num")
2664.         self.assertSequenceEqual(qs, [{"num": 72}])
2665. 
2666.     def test_extra_values_order_twice(self):
2667.         # testing for ticket 14930 issues
2668.         qs = Number.objects.extra(
2669.             select={"value_plus_one": "num+1", "value_minus_one": "num-1"}
2670.         )
2671.         qs = qs.order_by("value_minus_one").order_by("value_plus_one")
2672.         qs = qs.values("num")
2673.         self.assertSequenceEqual(qs, [{"num": 72}])
2674. 
2675.     def test_extra_values_order_multiple(self):
2676.         # Postgres doesn't allow constants in order by, so check for that.
2677.         qs = Number.objects.extra(
2678.             select={
2679.                 "value_plus_one": "num+1",
2680.                 "value_minus_one": "num-1",
2681.                 "constant_value": "1",
2682.             }
2683.         )
2684.         qs = qs.order_by("value_plus_one", "value_minus_one", "constant_value")
2685.         qs = qs.values("num")
2686.         self.assertSequenceEqual(qs, [{"num": 72}])
2687. 
2688.     def test_extra_values_order_in_extra(self):
2689.         # testing for ticket 14930 issues
2690.         qs = Number.objects.extra(
2691.             select={"value_plus_one": "num+1", "value_minus_one": "num-1"},
2692.             order_by=["value_minus_one"],
2693.         )
2694.         qs = qs.values("num")
2695. 
2696.     def test_extra_select_params_values_order_in_extra(self):
2697.         # testing for 23259 issue
2698.         qs = Number.objects.extra(
2699.             select={"value_plus_x": "num+%s"},
2700.             select_params=[1],
2701.             order_by=["value_plus_x"],
2702.         )
2703.         qs = qs.filter(num=72)
2704.         qs = qs.values("num")
2705.         self.assertSequenceEqual(qs, [{"num": 72}])
2706. 
2707.     def test_extra_multiple_select_params_values_order_by(self):
2708.         # testing for 23259 issue
2709.         qs = Number.objects.extra(
2710.             select={"value_plus_x": "num+%s", "value_minus_x": "num-%s"},
2711.             select_params=(72, 72),
2712.         )
2713.         qs = qs.order_by("value_minus_x")
2714.         qs = qs.filter(num=1)
2715.         qs = qs.values("num")
2716.         self.assertSequenceEqual(qs, [])
2717. 
2718.     def test_extra_values_list(self):
2719.         # testing for ticket 14930 issues
2720.         qs = Number.objects.extra(select={"value_plus_one": "num+1"})
2721.         qs = qs.order_by("value_plus_one")
2722.         qs = qs.values_list("num")
2723.         self.assertSequenceEqual(qs, [(72,)])
2724. 
2725.     def test_flat_extra_values_list(self):
2726.         # testing for ticket 14930 issues
2727.         qs = Number.objects.extra(select={"value_plus_one": "num+1"})
2728.         qs = qs.order_by("value_plus_one")
2729.         qs = qs.values_list("num", flat=True)
2730.         self.assertSequenceEqual(qs, [72])
2731. 
2732.     def test_field_error_values_list(self):
2733.         # see #23443
2734.         msg = (
2735.             "Cannot resolve keyword %r into field. Join on 'name' not permitted."
2736.             % "foo"
2737.         )
2738.         with self.assertRaisesMessage(FieldError, msg):
2739.             Tag.objects.values_list("name__foo")
2740. 
2741.     def test_named_values_list_flat(self):
2742.         msg = "'flat' and 'named' can't be used together."
2743.         with self.assertRaisesMessage(TypeError, msg):
2744.             Number.objects.values_list("num", flat=True, named=True)
2745. 
2746.     def test_named_values_list_bad_field_name(self):
2747.         msg = "Type names and field names must be valid identifiers: '1'"
2748.         with self.assertRaisesMessage(ValueError, msg):
2749.             Number.objects.extra(select={"1": "num+1"}).values_list(
2750.                 "1", named=True
2751.             ).first()
2752. 
2753.     def test_named_values_list_with_fields(self):
2754.         qs = Number.objects.extra(select={"num2": "num+1"}).annotate(Count("id"))
2755.         values = qs.values_list("num", "num2", named=True).first()
2756.         self.assertEqual(type(values).__name__, "Row")
2757.         self.assertEqual(values._fields, ("num", "num2"))
2758.         self.assertEqual(values.num, 72)
2759.         self.assertEqual(values.num2, 73)
2760. 
2761.     def test_named_values_list_without_fields(self):
2762.         qs = Number.objects.extra(select={"num2": "num+1"}).annotate(Count("id"))
2763.         values = qs.values_list(named=True).first()
2764.         self.assertEqual(type(values).__name__, "Row")
2765.         self.assertEqual(
2766.             values._fields,
2767.             ("num2", "id", "num", "other_num", "another_num", "id__count"),
2768.         )
2769.         self.assertEqual(values.num, 72)
2770.         self.assertEqual(values.num2, 73)
2771.         self.assertEqual(values.id__count, 1)
2772. 
2773.     def test_named_values_list_expression_with_default_alias(self):
2774.         expr = Count("id")
2775.         values = (
2776.             Number.objects.annotate(id__count1=expr)
2777.             .values_list(expr, "id__count1", named=True)
2778.             .first()
2779.         )
2780.         self.assertEqual(values._fields, ("id__count2", "id__count1"))
2781. 
2782.     def test_named_values_list_expression(self):
2783.         expr = F("num") + 1
2784.         qs = Number.objects.annotate(combinedexpression1=expr).values_list(
2785.             expr, "combinedexpression1", named=True
2786.         )
2787.         values = qs.first()
2788.         self.assertEqual(values._fields, ("combinedexpression2", "combinedexpression1"))
2789. 
2790.     def test_named_values_pickle(self):
2791.         value = Number.objects.values_list("num", "other_num", named=True).get()
2792.         self.assertEqual(value, (72, None))
2793.         self.assertEqual(pickle.loads(pickle.dumps(value)), value)


File: tests/queries/tests.py
Line number range: 3560 - 3570
Content:
3560. class ProxyQueryCleanupTest(TestCase):
3561.     def test_evaluated_proxy_count(self):
3562.         """
3563.         Generating the query string doesn't alter the query's state
3564.         in irreversible ways. Refs #18248.
3565.         """
3566.         ProxyCategory.objects.create()
3567.         qs = ProxyCategory.objects.all()
3568.         self.assertEqual(qs.count(), 1)
3569.         str(qs.query)
3570.         self.assertEqual(qs.count(), 1)


File: tests/queries/tests.py
Line number range: 3839 - 3893
Content:
3839. class JoinReuseTest(TestCase):
3840.     """
3841.     The queries reuse joins sensibly (for example, direct joins
3842.     are always reused).
3843.     """
3844. 
3845.     def test_fk_reuse(self):
3846.         qs = Annotation.objects.filter(tag__name="foo").filter(tag__name="bar")
3847.         self.assertEqual(str(qs.query).count("JOIN"), 1)
3848. 
3849.     def test_fk_reuse_select_related(self):
3850.         qs = Annotation.objects.filter(tag__name="foo").select_related("tag")
3851.         self.assertEqual(str(qs.query).count("JOIN"), 1)
3852. 
3853.     def test_fk_reuse_annotation(self):
3854.         qs = Annotation.objects.filter(tag__name="foo").annotate(cnt=Count("tag__name"))
3855.         self.assertEqual(str(qs.query).count("JOIN"), 1)
3856. 
3857.     def test_fk_reuse_disjunction(self):
3858.         qs = Annotation.objects.filter(Q(tag__name="foo") | Q(tag__name="bar"))
3859.         self.assertEqual(str(qs.query).count("JOIN"), 1)
3860. 
3861.     def test_fk_reuse_order_by(self):
3862.         qs = Annotation.objects.filter(tag__name="foo").order_by("tag__name")
3863.         self.assertEqual(str(qs.query).count("JOIN"), 1)
3864. 
3865.     def test_revo2o_reuse(self):
3866.         qs = Detail.objects.filter(member__name="foo").filter(member__name="foo")
3867.         self.assertEqual(str(qs.query).count("JOIN"), 1)
3868. 
3869.     def test_revfk_noreuse(self):
3870.         qs = Author.objects.filter(report__name="r4").filter(report__name="r1")
3871.         self.assertEqual(str(qs.query).count("JOIN"), 2)
3872. 
3873.     def test_inverted_q_across_relations(self):
3874.         """
3875.         When a trimmable join is specified in the query (here school__), the
3876.         ORM detects it and removes unnecessary joins. The set of reusable joins
3877.         are updated after trimming the query so that other lookups don't
3878.         consider that the outer query's filters are in effect for the subquery
3879.         (#26551).
3880.         """
3881.         springfield_elementary = School.objects.create()
3882.         hogward = School.objects.create()
3883.         Student.objects.create(school=springfield_elementary)
3884.         hp = Student.objects.create(school=hogward)
3885.         Classroom.objects.create(school=hogward, name="Potion")
3886.         Classroom.objects.create(school=springfield_elementary, name="Main")
3887.         qs = Student.objects.filter(
3888.             ~(
3889.                 Q(school__classroom__name="Main")
3890.                 & Q(school__classroom__has_blackboard=None)
3891.             )
3892.         )
3893.         self.assertSequenceEqual(qs, [hp])


File: tests/queries/tests.py
Line number range: 4149 - 4158
Content:
4149. class Ticket18785Tests(SimpleTestCase):
4150.     def test_ticket_18785(self):
4151.         # Test join trimming from ticket18785
4152.         qs = (
4153.             Item.objects.exclude(note__isnull=False)
4154.             .filter(name="something", creator__extra__isnull=True)
4155.             .order_by()
4156.         )
4157.         self.assertEqual(1, str(qs.query).count("INNER JOIN"))
4158.         self.assertEqual(0, str(qs.query).count("OUTER JOIN"))


File: tests/queries/tests.py
Line number range: 4331 - 4356
Content:
4331. class Ticket20955Tests(TestCase):
4332.     def test_ticket_20955(self):
4333.         jack = Staff.objects.create(name="jackstaff")
4334.         jackstaff = StaffUser.objects.create(staff=jack)
4335.         jill = Staff.objects.create(name="jillstaff")
4336.         jillstaff = StaffUser.objects.create(staff=jill)
4337.         task = Task.objects.create(creator=jackstaff, owner=jillstaff, title="task")
4338.         task_get = Task.objects.get(pk=task.pk)
4339.         # Load data so that assertNumQueries doesn't complain about the get
4340.         # version's queries.
4341.         task_get.creator.staffuser.staff
4342.         task_get.owner.staffuser.staff
4343.         qs = Task.objects.select_related(
4344.             "creator__staffuser__staff", "owner__staffuser__staff"
4345.         )
4346.         self.assertEqual(str(qs.query).count(" JOIN "), 6)
4347.         task_select_related = qs.get(pk=task.pk)
4348.         with self.assertNumQueries(0):
4349.             self.assertEqual(
4350.                 task_select_related.creator.staffuser.staff,
4351.                 task_get.creator.staffuser.staff,
4352.             )
4353.             self.assertEqual(
4354.                 task_select_related.owner.staffuser.staff,
4355.                 task_get.owner.staffuser.staff,
4356.             )


File: tests/queries/tests.py
Line number range: 4359 - 4365
Content:
4359. class Ticket21203Tests(TestCase):
4360.     def test_ticket_21203(self):
4361.         p = Ticket21203Parent.objects.create(parent_bool=True)
4362.         c = Ticket21203Child.objects.create(parent=p)
4363.         qs = Ticket21203Child.objects.select_related("parent").defer("parent__created")
4364.         self.assertSequenceEqual(qs, [c])
4365.         self.assertIs(qs[0].parent.parent_bool, True)


File: tests/queries/tests.py
Line number range: 4368 - 4393
Content:
4368. class ValuesJoinPromotionTests(TestCase):
4369.     def test_values_no_promotion_for_existing(self):
4370.         qs = Node.objects.filter(parent__parent__isnull=False)
4371.         self.assertIn(" INNER JOIN ", str(qs.query))
4372.         qs = qs.values("parent__parent__id")
4373.         self.assertIn(" INNER JOIN ", str(qs.query))
4374.         # Make sure there is a left outer join without the filter.
4375.         qs = Node.objects.values("parent__parent__id")
4376.         self.assertIn(" LEFT OUTER JOIN ", str(qs.query))
4377. 
4378.     def test_non_nullable_fk_not_promoted(self):
4379.         qs = ObjectB.objects.values("objecta__name")
4380.         self.assertIn(" INNER JOIN ", str(qs.query))
4381. 
4382.     def test_ticket_21376(self):
4383.         a = ObjectA.objects.create()
4384.         ObjectC.objects.create(objecta=a)
4385.         qs = ObjectC.objects.filter(
4386.             Q(objecta=a) | Q(objectb__objecta=a),
4387.         )
4388.         qs = qs.filter(
4389.             Q(objectb=1) | Q(objecta=a),
4390.         )
4391.         self.assertEqual(qs.count(), 1)
4392.         tblname = connection.ops.quote_name(ObjectB._meta.db_table)
4393.         self.assertIn(" LEFT OUTER JOIN %s" % tblname, str(qs.query))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 17:44:51,943 - thread-128656315778752.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have analyzed the user's request and the provided patch, which aims to optimize `QuerySet.count()` by stripping unused annotations. I have reviewed the previously provided context, which includes the full content of `tests/aggregation/tests.py` and `tests/queries/tests.py`. Within this context, I have identified three relevant test cases that demonstrate similar functionality or optimization patterns:\n\n1.  `tests/aggregation/tests.py::AggregateTestCase::test_exists_none_with_aggregate`: This test serves as a positive case, using `len()` (which triggers `.count()`) on a queryset with unused annotations. The optimization in the patch should apply here.\n2.  `tests/aggregation/tests.py::AggregateTestCase::test_annotation`: This test acts as a negative case where an annotation is used in a filter, meaning it should not be stripped by the optimization. This is crucial for ensuring the patch does not break existing, expected behavior.\n3.  `tests/queries/tests.py::Queries1Tests::test_get_clears_ordering`: This test demonstrates an analogous optimization for the `.get()` method, where ordering is cleared. This is relevant as the user's patch also considers ordering when optimizing `.count()`.\n\nThe existing context provides the full implementation of these test cases, including necessary imports and setup, making it sufficient to fulfill the user's request. Therefore, no additional context is required." query='' extra_requirements='' purpose=''
2025-12-21 17:44:51,945 - thread-128656315778752.prometheus_context_collector - INFO - Successfully retrieved 14 context snippets
