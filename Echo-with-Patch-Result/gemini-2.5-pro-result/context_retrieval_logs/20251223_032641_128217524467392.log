2025-12-23 03:26:41,896 - thread-128217524467392.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: `solveset` raises `NotImplementedError` instead of returning `ConditionSet`

Description: The problem is
```julia
In [10]: Eq(n*cos(n) - 3*sin(n), 0).as_set()                                                                                                                  
---------------------------------------------------------------------------
NotImplementedError
```
Here `solveset` raises `NotImplementedError` but probably a `ConditionSet` should be returned by `solveset` instead. The obvious result of `as_set()` here is
```julia
In [11]: ConditionSet(n, Eq(n*cos(n) - 3*sin(n), 0), Reals)                                                                                                   
Out[11]: {n | n ∊ ℝ ∧ n⋅cos(n) - 3⋅sin(n) = 0}
```

_Originally posted by @oscarbenjamin in https://github.com/sympy/sympy/pull/17771_

Patch information:
diff --git a/sympy/core/relational.py b/sympy/core/relational.py
index f581bfa3c4..9e54266d56 100644
--- a/sympy/core/relational.py
+++ b/sympy/core/relational.py
@@ -389,10 +389,14 @@ def __nonzero__(self):
     def _eval_as_set(self):
         # self is univariate and periodicity(self, x) in (0, None)
         from sympy.solvers.inequalities import solve_univariate_inequality
+        from sympy.sets.conditionset import ConditionSet
         syms = self.free_symbols
         assert len(syms) == 1
         x = syms.pop()
-        return solve_univariate_inequality(self, x, relational=False)
+        try:
+            return solve_univariate_inequality(self, x, relational=False)
+        except NotImplementedError:
+            return ConditionSet(x, self, S.Reals)
 
     @property
     def binary_symbols(self):
diff --git a/sympy/logic/boolalg.py b/sympy/logic/boolalg.py
index c3664a1055..8a6232435b 100644
--- a/sympy/logic/boolalg.py
+++ b/sympy/logic/boolalg.py
@@ -152,10 +152,8 @@ def as_set(self):
                     if s in (S.EmptySet, S.UniversalSet, S.Reals):
                         reps[r] = s.as_relational(x)
                         continue
-                    raise NotImplementedError(filldedent('''
-                        as_set is not implemented for relationals
-                        with periodic solutions
-                        '''))
+                    from sympy.sets.conditionset import ConditionSet
+                    return ConditionSet(x, self, S.Reals)
             return self.subs(reps)._eval_as_set()
         else:
             raise NotImplementedError("Sorry, as_set has not yet been"


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 03:26:41,973 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_array_utils.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_pyutils.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── __init__.py
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: `solveset` raises `NotImplementedError` instead of returning `ConditionSet`

Description: The problem is
```julia
In [10]: Eq(n*cos(n) - 3*sin(n), 0).as_set()                                                                                                                  
---------------------------------------------------------------------------
NotImplementedError
```
Here `solveset` raises `NotImplementedError` but probably a `ConditionSet` should be returned by `solveset` instead. The obvious result of `as_set()` here is
```julia
In [11]: ConditionSet(n, Eq(n*cos(n) - 3*sin(n), 0), Reals)                                                                                                   
Out[11]: {n | n ∊ ℝ ∧ n⋅cos(n) - 3⋅sin(n) = 0}
```

_Originally posted by @oscarbenjamin in https://github.com/sympy/sympy/pull/17771_

Patch information:
diff --git a/sympy/core/relational.py b/sympy/core/relational.py
index f581bfa3c4..9e54266d56 100644
--- a/sympy/core/relational.py
+++ b/sympy/core/relational.py
@@ -389,10 +389,14 @@ def __nonzero__(self):
     def _eval_as_set(self):
         # self is univariate and periodicity(self, x) in (0, None)
         from sympy.solvers.inequalities import solve_univariate_inequality
+        from sympy.sets.conditionset import ConditionSet
         syms = self.free_symbols
         assert len(syms) == 1
         x = syms.pop()
-        return solve_univariate_inequality(self, x, relational=False)
+        try:
+            return solve_univariate_inequality(self, x, relational=False)
+        except NotImplementedError:
+            return ConditionSet(x, self, S.Reals)
 
     @property
     def binary_symbols(self):
diff --git a/sympy/logic/boolalg.py b/sympy/logic/boolalg.py
index c3664a1055..8a6232435b 100644
--- a/sympy/logic/boolalg.py
+++ b/sympy/logic/boolalg.py
@@ -152,10 +152,8 @@ def as_set(self):
                     if s in (S.EmptySet, S.UniversalSet, S.Reals):
                         reps[r] = s.as_relational(x)
                         continue
-                    raise NotImplementedError(filldedent('''
-                        as_set is not implemented for relationals
-                        with periodic solutions
-                        '''))
+                    from sympy.sets.conditionset import ConditionSet
+                    return ConditionSet(x, self, S.Reals)
             return self.subs(reps)._eval_as_set()
         else:
             raise NotImplementedError("Sorry, as_set has not yet been"


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 03:27:47,723 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to find test cases related to `solveset` raising a `NotImplementedError` instead of returning a `ConditionSet`. The user's example `Eq(n*cos(n) - 3*sin(n), 0).as_set()` involves a call to `solveset`. The most direct way to find relevant tests is to examine the test suite for `solveset`. I need the content of `sympy/solvers/tests/test_solveset.py` to identify tests that handle transcendental equations or other cases where `solveset` is expected to return a `ConditionSet` because an explicit solution cannot be found." query='Please provide the full content of the file `sympy/solvers/tests/test_solveset.py`.' extra_requirements='' purpose="I need to find test cases that demonstrate how `solveset` handles equations for which it cannot find an explicit solution, which is central to the user's problem description."
2025-12-23 03:27:47,725 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `sympy/solvers/tests/test_solveset.py`.
2025-12-23 03:27:47,725 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 03:27:47,725 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 03:27:47,726 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 03:27:47,726 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `sympy/solvers/tests/test_solveset.py`.
Purpose: I need to find test cases that demonstrate how `solveset` handles equations for which it cannot find an explicit solution, which is central to the user's problem description.
2025-12-23 03:27:50,379 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/solvers/tests/test_solveset.py"}'}, '__gemini_function_call_thought_signatures__': {'83fb3219-0cf9-4762-ab08-658e4f50f5df': 'CoUFAY89a1+7fn9C6fITvFFRxKvghZj7W7t8GlwZT9a8Ce4nZprTrnT4swgJkG9fSqcquGDx0ZP887khCHoSB419r/teCmATX93FLSehA3ISXfPM3e7w4Atgc0ARfLWKoaJtqVsT7kek0GeuwG9b3y6fAJnW/joH5S3qAWN6WhcXSwbu2kBtRzJ45RroaX5uaFjdbzcuIzsiOG3zmgyMtCDf3uZ0TDiE5MFMqTYwM+GP0yj9GbuZNucZVtwlId5XSmXJ91lEV+m1suS8LKc+Mr1CjksJabCSifI1y9ZM7jtWW4nJkjfIiIadmKvR9RSz1puLRsbxTUkIVrEfWXIj3u1LzWLombnkT2u648SPj2+B0xUak4XaJ6Lu4w5u8ODPm8WzeauHAqhhBo45wW6gyrCu3Pb2vs6UUKwDskF3WAXIUwSrRp1KwOO7uj5Vyn35VKYM/+LZZmx20dqbWg07KBlLueiDfTA6lpjfXge5q+QQQKUYBpF0akhX99846p1KbDfuCi56ph36D9art+MVbpPgWKQjnFRPdf4COLV57YFNAFOfh2pEZD1fwhlRRpZXY1Fx9wMSuIW6sv+ctZSx+HS6SeJ8USXyrzwXEbTPIX88MVpt3nVwc0J98WzZLQqeYiNWlS1nfW/iA1SPBDbbUbRBq/6Gs/gLEgvo2OXWnlNaOk5QGbc1V+uoEHChn68TnRQl3F8dXNdqq4wEa8cU0GaA5tVenSnv3Ig4XiKHcIs6nX4pPU+mFku7Pr9eD2pwc0ax2khMhLiCZMT4vPRl8lr5n+7M8sCBFcSsUNv+giUDpKPninLV9pqyDNQ+D+yeMW1ti9SIBjm9XpG5VZS2Oy8Pi/Ry5icW'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2122, 'candidates_token_count': 28, 'total_token_count': 2311, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2122}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 28}], 'thoughts_token_count': 161, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.29510460581098286, 'model_name': 'gemini-2.5-pro'} id='run--f2180f42-77aa-4a1e-97c4-19f86d57af03-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/solvers/tests/test_solveset.py'}, 'id': '83fb3219-0cf9-4762-ab08-658e4f50f5df', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2122, 'output_tokens': 28, 'total_tokens': 2311, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 161}}
2025-12-23 03:27:53,409 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "end_line": 2000.0, "relative_path": "sympy/solvers/tests/test_solveset.py"}'}, '__gemini_function_call_thought_signatures__': {'f1f54276-3531-4bdb-8284-195048c753be': 'CtcEAY89a18LfadqGrwAuuujeIl9lWAi0NPAQ38sDnBDE4oPyIV3f/qKTAa1MmawRSSDLTYypZ4M8FkfPwLaPratkxXDz9dQWIeDWXIQzOqen5HfEVfS2NVRFZkLnbF2S99nzQGpC6H1mM0GtpmW6RW5wkKIjq1jwm4krOkuNJDpL0gb+lV1RYQjVIkuHfkEUQ5iYgTrd291w8x+77pU19otvJimngNTJzmJPe98m3iB/X99b9t8FtVfeSF2R9K5wqvh0bz0i1J1qG3Qb7z2b7QnMFM1+5kdNUGz+FQCH6caQgiosNPe8cdLl/wjLIZjRkGldAf3rr8E3167rpCQ7PQcN1r2ARhElDrk3RdxwA+qa4omq4/iG5EUZNBZ5GpgXf63oYhWQe/5lpgdtn97tfgAau8kb0yaIpz/swG3R5rG1Ld1+LOceTBpbrLnEB29W0y3a29JDDb+bkdMIJmIlSY0PBFmi7QnCvEVgdPs2+pW4qoe3nEY6vSzltn4UvdYmHu5GWCidHtbMfR2bNKPvGg7r/MtNaYrp6BYOMvGwUWqzNE1mxuNVpFQvVPgynxLLUd0hpUtE3UV0iCc7OJGU6vJO9Khqd1MAOalJGMO53Ev8iINqrWa8whDsXogC1RyLcZQW+h7vwu7/mNsIfHYlp6F14H6U4AUed2umeiZk5VMggYAbRjbSzqLt0aEQTXiZ7lqQZVQeNgF2mNuekbHIKP9ja7BjxMjw8pfwjo4q0TjxW6CiKj2XzjuGMwFUDfoFurF6OaEGSxeIdXUxAR9h92qifsZSQmX3Tw='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12614, 'candidates_token_count': 34, 'total_token_count': 12801, 'cached_content_token_count': 1898, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12775}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1898}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 34}], 'thoughts_token_count': 153}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3226803050321691, 'model_name': 'gemini-2.5-pro'} id='run--9fa0e78f-29dc-4b93-8cf2-fe387c54388f-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'end_line': 2000.0, 'relative_path': 'sympy/solvers/tests/test_solveset.py'}, 'id': 'f1f54276-3531-4bdb-8284-195048c753be', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12614, 'output_tokens': 34, 'total_tokens': 12801, 'input_token_details': {'cache_read': 1898}, 'output_token_details': {'reasoning': 153}}
2025-12-23 03:27:56,371 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2001.0, "end_line": 4000.0, "relative_path": "sympy/solvers/tests/test_solveset.py"}'}, '__gemini_function_call_thought_signatures__': {'55da6bd2-33a8-44aa-8254-5d45e6143548': 'CrcCAY89a1/l0kTPJMDrdlp56P+vejI7OeAv3eZDtIyaoSY1G6gVZRN2RL6N6qap7eDq7AMDukOGmA12XnzvOJqLl4qEirB7k9QXDULHMogILDi2psihv2PDNwSHJCxkTgtR6WxtKBVdCrXqNJWmyHevDxVqA+V+Ds8oB/v8IT8iMHM8Lx/QaZYK/xnE20rpiL5kd2a0fMNdmtJCAW9cLgP7FsGBJVf3pcJrURxAatvdSbB9L8/WOgFKP/oaogD3is1bI6QlSU+yZgA1UtPvvVuLDf14uxmjeeiXJ9SNatW+a4D8p9Me+bRt6csRIvQtycImLEhSP/PPAJRhGfpgK05oSfbgvP0kQr5GKZKh5J6Pj2lGOvT8LHXXW10se43Z5yqximAbhseWVQKHzV9XbkyJEpqQtfpoTB0='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 45446, 'candidates_token_count': 34, 'total_token_count': 45562, 'cached_content_token_count': 11934, 'prompt_tokens_details': [{'modality': 1, 'token_count': 45760}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11934}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 34}], 'thoughts_token_count': 82}, 'finish_reason': 'STOP', 'avg_logprobs': -0.20637939958011403, 'model_name': 'gemini-2.5-pro'} id='run--3f4d0ca2-39e4-4de3-891d-e831fd96e589-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2001.0, 'end_line': 4000.0, 'relative_path': 'sympy/solvers/tests/test_solveset.py'}, 'id': '55da6bd2-33a8-44aa-8254-5d45e6143548', 'type': 'tool_call'}] usage_metadata={'input_tokens': 45446, 'output_tokens': 34, 'total_tokens': 45562, 'input_token_details': {'cache_read': 11934}, 'output_token_details': {'reasoning': 82}}
2025-12-23 03:28:02,812 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `sympy/solvers/tests/test_solveset.py` by reading the file in parts and combining them. The file contains extensive test cases for the `solveset` function, which is designed to solve equations. These tests cover a variety of scenarios, including cases where explicit solutions are not found, which is relevant to your query. I have combined the retrieved chunks of the file to provide you with the complete content.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 52594, 'candidates_token_count': 96, 'total_token_count': 53025, 'cached_content_token_count': 45804, 'prompt_tokens_details': [{'modality': 1, 'token_count': 52990}], 'cache_tokens_details': [{'modality': 1, 'token_count': 45804}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 96}], 'thoughts_token_count': 335}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5169389247894287, 'model_name': 'gemini-2.5-pro'} id='run--f223b480-fe4d-42d7-b4ea-15b1994050c2-0' usage_metadata={'input_tokens': 52594, 'output_tokens': 96, 'total_tokens': 53025, 'input_token_details': {'cache_read': 45804}, 'output_token_details': {'reasoning': 335}}
2025-12-23 03:28:02,814 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `sympy/solvers/tests/test_solveset.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find test cases that demonstrate how `solveset` handles equations for which it cannot find an explicit solution, which is central to the user's problem description.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/solvers/tests/test_solveset.py
Line number range: 1 - 500
Content:
1. from sympy.core.containers import Tuple
2. from sympy.core.function import (Function, Lambda, nfloat)
3. from sympy.core.mod import Mod
4. from sympy.core.numbers import (E, I, Rational, oo, pi)
5. from sympy.core.relational import (Eq, Gt,
6.     Ne)
7. from sympy.core.singleton import S
8. from sympy.core.symbol import (Dummy, Symbol, symbols)
9. from sympy.functions.elementary.complexes import (Abs, arg, im, re, sign)
10. from sympy.functions.elementary.exponential import (LambertW, exp, log)
11. from sympy.functions.elementary.hyperbolic import (HyperbolicFunction,
12.     atanh, sinh, tanh, cosh, sech, coth)
13. from sympy.functions.elementary.miscellaneous import sqrt, Min, Max
14. from sympy.functions.elementary.piecewise import Piecewise
15. from sympy.functions.elementary.trigonometric import (
16.     TrigonometricFunction, acos, acot, acsc, asec, asin, atan, atan2,
17.     cos, cot, csc, sec, sin, tan)
18. from sympy.functions.special.error_functions import (erf, erfc,
19.     erfcinv, erfinv)
20. from sympy.logic.boolalg import And
21. from sympy.matrices.dense import MutableDenseMatrix as Matrix
22. from sympy.matrices.immutable import ImmutableDenseMatrix
23. from sympy.polys.polytools import Poly
24. from sympy.polys.rootoftools import CRootOf
25. from sympy.sets.contains import Contains
26. from sympy.sets.conditionset import ConditionSet
27. from sympy.sets.fancysets import ImageSet
28. from sympy.sets.sets import (Complement, EmptySet, FiniteSet,
29.     Intersection, Interval, Union, imageset, ProductSet)
30. from sympy.tensor.indexed import Indexed
31. from sympy.utilities.iterables import numbered_symbols
32. 
33. from sympy.utilities.pytest import (XFAIL, raises, skip, slow, SKIP,
34.     nocache_fail)
35. from sympy.utilities.randtest import verify_numerically as tn
36. from sympy.physics.units import cm
37. 
38. from sympy.solvers.solveset import (
39.     solveset_real, domain_check, solveset_complex, linear_eq_to_matrix,
40.     linsolve, _is_function_class_equation, invert_real, invert_complex,
41.     solveset, solve_decomposition, substitution, nonlinsolve, solvify,
42.     _is_finite_with_finite_vars, _transolve, _is_exponential,
43.     _solve_exponential, _is_logarithmic,
44.     _solve_logarithm, _term_factors, _is_modular)
45. 
46. 
47. a = Symbol('a', real=True)
48. b = Symbol('b', real=True)
49. c = Symbol('c', real=True)
50. x = Symbol('x', real=True)
51. y = Symbol('y', real=True)
52. z = Symbol('z', real=True)
53. q = Symbol('q', real=True)
54. m = Symbol('m', real=True)
55. n = Symbol('n', real=True)
56. 
57. 
58. def test_invert_real():
59.     x = Symbol('x', real=True)
60.     y = Symbol('y')
61.     n = Symbol('n')
62. 
63.     def ireal(x, s=S.Reals):
64.         return Intersection(s, x)
65. 
66.     # issue 14223
67.     assert invert_real(x, 0, x, Interval(1, 2)) == (x, S.EmptySet)
68. 
69.     assert invert_real(exp(x), y, x) == (x, ireal(FiniteSet(log(y))))
70. 
71.     y = Symbol('y', positive=True)
72.     n = Symbol('n', real=True)
73.     assert invert_real(x + 3, y, x) == (x, FiniteSet(y - 3))
74.     assert invert_real(x*3, y, x) == (x, FiniteSet(y / 3))
75. 
76.     assert invert_real(exp(x), y, x) == (x, FiniteSet(log(y)))
77.     assert invert_real(exp(3*x), y, x) == (x, FiniteSet(log(y) / 3))
78.     assert invert_real(exp(x + 3), y, x) == (x, FiniteSet(log(y) - 3))
79. 
80.     assert invert_real(exp(x) + 3, y, x) == (x, ireal(FiniteSet(log(y - 3))))
81.     assert invert_real(exp(x)*3, y, x) == (x, FiniteSet(log(y / 3)))
82. 
83.     assert invert_real(log(x), y, x) == (x, FiniteSet(exp(y)))
84.     assert invert_real(log(3*x), y, x) == (x, FiniteSet(exp(y) / 3))
85.     assert invert_real(log(x + 3), y, x) == (x, FiniteSet(exp(y) - 3))
86. 
87.     assert invert_real(Abs(x), y, x) == (x, FiniteSet(y, -y))
88. 
89.     assert invert_real(2**x, y, x) == (x, FiniteSet(log(y)/log(2)))
90.     assert invert_real(2**exp(x), y, x) == (x, ireal(FiniteSet(log(log(y)/log(2)))))
91. 
92.     assert invert_real(x**2, y, x) == (x, FiniteSet(sqrt(y), -sqrt(y)))
93.     assert invert_real(x**S.Half, y, x) == (x, FiniteSet(y**2))
94. 
95.     raises(ValueError, lambda: invert_real(x, x, x))
96.     raises(ValueError, lambda: invert_real(x**pi, y, x))
97.     raises(ValueError, lambda: invert_real(S.One, y, x))
98. 
99.     assert invert_real(x**31 + x, y, x) == (x**31 + x, FiniteSet(y))
100. 
101.     lhs = x**31 + x
102.     base_values =  FiniteSet(y - 1, -y - 1)
103.     assert invert_real(Abs(x**31 + x + 1), y, x) == (lhs, base_values)
104. 
105.     assert invert_real(sin(x), y, x) == \
106.         (x, imageset(Lambda(n, n*pi + (-1)**n*asin(y)), S.Integers))
107. 
108.     assert invert_real(sin(exp(x)), y, x) == \
109.         (x, imageset(Lambda(n, log((-1)**n*asin(y) + n*pi)), S.Integers))
110. 
111.     assert invert_real(csc(x), y, x) == \
112.         (x, imageset(Lambda(n, n*pi + (-1)**n*acsc(y)), S.Integers))
113. 
114.     assert invert_real(csc(exp(x)), y, x) == \
115.         (x, imageset(Lambda(n, log((-1)**n*acsc(y) + n*pi)), S.Integers))
116. 
117.     assert invert_real(cos(x), y, x) == \
118.         (x, Union(imageset(Lambda(n, 2*n*pi + acos(y)), S.Integers), \
119.                 imageset(Lambda(n, 2*n*pi - acos(y)), S.Integers)))
120. 
121.     assert invert_real(cos(exp(x)), y, x) == \
122.         (x, Union(imageset(Lambda(n, log(2*n*pi + acos(y))), S.Integers), \
123.                 imageset(Lambda(n, log(2*n*pi - acos(y))), S.Integers)))
124. 
125.     assert invert_real(sec(x), y, x) == \
126.         (x, Union(imageset(Lambda(n, 2*n*pi + asec(y)), S.Integers), \
127.                 imageset(Lambda(n, 2*n*pi - asec(y)), S.Integers)))
128. 
129.     assert invert_real(sec(exp(x)), y, x) == \
130.         (x, Union(imageset(Lambda(n, log(2*n*pi + asec(y))), S.Integers), \
131.                 imageset(Lambda(n, log(2*n*pi - asec(y))), S.Integers)))
132. 
133.     assert invert_real(tan(x), y, x) == \
134.         (x, imageset(Lambda(n, n*pi + atan(y)), S.Integers))
135. 
136.     assert invert_real(tan(exp(x)), y, x) == \
137.         (x, imageset(Lambda(n, log(n*pi + atan(y))), S.Integers))
138. 
139.     assert invert_real(cot(x), y, x) == \
140.         (x, imageset(Lambda(n, n*pi + acot(y)), S.Integers))
141. 
142.     assert invert_real(cot(exp(x)), y, x) == \
143.         (x, imageset(Lambda(n, log(n*pi + acot(y))), S.Integers))
144. 
145.     assert invert_real(tan(tan(x)), y, x) == \
146.         (tan(x), imageset(Lambda(n, n*pi + atan(y)), S.Integers))
147. 
148.     x = Symbol('x', positive=True)
149.     assert invert_real(x**pi, y, x) == (x, FiniteSet(y**(1/pi)))
150. 
151. 
152. def test_invert_complex():
153.     assert invert_complex(x + 3, y, x) == (x, FiniteSet(y - 3))
154.     assert invert_complex(x*3, y, x) == (x, FiniteSet(y / 3))
155. 
156.     assert invert_complex(exp(x), y, x) == \
157.         (x, imageset(Lambda(n, I*(2*pi*n + arg(y)) + log(Abs(y))), S.Integers))
158. 
159.     assert invert_complex(log(x), y, x) == (x, FiniteSet(exp(y)))
160. 
161.     raises(ValueError, lambda: invert_real(1, y, x))
162.     raises(ValueError, lambda: invert_complex(x, x, x))
163.     raises(ValueError, lambda: invert_complex(x, x, 1))
164. 
165.     # https://github.com/skirpichev/omg/issues/16
166.     assert invert_complex(sinh(x), 0, x) != (x, FiniteSet(0))
167. 
168. 
169. def test_domain_check():
170.     assert domain_check(1/(1 + (1/(x+1))**2), x, -1) is False
171.     assert domain_check(x**2, x, 0) is True
172.     assert domain_check(x, x, oo) is False
173.     assert domain_check(0, x, oo) is False
174. 
175. 
176. def test_issue_11536():
177.     assert solveset(0**x - 100, x, S.Reals) == S.EmptySet
178.     assert solveset(0**x - 1, x, S.Reals) == FiniteSet(0)
179. 
180. 
181. def test_issue_17479():
182.     import sympy as sb
183.     from sympy.solvers.solveset import nonlinsolve
184.     x, y, z = sb.symbols("x, y, z")
185.     f = (x**2 + y**2)**2 + (x**2 + z**2)**2 - 2*(2*x**2 + y**2 + z**2)
186.     fx = sb.diff(f, x)
187.     fy = sb.diff(f, y)
188.     fz = sb.diff(f, z)
189.     sol = nonlinsolve([fx, fy, fz], [x, y, z])
190.     # FIXME: This previously gave 18 solutions and now gives 20 due to fixes
191.     # in the handling of intersection of FiniteSets or possibly a small change
192.     # to ImageSet._contains. However Using expand I can turn this into 16
193.     # solutions either way:
194.     #
195.     #    >>> len(FiniteSet(*(Tuple(*(expand(w) for w in s)) for s in sol)))
196.     #    16
197.     #
198.     assert len(sol) == 20
199. 
200. 
201. def test_is_function_class_equation():
202.     from sympy.abc import x, a
203.     assert _is_function_class_equation(TrigonometricFunction,
204.                                        tan(x), x) is True
205.     assert _is_function_class_equation(TrigonometricFunction,
206.                                        tan(x) - 1, x) is True
207.     assert _is_function_class_equation(TrigonometricFunction,
208.                                        tan(x) + sin(x), x) is True
209.     assert _is_function_class_equation(TrigonometricFunction,
210.                                        tan(x) + sin(x) - a, x) is True
211.     assert _is_function_class_equation(TrigonometricFunction,
212.                                        sin(x)*tan(x) + sin(x), x) is True
213.     assert _is_function_class_equation(TrigonometricFunction,
214.                                        sin(x)*tan(x + a) + sin(x), x) is True
215.     assert _is_function_class_equation(TrigonometricFunction,
216.                                        sin(x)*tan(x*a) + sin(x), x) is True
217.     assert _is_function_class_equation(TrigonometricFunction,
218.                                        a*tan(x) - 1, x) is True
219.     assert _is_function_class_equation(TrigonometricFunction,
220.                                        tan(x)**2 + sin(x) - 1, x) is True
221.     assert _is_function_class_equation(TrigonometricFunction,
222.                                        tan(x) + x, x) is False
223.     assert _is_function_class_equation(TrigonometricFunction,
224.                                        tan(x**2), x) is False
225.     assert _is_function_class_equation(TrigonometricFunction,
226.                                        tan(x**2) + sin(x), x) is False
227.     assert _is_function_class_equation(TrigonometricFunction,
228.                                        tan(x)**sin(x), x) is False
229.     assert _is_function_class_equation(TrigonometricFunction,
230.                                        tan(sin(x)) + sin(x), x) is False
231.     assert _is_function_class_equation(HyperbolicFunction,
232.                                        tanh(x), x) is True
233.     assert _is_function_class_equation(HyperbolicFunction,
234.                                        tanh(x) - 1, x) is True
235.     assert _is_function_class_equation(HyperbolicFunction,
236.                                        tanh(x) + sinh(x), x) is True
237.     assert _is_function_class_equation(HyperbolicFunction,
238.                                        tanh(x) + sinh(x) - a, x) is True
239.     assert _is_function_class_equation(HyperbolicFunction,
240.                                        sinh(x)*tanh(x) + sinh(x), x) is True
241.     assert _is_function_class_equation(HyperbolicFunction,
242.                                        sinh(x)*tanh(x + a) + sinh(x), x) is True
243.     assert _is_function_class_equation(HyperbolicFunction,
244.                                        sinh(x)*tanh(x*a) + sinh(x), x) is True
245.     assert _is_function_class_equation(HyperbolicFunction,
246.                                        a*tanh(x) - 1, x) is True
247.     assert _is_function_class_equation(HyperbolicFunction,
248.                                        tanh(x)**2 + sinh(x) - 1, x) is True
249.     assert _is_function_class_equation(HyperbolicFunction,
250.                                        tanh(x) + x, x) is False
251.     assert _is_function_class_equation(HyperbolicFunction,
252.                                        tanh(x**2), x) is False
253.     assert _is_function_class_equation(HyperbolicFunction,
254.                                        tanh(x**2) + sinh(x), x) is False
255.     assert _is_function_class_equation(HyperbolicFunction,
256.                                        tanh(x)**sinh(x), x) is False
257.     assert _is_function_class_equation(HyperbolicFunction,
258.                                        tanh(sinh(x)) + sinh(x), x) is False
259. 
260. 
261. def test_garbage_input():
262.     raises(ValueError, lambda: solveset_real([x], x))
263.     assert solveset_real(x, 1) == S.EmptySet
264.     assert solveset_real(x - 1, 1) == FiniteSet(x)
265.     assert solveset_real(x, pi) == S.EmptySet
266.     assert solveset_real(x, x**2) == S.EmptySet
267. 
268.     raises(ValueError, lambda: solveset_complex([x], x))
269.     assert solveset_complex(x, pi) == S.EmptySet
270. 
271.     raises(ValueError, lambda: solveset((x, y), x))
272.     raises(ValueError, lambda: solveset(x + 1, S.Reals))
273.     raises(ValueError, lambda: solveset(x + 1, x, 2))
274. 
275. 
276. def test_solve_mul():
277.     assert solveset_real((a*x + b)*(exp(x) - 3), x) == \
278.         Union({log(3)}, Intersection({-b/a}, S.Reals))
279.     anz = Symbol('anz', nonzero=True)
280.     assert solveset_real((anz*x + b)*(exp(x) - 3), x) == \
281.         FiniteSet(-b/anz, log(3))
282.     assert solveset_real((2*x + 8)*(8 + exp(x)), x) == FiniteSet(S(-4))
283.     assert solveset_real(x/log(x), x) == EmptySet()
284. 
285. 
286. def test_solve_invert():
287.     assert solveset_real(exp(x) - 3, x) == FiniteSet(log(3))
288.     assert solveset_real(log(x) - 3, x) == FiniteSet(exp(3))
289. 
290.     assert solveset_real(3**(x + 2), x) == FiniteSet()
291.     assert solveset_real(3**(2 - x), x) == FiniteSet()
292. 
293.     assert solveset_real(y - b*exp(a/x), x) == Intersection(
294.         S.Reals, FiniteSet(a/log(y/b)))
295. 
296.     # issue 4504
297.     assert solveset_real(2**x - 10, x) == FiniteSet(1 + log(5)/log(2))
298. 
299. 
300. def test_errorinverses():
301.     assert solveset_real(erf(x) - S.Half, x) == \
302.         FiniteSet(erfinv(S.Half))
303.     assert solveset_real(erfinv(x) - 2, x) == \
304.         FiniteSet(erf(2))
305.     assert solveset_real(erfc(x) - S.One, x) == \
306.         FiniteSet(erfcinv(S.One))
307.     assert solveset_real(erfcinv(x) - 2, x) == FiniteSet(erfc(2))
308. 
309. 
310. def test_solve_polynomial():
311.     assert solveset_real(3*x - 2, x) == FiniteSet(Rational(2, 3))
312. 
313.     assert solveset_real(x**2 - 1, x) == FiniteSet(-S.One, S.One)
314.     assert solveset_real(x - y**3, x) == FiniteSet(y ** 3)
315. 
316.     a11, a12, a21, a22, b1, b2 = symbols('a11, a12, a21, a22, b1, b2')
317. 
318.     assert solveset_real(x**3 - 15*x - 4, x) == FiniteSet(
319.         -2 + 3 ** S.Half,
320.         S(4),
321.         -2 - 3 ** S.Half)
322. 
323.     assert solveset_real(sqrt(x) - 1, x) == FiniteSet(1)
324.     assert solveset_real(sqrt(x) - 2, x) == FiniteSet(4)
325.     assert solveset_real(x**Rational(1, 4) - 2, x) == FiniteSet(16)
326.     assert solveset_real(x**Rational(1, 3) - 3, x) == FiniteSet(27)
327.     assert len(solveset_real(x**5 + x**3 + 1, x)) == 1
328.     assert len(solveset_real(-2*x**3 + 4*x**2 - 2*x + 6, x)) > 0
329. 
330.     assert solveset_real(x**6 + x**4  + I, x) == ConditionSet(x,
331.                                         Eq(x**6 + x**4 + I, 0), S.Reals)
332. 
333. 
334. def test_return_root_of():
335.     f = x**5 - 15*x**3 - 5*x**2 + 10*x + 20
336.     s = list(solveset_complex(f, x))
337.     for root in s:
338.         assert root.func == CRootOf
339. 
340.     # if one uses solve to get the roots of a polynomial that has a CRootOf
341.     # solution, make sure that the use of nfloat during the solve process
342.     # doesn't fail. Note: if you want numerical solutions to a polynomial
343.     # it is *much* faster to use nroots to get them than to solve the
344.     # equation only to get CRootOf solutions which are then numerically
345.     # evaluated. So for eq = x**5 + 3*x + 7 do Poly(eq).nroots() rather
346.     # than [i.n() for i in solve(eq)] to get the numerical roots of eq.
347.     assert nfloat(list(solveset_complex(x**5 + 3*x**3 + 7, x))[0],
348.                   exponent=False) == CRootOf(x**5 + 3*x**3 + 7, 0).n()
349. 
350.     sol = list(solveset_complex(x**6 - 2*x + 2, x))
351.     assert all(isinstance(i, CRootOf) for i in sol) and len(sol) == 6
352. 
353.     f = x**5 - 15*x**3 - 5*x**2 + 10*x + 20
354.     s = list(solveset_complex(f, x))
355.     for root in s:
356.         assert root.func == CRootOf
357. 
358.     s = x**5 + 4*x**3 + 3*x**2 + Rational(7, 4)
359.     assert solveset_complex(s, x) == \
360.         FiniteSet(*Poly(s*4, domain='ZZ').all_roots())
361. 
362.     # Refer issue #7876
363.     eq = x*(x - 1)**2*(x + 1)*(x**6 - x + 1)
364.     assert solveset_complex(eq, x) == \
365.         FiniteSet(-1, 0, 1, CRootOf(x**6 - x + 1, 0),
366.                        CRootOf(x**6 - x + 1, 1),
367.                        CRootOf(x**6 - x + 1, 2),
368.                        CRootOf(x**6 - x + 1, 3),
369.                        CRootOf(x**6 - x + 1, 4),
370.                        CRootOf(x**6 - x + 1, 5))
371. 
372. 
373. def test__has_rational_power():
374.     from sympy.solvers.solveset import _has_rational_power
375.     assert _has_rational_power(sqrt(2), x)[0] is False
376.     assert _has_rational_power(x*sqrt(2), x)[0] is False
377. 
378.     assert _has_rational_power(x**2*sqrt(x), x) == (True, 2)
379.     assert _has_rational_power(sqrt(2)*x**Rational(1, 3), x) == (True, 3)
380.     assert _has_rational_power(sqrt(x)*x**Rational(1, 3), x) == (True, 6)
381. 
382. 
383. def test_solveset_sqrt_1():
384.     assert solveset_real(sqrt(5*x + 6) - 2 - x, x) == \
385.         FiniteSet(-S.One, S(2))
386.     assert solveset_real(sqrt(x - 1) - x + 7, x) == FiniteSet(10)
387.     assert solveset_real(sqrt(x - 2) - 5, x) == FiniteSet(27)
388.     assert solveset_real(sqrt(x) - 2 - 5, x) == FiniteSet(49)
389.     assert solveset_real(sqrt(x**3), x) == FiniteSet(0)
390.     assert solveset_real(sqrt(x - 1), x) == FiniteSet(1)
391. 
392. 
393. def test_solveset_sqrt_2():
394.     # http://tutorial.math.lamar.edu/Classes/Alg/SolveRadicalEqns.aspx#Solve_Rad_Ex2_a
395.     assert solveset_real(sqrt(2*x - 1) - sqrt(x - 4) - 2, x) == \
396.         FiniteSet(S(5), S(13))
397.     assert solveset_real(sqrt(x + 7) + 2 - sqrt(3 - x), x) == \
398.         FiniteSet(-6)
399. 
400.     # http://www.purplemath.com/modules/solverad.htm
401.     assert solveset_real(sqrt(17*x - sqrt(x**2 - 5)) - 7, x) == \
402.         FiniteSet(3)
403. 
404.     eq = x + 1 - (x**4 + 4*x**3 - x)**Rational(1, 4)
405.     assert solveset_real(eq, x) == FiniteSet(Rational(-1, 2), Rational(-1, 3))
406. 
407.     eq = sqrt(2*x + 9) - sqrt(x + 1) - sqrt(x + 4)
408.     assert solveset_real(eq, x) == FiniteSet(0)
409. 
410.     eq = sqrt(x + 4) + sqrt(2*x - 1) - 3*sqrt(x - 1)
411.     assert solveset_real(eq, x) == FiniteSet(5)
412. 
413.     eq = sqrt(x)*sqrt(x - 7) - 12
414.     assert solveset_real(eq, x) == FiniteSet(16)
415. 
416.     eq = sqrt(x - 3) + sqrt(x) - 3
417.     assert solveset_real(eq, x) == FiniteSet(4)
418. 
419.     eq = sqrt(2*x**2 - 7) - (3 - x)
420.     assert solveset_real(eq, x) == FiniteSet(-S(8), S(2))
421. 
422.     # others
423.     eq = sqrt(9*x**2 + 4) - (3*x + 2)
424.     assert solveset_real(eq, x) == FiniteSet(0)
425. 
426.     assert solveset_real(sqrt(x - 3) - sqrt(x) - 3, x) == FiniteSet()
427. 
428.     eq = (2*x - 5)**Rational(1, 3) - 3
429.     assert solveset_real(eq, x) == FiniteSet(16)
430. 
431.     assert solveset_real(sqrt(x) + sqrt(sqrt(x)) - 4, x) == \
432.         FiniteSet((Rational(-1, 2) + sqrt(17)/2)**4)
433. 
434.     eq = sqrt(x) - sqrt(x - 1) + sqrt(sqrt(x))
435.     assert solveset_real(eq, x) == FiniteSet()
436. 
437.     eq = (sqrt(x) + sqrt(x + 1) + sqrt(1 - x) - 6*sqrt(5)/5)
438.     ans = solveset_real(eq, x)
439.     ra = S('''-1484/375 - 4*(-1/2 + sqrt(3)*I/2)*(-12459439/52734375 +
440.     114*sqrt(12657)/78125)**(1/3) - 172564/(140625*(-1/2 +
441.     sqrt(3)*I/2)*(-12459439/52734375 + 114*sqrt(12657)/78125)**(1/3))''')
442.     rb = Rational(4, 5)
443.     assert all(abs(eq.subs(x, i).n()) < 1e-10 for i in (ra, rb)) and \
444.         len(ans) == 2 and \
445.         set([i.n(chop=True) for i in ans]) == \
446.         set([i.n(chop=True) for i in (ra, rb)])
447. 
448.     assert solveset_real(sqrt(x) + x**Rational(1, 3) +
449.                                  x**Rational(1, 4), x) == FiniteSet(0)
450. 
451.     assert solveset_real(x/sqrt(x**2 + 1), x) == FiniteSet(0)
452. 
453.     eq = (x - y**3)/((y**2)*sqrt(1 - y**2))
454.     assert solveset_real(eq, x) == FiniteSet(y**3)
455. 
456.     # issue 4497
457.     assert solveset_real(1/(5 + x)**Rational(1, 5) - 9, x) == \
458.         FiniteSet(Rational(-295244, 59049))
459. 
460. 
461. @XFAIL
462. def test_solve_sqrt_fail():
463.     # this only works if we check real_root(eq.subs(x, Rational(1, 3)))
464.     # but checksol doesn't work like that
465.     eq = (x**3 - 3*x**2)**Rational(1, 3) + 1 - x
466.     assert solveset_real(eq, x) == FiniteSet(Rational(1, 3))
467. 
468. 
469. @slow
470. def test_solve_sqrt_3():
471.     R = Symbol('R')
472.     eq = sqrt(2)*R*sqrt(1/(R + 1)) + (R + 1)*(sqrt(2)*sqrt(1/(R + 1)) - 1)
473.     sol = solveset_complex(eq, R)
474.     fset = [Rational(5, 3) + 4*sqrt(10)*cos(atan(3*sqrt(111)/251)/3)/3,
475.             -sqrt(10)*cos(atan(3*sqrt(111)/251)/3)/3 +
476.             40*re(1/((Rational(-1, 2) - sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9 +
477.             sqrt(30)*sin(atan(3*sqrt(111)/251)/3)/3 + Rational(5, 3) +
478.             I*(-sqrt(30)*cos(atan(3*sqrt(111)/251)/3)/3 -
479.                sqrt(10)*sin(atan(3*sqrt(111)/251)/3)/3 +
480.                40*im(1/((Rational(-1, 2) - sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9)]
481.     cset = [40*re(1/((Rational(-1, 2) + sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9 -
482.             sqrt(10)*cos(atan(3*sqrt(111)/251)/3)/3 - sqrt(30)*sin(atan(3*sqrt(111)/251)/3)/3 +
483.             Rational(5, 3) +
484.             I*(40*im(1/((Rational(-1, 2) + sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9 -
485.                sqrt(10)*sin(atan(3*sqrt(111)/251)/3)/3 +
486.                sqrt(30)*cos(atan(3*sqrt(111)/251)/3)/3)]
487. 
488.     assert sol._args[0] == FiniteSet(*fset)
489.     assert sol._args[1] == ConditionSet(
490.         R,
491.         Eq(sqrt(2)*R*sqrt(1/(R + 1)) + (R + 1)*(sqrt(2)*sqrt(1/(R + 1)) - 1), 0),
492.         FiniteSet(*cset))
493. 
494.     # the number of real roots will depend on the value of m: for m=1 there are 4
495.     # and for m=-1 there are none.
496.     eq = -sqrt((m - q)**2 + (-m/(2*q) + S.Half)**2) + sqrt((-m**2/2 - sqrt(
497.         4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2 + (m**2/2 - m - sqrt(
498.             4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2)
499.     unsolved_object = ConditionSet(q, Eq(sqrt((m - q)**2 + (-m/(2*q) + S.Half)**2) -
500.         sqrt((-m**2/2 - sqrt(4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2 + (m**2/2 - m -


File: sympy/solvers/tests/test_solveset.py
Line number range: 501 - 2000
Content:
501.         sqrt(4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2), 0), S.Reals)
502.     assert solveset_real(eq, q) == unsolved_object
503. 
504. 
505. def test_solve_polynomial_symbolic_param():
506.     assert solveset_complex((x**2 - 1)**2 - a, x) == \
507.         FiniteSet(sqrt(1 + sqrt(a)), -sqrt(1 + sqrt(a)),
508.                   sqrt(1 - sqrt(a)), -sqrt(1 - sqrt(a)))
509. 
510.     # issue 4507
511.     assert solveset_complex(y - b/(1 + a*x), x) == \
512.         FiniteSet((b/y - 1)/a) - FiniteSet(-1/a)
513. 
514.     # issue 4508
515.     assert solveset_complex(y - b*x/(a + x), x) == \
516.         FiniteSet(-a*y/(y - b)) - FiniteSet(-a)
517. 
518. 
519. def test_solve_rational():
520.     assert solveset_real(1/x + 1, x) == FiniteSet(-S.One)
521.     assert solveset_real(1/exp(x) - 1, x) == FiniteSet(0)
522.     assert solveset_real(x*(1 - 5/x), x) == FiniteSet(5)
523.     assert solveset_real(2*x/(x + 2) - 1, x) == FiniteSet(2)
524.     assert solveset_real((x**2/(7 - x)).diff(x), x) == \
525.         FiniteSet(S.Zero, S(14))
526. 
527. 
528. def test_solveset_real_gen_is_pow():
529.     assert solveset_real(sqrt(1) + 1, x) == EmptySet()
530. 
531. 
532. def test_no_sol():
533.     assert solveset(1 - oo*x) == EmptySet()
534.     assert solveset(oo*x, x) == EmptySet()
535.     assert solveset(oo*x - oo, x) == EmptySet()
536.     assert solveset_real(4, x) == EmptySet()
537.     assert solveset_real(exp(x), x) == EmptySet()
538.     assert solveset_real(x**2 + 1, x) == EmptySet()
539.     assert solveset_real(-3*a/sqrt(x), x) == EmptySet()
540.     assert solveset_real(1/x, x) == EmptySet()
541.     assert solveset_real(-(1 + x)/(2 + x)**2 + 1/(2 + x), x) == \
542.         EmptySet()
543. 
544. 
545. def test_sol_zero_real():
546.     assert solveset_real(0, x) == S.Reals
547.     assert solveset(0, x, Interval(1, 2)) == Interval(1, 2)
548.     assert solveset_real(-x**2 - 2*x + (x + 1)**2 - 1, x) == S.Reals
549. 
550. 
551. def test_no_sol_rational_extragenous():
552.     assert solveset_real((x/(x + 1) + 3)**(-2), x) == EmptySet()
553.     assert solveset_real((x - 1)/(1 + 1/(x - 1)), x) == EmptySet()
554. 
555. 
556. def test_solve_polynomial_cv_1a():
557.     """
558.     Test for solving on equations that can be converted to
559.     a polynomial equation using the change of variable y -> x**Rational(p, q)
560.     """
561.     assert solveset_real(sqrt(x) - 1, x) == FiniteSet(1)
562.     assert solveset_real(sqrt(x) - 2, x) == FiniteSet(4)
563.     assert solveset_real(x**Rational(1, 4) - 2, x) == FiniteSet(16)
564.     assert solveset_real(x**Rational(1, 3) - 3, x) == FiniteSet(27)
565.     assert solveset_real(x*(x**(S.One / 3) - 3), x) == \
566.         FiniteSet(S.Zero, S(27))
567. 
568. 
569. def test_solveset_real_rational():
570.     """Test solveset_real for rational functions"""
571.     assert solveset_real((x - y**3) / ((y**2)*sqrt(1 - y**2)), x) \
572.         == FiniteSet(y**3)
573.     # issue 4486
574.     assert solveset_real(2*x/(x + 2) - 1, x) == FiniteSet(2)
575. 
576. 
577. def test_solveset_real_log():
578.     assert solveset_real(log((x-1)*(x+1)), x) == \
579.         FiniteSet(sqrt(2), -sqrt(2))
580. 
581. 
582. def test_poly_gens():
583.     assert solveset_real(4**(2*(x**2) + 2*x) - 8, x) == \
584.         FiniteSet(Rational(-3, 2), S.Half)
585. 
586. 
587. def test_solve_abs():
588.     x = Symbol('x')
589.     n = Dummy('n')
590.     raises(ValueError, lambda: solveset(Abs(x) - 1, x))
591.     assert solveset(Abs(x) - n, x, S.Reals) == ConditionSet(x, Contains(n, Interval(0, oo)), {-n, n})
592.     assert solveset_real(Abs(x) - 2, x) == FiniteSet(-2, 2)
593.     assert solveset_real(Abs(x) + 2, x) is S.EmptySet
594.     assert solveset_real(Abs(x + 3) - 2*Abs(x - 3), x) == \
595.         FiniteSet(1, 9)
596.     assert solveset_real(2*Abs(x) - Abs(x - 1), x) == \
597.         FiniteSet(-1, Rational(1, 3))
598. 
599.     sol = ConditionSet(
600.             x,
601.             And(
602.                 Contains(b, Interval(0, oo)),
603.                 Contains(a + b, Interval(0, oo)),
604.                 Contains(a - b, Interval(0, oo))),
605.             FiniteSet(-a - b - 3, -a + b - 3, a - b - 3, a + b - 3))
606.     eq = Abs(Abs(x + 3) - a) - b
607.     assert invert_real(eq, 0, x)[1] == sol
608.     reps = {a: 3, b: 1}
609.     eqab = eq.subs(reps)
610.     for i in sol.subs(reps):
611.         assert not eqab.subs(x, i)
612.     assert solveset(Eq(sin(Abs(x)), 1), x, domain=S.Reals) == Union(
613.         Intersection(Interval(0, oo),
614.             ImageSet(Lambda(n, (-1)**n*pi/2 + n*pi), S.Integers)),
615.         Intersection(Interval(-oo, 0),
616.             ImageSet(Lambda(n, n*pi - (-1)**(-n)*pi/2), S.Integers)))
617. 
618. 
619. 
620. def test_issue_9565():
621.     assert solveset_real(Abs((x - 1)/(x - 5)) <= Rational(1, 3), x) == Interval(-1, 2)
622. 
623. 
624. def test_issue_10069():
625.     eq = abs(1/(x - 1)) - 1 > 0
626.     u = Union(Interval.open(0, 1), Interval.open(1, 2))
627.     assert solveset_real(eq, x) == u
628. 
629. 
630. def test_real_imag_splitting():
631.     a, b = symbols('a b', real=True)
632.     assert solveset_real(sqrt(a**2 - b**2) - 3, a) == \
633.         FiniteSet(-sqrt(b**2 + 9), sqrt(b**2 + 9))
634.     assert solveset_real(sqrt(a**2 + b**2) - 3, a) != \
635.         S.EmptySet
636. 
637. 
638. def test_units():
639.     assert solveset_real(1/x - 1/(2*cm), x) == FiniteSet(2*cm)
640. 
641. 
642. def test_solve_only_exp_1():
643.     y = Symbol('y', positive=True)
644.     assert solveset_real(exp(x) - y, x) == FiniteSet(log(y))
645.     assert solveset_real(exp(x) + exp(-x) - 4, x) == \
646.         FiniteSet(log(-sqrt(3) + 2), log(sqrt(3) + 2))
647.     assert solveset_real(exp(x) + exp(-x) - y, x) != S.EmptySet
648. 
649. 
650. def test_atan2():
651.     # The .inverse() method on atan2 works only if x.is_real is True and the
652.     # second argument is a real constant
653.     assert solveset_real(atan2(x, 2) - pi/3, x) == FiniteSet(2*sqrt(3))
654. 
655. 
656. def test_piecewise_solveset():
657.     eq = Piecewise((x - 2, Gt(x, 2)), (2 - x, True)) - 3
658.     assert set(solveset_real(eq, x)) == set(FiniteSet(-1, 5))
659. 
660.     absxm3 = Piecewise(
661.         (x - 3, 0 <= x - 3),
662.         (3 - x, 0 > x - 3))
663.     y = Symbol('y', positive=True)
664.     assert solveset_real(absxm3 - y, x) == FiniteSet(-y + 3, y + 3)
665. 
666.     f = Piecewise(((x - 2)**2, x >= 0), (0, True))
667.     assert solveset(f, x, domain=S.Reals) == Union(FiniteSet(2), Interval(-oo, 0, True, True))
668. 
669.     assert solveset(
670.         Piecewise((x + 1, x > 0), (I, True)) - I, x, S.Reals
671.         ) == Interval(-oo, 0)
672. 
673.     assert solveset(Piecewise((x - 1, Ne(x, I)), (x, True)), x) == FiniteSet(1)
674. 
675. 
676. def test_solveset_complex_polynomial():
677.     from sympy.abc import x, a, b, c
678.     assert solveset_complex(a*x**2 + b*x + c, x) == \
679.         FiniteSet(-b/(2*a) - sqrt(-4*a*c + b**2)/(2*a),
680.                   -b/(2*a) + sqrt(-4*a*c + b**2)/(2*a))
681. 
682.     assert solveset_complex(x - y**3, y) == FiniteSet(
683.         (-x**Rational(1, 3))/2 + I*sqrt(3)*x**Rational(1, 3)/2,
684.         x**Rational(1, 3),
685.         (-x**Rational(1, 3))/2 - I*sqrt(3)*x**Rational(1, 3)/2)
686. 
687.     assert solveset_complex(x + 1/x - 1, x) == \
688.         FiniteSet(S.Half + I*sqrt(3)/2, S.Half - I*sqrt(3)/2)
689. 
690. 
691. def test_sol_zero_complex():
692.     assert solveset_complex(0, x) == S.Complexes
693. 
694. 
695. def test_solveset_complex_rational():
696.     assert solveset_complex((x - 1)*(x - I)/(x - 3), x) == \
697.         FiniteSet(1, I)
698. 
699.     assert solveset_complex((x - y**3)/((y**2)*sqrt(1 - y**2)), x) == \
700.         FiniteSet(y**3)
701.     assert solveset_complex(-x**2 - I, x) == \
702.         FiniteSet(-sqrt(2)/2 + sqrt(2)*I/2, sqrt(2)/2 - sqrt(2)*I/2)
703. 
704. 
705. def test_solve_quintics():
706.     skip("This test is too slow")
707.     f = x**5 - 110*x**3 - 55*x**2 + 2310*x + 979
708.     s = solveset_complex(f, x)
709.     for root in s:
710.         res = f.subs(x, root.n()).n()
711.         assert tn(res, 0)
712. 
713.     f = x**5 + 15*x + 12
714.     s = solveset_complex(f, x)
715.     for root in s:
716.         res = f.subs(x, root.n()).n()
717.         assert tn(res, 0)
718. 
719. 
720. def test_solveset_complex_exp():
721.     from sympy.abc import x, n
722.     assert solveset_complex(exp(x) - 1, x) == \
723.         imageset(Lambda(n, I*2*n*pi), S.Integers)
724.     assert solveset_complex(exp(x) - I, x) == \
725.         imageset(Lambda(n, I*(2*n*pi + pi/2)), S.Integers)
726.     assert solveset_complex(1/exp(x), x) == S.EmptySet
727.     assert solveset_complex(sinh(x).rewrite(exp), x) == \
728.         imageset(Lambda(n, n*pi*I), S.Integers)
729. 
730. 
731. def test_solveset_real_exp():
732.     from sympy.abc import x, y
733.     assert solveset(Eq((-2)**x, 4), x, S.Reals) == FiniteSet(2)
734.     assert solveset(Eq(-2**x, 4), x, S.Reals) == S.EmptySet
735.     assert solveset(Eq((-3)**x, 27), x, S.Reals) == S.EmptySet
736.     assert solveset(Eq((-5)**(x+1), 625), x, S.Reals) == FiniteSet(3)
737.     assert solveset(Eq(2**(x-3), -16), x, S.Reals) == S.EmptySet
738.     assert solveset(Eq((-3)**(x - 3), -3**39), x, S.Reals) == FiniteSet(42)
739.     assert solveset(Eq(2**x, y), x, S.Reals) == Intersection(S.Reals, FiniteSet(log(y)/log(2)))
740. 
741.     assert invert_real((-2)**(2*x) - 16, 0, x) == (x, FiniteSet(2))
742. 
743. 
744. def test_solve_complex_log():
745.     assert solveset_complex(log(x), x) == FiniteSet(1)
746.     assert solveset_complex(1 - log(a + 4*x**2), x) == \
747.         FiniteSet(-sqrt(-a + E)/2, sqrt(-a + E)/2)
748. 
749. 
750. def test_solve_complex_sqrt():
751.     assert solveset_complex(sqrt(5*x + 6) - 2 - x, x) == \
752.         FiniteSet(-S.One, S(2))
753.     assert solveset_complex(sqrt(5*x + 6) - (2 + 2*I) - x, x) == \
754.         FiniteSet(-S(2), 3 - 4*I)
755.     assert solveset_complex(4*x*(1 - a * sqrt(x)), x) == \
756.         FiniteSet(S.Zero, 1 / a ** 2)
757. 
758. 
759. def test_solveset_complex_tan():
760.     s = solveset_complex(tan(x).rewrite(exp), x)
761.     assert s == imageset(Lambda(n, pi*n), S.Integers) - \
762.         imageset(Lambda(n, pi*n + pi/2), S.Integers)
763. 
764. 
765. @nocache_fail
766. def test_solve_trig():
767.     from sympy.abc import n
768.     assert solveset_real(sin(x), x) == \
769.         Union(imageset(Lambda(n, 2*pi*n), S.Integers),
770.               imageset(Lambda(n, 2*pi*n + pi), S.Integers))
771. 
772.     assert solveset_real(sin(x) - 1, x) == \
773.         imageset(Lambda(n, 2*pi*n + pi/2), S.Integers)
774. 
775.     assert solveset_real(cos(x), x) == \
776.         Union(imageset(Lambda(n, 2*pi*n + pi/2), S.Integers),
777.               imageset(Lambda(n, 2*pi*n + pi*Rational(3, 2)), S.Integers))
778. 
779.     assert solveset_real(sin(x) + cos(x), x) == \
780.         Union(imageset(Lambda(n, 2*n*pi + pi*Rational(3, 4)), S.Integers),
781.               imageset(Lambda(n, 2*n*pi + pi*Rational(7, 4)), S.Integers))
782. 
783.     assert solveset_real(sin(x)**2 + cos(x)**2, x) == S.EmptySet
784. 
785.     # This fails when running with the cache off:
786.     assert solveset_complex(cos(x) - S.Half, x) == \
787.         Union(imageset(Lambda(n, 2*n*pi + pi*Rational(5, 3)), S.Integers),
788.               imageset(Lambda(n, 2*n*pi + pi/3), S.Integers))
789. 
790.     y, a = symbols('y,a')
791.     assert solveset(sin(y + a) - sin(y), a, domain=S.Reals) == \
792.         Union(ImageSet(Lambda(n, 2*n*pi), S.Integers),
793.         Intersection(ImageSet(Lambda(n, -I*(I*(
794.         2*n*pi + arg(-exp(-2*I*y))) +
795.         2*im(y))), S.Integers), S.Reals))
796. 
797.     assert solveset_real(sin(2*x)*cos(x) + cos(2*x)*sin(x)-1, x) == \
798.                             ImageSet(Lambda(n, n*pi*Rational(2, 3) + pi/6), S.Integers)
799. 
800.     # Tests for _solve_trig2() function
801.     assert solveset_real(2*cos(x)*cos(2*x) - 1, x) == \
802.           Union(ImageSet(Lambda(n, 2*n*pi + 2*atan(sqrt(-2*2**Rational(1, 3)*(67 +
803.                   9*sqrt(57))**Rational(2, 3) + 8*2**Rational(2, 3) + 11*(67 +
804.                   9*sqrt(57))**Rational(1, 3))/(3*(67 + 9*sqrt(57))**Rational(1, 6)))), S.Integers),
805.                   ImageSet(Lambda(n, 2*n*pi - 2*atan(sqrt(-2*2**Rational(1, 3)*(67 +
806.                   9*sqrt(57))**Rational(2, 3) + 8*2**Rational(2, 3) + 11*(67 +
807.                   9*sqrt(57))**Rational(1, 3))/(3*(67 + 9*sqrt(57))**Rational(1, 6))) +
808.                   2*pi), S.Integers))
809. 
810.     assert solveset_real(2*tan(x)*sin(x) + 1, x) == Union(
811.         ImageSet(Lambda(n, 2*n*pi + atan(sqrt(2)*sqrt(-1 +sqrt(17))/
812.             (1 - sqrt(17))) + pi), S.Integers),
813.         ImageSet(Lambda(n, 2*n*pi - atan(sqrt(2)*sqrt(-1 + sqrt(17))/
814.             (1 - sqrt(17))) + pi), S.Integers))
815. 
816.     assert solveset_real(cos(2*x)*cos(4*x) - 1, x) == \
817.                             ImageSet(Lambda(n, n*pi), S.Integers)
818. 
819. 
820. def test_solve_hyperbolic():
821.     # actual solver: _solve_trig1
822.     n = Dummy('n')
823.     assert solveset(sinh(x) + cosh(x), x) == S.EmptySet
824.     assert solveset(sinh(x) + cos(x), x) == ConditionSet(x,
825.         Eq(cos(x) + sinh(x), 0), S.Complexes)
826.     assert solveset_real(sinh(x) + sech(x), x) == FiniteSet(
827.         log(sqrt(sqrt(5) - 2)))
828.     assert solveset_real(3*cosh(2*x) - 5, x) == FiniteSet(
829.         log(sqrt(3)/3), log(sqrt(3)))
830.     assert solveset_real(sinh(x - 3) - 2, x) == FiniteSet(
831.         log((2 + sqrt(5))*exp(3)))
832.     assert solveset_real(cosh(2*x) + 2*sinh(x) - 5, x) == FiniteSet(
833.         log(-2 + sqrt(5)), log(1 + sqrt(2)))
834.     assert solveset_real((coth(x) + sinh(2*x))/cosh(x) - 3, x) == FiniteSet(
835.         log(S.Half + sqrt(5)/2), log(1 + sqrt(2)))
836.     assert solveset_real(cosh(x)*sinh(x) - 2, x) == FiniteSet(
837.         log(sqrt(4 + sqrt(17))))
838.     assert solveset_real(sinh(x) + tanh(x) - 1, x) == FiniteSet(
839.         log(sqrt(2)/2 + sqrt(-S(1)/2 + sqrt(2))))
840.     assert solveset_complex(sinh(x) - I/2, x) == Union(
841.         ImageSet(Lambda(n, I*(2*n*pi + 5*pi/6)), S.Integers),
842.         ImageSet(Lambda(n, I*(2*n*pi + pi/6)), S.Integers))
843.     assert solveset_complex(sinh(x) + sech(x), x) == Union(
844.         ImageSet(Lambda(n, 2*n*I*pi + log(sqrt(-2 + sqrt(5)))), S.Integers),
845.         ImageSet(Lambda(n, I*(2*n*pi + pi/2) + log(sqrt(2 + sqrt(5)))), S.Integers),
846.         ImageSet(Lambda(n, I*(2*n*pi + pi) + log(sqrt(-2 + sqrt(5)))), S.Integers),
847.         ImageSet(Lambda(n, I*(2*n*pi - pi/2) + log(sqrt(2 + sqrt(5)))), S.Integers))
848.     # issues #9606 / #9531:
849.     assert solveset(sinh(x), x, S.Reals) == FiniteSet(0)
850.     assert solveset(sinh(x), x, S.Complexes) == Union(
851.         ImageSet(Lambda(n, I*(2*n*pi + pi)), S.Integers),
852.         ImageSet(Lambda(n, 2*n*I*pi), S.Integers))
853. 
854. 
855. def test_solve_invalid_sol():
856.     assert 0 not in solveset_real(sin(x)/x, x)
857.     assert 0 not in solveset_complex((exp(x) - 1)/x, x)
858. 
859. 
860. @XFAIL
861. def test_solve_trig_simplified():
862.     from sympy.abc import n
863.     assert solveset_real(sin(x), x) == \
864.         imageset(Lambda(n, n*pi), S.Integers)
865. 
866.     assert solveset_real(cos(x), x) == \
867.         imageset(Lambda(n, n*pi + pi/2), S.Integers)
868. 
869.     assert solveset_real(cos(x) + sin(x), x) == \
870.         imageset(Lambda(n, n*pi - pi/4), S.Integers)
871. 
872. 
873. @XFAIL
874. def test_solve_lambert():
875.     assert solveset_real(x*exp(x) - 1, x) == FiniteSet(LambertW(1))
876.     assert solveset_real(exp(x) + x, x) == FiniteSet(-LambertW(1))
877.     assert solveset_real(x + 2**x, x) == \
878.         FiniteSet(-LambertW(log(2))/log(2))
879. 
880.     # issue 4739
881.     ans = solveset_real(3*x + 5 + 2**(-5*x + 3), x)
882.     assert ans == FiniteSet(Rational(-5, 3) +
883.                             LambertW(-10240*2**Rational(1, 3)*log(2)/3)/(5*log(2)))
884. 
885.     eq = 2*(3*x + 4)**5 - 6*7**(3*x + 9)
886.     result = solveset_real(eq, x)
887.     ans = FiniteSet((log(2401) +
888.                      5*LambertW(-log(7**(7*3**Rational(1, 5)/5))))/(3*log(7))/-1)
889.     assert result == ans
890.     assert solveset_real(eq.expand(), x) == result
891. 
892.     assert solveset_real(5*x - 1 + 3*exp(2 - 7*x), x) == \
893.         FiniteSet(Rational(1, 5) + LambertW(-21*exp(Rational(3, 5))/5)/7)
894. 
895.     assert solveset_real(2*x + 5 + log(3*x - 2), x) == \
896.         FiniteSet(Rational(2, 3) + LambertW(2*exp(Rational(-19, 3))/3)/2)
897. 
898.     assert solveset_real(3*x + log(4*x), x) == \
899.         FiniteSet(LambertW(Rational(3, 4))/3)
900. 
901.     assert solveset_real(x**x - 2) == FiniteSet(exp(LambertW(log(2))))
902. 
903.     a = Symbol('a')
904.     assert solveset_real(-a*x + 2*x*log(x), x) == FiniteSet(exp(a/2))
905.     a = Symbol('a', real=True)
906.     assert solveset_real(a/x + exp(x/2), x) == \
907.         FiniteSet(2*LambertW(-a/2))
908.     assert solveset_real((a/x + exp(x/2)).diff(x), x) == \
909.         FiniteSet(4*LambertW(sqrt(2)*sqrt(a)/4))
910. 
911.     # coverage test
912.     assert solveset_real(tanh(x + 3)*tanh(x - 3) - 1, x) == EmptySet()
913. 
914.     assert solveset_real((x**2 - 2*x + 1).subs(x, log(x) + 3*x), x) == \
915.         FiniteSet(LambertW(3*S.Exp1)/3)
916.     assert solveset_real((x**2 - 2*x + 1).subs(x, (log(x) + 3*x)**2 - 1), x) == \
917.         FiniteSet(LambertW(3*exp(-sqrt(2)))/3, LambertW(3*exp(sqrt(2)))/3)
918.     assert solveset_real((x**2 - 2*x - 2).subs(x, log(x) + 3*x), x) == \
919.         FiniteSet(LambertW(3*exp(1 + sqrt(3)))/3, LambertW(3*exp(-sqrt(3) + 1))/3)
920.     assert solveset_real(x*log(x) + 3*x + 1, x) == \
921.         FiniteSet(exp(-3 + LambertW(-exp(3))))
922.     eq = (x*exp(x) - 3).subs(x, x*exp(x))
923.     assert solveset_real(eq, x) == \
924.         FiniteSet(LambertW(3*exp(-LambertW(3))))
925. 
926.     assert solveset_real(3*log(a**(3*x + 5)) + a**(3*x + 5), x) == \
927.         FiniteSet(-((log(a**5) + LambertW(Rational(1, 3)))/(3*log(a))))
928.     p = symbols('p', positive=True)
929.     assert solveset_real(3*log(p**(3*x + 5)) + p**(3*x + 5), x) == \
930.         FiniteSet(
931.         log((-3**Rational(1, 3) - 3**Rational(5, 6)*I)*LambertW(Rational(1, 3))**Rational(1, 3)/(2*p**Rational(5, 3)))/log(p),
932.         log((-3**Rational(1, 3) + 3**Rational(5, 6)*I)*LambertW(Rational(1, 3))**Rational(1, 3)/(2*p**Rational(5, 3)))/log(p),
933.         log((3*LambertW(Rational(1, 3))/p**5)**(1/(3*log(p)))),)  # checked numerically
934.     # check collection
935.     b = Symbol('b')
936.     eq = 3*log(a**(3*x + 5)) + b*log(a**(3*x + 5)) + a**(3*x + 5)
937.     assert solveset_real(eq, x) == FiniteSet(
938.         -((log(a**5) + LambertW(1/(b + 3)))/(3*log(a))))
939. 
940.     # issue 4271
941.     assert solveset_real((a/x + exp(x/2)).diff(x, 2), x) == FiniteSet(
942.         6*LambertW((-1)**Rational(1, 3)*a**Rational(1, 3)/3))
943. 
944.     assert solveset_real(x**3 - 3**x, x) == \
945.         FiniteSet(-3/log(3)*LambertW(-log(3)/3))
946.     assert solveset_real(3**cos(x) - cos(x)**3) == FiniteSet(
947.         acos(-3*LambertW(-log(3)/3)/log(3)))
948. 
949.     assert solveset_real(x**2 - 2**x, x) == \
950.         solveset_real(-x**2 + 2**x, x)
951. 
952.     assert solveset_real(3*log(x) - x*log(3)) == FiniteSet(
953.         -3*LambertW(-log(3)/3)/log(3),
954.         -3*LambertW(-log(3)/3, -1)/log(3))
955. 
956.     assert solveset_real(LambertW(2*x) - y) == FiniteSet(
957.         y*exp(y)/2)
958. 
959. 
960. @XFAIL
961. def test_other_lambert():
962.     a = Rational(6, 5)
963.     assert solveset_real(x**a - a**x, x) == FiniteSet(
964.         a, -a*LambertW(-log(a)/a)/log(a))
965. 
966. 
967. def test_solveset():
968.     x = Symbol('x')
969.     f = Function('f')
970.     raises(ValueError, lambda: solveset(x + y))
971.     assert solveset(x, 1) == S.EmptySet
972.     assert solveset(f(1)**2 + y + 1, f(1)
973.         ) == FiniteSet(-sqrt(-y - 1), sqrt(-y - 1))
974.     assert solveset(f(1)**2 - 1, f(1), S.Reals) == FiniteSet(-1, 1)
975.     assert solveset(f(1)**2 + 1, f(1)) == FiniteSet(-I, I)
976.     assert solveset(x - 1, 1) == FiniteSet(x)
977.     assert solveset(sin(x) - cos(x), sin(x)) == FiniteSet(cos(x))
978. 
979.     assert solveset(0, domain=S.Reals) == S.Reals
980.     assert solveset(1) == S.EmptySet
981.     assert solveset(True, domain=S.Reals) == S.Reals  # issue 10197
982.     assert solveset(False, domain=S.Reals) == S.EmptySet
983. 
984.     assert solveset(exp(x) - 1, domain=S.Reals) == FiniteSet(0)
985.     assert solveset(exp(x) - 1, x, S.Reals) == FiniteSet(0)
986.     assert solveset(Eq(exp(x), 1), x, S.Reals) == FiniteSet(0)
987.     assert solveset(exp(x) - 1, exp(x), S.Reals) == FiniteSet(1)
988.     A = Indexed('A', x)
989.     assert solveset(A - 1, A, S.Reals) == FiniteSet(1)
990. 
991.     assert solveset(x - 1 >= 0, x, S.Reals) == Interval(1, oo)
992.     assert solveset(exp(x) - 1 >= 0, x, S.Reals) == Interval(0, oo)
993. 
994.     assert solveset(exp(x) - 1, x) == imageset(Lambda(n, 2*I*pi*n), S.Integers)
995.     assert solveset(Eq(exp(x), 1), x) == imageset(Lambda(n, 2*I*pi*n),
996.                                                   S.Integers)
997.     # issue 13825
998.     assert solveset(x**2 + f(0) + 1, x) == {-sqrt(-f(0) - 1), sqrt(-f(0) - 1)}
999. 
1000. 
1001. def test__solveset_multi():
1002.     from sympy.solvers.solveset import _solveset_multi
1003.     from sympy import Reals
1004. 
1005.     # Basic univariate case:
1006.     from sympy.abc import x
1007.     assert _solveset_multi([x**2-1], [x], [S.Reals]) == FiniteSet((1,), (-1,))
1008. 
1009.     # Linear systems of two equations
1010.     from sympy.abc import x, y
1011.     assert _solveset_multi([x+y, x+1], [x, y], [Reals, Reals]) == FiniteSet((-1, 1))
1012.     assert _solveset_multi([x+y, x+1], [y, x], [Reals, Reals]) == FiniteSet((1, -1))
1013.     assert _solveset_multi([x+y, x-y-1], [x, y], [Reals, Reals]) == FiniteSet((S(1)/2, -S(1)/2))
1014.     assert _solveset_multi([x-1, y-2], [x, y], [Reals, Reals]) == FiniteSet((1, 2))
1015.     #assert _solveset_multi([x+y], [x, y], [Reals, Reals]) == ImageSet(Lambda(x, (x, -x)), Reals)
1016.     assert _solveset_multi([x+y], [x, y], [Reals, Reals]) == Union(
1017.             ImageSet(Lambda(((x,),), (x, -x)), ProductSet(Reals)),
1018.             ImageSet(Lambda(((y,),), (-y, y)), ProductSet(Reals)))
1019.     assert _solveset_multi([x+y, x+y+1], [x, y], [Reals, Reals]) == S.EmptySet
1020.     assert _solveset_multi([x+y, x-y, x-1], [x, y], [Reals, Reals]) == S.EmptySet
1021.     assert _solveset_multi([x+y, x-y, x-1], [y, x], [Reals, Reals]) == S.EmptySet
1022. 
1023.     # Systems of three equations:
1024.     from sympy.abc import x, y, z
1025.     assert _solveset_multi([x+y+z-1, x+y-z-2, x-y-z-3], [x, y, z], [Reals,
1026.         Reals, Reals]) == FiniteSet((2, -S.Half, -S.Half))
1027. 
1028.     # Nonlinear systems:
1029.     from sympy.abc import r, theta, z, x, y
1030.     assert _solveset_multi([x**2+y**2-2, x+y], [x, y], [Reals, Reals]) == FiniteSet((-1, 1), (1, -1))
1031.     assert _solveset_multi([x**2-1, y], [x, y], [Reals, Reals]) == FiniteSet((1, 0), (-1, 0))
1032.     #assert _solveset_multi([x**2-y**2], [x, y], [Reals, Reals]) == Union(
1033.     #        ImageSet(Lambda(x, (x, -x)), Reals), ImageSet(Lambda(x, (x, x)), Reals))
1034.     assert _solveset_multi([x**2-y**2], [x, y], [Reals, Reals]) == Union(
1035.             ImageSet(Lambda(((x,),), (x, -Abs(x))), ProductSet(Reals)),
1036.             ImageSet(Lambda(((x,),), (x, Abs(x))), ProductSet(Reals)),
1037.             ImageSet(Lambda(((y,),), (-Abs(y), y)), ProductSet(Reals)),
1038.             ImageSet(Lambda(((y,),), (Abs(y), y)), ProductSet(Reals)))
1039.     assert _solveset_multi([r*cos(theta)-1, r*sin(theta)], [theta, r],
1040.             [Interval(0, pi), Interval(-1, 1)]) == FiniteSet((0, 1), (pi, -1))
1041.     assert _solveset_multi([r*cos(theta)-1, r*sin(theta)], [r, theta],
1042.             [Interval(0, 1), Interval(0, pi)]) == FiniteSet((1, 0))
1043.     #assert _solveset_multi([r*cos(theta)-r, r*sin(theta)], [r, theta],
1044.     #        [Interval(0, 1), Interval(0, pi)]) == ?
1045.     assert _solveset_multi([r*cos(theta)-r, r*sin(theta)], [r, theta],
1046.             [Interval(0, 1), Interval(0, pi)]) == Union(
1047.             ImageSet(Lambda(((r,),), (r, 0)), ImageSet(Lambda(r, (r,)), Interval(0, 1))),
1048.             ImageSet(Lambda(((theta,),), (0, theta)), ImageSet(Lambda(theta, (theta,)), Interval(0, pi))))
1049. 
1050. 
1051. def test_conditionset():
1052.     assert solveset(Eq(sin(x)**2 + cos(x)**2, 1), x, domain=S.Reals) == \
1053.         ConditionSet(x, True, S.Reals)
1054. 
1055.     assert solveset(Eq(x**2 + x*sin(x), 1), x, domain=S.Reals
1056.         ) == ConditionSet(x, Eq(x**2 + x*sin(x) - 1, 0), S.Reals)
1057. 
1058.     assert solveset(Eq(-I*(exp(I*x) - exp(-I*x))/2, 1), x
1059.         ) == imageset(Lambda(n, 2*n*pi + pi/2), S.Integers)
1060. 
1061.     assert solveset(x + sin(x) > 1, x, domain=S.Reals
1062.         ) == ConditionSet(x, x + sin(x) > 1, S.Reals)
1063. 
1064.     assert solveset(Eq(sin(Abs(x)), x), x, domain=S.Reals
1065.         ) == ConditionSet(x, Eq(-x + sin(Abs(x)), 0), S.Reals)
1066. 
1067.     assert solveset(y**x-z, x, S.Reals) == \
1068.         ConditionSet(x, Eq(y**x - z, 0), S.Reals)
1069. 
1070. 
1071. @XFAIL
1072. def test_conditionset_equality():
1073.     ''' Checking equality of different representations of ConditionSet'''
1074.     assert solveset(Eq(tan(x), y), x) == ConditionSet(x, Eq(tan(x), y), S.Complexes)
1075. 
1076. 
1077. def test_solveset_domain():
1078.     x = Symbol('x')
1079. 
1080.     assert solveset(x**2 - x - 6, x, Interval(0, oo)) == FiniteSet(3)
1081.     assert solveset(x**2 - 1, x, Interval(0, oo)) == FiniteSet(1)
1082.     assert solveset(x**4 - 16, x, Interval(0, 10)) == FiniteSet(2)
1083. 
1084. 
1085. def test_improve_coverage():
1086.     from sympy.solvers.solveset import _has_rational_power
1087.     x = Symbol('x')
1088.     solution = solveset(exp(x) + sin(x), x, S.Reals)
1089.     unsolved_object = ConditionSet(x, Eq(exp(x) + sin(x), 0), S.Reals)
1090.     assert solution == unsolved_object
1091. 
1092.     assert _has_rational_power(sin(x)*exp(x) + 1, x) == (False, S.One)
1093.     assert _has_rational_power((sin(x)**2)*(exp(x) + 1)**3, x) == (False, S.One)
1094. 
1095. 
1096. def test_issue_9522():
1097.     x = Symbol('x')
1098.     expr1 = Eq(1/(x**2 - 4) + x, 1/(x**2 - 4) + 2)
1099.     expr2 = Eq(1/x + x, 1/x)
1100. 
1101.     assert solveset(expr1, x, S.Reals) == EmptySet()
1102.     assert solveset(expr2, x, S.Reals) == EmptySet()
1103. 
1104. 
1105. def test_solvify():
1106.     x = Symbol('x')
1107. 
1108.     assert solvify(x**2 + 10, x, S.Reals) == []
1109.     assert solvify(x**3 + 1, x, S.Complexes) == [-1, S.Half - sqrt(3)*I/2,
1110.                                                  S.Half + sqrt(3)*I/2]
1111.     assert solvify(log(x), x, S.Reals) == [1]
1112.     assert solvify(cos(x), x, S.Reals) == [pi/2, pi*Rational(3, 2)]
1113.     assert solvify(sin(x) + 1, x, S.Reals) == [pi*Rational(3, 2)]
1114.     raises(NotImplementedError, lambda: solvify(sin(exp(x)), x, S.Complexes))
1115. 
1116. 
1117. def test_abs_invert_solvify():
1118.     assert solvify(sin(Abs(x)), x, S.Reals) is None
1119. 
1120. 
1121. def test_linear_eq_to_matrix():
1122.     x, y, z = symbols('x, y, z')
1123.     a, b, c, d, e, f, g, h, i, j, k, l = symbols('a:l')
1124. 
1125.     eqns1 = [2*x + y - 2*z - 3, x - y - z, x + y + 3*z - 12]
1126.     eqns2 = [Eq(3*x + 2*y - z, 1), Eq(2*x - 2*y + 4*z, -2), -2*x + y - 2*z]
1127. 
1128.     A, B = linear_eq_to_matrix(eqns1, x, y, z)
1129.     assert A == Matrix([[2, 1, -2], [1, -1, -1], [1, 1, 3]])
1130.     assert B == Matrix([[3], [0], [12]])
1131. 
1132.     A, B = linear_eq_to_matrix(eqns2, x, y, z)
1133.     assert A == Matrix([[3, 2, -1], [2, -2, 4], [-2, 1, -2]])
1134.     assert B == Matrix([[1], [-2], [0]])
1135. 
1136.     # Pure symbolic coefficients
1137.     eqns3 = [a*b*x + b*y + c*z - d, e*x + d*x + f*y + g*z - h, i*x + j*y + k*z - l]
1138.     A, B = linear_eq_to_matrix(eqns3, x, y, z)
1139.     assert A == Matrix([[a*b, b, c], [d + e, f, g], [i, j, k]])
1140.     assert B == Matrix([[d], [h], [l]])
1141. 
1142.     # raise ValueError if
1143.     # 1) no symbols are given
1144.     raises(ValueError, lambda: linear_eq_to_matrix(eqns3))
1145.     # 2) there are duplicates
1146.     raises(ValueError, lambda: linear_eq_to_matrix(eqns3, [x, x, y]))
1147.     # 3) there are non-symbols
1148.     raises(ValueError, lambda: linear_eq_to_matrix(eqns3, [x, 1/a, y]))
1149.     # 4) a nonlinear term is detected in the original expression
1150.     raises(ValueError, lambda: linear_eq_to_matrix(Eq(1/x + x, 1/x)))
1151. 
1152.     assert linear_eq_to_matrix(1, x) == (Matrix([[0]]), Matrix([[-1]]))
1153.     # issue 15195
1154.     assert linear_eq_to_matrix(x + y*(z*(3*x + 2) + 3), x) == (
1155.         Matrix([[3*y*z + 1]]), Matrix([[-y*(2*z + 3)]]))
1156.     assert linear_eq_to_matrix(Matrix(
1157.         [[a*x + b*y - 7], [5*x + 6*y - c]]), x, y) == (
1158.         Matrix([[a, b], [5, 6]]), Matrix([[7], [c]]))
1159. 
1160.     # issue 15312
1161.     assert linear_eq_to_matrix(Eq(x + 2, 1), x) == (
1162.         Matrix([[1]]), Matrix([[-1]]))
1163. 
1164. 
1165. def test_issue_16577():
1166.     assert linear_eq_to_matrix(Eq(a*(2*x + 3*y) + 4*y, 5), x, y) == (
1167.         Matrix([[2*a, 3*a + 4]]), Matrix([[5]]))
1168. 
1169. 
1170. def test_linsolve():
1171.     x, y, z, u, v, w = symbols("x, y, z, u, v, w")
1172.     x1, x2, x3, x4 = symbols('x1, x2, x3, x4')
1173. 
1174.     # Test for different input forms
1175. 
1176.     M = Matrix([[1, 2, 1, 1, 7], [1, 2, 2, -1, 12], [2, 4, 0, 6, 4]])
1177.     system1 = A, b = M[:, :-1], M[:, -1]
1178.     Eqns = [x1 + 2*x2 + x3 + x4 - 7, x1 + 2*x2 + 2*x3 - x4 - 12,
1179.             2*x1 + 4*x2 + 6*x4 - 4]
1180. 
1181.     sol = FiniteSet((-2*x2 - 3*x4 + 2, x2, 2*x4 + 5, x4))
1182.     assert linsolve(Eqns, (x1, x2, x3, x4)) == sol
1183.     assert linsolve(Eqns, *(x1, x2, x3, x4)) == sol
1184.     assert linsolve(system1, (x1, x2, x3, x4)) == sol
1185.     assert linsolve(system1, *(x1, x2, x3, x4)) == sol
1186.     # issue 9667 - symbols can be Dummy symbols
1187.     x1, x2, x3, x4 = symbols('x:4', cls=Dummy)
1188.     assert linsolve(system1, x1, x2, x3, x4) == FiniteSet(
1189.         (-2*x2 - 3*x4 + 2, x2, 2*x4 + 5, x4))
1190. 
1191.     # raise ValueError for garbage value
1192.     raises(ValueError, lambda: linsolve(Eqns))
1193.     raises(ValueError, lambda: linsolve(x1))
1194.     raises(ValueError, lambda: linsolve(x1, x2))
1195.     raises(ValueError, lambda: linsolve((A,), x1, x2))
1196.     raises(ValueError, lambda: linsolve(A, b, x1, x2))
1197. 
1198.     #raise ValueError if equations are non-linear in given variables
1199.     raises(ValueError, lambda: linsolve([x + y - 1, x ** 2 + y - 3], [x, y]))
1200.     raises(ValueError, lambda: linsolve([cos(x) + y, x + y], [x, y]))
1201.     assert linsolve([x + z - 1, x ** 2 + y - 3], [z, y]) == {(-x + 1, -x**2 + 3)}
1202. 
1203.     # Fully symbolic test
1204.     a, b, c, d, e, f = symbols('a, b, c, d, e, f')
1205.     A = Matrix([[a, b], [c, d]])
1206.     B = Matrix([[e], [f]])
1207.     system2 = (A, B)
1208.     sol = FiniteSet(((-b*f + d*e)/(a*d - b*c), (a*f - c*e)/(a*d - b*c)))
1209.     assert linsolve(system2, [x, y]) == sol
1210. 
1211.     # No solution
1212.     A = Matrix([[1, 2, 3], [2, 4, 6], [3, 6, 9]])
1213.     b = Matrix([0, 0, 1])
1214.     assert linsolve((A, b), (x, y, z)) == EmptySet()
1215. 
1216.     # Issue #10056
1217.     A, B, J1, J2 = symbols('A B J1 J2')
1218.     Augmatrix = Matrix([
1219.         [2*I*J1, 2*I*J2, -2/J1],
1220.         [-2*I*J2, -2*I*J1, 2/J2],
1221.         [0, 2, 2*I/(J1*J2)],
1222.         [2, 0,  0],
1223.         ])
1224. 
1225.     assert linsolve(Augmatrix, A, B) == FiniteSet((0, I/(J1*J2)))
1226. 
1227.     # Issue #10121 - Assignment of free variables
1228.     a, b, c, d, e = symbols('a, b, c, d, e')
1229.     Augmatrix = Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, 0]])
1230.     assert linsolve(Augmatrix, a, b, c, d, e) == FiniteSet((a, 0, c, 0, e))
1231.     raises(IndexError, lambda: linsolve(Augmatrix, a, b, c))
1232. 
1233.     x0, x1, x2, _x0 = symbols('tau0 tau1 tau2 _tau0')
1234.     assert linsolve(Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, _x0]])
1235.         ) == FiniteSet((x0, 0, x1, _x0, x2))
1236.     x0, x1, x2, _x0 = symbols('_tau0 _tau1 _tau2 tau0')
1237.     assert linsolve(Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, _x0]])
1238.         ) == FiniteSet((x0, 0, x1, _x0, x2))
1239.     x0, x1, x2, _x0 = symbols('_tau0 _tau1 _tau2 tau1')
1240.     assert linsolve(Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, _x0]])
1241.         ) == FiniteSet((x0, 0, x1, _x0, x2))
1242.     # symbols can be given as generators
1243.     x0, x2, x4 = symbols('x0, x2, x4')
1244.     assert linsolve(Augmatrix, numbered_symbols('x')
1245.         ) == FiniteSet((x0, 0, x2, 0, x4))
1246.     Augmatrix[-1, -1] = x0
1247.     # use Dummy to avoid clash; the names may clash but the symbols
1248.     # will not
1249.     Augmatrix[-1, -1] = symbols('_x0')
1250.     assert len(linsolve(
1251.         Augmatrix, numbered_symbols('x', cls=Dummy)).free_symbols) == 4
1252. 
1253.     # Issue #12604
1254.     f = Function('f')
1255.     assert linsolve([f(x) - 5], f(x)) == FiniteSet((5,))
1256. 
1257.     # Issue #14860
1258.     from sympy.physics.units import meter, newton, kilo
1259.     Eqns = [8*kilo*newton + x + y, 28*kilo*newton*meter + 3*x*meter]
1260.     assert linsolve(Eqns, x, y) == {(newton*Rational(-28000, 3), newton*Rational(4000, 3))}
1261. 
1262.     # linsolve fully expands expressions, so removable singularities
1263.     # and other nonlinearity does not raise an error
1264.     assert linsolve([Eq(x, x + y)], [x, y]) == {(x, 0)}
1265.     assert linsolve([Eq(1/x, 1/x + y)], [x, y]) == {(x, 0)}
1266.     assert linsolve([Eq(y/x, y/x + y)], [x, y]) == {(x, 0)}
1267.     assert linsolve([Eq(x*(x + 1), x**2 + y)], [x, y]) == {(y, y)}
1268. 
1269. 
1270. def test_linsolve_immutable():
1271.     A = ImmutableDenseMatrix([[1, 1, 2], [0, 1, 2], [0, 0, 1]])
1272.     B = ImmutableDenseMatrix([2, 1, -1])
1273.     c = symbols('c1 c2 c3')
1274.     assert linsolve([A, B], c) == FiniteSet((1, 3, -1))
1275. 
1276.     A = ImmutableDenseMatrix([[1, 1, 7], [1, -1, 3]])
1277.     assert linsolve(A) == FiniteSet((5, 2))
1278. 
1279. 
1280. def test_solve_decomposition():
1281.     x = Symbol('x')
1282.     n = Dummy('n')
1283. 
1284.     f1 = exp(3*x) - 6*exp(2*x) + 11*exp(x) - 6
1285.     f2 = sin(x)**2 - 2*sin(x) + 1
1286.     f3 = sin(x)**2 - sin(x)
1287.     f4 = sin(x + 1)
1288.     f5 = exp(x + 2) - 1
1289.     f6 = 1/log(x)
1290.     f7 = 1/x
1291. 
1292.     s1 = ImageSet(Lambda(n, 2*n*pi), S.Integers)
1293.     s2 = ImageSet(Lambda(n, 2*n*pi + pi), S.Integers)
1294.     s3 = ImageSet(Lambda(n, 2*n*pi + pi/2), S.Integers)
1295.     s4 = ImageSet(Lambda(n, 2*n*pi - 1), S.Integers)
1296.     s5 = ImageSet(Lambda(n, 2*n*pi - 1 + pi), S.Integers)
1297. 
1298.     assert solve_decomposition(f1, x, S.Reals) == FiniteSet(0, log(2), log(3))
1299.     assert solve_decomposition(f2, x, S.Reals) == s3
1300.     assert solve_decomposition(f3, x, S.Reals) == Union(s1, s2, s3)
1301.     assert solve_decomposition(f4, x, S.Reals) == Union(s4, s5)
1302.     assert solve_decomposition(f5, x, S.Reals) == FiniteSet(-2)
1303.     assert solve_decomposition(f6, x, S.Reals) == S.EmptySet
1304.     assert solve_decomposition(f7, x, S.Reals) == S.EmptySet
1305.     assert solve_decomposition(x, x, Interval(1, 2)) == S.EmptySet
1306. 
1307. # nonlinsolve testcases
1308. def test_nonlinsolve_basic():
1309.     assert nonlinsolve([],[]) == S.EmptySet
1310.     assert nonlinsolve([],[x, y]) == S.EmptySet
1311. 
1312.     system = [x, y - x - 5]
1313.     assert nonlinsolve([x],[x, y]) == FiniteSet((0, y))
1314.     assert nonlinsolve(system, [y]) == FiniteSet((x + 5,))
1315.     soln = (ImageSet(Lambda(n, 2*n*pi + pi/2), S.Integers),)
1316.     assert nonlinsolve([sin(x) - 1], [x]) == FiniteSet(tuple(soln))
1317.     assert nonlinsolve([x**2 - 1], [x]) == FiniteSet((-1,), (1,))
1318. 
1319.     soln = FiniteSet((y, y))
1320.     assert nonlinsolve([x - y, 0], x, y) == soln
1321.     assert nonlinsolve([0, x - y], x, y) == soln
1322.     assert nonlinsolve([x - y, x - y], x, y) == soln
1323.     assert nonlinsolve([x, 0], x, y) == FiniteSet((0, y))
1324.     f = Function('f')
1325.     assert nonlinsolve([f(x), 0], f(x), y) == FiniteSet((0, y))
1326.     assert nonlinsolve([f(x), 0], f(x), f(y)) == FiniteSet((0, f(y)))
1327.     A = Indexed('A', x)
1328.     assert nonlinsolve([A, 0], A, y) == FiniteSet((0, y))
1329.     assert nonlinsolve([x**2 -1], [sin(x)]) == FiniteSet((S.EmptySet,))
1330.     assert nonlinsolve([x**2 -1], sin(x)) == FiniteSet((S.EmptySet,))
1331.     assert nonlinsolve([x**2 -1], 1) == FiniteSet((x**2,))
1332.     assert nonlinsolve([x**2 -1], x + y) == FiniteSet((S.EmptySet,))
1333. 
1334. 
1335. def test_nonlinsolve_abs():
1336.     soln = FiniteSet((x, Abs(x)))
1337.     assert nonlinsolve([Abs(x) - y], x, y) == soln
1338. 
1339. 
1340. def test_raise_exception_nonlinsolve():
1341.     raises(IndexError, lambda: nonlinsolve([x**2 -1], []))
1342.     raises(ValueError, lambda: nonlinsolve([x**2 -1]))
1343.     raises(NotImplementedError, lambda: nonlinsolve([(x+y)**2 - 9, x**2 - y**2 - 0.75], (x, y)))
1344. 
1345. 
1346. def test_trig_system():
1347.     # TODO: add more simple testcases when solveset returns
1348.     # simplified soln for Trig eq
1349.     assert nonlinsolve([sin(x) - 1, cos(x) -1 ], x) == S.EmptySet
1350.     soln1 = (ImageSet(Lambda(n, 2*n*pi + pi/2), S.Integers),)
1351.     soln = FiniteSet(soln1)
1352.     assert nonlinsolve([sin(x) - 1, cos(x)], x) == soln
1353. 
1354. 
1355. @XFAIL
1356. def test_trig_system_fail():
1357.     # fails because solveset trig solver is not much smart.
1358.     sys = [x + y - pi/2, sin(x) + sin(y) - 1]
1359.     # solveset returns conditionset for sin(x) + sin(y) - 1
1360.     soln_1 = (ImageSet(Lambda(n, n*pi + pi/2), S.Integers),
1361.         ImageSet(Lambda(n, n*pi)), S.Integers)
1362.     soln_1 = FiniteSet(soln_1)
1363.     soln_2 = (ImageSet(Lambda(n, n*pi), S.Integers),
1364.         ImageSet(Lambda(n, n*pi+ pi/2), S.Integers))
1365.     soln_2 = FiniteSet(soln_2)
1366.     soln = soln_1 + soln_2
1367.     assert nonlinsolve(sys, [x, y]) == soln
1368. 
1369.     # Add more cases from here
1370.     # http://www.vitutor.com/geometry/trigonometry/equations_systems.html#uno
1371.     sys = [sin(x) + sin(y) - (sqrt(3)+1)/2, sin(x) - sin(y) - (sqrt(3) - 1)/2]
1372.     soln_x = Union(ImageSet(Lambda(n, 2*n*pi + pi/3), S.Integers),
1373.         ImageSet(Lambda(n, 2*n*pi + pi*Rational(2, 3)), S.Integers))
1374.     soln_y = Union(ImageSet(Lambda(n, 2*n*pi + pi/6), S.Integers),
1375.         ImageSet(Lambda(n, 2*n*pi + pi*Rational(5, 6)), S.Integers))
1376.     assert nonlinsolve(sys, [x, y]) ==FiniteSet((soln_x, soln_y))
1377. 
1378. 
1379. def test_nonlinsolve_positive_dimensional():
1380.     x, y, z, a, b, c, d = symbols('x, y, z, a, b, c, d', extended_real = True)
1381.     assert nonlinsolve([x*y, x*y - x], [x, y]) == FiniteSet((0, y))
1382. 
1383.     system = [a**2 + a*c, a - b]
1384.     assert nonlinsolve(system, [a, b]) == FiniteSet((0, 0), (-c, -c))
1385.     # here (a= 0, b = 0) is independent soln so both is printed.
1386.     # if symbols = [a, b, c] then only {a : -c ,b : -c}
1387. 
1388.     eq1 =  a + b + c + d
1389.     eq2 = a*b + b*c + c*d + d*a
1390.     eq3 = a*b*c + b*c*d + c*d*a + d*a*b
1391.     eq4 = a*b*c*d - 1
1392.     system = [eq1, eq2, eq3, eq4]
1393.     sol1 = (-1/d, -d, 1/d, FiniteSet(d) - FiniteSet(0))
1394.     sol2 = (1/d, -d, -1/d, FiniteSet(d) - FiniteSet(0))
1395.     soln = FiniteSet(sol1, sol2)
1396.     assert nonlinsolve(system, [a, b, c, d]) == soln
1397. 
1398. 
1399. def test_nonlinsolve_polysys():
1400.     x, y, z = symbols('x, y, z', real = True)
1401.     assert nonlinsolve([x**2 + y - 2, x**2 + y], [x, y]) == S.EmptySet
1402. 
1403.     s = (-y + 2, y)
1404.     assert nonlinsolve([(x + y)**2 - 4, x + y - 2], [x, y]) == FiniteSet(s)
1405. 
1406.     system = [x**2 - y**2]
1407.     soln_real = FiniteSet((-y, y), (y, y))
1408.     soln_complex = FiniteSet((-Abs(y), y), (Abs(y), y))
1409.     soln =soln_real + soln_complex
1410.     assert nonlinsolve(system, [x, y]) == soln
1411. 
1412.     system = [x**2 - y**2]
1413.     soln_real= FiniteSet((y, -y), (y, y))
1414.     soln_complex = FiniteSet((y, -Abs(y)), (y, Abs(y)))
1415.     soln = soln_real + soln_complex
1416.     assert nonlinsolve(system, [y, x]) == soln
1417. 
1418.     system = [x**2 + y - 3, x - y - 4]
1419.     assert nonlinsolve(system, (x, y)) != nonlinsolve(system, (y, x))
1420. 
1421. 
1422. def test_nonlinsolve_using_substitution():
1423.     x, y, z, n = symbols('x, y, z, n', real = True)
1424.     system = [(x + y)*n - y**2 + 2]
1425.     s_x = (n*y - y**2 + 2)/n
1426.     soln = (-s_x, y)
1427.     assert nonlinsolve(system, [x, y]) == FiniteSet(soln)
1428. 
1429.     system = [z**2*x**2 - z**2*y**2/exp(x)]
1430.     soln_real_1 = (y, x, 0)
1431.     soln_real_2 = (-exp(x/2)*Abs(x), x, z)
1432.     soln_real_3 = (exp(x/2)*Abs(x), x, z)
1433.     soln_complex_1 = (-x*exp(x/2), x, z)
1434.     soln_complex_2 = (x*exp(x/2), x, z)
1435.     syms = [y, x, z]
1436.     soln = FiniteSet(soln_real_1, soln_complex_1, soln_complex_2,\
1437.         soln_real_2, soln_real_3)
1438.     assert nonlinsolve(system,syms) == soln
1439. 
1440. 
1441. def test_nonlinsolve_complex():
1442.     x, y, z = symbols('x, y, z')
1443.     n = Dummy('n')
1444.     assert nonlinsolve([exp(x) - sin(y), 1/y - 3], [x, y]) == {
1445.         (ImageSet(Lambda(n, 2*n*I*pi + log(sin(Rational(1, 3)))), S.Integers), Rational(1, 3))}
1446. 
1447.     system = [exp(x) - sin(y), 1/exp(y) - 3]
1448.     assert nonlinsolve(system, [x, y]) == {
1449.         (ImageSet(Lambda(n, I*(2*n*pi + pi)
1450.                          + log(sin(log(3)))), S.Integers), -log(3)),
1451.         (ImageSet(Lambda(n, I*(2*n*pi + arg(sin(2*n*I*pi - log(3))))
1452.                          + log(Abs(sin(2*n*I*pi - log(3))))), S.Integers),
1453.         ImageSet(Lambda(n, 2*n*I*pi - log(3)), S.Integers))}
1454. 
1455.     system = [exp(x) - sin(y), y**2 - 4]
1456.     assert nonlinsolve(system, [x, y]) == {
1457.         (ImageSet(Lambda(n, I*(2*n*pi + pi) + log(sin(2))), S.Integers), -2),
1458.         (ImageSet(Lambda(n, 2*n*I*pi + log(sin(2))), S.Integers), 2)}
1459. 
1460. 
1461. @XFAIL
1462. def test_solve_nonlinear_trans():
1463.     # After the transcendental equation solver these will work
1464.     x, y, z = symbols('x, y, z', real=True)
1465.     soln1 = FiniteSet((2*LambertW(y/2), y))
1466.     soln2 = FiniteSet((-x*sqrt(exp(x)), y), (x*sqrt(exp(x)), y))
1467.     soln3 = FiniteSet((x*exp(x/2), x))
1468.     soln4 = FiniteSet(2*LambertW(y/2), y)
1469.     assert nonlinsolve([x**2 - y**2/exp(x)], [x, y]) == soln1
1470.     assert nonlinsolve([x**2 - y**2/exp(x)], [y, x]) == soln2
1471.     assert nonlinsolve([x**2 - y**2/exp(x)], [y, x]) == soln3
1472.     assert nonlinsolve([x**2 - y**2/exp(x)], [x, y]) == soln4
1473. 
1474. 
1475. def test_issue_5132_1():
1476.     system = [sqrt(x**2 + y**2) - sqrt(10), x + y - 4]
1477.     assert nonlinsolve(system, [x, y]) == FiniteSet((1, 3), (3, 1))
1478. 
1479.     n = Dummy('n')
1480.     eqs = [exp(x)**2 - sin(y) + z**2, 1/exp(y) - 3]
1481.     s_real_y = -log(3)
1482.     s_real_z = sqrt(-exp(2*x) - sin(log(3)))
1483.     soln_real = FiniteSet((s_real_y, s_real_z), (s_real_y, -s_real_z))
1484.     lam = Lambda(n, 2*n*I*pi + -log(3))
1485.     s_complex_y = ImageSet(lam, S.Integers)
1486.     lam = Lambda(n, sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1487.     s_complex_z_1 = ImageSet(lam, S.Integers)
1488.     lam = Lambda(n, -sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1489.     s_complex_z_2 = ImageSet(lam, S.Integers)
1490.     soln_complex = FiniteSet(
1491.                                             (s_complex_y, s_complex_z_1),
1492.                                             (s_complex_y, s_complex_z_2)
1493.                                         )
1494.     soln = soln_real + soln_complex
1495.     assert nonlinsolve(eqs, [y, z]) == soln
1496. 
1497. 
1498. def test_issue_5132_2():
1499.     x, y = symbols('x, y', real=True)
1500.     eqs = [exp(x)**2 - sin(y) + z**2, 1/exp(y) - 3]
1501.     n = Dummy('n')
1502.     soln_real = (log(-z**2 + sin(y))/2, z)
1503.     lam = Lambda( n, I*(2*n*pi + arg(-z**2 + sin(y)))/2 + log(Abs(z**2 - sin(y)))/2)
1504.     img = ImageSet(lam, S.Integers)
1505.     # not sure about the complex soln. But it looks correct.
1506.     soln_complex = (img, z)
1507.     soln = FiniteSet(soln_real, soln_complex)
1508.     assert nonlinsolve(eqs, [x, z]) == soln
1509. 
1510.     r, t = symbols('r, t')
1511.     system = [r - x**2 - y**2, tan(t) - y/x]
1512.     s_x = sqrt(r/(tan(t)**2 + 1))
1513.     s_y = sqrt(r/(tan(t)**2 + 1))*tan(t)
1514.     soln = FiniteSet((s_x, s_y), (-s_x, -s_y))
1515.     assert nonlinsolve(system, [x, y]) == soln
1516. 
1517. 
1518. def test_issue_6752():
1519.     a,b,c,d = symbols('a, b, c, d', real=True)
1520.     assert nonlinsolve([a**2 + a, a - b], [a, b]) == {(-1, -1), (0, 0)}
1521. 
1522. 
1523. @SKIP("slow")
1524. def test_issue_5114_solveset():
1525.     # slow testcase
1526.     a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r = symbols('a:r')
1527. 
1528.     # there is no 'a' in the equation set but this is how the
1529.     # problem was originally posed
1530.     syms = [a, b, c, f, h, k, n]
1531.     eqs = [b + r/d - c/d,
1532.     c*(1/d + 1/e + 1/g) - f/g - r/d,
1533.         f*(1/g + 1/i + 1/j) - c/g - h/i,
1534.         h*(1/i + 1/l + 1/m) - f/i - k/m,
1535.         k*(1/m + 1/o + 1/p) - h/m - n/p,
1536.         n*(1/p + 1/q) - k/p]
1537.     assert len(nonlinsolve(eqs, syms)) == 1
1538. 
1539. 
1540. @SKIP("Hangs")
1541. def _test_issue_5335():
1542.     # Not able to check zero dimensional system.
1543.     # is_zero_dimensional Hangs
1544.     lam, a0, conc = symbols('lam a0 conc')
1545.     eqs = [lam + 2*y - a0*(1 - x/2)*x - 0.005*x/2*x,
1546.            a0*(1 - x/2)*x - 1*y - 0.743436700916726*y,
1547.            x + y - conc]
1548.     sym = [x, y, a0]
1549.     # there are 4 solutions but only two are valid
1550.     assert len(nonlinsolve(eqs, sym)) == 2
1551.     # float
1552.     lam, a0, conc = symbols('lam a0 conc')
1553.     eqs = [lam + 2*y - a0*(1 - x/2)*x - 0.005*x/2*x,
1554.            a0*(1 - x/2)*x - 1*y - 0.743436700916726*y,
1555.            x + y - conc]
1556.     sym = [x, y, a0]
1557.     assert len(nonlinsolve(eqs, sym)) == 2
1558. 
1559. 
1560. def test_issue_2777():
1561.     # the equations represent two circles
1562.     x, y = symbols('x y', real=True)
1563.     e1, e2 = sqrt(x**2 + y**2) - 10, sqrt(y**2 + (-x + 10)**2) - 3
1564.     a, b = Rational(191, 20), 3*sqrt(391)/20
1565.     ans = {(a, -b), (a, b)}
1566.     assert nonlinsolve((e1, e2), (x, y)) == ans
1567.     assert nonlinsolve((e1, e2/(x - a)), (x, y)) == S.EmptySet
1568.     # make the 2nd circle's radius be -3
1569.     e2 += 6
1570.     assert nonlinsolve((e1, e2), (x, y)) == S.EmptySet
1571. 
1572. 
1573. def test_issue_8828():
1574.     x1 = 0
1575.     y1 = -620
1576.     r1 = 920
1577.     x2 = 126
1578.     y2 = 276
1579.     x3 = 51
1580.     y3 = 205
1581.     r3 = 104
1582.     v = [x, y, z]
1583. 
1584.     f1 = (x - x1)**2 + (y - y1)**2 - (r1 - z)**2
1585.     f2 = (x2 - x)**2 + (y2 - y)**2 - z**2
1586.     f3 = (x - x3)**2 + (y - y3)**2 - (r3 - z)**2
1587.     F = [f1, f2, f3]
1588. 
1589.     g1 = sqrt((x - x1)**2 + (y - y1)**2) + z - r1
1590.     g2 = f2
1591.     g3 = sqrt((x - x3)**2 + (y - y3)**2) + z - r3
1592.     G = [g1, g2, g3]
1593. 
1594.     # both soln same
1595.     A = nonlinsolve(F, v)
1596.     B = nonlinsolve(G, v)
1597.     assert A == B
1598. 
1599. 
1600. def test_nonlinsolve_conditionset():
1601.     # when solveset failed to solve all the eq
1602.     # return conditionset
1603.     f = Function('f')
1604.     f1 = f(x) - pi/2
1605.     f2 = f(y) - pi*Rational(3, 2)
1606.     intermediate_system = Eq(2*f(x) - pi, 0) & Eq(2*f(y) - 3*pi, 0)
1607.     symbols = Tuple(x, y)
1608.     soln = ConditionSet(
1609.         symbols,
1610.         intermediate_system,
1611.         S.Complexes**2)
1612.     assert nonlinsolve([f1, f2], [x, y]) == soln
1613. 
1614. 
1615. def test_substitution_basic():
1616.     assert substitution([], [x, y]) == S.EmptySet
1617.     assert substitution([], []) == S.EmptySet
1618.     system = [2*x**2 + 3*y**2 - 30, 3*x**2 - 2*y**2 - 19]
1619.     soln = FiniteSet((-3, -2), (-3, 2), (3, -2), (3, 2))
1620.     assert substitution(system, [x, y]) == soln
1621. 
1622.     soln = FiniteSet((-1, 1))
1623.     assert substitution([x + y], [x], [{y: 1}], [y], set([]), [x, y]) == soln
1624.     assert substitution(
1625.         [x + y], [x], [{y: 1}], [y],
1626.         set([x + 1]), [y, x]) == S.EmptySet
1627. 
1628. 
1629. def test_issue_5132_substitution():
1630.     x, y, z, r, t = symbols('x, y, z, r, t', real=True)
1631.     system = [r - x**2 - y**2, tan(t) - y/x]
1632.     s_x_1 = Complement(FiniteSet(-sqrt(r/(tan(t)**2 + 1))), FiniteSet(0))
1633.     s_x_2 = Complement(FiniteSet(sqrt(r/(tan(t)**2 + 1))), FiniteSet(0))
1634.     s_y = sqrt(r/(tan(t)**2 + 1))*tan(t)
1635.     soln = FiniteSet((s_x_2, s_y)) + FiniteSet((s_x_1, -s_y))
1636.     assert substitution(system, [x, y]) == soln
1637. 
1638.     n = Dummy('n')
1639.     eqs = [exp(x)**2 - sin(y) + z**2, 1/exp(y) - 3]
1640.     s_real_y = -log(3)
1641.     s_real_z = sqrt(-exp(2*x) - sin(log(3)))
1642.     soln_real = FiniteSet((s_real_y, s_real_z), (s_real_y, -s_real_z))
1643.     lam = Lambda(n, 2*n*I*pi + -log(3))
1644.     s_complex_y = ImageSet(lam, S.Integers)
1645.     lam = Lambda(n, sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1646.     s_complex_z_1 = ImageSet(lam, S.Integers)
1647.     lam = Lambda(n, -sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1648.     s_complex_z_2 = ImageSet(lam, S.Integers)
1649.     soln_complex = FiniteSet(
1650.         (s_complex_y, s_complex_z_1),
1651.         (s_complex_y, s_complex_z_2))
1652.     soln = soln_real + soln_complex
1653.     assert substitution(eqs, [y, z]) == soln
1654. 
1655. 
1656. def test_raises_substitution():
1657.     raises(ValueError, lambda: substitution([x**2 -1], []))
1658.     raises(TypeError, lambda: substitution([x**2 -1]))
1659.     raises(ValueError, lambda: substitution([x**2 -1], [sin(x)]))
1660.     raises(TypeError, lambda: substitution([x**2 -1], x))
1661.     raises(TypeError, lambda: substitution([x**2 -1], 1))
1662. 
1663. # end of tests for nonlinsolve
1664. 
1665. 
1666. def test_issue_9556():
1667.     x = Symbol('x')
1668.     b = Symbol('b', positive=True)
1669. 
1670.     assert solveset(Abs(x) + 1, x, S.Reals) == EmptySet()
1671.     assert solveset(Abs(x) + b, x, S.Reals) == EmptySet()
1672.     assert solveset(Eq(b, -1), b, S.Reals) == EmptySet()
1673. 
1674. 
1675. def test_issue_9611():
1676.     x = Symbol('x')
1677.     a = Symbol('a')
1678.     y = Symbol('y')
1679. 
1680.     assert solveset(Eq(x - x + a, a), x, S.Reals) == S.Reals
1681.     assert solveset(Eq(y - y + a, a), y) == S.Complexes
1682. 
1683. 
1684. def test_issue_9557():
1685.     x = Symbol('x')
1686.     a = Symbol('a')
1687. 
1688.     assert solveset(x**2 + a, x, S.Reals) == Intersection(S.Reals,
1689.         FiniteSet(-sqrt(-a), sqrt(-a)))
1690. 
1691. 
1692. def test_issue_9778():
1693.     assert solveset(x**3 + 1, x, S.Reals) == FiniteSet(-1)
1694.     assert solveset(x**Rational(3, 5) + 1, x, S.Reals) == S.EmptySet
1695.     assert solveset(x**3 + y, x, S.Reals) == \
1696.         FiniteSet(-Abs(y)**Rational(1, 3)*sign(y))
1697. 
1698. 
1699. def test_issue_10214():
1700.     assert solveset(x**Rational(3, 2) + 4, x, S.Reals) == S.EmptySet
1701.     assert solveset(x**(Rational(-3, 2)) + 4, x, S.Reals) == S.EmptySet
1702. 
1703.     ans = FiniteSet(-2**Rational(2, 3))
1704.     assert solveset(x**(S(3)) + 4, x, S.Reals) == ans
1705.     assert (x**(S(3)) + 4).subs(x,list(ans)[0]) == 0 # substituting ans and verifying the result.
1706.     assert (x**(S(3)) + 4).subs(x,-(-2)**Rational(2, 3)) == 0
1707. 
1708. 
1709. def test_issue_9849():
1710.     assert solveset(Abs(sin(x)) + 1, x, S.Reals) == S.EmptySet
1711. 
1712. 
1713. def test_issue_9953():
1714.     assert linsolve([ ], x) == S.EmptySet
1715. 
1716. 
1717. def test_issue_9913():
1718.     assert solveset(2*x + 1/(x - 10)**2, x, S.Reals) == \
1719.         FiniteSet(-(3*sqrt(24081)/4 + Rational(4027, 4))**Rational(1, 3)/3 - 100/
1720.                 (3*(3*sqrt(24081)/4 + Rational(4027, 4))**Rational(1, 3)) + Rational(20, 3))
1721. 
1722. 
1723. def test_issue_10397():
1724.     assert solveset(sqrt(x), x, S.Complexes) == FiniteSet(0)
1725. 
1726. 
1727. def test_issue_14987():
1728.     raises(ValueError, lambda: linear_eq_to_matrix(
1729.         [x**2], x))
1730.     raises(ValueError, lambda: linear_eq_to_matrix(
1731.         [x*(-3/x + 1) + 2*y - a], [x, y]))
1732.     raises(ValueError, lambda: linear_eq_to_matrix(
1733.         [(x**2 - 3*x)/(x - 3) - 3], x))
1734.     raises(ValueError, lambda: linear_eq_to_matrix(
1735.         [(x + 1)**3 - x**3 - 3*x**2 + 7], x))
1736.     raises(ValueError, lambda: linear_eq_to_matrix(
1737.         [x*(1/x + 1) + y], [x, y]))
1738.     raises(ValueError, lambda: linear_eq_to_matrix(
1739.         [(x + 1)*y], [x, y]))
1740.     raises(ValueError, lambda: linear_eq_to_matrix(
1741.         [Eq(1/x, 1/x + y)], [x, y]))
1742.     raises(ValueError, lambda: linear_eq_to_matrix(
1743.         [Eq(y/x, y/x + y)], [x, y]))
1744.     raises(ValueError, lambda: linear_eq_to_matrix(
1745.         [Eq(x*(x + 1), x**2 + y)], [x, y]))
1746. 
1747. 
1748. def test_simplification():
1749.     eq = x + (a - b)/(-2*a + 2*b)
1750.     assert solveset(eq, x) == FiniteSet(S.Half)
1751.     assert solveset(eq, x, S.Reals) == Intersection({-((a - b)/(-2*a + 2*b))}, S.Reals)
1752.     # So that ap - bn is not zero:
1753.     ap = Symbol('ap', positive=True)
1754.     bn = Symbol('bn', negative=True)
1755.     eq = x + (ap - bn)/(-2*ap + 2*bn)
1756.     assert solveset(eq, x) == FiniteSet(S.Half)
1757.     assert solveset(eq, x, S.Reals) == FiniteSet(S.Half)
1758. 
1759. 
1760. def test_issue_10555():
1761.     f = Function('f')
1762.     g = Function('g')
1763.     assert solveset(f(x) - pi/2, x, S.Reals) == \
1764.         ConditionSet(x, Eq(f(x) - pi/2, 0), S.Reals)
1765.     assert solveset(f(g(x)) - pi/2, g(x), S.Reals) == \
1766.         ConditionSet(g(x), Eq(f(g(x)) - pi/2, 0), S.Reals)
1767. 
1768. 
1769. def test_issue_8715():
1770.     eq = x + 1/x > -2 + 1/x
1771.     assert solveset(eq, x, S.Reals) == \
1772.         (Interval.open(-2, oo) - FiniteSet(0))
1773.     assert solveset(eq.subs(x,log(x)), x, S.Reals) == \
1774.         Interval.open(exp(-2), oo) - FiniteSet(1)
1775. 
1776. 
1777. def test_issue_11174():
1778.     r, t = symbols('r t')
1779.     eq = z**2 + exp(2*x) - sin(y)
1780.     soln = Intersection(S.Reals, FiniteSet(log(-z**2 + sin(y))/2))
1781.     assert solveset(eq, x, S.Reals) == soln
1782. 
1783.     eq = sqrt(r)*Abs(tan(t))/sqrt(tan(t)**2 + 1) + x*tan(t)
1784.     s = -sqrt(r)*Abs(tan(t))/(sqrt(tan(t)**2 + 1)*tan(t))
1785.     soln = Intersection(S.Reals, FiniteSet(s))
1786.     assert solveset(eq, x, S.Reals) == soln
1787. 
1788. 
1789. def test_issue_11534():
1790.     # eq and eq2 should give the same solution as a Complement
1791.     eq = -y + x/sqrt(-x**2 + 1)
1792.     eq2 = -y**2 + x**2/(-x**2 + 1)
1793.     soln = Complement(FiniteSet(-y/sqrt(y**2 + 1), y/sqrt(y**2 + 1)), FiniteSet(-1, 1))
1794.     assert solveset(eq, x, S.Reals) == soln
1795.     assert solveset(eq2, x, S.Reals) == soln
1796. 
1797. 
1798. def test_issue_10477():
1799.     assert solveset((x**2 + 4*x - 3)/x < 2, x, S.Reals) == \
1800.         Union(Interval.open(-oo, -3), Interval.open(0, 1))
1801. 
1802. 
1803. def test_issue_10671():
1804.     assert solveset(sin(y), y, Interval(0, pi)) == FiniteSet(0, pi)
1805.     i = Interval(1, 10)
1806.     assert solveset((1/x).diff(x) < 0, x, i) == i
1807. 
1808. 
1809. def test_issue_11064():
1810.     eq = x + sqrt(x**2 - 5)
1811.     assert solveset(eq > 0, x, S.Reals) == \
1812.         Interval(sqrt(5), oo)
1813.     assert solveset(eq < 0, x, S.Reals) == \
1814.         Interval(-oo, -sqrt(5))
1815.     assert solveset(eq > sqrt(5), x, S.Reals) == \
1816.         Interval.Lopen(sqrt(5), oo)
1817. 
1818. 
1819. def test_issue_12478():
1820.     eq = sqrt(x - 2) + 2
1821.     soln = solveset_real(eq, x)
1822.     assert soln is S.EmptySet
1823.     assert solveset(eq < 0, x, S.Reals) is S.EmptySet
1824.     assert solveset(eq > 0, x, S.Reals) == Interval(2, oo)
1825. 
1826. 
1827. def test_issue_12429():
1828.     eq = solveset(log(x)/x <= 0, x, S.Reals)
1829.     sol = Interval.Lopen(0, 1)
1830.     assert eq == sol
1831. 
1832. 
1833. def test_solveset_arg():
1834.     assert solveset(arg(x), x, S.Reals)  == Interval.open(0, oo)
1835.     assert solveset(arg(4*x -3), x) == Interval.open(Rational(3, 4), oo)
1836. 
1837. 
1838. def test__is_finite_with_finite_vars():
1839.     f = _is_finite_with_finite_vars
1840.     # issue 12482
1841.     assert all(f(1/x) is None for x in (
1842.         Dummy(), Dummy(real=True), Dummy(complex=True)))
1843.     assert f(1/Dummy(real=False)) is True  # b/c it's finite but not 0
1844. 
1845. 
1846. def test_issue_13550():
1847.     assert solveset(x**2 - 2*x - 15, symbol = x, domain = Interval(-oo, 0)) == FiniteSet(-3)
1848. 
1849. 
1850. def test_issue_13849():
1851.     t = symbols('t')
1852.     assert nonlinsolve((t*(sqrt(5) + sqrt(2)) - sqrt(2), t), t) == EmptySet()
1853. 
1854. 
1855. def test_issue_14223():
1856.     x = Symbol('x')
1857.     assert solveset((Abs(x + Min(x, 2)) - 2).rewrite(Piecewise), x,
1858.         S.Reals) == FiniteSet(-1, 1)
1859.     assert solveset((Abs(x + Min(x, 2)) - 2).rewrite(Piecewise), x,
1860.         Interval(0, 2)) == FiniteSet(1)
1861. 
1862. 
1863. def test_issue_10158():
1864.     x = Symbol('x')
1865.     dom = S.Reals
1866.     assert solveset(x*Max(x, 15) - 10, x, dom) == FiniteSet(Rational(2, 3))
1867.     assert solveset(x*Min(x, 15) - 10, x, dom) == FiniteSet(-sqrt(10), sqrt(10))
1868.     assert solveset(Max(Abs(x - 3) - 1, x + 2) - 3, x, dom) == FiniteSet(-1, 1)
1869.     assert solveset(Abs(x - 1) - Abs(y), x, dom) == FiniteSet(-Abs(y) + 1, Abs(y) + 1)
1870.     assert solveset(Abs(x + 4*Abs(x + 1)), x, dom) == FiniteSet(Rational(-4, 3), Rational(-4, 5))
1871.     assert solveset(2*Abs(x + Abs(x + Max(3, x))) - 2, x, S.Reals) == FiniteSet(-1, -2)
1872.     dom = S.Complexes
1873.     raises(ValueError, lambda: solveset(x*Max(x, 15) - 10, x, dom))
1874.     raises(ValueError, lambda: solveset(x*Min(x, 15) - 10, x, dom))
1875.     raises(ValueError, lambda: solveset(Max(Abs(x - 3) - 1, x + 2) - 3, x, dom))
1876.     raises(ValueError, lambda: solveset(Abs(x - 1) - Abs(y), x, dom))
1877.     raises(ValueError, lambda: solveset(Abs(x + 4*Abs(x + 1)), x, dom))
1878. 
1879. 
1880. def test_issue_14300():
1881.     x, y, n = symbols('x y n')
1882. 
1883.     f = 1 - exp(-18000000*x) - y
1884.     a1 = FiniteSet(-log(-y + 1)/18000000)
1885. 
1886.     assert solveset(f, x, S.Reals) == \
1887.         Intersection(S.Reals, a1)
1888.     assert solveset(f, x) == \
1889.         ImageSet(Lambda(n, -I*(2*n*pi + arg(-y + 1))/18000000 -
1890.             log(Abs(y - 1))/18000000), S.Integers)
1891. 
1892. 
1893. def test_issue_14454():
1894.     x = Symbol('x')
1895.     number = CRootOf(x**4 + x - 1, 2)
1896.     raises(ValueError, lambda: invert_real(number, 0, x, S.Reals))
1897.     assert invert_real(x**2, number, x, S.Reals)  # no error
1898. 
1899. 
1900. def test_term_factors():
1901.     assert list(_term_factors(3**x - 2)) == [-2, 3**x]
1902.     expr = 4**(x + 1) + 4**(x + 2) + 4**(x - 1) - 3**(x + 2) - 3**(x + 3)
1903.     assert set(_term_factors(expr)) == set([
1904.         3**(x + 2), 4**(x + 2), 3**(x + 3), 4**(x - 1), -1, 4**(x + 1)])
1905. 
1906. 
1907. #################### tests for transolve and its helpers ###############
1908. 
1909. def test_transolve():
1910. 
1911.     assert _transolve(3**x, x, S.Reals) == S.EmptySet
1912.     assert _transolve(3**x - 9**(x + 5), x, S.Reals) == FiniteSet(-10)
1913. 
1914. 
1915. # exponential tests
1916. def test_exponential_real():
1917.     from sympy.abc import x, y, z
1918. 
1919.     e1 = 3**(2*x) - 2**(x + 3)
1920.     e2 = 4**(5 - 9*x) - 8**(2 - x)
1921.     e3 = 2**x + 4**x
1922.     e4 = exp(log(5)*x) - 2**x
1923.     e5 = exp(x/y)*exp(-z/y) - 2
1924.     e6 = 5**(x/2) - 2**(x/3)
1925.     e7 = 4**(x + 1) + 4**(x + 2) + 4**(x - 1) - 3**(x + 2) - 3**(x + 3)
1926.     e8 = -9*exp(-2*x + 5) + 4*exp(3*x + 1)
1927.     e9 = 2**x + 4**x + 8**x - 84
1928. 
1929.     assert solveset(e1, x, S.Reals) == FiniteSet(
1930.         -3*log(2)/(-2*log(3) + log(2)))
1931.     assert solveset(e2, x, S.Reals) == FiniteSet(Rational(4, 15))
1932.     assert solveset(e3, x, S.Reals) == S.EmptySet
1933.     assert solveset(e4, x, S.Reals) == FiniteSet(0)
1934.     assert solveset(e5, x, S.Reals) == Intersection(
1935.         S.Reals, FiniteSet(y*log(2*exp(z/y))))
1936.     assert solveset(e6, x, S.Reals) == FiniteSet(0)
1937.     assert solveset(e7, x, S.Reals) == FiniteSet(2)
1938.     assert solveset(e8, x, S.Reals) == FiniteSet(-2*log(2)/5 + 2*log(3)/5 + Rational(4, 5))
1939.     assert solveset(e9, x, S.Reals) == FiniteSet(2)
1940. 
1941.     assert solveset_real(-9*exp(-2*x + 5) + 2**(x + 1), x) == FiniteSet(
1942.         -((-5 - 2*log(3) + log(2))/(log(2) + 2)))
1943.     assert solveset_real(4**(x/2) - 2**(x/3), x) == FiniteSet(0)
1944.     b = sqrt(6)*sqrt(log(2))/sqrt(log(5))
1945.     assert solveset_real(5**(x/2) - 2**(3/x), x) == FiniteSet(-b, b)
1946. 
1947.     # coverage test
1948.     C1, C2 = symbols('C1 C2')
1949.     f = Function('f')
1950.     assert solveset_real(C1 + C2/x**2 - exp(-f(x)), f(x)) == Intersection(
1951.         S.Reals, FiniteSet(-log(C1 + C2/x**2)))
1952.     y = symbols('y', positive=True)
1953.     assert solveset_real(x**2 - y**2/exp(x), y) == Intersection(
1954.         S.Reals, FiniteSet(-sqrt(x**2*exp(x)), sqrt(x**2*exp(x))))
1955.     p = Symbol('p', positive=True)
1956.     assert solveset_real((1/p + 1)**(p + 1), p) == EmptySet()
1957. 
1958. 
1959. @XFAIL
1960. def test_exponential_complex():
1961.     from sympy.abc import x
1962.     from sympy import Dummy
1963.     n = Dummy('n')
1964. 
1965.     assert solveset_complex(2**x + 4**x, x) == imageset(
1966.         Lambda(n, I*(2*n*pi + pi)/log(2)), S.Integers)
1967.     assert solveset_complex(x**z*y**z - 2, z) == FiniteSet(
1968.         log(2)/(log(x) + log(y)))
1969.     assert solveset_complex(4**(x/2) - 2**(x/3), x) == imageset(
1970.         Lambda(n, 3*n*I*pi/log(2)), S.Integers)
1971.     assert solveset(2**x + 32, x) == imageset(
1972.         Lambda(n, (I*(2*n*pi + pi) + 5*log(2))/log(2)), S.Integers)
1973. 
1974.     eq = (2**exp(y**2/x) + 2)/(x**2 + 15)
1975.     a = sqrt(x)*sqrt(-log(log(2)) + log(log(2) + 2*n*I*pi))
1976.     assert solveset_complex(eq, y) == FiniteSet(-a, a)
1977. 
1978.     union1 = imageset(Lambda(n, I*(2*n*pi - pi*Rational(2, 3))/log(2)), S.Integers)
1979.     union2 = imageset(Lambda(n, I*(2*n*pi + pi*Rational(2, 3))/log(2)), S.Integers)
1980.     assert solveset(2**x + 4**x + 8**x, x) == Union(union1, union2)
1981. 
1982.     eq = 4**(x + 1) + 4**(x + 2) + 4**(x - 1) - 3**(x + 2) - 3**(x + 3)
1983.     res = solveset(eq, x)
1984.     num = 2*n*I*pi - 4*log(2) + 2*log(3)
1985.     den = -2*log(2) + log(3)
1986.     ans = imageset(Lambda(n, num/den), S.Integers)
1987.     assert res == ans
1988. 
1989. 
1990. def test_expo_conditionset():
1991.     from sympy.abc import x, y
1992. 
1993.     f1 = (exp(x) + 1)**x - 2
1994.     f2 = (x + 2)**y*x - 3
1995.     f3 = 2**x - exp(x) - 3
1996.     f4 = log(x) - exp(x)
1997.     f5 = 2**x + 3**x - 5**x
1998. 
1999.     assert solveset(f1, x, S.Reals) == ConditionSet(
2000.         x, Eq((exp(x) + 1)**x - 2, 0), S.Reals)


File: sympy/solvers/tests/test_solveset.py
Line number range: 2001 - 4000
Content:
2001.     assert solveset(f2, x, S.Reals) == ConditionSet(
2002.         x, Eq(x*(x + 2)**y - 3, 0), S.Reals)
2003.     assert solveset(f3, x, S.Reals) == ConditionSet(
2004.         x, Eq(2**x - exp(x) - 3, 0), S.Reals)
2005.     assert solveset(f4, x, S.Reals) == ConditionSet(
2006.         x, Eq(-exp(x) + log(x), 0), S.Reals)
2007.     assert solveset(f5, x, S.Reals) == ConditionSet(
2008.         x, Eq(2**x + 3**x - 5**x, 0), S.Reals)
2009. 
2010. 
2011. def test_exponential_symbols():
2012.     x, y, z = symbols('x y z', positive=True)
2013. 
2014.     assert solveset(z**x - y, x, S.Reals) == Intersection(
2015.         S.Reals, FiniteSet(log(y)/log(z)))
2016. 
2017.     w = symbols('w')
2018.     f1 = 2*x**w - 4*y**w
2019.     f2 = (x/y)**w - 2
2020.     sol1 = Intersection({log(2)/(log(x) - log(y))}, S.Reals)
2021.     sol2 = Intersection({log(2)/log(x/y)}, S.Reals)
2022.     assert solveset(f1, w, S.Reals) == sol1
2023.     assert solveset(f2, w, S.Reals) == sol2
2024. 
2025.     assert solveset(x**x, x, S.Reals) == S.EmptySet
2026.     assert solveset(x**y - 1, y, S.Reals) == FiniteSet(0)
2027.     assert solveset(exp(x/y)*exp(-z/y) - 2, y, S.Reals) == FiniteSet(
2028.         (x - z)/log(2)) - FiniteSet(0)
2029. 
2030.     a, b, x, y = symbols('a b x y')
2031.     assert solveset_real(a**x - b**x, x) == ConditionSet(
2032.         x, (a > 0) & (b > 0), FiniteSet(0))
2033.     assert solveset(a**x - b**x, x) == ConditionSet(
2034.         x, Ne(a, 0) & Ne(b, 0), FiniteSet(0))
2035. 
2036. 
2037. @XFAIL
2038. def test_issue_10864():
2039.     assert solveset(x**(y*z) - x, x, S.Reals) == FiniteSet(1)
2040. 
2041. 
2042. @XFAIL
2043. def test_solve_only_exp_2():
2044.     assert solveset_real(sqrt(exp(x)) + sqrt(exp(-x)) - 4, x) == \
2045.         FiniteSet(2*log(-sqrt(3) + 2), 2*log(sqrt(3) + 2))
2046. 
2047. 
2048. def test_is_exponential():
2049.     x, y, z = symbols('x y z')
2050. 
2051.     assert _is_exponential(y, x) is False
2052.     assert _is_exponential(3**x - 2, x) is True
2053.     assert _is_exponential(5**x - 7**(2 - x), x) is True
2054.     assert _is_exponential(sin(2**x) - 4*x, x) is False
2055.     assert _is_exponential(x**y - z, y) is True
2056.     assert _is_exponential(x**y - z, x) is False
2057.     assert _is_exponential(2**x + 4**x - 1, x) is True
2058.     assert _is_exponential(x**(y*z) - x, x) is False
2059.     assert _is_exponential(x**(2*x) - 3**x, x) is False
2060.     assert _is_exponential(x**y - y*z, y) is False
2061.     assert _is_exponential(x**y - x*z, y) is True
2062. 
2063. 
2064. def test_solve_exponential():
2065.     assert _solve_exponential(3**(2*x) - 2**(x + 3), 0, x, S.Reals) == \
2066.         FiniteSet(-3*log(2)/(-2*log(3) + log(2)))
2067.     assert _solve_exponential(2**y + 4**y, 1, y, S.Reals) == \
2068.         FiniteSet(log(Rational(-1, 2) + sqrt(5)/2)/log(2))
2069.     assert _solve_exponential(2**y + 4**y, 0, y, S.Reals) == \
2070.         S.EmptySet
2071.     assert _solve_exponential(2**x + 3**x - 5**x, 0, x, S.Reals) == \
2072.         ConditionSet(x, Eq(2**x + 3**x - 5**x, 0), S.Reals)
2073. 
2074. # end of exponential tests
2075. 
2076. 
2077. # logarithmic tests
2078. def test_logarithmic():
2079.     assert solveset_real(log(x - 3) + log(x + 3), x) == FiniteSet(
2080.         -sqrt(10), sqrt(10))
2081.     assert solveset_real(log(x + 1) - log(2*x - 1), x) == FiniteSet(2)
2082.     assert solveset_real(log(x + 3) + log(1 + 3/x) - 3, x) == FiniteSet(
2083.         -3 + sqrt(-12 + exp(3))*exp(Rational(3, 2))/2 + exp(3)/2,
2084.         -sqrt(-12 + exp(3))*exp(Rational(3, 2))/2 - 3 + exp(3)/2)
2085. 
2086.     eq = z - log(x) + log(y/(x*(-1 + y**2/x**2)))
2087.     assert solveset_real(eq, x) == \
2088.         Intersection(S.Reals, FiniteSet(-sqrt(y**2 - y*exp(z)),
2089.             sqrt(y**2 - y*exp(z)))) - \
2090.         Intersection(S.Reals, FiniteSet(-sqrt(y**2), sqrt(y**2)))
2091.     assert solveset_real(
2092.         log(3*x) - log(-x + 1) - log(4*x + 1), x) == FiniteSet(Rational(-1, 2), S.Half)
2093.     assert solveset(log(x**y) - y*log(x), x, S.Reals) == S.Reals
2094. 
2095. @XFAIL
2096. def test_uselogcombine_2():
2097.     eq = log(exp(2*x) + 1) + log(-tanh(x) + 1) - log(2)
2098.     assert solveset_real(eq, x) == EmptySet()
2099.     eq = log(8*x) - log(sqrt(x) + 1) - 2
2100.     assert solveset_real(eq, x) == EmptySet()
2101. 
2102. 
2103. def test_is_logarithmic():
2104.     assert _is_logarithmic(y, x) is False
2105.     assert _is_logarithmic(log(x), x) is True
2106.     assert _is_logarithmic(log(x) - 3, x) is True
2107.     assert _is_logarithmic(log(x)*log(y), x) is True
2108.     assert _is_logarithmic(log(x)**2, x) is False
2109.     assert _is_logarithmic(log(x - 3) + log(x + 3), x) is True
2110.     assert _is_logarithmic(log(x**y) - y*log(x), x) is True
2111.     assert _is_logarithmic(sin(log(x)), x) is False
2112.     assert _is_logarithmic(x + y, x) is False
2113.     assert _is_logarithmic(log(3*x) - log(1 - x) + 4, x) is True
2114.     assert _is_logarithmic(log(x) + log(y) + x, x) is False
2115.     assert _is_logarithmic(log(log(x - 3)) + log(x - 3), x) is True
2116.     assert _is_logarithmic(log(log(3) + x) + log(x), x) is True
2117.     assert _is_logarithmic(log(x)*(y + 3) + log(x), y) is False
2118. 
2119. 
2120. def test_solve_logarithm():
2121.     y = Symbol('y')
2122.     assert _solve_logarithm(log(x**y) - y*log(x), 0, x, S.Reals) == S.Reals
2123.     y = Symbol('y', positive=True)
2124.     assert _solve_logarithm(log(x)*log(y), 0, x, S.Reals) == FiniteSet(1)
2125. 
2126. # end of logarithmic tests
2127. 
2128. 
2129. def test_linear_coeffs():
2130.     from sympy.solvers.solveset import linear_coeffs
2131.     assert linear_coeffs(0, x) == [0, 0]
2132.     assert all(i is S.Zero for i in linear_coeffs(0, x))
2133.     assert linear_coeffs(x + 2*y + 3, x, y) == [1, 2, 3]
2134.     assert linear_coeffs(x + 2*y + 3, y, x) == [2, 1, 3]
2135.     assert linear_coeffs(x + 2*x**2 + 3, x, x**2) == [1, 2, 3]
2136.     raises(ValueError, lambda:
2137.         linear_coeffs(x + 2*x**2 + x**3, x, x**2))
2138.     raises(ValueError, lambda:
2139.         linear_coeffs(1/x*(x - 1) + 1/x, x))
2140.     assert linear_coeffs(a*(x + y), x, y) == [a, a, 0]
2141.     assert linear_coeffs(1.0, x, y) == [0, 0, 1.0]
2142. 
2143. # modular tests
2144. def test_is_modular():
2145.     x, y = symbols('x y')
2146. 
2147.     assert _is_modular(y, x) is False
2148.     assert _is_modular(Mod(x, 3) - 1, x) is True
2149.     assert _is_modular(Mod(x**3 - 3*x**2 - x + 1, 3) - 1, x) is True
2150.     assert _is_modular(Mod(exp(x + y), 3) - 2, x) is True
2151.     assert _is_modular(Mod(exp(x + y), 3) - log(x), x) is True
2152.     assert _is_modular(Mod(x, 3) - 1, y) is False
2153.     assert _is_modular(Mod(x, 3)**2 - 5, x) is False
2154.     assert _is_modular(Mod(x, 3)**2 - y, x) is False
2155.     assert _is_modular(exp(Mod(x, 3)) - 1, x) is False
2156.     assert _is_modular(Mod(3, y) - 1, y) is False
2157. 
2158. 
2159. def test_invert_modular():
2160.     x, y = symbols('x y')
2161.     n = Dummy('n', integer=True)
2162.     from sympy.solvers.solveset import _invert_modular as invert_modular
2163. 
2164.     # non invertible cases
2165.     assert invert_modular(Mod(sin(x), 7), S(5), n, x) == (Mod(sin(x), 7), 5)
2166.     assert invert_modular(Mod(exp(x), 7), S(5), n, x) == (Mod(exp(x), 7), 5)
2167.     assert invert_modular(Mod(log(x), 7), S(5), n, x) == (Mod(log(x), 7), 5)
2168.     # a is symbol
2169.     assert invert_modular(Mod(x, 7), S(5), n, x) == \
2170.             (x, ImageSet(Lambda(n, 7*n + 5), S.Integers))
2171.     # a.is_Add
2172.     assert invert_modular(Mod(x + 8, 7), S(5), n, x) == \
2173.             (x, ImageSet(Lambda(n, 7*n + 4), S.Integers))
2174.     assert invert_modular(Mod(x**2 + x, 7), S(5), n, x) == \
2175.             (Mod(x**2 + x, 7), 5)
2176.     # a.is_Mul
2177.     assert invert_modular(Mod(3*x, 7), S(5), n, x) == \
2178.             (x, ImageSet(Lambda(n, 7*n + 4), S.Integers))
2179.     assert invert_modular(Mod((x + 1)*(x + 2), 7), S(5), n, x) == \
2180.             (Mod((x + 1)*(x + 2), 7), 5)
2181.     # a.is_Pow
2182.     assert invert_modular(Mod(x**4, 7), S(5), n, x) == \
2183.             (x, EmptySet())
2184.     assert invert_modular(Mod(3**x, 4), S(3), n, x) == \
2185.             (x, ImageSet(Lambda(n, 2*n + 1), S.Naturals0))
2186.     assert invert_modular(Mod(2**(x**2 + x + 1), 7), S(2), n, x) == \
2187.             (x**2 + x + 1, ImageSet(Lambda(n, 3*n + 1), S.Naturals0))
2188. 
2189. 
2190. def test_solve_modular():
2191.     x = Symbol('x')
2192.     n = Dummy('n', integer=True)
2193.     # if rhs has symbol (need to be implemented in future).
2194.     assert solveset(Mod(x, 4) - x, x, S.Integers) == \
2195.             ConditionSet(x, Eq(-x + Mod(x, 4), 0), \
2196.             S.Integers)
2197.     # when _invert_modular fails to invert
2198.     assert solveset(3 - Mod(sin(x), 7), x, S.Integers) == \
2199.             ConditionSet(x, Eq(Mod(sin(x), 7) - 3, 0), S.Integers)
2200.     assert solveset(3 - Mod(log(x), 7), x, S.Integers) == \
2201.             ConditionSet(x, Eq(Mod(log(x), 7) - 3, 0), S.Integers)
2202.     assert solveset(3 - Mod(exp(x), 7), x, S.Integers) == \
2203.             ConditionSet(x, Eq(Mod(exp(x), 7) - 3, 0), S.Integers)
2204.     # EmptySet solution definitely
2205.     assert solveset(7 - Mod(x, 5), x, S.Integers) == EmptySet()
2206.     assert solveset(5 - Mod(x, 5), x, S.Integers) == EmptySet()
2207.     # Negative m
2208.     assert solveset(2 + Mod(x, -3), x, S.Integers) == \
2209.             ImageSet(Lambda(n, -3*n - 2), S.Integers)
2210.     assert solveset(4 + Mod(x, -3), x, S.Integers) == EmptySet()
2211.     # linear expression in Mod
2212.     assert solveset(3 - Mod(x, 5), x, S.Integers) == ImageSet(Lambda(n, 5*n + 3), S.Integers)
2213.     assert solveset(3 - Mod(5*x - 8, 7), x, S.Integers) == \
2214.                 ImageSet(Lambda(n, 7*n + 5), S.Integers)
2215.     assert solveset(3 - Mod(5*x, 7), x, S.Integers) == \
2216.                 ImageSet(Lambda(n, 7*n + 2), S.Integers)
2217.     # higher degree expression in Mod
2218.     assert solveset(Mod(x**2, 160) - 9, x, S.Integers) == \
2219.             Union(ImageSet(Lambda(n, 160*n + 3), S.Integers),
2220.             ImageSet(Lambda(n, 160*n + 13), S.Integers),
2221.             ImageSet(Lambda(n, 160*n + 67), S.Integers),
2222.             ImageSet(Lambda(n, 160*n + 77), S.Integers),
2223.             ImageSet(Lambda(n, 160*n + 83), S.Integers),
2224.             ImageSet(Lambda(n, 160*n + 93), S.Integers),
2225.             ImageSet(Lambda(n, 160*n + 147), S.Integers),
2226.             ImageSet(Lambda(n, 160*n + 157), S.Integers))
2227.     assert solveset(3 - Mod(x**4, 7), x, S.Integers) == EmptySet()
2228.     assert solveset(Mod(x**4, 17) - 13, x, S.Integers) == \
2229.             Union(ImageSet(Lambda(n, 17*n + 3), S.Integers),
2230.             ImageSet(Lambda(n, 17*n + 5), S.Integers),
2231.             ImageSet(Lambda(n, 17*n + 12), S.Integers),
2232.             ImageSet(Lambda(n, 17*n + 14), S.Integers))
2233.     # a.is_Pow tests
2234.     assert solveset(Mod(7**x, 41) - 15, x, S.Integers) == \
2235.             ImageSet(Lambda(n, 40*n + 3), S.Naturals0)
2236.     assert solveset(Mod(12**x, 21) - 18, x, S.Integers) == \
2237.             ImageSet(Lambda(n, 6*n + 2), S.Naturals0)
2238.     assert solveset(Mod(3**x, 4) - 3, x, S.Integers) == \
2239.             ImageSet(Lambda(n, 2*n + 1), S.Naturals0)
2240.     assert solveset(Mod(2**x, 7) - 2 , x, S.Integers) == \
2241.             ImageSet(Lambda(n, 3*n + 1), S.Naturals0)
2242.     assert solveset(Mod(3**(3**x), 4) - 3, x, S.Integers) == \
2243.             Intersection(ImageSet(Lambda(n, Intersection({log(2*n + 1)/log(3)},
2244.             S.Integers)), S.Naturals0), S.Integers)
2245.     # Not Implemented for m without primitive root
2246.     assert solveset(Mod(x**3, 8) - 1, x, S.Integers) == \
2247.             ConditionSet(x, Eq(Mod(x**3, 8) - 1, 0), S.Integers)
2248.     assert solveset(Mod(x**4, 9) - 4, x, S.Integers) == \
2249.             ConditionSet(x, Eq(Mod(x**4, 9) - 4, 0), S.Integers)
2250.     # domain intersection
2251.     assert solveset(3 - Mod(5*x - 8, 7), x, S.Naturals0) == \
2252.             Intersection(ImageSet(Lambda(n, 7*n + 5), S.Integers), S.Naturals0)
2253.     # Complex args
2254.     assert solveset(Mod(x, 3) - I, x, S.Integers) == \
2255.             EmptySet()
2256.     assert solveset(Mod(I*x, 3) - 2, x, S.Integers) == \
2257.             ConditionSet(x, Eq(Mod(I*x, 3) - 2, 0), S.Integers)
2258.     assert solveset(Mod(I + x, 3) - 2, x, S.Integers) == \
2259.             ConditionSet(x, Eq(Mod(x + I, 3) - 2, 0), S.Integers)
2260.     # issue 13178
2261.     n = symbols('n', integer=True)
2262.     a = 742938285
2263.     z = 1898888478
2264.     m = 2**31 - 1
2265.     x = 20170816
2266.     assert solveset(x - Mod(a**n*z, m), n, S.Integers) == \
2267.             ImageSet(Lambda(n, 2147483646*n + 100), S.Naturals0)
2268.     assert solveset(x - Mod(a**n*z, m), n, S.Naturals0) == \
2269.             Intersection(ImageSet(Lambda(n, 2147483646*n + 100), S.Naturals0),
2270.             S.Naturals0)
2271.     assert solveset(x - Mod(a**(2*n)*z, m), n, S.Integers) == \
2272.             Intersection(ImageSet(Lambda(n, 1073741823*n + 50), S.Naturals0),
2273.             S.Integers)
2274.     assert solveset(x - Mod(a**(2*n + 7)*z, m), n, S.Integers) == EmptySet()
2275.     assert solveset(x - Mod(a**(n - 4)*z, m), n, S.Integers) == \
2276.             Intersection(ImageSet(Lambda(n, 2147483646*n + 104), S.Naturals0),
2277.             S.Integers)
2278. 
2279. @XFAIL
2280. def test_solve_modular_fail():
2281.     # issue 17373 (https://github.com/sympy/sympy/issues/17373)
2282.     assert solveset(Mod(x**4, 14) - 11, x, S.Integers) == \
2283.             Union(ImageSet(Lambda(n, 14*n + 3), S.Integers),
2284.             ImageSet(Lambda(n, 14*n + 11), S.Integers))
2285.     assert solveset(Mod(x**31, 74) - 43, x, S.Integers) == \
2286.             ImageSet(Lambda(n, 74*n + 31), S.Integers)
2287. 
2288. # end of modular tests

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 03:28:19,528 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user has requested the full content of the file `sympy/solvers/tests/test_solveset.py`. The context provided contains the entire file, from line 1 to line 2288.', relative_path='sympy/solvers/tests/test_solveset.py', start_line=1, end_line=2288)]
2025-12-23 03:28:19,532 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file `sympy/solvers/tests/test_solveset.py`.
2025-12-23 03:28:19,532 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 03:28:19,532 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 03:28:19,532 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-23 03:28:19,533 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-23 03:28:19,533 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_array_utils.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_pyutils.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── __init__.py
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: `solveset` raises `NotImplementedError` instead of returning `ConditionSet`

Description: The problem is
```julia
In [10]: Eq(n*cos(n) - 3*sin(n), 0).as_set()                                                                                                                  
---------------------------------------------------------------------------
NotImplementedError
```
Here `solveset` raises `NotImplementedError` but probably a `ConditionSet` should be returned by `solveset` instead. The obvious result of `as_set()` here is
```julia
In [11]: ConditionSet(n, Eq(n*cos(n) - 3*sin(n), 0), Reals)                                                                                                   
Out[11]: {n | n ∊ ℝ ∧ n⋅cos(n) - 3⋅sin(n) = 0}
```

_Originally posted by @oscarbenjamin in https://github.com/sympy/sympy/pull/17771_

Patch information:
diff --git a/sympy/core/relational.py b/sympy/core/relational.py
index f581bfa3c4..9e54266d56 100644
--- a/sympy/core/relational.py
+++ b/sympy/core/relational.py
@@ -389,10 +389,14 @@ def __nonzero__(self):
     def _eval_as_set(self):
         # self is univariate and periodicity(self, x) in (0, None)
         from sympy.solvers.inequalities import solve_univariate_inequality
+        from sympy.sets.conditionset import ConditionSet
         syms = self.free_symbols
         assert len(syms) == 1
         x = syms.pop()
-        return solve_univariate_inequality(self, x, relational=False)
+        try:
+            return solve_univariate_inequality(self, x, relational=False)
+        except NotImplementedError:
+            return ConditionSet(x, self, S.Reals)
 
     @property
     def binary_symbols(self):
diff --git a/sympy/logic/boolalg.py b/sympy/logic/boolalg.py
index c3664a1055..8a6232435b 100644
--- a/sympy/logic/boolalg.py
+++ b/sympy/logic/boolalg.py
@@ -152,10 +152,8 @@ def as_set(self):
                     if s in (S.EmptySet, S.UniversalSet, S.Reals):
                         reps[r] = s.as_relational(x)
                         continue
-                    raise NotImplementedError(filldedent('''
-                        as_set is not implemented for relationals
-                        with periodic solutions
-                        '''))
+                    from sympy.sets.conditionset import ConditionSet
+                    return ConditionSet(x, self, S.Reals)
             return self.subs(reps)._eval_as_set()
         else:
             raise NotImplementedError("Sorry, as_set has not yet been"


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `sympy/solvers/tests/test_solveset.py`.
Extra Requirements: 
Purpose: I need to find test cases that demonstrate how `solveset` handles equations for which it cannot find an explicit solution, which is central to the user's problem description.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/solvers/tests/test_solveset.py
Line number range: 1 - 2288
Content:
1. from sympy.core.containers import Tuple
2. from sympy.core.function import (Function, Lambda, nfloat)
3. from sympy.core.mod import Mod
4. from sympy.core.numbers import (E, I, Rational, oo, pi)
5. from sympy.core.relational import (Eq, Gt,
6.     Ne)
7. from sympy.core.singleton import S
8. from sympy.core.symbol import (Dummy, Symbol, symbols)
9. from sympy.functions.elementary.complexes import (Abs, arg, im, re, sign)
10. from sympy.functions.elementary.exponential import (LambertW, exp, log)
11. from sympy.functions.elementary.hyperbolic import (HyperbolicFunction,
12.     atanh, sinh, tanh, cosh, sech, coth)
13. from sympy.functions.elementary.miscellaneous import sqrt, Min, Max
14. from sympy.functions.elementary.piecewise import Piecewise
15. from sympy.functions.elementary.trigonometric import (
16.     TrigonometricFunction, acos, acot, acsc, asec, asin, atan, atan2,
17.     cos, cot, csc, sec, sin, tan)
18. from sympy.functions.special.error_functions import (erf, erfc,
19.     erfcinv, erfinv)
20. from sympy.logic.boolalg import And
21. from sympy.matrices.dense import MutableDenseMatrix as Matrix
22. from sympy.matrices.immutable import ImmutableDenseMatrix
23. from sympy.polys.polytools import Poly
24. from sympy.polys.rootoftools import CRootOf
25. from sympy.sets.contains import Contains
26. from sympy.sets.conditionset import ConditionSet
27. from sympy.sets.fancysets import ImageSet
28. from sympy.sets.sets import (Complement, EmptySet, FiniteSet,
29.     Intersection, Interval, Union, imageset, ProductSet)
30. from sympy.tensor.indexed import Indexed
31. from sympy.utilities.iterables import numbered_symbols
32. 
33. from sympy.utilities.pytest import (XFAIL, raises, skip, slow, SKIP,
34.     nocache_fail)
35. from sympy.utilities.randtest import verify_numerically as tn
36. from sympy.physics.units import cm
37. 
38. from sympy.solvers.solveset import (
39.     solveset_real, domain_check, solveset_complex, linear_eq_to_matrix,
40.     linsolve, _is_function_class_equation, invert_real, invert_complex,
41.     solveset, solve_decomposition, substitution, nonlinsolve, solvify,
42.     _is_finite_with_finite_vars, _transolve, _is_exponential,
43.     _solve_exponential, _is_logarithmic,
44.     _solve_logarithm, _term_factors, _is_modular)
45. 
46. 
47. a = Symbol('a', real=True)
48. b = Symbol('b', real=True)
49. c = Symbol('c', real=True)
50. x = Symbol('x', real=True)
51. y = Symbol('y', real=True)
52. z = Symbol('z', real=True)
53. q = Symbol('q', real=True)
54. m = Symbol('m', real=True)
55. n = Symbol('n', real=True)
56. 
57. 
58. def test_invert_real():
59.     x = Symbol('x', real=True)
60.     y = Symbol('y')
61.     n = Symbol('n')
62. 
63.     def ireal(x, s=S.Reals):
64.         return Intersection(s, x)
65. 
66.     # issue 14223
67.     assert invert_real(x, 0, x, Interval(1, 2)) == (x, S.EmptySet)
68. 
69.     assert invert_real(exp(x), y, x) == (x, ireal(FiniteSet(log(y))))
70. 
71.     y = Symbol('y', positive=True)
72.     n = Symbol('n', real=True)
73.     assert invert_real(x + 3, y, x) == (x, FiniteSet(y - 3))
74.     assert invert_real(x*3, y, x) == (x, FiniteSet(y / 3))
75. 
76.     assert invert_real(exp(x), y, x) == (x, FiniteSet(log(y)))
77.     assert invert_real(exp(3*x), y, x) == (x, FiniteSet(log(y) / 3))
78.     assert invert_real(exp(x + 3), y, x) == (x, FiniteSet(log(y) - 3))
79. 
80.     assert invert_real(exp(x) + 3, y, x) == (x, ireal(FiniteSet(log(y - 3))))
81.     assert invert_real(exp(x)*3, y, x) == (x, FiniteSet(log(y / 3)))
82. 
83.     assert invert_real(log(x), y, x) == (x, FiniteSet(exp(y)))
84.     assert invert_real(log(3*x), y, x) == (x, FiniteSet(exp(y) / 3))
85.     assert invert_real(log(x + 3), y, x) == (x, FiniteSet(exp(y) - 3))
86. 
87.     assert invert_real(Abs(x), y, x) == (x, FiniteSet(y, -y))
88. 
89.     assert invert_real(2**x, y, x) == (x, FiniteSet(log(y)/log(2)))
90.     assert invert_real(2**exp(x), y, x) == (x, ireal(FiniteSet(log(log(y)/log(2)))))
91. 
92.     assert invert_real(x**2, y, x) == (x, FiniteSet(sqrt(y), -sqrt(y)))
93.     assert invert_real(x**S.Half, y, x) == (x, FiniteSet(y**2))
94. 
95.     raises(ValueError, lambda: invert_real(x, x, x))
96.     raises(ValueError, lambda: invert_real(x**pi, y, x))
97.     raises(ValueError, lambda: invert_real(S.One, y, x))
98. 
99.     assert invert_real(x**31 + x, y, x) == (x**31 + x, FiniteSet(y))
100. 
101.     lhs = x**31 + x
102.     base_values =  FiniteSet(y - 1, -y - 1)
103.     assert invert_real(Abs(x**31 + x + 1), y, x) == (lhs, base_values)
104. 
105.     assert invert_real(sin(x), y, x) == \
106.         (x, imageset(Lambda(n, n*pi + (-1)**n*asin(y)), S.Integers))
107. 
108.     assert invert_real(sin(exp(x)), y, x) == \
109.         (x, imageset(Lambda(n, log((-1)**n*asin(y) + n*pi)), S.Integers))
110. 
111.     assert invert_real(csc(x), y, x) == \
112.         (x, imageset(Lambda(n, n*pi + (-1)**n*acsc(y)), S.Integers))
113. 
114.     assert invert_real(csc(exp(x)), y, x) == \
115.         (x, imageset(Lambda(n, log((-1)**n*acsc(y) + n*pi)), S.Integers))
116. 
117.     assert invert_real(cos(x), y, x) == \
118.         (x, Union(imageset(Lambda(n, 2*n*pi + acos(y)), S.Integers), \
119.                 imageset(Lambda(n, 2*n*pi - acos(y)), S.Integers)))
120. 
121.     assert invert_real(cos(exp(x)), y, x) == \
122.         (x, Union(imageset(Lambda(n, log(2*n*pi + acos(y))), S.Integers), \
123.                 imageset(Lambda(n, log(2*n*pi - acos(y))), S.Integers)))
124. 
125.     assert invert_real(sec(x), y, x) == \
126.         (x, Union(imageset(Lambda(n, 2*n*pi + asec(y)), S.Integers), \
127.                 imageset(Lambda(n, 2*n*pi - asec(y)), S.Integers)))
128. 
129.     assert invert_real(sec(exp(x)), y, x) == \
130.         (x, Union(imageset(Lambda(n, log(2*n*pi + asec(y))), S.Integers), \
131.                 imageset(Lambda(n, log(2*n*pi - asec(y))), S.Integers)))
132. 
133.     assert invert_real(tan(x), y, x) == \
134.         (x, imageset(Lambda(n, n*pi + atan(y)), S.Integers))
135. 
136.     assert invert_real(tan(exp(x)), y, x) == \
137.         (x, imageset(Lambda(n, log(n*pi + atan(y))), S.Integers))
138. 
139.     assert invert_real(cot(x), y, x) == \
140.         (x, imageset(Lambda(n, n*pi + acot(y)), S.Integers))
141. 
142.     assert invert_real(cot(exp(x)), y, x) == \
143.         (x, imageset(Lambda(n, log(n*pi + acot(y))), S.Integers))
144. 
145.     assert invert_real(tan(tan(x)), y, x) == \
146.         (tan(x), imageset(Lambda(n, n*pi + atan(y)), S.Integers))
147. 
148.     x = Symbol('x', positive=True)
149.     assert invert_real(x**pi, y, x) == (x, FiniteSet(y**(1/pi)))
150. 
151. 
152. def test_invert_complex():
153.     assert invert_complex(x + 3, y, x) == (x, FiniteSet(y - 3))
154.     assert invert_complex(x*3, y, x) == (x, FiniteSet(y / 3))
155. 
156.     assert invert_complex(exp(x), y, x) == \
157.         (x, imageset(Lambda(n, I*(2*pi*n + arg(y)) + log(Abs(y))), S.Integers))
158. 
159.     assert invert_complex(log(x), y, x) == (x, FiniteSet(exp(y)))
160. 
161.     raises(ValueError, lambda: invert_real(1, y, x))
162.     raises(ValueError, lambda: invert_complex(x, x, x))
163.     raises(ValueError, lambda: invert_complex(x, x, 1))
164. 
165.     # https://github.com/skirpichev/omg/issues/16
166.     assert invert_complex(sinh(x), 0, x) != (x, FiniteSet(0))
167. 
168. 
169. def test_domain_check():
170.     assert domain_check(1/(1 + (1/(x+1))**2), x, -1) is False
171.     assert domain_check(x**2, x, 0) is True
172.     assert domain_check(x, x, oo) is False
173.     assert domain_check(0, x, oo) is False
174. 
175. 
176. def test_issue_11536():
177.     assert solveset(0**x - 100, x, S.Reals) == S.EmptySet
178.     assert solveset(0**x - 1, x, S.Reals) == FiniteSet(0)
179. 
180. 
181. def test_issue_17479():
182.     import sympy as sb
183.     from sympy.solvers.solveset import nonlinsolve
184.     x, y, z = sb.symbols("x, y, z")
185.     f = (x**2 + y**2)**2 + (x**2 + z**2)**2 - 2*(2*x**2 + y**2 + z**2)
186.     fx = sb.diff(f, x)
187.     fy = sb.diff(f, y)
188.     fz = sb.diff(f, z)
189.     sol = nonlinsolve([fx, fy, fz], [x, y, z])
190.     # FIXME: This previously gave 18 solutions and now gives 20 due to fixes
191.     # in the handling of intersection of FiniteSets or possibly a small change
192.     # to ImageSet._contains. However Using expand I can turn this into 16
193.     # solutions either way:
194.     #
195.     #    >>> len(FiniteSet(*(Tuple(*(expand(w) for w in s)) for s in sol)))
196.     #    16
197.     #
198.     assert len(sol) == 20
199. 
200. 
201. def test_is_function_class_equation():
202.     from sympy.abc import x, a
203.     assert _is_function_class_equation(TrigonometricFunction,
204.                                        tan(x), x) is True
205.     assert _is_function_class_equation(TrigonometricFunction,
206.                                        tan(x) - 1, x) is True
207.     assert _is_function_class_equation(TrigonometricFunction,
208.                                        tan(x) + sin(x), x) is True
209.     assert _is_function_class_equation(TrigonometricFunction,
210.                                        tan(x) + sin(x) - a, x) is True
211.     assert _is_function_class_equation(TrigonometricFunction,
212.                                        sin(x)*tan(x) + sin(x), x) is True
213.     assert _is_function_class_equation(TrigonometricFunction,
214.                                        sin(x)*tan(x + a) + sin(x), x) is True
215.     assert _is_function_class_equation(TrigonometricFunction,
216.                                        sin(x)*tan(x*a) + sin(x), x) is True
217.     assert _is_function_class_equation(TrigonometricFunction,
218.                                        a*tan(x) - 1, x) is True
219.     assert _is_function_class_equation(TrigonometricFunction,
220.                                        tan(x)**2 + sin(x) - 1, x) is True
221.     assert _is_function_class_equation(TrigonometricFunction,
222.                                        tan(x) + x, x) is False
223.     assert _is_function_class_equation(TrigonometricFunction,
224.                                        tan(x**2), x) is False
225.     assert _is_function_class_equation(TrigonometricFunction,
226.                                        tan(x**2) + sin(x), x) is False
227.     assert _is_function_class_equation(TrigonometricFunction,
228.                                        tan(x)**sin(x), x) is False
229.     assert _is_function_class_equation(TrigonometricFunction,
230.                                        tan(sin(x)) + sin(x), x) is False
231.     assert _is_function_class_equation(HyperbolicFunction,
232.                                        tanh(x), x) is True
233.     assert _is_function_class_equation(HyperbolicFunction,
234.                                        tanh(x) - 1, x) is True
235.     assert _is_function_class_equation(HyperbolicFunction,
236.                                        tanh(x) + sinh(x), x) is True
237.     assert _is_function_class_equation(HyperbolicFunction,
238.                                        tanh(x) + sinh(x) - a, x) is True
239.     assert _is_function_class_equation(HyperbolicFunction,
240.                                        sinh(x)*tanh(x) + sinh(x), x) is True
241.     assert _is_function_class_equation(HyperbolicFunction,
242.                                        sinh(x)*tanh(x + a) + sinh(x), x) is True
243.     assert _is_function_class_equation(HyperbolicFunction,
244.                                        sinh(x)*tanh(x*a) + sinh(x), x) is True
245.     assert _is_function_class_equation(HyperbolicFunction,
246.                                        a*tanh(x) - 1, x) is True
247.     assert _is_function_class_equation(HyperbolicFunction,
248.                                        tanh(x)**2 + sinh(x) - 1, x) is True
249.     assert _is_function_class_equation(HyperbolicFunction,
250.                                        tanh(x) + x, x) is False
251.     assert _is_function_class_equation(HyperbolicFunction,
252.                                        tanh(x**2), x) is False
253.     assert _is_function_class_equation(HyperbolicFunction,
254.                                        tanh(x**2) + sinh(x), x) is False
255.     assert _is_function_class_equation(HyperbolicFunction,
256.                                        tanh(x)**sinh(x), x) is False
257.     assert _is_function_class_equation(HyperbolicFunction,
258.                                        tanh(sinh(x)) + sinh(x), x) is False
259. 
260. 
261. def test_garbage_input():
262.     raises(ValueError, lambda: solveset_real([x], x))
263.     assert solveset_real(x, 1) == S.EmptySet
264.     assert solveset_real(x - 1, 1) == FiniteSet(x)
265.     assert solveset_real(x, pi) == S.EmptySet
266.     assert solveset_real(x, x**2) == S.EmptySet
267. 
268.     raises(ValueError, lambda: solveset_complex([x], x))
269.     assert solveset_complex(x, pi) == S.EmptySet
270. 
271.     raises(ValueError, lambda: solveset((x, y), x))
272.     raises(ValueError, lambda: solveset(x + 1, S.Reals))
273.     raises(ValueError, lambda: solveset(x + 1, x, 2))
274. 
275. 
276. def test_solve_mul():
277.     assert solveset_real((a*x + b)*(exp(x) - 3), x) == \
278.         Union({log(3)}, Intersection({-b/a}, S.Reals))
279.     anz = Symbol('anz', nonzero=True)
280.     assert solveset_real((anz*x + b)*(exp(x) - 3), x) == \
281.         FiniteSet(-b/anz, log(3))
282.     assert solveset_real((2*x + 8)*(8 + exp(x)), x) == FiniteSet(S(-4))
283.     assert solveset_real(x/log(x), x) == EmptySet()
284. 
285. 
286. def test_solve_invert():
287.     assert solveset_real(exp(x) - 3, x) == FiniteSet(log(3))
288.     assert solveset_real(log(x) - 3, x) == FiniteSet(exp(3))
289. 
290.     assert solveset_real(3**(x + 2), x) == FiniteSet()
291.     assert solveset_real(3**(2 - x), x) == FiniteSet()
292. 
293.     assert solveset_real(y - b*exp(a/x), x) == Intersection(
294.         S.Reals, FiniteSet(a/log(y/b)))
295. 
296.     # issue 4504
297.     assert solveset_real(2**x - 10, x) == FiniteSet(1 + log(5)/log(2))
298. 
299. 
300. def test_errorinverses():
301.     assert solveset_real(erf(x) - S.Half, x) == \
302.         FiniteSet(erfinv(S.Half))
303.     assert solveset_real(erfinv(x) - 2, x) == \
304.         FiniteSet(erf(2))
305.     assert solveset_real(erfc(x) - S.One, x) == \
306.         FiniteSet(erfcinv(S.One))
307.     assert solveset_real(erfcinv(x) - 2, x) == FiniteSet(erfc(2))
308. 
309. 
310. def test_solve_polynomial():
311.     assert solveset_real(3*x - 2, x) == FiniteSet(Rational(2, 3))
312. 
313.     assert solveset_real(x**2 - 1, x) == FiniteSet(-S.One, S.One)
314.     assert solveset_real(x - y**3, x) == FiniteSet(y ** 3)
315. 
316.     a11, a12, a21, a22, b1, b2 = symbols('a11, a12, a21, a22, b1, b2')
317. 
318.     assert solveset_real(x**3 - 15*x - 4, x) == FiniteSet(
319.         -2 + 3 ** S.Half,
320.         S(4),
321.         -2 - 3 ** S.Half)
322. 
323.     assert solveset_real(sqrt(x) - 1, x) == FiniteSet(1)
324.     assert solveset_real(sqrt(x) - 2, x) == FiniteSet(4)
325.     assert solveset_real(x**Rational(1, 4) - 2, x) == FiniteSet(16)
326.     assert solveset_real(x**Rational(1, 3) - 3, x) == FiniteSet(27)
327.     assert len(solveset_real(x**5 + x**3 + 1, x)) == 1
328.     assert len(solveset_real(-2*x**3 + 4*x**2 - 2*x + 6, x)) > 0
329. 
330.     assert solveset_real(x**6 + x**4  + I, x) == ConditionSet(x,
331.                                         Eq(x**6 + x**4 + I, 0), S.Reals)
332. 
333. 
334. def test_return_root_of():
335.     f = x**5 - 15*x**3 - 5*x**2 + 10*x + 20
336.     s = list(solveset_complex(f, x))
337.     for root in s:
338.         assert root.func == CRootOf
339. 
340.     # if one uses solve to get the roots of a polynomial that has a CRootOf
341.     # solution, make sure that the use of nfloat during the solve process
342.     # doesn't fail. Note: if you want numerical solutions to a polynomial
343.     # it is *much* faster to use nroots to get them than to solve the
344.     # equation only to get CRootOf solutions which are then numerically
345.     # evaluated. So for eq = x**5 + 3*x + 7 do Poly(eq).nroots() rather
346.     # than [i.n() for i in solve(eq)] to get the numerical roots of eq.
347.     assert nfloat(list(solveset_complex(x**5 + 3*x**3 + 7, x))[0],
348.                   exponent=False) == CRootOf(x**5 + 3*x**3 + 7, 0).n()
349. 
350.     sol = list(solveset_complex(x**6 - 2*x + 2, x))
351.     assert all(isinstance(i, CRootOf) for i in sol) and len(sol) == 6
352. 
353.     f = x**5 - 15*x**3 - 5*x**2 + 10*x + 20
354.     s = list(solveset_complex(f, x))
355.     for root in s:
356.         assert root.func == CRootOf
357. 
358.     s = x**5 + 4*x**3 + 3*x**2 + Rational(7, 4)
359.     assert solveset_complex(s, x) == \
360.         FiniteSet(*Poly(s*4, domain='ZZ').all_roots())
361. 
362.     # Refer issue #7876
363.     eq = x*(x - 1)**2*(x + 1)*(x**6 - x + 1)
364.     assert solveset_complex(eq, x) == \
365.         FiniteSet(-1, 0, 1, CRootOf(x**6 - x + 1, 0),
366.                        CRootOf(x**6 - x + 1, 1),
367.                        CRootOf(x**6 - x + 1, 2),
368.                        CRootOf(x**6 - x + 1, 3),
369.                        CRootOf(x**6 - x + 1, 4),
370.                        CRootOf(x**6 - x + 1, 5))
371. 
372. 
373. def test__has_rational_power():
374.     from sympy.solvers.solveset import _has_rational_power
375.     assert _has_rational_power(sqrt(2), x)[0] is False
376.     assert _has_rational_power(x*sqrt(2), x)[0] is False
377. 
378.     assert _has_rational_power(x**2*sqrt(x), x) == (True, 2)
379.     assert _has_rational_power(sqrt(2)*x**Rational(1, 3), x) == (True, 3)
380.     assert _has_rational_power(sqrt(x)*x**Rational(1, 3), x) == (True, 6)
381. 
382. 
383. def test_solveset_sqrt_1():
384.     assert solveset_real(sqrt(5*x + 6) - 2 - x, x) == \
385.         FiniteSet(-S.One, S(2))
386.     assert solveset_real(sqrt(x - 1) - x + 7, x) == FiniteSet(10)
387.     assert solveset_real(sqrt(x - 2) - 5, x) == FiniteSet(27)
388.     assert solveset_real(sqrt(x) - 2 - 5, x) == FiniteSet(49)
389.     assert solveset_real(sqrt(x**3), x) == FiniteSet(0)
390.     assert solveset_real(sqrt(x - 1), x) == FiniteSet(1)
391. 
392. 
393. def test_solveset_sqrt_2():
394.     # http://tutorial.math.lamar.edu/Classes/Alg/SolveRadicalEqns.aspx#Solve_Rad_Ex2_a
395.     assert solveset_real(sqrt(2*x - 1) - sqrt(x - 4) - 2, x) == \
396.         FiniteSet(S(5), S(13))
397.     assert solveset_real(sqrt(x + 7) + 2 - sqrt(3 - x), x) == \
398.         FiniteSet(-6)
399. 
400.     # http://www.purplemath.com/modules/solverad.htm
401.     assert solveset_real(sqrt(17*x - sqrt(x**2 - 5)) - 7, x) == \
402.         FiniteSet(3)
403. 
404.     eq = x + 1 - (x**4 + 4*x**3 - x)**Rational(1, 4)
405.     assert solveset_real(eq, x) == FiniteSet(Rational(-1, 2), Rational(-1, 3))
406. 
407.     eq = sqrt(2*x + 9) - sqrt(x + 1) - sqrt(x + 4)
408.     assert solveset_real(eq, x) == FiniteSet(0)
409. 
410.     eq = sqrt(x + 4) + sqrt(2*x - 1) - 3*sqrt(x - 1)
411.     assert solveset_real(eq, x) == FiniteSet(5)
412. 
413.     eq = sqrt(x)*sqrt(x - 7) - 12
414.     assert solveset_real(eq, x) == FiniteSet(16)
415. 
416.     eq = sqrt(x - 3) + sqrt(x) - 3
417.     assert solveset_real(eq, x) == FiniteSet(4)
418. 
419.     eq = sqrt(2*x**2 - 7) - (3 - x)
420.     assert solveset_real(eq, x) == FiniteSet(-S(8), S(2))
421. 
422.     # others
423.     eq = sqrt(9*x**2 + 4) - (3*x + 2)
424.     assert solveset_real(eq, x) == FiniteSet(0)
425. 
426.     assert solveset_real(sqrt(x - 3) - sqrt(x) - 3, x) == FiniteSet()
427. 
428.     eq = (2*x - 5)**Rational(1, 3) - 3
429.     assert solveset_real(eq, x) == FiniteSet(16)
430. 
431.     assert solveset_real(sqrt(x) + sqrt(sqrt(x)) - 4, x) == \
432.         FiniteSet((Rational(-1, 2) + sqrt(17)/2)**4)
433. 
434.     eq = sqrt(x) - sqrt(x - 1) + sqrt(sqrt(x))
435.     assert solveset_real(eq, x) == FiniteSet()
436. 
437.     eq = (sqrt(x) + sqrt(x + 1) + sqrt(1 - x) - 6*sqrt(5)/5)
438.     ans = solveset_real(eq, x)
439.     ra = S('''-1484/375 - 4*(-1/2 + sqrt(3)*I/2)*(-12459439/52734375 +
440.     114*sqrt(12657)/78125)**(1/3) - 172564/(140625*(-1/2 +
441.     sqrt(3)*I/2)*(-12459439/52734375 + 114*sqrt(12657)/78125)**(1/3))''')
442.     rb = Rational(4, 5)
443.     assert all(abs(eq.subs(x, i).n()) < 1e-10 for i in (ra, rb)) and \
444.         len(ans) == 2 and \
445.         set([i.n(chop=True) for i in ans]) == \
446.         set([i.n(chop=True) for i in (ra, rb)])
447. 
448.     assert solveset_real(sqrt(x) + x**Rational(1, 3) +
449.                                  x**Rational(1, 4), x) == FiniteSet(0)
450. 
451.     assert solveset_real(x/sqrt(x**2 + 1), x) == FiniteSet(0)
452. 
453.     eq = (x - y**3)/((y**2)*sqrt(1 - y**2))
454.     assert solveset_real(eq, x) == FiniteSet(y**3)
455. 
456.     # issue 4497
457.     assert solveset_real(1/(5 + x)**Rational(1, 5) - 9, x) == \
458.         FiniteSet(Rational(-295244, 59049))
459. 
460. 
461. @XFAIL
462. def test_solve_sqrt_fail():
463.     # this only works if we check real_root(eq.subs(x, Rational(1, 3)))
464.     # but checksol doesn't work like that
465.     eq = (x**3 - 3*x**2)**Rational(1, 3) + 1 - x
466.     assert solveset_real(eq, x) == FiniteSet(Rational(1, 3))
467. 
468. 
469. @slow
470. def test_solve_sqrt_3():
471.     R = Symbol('R')
472.     eq = sqrt(2)*R*sqrt(1/(R + 1)) + (R + 1)*(sqrt(2)*sqrt(1/(R + 1)) - 1)
473.     sol = solveset_complex(eq, R)
474.     fset = [Rational(5, 3) + 4*sqrt(10)*cos(atan(3*sqrt(111)/251)/3)/3,
475.             -sqrt(10)*cos(atan(3*sqrt(111)/251)/3)/3 +
476.             40*re(1/((Rational(-1, 2) - sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9 +
477.             sqrt(30)*sin(atan(3*sqrt(111)/251)/3)/3 + Rational(5, 3) +
478.             I*(-sqrt(30)*cos(atan(3*sqrt(111)/251)/3)/3 -
479.                sqrt(10)*sin(atan(3*sqrt(111)/251)/3)/3 +
480.                40*im(1/((Rational(-1, 2) - sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9)]
481.     cset = [40*re(1/((Rational(-1, 2) + sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9 -
482.             sqrt(10)*cos(atan(3*sqrt(111)/251)/3)/3 - sqrt(30)*sin(atan(3*sqrt(111)/251)/3)/3 +
483.             Rational(5, 3) +
484.             I*(40*im(1/((Rational(-1, 2) + sqrt(3)*I/2)*(Rational(251, 27) + sqrt(111)*I/9)**Rational(1, 3)))/9 -
485.                sqrt(10)*sin(atan(3*sqrt(111)/251)/3)/3 +
486.                sqrt(30)*cos(atan(3*sqrt(111)/251)/3)/3)]
487. 
488.     assert sol._args[0] == FiniteSet(*fset)
489.     assert sol._args[1] == ConditionSet(
490.         R,
491.         Eq(sqrt(2)*R*sqrt(1/(R + 1)) + (R + 1)*(sqrt(2)*sqrt(1/(R + 1)) - 1), 0),
492.         FiniteSet(*cset))
493. 
494.     # the number of real roots will depend on the value of m: for m=1 there are 4
495.     # and for m=-1 there are none.
496.     eq = -sqrt((m - q)**2 + (-m/(2*q) + S.Half)**2) + sqrt((-m**2/2 - sqrt(
497.         4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2 + (m**2/2 - m - sqrt(
498.             4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2)
499.     unsolved_object = ConditionSet(q, Eq(sqrt((m - q)**2 + (-m/(2*q) + S.Half)**2) -
500.         sqrt((-m**2/2 - sqrt(4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2 + (m**2/2 - m -
501.         sqrt(4*m**4 - 4*m**2 + 8*m + 1)/4 - Rational(1, 4))**2), 0), S.Reals)
502.     assert solveset_real(eq, q) == unsolved_object
503. 
504. 
505. def test_solve_polynomial_symbolic_param():
506.     assert solveset_complex((x**2 - 1)**2 - a, x) == \
507.         FiniteSet(sqrt(1 + sqrt(a)), -sqrt(1 + sqrt(a)),
508.                   sqrt(1 - sqrt(a)), -sqrt(1 - sqrt(a)))
509. 
510.     # issue 4507
511.     assert solveset_complex(y - b/(1 + a*x), x) == \
512.         FiniteSet((b/y - 1)/a) - FiniteSet(-1/a)
513. 
514.     # issue 4508
515.     assert solveset_complex(y - b*x/(a + x), x) == \
516.         FiniteSet(-a*y/(y - b)) - FiniteSet(-a)
517. 
518. 
519. def test_solve_rational():
520.     assert solveset_real(1/x + 1, x) == FiniteSet(-S.One)
521.     assert solveset_real(1/exp(x) - 1, x) == FiniteSet(0)
522.     assert solveset_real(x*(1 - 5/x), x) == FiniteSet(5)
523.     assert solveset_real(2*x/(x + 2) - 1, x) == FiniteSet(2)
524.     assert solveset_real((x**2/(7 - x)).diff(x), x) == \
525.         FiniteSet(S.Zero, S(14))
526. 
527. 
528. def test_solveset_real_gen_is_pow():
529.     assert solveset_real(sqrt(1) + 1, x) == EmptySet()
530. 
531. 
532. def test_no_sol():
533.     assert solveset(1 - oo*x) == EmptySet()
534.     assert solveset(oo*x, x) == EmptySet()
535.     assert solveset(oo*x - oo, x) == EmptySet()
536.     assert solveset_real(4, x) == EmptySet()
537.     assert solveset_real(exp(x), x) == EmptySet()
538.     assert solveset_real(x**2 + 1, x) == EmptySet()
539.     assert solveset_real(-3*a/sqrt(x), x) == EmptySet()
540.     assert solveset_real(1/x, x) == EmptySet()
541.     assert solveset_real(-(1 + x)/(2 + x)**2 + 1/(2 + x), x) == \
542.         EmptySet()
543. 
544. 
545. def test_sol_zero_real():
546.     assert solveset_real(0, x) == S.Reals
547.     assert solveset(0, x, Interval(1, 2)) == Interval(1, 2)
548.     assert solveset_real(-x**2 - 2*x + (x + 1)**2 - 1, x) == S.Reals
549. 
550. 
551. def test_no_sol_rational_extragenous():
552.     assert solveset_real((x/(x + 1) + 3)**(-2), x) == EmptySet()
553.     assert solveset_real((x - 1)/(1 + 1/(x - 1)), x) == EmptySet()
554. 
555. 
556. def test_solve_polynomial_cv_1a():
557.     """
558.     Test for solving on equations that can be converted to
559.     a polynomial equation using the change of variable y -> x**Rational(p, q)
560.     """
561.     assert solveset_real(sqrt(x) - 1, x) == FiniteSet(1)
562.     assert solveset_real(sqrt(x) - 2, x) == FiniteSet(4)
563.     assert solveset_real(x**Rational(1, 4) - 2, x) == FiniteSet(16)
564.     assert solveset_real(x**Rational(1, 3) - 3, x) == FiniteSet(27)
565.     assert solveset_real(x*(x**(S.One / 3) - 3), x) == \
566.         FiniteSet(S.Zero, S(27))
567. 
568. 
569. def test_solveset_real_rational():
570.     """Test solveset_real for rational functions"""
571.     assert solveset_real((x - y**3) / ((y**2)*sqrt(1 - y**2)), x) \
572.         == FiniteSet(y**3)
573.     # issue 4486
574.     assert solveset_real(2*x/(x + 2) - 1, x) == FiniteSet(2)
575. 
576. 
577. def test_solveset_real_log():
578.     assert solveset_real(log((x-1)*(x+1)), x) == \
579.         FiniteSet(sqrt(2), -sqrt(2))
580. 
581. 
582. def test_poly_gens():
583.     assert solveset_real(4**(2*(x**2) + 2*x) - 8, x) == \
584.         FiniteSet(Rational(-3, 2), S.Half)
585. 
586. 
587. def test_solve_abs():
588.     x = Symbol('x')
589.     n = Dummy('n')
590.     raises(ValueError, lambda: solveset(Abs(x) - 1, x))
591.     assert solveset(Abs(x) - n, x, S.Reals) == ConditionSet(x, Contains(n, Interval(0, oo)), {-n, n})
592.     assert solveset_real(Abs(x) - 2, x) == FiniteSet(-2, 2)
593.     assert solveset_real(Abs(x) + 2, x) is S.EmptySet
594.     assert solveset_real(Abs(x + 3) - 2*Abs(x - 3), x) == \
595.         FiniteSet(1, 9)
596.     assert solveset_real(2*Abs(x) - Abs(x - 1), x) == \
597.         FiniteSet(-1, Rational(1, 3))
598. 
599.     sol = ConditionSet(
600.             x,
601.             And(
602.                 Contains(b, Interval(0, oo)),
603.                 Contains(a + b, Interval(0, oo)),
604.                 Contains(a - b, Interval(0, oo))),
605.             FiniteSet(-a - b - 3, -a + b - 3, a - b - 3, a + b - 3))
606.     eq = Abs(Abs(x + 3) - a) - b
607.     assert invert_real(eq, 0, x)[1] == sol
608.     reps = {a: 3, b: 1}
609.     eqab = eq.subs(reps)
610.     for i in sol.subs(reps):
611.         assert not eqab.subs(x, i)
612.     assert solveset(Eq(sin(Abs(x)), 1), x, domain=S.Reals) == Union(
613.         Intersection(Interval(0, oo),
614.             ImageSet(Lambda(n, (-1)**n*pi/2 + n*pi), S.Integers)),
615.         Intersection(Interval(-oo, 0),
616.             ImageSet(Lambda(n, n*pi - (-1)**(-n)*pi/2), S.Integers)))
617. 
618. 
619. 
620. def test_issue_9565():
621.     assert solveset_real(Abs((x - 1)/(x - 5)) <= Rational(1, 3), x) == Interval(-1, 2)
622. 
623. 
624. def test_issue_10069():
625.     eq = abs(1/(x - 1)) - 1 > 0
626.     u = Union(Interval.open(0, 1), Interval.open(1, 2))
627.     assert solveset_real(eq, x) == u
628. 
629. 
630. def test_real_imag_splitting():
631.     a, b = symbols('a b', real=True)
632.     assert solveset_real(sqrt(a**2 - b**2) - 3, a) == \
633.         FiniteSet(-sqrt(b**2 + 9), sqrt(b**2 + 9))
634.     assert solveset_real(sqrt(a**2 + b**2) - 3, a) != \
635.         S.EmptySet
636. 
637. 
638. def test_units():
639.     assert solveset_real(1/x - 1/(2*cm), x) == FiniteSet(2*cm)
640. 
641. 
642. def test_solve_only_exp_1():
643.     y = Symbol('y', positive=True)
644.     assert solveset_real(exp(x) - y, x) == FiniteSet(log(y))
645.     assert solveset_real(exp(x) + exp(-x) - 4, x) == \
646.         FiniteSet(log(-sqrt(3) + 2), log(sqrt(3) + 2))
647.     assert solveset_real(exp(x) + exp(-x) - y, x) != S.EmptySet
648. 
649. 
650. def test_atan2():
651.     # The .inverse() method on atan2 works only if x.is_real is True and the
652.     # second argument is a real constant
653.     assert solveset_real(atan2(x, 2) - pi/3, x) == FiniteSet(2*sqrt(3))
654. 
655. 
656. def test_piecewise_solveset():
657.     eq = Piecewise((x - 2, Gt(x, 2)), (2 - x, True)) - 3
658.     assert set(solveset_real(eq, x)) == set(FiniteSet(-1, 5))
659. 
660.     absxm3 = Piecewise(
661.         (x - 3, 0 <= x - 3),
662.         (3 - x, 0 > x - 3))
663.     y = Symbol('y', positive=True)
664.     assert solveset_real(absxm3 - y, x) == FiniteSet(-y + 3, y + 3)
665. 
666.     f = Piecewise(((x - 2)**2, x >= 0), (0, True))
667.     assert solveset(f, x, domain=S.Reals) == Union(FiniteSet(2), Interval(-oo, 0, True, True))
668. 
669.     assert solveset(
670.         Piecewise((x + 1, x > 0), (I, True)) - I, x, S.Reals
671.         ) == Interval(-oo, 0)
672. 
673.     assert solveset(Piecewise((x - 1, Ne(x, I)), (x, True)), x) == FiniteSet(1)
674. 
675. 
676. def test_solveset_complex_polynomial():
677.     from sympy.abc import x, a, b, c
678.     assert solveset_complex(a*x**2 + b*x + c, x) == \
679.         FiniteSet(-b/(2*a) - sqrt(-4*a*c + b**2)/(2*a),
680.                   -b/(2*a) + sqrt(-4*a*c + b**2)/(2*a))
681. 
682.     assert solveset_complex(x - y**3, y) == FiniteSet(
683.         (-x**Rational(1, 3))/2 + I*sqrt(3)*x**Rational(1, 3)/2,
684.         x**Rational(1, 3),
685.         (-x**Rational(1, 3))/2 - I*sqrt(3)*x**Rational(1, 3)/2)
686. 
687.     assert solveset_complex(x + 1/x - 1, x) == \
688.         FiniteSet(S.Half + I*sqrt(3)/2, S.Half - I*sqrt(3)/2)
689. 
690. 
691. def test_sol_zero_complex():
692.     assert solveset_complex(0, x) == S.Complexes
693. 
694. 
695. def test_solveset_complex_rational():
696.     assert solveset_complex((x - 1)*(x - I)/(x - 3), x) == \
697.         FiniteSet(1, I)
698. 
699.     assert solveset_complex((x - y**3)/((y**2)*sqrt(1 - y**2)), x) == \
700.         FiniteSet(y**3)
701.     assert solveset_complex(-x**2 - I, x) == \
702.         FiniteSet(-sqrt(2)/2 + sqrt(2)*I/2, sqrt(2)/2 - sqrt(2)*I/2)
703. 
704. 
705. def test_solve_quintics():
706.     skip("This test is too slow")
707.     f = x**5 - 110*x**3 - 55*x**2 + 2310*x + 979
708.     s = solveset_complex(f, x)
709.     for root in s:
710.         res = f.subs(x, root.n()).n()
711.         assert tn(res, 0)
712. 
713.     f = x**5 + 15*x + 12
714.     s = solveset_complex(f, x)
715.     for root in s:
716.         res = f.subs(x, root.n()).n()
717.         assert tn(res, 0)
718. 
719. 
720. def test_solveset_complex_exp():
721.     from sympy.abc import x, n
722.     assert solveset_complex(exp(x) - 1, x) == \
723.         imageset(Lambda(n, I*2*n*pi), S.Integers)
724.     assert solveset_complex(exp(x) - I, x) == \
725.         imageset(Lambda(n, I*(2*n*pi + pi/2)), S.Integers)
726.     assert solveset_complex(1/exp(x), x) == S.EmptySet
727.     assert solveset_complex(sinh(x).rewrite(exp), x) == \
728.         imageset(Lambda(n, n*pi*I), S.Integers)
729. 
730. 
731. def test_solveset_real_exp():
732.     from sympy.abc import x, y
733.     assert solveset(Eq((-2)**x, 4), x, S.Reals) == FiniteSet(2)
734.     assert solveset(Eq(-2**x, 4), x, S.Reals) == S.EmptySet
735.     assert solveset(Eq((-3)**x, 27), x, S.Reals) == S.EmptySet
736.     assert solveset(Eq((-5)**(x+1), 625), x, S.Reals) == FiniteSet(3)
737.     assert solveset(Eq(2**(x-3), -16), x, S.Reals) == S.EmptySet
738.     assert solveset(Eq((-3)**(x - 3), -3**39), x, S.Reals) == FiniteSet(42)
739.     assert solveset(Eq(2**x, y), x, S.Reals) == Intersection(S.Reals, FiniteSet(log(y)/log(2)))
740. 
741.     assert invert_real((-2)**(2*x) - 16, 0, x) == (x, FiniteSet(2))
742. 
743. 
744. def test_solve_complex_log():
745.     assert solveset_complex(log(x), x) == FiniteSet(1)
746.     assert solveset_complex(1 - log(a + 4*x**2), x) == \
747.         FiniteSet(-sqrt(-a + E)/2, sqrt(-a + E)/2)
748. 
749. 
750. def test_solve_complex_sqrt():
751.     assert solveset_complex(sqrt(5*x + 6) - 2 - x, x) == \
752.         FiniteSet(-S.One, S(2))
753.     assert solveset_complex(sqrt(5*x + 6) - (2 + 2*I) - x, x) == \
754.         FiniteSet(-S(2), 3 - 4*I)
755.     assert solveset_complex(4*x*(1 - a * sqrt(x)), x) == \
756.         FiniteSet(S.Zero, 1 / a ** 2)
757. 
758. 
759. def test_solveset_complex_tan():
760.     s = solveset_complex(tan(x).rewrite(exp), x)
761.     assert s == imageset(Lambda(n, pi*n), S.Integers) - \
762.         imageset(Lambda(n, pi*n + pi/2), S.Integers)
763. 
764. 
765. @nocache_fail
766. def test_solve_trig():
767.     from sympy.abc import n
768.     assert solveset_real(sin(x), x) == \
769.         Union(imageset(Lambda(n, 2*pi*n), S.Integers),
770.               imageset(Lambda(n, 2*pi*n + pi), S.Integers))
771. 
772.     assert solveset_real(sin(x) - 1, x) == \
773.         imageset(Lambda(n, 2*pi*n + pi/2), S.Integers)
774. 
775.     assert solveset_real(cos(x), x) == \
776.         Union(imageset(Lambda(n, 2*pi*n + pi/2), S.Integers),
777.               imageset(Lambda(n, 2*pi*n + pi*Rational(3, 2)), S.Integers))
778. 
779.     assert solveset_real(sin(x) + cos(x), x) == \
780.         Union(imageset(Lambda(n, 2*n*pi + pi*Rational(3, 4)), S.Integers),
781.               imageset(Lambda(n, 2*n*pi + pi*Rational(7, 4)), S.Integers))
782. 
783.     assert solveset_real(sin(x)**2 + cos(x)**2, x) == S.EmptySet
784. 
785.     # This fails when running with the cache off:
786.     assert solveset_complex(cos(x) - S.Half, x) == \
787.         Union(imageset(Lambda(n, 2*n*pi + pi*Rational(5, 3)), S.Integers),
788.               imageset(Lambda(n, 2*n*pi + pi/3), S.Integers))
789. 
790.     y, a = symbols('y,a')
791.     assert solveset(sin(y + a) - sin(y), a, domain=S.Reals) == \
792.         Union(ImageSet(Lambda(n, 2*n*pi), S.Integers),
793.         Intersection(ImageSet(Lambda(n, -I*(I*(
794.         2*n*pi + arg(-exp(-2*I*y))) +
795.         2*im(y))), S.Integers), S.Reals))
796. 
797.     assert solveset_real(sin(2*x)*cos(x) + cos(2*x)*sin(x)-1, x) == \
798.                             ImageSet(Lambda(n, n*pi*Rational(2, 3) + pi/6), S.Integers)
799. 
800.     # Tests for _solve_trig2() function
801.     assert solveset_real(2*cos(x)*cos(2*x) - 1, x) == \
802.           Union(ImageSet(Lambda(n, 2*n*pi + 2*atan(sqrt(-2*2**Rational(1, 3)*(67 +
803.                   9*sqrt(57))**Rational(2, 3) + 8*2**Rational(2, 3) + 11*(67 +
804.                   9*sqrt(57))**Rational(1, 3))/(3*(67 + 9*sqrt(57))**Rational(1, 6)))), S.Integers),
805.                   ImageSet(Lambda(n, 2*n*pi - 2*atan(sqrt(-2*2**Rational(1, 3)*(67 +
806.                   9*sqrt(57))**Rational(2, 3) + 8*2**Rational(2, 3) + 11*(67 +
807.                   9*sqrt(57))**Rational(1, 3))/(3*(67 + 9*sqrt(57))**Rational(1, 6))) +
808.                   2*pi), S.Integers))
809. 
810.     assert solveset_real(2*tan(x)*sin(x) + 1, x) == Union(
811.         ImageSet(Lambda(n, 2*n*pi + atan(sqrt(2)*sqrt(-1 +sqrt(17))/
812.             (1 - sqrt(17))) + pi), S.Integers),
813.         ImageSet(Lambda(n, 2*n*pi - atan(sqrt(2)*sqrt(-1 + sqrt(17))/
814.             (1 - sqrt(17))) + pi), S.Integers))
815. 
816.     assert solveset_real(cos(2*x)*cos(4*x) - 1, x) == \
817.                             ImageSet(Lambda(n, n*pi), S.Integers)
818. 
819. 
820. def test_solve_hyperbolic():
821.     # actual solver: _solve_trig1
822.     n = Dummy('n')
823.     assert solveset(sinh(x) + cosh(x), x) == S.EmptySet
824.     assert solveset(sinh(x) + cos(x), x) == ConditionSet(x,
825.         Eq(cos(x) + sinh(x), 0), S.Complexes)
826.     assert solveset_real(sinh(x) + sech(x), x) == FiniteSet(
827.         log(sqrt(sqrt(5) - 2)))
828.     assert solveset_real(3*cosh(2*x) - 5, x) == FiniteSet(
829.         log(sqrt(3)/3), log(sqrt(3)))
830.     assert solveset_real(sinh(x - 3) - 2, x) == FiniteSet(
831.         log((2 + sqrt(5))*exp(3)))
832.     assert solveset_real(cosh(2*x) + 2*sinh(x) - 5, x) == FiniteSet(
833.         log(-2 + sqrt(5)), log(1 + sqrt(2)))
834.     assert solveset_real((coth(x) + sinh(2*x))/cosh(x) - 3, x) == FiniteSet(
835.         log(S.Half + sqrt(5)/2), log(1 + sqrt(2)))
836.     assert solveset_real(cosh(x)*sinh(x) - 2, x) == FiniteSet(
837.         log(sqrt(4 + sqrt(17))))
838.     assert solveset_real(sinh(x) + tanh(x) - 1, x) == FiniteSet(
839.         log(sqrt(2)/2 + sqrt(-S(1)/2 + sqrt(2))))
840.     assert solveset_complex(sinh(x) - I/2, x) == Union(
841.         ImageSet(Lambda(n, I*(2*n*pi + 5*pi/6)), S.Integers),
842.         ImageSet(Lambda(n, I*(2*n*pi + pi/6)), S.Integers))
843.     assert solveset_complex(sinh(x) + sech(x), x) == Union(
844.         ImageSet(Lambda(n, 2*n*I*pi + log(sqrt(-2 + sqrt(5)))), S.Integers),
845.         ImageSet(Lambda(n, I*(2*n*pi + pi/2) + log(sqrt(2 + sqrt(5)))), S.Integers),
846.         ImageSet(Lambda(n, I*(2*n*pi + pi) + log(sqrt(-2 + sqrt(5)))), S.Integers),
847.         ImageSet(Lambda(n, I*(2*n*pi - pi/2) + log(sqrt(2 + sqrt(5)))), S.Integers))
848.     # issues #9606 / #9531:
849.     assert solveset(sinh(x), x, S.Reals) == FiniteSet(0)
850.     assert solveset(sinh(x), x, S.Complexes) == Union(
851.         ImageSet(Lambda(n, I*(2*n*pi + pi)), S.Integers),
852.         ImageSet(Lambda(n, 2*n*I*pi), S.Integers))
853. 
854. 
855. def test_solve_invalid_sol():
856.     assert 0 not in solveset_real(sin(x)/x, x)
857.     assert 0 not in solveset_complex((exp(x) - 1)/x, x)
858. 
859. 
860. @XFAIL
861. def test_solve_trig_simplified():
862.     from sympy.abc import n
863.     assert solveset_real(sin(x), x) == \
864.         imageset(Lambda(n, n*pi), S.Integers)
865. 
866.     assert solveset_real(cos(x), x) == \
867.         imageset(Lambda(n, n*pi + pi/2), S.Integers)
868. 
869.     assert solveset_real(cos(x) + sin(x), x) == \
870.         imageset(Lambda(n, n*pi - pi/4), S.Integers)
871. 
872. 
873. @XFAIL
874. def test_solve_lambert():
875.     assert solveset_real(x*exp(x) - 1, x) == FiniteSet(LambertW(1))
876.     assert solveset_real(exp(x) + x, x) == FiniteSet(-LambertW(1))
877.     assert solveset_real(x + 2**x, x) == \
878.         FiniteSet(-LambertW(log(2))/log(2))
879. 
880.     # issue 4739
881.     ans = solveset_real(3*x + 5 + 2**(-5*x + 3), x)
882.     assert ans == FiniteSet(Rational(-5, 3) +
883.                             LambertW(-10240*2**Rational(1, 3)*log(2)/3)/(5*log(2)))
884. 
885.     eq = 2*(3*x + 4)**5 - 6*7**(3*x + 9)
886.     result = solveset_real(eq, x)
887.     ans = FiniteSet((log(2401) +
888.                      5*LambertW(-log(7**(7*3**Rational(1, 5)/5))))/(3*log(7))/-1)
889.     assert result == ans
890.     assert solveset_real(eq.expand(), x) == result
891. 
892.     assert solveset_real(5*x - 1 + 3*exp(2 - 7*x), x) == \
893.         FiniteSet(Rational(1, 5) + LambertW(-21*exp(Rational(3, 5))/5)/7)
894. 
895.     assert solveset_real(2*x + 5 + log(3*x - 2), x) == \
896.         FiniteSet(Rational(2, 3) + LambertW(2*exp(Rational(-19, 3))/3)/2)
897. 
898.     assert solveset_real(3*x + log(4*x), x) == \
899.         FiniteSet(LambertW(Rational(3, 4))/3)
900. 
901.     assert solveset_real(x**x - 2) == FiniteSet(exp(LambertW(log(2))))
902. 
903.     a = Symbol('a')
904.     assert solveset_real(-a*x + 2*x*log(x), x) == FiniteSet(exp(a/2))
905.     a = Symbol('a', real=True)
906.     assert solveset_real(a/x + exp(x/2), x) == \
907.         FiniteSet(2*LambertW(-a/2))
908.     assert solveset_real((a/x + exp(x/2)).diff(x), x) == \
909.         FiniteSet(4*LambertW(sqrt(2)*sqrt(a)/4))
910. 
911.     # coverage test
912.     assert solveset_real(tanh(x + 3)*tanh(x - 3) - 1, x) == EmptySet()
913. 
914.     assert solveset_real((x**2 - 2*x + 1).subs(x, log(x) + 3*x), x) == \
915.         FiniteSet(LambertW(3*S.Exp1)/3)
916.     assert solveset_real((x**2 - 2*x + 1).subs(x, (log(x) + 3*x)**2 - 1), x) == \
917.         FiniteSet(LambertW(3*exp(-sqrt(2)))/3, LambertW(3*exp(sqrt(2)))/3)
918.     assert solveset_real((x**2 - 2*x - 2).subs(x, log(x) + 3*x), x) == \
919.         FiniteSet(LambertW(3*exp(1 + sqrt(3)))/3, LambertW(3*exp(-sqrt(3) + 1))/3)
920.     assert solveset_real(x*log(x) + 3*x + 1, x) == \
921.         FiniteSet(exp(-3 + LambertW(-exp(3))))
922.     eq = (x*exp(x) - 3).subs(x, x*exp(x))
923.     assert solveset_real(eq, x) == \
924.         FiniteSet(LambertW(3*exp(-LambertW(3))))
925. 
926.     assert solveset_real(3*log(a**(3*x + 5)) + a**(3*x + 5), x) == \
927.         FiniteSet(-((log(a**5) + LambertW(Rational(1, 3)))/(3*log(a))))
928.     p = symbols('p', positive=True)
929.     assert solveset_real(3*log(p**(3*x + 5)) + p**(3*x + 5), x) == \
930.         FiniteSet(
931.         log((-3**Rational(1, 3) - 3**Rational(5, 6)*I)*LambertW(Rational(1, 3))**Rational(1, 3)/(2*p**Rational(5, 3)))/log(p),
932.         log((-3**Rational(1, 3) + 3**Rational(5, 6)*I)*LambertW(Rational(1, 3))**Rational(1, 3)/(2*p**Rational(5, 3)))/log(p),
933.         log((3*LambertW(Rational(1, 3))/p**5)**(1/(3*log(p)))),)  # checked numerically
934.     # check collection
935.     b = Symbol('b')
936.     eq = 3*log(a**(3*x + 5)) + b*log(a**(3*x + 5)) + a**(3*x + 5)
937.     assert solveset_real(eq, x) == FiniteSet(
938.         -((log(a**5) + LambertW(1/(b + 3)))/(3*log(a))))
939. 
940.     # issue 4271
941.     assert solveset_real((a/x + exp(x/2)).diff(x, 2), x) == FiniteSet(
942.         6*LambertW((-1)**Rational(1, 3)*a**Rational(1, 3)/3))
943. 
944.     assert solveset_real(x**3 - 3**x, x) == \
945.         FiniteSet(-3/log(3)*LambertW(-log(3)/3))
946.     assert solveset_real(3**cos(x) - cos(x)**3) == FiniteSet(
947.         acos(-3*LambertW(-log(3)/3)/log(3)))
948. 
949.     assert solveset_real(x**2 - 2**x, x) == \
950.         solveset_real(-x**2 + 2**x, x)
951. 
952.     assert solveset_real(3*log(x) - x*log(3)) == FiniteSet(
953.         -3*LambertW(-log(3)/3)/log(3),
954.         -3*LambertW(-log(3)/3, -1)/log(3))
955. 
956.     assert solveset_real(LambertW(2*x) - y) == FiniteSet(
957.         y*exp(y)/2)
958. 
959. 
960. @XFAIL
961. def test_other_lambert():
962.     a = Rational(6, 5)
963.     assert solveset_real(x**a - a**x, x) == FiniteSet(
964.         a, -a*LambertW(-log(a)/a)/log(a))
965. 
966. 
967. def test_solveset():
968.     x = Symbol('x')
969.     f = Function('f')
970.     raises(ValueError, lambda: solveset(x + y))
971.     assert solveset(x, 1) == S.EmptySet
972.     assert solveset(f(1)**2 + y + 1, f(1)
973.         ) == FiniteSet(-sqrt(-y - 1), sqrt(-y - 1))
974.     assert solveset(f(1)**2 - 1, f(1), S.Reals) == FiniteSet(-1, 1)
975.     assert solveset(f(1)**2 + 1, f(1)) == FiniteSet(-I, I)
976.     assert solveset(x - 1, 1) == FiniteSet(x)
977.     assert solveset(sin(x) - cos(x), sin(x)) == FiniteSet(cos(x))
978. 
979.     assert solveset(0, domain=S.Reals) == S.Reals
980.     assert solveset(1) == S.EmptySet
981.     assert solveset(True, domain=S.Reals) == S.Reals  # issue 10197
982.     assert solveset(False, domain=S.Reals) == S.EmptySet
983. 
984.     assert solveset(exp(x) - 1, domain=S.Reals) == FiniteSet(0)
985.     assert solveset(exp(x) - 1, x, S.Reals) == FiniteSet(0)
986.     assert solveset(Eq(exp(x), 1), x, S.Reals) == FiniteSet(0)
987.     assert solveset(exp(x) - 1, exp(x), S.Reals) == FiniteSet(1)
988.     A = Indexed('A', x)
989.     assert solveset(A - 1, A, S.Reals) == FiniteSet(1)
990. 
991.     assert solveset(x - 1 >= 0, x, S.Reals) == Interval(1, oo)
992.     assert solveset(exp(x) - 1 >= 0, x, S.Reals) == Interval(0, oo)
993. 
994.     assert solveset(exp(x) - 1, x) == imageset(Lambda(n, 2*I*pi*n), S.Integers)
995.     assert solveset(Eq(exp(x), 1), x) == imageset(Lambda(n, 2*I*pi*n),
996.                                                   S.Integers)
997.     # issue 13825
998.     assert solveset(x**2 + f(0) + 1, x) == {-sqrt(-f(0) - 1), sqrt(-f(0) - 1)}
999. 
1000. 
1001. def test__solveset_multi():
1002.     from sympy.solvers.solveset import _solveset_multi
1003.     from sympy import Reals
1004. 
1005.     # Basic univariate case:
1006.     from sympy.abc import x
1007.     assert _solveset_multi([x**2-1], [x], [S.Reals]) == FiniteSet((1,), (-1,))
1008. 
1009.     # Linear systems of two equations
1010.     from sympy.abc import x, y
1011.     assert _solveset_multi([x+y, x+1], [x, y], [Reals, Reals]) == FiniteSet((-1, 1))
1012.     assert _solveset_multi([x+y, x+1], [y, x], [Reals, Reals]) == FiniteSet((1, -1))
1013.     assert _solveset_multi([x+y, x-y-1], [x, y], [Reals, Reals]) == FiniteSet((S(1)/2, -S(1)/2))
1014.     assert _solveset_multi([x-1, y-2], [x, y], [Reals, Reals]) == FiniteSet((1, 2))
1015.     #assert _solveset_multi([x+y], [x, y], [Reals, Reals]) == ImageSet(Lambda(x, (x, -x)), Reals)
1016.     assert _solveset_multi([x+y], [x, y], [Reals, Reals]) == Union(
1017.             ImageSet(Lambda(((x,),), (x, -x)), ProductSet(Reals)),
1018.             ImageSet(Lambda(((y,),), (-y, y)), ProductSet(Reals)))
1019.     assert _solveset_multi([x+y, x+y+1], [x, y], [Reals, Reals]) == S.EmptySet
1020.     assert _solveset_multi([x+y, x-y, x-1], [x, y], [Reals, Reals]) == S.EmptySet
1021.     assert _solveset_multi([x+y, x-y, x-1], [y, x], [Reals, Reals]) == S.EmptySet
1022. 
1023.     # Systems of three equations:
1024.     from sympy.abc import x, y, z
1025.     assert _solveset_multi([x+y+z-1, x+y-z-2, x-y-z-3], [x, y, z], [Reals,
1026.         Reals, Reals]) == FiniteSet((2, -S.Half, -S.Half))
1027. 
1028.     # Nonlinear systems:
1029.     from sympy.abc import r, theta, z, x, y
1030.     assert _solveset_multi([x**2+y**2-2, x+y], [x, y], [Reals, Reals]) == FiniteSet((-1, 1), (1, -1))
1031.     assert _solveset_multi([x**2-1, y], [x, y], [Reals, Reals]) == FiniteSet((1, 0), (-1, 0))
1032.     #assert _solveset_multi([x**2-y**2], [x, y], [Reals, Reals]) == Union(
1033.     #        ImageSet(Lambda(x, (x, -x)), Reals), ImageSet(Lambda(x, (x, x)), Reals))
1034.     assert _solveset_multi([x**2-y**2], [x, y], [Reals, Reals]) == Union(
1035.             ImageSet(Lambda(((x,),), (x, -Abs(x))), ProductSet(Reals)),
1036.             ImageSet(Lambda(((x,),), (x, Abs(x))), ProductSet(Reals)),
1037.             ImageSet(Lambda(((y,),), (-Abs(y), y)), ProductSet(Reals)),
1038.             ImageSet(Lambda(((y,),), (Abs(y), y)), ProductSet(Reals)))
1039.     assert _solveset_multi([r*cos(theta)-1, r*sin(theta)], [theta, r],
1040.             [Interval(0, pi), Interval(-1, 1)]) == FiniteSet((0, 1), (pi, -1))
1041.     assert _solveset_multi([r*cos(theta)-1, r*sin(theta)], [r, theta],
1042.             [Interval(0, 1), Interval(0, pi)]) == FiniteSet((1, 0))
1043.     #assert _solveset_multi([r*cos(theta)-r, r*sin(theta)], [r, theta],
1044.     #        [Interval(0, 1), Interval(0, pi)]) == ?
1045.     assert _solveset_multi([r*cos(theta)-r, r*sin(theta)], [r, theta],
1046.             [Interval(0, 1), Interval(0, pi)]) == Union(
1047.             ImageSet(Lambda(((r,),), (r, 0)), ImageSet(Lambda(r, (r,)), Interval(0, 1))),
1048.             ImageSet(Lambda(((theta,),), (0, theta)), ImageSet(Lambda(theta, (theta,)), Interval(0, pi))))
1049. 
1050. 
1051. def test_conditionset():
1052.     assert solveset(Eq(sin(x)**2 + cos(x)**2, 1), x, domain=S.Reals) == \
1053.         ConditionSet(x, True, S.Reals)
1054. 
1055.     assert solveset(Eq(x**2 + x*sin(x), 1), x, domain=S.Reals
1056.         ) == ConditionSet(x, Eq(x**2 + x*sin(x) - 1, 0), S.Reals)
1057. 
1058.     assert solveset(Eq(-I*(exp(I*x) - exp(-I*x))/2, 1), x
1059.         ) == imageset(Lambda(n, 2*n*pi + pi/2), S.Integers)
1060. 
1061.     assert solveset(x + sin(x) > 1, x, domain=S.Reals
1062.         ) == ConditionSet(x, x + sin(x) > 1, S.Reals)
1063. 
1064.     assert solveset(Eq(sin(Abs(x)), x), x, domain=S.Reals
1065.         ) == ConditionSet(x, Eq(-x + sin(Abs(x)), 0), S.Reals)
1066. 
1067.     assert solveset(y**x-z, x, S.Reals) == \
1068.         ConditionSet(x, Eq(y**x - z, 0), S.Reals)
1069. 
1070. 
1071. @XFAIL
1072. def test_conditionset_equality():
1073.     ''' Checking equality of different representations of ConditionSet'''
1074.     assert solveset(Eq(tan(x), y), x) == ConditionSet(x, Eq(tan(x), y), S.Complexes)
1075. 
1076. 
1077. def test_solveset_domain():
1078.     x = Symbol('x')
1079. 
1080.     assert solveset(x**2 - x - 6, x, Interval(0, oo)) == FiniteSet(3)
1081.     assert solveset(x**2 - 1, x, Interval(0, oo)) == FiniteSet(1)
1082.     assert solveset(x**4 - 16, x, Interval(0, 10)) == FiniteSet(2)
1083. 
1084. 
1085. def test_improve_coverage():
1086.     from sympy.solvers.solveset import _has_rational_power
1087.     x = Symbol('x')
1088.     solution = solveset(exp(x) + sin(x), x, S.Reals)
1089.     unsolved_object = ConditionSet(x, Eq(exp(x) + sin(x), 0), S.Reals)
1090.     assert solution == unsolved_object
1091. 
1092.     assert _has_rational_power(sin(x)*exp(x) + 1, x) == (False, S.One)
1093.     assert _has_rational_power((sin(x)**2)*(exp(x) + 1)**3, x) == (False, S.One)
1094. 
1095. 
1096. def test_issue_9522():
1097.     x = Symbol('x')
1098.     expr1 = Eq(1/(x**2 - 4) + x, 1/(x**2 - 4) + 2)
1099.     expr2 = Eq(1/x + x, 1/x)
1100. 
1101.     assert solveset(expr1, x, S.Reals) == EmptySet()
1102.     assert solveset(expr2, x, S.Reals) == EmptySet()
1103. 
1104. 
1105. def test_solvify():
1106.     x = Symbol('x')
1107. 
1108.     assert solvify(x**2 + 10, x, S.Reals) == []
1109.     assert solvify(x**3 + 1, x, S.Complexes) == [-1, S.Half - sqrt(3)*I/2,
1110.                                                  S.Half + sqrt(3)*I/2]
1111.     assert solvify(log(x), x, S.Reals) == [1]
1112.     assert solvify(cos(x), x, S.Reals) == [pi/2, pi*Rational(3, 2)]
1113.     assert solvify(sin(x) + 1, x, S.Reals) == [pi*Rational(3, 2)]
1114.     raises(NotImplementedError, lambda: solvify(sin(exp(x)), x, S.Complexes))
1115. 
1116. 
1117. def test_abs_invert_solvify():
1118.     assert solvify(sin(Abs(x)), x, S.Reals) is None
1119. 
1120. 
1121. def test_linear_eq_to_matrix():
1122.     x, y, z = symbols('x, y, z')
1123.     a, b, c, d, e, f, g, h, i, j, k, l = symbols('a:l')
1124. 
1125.     eqns1 = [2*x + y - 2*z - 3, x - y - z, x + y + 3*z - 12]
1126.     eqns2 = [Eq(3*x + 2*y - z, 1), Eq(2*x - 2*y + 4*z, -2), -2*x + y - 2*z]
1127. 
1128.     A, B = linear_eq_to_matrix(eqns1, x, y, z)
1129.     assert A == Matrix([[2, 1, -2], [1, -1, -1], [1, 1, 3]])
1130.     assert B == Matrix([[3], [0], [12]])
1131. 
1132.     A, B = linear_eq_to_matrix(eqns2, x, y, z)
1133.     assert A == Matrix([[3, 2, -1], [2, -2, 4], [-2, 1, -2]])
1134.     assert B == Matrix([[1], [-2], [0]])
1135. 
1136.     # Pure symbolic coefficients
1137.     eqns3 = [a*b*x + b*y + c*z - d, e*x + d*x + f*y + g*z - h, i*x + j*y + k*z - l]
1138.     A, B = linear_eq_to_matrix(eqns3, x, y, z)
1139.     assert A == Matrix([[a*b, b, c], [d + e, f, g], [i, j, k]])
1140.     assert B == Matrix([[d], [h], [l]])
1141. 
1142.     # raise ValueError if
1143.     # 1) no symbols are given
1144.     raises(ValueError, lambda: linear_eq_to_matrix(eqns3))
1145.     # 2) there are duplicates
1146.     raises(ValueError, lambda: linear_eq_to_matrix(eqns3, [x, x, y]))
1147.     # 3) there are non-symbols
1148.     raises(ValueError, lambda: linear_eq_to_matrix(eqns3, [x, 1/a, y]))
1149.     # 4) a nonlinear term is detected in the original expression
1150.     raises(ValueError, lambda: linear_eq_to_matrix(Eq(1/x + x, 1/x)))
1151. 
1152.     assert linear_eq_to_matrix(1, x) == (Matrix([[0]]), Matrix([[-1]]))
1153.     # issue 15195
1154.     assert linear_eq_to_matrix(x + y*(z*(3*x + 2) + 3), x) == (
1155.         Matrix([[3*y*z + 1]]), Matrix([[-y*(2*z + 3)]]))
1156.     assert linear_eq_to_matrix(Matrix(
1157.         [[a*x + b*y - 7], [5*x + 6*y - c]]), x, y) == (
1158.         Matrix([[a, b], [5, 6]]), Matrix([[7], [c]]))
1159. 
1160.     # issue 15312
1161.     assert linear_eq_to_matrix(Eq(x + 2, 1), x) == (
1162.         Matrix([[1]]), Matrix([[-1]]))
1163. 
1164. 
1165. def test_issue_16577():
1166.     assert linear_eq_to_matrix(Eq(a*(2*x + 3*y) + 4*y, 5), x, y) == (
1167.         Matrix([[2*a, 3*a + 4]]), Matrix([[5]]))
1168. 
1169. 
1170. def test_linsolve():
1171.     x, y, z, u, v, w = symbols("x, y, z, u, v, w")
1172.     x1, x2, x3, x4 = symbols('x1, x2, x3, x4')
1173. 
1174.     # Test for different input forms
1175. 
1176.     M = Matrix([[1, 2, 1, 1, 7], [1, 2, 2, -1, 12], [2, 4, 0, 6, 4]])
1177.     system1 = A, b = M[:, :-1], M[:, -1]
1178.     Eqns = [x1 + 2*x2 + x3 + x4 - 7, x1 + 2*x2 + 2*x3 - x4 - 12,
1179.             2*x1 + 4*x2 + 6*x4 - 4]
1180. 
1181.     sol = FiniteSet((-2*x2 - 3*x4 + 2, x2, 2*x4 + 5, x4))
1182.     assert linsolve(Eqns, (x1, x2, x3, x4)) == sol
1183.     assert linsolve(Eqns, *(x1, x2, x3, x4)) == sol
1184.     assert linsolve(system1, (x1, x2, x3, x4)) == sol
1185.     assert linsolve(system1, *(x1, x2, x3, x4)) == sol
1186.     # issue 9667 - symbols can be Dummy symbols
1187.     x1, x2, x3, x4 = symbols('x:4', cls=Dummy)
1188.     assert linsolve(system1, x1, x2, x3, x4) == FiniteSet(
1189.         (-2*x2 - 3*x4 + 2, x2, 2*x4 + 5, x4))
1190. 
1191.     # raise ValueError for garbage value
1192.     raises(ValueError, lambda: linsolve(Eqns))
1193.     raises(ValueError, lambda: linsolve(x1))
1194.     raises(ValueError, lambda: linsolve(x1, x2))
1195.     raises(ValueError, lambda: linsolve((A,), x1, x2))
1196.     raises(ValueError, lambda: linsolve(A, b, x1, x2))
1197. 
1198.     #raise ValueError if equations are non-linear in given variables
1199.     raises(ValueError, lambda: linsolve([x + y - 1, x ** 2 + y - 3], [x, y]))
1200.     raises(ValueError, lambda: linsolve([cos(x) + y, x + y], [x, y]))
1201.     assert linsolve([x + z - 1, x ** 2 + y - 3], [z, y]) == {(-x + 1, -x**2 + 3)}
1202. 
1203.     # Fully symbolic test
1204.     a, b, c, d, e, f = symbols('a, b, c, d, e, f')
1205.     A = Matrix([[a, b], [c, d]])
1206.     B = Matrix([[e], [f]])
1207.     system2 = (A, B)
1208.     sol = FiniteSet(((-b*f + d*e)/(a*d - b*c), (a*f - c*e)/(a*d - b*c)))
1209.     assert linsolve(system2, [x, y]) == sol
1210. 
1211.     # No solution
1212.     A = Matrix([[1, 2, 3], [2, 4, 6], [3, 6, 9]])
1213.     b = Matrix([0, 0, 1])
1214.     assert linsolve((A, b), (x, y, z)) == EmptySet()
1215. 
1216.     # Issue #10056
1217.     A, B, J1, J2 = symbols('A B J1 J2')
1218.     Augmatrix = Matrix([
1219.         [2*I*J1, 2*I*J2, -2/J1],
1220.         [-2*I*J2, -2*I*J1, 2/J2],
1221.         [0, 2, 2*I/(J1*J2)],
1222.         [2, 0,  0],
1223.         ])
1224. 
1225.     assert linsolve(Augmatrix, A, B) == FiniteSet((0, I/(J1*J2)))
1226. 
1227.     # Issue #10121 - Assignment of free variables
1228.     a, b, c, d, e = symbols('a, b, c, d, e')
1229.     Augmatrix = Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, 0]])
1230.     assert linsolve(Augmatrix, a, b, c, d, e) == FiniteSet((a, 0, c, 0, e))
1231.     raises(IndexError, lambda: linsolve(Augmatrix, a, b, c))
1232. 
1233.     x0, x1, x2, _x0 = symbols('tau0 tau1 tau2 _tau0')
1234.     assert linsolve(Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, _x0]])
1235.         ) == FiniteSet((x0, 0, x1, _x0, x2))
1236.     x0, x1, x2, _x0 = symbols('_tau0 _tau1 _tau2 tau0')
1237.     assert linsolve(Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, _x0]])
1238.         ) == FiniteSet((x0, 0, x1, _x0, x2))
1239.     x0, x1, x2, _x0 = symbols('_tau0 _tau1 _tau2 tau1')
1240.     assert linsolve(Matrix([[0, 1, 0, 0, 0, 0], [0, 0, 0, 1, 0, _x0]])
1241.         ) == FiniteSet((x0, 0, x1, _x0, x2))
1242.     # symbols can be given as generators
1243.     x0, x2, x4 = symbols('x0, x2, x4')
1244.     assert linsolve(Augmatrix, numbered_symbols('x')
1245.         ) == FiniteSet((x0, 0, x2, 0, x4))
1246.     Augmatrix[-1, -1] = x0
1247.     # use Dummy to avoid clash; the names may clash but the symbols
1248.     # will not
1249.     Augmatrix[-1, -1] = symbols('_x0')
1250.     assert len(linsolve(
1251.         Augmatrix, numbered_symbols('x', cls=Dummy)).free_symbols) == 4
1252. 
1253.     # Issue #12604
1254.     f = Function('f')
1255.     assert linsolve([f(x) - 5], f(x)) == FiniteSet((5,))
1256. 
1257.     # Issue #14860
1258.     from sympy.physics.units import meter, newton, kilo
1259.     Eqns = [8*kilo*newton + x + y, 28*kilo*newton*meter + 3*x*meter]
1260.     assert linsolve(Eqns, x, y) == {(newton*Rational(-28000, 3), newton*Rational(4000, 3))}
1261. 
1262.     # linsolve fully expands expressions, so removable singularities
1263.     # and other nonlinearity does not raise an error
1264.     assert linsolve([Eq(x, x + y)], [x, y]) == {(x, 0)}
1265.     assert linsolve([Eq(1/x, 1/x + y)], [x, y]) == {(x, 0)}
1266.     assert linsolve([Eq(y/x, y/x + y)], [x, y]) == {(x, 0)}
1267.     assert linsolve([Eq(x*(x + 1), x**2 + y)], [x, y]) == {(y, y)}
1268. 
1269. 
1270. def test_linsolve_immutable():
1271.     A = ImmutableDenseMatrix([[1, 1, 2], [0, 1, 2], [0, 0, 1]])
1272.     B = ImmutableDenseMatrix([2, 1, -1])
1273.     c = symbols('c1 c2 c3')
1274.     assert linsolve([A, B], c) == FiniteSet((1, 3, -1))
1275. 
1276.     A = ImmutableDenseMatrix([[1, 1, 7], [1, -1, 3]])
1277.     assert linsolve(A) == FiniteSet((5, 2))
1278. 
1279. 
1280. def test_solve_decomposition():
1281.     x = Symbol('x')
1282.     n = Dummy('n')
1283. 
1284.     f1 = exp(3*x) - 6*exp(2*x) + 11*exp(x) - 6
1285.     f2 = sin(x)**2 - 2*sin(x) + 1
1286.     f3 = sin(x)**2 - sin(x)
1287.     f4 = sin(x + 1)
1288.     f5 = exp(x + 2) - 1
1289.     f6 = 1/log(x)
1290.     f7 = 1/x
1291. 
1292.     s1 = ImageSet(Lambda(n, 2*n*pi), S.Integers)
1293.     s2 = ImageSet(Lambda(n, 2*n*pi + pi), S.Integers)
1294.     s3 = ImageSet(Lambda(n, 2*n*pi + pi/2), S.Integers)
1295.     s4 = ImageSet(Lambda(n, 2*n*pi - 1), S.Integers)
1296.     s5 = ImageSet(Lambda(n, 2*n*pi - 1 + pi), S.Integers)
1297. 
1298.     assert solve_decomposition(f1, x, S.Reals) == FiniteSet(0, log(2), log(3))
1299.     assert solve_decomposition(f2, x, S.Reals) == s3
1300.     assert solve_decomposition(f3, x, S.Reals) == Union(s1, s2, s3)
1301.     assert solve_decomposition(f4, x, S.Reals) == Union(s4, s5)
1302.     assert solve_decomposition(f5, x, S.Reals) == FiniteSet(-2)
1303.     assert solve_decomposition(f6, x, S.Reals) == S.EmptySet
1304.     assert solve_decomposition(f7, x, S.Reals) == S.EmptySet
1305.     assert solve_decomposition(x, x, Interval(1, 2)) == S.EmptySet
1306. 
1307. # nonlinsolve testcases
1308. def test_nonlinsolve_basic():
1309.     assert nonlinsolve([],[]) == S.EmptySet
1310.     assert nonlinsolve([],[x, y]) == S.EmptySet
1311. 
1312.     system = [x, y - x - 5]
1313.     assert nonlinsolve([x],[x, y]) == FiniteSet((0, y))
1314.     assert nonlinsolve(system, [y]) == FiniteSet((x + 5,))
1315.     soln = (ImageSet(Lambda(n, 2*n*pi + pi/2), S.Integers),)
1316.     assert nonlinsolve([sin(x) - 1], [x]) == FiniteSet(tuple(soln))
1317.     assert nonlinsolve([x**2 - 1], [x]) == FiniteSet((-1,), (1,))
1318. 
1319.     soln = FiniteSet((y, y))
1320.     assert nonlinsolve([x - y, 0], x, y) == soln
1321.     assert nonlinsolve([0, x - y], x, y) == soln
1322.     assert nonlinsolve([x - y, x - y], x, y) == soln
1323.     assert nonlinsolve([x, 0], x, y) == FiniteSet((0, y))
1324.     f = Function('f')
1325.     assert nonlinsolve([f(x), 0], f(x), y) == FiniteSet((0, y))
1326.     assert nonlinsolve([f(x), 0], f(x), f(y)) == FiniteSet((0, f(y)))
1327.     A = Indexed('A', x)
1328.     assert nonlinsolve([A, 0], A, y) == FiniteSet((0, y))
1329.     assert nonlinsolve([x**2 -1], [sin(x)]) == FiniteSet((S.EmptySet,))
1330.     assert nonlinsolve([x**2 -1], sin(x)) == FiniteSet((S.EmptySet,))
1331.     assert nonlinsolve([x**2 -1], 1) == FiniteSet((x**2,))
1332.     assert nonlinsolve([x**2 -1], x + y) == FiniteSet((S.EmptySet,))
1333. 
1334. 
1335. def test_nonlinsolve_abs():
1336.     soln = FiniteSet((x, Abs(x)))
1337.     assert nonlinsolve([Abs(x) - y], x, y) == soln
1338. 
1339. 
1340. def test_raise_exception_nonlinsolve():
1341.     raises(IndexError, lambda: nonlinsolve([x**2 -1], []))
1342.     raises(ValueError, lambda: nonlinsolve([x**2 -1]))
1343.     raises(NotImplementedError, lambda: nonlinsolve([(x+y)**2 - 9, x**2 - y**2 - 0.75], (x, y)))
1344. 
1345. 
1346. def test_trig_system():
1347.     # TODO: add more simple testcases when solveset returns
1348.     # simplified soln for Trig eq
1349.     assert nonlinsolve([sin(x) - 1, cos(x) -1 ], x) == S.EmptySet
1350.     soln1 = (ImageSet(Lambda(n, 2*n*pi + pi/2), S.Integers),)
1351.     soln = FiniteSet(soln1)
1352.     assert nonlinsolve([sin(x) - 1, cos(x)], x) == soln
1353. 
1354. 
1355. @XFAIL
1356. def test_trig_system_fail():
1357.     # fails because solveset trig solver is not much smart.
1358.     sys = [x + y - pi/2, sin(x) + sin(y) - 1]
1359.     # solveset returns conditionset for sin(x) + sin(y) - 1
1360.     soln_1 = (ImageSet(Lambda(n, n*pi + pi/2), S.Integers),
1361.         ImageSet(Lambda(n, n*pi)), S.Integers)
1362.     soln_1 = FiniteSet(soln_1)
1363.     soln_2 = (ImageSet(Lambda(n, n*pi), S.Integers),
1364.         ImageSet(Lambda(n, n*pi+ pi/2), S.Integers))
1365.     soln_2 = FiniteSet(soln_2)
1366.     soln = soln_1 + soln_2
1367.     assert nonlinsolve(sys, [x, y]) == soln
1368. 
1369.     # Add more cases from here
1370.     # http://www.vitutor.com/geometry/trigonometry/equations_systems.html#uno
1371.     sys = [sin(x) + sin(y) - (sqrt(3)+1)/2, sin(x) - sin(y) - (sqrt(3) - 1)/2]
1372.     soln_x = Union(ImageSet(Lambda(n, 2*n*pi + pi/3), S.Integers),
1373.         ImageSet(Lambda(n, 2*n*pi + pi*Rational(2, 3)), S.Integers))
1374.     soln_y = Union(ImageSet(Lambda(n, 2*n*pi + pi/6), S.Integers),
1375.         ImageSet(Lambda(n, 2*n*pi + pi*Rational(5, 6)), S.Integers))
1376.     assert nonlinsolve(sys, [x, y]) ==FiniteSet((soln_x, soln_y))
1377. 
1378. 
1379. def test_nonlinsolve_positive_dimensional():
1380.     x, y, z, a, b, c, d = symbols('x, y, z, a, b, c, d', extended_real = True)
1381.     assert nonlinsolve([x*y, x*y - x], [x, y]) == FiniteSet((0, y))
1382. 
1383.     system = [a**2 + a*c, a - b]
1384.     assert nonlinsolve(system, [a, b]) == FiniteSet((0, 0), (-c, -c))
1385.     # here (a= 0, b = 0) is independent soln so both is printed.
1386.     # if symbols = [a, b, c] then only {a : -c ,b : -c}
1387. 
1388.     eq1 =  a + b + c + d
1389.     eq2 = a*b + b*c + c*d + d*a
1390.     eq3 = a*b*c + b*c*d + c*d*a + d*a*b
1391.     eq4 = a*b*c*d - 1
1392.     system = [eq1, eq2, eq3, eq4]
1393.     sol1 = (-1/d, -d, 1/d, FiniteSet(d) - FiniteSet(0))
1394.     sol2 = (1/d, -d, -1/d, FiniteSet(d) - FiniteSet(0))
1395.     soln = FiniteSet(sol1, sol2)
1396.     assert nonlinsolve(system, [a, b, c, d]) == soln
1397. 
1398. 
1399. def test_nonlinsolve_polysys():
1400.     x, y, z = symbols('x, y, z', real = True)
1401.     assert nonlinsolve([x**2 + y - 2, x**2 + y], [x, y]) == S.EmptySet
1402. 
1403.     s = (-y + 2, y)
1404.     assert nonlinsolve([(x + y)**2 - 4, x + y - 2], [x, y]) == FiniteSet(s)
1405. 
1406.     system = [x**2 - y**2]
1407.     soln_real = FiniteSet((-y, y), (y, y))
1408.     soln_complex = FiniteSet((-Abs(y), y), (Abs(y), y))
1409.     soln =soln_real + soln_complex
1410.     assert nonlinsolve(system, [x, y]) == soln
1411. 
1412.     system = [x**2 - y**2]
1413.     soln_real= FiniteSet((y, -y), (y, y))
1414.     soln_complex = FiniteSet((y, -Abs(y)), (y, Abs(y)))
1415.     soln = soln_real + soln_complex
1416.     assert nonlinsolve(system, [y, x]) == soln
1417. 
1418.     system = [x**2 + y - 3, x - y - 4]
1419.     assert nonlinsolve(system, (x, y)) != nonlinsolve(system, (y, x))
1420. 
1421. 
1422. def test_nonlinsolve_using_substitution():
1423.     x, y, z, n = symbols('x, y, z, n', real = True)
1424.     system = [(x + y)*n - y**2 + 2]
1425.     s_x = (n*y - y**2 + 2)/n
1426.     soln = (-s_x, y)
1427.     assert nonlinsolve(system, [x, y]) == FiniteSet(soln)
1428. 
1429.     system = [z**2*x**2 - z**2*y**2/exp(x)]
1430.     soln_real_1 = (y, x, 0)
1431.     soln_real_2 = (-exp(x/2)*Abs(x), x, z)
1432.     soln_real_3 = (exp(x/2)*Abs(x), x, z)
1433.     soln_complex_1 = (-x*exp(x/2), x, z)
1434.     soln_complex_2 = (x*exp(x/2), x, z)
1435.     syms = [y, x, z]
1436.     soln = FiniteSet(soln_real_1, soln_complex_1, soln_complex_2,\
1437.         soln_real_2, soln_real_3)
1438.     assert nonlinsolve(system,syms) == soln
1439. 
1440. 
1441. def test_nonlinsolve_complex():
1442.     x, y, z = symbols('x, y, z')
1443.     n = Dummy('n')
1444.     assert nonlinsolve([exp(x) - sin(y), 1/y - 3], [x, y]) == {
1445.         (ImageSet(Lambda(n, 2*n*I*pi + log(sin(Rational(1, 3)))), S.Integers), Rational(1, 3))}
1446. 
1447.     system = [exp(x) - sin(y), 1/exp(y) - 3]
1448.     assert nonlinsolve(system, [x, y]) == {
1449.         (ImageSet(Lambda(n, I*(2*n*pi + pi)
1450.                          + log(sin(log(3)))), S.Integers), -log(3)),
1451.         (ImageSet(Lambda(n, I*(2*n*pi + arg(sin(2*n*I*pi - log(3))))
1452.                          + log(Abs(sin(2*n*I*pi - log(3))))), S.Integers),
1453.         ImageSet(Lambda(n, 2*n*I*pi - log(3)), S.Integers))}
1454. 
1455.     system = [exp(x) - sin(y), y**2 - 4]
1456.     assert nonlinsolve(system, [x, y]) == {
1457.         (ImageSet(Lambda(n, I*(2*n*pi + pi) + log(sin(2))), S.Integers), -2),
1458.         (ImageSet(Lambda(n, 2*n*I*pi + log(sin(2))), S.Integers), 2)}
1459. 
1460. 
1461. @XFAIL
1462. def test_solve_nonlinear_trans():
1463.     # After the transcendental equation solver these will work
1464.     x, y, z = symbols('x, y, z', real=True)
1465.     soln1 = FiniteSet((2*LambertW(y/2), y))
1466.     soln2 = FiniteSet((-x*sqrt(exp(x)), y), (x*sqrt(exp(x)), y))
1467.     soln3 = FiniteSet((x*exp(x/2), x))
1468.     soln4 = FiniteSet(2*LambertW(y/2), y)
1469.     assert nonlinsolve([x**2 - y**2/exp(x)], [x, y]) == soln1
1470.     assert nonlinsolve([x**2 - y**2/exp(x)], [y, x]) == soln2
1471.     assert nonlinsolve([x**2 - y**2/exp(x)], [y, x]) == soln3
1472.     assert nonlinsolve([x**2 - y**2/exp(x)], [x, y]) == soln4
1473. 
1474. 
1475. def test_issue_5132_1():
1476.     system = [sqrt(x**2 + y**2) - sqrt(10), x + y - 4]
1477.     assert nonlinsolve(system, [x, y]) == FiniteSet((1, 3), (3, 1))
1478. 
1479.     n = Dummy('n')
1480.     eqs = [exp(x)**2 - sin(y) + z**2, 1/exp(y) - 3]
1481.     s_real_y = -log(3)
1482.     s_real_z = sqrt(-exp(2*x) - sin(log(3)))
1483.     soln_real = FiniteSet((s_real_y, s_real_z), (s_real_y, -s_real_z))
1484.     lam = Lambda(n, 2*n*I*pi + -log(3))
1485.     s_complex_y = ImageSet(lam, S.Integers)
1486.     lam = Lambda(n, sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1487.     s_complex_z_1 = ImageSet(lam, S.Integers)
1488.     lam = Lambda(n, -sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1489.     s_complex_z_2 = ImageSet(lam, S.Integers)
1490.     soln_complex = FiniteSet(
1491.                                             (s_complex_y, s_complex_z_1),
1492.                                             (s_complex_y, s_complex_z_2)
1493.                                         )
1494.     soln = soln_real + soln_complex
1495.     assert nonlinsolve(eqs, [y, z]) == soln
1496. 
1497. 
1498. def test_issue_5132_2():
1499.     x, y = symbols('x, y', real=True)
1500.     eqs = [exp(x)**2 - sin(y) + z**2, 1/exp(y) - 3]
1501.     n = Dummy('n')
1502.     soln_real = (log(-z**2 + sin(y))/2, z)
1503.     lam = Lambda( n, I*(2*n*pi + arg(-z**2 + sin(y)))/2 + log(Abs(z**2 - sin(y)))/2)
1504.     img = ImageSet(lam, S.Integers)
1505.     # not sure about the complex soln. But it looks correct.
1506.     soln_complex = (img, z)
1507.     soln = FiniteSet(soln_real, soln_complex)
1508.     assert nonlinsolve(eqs, [x, z]) == soln
1509. 
1510.     r, t = symbols('r, t')
1511.     system = [r - x**2 - y**2, tan(t) - y/x]
1512.     s_x = sqrt(r/(tan(t)**2 + 1))
1513.     s_y = sqrt(r/(tan(t)**2 + 1))*tan(t)
1514.     soln = FiniteSet((s_x, s_y), (-s_x, -s_y))
1515.     assert nonlinsolve(system, [x, y]) == soln
1516. 
1517. 
1518. def test_issue_6752():
1519.     a,b,c,d = symbols('a, b, c, d', real=True)
1520.     assert nonlinsolve([a**2 + a, a - b], [a, b]) == {(-1, -1), (0, 0)}
1521. 
1522. 
1523. @SKIP("slow")
1524. def test_issue_5114_solveset():
1525.     # slow testcase
1526.     a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r = symbols('a:r')
1527. 
1528.     # there is no 'a' in the equation set but this is how the
1529.     # problem was originally posed
1530.     syms = [a, b, c, f, h, k, n]
1531.     eqs = [b + r/d - c/d,
1532.     c*(1/d + 1/e + 1/g) - f/g - r/d,
1533.         f*(1/g + 1/i + 1/j) - c/g - h/i,
1534.         h*(1/i + 1/l + 1/m) - f/i - k/m,
1535.         k*(1/m + 1/o + 1/p) - h/m - n/p,
1536.         n*(1/p + 1/q) - k/p]
1537.     assert len(nonlinsolve(eqs, syms)) == 1
1538. 
1539. 
1540. @SKIP("Hangs")
1541. def _test_issue_5335():
1542.     # Not able to check zero dimensional system.
1543.     # is_zero_dimensional Hangs
1544.     lam, a0, conc = symbols('lam a0 conc')
1545.     eqs = [lam + 2*y - a0*(1 - x/2)*x - 0.005*x/2*x,
1546.            a0*(1 - x/2)*x - 1*y - 0.743436700916726*y,
1547.            x + y - conc]
1548.     sym = [x, y, a0]
1549.     # there are 4 solutions but only two are valid
1550.     assert len(nonlinsolve(eqs, sym)) == 2
1551.     # float
1552.     lam, a0, conc = symbols('lam a0 conc')
1553.     eqs = [lam + 2*y - a0*(1 - x/2)*x - 0.005*x/2*x,
1554.            a0*(1 - x/2)*x - 1*y - 0.743436700916726*y,
1555.            x + y - conc]
1556.     sym = [x, y, a0]
1557.     assert len(nonlinsolve(eqs, sym)) == 2
1558. 
1559. 
1560. def test_issue_2777():
1561.     # the equations represent two circles
1562.     x, y = symbols('x y', real=True)
1563.     e1, e2 = sqrt(x**2 + y**2) - 10, sqrt(y**2 + (-x + 10)**2) - 3
1564.     a, b = Rational(191, 20), 3*sqrt(391)/20
1565.     ans = {(a, -b), (a, b)}
1566.     assert nonlinsolve((e1, e2), (x, y)) == ans
1567.     assert nonlinsolve((e1, e2/(x - a)), (x, y)) == S.EmptySet
1568.     # make the 2nd circle's radius be -3
1569.     e2 += 6
1570.     assert nonlinsolve((e1, e2), (x, y)) == S.EmptySet
1571. 
1572. 
1573. def test_issue_8828():
1574.     x1 = 0
1575.     y1 = -620
1576.     r1 = 920
1577.     x2 = 126
1578.     y2 = 276
1579.     x3 = 51
1580.     y3 = 205
1581.     r3 = 104
1582.     v = [x, y, z]
1583. 
1584.     f1 = (x - x1)**2 + (y - y1)**2 - (r1 - z)**2
1585.     f2 = (x2 - x)**2 + (y2 - y)**2 - z**2
1586.     f3 = (x - x3)**2 + (y - y3)**2 - (r3 - z)**2
1587.     F = [f1, f2, f3]
1588. 
1589.     g1 = sqrt((x - x1)**2 + (y - y1)**2) + z - r1
1590.     g2 = f2
1591.     g3 = sqrt((x - x3)**2 + (y - y3)**2) + z - r3
1592.     G = [g1, g2, g3]
1593. 
1594.     # both soln same
1595.     A = nonlinsolve(F, v)
1596.     B = nonlinsolve(G, v)
1597.     assert A == B
1598. 
1599. 
1600. def test_nonlinsolve_conditionset():
1601.     # when solveset failed to solve all the eq
1602.     # return conditionset
1603.     f = Function('f')
1604.     f1 = f(x) - pi/2
1605.     f2 = f(y) - pi*Rational(3, 2)
1606.     intermediate_system = Eq(2*f(x) - pi, 0) & Eq(2*f(y) - 3*pi, 0)
1607.     symbols = Tuple(x, y)
1608.     soln = ConditionSet(
1609.         symbols,
1610.         intermediate_system,
1611.         S.Complexes**2)
1612.     assert nonlinsolve([f1, f2], [x, y]) == soln
1613. 
1614. 
1615. def test_substitution_basic():
1616.     assert substitution([], [x, y]) == S.EmptySet
1617.     assert substitution([], []) == S.EmptySet
1618.     system = [2*x**2 + 3*y**2 - 30, 3*x**2 - 2*y**2 - 19]
1619.     soln = FiniteSet((-3, -2), (-3, 2), (3, -2), (3, 2))
1620.     assert substitution(system, [x, y]) == soln
1621. 
1622.     soln = FiniteSet((-1, 1))
1623.     assert substitution([x + y], [x], [{y: 1}], [y], set([]), [x, y]) == soln
1624.     assert substitution(
1625.         [x + y], [x], [{y: 1}], [y],
1626.         set([x + 1]), [y, x]) == S.EmptySet
1627. 
1628. 
1629. def test_issue_5132_substitution():
1630.     x, y, z, r, t = symbols('x, y, z, r, t', real=True)
1631.     system = [r - x**2 - y**2, tan(t) - y/x]
1632.     s_x_1 = Complement(FiniteSet(-sqrt(r/(tan(t)**2 + 1))), FiniteSet(0))
1633.     s_x_2 = Complement(FiniteSet(sqrt(r/(tan(t)**2 + 1))), FiniteSet(0))
1634.     s_y = sqrt(r/(tan(t)**2 + 1))*tan(t)
1635.     soln = FiniteSet((s_x_2, s_y)) + FiniteSet((s_x_1, -s_y))
1636.     assert substitution(system, [x, y]) == soln
1637. 
1638.     n = Dummy('n')
1639.     eqs = [exp(x)**2 - sin(y) + z**2, 1/exp(y) - 3]
1640.     s_real_y = -log(3)
1641.     s_real_z = sqrt(-exp(2*x) - sin(log(3)))
1642.     soln_real = FiniteSet((s_real_y, s_real_z), (s_real_y, -s_real_z))
1643.     lam = Lambda(n, 2*n*I*pi + -log(3))
1644.     s_complex_y = ImageSet(lam, S.Integers)
1645.     lam = Lambda(n, sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1646.     s_complex_z_1 = ImageSet(lam, S.Integers)
1647.     lam = Lambda(n, -sqrt(-exp(2*x) + sin(2*n*I*pi + -log(3))))
1648.     s_complex_z_2 = ImageSet(lam, S.Integers)
1649.     soln_complex = FiniteSet(
1650.         (s_complex_y, s_complex_z_1),
1651.         (s_complex_y, s_complex_z_2))
1652.     soln = soln_real + soln_complex
1653.     assert substitution(eqs, [y, z]) == soln
1654. 
1655. 
1656. def test_raises_substitution():
1657.     raises(ValueError, lambda: substitution([x**2 -1], []))
1658.     raises(TypeError, lambda: substitution([x**2 -1]))
1659.     raises(ValueError, lambda: substitution([x**2 -1], [sin(x)]))
1660.     raises(TypeError, lambda: substitution([x**2 -1], x))
1661.     raises(TypeError, lambda: substitution([x**2 -1], 1))
1662. 
1663. # end of tests for nonlinsolve
1664. 
1665. 
1666. def test_issue_9556():
1667.     x = Symbol('x')
1668.     b = Symbol('b', positive=True)
1669. 
1670.     assert solveset(Abs(x) + 1, x, S.Reals) == EmptySet()
1671.     assert solveset(Abs(x) + b, x, S.Reals) == EmptySet()
1672.     assert solveset(Eq(b, -1), b, S.Reals) == EmptySet()
1673. 
1674. 
1675. def test_issue_9611():
1676.     x = Symbol('x')
1677.     a = Symbol('a')
1678.     y = Symbol('y')
1679. 
1680.     assert solveset(Eq(x - x + a, a), x, S.Reals) == S.Reals
1681.     assert solveset(Eq(y - y + a, a), y) == S.Complexes
1682. 
1683. 
1684. def test_issue_9557():
1685.     x = Symbol('x')
1686.     a = Symbol('a')
1687. 
1688.     assert solveset(x**2 + a, x, S.Reals) == Intersection(S.Reals,
1689.         FiniteSet(-sqrt(-a), sqrt(-a)))
1690. 
1691. 
1692. def test_issue_9778():
1693.     assert solveset(x**3 + 1, x, S.Reals) == FiniteSet(-1)
1694.     assert solveset(x**Rational(3, 5) + 1, x, S.Reals) == S.EmptySet
1695.     assert solveset(x**3 + y, x, S.Reals) == \
1696.         FiniteSet(-Abs(y)**Rational(1, 3)*sign(y))
1697. 
1698. 
1699. def test_issue_10214():
1700.     assert solveset(x**Rational(3, 2) + 4, x, S.Reals) == S.EmptySet
1701.     assert solveset(x**(Rational(-3, 2)) + 4, x, S.Reals) == S.EmptySet
1702. 
1703.     ans = FiniteSet(-2**Rational(2, 3))
1704.     assert solveset(x**(S(3)) + 4, x, S.Reals) == ans
1705.     assert (x**(S(3)) + 4).subs(x,list(ans)[0]) == 0 # substituting ans and verifying the result.
1706.     assert (x**(S(3)) + 4).subs(x,-(-2)**Rational(2, 3)) == 0
1707. 
1708. 
1709. def test_issue_9849():
1710.     assert solveset(Abs(sin(x)) + 1, x, S.Reals) == S.EmptySet
1711. 
1712. 
1713. def test_issue_9953():
1714.     assert linsolve([ ], x) == S.EmptySet
1715. 
1716. 
1717. def test_issue_9913():
1718.     assert solveset(2*x + 1/(x - 10)**2, x, S.Reals) == \
1719.         FiniteSet(-(3*sqrt(24081)/4 + Rational(4027, 4))**Rational(1, 3)/3 - 100/
1720.                 (3*(3*sqrt(24081)/4 + Rational(4027, 4))**Rational(1, 3)) + Rational(20, 3))
1721. 
1722. 
1723. def test_issue_10397():
1724.     assert solveset(sqrt(x), x, S.Complexes) == FiniteSet(0)
1725. 
1726. 
1727. def test_issue_14987():
1728.     raises(ValueError, lambda: linear_eq_to_matrix(
1729.         [x**2], x))
1730.     raises(ValueError, lambda: linear_eq_to_matrix(
1731.         [x*(-3/x + 1) + 2*y - a], [x, y]))
1732.     raises(ValueError, lambda: linear_eq_to_matrix(
1733.         [(x**2 - 3*x)/(x - 3) - 3], x))
1734.     raises(ValueError, lambda: linear_eq_to_matrix(
1735.         [(x + 1)**3 - x**3 - 3*x**2 + 7], x))
1736.     raises(ValueError, lambda: linear_eq_to_matrix(
1737.         [x*(1/x + 1) + y], [x, y]))
1738.     raises(ValueError, lambda: linear_eq_to_matrix(
1739.         [(x + 1)*y], [x, y]))
1740.     raises(ValueError, lambda: linear_eq_to_matrix(
1741.         [Eq(1/x, 1/x + y)], [x, y]))
1742.     raises(ValueError, lambda: linear_eq_to_matrix(
1743.         [Eq(y/x, y/x + y)], [x, y]))
1744.     raises(ValueError, lambda: linear_eq_to_matrix(
1745.         [Eq(x*(x + 1), x**2 + y)], [x, y]))
1746. 
1747. 
1748. def test_simplification():
1749.     eq = x + (a - b)/(-2*a + 2*b)
1750.     assert solveset(eq, x) == FiniteSet(S.Half)
1751.     assert solveset(eq, x, S.Reals) == Intersection({-((a - b)/(-2*a + 2*b))}, S.Reals)
1752.     # So that ap - bn is not zero:
1753.     ap = Symbol('ap', positive=True)
1754.     bn = Symbol('bn', negative=True)
1755.     eq = x + (ap - bn)/(-2*ap + 2*bn)
1756.     assert solveset(eq, x) == FiniteSet(S.Half)
1757.     assert solveset(eq, x, S.Reals) == FiniteSet(S.Half)
1758. 
1759. 
1760. def test_issue_10555():
1761.     f = Function('f')
1762.     g = Function('g')
1763.     assert solveset(f(x) - pi/2, x, S.Reals) == \
1764.         ConditionSet(x, Eq(f(x) - pi/2, 0), S.Reals)
1765.     assert solveset(f(g(x)) - pi/2, g(x), S.Reals) == \
1766.         ConditionSet(g(x), Eq(f(g(x)) - pi/2, 0), S.Reals)
1767. 
1768. 
1769. def test_issue_8715():
1770.     eq = x + 1/x > -2 + 1/x
1771.     assert solveset(eq, x, S.Reals) == \
1772.         (Interval.open(-2, oo) - FiniteSet(0))
1773.     assert solveset(eq.subs(x,log(x)), x, S.Reals) == \
1774.         Interval.open(exp(-2), oo) - FiniteSet(1)
1775. 
1776. 
1777. def test_issue_11174():
1778.     r, t = symbols('r t')
1779.     eq = z**2 + exp(2*x) - sin(y)
1780.     soln = Intersection(S.Reals, FiniteSet(log(-z**2 + sin(y))/2))
1781.     assert solveset(eq, x, S.Reals) == soln
1782. 
1783.     eq = sqrt(r)*Abs(tan(t))/sqrt(tan(t)**2 + 1) + x*tan(t)
1784.     s = -sqrt(r)*Abs(tan(t))/(sqrt(tan(t)**2 + 1)*tan(t))
1785.     soln = Intersection(S.Reals, FiniteSet(s))
1786.     assert solveset(eq, x, S.Reals) == soln
1787. 
1788. 
1789. def test_issue_11534():
1790.     # eq and eq2 should give the same solution as a Complement
1791.     eq = -y + x/sqrt(-x**2 + 1)
1792.     eq2 = -y**2 + x**2/(-x**2 + 1)
1793.     soln = Complement(FiniteSet(-y/sqrt(y**2 + 1), y/sqrt(y**2 + 1)), FiniteSet(-1, 1))
1794.     assert solveset(eq, x, S.Reals) == soln
1795.     assert solveset(eq2, x, S.Reals) == soln
1796. 
1797. 
1798. def test_issue_10477():
1799.     assert solveset((x**2 + 4*x - 3)/x < 2, x, S.Reals) == \
1800.         Union(Interval.open(-oo, -3), Interval.open(0, 1))
1801. 
1802. 
1803. def test_issue_10671():
1804.     assert solveset(sin(y), y, Interval(0, pi)) == FiniteSet(0, pi)
1805.     i = Interval(1, 10)
1806.     assert solveset((1/x).diff(x) < 0, x, i) == i
1807. 
1808. 
1809. def test_issue_11064():
1810.     eq = x + sqrt(x**2 - 5)
1811.     assert solveset(eq > 0, x, S.Reals) == \
1812.         Interval(sqrt(5), oo)
1813.     assert solveset(eq < 0, x, S.Reals) == \
1814.         Interval(-oo, -sqrt(5))
1815.     assert solveset(eq > sqrt(5), x, S.Reals) == \
1816.         Interval.Lopen(sqrt(5), oo)
1817. 
1818. 
1819. def test_issue_12478():
1820.     eq = sqrt(x - 2) + 2
1821.     soln = solveset_real(eq, x)
1822.     assert soln is S.EmptySet
1823.     assert solveset(eq < 0, x, S.Reals) is S.EmptySet
1824.     assert solveset(eq > 0, x, S.Reals) == Interval(2, oo)
1825. 
1826. 
1827. def test_issue_12429():
1828.     eq = solveset(log(x)/x <= 0, x, S.Reals)
1829.     sol = Interval.Lopen(0, 1)
1830.     assert eq == sol
1831. 
1832. 
1833. def test_solveset_arg():
1834.     assert solveset(arg(x), x, S.Reals)  == Interval.open(0, oo)
1835.     assert solveset(arg(4*x -3), x) == Interval.open(Rational(3, 4), oo)
1836. 
1837. 
1838. def test__is_finite_with_finite_vars():
1839.     f = _is_finite_with_finite_vars
1840.     # issue 12482
1841.     assert all(f(1/x) is None for x in (
1842.         Dummy(), Dummy(real=True), Dummy(complex=True)))
1843.     assert f(1/Dummy(real=False)) is True  # b/c it's finite but not 0
1844. 
1845. 
1846. def test_issue_13550():
1847.     assert solveset(x**2 - 2*x - 15, symbol = x, domain = Interval(-oo, 0)) == FiniteSet(-3)
1848. 
1849. 
1850. def test_issue_13849():
1851.     t = symbols('t')
1852.     assert nonlinsolve((t*(sqrt(5) + sqrt(2)) - sqrt(2), t), t) == EmptySet()
1853. 
1854. 
1855. def test_issue_14223():
1856.     x = Symbol('x')
1857.     assert solveset((Abs(x + Min(x, 2)) - 2).rewrite(Piecewise), x,
1858.         S.Reals) == FiniteSet(-1, 1)
1859.     assert solveset((Abs(x + Min(x, 2)) - 2).rewrite(Piecewise), x,
1860.         Interval(0, 2)) == FiniteSet(1)
1861. 
1862. 
1863. def test_issue_10158():
1864.     x = Symbol('x')
1865.     dom = S.Reals
1866.     assert solveset(x*Max(x, 15) - 10, x, dom) == FiniteSet(Rational(2, 3))
1867.     assert solveset(x*Min(x, 15) - 10, x, dom) == FiniteSet(-sqrt(10), sqrt(10))
1868.     assert solveset(Max(Abs(x - 3) - 1, x + 2) - 3, x, dom) == FiniteSet(-1, 1)
1869.     assert solveset(Abs(x - 1) - Abs(y), x, dom) == FiniteSet(-Abs(y) + 1, Abs(y) + 1)
1870.     assert solveset(Abs(x + 4*Abs(x + 1)), x, dom) == FiniteSet(Rational(-4, 3), Rational(-4, 5))
1871.     assert solveset(2*Abs(x + Abs(x + Max(3, x))) - 2, x, S.Reals) == FiniteSet(-1, -2)
1872.     dom = S.Complexes
1873.     raises(ValueError, lambda: solveset(x*Max(x, 15) - 10, x, dom))
1874.     raises(ValueError, lambda: solveset(x*Min(x, 15) - 10, x, dom))
1875.     raises(ValueError, lambda: solveset(Max(Abs(x - 3) - 1, x + 2) - 3, x, dom))
1876.     raises(ValueError, lambda: solveset(Abs(x - 1) - Abs(y), x, dom))
1877.     raises(ValueError, lambda: solveset(Abs(x + 4*Abs(x + 1)), x, dom))
1878. 
1879. 
1880. def test_issue_14300():
1881.     x, y, n = symbols('x y n')
1882. 
1883.     f = 1 - exp(-18000000*x) - y
1884.     a1 = FiniteSet(-log(-y + 1)/18000000)
1885. 
1886.     assert solveset(f, x, S.Reals) == \
1887.         Intersection(S.Reals, a1)
1888.     assert solveset(f, x) == \
1889.         ImageSet(Lambda(n, -I*(2*n*pi + arg(-y + 1))/18000000 -
1890.             log(Abs(y - 1))/18000000), S.Integers)
1891. 
1892. 
1893. def test_issue_14454():
1894.     x = Symbol('x')
1895.     number = CRootOf(x**4 + x - 1, 2)
1896.     raises(ValueError, lambda: invert_real(number, 0, x, S.Reals))
1897.     assert invert_real(x**2, number, x, S.Reals)  # no error
1898. 
1899. 
1900. def test_term_factors():
1901.     assert list(_term_factors(3**x - 2)) == [-2, 3**x]
1902.     expr = 4**(x + 1) + 4**(x + 2) + 4**(x - 1) - 3**(x + 2) - 3**(x + 3)
1903.     assert set(_term_factors(expr)) == set([
1904.         3**(x + 2), 4**(x + 2), 3**(x + 3), 4**(x - 1), -1, 4**(x + 1)])
1905. 
1906. 
1907. #################### tests for transolve and its helpers ###############
1908. 
1909. def test_transolve():
1910. 
1911.     assert _transolve(3**x, x, S.Reals) == S.EmptySet
1912.     assert _transolve(3**x - 9**(x + 5), x, S.Reals) == FiniteSet(-10)
1913. 
1914. 
1915. # exponential tests
1916. def test_exponential_real():
1917.     from sympy.abc import x, y, z
1918. 
1919.     e1 = 3**(2*x) - 2**(x + 3)
1920.     e2 = 4**(5 - 9*x) - 8**(2 - x)
1921.     e3 = 2**x + 4**x
1922.     e4 = exp(log(5)*x) - 2**x
1923.     e5 = exp(x/y)*exp(-z/y) - 2
1924.     e6 = 5**(x/2) - 2**(x/3)
1925.     e7 = 4**(x + 1) + 4**(x + 2) + 4**(x - 1) - 3**(x + 2) - 3**(x + 3)
1926.     e8 = -9*exp(-2*x + 5) + 4*exp(3*x + 1)
1927.     e9 = 2**x + 4**x + 8**x - 84
1928. 
1929.     assert solveset(e1, x, S.Reals) == FiniteSet(
1930.         -3*log(2)/(-2*log(3) + log(2)))
1931.     assert solveset(e2, x, S.Reals) == FiniteSet(Rational(4, 15))
1932.     assert solveset(e3, x, S.Reals) == S.EmptySet
1933.     assert solveset(e4, x, S.Reals) == FiniteSet(0)
1934.     assert solveset(e5, x, S.Reals) == Intersection(
1935.         S.Reals, FiniteSet(y*log(2*exp(z/y))))
1936.     assert solveset(e6, x, S.Reals) == FiniteSet(0)
1937.     assert solveset(e7, x, S.Reals) == FiniteSet(2)
1938.     assert solveset(e8, x, S.Reals) == FiniteSet(-2*log(2)/5 + 2*log(3)/5 + Rational(4, 5))
1939.     assert solveset(e9, x, S.Reals) == FiniteSet(2)
1940. 
1941.     assert solveset_real(-9*exp(-2*x + 5) + 2**(x + 1), x) == FiniteSet(
1942.         -((-5 - 2*log(3) + log(2))/(log(2) + 2)))
1943.     assert solveset_real(4**(x/2) - 2**(x/3), x) == FiniteSet(0)
1944.     b = sqrt(6)*sqrt(log(2))/sqrt(log(5))
1945.     assert solveset_real(5**(x/2) - 2**(3/x), x) == FiniteSet(-b, b)
1946. 
1947.     # coverage test
1948.     C1, C2 = symbols('C1 C2')
1949.     f = Function('f')
1950.     assert solveset_real(C1 + C2/x**2 - exp(-f(x)), f(x)) == Intersection(
1951.         S.Reals, FiniteSet(-log(C1 + C2/x**2)))
1952.     y = symbols('y', positive=True)
1953.     assert solveset_real(x**2 - y**2/exp(x), y) == Intersection(
1954.         S.Reals, FiniteSet(-sqrt(x**2*exp(x)), sqrt(x**2*exp(x))))
1955.     p = Symbol('p', positive=True)
1956.     assert solveset_real((1/p + 1)**(p + 1), p) == EmptySet()
1957. 
1958. 
1959. @XFAIL
1960. def test_exponential_complex():
1961.     from sympy.abc import x
1962.     from sympy import Dummy
1963.     n = Dummy('n')
1964. 
1965.     assert solveset_complex(2**x + 4**x, x) == imageset(
1966.         Lambda(n, I*(2*n*pi + pi)/log(2)), S.Integers)
1967.     assert solveset_complex(x**z*y**z - 2, z) == FiniteSet(
1968.         log(2)/(log(x) + log(y)))
1969.     assert solveset_complex(4**(x/2) - 2**(x/3), x) == imageset(
1970.         Lambda(n, 3*n*I*pi/log(2)), S.Integers)
1971.     assert solveset(2**x + 32, x) == imageset(
1972.         Lambda(n, (I*(2*n*pi + pi) + 5*log(2))/log(2)), S.Integers)
1973. 
1974.     eq = (2**exp(y**2/x) + 2)/(x**2 + 15)
1975.     a = sqrt(x)*sqrt(-log(log(2)) + log(log(2) + 2*n*I*pi))
1976.     assert solveset_complex(eq, y) == FiniteSet(-a, a)
1977. 
1978.     union1 = imageset(Lambda(n, I*(2*n*pi - pi*Rational(2, 3))/log(2)), S.Integers)
1979.     union2 = imageset(Lambda(n, I*(2*n*pi + pi*Rational(2, 3))/log(2)), S.Integers)
1980.     assert solveset(2**x + 4**x + 8**x, x) == Union(union1, union2)
1981. 
1982.     eq = 4**(x + 1) + 4**(x + 2) + 4**(x - 1) - 3**(x + 2) - 3**(x + 3)
1983.     res = solveset(eq, x)
1984.     num = 2*n*I*pi - 4*log(2) + 2*log(3)
1985.     den = -2*log(2) + log(3)
1986.     ans = imageset(Lambda(n, num/den), S.Integers)
1987.     assert res == ans
1988. 
1989. 
1990. def test_expo_conditionset():
1991.     from sympy.abc import x, y
1992. 
1993.     f1 = (exp(x) + 1)**x - 2
1994.     f2 = (x + 2)**y*x - 3
1995.     f3 = 2**x - exp(x) - 3
1996.     f4 = log(x) - exp(x)
1997.     f5 = 2**x + 3**x - 5**x
1998. 
1999.     assert solveset(f1, x, S.Reals) == ConditionSet(
2000.         x, Eq((exp(x) + 1)**x - 2, 0), S.Reals)
2001.     assert solveset(f2, x, S.Reals) == ConditionSet(
2002.         x, Eq(x*(x + 2)**y - 3, 0), S.Reals)
2003.     assert solveset(f3, x, S.Reals) == ConditionSet(
2004.         x, Eq(2**x - exp(x) - 3, 0), S.Reals)
2005.     assert solveset(f4, x, S.Reals) == ConditionSet(
2006.         x, Eq(-exp(x) + log(x), 0), S.Reals)
2007.     assert solveset(f5, x, S.Reals) == ConditionSet(
2008.         x, Eq(2**x + 3**x - 5**x, 0), S.Reals)
2009. 
2010. 
2011. def test_exponential_symbols():
2012.     x, y, z = symbols('x y z', positive=True)
2013. 
2014.     assert solveset(z**x - y, x, S.Reals) == Intersection(
2015.         S.Reals, FiniteSet(log(y)/log(z)))
2016. 
2017.     w = symbols('w')
2018.     f1 = 2*x**w - 4*y**w
2019.     f2 = (x/y)**w - 2
2020.     sol1 = Intersection({log(2)/(log(x) - log(y))}, S.Reals)
2021.     sol2 = Intersection({log(2)/log(x/y)}, S.Reals)
2022.     assert solveset(f1, w, S.Reals) == sol1
2023.     assert solveset(f2, w, S.Reals) == sol2
2024. 
2025.     assert solveset(x**x, x, S.Reals) == S.EmptySet
2026.     assert solveset(x**y - 1, y, S.Reals) == FiniteSet(0)
2027.     assert solveset(exp(x/y)*exp(-z/y) - 2, y, S.Reals) == FiniteSet(
2028.         (x - z)/log(2)) - FiniteSet(0)
2029. 
2030.     a, b, x, y = symbols('a b x y')
2031.     assert solveset_real(a**x - b**x, x) == ConditionSet(
2032.         x, (a > 0) & (b > 0), FiniteSet(0))
2033.     assert solveset(a**x - b**x, x) == ConditionSet(
2034.         x, Ne(a, 0) & Ne(b, 0), FiniteSet(0))
2035. 
2036. 
2037. @XFAIL
2038. def test_issue_10864():
2039.     assert solveset(x**(y*z) - x, x, S.Reals) == FiniteSet(1)
2040. 
2041. 
2042. @XFAIL
2043. def test_solve_only_exp_2():
2044.     assert solveset_real(sqrt(exp(x)) + sqrt(exp(-x)) - 4, x) == \
2045.         FiniteSet(2*log(-sqrt(3) + 2), 2*log(sqrt(3) + 2))
2046. 
2047. 
2048. def test_is_exponential():
2049.     x, y, z = symbols('x y z')
2050. 
2051.     assert _is_exponential(y, x) is False
2052.     assert _is_exponential(3**x - 2, x) is True
2053.     assert _is_exponential(5**x - 7**(2 - x), x) is True
2054.     assert _is_exponential(sin(2**x) - 4*x, x) is False
2055.     assert _is_exponential(x**y - z, y) is True
2056.     assert _is_exponential(x**y - z, x) is False
2057.     assert _is_exponential(2**x + 4**x - 1, x) is True
2058.     assert _is_exponential(x**(y*z) - x, x) is False
2059.     assert _is_exponential(x**(2*x) - 3**x, x) is False
2060.     assert _is_exponential(x**y - y*z, y) is False
2061.     assert _is_exponential(x**y - x*z, y) is True
2062. 
2063. 
2064. def test_solve_exponential():
2065.     assert _solve_exponential(3**(2*x) - 2**(x + 3), 0, x, S.Reals) == \
2066.         FiniteSet(-3*log(2)/(-2*log(3) + log(2)))
2067.     assert _solve_exponential(2**y + 4**y, 1, y, S.Reals) == \
2068.         FiniteSet(log(Rational(-1, 2) + sqrt(5)/2)/log(2))
2069.     assert _solve_exponential(2**y + 4**y, 0, y, S.Reals) == \
2070.         S.EmptySet
2071.     assert _solve_exponential(2**x + 3**x - 5**x, 0, x, S.Reals) == \
2072.         ConditionSet(x, Eq(2**x + 3**x - 5**x, 0), S.Reals)
2073. 
2074. # end of exponential tests
2075. 
2076. 
2077. # logarithmic tests
2078. def test_logarithmic():
2079.     assert solveset_real(log(x - 3) + log(x + 3), x) == FiniteSet(
2080.         -sqrt(10), sqrt(10))
2081.     assert solveset_real(log(x + 1) - log(2*x - 1), x) == FiniteSet(2)
2082.     assert solveset_real(log(x + 3) + log(1 + 3/x) - 3, x) == FiniteSet(
2083.         -3 + sqrt(-12 + exp(3))*exp(Rational(3, 2))/2 + exp(3)/2,
2084.         -sqrt(-12 + exp(3))*exp(Rational(3, 2))/2 - 3 + exp(3)/2)
2085. 
2086.     eq = z - log(x) + log(y/(x*(-1 + y**2/x**2)))
2087.     assert solveset_real(eq, x) == \
2088.         Intersection(S.Reals, FiniteSet(-sqrt(y**2 - y*exp(z)),
2089.             sqrt(y**2 - y*exp(z)))) - \
2090.         Intersection(S.Reals, FiniteSet(-sqrt(y**2), sqrt(y**2)))
2091.     assert solveset_real(
2092.         log(3*x) - log(-x + 1) - log(4*x + 1), x) == FiniteSet(Rational(-1, 2), S.Half)
2093.     assert solveset(log(x**y) - y*log(x), x, S.Reals) == S.Reals
2094. 
2095. @XFAIL
2096. def test_uselogcombine_2():
2097.     eq = log(exp(2*x) + 1) + log(-tanh(x) + 1) - log(2)
2098.     assert solveset_real(eq, x) == EmptySet()
2099.     eq = log(8*x) - log(sqrt(x) + 1) - 2
2100.     assert solveset_real(eq, x) == EmptySet()
2101. 
2102. 
2103. def test_is_logarithmic():
2104.     assert _is_logarithmic(y, x) is False
2105.     assert _is_logarithmic(log(x), x) is True
2106.     assert _is_logarithmic(log(x) - 3, x) is True
2107.     assert _is_logarithmic(log(x)*log(y), x) is True
2108.     assert _is_logarithmic(log(x)**2, x) is False
2109.     assert _is_logarithmic(log(x - 3) + log(x + 3), x) is True
2110.     assert _is_logarithmic(log(x**y) - y*log(x), x) is True
2111.     assert _is_logarithmic(sin(log(x)), x) is False
2112.     assert _is_logarithmic(x + y, x) is False
2113.     assert _is_logarithmic(log(3*x) - log(1 - x) + 4, x) is True
2114.     assert _is_logarithmic(log(x) + log(y) + x, x) is False
2115.     assert _is_logarithmic(log(log(x - 3)) + log(x - 3), x) is True
2116.     assert _is_logarithmic(log(log(3) + x) + log(x), x) is True
2117.     assert _is_logarithmic(log(x)*(y + 3) + log(x), y) is False
2118. 
2119. 
2120. def test_solve_logarithm():
2121.     y = Symbol('y')
2122.     assert _solve_logarithm(log(x**y) - y*log(x), 0, x, S.Reals) == S.Reals
2123.     y = Symbol('y', positive=True)
2124.     assert _solve_logarithm(log(x)*log(y), 0, x, S.Reals) == FiniteSet(1)
2125. 
2126. # end of logarithmic tests
2127. 
2128. 
2129. def test_linear_coeffs():
2130.     from sympy.solvers.solveset import linear_coeffs
2131.     assert linear_coeffs(0, x) == [0, 0]
2132.     assert all(i is S.Zero for i in linear_coeffs(0, x))
2133.     assert linear_coeffs(x + 2*y + 3, x, y) == [1, 2, 3]
2134.     assert linear_coeffs(x + 2*y + 3, y, x) == [2, 1, 3]
2135.     assert linear_coeffs(x + 2*x**2 + 3, x, x**2) == [1, 2, 3]
2136.     raises(ValueError, lambda:
2137.         linear_coeffs(x + 2*x**2 + x**3, x, x**2))
2138.     raises(ValueError, lambda:
2139.         linear_coeffs(1/x*(x - 1) + 1/x, x))
2140.     assert linear_coeffs(a*(x + y), x, y) == [a, a, 0]
2141.     assert linear_coeffs(1.0, x, y) == [0, 0, 1.0]
2142. 
2143. # modular tests
2144. def test_is_modular():
2145.     x, y = symbols('x y')
2146. 
2147.     assert _is_modular(y, x) is False
2148.     assert _is_modular(Mod(x, 3) - 1, x) is True
2149.     assert _is_modular(Mod(x**3 - 3*x**2 - x + 1, 3) - 1, x) is True
2150.     assert _is_modular(Mod(exp(x + y), 3) - 2, x) is True
2151.     assert _is_modular(Mod(exp(x + y), 3) - log(x), x) is True
2152.     assert _is_modular(Mod(x, 3) - 1, y) is False
2153.     assert _is_modular(Mod(x, 3)**2 - 5, x) is False
2154.     assert _is_modular(Mod(x, 3)**2 - y, x) is False
2155.     assert _is_modular(exp(Mod(x, 3)) - 1, x) is False
2156.     assert _is_modular(Mod(3, y) - 1, y) is False
2157. 
2158. 
2159. def test_invert_modular():
2160.     x, y = symbols('x y')
2161.     n = Dummy('n', integer=True)
2162.     from sympy.solvers.solveset import _invert_modular as invert_modular
2163. 
2164.     # non invertible cases
2165.     assert invert_modular(Mod(sin(x), 7), S(5), n, x) == (Mod(sin(x), 7), 5)
2166.     assert invert_modular(Mod(exp(x), 7), S(5), n, x) == (Mod(exp(x), 7), 5)
2167.     assert invert_modular(Mod(log(x), 7), S(5), n, x) == (Mod(log(x), 7), 5)
2168.     # a is symbol
2169.     assert invert_modular(Mod(x, 7), S(5), n, x) == \
2170.             (x, ImageSet(Lambda(n, 7*n + 5), S.Integers))
2171.     # a.is_Add
2172.     assert invert_modular(Mod(x + 8, 7), S(5), n, x) == \
2173.             (x, ImageSet(Lambda(n, 7*n + 4), S.Integers))
2174.     assert invert_modular(Mod(x**2 + x, 7), S(5), n, x) == \
2175.             (Mod(x**2 + x, 7), 5)
2176.     # a.is_Mul
2177.     assert invert_modular(Mod(3*x, 7), S(5), n, x) == \
2178.             (x, ImageSet(Lambda(n, 7*n + 4), S.Integers))
2179.     assert invert_modular(Mod((x + 1)*(x + 2), 7), S(5), n, x) == \
2180.             (Mod((x + 1)*(x + 2), 7), 5)
2181.     # a.is_Pow
2182.     assert invert_modular(Mod(x**4, 7), S(5), n, x) == \
2183.             (x, EmptySet())
2184.     assert invert_modular(Mod(3**x, 4), S(3), n, x) == \
2185.             (x, ImageSet(Lambda(n, 2*n + 1), S.Naturals0))
2186.     assert invert_modular(Mod(2**(x**2 + x + 1), 7), S(2), n, x) == \
2187.             (x**2 + x + 1, ImageSet(Lambda(n, 3*n + 1), S.Naturals0))
2188. 
2189. 
2190. def test_solve_modular():
2191.     x = Symbol('x')
2192.     n = Dummy('n', integer=True)
2193.     # if rhs has symbol (need to be implemented in future).
2194.     assert solveset(Mod(x, 4) - x, x, S.Integers) == \
2195.             ConditionSet(x, Eq(-x + Mod(x, 4), 0), \
2196.             S.Integers)
2197.     # when _invert_modular fails to invert
2198.     assert solveset(3 - Mod(sin(x), 7), x, S.Integers) == \
2199.             ConditionSet(x, Eq(Mod(sin(x), 7) - 3, 0), S.Integers)
2200.     assert solveset(3 - Mod(log(x), 7), x, S.Integers) == \
2201.             ConditionSet(x, Eq(Mod(log(x), 7) - 3, 0), S.Integers)
2202.     assert solveset(3 - Mod(exp(x), 7), x, S.Integers) == \
2203.             ConditionSet(x, Eq(Mod(exp(x), 7) - 3, 0), S.Integers)
2204.     # EmptySet solution definitely
2205.     assert solveset(7 - Mod(x, 5), x, S.Integers) == EmptySet()
2206.     assert solveset(5 - Mod(x, 5), x, S.Integers) == EmptySet()
2207.     # Negative m
2208.     assert solveset(2 + Mod(x, -3), x, S.Integers) == \
2209.             ImageSet(Lambda(n, -3*n - 2), S.Integers)
2210.     assert solveset(4 + Mod(x, -3), x, S.Integers) == EmptySet()
2211.     # linear expression in Mod
2212.     assert solveset(3 - Mod(x, 5), x, S.Integers) == ImageSet(Lambda(n, 5*n + 3), S.Integers)
2213.     assert solveset(3 - Mod(5*x - 8, 7), x, S.Integers) == \
2214.                 ImageSet(Lambda(n, 7*n + 5), S.Integers)
2215.     assert solveset(3 - Mod(5*x, 7), x, S.Integers) == \
2216.                 ImageSet(Lambda(n, 7*n + 2), S.Integers)
2217.     # higher degree expression in Mod
2218.     assert solveset(Mod(x**2, 160) - 9, x, S.Integers) == \
2219.             Union(ImageSet(Lambda(n, 160*n + 3), S.Integers),
2220.             ImageSet(Lambda(n, 160*n + 13), S.Integers),
2221.             ImageSet(Lambda(n, 160*n + 67), S.Integers),
2222.             ImageSet(Lambda(n, 160*n + 77), S.Integers),
2223.             ImageSet(Lambda(n, 160*n + 83), S.Integers),
2224.             ImageSet(Lambda(n, 160*n + 93), S.Integers),
2225.             ImageSet(Lambda(n, 160*n + 147), S.Integers),
2226.             ImageSet(Lambda(n, 160*n + 157), S.Integers))
2227.     assert solveset(3 - Mod(x**4, 7), x, S.Integers) == EmptySet()
2228.     assert solveset(Mod(x**4, 17) - 13, x, S.Integers) == \
2229.             Union(ImageSet(Lambda(n, 17*n + 3), S.Integers),
2230.             ImageSet(Lambda(n, 17*n + 5), S.Integers),
2231.             ImageSet(Lambda(n, 17*n + 12), S.Integers),
2232.             ImageSet(Lambda(n, 17*n + 14), S.Integers))
2233.     # a.is_Pow tests
2234.     assert solveset(Mod(7**x, 41) - 15, x, S.Integers) == \
2235.             ImageSet(Lambda(n, 40*n + 3), S.Naturals0)
2236.     assert solveset(Mod(12**x, 21) - 18, x, S.Integers) == \
2237.             ImageSet(Lambda(n, 6*n + 2), S.Naturals0)
2238.     assert solveset(Mod(3**x, 4) - 3, x, S.Integers) == \
2239.             ImageSet(Lambda(n, 2*n + 1), S.Naturals0)
2240.     assert solveset(Mod(2**x, 7) - 2 , x, S.Integers) == \
2241.             ImageSet(Lambda(n, 3*n + 1), S.Naturals0)
2242.     assert solveset(Mod(3**(3**x), 4) - 3, x, S.Integers) == \
2243.             Intersection(ImageSet(Lambda(n, Intersection({log(2*n + 1)/log(3)},
2244.             S.Integers)), S.Naturals0), S.Integers)
2245.     # Not Implemented for m without primitive root
2246.     assert solveset(Mod(x**3, 8) - 1, x, S.Integers) == \
2247.             ConditionSet(x, Eq(Mod(x**3, 8) - 1, 0), S.Integers)
2248.     assert solveset(Mod(x**4, 9) - 4, x, S.Integers) == \
2249.             ConditionSet(x, Eq(Mod(x**4, 9) - 4, 0), S.Integers)
2250.     # domain intersection
2251.     assert solveset(3 - Mod(5*x - 8, 7), x, S.Naturals0) == \
2252.             Intersection(ImageSet(Lambda(n, 7*n + 5), S.Integers), S.Naturals0)
2253.     # Complex args
2254.     assert solveset(Mod(x, 3) - I, x, S.Integers) == \
2255.             EmptySet()
2256.     assert solveset(Mod(I*x, 3) - 2, x, S.Integers) == \
2257.             ConditionSet(x, Eq(Mod(I*x, 3) - 2, 0), S.Integers)
2258.     assert solveset(Mod(I + x, 3) - 2, x, S.Integers) == \
2259.             ConditionSet(x, Eq(Mod(x + I, 3) - 2, 0), S.Integers)
2260.     # issue 13178
2261.     n = symbols('n', integer=True)
2262.     a = 742938285
2263.     z = 1898888478
2264.     m = 2**31 - 1
2265.     x = 20170816
2266.     assert solveset(x - Mod(a**n*z, m), n, S.Integers) == \
2267.             ImageSet(Lambda(n, 2147483646*n + 100), S.Naturals0)
2268.     assert solveset(x - Mod(a**n*z, m), n, S.Naturals0) == \
2269.             Intersection(ImageSet(Lambda(n, 2147483646*n + 100), S.Naturals0),
2270.             S.Naturals0)
2271.     assert solveset(x - Mod(a**(2*n)*z, m), n, S.Integers) == \
2272.             Intersection(ImageSet(Lambda(n, 1073741823*n + 50), S.Naturals0),
2273.             S.Integers)
2274.     assert solveset(x - Mod(a**(2*n + 7)*z, m), n, S.Integers) == EmptySet()
2275.     assert solveset(x - Mod(a**(n - 4)*z, m), n, S.Integers) == \
2276.             Intersection(ImageSet(Lambda(n, 2147483646*n + 104), S.Naturals0),
2277.             S.Integers)
2278. 
2279. @XFAIL
2280. def test_solve_modular_fail():
2281.     # issue 17373 (https://github.com/sympy/sympy/issues/17373)
2282.     assert solveset(Mod(x**4, 14) - 11, x, S.Integers) == \
2283.             Union(ImageSet(Lambda(n, 14*n + 3), S.Integers),
2284.             ImageSet(Lambda(n, 14*n + 11), S.Integers))
2285.     assert solveset(Mod(x**31, 74) - 43, x, S.Integers) == \
2286.             ImageSet(Lambda(n, 74*n + 31), S.Integers)
2287. 
2288. # end of modular tests

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 03:28:51,721 - thread-128217524467392.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases that demonstrate `solveset` returning a `ConditionSet` for equations it cannot solve explicitly. The provided context, `sympy/solvers/tests/test_solveset.py`, contains numerous such test cases. I can find at least three relevant examples in this file. For example, `test_conditionset`, `test_improve_coverage`, and `test_solve_polynomial` all contain tests where `solveset` is expected to return a `ConditionSet`. Therefore, I have sufficient context and do not need to request more information.' query='' extra_requirements='' purpose=''
2025-12-23 03:28:51,723 - thread-128217524467392.prometheus_context_collector - INFO - Successfully retrieved 1 context snippets
