2025-12-23 11:53:13,503 - thread-139575885280960.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: ascii.qdp Table format assumes QDP commands are upper case

Description: ### Description

ascii.qdp assumes that commands in a QDP file are upper case, for example, for errors they must be "READ SERR 1 2" whereas QDP itself is not case sensitive and case use "read serr 1 2". 

As many QDP files are created by hand, the expectation that all commands be all-caps should be removed.

### Expected behavior

The following qdp file should read into a `Table` with errors, rather than crashing.
```
read serr 1 2 
1 0.5 1 0.5
```

### How to Reproduce

Create a QDP file:
```
> cat > test.qdp
read serr 1 2 
1 0.5 1 0.5
<EOF>

 > python
Python 3.10.9 (main, Dec  7 2022, 02:03:23) [Clang 13.0.0 (clang-1300.0.29.30)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from astropy.table import Table
>>> Table.read('test.qdp',format='ascii.qdp')
WARNING: table_id not specified. Reading the first available table [astropy.io.ascii.qdp]
Traceback (most recent call last):
...
    raise ValueError(f'Unrecognized QDP line: {line}')
ValueError: Unrecognized QDP line: read serr 1 2
```

Running "qdp test.qdp" works just fine.


### Versions

Python 3.10.9 (main, Dec  7 2022, 02:03:23) [Clang 13.0.0 (clang-1300.0.29.30)]
astropy 5.1
Numpy 1.24.1
pyerfa 2.0.0.1
Scipy 1.10.0
Matplotlib 3.6.3


Patch information:
diff --git a/astropy/io/ascii/qdp.py b/astropy/io/ascii/qdp.py
index 83a4f004aa..bd801b786d 100644
--- a/astropy/io/ascii/qdp.py
+++ b/astropy/io/ascii/qdp.py
@@ -67,7 +67,7 @@ def _line_type(line, delimiter=None):
         sep = r"\s+"
     _new_re = rf"NO({sep}NO)+"
     _data_re = rf"({_decimal_re}|NO|[-+]?nan)({sep}({_decimal_re}|NO|[-+]?nan))*)"
-    _type_re = rf"^\s*((?P<command>{_command_re})|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
+    _type_re = rf"^\s*((?P<command>(?i:{_command_re}))|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
     _line_type_re = re.compile(_type_re)
     line = line.strip()
     if not line:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 11:53:13,574 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .devcontainer
|   └── welcome-message.txt
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yaml
|   |   ├── config.yml
|   |   └── feature_request.yaml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── labeler.yml
|   └── workflows
|       ├── check_changelog.yml
|       ├── ci_cron_daily.yml
|       ├── ci_cron_weekly.yml
|       ├── ci_workflows.yml
|       ├── codeql-analysis.yml
|       ├── open_actions.yml
|       ├── publish.yml
|       ├── stalebot.yml
|       └── update_iers.yml
├── .pre-commit-config.yaml
├── .pyinstaller
|   ├── hooks
|   |   └── hook-skyfield.py
|   └── run_astropy_tests.py
├── .readthedocs.yaml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── LICENSE.rst
├── README.rst
├── astropy
|   ├── __init__.py
|   ├── _dev
|   |   ├── __init__.py
|   |   └── scm_version.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── astropyconst40.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── codata2018.py
|   |   ├── config.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_prior_version.py
|   |   |   └── test_sciencestate.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── convolve.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_formats.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── equatorial.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hadec.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── icrs_observed_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── itrs_observed_transforms.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── erfa_astrom.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── jparser.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── sky_coordinate_parsers.py
|   |   ├── solar_system.py
|   |   ├── spectral_coordinate.py
|   |   ├── spectral_quantity.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── generate_spectralcoord_ref.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── data
|   |   |   ├── helper.py
|   |   |   ├── test_angle_generators.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_earth_orientation.py
|   |   |   ├── test_erfa_astrom.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_geodetic_representations.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_icrs_observed_transformations.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_spectral_coordinate.py
|   |   |   ├── test_spectral_quantity.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_utils.py
|   |   |   └── test_velocity_corrs.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── connect.py
|   |   ├── core.py
|   |   ├── data
|   |   ├── flrw
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── lambdacdm.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── conftest.py
|   |   |   |   ├── data
|   |   |   |   ├── test_base.py
|   |   |   |   ├── test_init.py
|   |   |   |   ├── test_lambdacdm.py
|   |   |   |   ├── test_w.py
|   |   |   |   ├── test_w0cdm.py
|   |   |   |   ├── test_w0wacdm.py
|   |   |   |   ├── test_w0wzcdm.py
|   |   |   |   └── test_wpwazpcdm.py
|   |   |   ├── w0cdm.py
|   |   |   ├── w0wacdm.py
|   |   |   ├── w0wzcdm.py
|   |   |   └── wpwazpcdm.py
|   |   ├── funcs
|   |   |   ├── __init__.py
|   |   |   ├── comparison.py
|   |   |   ├── optimize.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_comparison.py
|   |   |       └── test_funcs.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── cosmology.py
|   |   |   ├── ecsv.py
|   |   |   ├── html.py
|   |   |   ├── mapping.py
|   |   |   ├── model.py
|   |   |   ├── row.py
|   |   |   ├── table.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── test_.py
|   |   |   |   ├── test_cosmology.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_json.py
|   |   |   |   ├── test_mapping.py
|   |   |   |   ├── test_model.py
|   |   |   |   ├── test_row.py
|   |   |   |   ├── test_table.py
|   |   |   |   └── test_yaml.py
|   |   |   ├── utils.py
|   |   |   └── yaml.py
|   |   ├── parameter.py
|   |   ├── parameters.py
|   |   ├── realizations.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── conftest.py
|   |   |   ├── helper.py
|   |   |   ├── test_connect.py
|   |   |   ├── test_core.py
|   |   |   ├── test_parameter.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_realizations.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   ├── units.py
|   |   └── utils.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── _strptime.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── jquery
|   |   |   ├── __init__.py
|   |   |   └── data
|   |   |       ├── css
|   |   |       ├── images
|   |   |       └── js
|   |   └── ply
|   |       ├── __init__.py
|   |       ├── cpp.py
|   |       ├── ctokens.py
|   |       ├── lex.py
|   |       ├── yacc.py
|   |       └── ygen.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── docs.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── mrt.py
|   |   |   ├── qdp.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── data
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_qdp.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── _tiled_compression
|   |   |   |   ├── __init__.py
|   |   |   |   ├── codecs.py
|   |   |   |   ├── quantization.py
|   |   |   |   ├── setup_package.py
|   |   |   |   ├── src
|   |   |   |   ├── tests
|   |   |   |   ├── tiled_compression.py
|   |   |   |   └── utils.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── conftest.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_fsspec.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_image_dask.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_tilde_path.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── conftest.py
|   |   |   |   ├── connect.py
|   |   |   |   ├── data
|   |   |   |   ├── deprecation.py
|   |   |   |   ├── extension.py
|   |   |   |   ├── tags
|   |   |   |   ├── tests
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pandas
|   |   |   |   ├── __init__.py
|   |   |   |   └── connect.py
|   |   |   ├── parquet.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pandas.py
|   |   |   |   ├── test_parquet.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── compat.py
|   |   |   ├── core.py
|   |   |   ├── interface.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_registries.py
|   |   |       └── test_registry_help.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── mixin_columns.py
|   |   |   └── safeio.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   └── result.py
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── bounding_box.py
|   |   ├── convolution.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── math_functions.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── physical_models.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── spline.py
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── __init__.py
|   |   |   |   └── spec.txt
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_bounding_box.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_convolution.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_math_func.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_physical_models.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_spline.py
|   |   |   ├── test_statistics.py
|   |   |   ├── test_units_mapping.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── _testing.py
|   |   ├── bitmask.py
|   |   ├── blocks.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_bitmask.py
|   |   |   ├── test_blocks.py
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── bls
|   |   |   └── __init__.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   └── __init__.py
|   |   ├── setup_package.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   ├── src
|   |   |   ├── compute_bounds.c
|   |   |   ├── fast_sigma_clip.c
|   |   |   └── wirth_select.c
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── connect.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── dask.py
|   |   |   ├── registry.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_dask.py
|   |   |       └── test_registry.py
|   |   ├── ndarray_mixin.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── soco.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── figures
|   |   |   ├── __init__.py
|   |   |   └── helpers.py
|   |   ├── helper.py
|   |   ├── runner.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── parse_times.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_custom_formats.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_fast_parser.py
|   |   |   ├── test_functions.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   ├── test_update_leap_seconds.py
|   |   |   └── test_ut1.py
|   |   ├── time_helper
|   |   |   ├── __init__.py
|   |   |   └── function_helpers.py
|   |   └── utils.py
|   ├── timeseries
|   |   ├── __init__.py
|   |   ├── binned.py
|   |   ├── core.py
|   |   ├── downsample.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── kepler.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_kepler.py
|   |   ├── periodograms
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── bls
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core.py
|   |   |   |   ├── methods.py
|   |   |   |   ├── setup_package.py
|   |   |   |   └── tests
|   |   |   └── lombscargle
|   |   |       ├── __init__.py
|   |   |       ├── _statistics.py
|   |   |       ├── core.py
|   |   |       ├── implementations
|   |   |       ├── tests
|   |   |       └── utils.py
|   |   ├── sampled.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       ├── test_binned.py
|   |       ├── test_common.py
|   |       ├── test_downsample.py
|   |       └── test_sampled.py
|   ├── uncertainty
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── distributions.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_containers.py
|   |       └── test_distribution.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── _typing.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── misc.py
|   |   ├── photometric.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper
|   |   |   ├── __init__.py
|   |   |   ├── converters.py
|   |   |   ├── erfa.py
|   |   |   ├── function_helpers.py
|   |   |   ├── helpers.py
|   |   |   └── scipy_special.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── structured.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_aliases.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_photometric.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_annotations.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_helpers.py
|   |   |   ├── test_quantity_info.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_typing.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   ├── test_structured.py
|   |   |   ├── test_structured_erfa_ufuncs.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpycompat.py
|   |   |   └── optional_deps.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── diff.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── update_builtin_iers.sh
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── data
|   |   |       ├── test_iers.py
|   |   |       └── test_leap_second.py
|   |   ├── introspection.py
|   |   ├── masked
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── function_helpers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_containers.py
|   |   |       ├── test_function_helpers.py
|   |   |       ├── test_functions.py
|   |   |       ├── test_masked.py
|   |   |       └── test_table.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── parsing.py
|   |   ├── setup_package.py
|   |   ├── shapes.py
|   |   ├── src
|   |   |   └── compiler.c
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── dataurl
|   |   |   |   ├── dataurl_mirror
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_diff.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_parsing.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_shapes.py
|   |   |   ├── test_state.py
|   |   |   └── test_xml.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── version.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   ├── test_time.py
|   |   |   └── test_units.py
|   |   ├── time.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── helpers.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_grid_paths.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   ├── test_utils.py
|   |       |   └── test_wcsapi.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       ├── utils.py
|   |       └── wcsapi.py
|   └── wcs
|       ├── __init__.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_auxprm_wrap.c
|       |   ├── wcslib_celprm_wrap.c
|       |   ├── wcslib_prjprm_wrap.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   ├── wcslib_wrap.c
|       |   └── wcslib_wtbarr_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   ├── maps
|       |   |   ├── spectra
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   ├── validate.6.txt
|       |   |   ├── validate.7.4.txt
|       |   |   ├── validate.7.6.txt
|       |   |   └── validate.txt
|       |   ├── helper.py
|       |   ├── test_auxprm.py
|       |   ├── test_celprm.py
|       |   ├── test_pickle.py
|       |   ├── test_prjprm.py
|       |   ├── test_profiling.py
|       |   ├── test_tab.py
|       |   ├── test_tabprm.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   ├── test_wcsprm.py
|       |   └── test_wtbarr.py
|       ├── utils.py
|       ├── wcs.py
|       ├── wcsapi
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   └── ucds.txt
|       |   ├── fitswcs.py
|       |   ├── high_level_api.py
|       |   ├── high_level_wcs_wrapper.py
|       |   ├── low_level_api.py
|       |   ├── sliced_low_level_wcs.py
|       |   ├── tests
|       |   |   ├── __init__.py
|       |   |   ├── test_fitswcs.py
|       |   |   ├── test_high_level_api.py
|       |   |   ├── test_high_level_wcs_wrapper.py
|       |   |   ├── test_low_level_api.py
|       |   |   └── test_utils.py
|       |   ├── utils.py
|       |   └── wrappers
|       |       ├── __init__.py
|       |       ├── base.py
|       |       ├── sliced_wcs.py
|       |       └── tests
|       └── wcslint.py
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.rst
|   |   ├── docs
|   |   |   └── changes.txt
|   |   └── lib
|   |       ├── fits_hcompress.c
|   |       ├── fits_hdecompress.c
|   |       ├── pliocomp.c
|   |       ├── quantize.c
|   |       └── ricecomp.c
|   ├── expat
|   |   ├── README.md
|   |   ├── README.txt
|   |   └── lib
|   |       ├── xmlparse.c
|   |       ├── xmlrole.c
|   |       ├── xmltok.c
|   |       ├── xmltok_impl.c
|   |       └── xmltok_ns.c
|   ├── trim_cfitsio.sh
|   ├── trim_expat.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── codecov.yml
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── _templates
|   |   └── layout.html
|   ├── changelog.rst
|   ├── changes
|   |   ├── 13985.other.rst
|   |   ├── 14252.other.rst
|   |   ├── 14311.other.rst
|   |   ├── 14321.other.rst
|   |   ├── 14349.other.rst
|   |   ├── 14517.other.rst
|   |   ├── README.rst
|   |   ├── config
|   |   ├── constants
|   |   ├── convolution
|   |   ├── coordinates
|   |   |   ├── 13993.feature.rst
|   |   |   ├── 14354.api.rst
|   |   |   ├── 14371.feature.rst
|   |   |   └── 14628.feature.rst
|   |   ├── cosmology
|   |   |   └── 12353.feature.rst
|   |   ├── extern
|   |   ├── io.ascii
|   |   |   └── 14182.feature.rst
|   |   ├── io.fits
|   |   |   ├── 14252.bugfix.rst
|   |   |   ├── 14252.feature.rst
|   |   |   ├── 14353.feature.rst
|   |   |   ├── 14408.feature.rst
|   |   |   ├── 14410.api.rst
|   |   |   ├── 14428.api.rst
|   |   |   ├── 14428.feature.rst
|   |   |   ├── 14508.bugfix.rst
|   |   |   └── 14528.bugfix.rst
|   |   ├── io.misc
|   |   |   └── 14237.feature.rst
|   |   ├── io.registry
|   |   ├── io.votable
|   |   |   ├── 14212.feature.rst
|   |   |   └── 14554.feature.rst
|   |   ├── modeling
|   |   |   ├── 14013.api.rst
|   |   |   ├── 14037.feature.rst
|   |   |   ├── 14038.api.rst
|   |   |   └── 14519.api.rst
|   |   ├── nddata
|   |   |   └── 14175.feature.rst
|   |   ├── samp
|   |   ├── stats
|   |   ├── table
|   |   |   └── 14187.feature.rst
|   |   ├── template.rst
|   |   ├── tests
|   |   ├── time
|   |   |   ├── 14566.bugfix.rst
|   |   |   └── 14606.feature.rst
|   |   ├── timeseries
|   |   |   └── 14294.feature.rst
|   |   ├── uncertainty
|   |   |   └── 14421.bugfix.rst
|   |   ├── units
|   |   |   ├── 13977.bugfix.rst
|   |   |   ├── 14042.feature.rst
|   |   |   ├── 14124.api.rst
|   |   |   ├── 14135.feature.rst
|   |   |   ├── 14163.bugfix.rst
|   |   |   ├── 14253.api.rst
|   |   |   ├── 14267.api.rst
|   |   |   ├── 14407.feature.rst
|   |   |   ├── 14413.bugfix.rst
|   |   |   ├── 14417.api.rst
|   |   |   ├── 14419.bugfix.rst
|   |   |   ├── 14439.api.rst
|   |   |   ├── 14449.feature.rst
|   |   |   └── 14635.bugfix.rst
|   |   ├── utils
|   |   |   ├── 13730.bugfix.rst
|   |   |   ├── 14341.feature.rst
|   |   |   ├── 14382.feature.rst
|   |   |   ├── 14590.api.rst
|   |   |   └── 14624.bugfix.rst
|   |   ├── visualization
|   |   |   ├── 13989.api.rst
|   |   |   ├── 13989.bugfix.rst
|   |   |   ├── 14050.api.rst
|   |   |   ├── 14251.bugfix.rst
|   |   |   └── 14326.bugfix.rst
|   |   └── wcs
|   |       └── 14295.bugfix.rst
|   ├── common_links.txt
|   ├── conf.py
|   ├── config
|   |   ├── astropy_config.rst
|   |   └── index.rst
|   ├── conftest.py
|   ├── constants
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   ├── performance.inc.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── common_errors.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── performance.inc.rst
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── satellites.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── spectralcoord.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   ├── dev.rst
|   |   ├── index.rst
|   |   ├── io.rst
|   |   └── units.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── style-guide.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   ├── when_to_rebase.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       └── virtual_pythons.rst
|   ├── getting_started.rst
|   ├── glossary.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── ecsv.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── asdf-schemas.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   ├── tiled_compression.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   └── usage
|   |   |       ├── cloud.rst
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       ├── performance.inc.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── lts_policy.rst
|   ├── modeling
|   |   ├── add-units.rst
|   |   ├── compound-models.rst
|   |   ├── example-fitting-constraints.rst
|   |   ├── example-fitting-line.rst
|   |   ├── example-fitting-model-sets.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── jointfitter.rst
|   |   ├── models.rst
|   |   ├── new-fitter.rst
|   |   ├── new-model.rst
|   |   ├── parameters.rst
|   |   ├── performance.rst
|   |   ├── physical_models.rst
|   |   ├── polynomial_models.rst
|   |   ├── powerlaw_models.rst
|   |   ├── predef_models1D.rst
|   |   ├── predef_models2D.rst
|   |   ├── reference_api.rst
|   |   ├── spline_models.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── bitmask.rst
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── examples
|   |   |   └── cutout2d_tofits.py
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── performance.inc.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── robots.txt
|   ├── rtd_environment.yaml
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── performance.inc.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── performance.inc.rst
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── timeseries
|   |   ├── analysis.rst
|   |   ├── bls.rst
|   |   ├── data_access.rst
|   |   ├── index.rst
|   |   ├── initializing.rst
|   |   ├── io.rst
|   |   ├── lombscargle.rst
|   |   ├── masking.rst
|   |   ├── pandas.rst
|   |   └── times.rst
|   ├── uncertainty
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── constants_versions.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── performance.inc.rst
|   |   ├── physical_types.rst
|   |   ├── quantity.rst
|   |   ├── standard_units.rst
|   |   ├── structured_units.rst
|   |   └── type_hints.rst
|   ├── utils
|   |   ├── data.rst
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── masked
|   |       └── index.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── matplotlib_integration.rst
|   |   ├── normalization.rst
|   |   ├── performance.inc.rst
|   |   ├── rgb.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── generic_transforms.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── example_create_imaging.rst
|   |   ├── example_cube_wcs.rst
|   |   ├── examples
|   |   |   ├── cube_wcs.py
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── legacy_interface.rst
|   |   ├── loading_from_fits.rst
|   |   ├── note_sip.rst
|   |   ├── performance.inc.rst
|   |   ├── reference_api.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   ├── relax.rst
|   |   ├── supported_projections.rst
|   |   ├── validation.rst
|   |   ├── wcsapi.rst
|   |   └── wcstools.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       ├── 3.2.rst
|       ├── 4.0.rst
|       ├── 4.1.rst
|       ├── 4.2.rst
|       ├── 4.3.rst
|       ├── 5.0.rst
|       ├── 5.1.rst
|       ├── 5.2.rst
|       ├── 5.3.rst
|       └── index.rst
├── examples
|   ├── README.rst
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── PYTHON.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
└── setup.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ascii.qdp Table format assumes QDP commands are upper case

Description: ### Description

ascii.qdp assumes that commands in a QDP file are upper case, for example, for errors they must be "READ SERR 1 2" whereas QDP itself is not case sensitive and case use "read serr 1 2". 

As many QDP files are created by hand, the expectation that all commands be all-caps should be removed.

### Expected behavior

The following qdp file should read into a `Table` with errors, rather than crashing.
```
read serr 1 2 
1 0.5 1 0.5
```

### How to Reproduce

Create a QDP file:
```
> cat > test.qdp
read serr 1 2 
1 0.5 1 0.5
<EOF>

 > python
Python 3.10.9 (main, Dec  7 2022, 02:03:23) [Clang 13.0.0 (clang-1300.0.29.30)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from astropy.table import Table
>>> Table.read('test.qdp',format='ascii.qdp')
WARNING: table_id not specified. Reading the first available table [astropy.io.ascii.qdp]
Traceback (most recent call last):
...
    raise ValueError(f'Unrecognized QDP line: {line}')
ValueError: Unrecognized QDP line: read serr 1 2
```

Running "qdp test.qdp" works just fine.


### Versions

Python 3.10.9 (main, Dec  7 2022, 02:03:23) [Clang 13.0.0 (clang-1300.0.29.30)]
astropy 5.1
Numpy 1.24.1
pyerfa 2.0.0.1
Scipy 1.10.0
Matplotlib 3.6.3


Patch information:
diff --git a/astropy/io/ascii/qdp.py b/astropy/io/ascii/qdp.py
index 83a4f004aa..bd801b786d 100644
--- a/astropy/io/ascii/qdp.py
+++ b/astropy/io/ascii/qdp.py
@@ -67,7 +67,7 @@ def _line_type(line, delimiter=None):
         sep = r"\s+"
     _new_re = rf"NO({sep}NO)+"
     _data_re = rf"({_decimal_re}|NO|[-+]?nan)({sep}({_decimal_re}|NO|[-+]?nan))*)"
-    _type_re = rf"^\s*((?P<command>{_command_re})|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
+    _type_re = rf"^\s*((?P<command>(?i:{_command_re}))|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
     _line_type_re = re.compile(_type_re)
     line = line.strip()
     if not line:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 11:53:31,654 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find 3 relevant test cases for a bug in `astropy.io.ascii.qdp`. The bug is related to case-sensitive command parsing in QDP files. To find relevant existing tests, I need to examine the tests for the `qdp` module. The most relevant file is likely `astropy/io/ascii/tests/test_qdp.py`. I also need the source code of the module itself, `astropy/io/ascii/qdp.py`, to understand the context of the tests and the bug. I currently have no file contents, so I must request them.' query='Please provide the full content of `astropy/io/ascii/tests/test_qdp.py` and `astropy/io/ascii/qdp.py`.' extra_requirements='' purpose='I need the content of the test file to identify relevant test cases and the source file to understand the code being tested.'
2025-12-23 11:53:31,660 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `astropy/io/ascii/tests/test_qdp.py` and `astropy/io/ascii/qdp.py`.
2025-12-23 11:53:31,666 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 11:53:31,672 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 11:53:31,678 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 11:53:31,684 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `astropy/io/ascii/tests/test_qdp.py` and `astropy/io/ascii/qdp.py`.
Purpose: I need the content of the test file to identify relevant test cases and the source file to understand the code being tested.
2025-12-23 11:53:36,915 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of both the test file `astropy/io/ascii/tests/test_qdp.py` and the source file `astropy/io/ascii/qdp.py`. This will allow you to examine the test cases and the corresponding source code.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "astropy/io/ascii/qdp.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2132, 'candidates_token_count': 114, 'total_token_count': 2657, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2132}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 114}], 'thoughts_token_count': 411, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.0873687560098213, 'model_name': 'gemini-2.5-pro'} id='run--b7450b62-edff-44d3-b1c3-1d0c28cb6f86-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'astropy/io/ascii/tests/test_qdp.py'}, 'id': '81966a3c-7028-4b06-ab56-909b205723f3', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'astropy/io/ascii/qdp.py'}, 'id': 'a28067ff-2cf5-4e33-a108-d5a38e07405b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2132, 'output_tokens': 114, 'total_tokens': 2657, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 411}}
2025-12-23 11:53:40,710 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of both the test file `astropy/io/ascii/tests/test_qdp.py` and the source file `astropy/io/ascii/qdp.py`. You can now examine the test cases in the test file to understand how the QDP reader and writer are tested. The source file contains the implementation of the QDP reader and writer, which you can now analyze to understand its logic.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 14182, 'candidates_token_count': 92, 'total_token_count': 14495, 'cached_content_token_count': 1877, 'prompt_tokens_details': [{'modality': 1, 'token_count': 14182}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1877}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 92}], 'thoughts_token_count': 221}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17033396596493927, 'model_name': 'gemini-2.5-pro'} id='run--f737e99f-e74a-4455-8e3e-003f1b3797c1-0' usage_metadata={'input_tokens': 14182, 'output_tokens': 92, 'total_tokens': 14495, 'input_token_details': {'cache_read': 1877}, 'output_token_details': {'reasoning': 221}}
2025-12-23 11:53:40,711 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `astropy/io/ascii/tests/test_qdp.py` and `astropy/io/ascii/qdp.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need the content of the test file to identify relevant test cases and the source file to understand the code being tested.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: astropy/io/ascii/qdp.py
Line number range: 1 - 500
Content:
1. # Licensed under a 3-clause BSD style license - see LICENSE.rst
2. """
3. This package contains functions for reading and writing QDP tables that are
4. not meant to be used directly, but instead are available as readers/writers in
5. `astropy.table`. See :ref:`astropy:table_io` for more details.
6. """
7. import copy
8. import re
9. import warnings
10. from collections.abc import Iterable
11. 
12. import numpy as np
13. 
14. from astropy.table import Table
15. from astropy.utils.exceptions import AstropyUserWarning
16. 
17. from . import basic, core
18. 
19. 
20. def _line_type(line, delimiter=None):
21.     """Interpret a QDP file line.
22. 
23.     Parameters
24.     ----------
25.     line : str
26.         a single line of the file
27. 
28.     Returns
29.     -------
30.     type : str
31.         Line type: "comment", "command", or "data"
32. 
33.     Examples
34.     --------
35.     >>> _line_type("READ SERR 3")
36.     'command'
37.     >>> _line_type(" \\n    !some gibberish")
38.     'comment'
39.     >>> _line_type("   ")
40.     'comment'
41.     >>> _line_type(" 21345.45")
42.     'data,1'
43.     >>> _line_type(" 21345.45 1.53e-3 1e-3 .04 NO nan")
44.     'data,6'
45.     >>> _line_type(" 21345.45,1.53e-3,1e-3,.04,NO,nan", delimiter=',')
46.     'data,6'
47.     >>> _line_type(" 21345.45 ! a comment to disturb")
48.     'data,1'
49.     >>> _line_type("NO NO NO NO NO")
50.     'new'
51.     >>> _line_type("NO,NO,NO,NO,NO", delimiter=',')
52.     'new'
53.     >>> _line_type("N O N NOON OON O")
54.     Traceback (most recent call last):
55.         ...
56.     ValueError: Unrecognized QDP line...
57.     >>> _line_type(" some non-comment gibberish")
58.     Traceback (most recent call last):
59.         ...
60.     ValueError: Unrecognized QDP line...
61.     """
62.     _decimal_re = r"[+-]?(\d+(\.\d*)?|\.\d+)([eE][+-]?\d+)?"
63.     _command_re = r"READ [TS]ERR(\s+[0-9]+)+"
64. 
65.     sep = delimiter
66.     if delimiter is None:
67.         sep = r"\s+"
68.     _new_re = rf"NO({sep}NO)+"
69.     _data_re = rf"({_decimal_re}|NO|[-+]?nan)({sep}({_decimal_re}|NO|[-+]?nan))*)"
70.     _type_re = rf"^\s*((?P<command>{_command_re})|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
71.     _line_type_re = re.compile(_type_re)
72.     line = line.strip()
73.     if not line:
74.         return "comment"
75.     match = _line_type_re.match(line)
76. 
77.     if match is None:
78.         raise ValueError(f"Unrecognized QDP line: {line}")
79.     for type_, val in match.groupdict().items():
80.         if val is None:
81.             continue
82.         if type_ == "data":
83.             return f"data,{len(val.split(sep=delimiter))}"
84.         else:
85.             return type_
86. 
87. 
88. def _get_type_from_list_of_lines(lines, delimiter=None):
89.     """Read through the list of QDP file lines and label each line by type.
90. 
91.     Parameters
92.     ----------
93.     lines : list
94.         List containing one file line in each entry
95. 
96.     Returns
97.     -------
98.     contents : list
99.         List containing the type for each line (see `line_type_and_data`)
100.     ncol : int
101.         The number of columns in the data lines. Must be the same throughout
102.         the file
103. 
104.     Examples
105.     --------
106.     >>> line0 = "! A comment"
107.     >>> line1 = "543 12 456.0"
108.     >>> lines = [line0, line1]
109.     >>> types, ncol = _get_type_from_list_of_lines(lines)
110.     >>> types[0]
111.     'comment'
112.     >>> types[1]
113.     'data,3'
114.     >>> ncol
115.     3
116.     >>> lines.append("23")
117.     >>> _get_type_from_list_of_lines(lines)
118.     Traceback (most recent call last):
119.         ...
120.     ValueError: Inconsistent number of columns
121.     """
122.     types = [_line_type(line, delimiter=delimiter) for line in lines]
123.     current_ncol = None
124.     for type_ in types:
125.         if type_.startswith("data,"):
126.             ncol = int(type_[5:])
127.             if current_ncol is None:
128.                 current_ncol = ncol
129.             elif ncol != current_ncol:
130.                 raise ValueError("Inconsistent number of columns")
131. 
132.     return types, current_ncol
133. 
134. 
135. def _get_lines_from_file(qdp_file):
136.     if "\n" in qdp_file:
137.         lines = qdp_file.split("\n")
138.     elif isinstance(qdp_file, str):
139.         with open(qdp_file) as fobj:
140.             lines = [line.strip() for line in fobj.readlines()]
141.     elif isinstance(qdp_file, Iterable):
142.         lines = qdp_file
143.     else:
144.         raise ValueError("invalid value of qdb_file")
145. 
146.     return lines
147. 
148. 
149. def _interpret_err_lines(err_specs, ncols, names=None):
150.     """Give list of column names from the READ SERR and TERR commands.
151. 
152.     Parameters
153.     ----------
154.     err_specs : dict
155.         ``{'serr': [n0, n1, ...], 'terr': [n2, n3, ...]}``
156.         Error specifications for symmetric and two-sided errors
157.     ncols : int
158.         Number of data columns
159. 
160.     Other Parameters
161.     ----------------
162.     names : list of str
163.         Name of data columns (defaults to ['col1', 'col2', ...]), _not_
164.         including error columns.
165. 
166.     Returns
167.     -------
168.     colnames : list
169.         List containing the column names. Error columns will have the name
170.         of the main column plus ``_err`` for symmetric errors, and ``_perr``
171.         and ``_nerr`` for positive and negative errors respectively
172. 
173.     Examples
174.     --------
175.     >>> col_in = ['MJD', 'Rate']
176.     >>> cols = _interpret_err_lines(None, 2, names=col_in)
177.     >>> cols[0]
178.     'MJD'
179.     >>> err_specs = {'terr': [1], 'serr': [2]}
180.     >>> ncols = 5
181.     >>> cols = _interpret_err_lines(err_specs, ncols, names=col_in)
182.     >>> cols[0]
183.     'MJD'
184.     >>> cols[2]
185.     'MJD_nerr'
186.     >>> cols[4]
187.     'Rate_err'
188.     >>> _interpret_err_lines(err_specs, 6, names=col_in)
189.     Traceback (most recent call last):
190.         ...
191.     ValueError: Inconsistent number of input colnames
192.     """
193.     colnames = ["" for i in range(ncols)]
194.     if err_specs is None:
195.         serr_cols = terr_cols = []
196. 
197.     else:
198.         # I don't want to empty the original one when using `pop` below
199.         err_specs = copy.deepcopy(err_specs)
200. 
201.         serr_cols = err_specs.pop("serr", [])
202.         terr_cols = err_specs.pop("terr", [])
203. 
204.     if names is not None:
205.         all_error_cols = len(serr_cols) + len(terr_cols) * 2
206.         if all_error_cols + len(names) != ncols:
207.             raise ValueError("Inconsistent number of input colnames")
208. 
209.     shift = 0
210.     for i in range(ncols):
211.         col_num = i + 1 - shift
212.         if colnames[i] != "":
213.             continue
214. 
215.         colname_root = f"col{col_num}"
216. 
217.         if names is not None:
218.             colname_root = names[col_num - 1]
219. 
220.         colnames[i] = f"{colname_root}"
221.         if col_num in serr_cols:
222.             colnames[i + 1] = f"{colname_root}_err"
223.             shift += 1
224.             continue
225. 
226.         if col_num in terr_cols:
227.             colnames[i + 1] = f"{colname_root}_perr"
228.             colnames[i + 2] = f"{colname_root}_nerr"
229.             shift += 2
230.             continue
231. 
232.     assert not np.any([c == "" for c in colnames])
233. 
234.     return colnames
235. 
236. 
237. def _get_tables_from_qdp_file(qdp_file, input_colnames=None, delimiter=None):
238.     """Get all tables from a QDP file.
239. 
240.     Parameters
241.     ----------
242.     qdp_file : str
243.         Input QDP file name
244. 
245.     Other Parameters
246.     ----------------
247.     input_colnames : list of str
248.         Name of data columns (defaults to ['col1', 'col2', ...]), _not_
249.         including error columns.
250.     delimiter : str
251.         Delimiter for the values in the table.
252. 
253.     Returns
254.     -------
255.     list of `~astropy.table.Table`
256.         List containing all the tables present inside the QDP file
257.     """
258.     lines = _get_lines_from_file(qdp_file)
259.     contents, ncol = _get_type_from_list_of_lines(lines, delimiter=delimiter)
260. 
261.     table_list = []
262.     err_specs = {}
263.     colnames = None
264. 
265.     comment_text = ""
266.     initial_comments = ""
267.     command_lines = ""
268.     current_rows = None
269. 
270.     for line, datatype in zip(lines, contents):
271.         line = line.strip().lstrip("!")
272.         # Is this a comment?
273.         if datatype == "comment":
274.             comment_text += line + "\n"
275.             continue
276. 
277.         if datatype == "command":
278.             # The first time I find commands, I save whatever comments into
279.             # The initial comments.
280.             if command_lines == "":
281.                 initial_comments = comment_text
282.                 comment_text = ""
283. 
284.             if err_specs != {}:
285.                 warnings.warn(
286.                     "This file contains multiple command blocks. Please verify",
287.                     AstropyUserWarning,
288.                 )
289.             command_lines += line + "\n"
290.             continue
291. 
292.         if datatype.startswith("data"):
293.             # The first time I find data, I define err_specs
294.             if err_specs == {} and command_lines != "":
295.                 for cline in command_lines.strip().split("\n"):
296.                     command = cline.strip().split()
297.                     # This should never happen, but just in case.
298.                     if len(command) < 3:
299.                         continue
300.                     err_specs[command[1].lower()] = [int(c) for c in command[2:]]
301.             if colnames is None:
302.                 colnames = _interpret_err_lines(err_specs, ncol, names=input_colnames)
303. 
304.             if current_rows is None:
305.                 current_rows = []
306. 
307.             values = []
308.             for v in line.split(delimiter):
309.                 if v == "NO":
310.                     values.append(np.ma.masked)
311.                 else:
312.                     # Understand if number is int or float
313.                     try:
314.                         values.append(int(v))
315.                     except ValueError:
316.                         values.append(float(v))
317.             current_rows.append(values)
318.             continue
319. 
320.         if datatype == "new":
321.             # Save table to table_list and reset
322.             if current_rows is not None:
323.                 new_table = Table(names=colnames, rows=current_rows)
324.                 new_table.meta["initial_comments"] = initial_comments.strip().split(
325.                     "\n"
326.                 )
327.                 new_table.meta["comments"] = comment_text.strip().split("\n")
328.                 # Reset comments
329.                 comment_text = ""
330.                 table_list.append(new_table)
331.                 current_rows = None
332.             continue
333. 
334.     # At the very end, if there is still a table being written, let's save
335.     # it to the table_list
336.     if current_rows is not None:
337.         new_table = Table(names=colnames, rows=current_rows)
338.         new_table.meta["initial_comments"] = initial_comments.strip().split("\n")
339.         new_table.meta["comments"] = comment_text.strip().split("\n")
340.         table_list.append(new_table)
341. 
342.     return table_list
343. 
344. 
345. def _understand_err_col(colnames):
346.     """Get which column names are error columns.
347. 
348.     Examples
349.     --------
350.     >>> colnames = ['a', 'a_err', 'b', 'b_perr', 'b_nerr']
351.     >>> serr, terr = _understand_err_col(colnames)
352.     >>> np.allclose(serr, [1])
353.     True
354.     >>> np.allclose(terr, [2])
355.     True
356.     >>> serr, terr = _understand_err_col(['a', 'a_nerr'])
357.     Traceback (most recent call last):
358.     ...
359.     ValueError: Missing positive error...
360.     >>> serr, terr = _understand_err_col(['a', 'a_perr'])
361.     Traceback (most recent call last):
362.     ...
363.     ValueError: Missing negative error...
364.     """
365.     shift = 0
366.     serr = []
367.     terr = []
368. 
369.     for i, col in enumerate(colnames):
370.         if col.endswith("_err"):
371.             # The previous column, but they're numbered from 1!
372.             # Plus, take shift into account
373.             serr.append(i - shift)
374.             shift += 1
375.         elif col.endswith("_perr"):
376.             terr.append(i - shift)
377.             if len(colnames) == i + 1 or not colnames[i + 1].endswith("_nerr"):
378.                 raise ValueError("Missing negative error")
379.             shift += 2
380.         elif col.endswith("_nerr") and not colnames[i - 1].endswith("_perr"):
381.             raise ValueError("Missing positive error")
382.     return serr, terr
383. 
384. 
385. def _read_table_qdp(qdp_file, names=None, table_id=None, delimiter=None):
386.     """Read a table from a QDP file.
387. 
388.     Parameters
389.     ----------
390.     qdp_file : str
391.         Input QDP file name
392. 
393.     Other Parameters
394.     ----------------
395.     names : list of str
396.         Name of data columns (defaults to ['col1', 'col2', ...]), _not_
397.         including error columns.
398. 
399.     table_id : int, default 0
400.         Number of the table to be read from the QDP file. This is useful
401.         when multiple tables present in the file. By default, the first is read.
402. 
403.     delimiter : str
404.         Any delimiter accepted by the `sep` argument of str.split()
405. 
406.     Returns
407.     -------
408.     tables : list of `~astropy.table.Table`
409.         List containing all the tables present inside the QDP file
410.     """
411.     if table_id is None:
412.         warnings.warn(
413.             "table_id not specified. Reading the first available table",
414.             AstropyUserWarning,
415.         )
416.         table_id = 0
417. 
418.     tables = _get_tables_from_qdp_file(
419.         qdp_file, input_colnames=names, delimiter=delimiter
420.     )
421. 
422.     return tables[table_id]
423. 
424. 
425. def _write_table_qdp(table, filename=None, err_specs=None):
426.     """Write a table to a QDP file.
427. 
428.     Parameters
429.     ----------
430.     table : :class:`~astropy.table.Table`
431.         Input table to be written
432.     filename : str
433.         Output QDP file name
434. 
435.     Other Parameters
436.     ----------------
437.     err_specs : dict
438.         Dictionary of the format {'serr': [1], 'terr': [2, 3]}, specifying
439.         which columns have symmetric and two-sided errors (see QDP format
440.         specification)
441.     """
442.     import io
443. 
444.     fobj = io.StringIO()
445. 
446.     if "initial_comments" in table.meta and table.meta["initial_comments"] != []:
447.         for line in table.meta["initial_comments"]:
448.             line = line.strip()
449.             if not line.startswith("!"):
450.                 line = "!" + line
451.             print(line, file=fobj)
452. 
453.     if err_specs is None:
454.         serr_cols, terr_cols = _understand_err_col(table.colnames)
455.     else:
456.         serr_cols = err_specs.pop("serr", [])
457.         terr_cols = err_specs.pop("terr", [])
458.     if serr_cols != []:
459.         col_string = " ".join([str(val) for val in serr_cols])
460.         print(f"READ SERR {col_string}", file=fobj)
461.     if terr_cols != []:
462.         col_string = " ".join([str(val) for val in terr_cols])
463.         print(f"READ TERR {col_string}", file=fobj)
464. 
465.     if "comments" in table.meta and table.meta["comments"] != []:
466.         for line in table.meta["comments"]:
467.             line = line.strip()
468.             if not line.startswith("!"):
469.                 line = "!" + line
470.             print(line, file=fobj)
471. 
472.     colnames = table.colnames
473.     print("!" + " ".join(colnames), file=fobj)
474.     for row in table:
475.         values = []
476.         for val in row:
477.             if not np.ma.is_masked(val):
478.                 rep = str(val)
479.             else:
480.                 rep = "NO"
481.             values.append(rep)
482.         print(" ".join(values), file=fobj)
483. 
484.     full_string = fobj.getvalue()
485.     fobj.close()
486. 
487.     if filename is not None:
488.         with open(filename, "w") as fobj:
489.             print(full_string, file=fobj)
490. 
491.     return full_string.split("\n")
492. 
493. 
494. class QDPSplitter(core.DefaultSplitter):
495.     """
496.     Split on space for QDP tables.
497.     """
498. 
499.     delimiter = " "
500.


File: astropy/io/ascii/tests/test_qdp.py
Line number range: 1 - 247
Content:
1. import numpy as np
2. import pytest
3. 
4. from astropy.io import ascii
5. from astropy.io.ascii.qdp import _get_lines_from_file, _read_table_qdp, _write_table_qdp
6. from astropy.table import Column, MaskedColumn, Table
7. from astropy.utils.exceptions import AstropyUserWarning
8. 
9. 
10. def test_get_tables_from_qdp_file(tmp_path):
11.     example_qdp = """
12.     ! Swift/XRT hardness ratio of trigger: XXXX, name: BUBU X-2
13.     ! Columns are as labelled
14.     READ TERR 1
15.     READ SERR 2
16.     ! WT -- hard data
17.     !MJD            Err (pos)       Err(neg)        Rate            Error
18.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.212439       0.212439
19.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        0.000000
20.     NO NO NO NO NO
21.     ! WT -- soft data
22.     !MJD            Err (pos)       Err(neg)        Rate            Error
23.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   0.726155        0.583890
24.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   2.410935        1.393592
25.     NO NO NO NO NO
26.     ! WT -- hardness ratio
27.     !MJD            Err (pos)       Err(neg)        Rate            Error
28.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.292553       -0.374935
29.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        -nan
30.     """
31. 
32.     path = tmp_path / "test.qdp"
33. 
34.     with open(path, "w") as fp:
35.         print(example_qdp, file=fp)
36. 
37.     table0 = _read_table_qdp(fp.name, names=["MJD", "Rate"], table_id=0)
38.     assert table0.meta["initial_comments"][0].startswith("Swift")
39.     assert table0.meta["comments"][0].startswith("WT -- hard data")
40.     table2 = _read_table_qdp(fp.name, names=["MJD", "Rate"], table_id=2)
41.     assert table2.meta["initial_comments"][0].startswith("Swift")
42.     assert table2.meta["comments"][0].startswith("WT -- hardness")
43.     assert np.isclose(table2["MJD_nerr"][0], -2.37847222222222e-05)
44. 
45. 
46. def test_roundtrip(tmp_path):
47.     example_qdp = """
48.     ! Swift/XRT hardness ratio of trigger: XXXX, name: BUBU X-2
49.     ! Columns are as labelled
50.     READ TERR 1
51.     READ SERR 2
52.     ! WT -- hard data
53.     !MJD            Err (pos)       Err(neg)        Rate            Error
54.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   NO       0.212439
55.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        0.000000
56.     NO NO NO NO NO
57.     ! WT -- soft data
58.     !MJD            Err (pos)       Err(neg)        Rate            Error
59.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   0.726155        0.583890
60.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   2.410935        1.393592
61.     NO NO NO NO NO
62.     ! WT -- hardness ratio
63.     !MJD            Err (pos)       Err(neg)        Rate            Error
64.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.292553       -0.374935
65.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        NO
66.     ! Add command, just to raise the warning.
67.     READ TERR 1
68.     ! WT -- whatever
69.     !MJD            Err (pos)       Err(neg)        Rate            Error
70.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.292553       -0.374935
71.     NO 1.14467592592593e-05    -1.14467592592593e-05   0.000000        NO
72.     """
73. 
74.     path = str(tmp_path / "test.qdp")
75.     path2 = str(tmp_path / "test2.qdp")
76. 
77.     with open(path, "w") as fp:
78.         print(example_qdp, file=fp)
79.     with pytest.warns(AstropyUserWarning) as record:
80.         table = _read_table_qdp(path, names=["MJD", "Rate"], table_id=0)
81.     assert np.any(
82.         [
83.             "This file contains multiple command blocks" in r.message.args[0]
84.             for r in record
85.         ]
86.     )
87. 
88.     _write_table_qdp(table, path2)
89. 
90.     new_table = _read_table_qdp(path2, names=["MJD", "Rate"], table_id=0)
91. 
92.     for col in new_table.colnames:
93.         is_masked = np.array([np.ma.is_masked(val) for val in new_table[col]])
94.         if np.any(is_masked):
95.             # All NaN values are read as such.
96.             assert np.ma.is_masked(table[col][is_masked])
97. 
98.         is_nan = np.array(
99.             [(not np.ma.is_masked(val) and np.isnan(val)) for val in new_table[col]]
100.         )
101.         # All non-NaN values are the same
102.         assert np.allclose(new_table[col][~is_nan], table[col][~is_nan])
103.         if np.any(is_nan):
104.             # All NaN values are read as such.
105.             assert np.isnan(table[col][is_nan])
106.     assert np.allclose(new_table["MJD_perr"], [2.378472e-05, 1.1446759e-05])
107. 
108.     for meta_name in ["initial_comments", "comments"]:
109.         assert meta_name in new_table.meta
110. 
111. 
112. def test_read_example():
113.     example_qdp = """
114.         ! Initial comment line 1
115.         ! Initial comment line 2
116.         READ TERR 1
117.         READ SERR 3
118.         ! Table 0 comment
119.         !a a(pos) a(neg) b c ce d
120.         53000.5   0.25  -0.5   1  1.5  3.5 2
121.         54000.5   1.25  -1.5   2  2.5  4.5 3
122.         NO NO NO NO NO
123.         ! Table 1 comment
124.         !a a(pos) a(neg) b c ce d
125.         54000.5   2.25  -2.5   NO  3.5  5.5 5
126.         55000.5   3.25  -3.5   4  4.5  6.5 nan
127.         """
128.     dat = ascii.read(example_qdp, format="qdp", table_id=1, names=["a", "b", "c", "d"])
129.     t = Table.read(
130.         example_qdp, format="ascii.qdp", table_id=1, names=["a", "b", "c", "d"]
131.     )
132. 
133.     assert np.allclose(t["a"], [54000, 55000])
134.     assert t["c_err"][0] == 5.5
135.     assert np.ma.is_masked(t["b"][0])
136.     assert np.isnan(t["d"][1])
137. 
138.     for col1, col2 in zip(t.itercols(), dat.itercols()):
139.         assert np.allclose(col1, col2, equal_nan=True)
140. 
141. 
142. def test_roundtrip_example(tmp_path):
143.     example_qdp = """
144.         ! Initial comment line 1
145.         ! Initial comment line 2
146.         READ TERR 1
147.         READ SERR 3
148.         ! Table 0 comment
149.         !a a(pos) a(neg) b c ce d
150.         53000.5   0.25  -0.5   1  1.5  3.5 2
151.         54000.5   1.25  -1.5   2  2.5  4.5 3
152.         NO NO NO NO NO
153.         ! Table 1 comment
154.         !a a(pos) a(neg) b c ce d
155.         54000.5   2.25  -2.5   NO  3.5  5.5 5
156.         55000.5   3.25  -3.5   4  4.5  6.5 nan
157.         """
158.     test_file = tmp_path / "test.qdp"
159. 
160.     t = Table.read(
161.         example_qdp, format="ascii.qdp", table_id=1, names=["a", "b", "c", "d"]
162.     )
163.     t.write(test_file, err_specs={"terr": [1], "serr": [3]})
164.     t2 = Table.read(test_file, names=["a", "b", "c", "d"], table_id=0)
165. 
166.     for col1, col2 in zip(t.itercols(), t2.itercols()):
167.         assert np.allclose(col1, col2, equal_nan=True)
168. 
169. 
170. def test_roundtrip_example_comma(tmp_path):
171.     example_qdp = """
172.         ! Initial comment line 1
173.         ! Initial comment line 2
174.         READ TERR 1
175.         READ SERR 3
176.         ! Table 0 comment
177.         !a,a(pos),a(neg),b,c,ce,d
178.         53000.5,0.25,-0.5,1,1.5,3.5,2
179.         54000.5,1.25,-1.5,2,2.5,4.5,3
180.         NO,NO,NO,NO,NO
181.         ! Table 1 comment
182.         !a,a(pos),a(neg),b,c,ce,d
183.         54000.5,2.25,-2.5,NO,3.5,5.5,5
184.         55000.5,3.25,-3.5,4,4.5,6.5,nan
185.         """
186.     test_file = tmp_path / "test.qdp"
187. 
188.     t = Table.read(
189.         example_qdp, format="ascii.qdp", table_id=1, names=["a", "b", "c", "d"], sep=","
190.     )
191.     t.write(test_file, err_specs={"terr": [1], "serr": [3]})
192.     t2 = Table.read(test_file, names=["a", "b", "c", "d"], table_id=0)
193. 
194.     # t.values_equal(t2)
195.     for col1, col2 in zip(t.itercols(), t2.itercols()):
196.         assert np.allclose(col1, col2, equal_nan=True)
197. 
198. 
199. def test_read_write_simple(tmp_path):
200.     test_file = tmp_path / "test.qdp"
201.     t1 = Table()
202.     t1.add_column(Column(name="a", data=[1, 2, 3, 4]))
203.     t1.add_column(
204.         MaskedColumn(
205.             data=[4.0, np.nan, 3.0, 1.0], name="b", mask=[False, False, False, True]
206.         )
207.     )
208.     t1.write(test_file, format="ascii.qdp")
209.     with pytest.warns(UserWarning) as record:
210.         t2 = Table.read(test_file, format="ascii.qdp")
211.     assert np.any(
212.         [
213.             "table_id not specified. Reading the first available table"
214.             in r.message.args[0]
215.             for r in record
216.         ]
217.     )
218. 
219.     assert np.allclose(t2["col1"], t1["a"])
220.     assert np.all(t2["col1"] == t1["a"])
221. 
222.     good = ~np.isnan(t1["b"])
223.     assert np.allclose(t2["col2"][good], t1["b"][good])
224. 
225. 
226. def test_read_write_simple_specify_name(tmp_path):
227.     test_file = tmp_path / "test.qdp"
228.     t1 = Table()
229.     t1.add_column(Column(name="a", data=[1, 2, 3]))
230.     # Give a non-None err_specs
231.     t1.write(test_file, format="ascii.qdp")
232.     t2 = Table.read(test_file, table_id=0, format="ascii.qdp", names=["a"])
233.     assert np.all(t2["a"] == t1["a"])
234. 
235. 
236. def test_get_lines_from_qdp(tmp_path):
237.     test_file = str(tmp_path / "test.qdp")
238.     text_string = "A\nB"
239.     text_output = _get_lines_from_file(text_string)
240.     with open(test_file, "w") as fobj:
241.         print(text_string, file=fobj)
242.     file_output = _get_lines_from_file(test_file)
243.     list_output = _get_lines_from_file(["A", "B"])
244.     for i, line in enumerate(["A", "B"]):
245.         assert file_output[i] == line
246.         assert list_output[i] == line
247.         assert text_output[i] == line

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 11:53:54,917 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of the file `astropy/io/ascii/qdp.py`. This context block includes the entire file content as provided.', relative_path='astropy/io/ascii/qdp.py', start_line=1, end_line=500), ContextOutput(reasoning='The user requested the full content of the file `astropy/io/ascii/tests/test_qdp.py`. This context block includes the entire file content as provided.', relative_path='astropy/io/ascii/tests/test_qdp.py', start_line=1, end_line=247)]
2025-12-23 11:53:54,919 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of `astropy/io/ascii/tests/test_qdp.py` and `astropy/io/ascii/qdp.py`.
2025-12-23 11:53:54,919 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 11:53:54,919 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 11:53:54,919 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 0 existing contexts
2025-12-23 11:53:54,919 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-23 11:53:54,920 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .devcontainer
|   └── welcome-message.txt
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yaml
|   |   ├── config.yml
|   |   └── feature_request.yaml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── labeler.yml
|   └── workflows
|       ├── check_changelog.yml
|       ├── ci_cron_daily.yml
|       ├── ci_cron_weekly.yml
|       ├── ci_workflows.yml
|       ├── codeql-analysis.yml
|       ├── open_actions.yml
|       ├── publish.yml
|       ├── stalebot.yml
|       └── update_iers.yml
├── .pre-commit-config.yaml
├── .pyinstaller
|   ├── hooks
|   |   └── hook-skyfield.py
|   └── run_astropy_tests.py
├── .readthedocs.yaml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── LICENSE.rst
├── README.rst
├── astropy
|   ├── __init__.py
|   ├── _dev
|   |   ├── __init__.py
|   |   └── scm_version.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── astropyconst40.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── codata2018.py
|   |   ├── config.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_prior_version.py
|   |   |   └── test_sciencestate.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── convolve.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_formats.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── equatorial.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hadec.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── icrs_observed_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── itrs_observed_transforms.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── erfa_astrom.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── jparser.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── sky_coordinate_parsers.py
|   |   ├── solar_system.py
|   |   ├── spectral_coordinate.py
|   |   ├── spectral_quantity.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── generate_spectralcoord_ref.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── data
|   |   |   ├── helper.py
|   |   |   ├── test_angle_generators.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_earth_orientation.py
|   |   |   ├── test_erfa_astrom.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_geodetic_representations.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_icrs_observed_transformations.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_spectral_coordinate.py
|   |   |   ├── test_spectral_quantity.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_utils.py
|   |   |   └── test_velocity_corrs.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── connect.py
|   |   ├── core.py
|   |   ├── data
|   |   ├── flrw
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── lambdacdm.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── conftest.py
|   |   |   |   ├── data
|   |   |   |   ├── test_base.py
|   |   |   |   ├── test_init.py
|   |   |   |   ├── test_lambdacdm.py
|   |   |   |   ├── test_w.py
|   |   |   |   ├── test_w0cdm.py
|   |   |   |   ├── test_w0wacdm.py
|   |   |   |   ├── test_w0wzcdm.py
|   |   |   |   └── test_wpwazpcdm.py
|   |   |   ├── w0cdm.py
|   |   |   ├── w0wacdm.py
|   |   |   ├── w0wzcdm.py
|   |   |   └── wpwazpcdm.py
|   |   ├── funcs
|   |   |   ├── __init__.py
|   |   |   ├── comparison.py
|   |   |   ├── optimize.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_comparison.py
|   |   |       └── test_funcs.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── cosmology.py
|   |   |   ├── ecsv.py
|   |   |   ├── html.py
|   |   |   ├── mapping.py
|   |   |   ├── model.py
|   |   |   ├── row.py
|   |   |   ├── table.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── test_.py
|   |   |   |   ├── test_cosmology.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_json.py
|   |   |   |   ├── test_mapping.py
|   |   |   |   ├── test_model.py
|   |   |   |   ├── test_row.py
|   |   |   |   ├── test_table.py
|   |   |   |   └── test_yaml.py
|   |   |   ├── utils.py
|   |   |   └── yaml.py
|   |   ├── parameter.py
|   |   ├── parameters.py
|   |   ├── realizations.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── conftest.py
|   |   |   ├── helper.py
|   |   |   ├── test_connect.py
|   |   |   ├── test_core.py
|   |   |   ├── test_parameter.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_realizations.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   ├── units.py
|   |   └── utils.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── _strptime.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── jquery
|   |   |   ├── __init__.py
|   |   |   └── data
|   |   |       ├── css
|   |   |       ├── images
|   |   |       └── js
|   |   └── ply
|   |       ├── __init__.py
|   |       ├── cpp.py
|   |       ├── ctokens.py
|   |       ├── lex.py
|   |       ├── yacc.py
|   |       └── ygen.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── docs.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── mrt.py
|   |   |   ├── qdp.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── data
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_qdp.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── _tiled_compression
|   |   |   |   ├── __init__.py
|   |   |   |   ├── codecs.py
|   |   |   |   ├── quantization.py
|   |   |   |   ├── setup_package.py
|   |   |   |   ├── src
|   |   |   |   ├── tests
|   |   |   |   ├── tiled_compression.py
|   |   |   |   └── utils.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── conftest.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_fsspec.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_image_dask.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_tilde_path.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── conftest.py
|   |   |   |   ├── connect.py
|   |   |   |   ├── data
|   |   |   |   ├── deprecation.py
|   |   |   |   ├── extension.py
|   |   |   |   ├── tags
|   |   |   |   ├── tests
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pandas
|   |   |   |   ├── __init__.py
|   |   |   |   └── connect.py
|   |   |   ├── parquet.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pandas.py
|   |   |   |   ├── test_parquet.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── compat.py
|   |   |   ├── core.py
|   |   |   ├── interface.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_registries.py
|   |   |       └── test_registry_help.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── mixin_columns.py
|   |   |   └── safeio.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   └── result.py
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── bounding_box.py
|   |   ├── convolution.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── math_functions.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── physical_models.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── spline.py
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── __init__.py
|   |   |   |   └── spec.txt
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_bounding_box.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_convolution.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_math_func.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_physical_models.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_spline.py
|   |   |   ├── test_statistics.py
|   |   |   ├── test_units_mapping.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── _testing.py
|   |   ├── bitmask.py
|   |   ├── blocks.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_bitmask.py
|   |   |   ├── test_blocks.py
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── bls
|   |   |   └── __init__.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   └── __init__.py
|   |   ├── setup_package.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   ├── src
|   |   |   ├── compute_bounds.c
|   |   |   ├── fast_sigma_clip.c
|   |   |   └── wirth_select.c
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── connect.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── dask.py
|   |   |   ├── registry.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_dask.py
|   |   |       └── test_registry.py
|   |   ├── ndarray_mixin.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── soco.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── figures
|   |   |   ├── __init__.py
|   |   |   └── helpers.py
|   |   ├── helper.py
|   |   ├── runner.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── parse_times.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_custom_formats.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_fast_parser.py
|   |   |   ├── test_functions.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   ├── test_update_leap_seconds.py
|   |   |   └── test_ut1.py
|   |   ├── time_helper
|   |   |   ├── __init__.py
|   |   |   └── function_helpers.py
|   |   └── utils.py
|   ├── timeseries
|   |   ├── __init__.py
|   |   ├── binned.py
|   |   ├── core.py
|   |   ├── downsample.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── kepler.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_kepler.py
|   |   ├── periodograms
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── bls
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core.py
|   |   |   |   ├── methods.py
|   |   |   |   ├── setup_package.py
|   |   |   |   └── tests
|   |   |   └── lombscargle
|   |   |       ├── __init__.py
|   |   |       ├── _statistics.py
|   |   |       ├── core.py
|   |   |       ├── implementations
|   |   |       ├── tests
|   |   |       └── utils.py
|   |   ├── sampled.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       ├── test_binned.py
|   |       ├── test_common.py
|   |       ├── test_downsample.py
|   |       └── test_sampled.py
|   ├── uncertainty
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── distributions.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_containers.py
|   |       └── test_distribution.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── _typing.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── misc.py
|   |   ├── photometric.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper
|   |   |   ├── __init__.py
|   |   |   ├── converters.py
|   |   |   ├── erfa.py
|   |   |   ├── function_helpers.py
|   |   |   ├── helpers.py
|   |   |   └── scipy_special.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── structured.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_aliases.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_photometric.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_annotations.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_helpers.py
|   |   |   ├── test_quantity_info.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_typing.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   ├── test_structured.py
|   |   |   ├── test_structured_erfa_ufuncs.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpycompat.py
|   |   |   └── optional_deps.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── diff.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── update_builtin_iers.sh
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── data
|   |   |       ├── test_iers.py
|   |   |       └── test_leap_second.py
|   |   ├── introspection.py
|   |   ├── masked
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── function_helpers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_containers.py
|   |   |       ├── test_function_helpers.py
|   |   |       ├── test_functions.py
|   |   |       ├── test_masked.py
|   |   |       └── test_table.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── parsing.py
|   |   ├── setup_package.py
|   |   ├── shapes.py
|   |   ├── src
|   |   |   └── compiler.c
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── dataurl
|   |   |   |   ├── dataurl_mirror
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_diff.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_parsing.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_shapes.py
|   |   |   ├── test_state.py
|   |   |   └── test_xml.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── version.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   ├── test_time.py
|   |   |   └── test_units.py
|   |   ├── time.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── helpers.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_grid_paths.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   ├── test_utils.py
|   |       |   └── test_wcsapi.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       ├── utils.py
|   |       └── wcsapi.py
|   └── wcs
|       ├── __init__.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_auxprm_wrap.c
|       |   ├── wcslib_celprm_wrap.c
|       |   ├── wcslib_prjprm_wrap.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   ├── wcslib_wrap.c
|       |   └── wcslib_wtbarr_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   ├── maps
|       |   |   ├── spectra
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   ├── validate.6.txt
|       |   |   ├── validate.7.4.txt
|       |   |   ├── validate.7.6.txt
|       |   |   └── validate.txt
|       |   ├── helper.py
|       |   ├── test_auxprm.py
|       |   ├── test_celprm.py
|       |   ├── test_pickle.py
|       |   ├── test_prjprm.py
|       |   ├── test_profiling.py
|       |   ├── test_tab.py
|       |   ├── test_tabprm.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   ├── test_wcsprm.py
|       |   └── test_wtbarr.py
|       ├── utils.py
|       ├── wcs.py
|       ├── wcsapi
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   └── ucds.txt
|       |   ├── fitswcs.py
|       |   ├── high_level_api.py
|       |   ├── high_level_wcs_wrapper.py
|       |   ├── low_level_api.py
|       |   ├── sliced_low_level_wcs.py
|       |   ├── tests
|       |   |   ├── __init__.py
|       |   |   ├── test_fitswcs.py
|       |   |   ├── test_high_level_api.py
|       |   |   ├── test_high_level_wcs_wrapper.py
|       |   |   ├── test_low_level_api.py
|       |   |   └── test_utils.py
|       |   ├── utils.py
|       |   └── wrappers
|       |       ├── __init__.py
|       |       ├── base.py
|       |       ├── sliced_wcs.py
|       |       └── tests
|       └── wcslint.py
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.rst
|   |   ├── docs
|   |   |   └── changes.txt
|   |   └── lib
|   |       ├── fits_hcompress.c
|   |       ├── fits_hdecompress.c
|   |       ├── pliocomp.c
|   |       ├── quantize.c
|   |       └── ricecomp.c
|   ├── expat
|   |   ├── README.md
|   |   ├── README.txt
|   |   └── lib
|   |       ├── xmlparse.c
|   |       ├── xmlrole.c
|   |       ├── xmltok.c
|   |       ├── xmltok_impl.c
|   |       └── xmltok_ns.c
|   ├── trim_cfitsio.sh
|   ├── trim_expat.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── codecov.yml
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── _templates
|   |   └── layout.html
|   ├── changelog.rst
|   ├── changes
|   |   ├── 13985.other.rst
|   |   ├── 14252.other.rst
|   |   ├── 14311.other.rst
|   |   ├── 14321.other.rst
|   |   ├── 14349.other.rst
|   |   ├── 14517.other.rst
|   |   ├── README.rst
|   |   ├── config
|   |   ├── constants
|   |   ├── convolution
|   |   ├── coordinates
|   |   |   ├── 13993.feature.rst
|   |   |   ├── 14354.api.rst
|   |   |   ├── 14371.feature.rst
|   |   |   └── 14628.feature.rst
|   |   ├── cosmology
|   |   |   └── 12353.feature.rst
|   |   ├── extern
|   |   ├── io.ascii
|   |   |   └── 14182.feature.rst
|   |   ├── io.fits
|   |   |   ├── 14252.bugfix.rst
|   |   |   ├── 14252.feature.rst
|   |   |   ├── 14353.feature.rst
|   |   |   ├── 14408.feature.rst
|   |   |   ├── 14410.api.rst
|   |   |   ├── 14428.api.rst
|   |   |   ├── 14428.feature.rst
|   |   |   ├── 14508.bugfix.rst
|   |   |   └── 14528.bugfix.rst
|   |   ├── io.misc
|   |   |   └── 14237.feature.rst
|   |   ├── io.registry
|   |   ├── io.votable
|   |   |   ├── 14212.feature.rst
|   |   |   └── 14554.feature.rst
|   |   ├── modeling
|   |   |   ├── 14013.api.rst
|   |   |   ├── 14037.feature.rst
|   |   |   ├── 14038.api.rst
|   |   |   └── 14519.api.rst
|   |   ├── nddata
|   |   |   └── 14175.feature.rst
|   |   ├── samp
|   |   ├── stats
|   |   ├── table
|   |   |   └── 14187.feature.rst
|   |   ├── template.rst
|   |   ├── tests
|   |   ├── time
|   |   |   ├── 14566.bugfix.rst
|   |   |   └── 14606.feature.rst
|   |   ├── timeseries
|   |   |   └── 14294.feature.rst
|   |   ├── uncertainty
|   |   |   └── 14421.bugfix.rst
|   |   ├── units
|   |   |   ├── 13977.bugfix.rst
|   |   |   ├── 14042.feature.rst
|   |   |   ├── 14124.api.rst
|   |   |   ├── 14135.feature.rst
|   |   |   ├── 14163.bugfix.rst
|   |   |   ├── 14253.api.rst
|   |   |   ├── 14267.api.rst
|   |   |   ├── 14407.feature.rst
|   |   |   ├── 14413.bugfix.rst
|   |   |   ├── 14417.api.rst
|   |   |   ├── 14419.bugfix.rst
|   |   |   ├── 14439.api.rst
|   |   |   ├── 14449.feature.rst
|   |   |   └── 14635.bugfix.rst
|   |   ├── utils
|   |   |   ├── 13730.bugfix.rst
|   |   |   ├── 14341.feature.rst
|   |   |   ├── 14382.feature.rst
|   |   |   ├── 14590.api.rst
|   |   |   └── 14624.bugfix.rst
|   |   ├── visualization
|   |   |   ├── 13989.api.rst
|   |   |   ├── 13989.bugfix.rst
|   |   |   ├── 14050.api.rst
|   |   |   ├── 14251.bugfix.rst
|   |   |   └── 14326.bugfix.rst
|   |   └── wcs
|   |       └── 14295.bugfix.rst
|   ├── common_links.txt
|   ├── conf.py
|   ├── config
|   |   ├── astropy_config.rst
|   |   └── index.rst
|   ├── conftest.py
|   ├── constants
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   ├── performance.inc.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── common_errors.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── performance.inc.rst
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── satellites.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── spectralcoord.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   ├── dev.rst
|   |   ├── index.rst
|   |   ├── io.rst
|   |   └── units.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── style-guide.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   ├── when_to_rebase.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       └── virtual_pythons.rst
|   ├── getting_started.rst
|   ├── glossary.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── ecsv.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── asdf-schemas.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   ├── tiled_compression.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   └── usage
|   |   |       ├── cloud.rst
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       ├── performance.inc.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── lts_policy.rst
|   ├── modeling
|   |   ├── add-units.rst
|   |   ├── compound-models.rst
|   |   ├── example-fitting-constraints.rst
|   |   ├── example-fitting-line.rst
|   |   ├── example-fitting-model-sets.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── jointfitter.rst
|   |   ├── models.rst
|   |   ├── new-fitter.rst
|   |   ├── new-model.rst
|   |   ├── parameters.rst
|   |   ├── performance.rst
|   |   ├── physical_models.rst
|   |   ├── polynomial_models.rst
|   |   ├── powerlaw_models.rst
|   |   ├── predef_models1D.rst
|   |   ├── predef_models2D.rst
|   |   ├── reference_api.rst
|   |   ├── spline_models.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── bitmask.rst
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── examples
|   |   |   └── cutout2d_tofits.py
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── performance.inc.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── robots.txt
|   ├── rtd_environment.yaml
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── performance.inc.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── performance.inc.rst
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── timeseries
|   |   ├── analysis.rst
|   |   ├── bls.rst
|   |   ├── data_access.rst
|   |   ├── index.rst
|   |   ├── initializing.rst
|   |   ├── io.rst
|   |   ├── lombscargle.rst
|   |   ├── masking.rst
|   |   ├── pandas.rst
|   |   └── times.rst
|   ├── uncertainty
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── constants_versions.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── performance.inc.rst
|   |   ├── physical_types.rst
|   |   ├── quantity.rst
|   |   ├── standard_units.rst
|   |   ├── structured_units.rst
|   |   └── type_hints.rst
|   ├── utils
|   |   ├── data.rst
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── masked
|   |       └── index.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── matplotlib_integration.rst
|   |   ├── normalization.rst
|   |   ├── performance.inc.rst
|   |   ├── rgb.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── generic_transforms.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── example_create_imaging.rst
|   |   ├── example_cube_wcs.rst
|   |   ├── examples
|   |   |   ├── cube_wcs.py
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── legacy_interface.rst
|   |   ├── loading_from_fits.rst
|   |   ├── note_sip.rst
|   |   ├── performance.inc.rst
|   |   ├── reference_api.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   ├── relax.rst
|   |   ├── supported_projections.rst
|   |   ├── validation.rst
|   |   ├── wcsapi.rst
|   |   └── wcstools.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       ├── 3.2.rst
|       ├── 4.0.rst
|       ├── 4.1.rst
|       ├── 4.2.rst
|       ├── 4.3.rst
|       ├── 5.0.rst
|       ├── 5.1.rst
|       ├── 5.2.rst
|       ├── 5.3.rst
|       └── index.rst
├── examples
|   ├── README.rst
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── PYTHON.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
└── setup.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: ascii.qdp Table format assumes QDP commands are upper case

Description: ### Description

ascii.qdp assumes that commands in a QDP file are upper case, for example, for errors they must be "READ SERR 1 2" whereas QDP itself is not case sensitive and case use "read serr 1 2". 

As many QDP files are created by hand, the expectation that all commands be all-caps should be removed.

### Expected behavior

The following qdp file should read into a `Table` with errors, rather than crashing.
```
read serr 1 2 
1 0.5 1 0.5
```

### How to Reproduce

Create a QDP file:
```
> cat > test.qdp
read serr 1 2 
1 0.5 1 0.5
<EOF>

 > python
Python 3.10.9 (main, Dec  7 2022, 02:03:23) [Clang 13.0.0 (clang-1300.0.29.30)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from astropy.table import Table
>>> Table.read('test.qdp',format='ascii.qdp')
WARNING: table_id not specified. Reading the first available table [astropy.io.ascii.qdp]
Traceback (most recent call last):
...
    raise ValueError(f'Unrecognized QDP line: {line}')
ValueError: Unrecognized QDP line: read serr 1 2
```

Running "qdp test.qdp" works just fine.


### Versions

Python 3.10.9 (main, Dec  7 2022, 02:03:23) [Clang 13.0.0 (clang-1300.0.29.30)]
astropy 5.1
Numpy 1.24.1
pyerfa 2.0.0.1
Scipy 1.10.0
Matplotlib 3.6.3


Patch information:
diff --git a/astropy/io/ascii/qdp.py b/astropy/io/ascii/qdp.py
index 83a4f004aa..bd801b786d 100644
--- a/astropy/io/ascii/qdp.py
+++ b/astropy/io/ascii/qdp.py
@@ -67,7 +67,7 @@ def _line_type(line, delimiter=None):
         sep = r"\s+"
     _new_re = rf"NO({sep}NO)+"
     _data_re = rf"({_decimal_re}|NO|[-+]?nan)({sep}({_decimal_re}|NO|[-+]?nan))*)"
-    _type_re = rf"^\s*((?P<command>{_command_re})|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
+    _type_re = rf"^\s*((?P<command>(?i:{_command_re}))|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
     _line_type_re = re.compile(_type_re)
     line = line.strip()
     if not line:


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `astropy/io/ascii/tests/test_qdp.py` and `astropy/io/ascii/qdp.py`.
Extra Requirements: 
Purpose: I need the content of the test file to identify relevant test cases and the source file to understand the code being tested.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: astropy/io/ascii/qdp.py
Line number range: 1 - 500
Content:
1. # Licensed under a 3-clause BSD style license - see LICENSE.rst
2. """
3. This package contains functions for reading and writing QDP tables that are
4. not meant to be used directly, but instead are available as readers/writers in
5. `astropy.table`. See :ref:`astropy:table_io` for more details.
6. """
7. import copy
8. import re
9. import warnings
10. from collections.abc import Iterable
11. 
12. import numpy as np
13. 
14. from astropy.table import Table
15. from astropy.utils.exceptions import AstropyUserWarning
16. 
17. from . import basic, core
18. 
19. 
20. def _line_type(line, delimiter=None):
21.     """Interpret a QDP file line.
22. 
23.     Parameters
24.     ----------
25.     line : str
26.         a single line of the file
27. 
28.     Returns
29.     -------
30.     type : str
31.         Line type: "comment", "command", or "data"
32. 
33.     Examples
34.     --------
35.     >>> _line_type("READ SERR 3")
36.     'command'
37.     >>> _line_type(" \\n    !some gibberish")
38.     'comment'
39.     >>> _line_type("   ")
40.     'comment'
41.     >>> _line_type(" 21345.45")
42.     'data,1'
43.     >>> _line_type(" 21345.45 1.53e-3 1e-3 .04 NO nan")
44.     'data,6'
45.     >>> _line_type(" 21345.45,1.53e-3,1e-3,.04,NO,nan", delimiter=',')
46.     'data,6'
47.     >>> _line_type(" 21345.45 ! a comment to disturb")
48.     'data,1'
49.     >>> _line_type("NO NO NO NO NO")
50.     'new'
51.     >>> _line_type("NO,NO,NO,NO,NO", delimiter=',')
52.     'new'
53.     >>> _line_type("N O N NOON OON O")
54.     Traceback (most recent call last):
55.         ...
56.     ValueError: Unrecognized QDP line...
57.     >>> _line_type(" some non-comment gibberish")
58.     Traceback (most recent call last):
59.         ...
60.     ValueError: Unrecognized QDP line...
61.     """
62.     _decimal_re = r"[+-]?(\d+(\.\d*)?|\.\d+)([eE][+-]?\d+)?"
63.     _command_re = r"READ [TS]ERR(\s+[0-9]+)+"
64. 
65.     sep = delimiter
66.     if delimiter is None:
67.         sep = r"\s+"
68.     _new_re = rf"NO({sep}NO)+"
69.     _data_re = rf"({_decimal_re}|NO|[-+]?nan)({sep}({_decimal_re}|NO|[-+]?nan))*)"
70.     _type_re = rf"^\s*((?P<command>{_command_re})|(?P<new>{_new_re})|(?P<data>{_data_re})?\s*(\!(?P<comment>.*))?\s*$"
71.     _line_type_re = re.compile(_type_re)
72.     line = line.strip()
73.     if not line:
74.         return "comment"
75.     match = _line_type_re.match(line)
76. 
77.     if match is None:
78.         raise ValueError(f"Unrecognized QDP line: {line}")
79.     for type_, val in match.groupdict().items():
80.         if val is None:
81.             continue
82.         if type_ == "data":
83.             return f"data,{len(val.split(sep=delimiter))}"
84.         else:
85.             return type_
86. 
87. 
88. def _get_type_from_list_of_lines(lines, delimiter=None):
89.     """Read through the list of QDP file lines and label each line by type.
90. 
91.     Parameters
92.     ----------
93.     lines : list
94.         List containing one file line in each entry
95. 
96.     Returns
97.     -------
98.     contents : list
99.         List containing the type for each line (see `line_type_and_data`)
100.     ncol : int
101.         The number of columns in the data lines. Must be the same throughout
102.         the file
103. 
104.     Examples
105.     --------
106.     >>> line0 = "! A comment"
107.     >>> line1 = "543 12 456.0"
108.     >>> lines = [line0, line1]
109.     >>> types, ncol = _get_type_from_list_of_lines(lines)
110.     >>> types[0]
111.     'comment'
112.     >>> types[1]
113.     'data,3'
114.     >>> ncol
115.     3
116.     >>> lines.append("23")
117.     >>> _get_type_from_list_of_lines(lines)
118.     Traceback (most recent call last):
119.         ...
120.     ValueError: Inconsistent number of columns
121.     """
122.     types = [_line_type(line, delimiter=delimiter) for line in lines]
123.     current_ncol = None
124.     for type_ in types:
125.         if type_.startswith("data,"):
126.             ncol = int(type_[5:])
127.             if current_ncol is None:
128.                 current_ncol = ncol
129.             elif ncol != current_ncol:
130.                 raise ValueError("Inconsistent number of columns")
131. 
132.     return types, current_ncol
133. 
134. 
135. def _get_lines_from_file(qdp_file):
136.     if "\n" in qdp_file:
137.         lines = qdp_file.split("\n")
138.     elif isinstance(qdp_file, str):
139.         with open(qdp_file) as fobj:
140.             lines = [line.strip() for line in fobj.readlines()]
141.     elif isinstance(qdp_file, Iterable):
142.         lines = qdp_file
143.     else:
144.         raise ValueError("invalid value of qdb_file")
145. 
146.     return lines
147. 
148. 
149. def _interpret_err_lines(err_specs, ncols, names=None):
150.     """Give list of column names from the READ SERR and TERR commands.
151. 
152.     Parameters
153.     ----------
154.     err_specs : dict
155.         ``{'serr': [n0, n1, ...], 'terr': [n2, n3, ...]}``
156.         Error specifications for symmetric and two-sided errors
157.     ncols : int
158.         Number of data columns
159. 
160.     Other Parameters
161.     ----------------
162.     names : list of str
163.         Name of data columns (defaults to ['col1', 'col2', ...]), _not_
164.         including error columns.
165. 
166.     Returns
167.     -------
168.     colnames : list
169.         List containing the column names. Error columns will have the name
170.         of the main column plus ``_err`` for symmetric errors, and ``_perr``
171.         and ``_nerr`` for positive and negative errors respectively
172. 
173.     Examples
174.     --------
175.     >>> col_in = ['MJD', 'Rate']
176.     >>> cols = _interpret_err_lines(None, 2, names=col_in)
177.     >>> cols[0]
178.     'MJD'
179.     >>> err_specs = {'terr': [1], 'serr': [2]}
180.     >>> ncols = 5
181.     >>> cols = _interpret_err_lines(err_specs, ncols, names=col_in)
182.     >>> cols[0]
183.     'MJD'
184.     >>> cols[2]
185.     'MJD_nerr'
186.     >>> cols[4]
187.     'Rate_err'
188.     >>> _interpret_err_lines(err_specs, 6, names=col_in)
189.     Traceback (most recent call last):
190.         ...
191.     ValueError: Inconsistent number of input colnames
192.     """
193.     colnames = ["" for i in range(ncols)]
194.     if err_specs is None:
195.         serr_cols = terr_cols = []
196. 
197.     else:
198.         # I don't want to empty the original one when using `pop` below
199.         err_specs = copy.deepcopy(err_specs)
200. 
201.         serr_cols = err_specs.pop("serr", [])
202.         terr_cols = err_specs.pop("terr", [])
203. 
204.     if names is not None:
205.         all_error_cols = len(serr_cols) + len(terr_cols) * 2
206.         if all_error_cols + len(names) != ncols:
207.             raise ValueError("Inconsistent number of input colnames")
208. 
209.     shift = 0
210.     for i in range(ncols):
211.         col_num = i + 1 - shift
212.         if colnames[i] != "":
213.             continue
214. 
215.         colname_root = f"col{col_num}"
216. 
217.         if names is not None:
218.             colname_root = names[col_num - 1]
219. 
220.         colnames[i] = f"{colname_root}"
221.         if col_num in serr_cols:
222.             colnames[i + 1] = f"{colname_root}_err"
223.             shift += 1
224.             continue
225. 
226.         if col_num in terr_cols:
227.             colnames[i + 1] = f"{colname_root}_perr"
228.             colnames[i + 2] = f"{colname_root}_nerr"
229.             shift += 2
230.             continue
231. 
232.     assert not np.any([c == "" for c in colnames])
233. 
234.     return colnames
235. 
236. 
237. def _get_tables_from_qdp_file(qdp_file, input_colnames=None, delimiter=None):
238.     """Get all tables from a QDP file.
239. 
240.     Parameters
241.     ----------
242.     qdp_file : str
243.         Input QDP file name
244. 
245.     Other Parameters
246.     ----------------
247.     input_colnames : list of str
248.         Name of data columns (defaults to ['col1', 'col2', ...]), _not_
249.         including error columns.
250.     delimiter : str
251.         Delimiter for the values in the table.
252. 
253.     Returns
254.     -------
255.     list of `~astropy.table.Table`
256.         List containing all the tables present inside the QDP file
257.     """
258.     lines = _get_lines_from_file(qdp_file)
259.     contents, ncol = _get_type_from_list_of_lines(lines, delimiter=delimiter)
260. 
261.     table_list = []
262.     err_specs = {}
263.     colnames = None
264. 
265.     comment_text = ""
266.     initial_comments = ""
267.     command_lines = ""
268.     current_rows = None
269. 
270.     for line, datatype in zip(lines, contents):
271.         line = line.strip().lstrip("!")
272.         # Is this a comment?
273.         if datatype == "comment":
274.             comment_text += line + "\n"
275.             continue
276. 
277.         if datatype == "command":
278.             # The first time I find commands, I save whatever comments into
279.             # The initial comments.
280.             if command_lines == "":
281.                 initial_comments = comment_text
282.                 comment_text = ""
283. 
284.             if err_specs != {}:
285.                 warnings.warn(
286.                     "This file contains multiple command blocks. Please verify",
287.                     AstropyUserWarning,
288.                 )
289.             command_lines += line + "\n"
290.             continue
291. 
292.         if datatype.startswith("data"):
293.             # The first time I find data, I define err_specs
294.             if err_specs == {} and command_lines != "":
295.                 for cline in command_lines.strip().split("\n"):
296.                     command = cline.strip().split()
297.                     # This should never happen, but just in case.
298.                     if len(command) < 3:
299.                         continue
300.                     err_specs[command[1].lower()] = [int(c) for c in command[2:]]
301.             if colnames is None:
302.                 colnames = _interpret_err_lines(err_specs, ncol, names=input_colnames)
303. 
304.             if current_rows is None:
305.                 current_rows = []
306. 
307.             values = []
308.             for v in line.split(delimiter):
309.                 if v == "NO":
310.                     values.append(np.ma.masked)
311.                 else:
312.                     # Understand if number is int or float
313.                     try:
314.                         values.append(int(v))
315.                     except ValueError:
316.                         values.append(float(v))
317.             current_rows.append(values)
318.             continue
319. 
320.         if datatype == "new":
321.             # Save table to table_list and reset
322.             if current_rows is not None:
323.                 new_table = Table(names=colnames, rows=current_rows)
324.                 new_table.meta["initial_comments"] = initial_comments.strip().split(
325.                     "\n"
326.                 )
327.                 new_table.meta["comments"] = comment_text.strip().split("\n")
328.                 # Reset comments
329.                 comment_text = ""
330.                 table_list.append(new_table)
331.                 current_rows = None
332.             continue
333. 
334.     # At the very end, if there is still a table being written, let's save
335.     # it to the table_list
336.     if current_rows is not None:
337.         new_table = Table(names=colnames, rows=current_rows)
338.         new_table.meta["initial_comments"] = initial_comments.strip().split("\n")
339.         new_table.meta["comments"] = comment_text.strip().split("\n")
340.         table_list.append(new_table)
341. 
342.     return table_list
343. 
344. 
345. def _understand_err_col(colnames):
346.     """Get which column names are error columns.
347. 
348.     Examples
349.     --------
350.     >>> colnames = ['a', 'a_err', 'b', 'b_perr', 'b_nerr']
351.     >>> serr, terr = _understand_err_col(colnames)
352.     >>> np.allclose(serr, [1])
353.     True
354.     >>> np.allclose(terr, [2])
355.     True
356.     >>> serr, terr = _understand_err_col(['a', 'a_nerr'])
357.     Traceback (most recent call last):
358.     ...
359.     ValueError: Missing positive error...
360.     >>> serr, terr = _understand_err_col(['a', 'a_perr'])
361.     Traceback (most recent call last):
362.     ...
363.     ValueError: Missing negative error...
364.     """
365.     shift = 0
366.     serr = []
367.     terr = []
368. 
369.     for i, col in enumerate(colnames):
370.         if col.endswith("_err"):
371.             # The previous column, but they're numbered from 1!
372.             # Plus, take shift into account
373.             serr.append(i - shift)
374.             shift += 1
375.         elif col.endswith("_perr"):
376.             terr.append(i - shift)
377.             if len(colnames) == i + 1 or not colnames[i + 1].endswith("_nerr"):
378.                 raise ValueError("Missing negative error")
379.             shift += 2
380.         elif col.endswith("_nerr") and not colnames[i - 1].endswith("_perr"):
381.             raise ValueError("Missing positive error")
382.     return serr, terr
383. 
384. 
385. def _read_table_qdp(qdp_file, names=None, table_id=None, delimiter=None):
386.     """Read a table from a QDP file.
387. 
388.     Parameters
389.     ----------
390.     qdp_file : str
391.         Input QDP file name
392. 
393.     Other Parameters
394.     ----------------
395.     names : list of str
396.         Name of data columns (defaults to ['col1', 'col2', ...]), _not_
397.         including error columns.
398. 
399.     table_id : int, default 0
400.         Number of the table to be read from the QDP file. This is useful
401.         when multiple tables present in the file. By default, the first is read.
402. 
403.     delimiter : str
404.         Any delimiter accepted by the `sep` argument of str.split()
405. 
406.     Returns
407.     -------
408.     tables : list of `~astropy.table.Table`
409.         List containing all the tables present inside the QDP file
410.     """
411.     if table_id is None:
412.         warnings.warn(
413.             "table_id not specified. Reading the first available table",
414.             AstropyUserWarning,
415.         )
416.         table_id = 0
417. 
418.     tables = _get_tables_from_qdp_file(
419.         qdp_file, input_colnames=names, delimiter=delimiter
420.     )
421. 
422.     return tables[table_id]
423. 
424. 
425. def _write_table_qdp(table, filename=None, err_specs=None):
426.     """Write a table to a QDP file.
427. 
428.     Parameters
429.     ----------
430.     table : :class:`~astropy.table.Table`
431.         Input table to be written
432.     filename : str
433.         Output QDP file name
434. 
435.     Other Parameters
436.     ----------------
437.     err_specs : dict
438.         Dictionary of the format {'serr': [1], 'terr': [2, 3]}, specifying
439.         which columns have symmetric and two-sided errors (see QDP format
440.         specification)
441.     """
442.     import io
443. 
444.     fobj = io.StringIO()
445. 
446.     if "initial_comments" in table.meta and table.meta["initial_comments"] != []:
447.         for line in table.meta["initial_comments"]:
448.             line = line.strip()
449.             if not line.startswith("!"):
450.                 line = "!" + line
451.             print(line, file=fobj)
452. 
453.     if err_specs is None:
454.         serr_cols, terr_cols = _understand_err_col(table.colnames)
455.     else:
456.         serr_cols = err_specs.pop("serr", [])
457.         terr_cols = err_specs.pop("terr", [])
458.     if serr_cols != []:
459.         col_string = " ".join([str(val) for val in serr_cols])
460.         print(f"READ SERR {col_string}", file=fobj)
461.     if terr_cols != []:
462.         col_string = " ".join([str(val) for val in terr_cols])
463.         print(f"READ TERR {col_string}", file=fobj)
464. 
465.     if "comments" in table.meta and table.meta["comments"] != []:
466.         for line in table.meta["comments"]:
467.             line = line.strip()
468.             if not line.startswith("!"):
469.                 line = "!" + line
470.             print(line, file=fobj)
471. 
472.     colnames = table.colnames
473.     print("!" + " ".join(colnames), file=fobj)
474.     for row in table:
475.         values = []
476.         for val in row:
477.             if not np.ma.is_masked(val):
478.                 rep = str(val)
479.             else:
480.                 rep = "NO"
481.             values.append(rep)
482.         print(" ".join(values), file=fobj)
483. 
484.     full_string = fobj.getvalue()
485.     fobj.close()
486. 
487.     if filename is not None:
488.         with open(filename, "w") as fobj:
489.             print(full_string, file=fobj)
490. 
491.     return full_string.split("\n")
492. 
493. 
494. class QDPSplitter(core.DefaultSplitter):
495.     """
496.     Split on space for QDP tables.
497.     """
498. 
499.     delimiter = " "
500. 


File: astropy/io/ascii/tests/test_qdp.py
Line number range: 1 - 247
Content:
1. import numpy as np
2. import pytest
3. 
4. from astropy.io import ascii
5. from astropy.io.ascii.qdp import _get_lines_from_file, _read_table_qdp, _write_table_qdp
6. from astropy.table import Column, MaskedColumn, Table
7. from astropy.utils.exceptions import AstropyUserWarning
8. 
9. 
10. def test_get_tables_from_qdp_file(tmp_path):
11.     example_qdp = """
12.     ! Swift/XRT hardness ratio of trigger: XXXX, name: BUBU X-2
13.     ! Columns are as labelled
14.     READ TERR 1
15.     READ SERR 2
16.     ! WT -- hard data
17.     !MJD            Err (pos)       Err(neg)        Rate            Error
18.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.212439       0.212439
19.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        0.000000
20.     NO NO NO NO NO
21.     ! WT -- soft data
22.     !MJD            Err (pos)       Err(neg)        Rate            Error
23.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   0.726155        0.583890
24.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   2.410935        1.393592
25.     NO NO NO NO NO
26.     ! WT -- hardness ratio
27.     !MJD            Err (pos)       Err(neg)        Rate            Error
28.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.292553       -0.374935
29.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        -nan
30.     """
31. 
32.     path = tmp_path / "test.qdp"
33. 
34.     with open(path, "w") as fp:
35.         print(example_qdp, file=fp)
36. 
37.     table0 = _read_table_qdp(fp.name, names=["MJD", "Rate"], table_id=0)
38.     assert table0.meta["initial_comments"][0].startswith("Swift")
39.     assert table0.meta["comments"][0].startswith("WT -- hard data")
40.     table2 = _read_table_qdp(fp.name, names=["MJD", "Rate"], table_id=2)
41.     assert table2.meta["initial_comments"][0].startswith("Swift")
42.     assert table2.meta["comments"][0].startswith("WT -- hardness")
43.     assert np.isclose(table2["MJD_nerr"][0], -2.37847222222222e-05)
44. 
45. 
46. def test_roundtrip(tmp_path):
47.     example_qdp = """
48.     ! Swift/XRT hardness ratio of trigger: XXXX, name: BUBU X-2
49.     ! Columns are as labelled
50.     READ TERR 1
51.     READ SERR 2
52.     ! WT -- hard data
53.     !MJD            Err (pos)       Err(neg)        Rate            Error
54.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   NO       0.212439
55.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        0.000000
56.     NO NO NO NO NO
57.     ! WT -- soft data
58.     !MJD            Err (pos)       Err(neg)        Rate            Error
59.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   0.726155        0.583890
60.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   2.410935        1.393592
61.     NO NO NO NO NO
62.     ! WT -- hardness ratio
63.     !MJD            Err (pos)       Err(neg)        Rate            Error
64.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.292553       -0.374935
65.     55045.099887 1.14467592592593e-05    -1.14467592592593e-05   0.000000        NO
66.     ! Add command, just to raise the warning.
67.     READ TERR 1
68.     ! WT -- whatever
69.     !MJD            Err (pos)       Err(neg)        Rate            Error
70.     53000.123456 2.37847222222222e-05    -2.37847222222222e-05   -0.292553       -0.374935
71.     NO 1.14467592592593e-05    -1.14467592592593e-05   0.000000        NO
72.     """
73. 
74.     path = str(tmp_path / "test.qdp")
75.     path2 = str(tmp_path / "test2.qdp")
76. 
77.     with open(path, "w") as fp:
78.         print(example_qdp, file=fp)
79.     with pytest.warns(AstropyUserWarning) as record:
80.         table = _read_table_qdp(path, names=["MJD", "Rate"], table_id=0)
81.     assert np.any(
82.         [
83.             "This file contains multiple command blocks" in r.message.args[0]
84.             for r in record
85.         ]
86.     )
87. 
88.     _write_table_qdp(table, path2)
89. 
90.     new_table = _read_table_qdp(path2, names=["MJD", "Rate"], table_id=0)
91. 
92.     for col in new_table.colnames:
93.         is_masked = np.array([np.ma.is_masked(val) for val in new_table[col]])
94.         if np.any(is_masked):
95.             # All NaN values are read as such.
96.             assert np.ma.is_masked(table[col][is_masked])
97. 
98.         is_nan = np.array(
99.             [(not np.ma.is_masked(val) and np.isnan(val)) for val in new_table[col]]
100.         )
101.         # All non-NaN values are the same
102.         assert np.allclose(new_table[col][~is_nan], table[col][~is_nan])
103.         if np.any(is_nan):
104.             # All NaN values are read as such.
105.             assert np.isnan(table[col][is_nan])
106.     assert np.allclose(new_table["MJD_perr"], [2.378472e-05, 1.1446759e-05])
107. 
108.     for meta_name in ["initial_comments", "comments"]:
109.         assert meta_name in new_table.meta
110. 
111. 
112. def test_read_example():
113.     example_qdp = """
114.         ! Initial comment line 1
115.         ! Initial comment line 2
116.         READ TERR 1
117.         READ SERR 3
118.         ! Table 0 comment
119.         !a a(pos) a(neg) b c ce d
120.         53000.5   0.25  -0.5   1  1.5  3.5 2
121.         54000.5   1.25  -1.5   2  2.5  4.5 3
122.         NO NO NO NO NO
123.         ! Table 1 comment
124.         !a a(pos) a(neg) b c ce d
125.         54000.5   2.25  -2.5   NO  3.5  5.5 5
126.         55000.5   3.25  -3.5   4  4.5  6.5 nan
127.         """
128.     dat = ascii.read(example_qdp, format="qdp", table_id=1, names=["a", "b", "c", "d"])
129.     t = Table.read(
130.         example_qdp, format="ascii.qdp", table_id=1, names=["a", "b", "c", "d"]
131.     )
132. 
133.     assert np.allclose(t["a"], [54000, 55000])
134.     assert t["c_err"][0] == 5.5
135.     assert np.ma.is_masked(t["b"][0])
136.     assert np.isnan(t["d"][1])
137. 
138.     for col1, col2 in zip(t.itercols(), dat.itercols()):
139.         assert np.allclose(col1, col2, equal_nan=True)
140. 
141. 
142. def test_roundtrip_example(tmp_path):
143.     example_qdp = """
144.         ! Initial comment line 1
145.         ! Initial comment line 2
146.         READ TERR 1
147.         READ SERR 3
148.         ! Table 0 comment
149.         !a a(pos) a(neg) b c ce d
150.         53000.5   0.25  -0.5   1  1.5  3.5 2
151.         54000.5   1.25  -1.5   2  2.5  4.5 3
152.         NO NO NO NO NO
153.         ! Table 1 comment
154.         !a a(pos) a(neg) b c ce d
155.         54000.5   2.25  -2.5   NO  3.5  5.5 5
156.         55000.5   3.25  -3.5   4  4.5  6.5 nan
157.         """
158.     test_file = tmp_path / "test.qdp"
159. 
160.     t = Table.read(
161.         example_qdp, format="ascii.qdp", table_id=1, names=["a", "b", "c", "d"]
162.     )
163.     t.write(test_file, err_specs={"terr": [1], "serr": [3]})
164.     t2 = Table.read(test_file, names=["a", "b", "c", "d"], table_id=0)
165. 
166.     for col1, col2 in zip(t.itercols(), t2.itercols()):
167.         assert np.allclose(col1, col2, equal_nan=True)
168. 
169. 
170. def test_roundtrip_example_comma(tmp_path):
171.     example_qdp = """
172.         ! Initial comment line 1
173.         ! Initial comment line 2
174.         READ TERR 1
175.         READ SERR 3
176.         ! Table 0 comment
177.         !a,a(pos),a(neg),b,c,ce,d
178.         53000.5,0.25,-0.5,1,1.5,3.5,2
179.         54000.5,1.25,-1.5,2,2.5,4.5,3
180.         NO,NO,NO,NO,NO
181.         ! Table 1 comment
182.         !a,a(pos),a(neg),b,c,ce,d
183.         54000.5,2.25,-2.5,NO,3.5,5.5,5
184.         55000.5,3.25,-3.5,4,4.5,6.5,nan
185.         """
186.     test_file = tmp_path / "test.qdp"
187. 
188.     t = Table.read(
189.         example_qdp, format="ascii.qdp", table_id=1, names=["a", "b", "c", "d"], sep=","
190.     )
191.     t.write(test_file, err_specs={"terr": [1], "serr": [3]})
192.     t2 = Table.read(test_file, names=["a", "b", "c", "d"], table_id=0)
193. 
194.     # t.values_equal(t2)
195.     for col1, col2 in zip(t.itercols(), t2.itercols()):
196.         assert np.allclose(col1, col2, equal_nan=True)
197. 
198. 
199. def test_read_write_simple(tmp_path):
200.     test_file = tmp_path / "test.qdp"
201.     t1 = Table()
202.     t1.add_column(Column(name="a", data=[1, 2, 3, 4]))
203.     t1.add_column(
204.         MaskedColumn(
205.             data=[4.0, np.nan, 3.0, 1.0], name="b", mask=[False, False, False, True]
206.         )
207.     )
208.     t1.write(test_file, format="ascii.qdp")
209.     with pytest.warns(UserWarning) as record:
210.         t2 = Table.read(test_file, format="ascii.qdp")
211.     assert np.any(
212.         [
213.             "table_id not specified. Reading the first available table"
214.             in r.message.args[0]
215.             for r in record
216.         ]
217.     )
218. 
219.     assert np.allclose(t2["col1"], t1["a"])
220.     assert np.all(t2["col1"] == t1["a"])
221. 
222.     good = ~np.isnan(t1["b"])
223.     assert np.allclose(t2["col2"][good], t1["b"][good])
224. 
225. 
226. def test_read_write_simple_specify_name(tmp_path):
227.     test_file = tmp_path / "test.qdp"
228.     t1 = Table()
229.     t1.add_column(Column(name="a", data=[1, 2, 3]))
230.     # Give a non-None err_specs
231.     t1.write(test_file, format="ascii.qdp")
232.     t2 = Table.read(test_file, table_id=0, format="ascii.qdp", names=["a"])
233.     assert np.all(t2["a"] == t1["a"])
234. 
235. 
236. def test_get_lines_from_qdp(tmp_path):
237.     test_file = str(tmp_path / "test.qdp")
238.     text_string = "A\nB"
239.     text_output = _get_lines_from_file(text_string)
240.     with open(test_file, "w") as fobj:
241.         print(text_string, file=fobj)
242.     file_output = _get_lines_from_file(test_file)
243.     list_output = _get_lines_from_file(["A", "B"])
244.     for i, line in enumerate(["A", "B"]):
245.         assert file_output[i] == line
246.         assert list_output[i] == line
247.         assert text_output[i] == line

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 11:54:13,723 - thread-139575885280960.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have analyzed the user's request and the provided context. The user wants to find three relevant test cases for a bug related to case-sensitive command parsing in `astropy.io.ascii.qdp`. I have already been provided with the full content of `astropy/io/ascii/tests/test_qdp.py`, which contains the tests for the QDP reader. This file contains several test cases that, while not testing for the specific bug (case-insensitivity), test the surrounding functionality of reading QDP files with commands like `READ SERR` and `READ TERR`. I can select three suitable test cases from this file to fulfill the user's request. Therefore, I have sufficient information and do not need to request additional context." query='' extra_requirements='' purpose=''
2025-12-23 11:54:13,724 - thread-139575885280960.prometheus_context_collector - INFO - Successfully retrieved 2 context snippets
