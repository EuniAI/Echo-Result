2025-12-23 23:32:06,887 - thread-125368433358528.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: C++ User Defined Literals not supported

Description: The code as below

```cpp
namespace units::si {

inline constexpr auto planck_constant = 6.62607015e-34q_J * 1q_s;

}
```

causes the following error:

```
WARNING: Invalid definition: Expected end of definition. [error at 58]
[build]   constexpr auto units::si::planck_constant = 6.62607015e-34q_J * 1q_s
[build]   ----------------------------------------------------------^
```

According to <https://github.com/sphinx-doc/sphinx/blob/3.x/sphinx/domains/cpp.py#L4770> Sphinx seems to not have features for UDLs. Could you please add those?

Patch information:
diff --git a/sphinx/domains/cpp.py b/sphinx/domains/cpp.py
index fe52d881d..932745855 100644
--- a/sphinx/domains/cpp.py
+++ b/sphinx/domains/cpp.py
@@ -35,7 +35,7 @@ from sphinx.util.cfamily import (
     BaseParser, DefinitionError, UnsupportedMultiCharacterCharLiteral,
     identifier_re, anon_identifier_re, integer_literal_re, octal_literal_re,
     hex_literal_re, binary_literal_re, float_literal_re,
-    char_literal_re
+    char_literal_re, ud_suffix_re
 )
 from sphinx.util.docfields import Field, GroupedField
 from sphinx.util.docutils import SphinxDirective
@@ -882,6 +882,24 @@ class ASTCharLiteral(ASTLiteral):
         signode.append(nodes.Text(txt, txt))
 
 
+class ASTUserDefinedLiteral(ASTLiteral):
+    def __init__(self, data: str) -> None:
+        # full literal token including any ud-suffix
+        self.data = data
+
+    def _stringify(self, transform: StringifyTransform) -> str:
+        return self.data
+
+    def get_id(self, version: int) -> str:
+        # Use the same id scheme as number literals but include full token
+        return "L%sE" % self.data
+
+    def describe_signature(self, signode: TextElement, mode: str,
+                           env: "BuildEnvironment", symbol: "Symbol") -> None:
+        txt = str(self)
+        signode.append(nodes.Text(txt, txt))
+
+
 class ASTThisLiteral(ASTExpression):
     def _stringify(self, transform: StringifyTransform) -> str:
         return "this"
@@ -4664,16 +4682,28 @@ class DefinitionParser(BaseParser):
             if self.match(regex):
                 while self.current_char in 'uUlLfF':
                     self.pos += 1
+                # check for user-defined literal suffix with no intervening whitespace
+                if self.match(ud_suffix_re):
+                    return ASTUserDefinedLiteral(self.definition[pos:self.pos])
                 return ASTNumberLiteral(self.definition[pos:self.pos])
 
+        # string-literal (no prefix handling here)
+        startPos = self.pos
         string = self._parse_string()
         if string is not None:
+            # check for user-defined literal suffix immediately after the string
+            if self.match(ud_suffix_re):
+                return ASTUserDefinedLiteral(self.definition[startPos:self.pos])
             return ASTStringLiteral(string)
 
         # character-literal
+        pos = self.pos
         if self.match(char_literal_re):
             prefix = self.last_match.group(1)  # may be None when no prefix
             data = self.last_match.group(2)
+            # check for user-defined literal suffix immediately after the char literal
+            if self.match(ud_suffix_re):
+                return ASTUserDefinedLiteral(self.definition[pos:self.pos])
             try:
                 return ASTCharLiteral(prefix, data)
             except UnicodeDecodeError as e:
@@ -4682,7 +4712,6 @@ class DefinitionParser(BaseParser):
                 self.fail("Can not handle character literal"
                           " resulting in multiple decoded characters.")
 
-        # TODO: user-defined lit
         return None
 
     def _parse_fold_or_paren_expression(self) -> ASTExpression:
diff --git a/sphinx/util/cfamily.py b/sphinx/util/cfamily.py
index 790a492a5..bd6bfe5df 100644
--- a/sphinx/util/cfamily.py
+++ b/sphinx/util/cfamily.py
@@ -67,6 +67,10 @@ char_literal_re = re.compile(r'''(?x)
     )'
 ''')
 
+# Regex for C++ user-defined literal suffix (ud-suffix):
+# must start with a letter or underscore and continue with letters, digits, or underscores
+ud_suffix_re = re.compile(r'[a-zA-Z_][a-zA-Z0-9_]*')
+
 
 def verify_description_mode(mode: str) -> None:
     if mode not in ('lastIsName', 'noneIsName', 'markType', 'markName', 'param'):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 23:32:06,949 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .appveyor.yml
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── authors.rst
|   ├── changes.rst
|   ├── code_of_conduct.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── devguide.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── intro.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── theming.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   └── __init__.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.4.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   ├── layout.html
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── callable.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enum.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── need_mocks.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_autodoc.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: C++ User Defined Literals not supported

Description: The code as below

```cpp
namespace units::si {

inline constexpr auto planck_constant = 6.62607015e-34q_J * 1q_s;

}
```

causes the following error:

```
WARNING: Invalid definition: Expected end of definition. [error at 58]
[build]   constexpr auto units::si::planck_constant = 6.62607015e-34q_J * 1q_s
[build]   ----------------------------------------------------------^
```

According to <https://github.com/sphinx-doc/sphinx/blob/3.x/sphinx/domains/cpp.py#L4770> Sphinx seems to not have features for UDLs. Could you please add those?

Patch information:
diff --git a/sphinx/domains/cpp.py b/sphinx/domains/cpp.py
index fe52d881d..932745855 100644
--- a/sphinx/domains/cpp.py
+++ b/sphinx/domains/cpp.py
@@ -35,7 +35,7 @@ from sphinx.util.cfamily import (
     BaseParser, DefinitionError, UnsupportedMultiCharacterCharLiteral,
     identifier_re, anon_identifier_re, integer_literal_re, octal_literal_re,
     hex_literal_re, binary_literal_re, float_literal_re,
-    char_literal_re
+    char_literal_re, ud_suffix_re
 )
 from sphinx.util.docfields import Field, GroupedField
 from sphinx.util.docutils import SphinxDirective
@@ -882,6 +882,24 @@ class ASTCharLiteral(ASTLiteral):
         signode.append(nodes.Text(txt, txt))
 
 
+class ASTUserDefinedLiteral(ASTLiteral):
+    def __init__(self, data: str) -> None:
+        # full literal token including any ud-suffix
+        self.data = data
+
+    def _stringify(self, transform: StringifyTransform) -> str:
+        return self.data
+
+    def get_id(self, version: int) -> str:
+        # Use the same id scheme as number literals but include full token
+        return "L%sE" % self.data
+
+    def describe_signature(self, signode: TextElement, mode: str,
+                           env: "BuildEnvironment", symbol: "Symbol") -> None:
+        txt = str(self)
+        signode.append(nodes.Text(txt, txt))
+
+
 class ASTThisLiteral(ASTExpression):
     def _stringify(self, transform: StringifyTransform) -> str:
         return "this"
@@ -4664,16 +4682,28 @@ class DefinitionParser(BaseParser):
             if self.match(regex):
                 while self.current_char in 'uUlLfF':
                     self.pos += 1
+                # check for user-defined literal suffix with no intervening whitespace
+                if self.match(ud_suffix_re):
+                    return ASTUserDefinedLiteral(self.definition[pos:self.pos])
                 return ASTNumberLiteral(self.definition[pos:self.pos])
 
+        # string-literal (no prefix handling here)
+        startPos = self.pos
         string = self._parse_string()
         if string is not None:
+            # check for user-defined literal suffix immediately after the string
+            if self.match(ud_suffix_re):
+                return ASTUserDefinedLiteral(self.definition[startPos:self.pos])
             return ASTStringLiteral(string)
 
         # character-literal
+        pos = self.pos
         if self.match(char_literal_re):
             prefix = self.last_match.group(1)  # may be None when no prefix
             data = self.last_match.group(2)
+            # check for user-defined literal suffix immediately after the char literal
+            if self.match(ud_suffix_re):
+                return ASTUserDefinedLiteral(self.definition[pos:self.pos])
             try:
                 return ASTCharLiteral(prefix, data)
             except UnicodeDecodeError as e:
@@ -4682,7 +4712,6 @@ class DefinitionParser(BaseParser):
                 self.fail("Can not handle character literal"
                           " resulting in multiple decoded characters.")
 
-        # TODO: user-defined lit
         return None
 
     def _parse_fold_or_paren_expression(self) -> ASTExpression:
diff --git a/sphinx/util/cfamily.py b/sphinx/util/cfamily.py
index 790a492a5..bd6bfe5df 100644
--- a/sphinx/util/cfamily.py
+++ b/sphinx/util/cfamily.py
@@ -67,6 +67,10 @@ char_literal_re = re.compile(r'''(?x)
     )'
 ''')
 
+# Regex for C++ user-defined literal suffix (ud-suffix):
+# must start with a letter or underscore and continue with letters, digits, or underscores
+ud_suffix_re = re.compile(r'[a-zA-Z_][a-zA-Z0-9_]*')
+
 
 def verify_description_mode(mode: str) -> None:
     if mode not in ('lastIsName', 'noneIsName', 'markType', 'markName', 'param'):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 23:32:20,904 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find relevant test cases for a bug concerning C++ User-Defined Literals. The provided patch modifies the C++ parser. To find similar test cases, I need to examine how other literals are tested in the C++ domain. The most relevant file for this is `tests/test_domain_cpp.py`, but its content is not available in the current context. Therefore, I need to retrieve the content of this file to identify suitable test cases.' query='Please provide the full content of `tests/test_domain_cpp.py`.' extra_requirements='' purpose='I need the content of `tests/test_domain_cpp.py` to find existing tests for C++ literals, which will serve as a template for testing the new User-Defined Literal functionality.'
2025-12-23 23:32:20,905 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_domain_cpp.py`.
2025-12-23 23:32:20,905 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 23:32:20,906 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 23:32:20,907 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 23:32:20,907 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_domain_cpp.py`.
Purpose: I need the content of `tests/test_domain_cpp.py` to find existing tests for C++ literals, which will serve as a template for testing the new User-Defined Literal functionality.
2025-12-23 23:32:23,170 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_domain_cpp.py"}'}, '__gemini_function_call_thought_signatures__': {'ea288c6a-aa80-484b-bfdd-2a47f48150b8': 'CvwFAY89a1/PTAQRVzZP+TewQfc3bnlcYZ7OCKPoutlumbQ+MJKaZE8qzDzM495csshUIKkXl4s6GYxxuBtrks1UokL+4FowLXymZDWmbLAeWQKK0EUoWuqfmzzCA+I4l/Of8fIDo/aeJy7hoUlDCVPQJnZQ4oP9xHdfCogBGNfAJem5ejh1uq+p85U8SUxp6SeQEjh8L1TjCRr5rbuw40/jrM7ujccMpvpFkc/pfcOoTN8tzmi6YWPozSXIYobE8WYc4BuCR6FfBmXW6YKjVr81jwhcBJYSsRhm0NsEdG/zzPEPmvL/ph4yz+o5JgqlW282zrk/QbJPr0XLZeWId/zLNbojl3O/xIYpOkOdrY8dAtOUJvjPmJ/qZa87Qws5GUm+fh6VQ7wNmOSUJPczsSQmgccPciUNiiV6j47YsAtQCgpdbmsgJBQWZ6VXhNvuj/4B+2KAMtbBF5pqBVkGhinG/3YCCePxuTz5IeH8LiQRHx0eSQ7noRlJZS8YUEtji/UcCGXkrf+98lRLQ6Un+2CJagyGml3Xz2Nega43E7zmiFJI6odi7GqHYTHO4iWDrEjAQlEFkY6MWMWkHnEaLYnNQEYGk9l9jXTSd/gM4UacwLBpkjUIi5HaWCoW+sgGQoAaWxvbLAjkE6JYLvA8mgX5pcHCjK1IsM7ixiN7U9ms4nxX00s8hA8lHVSZJPiSJ5EgPEGPq5LOvDHCtZgc1WKmkn3cLjrQVQ0lhaA5cmVInZdN+jHW8boV7VNk7MojzNVeyeeaVJ2ztxMyaXY6QbOauADt7GEGcv4sNPBokpzoV4kQmK/amuejrd+HsUc9x8v/ta8wECs6z66W3H9lYq9NFoFCmfLFZe6+wLs07eObb+SHIFlW5iTNXYBl44aaijmthNkixw02kmrF9aAoQ8nIqWruEYG51mLEM7picfRaQ4oOcxtCVbuEypF+xQPcMMz3ocfcIlW6nwuMz7W8CSoEII2jSQUA6PQ8a3SO1JGSviThZyu9MPoqbjMMpqo='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2088, 'candidates_token_count': 23, 'total_token_count': 2299, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2088}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 23}], 'thoughts_token_count': 188, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.32084404903909436, 'model_name': 'gemini-2.5-pro'} id='run--8add6fab-9e67-43c9-8834-e30e92b2ecf6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_domain_cpp.py'}, 'id': 'ea288c6a-aa80-484b-bfdd-2a47f48150b8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2088, 'output_tokens': 23, 'total_tokens': 2299, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 188}}
2025-12-23 23:32:25,784 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "tests/test_domain_cpp.py", "end_line": 1000.0}'}, '__gemini_function_call_thought_signatures__': {'84878ea1-7404-4057-94f6-9154fb8d021f': 'CtEDAY89a1+ZF0vmytJah+YhfuyfyJm8Ul9xoSMUdbrfhp0CPOkwycHkip1izUjkKrOmPYh69nrgi2PFiR5hG0hPgo6W484D0QrsEDDvTuXL34FoRr99UeC/H80re3bwyrlL1Mu5oTRStM5SC3cXiHDuJlw/DZe41A9MRo7jwixFPkh+KH9IZ61LIoBt91R3dWuQcZNucRu9oGVXcsa6jafZUwdWZ7blxqtQwoMPHwRm52BkJjjLSR9fGVFOvTYMVv+iyN/y68guk9eM6hvWk/K7zPtnBHNDuPQOASYPIlh1w7TBtFp4+dDGIwPLSuq8PeNboklP0nSntSf2tpgHKvkj9AADP/Omg25gZSrqqgU15P/uYjjvZH1GQ6kzIMFInDWxbXyczXYaan9iwV+OSgXRCyvXUpf2jWGjmLAWtNLaR9tKaqJqOOgvMddrl6NzXOUlsF29XtEGpWU41885+3B9e+0H6CKzmfZJjP2OjbX/WCRceiG41+NbKTsEn2aAlkxSLAYjLq8odqv6r3dKXfMrP/PSQT+56xyjk9Qj+IJmqL0FxfN35reftDurVEt4M5PpTZF7VQ5uDdfQZWeE+rvhJZPfjHauFoj6KM5KzZRZ6gnu'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 13633, 'candidates_token_count': 29, 'total_token_count': 13786, 'cached_content_token_count': 1837, 'prompt_tokens_details': [{'modality': 1, 'token_count': 13821}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1837}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 124}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4337032252344592, 'model_name': 'gemini-2.5-pro'} id='run--38780525-870f-4a19-a4b1-8d4b50f818d1-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'tests/test_domain_cpp.py', 'end_line': 1000.0}, 'id': '84878ea1-7404-4057-94f6-9154fb8d021f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13633, 'output_tokens': 29, 'total_tokens': 13786, 'input_token_details': {'cache_read': 1837}, 'output_token_details': {'reasoning': 124}}
2025-12-23 23:32:27,785 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1001.0, "relative_path": "tests/test_domain_cpp.py", "end_line": 1500.0}'}, '__gemini_function_call_thought_signatures__': {'9eee83b4-207d-4306-8b5f-74001217cc44': 'CtUCAY89a1+gpHrPQDSPpsFu+pesiDA6WP/+9tr9MSs2VY99w+NX5KOK7nT3bDLXVi2OT42hElXAkq2/9cLt1Tyjx7z9Brf6Wl7QUMpHgA6imZ68mC0dpxlar38TXumy6CoDLO053MwKwqeQXRincH2cVxcO2LYWiXW8tJPSljkkvuFlCBWJfcam7zqZ7BQDpUyxMh/qz9N8Pf8hePQeREighhB3ADsJpxHF5sRiIqlS52avgjYSj+AZxbxYGKd9ECTAsnnRv6MPNCFUNwOwE2KMlmxv6Tgq1NODgokWpj1CStYWeJZZrkLgUxgr/W1UIrYgn0UPOFiz4E9pJ2JEclOhEo4rte87oKVkD4L7ZNr/gA+0lRoQGAxDmxiMwNbPRenZq63alRbWcRA1l1D9H0SliguSlYq3uMJH7LzDivDEEeLo5zBYlFr18EpTfPfOBZ+PKXGmwDk='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 25873, 'candidates_token_count': 29, 'total_token_count': 25988, 'prompt_tokens_details': [{'modality': 1, 'token_count': 26185}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 29}], 'thoughts_token_count': 86, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2019869376873148, 'model_name': 'gemini-2.5-pro'} id='run--ddfad034-c746-41be-8fc1-09ba2a0095fa-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1001.0, 'relative_path': 'tests/test_domain_cpp.py', 'end_line': 1500.0}, 'id': '9eee83b4-207d-4306-8b5f-74001217cc44', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25873, 'output_tokens': 29, 'total_tokens': 25988, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 86}}
2025-12-23 23:32:31,966 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/test_domain_cpp.py`. Initially, I read the first 500 lines of the file. Subsequently, I fetched the remaining content in two separate chunks to ensure the entire file is available.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 28463, 'candidates_token_count': 52, 'total_token_count': 28775, 'cached_content_token_count': 24367, 'prompt_tokens_details': [{'modality': 1, 'token_count': 28861}], 'cache_tokens_details': [{'modality': 1, 'token_count': 24367}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 52}], 'thoughts_token_count': 260}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7003079194288987, 'model_name': 'gemini-2.5-pro'} id='run--fba580fd-ca08-490d-9286-72ed910265d0-0' usage_metadata={'input_tokens': 28463, 'output_tokens': 52, 'total_tokens': 28775, 'input_token_details': {'cache_read': 24367}, 'output_token_details': {'reasoning': 260}}
2025-12-23 23:32:31,968 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_domain_cpp.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need the content of `tests/test_domain_cpp.py` to find existing tests for C++ literals, which will serve as a template for testing the new User-Defined Literal functionality.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_domain_cpp.py
Line number range: 1 - 500
Content:
1. """
2.     test_domain_cpp
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests the C++ Domain
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. 
13. import pytest
14. 
15. import sphinx.domains.cpp as cppDomain
16. from sphinx import addnodes
17. from sphinx.domains.cpp import DefinitionParser, DefinitionError, NoOldIdError
18. from sphinx.domains.cpp import Symbol, _max_id, _id_prefix
19. from sphinx.util import docutils
20. 
21. 
22. def parse(name, string):
23.     class Config:
24.         cpp_id_attributes = ["id_attr"]
25.         cpp_paren_attributes = ["paren_attr"]
26.     parser = DefinitionParser(string, location=None, config=Config())
27.     parser.allowFallbackExpressionParsing = False
28.     ast = parser.parse_declaration(name, name)
29.     parser.assert_end()
30.     # The scopedness would usually have been set by CPPEnumObject
31.     if name == "enum":
32.         ast.scoped = None  # simulate unscoped enum
33.     return ast
34. 
35. 
36. def _check(name, input, idDict, output):
37.     # first a simple check of the AST
38.     ast = parse(name, input)
39.     res = str(ast)
40.     if res != output:
41.         print("")
42.         print("Input:    ", input)
43.         print("Result:   ", res)
44.         print("Expected: ", output)
45.         raise DefinitionError("")
46.     rootSymbol = Symbol(None, None, None, None, None, None)
47.     symbol = rootSymbol.add_declaration(ast, docname="TestDoc")
48.     parentNode = addnodes.desc()
49.     signode = addnodes.desc_signature(input, '')
50.     parentNode += signode
51.     ast.describe_signature(signode, 'lastIsName', symbol, options={})
52. 
53.     idExpected = [None]
54.     for i in range(1, _max_id + 1):
55.         if i in idDict:
56.             idExpected.append(idDict[i])
57.         else:
58.             idExpected.append(idExpected[i - 1])
59.     idActual = [None]
60.     for i in range(1, _max_id + 1):
61.         try:
62.             id = ast.get_id(version=i)
63.             assert id is not None
64.             idActual.append(id[len(_id_prefix[i]):])
65.         except NoOldIdError:
66.             idActual.append(None)
67. 
68.     res = [True]
69.     for i in range(1, _max_id + 1):
70.         res.append(idExpected[i] == idActual[i])
71. 
72.     if not all(res):
73.         print("input:    %s" % input.rjust(20))
74.         for i in range(1, _max_id + 1):
75.             if res[i]:
76.                 continue
77.             print("Error in id version %d." % i)
78.             print("result:   %s" % idActual[i])
79.             print("expected: %s" % idExpected[i])
80.         print(rootSymbol.dump(0))
81.         raise DefinitionError("")
82. 
83. 
84. def check(name, input, idDict, output=None):
85.     if output is None:
86.         output = input
87.     # First, check without semicolon
88.     _check(name, input, idDict, output)
89.     # Second, check with semicolon
90.     _check(name, input + ' ;', idDict, output + ';')
91. 
92. 
93. def test_fundamental_types():
94.     # see https://en.cppreference.com/w/cpp/language/types
95.     for t, id_v2 in cppDomain._id_fundamental_v2.items():
96.         def makeIdV1():
97.             if t == 'decltype(auto)':
98.                 return None
99.             id = t.replace(" ", "-").replace("long", "l").replace("int", "i")
100.             id = id.replace("bool", "b").replace("char", "c")
101.             id = id.replace("wc_t", "wchar_t").replace("c16_t", "char16_t")
102.             id = id.replace("c32_t", "char32_t")
103.             return "f__%s" % id
104. 
105.         def makeIdV2():
106.             id = id_v2
107.             if t == "std::nullptr_t":
108.                 id = "NSt9nullptr_tE"
109.             return "1f%s" % id
110.         check("function", "void f(%s arg)" % t, {1: makeIdV1(), 2: makeIdV2()})
111. 
112. 
113. def test_expressions():
114.     def exprCheck(expr, id, id4=None):
115.         ids = 'IE1CIA%s_1aE'
116.         idDict = {2: ids % expr, 3: ids % id}
117.         if id4 is not None:
118.             idDict[4] = ids % id4
119.         check('class', 'template<> C<a[%s]>' % expr, idDict)
120. 
121.         class Config:
122.             cpp_id_attributes = ["id_attr"]
123.             cpp_paren_attributes = ["paren_attr"]
124. 
125.         parser = DefinitionParser(expr, location=None,
126.                                   config=Config())
127.         parser.allowFallbackExpressionParsing = False
128.         ast = parser.parse_expression()
129.         res = str(ast)
130.         if res != expr:
131.             print("")
132.             print("Input:    ", expr)
133.             print("Result:   ", res)
134.             raise DefinitionError("")
135.     # primary
136.     exprCheck('nullptr', 'LDnE')
137.     exprCheck('true', 'L1E')
138.     exprCheck('false', 'L0E')
139.     ints = ['5', '0', '075', '0x0123456789ABCDEF', '0XF', '0b1', '0B1']
140.     unsignedSuffix = ['', 'u', 'U']
141.     longSuffix = ['', 'l', 'L', 'll', 'LL']
142.     for i in ints:
143.         for u in unsignedSuffix:
144.             for l in longSuffix:
145.                 expr = i + u + l
146.                 exprCheck(expr, 'L' + expr + 'E')
147.                 expr = i + l + u
148.                 exprCheck(expr, 'L' + expr + 'E')
149.     for suffix in ['', 'f', 'F', 'l', 'L']:
150.         for e in [
151.                 '5e42', '5e+42', '5e-42',
152.                 '5.', '5.e42', '5.e+42', '5.e-42',
153.                 '.5', '.5e42', '.5e+42', '.5e-42',
154.                 '5.0', '5.0e42', '5.0e+42', '5.0e-42']:
155.             expr = e + suffix
156.             exprCheck(expr, 'L' + expr + 'E')
157.         for e in [
158.                 'ApF', 'Ap+F', 'Ap-F',
159.                 'A.', 'A.pF', 'A.p+F', 'A.p-F',
160.                 '.A', '.ApF', '.Ap+F', '.Ap-F',
161.                 'A.B', 'A.BpF', 'A.Bp+F', 'A.Bp-F']:
162.             expr = "0x" + e + suffix
163.             exprCheck(expr, 'L' + expr + 'E')
164.     exprCheck('"abc\\"cba"', 'LA8_KcE')  # string
165.     exprCheck('this', 'fpT')
166.     # character literals
167.     for p, t in [('', 'c'), ('u8', 'c'), ('u', 'Ds'), ('U', 'Di'), ('L', 'w')]:
168.         exprCheck(p + "'a'", t + "97")
169.         exprCheck(p + "'\\n'", t + "10")
170.         exprCheck(p + "'\\012'", t + "10")
171.         exprCheck(p + "'\\0'", t + "0")
172.         exprCheck(p + "'\\x0a'", t + "10")
173.         exprCheck(p + "'\\x0A'", t + "10")
174.         exprCheck(p + "'\\u0a42'", t + "2626")
175.         exprCheck(p + "'\\u0A42'", t + "2626")
176.         exprCheck(p + "'\\U0001f34c'", t + "127820")
177.         exprCheck(p + "'\\U0001F34C'", t + "127820")
178. 
179.     # TODO: user-defined lit
180.     exprCheck('(... + Ns)', '(... + Ns)', id4='flpl2Ns')
181.     exprCheck('(Ns + ...)', '(Ns + ...)', id4='frpl2Ns')
182.     exprCheck('(Ns + ... + 0)', '(Ns + ... + 0)', id4='fLpl2NsL0E')
183.     exprCheck('(5)', 'L5E')
184.     exprCheck('C', '1C')
185.     # postfix
186.     exprCheck('A(2)', 'cl1AL2EE')
187.     exprCheck('A[2]', 'ix1AL2E')
188.     exprCheck('a.b.c', 'dtdt1a1b1c')
189.     exprCheck('a->b->c', 'ptpt1a1b1c')
190.     exprCheck('i++', 'pp1i')
191.     exprCheck('i--', 'mm1i')
192.     exprCheck('dynamic_cast<T&>(i)++', 'ppdcR1T1i')
193.     exprCheck('static_cast<T&>(i)++', 'ppscR1T1i')
194.     exprCheck('reinterpret_cast<T&>(i)++', 'pprcR1T1i')
195.     exprCheck('const_cast<T&>(i)++', 'ppccR1T1i')
196.     exprCheck('typeid(T).name', 'dtti1T4name')
197.     exprCheck('typeid(a + b).name', 'dttepl1a1b4name')
198.     # unary
199.     exprCheck('++5', 'pp_L5E')
200.     exprCheck('--5', 'mm_L5E')
201.     exprCheck('*5', 'deL5E')
202.     exprCheck('&5', 'adL5E')
203.     exprCheck('+5', 'psL5E')
204.     exprCheck('-5', 'ngL5E')
205.     exprCheck('!5', 'ntL5E')
206.     exprCheck('not 5', 'ntL5E')
207.     exprCheck('~5', 'coL5E')
208.     exprCheck('compl 5', 'coL5E')
209.     exprCheck('sizeof...(a)', 'sZ1a')
210.     exprCheck('sizeof(T)', 'st1T')
211.     exprCheck('sizeof -42', 'szngL42E')
212.     exprCheck('alignof(T)', 'at1T')
213.     exprCheck('noexcept(-42)', 'nxngL42E')
214.     # new-expression
215.     exprCheck('new int', 'nw_iE')
216.     exprCheck('new volatile int', 'nw_ViE')
217.     exprCheck('new int[42]', 'nw_AL42E_iE')
218.     exprCheck('new int()', 'nw_ipiE')
219.     exprCheck('new int(5, 42)', 'nw_ipiL5EL42EE')
220.     exprCheck('::new int', 'nw_iE')
221.     exprCheck('new int{}', 'nw_iilE')
222.     exprCheck('new int{5, 42}', 'nw_iilL5EL42EE')
223.     # delete-expression
224.     exprCheck('delete p', 'dl1p')
225.     exprCheck('delete [] p', 'da1p')
226.     exprCheck('::delete p', 'dl1p')
227.     exprCheck('::delete [] p', 'da1p')
228.     # cast
229.     exprCheck('(int)2', 'cviL2E')
230.     # binary op
231.     exprCheck('5 || 42', 'ooL5EL42E')
232.     exprCheck('5 or 42', 'ooL5EL42E')
233.     exprCheck('5 && 42', 'aaL5EL42E')
234.     exprCheck('5 and 42', 'aaL5EL42E')
235.     exprCheck('5 | 42', 'orL5EL42E')
236.     exprCheck('5 bitor 42', 'orL5EL42E')
237.     exprCheck('5 ^ 42', 'eoL5EL42E')
238.     exprCheck('5 xor 42', 'eoL5EL42E')
239.     exprCheck('5 & 42', 'anL5EL42E')
240.     exprCheck('5 bitand 42', 'anL5EL42E')
241.     # ['==', '!=']
242.     exprCheck('5 == 42', 'eqL5EL42E')
243.     exprCheck('5 != 42', 'neL5EL42E')
244.     exprCheck('5 not_eq 42', 'neL5EL42E')
245.     # ['<=', '>=', '<', '>']
246.     exprCheck('5 <= 42', 'leL5EL42E')
247.     exprCheck('A <= 42', 'le1AL42E')
248.     exprCheck('5 >= 42', 'geL5EL42E')
249.     exprCheck('5 < 42', 'ltL5EL42E')
250.     exprCheck('A < 42', 'lt1AL42E')
251.     exprCheck('5 > 42', 'gtL5EL42E')
252.     # ['<<', '>>']
253.     exprCheck('5 << 42', 'lsL5EL42E')
254.     exprCheck('A << 42', 'ls1AL42E')
255.     exprCheck('5 >> 42', 'rsL5EL42E')
256.     # ['+', '-']
257.     exprCheck('5 + 42', 'plL5EL42E')
258.     exprCheck('5 - 42', 'miL5EL42E')
259.     # ['*', '/', '%']
260.     exprCheck('5 * 42', 'mlL5EL42E')
261.     exprCheck('5 / 42', 'dvL5EL42E')
262.     exprCheck('5 % 42', 'rmL5EL42E')
263.     # ['.*', '->*']
264.     exprCheck('5 .* 42', 'dsL5EL42E')
265.     exprCheck('5 ->* 42', 'pmL5EL42E')
266.     # conditional
267.     # TODO
268.     # assignment
269.     exprCheck('a = 5', 'aS1aL5E')
270.     exprCheck('a *= 5', 'mL1aL5E')
271.     exprCheck('a /= 5', 'dV1aL5E')
272.     exprCheck('a %= 5', 'rM1aL5E')
273.     exprCheck('a += 5', 'pL1aL5E')
274.     exprCheck('a -= 5', 'mI1aL5E')
275.     exprCheck('a >>= 5', 'rS1aL5E')
276.     exprCheck('a <<= 5', 'lS1aL5E')
277.     exprCheck('a &= 5', 'aN1aL5E')
278.     exprCheck('a and_eq 5', 'aN1aL5E')
279.     exprCheck('a ^= 5', 'eO1aL5E')
280.     exprCheck('a xor_eq 5', 'eO1aL5E')
281.     exprCheck('a |= 5', 'oR1aL5E')
282.     exprCheck('a or_eq 5', 'oR1aL5E')
283.     exprCheck('a = {1, 2, 3}', 'aS1ailL1EL2EL3EE')
284.     # comma operator
285.     exprCheck('a, 5', 'cm1aL5E')
286. 
287.     # Additional tests
288.     # a < expression that starts with something that could be a template
289.     exprCheck('A < 42', 'lt1AL42E')
290.     check('function', 'template<> void f(A<B, 2> &v)',
291.           {2: "IE1fR1AI1BX2EE", 3: "IE1fR1AI1BXL2EEE", 4: "IE1fvR1AI1BXL2EEE"})
292.     exprCheck('A<1>::value', 'N1AIXL1EEE5valueE')
293.     check('class', "template<int T = 42> A", {2: "I_iE1A"})
294.     check('enumerator', 'A = std::numeric_limits<unsigned long>::max()', {2: "1A"})
295. 
296.     exprCheck('operator()()', 'clclE')
297.     exprCheck('operator()<int>()', 'clclIiEE')
298. 
299.     # pack expansion
300.     exprCheck('a(b(c, 1 + d...)..., e(f..., g))', 'cl1aspcl1b1cspplL1E1dEcl1esp1f1gEE')
301. 
302. 
303. def test_type_definitions():
304.     check("type", "public bool b", {1: "b", 2: "1b"}, "bool b")
305.     check("type", "bool A::b", {1: "A::b", 2: "N1A1bE"})
306.     check("type", "bool *b", {1: "b", 2: "1b"})
307.     check("type", "bool *const b", {1: "b", 2: "1b"})
308.     check("type", "bool *volatile const b", {1: "b", 2: "1b"})
309.     check("type", "bool *volatile const b", {1: "b", 2: "1b"})
310.     check("type", "bool *volatile const *b", {1: "b", 2: "1b"})
311.     check("type", "bool &b", {1: "b", 2: "1b"})
312.     check("type", "bool b[]", {1: "b", 2: "1b"})
313.     check("type", "std::pair<int, int> coord", {1: "coord", 2: "5coord"})
314.     check("type", "long long int foo", {1: "foo", 2: "3foo"})
315.     check("type", 'std::vector<std::pair<std::string, long long>> module::blah',
316.           {1: "module::blah", 2: "N6module4blahE"})
317.     check("type", "std::function<void()> F", {1: "F", 2: "1F"})
318.     check("type", "std::function<R(A1, A2)> F", {1: "F", 2: "1F"})
319.     check("type", "std::function<R(A1, A2, A3)> F", {1: "F", 2: "1F"})
320.     check("type", "std::function<R(A1, A2, A3, As...)> F", {1: "F", 2: "1F"})
321.     check("type", "MyContainer::const_iterator",
322.           {1: "MyContainer::const_iterator", 2: "N11MyContainer14const_iteratorE"})
323.     check("type",
324.           "public MyContainer::const_iterator",
325.           {1: "MyContainer::const_iterator", 2: "N11MyContainer14const_iteratorE"},
326.           output="MyContainer::const_iterator")
327.     # test decl specs on right
328.     check("type", "bool const b", {1: "b", 2: "1b"})
329.     # test name in global scope
330.     check("type", "bool ::B::b", {1: "B::b", 2: "N1B1bE"})
331. 
332.     check('type', 'A = B', {2: '1A'})
333.     check('type', 'A = decltype(b)', {2: '1A'})
334. 
335.     # from breathe#267 (named function parameters for function pointers
336.     check('type', 'void (*gpio_callback_t)(struct device *port, uint32_t pin)',
337.           {1: 'gpio_callback_t', 2: '15gpio_callback_t'})
338.     check('type', 'void (*f)(std::function<void(int i)> g)', {1: 'f', 2: '1f'})
339. 
340.     check('type', 'T = A::template B<int>::template C<double>', {2: '1T'})
341. 
342.     check('type', 'T = Q<A::operator()>', {2: '1T'})
343.     check('type', 'T = Q<A::operator()<int>>', {2: '1T'})
344.     check('type', 'T = Q<A::operator bool>', {2: '1T'})
345. 
346. 
347. def test_concept_definitions():
348.     check('concept', 'template<typename Param> A::B::Concept',
349.           {2: 'I0EN1A1B7ConceptE'})
350.     check('concept', 'template<typename A, typename B, typename ...C> Foo',
351.           {2: 'I00DpE3Foo'})
352.     with pytest.raises(DefinitionError):
353.         parse('concept', 'Foo')
354.     with pytest.raises(DefinitionError):
355.         parse('concept', 'template<typename T> template<typename U> Foo')
356. 
357. 
358. def test_member_definitions():
359.     check('member', '  const  std::string  &  name = 42',
360.           {1: "name__ssCR", 2: "4name"}, output='const std::string &name = 42')
361.     check('member', '  const  std::string  &  name', {1: "name__ssCR", 2: "4name"},
362.           output='const std::string &name')
363.     check('member', '  const  std::string  &  name [ n ]',
364.           {1: "name__ssCRA", 2: "4name"}, output='const std::string &name[n]')
365.     check('member', 'const std::vector< unsigned int, long> &name',
366.           {1: "name__std::vector:unsigned-i.l:CR", 2: "4name"},
367.           output='const std::vector<unsigned int, long> &name')
368.     check('member', 'module::myclass foo[n]', {1: "foo__module::myclassA", 2: "3foo"})
369.     check('member', 'int *const p', {1: 'p__iPC', 2: '1p'})
370.     check('member', 'extern int myInt', {1: 'myInt__i', 2: '5myInt'})
371.     check('member', 'thread_local int myInt', {1: 'myInt__i', 2: '5myInt'})
372.     check('member', 'extern thread_local int myInt', {1: 'myInt__i', 2: '5myInt'})
373.     check('member', 'thread_local extern int myInt', {1: 'myInt__i', 2: '5myInt'},
374.           'extern thread_local int myInt')
375. 
376.     # tests based on https://en.cppreference.com/w/cpp/language/bit_field
377.     check('member', 'int b : 3', {1: 'b__i', 2: '1b'})
378.     check('member', 'int b : 8 = 42', {1: 'b__i', 2: '1b'})
379.     check('member', 'int b : 8{42}', {1: 'b__i', 2: '1b'})
380.     # TODO: enable once the ternary operator is supported
381.     #check('member', 'int b : true ? 8 : a = 42', {1: 'b__i', 2: '1b'})
382.     # TODO: enable once the ternary operator is supported
383.     #check('member', 'int b : (true ? 8 : a) = 42', {1: 'b__i', 2: '1b'})
384.     check('member', 'int b : 1 || new int{0}', {1: 'b__i', 2: '1b'})
385. 
386. 
387. def test_function_definitions():
388.     check('function', 'void f(volatile int)', {1: "f__iV", 2: "1fVi"})
389.     check('function', 'void f(std::size_t)', {1: "f__std::s", 2: "1fNSt6size_tE"})
390.     check('function', 'operator bool() const', {1: "castto-b-operatorC", 2: "NKcvbEv"})
391.     check('function', 'A::operator bool() const',
392.           {1: "A::castto-b-operatorC", 2: "NK1AcvbEv"})
393.     check('function', 'A::operator bool() volatile const &',
394.           {1: "A::castto-b-operatorVCR", 2: "NVKR1AcvbEv"})
395.     check('function', 'A::operator bool() volatile const &&',
396.           {1: "A::castto-b-operatorVCO", 2: "NVKO1AcvbEv"})
397.     check('function', 'bool namespaced::theclass::method(arg1, arg2)',
398.           {1: "namespaced::theclass::method__arg1.arg2",
399.            2: "N10namespaced8theclass6methodE4arg14arg2"})
400.     x = 'std::vector<std::pair<std::string, int>> &module::test(register int ' \
401.         'foo, bar, std::string baz = "foobar, blah, bleh") const = 0'
402.     check('function', x, {1: "module::test__i.bar.ssC",
403.                           2: "NK6module4testEi3barNSt6stringE"})
404.     check('function', 'void f(std::pair<A, B>)',
405.           {1: "f__std::pair:A.B:", 2: "1fNSt4pairI1A1BEE"})
406.     check('function', 'explicit module::myclass::foo::foo()',
407.           {1: "module::myclass::foo::foo", 2: "N6module7myclass3foo3fooEv"})
408.     check('function', 'module::myclass::foo::~foo()',
409.           {1: "module::myclass::foo::~foo", 2: "N6module7myclass3fooD0Ev"})
410.     check('function', 'int printf(const char *fmt, ...)',
411.           {1: "printf__cCP.z", 2: "6printfPKcz"})
412.     check('function', 'int foo(const unsigned int j)',
413.           {1: "foo__unsigned-iC", 2: "3fooKj"})
414.     check('function', 'int foo(const int *const ptr)',
415.           {1: "foo__iCPC", 2: "3fooPCKi"})
416.     check('function', 'module::myclass::operator std::vector<std::string>()',
417.           {1: "module::myclass::castto-std::vector:ss:-operator",
418.            2: "N6module7myclasscvNSt6vectorINSt6stringEEEEv"})
419.     check('function',
420.           'void operator()(const boost::array<VertexID, 2> &v) const',
421.           {1: "call-operator__boost::array:VertexID.2:CRC",
422.            2: "NKclERKN5boost5arrayI8VertexIDX2EEE",
423.            3: "NKclERKN5boost5arrayI8VertexIDXL2EEEE"})
424.     check('function',
425.           'void operator()(const boost::array<VertexID, 2, "foo,  bar"> &v) const',
426.           {1: 'call-operator__boost::array:VertexID.2."foo,--bar":CRC',
427.            2: 'NKclERKN5boost5arrayI8VertexIDX2EX"foo,  bar"EEE',
428.            3: 'NKclERKN5boost5arrayI8VertexIDXL2EEXLA9_KcEEEE'})
429.     check('function', 'MyClass::MyClass(MyClass::MyClass&&)',
430.           {1: "MyClass::MyClass__MyClass::MyClassRR",
431.            2: "N7MyClass7MyClassERRN7MyClass7MyClassE"})
432.     check('function', 'constexpr int get_value()', {1: "get_valueCE", 2: "9get_valuev"})
433.     check('function', 'static constexpr int get_value()',
434.           {1: "get_valueCE", 2: "9get_valuev"})
435.     check('function', 'int get_value() const noexcept',
436.           {1: "get_valueC", 2: "NK9get_valueEv"})
437.     check('function', 'int get_value() const noexcept(std::is_nothrow_move_constructible<T>::value)',
438.           {1: "get_valueC", 2: "NK9get_valueEv"})
439.     check('function', 'int get_value() const noexcept("see below")',
440.           {1: "get_valueC", 2: "NK9get_valueEv"})
441.     check('function', 'int get_value() const noexcept = delete',
442.           {1: "get_valueC", 2: "NK9get_valueEv"})
443.     check('function', 'int get_value() volatile const',
444.           {1: "get_valueVC", 2: "NVK9get_valueEv"})
445.     check('function', 'MyClass::MyClass(MyClass::MyClass&&) = default',
446.           {1: "MyClass::MyClass__MyClass::MyClassRR",
447.            2: "N7MyClass7MyClassERRN7MyClass7MyClassE"})
448.     check('function', 'virtual MyClass::a_virtual_function() const override',
449.           {1: "MyClass::a_virtual_functionC", 2: "NK7MyClass18a_virtual_functionEv"})
450.     check('function', 'A B() override', {1: "B", 2: "1Bv"})
451.     check('function', 'A B() final', {1: "B", 2: "1Bv"})
452.     check('function', 'A B() final override', {1: "B", 2: "1Bv"})
453.     check('function', 'A B() override final', {1: "B", 2: "1Bv"},
454.           output='A B() final override')
455.     check('function', 'MyClass::a_member_function() volatile',
456.           {1: "MyClass::a_member_functionV", 2: "NV7MyClass17a_member_functionEv"})
457.     check('function', 'MyClass::a_member_function() volatile const',
458.           {1: "MyClass::a_member_functionVC", 2: "NVK7MyClass17a_member_functionEv"})
459.     check('function', 'MyClass::a_member_function() &&',
460.           {1: "MyClass::a_member_functionO", 2: "NO7MyClass17a_member_functionEv"})
461.     check('function', 'MyClass::a_member_function() &',
462.           {1: "MyClass::a_member_functionR", 2: "NR7MyClass17a_member_functionEv"})
463.     check('function', 'MyClass::a_member_function() const &',
464.           {1: "MyClass::a_member_functionCR", 2: "NKR7MyClass17a_member_functionEv"})
465.     check('function', 'int main(int argc, char *argv[])',
466.           {1: "main__i.cPA", 2: "4mainiA_Pc"})
467.     check('function', 'MyClass &MyClass::operator++()',
468.           {1: "MyClass::inc-operator", 2: "N7MyClassppEv"})
469.     check('function', 'MyClass::pointer MyClass::operator->()',
470.           {1: "MyClass::pointer-operator", 2: "N7MyClassptEv"})
471. 
472.     x = 'std::vector<std::pair<std::string, int>> &module::test(register int ' \
473.         'foo, bar[n], std::string baz = "foobar, blah, bleh") const = 0'
474.     check('function', x, {1: "module::test__i.barA.ssC",
475.                           2: "NK6module4testEiAn_3barNSt6stringE",
476.                           3: "NK6module4testEiA1n_3barNSt6stringE"})
477.     check('function',
478.           'int foo(Foo f = Foo(double(), std::make_pair(int(2), double(3.4))))',
479.           {1: "foo__Foo", 2: "3foo3Foo"})
480.     check('function', 'int foo(A a = x(a))', {1: "foo__A", 2: "3foo1A"})
481.     with pytest.raises(DefinitionError):
482.         parse('function', 'int foo(B b=x(a)')
483.     with pytest.raises(DefinitionError):
484.         parse('function', 'int foo)C c=x(a))')
485.     with pytest.raises(DefinitionError):
486.         parse('function', 'int foo(D d=x(a')
487.     check('function', 'int foo(const A&... a)', {1: "foo__ACRDp", 2: "3fooDpRK1A"})
488.     check('function', 'int foo(const A&...)', {1: "foo__ACRDp", 2: "3fooDpRK1A"})
489.     check('function', 'int foo(const A*... a)', {1: "foo__ACPDp", 2: "3fooDpPK1A"})
490.     check('function', 'int foo(const A*...)', {1: "foo__ACPDp", 2: "3fooDpPK1A"})
491.     check('function', 'int foo(const int A::*... a)', {2: "3fooDpM1AKi"})
492.     check('function', 'int foo(const int A::*...)', {2: "3fooDpM1AKi"})
493.     #check('function', 'int foo(int (*a)(A)...)', {1: "foo__ACRDp", 2: "3fooDpPK1A"})
494.     #check('function', 'int foo(int (*)(A)...)', {1: "foo__ACRDp", 2: "3fooDpPK1A"})
495.     check('function', 'virtual void f()', {1: "f", 2: "1fv"})
496.     # test for ::nestedName, from issue 1738
497.     check("function", "result(int val, ::std::error_category const &cat)",
498.           {1: "result__i.std::error_categoryCR", 2: "6resultiRKNSt14error_categoryE"})
499.     check("function", "int *f()", {1: "f", 2: "1fv"})
500.     # tests derived from issue #1753 (skip to keep sanity)


File: tests/test_domain_cpp.py
Line number range: 501 - 1000
Content:
501.     check("function", "f(int (&array)[10])", {2: "1fRA10_i", 3: "1fRAL10E_i"})
502.     check("function", "void f(int (&array)[10])", {2: "1fRA10_i", 3: "1fRAL10E_i"})
503.     check("function", "void f(float *q(double))", {2: "1fFPfdE"})
504.     check("function", "void f(float *(*q)(double))", {2: "1fPFPfdE"})
505.     check("function", "void f(float (*q)(double))", {2: "1fPFfdE"})
506.     check("function", "int (*f(double d))(float)", {1: "f__double", 2: "1fd"})
507.     check("function", "int (*f(bool b))[5]", {1: "f__b", 2: "1fb"})
508.     check("function", "int (*A::f(double d) const)(float)",
509.           {1: "A::f__doubleC", 2: "NK1A1fEd"})
510.     check("function", "void f(std::shared_ptr<int(double)> ptr)",
511.           {2: "1fNSt10shared_ptrIFidEEE"})
512.     check("function", "void f(int *const p)", {1: "f__iPC", 2: "1fPCi"})
513.     check("function", "void f(int *volatile const p)", {1: "f__iPVC", 2: "1fPVCi"})
514. 
515.     check('function', 'extern int f()', {1: 'f', 2: '1fv'})
516. 
517.     check('function', 'decltype(auto) f()', {1: 'f', 2: "1fv"})
518. 
519.     # TODO: make tests for functions in a template, e.g., Test<int&&()>
520.     # such that the id generation for function type types is correct.
521. 
522.     check('function', 'friend std::ostream &f(std::ostream &s, int i)',
523.           {1: 'f__osR.i', 2: '1fRNSt7ostreamEi'})
524. 
525.     # from breathe#223
526.     check('function', 'void f(struct E e)', {1: 'f__E', 2: '1f1E'})
527.     check('function', 'void f(class E e)', {1: 'f__E', 2: '1f1E'})
528.     check('function', 'void f(typename E e)', {1: 'f__E', 2: '1f1E'})
529.     check('function', 'void f(enum E e)', {1: 'f__E', 2: '1f1E'})
530.     check('function', 'void f(union E e)', {1: 'f__E', 2: '1f1E'})
531. 
532.     # pointer to member (function)
533.     check('function', 'void f(int C::*)', {2: '1fM1Ci'})
534.     check('function', 'void f(int C::* p)', {2: '1fM1Ci'})
535.     check('function', 'void f(int ::C::* p)', {2: '1fM1Ci'})
536.     check('function', 'void f(int C::*const)', {2: '1fKM1Ci'})
537.     check('function', 'void f(int C::*const&)', {2: '1fRKM1Ci'})
538.     check('function', 'void f(int C::*volatile)', {2: '1fVM1Ci'})
539.     check('function', 'void f(int C::*const volatile)', {2: '1fVKM1Ci'},
540.           output='void f(int C::*volatile const)')
541.     check('function', 'void f(int C::*volatile const)', {2: '1fVKM1Ci'})
542.     check('function', 'void f(int (C::*)(float, double))', {2: '1fM1CFifdE'})
543.     check('function', 'void f(int (C::* p)(float, double))', {2: '1fM1CFifdE'})
544.     check('function', 'void f(int (::C::* p)(float, double))', {2: '1fM1CFifdE'})
545.     check('function', 'void f(void (C::*)() const &)', {2: '1fM1CKRFvvE'})
546.     check('function', 'int C::* f(int, double)', {2: '1fid'})
547.     check('function', 'void f(int C::* *p)', {2: '1fPM1Ci'})
548.     check('function', 'void f(int C::**)', {2: '1fPM1Ci'})
549.     check('function', 'void f(int C::*const *p)', {2: '1fPKM1Ci'})
550.     check('function', 'void f(int C::*const*)', {2: '1fPKM1Ci'})
551. 
552.     # exceptions from return type mangling
553.     check('function', 'template<typename T> C()', {2: 'I0E1Cv'})
554.     check('function', 'template<typename T> operator int()', {1: None, 2: 'I0Ecviv'})
555. 
556. 
557. def test_operators():
558.     check('function', 'void operator new()', {1: "new-operator", 2: "nwv"})
559.     check('function', 'void operator new[]()', {1: "new-array-operator", 2: "nav"})
560.     check('function', 'void operator delete()', {1: "delete-operator", 2: "dlv"})
561.     check('function', 'void operator delete[]()', {1: "delete-array-operator", 2: "dav"})
562.     check('function', 'operator bool() const', {1: "castto-b-operatorC", 2: "NKcvbEv"})
563.     check('function', 'void operator""_udl()', {2: 'li4_udlv'})
564. 
565.     check('function', 'void operator~()', {1: "inv-operator", 2: "cov"})
566.     check('function', 'void operator compl()', {2: "cov"})
567.     check('function', 'void operator+()', {1: "add-operator", 2: "plv"})
568.     check('function', 'void operator-()', {1: "sub-operator", 2: "miv"})
569.     check('function', 'void operator*()', {1: "mul-operator", 2: "mlv"})
570.     check('function', 'void operator/()', {1: "div-operator", 2: "dvv"})
571.     check('function', 'void operator%()', {1: "mod-operator", 2: "rmv"})
572.     check('function', 'void operator&()', {1: "and-operator", 2: "anv"})
573.     check('function', 'void operator bitand()', {2: "anv"})
574.     check('function', 'void operator|()', {1: "or-operator", 2: "orv"})
575.     check('function', 'void operator bitor()', {2: "orv"})
576.     check('function', 'void operator^()', {1: "xor-operator", 2: "eov"})
577.     check('function', 'void operator xor()', {2: "eov"})
578.     check('function', 'void operator=()', {1: "assign-operator", 2: "aSv"})
579.     check('function', 'void operator+=()', {1: "add-assign-operator", 2: "pLv"})
580.     check('function', 'void operator-=()', {1: "sub-assign-operator", 2: "mIv"})
581.     check('function', 'void operator*=()', {1: "mul-assign-operator", 2: "mLv"})
582.     check('function', 'void operator/=()', {1: "div-assign-operator", 2: "dVv"})
583.     check('function', 'void operator%=()', {1: "mod-assign-operator", 2: "rMv"})
584.     check('function', 'void operator&=()', {1: "and-assign-operator", 2: "aNv"})
585.     check('function', 'void operator and_eq()', {2: "aNv"})
586.     check('function', 'void operator|=()', {1: "or-assign-operator", 2: "oRv"})
587.     check('function', 'void operator or_eq()', {2: "oRv"})
588.     check('function', 'void operator^=()', {1: "xor-assign-operator", 2: "eOv"})
589.     check('function', 'void operator xor_eq()', {2: "eOv"})
590.     check('function', 'void operator<<()', {1: "lshift-operator", 2: "lsv"})
591.     check('function', 'void operator>>()', {1: "rshift-operator", 2: "rsv"})
592.     check('function', 'void operator<<=()', {1: "lshift-assign-operator", 2: "lSv"})
593.     check('function', 'void operator>>=()', {1: "rshift-assign-operator", 2: "rSv"})
594.     check('function', 'void operator==()', {1: "eq-operator", 2: "eqv"})
595.     check('function', 'void operator!=()', {1: "neq-operator", 2: "nev"})
596.     check('function', 'void operator not_eq()', {2: "nev"})
597.     check('function', 'void operator<()', {1: "lt-operator", 2: "ltv"})
598.     check('function', 'void operator>()', {1: "gt-operator", 2: "gtv"})
599.     check('function', 'void operator<=()', {1: "lte-operator", 2: "lev"})
600.     check('function', 'void operator>=()', {1: "gte-operator", 2: "gev"})
601.     check('function', 'void operator!()', {1: "not-operator", 2: "ntv"})
602.     check('function', 'void operator not()', {2: "ntv"})
603.     check('function', 'void operator&&()', {1: "sand-operator", 2: "aav"})
604.     check('function', 'void operator and()', {2: "aav"})
605.     check('function', 'void operator||()', {1: "sor-operator", 2: "oov"})
606.     check('function', 'void operator or()', {2: "oov"})
607.     check('function', 'void operator++()', {1: "inc-operator", 2: "ppv"})
608.     check('function', 'void operator--()', {1: "dec-operator", 2: "mmv"})
609.     check('function', 'void operator,()', {1: "comma-operator", 2: "cmv"})
610.     check('function', 'void operator->*()', {1: "pointer-by-pointer-operator", 2: "pmv"})
611.     check('function', 'void operator->()', {1: "pointer-operator", 2: "ptv"})
612.     check('function', 'void operator()()', {1: "call-operator", 2: "clv"})
613.     check('function', 'void operator[]()', {1: "subscript-operator", 2: "ixv"})
614. 
615. 
616. def test_class_definitions():
617.     check('class', 'public A', {1: "A", 2: "1A"}, output='A')
618.     check('class', 'private A', {1: "A", 2: "1A"})
619.     check('class', 'A final', {1: 'A', 2: '1A'})
620. 
621.     # test bases
622.     check('class', 'A', {1: "A", 2: "1A"})
623.     check('class', 'A::B::C', {1: "A::B::C", 2: "N1A1B1CE"})
624.     check('class', 'A : B', {1: "A", 2: "1A"})
625.     check('class', 'A : private B', {1: "A", 2: "1A"})
626.     check('class', 'A : public B', {1: "A", 2: "1A"})
627.     check('class', 'A : B, C', {1: "A", 2: "1A"})
628.     check('class', 'A : B, protected C, D', {1: "A", 2: "1A"})
629.     check('class', 'A : virtual private B', {1: 'A', 2: '1A'}, output='A : private virtual B')
630.     check('class', 'A : private virtual B', {1: 'A', 2: '1A'})
631.     check('class', 'A : B, virtual C', {1: 'A', 2: '1A'})
632.     check('class', 'A : public virtual B', {1: 'A', 2: '1A'})
633.     check('class', 'A : B, C...', {1: 'A', 2: '1A'})
634.     check('class', 'A : B..., C', {1: 'A', 2: '1A'})
635. 
636.     # from #4094
637.     check('class', 'template<class, class = std::void_t<>> has_var', {2: 'I00E7has_var'})
638.     check('class', 'template<class T> has_var<T, std::void_t<decltype(&T::var)>>',
639.           {2: 'I0E7has_varI1TNSt6void_tIDTadN1T3varEEEEE'})
640. 
641. 
642.     check('class', 'template<typename ...Ts> T<int (*)(Ts)...>',
643.           {2: 'IDpE1TIJPFi2TsEEE'})
644.     check('class', 'template<int... Is> T<(Is)...>',
645.           {2: 'I_DpiE1TIJX(Is)EEE', 3: 'I_DpiE1TIJX2IsEEE'})
646. 
647. 
648. def test_union_definitions():
649.     check('union', 'A', {2: "1A"})
650. 
651. 
652. def test_enum_definitions():
653.     check('enum', 'A', {2: "1A"})
654.     check('enum', 'A : std::underlying_type<B>::type', {2: "1A"})
655.     check('enum', 'A : unsigned int', {2: "1A"})
656.     check('enum', 'public A', {2: "1A"}, output='A')
657.     check('enum', 'private A', {2: "1A"})
658. 
659.     check('enumerator', 'A', {2: "1A"})
660.     check('enumerator', 'A = std::numeric_limits<unsigned long>::max()', {2: "1A"})
661. 
662. 
663. def test_anon_definitions():
664.     check('class', '@a', {3: "Ut1_a"})
665.     check('union', '@a', {3: "Ut1_a"})
666.     check('enum', '@a', {3: "Ut1_a"})
667.     check('class', '@1', {3: "Ut1_1"})
668.     check('class', '@a::A', {3: "NUt1_a1AE"})
669. 
670. 
671. def test_templates():
672.     check('class', "A<T>", {2: "IE1AI1TE"}, output="template<> A<T>")
673.     # first just check which objects support templating
674.     check('class', "template<> A", {2: "IE1A"})
675.     check('function', "template<> void A()", {2: "IE1Av", 4: "IE1Avv"})
676.     check('member', "template<> A a", {2: "IE1a"})
677.     check('type', "template<> a = A", {2: "IE1a"})
678.     with pytest.raises(DefinitionError):
679.         parse('enum', "template<> A")
680.     with pytest.raises(DefinitionError):
681.         parse('enumerator', "template<> A")
682.     # then all the real tests
683.     check('class', "template<typename T1, typename T2> A", {2: "I00E1A"})
684.     check('type', "template<> a", {2: "IE1a"})
685. 
686.     check('class', "template<typename T> A", {2: "I0E1A"})
687.     check('class', "template<class T> A", {2: "I0E1A"})
688.     check('class', "template<typename ...T> A", {2: "IDpE1A"})
689.     check('class', "template<typename...> A", {2: "IDpE1A"})
690.     check('class', "template<typename = Test> A", {2: "I0E1A"})
691.     check('class', "template<typename T = Test> A", {2: "I0E1A"})
692. 
693.     check('class', "template<template<typename> typename T> A", {2: "II0E0E1A"})
694.     check('class', "template<template<typename> typename> A", {2: "II0E0E1A"})
695.     check('class', "template<template<typename> typename ...T> A", {2: "II0EDpE1A"})
696.     check('class', "template<template<typename> typename...> A", {2: "II0EDpE1A"})
697. 
698.     check('class', "template<int> A", {2: "I_iE1A"})
699.     check('class', "template<int T> A", {2: "I_iE1A"})
700.     check('class', "template<int... T> A", {2: "I_DpiE1A"})
701.     check('class', "template<int T = 42> A", {2: "I_iE1A"})
702.     check('class', "template<int = 42> A", {2: "I_iE1A"})
703. 
704.     check('class', "template<> A<NS::B<>>", {2: "IE1AIN2NS1BIEEE"})
705. 
706.     # from #2058
707.     check('function',
708.           "template<typename Char, typename Traits> "
709.           "inline std::basic_ostream<Char, Traits> &operator<<("
710.           "std::basic_ostream<Char, Traits> &os, "
711.           "const c_string_view_base<const Char, Traits> &str)",
712.           {2: "I00ElsRNSt13basic_ostreamI4Char6TraitsEE"
713.               "RK18c_string_view_baseIK4Char6TraitsE",
714.            4: "I00Els"
715.               "RNSt13basic_ostreamI4Char6TraitsEE"
716.               "RNSt13basic_ostreamI4Char6TraitsEE"
717.               "RK18c_string_view_baseIK4Char6TraitsE"})
718. 
719.     # template introductions
720.     with pytest.raises(DefinitionError):
721.         parse('enum', 'abc::ns::foo{id_0, id_1, id_2} A')
722.     with pytest.raises(DefinitionError):
723.         parse('enumerator', 'abc::ns::foo{id_0, id_1, id_2} A')
724.     check('class', 'abc::ns::foo{id_0, id_1, id_2} xyz::bar',
725.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barE'})
726.     check('class', 'abc::ns::foo{id_0, id_1, ...id_2} xyz::bar',
727.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barE'})
728.     check('class', 'abc::ns::foo{id_0, id_1, id_2} xyz::bar<id_0, id_1, id_2>',
729.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barI4id_04id_14id_2EE'})
730.     check('class', 'abc::ns::foo{id_0, id_1, ...id_2} xyz::bar<id_0, id_1, id_2...>',
731.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barI4id_04id_1Dp4id_2EE'})
732. 
733.     check('class', 'template<> Concept{U} A<int>::B', {2: 'IEI0EX7ConceptI1UEEN1AIiE1BE'})
734. 
735.     check('type', 'abc::ns::foo{id_0, id_1, id_2} xyz::bar = ghi::qux',
736.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barE'})
737.     check('type', 'abc::ns::foo{id_0, id_1, ...id_2} xyz::bar = ghi::qux',
738.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barE'})
739.     check('function', 'abc::ns::foo{id_0, id_1, id_2} void xyz::bar()',
740.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barEv',
741.            4: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barEvv'})
742.     check('function', 'abc::ns::foo{id_0, id_1, ...id_2} void xyz::bar()',
743.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barEv',
744.            4: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barEvv'})
745.     check('member', 'abc::ns::foo{id_0, id_1, id_2} ghi::qux xyz::bar',
746.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barE'})
747.     check('member', 'abc::ns::foo{id_0, id_1, ...id_2} ghi::qux xyz::bar',
748.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barE'})
749.     check('concept', 'Iterator{T, U} Another', {2: 'I00EX8IteratorI1T1UEE7Another'})
750.     check('concept', 'template<typename ...Pack> Numerics = (... && Numeric<Pack>)',
751.           {2: 'IDpE8Numerics'})
752. 
753.     # explicit specializations of members
754.     check('member', 'template<> int A<int>::a', {2: 'IEN1AIiE1aE'})
755.     check('member', 'template int A<int>::a', {2: 'IEN1AIiE1aE'},
756.           output='template<> int A<int>::a')  # same as above
757.     check('member', 'template<> template<> int A<int>::B<int>::b', {2: 'IEIEN1AIiE1BIiE1bE'})
758.     check('member', 'template int A<int>::B<int>::b', {2: 'IEIEN1AIiE1BIiE1bE'},
759.           output='template<> template<> int A<int>::B<int>::b')  # same as above
760. 
761.     # defaulted constrained type parameters
762.     check('type', 'template<C T = int&> A', {2: 'I_1CE1A'})
763. 
764. 
765. def test_template_args():
766.     # from breathe#218
767.     check('function',
768.           "template<typename F> "
769.           "void allow(F *f, typename func<F, B, G != 1>::type tt)",
770.           {2: "I0E5allowP1FN4funcI1F1BXG != 1EE4typeE",
771.            3: "I0E5allowP1FN4funcI1F1BXne1GL1EEE4typeE",
772.            4: "I0E5allowvP1FN4funcI1F1BXne1GL1EEE4typeE"})
773.     # from #3542
774.     check('type', "template<typename T> "
775.           "enable_if_not_array_t = std::enable_if_t<!is_array<T>::value, int>",
776.           {2: "I0E21enable_if_not_array_t"})
777. 
778. 
779. def test_initializers():
780.     idsMember = {1: 'v__T', 2: '1v'}
781.     idsFunction = {1: 'f__T', 2: '1f1T'}
782.     idsTemplate = {2: 'I_1TE1fv', 4: 'I_1TE1fvv'}
783.     # no init
784.     check('member', 'T v', idsMember)
785.     check('function', 'void f(T v)', idsFunction)
786.     check('function', 'template<T v> void f()', idsTemplate)
787.     # with '=', assignment-expression
788.     check('member', 'T v = 42', idsMember)
789.     check('function', 'void f(T v = 42)', idsFunction)
790.     check('function', 'template<T v = 42> void f()', idsTemplate)
791.     # with '=', braced-init
792.     check('member', 'T v = {}', idsMember)
793.     check('function', 'void f(T v = {})', idsFunction)
794.     check('function', 'template<T v = {}> void f()', idsTemplate)
795.     check('member', 'T v = {42, 42, 42}', idsMember)
796.     check('function', 'void f(T v = {42, 42, 42})', idsFunction)
797.     check('function', 'template<T v = {42, 42, 42}> void f()', idsTemplate)
798.     check('member', 'T v = {42, 42, 42,}', idsMember)
799.     check('function', 'void f(T v = {42, 42, 42,})', idsFunction)
800.     check('function', 'template<T v = {42, 42, 42,}> void f()', idsTemplate)
801.     check('member', 'T v = {42, 42, args...}', idsMember)
802.     check('function', 'void f(T v = {42, 42, args...})', idsFunction)
803.     check('function', 'template<T v = {42, 42, args...}> void f()', idsTemplate)
804.     # without '=', braced-init
805.     check('member', 'T v{}', idsMember)
806.     check('member', 'T v{42, 42, 42}', idsMember)
807.     check('member', 'T v{42, 42, 42,}', idsMember)
808.     check('member', 'T v{42, 42, args...}', idsMember)
809.     # other
810.     check('member', 'T v = T{}', idsMember)
811. 
812. 
813. def test_attributes():
814.     # style: C++
815.     check('member', '[[]] int f', {1: 'f__i', 2: '1f'})
816.     check('member', '[ [ ] ] int f', {1: 'f__i', 2: '1f'},
817.           # this will fail when the proper grammar is implemented
818.           output='[[ ]] int f')
819.     check('member', '[[a]] int f', {1: 'f__i', 2: '1f'})
820.     # style: GNU
821.     check('member', '__attribute__(()) int f', {1: 'f__i', 2: '1f'})
822.     check('member', '__attribute__((a)) int f', {1: 'f__i', 2: '1f'})
823.     check('member', '__attribute__((a, b)) int f', {1: 'f__i', 2: '1f'})
824.     # style: user-defined id
825.     check('member', 'id_attr int f', {1: 'f__i', 2: '1f'})
826.     # style: user-defined paren
827.     check('member', 'paren_attr() int f', {1: 'f__i', 2: '1f'})
828.     check('member', 'paren_attr(a) int f', {1: 'f__i', 2: '1f'})
829.     check('member', 'paren_attr("") int f', {1: 'f__i', 2: '1f'})
830.     check('member', 'paren_attr(()[{}][]{}) int f', {1: 'f__i', 2: '1f'})
831.     with pytest.raises(DefinitionError):
832.         parse('member', 'paren_attr(() int f')
833.     with pytest.raises(DefinitionError):
834.         parse('member', 'paren_attr([) int f')
835.     with pytest.raises(DefinitionError):
836.         parse('member', 'paren_attr({) int f')
837.     with pytest.raises(DefinitionError):
838.         parse('member', 'paren_attr([)]) int f')
839.     with pytest.raises(DefinitionError):
840.         parse('member', 'paren_attr((])) int f')
841.     with pytest.raises(DefinitionError):
842.         parse('member', 'paren_attr({]}) int f')
843. 
844.     # position: decl specs
845.     check('function', 'static inline __attribute__(()) void f()',
846.           {1: 'f', 2: '1fv'},
847.           output='__attribute__(()) static inline void f()')
848.     check('function', '[[attr1]] [[attr2]] void f()',
849.           {1: 'f', 2: '1fv'},
850.           output='[[attr1]] [[attr2]] void f()')
851.     # position: declarator
852.     check('member', 'int *[[attr]] i', {1: 'i__iP', 2: '1i'})
853.     check('member', 'int *const [[attr]] volatile i', {1: 'i__iPVC', 2: '1i'},
854.           output='int *[[attr]] volatile const i')
855.     check('member', 'int &[[attr]] i', {1: 'i__iR', 2: '1i'})
856.     check('member', 'int *[[attr]] *i', {1: 'i__iPP', 2: '1i'})
857. 
858. 
859. def test_xref_parsing():
860.     def check(target):
861.         class Config:
862.             cpp_id_attributes = ["id_attr"]
863.             cpp_paren_attributes = ["paren_attr"]
864.         parser = DefinitionParser(target, location=None,
865.                                   config=Config())
866.         ast, isShorthand = parser.parse_xref_object()
867.         parser.assert_end()
868.     check('f')
869.     check('f()')
870.     check('void f()')
871.     check('T f()')
872. 
873. 
874. # def test_print():
875. #     # used for getting all the ids out for checking
876. #     for a in ids:
877. #         print(a)
878. #     raise DefinitionError("")
879. 
880. 
881. def filter_warnings(warning, file):
882.     lines = warning.getvalue().split("\n")
883.     res = [l for l in lines if "domain-cpp" in l and "{}.rst".format(file) in l and
884.            "WARNING: document isn't included in any toctree" not in l]
885.     print("Filtered warnings for file '{}':".format(file))
886.     for w in res:
887.         print(w)
888.     return res
889. 
890. 
891. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
892. def test_build_domain_cpp_multi_decl_lookup(app, status, warning):
893.     app.builder.build_all()
894.     ws = filter_warnings(warning, "lookup-key-overload")
895.     assert len(ws) == 0
896. 
897.     ws = filter_warnings(warning, "multi-decl-lookup")
898.     assert len(ws) == 0
899. 
900. 
901. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
902. def test_build_domain_cpp_warn_template_param_qualified_name(app, status, warning):
903.     app.builder.build_all()
904.     ws = filter_warnings(warning, "warn-template-param-qualified-name")
905.     assert len(ws) == 2
906.     assert "WARNING: cpp:type reference target not found: T::typeWarn" in ws[0]
907.     assert "WARNING: cpp:type reference target not found: T::U::typeWarn" in ws[1]
908. 
909. 
910. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
911. def test_build_domain_cpp_backslash_ok(app, status, warning):
912.     app.builder.build_all()
913.     ws = filter_warnings(warning, "backslash")
914.     assert len(ws) == 0
915. 
916. 
917. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
918. def test_build_domain_cpp_semicolon(app, status, warning):
919.     app.builder.build_all()
920.     ws = filter_warnings(warning, "semicolon")
921.     assert len(ws) == 0
922. 
923. 
924. @pytest.mark.sphinx(testroot='domain-cpp',
925.                     confoverrides={'nitpicky': True, 'strip_signature_backslash': True})
926. def test_build_domain_cpp_backslash_ok(app, status, warning):
927.     app.builder.build_all()
928.     ws = filter_warnings(warning, "backslash")
929.     assert len(ws) == 1
930.     assert "WARNING: Parsing of expression failed. Using fallback parser." in ws[0]
931. 
932. 
933. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
934. def test_build_domain_cpp_anon_dup_decl(app, status, warning):
935.     app.builder.build_all()
936.     ws = filter_warnings(warning, "anon-dup-decl")
937.     assert len(ws) == 2
938.     assert "WARNING: cpp:identifier reference target not found: @a" in ws[0]
939.     assert "WARNING: cpp:identifier reference target not found: @b" in ws[1]
940. 
941. 
942. @pytest.mark.sphinx(testroot='domain-cpp')
943. def test_build_domain_cpp_misuse_of_roles(app, status, warning):
944.     app.builder.build_all()
945.     ws = filter_warnings(warning, "roles-targets-ok")
946.     assert len(ws) == 0
947. 
948.     ws = filter_warnings(warning, "roles-targets-warn")
949.     # the roles that should be able to generate warnings:
950.     allRoles = ['class', 'struct', 'union', 'func', 'member', 'var', 'type', 'concept', 'enum', 'enumerator']
951.     ok = [  # targetType, okRoles
952.         ('class', ['class', 'struct', 'type']),
953.         ('union', ['union', 'type']),
954.         ('func', ['func', 'type']),
955.         ('member', ['member', 'var']),
956.         ('type', ['type']),
957.         ('concept', ['concept']),
958.         ('enum', ['type', 'enum']),
959.         ('enumerator', ['enumerator']),
960.         ('tParam', ['class', 'struct', 'union', 'func', 'member', 'var', 'type', 'concept', 'enum', 'enumerator', 'functionParam']),
961.         ('functionParam', ['member', 'var']),
962.     ]
963.     warn = []
964.     for targetType, roles in ok:
965.         txtTargetType = "function" if targetType == "func" else targetType
966.         for r in allRoles:
967.             if r not in roles:
968.                 warn.append("WARNING: cpp:{} targets a {} (".format(r, txtTargetType))
969.     warn = list(sorted(warn))
970.     for w in ws:
971.         assert "targets a" in w
972.     ws = [w[w.index("WARNING:"):] for w in ws]
973.     ws = list(sorted(ws))
974.     print("Expected warnings:")
975.     for w in warn:
976.         print(w)
977.     print("Actual warnings:")
978.     for w in ws:
979.         print(w)
980. 
981.     for i in range(min(len(warn), len(ws))):
982.         assert ws[i].startswith(warn[i])
983. 
984.     assert len(ws) == len(warn)
985. 
986. 
987. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
988.                     reason='docutils-0.13 or above is required')
989. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'add_function_parentheses': True})
990. def test_build_domain_cpp_with_add_function_parentheses_is_True(app, status, warning):
991.     app.builder.build_all()
992. 
993.     def check(spec, text, file):
994.         pattern = '<li><p>%s<a .*?><code .*?><span .*?>%s</span></code></a></p></li>' % spec
995.         res = re.search(pattern, text)
996.         if not res:
997.             print("Pattern\n\t%s\nnot found in %s" % (pattern, file))
998.             assert False
999.     rolePatterns = [
1000.         ('', 'Sphinx'),


File: tests/test_domain_cpp.py
Line number range: 1001 - 1500
Content:
1001.         ('', 'Sphinx::version'),
1002.         ('', 'version'),
1003.         ('', 'List'),
1004.         ('', 'MyEnum')
1005.     ]
1006.     parenPatterns = [
1007.         ('ref function without parens ', r'paren_1\(\)'),
1008.         ('ref function with parens ', r'paren_2\(\)'),
1009.         ('ref function without parens, explicit title ', 'paren_3_title'),
1010.         ('ref function with parens, explicit title ', 'paren_4_title'),
1011.         ('ref op call without parens ', r'paren_5::operator\(\)\(\)'),
1012.         ('ref op call with parens ', r'paren_6::operator\(\)\(\)'),
1013.         ('ref op call without parens, explicit title ', 'paren_7_title'),
1014.         ('ref op call with parens, explicit title ', 'paren_8_title')
1015.     ]
1016. 
1017.     f = 'roles.html'
1018.     t = (app.outdir / f).read_text()
1019.     for s in rolePatterns:
1020.         check(s, t, f)
1021.     for s in parenPatterns:
1022.         check(s, t, f)
1023. 
1024.     f = 'any-role.html'
1025.     t = (app.outdir / f).read_text()
1026.     for s in parenPatterns:
1027.         check(s, t, f)
1028. 
1029. 
1030. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
1031.                     reason='docutils-0.13 or above is required')
1032. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'add_function_parentheses': False})
1033. def test_build_domain_cpp_with_add_function_parentheses_is_False(app, status, warning):
1034.     app.builder.build_all()
1035. 
1036.     def check(spec, text, file):
1037.         pattern = '<li><p>%s<a .*?><code .*?><span .*?>%s</span></code></a></p></li>' % spec
1038.         res = re.search(pattern, text)
1039.         if not res:
1040.             print("Pattern\n\t%s\nnot found in %s" % (pattern, file))
1041.             assert False
1042.     rolePatterns = [
1043.         ('', 'Sphinx'),
1044.         ('', 'Sphinx::version'),
1045.         ('', 'version'),
1046.         ('', 'List'),
1047.         ('', 'MyEnum')
1048.     ]
1049.     parenPatterns = [
1050.         ('ref function without parens ', 'paren_1'),
1051.         ('ref function with parens ', 'paren_2'),
1052.         ('ref function without parens, explicit title ', 'paren_3_title'),
1053.         ('ref function with parens, explicit title ', 'paren_4_title'),
1054.         ('ref op call without parens ', r'paren_5::operator\(\)'),
1055.         ('ref op call with parens ', r'paren_6::operator\(\)'),
1056.         ('ref op call without parens, explicit title ', 'paren_7_title'),
1057.         ('ref op call with parens, explicit title ', 'paren_8_title')
1058.     ]
1059. 
1060.     f = 'roles.html'
1061.     t = (app.outdir / f).read_text()
1062.     for s in rolePatterns:
1063.         check(s, t, f)
1064.     for s in parenPatterns:
1065.         check(s, t, f)
1066. 
1067.     f = 'any-role.html'
1068.     t = (app.outdir / f).read_text()
1069.     for s in parenPatterns:
1070.         check(s, t, f)
1071. 
1072. 
1073. @pytest.mark.sphinx(testroot='domain-cpp')
1074. def test_xref_consistency(app, status, warning):
1075.     app.builder.build_all()
1076. 
1077.     test = 'xref_consistency.html'
1078.     output = (app.outdir / test).read_text()
1079. 
1080.     def classes(role, tag):
1081.         pattern = (r'{role}-role:.*?'
1082.                    r'<(?P<tag>{tag}) .*?class=["\'](?P<classes>.*?)["\'].*?>'
1083.                    r'.*'
1084.                    r'</(?P=tag)>').format(role=role, tag=tag)
1085.         result = re.search(pattern, output)
1086.         expect = '''\
1087. Pattern for role `{role}` with tag `{tag}`
1088. \t{pattern}
1089. not found in `{test}`
1090. '''.format(role=role, tag=tag, pattern=pattern, test=test)
1091.         assert result, expect
1092.         return set(result.group('classes').split())
1093. 
1094.     class RoleClasses:
1095.         """Collect the classes from the layout that was generated for a given role."""
1096. 
1097.         def __init__(self, role, root, contents):
1098.             self.name = role
1099.             self.classes = classes(role, root)
1100.             self.content_classes = dict()
1101.             for tag in contents:
1102.                 self.content_classes[tag] = classes(role, tag)
1103. 
1104.     # not actually used as a reference point
1105.     # code_role = RoleClasses('code', 'code', [])
1106.     any_role = RoleClasses('any', 'a', ['code'])
1107.     cpp_any_role = RoleClasses('cpp-any', 'a', ['code'])
1108.     # NYI: consistent looks
1109.     # texpr_role = RoleClasses('cpp-texpr', 'span', ['a', 'code'])
1110.     expr_role = RoleClasses('cpp-expr', 'code', ['a'])
1111.     texpr_role = RoleClasses('cpp-texpr', 'span', ['a', 'span'])
1112. 
1113.     # XRefRole-style classes
1114. 
1115.     # any and cpp:any do not put these classes at the root
1116. 
1117.     # n.b. the generic any machinery finds the specific 'cpp-class' object type
1118.     expect = 'any uses XRefRole classes'
1119.     assert {'xref', 'any', 'cpp', 'cpp-class'} <= any_role.content_classes['code'], expect
1120. 
1121.     expect = 'cpp:any uses XRefRole classes'
1122.     assert {'xref', 'cpp-any', 'cpp'} <= cpp_any_role.content_classes['code'], expect
1123. 
1124.     for role in (expr_role, texpr_role):
1125.         name = role.name
1126.         expect = '`{name}` puts the domain and role classes at its root'.format(name=name)
1127.         # NYI: xref should go in the references
1128.         assert {'xref', 'cpp', name} <= role.classes, expect
1129. 
1130.     # reference classes
1131. 
1132.     expect = 'the xref roles use the same reference classes'
1133.     assert any_role.classes == cpp_any_role.classes, expect
1134.     assert any_role.classes == expr_role.content_classes['a'], expect
1135.     assert any_role.classes == texpr_role.content_classes['a'], expect

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 23:32:37,447 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query asks for the full content of `tests/test_domain_cpp.py`.\n   - The context provided contains the complete content of this file.\n2. Extended relevance:\n   - Providing the full file content is necessary to directly and completely answer the user's request.", relative_path='tests/test_domain_cpp.py', start_line=1, end_line=1135)]
2025-12-23 23:32:37,449 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/test_domain_cpp.py`.
2025-12-23 23:32:37,449 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 23:32:37,449 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 23:32:37,450 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-23 23:32:37,450 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-23 23:32:37,450 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .appveyor.yml
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── authors.rst
|   ├── changes.rst
|   ├── code_of_conduct.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── develop.rst
|   ├── development
|   |   └── tutorials
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── devguide.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── intro.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── theming.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── applehelp.py
|   |   ├── changes.py
|   |   ├── devhelp.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   └── __init__.py
|   |   ├── htmlhelp.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── qthelp.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── indexentries.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── jsmath.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.4.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.3.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   ├── layout.html
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── jsonimpl.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── conftest.py
|   ├── js
|   |   └── doctools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── semicolon.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── bound_method.py
|   |   |       ├── callable.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── enum.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── methods.py
|   |   |       ├── need_mocks.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_autodoc.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_pycompat.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   └── typing_test_data.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: C++ User Defined Literals not supported

Description: The code as below

```cpp
namespace units::si {

inline constexpr auto planck_constant = 6.62607015e-34q_J * 1q_s;

}
```

causes the following error:

```
WARNING: Invalid definition: Expected end of definition. [error at 58]
[build]   constexpr auto units::si::planck_constant = 6.62607015e-34q_J * 1q_s
[build]   ----------------------------------------------------------^
```

According to <https://github.com/sphinx-doc/sphinx/blob/3.x/sphinx/domains/cpp.py#L4770> Sphinx seems to not have features for UDLs. Could you please add those?

Patch information:
diff --git a/sphinx/domains/cpp.py b/sphinx/domains/cpp.py
index fe52d881d..932745855 100644
--- a/sphinx/domains/cpp.py
+++ b/sphinx/domains/cpp.py
@@ -35,7 +35,7 @@ from sphinx.util.cfamily import (
     BaseParser, DefinitionError, UnsupportedMultiCharacterCharLiteral,
     identifier_re, anon_identifier_re, integer_literal_re, octal_literal_re,
     hex_literal_re, binary_literal_re, float_literal_re,
-    char_literal_re
+    char_literal_re, ud_suffix_re
 )
 from sphinx.util.docfields import Field, GroupedField
 from sphinx.util.docutils import SphinxDirective
@@ -882,6 +882,24 @@ class ASTCharLiteral(ASTLiteral):
         signode.append(nodes.Text(txt, txt))
 
 
+class ASTUserDefinedLiteral(ASTLiteral):
+    def __init__(self, data: str) -> None:
+        # full literal token including any ud-suffix
+        self.data = data
+
+    def _stringify(self, transform: StringifyTransform) -> str:
+        return self.data
+
+    def get_id(self, version: int) -> str:
+        # Use the same id scheme as number literals but include full token
+        return "L%sE" % self.data
+
+    def describe_signature(self, signode: TextElement, mode: str,
+                           env: "BuildEnvironment", symbol: "Symbol") -> None:
+        txt = str(self)
+        signode.append(nodes.Text(txt, txt))
+
+
 class ASTThisLiteral(ASTExpression):
     def _stringify(self, transform: StringifyTransform) -> str:
         return "this"
@@ -4664,16 +4682,28 @@ class DefinitionParser(BaseParser):
             if self.match(regex):
                 while self.current_char in 'uUlLfF':
                     self.pos += 1
+                # check for user-defined literal suffix with no intervening whitespace
+                if self.match(ud_suffix_re):
+                    return ASTUserDefinedLiteral(self.definition[pos:self.pos])
                 return ASTNumberLiteral(self.definition[pos:self.pos])
 
+        # string-literal (no prefix handling here)
+        startPos = self.pos
         string = self._parse_string()
         if string is not None:
+            # check for user-defined literal suffix immediately after the string
+            if self.match(ud_suffix_re):
+                return ASTUserDefinedLiteral(self.definition[startPos:self.pos])
             return ASTStringLiteral(string)
 
         # character-literal
+        pos = self.pos
         if self.match(char_literal_re):
             prefix = self.last_match.group(1)  # may be None when no prefix
             data = self.last_match.group(2)
+            # check for user-defined literal suffix immediately after the char literal
+            if self.match(ud_suffix_re):
+                return ASTUserDefinedLiteral(self.definition[pos:self.pos])
             try:
                 return ASTCharLiteral(prefix, data)
             except UnicodeDecodeError as e:
@@ -4682,7 +4712,6 @@ class DefinitionParser(BaseParser):
                 self.fail("Can not handle character literal"
                           " resulting in multiple decoded characters.")
 
-        # TODO: user-defined lit
         return None
 
     def _parse_fold_or_paren_expression(self) -> ASTExpression:
diff --git a/sphinx/util/cfamily.py b/sphinx/util/cfamily.py
index 790a492a5..bd6bfe5df 100644
--- a/sphinx/util/cfamily.py
+++ b/sphinx/util/cfamily.py
@@ -67,6 +67,10 @@ char_literal_re = re.compile(r'''(?x)
     )'
 ''')
 
+# Regex for C++ user-defined literal suffix (ud-suffix):
+# must start with a letter or underscore and continue with letters, digits, or underscores
+ud_suffix_re = re.compile(r'[a-zA-Z_][a-zA-Z0-9_]*')
+
 
 def verify_description_mode(mode: str) -> None:
     if mode not in ('lastIsName', 'noneIsName', 'markType', 'markName', 'param'):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_domain_cpp.py`.
Extra Requirements: 
Purpose: I need the content of `tests/test_domain_cpp.py` to find existing tests for C++ literals, which will serve as a template for testing the new User-Defined Literal functionality.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/test_domain_cpp.py
Line number range: 1 - 1135
Content:
1. """
2.     test_domain_cpp
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests the C++ Domain
6. 
7.     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. 
13. import pytest
14. 
15. import sphinx.domains.cpp as cppDomain
16. from sphinx import addnodes
17. from sphinx.domains.cpp import DefinitionParser, DefinitionError, NoOldIdError
18. from sphinx.domains.cpp import Symbol, _max_id, _id_prefix
19. from sphinx.util import docutils
20. 
21. 
22. def parse(name, string):
23.     class Config:
24.         cpp_id_attributes = ["id_attr"]
25.         cpp_paren_attributes = ["paren_attr"]
26.     parser = DefinitionParser(string, location=None, config=Config())
27.     parser.allowFallbackExpressionParsing = False
28.     ast = parser.parse_declaration(name, name)
29.     parser.assert_end()
30.     # The scopedness would usually have been set by CPPEnumObject
31.     if name == "enum":
32.         ast.scoped = None  # simulate unscoped enum
33.     return ast
34. 
35. 
36. def _check(name, input, idDict, output):
37.     # first a simple check of the AST
38.     ast = parse(name, input)
39.     res = str(ast)
40.     if res != output:
41.         print("")
42.         print("Input:    ", input)
43.         print("Result:   ", res)
44.         print("Expected: ", output)
45.         raise DefinitionError("")
46.     rootSymbol = Symbol(None, None, None, None, None, None)
47.     symbol = rootSymbol.add_declaration(ast, docname="TestDoc")
48.     parentNode = addnodes.desc()
49.     signode = addnodes.desc_signature(input, '')
50.     parentNode += signode
51.     ast.describe_signature(signode, 'lastIsName', symbol, options={})
52. 
53.     idExpected = [None]
54.     for i in range(1, _max_id + 1):
55.         if i in idDict:
56.             idExpected.append(idDict[i])
57.         else:
58.             idExpected.append(idExpected[i - 1])
59.     idActual = [None]
60.     for i in range(1, _max_id + 1):
61.         try:
62.             id = ast.get_id(version=i)
63.             assert id is not None
64.             idActual.append(id[len(_id_prefix[i]):])
65.         except NoOldIdError:
66.             idActual.append(None)
67. 
68.     res = [True]
69.     for i in range(1, _max_id + 1):
70.         res.append(idExpected[i] == idActual[i])
71. 
72.     if not all(res):
73.         print("input:    %s" % input.rjust(20))
74.         for i in range(1, _max_id + 1):
75.             if res[i]:
76.                 continue
77.             print("Error in id version %d." % i)
78.             print("result:   %s" % idActual[i])
79.             print("expected: %s" % idExpected[i])
80.         print(rootSymbol.dump(0))
81.         raise DefinitionError("")
82. 
83. 
84. def check(name, input, idDict, output=None):
85.     if output is None:
86.         output = input
87.     # First, check without semicolon
88.     _check(name, input, idDict, output)
89.     # Second, check with semicolon
90.     _check(name, input + ' ;', idDict, output + ';')
91. 
92. 
93. def test_fundamental_types():
94.     # see https://en.cppreference.com/w/cpp/language/types
95.     for t, id_v2 in cppDomain._id_fundamental_v2.items():
96.         def makeIdV1():
97.             if t == 'decltype(auto)':
98.                 return None
99.             id = t.replace(" ", "-").replace("long", "l").replace("int", "i")
100.             id = id.replace("bool", "b").replace("char", "c")
101.             id = id.replace("wc_t", "wchar_t").replace("c16_t", "char16_t")
102.             id = id.replace("c32_t", "char32_t")
103.             return "f__%s" % id
104. 
105.         def makeIdV2():
106.             id = id_v2
107.             if t == "std::nullptr_t":
108.                 id = "NSt9nullptr_tE"
109.             return "1f%s" % id
110.         check("function", "void f(%s arg)" % t, {1: makeIdV1(), 2: makeIdV2()})
111. 
112. 
113. def test_expressions():
114.     def exprCheck(expr, id, id4=None):
115.         ids = 'IE1CIA%s_1aE'
116.         idDict = {2: ids % expr, 3: ids % id}
117.         if id4 is not None:
118.             idDict[4] = ids % id4
119.         check('class', 'template<> C<a[%s]>' % expr, idDict)
120. 
121.         class Config:
122.             cpp_id_attributes = ["id_attr"]
123.             cpp_paren_attributes = ["paren_attr"]
124. 
125.         parser = DefinitionParser(expr, location=None,
126.                                   config=Config())
127.         parser.allowFallbackExpressionParsing = False
128.         ast = parser.parse_expression()
129.         res = str(ast)
130.         if res != expr:
131.             print("")
132.             print("Input:    ", expr)
133.             print("Result:   ", res)
134.             raise DefinitionError("")
135.     # primary
136.     exprCheck('nullptr', 'LDnE')
137.     exprCheck('true', 'L1E')
138.     exprCheck('false', 'L0E')
139.     ints = ['5', '0', '075', '0x0123456789ABCDEF', '0XF', '0b1', '0B1']
140.     unsignedSuffix = ['', 'u', 'U']
141.     longSuffix = ['', 'l', 'L', 'll', 'LL']
142.     for i in ints:
143.         for u in unsignedSuffix:
144.             for l in longSuffix:
145.                 expr = i + u + l
146.                 exprCheck(expr, 'L' + expr + 'E')
147.                 expr = i + l + u
148.                 exprCheck(expr, 'L' + expr + 'E')
149.     for suffix in ['', 'f', 'F', 'l', 'L']:
150.         for e in [
151.                 '5e42', '5e+42', '5e-42',
152.                 '5.', '5.e42', '5.e+42', '5.e-42',
153.                 '.5', '.5e42', '.5e+42', '.5e-42',
154.                 '5.0', '5.0e42', '5.0e+42', '5.0e-42']:
155.             expr = e + suffix
156.             exprCheck(expr, 'L' + expr + 'E')
157.         for e in [
158.                 'ApF', 'Ap+F', 'Ap-F',
159.                 'A.', 'A.pF', 'A.p+F', 'A.p-F',
160.                 '.A', '.ApF', '.Ap+F', '.Ap-F',
161.                 'A.B', 'A.BpF', 'A.Bp+F', 'A.Bp-F']:
162.             expr = "0x" + e + suffix
163.             exprCheck(expr, 'L' + expr + 'E')
164.     exprCheck('"abc\\"cba"', 'LA8_KcE')  # string
165.     exprCheck('this', 'fpT')
166.     # character literals
167.     for p, t in [('', 'c'), ('u8', 'c'), ('u', 'Ds'), ('U', 'Di'), ('L', 'w')]:
168.         exprCheck(p + "'a'", t + "97")
169.         exprCheck(p + "'\\n'", t + "10")
170.         exprCheck(p + "'\\012'", t + "10")
171.         exprCheck(p + "'\\0'", t + "0")
172.         exprCheck(p + "'\\x0a'", t + "10")
173.         exprCheck(p + "'\\x0A'", t + "10")
174.         exprCheck(p + "'\\u0a42'", t + "2626")
175.         exprCheck(p + "'\\u0A42'", t + "2626")
176.         exprCheck(p + "'\\U0001f34c'", t + "127820")
177.         exprCheck(p + "'\\U0001F34C'", t + "127820")
178. 
179.     # TODO: user-defined lit
180.     exprCheck('(... + Ns)', '(... + Ns)', id4='flpl2Ns')
181.     exprCheck('(Ns + ...)', '(Ns + ...)', id4='frpl2Ns')
182.     exprCheck('(Ns + ... + 0)', '(Ns + ... + 0)', id4='fLpl2NsL0E')
183.     exprCheck('(5)', 'L5E')
184.     exprCheck('C', '1C')
185.     # postfix
186.     exprCheck('A(2)', 'cl1AL2EE')
187.     exprCheck('A[2]', 'ix1AL2E')
188.     exprCheck('a.b.c', 'dtdt1a1b1c')
189.     exprCheck('a->b->c', 'ptpt1a1b1c')
190.     exprCheck('i++', 'pp1i')
191.     exprCheck('i--', 'mm1i')
192.     exprCheck('dynamic_cast<T&>(i)++', 'ppdcR1T1i')
193.     exprCheck('static_cast<T&>(i)++', 'ppscR1T1i')
194.     exprCheck('reinterpret_cast<T&>(i)++', 'pprcR1T1i')
195.     exprCheck('const_cast<T&>(i)++', 'ppccR1T1i')
196.     exprCheck('typeid(T).name', 'dtti1T4name')
197.     exprCheck('typeid(a + b).name', 'dttepl1a1b4name')
198.     # unary
199.     exprCheck('++5', 'pp_L5E')
200.     exprCheck('--5', 'mm_L5E')
201.     exprCheck('*5', 'deL5E')
202.     exprCheck('&5', 'adL5E')
203.     exprCheck('+5', 'psL5E')
204.     exprCheck('-5', 'ngL5E')
205.     exprCheck('!5', 'ntL5E')
206.     exprCheck('not 5', 'ntL5E')
207.     exprCheck('~5', 'coL5E')
208.     exprCheck('compl 5', 'coL5E')
209.     exprCheck('sizeof...(a)', 'sZ1a')
210.     exprCheck('sizeof(T)', 'st1T')
211.     exprCheck('sizeof -42', 'szngL42E')
212.     exprCheck('alignof(T)', 'at1T')
213.     exprCheck('noexcept(-42)', 'nxngL42E')
214.     # new-expression
215.     exprCheck('new int', 'nw_iE')
216.     exprCheck('new volatile int', 'nw_ViE')
217.     exprCheck('new int[42]', 'nw_AL42E_iE')
218.     exprCheck('new int()', 'nw_ipiE')
219.     exprCheck('new int(5, 42)', 'nw_ipiL5EL42EE')
220.     exprCheck('::new int', 'nw_iE')
221.     exprCheck('new int{}', 'nw_iilE')
222.     exprCheck('new int{5, 42}', 'nw_iilL5EL42EE')
223.     # delete-expression
224.     exprCheck('delete p', 'dl1p')
225.     exprCheck('delete [] p', 'da1p')
226.     exprCheck('::delete p', 'dl1p')
227.     exprCheck('::delete [] p', 'da1p')
228.     # cast
229.     exprCheck('(int)2', 'cviL2E')
230.     # binary op
231.     exprCheck('5 || 42', 'ooL5EL42E')
232.     exprCheck('5 or 42', 'ooL5EL42E')
233.     exprCheck('5 && 42', 'aaL5EL42E')
234.     exprCheck('5 and 42', 'aaL5EL42E')
235.     exprCheck('5 | 42', 'orL5EL42E')
236.     exprCheck('5 bitor 42', 'orL5EL42E')
237.     exprCheck('5 ^ 42', 'eoL5EL42E')
238.     exprCheck('5 xor 42', 'eoL5EL42E')
239.     exprCheck('5 & 42', 'anL5EL42E')
240.     exprCheck('5 bitand 42', 'anL5EL42E')
241.     # ['==', '!=']
242.     exprCheck('5 == 42', 'eqL5EL42E')
243.     exprCheck('5 != 42', 'neL5EL42E')
244.     exprCheck('5 not_eq 42', 'neL5EL42E')
245.     # ['<=', '>=', '<', '>']
246.     exprCheck('5 <= 42', 'leL5EL42E')
247.     exprCheck('A <= 42', 'le1AL42E')
248.     exprCheck('5 >= 42', 'geL5EL42E')
249.     exprCheck('5 < 42', 'ltL5EL42E')
250.     exprCheck('A < 42', 'lt1AL42E')
251.     exprCheck('5 > 42', 'gtL5EL42E')
252.     # ['<<', '>>']
253.     exprCheck('5 << 42', 'lsL5EL42E')
254.     exprCheck('A << 42', 'ls1AL42E')
255.     exprCheck('5 >> 42', 'rsL5EL42E')
256.     # ['+', '-']
257.     exprCheck('5 + 42', 'plL5EL42E')
258.     exprCheck('5 - 42', 'miL5EL42E')
259.     # ['*', '/', '%']
260.     exprCheck('5 * 42', 'mlL5EL42E')
261.     exprCheck('5 / 42', 'dvL5EL42E')
262.     exprCheck('5 % 42', 'rmL5EL42E')
263.     # ['.*', '->*']
264.     exprCheck('5 .* 42', 'dsL5EL42E')
265.     exprCheck('5 ->* 42', 'pmL5EL42E')
266.     # conditional
267.     # TODO
268.     # assignment
269.     exprCheck('a = 5', 'aS1aL5E')
270.     exprCheck('a *= 5', 'mL1aL5E')
271.     exprCheck('a /= 5', 'dV1aL5E')
272.     exprCheck('a %= 5', 'rM1aL5E')
273.     exprCheck('a += 5', 'pL1aL5E')
274.     exprCheck('a -= 5', 'mI1aL5E')
275.     exprCheck('a >>= 5', 'rS1aL5E')
276.     exprCheck('a <<= 5', 'lS1aL5E')
277.     exprCheck('a &= 5', 'aN1aL5E')
278.     exprCheck('a and_eq 5', 'aN1aL5E')
279.     exprCheck('a ^= 5', 'eO1aL5E')
280.     exprCheck('a xor_eq 5', 'eO1aL5E')
281.     exprCheck('a |= 5', 'oR1aL5E')
282.     exprCheck('a or_eq 5', 'oR1aL5E')
283.     exprCheck('a = {1, 2, 3}', 'aS1ailL1EL2EL3EE')
284.     # comma operator
285.     exprCheck('a, 5', 'cm1aL5E')
286. 
287.     # Additional tests
288.     # a < expression that starts with something that could be a template
289.     exprCheck('A < 42', 'lt1AL42E')
290.     check('function', 'template<> void f(A<B, 2> &v)',
291.           {2: "IE1fR1AI1BX2EE", 3: "IE1fR1AI1BXL2EEE", 4: "IE1fvR1AI1BXL2EEE"})
292.     exprCheck('A<1>::value', 'N1AIXL1EEE5valueE')
293.     check('class', "template<int T = 42> A", {2: "I_iE1A"})
294.     check('enumerator', 'A = std::numeric_limits<unsigned long>::max()', {2: "1A"})
295. 
296.     exprCheck('operator()()', 'clclE')
297.     exprCheck('operator()<int>()', 'clclIiEE')
298. 
299.     # pack expansion
300.     exprCheck('a(b(c, 1 + d...)..., e(f..., g))', 'cl1aspcl1b1cspplL1E1dEcl1esp1f1gEE')
301. 
302. 
303. def test_type_definitions():
304.     check("type", "public bool b", {1: "b", 2: "1b"}, "bool b")
305.     check("type", "bool A::b", {1: "A::b", 2: "N1A1bE"})
306.     check("type", "bool *b", {1: "b", 2: "1b"})
307.     check("type", "bool *const b", {1: "b", 2: "1b"})
308.     check("type", "bool *volatile const b", {1: "b", 2: "1b"})
309.     check("type", "bool *volatile const b", {1: "b", 2: "1b"})
310.     check("type", "bool *volatile const *b", {1: "b", 2: "1b"})
311.     check("type", "bool &b", {1: "b", 2: "1b"})
312.     check("type", "bool b[]", {1: "b", 2: "1b"})
313.     check("type", "std::pair<int, int> coord", {1: "coord", 2: "5coord"})
314.     check("type", "long long int foo", {1: "foo", 2: "3foo"})
315.     check("type", 'std::vector<std::pair<std::string, long long>> module::blah',
316.           {1: "module::blah", 2: "N6module4blahE"})
317.     check("type", "std::function<void()> F", {1: "F", 2: "1F"})
318.     check("type", "std::function<R(A1, A2)> F", {1: "F", 2: "1F"})
319.     check("type", "std::function<R(A1, A2, A3)> F", {1: "F", 2: "1F"})
320.     check("type", "std::function<R(A1, A2, A3, As...)> F", {1: "F", 2: "1F"})
321.     check("type", "MyContainer::const_iterator",
322.           {1: "MyContainer::const_iterator", 2: "N11MyContainer14const_iteratorE"})
323.     check("type",
324.           "public MyContainer::const_iterator",
325.           {1: "MyContainer::const_iterator", 2: "N11MyContainer14const_iteratorE"},
326.           output="MyContainer::const_iterator")
327.     # test decl specs on right
328.     check("type", "bool const b", {1: "b", 2: "1b"})
329.     # test name in global scope
330.     check("type", "bool ::B::b", {1: "B::b", 2: "N1B1bE"})
331. 
332.     check('type', 'A = B', {2: '1A'})
333.     check('type', 'A = decltype(b)', {2: '1A'})
334. 
335.     # from breathe#267 (named function parameters for function pointers
336.     check('type', 'void (*gpio_callback_t)(struct device *port, uint32_t pin)',
337.           {1: 'gpio_callback_t', 2: '15gpio_callback_t'})
338.     check('type', 'void (*f)(std::function<void(int i)> g)', {1: 'f', 2: '1f'})
339. 
340.     check('type', 'T = A::template B<int>::template C<double>', {2: '1T'})
341. 
342.     check('type', 'T = Q<A::operator()>', {2: '1T'})
343.     check('type', 'T = Q<A::operator()<int>>', {2: '1T'})
344.     check('type', 'T = Q<A::operator bool>', {2: '1T'})
345. 
346. 
347. def test_concept_definitions():
348.     check('concept', 'template<typename Param> A::B::Concept',
349.           {2: 'I0EN1A1B7ConceptE'})
350.     check('concept', 'template<typename A, typename B, typename ...C> Foo',
351.           {2: 'I00DpE3Foo'})
352.     with pytest.raises(DefinitionError):
353.         parse('concept', 'Foo')
354.     with pytest.raises(DefinitionError):
355.         parse('concept', 'template<typename T> template<typename U> Foo')
356. 
357. 
358. def test_member_definitions():
359.     check('member', '  const  std::string  &  name = 42',
360.           {1: "name__ssCR", 2: "4name"}, output='const std::string &name = 42')
361.     check('member', '  const  std::string  &  name', {1: "name__ssCR", 2: "4name"},
362.           output='const std::string &name')
363.     check('member', '  const  std::string  &  name [ n ]',
364.           {1: "name__ssCRA", 2: "4name"}, output='const std::string &name[n]')
365.     check('member', 'const std::vector< unsigned int, long> &name',
366.           {1: "name__std::vector:unsigned-i.l:CR", 2: "4name"},
367.           output='const std::vector<unsigned int, long> &name')
368.     check('member', 'module::myclass foo[n]', {1: "foo__module::myclassA", 2: "3foo"})
369.     check('member', 'int *const p', {1: 'p__iPC', 2: '1p'})
370.     check('member', 'extern int myInt', {1: 'myInt__i', 2: '5myInt'})
371.     check('member', 'thread_local int myInt', {1: 'myInt__i', 2: '5myInt'})
372.     check('member', 'extern thread_local int myInt', {1: 'myInt__i', 2: '5myInt'})
373.     check('member', 'thread_local extern int myInt', {1: 'myInt__i', 2: '5myInt'},
374.           'extern thread_local int myInt')
375. 
376.     # tests based on https://en.cppreference.com/w/cpp/language/bit_field
377.     check('member', 'int b : 3', {1: 'b__i', 2: '1b'})
378.     check('member', 'int b : 8 = 42', {1: 'b__i', 2: '1b'})
379.     check('member', 'int b : 8{42}', {1: 'b__i', 2: '1b'})
380.     # TODO: enable once the ternary operator is supported
381.     #check('member', 'int b : true ? 8 : a = 42', {1: 'b__i', 2: '1b'})
382.     # TODO: enable once the ternary operator is supported
383.     #check('member', 'int b : (true ? 8 : a) = 42', {1: 'b__i', 2: '1b'})
384.     check('member', 'int b : 1 || new int{0}', {1: 'b__i', 2: '1b'})
385. 
386. 
387. def test_function_definitions():
388.     check('function', 'void f(volatile int)', {1: "f__iV", 2: "1fVi"})
389.     check('function', 'void f(std::size_t)', {1: "f__std::s", 2: "1fNSt6size_tE"})
390.     check('function', 'operator bool() const', {1: "castto-b-operatorC", 2: "NKcvbEv"})
391.     check('function', 'A::operator bool() const',
392.           {1: "A::castto-b-operatorC", 2: "NK1AcvbEv"})
393.     check('function', 'A::operator bool() volatile const &',
394.           {1: "A::castto-b-operatorVCR", 2: "NVKR1AcvbEv"})
395.     check('function', 'A::operator bool() volatile const &&',
396.           {1: "A::castto-b-operatorVCO", 2: "NVKO1AcvbEv"})
397.     check('function', 'bool namespaced::theclass::method(arg1, arg2)',
398.           {1: "namespaced::theclass::method__arg1.arg2",
399.            2: "N10namespaced8theclass6methodE4arg14arg2"})
400.     x = 'std::vector<std::pair<std::string, int>> &module::test(register int ' \
401.         'foo, bar, std::string baz = "foobar, blah, bleh") const = 0'
402.     check('function', x, {1: "module::test__i.bar.ssC",
403.                           2: "NK6module4testEi3barNSt6stringE"})
404.     check('function', 'void f(std::pair<A, B>)',
405.           {1: "f__std::pair:A.B:", 2: "1fNSt4pairI1A1BEE"})
406.     check('function', 'explicit module::myclass::foo::foo()',
407.           {1: "module::myclass::foo::foo", 2: "N6module7myclass3foo3fooEv"})
408.     check('function', 'module::myclass::foo::~foo()',
409.           {1: "module::myclass::foo::~foo", 2: "N6module7myclass3fooD0Ev"})
410.     check('function', 'int printf(const char *fmt, ...)',
411.           {1: "printf__cCP.z", 2: "6printfPKcz"})
412.     check('function', 'int foo(const unsigned int j)',
413.           {1: "foo__unsigned-iC", 2: "3fooKj"})
414.     check('function', 'int foo(const int *const ptr)',
415.           {1: "foo__iCPC", 2: "3fooPCKi"})
416.     check('function', 'module::myclass::operator std::vector<std::string>()',
417.           {1: "module::myclass::castto-std::vector:ss:-operator",
418.            2: "N6module7myclasscvNSt6vectorINSt6stringEEEEv"})
419.     check('function',
420.           'void operator()(const boost::array<VertexID, 2> &v) const',
421.           {1: "call-operator__boost::array:VertexID.2:CRC",
422.            2: "NKclERKN5boost5arrayI8VertexIDX2EEE",
423.            3: "NKclERKN5boost5arrayI8VertexIDXL2EEEE"})
424.     check('function',
425.           'void operator()(const boost::array<VertexID, 2, "foo,  bar"> &v) const',
426.           {1: 'call-operator__boost::array:VertexID.2."foo,--bar":CRC',
427.            2: 'NKclERKN5boost5arrayI8VertexIDX2EX"foo,  bar"EEE',
428.            3: 'NKclERKN5boost5arrayI8VertexIDXL2EEXLA9_KcEEEE'})
429.     check('function', 'MyClass::MyClass(MyClass::MyClass&&)',
430.           {1: "MyClass::MyClass__MyClass::MyClassRR",
431.            2: "N7MyClass7MyClassERRN7MyClass7MyClassE"})
432.     check('function', 'constexpr int get_value()', {1: "get_valueCE", 2: "9get_valuev"})
433.     check('function', 'static constexpr int get_value()',
434.           {1: "get_valueCE", 2: "9get_valuev"})
435.     check('function', 'int get_value() const noexcept',
436.           {1: "get_valueC", 2: "NK9get_valueEv"})
437.     check('function', 'int get_value() const noexcept(std::is_nothrow_move_constructible<T>::value)',
438.           {1: "get_valueC", 2: "NK9get_valueEv"})
439.     check('function', 'int get_value() const noexcept("see below")',
440.           {1: "get_valueC", 2: "NK9get_valueEv"})
441.     check('function', 'int get_value() const noexcept = delete',
442.           {1: "get_valueC", 2: "NK9get_valueEv"})
443.     check('function', 'int get_value() volatile const',
444.           {1: "get_valueVC", 2: "NVK9get_valueEv"})
445.     check('function', 'MyClass::MyClass(MyClass::MyClass&&) = default',
446.           {1: "MyClass::MyClass__MyClass::MyClassRR",
447.            2: "N7MyClass7MyClassERRN7MyClass7MyClassE"})
448.     check('function', 'virtual MyClass::a_virtual_function() const override',
449.           {1: "MyClass::a_virtual_functionC", 2: "NK7MyClass18a_virtual_functionEv"})
450.     check('function', 'A B() override', {1: "B", 2: "1Bv"})
451.     check('function', 'A B() final', {1: "B", 2: "1Bv"})
452.     check('function', 'A B() final override', {1: "B", 2: "1Bv"})
453.     check('function', 'A B() override final', {1: "B", 2: "1Bv"},
454.           output='A B() final override')
455.     check('function', 'MyClass::a_member_function() volatile',
456.           {1: "MyClass::a_member_functionV", 2: "NV7MyClass17a_member_functionEv"})
457.     check('function', 'MyClass::a_member_function() volatile const',
458.           {1: "MyClass::a_member_functionVC", 2: "NVK7MyClass17a_member_functionEv"})
459.     check('function', 'MyClass::a_member_function() &&',
460.           {1: "MyClass::a_member_functionO", 2: "NO7MyClass17a_member_functionEv"})
461.     check('function', 'MyClass::a_member_function() &',
462.           {1: "MyClass::a_member_functionR", 2: "NR7MyClass17a_member_functionEv"})
463.     check('function', 'MyClass::a_member_function() const &',
464.           {1: "MyClass::a_member_functionCR", 2: "NKR7MyClass17a_member_functionEv"})
465.     check('function', 'int main(int argc, char *argv[])',
466.           {1: "main__i.cPA", 2: "4mainiA_Pc"})
467.     check('function', 'MyClass &MyClass::operator++()',
468.           {1: "MyClass::inc-operator", 2: "N7MyClassppEv"})
469.     check('function', 'MyClass::pointer MyClass::operator->()',
470.           {1: "MyClass::pointer-operator", 2: "N7MyClassptEv"})
471. 
472.     x = 'std::vector<std::pair<std::string, int>> &module::test(register int ' \
473.         'foo, bar[n], std::string baz = "foobar, blah, bleh") const = 0'
474.     check('function', x, {1: "module::test__i.barA.ssC",
475.                           2: "NK6module4testEiAn_3barNSt6stringE",
476.                           3: "NK6module4testEiA1n_3barNSt6stringE"})
477.     check('function',
478.           'int foo(Foo f = Foo(double(), std::make_pair(int(2), double(3.4))))',
479.           {1: "foo__Foo", 2: "3foo3Foo"})
480.     check('function', 'int foo(A a = x(a))', {1: "foo__A", 2: "3foo1A"})
481.     with pytest.raises(DefinitionError):
482.         parse('function', 'int foo(B b=x(a)')
483.     with pytest.raises(DefinitionError):
484.         parse('function', 'int foo)C c=x(a))')
485.     with pytest.raises(DefinitionError):
486.         parse('function', 'int foo(D d=x(a')
487.     check('function', 'int foo(const A&... a)', {1: "foo__ACRDp", 2: "3fooDpRK1A"})
488.     check('function', 'int foo(const A&...)', {1: "foo__ACRDp", 2: "3fooDpRK1A"})
489.     check('function', 'int foo(const A*... a)', {1: "foo__ACPDp", 2: "3fooDpPK1A"})
490.     check('function', 'int foo(const A*...)', {1: "foo__ACPDp", 2: "3fooDpPK1A"})
491.     check('function', 'int foo(const int A::*... a)', {2: "3fooDpM1AKi"})
492.     check('function', 'int foo(const int A::*...)', {2: "3fooDpM1AKi"})
493.     #check('function', 'int foo(int (*a)(A)...)', {1: "foo__ACRDp", 2: "3fooDpPK1A"})
494.     #check('function', 'int foo(int (*)(A)...)', {1: "foo__ACRDp", 2: "3fooDpPK1A"})
495.     check('function', 'virtual void f()', {1: "f", 2: "1fv"})
496.     # test for ::nestedName, from issue 1738
497.     check("function", "result(int val, ::std::error_category const &cat)",
498.           {1: "result__i.std::error_categoryCR", 2: "6resultiRKNSt14error_categoryE"})
499.     check("function", "int *f()", {1: "f", 2: "1fv"})
500.     # tests derived from issue #1753 (skip to keep sanity)
501.     check("function", "f(int (&array)[10])", {2: "1fRA10_i", 3: "1fRAL10E_i"})
502.     check("function", "void f(int (&array)[10])", {2: "1fRA10_i", 3: "1fRAL10E_i"})
503.     check("function", "void f(float *q(double))", {2: "1fFPfdE"})
504.     check("function", "void f(float *(*q)(double))", {2: "1fPFPfdE"})
505.     check("function", "void f(float (*q)(double))", {2: "1fPFfdE"})
506.     check("function", "int (*f(double d))(float)", {1: "f__double", 2: "1fd"})
507.     check("function", "int (*f(bool b))[5]", {1: "f__b", 2: "1fb"})
508.     check("function", "int (*A::f(double d) const)(float)",
509.           {1: "A::f__doubleC", 2: "NK1A1fEd"})
510.     check("function", "void f(std::shared_ptr<int(double)> ptr)",
511.           {2: "1fNSt10shared_ptrIFidEEE"})
512.     check("function", "void f(int *const p)", {1: "f__iPC", 2: "1fPCi"})
513.     check("function", "void f(int *volatile const p)", {1: "f__iPVC", 2: "1fPVCi"})
514. 
515.     check('function', 'extern int f()', {1: 'f', 2: '1fv'})
516. 
517.     check('function', 'decltype(auto) f()', {1: 'f', 2: "1fv"})
518. 
519.     # TODO: make tests for functions in a template, e.g., Test<int&&()>
520.     # such that the id generation for function type types is correct.
521. 
522.     check('function', 'friend std::ostream &f(std::ostream &s, int i)',
523.           {1: 'f__osR.i', 2: '1fRNSt7ostreamEi'})
524. 
525.     # from breathe#223
526.     check('function', 'void f(struct E e)', {1: 'f__E', 2: '1f1E'})
527.     check('function', 'void f(class E e)', {1: 'f__E', 2: '1f1E'})
528.     check('function', 'void f(typename E e)', {1: 'f__E', 2: '1f1E'})
529.     check('function', 'void f(enum E e)', {1: 'f__E', 2: '1f1E'})
530.     check('function', 'void f(union E e)', {1: 'f__E', 2: '1f1E'})
531. 
532.     # pointer to member (function)
533.     check('function', 'void f(int C::*)', {2: '1fM1Ci'})
534.     check('function', 'void f(int C::* p)', {2: '1fM1Ci'})
535.     check('function', 'void f(int ::C::* p)', {2: '1fM1Ci'})
536.     check('function', 'void f(int C::*const)', {2: '1fKM1Ci'})
537.     check('function', 'void f(int C::*const&)', {2: '1fRKM1Ci'})
538.     check('function', 'void f(int C::*volatile)', {2: '1fVM1Ci'})
539.     check('function', 'void f(int C::*const volatile)', {2: '1fVKM1Ci'},
540.           output='void f(int C::*volatile const)')
541.     check('function', 'void f(int C::*volatile const)', {2: '1fVKM1Ci'})
542.     check('function', 'void f(int (C::*)(float, double))', {2: '1fM1CFifdE'})
543.     check('function', 'void f(int (C::* p)(float, double))', {2: '1fM1CFifdE'})
544.     check('function', 'void f(int (::C::* p)(float, double))', {2: '1fM1CFifdE'})
545.     check('function', 'void f(void (C::*)() const &)', {2: '1fM1CKRFvvE'})
546.     check('function', 'int C::* f(int, double)', {2: '1fid'})
547.     check('function', 'void f(int C::* *p)', {2: '1fPM1Ci'})
548.     check('function', 'void f(int C::**)', {2: '1fPM1Ci'})
549.     check('function', 'void f(int C::*const *p)', {2: '1fPKM1Ci'})
550.     check('function', 'void f(int C::*const*)', {2: '1fPKM1Ci'})
551. 
552.     # exceptions from return type mangling
553.     check('function', 'template<typename T> C()', {2: 'I0E1Cv'})
554.     check('function', 'template<typename T> operator int()', {1: None, 2: 'I0Ecviv'})
555. 
556. 
557. def test_operators():
558.     check('function', 'void operator new()', {1: "new-operator", 2: "nwv"})
559.     check('function', 'void operator new[]()', {1: "new-array-operator", 2: "nav"})
560.     check('function', 'void operator delete()', {1: "delete-operator", 2: "dlv"})
561.     check('function', 'void operator delete[]()', {1: "delete-array-operator", 2: "dav"})
562.     check('function', 'operator bool() const', {1: "castto-b-operatorC", 2: "NKcvbEv"})
563.     check('function', 'void operator""_udl()', {2: 'li4_udlv'})
564. 
565.     check('function', 'void operator~()', {1: "inv-operator", 2: "cov"})
566.     check('function', 'void operator compl()', {2: "cov"})
567.     check('function', 'void operator+()', {1: "add-operator", 2: "plv"})
568.     check('function', 'void operator-()', {1: "sub-operator", 2: "miv"})
569.     check('function', 'void operator*()', {1: "mul-operator", 2: "mlv"})
570.     check('function', 'void operator/()', {1: "div-operator", 2: "dvv"})
571.     check('function', 'void operator%()', {1: "mod-operator", 2: "rmv"})
572.     check('function', 'void operator&()', {1: "and-operator", 2: "anv"})
573.     check('function', 'void operator bitand()', {2: "anv"})
574.     check('function', 'void operator|()', {1: "or-operator", 2: "orv"})
575.     check('function', 'void operator bitor()', {2: "orv"})
576.     check('function', 'void operator^()', {1: "xor-operator", 2: "eov"})
577.     check('function', 'void operator xor()', {2: "eov"})
578.     check('function', 'void operator=()', {1: "assign-operator", 2: "aSv"})
579.     check('function', 'void operator+=()', {1: "add-assign-operator", 2: "pLv"})
580.     check('function', 'void operator-=()', {1: "sub-assign-operator", 2: "mIv"})
581.     check('function', 'void operator*=()', {1: "mul-assign-operator", 2: "mLv"})
582.     check('function', 'void operator/=()', {1: "div-assign-operator", 2: "dVv"})
583.     check('function', 'void operator%=()', {1: "mod-assign-operator", 2: "rMv"})
584.     check('function', 'void operator&=()', {1: "and-assign-operator", 2: "aNv"})
585.     check('function', 'void operator and_eq()', {2: "aNv"})
586.     check('function', 'void operator|=()', {1: "or-assign-operator", 2: "oRv"})
587.     check('function', 'void operator or_eq()', {2: "oRv"})
588.     check('function', 'void operator^=()', {1: "xor-assign-operator", 2: "eOv"})
589.     check('function', 'void operator xor_eq()', {2: "eOv"})
590.     check('function', 'void operator<<()', {1: "lshift-operator", 2: "lsv"})
591.     check('function', 'void operator>>()', {1: "rshift-operator", 2: "rsv"})
592.     check('function', 'void operator<<=()', {1: "lshift-assign-operator", 2: "lSv"})
593.     check('function', 'void operator>>=()', {1: "rshift-assign-operator", 2: "rSv"})
594.     check('function', 'void operator==()', {1: "eq-operator", 2: "eqv"})
595.     check('function', 'void operator!=()', {1: "neq-operator", 2: "nev"})
596.     check('function', 'void operator not_eq()', {2: "nev"})
597.     check('function', 'void operator<()', {1: "lt-operator", 2: "ltv"})
598.     check('function', 'void operator>()', {1: "gt-operator", 2: "gtv"})
599.     check('function', 'void operator<=()', {1: "lte-operator", 2: "lev"})
600.     check('function', 'void operator>=()', {1: "gte-operator", 2: "gev"})
601.     check('function', 'void operator!()', {1: "not-operator", 2: "ntv"})
602.     check('function', 'void operator not()', {2: "ntv"})
603.     check('function', 'void operator&&()', {1: "sand-operator", 2: "aav"})
604.     check('function', 'void operator and()', {2: "aav"})
605.     check('function', 'void operator||()', {1: "sor-operator", 2: "oov"})
606.     check('function', 'void operator or()', {2: "oov"})
607.     check('function', 'void operator++()', {1: "inc-operator", 2: "ppv"})
608.     check('function', 'void operator--()', {1: "dec-operator", 2: "mmv"})
609.     check('function', 'void operator,()', {1: "comma-operator", 2: "cmv"})
610.     check('function', 'void operator->*()', {1: "pointer-by-pointer-operator", 2: "pmv"})
611.     check('function', 'void operator->()', {1: "pointer-operator", 2: "ptv"})
612.     check('function', 'void operator()()', {1: "call-operator", 2: "clv"})
613.     check('function', 'void operator[]()', {1: "subscript-operator", 2: "ixv"})
614. 
615. 
616. def test_class_definitions():
617.     check('class', 'public A', {1: "A", 2: "1A"}, output='A')
618.     check('class', 'private A', {1: "A", 2: "1A"})
619.     check('class', 'A final', {1: 'A', 2: '1A'})
620. 
621.     # test bases
622.     check('class', 'A', {1: "A", 2: "1A"})
623.     check('class', 'A::B::C', {1: "A::B::C", 2: "N1A1B1CE"})
624.     check('class', 'A : B', {1: "A", 2: "1A"})
625.     check('class', 'A : private B', {1: "A", 2: "1A"})
626.     check('class', 'A : public B', {1: "A", 2: "1A"})
627.     check('class', 'A : B, C', {1: "A", 2: "1A"})
628.     check('class', 'A : B, protected C, D', {1: "A", 2: "1A"})
629.     check('class', 'A : virtual private B', {1: 'A', 2: '1A'}, output='A : private virtual B')
630.     check('class', 'A : private virtual B', {1: 'A', 2: '1A'})
631.     check('class', 'A : B, virtual C', {1: 'A', 2: '1A'})
632.     check('class', 'A : public virtual B', {1: 'A', 2: '1A'})
633.     check('class', 'A : B, C...', {1: 'A', 2: '1A'})
634.     check('class', 'A : B..., C', {1: 'A', 2: '1A'})
635. 
636.     # from #4094
637.     check('class', 'template<class, class = std::void_t<>> has_var', {2: 'I00E7has_var'})
638.     check('class', 'template<class T> has_var<T, std::void_t<decltype(&T::var)>>',
639.           {2: 'I0E7has_varI1TNSt6void_tIDTadN1T3varEEEEE'})
640. 
641. 
642.     check('class', 'template<typename ...Ts> T<int (*)(Ts)...>',
643.           {2: 'IDpE1TIJPFi2TsEEE'})
644.     check('class', 'template<int... Is> T<(Is)...>',
645.           {2: 'I_DpiE1TIJX(Is)EEE', 3: 'I_DpiE1TIJX2IsEEE'})
646. 
647. 
648. def test_union_definitions():
649.     check('union', 'A', {2: "1A"})
650. 
651. 
652. def test_enum_definitions():
653.     check('enum', 'A', {2: "1A"})
654.     check('enum', 'A : std::underlying_type<B>::type', {2: "1A"})
655.     check('enum', 'A : unsigned int', {2: "1A"})
656.     check('enum', 'public A', {2: "1A"}, output='A')
657.     check('enum', 'private A', {2: "1A"})
658. 
659.     check('enumerator', 'A', {2: "1A"})
660.     check('enumerator', 'A = std::numeric_limits<unsigned long>::max()', {2: "1A"})
661. 
662. 
663. def test_anon_definitions():
664.     check('class', '@a', {3: "Ut1_a"})
665.     check('union', '@a', {3: "Ut1_a"})
666.     check('enum', '@a', {3: "Ut1_a"})
667.     check('class', '@1', {3: "Ut1_1"})
668.     check('class', '@a::A', {3: "NUt1_a1AE"})
669. 
670. 
671. def test_templates():
672.     check('class', "A<T>", {2: "IE1AI1TE"}, output="template<> A<T>")
673.     # first just check which objects support templating
674.     check('class', "template<> A", {2: "IE1A"})
675.     check('function', "template<> void A()", {2: "IE1Av", 4: "IE1Avv"})
676.     check('member', "template<> A a", {2: "IE1a"})
677.     check('type', "template<> a = A", {2: "IE1a"})
678.     with pytest.raises(DefinitionError):
679.         parse('enum', "template<> A")
680.     with pytest.raises(DefinitionError):
681.         parse('enumerator', "template<> A")
682.     # then all the real tests
683.     check('class', "template<typename T1, typename T2> A", {2: "I00E1A"})
684.     check('type', "template<> a", {2: "IE1a"})
685. 
686.     check('class', "template<typename T> A", {2: "I0E1A"})
687.     check('class', "template<class T> A", {2: "I0E1A"})
688.     check('class', "template<typename ...T> A", {2: "IDpE1A"})
689.     check('class', "template<typename...> A", {2: "IDpE1A"})
690.     check('class', "template<typename = Test> A", {2: "I0E1A"})
691.     check('class', "template<typename T = Test> A", {2: "I0E1A"})
692. 
693.     check('class', "template<template<typename> typename T> A", {2: "II0E0E1A"})
694.     check('class', "template<template<typename> typename> A", {2: "II0E0E1A"})
695.     check('class', "template<template<typename> typename ...T> A", {2: "II0EDpE1A"})
696.     check('class', "template<template<typename> typename...> A", {2: "II0EDpE1A"})
697. 
698.     check('class', "template<int> A", {2: "I_iE1A"})
699.     check('class', "template<int T> A", {2: "I_iE1A"})
700.     check('class', "template<int... T> A", {2: "I_DpiE1A"})
701.     check('class', "template<int T = 42> A", {2: "I_iE1A"})
702.     check('class', "template<int = 42> A", {2: "I_iE1A"})
703. 
704.     check('class', "template<> A<NS::B<>>", {2: "IE1AIN2NS1BIEEE"})
705. 
706.     # from #2058
707.     check('function',
708.           "template<typename Char, typename Traits> "
709.           "inline std::basic_ostream<Char, Traits> &operator<<("
710.           "std::basic_ostream<Char, Traits> &os, "
711.           "const c_string_view_base<const Char, Traits> &str)",
712.           {2: "I00ElsRNSt13basic_ostreamI4Char6TraitsEE"
713.               "RK18c_string_view_baseIK4Char6TraitsE",
714.            4: "I00Els"
715.               "RNSt13basic_ostreamI4Char6TraitsEE"
716.               "RNSt13basic_ostreamI4Char6TraitsEE"
717.               "RK18c_string_view_baseIK4Char6TraitsE"})
718. 
719.     # template introductions
720.     with pytest.raises(DefinitionError):
721.         parse('enum', 'abc::ns::foo{id_0, id_1, id_2} A')
722.     with pytest.raises(DefinitionError):
723.         parse('enumerator', 'abc::ns::foo{id_0, id_1, id_2} A')
724.     check('class', 'abc::ns::foo{id_0, id_1, id_2} xyz::bar',
725.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barE'})
726.     check('class', 'abc::ns::foo{id_0, id_1, ...id_2} xyz::bar',
727.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barE'})
728.     check('class', 'abc::ns::foo{id_0, id_1, id_2} xyz::bar<id_0, id_1, id_2>',
729.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barI4id_04id_14id_2EE'})
730.     check('class', 'abc::ns::foo{id_0, id_1, ...id_2} xyz::bar<id_0, id_1, id_2...>',
731.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barI4id_04id_1Dp4id_2EE'})
732. 
733.     check('class', 'template<> Concept{U} A<int>::B', {2: 'IEI0EX7ConceptI1UEEN1AIiE1BE'})
734. 
735.     check('type', 'abc::ns::foo{id_0, id_1, id_2} xyz::bar = ghi::qux',
736.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barE'})
737.     check('type', 'abc::ns::foo{id_0, id_1, ...id_2} xyz::bar = ghi::qux',
738.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barE'})
739.     check('function', 'abc::ns::foo{id_0, id_1, id_2} void xyz::bar()',
740.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barEv',
741.            4: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barEvv'})
742.     check('function', 'abc::ns::foo{id_0, id_1, ...id_2} void xyz::bar()',
743.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barEv',
744.            4: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barEvv'})
745.     check('member', 'abc::ns::foo{id_0, id_1, id_2} ghi::qux xyz::bar',
746.           {2: 'I000EXN3abc2ns3fooEI4id_04id_14id_2EEN3xyz3barE'})
747.     check('member', 'abc::ns::foo{id_0, id_1, ...id_2} ghi::qux xyz::bar',
748.           {2: 'I00DpEXN3abc2ns3fooEI4id_04id_1sp4id_2EEN3xyz3barE'})
749.     check('concept', 'Iterator{T, U} Another', {2: 'I00EX8IteratorI1T1UEE7Another'})
750.     check('concept', 'template<typename ...Pack> Numerics = (... && Numeric<Pack>)',
751.           {2: 'IDpE8Numerics'})
752. 
753.     # explicit specializations of members
754.     check('member', 'template<> int A<int>::a', {2: 'IEN1AIiE1aE'})
755.     check('member', 'template int A<int>::a', {2: 'IEN1AIiE1aE'},
756.           output='template<> int A<int>::a')  # same as above
757.     check('member', 'template<> template<> int A<int>::B<int>::b', {2: 'IEIEN1AIiE1BIiE1bE'})
758.     check('member', 'template int A<int>::B<int>::b', {2: 'IEIEN1AIiE1BIiE1bE'},
759.           output='template<> template<> int A<int>::B<int>::b')  # same as above
760. 
761.     # defaulted constrained type parameters
762.     check('type', 'template<C T = int&> A', {2: 'I_1CE1A'})
763. 
764. 
765. def test_template_args():
766.     # from breathe#218
767.     check('function',
768.           "template<typename F> "
769.           "void allow(F *f, typename func<F, B, G != 1>::type tt)",
770.           {2: "I0E5allowP1FN4funcI1F1BXG != 1EE4typeE",
771.            3: "I0E5allowP1FN4funcI1F1BXne1GL1EEE4typeE",
772.            4: "I0E5allowvP1FN4funcI1F1BXne1GL1EEE4typeE"})
773.     # from #3542
774.     check('type', "template<typename T> "
775.           "enable_if_not_array_t = std::enable_if_t<!is_array<T>::value, int>",
776.           {2: "I0E21enable_if_not_array_t"})
777. 
778. 
779. def test_initializers():
780.     idsMember = {1: 'v__T', 2: '1v'}
781.     idsFunction = {1: 'f__T', 2: '1f1T'}
782.     idsTemplate = {2: 'I_1TE1fv', 4: 'I_1TE1fvv'}
783.     # no init
784.     check('member', 'T v', idsMember)
785.     check('function', 'void f(T v)', idsFunction)
786.     check('function', 'template<T v> void f()', idsTemplate)
787.     # with '=', assignment-expression
788.     check('member', 'T v = 42', idsMember)
789.     check('function', 'void f(T v = 42)', idsFunction)
790.     check('function', 'template<T v = 42> void f()', idsTemplate)
791.     # with '=', braced-init
792.     check('member', 'T v = {}', idsMember)
793.     check('function', 'void f(T v = {})', idsFunction)
794.     check('function', 'template<T v = {}> void f()', idsTemplate)
795.     check('member', 'T v = {42, 42, 42}', idsMember)
796.     check('function', 'void f(T v = {42, 42, 42})', idsFunction)
797.     check('function', 'template<T v = {42, 42, 42}> void f()', idsTemplate)
798.     check('member', 'T v = {42, 42, 42,}', idsMember)
799.     check('function', 'void f(T v = {42, 42, 42,})', idsFunction)
800.     check('function', 'template<T v = {42, 42, 42,}> void f()', idsTemplate)
801.     check('member', 'T v = {42, 42, args...}', idsMember)
802.     check('function', 'void f(T v = {42, 42, args...})', idsFunction)
803.     check('function', 'template<T v = {42, 42, args...}> void f()', idsTemplate)
804.     # without '=', braced-init
805.     check('member', 'T v{}', idsMember)
806.     check('member', 'T v{42, 42, 42}', idsMember)
807.     check('member', 'T v{42, 42, 42,}', idsMember)
808.     check('member', 'T v{42, 42, args...}', idsMember)
809.     # other
810.     check('member', 'T v = T{}', idsMember)
811. 
812. 
813. def test_attributes():
814.     # style: C++
815.     check('member', '[[]] int f', {1: 'f__i', 2: '1f'})
816.     check('member', '[ [ ] ] int f', {1: 'f__i', 2: '1f'},
817.           # this will fail when the proper grammar is implemented
818.           output='[[ ]] int f')
819.     check('member', '[[a]] int f', {1: 'f__i', 2: '1f'})
820.     # style: GNU
821.     check('member', '__attribute__(()) int f', {1: 'f__i', 2: '1f'})
822.     check('member', '__attribute__((a)) int f', {1: 'f__i', 2: '1f'})
823.     check('member', '__attribute__((a, b)) int f', {1: 'f__i', 2: '1f'})
824.     # style: user-defined id
825.     check('member', 'id_attr int f', {1: 'f__i', 2: '1f'})
826.     # style: user-defined paren
827.     check('member', 'paren_attr() int f', {1: 'f__i', 2: '1f'})
828.     check('member', 'paren_attr(a) int f', {1: 'f__i', 2: '1f'})
829.     check('member', 'paren_attr("") int f', {1: 'f__i', 2: '1f'})
830.     check('member', 'paren_attr(()[{}][]{}) int f', {1: 'f__i', 2: '1f'})
831.     with pytest.raises(DefinitionError):
832.         parse('member', 'paren_attr(() int f')
833.     with pytest.raises(DefinitionError):
834.         parse('member', 'paren_attr([) int f')
835.     with pytest.raises(DefinitionError):
836.         parse('member', 'paren_attr({) int f')
837.     with pytest.raises(DefinitionError):
838.         parse('member', 'paren_attr([)]) int f')
839.     with pytest.raises(DefinitionError):
840.         parse('member', 'paren_attr((])) int f')
841.     with pytest.raises(DefinitionError):
842.         parse('member', 'paren_attr({]}) int f')
843. 
844.     # position: decl specs
845.     check('function', 'static inline __attribute__(()) void f()',
846.           {1: 'f', 2: '1fv'},
847.           output='__attribute__(()) static inline void f()')
848.     check('function', '[[attr1]] [[attr2]] void f()',
849.           {1: 'f', 2: '1fv'},
850.           output='[[attr1]] [[attr2]] void f()')
851.     # position: declarator
852.     check('member', 'int *[[attr]] i', {1: 'i__iP', 2: '1i'})
853.     check('member', 'int *const [[attr]] volatile i', {1: 'i__iPVC', 2: '1i'},
854.           output='int *[[attr]] volatile const i')
855.     check('member', 'int &[[attr]] i', {1: 'i__iR', 2: '1i'})
856.     check('member', 'int *[[attr]] *i', {1: 'i__iPP', 2: '1i'})
857. 
858. 
859. def test_xref_parsing():
860.     def check(target):
861.         class Config:
862.             cpp_id_attributes = ["id_attr"]
863.             cpp_paren_attributes = ["paren_attr"]
864.         parser = DefinitionParser(target, location=None,
865.                                   config=Config())
866.         ast, isShorthand = parser.parse_xref_object()
867.         parser.assert_end()
868.     check('f')
869.     check('f()')
870.     check('void f()')
871.     check('T f()')
872. 
873. 
874. # def test_print():
875. #     # used for getting all the ids out for checking
876. #     for a in ids:
877. #         print(a)
878. #     raise DefinitionError("")
879. 
880. 
881. def filter_warnings(warning, file):
882.     lines = warning.getvalue().split("\n")
883.     res = [l for l in lines if "domain-cpp" in l and "{}.rst".format(file) in l and
884.            "WARNING: document isn't included in any toctree" not in l]
885.     print("Filtered warnings for file '{}':".format(file))
886.     for w in res:
887.         print(w)
888.     return res
889. 
890. 
891. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
892. def test_build_domain_cpp_multi_decl_lookup(app, status, warning):
893.     app.builder.build_all()
894.     ws = filter_warnings(warning, "lookup-key-overload")
895.     assert len(ws) == 0
896. 
897.     ws = filter_warnings(warning, "multi-decl-lookup")
898.     assert len(ws) == 0
899. 
900. 
901. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
902. def test_build_domain_cpp_warn_template_param_qualified_name(app, status, warning):
903.     app.builder.build_all()
904.     ws = filter_warnings(warning, "warn-template-param-qualified-name")
905.     assert len(ws) == 2
906.     assert "WARNING: cpp:type reference target not found: T::typeWarn" in ws[0]
907.     assert "WARNING: cpp:type reference target not found: T::U::typeWarn" in ws[1]
908. 
909. 
910. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
911. def test_build_domain_cpp_backslash_ok(app, status, warning):
912.     app.builder.build_all()
913.     ws = filter_warnings(warning, "backslash")
914.     assert len(ws) == 0
915. 
916. 
917. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
918. def test_build_domain_cpp_semicolon(app, status, warning):
919.     app.builder.build_all()
920.     ws = filter_warnings(warning, "semicolon")
921.     assert len(ws) == 0
922. 
923. 
924. @pytest.mark.sphinx(testroot='domain-cpp',
925.                     confoverrides={'nitpicky': True, 'strip_signature_backslash': True})
926. def test_build_domain_cpp_backslash_ok(app, status, warning):
927.     app.builder.build_all()
928.     ws = filter_warnings(warning, "backslash")
929.     assert len(ws) == 1
930.     assert "WARNING: Parsing of expression failed. Using fallback parser." in ws[0]
931. 
932. 
933. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'nitpicky': True})
934. def test_build_domain_cpp_anon_dup_decl(app, status, warning):
935.     app.builder.build_all()
936.     ws = filter_warnings(warning, "anon-dup-decl")
937.     assert len(ws) == 2
938.     assert "WARNING: cpp:identifier reference target not found: @a" in ws[0]
939.     assert "WARNING: cpp:identifier reference target not found: @b" in ws[1]
940. 
941. 
942. @pytest.mark.sphinx(testroot='domain-cpp')
943. def test_build_domain_cpp_misuse_of_roles(app, status, warning):
944.     app.builder.build_all()
945.     ws = filter_warnings(warning, "roles-targets-ok")
946.     assert len(ws) == 0
947. 
948.     ws = filter_warnings(warning, "roles-targets-warn")
949.     # the roles that should be able to generate warnings:
950.     allRoles = ['class', 'struct', 'union', 'func', 'member', 'var', 'type', 'concept', 'enum', 'enumerator']
951.     ok = [  # targetType, okRoles
952.         ('class', ['class', 'struct', 'type']),
953.         ('union', ['union', 'type']),
954.         ('func', ['func', 'type']),
955.         ('member', ['member', 'var']),
956.         ('type', ['type']),
957.         ('concept', ['concept']),
958.         ('enum', ['type', 'enum']),
959.         ('enumerator', ['enumerator']),
960.         ('tParam', ['class', 'struct', 'union', 'func', 'member', 'var', 'type', 'concept', 'enum', 'enumerator', 'functionParam']),
961.         ('functionParam', ['member', 'var']),
962.     ]
963.     warn = []
964.     for targetType, roles in ok:
965.         txtTargetType = "function" if targetType == "func" else targetType
966.         for r in allRoles:
967.             if r not in roles:
968.                 warn.append("WARNING: cpp:{} targets a {} (".format(r, txtTargetType))
969.     warn = list(sorted(warn))
970.     for w in ws:
971.         assert "targets a" in w
972.     ws = [w[w.index("WARNING:"):] for w in ws]
973.     ws = list(sorted(ws))
974.     print("Expected warnings:")
975.     for w in warn:
976.         print(w)
977.     print("Actual warnings:")
978.     for w in ws:
979.         print(w)
980. 
981.     for i in range(min(len(warn), len(ws))):
982.         assert ws[i].startswith(warn[i])
983. 
984.     assert len(ws) == len(warn)
985. 
986. 
987. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
988.                     reason='docutils-0.13 or above is required')
989. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'add_function_parentheses': True})
990. def test_build_domain_cpp_with_add_function_parentheses_is_True(app, status, warning):
991.     app.builder.build_all()
992. 
993.     def check(spec, text, file):
994.         pattern = '<li><p>%s<a .*?><code .*?><span .*?>%s</span></code></a></p></li>' % spec
995.         res = re.search(pattern, text)
996.         if not res:
997.             print("Pattern\n\t%s\nnot found in %s" % (pattern, file))
998.             assert False
999.     rolePatterns = [
1000.         ('', 'Sphinx'),
1001.         ('', 'Sphinx::version'),
1002.         ('', 'version'),
1003.         ('', 'List'),
1004.         ('', 'MyEnum')
1005.     ]
1006.     parenPatterns = [
1007.         ('ref function without parens ', r'paren_1\(\)'),
1008.         ('ref function with parens ', r'paren_2\(\)'),
1009.         ('ref function without parens, explicit title ', 'paren_3_title'),
1010.         ('ref function with parens, explicit title ', 'paren_4_title'),
1011.         ('ref op call without parens ', r'paren_5::operator\(\)\(\)'),
1012.         ('ref op call with parens ', r'paren_6::operator\(\)\(\)'),
1013.         ('ref op call without parens, explicit title ', 'paren_7_title'),
1014.         ('ref op call with parens, explicit title ', 'paren_8_title')
1015.     ]
1016. 
1017.     f = 'roles.html'
1018.     t = (app.outdir / f).read_text()
1019.     for s in rolePatterns:
1020.         check(s, t, f)
1021.     for s in parenPatterns:
1022.         check(s, t, f)
1023. 
1024.     f = 'any-role.html'
1025.     t = (app.outdir / f).read_text()
1026.     for s in parenPatterns:
1027.         check(s, t, f)
1028. 
1029. 
1030. @pytest.mark.skipif(docutils.__version_info__ < (0, 13),
1031.                     reason='docutils-0.13 or above is required')
1032. @pytest.mark.sphinx(testroot='domain-cpp', confoverrides={'add_function_parentheses': False})
1033. def test_build_domain_cpp_with_add_function_parentheses_is_False(app, status, warning):
1034.     app.builder.build_all()
1035. 
1036.     def check(spec, text, file):
1037.         pattern = '<li><p>%s<a .*?><code .*?><span .*?>%s</span></code></a></p></li>' % spec
1038.         res = re.search(pattern, text)
1039.         if not res:
1040.             print("Pattern\n\t%s\nnot found in %s" % (pattern, file))
1041.             assert False
1042.     rolePatterns = [
1043.         ('', 'Sphinx'),
1044.         ('', 'Sphinx::version'),
1045.         ('', 'version'),
1046.         ('', 'List'),
1047.         ('', 'MyEnum')
1048.     ]
1049.     parenPatterns = [
1050.         ('ref function without parens ', 'paren_1'),
1051.         ('ref function with parens ', 'paren_2'),
1052.         ('ref function without parens, explicit title ', 'paren_3_title'),
1053.         ('ref function with parens, explicit title ', 'paren_4_title'),
1054.         ('ref op call without parens ', r'paren_5::operator\(\)'),
1055.         ('ref op call with parens ', r'paren_6::operator\(\)'),
1056.         ('ref op call without parens, explicit title ', 'paren_7_title'),
1057.         ('ref op call with parens, explicit title ', 'paren_8_title')
1058.     ]
1059. 
1060.     f = 'roles.html'
1061.     t = (app.outdir / f).read_text()
1062.     for s in rolePatterns:
1063.         check(s, t, f)
1064.     for s in parenPatterns:
1065.         check(s, t, f)
1066. 
1067.     f = 'any-role.html'
1068.     t = (app.outdir / f).read_text()
1069.     for s in parenPatterns:
1070.         check(s, t, f)
1071. 
1072. 
1073. @pytest.mark.sphinx(testroot='domain-cpp')
1074. def test_xref_consistency(app, status, warning):
1075.     app.builder.build_all()
1076. 
1077.     test = 'xref_consistency.html'
1078.     output = (app.outdir / test).read_text()
1079. 
1080.     def classes(role, tag):
1081.         pattern = (r'{role}-role:.*?'
1082.                    r'<(?P<tag>{tag}) .*?class=["\'](?P<classes>.*?)["\'].*?>'
1083.                    r'.*'
1084.                    r'</(?P=tag)>').format(role=role, tag=tag)
1085.         result = re.search(pattern, output)
1086.         expect = '''\
1087. Pattern for role `{role}` with tag `{tag}`
1088. \t{pattern}
1089. not found in `{test}`
1090. '''.format(role=role, tag=tag, pattern=pattern, test=test)
1091.         assert result, expect
1092.         return set(result.group('classes').split())
1093. 
1094.     class RoleClasses:
1095.         """Collect the classes from the layout that was generated for a given role."""
1096. 
1097.         def __init__(self, role, root, contents):
1098.             self.name = role
1099.             self.classes = classes(role, root)
1100.             self.content_classes = dict()
1101.             for tag in contents:
1102.                 self.content_classes[tag] = classes(role, tag)
1103. 
1104.     # not actually used as a reference point
1105.     # code_role = RoleClasses('code', 'code', [])
1106.     any_role = RoleClasses('any', 'a', ['code'])
1107.     cpp_any_role = RoleClasses('cpp-any', 'a', ['code'])
1108.     # NYI: consistent looks
1109.     # texpr_role = RoleClasses('cpp-texpr', 'span', ['a', 'code'])
1110.     expr_role = RoleClasses('cpp-expr', 'code', ['a'])
1111.     texpr_role = RoleClasses('cpp-texpr', 'span', ['a', 'span'])
1112. 
1113.     # XRefRole-style classes
1114. 
1115.     # any and cpp:any do not put these classes at the root
1116. 
1117.     # n.b. the generic any machinery finds the specific 'cpp-class' object type
1118.     expect = 'any uses XRefRole classes'
1119.     assert {'xref', 'any', 'cpp', 'cpp-class'} <= any_role.content_classes['code'], expect
1120. 
1121.     expect = 'cpp:any uses XRefRole classes'
1122.     assert {'xref', 'cpp-any', 'cpp'} <= cpp_any_role.content_classes['code'], expect
1123. 
1124.     for role in (expr_role, texpr_role):
1125.         name = role.name
1126.         expect = '`{name}` puts the domain and role classes at its root'.format(name=name)
1127.         # NYI: xref should go in the references
1128.         assert {'xref', 'cpp', name} <= role.classes, expect
1129. 
1130.     # reference classes
1131. 
1132.     expect = 'the xref roles use the same reference classes'
1133.     assert any_role.classes == cpp_any_role.classes, expect
1134.     assert any_role.classes == expr_role.content_classes['a'], expect
1135.     assert any_role.classes == texpr_role.content_classes['a'], expect

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 23:33:25,250 - thread-125368433358528.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find relevant test cases for a bug fix that adds support for C++ User-Defined Literals (UDLs). The provided context contains the file `tests/test_domain_cpp.py`, which includes a comprehensive test suite for the C++ domain. Specifically, the `test_expressions` function within this file contains tests for various C++ literals like integers, floats, and strings. These tests are the perfect template for creating new tests for UDLs because they check the Abstract Syntax Tree (AST) and the generated IDs, which is precisely what needs to be validated for the new UDL feature. The existing context is sufficient to extract multiple relevant examples. Therefore, no additional context is required.' query='' extra_requirements='' purpose=''
2025-12-23 23:33:25,251 - thread-125368433358528.prometheus_context_collector - INFO - Successfully retrieved 1 context snippets
