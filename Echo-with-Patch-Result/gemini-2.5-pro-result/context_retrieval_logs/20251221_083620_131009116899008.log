2025-12-21 08:36:20,865 - thread-131009116899008.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Nitpick flags Literal annotation values as missing py:class

Description: ### Describe the bug

When a value is present in a type annotation as `Literal`, sphinx will treat the value as a `py:class`. With nitpick enabled, values like `Literal[True]` end up failing, because `True` is not a class.

This is a problem for builds which want to use `-n -W` to catch doc errors.

### How to Reproduce

Setup a simple function which uses Literal, then attempt to autodoc it. e.g.
```python
import typing
@typing.overload
def foo(x: "typing.Literal[True]") -> int: ...
@typing.overload
def foo(x: "typing.Literal[False]") -> str: ...
def foo(x: bool):
    """a func"""
    return 1 if x else "foo"
```

I've pushed an example [failing project](https://github.com/sirosen/repro/tree/master/sphinxdoc/literal) to [my repro repo](https://github.com/sirosen/repro). Just run `./doc.sh` with `sphinx-build` available to see the failing build.

### Expected behavior

`Literal[True]` (or whatever literal value) should be present in the type annotation but should not trigger the nitpick warning.

### Your project

https://github.com/sirosen/repro/tree/master/sphinxdoc/literal

### Screenshots

_No response_

### OS

Linux

### Python version

3.8, 3.9

### Sphinx version

4.1.2

### Sphinx extensions

autodoc

### Extra tools

_No response_

### Additional context

_No response_

Patch information:
diff --git a/sphinx/domains/python.py b/sphinx/domains/python.py
index 9875a9f4b..e1c6e595b 100644
--- a/sphinx/domains/python.py
+++ b/sphinx/domains/python.py
@@ -109,13 +109,21 @@ def type_to_xref(text: str, env: BuildEnvironment = None) -> addnodes.pending_xr
 
 def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Node]:
     """Parse type annotation."""
-    def unparse(node: ast.AST) -> List[Node]:
+    def is_literal_type(n: ast.AST) -> bool:
+        if isinstance(n, ast.Name):
+            return n.id == 'Literal'
+        elif isinstance(n, ast.Attribute):
+            return n.attr == 'Literal'
+        else:
+            return False
+
+    def unparse(node: ast.AST, in_literal: bool = False) -> List[Node]:
         if isinstance(node, ast.Attribute):
-            return [nodes.Text("%s.%s" % (unparse(node.value)[0], node.attr))]
+            return [nodes.Text("%s.%s" % (unparse(node.value, in_literal)[0], node.attr))]
         elif isinstance(node, ast.BinOp):
-            result: List[Node] = unparse(node.left)
-            result.extend(unparse(node.op))
-            result.extend(unparse(node.right))
+            result: List[Node] = unparse(node.left, in_literal)
+            result.extend(unparse(node.op, in_literal))
+            result.extend(unparse(node.right, in_literal))
             return result
         elif isinstance(node, ast.BitOr):
             return [nodes.Text(' '), addnodes.desc_sig_punctuation('', '|'), nodes.Text(' ')]
@@ -123,11 +131,14 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
             if node.value is Ellipsis:
                 return [addnodes.desc_sig_punctuation('', "...")]
             else:
-                return [nodes.Text(node.value)]
+                if in_literal:
+                    return [nodes.Text(repr(node.value))]
+                else:
+                    return [nodes.Text(node.value)]
         elif isinstance(node, ast.Expr):
-            return unparse(node.value)
+            return unparse(node.value, in_literal)
         elif isinstance(node, ast.Index):
-            return unparse(node.value)
+            return unparse(node.value, in_literal)
         elif isinstance(node, ast.List):
             result = [addnodes.desc_sig_punctuation('', '[')]
             if node.elts:
@@ -135,26 +146,27 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
                 # last element of result if the for-loop was run at least
                 # once
                 for elem in node.elts:
-                    result.extend(unparse(elem))
+                    result.extend(unparse(elem, in_literal))
                     result.append(addnodes.desc_sig_punctuation('', ', '))
                 result.pop()
             result.append(addnodes.desc_sig_punctuation('', ']'))
             return result
         elif isinstance(node, ast.Module):
-            return sum((unparse(e) for e in node.body), [])
+            return sum((unparse(e, in_literal) for e in node.body), [])
         elif isinstance(node, ast.Name):
             return [nodes.Text(node.id)]
         elif isinstance(node, ast.Subscript):
-            result = unparse(node.value)
+            result = unparse(node.value, in_literal)
             result.append(addnodes.desc_sig_punctuation('', '['))
-            result.extend(unparse(node.slice))
+            slice_in_literal = in_literal or is_literal_type(node.value)
+            result.extend(unparse(node.slice, slice_in_literal))
             result.append(addnodes.desc_sig_punctuation('', ']'))
             return result
         elif isinstance(node, ast.Tuple):
             if node.elts:
                 result = []
                 for elem in node.elts:
-                    result.extend(unparse(elem))
+                    result.extend(unparse(elem, in_literal))
                     result.append(addnodes.desc_sig_punctuation('', ', '))
                 result.pop()
             else:
@@ -167,7 +179,10 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
                 if isinstance(node, ast.Ellipsis):
                     return [addnodes.desc_sig_punctuation('', "...")]
                 elif isinstance(node, ast.NameConstant):
-                    return [nodes.Text(node.value)]
+                    if in_literal:
+                        return [nodes.Text(repr(node.value))]
+                    else:
+                        return [nodes.Text(node.value)]
 
             raise SyntaxError  # unsupported syntax
 
@@ -178,10 +193,44 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
     try:
         tree = ast_parse(annotation)
         result = unparse(tree)
-        for i, node in enumerate(result):
+        converted: List[Node] = []
+        in_literal_args = False
+        literal_detected = False
+        depth = 0
+        for node in result:
+            if isinstance(node, addnodes.desc_sig_punctuation):
+                punct = node.astext()
+                if not in_literal_args:
+                    if literal_detected and punct == '[':
+                        in_literal_args = True
+                        depth = 1
+                        converted.append(node)
+                        continue
+                else:
+                    if punct == '[':
+                        depth += 1
+                    elif punct == ']':
+                        depth -= 1
+                        if depth == 0:
+                            in_literal_args = False
+                            literal_detected = False
+                    converted.append(node)
+                    continue
+                converted.append(node)
+                continue
             if isinstance(node, nodes.Text) and node.strip():
-                result[i] = type_to_xref(str(node), env)
-        return result
+                text = str(node)
+                if not in_literal_args:
+                    if text == 'Literal' or text.endswith('.Literal'):
+                        literal_detected = True
+                    else:
+                        literal_detected = False
+                    converted.append(type_to_xref(text, env))
+                else:
+                    converted.append(nodes.Text(text))
+            else:
+                converted.append(node)
+        return converted
     except SyntaxError:
         return [type_to_xref(annotation, env)]
 


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

2025-12-21 08:36:20,929 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Nitpick flags Literal annotation values as missing py:class

Description: ### Describe the bug

When a value is present in a type annotation as `Literal`, sphinx will treat the value as a `py:class`. With nitpick enabled, values like `Literal[True]` end up failing, because `True` is not a class.

This is a problem for builds which want to use `-n -W` to catch doc errors.

### How to Reproduce

Setup a simple function which uses Literal, then attempt to autodoc it. e.g.
```python
import typing
@typing.overload
def foo(x: "typing.Literal[True]") -> int: ...
@typing.overload
def foo(x: "typing.Literal[False]") -> str: ...
def foo(x: bool):
    """a func"""
    return 1 if x else "foo"
```

I've pushed an example [failing project](https://github.com/sirosen/repro/tree/master/sphinxdoc/literal) to [my repro repo](https://github.com/sirosen/repro). Just run `./doc.sh` with `sphinx-build` available to see the failing build.

### Expected behavior

`Literal[True]` (or whatever literal value) should be present in the type annotation but should not trigger the nitpick warning.

### Your project

https://github.com/sirosen/repro/tree/master/sphinxdoc/literal

### Screenshots

_No response_

### OS

Linux

### Python version

3.8, 3.9

### Sphinx version

4.1.2

### Sphinx extensions

autodoc

### Extra tools

_No response_

### Additional context

_No response_

Patch information:
diff --git a/sphinx/domains/python.py b/sphinx/domains/python.py
index 9875a9f4b..e1c6e595b 100644
--- a/sphinx/domains/python.py
+++ b/sphinx/domains/python.py
@@ -109,13 +109,21 @@ def type_to_xref(text: str, env: BuildEnvironment = None) -> addnodes.pending_xr
 
 def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Node]:
     """Parse type annotation."""
-    def unparse(node: ast.AST) -> List[Node]:
+    def is_literal_type(n: ast.AST) -> bool:
+        if isinstance(n, ast.Name):
+            return n.id == 'Literal'
+        elif isinstance(n, ast.Attribute):
+            return n.attr == 'Literal'
+        else:
+            return False
+
+    def unparse(node: ast.AST, in_literal: bool = False) -> List[Node]:
         if isinstance(node, ast.Attribute):
-            return [nodes.Text("%s.%s" % (unparse(node.value)[0], node.attr))]
+            return [nodes.Text("%s.%s" % (unparse(node.value, in_literal)[0], node.attr))]
         elif isinstance(node, ast.BinOp):
-            result: List[Node] = unparse(node.left)
-            result.extend(unparse(node.op))
-            result.extend(unparse(node.right))
+            result: List[Node] = unparse(node.left, in_literal)
+            result.extend(unparse(node.op, in_literal))
+            result.extend(unparse(node.right, in_literal))
             return result
         elif isinstance(node, ast.BitOr):
             return [nodes.Text(' '), addnodes.desc_sig_punctuation('', '|'), nodes.Text(' ')]
@@ -123,11 +131,14 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
             if node.value is Ellipsis:
                 return [addnodes.desc_sig_punctuation('', "...")]
             else:
-                return [nodes.Text(node.value)]
+                if in_literal:
+                    return [nodes.Text(repr(node.value))]
+                else:
+                    return [nodes.Text(node.value)]
         elif isinstance(node, ast.Expr):
-            return unparse(node.value)
+            return unparse(node.value, in_literal)
         elif isinstance(node, ast.Index):
-            return unparse(node.value)
+            return unparse(node.value, in_literal)
         elif isinstance(node, ast.List):
             result = [addnodes.desc_sig_punctuation('', '[')]
             if node.elts:
@@ -135,26 +146,27 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
                 # last element of result if the for-loop was run at least
                 # once
                 for elem in node.elts:
-                    result.extend(unparse(elem))
+                    result.extend(unparse(elem, in_literal))
                     result.append(addnodes.desc_sig_punctuation('', ', '))
                 result.pop()
             result.append(addnodes.desc_sig_punctuation('', ']'))
             return result
         elif isinstance(node, ast.Module):
-            return sum((unparse(e) for e in node.body), [])
+            return sum((unparse(e, in_literal) for e in node.body), [])
         elif isinstance(node, ast.Name):
             return [nodes.Text(node.id)]
         elif isinstance(node, ast.Subscript):
-            result = unparse(node.value)
+            result = unparse(node.value, in_literal)
             result.append(addnodes.desc_sig_punctuation('', '['))
-            result.extend(unparse(node.slice))
+            slice_in_literal = in_literal or is_literal_type(node.value)
+            result.extend(unparse(node.slice, slice_in_literal))
             result.append(addnodes.desc_sig_punctuation('', ']'))
             return result
         elif isinstance(node, ast.Tuple):
             if node.elts:
                 result = []
                 for elem in node.elts:
-                    result.extend(unparse(elem))
+                    result.extend(unparse(elem, in_literal))
                     result.append(addnodes.desc_sig_punctuation('', ', '))
                 result.pop()
             else:
@@ -167,7 +179,10 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
                 if isinstance(node, ast.Ellipsis):
                     return [addnodes.desc_sig_punctuation('', "...")]
                 elif isinstance(node, ast.NameConstant):
-                    return [nodes.Text(node.value)]
+                    if in_literal:
+                        return [nodes.Text(repr(node.value))]
+                    else:
+                        return [nodes.Text(node.value)]
 
             raise SyntaxError  # unsupported syntax
 
@@ -178,10 +193,44 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
     try:
         tree = ast_parse(annotation)
         result = unparse(tree)
-        for i, node in enumerate(result):
+        converted: List[Node] = []
+        in_literal_args = False
+        literal_detected = False
+        depth = 0
+        for node in result:
+            if isinstance(node, addnodes.desc_sig_punctuation):
+                punct = node.astext()
+                if not in_literal_args:
+                    if literal_detected and punct == '[':
+                        in_literal_args = True
+                        depth = 1
+                        converted.append(node)
+                        continue
+                else:
+                    if punct == '[':
+                        depth += 1
+                    elif punct == ']':
+                        depth -= 1
+                        if depth == 0:
+                            in_literal_args = False
+                            literal_detected = False
+                    converted.append(node)
+                    continue
+                converted.append(node)
+                continue
             if isinstance(node, nodes.Text) and node.strip():
-                result[i] = type_to_xref(str(node), env)
-        return result
+                text = str(node)
+                if not in_literal_args:
+                    if text == 'Literal' or text.endswith('.Literal'):
+                        literal_detected = True
+                    else:
+                        literal_detected = False
+                    converted.append(type_to_xref(text, env))
+                else:
+                    converted.append(nodes.Text(text))
+            else:
+                converted.append(node)
+        return converted
     except SyntaxError:
         return [type_to_xref(annotation, env)]
 


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 08:36:53,373 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to fix a bug related to how Sphinx handles `Literal` type annotations, especially when using `autodoc`. A patch for `sphinx/domains/python.py` is provided. To understand the bug and the patch, I need to see the original code in `sphinx/domains/python.py`, particularly the `_parse_annotation` and `type_to_xref` functions. The bug report mentions `autodoc`, and `sphinx/ext/autodoc/typehints.py` is the most likely place where type hints are processed for `autodoc`. Therefore, I need both files to get a complete picture of the code path and the problem.' query='Please provide the full content of `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`.' extra_requirements='' purpose='To analyze the processing of type annotations from autodoc to the Python domain and understand the provided patch for the `Literal` type bug.'
2025-12-21 08:36:53,374 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`.
2025-12-21 08:36:53,374 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 08:36:53,375 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 08:36:53,375 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 08:36:53,375 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`.
Purpose: To analyze the processing of type annotations from autodoc to the Python domain and understand the provided patch for the `Literal` type bug.
2025-12-21 08:36:55,730 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will provide the full content of the two requested files, `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`, by reading each one. This will allow for a comprehensive analysis of how type annotations are processed and how the patch addresses the `Literal` type bug.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sphinx/ext/autodoc/typehints.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2092, 'candidates_token_count': 111, 'total_token_count': 2276, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2092}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 111}], 'thoughts_token_count': 73, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.05656117361945075, 'model_name': 'gemini-2.5-pro'} id='run--0ad341e6-6c0b-492b-a9c6-2ca8766450cd-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sphinx/domains/python.py'}, 'id': 'a8bdb6e7-410d-435f-92ae-b17b25178865', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sphinx/ext/autodoc/typehints.py'}, 'id': '54254084-ee86-437e-89a3-4edd0508d0f0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2092, 'output_tokens': 111, 'total_tokens': 2276, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 73}}
2025-12-21 08:36:57,573 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire contents of both `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`. This provides all the necessary information for analyzing the type annotation processing and the `Literal` type bug patch. I am now finished with the request.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12683, 'candidates_token_count': 61, 'total_token_count': 12783, 'cached_content_token_count': 1860, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12683}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1860}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 61}], 'thoughts_token_count': 39}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10249552961255683, 'model_name': 'gemini-2.5-pro'} id='run--a41c95c9-800f-43bd-951f-4cfe507290ed-0' usage_metadata={'input_tokens': 12683, 'output_tokens': 61, 'total_tokens': 12783, 'input_token_details': {'cache_read': 1860}, 'output_token_details': {'reasoning': 39}}
2025-12-21 08:36:57,575 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
To analyze the processing of type annotations from autodoc to the Python domain and understand the provided patch for the `Literal` type bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sphinx/domains/python.py
Line number range: 1 - 500
Content:
1. """
2.     sphinx.domains.python
3.     ~~~~~~~~~~~~~~~~~~~~~
4. 
5.     The Python domain.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import builtins
12. import inspect
13. import re
14. import sys
15. import typing
16. import warnings
17. from inspect import Parameter
18. from typing import Any, Dict, Iterable, Iterator, List, NamedTuple, Optional, Tuple, Type, cast
19. 
20. from docutils import nodes
21. from docutils.nodes import Element, Node
22. from docutils.parsers.rst import directives
23. from docutils.parsers.rst.states import Inliner
24. 
25. from sphinx import addnodes
26. from sphinx.addnodes import desc_signature, pending_xref, pending_xref_condition
27. from sphinx.application import Sphinx
28. from sphinx.builders import Builder
29. from sphinx.deprecation import RemovedInSphinx50Warning
30. from sphinx.directives import ObjectDescription
31. from sphinx.domains import Domain, Index, IndexEntry, ObjType
32. from sphinx.environment import BuildEnvironment
33. from sphinx.locale import _, __
34. from sphinx.pycode.ast import ast
35. from sphinx.pycode.ast import parse as ast_parse
36. from sphinx.roles import XRefRole
37. from sphinx.util import logging
38. from sphinx.util.docfields import Field, GroupedField, TypedField
39. from sphinx.util.docutils import SphinxDirective
40. from sphinx.util.inspect import signature_from_str
41. from sphinx.util.nodes import find_pending_xref_condition, make_id, make_refnode
42. from sphinx.util.typing import OptionSpec, TextlikeNode
43. 
44. logger = logging.getLogger(__name__)
45. 
46. 
47. # REs for Python signatures
48. py_sig_re = re.compile(
49.     r'''^ ([\w.]*\.)?            # class name(s)
50.           (\w+)  \s*             # thing name
51.           (?: \(\s*(.*)\s*\)     # optional: arguments
52.            (?:\s* -> \s* (.*))?  #           return annotation
53.           )? $                   # and nothing more
54.           ''', re.VERBOSE)
55. 
56. 
57. pairindextypes = {
58.     'module':    _('module'),
59.     'keyword':   _('keyword'),
60.     'operator':  _('operator'),
61.     'object':    _('object'),
62.     'exception': _('exception'),
63.     'statement': _('statement'),
64.     'builtin':   _('built-in function'),
65. }
66. 
67. 
68. class ObjectEntry(NamedTuple):
69.     docname: str
70.     node_id: str
71.     objtype: str
72.     aliased: bool
73. 
74. 
75. class ModuleEntry(NamedTuple):
76.     docname: str
77.     node_id: str
78.     synopsis: str
79.     platform: str
80.     deprecated: bool
81. 
82. 
83. def type_to_xref(text: str, env: BuildEnvironment = None) -> addnodes.pending_xref:
84.     """Convert a type string to a cross reference node."""
85.     if text == 'None':
86.         reftype = 'obj'
87.     else:
88.         reftype = 'class'
89. 
90.     if env:
91.         kwargs = {'py:module': env.ref_context.get('py:module'),
92.                   'py:class': env.ref_context.get('py:class')}
93.     else:
94.         kwargs = {}
95. 
96.     if env.config.python_use_unqualified_type_names:
97.         # Note: It would be better to use qualname to describe the object to support support
98.         # nested classes.  But python domain can't access the real python object because this
99.         # module should work not-dynamically.
100.         shortname = text.split('.')[-1]
101.         contnodes: List[Node] = [pending_xref_condition('', shortname, condition='resolved'),
102.                                  pending_xref_condition('', text, condition='*')]
103.     else:
104.         contnodes = [nodes.Text(text)]
105. 
106.     return pending_xref('', *contnodes,
107.                         refdomain='py', reftype=reftype, reftarget=text, **kwargs)
108. 
109. 
110. def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Node]:
111.     """Parse type annotation."""
112.     def unparse(node: ast.AST) -> List[Node]:
113.         if isinstance(node, ast.Attribute):
114.             return [nodes.Text("%s.%s" % (unparse(node.value)[0], node.attr))]
115.         elif isinstance(node, ast.BinOp):
116.             result: List[Node] = unparse(node.left)
117.             result.extend(unparse(node.op))
118.             result.extend(unparse(node.right))
119.             return result
120.         elif isinstance(node, ast.BitOr):
121.             return [nodes.Text(' '), addnodes.desc_sig_punctuation('', '|'), nodes.Text(' ')]
122.         elif isinstance(node, ast.Constant):  # type: ignore
123.             if node.value is Ellipsis:
124.                 return [addnodes.desc_sig_punctuation('', "...")]
125.             else:
126.                 return [nodes.Text(node.value)]
127.         elif isinstance(node, ast.Expr):
128.             return unparse(node.value)
129.         elif isinstance(node, ast.Index):
130.             return unparse(node.value)
131.         elif isinstance(node, ast.List):
132.             result = [addnodes.desc_sig_punctuation('', '[')]
133.             if node.elts:
134.                 # check if there are elements in node.elts to only pop the
135.                 # last element of result if the for-loop was run at least
136.                 # once
137.                 for elem in node.elts:
138.                     result.extend(unparse(elem))
139.                     result.append(addnodes.desc_sig_punctuation('', ', '))
140.                 result.pop()
141.             result.append(addnodes.desc_sig_punctuation('', ']'))
142.             return result
143.         elif isinstance(node, ast.Module):
144.             return sum((unparse(e) for e in node.body), [])
145.         elif isinstance(node, ast.Name):
146.             return [nodes.Text(node.id)]
147.         elif isinstance(node, ast.Subscript):
148.             result = unparse(node.value)
149.             result.append(addnodes.desc_sig_punctuation('', '['))
150.             result.extend(unparse(node.slice))
151.             result.append(addnodes.desc_sig_punctuation('', ']'))
152.             return result
153.         elif isinstance(node, ast.Tuple):
154.             if node.elts:
155.                 result = []
156.                 for elem in node.elts:
157.                     result.extend(unparse(elem))
158.                     result.append(addnodes.desc_sig_punctuation('', ', '))
159.                 result.pop()
160.             else:
161.                 result = [addnodes.desc_sig_punctuation('', '('),
162.                           addnodes.desc_sig_punctuation('', ')')]
163. 
164.             return result
165.         else:
166.             if sys.version_info < (3, 8):
167.                 if isinstance(node, ast.Ellipsis):
168.                     return [addnodes.desc_sig_punctuation('', "...")]
169.                 elif isinstance(node, ast.NameConstant):
170.                     return [nodes.Text(node.value)]
171. 
172.             raise SyntaxError  # unsupported syntax
173. 
174.     if env is None:
175.         warnings.warn("The env parameter for _parse_annotation becomes required now.",
176.                       RemovedInSphinx50Warning, stacklevel=2)
177. 
178.     try:
179.         tree = ast_parse(annotation)
180.         result = unparse(tree)
181.         for i, node in enumerate(result):
182.             if isinstance(node, nodes.Text) and node.strip():
183.                 result[i] = type_to_xref(str(node), env)
184.         return result
185.     except SyntaxError:
186.         return [type_to_xref(annotation, env)]
187. 
188. 
189. def _parse_arglist(arglist: str, env: BuildEnvironment = None) -> addnodes.desc_parameterlist:
190.     """Parse a list of arguments using AST parser"""
191.     params = addnodes.desc_parameterlist(arglist)
192.     sig = signature_from_str('(%s)' % arglist)
193.     last_kind = None
194.     for param in sig.parameters.values():
195.         if param.kind != param.POSITIONAL_ONLY and last_kind == param.POSITIONAL_ONLY:
196.             # PEP-570: Separator for Positional Only Parameter: /
197.             params += addnodes.desc_parameter('', '', addnodes.desc_sig_operator('', '/'))
198.         if param.kind == param.KEYWORD_ONLY and last_kind in (param.POSITIONAL_OR_KEYWORD,
199.                                                               param.POSITIONAL_ONLY,
200.                                                               None):
201.             # PEP-3102: Separator for Keyword Only Parameter: *
202.             params += addnodes.desc_parameter('', '', addnodes.desc_sig_operator('', '*'))
203. 
204.         node = addnodes.desc_parameter()
205.         if param.kind == param.VAR_POSITIONAL:
206.             node += addnodes.desc_sig_operator('', '*')
207.             node += addnodes.desc_sig_name('', param.name)
208.         elif param.kind == param.VAR_KEYWORD:
209.             node += addnodes.desc_sig_operator('', '**')
210.             node += addnodes.desc_sig_name('', param.name)
211.         else:
212.             node += addnodes.desc_sig_name('', param.name)
213. 
214.         if param.annotation is not param.empty:
215.             children = _parse_annotation(param.annotation, env)
216.             node += addnodes.desc_sig_punctuation('', ':')
217.             node += nodes.Text(' ')
218.             node += addnodes.desc_sig_name('', '', *children)  # type: ignore
219.         if param.default is not param.empty:
220.             if param.annotation is not param.empty:
221.                 node += nodes.Text(' ')
222.                 node += addnodes.desc_sig_operator('', '=')
223.                 node += nodes.Text(' ')
224.             else:
225.                 node += addnodes.desc_sig_operator('', '=')
226.             node += nodes.inline('', param.default, classes=['default_value'],
227.                                  support_smartquotes=False)
228. 
229.         params += node
230.         last_kind = param.kind
231. 
232.     if last_kind == Parameter.POSITIONAL_ONLY:
233.         # PEP-570: Separator for Positional Only Parameter: /
234.         params += addnodes.desc_parameter('', '', addnodes.desc_sig_operator('', '/'))
235. 
236.     return params
237. 
238. 
239. def _pseudo_parse_arglist(signode: desc_signature, arglist: str) -> None:
240.     """"Parse" a list of arguments separated by commas.
241. 
242.     Arguments can have "optional" annotations given by enclosing them in
243.     brackets.  Currently, this will split at any comma, even if it's inside a
244.     string literal (e.g. default argument value).
245.     """
246.     paramlist = addnodes.desc_parameterlist()
247.     stack: List[Element] = [paramlist]
248.     try:
249.         for argument in arglist.split(','):
250.             argument = argument.strip()
251.             ends_open = ends_close = 0
252.             while argument.startswith('['):
253.                 stack.append(addnodes.desc_optional())
254.                 stack[-2] += stack[-1]
255.                 argument = argument[1:].strip()
256.             while argument.startswith(']'):
257.                 stack.pop()
258.                 argument = argument[1:].strip()
259.             while argument.endswith(']') and not argument.endswith('[]'):
260.                 ends_close += 1
261.                 argument = argument[:-1].strip()
262.             while argument.endswith('['):
263.                 ends_open += 1
264.                 argument = argument[:-1].strip()
265.             if argument:
266.                 stack[-1] += addnodes.desc_parameter(argument, argument)
267.             while ends_open:
268.                 stack.append(addnodes.desc_optional())
269.                 stack[-2] += stack[-1]
270.                 ends_open -= 1
271.             while ends_close:
272.                 stack.pop()
273.                 ends_close -= 1
274.         if len(stack) != 1:
275.             raise IndexError
276.     except IndexError:
277.         # if there are too few or too many elements on the stack, just give up
278.         # and treat the whole argument list as one argument, discarding the
279.         # already partially populated paramlist node
280.         paramlist = addnodes.desc_parameterlist()
281.         paramlist += addnodes.desc_parameter(arglist, arglist)
282.         signode += paramlist
283.     else:
284.         signode += paramlist
285. 
286. 
287. # This override allows our inline type specifiers to behave like :class: link
288. # when it comes to handling "." and "~" prefixes.
289. class PyXrefMixin:
290.     def make_xref(self, rolename: str, domain: str, target: str,
291.                   innernode: Type[TextlikeNode] = nodes.emphasis,
292.                   contnode: Node = None, env: BuildEnvironment = None,
293.                   inliner: Inliner = None, location: Node = None) -> Node:
294.         # we use inliner=None to make sure we get the old behaviour with a single
295.         # pending_xref node
296.         result = super().make_xref(rolename, domain, target,  # type: ignore
297.                                    innernode, contnode,
298.                                    env, inliner=None, location=None)
299.         result['refspecific'] = True
300.         result['py:module'] = env.ref_context.get('py:module')
301.         result['py:class'] = env.ref_context.get('py:class')
302.         if target.startswith(('.', '~')):
303.             prefix, result['reftarget'] = target[0], target[1:]
304.             if prefix == '.':
305.                 text = target[1:]
306.             elif prefix == '~':
307.                 text = target.split('.')[-1]
308.             for node in result.traverse(nodes.Text):
309.                 node.parent[node.parent.index(node)] = nodes.Text(text)
310.                 break
311.         elif isinstance(result, pending_xref) and env.config.python_use_unqualified_type_names:
312.             children = result.children
313.             result.clear()
314. 
315.             shortname = target.split('.')[-1]
316.             textnode = innernode('', shortname)
317.             contnodes = [pending_xref_condition('', '', textnode, condition='resolved'),
318.                          pending_xref_condition('', '', *children, condition='*')]
319.             result.extend(contnodes)
320. 
321.         return result
322. 
323.     def make_xrefs(self, rolename: str, domain: str, target: str,
324.                    innernode: Type[TextlikeNode] = nodes.emphasis,
325.                    contnode: Node = None, env: BuildEnvironment = None,
326.                    inliner: Inliner = None, location: Node = None) -> List[Node]:
327.         delims = r'(\s*[\[\]\(\),](?:\s*or\s)?\s*|\s+or\s+|\s*\|\s*|\.\.\.)'
328.         delims_re = re.compile(delims)
329.         sub_targets = re.split(delims, target)
330. 
331.         split_contnode = bool(contnode and contnode.astext() == target)
332. 
333.         results = []
334.         for sub_target in filter(None, sub_targets):
335.             if split_contnode:
336.                 contnode = nodes.Text(sub_target)
337. 
338.             if delims_re.match(sub_target):
339.                 results.append(contnode or innernode(sub_target, sub_target))
340.             else:
341.                 results.append(self.make_xref(rolename, domain, sub_target,
342.                                               innernode, contnode, env, inliner, location))
343. 
344.         return results
345. 
346. 
347. class PyField(PyXrefMixin, Field):
348.     def make_xref(self, rolename: str, domain: str, target: str,
349.                   innernode: Type[TextlikeNode] = nodes.emphasis,
350.                   contnode: Node = None, env: BuildEnvironment = None,
351.                   inliner: Inliner = None, location: Node = None) -> Node:
352.         if rolename == 'class' and target == 'None':
353.             # None is not a type, so use obj role instead.
354.             rolename = 'obj'
355. 
356.         return super().make_xref(rolename, domain, target, innernode, contnode,
357.                                  env, inliner, location)
358. 
359. 
360. class PyGroupedField(PyXrefMixin, GroupedField):
361.     pass
362. 
363. 
364. class PyTypedField(PyXrefMixin, TypedField):
365.     def make_xref(self, rolename: str, domain: str, target: str,
366.                   innernode: Type[TextlikeNode] = nodes.emphasis,
367.                   contnode: Node = None, env: BuildEnvironment = None,
368.                   inliner: Inliner = None, location: Node = None) -> Node:
369.         if rolename == 'class' and target == 'None':
370.             # None is not a type, so use obj role instead.
371.             rolename = 'obj'
372. 
373.         return super().make_xref(rolename, domain, target, innernode, contnode,
374.                                  env, inliner, location)
375. 
376. 
377. class PyObject(ObjectDescription[Tuple[str, str]]):
378.     """
379.     Description of a general Python object.
380. 
381.     :cvar allow_nesting: Class is an object that allows for nested namespaces
382.     :vartype allow_nesting: bool
383.     """
384.     option_spec: OptionSpec = {
385.         'noindex': directives.flag,
386.         'noindexentry': directives.flag,
387.         'module': directives.unchanged,
388.         'canonical': directives.unchanged,
389.         'annotation': directives.unchanged,
390.     }
391. 
392.     doc_field_types = [
393.         PyTypedField('parameter', label=_('Parameters'),
394.                      names=('param', 'parameter', 'arg', 'argument',
395.                             'keyword', 'kwarg', 'kwparam'),
396.                      typerolename='class', typenames=('paramtype', 'type'),
397.                      can_collapse=True),
398.         PyTypedField('variable', label=_('Variables'),
399.                      names=('var', 'ivar', 'cvar'),
400.                      typerolename='class', typenames=('vartype',),
401.                      can_collapse=True),
402.         PyGroupedField('exceptions', label=_('Raises'), rolename='exc',
403.                        names=('raises', 'raise', 'exception', 'except'),
404.                        can_collapse=True),
405.         Field('returnvalue', label=_('Returns'), has_arg=False,
406.               names=('returns', 'return')),
407.         PyField('returntype', label=_('Return type'), has_arg=False,
408.                 names=('rtype',), bodyrolename='class'),
409.     ]
410. 
411.     allow_nesting = False
412. 
413.     def get_signature_prefix(self, sig: str) -> str:
414.         """May return a prefix to put before the object name in the
415.         signature.
416.         """
417.         return ''
418. 
419.     def needs_arglist(self) -> bool:
420.         """May return true if an empty argument list is to be generated even if
421.         the document contains none.
422.         """
423.         return False
424. 
425.     def handle_signature(self, sig: str, signode: desc_signature) -> Tuple[str, str]:
426.         """Transform a Python signature into RST nodes.
427. 
428.         Return (fully qualified name of the thing, classname if any).
429. 
430.         If inside a class, the current class name is handled intelligently:
431.         * it is stripped from the displayed name if present
432.         * it is added to the full name (return value) if not present
433.         """
434.         m = py_sig_re.match(sig)
435.         if m is None:
436.             raise ValueError
437.         prefix, name, arglist, retann = m.groups()
438. 
439.         # determine module and class name (if applicable), as well as full name
440.         modname = self.options.get('module', self.env.ref_context.get('py:module'))
441.         classname = self.env.ref_context.get('py:class')
442.         if classname:
443.             add_module = False
444.             if prefix and (prefix == classname or
445.                            prefix.startswith(classname + ".")):
446.                 fullname = prefix + name
447.                 # class name is given again in the signature
448.                 prefix = prefix[len(classname):].lstrip('.')
449.             elif prefix:
450.                 # class name is given in the signature, but different
451.                 # (shouldn't happen)
452.                 fullname = classname + '.' + prefix + name
453.             else:
454.                 # class name is not given in the signature
455.                 fullname = classname + '.' + name
456.         else:
457.             add_module = True
458.             if prefix:
459.                 classname = prefix.rstrip('.')
460.                 fullname = prefix + name
461.             else:
462.                 classname = ''
463.                 fullname = name
464. 
465.         signode['module'] = modname
466.         signode['class'] = classname
467.         signode['fullname'] = fullname
468. 
469.         sig_prefix = self.get_signature_prefix(sig)
470.         if sig_prefix:
471.             signode += addnodes.desc_annotation(sig_prefix, sig_prefix)
472. 
473.         if prefix:
474.             signode += addnodes.desc_addname(prefix, prefix)
475.         elif modname and add_module and self.env.config.add_module_names:
476.             nodetext = modname + '.'
477.             signode += addnodes.desc_addname(nodetext, nodetext)
478. 
479.         signode += addnodes.desc_name(name, name)
480.         if arglist:
481.             try:
482.                 signode += _parse_arglist(arglist, self.env)
483.             except SyntaxError:
484.                 # fallback to parse arglist original parser.
485.                 # it supports to represent optional arguments (ex. "func(foo [, bar])")
486.                 _pseudo_parse_arglist(signode, arglist)
487.             except NotImplementedError as exc:
488.                 logger.warning("could not parse arglist (%r): %s", arglist, exc,
489.                                location=signode)
490.                 _pseudo_parse_arglist(signode, arglist)
491.         else:
492.             if self.needs_arglist():
493.                 # for callables, add an empty parameter list
494.                 signode += addnodes.desc_parameterlist()
495. 
496.         if retann:
497.             children = _parse_annotation(retann, self.env)
498.             signode += addnodes.desc_returns(retann, '', *children)
499. 
500.         anno = self.options.get('annotation')


File: sphinx/ext/autodoc/typehints.py
Line number range: 1 - 184
Content:
1. """
2.     sphinx.ext.autodoc.typehints
3.     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Generating content for autodoc using typehints
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. from collections import OrderedDict
13. from typing import Any, Dict, Iterable, Set, cast
14. 
15. from docutils import nodes
16. from docutils.nodes import Element
17. 
18. from sphinx import addnodes
19. from sphinx.application import Sphinx
20. from sphinx.util import inspect, typing
21. 
22. 
23. def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,
24.                      options: Dict, args: str, retann: str) -> None:
25.     """Record type hints to env object."""
26.     try:
27.         if callable(obj):
28.             annotations = app.env.temp_data.setdefault('annotations', {})
29.             annotation = annotations.setdefault(name, OrderedDict())
30.             sig = inspect.signature(obj, type_aliases=app.config.autodoc_type_aliases)
31.             for param in sig.parameters.values():
32.                 if param.annotation is not param.empty:
33.                     annotation[param.name] = typing.stringify(param.annotation)
34.             if sig.return_annotation is not sig.empty:
35.                 annotation['return'] = typing.stringify(sig.return_annotation)
36.     except (TypeError, ValueError):
37.         pass
38. 
39. 
40. def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element) -> None:
41.     if domain != 'py':
42.         return
43.     if app.config.autodoc_typehints not in ('both', 'description'):
44.         return
45. 
46.     try:
47.         signature = cast(addnodes.desc_signature, contentnode.parent[0])
48.         if signature['module']:
49.             fullname = '.'.join([signature['module'], signature['fullname']])
50.         else:
51.             fullname = signature['fullname']
52.     except KeyError:
53.         # signature node does not have valid context info for the target object
54.         return
55. 
56.     annotations = app.env.temp_data.get('annotations', {})
57.     if annotations.get(fullname, {}):
58.         field_lists = [n for n in contentnode if isinstance(n, nodes.field_list)]
59.         if field_lists == []:
60.             field_list = insert_field_list(contentnode)
61.             field_lists.append(field_list)
62. 
63.         for field_list in field_lists:
64.             if app.config.autodoc_typehints_description_target == "all":
65.                 modify_field_list(field_list, annotations[fullname])
66.             else:
67.                 augment_descriptions_with_types(field_list, annotations[fullname])
68. 
69. 
70. def insert_field_list(node: Element) -> nodes.field_list:
71.     field_list = nodes.field_list()
72.     desc = [n for n in node if isinstance(n, addnodes.desc)]
73.     if desc:
74.         # insert just before sub object descriptions (ex. methods, nested classes, etc.)
75.         index = node.index(desc[0])
76.         node.insert(index - 1, [field_list])
77.     else:
78.         node += field_list
79. 
80.     return field_list
81. 
82. 
83. def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> None:
84.     arguments: Dict[str, Dict[str, bool]] = {}
85.     fields = cast(Iterable[nodes.field], node)
86.     for field in fields:
87.         field_name = field[0].astext()
88.         parts = re.split(' +', field_name)
89.         if parts[0] == 'param':
90.             if len(parts) == 2:
91.                 # :param xxx:
92.                 arg = arguments.setdefault(parts[1], {})
93.                 arg['param'] = True
94.             elif len(parts) > 2:
95.                 # :param xxx yyy:
96.                 name = ' '.join(parts[2:])
97.                 arg = arguments.setdefault(name, {})
98.                 arg['param'] = True
99.                 arg['type'] = True
100.         elif parts[0] == 'type':
101.             name = ' '.join(parts[1:])
102.             arg = arguments.setdefault(name, {})
103.             arg['type'] = True
104.         elif parts[0] == 'rtype':
105.             arguments['return'] = {'type': True}
106. 
107.     for name, annotation in annotations.items():
108.         if name == 'return':
109.             continue
110. 
111.         arg = arguments.get(name, {})
112.         if not arg.get('type'):
113.             field = nodes.field()
114.             field += nodes.field_name('', 'type ' + name)
115.             field += nodes.field_body('', nodes.paragraph('', annotation))
116.             node += field
117.         if not arg.get('param'):
118.             field = nodes.field()
119.             field += nodes.field_name('', 'param ' + name)
120.             field += nodes.field_body('', nodes.paragraph('', ''))
121.             node += field
122. 
123.     if 'return' in annotations and 'return' not in arguments:
124.         field = nodes.field()
125.         field += nodes.field_name('', 'rtype')
126.         field += nodes.field_body('', nodes.paragraph('', annotation))
127.         node += field
128. 
129. 
130. def augment_descriptions_with_types(
131.     node: nodes.field_list,
132.     annotations: Dict[str, str],
133. ) -> None:
134.     fields = cast(Iterable[nodes.field], node)
135.     has_description = set()  # type: Set[str]
136.     has_type = set()  # type: Set[str]
137.     for field in fields:
138.         field_name = field[0].astext()
139.         parts = re.split(' +', field_name)
140.         if parts[0] == 'param':
141.             if len(parts) == 2:
142.                 # :param xxx:
143.                 has_description.add(parts[1])
144.             elif len(parts) > 2:
145.                 # :param xxx yyy:
146.                 name = ' '.join(parts[2:])
147.                 has_description.add(name)
148.                 has_type.add(name)
149.         elif parts[0] == 'type':
150.             name = ' '.join(parts[1:])
151.             has_type.add(name)
152.         elif parts[0] == 'return':
153.             has_description.add('return')
154.         elif parts[0] == 'rtype':
155.             has_type.add('return')
156. 
157.     # Add 'type' for parameters with a description but no declared type.
158.     for name in annotations:
159.         if name == 'return':
160.             continue
161.         if name in has_description and name not in has_type:
162.             field = nodes.field()
163.             field += nodes.field_name('', 'type ' + name)
164.             field += nodes.field_body('', nodes.paragraph('', annotations[name]))
165.             node += field
166. 
167.     # Add 'rtype' if 'return' is present and 'rtype' isn't.
168.     if 'return' in annotations:
169.         if 'return' in has_description and 'return' not in has_type:
170.             field = nodes.field()
171.             field += nodes.field_name('', 'rtype')
172.             field += nodes.field_body('', nodes.paragraph('', annotations['return']))
173.             node += field
174. 
175. 
176. def setup(app: Sphinx) -> Dict[str, Any]:
177.     app.connect('autodoc-process-signature', record_typehints)
178.     app.connect('object-description-transform', merge_typehints)
179. 
180.     return {
181.         'version': 'builtin',
182.         'parallel_read_safe': True,
183.         'parallel_write_safe': True,
184.     }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 08:37:02,399 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `sphinx/domains/python.py`. This context provides the entire file as requested.', relative_path='sphinx/domains/python.py', start_line=1, end_line=500), ContextOutput(reasoning='The user requested the full content of `sphinx/ext/autodoc/typehints.py`. This context provides the entire file as requested.', relative_path='sphinx/ext/autodoc/typehints.py', start_line=1, end_line=184)]
2025-12-21 08:37:02,401 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`.
2025-12-21 08:37:02,401 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 08:37:02,401 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 08:37:02,402 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 0 existing contexts
2025-12-21 08:37:02,402 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 08:37:02,403 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Nitpick flags Literal annotation values as missing py:class

Description: ### Describe the bug

When a value is present in a type annotation as `Literal`, sphinx will treat the value as a `py:class`. With nitpick enabled, values like `Literal[True]` end up failing, because `True` is not a class.

This is a problem for builds which want to use `-n -W` to catch doc errors.

### How to Reproduce

Setup a simple function which uses Literal, then attempt to autodoc it. e.g.
```python
import typing
@typing.overload
def foo(x: "typing.Literal[True]") -> int: ...
@typing.overload
def foo(x: "typing.Literal[False]") -> str: ...
def foo(x: bool):
    """a func"""
    return 1 if x else "foo"
```

I've pushed an example [failing project](https://github.com/sirosen/repro/tree/master/sphinxdoc/literal) to [my repro repo](https://github.com/sirosen/repro). Just run `./doc.sh` with `sphinx-build` available to see the failing build.

### Expected behavior

`Literal[True]` (or whatever literal value) should be present in the type annotation but should not trigger the nitpick warning.

### Your project

https://github.com/sirosen/repro/tree/master/sphinxdoc/literal

### Screenshots

_No response_

### OS

Linux

### Python version

3.8, 3.9

### Sphinx version

4.1.2

### Sphinx extensions

autodoc

### Extra tools

_No response_

### Additional context

_No response_

Patch information:
diff --git a/sphinx/domains/python.py b/sphinx/domains/python.py
index 9875a9f4b..e1c6e595b 100644
--- a/sphinx/domains/python.py
+++ b/sphinx/domains/python.py
@@ -109,13 +109,21 @@ def type_to_xref(text: str, env: BuildEnvironment = None) -> addnodes.pending_xr
 
 def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Node]:
     """Parse type annotation."""
-    def unparse(node: ast.AST) -> List[Node]:
+    def is_literal_type(n: ast.AST) -> bool:
+        if isinstance(n, ast.Name):
+            return n.id == 'Literal'
+        elif isinstance(n, ast.Attribute):
+            return n.attr == 'Literal'
+        else:
+            return False
+
+    def unparse(node: ast.AST, in_literal: bool = False) -> List[Node]:
         if isinstance(node, ast.Attribute):
-            return [nodes.Text("%s.%s" % (unparse(node.value)[0], node.attr))]
+            return [nodes.Text("%s.%s" % (unparse(node.value, in_literal)[0], node.attr))]
         elif isinstance(node, ast.BinOp):
-            result: List[Node] = unparse(node.left)
-            result.extend(unparse(node.op))
-            result.extend(unparse(node.right))
+            result: List[Node] = unparse(node.left, in_literal)
+            result.extend(unparse(node.op, in_literal))
+            result.extend(unparse(node.right, in_literal))
             return result
         elif isinstance(node, ast.BitOr):
             return [nodes.Text(' '), addnodes.desc_sig_punctuation('', '|'), nodes.Text(' ')]
@@ -123,11 +131,14 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
             if node.value is Ellipsis:
                 return [addnodes.desc_sig_punctuation('', "...")]
             else:
-                return [nodes.Text(node.value)]
+                if in_literal:
+                    return [nodes.Text(repr(node.value))]
+                else:
+                    return [nodes.Text(node.value)]
         elif isinstance(node, ast.Expr):
-            return unparse(node.value)
+            return unparse(node.value, in_literal)
         elif isinstance(node, ast.Index):
-            return unparse(node.value)
+            return unparse(node.value, in_literal)
         elif isinstance(node, ast.List):
             result = [addnodes.desc_sig_punctuation('', '[')]
             if node.elts:
@@ -135,26 +146,27 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
                 # last element of result if the for-loop was run at least
                 # once
                 for elem in node.elts:
-                    result.extend(unparse(elem))
+                    result.extend(unparse(elem, in_literal))
                     result.append(addnodes.desc_sig_punctuation('', ', '))
                 result.pop()
             result.append(addnodes.desc_sig_punctuation('', ']'))
             return result
         elif isinstance(node, ast.Module):
-            return sum((unparse(e) for e in node.body), [])
+            return sum((unparse(e, in_literal) for e in node.body), [])
         elif isinstance(node, ast.Name):
             return [nodes.Text(node.id)]
         elif isinstance(node, ast.Subscript):
-            result = unparse(node.value)
+            result = unparse(node.value, in_literal)
             result.append(addnodes.desc_sig_punctuation('', '['))
-            result.extend(unparse(node.slice))
+            slice_in_literal = in_literal or is_literal_type(node.value)
+            result.extend(unparse(node.slice, slice_in_literal))
             result.append(addnodes.desc_sig_punctuation('', ']'))
             return result
         elif isinstance(node, ast.Tuple):
             if node.elts:
                 result = []
                 for elem in node.elts:
-                    result.extend(unparse(elem))
+                    result.extend(unparse(elem, in_literal))
                     result.append(addnodes.desc_sig_punctuation('', ', '))
                 result.pop()
             else:
@@ -167,7 +179,10 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
                 if isinstance(node, ast.Ellipsis):
                     return [addnodes.desc_sig_punctuation('', "...")]
                 elif isinstance(node, ast.NameConstant):
-                    return [nodes.Text(node.value)]
+                    if in_literal:
+                        return [nodes.Text(repr(node.value))]
+                    else:
+                        return [nodes.Text(node.value)]
 
             raise SyntaxError  # unsupported syntax
 
@@ -178,10 +193,44 @@ def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Nod
     try:
         tree = ast_parse(annotation)
         result = unparse(tree)
-        for i, node in enumerate(result):
+        converted: List[Node] = []
+        in_literal_args = False
+        literal_detected = False
+        depth = 0
+        for node in result:
+            if isinstance(node, addnodes.desc_sig_punctuation):
+                punct = node.astext()
+                if not in_literal_args:
+                    if literal_detected and punct == '[':
+                        in_literal_args = True
+                        depth = 1
+                        converted.append(node)
+                        continue
+                else:
+                    if punct == '[':
+                        depth += 1
+                    elif punct == ']':
+                        depth -= 1
+                        if depth == 0:
+                            in_literal_args = False
+                            literal_detected = False
+                    converted.append(node)
+                    continue
+                converted.append(node)
+                continue
             if isinstance(node, nodes.Text) and node.strip():
-                result[i] = type_to_xref(str(node), env)
-        return result
+                text = str(node)
+                if not in_literal_args:
+                    if text == 'Literal' or text.endswith('.Literal'):
+                        literal_detected = True
+                    else:
+                        literal_detected = False
+                    converted.append(type_to_xref(text, env))
+                else:
+                    converted.append(nodes.Text(text))
+            else:
+                converted.append(node)
+        return converted
     except SyntaxError:
         return [type_to_xref(annotation, env)]
 


Find all relevant source code context needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`.
Extra Requirements: 
Purpose: To analyze the processing of type annotations from autodoc to the Python domain and understand the provided patch for the `Literal` type bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sphinx/domains/python.py
Line number range: 1 - 500
Content:
1. """
2.     sphinx.domains.python
3.     ~~~~~~~~~~~~~~~~~~~~~
4. 
5.     The Python domain.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import builtins
12. import inspect
13. import re
14. import sys
15. import typing
16. import warnings
17. from inspect import Parameter
18. from typing import Any, Dict, Iterable, Iterator, List, NamedTuple, Optional, Tuple, Type, cast
19. 
20. from docutils import nodes
21. from docutils.nodes import Element, Node
22. from docutils.parsers.rst import directives
23. from docutils.parsers.rst.states import Inliner
24. 
25. from sphinx import addnodes
26. from sphinx.addnodes import desc_signature, pending_xref, pending_xref_condition
27. from sphinx.application import Sphinx
28. from sphinx.builders import Builder
29. from sphinx.deprecation import RemovedInSphinx50Warning
30. from sphinx.directives import ObjectDescription
31. from sphinx.domains import Domain, Index, IndexEntry, ObjType
32. from sphinx.environment import BuildEnvironment
33. from sphinx.locale import _, __
34. from sphinx.pycode.ast import ast
35. from sphinx.pycode.ast import parse as ast_parse
36. from sphinx.roles import XRefRole
37. from sphinx.util import logging
38. from sphinx.util.docfields import Field, GroupedField, TypedField
39. from sphinx.util.docutils import SphinxDirective
40. from sphinx.util.inspect import signature_from_str
41. from sphinx.util.nodes import find_pending_xref_condition, make_id, make_refnode
42. from sphinx.util.typing import OptionSpec, TextlikeNode
43. 
44. logger = logging.getLogger(__name__)
45. 
46. 
47. # REs for Python signatures
48. py_sig_re = re.compile(
49.     r'''^ ([\w.]*\.)?            # class name(s)
50.           (\w+)  \s*             # thing name
51.           (?: \(\s*(.*)\s*\)     # optional: arguments
52.            (?:\s* -> \s* (.*))?  #           return annotation
53.           )? $                   # and nothing more
54.           ''', re.VERBOSE)
55. 
56. 
57. pairindextypes = {
58.     'module':    _('module'),
59.     'keyword':   _('keyword'),
60.     'operator':  _('operator'),
61.     'object':    _('object'),
62.     'exception': _('exception'),
63.     'statement': _('statement'),
64.     'builtin':   _('built-in function'),
65. }
66. 
67. 
68. class ObjectEntry(NamedTuple):
69.     docname: str
70.     node_id: str
71.     objtype: str
72.     aliased: bool
73. 
74. 
75. class ModuleEntry(NamedTuple):
76.     docname: str
77.     node_id: str
78.     synopsis: str
79.     platform: str
80.     deprecated: bool
81. 
82. 
83. def type_to_xref(text: str, env: BuildEnvironment = None) -> addnodes.pending_xref:
84.     """Convert a type string to a cross reference node."""
85.     if text == 'None':
86.         reftype = 'obj'
87.     else:
88.         reftype = 'class'
89. 
90.     if env:
91.         kwargs = {'py:module': env.ref_context.get('py:module'),
92.                   'py:class': env.ref_context.get('py:class')}
93.     else:
94.         kwargs = {}
95. 
96.     if env.config.python_use_unqualified_type_names:
97.         # Note: It would be better to use qualname to describe the object to support support
98.         # nested classes.  But python domain can't access the real python object because this
99.         # module should work not-dynamically.
100.         shortname = text.split('.')[-1]
101.         contnodes: List[Node] = [pending_xref_condition('', shortname, condition='resolved'),
102.                                  pending_xref_condition('', text, condition='*')]
103.     else:
104.         contnodes = [nodes.Text(text)]
105. 
106.     return pending_xref('', *contnodes,
107.                         refdomain='py', reftype=reftype, reftarget=text, **kwargs)
108. 
109. 
110. def _parse_annotation(annotation: str, env: BuildEnvironment = None) -> List[Node]:
111.     """Parse type annotation."""
112.     def unparse(node: ast.AST) -> List[Node]:
113.         if isinstance(node, ast.Attribute):
114.             return [nodes.Text("%s.%s" % (unparse(node.value)[0], node.attr))]
115.         elif isinstance(node, ast.BinOp):
116.             result: List[Node] = unparse(node.left)
117.             result.extend(unparse(node.op))
118.             result.extend(unparse(node.right))
119.             return result
120.         elif isinstance(node, ast.BitOr):
121.             return [nodes.Text(' '), addnodes.desc_sig_punctuation('', '|'), nodes.Text(' ')]
122.         elif isinstance(node, ast.Constant):  # type: ignore
123.             if node.value is Ellipsis:
124.                 return [addnodes.desc_sig_punctuation('', "...")]
125.             else:
126.                 return [nodes.Text(node.value)]
127.         elif isinstance(node, ast.Expr):
128.             return unparse(node.value)
129.         elif isinstance(node, ast.Index):
130.             return unparse(node.value)
131.         elif isinstance(node, ast.List):
132.             result = [addnodes.desc_sig_punctuation('', '[')]
133.             if node.elts:
134.                 # check if there are elements in node.elts to only pop the
135.                 # last element of result if the for-loop was run at least
136.                 # once
137.                 for elem in node.elts:
138.                     result.extend(unparse(elem))
139.                     result.append(addnodes.desc_sig_punctuation('', ', '))
140.                 result.pop()
141.             result.append(addnodes.desc_sig_punctuation('', ']'))
142.             return result
143.         elif isinstance(node, ast.Module):
144.             return sum((unparse(e) for e in node.body), [])
145.         elif isinstance(node, ast.Name):
146.             return [nodes.Text(node.id)]
147.         elif isinstance(node, ast.Subscript):
148.             result = unparse(node.value)
149.             result.append(addnodes.desc_sig_punctuation('', '['))
150.             result.extend(unparse(node.slice))
151.             result.append(addnodes.desc_sig_punctuation('', ']'))
152.             return result
153.         elif isinstance(node, ast.Tuple):
154.             if node.elts:
155.                 result = []
156.                 for elem in node.elts:
157.                     result.extend(unparse(elem))
158.                     result.append(addnodes.desc_sig_punctuation('', ', '))
159.                 result.pop()
160.             else:
161.                 result = [addnodes.desc_sig_punctuation('', '('),
162.                           addnodes.desc_sig_punctuation('', ')')]
163. 
164.             return result
165.         else:
166.             if sys.version_info < (3, 8):
167.                 if isinstance(node, ast.Ellipsis):
168.                     return [addnodes.desc_sig_punctuation('', "...")]
169.                 elif isinstance(node, ast.NameConstant):
170.                     return [nodes.Text(node.value)]
171. 
172.             raise SyntaxError  # unsupported syntax
173. 
174.     if env is None:
175.         warnings.warn("The env parameter for _parse_annotation becomes required now.",
176.                       RemovedInSphinx50Warning, stacklevel=2)
177. 
178.     try:
179.         tree = ast_parse(annotation)
180.         result = unparse(tree)
181.         for i, node in enumerate(result):
182.             if isinstance(node, nodes.Text) and node.strip():
183.                 result[i] = type_to_xref(str(node), env)
184.         return result
185.     except SyntaxError:
186.         return [type_to_xref(annotation, env)]
187. 
188. 
189. def _parse_arglist(arglist: str, env: BuildEnvironment = None) -> addnodes.desc_parameterlist:
190.     """Parse a list of arguments using AST parser"""
191.     params = addnodes.desc_parameterlist(arglist)
192.     sig = signature_from_str('(%s)' % arglist)
193.     last_kind = None
194.     for param in sig.parameters.values():
195.         if param.kind != param.POSITIONAL_ONLY and last_kind == param.POSITIONAL_ONLY:
196.             # PEP-570: Separator for Positional Only Parameter: /
197.             params += addnodes.desc_parameter('', '', addnodes.desc_sig_operator('', '/'))
198.         if param.kind == param.KEYWORD_ONLY and last_kind in (param.POSITIONAL_OR_KEYWORD,
199.                                                               param.POSITIONAL_ONLY,
200.                                                               None):
201.             # PEP-3102: Separator for Keyword Only Parameter: *
202.             params += addnodes.desc_parameter('', '', addnodes.desc_sig_operator('', '*'))
203. 
204.         node = addnodes.desc_parameter()
205.         if param.kind == param.VAR_POSITIONAL:
206.             node += addnodes.desc_sig_operator('', '*')
207.             node += addnodes.desc_sig_name('', param.name)
208.         elif param.kind == param.VAR_KEYWORD:
209.             node += addnodes.desc_sig_operator('', '**')
210.             node += addnodes.desc_sig_name('', param.name)
211.         else:
212.             node += addnodes.desc_sig_name('', param.name)
213. 
214.         if param.annotation is not param.empty:
215.             children = _parse_annotation(param.annotation, env)
216.             node += addnodes.desc_sig_punctuation('', ':')
217.             node += nodes.Text(' ')
218.             node += addnodes.desc_sig_name('', '', *children)  # type: ignore
219.         if param.default is not param.empty:
220.             if param.annotation is not param.empty:
221.                 node += nodes.Text(' ')
222.                 node += addnodes.desc_sig_operator('', '=')
223.                 node += nodes.Text(' ')
224.             else:
225.                 node += addnodes.desc_sig_operator('', '=')
226.             node += nodes.inline('', param.default, classes=['default_value'],
227.                                  support_smartquotes=False)
228. 
229.         params += node
230.         last_kind = param.kind
231. 
232.     if last_kind == Parameter.POSITIONAL_ONLY:
233.         # PEP-570: Separator for Positional Only Parameter: /
234.         params += addnodes.desc_parameter('', '', addnodes.desc_sig_operator('', '/'))
235. 
236.     return params
237. 
238. 
239. def _pseudo_parse_arglist(signode: desc_signature, arglist: str) -> None:
240.     """"Parse" a list of arguments separated by commas.
241. 
242.     Arguments can have "optional" annotations given by enclosing them in
243.     brackets.  Currently, this will split at any comma, even if it's inside a
244.     string literal (e.g. default argument value).
245.     """
246.     paramlist = addnodes.desc_parameterlist()
247.     stack: List[Element] = [paramlist]
248.     try:
249.         for argument in arglist.split(','):
250.             argument = argument.strip()
251.             ends_open = ends_close = 0
252.             while argument.startswith('['):
253.                 stack.append(addnodes.desc_optional())
254.                 stack[-2] += stack[-1]
255.                 argument = argument[1:].strip()
256.             while argument.startswith(']'):
257.                 stack.pop()
258.                 argument = argument[1:].strip()
259.             while argument.endswith(']') and not argument.endswith('[]'):
260.                 ends_close += 1
261.                 argument = argument[:-1].strip()
262.             while argument.endswith('['):
263.                 ends_open += 1
264.                 argument = argument[:-1].strip()
265.             if argument:
266.                 stack[-1] += addnodes.desc_parameter(argument, argument)
267.             while ends_open:
268.                 stack.append(addnodes.desc_optional())
269.                 stack[-2] += stack[-1]
270.                 ends_open -= 1
271.             while ends_close:
272.                 stack.pop()
273.                 ends_close -= 1
274.         if len(stack) != 1:
275.             raise IndexError
276.     except IndexError:
277.         # if there are too few or too many elements on the stack, just give up
278.         # and treat the whole argument list as one argument, discarding the
279.         # already partially populated paramlist node
280.         paramlist = addnodes.desc_parameterlist()
281.         paramlist += addnodes.desc_parameter(arglist, arglist)
282.         signode += paramlist
283.     else:
284.         signode += paramlist
285. 
286. 
287. # This override allows our inline type specifiers to behave like :class: link
288. # when it comes to handling "." and "~" prefixes.
289. class PyXrefMixin:
290.     def make_xref(self, rolename: str, domain: str, target: str,
291.                   innernode: Type[TextlikeNode] = nodes.emphasis,
292.                   contnode: Node = None, env: BuildEnvironment = None,
293.                   inliner: Inliner = None, location: Node = None) -> Node:
294.         # we use inliner=None to make sure we get the old behaviour with a single
295.         # pending_xref node
296.         result = super().make_xref(rolename, domain, target,  # type: ignore
297.                                    innernode, contnode,
298.                                    env, inliner=None, location=None)
299.         result['refspecific'] = True
300.         result['py:module'] = env.ref_context.get('py:module')
301.         result['py:class'] = env.ref_context.get('py:class')
302.         if target.startswith(('.', '~')):
303.             prefix, result['reftarget'] = target[0], target[1:]
304.             if prefix == '.':
305.                 text = target[1:]
306.             elif prefix == '~':
307.                 text = target.split('.')[-1]
308.             for node in result.traverse(nodes.Text):
309.                 node.parent[node.parent.index(node)] = nodes.Text(text)
310.                 break
311.         elif isinstance(result, pending_xref) and env.config.python_use_unqualified_type_names:
312.             children = result.children
313.             result.clear()
314. 
315.             shortname = target.split('.')[-1]
316.             textnode = innernode('', shortname)
317.             contnodes = [pending_xref_condition('', '', textnode, condition='resolved'),
318.                          pending_xref_condition('', '', *children, condition='*')]
319.             result.extend(contnodes)
320. 
321.         return result
322. 
323.     def make_xrefs(self, rolename: str, domain: str, target: str,
324.                    innernode: Type[TextlikeNode] = nodes.emphasis,
325.                    contnode: Node = None, env: BuildEnvironment = None,
326.                    inliner: Inliner = None, location: Node = None) -> List[Node]:
327.         delims = r'(\s*[\[\]\(\),](?:\s*or\s)?\s*|\s+or\s+|\s*\|\s*|\.\.\.)'
328.         delims_re = re.compile(delims)
329.         sub_targets = re.split(delims, target)
330. 
331.         split_contnode = bool(contnode and contnode.astext() == target)
332. 
333.         results = []
334.         for sub_target in filter(None, sub_targets):
335.             if split_contnode:
336.                 contnode = nodes.Text(sub_target)
337. 
338.             if delims_re.match(sub_target):
339.                 results.append(contnode or innernode(sub_target, sub_target))
340.             else:
341.                 results.append(self.make_xref(rolename, domain, sub_target,
342.                                               innernode, contnode, env, inliner, location))
343. 
344.         return results
345. 
346. 
347. class PyField(PyXrefMixin, Field):
348.     def make_xref(self, rolename: str, domain: str, target: str,
349.                   innernode: Type[TextlikeNode] = nodes.emphasis,
350.                   contnode: Node = None, env: BuildEnvironment = None,
351.                   inliner: Inliner = None, location: Node = None) -> Node:
352.         if rolename == 'class' and target == 'None':
353.             # None is not a type, so use obj role instead.
354.             rolename = 'obj'
355. 
356.         return super().make_xref(rolename, domain, target, innernode, contnode,
357.                                  env, inliner, location)
358. 
359. 
360. class PyGroupedField(PyXrefMixin, GroupedField):
361.     pass
362. 
363. 
364. class PyTypedField(PyXrefMixin, TypedField):
365.     def make_xref(self, rolename: str, domain: str, target: str,
366.                   innernode: Type[TextlikeNode] = nodes.emphasis,
367.                   contnode: Node = None, env: BuildEnvironment = None,
368.                   inliner: Inliner = None, location: Node = None) -> Node:
369.         if rolename == 'class' and target == 'None':
370.             # None is not a type, so use obj role instead.
371.             rolename = 'obj'
372. 
373.         return super().make_xref(rolename, domain, target, innernode, contnode,
374.                                  env, inliner, location)
375. 
376. 
377. class PyObject(ObjectDescription[Tuple[str, str]]):
378.     """
379.     Description of a general Python object.
380. 
381.     :cvar allow_nesting: Class is an object that allows for nested namespaces
382.     :vartype allow_nesting: bool
383.     """
384.     option_spec: OptionSpec = {
385.         'noindex': directives.flag,
386.         'noindexentry': directives.flag,
387.         'module': directives.unchanged,
388.         'canonical': directives.unchanged,
389.         'annotation': directives.unchanged,
390.     }
391. 
392.     doc_field_types = [
393.         PyTypedField('parameter', label=_('Parameters'),
394.                      names=('param', 'parameter', 'arg', 'argument',
395.                             'keyword', 'kwarg', 'kwparam'),
396.                      typerolename='class', typenames=('paramtype', 'type'),
397.                      can_collapse=True),
398.         PyTypedField('variable', label=_('Variables'),
399.                      names=('var', 'ivar', 'cvar'),
400.                      typerolename='class', typenames=('vartype',),
401.                      can_collapse=True),
402.         PyGroupedField('exceptions', label=_('Raises'), rolename='exc',
403.                        names=('raises', 'raise', 'exception', 'except'),
404.                        can_collapse=True),
405.         Field('returnvalue', label=_('Returns'), has_arg=False,
406.               names=('returns', 'return')),
407.         PyField('returntype', label=_('Return type'), has_arg=False,
408.                 names=('rtype',), bodyrolename='class'),
409.     ]
410. 
411.     allow_nesting = False
412. 
413.     def get_signature_prefix(self, sig: str) -> str:
414.         """May return a prefix to put before the object name in the
415.         signature.
416.         """
417.         return ''
418. 
419.     def needs_arglist(self) -> bool:
420.         """May return true if an empty argument list is to be generated even if
421.         the document contains none.
422.         """
423.         return False
424. 
425.     def handle_signature(self, sig: str, signode: desc_signature) -> Tuple[str, str]:
426.         """Transform a Python signature into RST nodes.
427. 
428.         Return (fully qualified name of the thing, classname if any).
429. 
430.         If inside a class, the current class name is handled intelligently:
431.         * it is stripped from the displayed name if present
432.         * it is added to the full name (return value) if not present
433.         """
434.         m = py_sig_re.match(sig)
435.         if m is None:
436.             raise ValueError
437.         prefix, name, arglist, retann = m.groups()
438. 
439.         # determine module and class name (if applicable), as well as full name
440.         modname = self.options.get('module', self.env.ref_context.get('py:module'))
441.         classname = self.env.ref_context.get('py:class')
442.         if classname:
443.             add_module = False
444.             if prefix and (prefix == classname or
445.                            prefix.startswith(classname + ".")):
446.                 fullname = prefix + name
447.                 # class name is given again in the signature
448.                 prefix = prefix[len(classname):].lstrip('.')
449.             elif prefix:
450.                 # class name is given in the signature, but different
451.                 # (shouldn't happen)
452.                 fullname = classname + '.' + prefix + name
453.             else:
454.                 # class name is not given in the signature
455.                 fullname = classname + '.' + name
456.         else:
457.             add_module = True
458.             if prefix:
459.                 classname = prefix.rstrip('.')
460.                 fullname = prefix + name
461.             else:
462.                 classname = ''
463.                 fullname = name
464. 
465.         signode['module'] = modname
466.         signode['class'] = classname
467.         signode['fullname'] = fullname
468. 
469.         sig_prefix = self.get_signature_prefix(sig)
470.         if sig_prefix:
471.             signode += addnodes.desc_annotation(sig_prefix, sig_prefix)
472. 
473.         if prefix:
474.             signode += addnodes.desc_addname(prefix, prefix)
475.         elif modname and add_module and self.env.config.add_module_names:
476.             nodetext = modname + '.'
477.             signode += addnodes.desc_addname(nodetext, nodetext)
478. 
479.         signode += addnodes.desc_name(name, name)
480.         if arglist:
481.             try:
482.                 signode += _parse_arglist(arglist, self.env)
483.             except SyntaxError:
484.                 # fallback to parse arglist original parser.
485.                 # it supports to represent optional arguments (ex. "func(foo [, bar])")
486.                 _pseudo_parse_arglist(signode, arglist)
487.             except NotImplementedError as exc:
488.                 logger.warning("could not parse arglist (%r): %s", arglist, exc,
489.                                location=signode)
490.                 _pseudo_parse_arglist(signode, arglist)
491.         else:
492.             if self.needs_arglist():
493.                 # for callables, add an empty parameter list
494.                 signode += addnodes.desc_parameterlist()
495. 
496.         if retann:
497.             children = _parse_annotation(retann, self.env)
498.             signode += addnodes.desc_returns(retann, '', *children)
499. 
500.         anno = self.options.get('annotation')


File: sphinx/ext/autodoc/typehints.py
Line number range: 1 - 184
Content:
1. """
2.     sphinx.ext.autodoc.typehints
3.     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Generating content for autodoc using typehints
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import re
12. from collections import OrderedDict
13. from typing import Any, Dict, Iterable, Set, cast
14. 
15. from docutils import nodes
16. from docutils.nodes import Element
17. 
18. from sphinx import addnodes
19. from sphinx.application import Sphinx
20. from sphinx.util import inspect, typing
21. 
22. 
23. def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,
24.                      options: Dict, args: str, retann: str) -> None:
25.     """Record type hints to env object."""
26.     try:
27.         if callable(obj):
28.             annotations = app.env.temp_data.setdefault('annotations', {})
29.             annotation = annotations.setdefault(name, OrderedDict())
30.             sig = inspect.signature(obj, type_aliases=app.config.autodoc_type_aliases)
31.             for param in sig.parameters.values():
32.                 if param.annotation is not param.empty:
33.                     annotation[param.name] = typing.stringify(param.annotation)
34.             if sig.return_annotation is not sig.empty:
35.                 annotation['return'] = typing.stringify(sig.return_annotation)
36.     except (TypeError, ValueError):
37.         pass
38. 
39. 
40. def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element) -> None:
41.     if domain != 'py':
42.         return
43.     if app.config.autodoc_typehints not in ('both', 'description'):
44.         return
45. 
46.     try:
47.         signature = cast(addnodes.desc_signature, contentnode.parent[0])
48.         if signature['module']:
49.             fullname = '.'.join([signature['module'], signature['fullname']])
50.         else:
51.             fullname = signature['fullname']
52.     except KeyError:
53.         # signature node does not have valid context info for the target object
54.         return
55. 
56.     annotations = app.env.temp_data.get('annotations', {})
57.     if annotations.get(fullname, {}):
58.         field_lists = [n for n in contentnode if isinstance(n, nodes.field_list)]
59.         if field_lists == []:
60.             field_list = insert_field_list(contentnode)
61.             field_lists.append(field_list)
62. 
63.         for field_list in field_lists:
64.             if app.config.autodoc_typehints_description_target == "all":
65.                 modify_field_list(field_list, annotations[fullname])
66.             else:
67.                 augment_descriptions_with_types(field_list, annotations[fullname])
68. 
69. 
70. def insert_field_list(node: Element) -> nodes.field_list:
71.     field_list = nodes.field_list()
72.     desc = [n for n in node if isinstance(n, addnodes.desc)]
73.     if desc:
74.         # insert just before sub object descriptions (ex. methods, nested classes, etc.)
75.         index = node.index(desc[0])
76.         node.insert(index - 1, [field_list])
77.     else:
78.         node += field_list
79. 
80.     return field_list
81. 
82. 
83. def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> None:
84.     arguments: Dict[str, Dict[str, bool]] = {}
85.     fields = cast(Iterable[nodes.field], node)
86.     for field in fields:
87.         field_name = field[0].astext()
88.         parts = re.split(' +', field_name)
89.         if parts[0] == 'param':
90.             if len(parts) == 2:
91.                 # :param xxx:
92.                 arg = arguments.setdefault(parts[1], {})
93.                 arg['param'] = True
94.             elif len(parts) > 2:
95.                 # :param xxx yyy:
96.                 name = ' '.join(parts[2:])
97.                 arg = arguments.setdefault(name, {})
98.                 arg['param'] = True
99.                 arg['type'] = True
100.         elif parts[0] == 'type':
101.             name = ' '.join(parts[1:])
102.             arg = arguments.setdefault(name, {})
103.             arg['type'] = True
104.         elif parts[0] == 'rtype':
105.             arguments['return'] = {'type': True}
106. 
107.     for name, annotation in annotations.items():
108.         if name == 'return':
109.             continue
110. 
111.         arg = arguments.get(name, {})
112.         if not arg.get('type'):
113.             field = nodes.field()
114.             field += nodes.field_name('', 'type ' + name)
115.             field += nodes.field_body('', nodes.paragraph('', annotation))
116.             node += field
117.         if not arg.get('param'):
118.             field = nodes.field()
119.             field += nodes.field_name('', 'param ' + name)
120.             field += nodes.field_body('', nodes.paragraph('', ''))
121.             node += field
122. 
123.     if 'return' in annotations and 'return' not in arguments:
124.         field = nodes.field()
125.         field += nodes.field_name('', 'rtype')
126.         field += nodes.field_body('', nodes.paragraph('', annotation))
127.         node += field
128. 
129. 
130. def augment_descriptions_with_types(
131.     node: nodes.field_list,
132.     annotations: Dict[str, str],
133. ) -> None:
134.     fields = cast(Iterable[nodes.field], node)
135.     has_description = set()  # type: Set[str]
136.     has_type = set()  # type: Set[str]
137.     for field in fields:
138.         field_name = field[0].astext()
139.         parts = re.split(' +', field_name)
140.         if parts[0] == 'param':
141.             if len(parts) == 2:
142.                 # :param xxx:
143.                 has_description.add(parts[1])
144.             elif len(parts) > 2:
145.                 # :param xxx yyy:
146.                 name = ' '.join(parts[2:])
147.                 has_description.add(name)
148.                 has_type.add(name)
149.         elif parts[0] == 'type':
150.             name = ' '.join(parts[1:])
151.             has_type.add(name)
152.         elif parts[0] == 'return':
153.             has_description.add('return')
154.         elif parts[0] == 'rtype':
155.             has_type.add('return')
156. 
157.     # Add 'type' for parameters with a description but no declared type.
158.     for name in annotations:
159.         if name == 'return':
160.             continue
161.         if name in has_description and name not in has_type:
162.             field = nodes.field()
163.             field += nodes.field_name('', 'type ' + name)
164.             field += nodes.field_body('', nodes.paragraph('', annotations[name]))
165.             node += field
166. 
167.     # Add 'rtype' if 'return' is present and 'rtype' isn't.
168.     if 'return' in annotations:
169.         if 'return' in has_description and 'return' not in has_type:
170.             field = nodes.field()
171.             field += nodes.field_name('', 'rtype')
172.             field += nodes.field_body('', nodes.paragraph('', annotations['return']))
173.             node += field
174. 
175. 
176. def setup(app: Sphinx) -> Dict[str, Any]:
177.     app.connect('autodoc-process-signature', record_typehints)
178.     app.connect('object-description-transform', merge_typehints)
179. 
180.     return {
181.         'version': 'builtin',
182.         'parallel_read_safe': True,
183.         'parallel_write_safe': True,
184.     }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 08:37:56,823 - thread-131009116899008.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The provided context, which includes `sphinx/domains/python.py` and `sphinx/ext/autodoc/typehints.py`, is sufficient to understand the issue and the proposed patch. The file `sphinx/domains/python.py` contains the `_parse_annotation` function that is being patched, along with its dependencies for creating cross-references. The file `sphinx/ext/autodoc/typehints.py` shows how type hints are extracted and processed, providing the input for the patched function. While `sphinx.util.typing.stringify` is used, its exact implementation is not critical because the patch is designed to handle the string representation of the `Literal` type, which is the root of the problem. Therefore, no additional context is necessary.' query='' extra_requirements='' purpose=''
2025-12-21 08:37:56,824 - thread-131009116899008.prometheus_context_collector - INFO - Successfully retrieved 2 context snippets
