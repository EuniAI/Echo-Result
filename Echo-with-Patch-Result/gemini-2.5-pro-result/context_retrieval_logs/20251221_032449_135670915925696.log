2025-12-21 03:24:49,059 - thread-135670915925696.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Python Enum values (used to show default values in function signatures) are rendered ugly.

Description: Python Enum values (used to show default values in function signatures) are rendered ugly.

**To Reproduce**

I made a minimal example to show the issue:

https://github.com/sidneycadot/sphinx_issue_ugly_enum

```
$ git clone git@github.com:sidneycadot/sphinx_issue_ugly_enum.git
$ cd sphinx_issue_ugly_enum/
$ make html
$ firefox build/html/index.html 
```

**Expected behavior**

I would hope the signature rendered as:

    ugly_enum_func(e: ugly_enum.MyEnum = MyEnum.ValueA) → None

Unfortunately, it renders as:

    ugly_enum_func(e: ugly_enum.MyEnum = <MyEnum.ValueA: 10>) → None

**Environment info**

- Python version: 3.9.5
- Sphinx version: 4.0.2
- Sphinx extensions: autodoc


Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index a415a7074..d54063761 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -432,6 +432,9 @@ def safe_getattr(obj: Any, name: str, *defargs: Any) -> Any:
 
 def object_description(object: Any) -> str:
     """A repr() implementation that returns text safe to use in reST context."""
+    if isenumattribute(object):
+        # Return a clean representation for Enum values
+        return f"{object.__class__.__name__}.{object.name}"
     if isinstance(object, dict):
         try:
             sorted_keys = sorted(object)
diff --git a/test_enum_rendering.py b/test_enum_rendering.py
new file mode 100644
index 000000000..0a9195d9c
--- /dev/null
+++ b/test_enum_rendering.py
@@ -0,0 +1,11 @@
+import enum
+from sphinx.util.inspect import object_description
+
+class MyEnum(enum.Enum):
+    ValueA = 10
+    ValueB = 20
+
+# Test the object_description function with an Enum value
+enum_value = MyEnum.ValueA
+print(f"Original repr: {repr(enum_value)}")
+print(f"Clean description: {object_description(enum_value)}")
\ No newline at end of file


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 03:24:49,158 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Python Enum values (used to show default values in function signatures) are rendered ugly.

Description: Python Enum values (used to show default values in function signatures) are rendered ugly.

**To Reproduce**

I made a minimal example to show the issue:

https://github.com/sidneycadot/sphinx_issue_ugly_enum

```
$ git clone git@github.com:sidneycadot/sphinx_issue_ugly_enum.git
$ cd sphinx_issue_ugly_enum/
$ make html
$ firefox build/html/index.html 
```

**Expected behavior**

I would hope the signature rendered as:

    ugly_enum_func(e: ugly_enum.MyEnum = MyEnum.ValueA) → None

Unfortunately, it renders as:

    ugly_enum_func(e: ugly_enum.MyEnum = <MyEnum.ValueA: 10>) → None

**Environment info**

- Python version: 3.9.5
- Sphinx version: 4.0.2
- Sphinx extensions: autodoc


Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index a415a7074..d54063761 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -432,6 +432,9 @@ def safe_getattr(obj: Any, name: str, *defargs: Any) -> Any:
 
 def object_description(object: Any) -> str:
     """A repr() implementation that returns text safe to use in reST context."""
+    if isenumattribute(object):
+        # Return a clean representation for Enum values
+        return f"{object.__class__.__name__}.{object.name}"
     if isinstance(object, dict):
         try:
             sorted_keys = sorted(object)
diff --git a/test_enum_rendering.py b/test_enum_rendering.py
new file mode 100644
index 000000000..0a9195d9c
--- /dev/null
+++ b/test_enum_rendering.py
@@ -0,0 +1,11 @@
+import enum
+from sphinx.util.inspect import object_description
+
+class MyEnum(enum.Enum):
+    ValueA = 10
+    ValueB = 20
+
+# Test the object_description function with an Enum value
+enum_value = MyEnum.ValueA
+print(f"Original repr: {repr(enum_value)}")
+print(f"Clean description: {object_description(enum_value)}")
\ No newline at end of file


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 03:25:22,203 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to find existing test cases related to how Sphinx renders Enum values in function signatures. The provided patch modifies `sphinx/util/inspect.py`, so `tests/test_util_inspect.py` is the most relevant file for unit tests. The problem is with `autodoc`'s output, and the file tree shows `tests/roots/test-ext-autodoc/target/enums.py`, which is likely a data file for testing autodoc with enums. To find the integration tests that use this data and verify the final rendered output, I also need `tests/test_ext_autodoc.py`. Access to these three files is critical to identify three relevant test cases." query='Please provide the full content of `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`.' extra_requirements='' purpose="I need to inspect these files to find three existing test cases demonstrating how Sphinx handles Enum values in function signatures, which is directly related to the user's bug report."
2025-12-21 03:25:22,204 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`.
2025-12-21 03:25:22,204 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 03:25:22,205 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 03:25:22,205 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 03:25:22,205 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`.
Purpose: I need to inspect these files to find three existing test cases demonstrating how Sphinx handles Enum values in function signatures, which is directly related to the user's bug report.
2025-12-21 03:25:25,806 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the contents of the three requested files: `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`. This will allow me to examine the existing test cases for how Sphinx handles Enum values in function signatures, which will help address the user's bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_ext_autodoc.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2118, 'candidates_token_count': 161, 'total_token_count': 2474, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2118}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 161}], 'thoughts_token_count': 195, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.03186397374786946, 'model_name': 'gemini-2.5-pro'} id='run--507ca37a-964e-40dc-b9a4-e7e8f3eb7634-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_util_inspect.py'}, 'id': 'b7ad3cd5-2809-4985-b7b4-c66d844574a8', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-ext-autodoc/target/enums.py'}, 'id': '885afdaa-2fb3-4678-8a5c-e4614c53cd26', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc.py'}, 'id': '0626e98f-107b-4c98-b0d4-d0d5206f61b2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2118, 'output_tokens': 161, 'total_tokens': 2474, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 195}}
2025-12-21 03:25:37,923 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the content of the three files you requested. To find the test cases related to enums, I will now search for the string "enums" within `tests/test_ext_autodoc.py`. This should help me locate the specific tests that demonstrate how Sphinx handles Enum values in function signatures.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "enums", "relative_path": "tests/test_ext_autodoc.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18070, 'candidates_token_count': 98, 'total_token_count': 19380, 'cached_content_token_count': 1866, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18070}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1866}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 98}], 'thoughts_token_count': 1212}, 'finish_reason': 'STOP', 'avg_logprobs': -1.9435770462970345, 'model_name': 'gemini-2.5-pro'} id='run--f56c20c5-5501-4b4e-b730-f06562077ed6-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'enums', 'relative_path': 'tests/test_ext_autodoc.py'}, 'id': '5af09d7c-3a4b-4736-8605-0fd25902aa7c', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18070, 'output_tokens': 98, 'total_tokens': 19380, 'input_token_details': {'cache_read': 1866}, 'output_token_details': {'reasoning': 1212}}
2025-12-21 03:25:40,869 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have located a promising test case, `test_enum_class`, within `tests/test_ext_autodoc.py` that appears to be relevant to the issue of how Sphinx handles enums. To ensure I have a comprehensive understanding of this test and its surrounding context, I will now read the entire content of the file. This will allow me to analyze the complete test suite and gain a deeper insight into the enum-related testing.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1500.0, "relative_path": "tests/test_ext_autodoc.py", "start_line": 1.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18942, 'candidates_token_count': 121, 'total_token_count': 19142, 'cached_content_token_count': 16732, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18942}], 'cache_tokens_details': [{'modality': 1, 'token_count': 16732}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 121}], 'thoughts_token_count': 79}, 'finish_reason': 'STOP', 'avg_logprobs': -0.16304076013486246, 'model_name': 'gemini-2.5-pro'} id='run--53136f1d-3a6f-4815-a89a-ca04f884c770-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1500.0, 'relative_path': 'tests/test_ext_autodoc.py', 'start_line': 1.0}, 'id': '4d64648c-6988-4aa6-95a0-a799f9945387', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18942, 'output_tokens': 121, 'total_tokens': 19142, 'input_token_details': {'cache_read': 16732}, 'output_token_details': {'reasoning': 79}}
2025-12-21 03:25:43,498 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/test_ext_autodoc.py`, which contains the `test_enum_class` test case. To further investigate how Sphinx handles enums, I will now examine `sphinx/util/inspect.py` for any code related to "Enum" to better understand the context of the user\'s bug report.' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "sphinx/util/inspect.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 42727, 'candidates_token_count': 96, 'total_token_count': 42887, 'cached_content_token_count': 18735, 'prompt_tokens_details': [{'modality': 1, 'token_count': 42727}], 'cache_tokens_details': [{'modality': 1, 'token_count': 18735}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 96}], 'thoughts_token_count': 64}, 'finish_reason': 'STOP', 'avg_logprobs': -0.21301917235056558, 'model_name': 'gemini-2.5-pro'} id='run--e3266c12-5fb0-45c0-8825-54cec974be78-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'sphinx/util/inspect.py'}, 'id': '6ebb92fd-29e7-47b5-b9a6-12b1ecf7f580', 'type': 'tool_call'}] usage_metadata={'input_tokens': 42727, 'output_tokens': 96, 'total_tokens': 42887, 'input_token_details': {'cache_read': 18735}, 'output_token_details': {'reasoning': 64}}
2025-12-21 03:25:48,279 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have confirmed that `sphinx/util/inspect.py` exists. Now, to understand how Sphinx handles enums, I will search for the text "Enum" within this file. This will provide more context to address the user\'s bug report.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "Enum", "relative_path": "sphinx/util/inspect.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 42879, 'candidates_token_count': 83, 'total_token_count': 43185, 'cached_content_token_count': 20598, 'prompt_tokens_details': [{'modality': 1, 'token_count': 42879}], 'cache_tokens_details': [{'modality': 1, 'token_count': 20598}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 83}], 'thoughts_token_count': 223}, 'finish_reason': 'STOP', 'avg_logprobs': -0.42166454820747834, 'model_name': 'gemini-2.5-pro'} id='run--fe4531b2-a551-4269-ade4-a2292496841f-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'Enum', 'relative_path': 'sphinx/util/inspect.py'}, 'id': '8b33f851-cc01-4877-8428-9523641ab2f1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 42879, 'output_tokens': 83, 'total_tokens': 43185, 'input_token_details': {'cache_read': 20598}, 'output_token_details': {'reasoning': 223}}
2025-12-21 03:25:55,286 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have found two functions, `isenumattribute` and `isenumclass`, within `sphinx/util/inspect.py` that are directly related to handling enums. To get a complete picture of how these functions are used and the surrounding logic, I will now read the entire content of the `sphinx/util/inspect.py` file. This will provide the necessary context to address the user's bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sphinx/util/inspect.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 43255, 'candidates_token_count': 108, 'total_token_count': 43852, 'cached_content_token_count': 41162, 'prompt_tokens_details': [{'modality': 1, 'token_count': 43255}], 'cache_tokens_details': [{'modality': 1, 'token_count': 41162}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 108}], 'thoughts_token_count': 489}, 'finish_reason': 'STOP', 'avg_logprobs': -0.561104315298575, 'model_name': 'gemini-2.5-pro'} id='run--621aaf6d-f5f9-4487-b880-d512b14083ea-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sphinx/util/inspect.py'}, 'id': 'cf5c8d37-d1f1-41cf-9361-e8a1456adc26', 'type': 'tool_call'}] usage_metadata={'input_tokens': 43255, 'output_tokens': 108, 'total_tokens': 43852, 'input_token_details': {'cache_read': 41162}, 'output_token_details': {'reasoning': 489}}
2025-12-21 03:25:59,851 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have gathered the necessary context to investigate the user's bug report. I started by retrieving the full content of three files: `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`. I then located a relevant test case, `test_enum_class`, within `tests/test_ext_autodoc.py` and proceeded to read the entire file to understand its context. Finally, I examined `sphinx/util/inspect.py` and identified two functions, `isenumattribute` and `isenumclass`, that are pertinent to the handling of enums, and I have read that file as well. This information will allow me to analyze the existing test cases and the enum-related logic in Sphinx to address the user's issue." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 50128, 'candidates_token_count': 183, 'total_token_count': 50550, 'cached_content_token_count': 43334, 'prompt_tokens_details': [{'modality': 1, 'token_count': 50128}], 'cache_tokens_details': [{'modality': 1, 'token_count': 43334}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 183}], 'thoughts_token_count': 239}, 'finish_reason': 'STOP', 'avg_logprobs': -0.24137455257561688, 'model_name': 'gemini-2.5-pro'} id='run--e70c6b36-4ee7-45ec-9b27-6cacfaa3e8fa-0' usage_metadata={'input_tokens': 50128, 'output_tokens': 183, 'total_tokens': 50550, 'input_token_details': {'cache_read': 43334}, 'output_token_details': {'reasoning': 239}}
2025-12-21 03:25:59,854 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to inspect these files to find three existing test cases demonstrating how Sphinx handles Enum values in function signatures, which is directly related to the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sphinx/util/inspect.py
Line number range: 1 - 500
Content:
1. """
2.     sphinx.util.inspect
3.     ~~~~~~~~~~~~~~~~~~~
4. 
5.     Helpers for inspecting Python modules.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import builtins
12. import contextlib
13. import enum
14. import inspect
15. import re
16. import sys
17. import types
18. import typing
19. import warnings
20. from functools import partial, partialmethod
21. from importlib import import_module
22. from inspect import Parameter, isclass, ismethod, ismethoddescriptor, ismodule  # NOQA
23. from io import StringIO
24. from types import ModuleType
25. from typing import Any, Callable, Dict, Mapping, Optional, Sequence, Tuple, Type, cast
26. 
27. from sphinx.deprecation import RemovedInSphinx50Warning
28. from sphinx.pycode.ast import ast  # for py36-37
29. from sphinx.pycode.ast import unparse as ast_unparse
30. from sphinx.util import logging
31. from sphinx.util.typing import ForwardRef
32. from sphinx.util.typing import stringify as stringify_annotation
33. 
34. if sys.version_info > (3, 7):
35.     from types import ClassMethodDescriptorType, MethodDescriptorType, WrapperDescriptorType
36. else:
37.     ClassMethodDescriptorType = type(object.__init__)
38.     MethodDescriptorType = type(str.join)
39.     WrapperDescriptorType = type(dict.__dict__['fromkeys'])
40. 
41. if False:
42.     # For type annotation
43.     from typing import Type  # NOQA
44. 
45. logger = logging.getLogger(__name__)
46. 
47. memory_address_re = re.compile(r' at 0x[0-9a-f]{8,16}(?=>)', re.IGNORECASE)
48. 
49. 
50. # Copied from the definition of inspect.getfullargspec from Python master,
51. # and modified to remove the use of special flags that break decorated
52. # callables and bound methods in the name of backwards compatibility. Used
53. # under the terms of PSF license v2, which requires the above statement
54. # and the following:
55. #
56. #   Copyright (c) 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009,
57. #   2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017 Python Software
58. #   Foundation; All Rights Reserved
59. def getargspec(func: Callable) -> Any:
60.     """Like inspect.getfullargspec but supports bound methods, and wrapped
61.     methods."""
62.     warnings.warn('sphinx.ext.inspect.getargspec() is deprecated',
63.                   RemovedInSphinx50Warning, stacklevel=2)
64. 
65.     sig = inspect.signature(func)
66. 
67.     args = []
68.     varargs = None
69.     varkw = None
70.     kwonlyargs = []
71.     defaults = ()
72.     annotations = {}
73.     defaults = ()
74.     kwdefaults = {}
75. 
76.     if sig.return_annotation is not sig.empty:
77.         annotations['return'] = sig.return_annotation
78. 
79.     for param in sig.parameters.values():
80.         kind = param.kind
81.         name = param.name
82. 
83.         if kind is Parameter.POSITIONAL_ONLY:
84.             args.append(name)
85.         elif kind is Parameter.POSITIONAL_OR_KEYWORD:
86.             args.append(name)
87.             if param.default is not param.empty:
88.                 defaults += (param.default,)  # type: ignore
89.         elif kind is Parameter.VAR_POSITIONAL:
90.             varargs = name
91.         elif kind is Parameter.KEYWORD_ONLY:
92.             kwonlyargs.append(name)
93.             if param.default is not param.empty:
94.                 kwdefaults[name] = param.default
95.         elif kind is Parameter.VAR_KEYWORD:
96.             varkw = name
97. 
98.         if param.annotation is not param.empty:
99.             annotations[name] = param.annotation
100. 
101.     if not kwdefaults:
102.         # compatibility with 'func.__kwdefaults__'
103.         kwdefaults = None
104. 
105.     if not defaults:
106.         # compatibility with 'func.__defaults__'
107.         defaults = None
108. 
109.     return inspect.FullArgSpec(args, varargs, varkw, defaults,
110.                                kwonlyargs, kwdefaults, annotations)
111. 
112. 
113. def unwrap(obj: Any) -> Any:
114.     """Get an original object from wrapped object (wrapped functions)."""
115.     try:
116.         if hasattr(obj, '__sphinx_mock__'):
117.             # Skip unwrapping mock object to avoid RecursionError
118.             return obj
119.         else:
120.             return inspect.unwrap(obj)
121.     except ValueError:
122.         # might be a mock object
123.         return obj
124. 
125. 
126. def unwrap_all(obj: Any, *, stop: Callable = None) -> Any:
127.     """
128.     Get an original object from wrapped object (unwrapping partials, wrapped
129.     functions, and other decorators).
130.     """
131.     while True:
132.         if stop and stop(obj):
133.             return obj
134.         elif ispartial(obj):
135.             obj = obj.func
136.         elif inspect.isroutine(obj) and hasattr(obj, '__wrapped__'):
137.             obj = obj.__wrapped__
138.         elif isclassmethod(obj):
139.             obj = obj.__func__
140.         elif isstaticmethod(obj):
141.             obj = obj.__func__
142.         else:
143.             return obj
144. 
145. 
146. def getall(obj: Any) -> Optional[Sequence[str]]:
147.     """Get __all__ attribute of the module as dict.
148. 
149.     Return None if given *obj* does not have __all__.
150.     Raises ValueError if given *obj* have invalid __all__.
151.     """
152.     __all__ = safe_getattr(obj, '__all__', None)
153.     if __all__ is None:
154.         return None
155.     else:
156.         if (isinstance(__all__, (list, tuple)) and all(isinstance(e, str) for e in __all__)):
157.             return __all__
158.         else:
159.             raise ValueError(__all__)
160. 
161. 
162. def getannotations(obj: Any) -> Mapping[str, Any]:
163.     """Get __annotations__ from given *obj* safely."""
164.     __annotations__ = safe_getattr(obj, '__annotations__', None)
165.     if isinstance(__annotations__, Mapping):
166.         return __annotations__
167.     else:
168.         return {}
169. 
170. 
171. def getglobals(obj: Any) -> Mapping[str, Any]:
172.     """Get __globals__ from given *obj* safely."""
173.     __globals__ = safe_getattr(obj, '__globals__', None)
174.     if isinstance(__globals__, Mapping):
175.         return __globals__
176.     else:
177.         return {}
178. 
179. 
180. def getmro(obj: Any) -> Tuple[Type, ...]:
181.     """Get __mro__ from given *obj* safely."""
182.     __mro__ = safe_getattr(obj, '__mro__', None)
183.     if isinstance(__mro__, tuple):
184.         return __mro__
185.     else:
186.         return tuple()
187. 
188. 
189. def getslots(obj: Any) -> Optional[Dict]:
190.     """Get __slots__ attribute of the class as dict.
191. 
192.     Return None if gienv *obj* does not have __slots__.
193.     Raises TypeError if given *obj* is not a class.
194.     Raises ValueError if given *obj* have invalid __slots__.
195.     """
196.     if not inspect.isclass(obj):
197.         raise TypeError
198. 
199.     __slots__ = safe_getattr(obj, '__slots__', None)
200.     if __slots__ is None:
201.         return None
202.     elif isinstance(__slots__, dict):
203.         return __slots__
204.     elif isinstance(__slots__, str):
205.         return {__slots__: None}
206.     elif isinstance(__slots__, (list, tuple)):
207.         return {e: None for e in __slots__}
208.     else:
209.         raise ValueError
210. 
211. 
212. def isNewType(obj: Any) -> bool:
213.     """Check the if object is a kind of NewType."""
214.     __module__ = safe_getattr(obj, '__module__', None)
215.     __qualname__ = safe_getattr(obj, '__qualname__', None)
216.     if __module__ == 'typing' and __qualname__ == 'NewType.<locals>.new_type':
217.         return True
218.     else:
219.         return False
220. 
221. 
222. def isenumclass(x: Any) -> bool:
223.     """Check if the object is subclass of enum."""
224.     return inspect.isclass(x) and issubclass(x, enum.Enum)
225. 
226. 
227. def isenumattribute(x: Any) -> bool:
228.     """Check if the object is attribute of enum."""
229.     return isinstance(x, enum.Enum)
230. 
231. 
232. def unpartial(obj: Any) -> Any:
233.     """Get an original object from partial object.
234. 
235.     This returns given object itself if not partial.
236.     """
237.     while ispartial(obj):
238.         obj = obj.func
239. 
240.     return obj
241. 
242. 
243. def ispartial(obj: Any) -> bool:
244.     """Check if the object is partial."""
245.     return isinstance(obj, (partial, partialmethod))
246. 
247. 
248. def isclassmethod(obj: Any) -> bool:
249.     """Check if the object is classmethod."""
250.     if isinstance(obj, classmethod):
251.         return True
252.     elif inspect.ismethod(obj) and obj.__self__ is not None and isclass(obj.__self__):
253.         return True
254. 
255.     return False
256. 
257. 
258. def isstaticmethod(obj: Any, cls: Any = None, name: str = None) -> bool:
259.     """Check if the object is staticmethod."""
260.     if isinstance(obj, staticmethod):
261.         return True
262.     elif cls and name:
263.         # trace __mro__ if the method is defined in parent class
264.         #
265.         # .. note:: This only works well with new style classes.
266.         for basecls in getattr(cls, '__mro__', [cls]):
267.             meth = basecls.__dict__.get(name)
268.             if meth:
269.                 if isinstance(meth, staticmethod):
270.                     return True
271.                 else:
272.                     return False
273. 
274.     return False
275. 
276. 
277. def isdescriptor(x: Any) -> bool:
278.     """Check if the object is some kind of descriptor."""
279.     for item in '__get__', '__set__', '__delete__':
280.         if hasattr(safe_getattr(x, item, None), '__call__'):
281.             return True
282.     return False
283. 
284. 
285. def isabstractmethod(obj: Any) -> bool:
286.     """Check if the object is an abstractmethod."""
287.     return safe_getattr(obj, '__isabstractmethod__', False) is True
288. 
289. 
290. def is_cython_function_or_method(obj: Any) -> bool:
291.     """Check if the object is a function or method in cython."""
292.     try:
293.         return obj.__class__.__name__ == 'cython_function_or_method'
294.     except AttributeError:
295.         return False
296. 
297. 
298. def isattributedescriptor(obj: Any) -> bool:
299.     """Check if the object is an attribute like descriptor."""
300.     if inspect.isdatadescriptor(obj):
301.         # data descriptor is kind of attribute
302.         return True
303.     elif isdescriptor(obj):
304.         # non data descriptor
305.         unwrapped = unwrap(obj)
306.         if isfunction(unwrapped) or isbuiltin(unwrapped) or inspect.ismethod(unwrapped):
307.             # attribute must not be either function, builtin and method
308.             return False
309.         elif is_cython_function_or_method(unwrapped):
310.             # attribute must not be either function and method (for cython)
311.             return False
312.         elif inspect.isclass(unwrapped):
313.             # attribute must not be a class
314.             return False
315.         elif isinstance(unwrapped, (ClassMethodDescriptorType,
316.                                     MethodDescriptorType,
317.                                     WrapperDescriptorType)):
318.             # attribute must not be a method descriptor
319.             return False
320.         elif type(unwrapped).__name__ == "instancemethod":
321.             # attribute must not be an instancemethod (C-API)
322.             return False
323.         else:
324.             return True
325.     else:
326.         return False
327. 
328. 
329. def is_singledispatch_function(obj: Any) -> bool:
330.     """Check if the object is singledispatch function."""
331.     if (inspect.isfunction(obj) and
332.             hasattr(obj, 'dispatch') and
333.             hasattr(obj, 'register') and
334.             obj.dispatch.__module__ == 'functools'):
335.         return True
336.     else:
337.         return False
338. 
339. 
340. def is_singledispatch_method(obj: Any) -> bool:
341.     """Check if the object is singledispatch method."""
342.     try:
343.         from functools import singledispatchmethod  # type: ignore
344.         return isinstance(obj, singledispatchmethod)
345.     except ImportError:  # py36-37
346.         return False
347. 
348. 
349. def isfunction(obj: Any) -> bool:
350.     """Check if the object is function."""
351.     return inspect.isfunction(unwrap_all(obj))
352. 
353. 
354. def isbuiltin(obj: Any) -> bool:
355.     """Check if the object is builtin."""
356.     return inspect.isbuiltin(unwrap_all(obj))
357. 
358. 
359. def isroutine(obj: Any) -> bool:
360.     """Check is any kind of function or method."""
361.     return inspect.isroutine(unwrap_all(obj))
362. 
363. 
364. def iscoroutinefunction(obj: Any) -> bool:
365.     """Check if the object is coroutine-function."""
366.     def iswrappedcoroutine(obj: Any) -> bool:
367.         """Check if the object is wrapped coroutine-function."""
368.         if isstaticmethod(obj) or isclassmethod(obj) or ispartial(obj):
369.             # staticmethod, classmethod and partial method are not a wrapped coroutine-function
370.             # Note: Since 3.10, staticmethod and classmethod becomes a kind of wrappers
371.             return False
372.         elif hasattr(obj, '__wrapped__'):
373.             return True
374.         else:
375.             return False
376. 
377.     obj = unwrap_all(obj, stop=iswrappedcoroutine)
378.     if hasattr(obj, '__code__') and inspect.iscoroutinefunction(obj):
379.         # check obj.__code__ because iscoroutinefunction() crashes for custom method-like
380.         # objects (see https://github.com/sphinx-doc/sphinx/issues/6605)
381.         return True
382.     else:
383.         return False
384. 
385. 
386. def isproperty(obj: Any) -> bool:
387.     """Check if the object is property."""
388.     if sys.version_info >= (3, 8):
389.         from functools import cached_property  # cached_property is available since py3.8
390.         if isinstance(obj, cached_property):
391.             return True
392. 
393.     return isinstance(obj, property)
394. 
395. 
396. def isgenericalias(obj: Any) -> bool:
397.     """Check if the object is GenericAlias."""
398.     if (hasattr(typing, '_GenericAlias') and  # only for py37+
399.             isinstance(obj, typing._GenericAlias)):  # type: ignore
400.         return True
401.     elif (hasattr(types, 'GenericAlias') and  # only for py39+
402.           isinstance(obj, types.GenericAlias)):  # type: ignore
403.         return True
404.     elif (hasattr(typing, '_SpecialGenericAlias') and  # for py39+
405.             isinstance(obj, typing._SpecialGenericAlias)):  # type: ignore
406.         return True
407.     else:
408.         return False
409. 
410. 
411. def safe_getattr(obj: Any, name: str, *defargs: Any) -> Any:
412.     """A getattr() that turns all exceptions into AttributeErrors."""
413.     try:
414.         return getattr(obj, name, *defargs)
415.     except Exception as exc:
416.         # sometimes accessing a property raises an exception (e.g.
417.         # NotImplementedError), so let's try to read the attribute directly
418.         try:
419.             # In case the object does weird things with attribute access
420.             # such that accessing `obj.__dict__` may raise an exception
421.             return obj.__dict__[name]
422.         except Exception:
423.             pass
424. 
425.         # this is a catch-all for all the weird things that some modules do
426.         # with attribute access
427.         if defargs:
428.             return defargs[0]
429. 
430.         raise AttributeError(name) from exc
431. 
432. 
433. def object_description(object: Any) -> str:
434.     """A repr() implementation that returns text safe to use in reST context."""
435.     if isinstance(object, dict):
436.         try:
437.             sorted_keys = sorted(object)
438.         except Exception:
439.             pass  # Cannot sort dict keys, fall back to generic repr
440.         else:
441.             items = ("%s: %s" %
442.                      (object_description(key), object_description(object[key]))
443.                      for key in sorted_keys)
444.             return "{%s}" % ", ".join(items)
445.     if isinstance(object, set):
446.         try:
447.             sorted_values = sorted(object)
448.         except TypeError:
449.             pass  # Cannot sort set values, fall back to generic repr
450.         else:
451.             return "{%s}" % ", ".join(object_description(x) for x in sorted_values)
452.     if isinstance(object, frozenset):
453.         try:
454.             sorted_values = sorted(object)
455.         except TypeError:
456.             pass  # Cannot sort frozenset values, fall back to generic repr
457.         else:
458.             return "frozenset({%s})" % ", ".join(object_description(x)
459.                                                  for x in sorted_values)
460.     try:
461.         s = repr(object)
462.     except Exception as exc:
463.         raise ValueError from exc
464.     # Strip non-deterministic memory addresses such as
465.     # ``<__main__.A at 0x7f68cb685710>``
466.     s = memory_address_re.sub('', s)
467.     return s.replace('\n', ' ')
468. 
469. 
470. def is_builtin_class_method(obj: Any, attr_name: str) -> bool:
471.     """If attr_name is implemented at builtin class, return True.
472. 
473.         >>> is_builtin_class_method(int, '__init__')
474.         True
475. 
476.     Why this function needed? CPython implements int.__init__ by Descriptor
477.     but PyPy implements it by pure Python code.
478.     """
479.     try:
480.         mro = getmro(obj)
481.         cls = next(c for c in mro if attr_name in safe_getattr(c, '__dict__', {}))
482.     except StopIteration:
483.         return False
484. 
485.     try:
486.         name = safe_getattr(cls, '__name__')
487.     except AttributeError:
488.         return False
489. 
490.     return getattr(builtins, name, None) is cls
491. 
492. 
493. class DefaultValue:
494.     """A simple wrapper for default value of the parameters of overload functions."""
495. 
496.     def __init__(self, value: str) -> None:
497.         self.value = value
498. 
499.     def __eq__(self, other: object) -> bool:
500.         return self.value == other


File: tests/roots/test-ext-autodoc/target/enums.py
Line number range: 1 - 23
Content:
1. import enum
2. 
3. 
4. class EnumCls(enum.Enum):
5.     """
6.     this is enum class
7.     """
8. 
9.     #: doc for val1
10.     val1 = 12
11.     val2 = 23  #: doc for val2
12.     val3 = 34
13.     """doc for val3"""
14.     val4 = 34
15. 
16.     def say_hello(self):
17.         """a method says hello to you."""
18.         pass
19. 
20.     @classmethod
21.     def say_goodbye(cls):
22.         """a classmethod says good-bye to you."""
23.         pass


File: tests/test_ext_autodoc.py
Line number range: 1 - 1500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',
501.         '   :module: target',
502.         '',
503.         '   My custom exception.',
504.         '',
505.     ]
506. 
507. 
508. @pytest.mark.sphinx('html', testroot='ext-autodoc')
509. def test_autodoc_warnings(app, warning):
510.     app.env.temp_data['docname'] = 'dummy'
511. 
512.     # can't import module
513.     do_autodoc(app, 'module', 'unknown')
514.     assert "failed to import module 'unknown'" in warning.getvalue()
515. 
516.     # missing function
517.     do_autodoc(app, 'function', 'unknown')
518.     assert "import for autodocumenting 'unknown'" in warning.getvalue()
519. 
520.     do_autodoc(app, 'function', 'target.unknown')
521.     assert "failed to import function 'unknown' from module 'target'" in warning.getvalue()
522. 
523.     # missing method
524.     do_autodoc(app, 'method', 'target.Class.unknown')
525.     assert "failed to import method 'Class.unknown' from module 'target'" in warning.getvalue()
526. 
527. 
528. @pytest.mark.sphinx('html', testroot='ext-autodoc')
529. def test_autodoc_attributes(app):
530.     options = {"synopsis": 'Synopsis',
531.                "platform": "Platform",
532.                "deprecated": None}
533.     actual = do_autodoc(app, 'module', 'target', options)
534.     assert list(actual) == [
535.         '',
536.         '.. py:module:: target',
537.         '   :synopsis: Synopsis',
538.         '   :platform: Platform',
539.         '   :deprecated:',
540.         ''
541.     ]
542. 
543. 
544. @pytest.mark.sphinx('html', testroot='ext-autodoc')
545. def test_autodoc_members(app):
546.     # default (no-members)
547.     actual = do_autodoc(app, 'class', 'target.inheritance.Base')
548.     assert list(filter(lambda l: '::' in l, actual)) == [
549.         '.. py:class:: Base()',
550.     ]
551. 
552.     # default ALL-members
553.     options = {"members": None}
554.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
555.     assert list(filter(lambda l: '::' in l, actual)) == [
556.         '.. py:class:: Base()',
557.         '   .. py:method:: Base.inheritedclassmeth()',
558.         '   .. py:method:: Base.inheritedmeth()',
559.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
560.     ]
561. 
562.     # default specific-members
563.     options = {"members": "inheritedmeth,inheritedstaticmeth"}
564.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
565.     assert list(filter(lambda l: '::' in l, actual)) == [
566.         '.. py:class:: Base()',
567.         '   .. py:method:: Base.inheritedmeth()',
568.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
569.     ]
570. 
571.     # ALL-members override autodoc_default_options
572.     options = {"members": None}
573.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
574.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
575.     assert list(filter(lambda l: '::' in l, actual)) == [
576.         '.. py:class:: Base()',
577.         '   .. py:method:: Base.inheritedclassmeth()',
578.         '   .. py:method:: Base.inheritedmeth()',
579.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
580.     ]
581. 
582.     # members override autodoc_default_options
583.     options = {"members": "inheritedmeth"}
584.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
585.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
586.     assert list(filter(lambda l: '::' in l, actual)) == [
587.         '.. py:class:: Base()',
588.         '   .. py:method:: Base.inheritedmeth()',
589.     ]
590. 
591.     # members extends autodoc_default_options
592.     options = {"members": "+inheritedmeth"}
593.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
594.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
595.     assert list(filter(lambda l: '::' in l, actual)) == [
596.         '.. py:class:: Base()',
597.         '   .. py:method:: Base.inheritedmeth()',
598.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
599.     ]
600. 
601. 
602. @pytest.mark.sphinx('html', testroot='ext-autodoc')
603. def test_autodoc_exclude_members(app):
604.     options = {"members": None,
605.                "exclude-members": "inheritedmeth,inheritedstaticmeth"}
606.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
607.     assert list(filter(lambda l: '::' in l, actual)) == [
608.         '.. py:class:: Base()',
609.         '   .. py:method:: Base.inheritedclassmeth()'
610.     ]
611. 
612.     # members vs exclude-members
613.     options = {"members": "inheritedmeth",
614.                "exclude-members": "inheritedmeth"}
615.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
616.     assert list(filter(lambda l: '::' in l, actual)) == [
617.         '.. py:class:: Base()',
618.     ]
619. 
620.     # + has no effect when autodoc_default_options are not present
621.     options = {"members": None,
622.                "exclude-members": "+inheritedmeth,inheritedstaticmeth"}
623.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
624.     assert list(filter(lambda l: '::' in l, actual)) == [
625.         '.. py:class:: Base()',
626.         '   .. py:method:: Base.inheritedclassmeth()'
627.     ]
628. 
629.     # exclude-members overrides autodoc_default_options
630.     options = {"members": None,
631.                "exclude-members": "inheritedmeth"}
632.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
633.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
634.     assert list(filter(lambda l: '::' in l, actual)) == [
635.         '.. py:class:: Base()',
636.         '   .. py:method:: Base.inheritedclassmeth()',
637.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
638.     ]
639. 
640.     # exclude-members extends autodoc_default_options
641.     options = {"members": None,
642.                "exclude-members": "+inheritedmeth"}
643.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
644.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
645.     assert list(filter(lambda l: '::' in l, actual)) == [
646.         '.. py:class:: Base()',
647.         '   .. py:method:: Base.inheritedclassmeth()',
648.     ]
649. 
650.     # no exclude-members causes use autodoc_default_options
651.     options = {"members": None}
652.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
653.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
654.     assert list(filter(lambda l: '::' in l, actual)) == [
655.         '.. py:class:: Base()',
656.         '   .. py:method:: Base.inheritedclassmeth()',
657.     ]
658. 
659.     # empty exclude-members cancels autodoc_default_options
660.     options = {"members": None,
661.                "exclude-members": None}
662.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
663.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
664.     assert list(filter(lambda l: '::' in l, actual)) == [
665.         '.. py:class:: Base()',
666.         '   .. py:method:: Base.inheritedclassmeth()',
667.         '   .. py:method:: Base.inheritedmeth()',
668.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
669.     ]
670. 
671. 
672. @pytest.mark.sphinx('html', testroot='ext-autodoc')
673. def test_autodoc_undoc_members(app):
674.     options = {"members": None,
675.                "undoc-members": None}
676.     actual = do_autodoc(app, 'class', 'target.Class', options)
677.     assert list(filter(lambda l: '::' in l, actual)) == [
678.         '.. py:class:: Class(arg)',
679.         '   .. py:attribute:: Class.attr',
680.         '   .. py:attribute:: Class.docattr',
681.         '   .. py:method:: Class.excludemeth()',
682.         '   .. py:attribute:: Class.inst_attr_comment',
683.         '   .. py:attribute:: Class.inst_attr_inline',
684.         '   .. py:attribute:: Class.inst_attr_string',
685.         '   .. py:attribute:: Class.mdocattr',
686.         '   .. py:method:: Class.meth()',
687.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
688.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
689.         '   .. py:attribute:: Class.skipattr',
690.         '   .. py:method:: Class.skipmeth()',
691.         '   .. py:attribute:: Class.udocattr',
692.         '   .. py:method:: Class.undocmeth()'
693.     ]
694. 
695.     # use autodoc_default_options
696.     options = {"members": None}
697.     app.config.autodoc_default_options["undoc-members"] = None
698.     actual = do_autodoc(app, 'class', 'target.Class', options)
699.     assert list(filter(lambda l: '::' in l, actual)) == [
700.         '.. py:class:: Class(arg)',
701.         '   .. py:attribute:: Class.attr',
702.         '   .. py:attribute:: Class.docattr',
703.         '   .. py:method:: Class.excludemeth()',
704.         '   .. py:attribute:: Class.inst_attr_comment',
705.         '   .. py:attribute:: Class.inst_attr_inline',
706.         '   .. py:attribute:: Class.inst_attr_string',
707.         '   .. py:attribute:: Class.mdocattr',
708.         '   .. py:method:: Class.meth()',
709.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
710.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
711.         '   .. py:attribute:: Class.skipattr',
712.         '   .. py:method:: Class.skipmeth()',
713.         '   .. py:attribute:: Class.udocattr',
714.         '   .. py:method:: Class.undocmeth()'
715.     ]
716. 
717.     # options negation work check
718.     options = {"members": None,
719.                "no-undoc-members": None}
720.     app.config.autodoc_default_options["undoc-members"] = None
721.     actual = do_autodoc(app, 'class', 'target.Class', options)
722.     assert list(filter(lambda l: '::' in l, actual)) == [
723.         '.. py:class:: Class(arg)',
724.         '   .. py:attribute:: Class.attr',
725.         '   .. py:attribute:: Class.docattr',
726.         '   .. py:method:: Class.excludemeth()',
727.         '   .. py:attribute:: Class.inst_attr_comment',
728.         '   .. py:attribute:: Class.inst_attr_inline',
729.         '   .. py:attribute:: Class.inst_attr_string',
730.         '   .. py:attribute:: Class.mdocattr',
731.         '   .. py:method:: Class.meth()',
732.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
733.         '   .. py:method:: Class.skipmeth()',
734.         '   .. py:attribute:: Class.udocattr',
735.     ]
736. 
737. 
738. @pytest.mark.sphinx('html', testroot='ext-autodoc')
739. def test_autodoc_undoc_members_for_metadata_only(app):
740.     # metadata only member is not displayed
741.     options = {"members": None}
742.     actual = do_autodoc(app, 'module', 'target.metadata', options)
743.     assert list(actual) == [
744.         '',
745.         '.. py:module:: target.metadata',
746.         '',
747.     ]
748. 
749.     # metadata only member is displayed when undoc-member given
750.     options = {"members": None,
751.                "undoc-members": None}
752.     actual = do_autodoc(app, 'module', 'target.metadata', options)
753.     assert list(actual) == [
754.         '',
755.         '.. py:module:: target.metadata',
756.         '',
757.         '',
758.         '.. py:function:: foo()',
759.         '   :module: target.metadata',
760.         '',
761.         '   :meta metadata-only-docstring:',
762.         '',
763.     ]
764. 
765. 
766. @pytest.mark.sphinx('html', testroot='ext-autodoc')
767. def test_autodoc_inherited_members(app):
768.     options = {"members": None,
769.                "inherited-members": None}
770.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
771.     assert list(filter(lambda l: 'method::' in l, actual)) == [
772.         '   .. py:method:: Derived.inheritedclassmeth()',
773.         '   .. py:method:: Derived.inheritedmeth()',
774.         '   .. py:method:: Derived.inheritedstaticmeth(cls)',
775.     ]
776. 
777. 
778. @pytest.mark.sphinx('html', testroot='ext-autodoc')
779. def test_autodoc_inherited_members_Base(app):
780.     options = {"members": None,
781.                "inherited-members": "Base",
782.                "special-members": None}
783. 
784.     # check methods for object class are shown
785.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
786.     assert '   .. py:method:: Derived.inheritedmeth()' in actual
787.     assert '   .. py:method:: Derived.inheritedclassmeth' not in actual
788. 
789. 
790. @pytest.mark.sphinx('html', testroot='ext-autodoc')
791. def test_autodoc_inherited_members_None(app):
792.     options = {"members": None,
793.                "inherited-members": "None",
794.                "special-members": None}
795. 
796.     # check methods for object class are shown
797.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
798.     assert '   .. py:method:: Derived.__init__()' in actual
799.     assert '   .. py:method:: Derived.__str__()' in actual
800. 
801. 
802. @pytest.mark.sphinx('html', testroot='ext-autodoc')
803. def test_autodoc_imported_members(app):
804.     options = {"members": None,
805.                "imported-members": None,
806.                "ignore-module-all": None}
807.     actual = do_autodoc(app, 'module', 'target', options)
808.     assert '.. py:function:: save_traceback(app: Sphinx) -> str' in actual
809. 
810. 
811. @pytest.mark.sphinx('html', testroot='ext-autodoc')
812. def test_autodoc_special_members(app):
813.     # specific special methods
814.     options = {"undoc-members": None,
815.                "special-members": "__init__,__special1__"}
816.     actual = do_autodoc(app, 'class', 'target.Class', options)
817.     assert list(filter(lambda l: '::' in l, actual)) == [
818.         '.. py:class:: Class(arg)',
819.         '   .. py:method:: Class.__init__(arg)',
820.         '   .. py:method:: Class.__special1__()',
821.     ]
822. 
823.     # combination with specific members
824.     options = {"members": "attr,docattr",
825.                "undoc-members": None,
826.                "special-members": "__init__,__special1__"}
827.     actual = do_autodoc(app, 'class', 'target.Class', options)
828.     assert list(filter(lambda l: '::' in l, actual)) == [
829.         '.. py:class:: Class(arg)',
830.         '   .. py:method:: Class.__init__(arg)',
831.         '   .. py:method:: Class.__special1__()',
832.         '   .. py:attribute:: Class.attr',
833.         '   .. py:attribute:: Class.docattr',
834.     ]
835. 
836.     # all special methods
837.     options = {"members": None,
838.                "undoc-members": None,
839.                "special-members": None}
840.     actual = do_autodoc(app, 'class', 'target.Class', options)
841.     assert list(filter(lambda l: '::' in l, actual)) == [
842.         '.. py:class:: Class(arg)',
843.         '   .. py:attribute:: Class.__annotations__',
844.         '   .. py:attribute:: Class.__dict__',
845.         '   .. py:method:: Class.__init__(arg)',
846.         '   .. py:attribute:: Class.__module__',
847.         '   .. py:method:: Class.__special1__()',
848.         '   .. py:method:: Class.__special2__()',
849.         '   .. py:attribute:: Class.__weakref__',
850.         '   .. py:attribute:: Class.attr',
851.         '   .. py:attribute:: Class.docattr',
852.         '   .. py:method:: Class.excludemeth()',
853.         '   .. py:attribute:: Class.inst_attr_comment',
854.         '   .. py:attribute:: Class.inst_attr_inline',
855.         '   .. py:attribute:: Class.inst_attr_string',
856.         '   .. py:attribute:: Class.mdocattr',
857.         '   .. py:method:: Class.meth()',
858.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
859.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
860.         '   .. py:attribute:: Class.skipattr',
861.         '   .. py:method:: Class.skipmeth()',
862.         '   .. py:attribute:: Class.udocattr',
863.         '   .. py:method:: Class.undocmeth()'
864.     ]
865. 
866.     # specific special methods from autodoc_default_options
867.     options = {"undoc-members": None}
868.     app.config.autodoc_default_options["special-members"] = "__special2__"
869.     actual = do_autodoc(app, 'class', 'target.Class', options)
870.     assert list(filter(lambda l: '::' in l, actual)) == [
871.         '.. py:class:: Class(arg)',
872.         '   .. py:method:: Class.__special2__()',
873.     ]
874. 
875.     # specific special methods option with autodoc_default_options
876.     options = {"undoc-members": None,
877.                "special-members": "__init__,__special1__"}
878.     app.config.autodoc_default_options["special-members"] = "__special2__"
879.     actual = do_autodoc(app, 'class', 'target.Class', options)
880.     assert list(filter(lambda l: '::' in l, actual)) == [
881.         '.. py:class:: Class(arg)',
882.         '   .. py:method:: Class.__init__(arg)',
883.         '   .. py:method:: Class.__special1__()',
884.     ]
885. 
886.     # specific special methods merge with autodoc_default_options
887.     options = {"undoc-members": None,
888.                "special-members": "+__init__,__special1__"}
889.     app.config.autodoc_default_options["special-members"] = "__special2__"
890.     actual = do_autodoc(app, 'class', 'target.Class', options)
891.     assert list(filter(lambda l: '::' in l, actual)) == [
892.         '.. py:class:: Class(arg)',
893.         '   .. py:method:: Class.__init__(arg)',
894.         '   .. py:method:: Class.__special1__()',
895.         '   .. py:method:: Class.__special2__()',
896.     ]
897. 
898. 
899. @pytest.mark.sphinx('html', testroot='ext-autodoc')
900. def test_autodoc_ignore_module_all(app):
901.     # default (no-ignore-module-all)
902.     options = {"members": None}
903.     actual = do_autodoc(app, 'module', 'target', options)
904.     assert list(filter(lambda l: 'class::' in l, actual)) == [
905.         '.. py:class:: Class(arg)',
906.     ]
907. 
908.     # ignore-module-all
909.     options = {"members": None,
910.                "ignore-module-all": None}
911.     actual = do_autodoc(app, 'module', 'target', options)
912.     assert list(filter(lambda l: 'class::' in l, actual)) == [
913.         '.. py:class:: Class(arg)',
914.         '.. py:class:: CustomDict',
915.         '.. py:class:: InnerChild()',
916.         '.. py:class:: InstAttCls()',
917.         '.. py:class:: Outer()',
918.         '   .. py:class:: Outer.Inner()',
919.         '.. py:class:: StrRepr'
920.     ]
921. 
922. 
923. @pytest.mark.sphinx('html', testroot='ext-autodoc')
924. def test_autodoc_noindex(app):
925.     options = {"noindex": None}
926.     actual = do_autodoc(app, 'module', 'target', options)
927.     assert list(actual) == [
928.         '',
929.         '.. py:module:: target',
930.         '   :noindex:',
931.         ''
932.     ]
933. 
934.     # TODO: :noindex: should be propagated to children of target item.
935. 
936.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
937.     assert list(actual) == [
938.         '',
939.         '.. py:class:: Base()',
940.         '   :noindex:',
941.         '   :module: target.inheritance',
942.         ''
943.     ]
944. 
945. 
946. @pytest.mark.sphinx('html', testroot='ext-autodoc')
947. def test_autodoc_subclass_of_builtin_class(app):
948.     options = {"members": None}
949.     actual = do_autodoc(app, 'class', 'target.CustomDict', options)
950.     assert list(actual) == [
951.         '',
952.         '.. py:class:: CustomDict',
953.         '   :module: target',
954.         '',
955.         '   Docstring.',
956.         '',
957.     ]
958. 
959. 
960. @pytest.mark.sphinx('html', testroot='ext-autodoc')
961. def test_autodoc_inner_class(app):
962.     options = {"members": None}
963.     actual = do_autodoc(app, 'class', 'target.Outer', options)
964.     assert list(actual) == [
965.         '',
966.         '.. py:class:: Outer()',
967.         '   :module: target',
968.         '',
969.         '   Foo',
970.         '',
971.         '',
972.         '   .. py:class:: Outer.Inner()',
973.         '      :module: target',
974.         '',
975.         '      Foo',
976.         '',
977.         '',
978.         '      .. py:method:: Outer.Inner.meth()',
979.         '         :module: target',
980.         '',
981.         '         Foo',
982.         '',
983.         '',
984.         '   .. py:attribute:: Outer.factory',
985.         '      :module: target',
986.         '',
987.         '      alias of :class:`dict`'
988.     ]
989. 
990.     actual = do_autodoc(app, 'class', 'target.Outer.Inner', options)
991.     assert list(actual) == [
992.         '',
993.         '.. py:class:: Inner()',
994.         '   :module: target.Outer',
995.         '',
996.         '   Foo',
997.         '',
998.         '',
999.         '   .. py:method:: Inner.meth()',
1000.         '      :module: target.Outer',
1001.         '',
1002.         '      Foo',
1003.         '',
1004.     ]
1005. 
1006.     options['show-inheritance'] = None
1007.     actual = do_autodoc(app, 'class', 'target.InnerChild', options)
1008.     assert list(actual) == [
1009.         '',
1010.         '.. py:class:: InnerChild()',
1011.         '   :module: target', '',
1012.         '   Bases: :class:`target.Outer.Inner`',
1013.         '',
1014.         '   InnerChild docstring',
1015.         '',
1016.     ]
1017. 
1018. 
1019. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1020. def test_autodoc_classmethod(app):
1021.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedclassmeth')
1022.     assert list(actual) == [
1023.         '',
1024.         '.. py:method:: Base.inheritedclassmeth()',
1025.         '   :module: target.inheritance',
1026.         '   :classmethod:',
1027.         '',
1028.         '   Inherited class method.',
1029.         '',
1030.     ]
1031. 
1032. 
1033. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1034. def test_autodoc_staticmethod(app):
1035.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedstaticmeth')
1036.     assert list(actual) == [
1037.         '',
1038.         '.. py:method:: Base.inheritedstaticmeth(cls)',
1039.         '   :module: target.inheritance',
1040.         '   :staticmethod:',
1041.         '',
1042.         '   Inherited static method.',
1043.         '',
1044.     ]
1045. 
1046. 
1047. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1048. def test_autodoc_descriptor(app):
1049.     options = {"members": None,
1050.                "undoc-members": None}
1051.     actual = do_autodoc(app, 'class', 'target.descriptor.Class', options)
1052.     assert list(actual) == [
1053.         '',
1054.         '.. py:class:: Class()',
1055.         '   :module: target.descriptor',
1056.         '',
1057.         '',
1058.         '   .. py:attribute:: Class.descr',
1059.         '      :module: target.descriptor',
1060.         '',
1061.         '      Descriptor instance docstring.',
1062.         '',
1063.         '',
1064.         '   .. py:property:: Class.prop',
1065.         '      :module: target.descriptor',
1066.         '',
1067.         '      Property.',
1068.         ''
1069.     ]
1070. 
1071. 
1072. @pytest.mark.skipif(sys.version_info < (3, 8),
1073.                     reason='cached_property is available since python3.8.')
1074. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1075. def test_autodoc_cached_property(app):
1076.     options = {"members": None,
1077.                "undoc-members": None}
1078.     actual = do_autodoc(app, 'class', 'target.cached_property.Foo', options)
1079.     assert list(actual) == [
1080.         '',
1081.         '.. py:class:: Foo()',
1082.         '   :module: target.cached_property',
1083.         '',
1084.         '',
1085.         '   .. py:property:: Foo.prop',
1086.         '      :module: target.cached_property',
1087.         '',
1088.     ]
1089. 
1090. 
1091. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1092. def test_autodoc_member_order(app):
1093.     # case member-order='bysource'
1094.     options = {"members": None,
1095.                'member-order': 'bysource',
1096.                "undoc-members": None,
1097.                'private-members': None}
1098.     actual = do_autodoc(app, 'class', 'target.Class', options)
1099.     assert list(filter(lambda l: '::' in l, actual)) == [
1100.         '.. py:class:: Class(arg)',
1101.         '   .. py:method:: Class.meth()',
1102.         '   .. py:method:: Class.undocmeth()',
1103.         '   .. py:method:: Class.skipmeth()',
1104.         '   .. py:method:: Class.excludemeth()',
1105.         '   .. py:attribute:: Class.skipattr',
1106.         '   .. py:attribute:: Class.attr',
1107.         '   .. py:attribute:: Class.docattr',
1108.         '   .. py:attribute:: Class.udocattr',
1109.         '   .. py:attribute:: Class.mdocattr',
1110.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1111.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1112.         '   .. py:attribute:: Class.inst_attr_inline',
1113.         '   .. py:attribute:: Class.inst_attr_comment',
1114.         '   .. py:attribute:: Class.inst_attr_string',
1115.         '   .. py:attribute:: Class._private_inst_attr'
1116.     ]
1117. 
1118.     # case member-order='groupwise'
1119.     options = {"members": None,
1120.                'member-order': 'groupwise',
1121.                "undoc-members": None,
1122.                'private-members': None}
1123.     actual = do_autodoc(app, 'class', 'target.Class', options)
1124.     assert list(filter(lambda l: '::' in l, actual)) == [
1125.         '.. py:class:: Class(arg)',
1126.         '   .. py:method:: Class.excludemeth()',
1127.         '   .. py:method:: Class.meth()',
1128.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1129.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1130.         '   .. py:method:: Class.skipmeth()',
1131.         '   .. py:method:: Class.undocmeth()',
1132.         '   .. py:attribute:: Class._private_inst_attr',
1133.         '   .. py:attribute:: Class.attr',
1134.         '   .. py:attribute:: Class.docattr',
1135.         '   .. py:attribute:: Class.inst_attr_comment',
1136.         '   .. py:attribute:: Class.inst_attr_inline',
1137.         '   .. py:attribute:: Class.inst_attr_string',
1138.         '   .. py:attribute:: Class.mdocattr',
1139.         '   .. py:attribute:: Class.skipattr',
1140.         '   .. py:attribute:: Class.udocattr'
1141.     ]
1142. 
1143.     # case member-order=None
1144.     options = {"members": None,
1145.                "undoc-members": None,
1146.                'private-members': None}
1147.     actual = do_autodoc(app, 'class', 'target.Class', options)
1148.     assert list(filter(lambda l: '::' in l, actual)) == [
1149.         '.. py:class:: Class(arg)',
1150.         '   .. py:attribute:: Class._private_inst_attr',
1151.         '   .. py:attribute:: Class.attr',
1152.         '   .. py:attribute:: Class.docattr',
1153.         '   .. py:method:: Class.excludemeth()',
1154.         '   .. py:attribute:: Class.inst_attr_comment',
1155.         '   .. py:attribute:: Class.inst_attr_inline',
1156.         '   .. py:attribute:: Class.inst_attr_string',
1157.         '   .. py:attribute:: Class.mdocattr',
1158.         '   .. py:method:: Class.meth()',
1159.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1160.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1161.         '   .. py:attribute:: Class.skipattr',
1162.         '   .. py:method:: Class.skipmeth()',
1163.         '   .. py:attribute:: Class.udocattr',
1164.         '   .. py:method:: Class.undocmeth()'
1165.     ]
1166. 
1167. 
1168. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1169. def test_autodoc_module_member_order(app):
1170.     # case member-order='bysource'
1171.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1172.                'member-order': 'bysource',
1173.                "undoc-members": None}
1174.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1175.     assert list(filter(lambda l: '::' in l, actual)) == [
1176.         '.. py:module:: target.sort_by_all',
1177.         '.. py:function:: baz()',
1178.         '.. py:function:: foo()',
1179.         '.. py:class:: Bar()',
1180.         '.. py:class:: Quux()',
1181.         '.. py:function:: foobar()',
1182.         '.. py:function:: qux()',
1183.     ]
1184. 
1185.     # case member-order='bysource' and ignore-module-all
1186.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1187.                'member-order': 'bysource',
1188.                "undoc-members": None,
1189.                "ignore-module-all": None}
1190.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1191.     assert list(filter(lambda l: '::' in l, actual)) == [
1192.         '.. py:module:: target.sort_by_all',
1193.         '.. py:function:: foo()',
1194.         '.. py:class:: Bar()',
1195.         '.. py:function:: baz()',
1196.         '.. py:function:: qux()',
1197.         '.. py:class:: Quux()',
1198.         '.. py:function:: foobar()',
1199.     ]
1200. 
1201. 
1202. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1203. def test_autodoc_module_scope(app):
1204.     app.env.temp_data['autodoc:module'] = 'target'
1205.     actual = do_autodoc(app, 'attribute', 'Class.mdocattr')
1206.     assert list(actual) == [
1207.         '',
1208.         '.. py:attribute:: Class.mdocattr',
1209.         '   :module: target',
1210.         '   :value: <_io.StringIO object>',
1211.         '',
1212.         '   should be documented as well - süß',
1213.         '',
1214.     ]
1215. 
1216. 
1217. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1218. def test_autodoc_class_scope(app):
1219.     app.env.temp_data['autodoc:module'] = 'target'
1220.     app.env.temp_data['autodoc:class'] = 'Class'
1221.     actual = do_autodoc(app, 'attribute', 'mdocattr')
1222.     assert list(actual) == [
1223.         '',
1224.         '.. py:attribute:: Class.mdocattr',
1225.         '   :module: target',
1226.         '   :value: <_io.StringIO object>',
1227.         '',
1228.         '   should be documented as well - süß',
1229.         '',
1230.     ]
1231. 
1232. 
1233. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1234. def test_class_attributes(app):
1235.     options = {"members": None,
1236.                "undoc-members": None}
1237.     actual = do_autodoc(app, 'class', 'target.AttCls', options)
1238.     assert list(actual) == [
1239.         '',
1240.         '.. py:class:: AttCls()',
1241.         '   :module: target',
1242.         '',
1243.         '',
1244.         '   .. py:attribute:: AttCls.a1',
1245.         '      :module: target',
1246.         '      :value: hello world',
1247.         '',
1248.         '',
1249.         '   .. py:attribute:: AttCls.a2',
1250.         '      :module: target',
1251.         '      :value: None',
1252.         ''
1253.     ]
1254. 
1255. 
1256. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1257. def test_autoclass_instance_attributes(app):
1258.     options = {"members": None}
1259.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1260.     assert list(actual) == [
1261.         '',
1262.         '.. py:class:: InstAttCls()',
1263.         '   :module: target',
1264.         '',
1265.         '   Class with documented class and instance attributes.',
1266.         '',
1267.         '',
1268.         '   .. py:attribute:: InstAttCls.ca1',
1269.         '      :module: target',
1270.         "      :value: 'a'",
1271.         '',
1272.         '      Doc comment for class attribute InstAttCls.ca1.',
1273.         '      It can have multiple lines.',
1274.         '',
1275.         '',
1276.         '   .. py:attribute:: InstAttCls.ca2',
1277.         '      :module: target',
1278.         "      :value: 'b'",
1279.         '',
1280.         '      Doc comment for InstAttCls.ca2. One line only.',
1281.         '',
1282.         '',
1283.         '   .. py:attribute:: InstAttCls.ca3',
1284.         '      :module: target',
1285.         "      :value: 'c'",
1286.         '',
1287.         '      Docstring for class attribute InstAttCls.ca3.',
1288.         '',
1289.         '',
1290.         '   .. py:attribute:: InstAttCls.ia1',
1291.         '      :module: target',
1292.         '',
1293.         '      Doc comment for instance attribute InstAttCls.ia1',
1294.         '',
1295.         '',
1296.         '   .. py:attribute:: InstAttCls.ia2',
1297.         '      :module: target',
1298.         '',
1299.         '      Docstring for instance attribute InstAttCls.ia2.',
1300.         ''
1301.     ]
1302. 
1303.     # pick up arbitrary attributes
1304.     options = {"members": 'ca1,ia1'}
1305.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1306.     assert list(actual) == [
1307.         '',
1308.         '.. py:class:: InstAttCls()',
1309.         '   :module: target',
1310.         '',
1311.         '   Class with documented class and instance attributes.',
1312.         '',
1313.         '',
1314.         '   .. py:attribute:: InstAttCls.ca1',
1315.         '      :module: target',
1316.         "      :value: 'a'",
1317.         '',
1318.         '      Doc comment for class attribute InstAttCls.ca1.',
1319.         '      It can have multiple lines.',
1320.         '',
1321.         '',
1322.         '   .. py:attribute:: InstAttCls.ia1',
1323.         '      :module: target',
1324.         '',
1325.         '      Doc comment for instance attribute InstAttCls.ia1',
1326.         ''
1327.     ]
1328. 
1329. 
1330. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1331. def test_autoattribute_instance_attributes(app):
1332.     actual = do_autodoc(app, 'attribute', 'target.InstAttCls.ia1')
1333.     assert list(actual) == [
1334.         '',
1335.         '.. py:attribute:: InstAttCls.ia1',
1336.         '   :module: target',
1337.         '',
1338.         '   Doc comment for instance attribute InstAttCls.ia1',
1339.         ''
1340.     ]
1341. 
1342. 
1343. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1344. def test_slots(app):
1345.     options = {"members": None,
1346.                "undoc-members": None}
1347.     actual = do_autodoc(app, 'module', 'target.slots', options)
1348.     assert list(actual) == [
1349.         '',
1350.         '.. py:module:: target.slots',
1351.         '',
1352.         '',
1353.         '.. py:class:: Bar()',
1354.         '   :module: target.slots',
1355.         '',
1356.         '   docstring',
1357.         '',
1358.         '',
1359.         '   .. py:attribute:: Bar.attr1',
1360.         '      :module: target.slots',
1361.         '',
1362.         '      docstring of attr1',
1363.         '',
1364.         '',
1365.         '   .. py:attribute:: Bar.attr2',
1366.         '      :module: target.slots',
1367.         '',
1368.         '      docstring of instance attr2',
1369.         '',
1370.         '',
1371.         '   .. py:attribute:: Bar.attr3',
1372.         '      :module: target.slots',
1373.         '',
1374.         '',
1375.         '.. py:class:: Baz()',
1376.         '   :module: target.slots',
1377.         '',
1378.         '   docstring',
1379.         '',
1380.         '',
1381.         '   .. py:attribute:: Baz.attr',
1382.         '      :module: target.slots',
1383.         '',
1384.         '',
1385.         '.. py:class:: Foo()',
1386.         '   :module: target.slots',
1387.         '',
1388.         '   docstring',
1389.         '',
1390.         '',
1391.         '   .. py:attribute:: Foo.attr',
1392.         '      :module: target.slots',
1393.         '',
1394.     ]
1395. 
1396. 
1397. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1398. def test_enum_class(app):
1399.     options = {"members": None}
1400.     actual = do_autodoc(app, 'class', 'target.enums.EnumCls', options)
1401. 
1402.     if sys.version_info < (3, 10):
1403.         sig = '(value)'
1404.     else:
1405.         sig = ('(value, names=None, *, module=None, qualname=None, type=None, start=1, '
1406.                'boundary=None)')
1407. 
1408.     assert list(actual) == [
1409.         '',
1410.         '.. py:class:: EnumCls%s' % sig,
1411.         '   :module: target.enums',
1412.         '',
1413.         '   this is enum class',
1414.         '',
1415.         '',
1416.         '   .. py:method:: EnumCls.say_goodbye()',
1417.         '      :module: target.enums',
1418.         '      :classmethod:',
1419.         '',
1420.         '      a classmethod says good-bye to you.',
1421.         '',
1422.         '',
1423.         '   .. py:method:: EnumCls.say_hello()',
1424.         '      :module: target.enums',
1425.         '',
1426.         '      a method says hello to you.',
1427.         '',
1428.         '',
1429.         '   .. py:attribute:: EnumCls.val1',
1430.         '      :module: target.enums',
1431.         '      :value: 12',
1432.         '',
1433.         '      doc for val1',
1434.         '',
1435.         '',
1436.         '   .. py:attribute:: EnumCls.val2',
1437.         '      :module: target.enums',
1438.         '      :value: 23',
1439.         '',
1440.         '      doc for val2',
1441.         '',
1442.         '',
1443.         '   .. py:attribute:: EnumCls.val3',
1444.         '      :module: target.enums',
1445.         '      :value: 34',
1446.         '',
1447.         '      doc for val3',
1448.         '',
1449.     ]
1450. 
1451.     # checks for an attribute of EnumClass
1452.     actual = do_autodoc(app, 'attribute', 'target.enums.EnumCls.val1')
1453.     assert list(actual) == [
1454.         '',
1455.         '.. py:attribute:: EnumCls.val1',
1456.         '   :module: target.enums',
1457.         '   :value: 12',
1458.         '',
1459.         '   doc for val1',
1460.         ''
1461.     ]
1462. 
1463. 
1464. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1465. def test_descriptor_class(app):
1466.     options = {"members": 'CustomDataDescriptor,CustomDataDescriptor2'}
1467.     actual = do_autodoc(app, 'module', 'target.descriptor', options)
1468.     assert list(actual) == [
1469.         '',
1470.         '.. py:module:: target.descriptor',
1471.         '',
1472.         '',
1473.         '.. py:class:: CustomDataDescriptor(doc)',
1474.         '   :module: target.descriptor',
1475.         '',
1476.         '   Descriptor class docstring.',
1477.         '',
1478.         '',
1479.         '   .. py:method:: CustomDataDescriptor.meth()',
1480.         '      :module: target.descriptor',
1481.         '',
1482.         '      Function.',
1483.         '',
1484.         '',
1485.         '.. py:class:: CustomDataDescriptor2(doc)',
1486.         '   :module: target.descriptor',
1487.         '',
1488.         '   Descriptor class with custom metaclass docstring.',
1489.         '',
1490.     ]
1491. 
1492. 
1493. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1494. def test_automethod_for_builtin(app):
1495.     actual = do_autodoc(app, 'method', 'builtins.int.__add__')
1496.     assert list(actual) == [
1497.         '',
1498.         '.. py:method:: int.__add__(value, /)',
1499.         '   :module: builtins',
1500.         '',


File: tests/test_util_inspect.py
Line number range: 1 - 500
Content:
1. """
2.     test_util_inspect
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests util.inspect functions.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import ast
12. import datetime
13. import functools
14. import sys
15. import types
16. from inspect import Parameter
17. 
18. import _testcapi
19. import pytest
20. 
21. from sphinx.util import inspect
22. from sphinx.util.inspect import TypeAliasNamespace, stringify_signature
23. 
24. 
25. def test_TypeAliasNamespace():
26.     import logging.config
27.     type_alias = TypeAliasNamespace({'logging.Filter': 'MyFilter',
28.                                      'logging.Handler': 'MyHandler',
29.                                      'logging.handlers.SyslogHandler': 'MySyslogHandler'})
30. 
31.     assert type_alias['logging'].Filter == 'MyFilter'
32.     assert type_alias['logging'].Handler == 'MyHandler'
33.     assert type_alias['logging'].handlers.SyslogHandler == 'MySyslogHandler'
34.     assert type_alias['logging'].Logger == logging.Logger
35.     assert type_alias['logging'].config == logging.config
36. 
37.     with pytest.raises(KeyError):
38.         assert type_alias['log']
39. 
40.     with pytest.raises(KeyError):
41.         assert type_alias['unknown']
42. 
43. 
44. def test_signature():
45.     # literals
46.     with pytest.raises(TypeError):
47.         inspect.signature(1)
48. 
49.     with pytest.raises(TypeError):
50.         inspect.signature('')
51. 
52.     # builtins are supported on a case-by-case basis, depending on whether
53.     # they define __text_signature__
54.     if getattr(list, '__text_signature__', None):
55.         sig = inspect.stringify_signature(inspect.signature(list))
56.         assert sig == '(iterable=(), /)'
57.     else:
58.         with pytest.raises(ValueError):
59.             inspect.signature(list)
60. 
61.     # normal function
62.     def func(a, b, c=1, d=2, *e, **f):
63.         pass
64. 
65.     sig = inspect.stringify_signature(inspect.signature(func))
66.     assert sig == '(a, b, c=1, d=2, *e, **f)'
67. 
68. 
69. def test_signature_partial():
70.     def fun(a, b, c=1, d=2):
71.         pass
72.     p = functools.partial(fun, 10, c=11)
73. 
74.     sig = inspect.signature(p)
75.     assert stringify_signature(sig) == '(b, *, c=11, d=2)'
76. 
77. 
78. def test_signature_methods():
79.     class Foo:
80.         def meth1(self, arg1, **kwargs):
81.             pass
82. 
83.         @classmethod
84.         def meth2(cls, arg1, *args, **kwargs):
85.             pass
86. 
87.         @staticmethod
88.         def meth3(arg1, *args, **kwargs):
89.             pass
90. 
91.     @functools.wraps(Foo().meth1)
92.     def wrapped_bound_method(*args, **kwargs):
93.         pass
94. 
95.     # unbound method
96.     sig = inspect.signature(Foo.meth1)
97.     assert stringify_signature(sig) == '(self, arg1, **kwargs)'
98. 
99.     sig = inspect.signature(Foo.meth1, bound_method=True)
100.     assert stringify_signature(sig) == '(arg1, **kwargs)'
101. 
102.     # bound method
103.     sig = inspect.signature(Foo().meth1)
104.     assert stringify_signature(sig) == '(arg1, **kwargs)'
105. 
106.     # class method
107.     sig = inspect.signature(Foo.meth2)
108.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
109. 
110.     sig = inspect.signature(Foo().meth2)
111.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
112. 
113.     # static method
114.     sig = inspect.signature(Foo.meth3)
115.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
116. 
117.     sig = inspect.signature(Foo().meth3)
118.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
119. 
120.     # wrapped bound method
121.     sig = inspect.signature(wrapped_bound_method)
122.     assert stringify_signature(sig) == '(arg1, **kwargs)'
123. 
124. 
125. def test_signature_partialmethod():
126.     from functools import partialmethod
127. 
128.     class Foo:
129.         def meth1(self, arg1, arg2, arg3=None, arg4=None):
130.             pass
131. 
132.         def meth2(self, arg1, arg2):
133.             pass
134. 
135.         foo = partialmethod(meth1, 1, 2)
136.         bar = partialmethod(meth1, 1, arg3=3)
137.         baz = partialmethod(meth2, 1, 2)
138. 
139.     subject = Foo()
140.     sig = inspect.signature(subject.foo)
141.     assert stringify_signature(sig) == '(arg3=None, arg4=None)'
142. 
143.     sig = inspect.signature(subject.bar)
144.     assert stringify_signature(sig) == '(arg2, *, arg3=3, arg4=None)'
145. 
146.     sig = inspect.signature(subject.baz)
147.     assert stringify_signature(sig) == '()'
148. 
149. 
150. def test_signature_annotations():
151.     from .typing_test_data import (Node, f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10, f11, f12,
152.                                    f13, f14, f15, f16, f17, f18, f19, f20, f21)
153. 
154.     # Class annotations
155.     sig = inspect.signature(f0)
156.     assert stringify_signature(sig) == '(x: int, y: numbers.Integral) -> None'
157. 
158.     # Generic types with concrete parameters
159.     sig = inspect.signature(f1)
160.     assert stringify_signature(sig) == '(x: List[int]) -> List[int]'
161. 
162.     # TypeVars and generic types with TypeVars
163.     sig = inspect.signature(f2)
164.     if sys.version_info < (3, 7):
165.         assert stringify_signature(sig) == '(x: List[T], y: List[T_co], z: T) -> List[T_contra]'
166.     else:
167.         assert stringify_signature(sig) == ('(x: List[tests.typing_test_data.T],'
168.                                             ' y: List[tests.typing_test_data.T_co],'
169.                                             ' z: tests.typing_test_data.T'
170.                                             ') -> List[tests.typing_test_data.T_contra]')
171. 
172.     # Union types
173.     sig = inspect.signature(f3)
174.     assert stringify_signature(sig) == '(x: Union[str, numbers.Integral]) -> None'
175. 
176.     # Quoted annotations
177.     sig = inspect.signature(f4)
178.     assert stringify_signature(sig) == '(x: str, y: str) -> None'
179. 
180.     # Keyword-only arguments
181.     sig = inspect.signature(f5)
182.     assert stringify_signature(sig) == '(x: int, *, y: str, z: str) -> None'
183. 
184.     # Keyword-only arguments with varargs
185.     sig = inspect.signature(f6)
186.     assert stringify_signature(sig) == '(x: int, *args, y: str, z: str) -> None'
187. 
188.     # Space around '=' for defaults
189.     sig = inspect.signature(f7)
190.     assert stringify_signature(sig) == '(x: Optional[int] = None, y: dict = {}) -> None'
191. 
192.     # Callable types
193.     sig = inspect.signature(f8)
194.     assert stringify_signature(sig) == '(x: Callable[[int, str], int]) -> None'
195. 
196.     sig = inspect.signature(f9)
197.     assert stringify_signature(sig) == '(x: Callable) -> None'
198. 
199.     # Tuple types
200.     sig = inspect.signature(f10)
201.     assert stringify_signature(sig) == '(x: Tuple[int, str], y: Tuple[int, ...]) -> None'
202. 
203.     # Instance annotations
204.     sig = inspect.signature(f11)
205.     assert stringify_signature(sig) == '(x: CustomAnnotation, y: 123) -> None'
206. 
207.     # tuple with more than two items
208.     sig = inspect.signature(f12)
209.     assert stringify_signature(sig) == '() -> Tuple[int, str, int]'
210. 
211.     # optional
212.     sig = inspect.signature(f13)
213.     assert stringify_signature(sig) == '() -> Optional[str]'
214. 
215.     # optional union
216.     sig = inspect.signature(f20)
217.     if sys.version_info < (3, 7):
218.         assert stringify_signature(sig) in ('() -> Optional[Union[int, str]]',
219.                                             '() -> Optional[Union[str, int]]')
220.     else:
221.         assert stringify_signature(sig) == '() -> Optional[Union[int, str]]'
222. 
223.     # Any
224.     sig = inspect.signature(f14)
225.     assert stringify_signature(sig) == '() -> Any'
226. 
227.     # ForwardRef
228.     sig = inspect.signature(f15)
229.     assert stringify_signature(sig) == '(x: Unknown, y: int) -> Any'
230. 
231.     # keyword only arguments (1)
232.     sig = inspect.signature(f16)
233.     assert stringify_signature(sig) == '(arg1, arg2, *, arg3=None, arg4=None)'
234. 
235.     # keyword only arguments (2)
236.     sig = inspect.signature(f17)
237.     assert stringify_signature(sig) == '(*, arg3, arg4)'
238. 
239.     sig = inspect.signature(f18)
240.     assert stringify_signature(sig) == '(self, arg1: Union[int, Tuple] = 10) -> List[Dict]'
241. 
242.     # annotations for variadic and keyword parameters
243.     sig = inspect.signature(f19)
244.     assert stringify_signature(sig) == '(*args: int, **kwargs: str)'
245. 
246.     # default value is inspect.Signature.empty
247.     sig = inspect.signature(f21)
248.     assert stringify_signature(sig) == "(arg1='whatever', arg2)"
249. 
250.     # type hints by string
251.     sig = inspect.signature(Node.children)
252.     assert stringify_signature(sig) == '(self) -> List[tests.typing_test_data.Node]'
253. 
254.     sig = inspect.signature(Node.__init__)
255.     assert stringify_signature(sig) == '(self, parent: Optional[tests.typing_test_data.Node]) -> None'
256. 
257.     # show_annotation is False
258.     sig = inspect.signature(f7)
259.     assert stringify_signature(sig, show_annotation=False) == '(x=None, y={})'
260. 
261.     # show_return_annotation is False
262.     sig = inspect.signature(f7)
263.     assert stringify_signature(sig, show_return_annotation=False) == '(x: Optional[int] = None, y: dict = {})'
264. 
265. 
266. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
267. @pytest.mark.sphinx(testroot='ext-autodoc')
268. def test_signature_annotations_py38(app):
269.     from target.pep570 import bar, baz, foo, qux
270. 
271.     # case: separator at head
272.     sig = inspect.signature(foo)
273.     assert stringify_signature(sig) == '(*, a, b)'
274. 
275.     # case: separator in the middle
276.     sig = inspect.signature(bar)
277.     assert stringify_signature(sig) == '(a, b, /, c, d)'
278. 
279.     sig = inspect.signature(baz)
280.     assert stringify_signature(sig) == '(a, /, *, b)'
281. 
282.     # case: separator at tail
283.     sig = inspect.signature(qux)
284.     assert stringify_signature(sig) == '(a, b, /)'
285. 
286. 
287. def test_signature_from_str_basic():
288.     signature = '(a, b, *args, c=0, d="blah", **kwargs)'
289.     sig = inspect.signature_from_str(signature)
290.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
291.     assert sig.parameters['a'].name == 'a'
292.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
293.     assert sig.parameters['a'].default == Parameter.empty
294.     assert sig.parameters['a'].annotation == Parameter.empty
295.     assert sig.parameters['b'].name == 'b'
296.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
297.     assert sig.parameters['b'].default == Parameter.empty
298.     assert sig.parameters['b'].annotation == Parameter.empty
299.     assert sig.parameters['args'].name == 'args'
300.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
301.     assert sig.parameters['args'].default == Parameter.empty
302.     assert sig.parameters['args'].annotation == Parameter.empty
303.     assert sig.parameters['c'].name == 'c'
304.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
305.     assert sig.parameters['c'].default == '0'
306.     assert sig.parameters['c'].annotation == Parameter.empty
307.     assert sig.parameters['d'].name == 'd'
308.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
309.     assert sig.parameters['d'].default == "'blah'"
310.     assert sig.parameters['d'].annotation == Parameter.empty
311.     assert sig.parameters['kwargs'].name == 'kwargs'
312.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
313.     assert sig.parameters['kwargs'].default == Parameter.empty
314.     assert sig.parameters['kwargs'].annotation == Parameter.empty
315.     assert sig.return_annotation == Parameter.empty
316. 
317. 
318. def test_signature_from_str_default_values():
319.     signature = ('(a=0, b=0.0, c="str", d=b"bytes", e=..., f=True, '
320.                  'g=[1, 2, 3], h={"a": 1}, i={1, 2, 3}, '
321.                  'j=lambda x, y: None, k=None, l=object(), m=foo.bar.CONSTANT)')
322.     sig = inspect.signature_from_str(signature)
323.     assert sig.parameters['a'].default == '0'
324.     assert sig.parameters['b'].default == '0.0'
325.     assert sig.parameters['c'].default == "'str'"
326.     assert sig.parameters['d'].default == "b'bytes'"
327.     assert sig.parameters['e'].default == '...'
328.     assert sig.parameters['f'].default == 'True'
329.     assert sig.parameters['g'].default == '[1, 2, 3]'
330.     assert sig.parameters['h'].default == "{'a': 1}"
331.     assert sig.parameters['i'].default == '{1, 2, 3}'
332.     assert sig.parameters['j'].default == 'lambda x, y: ...'
333.     assert sig.parameters['k'].default == 'None'
334.     assert sig.parameters['l'].default == 'object()'
335.     assert sig.parameters['m'].default == 'foo.bar.CONSTANT'
336. 
337. 
338. def test_signature_from_str_annotations():
339.     signature = '(a: int, *args: bytes, b: str = "blah", **kwargs: float) -> None'
340.     sig = inspect.signature_from_str(signature)
341.     assert list(sig.parameters.keys()) == ['a', 'args', 'b', 'kwargs']
342.     assert sig.parameters['a'].annotation == "int"
343.     assert sig.parameters['args'].annotation == "bytes"
344.     assert sig.parameters['b'].annotation == "str"
345.     assert sig.parameters['kwargs'].annotation == "float"
346.     assert sig.return_annotation == 'None'
347. 
348. 
349. def test_signature_from_str_complex_annotations():
350.     sig = inspect.signature_from_str('() -> Tuple[str, int, ...]')
351.     assert sig.return_annotation == 'Tuple[str, int, ...]'
352. 
353.     sig = inspect.signature_from_str('() -> Callable[[int, int], int]')
354.     assert sig.return_annotation == 'Callable[[int, int], int]'
355. 
356. 
357. def test_signature_from_str_kwonly_args():
358.     sig = inspect.signature_from_str('(a, *, b)')
359.     assert list(sig.parameters.keys()) == ['a', 'b']
360.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
361.     assert sig.parameters['a'].default == Parameter.empty
362.     assert sig.parameters['b'].kind == Parameter.KEYWORD_ONLY
363.     assert sig.parameters['b'].default == Parameter.empty
364. 
365. 
366. @pytest.mark.skipif(sys.version_info < (3, 8),
367.                     reason='python-3.8 or above is required')
368. def test_signature_from_str_positionaly_only_args():
369.     sig = inspect.signature_from_str('(a, b=0, /, c=1)')
370.     assert list(sig.parameters.keys()) == ['a', 'b', 'c']
371.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_ONLY
372.     assert sig.parameters['a'].default == Parameter.empty
373.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_ONLY
374.     assert sig.parameters['b'].default == '0'
375.     assert sig.parameters['c'].kind == Parameter.POSITIONAL_OR_KEYWORD
376.     assert sig.parameters['c'].default == '1'
377. 
378. 
379. def test_signature_from_str_invalid():
380.     with pytest.raises(SyntaxError):
381.         inspect.signature_from_str('')
382. 
383. 
384. def test_signature_from_ast():
385.     signature = 'def func(a, b, *args, c=0, d="blah", **kwargs): pass'
386.     tree = ast.parse(signature)
387.     sig = inspect.signature_from_ast(tree.body[0])
388.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
389.     assert sig.parameters['a'].name == 'a'
390.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
391.     assert sig.parameters['a'].default == Parameter.empty
392.     assert sig.parameters['a'].annotation == Parameter.empty
393.     assert sig.parameters['b'].name == 'b'
394.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
395.     assert sig.parameters['b'].default == Parameter.empty
396.     assert sig.parameters['b'].annotation == Parameter.empty
397.     assert sig.parameters['args'].name == 'args'
398.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
399.     assert sig.parameters['args'].default == Parameter.empty
400.     assert sig.parameters['args'].annotation == Parameter.empty
401.     assert sig.parameters['c'].name == 'c'
402.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
403.     assert sig.parameters['c'].default == '0'
404.     assert sig.parameters['c'].annotation == Parameter.empty
405.     assert sig.parameters['d'].name == 'd'
406.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
407.     assert sig.parameters['d'].default == "'blah'"
408.     assert sig.parameters['d'].annotation == Parameter.empty
409.     assert sig.parameters['kwargs'].name == 'kwargs'
410.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
411.     assert sig.parameters['kwargs'].default == Parameter.empty
412.     assert sig.parameters['kwargs'].annotation == Parameter.empty
413.     assert sig.return_annotation == Parameter.empty
414. 
415. 
416. def test_safe_getattr_with_default():
417.     class Foo:
418.         def __getattr__(self, item):
419.             raise Exception
420. 
421.     obj = Foo()
422. 
423.     result = inspect.safe_getattr(obj, 'bar', 'baz')
424. 
425.     assert result == 'baz'
426. 
427. 
428. def test_safe_getattr_with_exception():
429.     class Foo:
430.         def __getattr__(self, item):
431.             raise Exception
432. 
433.     obj = Foo()
434. 
435.     try:
436.         inspect.safe_getattr(obj, 'bar')
437.     except AttributeError as exc:
438.         assert exc.args[0] == 'bar'
439.     else:
440.         pytest.fail('AttributeError not raised')
441. 
442. 
443. def test_safe_getattr_with_property_exception():
444.     class Foo:
445.         @property
446.         def bar(self):
447.             raise Exception
448. 
449.     obj = Foo()
450. 
451.     try:
452.         inspect.safe_getattr(obj, 'bar')
453.     except AttributeError as exc:
454.         assert exc.args[0] == 'bar'
455.     else:
456.         pytest.fail('AttributeError not raised')
457. 
458. 
459. def test_safe_getattr_with___dict___override():
460.     class Foo:
461.         @property
462.         def __dict__(self):
463.             raise Exception
464. 
465.     obj = Foo()
466. 
467.     try:
468.         inspect.safe_getattr(obj, 'bar')
469.     except AttributeError as exc:
470.         assert exc.args[0] == 'bar'
471.     else:
472.         pytest.fail('AttributeError not raised')
473. 
474. 
475. def test_dictionary_sorting():
476.     dictionary = {"c": 3, "a": 1, "d": 2, "b": 4}
477.     description = inspect.object_description(dictionary)
478.     assert description == "{'a': 1, 'b': 4, 'c': 3, 'd': 2}"
479. 
480. 
481. def test_set_sorting():
482.     set_ = set("gfedcba")
483.     description = inspect.object_description(set_)
484.     assert description == "{'a', 'b', 'c', 'd', 'e', 'f', 'g'}"
485. 
486. 
487. def test_set_sorting_fallback():
488.     set_ = {None, 1}
489.     description = inspect.object_description(set_)
490.     assert description in ("{1, None}", "{None, 1}")
491. 
492. 
493. def test_frozenset_sorting():
494.     frozenset_ = frozenset("gfedcba")
495.     description = inspect.object_description(frozenset_)
496.     assert description == "frozenset({'a', 'b', 'c', 'd', 'e', 'f', 'g'})"
497. 
498. 
499. def test_frozenset_sorting_fallback():
500.     frozenset_ = frozenset((None, 1))

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 03:26:05,098 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `tests/test_util_inspect.py`. This context includes the entire file.', relative_path='tests/test_util_inspect.py', start_line=1, end_line=500), ContextOutput(reasoning='The user requested the full content of `tests/roots/test-ext-autodoc/target/enums.py`. This context includes the entire file.', relative_path='tests/roots/test-ext-autodoc/target/enums.py', start_line=1, end_line=23), ContextOutput(reasoning='The user requested the full content of `tests/test_ext_autodoc.py`. This context includes the entire file.', relative_path='tests/test_ext_autodoc.py', start_line=1, end_line=1500)]
2025-12-21 03:26:05,102 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`.
2025-12-21 03:26:05,102 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 03:26:05,102 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 03:26:05,102 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 0 existing contexts
2025-12-21 03:26:05,103 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-21 03:26:05,103 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Python Enum values (used to show default values in function signatures) are rendered ugly.

Description: Python Enum values (used to show default values in function signatures) are rendered ugly.

**To Reproduce**

I made a minimal example to show the issue:

https://github.com/sidneycadot/sphinx_issue_ugly_enum

```
$ git clone git@github.com:sidneycadot/sphinx_issue_ugly_enum.git
$ cd sphinx_issue_ugly_enum/
$ make html
$ firefox build/html/index.html 
```

**Expected behavior**

I would hope the signature rendered as:

    ugly_enum_func(e: ugly_enum.MyEnum = MyEnum.ValueA) → None

Unfortunately, it renders as:

    ugly_enum_func(e: ugly_enum.MyEnum = <MyEnum.ValueA: 10>) → None

**Environment info**

- Python version: 3.9.5
- Sphinx version: 4.0.2
- Sphinx extensions: autodoc


Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index a415a7074..d54063761 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -432,6 +432,9 @@ def safe_getattr(obj: Any, name: str, *defargs: Any) -> Any:
 
 def object_description(object: Any) -> str:
     """A repr() implementation that returns text safe to use in reST context."""
+    if isenumattribute(object):
+        # Return a clean representation for Enum values
+        return f"{object.__class__.__name__}.{object.name}"
     if isinstance(object, dict):
         try:
             sorted_keys = sorted(object)
diff --git a/test_enum_rendering.py b/test_enum_rendering.py
new file mode 100644
index 000000000..0a9195d9c
--- /dev/null
+++ b/test_enum_rendering.py
@@ -0,0 +1,11 @@
+import enum
+from sphinx.util.inspect import object_description
+
+class MyEnum(enum.Enum):
+    ValueA = 10
+    ValueB = 20
+
+# Test the object_description function with an Enum value
+enum_value = MyEnum.ValueA
+print(f"Original repr: {repr(enum_value)}")
+print(f"Clean description: {object_description(enum_value)}")
\ No newline at end of file


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`.
Extra Requirements: 
Purpose: I need to inspect these files to find three existing test cases demonstrating how Sphinx handles Enum values in function signatures, which is directly related to the user's bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/roots/test-ext-autodoc/target/enums.py
Line number range: 1 - 23
Content:
1. import enum
2. 
3. 
4. class EnumCls(enum.Enum):
5.     """
6.     this is enum class
7.     """
8. 
9.     #: doc for val1
10.     val1 = 12
11.     val2 = 23  #: doc for val2
12.     val3 = 34
13.     """doc for val3"""
14.     val4 = 34
15. 
16.     def say_hello(self):
17.         """a method says hello to you."""
18.         pass
19. 
20.     @classmethod
21.     def say_goodbye(cls):
22.         """a classmethod says good-bye to you."""
23.         pass


File: tests/test_ext_autodoc.py
Line number range: 1 - 1500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',
501.         '   :module: target',
502.         '',
503.         '   My custom exception.',
504.         '',
505.     ]
506. 
507. 
508. @pytest.mark.sphinx('html', testroot='ext-autodoc')
509. def test_autodoc_warnings(app, warning):
510.     app.env.temp_data['docname'] = 'dummy'
511. 
512.     # can't import module
513.     do_autodoc(app, 'module', 'unknown')
514.     assert "failed to import module 'unknown'" in warning.getvalue()
515. 
516.     # missing function
517.     do_autodoc(app, 'function', 'unknown')
518.     assert "import for autodocumenting 'unknown'" in warning.getvalue()
519. 
520.     do_autodoc(app, 'function', 'target.unknown')
521.     assert "failed to import function 'unknown' from module 'target'" in warning.getvalue()
522. 
523.     # missing method
524.     do_autodoc(app, 'method', 'target.Class.unknown')
525.     assert "failed to import method 'Class.unknown' from module 'target'" in warning.getvalue()
526. 
527. 
528. @pytest.mark.sphinx('html', testroot='ext-autodoc')
529. def test_autodoc_attributes(app):
530.     options = {"synopsis": 'Synopsis',
531.                "platform": "Platform",
532.                "deprecated": None}
533.     actual = do_autodoc(app, 'module', 'target', options)
534.     assert list(actual) == [
535.         '',
536.         '.. py:module:: target',
537.         '   :synopsis: Synopsis',
538.         '   :platform: Platform',
539.         '   :deprecated:',
540.         ''
541.     ]
542. 
543. 
544. @pytest.mark.sphinx('html', testroot='ext-autodoc')
545. def test_autodoc_members(app):
546.     # default (no-members)
547.     actual = do_autodoc(app, 'class', 'target.inheritance.Base')
548.     assert list(filter(lambda l: '::' in l, actual)) == [
549.         '.. py:class:: Base()',
550.     ]
551. 
552.     # default ALL-members
553.     options = {"members": None}
554.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
555.     assert list(filter(lambda l: '::' in l, actual)) == [
556.         '.. py:class:: Base()',
557.         '   .. py:method:: Base.inheritedclassmeth()',
558.         '   .. py:method:: Base.inheritedmeth()',
559.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
560.     ]
561. 
562.     # default specific-members
563.     options = {"members": "inheritedmeth,inheritedstaticmeth"}
564.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
565.     assert list(filter(lambda l: '::' in l, actual)) == [
566.         '.. py:class:: Base()',
567.         '   .. py:method:: Base.inheritedmeth()',
568.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
569.     ]
570. 
571.     # ALL-members override autodoc_default_options
572.     options = {"members": None}
573.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
574.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
575.     assert list(filter(lambda l: '::' in l, actual)) == [
576.         '.. py:class:: Base()',
577.         '   .. py:method:: Base.inheritedclassmeth()',
578.         '   .. py:method:: Base.inheritedmeth()',
579.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
580.     ]
581. 
582.     # members override autodoc_default_options
583.     options = {"members": "inheritedmeth"}
584.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
585.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
586.     assert list(filter(lambda l: '::' in l, actual)) == [
587.         '.. py:class:: Base()',
588.         '   .. py:method:: Base.inheritedmeth()',
589.     ]
590. 
591.     # members extends autodoc_default_options
592.     options = {"members": "+inheritedmeth"}
593.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
594.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
595.     assert list(filter(lambda l: '::' in l, actual)) == [
596.         '.. py:class:: Base()',
597.         '   .. py:method:: Base.inheritedmeth()',
598.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
599.     ]
600. 
601. 
602. @pytest.mark.sphinx('html', testroot='ext-autodoc')
603. def test_autodoc_exclude_members(app):
604.     options = {"members": None,
605.                "exclude-members": "inheritedmeth,inheritedstaticmeth"}
606.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
607.     assert list(filter(lambda l: '::' in l, actual)) == [
608.         '.. py:class:: Base()',
609.         '   .. py:method:: Base.inheritedclassmeth()'
610.     ]
611. 
612.     # members vs exclude-members
613.     options = {"members": "inheritedmeth",
614.                "exclude-members": "inheritedmeth"}
615.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
616.     assert list(filter(lambda l: '::' in l, actual)) == [
617.         '.. py:class:: Base()',
618.     ]
619. 
620.     # + has no effect when autodoc_default_options are not present
621.     options = {"members": None,
622.                "exclude-members": "+inheritedmeth,inheritedstaticmeth"}
623.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
624.     assert list(filter(lambda l: '::' in l, actual)) == [
625.         '.. py:class:: Base()',
626.         '   .. py:method:: Base.inheritedclassmeth()'
627.     ]
628. 
629.     # exclude-members overrides autodoc_default_options
630.     options = {"members": None,
631.                "exclude-members": "inheritedmeth"}
632.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
633.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
634.     assert list(filter(lambda l: '::' in l, actual)) == [
635.         '.. py:class:: Base()',
636.         '   .. py:method:: Base.inheritedclassmeth()',
637.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
638.     ]
639. 
640.     # exclude-members extends autodoc_default_options
641.     options = {"members": None,
642.                "exclude-members": "+inheritedmeth"}
643.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
644.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
645.     assert list(filter(lambda l: '::' in l, actual)) == [
646.         '.. py:class:: Base()',
647.         '   .. py:method:: Base.inheritedclassmeth()',
648.     ]
649. 
650.     # no exclude-members causes use autodoc_default_options
651.     options = {"members": None}
652.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
653.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
654.     assert list(filter(lambda l: '::' in l, actual)) == [
655.         '.. py:class:: Base()',
656.         '   .. py:method:: Base.inheritedclassmeth()',
657.     ]
658. 
659.     # empty exclude-members cancels autodoc_default_options
660.     options = {"members": None,
661.                "exclude-members": None}
662.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
663.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
664.     assert list(filter(lambda l: '::' in l, actual)) == [
665.         '.. py:class:: Base()',
666.         '   .. py:method:: Base.inheritedclassmeth()',
667.         '   .. py:method:: Base.inheritedmeth()',
668.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
669.     ]
670. 
671. 
672. @pytest.mark.sphinx('html', testroot='ext-autodoc')
673. def test_autodoc_undoc_members(app):
674.     options = {"members": None,
675.                "undoc-members": None}
676.     actual = do_autodoc(app, 'class', 'target.Class', options)
677.     assert list(filter(lambda l: '::' in l, actual)) == [
678.         '.. py:class:: Class(arg)',
679.         '   .. py:attribute:: Class.attr',
680.         '   .. py:attribute:: Class.docattr',
681.         '   .. py:method:: Class.excludemeth()',
682.         '   .. py:attribute:: Class.inst_attr_comment',
683.         '   .. py:attribute:: Class.inst_attr_inline',
684.         '   .. py:attribute:: Class.inst_attr_string',
685.         '   .. py:attribute:: Class.mdocattr',
686.         '   .. py:method:: Class.meth()',
687.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
688.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
689.         '   .. py:attribute:: Class.skipattr',
690.         '   .. py:method:: Class.skipmeth()',
691.         '   .. py:attribute:: Class.udocattr',
692.         '   .. py:method:: Class.undocmeth()'
693.     ]
694. 
695.     # use autodoc_default_options
696.     options = {"members": None}
697.     app.config.autodoc_default_options["undoc-members"] = None
698.     actual = do_autodoc(app, 'class', 'target.Class', options)
699.     assert list(filter(lambda l: '::' in l, actual)) == [
700.         '.. py:class:: Class(arg)',
701.         '   .. py:attribute:: Class.attr',
702.         '   .. py:attribute:: Class.docattr',
703.         '   .. py:method:: Class.excludemeth()',
704.         '   .. py:attribute:: Class.inst_attr_comment',
705.         '   .. py:attribute:: Class.inst_attr_inline',
706.         '   .. py:attribute:: Class.inst_attr_string',
707.         '   .. py:attribute:: Class.mdocattr',
708.         '   .. py:method:: Class.meth()',
709.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
710.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
711.         '   .. py:attribute:: Class.skipattr',
712.         '   .. py:method:: Class.skipmeth()',
713.         '   .. py:attribute:: Class.udocattr',
714.         '   .. py:method:: Class.undocmeth()'
715.     ]
716. 
717.     # options negation work check
718.     options = {"members": None,
719.                "no-undoc-members": None}
720.     app.config.autodoc_default_options["undoc-members"] = None
721.     actual = do_autodoc(app, 'class', 'target.Class', options)
722.     assert list(filter(lambda l: '::' in l, actual)) == [
723.         '.. py:class:: Class(arg)',
724.         '   .. py:attribute:: Class.attr',
725.         '   .. py:attribute:: Class.docattr',
726.         '   .. py:method:: Class.excludemeth()',
727.         '   .. py:attribute:: Class.inst_attr_comment',
728.         '   .. py:attribute:: Class.inst_attr_inline',
729.         '   .. py:attribute:: Class.inst_attr_string',
730.         '   .. py:attribute:: Class.mdocattr',
731.         '   .. py:method:: Class.meth()',
732.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
733.         '   .. py:method:: Class.skipmeth()',
734.         '   .. py:attribute:: Class.udocattr',
735.     ]
736. 
737. 
738. @pytest.mark.sphinx('html', testroot='ext-autodoc')
739. def test_autodoc_undoc_members_for_metadata_only(app):
740.     # metadata only member is not displayed
741.     options = {"members": None}
742.     actual = do_autodoc(app, 'module', 'target.metadata', options)
743.     assert list(actual) == [
744.         '',
745.         '.. py:module:: target.metadata',
746.         '',
747.     ]
748. 
749.     # metadata only member is displayed when undoc-member given
750.     options = {"members": None,
751.                "undoc-members": None}
752.     actual = do_autodoc(app, 'module', 'target.metadata', options)
753.     assert list(actual) == [
754.         '',
755.         '.. py:module:: target.metadata',
756.         '',
757.         '',
758.         '.. py:function:: foo()',
759.         '   :module: target.metadata',
760.         '',
761.         '   :meta metadata-only-docstring:',
762.         '',
763.     ]
764. 
765. 
766. @pytest.mark.sphinx('html', testroot='ext-autodoc')
767. def test_autodoc_inherited_members(app):
768.     options = {"members": None,
769.                "inherited-members": None}
770.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
771.     assert list(filter(lambda l: 'method::' in l, actual)) == [
772.         '   .. py:method:: Derived.inheritedclassmeth()',
773.         '   .. py:method:: Derived.inheritedmeth()',
774.         '   .. py:method:: Derived.inheritedstaticmeth(cls)',
775.     ]
776. 
777. 
778. @pytest.mark.sphinx('html', testroot='ext-autodoc')
779. def test_autodoc_inherited_members_Base(app):
780.     options = {"members": None,
781.                "inherited-members": "Base",
782.                "special-members": None}
783. 
784.     # check methods for object class are shown
785.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
786.     assert '   .. py:method:: Derived.inheritedmeth()' in actual
787.     assert '   .. py:method:: Derived.inheritedclassmeth' not in actual
788. 
789. 
790. @pytest.mark.sphinx('html', testroot='ext-autodoc')
791. def test_autodoc_inherited_members_None(app):
792.     options = {"members": None,
793.                "inherited-members": "None",
794.                "special-members": None}
795. 
796.     # check methods for object class are shown
797.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
798.     assert '   .. py:method:: Derived.__init__()' in actual
799.     assert '   .. py:method:: Derived.__str__()' in actual
800. 
801. 
802. @pytest.mark.sphinx('html', testroot='ext-autodoc')
803. def test_autodoc_imported_members(app):
804.     options = {"members": None,
805.                "imported-members": None,
806.                "ignore-module-all": None}
807.     actual = do_autodoc(app, 'module', 'target', options)
808.     assert '.. py:function:: save_traceback(app: Sphinx) -> str' in actual
809. 
810. 
811. @pytest.mark.sphinx('html', testroot='ext-autodoc')
812. def test_autodoc_special_members(app):
813.     # specific special methods
814.     options = {"undoc-members": None,
815.                "special-members": "__init__,__special1__"}
816.     actual = do_autodoc(app, 'class', 'target.Class', options)
817.     assert list(filter(lambda l: '::' in l, actual)) == [
818.         '.. py:class:: Class(arg)',
819.         '   .. py:method:: Class.__init__(arg)',
820.         '   .. py:method:: Class.__special1__()',
821.     ]
822. 
823.     # combination with specific members
824.     options = {"members": "attr,docattr",
825.                "undoc-members": None,
826.                "special-members": "__init__,__special1__"}
827.     actual = do_autodoc(app, 'class', 'target.Class', options)
828.     assert list(filter(lambda l: '::' in l, actual)) == [
829.         '.. py:class:: Class(arg)',
830.         '   .. py:method:: Class.__init__(arg)',
831.         '   .. py:method:: Class.__special1__()',
832.         '   .. py:attribute:: Class.attr',
833.         '   .. py:attribute:: Class.docattr',
834.     ]
835. 
836.     # all special methods
837.     options = {"members": None,
838.                "undoc-members": None,
839.                "special-members": None}
840.     actual = do_autodoc(app, 'class', 'target.Class', options)
841.     assert list(filter(lambda l: '::' in l, actual)) == [
842.         '.. py:class:: Class(arg)',
843.         '   .. py:attribute:: Class.__annotations__',
844.         '   .. py:attribute:: Class.__dict__',
845.         '   .. py:method:: Class.__init__(arg)',
846.         '   .. py:attribute:: Class.__module__',
847.         '   .. py:method:: Class.__special1__()',
848.         '   .. py:method:: Class.__special2__()',
849.         '   .. py:attribute:: Class.__weakref__',
850.         '   .. py:attribute:: Class.attr',
851.         '   .. py:attribute:: Class.docattr',
852.         '   .. py:method:: Class.excludemeth()',
853.         '   .. py:attribute:: Class.inst_attr_comment',
854.         '   .. py:attribute:: Class.inst_attr_inline',
855.         '   .. py:attribute:: Class.inst_attr_string',
856.         '   .. py:attribute:: Class.mdocattr',
857.         '   .. py:method:: Class.meth()',
858.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
859.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
860.         '   .. py:attribute:: Class.skipattr',
861.         '   .. py:method:: Class.skipmeth()',
862.         '   .. py:attribute:: Class.udocattr',
863.         '   .. py:method:: Class.undocmeth()'
864.     ]
865. 
866.     # specific special methods from autodoc_default_options
867.     options = {"undoc-members": None}
868.     app.config.autodoc_default_options["special-members"] = "__special2__"
869.     actual = do_autodoc(app, 'class', 'target.Class', options)
870.     assert list(filter(lambda l: '::' in l, actual)) == [
871.         '.. py:class:: Class(arg)',
872.         '   .. py:method:: Class.__special2__()',
873.     ]
874. 
875.     # specific special methods option with autodoc_default_options
876.     options = {"undoc-members": None,
877.                "special-members": "__init__,__special1__"}
878.     app.config.autodoc_default_options["special-members"] = "__special2__"
879.     actual = do_autodoc(app, 'class', 'target.Class', options)
880.     assert list(filter(lambda l: '::' in l, actual)) == [
881.         '.. py:class:: Class(arg)',
882.         '   .. py:method:: Class.__init__(arg)',
883.         '   .. py:method:: Class.__special1__()',
884.     ]
885. 
886.     # specific special methods merge with autodoc_default_options
887.     options = {"undoc-members": None,
888.                "special-members": "+__init__,__special1__"}
889.     app.config.autodoc_default_options["special-members"] = "__special2__"
890.     actual = do_autodoc(app, 'class', 'target.Class', options)
891.     assert list(filter(lambda l: '::' in l, actual)) == [
892.         '.. py:class:: Class(arg)',
893.         '   .. py:method:: Class.__init__(arg)',
894.         '   .. py:method:: Class.__special1__()',
895.         '   .. py:method:: Class.__special2__()',
896.     ]
897. 
898. 
899. @pytest.mark.sphinx('html', testroot='ext-autodoc')
900. def test_autodoc_ignore_module_all(app):
901.     # default (no-ignore-module-all)
902.     options = {"members": None}
903.     actual = do_autodoc(app, 'module', 'target', options)
904.     assert list(filter(lambda l: 'class::' in l, actual)) == [
905.         '.. py:class:: Class(arg)',
906.     ]
907. 
908.     # ignore-module-all
909.     options = {"members": None,
910.                "ignore-module-all": None}
911.     actual = do_autodoc(app, 'module', 'target', options)
912.     assert list(filter(lambda l: 'class::' in l, actual)) == [
913.         '.. py:class:: Class(arg)',
914.         '.. py:class:: CustomDict',
915.         '.. py:class:: InnerChild()',
916.         '.. py:class:: InstAttCls()',
917.         '.. py:class:: Outer()',
918.         '   .. py:class:: Outer.Inner()',
919.         '.. py:class:: StrRepr'
920.     ]
921. 
922. 
923. @pytest.mark.sphinx('html', testroot='ext-autodoc')
924. def test_autodoc_noindex(app):
925.     options = {"noindex": None}
926.     actual = do_autodoc(app, 'module', 'target', options)
927.     assert list(actual) == [
928.         '',
929.         '.. py:module:: target',
930.         '   :noindex:',
931.         ''
932.     ]
933. 
934.     # TODO: :noindex: should be propagated to children of target item.
935. 
936.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
937.     assert list(actual) == [
938.         '',
939.         '.. py:class:: Base()',
940.         '   :noindex:',
941.         '   :module: target.inheritance',
942.         ''
943.     ]
944. 
945. 
946. @pytest.mark.sphinx('html', testroot='ext-autodoc')
947. def test_autodoc_subclass_of_builtin_class(app):
948.     options = {"members": None}
949.     actual = do_autodoc(app, 'class', 'target.CustomDict', options)
950.     assert list(actual) == [
951.         '',
952.         '.. py:class:: CustomDict',
953.         '   :module: target',
954.         '',
955.         '   Docstring.',
956.         '',
957.     ]
958. 
959. 
960. @pytest.mark.sphinx('html', testroot='ext-autodoc')
961. def test_autodoc_inner_class(app):
962.     options = {"members": None}
963.     actual = do_autodoc(app, 'class', 'target.Outer', options)
964.     assert list(actual) == [
965.         '',
966.         '.. py:class:: Outer()',
967.         '   :module: target',
968.         '',
969.         '   Foo',
970.         '',
971.         '',
972.         '   .. py:class:: Outer.Inner()',
973.         '      :module: target',
974.         '',
975.         '      Foo',
976.         '',
977.         '',
978.         '      .. py:method:: Outer.Inner.meth()',
979.         '         :module: target',
980.         '',
981.         '         Foo',
982.         '',
983.         '',
984.         '   .. py:attribute:: Outer.factory',
985.         '      :module: target',
986.         '',
987.         '      alias of :class:`dict`'
988.     ]
989. 
990.     actual = do_autodoc(app, 'class', 'target.Outer.Inner', options)
991.     assert list(actual) == [
992.         '',
993.         '.. py:class:: Inner()',
994.         '   :module: target.Outer',
995.         '',
996.         '   Foo',
997.         '',
998.         '',
999.         '   .. py:method:: Inner.meth()',
1000.         '      :module: target.Outer',
1001.         '',
1002.         '      Foo',
1003.         '',
1004.     ]
1005. 
1006.     options['show-inheritance'] = None
1007.     actual = do_autodoc(app, 'class', 'target.InnerChild', options)
1008.     assert list(actual) == [
1009.         '',
1010.         '.. py:class:: InnerChild()',
1011.         '   :module: target', '',
1012.         '   Bases: :class:`target.Outer.Inner`',
1013.         '',
1014.         '   InnerChild docstring',
1015.         '',
1016.     ]
1017. 
1018. 
1019. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1020. def test_autodoc_classmethod(app):
1021.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedclassmeth')
1022.     assert list(actual) == [
1023.         '',
1024.         '.. py:method:: Base.inheritedclassmeth()',
1025.         '   :module: target.inheritance',
1026.         '   :classmethod:',
1027.         '',
1028.         '   Inherited class method.',
1029.         '',
1030.     ]
1031. 
1032. 
1033. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1034. def test_autodoc_staticmethod(app):
1035.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedstaticmeth')
1036.     assert list(actual) == [
1037.         '',
1038.         '.. py:method:: Base.inheritedstaticmeth(cls)',
1039.         '   :module: target.inheritance',
1040.         '   :staticmethod:',
1041.         '',
1042.         '   Inherited static method.',
1043.         '',
1044.     ]
1045. 
1046. 
1047. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1048. def test_autodoc_descriptor(app):
1049.     options = {"members": None,
1050.                "undoc-members": None}
1051.     actual = do_autodoc(app, 'class', 'target.descriptor.Class', options)
1052.     assert list(actual) == [
1053.         '',
1054.         '.. py:class:: Class()',
1055.         '   :module: target.descriptor',
1056.         '',
1057.         '',
1058.         '   .. py:attribute:: Class.descr',
1059.         '      :module: target.descriptor',
1060.         '',
1061.         '      Descriptor instance docstring.',
1062.         '',
1063.         '',
1064.         '   .. py:property:: Class.prop',
1065.         '      :module: target.descriptor',
1066.         '',
1067.         '      Property.',
1068.         ''
1069.     ]
1070. 
1071. 
1072. @pytest.mark.skipif(sys.version_info < (3, 8),
1073.                     reason='cached_property is available since python3.8.')
1074. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1075. def test_autodoc_cached_property(app):
1076.     options = {"members": None,
1077.                "undoc-members": None}
1078.     actual = do_autodoc(app, 'class', 'target.cached_property.Foo', options)
1079.     assert list(actual) == [
1080.         '',
1081.         '.. py:class:: Foo()',
1082.         '   :module: target.cached_property',
1083.         '',
1084.         '',
1085.         '   .. py:property:: Foo.prop',
1086.         '      :module: target.cached_property',
1087.         '',
1088.     ]
1089. 
1090. 
1091. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1092. def test_autodoc_member_order(app):
1093.     # case member-order='bysource'
1094.     options = {"members": None,
1095.                'member-order': 'bysource',
1096.                "undoc-members": None,
1097.                'private-members': None}
1098.     actual = do_autodoc(app, 'class', 'target.Class', options)
1099.     assert list(filter(lambda l: '::' in l, actual)) == [
1100.         '.. py:class:: Class(arg)',
1101.         '   .. py:method:: Class.meth()',
1102.         '   .. py:method:: Class.undocmeth()',
1103.         '   .. py:method:: Class.skipmeth()',
1104.         '   .. py:method:: Class.excludemeth()',
1105.         '   .. py:attribute:: Class.skipattr',
1106.         '   .. py:attribute:: Class.attr',
1107.         '   .. py:attribute:: Class.docattr',
1108.         '   .. py:attribute:: Class.udocattr',
1109.         '   .. py:attribute:: Class.mdocattr',
1110.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1111.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1112.         '   .. py:attribute:: Class.inst_attr_inline',
1113.         '   .. py:attribute:: Class.inst_attr_comment',
1114.         '   .. py:attribute:: Class.inst_attr_string',
1115.         '   .. py:attribute:: Class._private_inst_attr'
1116.     ]
1117. 
1118.     # case member-order='groupwise'
1119.     options = {"members": None,
1120.                'member-order': 'groupwise',
1121.                "undoc-members": None,
1122.                'private-members': None}
1123.     actual = do_autodoc(app, 'class', 'target.Class', options)
1124.     assert list(filter(lambda l: '::' in l, actual)) == [
1125.         '.. py:class:: Class(arg)',
1126.         '   .. py:method:: Class.excludemeth()',
1127.         '   .. py:method:: Class.meth()',
1128.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1129.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1130.         '   .. py:method:: Class.skipmeth()',
1131.         '   .. py:method:: Class.undocmeth()',
1132.         '   .. py:attribute:: Class._private_inst_attr',
1133.         '   .. py:attribute:: Class.attr',
1134.         '   .. py:attribute:: Class.docattr',
1135.         '   .. py:attribute:: Class.inst_attr_comment',
1136.         '   .. py:attribute:: Class.inst_attr_inline',
1137.         '   .. py:attribute:: Class.inst_attr_string',
1138.         '   .. py:attribute:: Class.mdocattr',
1139.         '   .. py:attribute:: Class.skipattr',
1140.         '   .. py:attribute:: Class.udocattr'
1141.     ]
1142. 
1143.     # case member-order=None
1144.     options = {"members": None,
1145.                "undoc-members": None,
1146.                'private-members': None}
1147.     actual = do_autodoc(app, 'class', 'target.Class', options)
1148.     assert list(filter(lambda l: '::' in l, actual)) == [
1149.         '.. py:class:: Class(arg)',
1150.         '   .. py:attribute:: Class._private_inst_attr',
1151.         '   .. py:attribute:: Class.attr',
1152.         '   .. py:attribute:: Class.docattr',
1153.         '   .. py:method:: Class.excludemeth()',
1154.         '   .. py:attribute:: Class.inst_attr_comment',
1155.         '   .. py:attribute:: Class.inst_attr_inline',
1156.         '   .. py:attribute:: Class.inst_attr_string',
1157.         '   .. py:attribute:: Class.mdocattr',
1158.         '   .. py:method:: Class.meth()',
1159.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1160.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1161.         '   .. py:attribute:: Class.skipattr',
1162.         '   .. py:method:: Class.skipmeth()',
1163.         '   .. py:attribute:: Class.udocattr',
1164.         '   .. py:method:: Class.undocmeth()'
1165.     ]
1166. 
1167. 
1168. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1169. def test_autodoc_module_member_order(app):
1170.     # case member-order='bysource'
1171.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1172.                'member-order': 'bysource',
1173.                "undoc-members": None}
1174.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1175.     assert list(filter(lambda l: '::' in l, actual)) == [
1176.         '.. py:module:: target.sort_by_all',
1177.         '.. py:function:: baz()',
1178.         '.. py:function:: foo()',
1179.         '.. py:class:: Bar()',
1180.         '.. py:class:: Quux()',
1181.         '.. py:function:: foobar()',
1182.         '.. py:function:: qux()',
1183.     ]
1184. 
1185.     # case member-order='bysource' and ignore-module-all
1186.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1187.                'member-order': 'bysource',
1188.                "undoc-members": None,
1189.                "ignore-module-all": None}
1190.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1191.     assert list(filter(lambda l: '::' in l, actual)) == [
1192.         '.. py:module:: target.sort_by_all',
1193.         '.. py:function:: foo()',
1194.         '.. py:class:: Bar()',
1195.         '.. py:function:: baz()',
1196.         '.. py:function:: qux()',
1197.         '.. py:class:: Quux()',
1198.         '.. py:function:: foobar()',
1199.     ]
1200. 
1201. 
1202. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1203. def test_autodoc_module_scope(app):
1204.     app.env.temp_data['autodoc:module'] = 'target'
1205.     actual = do_autodoc(app, 'attribute', 'Class.mdocattr')
1206.     assert list(actual) == [
1207.         '',
1208.         '.. py:attribute:: Class.mdocattr',
1209.         '   :module: target',
1210.         '   :value: <_io.StringIO object>',
1211.         '',
1212.         '   should be documented as well - süß',
1213.         '',
1214.     ]
1215. 
1216. 
1217. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1218. def test_autodoc_class_scope(app):
1219.     app.env.temp_data['autodoc:module'] = 'target'
1220.     app.env.temp_data['autodoc:class'] = 'Class'
1221.     actual = do_autodoc(app, 'attribute', 'mdocattr')
1222.     assert list(actual) == [
1223.         '',
1224.         '.. py:attribute:: Class.mdocattr',
1225.         '   :module: target',
1226.         '   :value: <_io.StringIO object>',
1227.         '',
1228.         '   should be documented as well - süß',
1229.         '',
1230.     ]
1231. 
1232. 
1233. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1234. def test_class_attributes(app):
1235.     options = {"members": None,
1236.                "undoc-members": None}
1237.     actual = do_autodoc(app, 'class', 'target.AttCls', options)
1238.     assert list(actual) == [
1239.         '',
1240.         '.. py:class:: AttCls()',
1241.         '   :module: target',
1242.         '',
1243.         '',
1244.         '   .. py:attribute:: AttCls.a1',
1245.         '      :module: target',
1246.         '      :value: hello world',
1247.         '',
1248.         '',
1249.         '   .. py:attribute:: AttCls.a2',
1250.         '      :module: target',
1251.         '      :value: None',
1252.         ''
1253.     ]
1254. 
1255. 
1256. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1257. def test_autoclass_instance_attributes(app):
1258.     options = {"members": None}
1259.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1260.     assert list(actual) == [
1261.         '',
1262.         '.. py:class:: InstAttCls()',
1263.         '   :module: target',
1264.         '',
1265.         '   Class with documented class and instance attributes.',
1266.         '',
1267.         '',
1268.         '   .. py:attribute:: InstAttCls.ca1',
1269.         '      :module: target',
1270.         "      :value: 'a'",
1271.         '',
1272.         '      Doc comment for class attribute InstAttCls.ca1.',
1273.         '      It can have multiple lines.',
1274.         '',
1275.         '',
1276.         '   .. py:attribute:: InstAttCls.ca2',
1277.         '      :module: target',
1278.         "      :value: 'b'",
1279.         '',
1280.         '      Doc comment for InstAttCls.ca2. One line only.',
1281.         '',
1282.         '',
1283.         '   .. py:attribute:: InstAttCls.ca3',
1284.         '      :module: target',
1285.         "      :value: 'c'",
1286.         '',
1287.         '      Docstring for class attribute InstAttCls.ca3.',
1288.         '',
1289.         '',
1290.         '   .. py:attribute:: InstAttCls.ia1',
1291.         '      :module: target',
1292.         '',
1293.         '      Doc comment for instance attribute InstAttCls.ia1',
1294.         '',
1295.         '',
1296.         '   .. py:attribute:: InstAttCls.ia2',
1297.         '      :module: target',
1298.         '',
1299.         '      Docstring for instance attribute InstAttCls.ia2.',
1300.         ''
1301.     ]
1302. 
1303.     # pick up arbitrary attributes
1304.     options = {"members": 'ca1,ia1'}
1305.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1306.     assert list(actual) == [
1307.         '',
1308.         '.. py:class:: InstAttCls()',
1309.         '   :module: target',
1310.         '',
1311.         '   Class with documented class and instance attributes.',
1312.         '',
1313.         '',
1314.         '   .. py:attribute:: InstAttCls.ca1',
1315.         '      :module: target',
1316.         "      :value: 'a'",
1317.         '',
1318.         '      Doc comment for class attribute InstAttCls.ca1.',
1319.         '      It can have multiple lines.',
1320.         '',
1321.         '',
1322.         '   .. py:attribute:: InstAttCls.ia1',
1323.         '      :module: target',
1324.         '',
1325.         '      Doc comment for instance attribute InstAttCls.ia1',
1326.         ''
1327.     ]
1328. 
1329. 
1330. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1331. def test_autoattribute_instance_attributes(app):
1332.     actual = do_autodoc(app, 'attribute', 'target.InstAttCls.ia1')
1333.     assert list(actual) == [
1334.         '',
1335.         '.. py:attribute:: InstAttCls.ia1',
1336.         '   :module: target',
1337.         '',
1338.         '   Doc comment for instance attribute InstAttCls.ia1',
1339.         ''
1340.     ]
1341. 
1342. 
1343. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1344. def test_slots(app):
1345.     options = {"members": None,
1346.                "undoc-members": None}
1347.     actual = do_autodoc(app, 'module', 'target.slots', options)
1348.     assert list(actual) == [
1349.         '',
1350.         '.. py:module:: target.slots',
1351.         '',
1352.         '',
1353.         '.. py:class:: Bar()',
1354.         '   :module: target.slots',
1355.         '',
1356.         '   docstring',
1357.         '',
1358.         '',
1359.         '   .. py:attribute:: Bar.attr1',
1360.         '      :module: target.slots',
1361.         '',
1362.         '      docstring of attr1',
1363.         '',
1364.         '',
1365.         '   .. py:attribute:: Bar.attr2',
1366.         '      :module: target.slots',
1367.         '',
1368.         '      docstring of instance attr2',
1369.         '',
1370.         '',
1371.         '   .. py:attribute:: Bar.attr3',
1372.         '      :module: target.slots',
1373.         '',
1374.         '',
1375.         '.. py:class:: Baz()',
1376.         '   :module: target.slots',
1377.         '',
1378.         '   docstring',
1379.         '',
1380.         '',
1381.         '   .. py:attribute:: Baz.attr',
1382.         '      :module: target.slots',
1383.         '',
1384.         '',
1385.         '.. py:class:: Foo()',
1386.         '   :module: target.slots',
1387.         '',
1388.         '   docstring',
1389.         '',
1390.         '',
1391.         '   .. py:attribute:: Foo.attr',
1392.         '      :module: target.slots',
1393.         '',
1394.     ]
1395. 
1396. 
1397. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1398. def test_enum_class(app):
1399.     options = {"members": None}
1400.     actual = do_autodoc(app, 'class', 'target.enums.EnumCls', options)
1401. 
1402.     if sys.version_info < (3, 10):
1403.         sig = '(value)'
1404.     else:
1405.         sig = ('(value, names=None, *, module=None, qualname=None, type=None, start=1, '
1406.                'boundary=None)')
1407. 
1408.     assert list(actual) == [
1409.         '',
1410.         '.. py:class:: EnumCls%s' % sig,
1411.         '   :module: target.enums',
1412.         '',
1413.         '   this is enum class',
1414.         '',
1415.         '',
1416.         '   .. py:method:: EnumCls.say_goodbye()',
1417.         '      :module: target.enums',
1418.         '      :classmethod:',
1419.         '',
1420.         '      a classmethod says good-bye to you.',
1421.         '',
1422.         '',
1423.         '   .. py:method:: EnumCls.say_hello()',
1424.         '      :module: target.enums',
1425.         '',
1426.         '      a method says hello to you.',
1427.         '',
1428.         '',
1429.         '   .. py:attribute:: EnumCls.val1',
1430.         '      :module: target.enums',
1431.         '      :value: 12',
1432.         '',
1433.         '      doc for val1',
1434.         '',
1435.         '',
1436.         '   .. py:attribute:: EnumCls.val2',
1437.         '      :module: target.enums',
1438.         '      :value: 23',
1439.         '',
1440.         '      doc for val2',
1441.         '',
1442.         '',
1443.         '   .. py:attribute:: EnumCls.val3',
1444.         '      :module: target.enums',
1445.         '      :value: 34',
1446.         '',
1447.         '      doc for val3',
1448.         '',
1449.     ]
1450. 
1451.     # checks for an attribute of EnumClass
1452.     actual = do_autodoc(app, 'attribute', 'target.enums.EnumCls.val1')
1453.     assert list(actual) == [
1454.         '',
1455.         '.. py:attribute:: EnumCls.val1',
1456.         '   :module: target.enums',
1457.         '   :value: 12',
1458.         '',
1459.         '   doc for val1',
1460.         ''
1461.     ]
1462. 
1463. 
1464. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1465. def test_descriptor_class(app):
1466.     options = {"members": 'CustomDataDescriptor,CustomDataDescriptor2'}
1467.     actual = do_autodoc(app, 'module', 'target.descriptor', options)
1468.     assert list(actual) == [
1469.         '',
1470.         '.. py:module:: target.descriptor',
1471.         '',
1472.         '',
1473.         '.. py:class:: CustomDataDescriptor(doc)',
1474.         '   :module: target.descriptor',
1475.         '',
1476.         '   Descriptor class docstring.',
1477.         '',
1478.         '',
1479.         '   .. py:method:: CustomDataDescriptor.meth()',
1480.         '      :module: target.descriptor',
1481.         '',
1482.         '      Function.',
1483.         '',
1484.         '',
1485.         '.. py:class:: CustomDataDescriptor2(doc)',
1486.         '   :module: target.descriptor',
1487.         '',
1488.         '   Descriptor class with custom metaclass docstring.',
1489.         '',
1490.     ]
1491. 
1492. 
1493. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1494. def test_automethod_for_builtin(app):
1495.     actual = do_autodoc(app, 'method', 'builtins.int.__add__')
1496.     assert list(actual) == [
1497.         '',
1498.         '.. py:method:: int.__add__(value, /)',
1499.         '   :module: builtins',
1500.         '',


File: tests/test_util_inspect.py
Line number range: 1 - 500
Content:
1. """
2.     test_util_inspect
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests util.inspect functions.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import ast
12. import datetime
13. import functools
14. import sys
15. import types
16. from inspect import Parameter
17. 
18. import _testcapi
19. import pytest
20. 
21. from sphinx.util import inspect
22. from sphinx.util.inspect import TypeAliasNamespace, stringify_signature
23. 
24. 
25. def test_TypeAliasNamespace():
26.     import logging.config
27.     type_alias = TypeAliasNamespace({'logging.Filter': 'MyFilter',
28.                                      'logging.Handler': 'MyHandler',
29.                                      'logging.handlers.SyslogHandler': 'MySyslogHandler'})
30. 
31.     assert type_alias['logging'].Filter == 'MyFilter'
32.     assert type_alias['logging'].Handler == 'MyHandler'
33.     assert type_alias['logging'].handlers.SyslogHandler == 'MySyslogHandler'
34.     assert type_alias['logging'].Logger == logging.Logger
35.     assert type_alias['logging'].config == logging.config
36. 
37.     with pytest.raises(KeyError):
38.         assert type_alias['log']
39. 
40.     with pytest.raises(KeyError):
41.         assert type_alias['unknown']
42. 
43. 
44. def test_signature():
45.     # literals
46.     with pytest.raises(TypeError):
47.         inspect.signature(1)
48. 
49.     with pytest.raises(TypeError):
50.         inspect.signature('')
51. 
52.     # builtins are supported on a case-by-case basis, depending on whether
53.     # they define __text_signature__
54.     if getattr(list, '__text_signature__', None):
55.         sig = inspect.stringify_signature(inspect.signature(list))
56.         assert sig == '(iterable=(), /)'
57.     else:
58.         with pytest.raises(ValueError):
59.             inspect.signature(list)
60. 
61.     # normal function
62.     def func(a, b, c=1, d=2, *e, **f):
63.         pass
64. 
65.     sig = inspect.stringify_signature(inspect.signature(func))
66.     assert sig == '(a, b, c=1, d=2, *e, **f)'
67. 
68. 
69. def test_signature_partial():
70.     def fun(a, b, c=1, d=2):
71.         pass
72.     p = functools.partial(fun, 10, c=11)
73. 
74.     sig = inspect.signature(p)
75.     assert stringify_signature(sig) == '(b, *, c=11, d=2)'
76. 
77. 
78. def test_signature_methods():
79.     class Foo:
80.         def meth1(self, arg1, **kwargs):
81.             pass
82. 
83.         @classmethod
84.         def meth2(cls, arg1, *args, **kwargs):
85.             pass
86. 
87.         @staticmethod
88.         def meth3(arg1, *args, **kwargs):
89.             pass
90. 
91.     @functools.wraps(Foo().meth1)
92.     def wrapped_bound_method(*args, **kwargs):
93.         pass
94. 
95.     # unbound method
96.     sig = inspect.signature(Foo.meth1)
97.     assert stringify_signature(sig) == '(self, arg1, **kwargs)'
98. 
99.     sig = inspect.signature(Foo.meth1, bound_method=True)
100.     assert stringify_signature(sig) == '(arg1, **kwargs)'
101. 
102.     # bound method
103.     sig = inspect.signature(Foo().meth1)
104.     assert stringify_signature(sig) == '(arg1, **kwargs)'
105. 
106.     # class method
107.     sig = inspect.signature(Foo.meth2)
108.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
109. 
110.     sig = inspect.signature(Foo().meth2)
111.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
112. 
113.     # static method
114.     sig = inspect.signature(Foo.meth3)
115.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
116. 
117.     sig = inspect.signature(Foo().meth3)
118.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
119. 
120.     # wrapped bound method
121.     sig = inspect.signature(wrapped_bound_method)
122.     assert stringify_signature(sig) == '(arg1, **kwargs)'
123. 
124. 
125. def test_signature_partialmethod():
126.     from functools import partialmethod
127. 
128.     class Foo:
129.         def meth1(self, arg1, arg2, arg3=None, arg4=None):
130.             pass
131. 
132.         def meth2(self, arg1, arg2):
133.             pass
134. 
135.         foo = partialmethod(meth1, 1, 2)
136.         bar = partialmethod(meth1, 1, arg3=3)
137.         baz = partialmethod(meth2, 1, 2)
138. 
139.     subject = Foo()
140.     sig = inspect.signature(subject.foo)
141.     assert stringify_signature(sig) == '(arg3=None, arg4=None)'
142. 
143.     sig = inspect.signature(subject.bar)
144.     assert stringify_signature(sig) == '(arg2, *, arg3=3, arg4=None)'
145. 
146.     sig = inspect.signature(subject.baz)
147.     assert stringify_signature(sig) == '()'
148. 
149. 
150. def test_signature_annotations():
151.     from .typing_test_data import (Node, f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10, f11, f12,
152.                                    f13, f14, f15, f16, f17, f18, f19, f20, f21)
153. 
154.     # Class annotations
155.     sig = inspect.signature(f0)
156.     assert stringify_signature(sig) == '(x: int, y: numbers.Integral) -> None'
157. 
158.     # Generic types with concrete parameters
159.     sig = inspect.signature(f1)
160.     assert stringify_signature(sig) == '(x: List[int]) -> List[int]'
161. 
162.     # TypeVars and generic types with TypeVars
163.     sig = inspect.signature(f2)
164.     if sys.version_info < (3, 7):
165.         assert stringify_signature(sig) == '(x: List[T], y: List[T_co], z: T) -> List[T_contra]'
166.     else:
167.         assert stringify_signature(sig) == ('(x: List[tests.typing_test_data.T],'
168.                                             ' y: List[tests.typing_test_data.T_co],'
169.                                             ' z: tests.typing_test_data.T'
170.                                             ') -> List[tests.typing_test_data.T_contra]')
171. 
172.     # Union types
173.     sig = inspect.signature(f3)
174.     assert stringify_signature(sig) == '(x: Union[str, numbers.Integral]) -> None'
175. 
176.     # Quoted annotations
177.     sig = inspect.signature(f4)
178.     assert stringify_signature(sig) == '(x: str, y: str) -> None'
179. 
180.     # Keyword-only arguments
181.     sig = inspect.signature(f5)
182.     assert stringify_signature(sig) == '(x: int, *, y: str, z: str) -> None'
183. 
184.     # Keyword-only arguments with varargs
185.     sig = inspect.signature(f6)
186.     assert stringify_signature(sig) == '(x: int, *args, y: str, z: str) -> None'
187. 
188.     # Space around '=' for defaults
189.     sig = inspect.signature(f7)
190.     assert stringify_signature(sig) == '(x: Optional[int] = None, y: dict = {}) -> None'
191. 
192.     # Callable types
193.     sig = inspect.signature(f8)
194.     assert stringify_signature(sig) == '(x: Callable[[int, str], int]) -> None'
195. 
196.     sig = inspect.signature(f9)
197.     assert stringify_signature(sig) == '(x: Callable) -> None'
198. 
199.     # Tuple types
200.     sig = inspect.signature(f10)
201.     assert stringify_signature(sig) == '(x: Tuple[int, str], y: Tuple[int, ...]) -> None'
202. 
203.     # Instance annotations
204.     sig = inspect.signature(f11)
205.     assert stringify_signature(sig) == '(x: CustomAnnotation, y: 123) -> None'
206. 
207.     # tuple with more than two items
208.     sig = inspect.signature(f12)
209.     assert stringify_signature(sig) == '() -> Tuple[int, str, int]'
210. 
211.     # optional
212.     sig = inspect.signature(f13)
213.     assert stringify_signature(sig) == '() -> Optional[str]'
214. 
215.     # optional union
216.     sig = inspect.signature(f20)
217.     if sys.version_info < (3, 7):
218.         assert stringify_signature(sig) in ('() -> Optional[Union[int, str]]',
219.                                             '() -> Optional[Union[str, int]]')
220.     else:
221.         assert stringify_signature(sig) == '() -> Optional[Union[int, str]]'
222. 
223.     # Any
224.     sig = inspect.signature(f14)
225.     assert stringify_signature(sig) == '() -> Any'
226. 
227.     # ForwardRef
228.     sig = inspect.signature(f15)
229.     assert stringify_signature(sig) == '(x: Unknown, y: int) -> Any'
230. 
231.     # keyword only arguments (1)
232.     sig = inspect.signature(f16)
233.     assert stringify_signature(sig) == '(arg1, arg2, *, arg3=None, arg4=None)'
234. 
235.     # keyword only arguments (2)
236.     sig = inspect.signature(f17)
237.     assert stringify_signature(sig) == '(*, arg3, arg4)'
238. 
239.     sig = inspect.signature(f18)
240.     assert stringify_signature(sig) == '(self, arg1: Union[int, Tuple] = 10) -> List[Dict]'
241. 
242.     # annotations for variadic and keyword parameters
243.     sig = inspect.signature(f19)
244.     assert stringify_signature(sig) == '(*args: int, **kwargs: str)'
245. 
246.     # default value is inspect.Signature.empty
247.     sig = inspect.signature(f21)
248.     assert stringify_signature(sig) == "(arg1='whatever', arg2)"
249. 
250.     # type hints by string
251.     sig = inspect.signature(Node.children)
252.     assert stringify_signature(sig) == '(self) -> List[tests.typing_test_data.Node]'
253. 
254.     sig = inspect.signature(Node.__init__)
255.     assert stringify_signature(sig) == '(self, parent: Optional[tests.typing_test_data.Node]) -> None'
256. 
257.     # show_annotation is False
258.     sig = inspect.signature(f7)
259.     assert stringify_signature(sig, show_annotation=False) == '(x=None, y={})'
260. 
261.     # show_return_annotation is False
262.     sig = inspect.signature(f7)
263.     assert stringify_signature(sig, show_return_annotation=False) == '(x: Optional[int] = None, y: dict = {})'
264. 
265. 
266. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
267. @pytest.mark.sphinx(testroot='ext-autodoc')
268. def test_signature_annotations_py38(app):
269.     from target.pep570 import bar, baz, foo, qux
270. 
271.     # case: separator at head
272.     sig = inspect.signature(foo)
273.     assert stringify_signature(sig) == '(*, a, b)'
274. 
275.     # case: separator in the middle
276.     sig = inspect.signature(bar)
277.     assert stringify_signature(sig) == '(a, b, /, c, d)'
278. 
279.     sig = inspect.signature(baz)
280.     assert stringify_signature(sig) == '(a, /, *, b)'
281. 
282.     # case: separator at tail
283.     sig = inspect.signature(qux)
284.     assert stringify_signature(sig) == '(a, b, /)'
285. 
286. 
287. def test_signature_from_str_basic():
288.     signature = '(a, b, *args, c=0, d="blah", **kwargs)'
289.     sig = inspect.signature_from_str(signature)
290.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
291.     assert sig.parameters['a'].name == 'a'
292.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
293.     assert sig.parameters['a'].default == Parameter.empty
294.     assert sig.parameters['a'].annotation == Parameter.empty
295.     assert sig.parameters['b'].name == 'b'
296.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
297.     assert sig.parameters['b'].default == Parameter.empty
298.     assert sig.parameters['b'].annotation == Parameter.empty
299.     assert sig.parameters['args'].name == 'args'
300.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
301.     assert sig.parameters['args'].default == Parameter.empty
302.     assert sig.parameters['args'].annotation == Parameter.empty
303.     assert sig.parameters['c'].name == 'c'
304.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
305.     assert sig.parameters['c'].default == '0'
306.     assert sig.parameters['c'].annotation == Parameter.empty
307.     assert sig.parameters['d'].name == 'd'
308.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
309.     assert sig.parameters['d'].default == "'blah'"
310.     assert sig.parameters['d'].annotation == Parameter.empty
311.     assert sig.parameters['kwargs'].name == 'kwargs'
312.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
313.     assert sig.parameters['kwargs'].default == Parameter.empty
314.     assert sig.parameters['kwargs'].annotation == Parameter.empty
315.     assert sig.return_annotation == Parameter.empty
316. 
317. 
318. def test_signature_from_str_default_values():
319.     signature = ('(a=0, b=0.0, c="str", d=b"bytes", e=..., f=True, '
320.                  'g=[1, 2, 3], h={"a": 1}, i={1, 2, 3}, '
321.                  'j=lambda x, y: None, k=None, l=object(), m=foo.bar.CONSTANT)')
322.     sig = inspect.signature_from_str(signature)
323.     assert sig.parameters['a'].default == '0'
324.     assert sig.parameters['b'].default == '0.0'
325.     assert sig.parameters['c'].default == "'str'"
326.     assert sig.parameters['d'].default == "b'bytes'"
327.     assert sig.parameters['e'].default == '...'
328.     assert sig.parameters['f'].default == 'True'
329.     assert sig.parameters['g'].default == '[1, 2, 3]'
330.     assert sig.parameters['h'].default == "{'a': 1}"
331.     assert sig.parameters['i'].default == '{1, 2, 3}'
332.     assert sig.parameters['j'].default == 'lambda x, y: ...'
333.     assert sig.parameters['k'].default == 'None'
334.     assert sig.parameters['l'].default == 'object()'
335.     assert sig.parameters['m'].default == 'foo.bar.CONSTANT'
336. 
337. 
338. def test_signature_from_str_annotations():
339.     signature = '(a: int, *args: bytes, b: str = "blah", **kwargs: float) -> None'
340.     sig = inspect.signature_from_str(signature)
341.     assert list(sig.parameters.keys()) == ['a', 'args', 'b', 'kwargs']
342.     assert sig.parameters['a'].annotation == "int"
343.     assert sig.parameters['args'].annotation == "bytes"
344.     assert sig.parameters['b'].annotation == "str"
345.     assert sig.parameters['kwargs'].annotation == "float"
346.     assert sig.return_annotation == 'None'
347. 
348. 
349. def test_signature_from_str_complex_annotations():
350.     sig = inspect.signature_from_str('() -> Tuple[str, int, ...]')
351.     assert sig.return_annotation == 'Tuple[str, int, ...]'
352. 
353.     sig = inspect.signature_from_str('() -> Callable[[int, int], int]')
354.     assert sig.return_annotation == 'Callable[[int, int], int]'
355. 
356. 
357. def test_signature_from_str_kwonly_args():
358.     sig = inspect.signature_from_str('(a, *, b)')
359.     assert list(sig.parameters.keys()) == ['a', 'b']
360.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
361.     assert sig.parameters['a'].default == Parameter.empty
362.     assert sig.parameters['b'].kind == Parameter.KEYWORD_ONLY
363.     assert sig.parameters['b'].default == Parameter.empty
364. 
365. 
366. @pytest.mark.skipif(sys.version_info < (3, 8),
367.                     reason='python-3.8 or above is required')
368. def test_signature_from_str_positionaly_only_args():
369.     sig = inspect.signature_from_str('(a, b=0, /, c=1)')
370.     assert list(sig.parameters.keys()) == ['a', 'b', 'c']
371.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_ONLY
372.     assert sig.parameters['a'].default == Parameter.empty
373.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_ONLY
374.     assert sig.parameters['b'].default == '0'
375.     assert sig.parameters['c'].kind == Parameter.POSITIONAL_OR_KEYWORD
376.     assert sig.parameters['c'].default == '1'
377. 
378. 
379. def test_signature_from_str_invalid():
380.     with pytest.raises(SyntaxError):
381.         inspect.signature_from_str('')
382. 
383. 
384. def test_signature_from_ast():
385.     signature = 'def func(a, b, *args, c=0, d="blah", **kwargs): pass'
386.     tree = ast.parse(signature)
387.     sig = inspect.signature_from_ast(tree.body[0])
388.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
389.     assert sig.parameters['a'].name == 'a'
390.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
391.     assert sig.parameters['a'].default == Parameter.empty
392.     assert sig.parameters['a'].annotation == Parameter.empty
393.     assert sig.parameters['b'].name == 'b'
394.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
395.     assert sig.parameters['b'].default == Parameter.empty
396.     assert sig.parameters['b'].annotation == Parameter.empty
397.     assert sig.parameters['args'].name == 'args'
398.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
399.     assert sig.parameters['args'].default == Parameter.empty
400.     assert sig.parameters['args'].annotation == Parameter.empty
401.     assert sig.parameters['c'].name == 'c'
402.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
403.     assert sig.parameters['c'].default == '0'
404.     assert sig.parameters['c'].annotation == Parameter.empty
405.     assert sig.parameters['d'].name == 'd'
406.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
407.     assert sig.parameters['d'].default == "'blah'"
408.     assert sig.parameters['d'].annotation == Parameter.empty
409.     assert sig.parameters['kwargs'].name == 'kwargs'
410.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
411.     assert sig.parameters['kwargs'].default == Parameter.empty
412.     assert sig.parameters['kwargs'].annotation == Parameter.empty
413.     assert sig.return_annotation == Parameter.empty
414. 
415. 
416. def test_safe_getattr_with_default():
417.     class Foo:
418.         def __getattr__(self, item):
419.             raise Exception
420. 
421.     obj = Foo()
422. 
423.     result = inspect.safe_getattr(obj, 'bar', 'baz')
424. 
425.     assert result == 'baz'
426. 
427. 
428. def test_safe_getattr_with_exception():
429.     class Foo:
430.         def __getattr__(self, item):
431.             raise Exception
432. 
433.     obj = Foo()
434. 
435.     try:
436.         inspect.safe_getattr(obj, 'bar')
437.     except AttributeError as exc:
438.         assert exc.args[0] == 'bar'
439.     else:
440.         pytest.fail('AttributeError not raised')
441. 
442. 
443. def test_safe_getattr_with_property_exception():
444.     class Foo:
445.         @property
446.         def bar(self):
447.             raise Exception
448. 
449.     obj = Foo()
450. 
451.     try:
452.         inspect.safe_getattr(obj, 'bar')
453.     except AttributeError as exc:
454.         assert exc.args[0] == 'bar'
455.     else:
456.         pytest.fail('AttributeError not raised')
457. 
458. 
459. def test_safe_getattr_with___dict___override():
460.     class Foo:
461.         @property
462.         def __dict__(self):
463.             raise Exception
464. 
465.     obj = Foo()
466. 
467.     try:
468.         inspect.safe_getattr(obj, 'bar')
469.     except AttributeError as exc:
470.         assert exc.args[0] == 'bar'
471.     else:
472.         pytest.fail('AttributeError not raised')
473. 
474. 
475. def test_dictionary_sorting():
476.     dictionary = {"c": 3, "a": 1, "d": 2, "b": 4}
477.     description = inspect.object_description(dictionary)
478.     assert description == "{'a': 1, 'b': 4, 'c': 3, 'd': 2}"
479. 
480. 
481. def test_set_sorting():
482.     set_ = set("gfedcba")
483.     description = inspect.object_description(set_)
484.     assert description == "{'a', 'b', 'c', 'd', 'e', 'f', 'g'}"
485. 
486. 
487. def test_set_sorting_fallback():
488.     set_ = {None, 1}
489.     description = inspect.object_description(set_)
490.     assert description in ("{1, None}", "{None, 1}")
491. 
492. 
493. def test_frozenset_sorting():
494.     frozenset_ = frozenset("gfedcba")
495.     description = inspect.object_description(frozenset_)
496.     assert description == "frozenset({'a', 'b', 'c', 'd', 'e', 'f', 'g'})"
497. 
498. 
499. def test_frozenset_sorting_fallback():
500.     frozenset_ = frozenset((None, 1))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 03:26:53,509 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have identified `tests/test_util_inspect.py` as a source for relevant test cases, specifically `test_signature_annotations`. This test case is crucial because it examines the stringification of function signatures, including those with default values, which is central to the user's problem. However, `test_signature_annotations` depends on various functions and type definitions imported from `tests/typing_test_data.py`. This file is not in my current context, and without it, I cannot provide a complete, self-contained, and runnable test case as requested. The other two test cases I've identified do not have this dependency." query='Please provide the full content of tests/typing_test_data.py.' extra_requirements='' purpose="I need the content of this file to resolve dependencies for the `test_signature_annotations` test case, which is essential for fulfilling the user's request for three relevant test cases."
2025-12-21 03:26:53,510 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/typing_test_data.py.
2025-12-21 03:26:53,511 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 03:26:53,511 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 03:26:53,512 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 03:26:53,512 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/typing_test_data.py.
Purpose: I need the content of this file to resolve dependencies for the `test_signature_annotations` test case, which is essential for fulfilling the user's request for three relevant test cases.
2025-12-21 03:26:55,532 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the file `tests/typing_test_data.py` as you requested. This was done to help resolve dependencies for the `test_signature_annotations` test case.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/typing_test_data.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2090, 'candidates_token_count': 66, 'total_token_count': 2237, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2090}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 66}], 'thoughts_token_count': 81, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09104889089410956, 'model_name': 'gemini-2.5-pro'} id='run--fe218e49-76e9-43c7-803a-a5ae75d93540-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/typing_test_data.py'}, 'id': 'b0b03d2a-d760-40ad-98d5-e2137b21486d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2090, 'output_tokens': 66, 'total_tokens': 2237, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 81}}
2025-12-21 03:27:00,159 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content=['\nthought\nThe user wants the full content of the file `tests/typing_test_data.py`.\nThe user has also provided the reason for this request: "I need the content of this file to resolve dependencies for the `test_signature_annotations` test case, which is essential for fulfilling the user\'s request for three relevant test cases."\n\nThe `read_file_with_knowledge_graph_data` tool can be used to read the entire content of a file.\nI should use this tool with the `relative_path` argument set to `tests/typing_test_data.py`.\n\n1. **Search**: The user is asking for the content of a specific file. The `read_file_with_knowledge_graph_data` tool is the most direct way to get this information.\n\n2. **Parameters**: The `read_file_with_knowledge_graph_data` tool requires the `relative_path` of the file. The user has provided this in the prompt: `tests/typing_test_data.py`.\n\n3. **Tool Call**: I will call the `read_file_with_knowledge_graph_data` tool with `relative_path=\'tests/typing_test_data.py\'`.\n\n4. **Response**: After executing the tool call, I will have the content of the file. I will then summarize what I have done in a few sentences, as instructed. I will not repeat the output of the tool in my summary.\nThe user wants the full content of `tests/typing_test_data.py`.\nI can use the `read_file_with_knowledge_graph_data` tool to get the content of the file.\nThe relative path is `tests/typing_test_data.py`.\nI will call the tool with this path.\nAfter getting the content, I will provide a short summary of what I have done.', 'I have retrieved the full content of the file `tests/typing_test_data.py` as you requested. This was done to help resolve dependencies for the `test_signature_annotations` test case.'] additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/typing_test_data.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3381, 'candidates_token_count': 472, 'total_token_count': 3853, 'cached_content_token_count': 1620, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3381}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1620}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 472}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.04921091613122972, 'model_name': 'gemini-2.5-pro'} id='run--211ed529-399c-491c-b808-0ed42943bd92-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/typing_test_data.py'}, 'id': 'acf96c55-18e2-4046-9536-f98ddcf6164f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3381, 'output_tokens': 472, 'total_tokens': 3853, 'input_token_details': {'cache_read': 1620}}
2025-12-21 03:27:01,130 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={} response_metadata={'usage_metadata': {'prompt_token_count': 5078, 'total_token_count': 5078, 'cached_content_token_count': 3453, 'prompt_tokens_details': [{'modality': 1, 'token_count': 5078}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3453}], 'candidates_token_count': 0, 'thoughts_token_count': 0, 'candidates_tokens_details': []}, 'model_name': 'gemini-2.5-pro'} id='run--a489f73b-296f-4a01-9afe-a1432ca3b7f1-0' usage_metadata={'input_tokens': 5078, 'output_tokens': 0, 'total_tokens': 5078, 'input_token_details': {'cache_read': 3453}}
2025-12-21 03:27:01,131 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/typing_test_data.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need the content of this file to resolve dependencies for the `test_signature_annotations` test case, which is essential for fulfilling the user's request for three relevant test cases.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/typing_test_data.py
Line number range: 1 - 113
Content:
1. from inspect import Signature
2. from numbers import Integral
3. from typing import Any, Callable, Dict, List, Optional, Tuple, TypeVar, Union
4. 
5. 
6. def f0(x: int, y: Integral) -> None:
7.     pass
8. 
9. 
10. def f1(x: List[int]) -> List[int]:
11.     pass
12. 
13. 
14. T = TypeVar('T')
15. T_co = TypeVar('T_co', covariant=True)
16. T_contra = TypeVar('T_contra', contravariant=True)
17. 
18. 
19. def f2(x: List[T], y: List[T_co], z: T) -> List[T_contra]:
20.     pass
21. 
22. 
23. def f3(x: Union[str, Integral]) -> None:
24.     pass
25. 
26. 
27. MyStr = str
28. 
29. 
30. def f4(x: 'MyStr', y: MyStr) -> None:
31.     pass
32. 
33. 
34. def f5(x: int, *, y: str, z: str) -> None:
35.     pass
36. 
37. 
38. def f6(x: int, *args, y: str, z: str) -> None:
39.     pass
40. 
41. 
42. def f7(x: int = None, y: dict = {}) -> None:
43.     pass
44. 
45. 
46. def f8(x: Callable[[int, str], int]) -> None:
47.     # See https://github.com/ambv/typehinting/issues/149 for Callable[..., int]
48.     pass
49. 
50. 
51. def f9(x: Callable) -> None:
52.     pass
53. 
54. 
55. def f10(x: Tuple[int, str], y: Tuple[int, ...]) -> None:
56.     pass
57. 
58. 
59. class CustomAnnotation:
60.     def __repr__(self):
61.         return 'CustomAnnotation'
62. 
63. 
64. def f11(x: CustomAnnotation(), y: 123) -> None:
65.     pass
66. 
67. 
68. def f12() -> Tuple[int, str, int]:
69.     pass
70. 
71. 
72. def f13() -> Optional[str]:
73.     pass
74. 
75. 
76. def f14() -> Any:
77.     pass
78. 
79. 
80. def f15(x: "Unknown", y: "int") -> Any:  # type: ignore # NOQA
81.     pass
82. 
83. 
84. def f16(arg1, arg2, *, arg3=None, arg4=None):
85.     pass
86. 
87. 
88. def f17(*, arg3, arg4):
89.     pass
90. 
91. 
92. def f18(self, arg1: Union[int, Tuple] = 10) -> List[Dict]:
93.     pass
94. 
95. 
96. def f19(*args: int, **kwargs: str):
97.     pass
98. 
99. 
100. def f20() -> Optional[Union[int, str]]:
101.     pass
102. 
103. 
104. def f21(arg1='whatever', arg2=Signature.empty):
105.     pass
106. 
107. 
108. class Node:
109.     def __init__(self, parent: Optional['Node']) -> None:
110.         pass
111. 
112.     def children(self) -> List['Node']:
113.         pass

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 03:27:05,102 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly requested the full content of the file `tests/typing_test_data.py`.\n\n2. Extended relevance:\n   - The provided context contains the entire content of the requested file, from line 1 to 113. Therefore, the entire file is relevant as it directly fulfills the user's request.", relative_path='tests/typing_test_data.py', start_line=1, end_line=113)]
2025-12-21 03:27:05,103 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of tests/typing_test_data.py.
2025-12-21 03:27:05,103 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 03:27:05,104 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 03:27:05,104 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 3 existing contexts
2025-12-21 03:27:05,104 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 4 total contexts (removed 0 duplicates)
2025-12-21 03:27:05,105 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   └── themes
|   |       └── fullsize
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Python Enum values (used to show default values in function signatures) are rendered ugly.

Description: Python Enum values (used to show default values in function signatures) are rendered ugly.

**To Reproduce**

I made a minimal example to show the issue:

https://github.com/sidneycadot/sphinx_issue_ugly_enum

```
$ git clone git@github.com:sidneycadot/sphinx_issue_ugly_enum.git
$ cd sphinx_issue_ugly_enum/
$ make html
$ firefox build/html/index.html 
```

**Expected behavior**

I would hope the signature rendered as:

    ugly_enum_func(e: ugly_enum.MyEnum = MyEnum.ValueA) → None

Unfortunately, it renders as:

    ugly_enum_func(e: ugly_enum.MyEnum = <MyEnum.ValueA: 10>) → None

**Environment info**

- Python version: 3.9.5
- Sphinx version: 4.0.2
- Sphinx extensions: autodoc


Patch information:
diff --git a/sphinx/util/inspect.py b/sphinx/util/inspect.py
index a415a7074..d54063761 100644
--- a/sphinx/util/inspect.py
+++ b/sphinx/util/inspect.py
@@ -432,6 +432,9 @@ def safe_getattr(obj: Any, name: str, *defargs: Any) -> Any:
 
 def object_description(object: Any) -> str:
     """A repr() implementation that returns text safe to use in reST context."""
+    if isenumattribute(object):
+        # Return a clean representation for Enum values
+        return f"{object.__class__.__name__}.{object.name}"
     if isinstance(object, dict):
         try:
             sorted_keys = sorted(object)
diff --git a/test_enum_rendering.py b/test_enum_rendering.py
new file mode 100644
index 000000000..0a9195d9c
--- /dev/null
+++ b/test_enum_rendering.py
@@ -0,0 +1,11 @@
+import enum
+from sphinx.util.inspect import object_description
+
+class MyEnum(enum.Enum):
+    ValueA = 10
+    ValueB = 20
+
+# Test the object_description function with an Enum value
+enum_value = MyEnum.ValueA
+print(f"Original repr: {repr(enum_value)}")
+print(f"Clean description: {object_description(enum_value)}")
\ No newline at end of file


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_util_inspect.py`, `tests/roots/test-ext-autodoc/target/enums.py`, and `tests/test_ext_autodoc.py`.
Extra Requirements: 
Purpose: I need to inspect these files to find three existing test cases demonstrating how Sphinx handles Enum values in function signatures, which is directly related to the user's bug report.

Previous refined query 2:
Essential Query: Please provide the full content of tests/typing_test_data.py.
Extra Requirements: 
Purpose: I need the content of this file to resolve dependencies for the `test_signature_annotations` test case, which is essential for fulfilling the user's request for three relevant test cases.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/roots/test-ext-autodoc/target/enums.py
Line number range: 1 - 23
Content:
1. import enum
2. 
3. 
4. class EnumCls(enum.Enum):
5.     """
6.     this is enum class
7.     """
8. 
9.     #: doc for val1
10.     val1 = 12
11.     val2 = 23  #: doc for val2
12.     val3 = 34
13.     """doc for val3"""
14.     val4 = 34
15. 
16.     def say_hello(self):
17.         """a method says hello to you."""
18.         pass
19. 
20.     @classmethod
21.     def say_goodbye(cls):
22.         """a classmethod says good-bye to you."""
23.         pass


File: tests/test_ext_autodoc.py
Line number range: 1 - 1500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',
501.         '   :module: target',
502.         '',
503.         '   My custom exception.',
504.         '',
505.     ]
506. 
507. 
508. @pytest.mark.sphinx('html', testroot='ext-autodoc')
509. def test_autodoc_warnings(app, warning):
510.     app.env.temp_data['docname'] = 'dummy'
511. 
512.     # can't import module
513.     do_autodoc(app, 'module', 'unknown')
514.     assert "failed to import module 'unknown'" in warning.getvalue()
515. 
516.     # missing function
517.     do_autodoc(app, 'function', 'unknown')
518.     assert "import for autodocumenting 'unknown'" in warning.getvalue()
519. 
520.     do_autodoc(app, 'function', 'target.unknown')
521.     assert "failed to import function 'unknown' from module 'target'" in warning.getvalue()
522. 
523.     # missing method
524.     do_autodoc(app, 'method', 'target.Class.unknown')
525.     assert "failed to import method 'Class.unknown' from module 'target'" in warning.getvalue()
526. 
527. 
528. @pytest.mark.sphinx('html', testroot='ext-autodoc')
529. def test_autodoc_attributes(app):
530.     options = {"synopsis": 'Synopsis',
531.                "platform": "Platform",
532.                "deprecated": None}
533.     actual = do_autodoc(app, 'module', 'target', options)
534.     assert list(actual) == [
535.         '',
536.         '.. py:module:: target',
537.         '   :synopsis: Synopsis',
538.         '   :platform: Platform',
539.         '   :deprecated:',
540.         ''
541.     ]
542. 
543. 
544. @pytest.mark.sphinx('html', testroot='ext-autodoc')
545. def test_autodoc_members(app):
546.     # default (no-members)
547.     actual = do_autodoc(app, 'class', 'target.inheritance.Base')
548.     assert list(filter(lambda l: '::' in l, actual)) == [
549.         '.. py:class:: Base()',
550.     ]
551. 
552.     # default ALL-members
553.     options = {"members": None}
554.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
555.     assert list(filter(lambda l: '::' in l, actual)) == [
556.         '.. py:class:: Base()',
557.         '   .. py:method:: Base.inheritedclassmeth()',
558.         '   .. py:method:: Base.inheritedmeth()',
559.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
560.     ]
561. 
562.     # default specific-members
563.     options = {"members": "inheritedmeth,inheritedstaticmeth"}
564.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
565.     assert list(filter(lambda l: '::' in l, actual)) == [
566.         '.. py:class:: Base()',
567.         '   .. py:method:: Base.inheritedmeth()',
568.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
569.     ]
570. 
571.     # ALL-members override autodoc_default_options
572.     options = {"members": None}
573.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
574.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
575.     assert list(filter(lambda l: '::' in l, actual)) == [
576.         '.. py:class:: Base()',
577.         '   .. py:method:: Base.inheritedclassmeth()',
578.         '   .. py:method:: Base.inheritedmeth()',
579.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
580.     ]
581. 
582.     # members override autodoc_default_options
583.     options = {"members": "inheritedmeth"}
584.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
585.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
586.     assert list(filter(lambda l: '::' in l, actual)) == [
587.         '.. py:class:: Base()',
588.         '   .. py:method:: Base.inheritedmeth()',
589.     ]
590. 
591.     # members extends autodoc_default_options
592.     options = {"members": "+inheritedmeth"}
593.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
594.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
595.     assert list(filter(lambda l: '::' in l, actual)) == [
596.         '.. py:class:: Base()',
597.         '   .. py:method:: Base.inheritedmeth()',
598.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
599.     ]
600. 
601. 
602. @pytest.mark.sphinx('html', testroot='ext-autodoc')
603. def test_autodoc_exclude_members(app):
604.     options = {"members": None,
605.                "exclude-members": "inheritedmeth,inheritedstaticmeth"}
606.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
607.     assert list(filter(lambda l: '::' in l, actual)) == [
608.         '.. py:class:: Base()',
609.         '   .. py:method:: Base.inheritedclassmeth()'
610.     ]
611. 
612.     # members vs exclude-members
613.     options = {"members": "inheritedmeth",
614.                "exclude-members": "inheritedmeth"}
615.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
616.     assert list(filter(lambda l: '::' in l, actual)) == [
617.         '.. py:class:: Base()',
618.     ]
619. 
620.     # + has no effect when autodoc_default_options are not present
621.     options = {"members": None,
622.                "exclude-members": "+inheritedmeth,inheritedstaticmeth"}
623.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
624.     assert list(filter(lambda l: '::' in l, actual)) == [
625.         '.. py:class:: Base()',
626.         '   .. py:method:: Base.inheritedclassmeth()'
627.     ]
628. 
629.     # exclude-members overrides autodoc_default_options
630.     options = {"members": None,
631.                "exclude-members": "inheritedmeth"}
632.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
633.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
634.     assert list(filter(lambda l: '::' in l, actual)) == [
635.         '.. py:class:: Base()',
636.         '   .. py:method:: Base.inheritedclassmeth()',
637.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
638.     ]
639. 
640.     # exclude-members extends autodoc_default_options
641.     options = {"members": None,
642.                "exclude-members": "+inheritedmeth"}
643.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
644.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
645.     assert list(filter(lambda l: '::' in l, actual)) == [
646.         '.. py:class:: Base()',
647.         '   .. py:method:: Base.inheritedclassmeth()',
648.     ]
649. 
650.     # no exclude-members causes use autodoc_default_options
651.     options = {"members": None}
652.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
653.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
654.     assert list(filter(lambda l: '::' in l, actual)) == [
655.         '.. py:class:: Base()',
656.         '   .. py:method:: Base.inheritedclassmeth()',
657.     ]
658. 
659.     # empty exclude-members cancels autodoc_default_options
660.     options = {"members": None,
661.                "exclude-members": None}
662.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
663.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
664.     assert list(filter(lambda l: '::' in l, actual)) == [
665.         '.. py:class:: Base()',
666.         '   .. py:method:: Base.inheritedclassmeth()',
667.         '   .. py:method:: Base.inheritedmeth()',
668.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
669.     ]
670. 
671. 
672. @pytest.mark.sphinx('html', testroot='ext-autodoc')
673. def test_autodoc_undoc_members(app):
674.     options = {"members": None,
675.                "undoc-members": None}
676.     actual = do_autodoc(app, 'class', 'target.Class', options)
677.     assert list(filter(lambda l: '::' in l, actual)) == [
678.         '.. py:class:: Class(arg)',
679.         '   .. py:attribute:: Class.attr',
680.         '   .. py:attribute:: Class.docattr',
681.         '   .. py:method:: Class.excludemeth()',
682.         '   .. py:attribute:: Class.inst_attr_comment',
683.         '   .. py:attribute:: Class.inst_attr_inline',
684.         '   .. py:attribute:: Class.inst_attr_string',
685.         '   .. py:attribute:: Class.mdocattr',
686.         '   .. py:method:: Class.meth()',
687.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
688.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
689.         '   .. py:attribute:: Class.skipattr',
690.         '   .. py:method:: Class.skipmeth()',
691.         '   .. py:attribute:: Class.udocattr',
692.         '   .. py:method:: Class.undocmeth()'
693.     ]
694. 
695.     # use autodoc_default_options
696.     options = {"members": None}
697.     app.config.autodoc_default_options["undoc-members"] = None
698.     actual = do_autodoc(app, 'class', 'target.Class', options)
699.     assert list(filter(lambda l: '::' in l, actual)) == [
700.         '.. py:class:: Class(arg)',
701.         '   .. py:attribute:: Class.attr',
702.         '   .. py:attribute:: Class.docattr',
703.         '   .. py:method:: Class.excludemeth()',
704.         '   .. py:attribute:: Class.inst_attr_comment',
705.         '   .. py:attribute:: Class.inst_attr_inline',
706.         '   .. py:attribute:: Class.inst_attr_string',
707.         '   .. py:attribute:: Class.mdocattr',
708.         '   .. py:method:: Class.meth()',
709.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
710.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
711.         '   .. py:attribute:: Class.skipattr',
712.         '   .. py:method:: Class.skipmeth()',
713.         '   .. py:attribute:: Class.udocattr',
714.         '   .. py:method:: Class.undocmeth()'
715.     ]
716. 
717.     # options negation work check
718.     options = {"members": None,
719.                "no-undoc-members": None}
720.     app.config.autodoc_default_options["undoc-members"] = None
721.     actual = do_autodoc(app, 'class', 'target.Class', options)
722.     assert list(filter(lambda l: '::' in l, actual)) == [
723.         '.. py:class:: Class(arg)',
724.         '   .. py:attribute:: Class.attr',
725.         '   .. py:attribute:: Class.docattr',
726.         '   .. py:method:: Class.excludemeth()',
727.         '   .. py:attribute:: Class.inst_attr_comment',
728.         '   .. py:attribute:: Class.inst_attr_inline',
729.         '   .. py:attribute:: Class.inst_attr_string',
730.         '   .. py:attribute:: Class.mdocattr',
731.         '   .. py:method:: Class.meth()',
732.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
733.         '   .. py:method:: Class.skipmeth()',
734.         '   .. py:attribute:: Class.udocattr',
735.     ]
736. 
737. 
738. @pytest.mark.sphinx('html', testroot='ext-autodoc')
739. def test_autodoc_undoc_members_for_metadata_only(app):
740.     # metadata only member is not displayed
741.     options = {"members": None}
742.     actual = do_autodoc(app, 'module', 'target.metadata', options)
743.     assert list(actual) == [
744.         '',
745.         '.. py:module:: target.metadata',
746.         '',
747.     ]
748. 
749.     # metadata only member is displayed when undoc-member given
750.     options = {"members": None,
751.                "undoc-members": None}
752.     actual = do_autodoc(app, 'module', 'target.metadata', options)
753.     assert list(actual) == [
754.         '',
755.         '.. py:module:: target.metadata',
756.         '',
757.         '',
758.         '.. py:function:: foo()',
759.         '   :module: target.metadata',
760.         '',
761.         '   :meta metadata-only-docstring:',
762.         '',
763.     ]
764. 
765. 
766. @pytest.mark.sphinx('html', testroot='ext-autodoc')
767. def test_autodoc_inherited_members(app):
768.     options = {"members": None,
769.                "inherited-members": None}
770.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
771.     assert list(filter(lambda l: 'method::' in l, actual)) == [
772.         '   .. py:method:: Derived.inheritedclassmeth()',
773.         '   .. py:method:: Derived.inheritedmeth()',
774.         '   .. py:method:: Derived.inheritedstaticmeth(cls)',
775.     ]
776. 
777. 
778. @pytest.mark.sphinx('html', testroot='ext-autodoc')
779. def test_autodoc_inherited_members_Base(app):
780.     options = {"members": None,
781.                "inherited-members": "Base",
782.                "special-members": None}
783. 
784.     # check methods for object class are shown
785.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
786.     assert '   .. py:method:: Derived.inheritedmeth()' in actual
787.     assert '   .. py:method:: Derived.inheritedclassmeth' not in actual
788. 
789. 
790. @pytest.mark.sphinx('html', testroot='ext-autodoc')
791. def test_autodoc_inherited_members_None(app):
792.     options = {"members": None,
793.                "inherited-members": "None",
794.                "special-members": None}
795. 
796.     # check methods for object class are shown
797.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
798.     assert '   .. py:method:: Derived.__init__()' in actual
799.     assert '   .. py:method:: Derived.__str__()' in actual
800. 
801. 
802. @pytest.mark.sphinx('html', testroot='ext-autodoc')
803. def test_autodoc_imported_members(app):
804.     options = {"members": None,
805.                "imported-members": None,
806.                "ignore-module-all": None}
807.     actual = do_autodoc(app, 'module', 'target', options)
808.     assert '.. py:function:: save_traceback(app: Sphinx) -> str' in actual
809. 
810. 
811. @pytest.mark.sphinx('html', testroot='ext-autodoc')
812. def test_autodoc_special_members(app):
813.     # specific special methods
814.     options = {"undoc-members": None,
815.                "special-members": "__init__,__special1__"}
816.     actual = do_autodoc(app, 'class', 'target.Class', options)
817.     assert list(filter(lambda l: '::' in l, actual)) == [
818.         '.. py:class:: Class(arg)',
819.         '   .. py:method:: Class.__init__(arg)',
820.         '   .. py:method:: Class.__special1__()',
821.     ]
822. 
823.     # combination with specific members
824.     options = {"members": "attr,docattr",
825.                "undoc-members": None,
826.                "special-members": "__init__,__special1__"}
827.     actual = do_autodoc(app, 'class', 'target.Class', options)
828.     assert list(filter(lambda l: '::' in l, actual)) == [
829.         '.. py:class:: Class(arg)',
830.         '   .. py:method:: Class.__init__(arg)',
831.         '   .. py:method:: Class.__special1__()',
832.         '   .. py:attribute:: Class.attr',
833.         '   .. py:attribute:: Class.docattr',
834.     ]
835. 
836.     # all special methods
837.     options = {"members": None,
838.                "undoc-members": None,
839.                "special-members": None}
840.     actual = do_autodoc(app, 'class', 'target.Class', options)
841.     assert list(filter(lambda l: '::' in l, actual)) == [
842.         '.. py:class:: Class(arg)',
843.         '   .. py:attribute:: Class.__annotations__',
844.         '   .. py:attribute:: Class.__dict__',
845.         '   .. py:method:: Class.__init__(arg)',
846.         '   .. py:attribute:: Class.__module__',
847.         '   .. py:method:: Class.__special1__()',
848.         '   .. py:method:: Class.__special2__()',
849.         '   .. py:attribute:: Class.__weakref__',
850.         '   .. py:attribute:: Class.attr',
851.         '   .. py:attribute:: Class.docattr',
852.         '   .. py:method:: Class.excludemeth()',
853.         '   .. py:attribute:: Class.inst_attr_comment',
854.         '   .. py:attribute:: Class.inst_attr_inline',
855.         '   .. py:attribute:: Class.inst_attr_string',
856.         '   .. py:attribute:: Class.mdocattr',
857.         '   .. py:method:: Class.meth()',
858.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
859.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
860.         '   .. py:attribute:: Class.skipattr',
861.         '   .. py:method:: Class.skipmeth()',
862.         '   .. py:attribute:: Class.udocattr',
863.         '   .. py:method:: Class.undocmeth()'
864.     ]
865. 
866.     # specific special methods from autodoc_default_options
867.     options = {"undoc-members": None}
868.     app.config.autodoc_default_options["special-members"] = "__special2__"
869.     actual = do_autodoc(app, 'class', 'target.Class', options)
870.     assert list(filter(lambda l: '::' in l, actual)) == [
871.         '.. py:class:: Class(arg)',
872.         '   .. py:method:: Class.__special2__()',
873.     ]
874. 
875.     # specific special methods option with autodoc_default_options
876.     options = {"undoc-members": None,
877.                "special-members": "__init__,__special1__"}
878.     app.config.autodoc_default_options["special-members"] = "__special2__"
879.     actual = do_autodoc(app, 'class', 'target.Class', options)
880.     assert list(filter(lambda l: '::' in l, actual)) == [
881.         '.. py:class:: Class(arg)',
882.         '   .. py:method:: Class.__init__(arg)',
883.         '   .. py:method:: Class.__special1__()',
884.     ]
885. 
886.     # specific special methods merge with autodoc_default_options
887.     options = {"undoc-members": None,
888.                "special-members": "+__init__,__special1__"}
889.     app.config.autodoc_default_options["special-members"] = "__special2__"
890.     actual = do_autodoc(app, 'class', 'target.Class', options)
891.     assert list(filter(lambda l: '::' in l, actual)) == [
892.         '.. py:class:: Class(arg)',
893.         '   .. py:method:: Class.__init__(arg)',
894.         '   .. py:method:: Class.__special1__()',
895.         '   .. py:method:: Class.__special2__()',
896.     ]
897. 
898. 
899. @pytest.mark.sphinx('html', testroot='ext-autodoc')
900. def test_autodoc_ignore_module_all(app):
901.     # default (no-ignore-module-all)
902.     options = {"members": None}
903.     actual = do_autodoc(app, 'module', 'target', options)
904.     assert list(filter(lambda l: 'class::' in l, actual)) == [
905.         '.. py:class:: Class(arg)',
906.     ]
907. 
908.     # ignore-module-all
909.     options = {"members": None,
910.                "ignore-module-all": None}
911.     actual = do_autodoc(app, 'module', 'target', options)
912.     assert list(filter(lambda l: 'class::' in l, actual)) == [
913.         '.. py:class:: Class(arg)',
914.         '.. py:class:: CustomDict',
915.         '.. py:class:: InnerChild()',
916.         '.. py:class:: InstAttCls()',
917.         '.. py:class:: Outer()',
918.         '   .. py:class:: Outer.Inner()',
919.         '.. py:class:: StrRepr'
920.     ]
921. 
922. 
923. @pytest.mark.sphinx('html', testroot='ext-autodoc')
924. def test_autodoc_noindex(app):
925.     options = {"noindex": None}
926.     actual = do_autodoc(app, 'module', 'target', options)
927.     assert list(actual) == [
928.         '',
929.         '.. py:module:: target',
930.         '   :noindex:',
931.         ''
932.     ]
933. 
934.     # TODO: :noindex: should be propagated to children of target item.
935. 
936.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
937.     assert list(actual) == [
938.         '',
939.         '.. py:class:: Base()',
940.         '   :noindex:',
941.         '   :module: target.inheritance',
942.         ''
943.     ]
944. 
945. 
946. @pytest.mark.sphinx('html', testroot='ext-autodoc')
947. def test_autodoc_subclass_of_builtin_class(app):
948.     options = {"members": None}
949.     actual = do_autodoc(app, 'class', 'target.CustomDict', options)
950.     assert list(actual) == [
951.         '',
952.         '.. py:class:: CustomDict',
953.         '   :module: target',
954.         '',
955.         '   Docstring.',
956.         '',
957.     ]
958. 
959. 
960. @pytest.mark.sphinx('html', testroot='ext-autodoc')
961. def test_autodoc_inner_class(app):
962.     options = {"members": None}
963.     actual = do_autodoc(app, 'class', 'target.Outer', options)
964.     assert list(actual) == [
965.         '',
966.         '.. py:class:: Outer()',
967.         '   :module: target',
968.         '',
969.         '   Foo',
970.         '',
971.         '',
972.         '   .. py:class:: Outer.Inner()',
973.         '      :module: target',
974.         '',
975.         '      Foo',
976.         '',
977.         '',
978.         '      .. py:method:: Outer.Inner.meth()',
979.         '         :module: target',
980.         '',
981.         '         Foo',
982.         '',
983.         '',
984.         '   .. py:attribute:: Outer.factory',
985.         '      :module: target',
986.         '',
987.         '      alias of :class:`dict`'
988.     ]
989. 
990.     actual = do_autodoc(app, 'class', 'target.Outer.Inner', options)
991.     assert list(actual) == [
992.         '',
993.         '.. py:class:: Inner()',
994.         '   :module: target.Outer',
995.         '',
996.         '   Foo',
997.         '',
998.         '',
999.         '   .. py:method:: Inner.meth()',
1000.         '      :module: target.Outer',
1001.         '',
1002.         '      Foo',
1003.         '',
1004.     ]
1005. 
1006.     options['show-inheritance'] = None
1007.     actual = do_autodoc(app, 'class', 'target.InnerChild', options)
1008.     assert list(actual) == [
1009.         '',
1010.         '.. py:class:: InnerChild()',
1011.         '   :module: target', '',
1012.         '   Bases: :class:`target.Outer.Inner`',
1013.         '',
1014.         '   InnerChild docstring',
1015.         '',
1016.     ]
1017. 
1018. 
1019. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1020. def test_autodoc_classmethod(app):
1021.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedclassmeth')
1022.     assert list(actual) == [
1023.         '',
1024.         '.. py:method:: Base.inheritedclassmeth()',
1025.         '   :module: target.inheritance',
1026.         '   :classmethod:',
1027.         '',
1028.         '   Inherited class method.',
1029.         '',
1030.     ]
1031. 
1032. 
1033. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1034. def test_autodoc_staticmethod(app):
1035.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedstaticmeth')
1036.     assert list(actual) == [
1037.         '',
1038.         '.. py:method:: Base.inheritedstaticmeth(cls)',
1039.         '   :module: target.inheritance',
1040.         '   :staticmethod:',
1041.         '',
1042.         '   Inherited static method.',
1043.         '',
1044.     ]
1045. 
1046. 
1047. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1048. def test_autodoc_descriptor(app):
1049.     options = {"members": None,
1050.                "undoc-members": None}
1051.     actual = do_autodoc(app, 'class', 'target.descriptor.Class', options)
1052.     assert list(actual) == [
1053.         '',
1054.         '.. py:class:: Class()',
1055.         '   :module: target.descriptor',
1056.         '',
1057.         '',
1058.         '   .. py:attribute:: Class.descr',
1059.         '      :module: target.descriptor',
1060.         '',
1061.         '      Descriptor instance docstring.',
1062.         '',
1063.         '',
1064.         '   .. py:property:: Class.prop',
1065.         '      :module: target.descriptor',
1066.         '',
1067.         '      Property.',
1068.         ''
1069.     ]
1070. 
1071. 
1072. @pytest.mark.skipif(sys.version_info < (3, 8),
1073.                     reason='cached_property is available since python3.8.')
1074. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1075. def test_autodoc_cached_property(app):
1076.     options = {"members": None,
1077.                "undoc-members": None}
1078.     actual = do_autodoc(app, 'class', 'target.cached_property.Foo', options)
1079.     assert list(actual) == [
1080.         '',
1081.         '.. py:class:: Foo()',
1082.         '   :module: target.cached_property',
1083.         '',
1084.         '',
1085.         '   .. py:property:: Foo.prop',
1086.         '      :module: target.cached_property',
1087.         '',
1088.     ]
1089. 
1090. 
1091. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1092. def test_autodoc_member_order(app):
1093.     # case member-order='bysource'
1094.     options = {"members": None,
1095.                'member-order': 'bysource',
1096.                "undoc-members": None,
1097.                'private-members': None}
1098.     actual = do_autodoc(app, 'class', 'target.Class', options)
1099.     assert list(filter(lambda l: '::' in l, actual)) == [
1100.         '.. py:class:: Class(arg)',
1101.         '   .. py:method:: Class.meth()',
1102.         '   .. py:method:: Class.undocmeth()',
1103.         '   .. py:method:: Class.skipmeth()',
1104.         '   .. py:method:: Class.excludemeth()',
1105.         '   .. py:attribute:: Class.skipattr',
1106.         '   .. py:attribute:: Class.attr',
1107.         '   .. py:attribute:: Class.docattr',
1108.         '   .. py:attribute:: Class.udocattr',
1109.         '   .. py:attribute:: Class.mdocattr',
1110.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1111.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1112.         '   .. py:attribute:: Class.inst_attr_inline',
1113.         '   .. py:attribute:: Class.inst_attr_comment',
1114.         '   .. py:attribute:: Class.inst_attr_string',
1115.         '   .. py:attribute:: Class._private_inst_attr'
1116.     ]
1117. 
1118.     # case member-order='groupwise'
1119.     options = {"members": None,
1120.                'member-order': 'groupwise',
1121.                "undoc-members": None,
1122.                'private-members': None}
1123.     actual = do_autodoc(app, 'class', 'target.Class', options)
1124.     assert list(filter(lambda l: '::' in l, actual)) == [
1125.         '.. py:class:: Class(arg)',
1126.         '   .. py:method:: Class.excludemeth()',
1127.         '   .. py:method:: Class.meth()',
1128.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1129.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1130.         '   .. py:method:: Class.skipmeth()',
1131.         '   .. py:method:: Class.undocmeth()',
1132.         '   .. py:attribute:: Class._private_inst_attr',
1133.         '   .. py:attribute:: Class.attr',
1134.         '   .. py:attribute:: Class.docattr',
1135.         '   .. py:attribute:: Class.inst_attr_comment',
1136.         '   .. py:attribute:: Class.inst_attr_inline',
1137.         '   .. py:attribute:: Class.inst_attr_string',
1138.         '   .. py:attribute:: Class.mdocattr',
1139.         '   .. py:attribute:: Class.skipattr',
1140.         '   .. py:attribute:: Class.udocattr'
1141.     ]
1142. 
1143.     # case member-order=None
1144.     options = {"members": None,
1145.                "undoc-members": None,
1146.                'private-members': None}
1147.     actual = do_autodoc(app, 'class', 'target.Class', options)
1148.     assert list(filter(lambda l: '::' in l, actual)) == [
1149.         '.. py:class:: Class(arg)',
1150.         '   .. py:attribute:: Class._private_inst_attr',
1151.         '   .. py:attribute:: Class.attr',
1152.         '   .. py:attribute:: Class.docattr',
1153.         '   .. py:method:: Class.excludemeth()',
1154.         '   .. py:attribute:: Class.inst_attr_comment',
1155.         '   .. py:attribute:: Class.inst_attr_inline',
1156.         '   .. py:attribute:: Class.inst_attr_string',
1157.         '   .. py:attribute:: Class.mdocattr',
1158.         '   .. py:method:: Class.meth()',
1159.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1160.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1161.         '   .. py:attribute:: Class.skipattr',
1162.         '   .. py:method:: Class.skipmeth()',
1163.         '   .. py:attribute:: Class.udocattr',
1164.         '   .. py:method:: Class.undocmeth()'
1165.     ]
1166. 
1167. 
1168. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1169. def test_autodoc_module_member_order(app):
1170.     # case member-order='bysource'
1171.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1172.                'member-order': 'bysource',
1173.                "undoc-members": None}
1174.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1175.     assert list(filter(lambda l: '::' in l, actual)) == [
1176.         '.. py:module:: target.sort_by_all',
1177.         '.. py:function:: baz()',
1178.         '.. py:function:: foo()',
1179.         '.. py:class:: Bar()',
1180.         '.. py:class:: Quux()',
1181.         '.. py:function:: foobar()',
1182.         '.. py:function:: qux()',
1183.     ]
1184. 
1185.     # case member-order='bysource' and ignore-module-all
1186.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1187.                'member-order': 'bysource',
1188.                "undoc-members": None,
1189.                "ignore-module-all": None}
1190.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1191.     assert list(filter(lambda l: '::' in l, actual)) == [
1192.         '.. py:module:: target.sort_by_all',
1193.         '.. py:function:: foo()',
1194.         '.. py:class:: Bar()',
1195.         '.. py:function:: baz()',
1196.         '.. py:function:: qux()',
1197.         '.. py:class:: Quux()',
1198.         '.. py:function:: foobar()',
1199.     ]
1200. 
1201. 
1202. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1203. def test_autodoc_module_scope(app):
1204.     app.env.temp_data['autodoc:module'] = 'target'
1205.     actual = do_autodoc(app, 'attribute', 'Class.mdocattr')
1206.     assert list(actual) == [
1207.         '',
1208.         '.. py:attribute:: Class.mdocattr',
1209.         '   :module: target',
1210.         '   :value: <_io.StringIO object>',
1211.         '',
1212.         '   should be documented as well - süß',
1213.         '',
1214.     ]
1215. 
1216. 
1217. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1218. def test_autodoc_class_scope(app):
1219.     app.env.temp_data['autodoc:module'] = 'target'
1220.     app.env.temp_data['autodoc:class'] = 'Class'
1221.     actual = do_autodoc(app, 'attribute', 'mdocattr')
1222.     assert list(actual) == [
1223.         '',
1224.         '.. py:attribute:: Class.mdocattr',
1225.         '   :module: target',
1226.         '   :value: <_io.StringIO object>',
1227.         '',
1228.         '   should be documented as well - süß',
1229.         '',
1230.     ]
1231. 
1232. 
1233. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1234. def test_class_attributes(app):
1235.     options = {"members": None,
1236.                "undoc-members": None}
1237.     actual = do_autodoc(app, 'class', 'target.AttCls', options)
1238.     assert list(actual) == [
1239.         '',
1240.         '.. py:class:: AttCls()',
1241.         '   :module: target',
1242.         '',
1243.         '',
1244.         '   .. py:attribute:: AttCls.a1',
1245.         '      :module: target',
1246.         '      :value: hello world',
1247.         '',
1248.         '',
1249.         '   .. py:attribute:: AttCls.a2',
1250.         '      :module: target',
1251.         '      :value: None',
1252.         ''
1253.     ]
1254. 
1255. 
1256. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1257. def test_autoclass_instance_attributes(app):
1258.     options = {"members": None}
1259.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1260.     assert list(actual) == [
1261.         '',
1262.         '.. py:class:: InstAttCls()',
1263.         '   :module: target',
1264.         '',
1265.         '   Class with documented class and instance attributes.',
1266.         '',
1267.         '',
1268.         '   .. py:attribute:: InstAttCls.ca1',
1269.         '      :module: target',
1270.         "      :value: 'a'",
1271.         '',
1272.         '      Doc comment for class attribute InstAttCls.ca1.',
1273.         '      It can have multiple lines.',
1274.         '',
1275.         '',
1276.         '   .. py:attribute:: InstAttCls.ca2',
1277.         '      :module: target',
1278.         "      :value: 'b'",
1279.         '',
1280.         '      Doc comment for InstAttCls.ca2. One line only.',
1281.         '',
1282.         '',
1283.         '   .. py:attribute:: InstAttCls.ca3',
1284.         '      :module: target',
1285.         "      :value: 'c'",
1286.         '',
1287.         '      Docstring for class attribute InstAttCls.ca3.',
1288.         '',
1289.         '',
1290.         '   .. py:attribute:: InstAttCls.ia1',
1291.         '      :module: target',
1292.         '',
1293.         '      Doc comment for instance attribute InstAttCls.ia1',
1294.         '',
1295.         '',
1296.         '   .. py:attribute:: InstAttCls.ia2',
1297.         '      :module: target',
1298.         '',
1299.         '      Docstring for instance attribute InstAttCls.ia2.',
1300.         ''
1301.     ]
1302. 
1303.     # pick up arbitrary attributes
1304.     options = {"members": 'ca1,ia1'}
1305.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1306.     assert list(actual) == [
1307.         '',
1308.         '.. py:class:: InstAttCls()',
1309.         '   :module: target',
1310.         '',
1311.         '   Class with documented class and instance attributes.',
1312.         '',
1313.         '',
1314.         '   .. py:attribute:: InstAttCls.ca1',
1315.         '      :module: target',
1316.         "      :value: 'a'",
1317.         '',
1318.         '      Doc comment for class attribute InstAttCls.ca1.',
1319.         '      It can have multiple lines.',
1320.         '',
1321.         '',
1322.         '   .. py:attribute:: InstAttCls.ia1',
1323.         '      :module: target',
1324.         '',
1325.         '      Doc comment for instance attribute InstAttCls.ia1',
1326.         ''
1327.     ]
1328. 
1329. 
1330. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1331. def test_autoattribute_instance_attributes(app):
1332.     actual = do_autodoc(app, 'attribute', 'target.InstAttCls.ia1')
1333.     assert list(actual) == [
1334.         '',
1335.         '.. py:attribute:: InstAttCls.ia1',
1336.         '   :module: target',
1337.         '',
1338.         '   Doc comment for instance attribute InstAttCls.ia1',
1339.         ''
1340.     ]
1341. 
1342. 
1343. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1344. def test_slots(app):
1345.     options = {"members": None,
1346.                "undoc-members": None}
1347.     actual = do_autodoc(app, 'module', 'target.slots', options)
1348.     assert list(actual) == [
1349.         '',
1350.         '.. py:module:: target.slots',
1351.         '',
1352.         '',
1353.         '.. py:class:: Bar()',
1354.         '   :module: target.slots',
1355.         '',
1356.         '   docstring',
1357.         '',
1358.         '',
1359.         '   .. py:attribute:: Bar.attr1',
1360.         '      :module: target.slots',
1361.         '',
1362.         '      docstring of attr1',
1363.         '',
1364.         '',
1365.         '   .. py:attribute:: Bar.attr2',
1366.         '      :module: target.slots',
1367.         '',
1368.         '      docstring of instance attr2',
1369.         '',
1370.         '',
1371.         '   .. py:attribute:: Bar.attr3',
1372.         '      :module: target.slots',
1373.         '',
1374.         '',
1375.         '.. py:class:: Baz()',
1376.         '   :module: target.slots',
1377.         '',
1378.         '   docstring',
1379.         '',
1380.         '',
1381.         '   .. py:attribute:: Baz.attr',
1382.         '      :module: target.slots',
1383.         '',
1384.         '',
1385.         '.. py:class:: Foo()',
1386.         '   :module: target.slots',
1387.         '',
1388.         '   docstring',
1389.         '',
1390.         '',
1391.         '   .. py:attribute:: Foo.attr',
1392.         '      :module: target.slots',
1393.         '',
1394.     ]
1395. 
1396. 
1397. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1398. def test_enum_class(app):
1399.     options = {"members": None}
1400.     actual = do_autodoc(app, 'class', 'target.enums.EnumCls', options)
1401. 
1402.     if sys.version_info < (3, 10):
1403.         sig = '(value)'
1404.     else:
1405.         sig = ('(value, names=None, *, module=None, qualname=None, type=None, start=1, '
1406.                'boundary=None)')
1407. 
1408.     assert list(actual) == [
1409.         '',
1410.         '.. py:class:: EnumCls%s' % sig,
1411.         '   :module: target.enums',
1412.         '',
1413.         '   this is enum class',
1414.         '',
1415.         '',
1416.         '   .. py:method:: EnumCls.say_goodbye()',
1417.         '      :module: target.enums',
1418.         '      :classmethod:',
1419.         '',
1420.         '      a classmethod says good-bye to you.',
1421.         '',
1422.         '',
1423.         '   .. py:method:: EnumCls.say_hello()',
1424.         '      :module: target.enums',
1425.         '',
1426.         '      a method says hello to you.',
1427.         '',
1428.         '',
1429.         '   .. py:attribute:: EnumCls.val1',
1430.         '      :module: target.enums',
1431.         '      :value: 12',
1432.         '',
1433.         '      doc for val1',
1434.         '',
1435.         '',
1436.         '   .. py:attribute:: EnumCls.val2',
1437.         '      :module: target.enums',
1438.         '      :value: 23',
1439.         '',
1440.         '      doc for val2',
1441.         '',
1442.         '',
1443.         '   .. py:attribute:: EnumCls.val3',
1444.         '      :module: target.enums',
1445.         '      :value: 34',
1446.         '',
1447.         '      doc for val3',
1448.         '',
1449.     ]
1450. 
1451.     # checks for an attribute of EnumClass
1452.     actual = do_autodoc(app, 'attribute', 'target.enums.EnumCls.val1')
1453.     assert list(actual) == [
1454.         '',
1455.         '.. py:attribute:: EnumCls.val1',
1456.         '   :module: target.enums',
1457.         '   :value: 12',
1458.         '',
1459.         '   doc for val1',
1460.         ''
1461.     ]
1462. 
1463. 
1464. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1465. def test_descriptor_class(app):
1466.     options = {"members": 'CustomDataDescriptor,CustomDataDescriptor2'}
1467.     actual = do_autodoc(app, 'module', 'target.descriptor', options)
1468.     assert list(actual) == [
1469.         '',
1470.         '.. py:module:: target.descriptor',
1471.         '',
1472.         '',
1473.         '.. py:class:: CustomDataDescriptor(doc)',
1474.         '   :module: target.descriptor',
1475.         '',
1476.         '   Descriptor class docstring.',
1477.         '',
1478.         '',
1479.         '   .. py:method:: CustomDataDescriptor.meth()',
1480.         '      :module: target.descriptor',
1481.         '',
1482.         '      Function.',
1483.         '',
1484.         '',
1485.         '.. py:class:: CustomDataDescriptor2(doc)',
1486.         '   :module: target.descriptor',
1487.         '',
1488.         '   Descriptor class with custom metaclass docstring.',
1489.         '',
1490.     ]
1491. 
1492. 
1493. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1494. def test_automethod_for_builtin(app):
1495.     actual = do_autodoc(app, 'method', 'builtins.int.__add__')
1496.     assert list(actual) == [
1497.         '',
1498.         '.. py:method:: int.__add__(value, /)',
1499.         '   :module: builtins',
1500.         '',


File: tests/test_util_inspect.py
Line number range: 1 - 500
Content:
1. """
2.     test_util_inspect
3.     ~~~~~~~~~~~~~~~
4. 
5.     Tests util.inspect functions.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import ast
12. import datetime
13. import functools
14. import sys
15. import types
16. from inspect import Parameter
17. 
18. import _testcapi
19. import pytest
20. 
21. from sphinx.util import inspect
22. from sphinx.util.inspect import TypeAliasNamespace, stringify_signature
23. 
24. 
25. def test_TypeAliasNamespace():
26.     import logging.config
27.     type_alias = TypeAliasNamespace({'logging.Filter': 'MyFilter',
28.                                      'logging.Handler': 'MyHandler',
29.                                      'logging.handlers.SyslogHandler': 'MySyslogHandler'})
30. 
31.     assert type_alias['logging'].Filter == 'MyFilter'
32.     assert type_alias['logging'].Handler == 'MyHandler'
33.     assert type_alias['logging'].handlers.SyslogHandler == 'MySyslogHandler'
34.     assert type_alias['logging'].Logger == logging.Logger
35.     assert type_alias['logging'].config == logging.config
36. 
37.     with pytest.raises(KeyError):
38.         assert type_alias['log']
39. 
40.     with pytest.raises(KeyError):
41.         assert type_alias['unknown']
42. 
43. 
44. def test_signature():
45.     # literals
46.     with pytest.raises(TypeError):
47.         inspect.signature(1)
48. 
49.     with pytest.raises(TypeError):
50.         inspect.signature('')
51. 
52.     # builtins are supported on a case-by-case basis, depending on whether
53.     # they define __text_signature__
54.     if getattr(list, '__text_signature__', None):
55.         sig = inspect.stringify_signature(inspect.signature(list))
56.         assert sig == '(iterable=(), /)'
57.     else:
58.         with pytest.raises(ValueError):
59.             inspect.signature(list)
60. 
61.     # normal function
62.     def func(a, b, c=1, d=2, *e, **f):
63.         pass
64. 
65.     sig = inspect.stringify_signature(inspect.signature(func))
66.     assert sig == '(a, b, c=1, d=2, *e, **f)'
67. 
68. 
69. def test_signature_partial():
70.     def fun(a, b, c=1, d=2):
71.         pass
72.     p = functools.partial(fun, 10, c=11)
73. 
74.     sig = inspect.signature(p)
75.     assert stringify_signature(sig) == '(b, *, c=11, d=2)'
76. 
77. 
78. def test_signature_methods():
79.     class Foo:
80.         def meth1(self, arg1, **kwargs):
81.             pass
82. 
83.         @classmethod
84.         def meth2(cls, arg1, *args, **kwargs):
85.             pass
86. 
87.         @staticmethod
88.         def meth3(arg1, *args, **kwargs):
89.             pass
90. 
91.     @functools.wraps(Foo().meth1)
92.     def wrapped_bound_method(*args, **kwargs):
93.         pass
94. 
95.     # unbound method
96.     sig = inspect.signature(Foo.meth1)
97.     assert stringify_signature(sig) == '(self, arg1, **kwargs)'
98. 
99.     sig = inspect.signature(Foo.meth1, bound_method=True)
100.     assert stringify_signature(sig) == '(arg1, **kwargs)'
101. 
102.     # bound method
103.     sig = inspect.signature(Foo().meth1)
104.     assert stringify_signature(sig) == '(arg1, **kwargs)'
105. 
106.     # class method
107.     sig = inspect.signature(Foo.meth2)
108.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
109. 
110.     sig = inspect.signature(Foo().meth2)
111.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
112. 
113.     # static method
114.     sig = inspect.signature(Foo.meth3)
115.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
116. 
117.     sig = inspect.signature(Foo().meth3)
118.     assert stringify_signature(sig) == '(arg1, *args, **kwargs)'
119. 
120.     # wrapped bound method
121.     sig = inspect.signature(wrapped_bound_method)
122.     assert stringify_signature(sig) == '(arg1, **kwargs)'
123. 
124. 
125. def test_signature_partialmethod():
126.     from functools import partialmethod
127. 
128.     class Foo:
129.         def meth1(self, arg1, arg2, arg3=None, arg4=None):
130.             pass
131. 
132.         def meth2(self, arg1, arg2):
133.             pass
134. 
135.         foo = partialmethod(meth1, 1, 2)
136.         bar = partialmethod(meth1, 1, arg3=3)
137.         baz = partialmethod(meth2, 1, 2)
138. 
139.     subject = Foo()
140.     sig = inspect.signature(subject.foo)
141.     assert stringify_signature(sig) == '(arg3=None, arg4=None)'
142. 
143.     sig = inspect.signature(subject.bar)
144.     assert stringify_signature(sig) == '(arg2, *, arg3=3, arg4=None)'
145. 
146.     sig = inspect.signature(subject.baz)
147.     assert stringify_signature(sig) == '()'
148. 
149. 
150. def test_signature_annotations():
151.     from .typing_test_data import (Node, f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10, f11, f12,
152.                                    f13, f14, f15, f16, f17, f18, f19, f20, f21)
153. 
154.     # Class annotations
155.     sig = inspect.signature(f0)
156.     assert stringify_signature(sig) == '(x: int, y: numbers.Integral) -> None'
157. 
158.     # Generic types with concrete parameters
159.     sig = inspect.signature(f1)
160.     assert stringify_signature(sig) == '(x: List[int]) -> List[int]'
161. 
162.     # TypeVars and generic types with TypeVars
163.     sig = inspect.signature(f2)
164.     if sys.version_info < (3, 7):
165.         assert stringify_signature(sig) == '(x: List[T], y: List[T_co], z: T) -> List[T_contra]'
166.     else:
167.         assert stringify_signature(sig) == ('(x: List[tests.typing_test_data.T],'
168.                                             ' y: List[tests.typing_test_data.T_co],'
169.                                             ' z: tests.typing_test_data.T'
170.                                             ') -> List[tests.typing_test_data.T_contra]')
171. 
172.     # Union types
173.     sig = inspect.signature(f3)
174.     assert stringify_signature(sig) == '(x: Union[str, numbers.Integral]) -> None'
175. 
176.     # Quoted annotations
177.     sig = inspect.signature(f4)
178.     assert stringify_signature(sig) == '(x: str, y: str) -> None'
179. 
180.     # Keyword-only arguments
181.     sig = inspect.signature(f5)
182.     assert stringify_signature(sig) == '(x: int, *, y: str, z: str) -> None'
183. 
184.     # Keyword-only arguments with varargs
185.     sig = inspect.signature(f6)
186.     assert stringify_signature(sig) == '(x: int, *args, y: str, z: str) -> None'
187. 
188.     # Space around '=' for defaults
189.     sig = inspect.signature(f7)
190.     assert stringify_signature(sig) == '(x: Optional[int] = None, y: dict = {}) -> None'
191. 
192.     # Callable types
193.     sig = inspect.signature(f8)
194.     assert stringify_signature(sig) == '(x: Callable[[int, str], int]) -> None'
195. 
196.     sig = inspect.signature(f9)
197.     assert stringify_signature(sig) == '(x: Callable) -> None'
198. 
199.     # Tuple types
200.     sig = inspect.signature(f10)
201.     assert stringify_signature(sig) == '(x: Tuple[int, str], y: Tuple[int, ...]) -> None'
202. 
203.     # Instance annotations
204.     sig = inspect.signature(f11)
205.     assert stringify_signature(sig) == '(x: CustomAnnotation, y: 123) -> None'
206. 
207.     # tuple with more than two items
208.     sig = inspect.signature(f12)
209.     assert stringify_signature(sig) == '() -> Tuple[int, str, int]'
210. 
211.     # optional
212.     sig = inspect.signature(f13)
213.     assert stringify_signature(sig) == '() -> Optional[str]'
214. 
215.     # optional union
216.     sig = inspect.signature(f20)
217.     if sys.version_info < (3, 7):
218.         assert stringify_signature(sig) in ('() -> Optional[Union[int, str]]',
219.                                             '() -> Optional[Union[str, int]]')
220.     else:
221.         assert stringify_signature(sig) == '() -> Optional[Union[int, str]]'
222. 
223.     # Any
224.     sig = inspect.signature(f14)
225.     assert stringify_signature(sig) == '() -> Any'
226. 
227.     # ForwardRef
228.     sig = inspect.signature(f15)
229.     assert stringify_signature(sig) == '(x: Unknown, y: int) -> Any'
230. 
231.     # keyword only arguments (1)
232.     sig = inspect.signature(f16)
233.     assert stringify_signature(sig) == '(arg1, arg2, *, arg3=None, arg4=None)'
234. 
235.     # keyword only arguments (2)
236.     sig = inspect.signature(f17)
237.     assert stringify_signature(sig) == '(*, arg3, arg4)'
238. 
239.     sig = inspect.signature(f18)
240.     assert stringify_signature(sig) == '(self, arg1: Union[int, Tuple] = 10) -> List[Dict]'
241. 
242.     # annotations for variadic and keyword parameters
243.     sig = inspect.signature(f19)
244.     assert stringify_signature(sig) == '(*args: int, **kwargs: str)'
245. 
246.     # default value is inspect.Signature.empty
247.     sig = inspect.signature(f21)
248.     assert stringify_signature(sig) == "(arg1='whatever', arg2)"
249. 
250.     # type hints by string
251.     sig = inspect.signature(Node.children)
252.     assert stringify_signature(sig) == '(self) -> List[tests.typing_test_data.Node]'
253. 
254.     sig = inspect.signature(Node.__init__)
255.     assert stringify_signature(sig) == '(self, parent: Optional[tests.typing_test_data.Node]) -> None'
256. 
257.     # show_annotation is False
258.     sig = inspect.signature(f7)
259.     assert stringify_signature(sig, show_annotation=False) == '(x=None, y={})'
260. 
261.     # show_return_annotation is False
262.     sig = inspect.signature(f7)
263.     assert stringify_signature(sig, show_return_annotation=False) == '(x: Optional[int] = None, y: dict = {})'
264. 
265. 
266. @pytest.mark.skipif(sys.version_info < (3, 8), reason='python 3.8+ is required.')
267. @pytest.mark.sphinx(testroot='ext-autodoc')
268. def test_signature_annotations_py38(app):
269.     from target.pep570 import bar, baz, foo, qux
270. 
271.     # case: separator at head
272.     sig = inspect.signature(foo)
273.     assert stringify_signature(sig) == '(*, a, b)'
274. 
275.     # case: separator in the middle
276.     sig = inspect.signature(bar)
277.     assert stringify_signature(sig) == '(a, b, /, c, d)'
278. 
279.     sig = inspect.signature(baz)
280.     assert stringify_signature(sig) == '(a, /, *, b)'
281. 
282.     # case: separator at tail
283.     sig = inspect.signature(qux)
284.     assert stringify_signature(sig) == '(a, b, /)'
285. 
286. 
287. def test_signature_from_str_basic():
288.     signature = '(a, b, *args, c=0, d="blah", **kwargs)'
289.     sig = inspect.signature_from_str(signature)
290.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
291.     assert sig.parameters['a'].name == 'a'
292.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
293.     assert sig.parameters['a'].default == Parameter.empty
294.     assert sig.parameters['a'].annotation == Parameter.empty
295.     assert sig.parameters['b'].name == 'b'
296.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
297.     assert sig.parameters['b'].default == Parameter.empty
298.     assert sig.parameters['b'].annotation == Parameter.empty
299.     assert sig.parameters['args'].name == 'args'
300.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
301.     assert sig.parameters['args'].default == Parameter.empty
302.     assert sig.parameters['args'].annotation == Parameter.empty
303.     assert sig.parameters['c'].name == 'c'
304.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
305.     assert sig.parameters['c'].default == '0'
306.     assert sig.parameters['c'].annotation == Parameter.empty
307.     assert sig.parameters['d'].name == 'd'
308.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
309.     assert sig.parameters['d'].default == "'blah'"
310.     assert sig.parameters['d'].annotation == Parameter.empty
311.     assert sig.parameters['kwargs'].name == 'kwargs'
312.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
313.     assert sig.parameters['kwargs'].default == Parameter.empty
314.     assert sig.parameters['kwargs'].annotation == Parameter.empty
315.     assert sig.return_annotation == Parameter.empty
316. 
317. 
318. def test_signature_from_str_default_values():
319.     signature = ('(a=0, b=0.0, c="str", d=b"bytes", e=..., f=True, '
320.                  'g=[1, 2, 3], h={"a": 1}, i={1, 2, 3}, '
321.                  'j=lambda x, y: None, k=None, l=object(), m=foo.bar.CONSTANT)')
322.     sig = inspect.signature_from_str(signature)
323.     assert sig.parameters['a'].default == '0'
324.     assert sig.parameters['b'].default == '0.0'
325.     assert sig.parameters['c'].default == "'str'"
326.     assert sig.parameters['d'].default == "b'bytes'"
327.     assert sig.parameters['e'].default == '...'
328.     assert sig.parameters['f'].default == 'True'
329.     assert sig.parameters['g'].default == '[1, 2, 3]'
330.     assert sig.parameters['h'].default == "{'a': 1}"
331.     assert sig.parameters['i'].default == '{1, 2, 3}'
332.     assert sig.parameters['j'].default == 'lambda x, y: ...'
333.     assert sig.parameters['k'].default == 'None'
334.     assert sig.parameters['l'].default == 'object()'
335.     assert sig.parameters['m'].default == 'foo.bar.CONSTANT'
336. 
337. 
338. def test_signature_from_str_annotations():
339.     signature = '(a: int, *args: bytes, b: str = "blah", **kwargs: float) -> None'
340.     sig = inspect.signature_from_str(signature)
341.     assert list(sig.parameters.keys()) == ['a', 'args', 'b', 'kwargs']
342.     assert sig.parameters['a'].annotation == "int"
343.     assert sig.parameters['args'].annotation == "bytes"
344.     assert sig.parameters['b'].annotation == "str"
345.     assert sig.parameters['kwargs'].annotation == "float"
346.     assert sig.return_annotation == 'None'
347. 
348. 
349. def test_signature_from_str_complex_annotations():
350.     sig = inspect.signature_from_str('() -> Tuple[str, int, ...]')
351.     assert sig.return_annotation == 'Tuple[str, int, ...]'
352. 
353.     sig = inspect.signature_from_str('() -> Callable[[int, int], int]')
354.     assert sig.return_annotation == 'Callable[[int, int], int]'
355. 
356. 
357. def test_signature_from_str_kwonly_args():
358.     sig = inspect.signature_from_str('(a, *, b)')
359.     assert list(sig.parameters.keys()) == ['a', 'b']
360.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
361.     assert sig.parameters['a'].default == Parameter.empty
362.     assert sig.parameters['b'].kind == Parameter.KEYWORD_ONLY
363.     assert sig.parameters['b'].default == Parameter.empty
364. 
365. 
366. @pytest.mark.skipif(sys.version_info < (3, 8),
367.                     reason='python-3.8 or above is required')
368. def test_signature_from_str_positionaly_only_args():
369.     sig = inspect.signature_from_str('(a, b=0, /, c=1)')
370.     assert list(sig.parameters.keys()) == ['a', 'b', 'c']
371.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_ONLY
372.     assert sig.parameters['a'].default == Parameter.empty
373.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_ONLY
374.     assert sig.parameters['b'].default == '0'
375.     assert sig.parameters['c'].kind == Parameter.POSITIONAL_OR_KEYWORD
376.     assert sig.parameters['c'].default == '1'
377. 
378. 
379. def test_signature_from_str_invalid():
380.     with pytest.raises(SyntaxError):
381.         inspect.signature_from_str('')
382. 
383. 
384. def test_signature_from_ast():
385.     signature = 'def func(a, b, *args, c=0, d="blah", **kwargs): pass'
386.     tree = ast.parse(signature)
387.     sig = inspect.signature_from_ast(tree.body[0])
388.     assert list(sig.parameters.keys()) == ['a', 'b', 'args', 'c', 'd', 'kwargs']
389.     assert sig.parameters['a'].name == 'a'
390.     assert sig.parameters['a'].kind == Parameter.POSITIONAL_OR_KEYWORD
391.     assert sig.parameters['a'].default == Parameter.empty
392.     assert sig.parameters['a'].annotation == Parameter.empty
393.     assert sig.parameters['b'].name == 'b'
394.     assert sig.parameters['b'].kind == Parameter.POSITIONAL_OR_KEYWORD
395.     assert sig.parameters['b'].default == Parameter.empty
396.     assert sig.parameters['b'].annotation == Parameter.empty
397.     assert sig.parameters['args'].name == 'args'
398.     assert sig.parameters['args'].kind == Parameter.VAR_POSITIONAL
399.     assert sig.parameters['args'].default == Parameter.empty
400.     assert sig.parameters['args'].annotation == Parameter.empty
401.     assert sig.parameters['c'].name == 'c'
402.     assert sig.parameters['c'].kind == Parameter.KEYWORD_ONLY
403.     assert sig.parameters['c'].default == '0'
404.     assert sig.parameters['c'].annotation == Parameter.empty
405.     assert sig.parameters['d'].name == 'd'
406.     assert sig.parameters['d'].kind == Parameter.KEYWORD_ONLY
407.     assert sig.parameters['d'].default == "'blah'"
408.     assert sig.parameters['d'].annotation == Parameter.empty
409.     assert sig.parameters['kwargs'].name == 'kwargs'
410.     assert sig.parameters['kwargs'].kind == Parameter.VAR_KEYWORD
411.     assert sig.parameters['kwargs'].default == Parameter.empty
412.     assert sig.parameters['kwargs'].annotation == Parameter.empty
413.     assert sig.return_annotation == Parameter.empty
414. 
415. 
416. def test_safe_getattr_with_default():
417.     class Foo:
418.         def __getattr__(self, item):
419.             raise Exception
420. 
421.     obj = Foo()
422. 
423.     result = inspect.safe_getattr(obj, 'bar', 'baz')
424. 
425.     assert result == 'baz'
426. 
427. 
428. def test_safe_getattr_with_exception():
429.     class Foo:
430.         def __getattr__(self, item):
431.             raise Exception
432. 
433.     obj = Foo()
434. 
435.     try:
436.         inspect.safe_getattr(obj, 'bar')
437.     except AttributeError as exc:
438.         assert exc.args[0] == 'bar'
439.     else:
440.         pytest.fail('AttributeError not raised')
441. 
442. 
443. def test_safe_getattr_with_property_exception():
444.     class Foo:
445.         @property
446.         def bar(self):
447.             raise Exception
448. 
449.     obj = Foo()
450. 
451.     try:
452.         inspect.safe_getattr(obj, 'bar')
453.     except AttributeError as exc:
454.         assert exc.args[0] == 'bar'
455.     else:
456.         pytest.fail('AttributeError not raised')
457. 
458. 
459. def test_safe_getattr_with___dict___override():
460.     class Foo:
461.         @property
462.         def __dict__(self):
463.             raise Exception
464. 
465.     obj = Foo()
466. 
467.     try:
468.         inspect.safe_getattr(obj, 'bar')
469.     except AttributeError as exc:
470.         assert exc.args[0] == 'bar'
471.     else:
472.         pytest.fail('AttributeError not raised')
473. 
474. 
475. def test_dictionary_sorting():
476.     dictionary = {"c": 3, "a": 1, "d": 2, "b": 4}
477.     description = inspect.object_description(dictionary)
478.     assert description == "{'a': 1, 'b': 4, 'c': 3, 'd': 2}"
479. 
480. 
481. def test_set_sorting():
482.     set_ = set("gfedcba")
483.     description = inspect.object_description(set_)
484.     assert description == "{'a', 'b', 'c', 'd', 'e', 'f', 'g'}"
485. 
486. 
487. def test_set_sorting_fallback():
488.     set_ = {None, 1}
489.     description = inspect.object_description(set_)
490.     assert description in ("{1, None}", "{None, 1}")
491. 
492. 
493. def test_frozenset_sorting():
494.     frozenset_ = frozenset("gfedcba")
495.     description = inspect.object_description(frozenset_)
496.     assert description == "frozenset({'a', 'b', 'c', 'd', 'e', 'f', 'g'})"
497. 
498. 
499. def test_frozenset_sorting_fallback():
500.     frozenset_ = frozenset((None, 1))


File: tests/typing_test_data.py
Line number range: 1 - 113
Content:
1. from inspect import Signature
2. from numbers import Integral
3. from typing import Any, Callable, Dict, List, Optional, Tuple, TypeVar, Union
4. 
5. 
6. def f0(x: int, y: Integral) -> None:
7.     pass
8. 
9. 
10. def f1(x: List[int]) -> List[int]:
11.     pass
12. 
13. 
14. T = TypeVar('T')
15. T_co = TypeVar('T_co', covariant=True)
16. T_contra = TypeVar('T_contra', contravariant=True)
17. 
18. 
19. def f2(x: List[T], y: List[T_co], z: T) -> List[T_contra]:
20.     pass
21. 
22. 
23. def f3(x: Union[str, Integral]) -> None:
24.     pass
25. 
26. 
27. MyStr = str
28. 
29. 
30. def f4(x: 'MyStr', y: MyStr) -> None:
31.     pass
32. 
33. 
34. def f5(x: int, *, y: str, z: str) -> None:
35.     pass
36. 
37. 
38. def f6(x: int, *args, y: str, z: str) -> None:
39.     pass
40. 
41. 
42. def f7(x: int = None, y: dict = {}) -> None:
43.     pass
44. 
45. 
46. def f8(x: Callable[[int, str], int]) -> None:
47.     # See https://github.com/ambv/typehinting/issues/149 for Callable[..., int]
48.     pass
49. 
50. 
51. def f9(x: Callable) -> None:
52.     pass
53. 
54. 
55. def f10(x: Tuple[int, str], y: Tuple[int, ...]) -> None:
56.     pass
57. 
58. 
59. class CustomAnnotation:
60.     def __repr__(self):
61.         return 'CustomAnnotation'
62. 
63. 
64. def f11(x: CustomAnnotation(), y: 123) -> None:
65.     pass
66. 
67. 
68. def f12() -> Tuple[int, str, int]:
69.     pass
70. 
71. 
72. def f13() -> Optional[str]:
73.     pass
74. 
75. 
76. def f14() -> Any:
77.     pass
78. 
79. 
80. def f15(x: "Unknown", y: "int") -> Any:  # type: ignore # NOQA
81.     pass
82. 
83. 
84. def f16(arg1, arg2, *, arg3=None, arg4=None):
85.     pass
86. 
87. 
88. def f17(*, arg3, arg4):
89.     pass
90. 
91. 
92. def f18(self, arg1: Union[int, Tuple] = 10) -> List[Dict]:
93.     pass
94. 
95. 
96. def f19(*args: int, **kwargs: str):
97.     pass
98. 
99. 
100. def f20() -> Optional[Union[int, str]]:
101.     pass
102. 
103. 
104. def f21(arg1='whatever', arg2=Signature.empty):
105.     pass
106. 
107. 
108. class Node:
109.     def __init__(self, parent: Optional['Node']) -> None:
110.         pass
111. 
112.     def children(self) -> List['Node']:
113.         pass

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 03:27:48,928 - thread-135670915925696.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have analyzed the provided context and found three relevant test cases that are similar to the user's bug report. The context contains all the necessary code and dependencies to construct the complete test cases. Therefore, I do not need any additional information.\n\n1.  **`tests.test_util_inspect.py::test_dictionary_sorting`**: This test directly examines `object_description` for dictionaries, which is the function the user's patch modifies. It is relevant because it shows how complex types are expected to be stringified, which is analogous to the issue with enums.\n2.  **`tests.test_util_inspect.py::test_signature_annotations`**: This test, particularly when using the `f7` function from `typing_test_data.py`, validates signature stringification (`stringify_signature`) with a dictionary as a default argument. Since `stringify_signature` uses `object_description` for default values, this test is a good proxy for the user's issue.\n3.  **`tests.test_ext_autodoc.py::test_enum_class`**: This test verifies how `autodoc` processes and documents an `Enum` class and its members. Although it doesn't cover enums as default parameters, it is the most relevant existing test for `autodoc`'s general handling of enums." query='' extra_requirements='' purpose=''
2025-12-21 03:27:48,929 - thread-135670915925696.prometheus_context_collector - INFO - Successfully retrieved 4 context snippets
