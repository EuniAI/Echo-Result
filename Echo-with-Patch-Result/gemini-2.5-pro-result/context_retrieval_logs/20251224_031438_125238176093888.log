2025-12-24 03:14:38,340 - thread-125238176093888.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-24 03:14:38,422 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22567-IT.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   ├── 22691-JMK.rst
|   |   |   |   ├── 22745-JMK.rst
|   |   |   |   ├── 23031-AL.rst
|   |   |   |   ├── 23170-JMK.rst
|   |   |   |   ├── 23188-JMK.rst
|   |   |   |   └── 23270-AL.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21584-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22167-EP.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22298-GL.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   ├── 22883-AL.rst
|   |   |   |   ├── 22885-AL.rst
|   |   |   |   ├── 23014-OG.rst
|   |   |   |   ├── 23045-OG.rst
|   |   |   |   ├── 23081-OG.rst
|   |   |   |   ├── 23166-ES.rst
|   |   |   |   ├── 23190-OG.rst
|   |   |   |   ├── 23232-TH.rst
|   |   |   |   ├── 23289-AL.rst
|   |   |   |   ├── 23302-TH.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       ├── 22738-JL.rst
|   |   |       ├── 22886-OG.rst
|   |   |       ├── 22952-TH.rst
|   |   |       ├── 23076-GL.rst
|   |   |       ├── 23077-GL.rst
|   |   |       ├── 23078-GL.rst
|   |   |       ├── 23079-GL.rst
|   |   |       ├── 23093-GL.rst
|   |   |       └── 23237-AL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   └── api_changes_3.5.2.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── rename_ncol_keyword_in_legend.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   ├── striped_lines.rst
|       |   ├── url_active_areas_rotate.rst
|       |   ├── use_contourpy.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   └── whats_new_3.5.2.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 03:15:04,385 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug report is centered around the behavior of `matplotlib.pyplot` functions (`figure`, `get_backend`, `rc_context`) and their effect on the global figure manager (`Gcf`). The most relevant tests for this behavior are likely located in the test file for the `pyplot` module itself. Therefore, I need to examine `lib/matplotlib/tests/test_pyplot.py` to find test cases that cover figure creation, `rc_context` usage, and backend interactions." query='Please provide the full content of the file `lib/matplotlib/tests/test_pyplot.py`.' extra_requirements='' purpose="I need to analyze this file to find existing test cases that are relevant to the user's reported bug concerning `rc_context` and figure management in `pyplot`."
2025-12-24 03:15:04,386 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_pyplot.py`.
2025-12-24 03:15:04,386 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 03:15:04,387 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 03:15:04,387 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 03:15:04,388 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `lib/matplotlib/tests/test_pyplot.py`.
Purpose: I need to analyze this file to find existing test cases that are relevant to the user's reported bug concerning `rc_context` and figure management in `pyplot`.
2025-12-24 03:15:07,027 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the full content of the file `lib/matplotlib/tests/test_pyplot.py`. This will allow me to analyze the existing test cases to identify any relevant to the user's bug report regarding `rc_context` and figure management in `pyplot`." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_pyplot.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2140, 'candidates_token_count': 81, 'total_token_count': 2312, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2140}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 81}], 'thoughts_token_count': 91, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11287678612603082, 'model_name': 'gemini-2.5-pro'} id='run--6ae7ce37-91ab-43e1-9b52-f94c0e523c14-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_pyplot.py'}, 'id': 'fe50e5b2-279c-478c-8c39-3770b34f7eea', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2140, 'output_tokens': 81, 'total_tokens': 2312, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 91}}
2025-12-24 03:15:09,918 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the contents of `lib/matplotlib/tests/test_pyplot.py` to understand the existing test structure. Now, I will search within this file for occurrences of `rc_context` to locate relevant test cases. This will help me understand how `rc_context` is currently tested and how to address the user's bug report." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_pyplot.py", "text": "rc_context"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 7566, 'candidates_token_count': 110, 'total_token_count': 7735, 'cached_content_token_count': 1803, 'prompt_tokens_details': [{'modality': 1, 'token_count': 7566}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1803}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 110}], 'thoughts_token_count': 59}, 'finish_reason': 'STOP', 'avg_logprobs': -0.0828797080300071, 'model_name': 'gemini-2.5-pro'} id='run--e841856f-b533-4da9-994f-7cae09b6e43d-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_pyplot.py', 'text': 'rc_context'}, 'id': 'bf43b6e4-99c9-44a3-8afb-cac382247632', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7566, 'output_tokens': 110, 'total_tokens': 7735, 'input_token_details': {'cache_read': 1803}, 'output_token_details': {'reasoning': 59}}
2025-12-24 03:15:17,652 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I was unable to find any occurrences of `rc_context` within the `lib/matplotlib/tests/test_pyplot.py` file. To broaden the search, I will now look for any file in the codebase that contains the text `rc_context`. This will help determine where `rc_context` is used and how it is tested throughout the project.' additional_kwargs={'function_call': {'name': 'find_file_node_with_basename', 'arguments': '{"basename": "rc_context"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 7708, 'candidates_token_count': 88, 'total_token_count': 8306, 'cached_content_token_count': 7200, 'prompt_tokens_details': [{'modality': 1, 'token_count': 7708}], 'cache_tokens_details': [{'modality': 1, 'token_count': 7200}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 88}], 'thoughts_token_count': 510}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0791195089166814, 'model_name': 'gemini-2.5-pro'} id='run--1a78bea2-d455-49be-ac11-b40770c891cc-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'rc_context'}, 'id': '1a700e03-54a8-4b2c-af77-a2ebbc6a5c94', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7708, 'output_tokens': 88, 'total_tokens': 8306, 'input_token_details': {'cache_read': 7200}, 'output_token_details': {'reasoning': 510}}
2025-12-24 03:15:24,855 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have been unable to find any direct references to `rc_context` in the files I\'ve examined so far. To continue my investigation, I will now search for the text "rc_context" within any text-based files in the project, such as documentation or comments. This will help me find where `rc_context` is discussed or explained, which can provide clues about its usage and location in the codebase.' additional_kwargs={'function_call': {'name': 'find_text_node_with_text', 'arguments': '{"text": "rc_context"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 7818, 'candidates_token_count': 100, 'total_token_count': 8456, 'cached_content_token_count': 7187, 'prompt_tokens_details': [{'modality': 1, 'token_count': 7818}], 'cache_tokens_details': [{'modality': 1, 'token_count': 7187}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 100}], 'thoughts_token_count': 538}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7494960784912109, 'model_name': 'gemini-2.5-pro'} id='run--d5a9cba3-2425-43e3-b7cd-c7437e7d85d8-0' tool_calls=[{'name': 'find_text_node_with_text', 'args': {'text': 'rc_context'}, 'id': 'd8a2cacf-ee99-4cc4-9559-2078ff01d6c1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7818, 'output_tokens': 100, 'total_tokens': 8456, 'input_token_details': {'cache_read': 7187}, 'output_token_details': {'reasoning': 538}}
2025-12-24 03:15:28,343 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have found mentions of `rc_context` in the documentation, indicating it can be used as a decorator. To understand its implementation, I will now search the entire codebase for the definition of `rc_context` as a function or class. This will allow me to analyze the source code and understand its behavior.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_type_in_file_with_basename', 'arguments': '{"type": "function_definition", "basename": "rc_context"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 15845, 'candidates_token_count': 89, 'total_token_count': 16071, 'cached_content_token_count': 7580, 'prompt_tokens_details': [{'modality': 1, 'token_count': 15845}], 'cache_tokens_details': [{'modality': 1, 'token_count': 7580}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 89}], 'thoughts_token_count': 137}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2674592693200272, 'model_name': 'gemini-2.5-pro'} id='run--de0bd3d3-25e4-4d75-8486-ff859018bdc6-0' tool_calls=[{'name': 'find_ast_node_with_type_in_file_with_basename', 'args': {'type': 'function_definition', 'basename': 'rc_context'}, 'id': '5c2a2442-37c5-49d2-9f5d-214dea09696d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15845, 'output_tokens': 89, 'total_tokens': 16071, 'input_token_details': {'cache_read': 7580}, 'output_token_details': {'reasoning': 137}}
2025-12-24 03:15:34,030 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have been unable to locate the source code for `rc_context` by searching for its function definition directly. Since the documentation suggests it's part of the main `matplotlib` module, I will now search for a file named `matplotlib.py` to see if the definition is located there. This will help me determine if `rc_context` is a standalone function or part of a larger class within the primary module." additional_kwargs={'function_call': {'name': 'find_file_node_with_basename', 'arguments': '{"basename": "matplotlib.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 15964, 'candidates_token_count': 100, 'total_token_count': 16424, 'cached_content_token_count': 15138, 'prompt_tokens_details': [{'modality': 1, 'token_count': 15964}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15138}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 100}], 'thoughts_token_count': 360}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6489732360839844, 'model_name': 'gemini-2.5-pro'} id='run--676dea1c-d96a-428e-94b4-38d9fb7a6dc2-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'matplotlib.py'}, 'id': 'f9d42aff-04b8-4890-89a2-17da78fa77e2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15964, 'output_tokens': 100, 'total_tokens': 16424, 'input_token_details': {'cache_read': 15138}, 'output_token_details': {'reasoning': 360}}
2025-12-24 03:15:36,163 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have been unable to find a file named `matplotlib.py`, which suggests that `rc_context` is not defined in a file with that name. Since the documentation indicates that `rc_context` is a core part of the library, I will broaden my search to look for `rc_context` within any file in the `lib/matplotlib` directory. This will help me locate the source code and understand its implementation.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib", "text": "rc_context"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16086, 'candidates_token_count': 117, 'total_token_count': 16203, 'cached_content_token_count': 15119, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16086}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15119}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 117}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1959723611163278, 'model_name': 'gemini-2.5-pro'} id='run--bca31d63-e9e5-4928-8728-1569596b5e98-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib', 'text': 'rc_context'}, 'id': '82f81c63-b3a5-4949-9032-edc485b866ca', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16086, 'output_tokens': 117, 'total_tokens': 16203, 'input_token_details': {'cache_read': 15119}}
2025-12-24 03:15:38,849 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I am encountering some technical difficulties with the search tools. As an alternative, I will examine the `__init__.py` file within the `lib/matplotlib` directory to understand the package's structure and hopefully locate the definition of `rc_context`." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/__init__.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16241, 'candidates_token_count': 73, 'total_token_count': 16366, 'cached_content_token_count': 15100, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16241}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15100}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 73}], 'thoughts_token_count': 52}, 'finish_reason': 'STOP', 'avg_logprobs': -0.19701884544059023, 'model_name': 'gemini-2.5-pro'} id='run--b05a955d-75e1-4f32-be99-af6c8425b381-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/__init__.py'}, 'id': 'b9483dd3-6d67-4271-aa84-cca63fcc8985', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16241, 'output_tokens': 73, 'total_tokens': 16366, 'input_token_details': {'cache_read': 15100}, 'output_token_details': {'reasoning': 52}}
2025-12-24 03:15:41,815 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have examined the `__init__.py` file in `lib/matplotlib`, but `rc_context` is not defined there. I did notice an import for `rcsetup`, which seems like a promising place to find the definition. I will now inspect the `rcsetup.py` file to see if it contains the `rc_context` implementation.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/rcsetup.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 23312, 'candidates_token_count': 96, 'total_token_count': 23473, 'cached_content_token_count': 15323, 'prompt_tokens_details': [{'modality': 1, 'token_count': 23312}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15323}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 96}], 'thoughts_token_count': 65}, 'finish_reason': 'STOP', 'avg_logprobs': -0.21271149317423502, 'model_name': 'gemini-2.5-pro'} id='run--595ee296-1dc5-4f5f-a874-80e48e374e49-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/rcsetup.py'}, 'id': '9469df22-cfbb-4213-a3a7-016e03fc7a0a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23312, 'output_tokens': 96, 'total_tokens': 23473, 'input_token_details': {'cache_read': 15323}, 'output_token_details': {'reasoning': 65}}
2025-12-24 03:15:48,487 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now examined the `rcsetup.py` file, and while it contains validation and setup logic for rc parameters, the `rc_context` definition is not present. My next step is to search for the text "def rc_context" within the `lib/matplotlib` directory to locate the function definition. This will allow me to pinpoint the exact file and code that implements the `rc_context` manager.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib", "text": "def rc_context"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 30440, 'candidates_token_count': 116, 'total_token_count': 30904, 'cached_content_token_count': 23070, 'prompt_tokens_details': [{'modality': 1, 'token_count': 30440}], 'cache_tokens_details': [{'modality': 1, 'token_count': 23070}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 116}], 'thoughts_token_count': 348}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5019247120824354, 'model_name': 'gemini-2.5-pro'} id='run--ee87051c-a80f-4f73-922e-a9ef1909c247-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib', 'text': 'def rc_context'}, 'id': '46bdb153-c3ac-4773-801a-dd988d9f80bc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30440, 'output_tokens': 116, 'total_tokens': 30904, 'input_token_details': {'cache_read': 23070}, 'output_token_details': {'reasoning': 348}}
2025-12-24 03:15:51,348 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I've encountered some technical issues while searching for the `rc_context` definition. To work around this, I will re-examine the `lib/matplotlib/__init__.py` file to find where `rc_context` is imported from. This should reveal the module that contains the `rc_context` implementation, allowing me to finally analyze its source code." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/__init__.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 30594, 'candidates_token_count': 96, 'total_token_count': 30774, 'cached_content_token_count': 28815, 'prompt_tokens_details': [{'modality': 1, 'token_count': 30594}], 'cache_tokens_details': [{'modality': 1, 'token_count': 28815}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 96}], 'thoughts_token_count': 84}, 'finish_reason': 'STOP', 'avg_logprobs': -0.23742534716924033, 'model_name': 'gemini-2.5-pro'} id='run--f76966c5-2cf3-4452-80d9-5f4d2f98ca14-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/__init__.py'}, 'id': '5cf66594-f7ac-4c8b-a02d-748412d12b4f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30594, 'output_tokens': 96, 'total_tokens': 30774, 'input_token_details': {'cache_read': 28815}, 'output_token_details': {'reasoning': 84}}
2025-12-24 03:17:01,422 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="After re-examining the `__init__.py` file, I have now successfully located the import for `rc_context`, which is sourced from the `matplotlib._rc_params` module. To finally understand its implementation, I will now read the contents of `lib/matplotlib/_rc_params.py`. This will allow me to analyze the source code and determine how it can be used to manage figure properties, which is essential for addressing the user's bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/_rc_params.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 37688, 'candidates_token_count': 121, 'total_token_count': 45115, 'cached_content_token_count': 28984, 'prompt_tokens_details': [{'modality': 1, 'token_count': 37688}], 'cache_tokens_details': [{'modality': 1, 'token_count': 28984}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 121}], 'thoughts_token_count': 7306}, 'finish_reason': 'STOP', 'avg_logprobs': -8.982544954158058, 'model_name': 'gemini-2.5-pro'} id='run--bf635b22-7d27-4707-9e85-c64b8340c03a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/_rc_params.py'}, 'id': '44667b01-3292-48c5-8421-8793876857fb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37688, 'output_tokens': 121, 'total_tokens': 45115, 'input_token_details': {'cache_read': 28984}, 'output_token_details': {'reasoning': 7306}}
2025-12-24 03:17:15,376 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have re-examined the `__init__.py` file and found that `rc_context` is defined directly within it as a context manager. I also discovered that it calls the `rc_context` method of an `RcParams` class instance. To fully understand the implementation, I will now read the definitions of both the `rc_context` function and the `RcParams` class from `lib/matplotlib/__init__.py`.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 833.0, "relative_path": "lib/matplotlib/__init__.py", "end_line": 884.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 37836, 'candidates_token_count': 118, 'total_token_count': 39097, 'cached_content_token_count': 28968, 'prompt_tokens_details': [{'modality': 1, 'token_count': 37836}], 'cache_tokens_details': [{'modality': 1, 'token_count': 28968}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 118}], 'thoughts_token_count': 1143}, 'finish_reason': 'STOP', 'avg_logprobs': -1.270484148445776, 'model_name': 'gemini-2.5-pro'} id='run--2097db1a-80fa-44a6-b255-d5aa863d9d37-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 833.0, 'relative_path': 'lib/matplotlib/__init__.py', 'end_line': 884.0}, 'id': 'c991ad34-0d83-4fb1-acf6-ce7584d6e2fe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37836, 'output_tokens': 118, 'total_tokens': 39097, 'input_token_details': {'cache_read': 28968}, 'output_token_details': {'reasoning': 1143}}
2025-12-24 03:17:18,324 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now examined the `rc_params_from_file` function, but it appears I was mistaken and `rc_context` is not defined there. To continue my investigation, I will now read the definition of the `RcParams` class in `lib/matplotlib/__init__.py`, from lines 515 to 832, to understand its implementation.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 515.0, "relative_path": "lib/matplotlib/__init__.py", "end_line": 832.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 38833, 'candidates_token_count': 105, 'total_token_count': 39016, 'cached_content_token_count': 36676, 'prompt_tokens_details': [{'modality': 1, 'token_count': 38833}], 'cache_tokens_details': [{'modality': 1, 'token_count': 36676}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 105}], 'thoughts_token_count': 78}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2811579386393229, 'model_name': 'gemini-2.5-pro'} id='run--178eda9e-c559-4145-af9d-e7686495e0e0-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 515.0, 'relative_path': 'lib/matplotlib/__init__.py', 'end_line': 832.0}, 'id': '77985b73-b5ef-47e9-82a7-dcdf547ae82d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 38833, 'output_tokens': 105, 'total_tokens': 39016, 'input_token_details': {'cache_read': 36676}, 'output_token_details': {'reasoning': 78}}
2025-12-24 03:17:25,468 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have now analyzed the `RcParams` class and the `rc_params_from_file` function in `lib/matplotlib/__init__.py`. With this context, along with the previously gathered documentation and the content of `test_pyplot.py`, I have a sufficient understanding of how `rc_context` and `rcParams` work to proceed with addressing the user's query. I can now analyze the `test_pyplot.py` file for relevant test cases to understand the interaction between `rc_context` and figure management." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 43712, 'candidates_token_count': 111, 'total_token_count': 44300, 'cached_content_token_count': 36771, 'prompt_tokens_details': [{'modality': 1, 'token_count': 43712}], 'cache_tokens_details': [{'modality': 1, 'token_count': 36771}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 111}], 'thoughts_token_count': 477}, 'finish_reason': 'STOP', 'avg_logprobs': -0.8315769917256123, 'model_name': 'gemini-2.5-pro'} id='run--ae0ade11-5640-4211-aa1e-2606c3f48633-0' usage_metadata={'input_tokens': 43712, 'output_tokens': 111, 'total_tokens': 44300, 'input_token_details': {'cache_read': 36771}, 'output_token_details': {'reasoning': 477}}
2025-12-24 03:17:25,470 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `lib/matplotlib/tests/test_pyplot.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze this file to find existing test cases that are relevant to the user's reported bug concerning `rc_context` and figure management in `pyplot`.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: doc/users/prev_whats_new/github_stats_3.3.0.rst
Line number range: 492 - 572
Content:
* :ghpull:`17212`: Cleanup text.py.
* :ghpull:`17196`: Move polar tests to their own module.
* :ghpull:`14747`: Deprecate AxisArtist.dpi_transform.
* :ghpull:`13144`: Deprecate NavigationToolbar2GTK3.ctx.
* :ghpull:`17202`: DOC: Remove extra word
* :ghpull:`17194`: Small cleanups/simplifications/fixes to pie().
* :ghpull:`17102`: Switch tk pan/zoom to use togglable buttons.
* :ghpull:`16832`: Correctly compute path extents
* :ghpull:`17193`: Document docstring quote convention
* :ghpull:`17195`: Fix polar tests.
* :ghpull:`17189`: Make all parameters of ColorbarBase, except ``ax``, keyword-only.
* :ghpull:`16717`: Bugfix for issue 16501 raised ValueError polar subplot with (thetamax - thetamin) > 2pi
* :ghpull:`17180`: Doc: spines arrows example
* :ghpull:`17184`: Fix various small typos.
* :ghpull:`17143`: Move linting to GitHub Actions with reviewdog.
* :ghpull:`17160`: Correctly go through property setter when init'ing Timer interval.
* :ghpull:`17166`: Deprecate ScalarMappable.check_update and associated machinery.
* :ghpull:`17177`: Manually linewrap PS hexlines. Fixes #17176
* :ghpull:`17162`: Update docs of rc_context()
* :ghpull:`17170`: Convert SubplotZero example into centered-spines-with-arrows recipe.
* :ghpull:`17164`: Fix Figure.add_axes(rect=...).
* :ghpull:`17154`: DOC: Fix some warning and unreproducibility
* :ghpull:`17169`: Clarify that draw_event occurs after the canvas draw.
* :ghpull:`17089`: Cleanup some imports in tests
* :ghpull:`17040`: Improve docs on automated tests
* :ghpull:`17145`: CI: run pydocstyle with our custom options
* :ghpull:`16864`: Check parameter type for legend(labels)
* :ghpull:`17146`: FigureManager/NavigationToolbar2 cleanups.
* :ghpull:`16933`: Add tests for toolmanager.
* :ghpull:`17127`: ENH: allow title autopositioning to be turned off
* :ghpull:`17150`: Many docstring cleanups.
* :ghpull:`17148`: Fix most instances of D404 ("docstring should not start with 'this'").
* :ghpull:`17142`: BUGFIX: conditional for add_axes arg deprecation
* :ghpull:`17032`: Fold table.CustomCell into Cell.
* :ghpull:`17117`: TextBox improvements.
* :ghpull:`17108`: Make widgets.TextBox work also when embedding.
* :ghpull:`17135`: Simplify pan/zoom toggling.
* :ghpull:`17134`: Don't override update() in NavigationToolbar2Tk.
* :ghpull:`17129`: In docs remove 'optional' if 'default' can be given
* :ghpull:`16963`: Deprecate Locator.refresh and associated helpers.
* :ghpull:`17133`: Fix Button widget motion callback.
* :ghpull:`17125`: Make multiline docstrings start with a newline.
* :ghpull:`17124`: Widgets cleanup.
* :ghpull:`17123`: Cleanup/Simplify Cell._set_text_position.
* :ghpull:`16862`: FIX: turn off title autopos if pad is set
* :ghpull:`15214`: Inline wx icon loading.
* :ghpull:`16831`: Simplify interactive zoom handling.
* :ghpull:`17094`: DOC: drop the experimental tag constrained_layout and tight_layout
* :ghpull:`17101`: Avoid "wrapped C/C++ object has been deleted" when closing wx window.
* :ghpull:`17028`: Changed return type of get_{x,y}ticklabels to plain list
* :ghpull:`16058`: Deprecate {ContourSet,Quiver}.ax in favor of .axes.
* :ghpull:`15349`: Use checkboxes as bullet points for the PR review checklists
* :ghpull:`17112`: Fix some link redirects in docs
* :ghpull:`17090`: DOCS: add examples of how one "should" use Bbox
* :ghpull:`17110`: Simplify connection of the default key_press and button_press handlers.
* :ghpull:`17070`: Cleanups to Qt backend.
* :ghpull:`16776`: Make cursor text precision actually correspond to pointing precision.
* :ghpull:`17026`:  Add eslint & prettier, and re-format JS
* :ghpull:`17091`: Make sure slider uses "x" sign before multiplicative factor.
* :ghpull:`17082`: Cleanup TextBox implementation.
* :ghpull:`17067`: Simplify and generalize _set_view_from_bbox.
* :ghpull:`17081`: Update animation_api.rst
* :ghpull:`17077`: Improve default formatter for Slider values.
* :ghpull:`17079`: Use True instead of 1 for boolean parameters.
* :ghpull:`17074`: Fixed a typo in Lifecycle of a Plot
* :ghpull:`17072`: Cleanup multi_image example.
* :ghpull:`15287`: Allow sharex/y after axes creation.
* :ghpull:`16987`: Deprecate case-insensitive properties.
* :ghpull:`17059`: More missing refs fixes, and associated doc rewordings.
* :ghpull:`17057`: Simplify subgridspec example/tutorial.
* :ghpull:`17058`: Fix minor doc typos.
* :ghpull:`17024`: Clarify docs of Rectangle
* :ghpull:`17043`: Avoid spurious deprecation warning in TextBox.
* :ghpull:`17047`: Highlighted  .cbook.warn_deprecated() in contributing.rst
* :ghpull:`17054`: Use slope in axline example
* :ghpull:`17048`: More missing refs fixes.
* :ghpull:`17021`: File name made more understandable
* :ghpull:`16903`: Shorten implementation of Axes methods that just wrap Axis methods.
* :ghpull:`17039`: Cleanups to contour docs.
* :ghpull:`17011`: ci: Publish result images as Azure artifacts.
* :ghpull:`17038`: Improve readability of documenting_mpl.rst


File: doc/users/prev_whats_new/github_stats_3.5.0.rst
Line number range: 706 - 783
Content:
* :ghpull:`20600`: Inline _print_svg into its only call site (print_svg).
* :ghpull:`20589`: Add directional sizing cursors
* :ghpull:`20481`: Deprecate Colorbar.patch.
* :ghpull:`20598`: Don't forget to propagate kwargs from print_svgz to print_svg.
* :ghpull:`19495`: Move svg basename detection down to RendererSVG.
* :ghpull:`20501`: Colorbar redo again!
* :ghpull:`20407`: Turn shared_axes, stale_viewlims into {axis_name: value} dicts.
* :ghpull:`18966`: PR: Remove modality of figure options
* :ghpull:`19265`: Change styling of slider widgets
* :ghpull:`20593`: DOC: fix various typos
* :ghpull:`20374`: Check modification times of included RST files
* :ghpull:`20569`: Better signature and docstring for Artist.set
* :ghpull:`20574`: Add tricontourf hatching example
* :ghpull:`18666`: Remove unused/deprecated ``AVConv`` classes
* :ghpull:`20514`: Fix example for rcParams['autolimit_mode']
* :ghpull:`20571`: Switch default ArrowStyle angle values from None to zero.
* :ghpull:`20510`: Consistent capitalization of section headers
* :ghpull:`20573`: Move the marker path example into the marker reference
* :ghpull:`20572`: Clarify allowable backend switches in matplotlib.use().
* :ghpull:`20538`: Show box/arrowstyle parameters in reference examples.
* :ghpull:`20515`: Shorten the implementation of bxp().
* :ghpull:`20562`: More concise how to for subplot adjustment
* :ghpull:`20570`: Reduce vertical margins in property tables
* :ghpull:`20563`: Expire deprecation of passing nbins to MaxNLocator in two ways
* :ghpull:`20561`: Fix limits in plot types example hist(x)
* :ghpull:`20559`: Fix deprecation of encoding in plot_directive.
* :ghpull:`20547`: Raise if passed invalid kwargs to set_constrained_layout_pads.
* :ghpull:`20527`: Factor out DEBUG_TRUETYPE checks in ttconv, & removals of unused defs.
* :ghpull:`20465`: Remove remaining 3.3 deprecations
* :ghpull:`20558`: Rename recently introduced parameters in SpanSelector
* :ghpull:`20535`: Improve the documentation guide
* :ghpull:`20113`: Interactive span selector improvement
* :ghpull:`20524`: Dedupe some box anchoring code between legend.py and offsetbox.py.
* :ghpull:`20451`: Add initial TextBox widget testing
* :ghpull:`20543`: Deprecate ``@pytest.mark.style(...)``.
* :ghpull:`20530`: Plot nothing for incompatible 0 shape in x,y data
* :ghpull:`20367`: Add parse_math in Text and default it False for TextBox
* :ghpull:`20509`: Cleanup plot types
* :ghpull:`20537`: Don't sort boxstyles/arrowstyles/etc. alphabetically.
* :ghpull:`20542`: Fix ScalarFormatter.format_ticks for non-ordered tick locations.
* :ghpull:`20533`: Rename (N, M) -> (M, N) array-like
* :ghpull:`20540`: Deprecate :encoding: option to .. plot::, which has no effect since 2011
* :ghpull:`20541`: Minor fix
* :ghpull:`20539`: Document defaults in plot_directive.
* :ghpull:`20536`: Make most of annotation tutorial a comment, and remove figure titles.
* :ghpull:`20439`: Remove dead code from LGTM alerts.
* :ghpull:`20528`: Merge subplot_demo into subplot example.
* :ghpull:`20493`: Cleanup AnchoredOffsetbox-related demos.
* :ghpull:`20513`: Shorten the bxp docstring.
* :ghpull:`20507`: Merge subplot_toolbar example into subplots_adjust.
* :ghpull:`20505`: Add rc_context to customizing tutorial
* :ghpull:`20449`: Suppress repeated logwarns in postscript output.
* :ghpull:`20500`: DOC: Add twitter icon and fix logo link
* :ghpull:`20499`: Simplify plot types pie()
* :ghpull:`20495`: Fix shape of Z in contour docs
* :ghpull:`20497`: Remove obsolete footnote on pyside
* :ghpull:`20485`: DOC: hexbin 'extent' must be 4-tuple of float, not float
* :ghpull:`20466`: Various cleanups to pgf backend.
* :ghpull:`20474`: Make lack of support more explicit for non-postscript fonts + usetex.
* :ghpull:`20476`: give Font a root widget
* :ghpull:`20477`: remove _master attribute from FigureCanvasTk
* :ghpull:`19731`: DOC: first pass at switching to pydata theme
* :ghpull:`20475`: Less pyplot, more OO in docs.
* :ghpull:`20467`: Small cleanups to sphinxext.plot_directive.
* :ghpull:`20437`: Use packaging to do version comparisons.
* :ghpull:`20354`: Merge Colorbar and ColorbarBase.
* :ghpull:`20464`: tinypages/conf.py doesn't need to manipulate sys.path.
* :ghpull:`20420`: Add a select_overload helper for signature-overloaded functions.
* :ghpull:`20460`: Shorten the AnchoredOffsetbox docstring.
* :ghpull:`20458`: Set the axes of legend text
* :ghpull:`20438`: Fix deprecation of ``Tick.apply_tickdir``.
* :ghpull:`20457`: Rename data variables in histogram example.
* :ghpull:`20442`: Fix dvi baseline detector when ``\usepackage{chemformula}`` is used.
* :ghpull:`20454`: Tell LGTM to use Python 3 explicitly.
* :ghpull:`20446`: Make used tex packages consistent between ps and other backends.
* :ghpull:`20447`: Remove Figure/Axes/Axis deprecations from 3.3
* :ghpull:`20414`: ENH: add colorbar info to gridspec cbar
* :ghpull:`20436`: Add missing super __init__ in subclasses


File: doc/users/prev_whats_new/whats_new_1.2.rst
Line number range: 1 - 150
Content:
.. _whats-new-1-2:


What's new in Matplotlib 1.2 (Nov 9, 2012)
==========================================

.. contents:: Table of Contents
   :depth: 2


.. note::

   matplotlib 1.2 supports Python 2.6, 2.7, and 3.1

Python 3.x support
------------------

Matplotlib 1.2 is the first version to support Python 3.x,
specifically Python 3.1 and 3.2.  To make this happen in a reasonable
way, we also had to drop support for Python versions earlier than 2.6.

This work was done by Michael Droettboom, the Cape Town Python Users'
Group, many others and supported financially in part by the SAGE
project.

The following GUI backends work under Python 3.x: Gtk3Cairo, Qt4Agg,
TkAgg and MacOSX.  The other GUI backends do not yet have adequate
bindings for Python 3.x, but continue to work on Python 2.6 and 2.7,
particularly the Qt and QtAgg backends (which have been
deprecated). The non-GUI backends, such as PDF, PS and SVG, work on
both Python 2.x and 3.x.

Features that depend on the Python Imaging Library, such as JPEG
handling, do not work, since the version of PIL for Python 3.x is not
sufficiently mature.

PGF/TikZ backend
----------------
Peter Würtz wrote a backend that allows matplotlib to export figures as
drawing commands for LaTeX. These can be processed by PdfLaTeX, XeLaTeX or
LuaLaTeX using the PGF/TikZ package. Usage examples and documentation are
found in :doc:`/tutorials/text/pgf`.

.. image:: /_static/pgf_preamble.*

Locator interface
-----------------

Philip Elson exposed the intelligence behind the tick Locator classes with a
simple interface. For instance, to get no more than 5 sensible steps which
span the values 10 and 19.5::

    >>> import matplotlib.ticker as mticker
    >>> locator = mticker.MaxNLocator(nbins=5)
    >>> print(locator.tick_values(10, 19.5))
    [ 10.  12.  14.  16.  18.  20.]

Tri-Surface Plots
-----------------

Damon McDougall added a new plotting method for the
:mod:`~mpl_toolkits.mplot3d` toolkit called
:meth:`~mpl_toolkits.mplot3d.axes3d.Axes3D.plot_trisurf`.

.. figure:: ../../gallery/mplot3d/images/sphx_glr_trisurf3d_001.png
   :target: ../../gallery/mplot3d/trisurf3d.html
   :align: center
   :scale: 50

Control the lengths of colorbar extensions
------------------------------------------

Andrew Dawson added a new keyword argument *extendfrac* to
:meth:`~matplotlib.pyplot.colorbar` to control the length of
minimum and maximum colorbar extensions.

.. plot::

    import matplotlib.pyplot as plt
    import numpy as np

    x = y = np.linspace(0., 2*np.pi, 100)
    X, Y = np.meshgrid(x, y)
    Z = np.cos(X) * np.sin(0.5*Y)

    clevs = [-.75, -.5, -.25, 0., .25, .5, .75]
    cmap = plt.cm.get_cmap(name='jet', lut=8)

    ax1 = plt.subplot(211)
    cs1 = plt.contourf(x, y, Z, clevs, cmap=cmap, extend='both')
    cb1 = plt.colorbar(orientation='horizontal', extendfrac=None)
    cb1.set_label('Default length colorbar extensions')

    ax2 = plt.subplot(212)
    cs2 = plt.contourf(x, y, Z, clevs, cmap=cmap, extend='both')
    cb2 = plt.colorbar(orientation='horizontal', extendfrac='auto')
    cb2.set_label('Custom length colorbar extensions')

    plt.show()


Figures are picklable
---------------------

Philip Elson added an experimental feature to make figures picklable
for quick and easy short-term storage of plots. Pickle files
are not designed for long term storage, are unsupported when restoring a pickle
saved in another matplotlib version and are insecure when restoring a pickle
from an untrusted source. Having said this, they are useful for short term
storage for later modification inside matplotlib.


Set default bounding box in matplotlibrc
------------------------------------------

Two new defaults are available in the matplotlibrc configuration file:
``savefig.bbox``, which can be set to 'standard' or 'tight', and
``savefig.pad_inches``, which controls the bounding box padding.


New Boxplot Functionality
-------------------------

Users can now incorporate their own methods for computing the median and its
confidence intervals into the `~.Axes.boxplot` method. For
every column of data passed to boxplot, the user can specify an accompanying
median and confidence interval.

.. figure:: ../../gallery/statistics/images/sphx_glr_boxplot_demo_003.png
   :target: ../../gallery/statistics/boxplot_demo.html
   :align: center
   :scale: 50

New RC parameter functionality
------------------------------

Matthew Emmett added a function and a context manager to help manage RC
parameters: :func:`~matplotlib.rc_file` and :class:`~matplotlib.rc_context`.
To load RC parameters from a file::

  >>> mpl.rc_file('mpl.rc')

To temporarily use RC parameters::

  >>> with mpl.rc_context(fname='mpl.rc', rc={'text.usetex': True}):
  >>>     ...


Streamplot
----------


File: doc/users/prev_whats_new/whats_new_1.2.rst
Line number range: 134 - 216
Content:
New RC parameter functionality
------------------------------

Matthew Emmett added a function and a context manager to help manage RC
parameters: :func:`~matplotlib.rc_file` and :class:`~matplotlib.rc_context`.
To load RC parameters from a file::

  >>> mpl.rc_file('mpl.rc')

To temporarily use RC parameters::

  >>> with mpl.rc_context(fname='mpl.rc', rc={'text.usetex': True}):
  >>>     ...


Streamplot
----------

Tom Flannaghan and Tony Yu have added a new
:meth:`~matplotlib.pyplot.streamplot` function to plot the streamlines of
a vector field. This has been a long-requested feature and complements the
existing :meth:`~matplotlib.pyplot.quiver` function for plotting vector fields.
In addition to simply plotting the streamlines of the vector field,
:meth:`~matplotlib.pyplot.streamplot` allows users to map the colors and/or
line widths of the streamlines to a separate parameter, such as the speed or
local intensity of the vector field.

.. figure:: ../../gallery/images_contours_and_fields/images/sphx_glr_plot_streamplot_001.png
   :target: ../../gallery/images_contours_and_fields/plot_streamplot.html
   :align: center
   :scale: 50

New hist functionality
----------------------

Nic Eggert added a new *stacked* kwarg to :meth:`~matplotlib.pyplot.hist` that
allows creation of stacked histograms using any of the histogram types.
Previously, this functionality was only available by using the "barstacked"
histogram type. Now, when ``stacked=True`` is passed to the function, any of the
histogram types can be stacked. The "barstacked" histogram type retains its
previous functionality for backwards compatibility.

Updated shipped dependencies
----------------------------

The following dependencies that ship with matplotlib and are
optionally installed alongside it have been updated:

- `pytz <http://pytz.sourceforge.net/>`_ 2012d
- `dateutil <http://labix.org/python-dateutil>`_ 1.5 on Python 2.x,
   and 2.1 on Python 3.x


Face-centred colors in tripcolor plots
--------------------------------------

Ian Thomas extended :meth:`~matplotlib.pyplot.tripcolor` to allow one color
value to be specified for each triangular face rather than for each point in
a triangulation.

.. figure:: ../../gallery/images_contours_and_fields/images/sphx_glr_tripcolor_demo_001.png
   :target: ../../gallery/images_contours_and_fields/tripcolor_demo.html
   :align: center
   :scale: 50

Hatching patterns in filled contour plots, with legends
-------------------------------------------------------

Phil Elson added support for hatching to
:func:`~matplotlib.pyplot.contourf`, together with the ability
to use a legend to identify contoured ranges.

.. figure:: ../../gallery/images_contours_and_fields/images/sphx_glr_contourf_hatching_001.png
   :target: ../../gallery/images_contours_and_fields/contourf_hatching.html
   :align: center
   :scale: 50

Known issues in the matplotlib 1.2 release
------------------------------------------

- When using the Qt4Agg backend with IPython 0.11 or later, the save
  dialog will not display.  This should be fixed in a future version
  of IPython.


File: doc/users/prev_whats_new/whats_new_3.3.0.rst
Line number range: 484 - 611
Content:
Similar to `~.Axes.scatter`, `~.Axes.plot` and `~.lines.Line2D` now accept
`~.markers.MarkerStyle` instances as input for the *marker* parameter::

    plt.plot(..., marker=matplotlib.markers.MarkerStyle("D"))


Fonts
=====

Simple syntax to select fonts by absolute path
----------------------------------------------

Fonts can now be selected by passing an absolute `pathlib.Path` to the *font*
keyword argument of `.Text`.

Improved font weight detection
------------------------------

Matplotlib is now better able to determine the weight of fonts from their
metadata, allowing to differentiate between fonts within the same family more
accurately.


rcParams improvements
=====================

``matplotlib.rc_context`` can be used as a decorator
----------------------------------------------------

`matplotlib.rc_context` can now be used as a decorator (technically, it is now
implemented as a `contextlib.contextmanager`), e.g., ::

    @rc_context({"lines.linewidth": 2})
    def some_function(...):
        ...

rcParams for controlling default "raise window" behavior
--------------------------------------------------------

The new config option :rc:`figure.raise_window` allows disabling of the raising
of the plot window when calling `~.pyplot.show` or `~.pyplot.pause`. The
``MacOSX`` backend is currently not supported.

Add generalized ``mathtext.fallback`` to rcParams
-------------------------------------------------

New  :rc:`mathtext.fallback` rcParam. Takes "cm", "stix", "stixsans"
or "none" to turn fallback off. The rcParam *mathtext.fallback_to_cm* is
deprecated, but if used, will override new fallback.

Add ``contour.linewidth`` to rcParams
-------------------------------------

The new config option :rc:`contour.linewidth` allows to control the default
line width of contours as a float. When set to ``None``, the line widths fall
back to :rc:`lines.linewidth`. The config value is overridden as usual by the
*linewidths* argument passed to `~.axes.Axes.contour` when it is not set to
``None``.


3D Axes improvements
====================

``Axes3D`` no longer distorts the 3D plot to match the 2D aspect ratio
----------------------------------------------------------------------

Plots made with :class:`~mpl_toolkits.mplot3d.axes3d.Axes3D` were previously
stretched to fit a square bounding box. As this stretching was done after the
projection from 3D to 2D, it resulted in distorted images if non-square
bounding boxes were used. As of 3.3, this no longer occurs.

Currently, modes of setting the aspect (via
`~mpl_toolkits.mplot3d.axes3d.Axes3D.set_aspect`) in data space are not
supported for Axes3D but may be in the future. If you want to simulate having
equal aspect in data space, set the ratio of your data limits to match the
value of `~.get_box_aspect`. To control these ratios use the
`~mpl_toolkits.mplot3d.axes3d.Axes3D.set_box_aspect` method which accepts the
ratios as a 3-tuple of X:Y:Z. The default aspect ratio is 4:4:3.

3D axes now support minor ticks
-------------------------------

.. plot::
    :include-source: True

    ax = plt.figure().add_subplot(projection='3d')

    ax.scatter([0, 1, 2], [1, 3, 5], [30, 50, 70])

    ax.set_xticks([0.25, 0.75, 1.25, 1.75], minor=True)
    ax.set_xticklabels(['a', 'b', 'c', 'd'], minor=True)

    ax.set_yticks([1.5, 2.5, 3.5, 4.5], minor=True)
    ax.set_yticklabels(['A', 'B', 'C', 'D'], minor=True)

    ax.set_zticks([35, 45, 55, 65], minor=True)
    ax.set_zticklabels([r'$\alpha$', r'$\beta$', r'$\delta$', r'$\gamma$'],
                       minor=True)

    ax.tick_params(which='major', color='C0', labelcolor='C0', width=5)
    ax.tick_params(which='minor', color='C1', labelcolor='C1', width=3)

Home/Forward/Backward buttons now work with 3D axes
---------------------------------------------------


Interactive tool improvements
=============================

More consistent toolbar behavior across backends
------------------------------------------------

Toolbar features are now more consistent across backends. The history buttons
will auto-disable when there is no further action in a direction. The pan and
zoom buttons will be marked active when they are in use.

In NbAgg and WebAgg, the toolbar buttons are now grouped similarly to other
backends. The WebAgg toolbar now uses the same icons as other backends.

Toolbar icons are now styled for dark themes
--------------------------------------------

On dark themes, toolbar icons will now be inverted. When using the GTK3Agg
backend, toolbar icons are now symbolic, and both foreground and background
colors will follow the theme. Tooltips should also behave correctly.

Cursor text now uses a number of significant digits matching pointing precision
-------------------------------------------------------------------------------


File: lib/matplotlib/__init__.py
Line number range: 1 - 500
Content:
1. """
2. An object-oriented plotting library.
3. 
4. A procedural interface is provided by the companion pyplot module,
5. which may be imported directly, e.g.::
6. 
7.     import matplotlib.pyplot as plt
8. 
9. or using ipython::
10. 
11.     ipython
12. 
13. at your terminal, followed by::
14. 
15.     In [1]: %matplotlib
16.     In [2]: import matplotlib.pyplot as plt
17. 
18. at the ipython shell prompt.
19. 
20. For the most part, direct use of the explicit object-oriented library is
21. encouraged when programming; the implicit pyplot interface is primarily for
22. working interactively. The exceptions to this suggestion are the pyplot
23. functions `.pyplot.figure`, `.pyplot.subplot`, `.pyplot.subplots`, and
24. `.pyplot.savefig`, which can greatly simplify scripting.  See
25. :ref:`api_interfaces` for an explanation of the tradeoffs between the implicit
26. and explicit interfaces.
27. 
28. Modules include:
29. 
30.     :mod:`matplotlib.axes`
31.         The `~.axes.Axes` class.  Most pyplot functions are wrappers for
32.         `~.axes.Axes` methods.  The axes module is the highest level of OO
33.         access to the library.
34. 
35.     :mod:`matplotlib.figure`
36.         The `.Figure` class.
37. 
38.     :mod:`matplotlib.artist`
39.         The `.Artist` base class for all classes that draw things.
40. 
41.     :mod:`matplotlib.lines`
42.         The `.Line2D` class for drawing lines and markers.
43. 
44.     :mod:`matplotlib.patches`
45.         Classes for drawing polygons.
46. 
47.     :mod:`matplotlib.text`
48.         The `.Text` and `.Annotation` classes.
49. 
50.     :mod:`matplotlib.image`
51.         The `.AxesImage` and `.FigureImage` classes.
52. 
53.     :mod:`matplotlib.collections`
54.         Classes for efficient drawing of groups of lines or polygons.
55. 
56.     :mod:`matplotlib.colors`
57.         Color specifications and making colormaps.
58. 
59.     :mod:`matplotlib.cm`
60.         Colormaps, and the `.ScalarMappable` mixin class for providing color
61.         mapping functionality to other classes.
62. 
63.     :mod:`matplotlib.ticker`
64.         Calculation of tick mark locations and formatting of tick labels.
65. 
66.     :mod:`matplotlib.backends`
67.         A subpackage with modules for various GUI libraries and output formats.
68. 
69. The base matplotlib namespace includes:
70. 
71.     `~matplotlib.rcParams`
72.         Default configuration settings; their defaults may be overridden using
73.         a :file:`matplotlibrc` file.
74. 
75.     `~matplotlib.use`
76.         Setting the Matplotlib backend.  This should be called before any
77.         figure is created, because it is not possible to switch between
78.         different GUI backends after that.
79. 
80. Matplotlib was initially written by John D. Hunter (1968-2012) and is now
81. developed and maintained by a host of others.
82. 
83. Occasionally the internal documentation (python docstrings) will refer
84. to MATLAB&reg;, a registered trademark of The MathWorks, Inc.
85. 
86. """
87. 
88. import atexit
89. from collections import namedtuple
90. from collections.abc import MutableMapping
91. import contextlib
92. import functools
93. import importlib
94. import inspect
95. from inspect import Parameter
96. import locale
97. import logging
98. import os
99. from pathlib import Path
100. import pprint
101. import re
102. import shutil
103. import subprocess
104. import sys
105. import tempfile
106. import warnings
107. 
108. import numpy
109. from packaging.version import parse as parse_version
110. 
111. # cbook must import matplotlib only within function
112. # definitions, so it is safe to import from it here.
113. from . import _api, _version, cbook, _docstring, rcsetup
114. from matplotlib.cbook import sanitize_sequence
115. from matplotlib._api import MatplotlibDeprecationWarning
116. from matplotlib.rcsetup import validate_backend, cycler
117. 
118. 
119. _log = logging.getLogger(__name__)
120. 
121. __bibtex__ = r"""@Article{Hunter:2007,
122.   Author    = {Hunter, J. D.},
123.   Title     = {Matplotlib: A 2D graphics environment},
124.   Journal   = {Computing in Science \& Engineering},
125.   Volume    = {9},
126.   Number    = {3},
127.   Pages     = {90--95},
128.   abstract  = {Matplotlib is a 2D graphics package used for Python
129.   for application development, interactive scripting, and
130.   publication-quality image generation across user
131.   interfaces and operating systems.},
132.   publisher = {IEEE COMPUTER SOC},
133.   year      = 2007
134. }"""
135. 
136. # modelled after sys.version_info
137. _VersionInfo = namedtuple('_VersionInfo',
138.                           'major, minor, micro, releaselevel, serial')
139. 
140. 
141. def _parse_to_version_info(version_str):
142.     """
143.     Parse a version string to a namedtuple analogous to sys.version_info.
144. 
145.     See:
146.     https://packaging.pypa.io/en/latest/version.html#packaging.version.parse
147.     https://docs.python.org/3/library/sys.html#sys.version_info
148.     """
149.     v = parse_version(version_str)
150.     if v.pre is None and v.post is None and v.dev is None:
151.         return _VersionInfo(v.major, v.minor, v.micro, 'final', 0)
152.     elif v.dev is not None:
153.         return _VersionInfo(v.major, v.minor, v.micro, 'alpha', v.dev)
154.     elif v.pre is not None:
155.         releaselevel = {
156.             'a': 'alpha',
157.             'b': 'beta',
158.             'rc': 'candidate'}.get(v.pre[0], 'alpha')
159.         return _VersionInfo(v.major, v.minor, v.micro, releaselevel, v.pre[1])
160.     else:
161.         # fallback for v.post: guess-next-dev scheme from setuptools_scm
162.         return _VersionInfo(v.major, v.minor, v.micro + 1, 'alpha', v.post)
163. 
164. 
165. def _get_version():
166.     """Return the version string used for __version__."""
167.     # Only shell out to a git subprocess if really needed, i.e. when we are in
168.     # a matplotlib git repo but not in a shallow clone, such as those used by
169.     # CI, as the latter would trigger a warning from setuptools_scm.
170.     root = Path(__file__).resolve().parents[2]
171.     if ((root / ".matplotlib-repo").exists()
172.             and (root / ".git").exists()
173.             and not (root / ".git/shallow").exists()):
174.         import setuptools_scm
175.         return setuptools_scm.get_version(
176.             root=root,
177.             version_scheme="release-branch-semver",
178.             local_scheme="node-and-date",
179.             fallback_version=_version.version,
180.         )
181.     else:  # Get the version from the _version.py setuptools_scm file.
182.         return _version.version
183. 
184. 
185. @_api.caching_module_getattr
186. class __getattr__:
187.     __version__ = property(lambda self: _get_version())
188.     __version_info__ = property(
189.         lambda self: _parse_to_version_info(self.__version__))
190.     # module-level deprecations
191.     URL_REGEX = _api.deprecated("3.5", obj_type="")(property(
192.         lambda self: re.compile(r'^http://|^https://|^ftp://|^file:')))
193. 
194. 
195. def _check_versions():
196. 
197.     # Quickfix to ensure Microsoft Visual C++ redistributable
198.     # DLLs are loaded before importing kiwisolver
199.     from . import ft2font
200. 
201.     for modname, minver in [
202.             ("cycler", "0.10"),
203.             ("dateutil", "2.7"),
204.             ("kiwisolver", "1.0.1"),
205.             ("numpy", "1.19"),
206.             ("pyparsing", "2.2.1"),
207.     ]:
208.         module = importlib.import_module(modname)
209.         if parse_version(module.__version__) < parse_version(minver):
210.             raise ImportError(f"Matplotlib requires {modname}>={minver}; "
211.                               f"you have {module.__version__}")
212. 
213. 
214. _check_versions()
215. 
216. 
217. # The decorator ensures this always returns the same handler (and it is only
218. # attached once).
219. @functools.lru_cache()
220. def _ensure_handler():
221.     """
222.     The first time this function is called, attach a `StreamHandler` using the
223.     same format as `logging.basicConfig` to the Matplotlib root logger.
224. 
225.     Return this handler every time this function is called.
226.     """
227.     handler = logging.StreamHandler()
228.     handler.setFormatter(logging.Formatter(logging.BASIC_FORMAT))
229.     _log.addHandler(handler)
230.     return handler
231. 
232. 
233. def set_loglevel(level):
234.     """
235.     Set Matplotlib's root logger and root logger handler level, creating
236.     the handler if it does not exist yet.
237. 
238.     Typically, one should call ``set_loglevel("info")`` or
239.     ``set_loglevel("debug")`` to get additional debugging information.
240. 
241.     Parameters
242.     ----------
243.     level : {"notset", "debug", "info", "warning", "error", "critical"}
244.         The log level of the handler.
245. 
246.     Notes
247.     -----
248.     The first time this function is called, an additional handler is attached
249.     to Matplotlib's root handler; this handler is reused every time and this
250.     function simply manipulates the logger and handler's level.
251.     """
252.     _log.setLevel(level.upper())
253.     _ensure_handler().setLevel(level.upper())
254. 
255. 
256. def _logged_cached(fmt, func=None):
257.     """
258.     Decorator that logs a function's return value, and memoizes that value.
259. 
260.     After ::
261. 
262.         @_logged_cached(fmt)
263.         def func(): ...
264. 
265.     the first call to *func* will log its return value at the DEBUG level using
266.     %-format string *fmt*, and memoize it; later calls to *func* will directly
267.     return that value.
268.     """
269.     if func is None:  # Return the actual decorator.
270.         return functools.partial(_logged_cached, fmt)
271. 
272.     called = False
273.     ret = None
274. 
275.     @functools.wraps(func)
276.     def wrapper(**kwargs):
277.         nonlocal called, ret
278.         if not called:
279.             ret = func(**kwargs)
280.             called = True
281.             _log.debug(fmt, ret)
282.         return ret
283. 
284.     return wrapper
285. 
286. 
287. _ExecInfo = namedtuple("_ExecInfo", "executable raw_version version")
288. 
289. 
290. class ExecutableNotFoundError(FileNotFoundError):
291.     """
292.     Error raised when an executable that Matplotlib optionally
293.     depends on can't be found.
294.     """
295.     pass
296. 
297. 
298. @functools.lru_cache()
299. def _get_executable_info(name):
300.     """
301.     Get the version of some executable that Matplotlib optionally depends on.
302. 
303.     .. warning::
304.        The list of executables that this function supports is set according to
305.        Matplotlib's internal needs, and may change without notice.
306. 
307.     Parameters
308.     ----------
309.     name : str
310.         The executable to query.  The following values are currently supported:
311.         "dvipng", "gs", "inkscape", "magick", "pdftocairo", "pdftops".  This
312.         list is subject to change without notice.
313. 
314.     Returns
315.     -------
316.     tuple
317.         A namedtuple with fields ``executable`` (`str`) and ``version``
318.         (`packaging.Version`, or ``None`` if the version cannot be determined).
319. 
320.     Raises
321.     ------
322.     ExecutableNotFoundError
323.         If the executable is not found or older than the oldest version
324.         supported by Matplotlib.  For debugging purposes, it is also
325.         possible to "hide" an executable from Matplotlib by adding it to the
326.         :envvar:`_MPLHIDEEXECUTABLES` environment variable (a comma-separated
327.         list), which must be set prior to any calls to this function.
328.     ValueError
329.         If the executable is not one that we know how to query.
330.     """
331. 
332.     def impl(args, regex, min_ver=None, ignore_exit_code=False):
333.         # Execute the subprocess specified by args; capture stdout and stderr.
334.         # Search for a regex match in the output; if the match succeeds, the
335.         # first group of the match is the version.
336.         # Return an _ExecInfo if the executable exists, and has a version of
337.         # at least min_ver (if set); else, raise ExecutableNotFoundError.
338.         try:
339.             output = subprocess.check_output(
340.                 args, stderr=subprocess.STDOUT,
341.                 universal_newlines=True, errors="replace")
342.         except subprocess.CalledProcessError as _cpe:
343.             if ignore_exit_code:
344.                 output = _cpe.output
345.             else:
346.                 raise ExecutableNotFoundError(str(_cpe)) from _cpe
347.         except OSError as _ose:
348.             raise ExecutableNotFoundError(str(_ose)) from _ose
349.         match = re.search(regex, output)
350.         if match:
351.             raw_version = match.group(1)
352.             version = parse_version(raw_version)
353.             if min_ver is not None and version < parse_version(min_ver):
354.                 raise ExecutableNotFoundError(
355.                     f"You have {args[0]} version {version} but the minimum "
356.                     f"version supported by Matplotlib is {min_ver}")
357.             return _ExecInfo(args[0], raw_version, version)
358.         else:
359.             raise ExecutableNotFoundError(
360.                 f"Failed to determine the version of {args[0]} from "
361.                 f"{' '.join(args)}, which output {output}")
362. 
363.     if name in os.environ.get("_MPLHIDEEXECUTABLES", "").split(","):
364.         raise ExecutableNotFoundError(f"{name} was hidden")
365. 
366.     if name == "dvipng":
367.         return impl(["dvipng", "-version"], "(?m)^dvipng(?: .*)? (.+)", "1.6")
368.     elif name == "gs":
369.         execs = (["gswin32c", "gswin64c", "mgs", "gs"]  # "mgs" for miktex.
370.                  if sys.platform == "win32" else
371.                  ["gs"])
372.         for e in execs:
373.             try:
374.                 return impl([e, "--version"], "(.*)", "9")
375.             except ExecutableNotFoundError:
376.                 pass
377.         message = "Failed to find a Ghostscript installation"
378.         raise ExecutableNotFoundError(message)
379.     elif name == "inkscape":
380.         try:
381.             # Try headless option first (needed for Inkscape version < 1.0):
382.             return impl(["inkscape", "--without-gui", "-V"],
383.                         "Inkscape ([^ ]*)")
384.         except ExecutableNotFoundError:
385.             pass  # Suppress exception chaining.
386.         # If --without-gui is not accepted, we may be using Inkscape >= 1.0 so
387.         # try without it:
388.         return impl(["inkscape", "-V"], "Inkscape ([^ ]*)")
389.     elif name == "magick":
390.         if sys.platform == "win32":
391.             # Check the registry to avoid confusing ImageMagick's convert with
392.             # Windows's builtin convert.exe.
393.             import winreg
394.             binpath = ""
395.             for flag in [0, winreg.KEY_WOW64_32KEY, winreg.KEY_WOW64_64KEY]:
396.                 try:
397.                     with winreg.OpenKeyEx(
398.                             winreg.HKEY_LOCAL_MACHINE,
399.                             r"Software\Imagemagick\Current",
400.                             0, winreg.KEY_QUERY_VALUE | flag) as hkey:
401.                         binpath = winreg.QueryValueEx(hkey, "BinPath")[0]
402.                 except OSError:
403.                     pass
404.             path = None
405.             if binpath:
406.                 for name in ["convert.exe", "magick.exe"]:
407.                     candidate = Path(binpath, name)
408.                     if candidate.exists():
409.                         path = str(candidate)
410.                         break
411.             if path is None:
412.                 raise ExecutableNotFoundError(
413.                     "Failed to find an ImageMagick installation")
414.         else:
415.             path = "convert"
416.         info = impl([path, "--version"], r"^Version: ImageMagick (\S*)")
417.         if info.raw_version == "7.0.10-34":
418.             # https://github.com/ImageMagick/ImageMagick/issues/2720
419.             raise ExecutableNotFoundError(
420.                 f"You have ImageMagick {info.version}, which is unsupported")
421.         return info
422.     elif name == "pdftocairo":
423.         return impl(["pdftocairo", "-v"], "pdftocairo version (.*)")
424.     elif name == "pdftops":
425.         info = impl(["pdftops", "-v"], "^pdftops version (.*)",
426.                     ignore_exit_code=True)
427.         if info and not (
428.                 3 <= info.version.major or
429.                 # poppler version numbers.
430.                 parse_version("0.9") <= info.version < parse_version("1.0")):
431.             raise ExecutableNotFoundError(
432.                 f"You have pdftops version {info.version} but the minimum "
433.                 f"version supported by Matplotlib is 3.0")
434.         return info
435.     else:
436.         raise ValueError("Unknown executable: {!r}".format(name))
437. 
438. 
439. @_api.deprecated("3.6", alternative="Vendor the code")
440. def checkdep_usetex(s):
441.     if not s:
442.         return False
443.     if not shutil.which("tex"):
444.         _log.warning("usetex mode requires TeX.")
445.         return False
446.     try:
447.         _get_executable_info("dvipng")
448.     except ExecutableNotFoundError:
449.         _log.warning("usetex mode requires dvipng.")
450.         return False
451.     try:
452.         _get_executable_info("gs")
453.     except ExecutableNotFoundError:
454.         _log.warning("usetex mode requires ghostscript.")
455.         return False
456.     return True
457. 
458. 
459. def _get_xdg_config_dir():
460.     """
461.     Return the XDG configuration directory, according to the XDG base
462.     directory spec:
463. 
464.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
465.     """
466.     return os.environ.get('XDG_CONFIG_HOME') or str(Path.home() / ".config")
467. 
468. 
469. def _get_xdg_cache_dir():
470.     """
471.     Return the XDG cache directory, according to the XDG base directory spec:
472. 
473.     https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
474.     """
475.     return os.environ.get('XDG_CACHE_HOME') or str(Path.home() / ".cache")
476. 
477. 
478. def _get_config_or_cache_dir(xdg_base_getter):
479.     configdir = os.environ.get('MPLCONFIGDIR')
480.     if configdir:
481.         configdir = Path(configdir).resolve()
482.     elif sys.platform.startswith(('linux', 'freebsd')):
483.         # Only call _xdg_base_getter here so that MPLCONFIGDIR is tried first,
484.         # as _xdg_base_getter can throw.
485.         configdir = Path(xdg_base_getter(), "matplotlib")
486.     else:
487.         configdir = Path.home() / ".matplotlib"
488.     try:
489.         configdir.mkdir(parents=True, exist_ok=True)
490.     except OSError:
491.         pass
492.     else:
493.         if os.access(str(configdir), os.W_OK) and configdir.is_dir():
494.             return str(configdir)
495.     # If the config or cache directory cannot be created or is not a writable
496.     # directory, create a temporary one.
497.     tmpdir = os.environ["MPLCONFIGDIR"] = \
498.         tempfile.mkdtemp(prefix="matplotlib-")
499.     atexit.register(shutil.rmtree, tmpdir)
500.     _log.warning(


File: lib/matplotlib/__init__.py
Line number range: 515 - 832
Content:
515.     The directory is chosen as follows:
516. 
517.     1. If the MPLCONFIGDIR environment variable is supplied, choose that.
518.     2. On Linux, follow the XDG specification and look first in
519.        ``$XDG_CONFIG_HOME``, if defined, or ``$HOME/.config``.  On other
520.        platforms, choose ``$HOME/.matplotlib``.
521.     3. If the chosen directory exists and is writable, use that as the
522.        configuration directory.
523.     4. Else, create a temporary directory, and use it as the configuration
524.        directory.
525.     """
526.     return _get_config_or_cache_dir(_get_xdg_config_dir)
527. 
528. 
529. @_logged_cached('CACHEDIR=%s')
530. def get_cachedir():
531.     """
532.     Return the string path of the cache directory.
533. 
534.     The procedure used to find the directory is the same as for
535.     _get_config_dir, except using ``$XDG_CACHE_HOME``/``$HOME/.cache`` instead.
536.     """
537.     return _get_config_or_cache_dir(_get_xdg_cache_dir)
538. 
539. 
540. @_logged_cached('matplotlib data path: %s')
541. def get_data_path():
542.     """Return the path to Matplotlib data."""
543.     return str(Path(__file__).with_name("mpl-data"))
544. 
545. 
546. def matplotlib_fname():
547.     """
548.     Get the location of the config file.
549. 
550.     The file location is determined in the following order
551. 
552.     - ``$PWD/matplotlibrc``
553.     - ``$MATPLOTLIBRC`` if it is not a directory
554.     - ``$MATPLOTLIBRC/matplotlibrc``
555.     - ``$MPLCONFIGDIR/matplotlibrc``
556.     - On Linux,
557.         - ``$XDG_CONFIG_HOME/matplotlib/matplotlibrc`` (if ``$XDG_CONFIG_HOME``
558.           is defined)
559.         - or ``$HOME/.config/matplotlib/matplotlibrc`` (if ``$XDG_CONFIG_HOME``
560.           is not defined)
561.     - On other platforms,
562.       - ``$HOME/.matplotlib/matplotlibrc`` if ``$HOME`` is defined
563.     - Lastly, it looks in ``$MATPLOTLIBDATA/matplotlibrc``, which should always
564.       exist.
565.     """
566. 
567.     def gen_candidates():
568.         # rely on down-stream code to make absolute.  This protects us
569.         # from having to directly get the current working directory
570.         # which can fail if the user has ended up with a cwd that is
571.         # non-existent.
572.         yield 'matplotlibrc'
573.         try:
574.             matplotlibrc = os.environ['MATPLOTLIBRC']
575.         except KeyError:
576.             pass
577.         else:
578.             yield matplotlibrc
579.             yield os.path.join(matplotlibrc, 'matplotlibrc')
580.         yield os.path.join(get_configdir(), 'matplotlibrc')
581.         yield os.path.join(get_data_path(), 'matplotlibrc')
582. 
583.     for fname in gen_candidates():
584.         if os.path.exists(fname) and not os.path.isdir(fname):
585.             return fname
586. 
587.     raise RuntimeError("Could not find matplotlibrc file; your Matplotlib "
588.                        "install is broken")
589. 
590. 
591. # rcParams deprecated and automatically mapped to another key.
592. # Values are tuples of (version, new_name, f_old2new, f_new2old).
593. _deprecated_map = {}
594. # rcParams deprecated; some can manually be mapped to another key.
595. # Values are tuples of (version, new_name_or_None).
596. _deprecated_ignore_map = {}
597. # rcParams deprecated; can use None to suppress warnings; remain actually
598. # listed in the rcParams.
599. # Values are tuples of (version,)
600. _deprecated_remain_as_none = {}
601. 
602. 
603. @_docstring.Substitution(
604.     "\n".join(map("- {}".format, sorted(rcsetup._validators, key=str.lower)))
605. )
606. class RcParams(MutableMapping, dict):
607.     """
608.     A dictionary object including validation.
609. 
610.     Validating functions are defined and associated with rc parameters in
611.     :mod:`matplotlib.rcsetup`.
612. 
613.     The list of rcParams is:
614. 
615.     %s
616. 
617.     See Also
618.     --------
619.     :ref:`customizing-with-matplotlibrc-files`
620.     """
621. 
622.     validate = rcsetup._validators
623. 
624.     # validate values on the way in
625.     def __init__(self, *args, **kwargs):
626.         self.update(*args, **kwargs)
627. 
628.     def __setitem__(self, key, val):
629.         try:
630.             if key in _deprecated_map:
631.                 version, alt_key, alt_val, inverse_alt = _deprecated_map[key]
632.                 _api.warn_deprecated(
633.                     version, name=key, obj_type="rcparam", alternative=alt_key)
634.                 key = alt_key
635.                 val = alt_val(val)
636.             elif key in _deprecated_remain_as_none and val is not None:
637.                 version, = _deprecated_remain_as_none[key]
638.                 _api.warn_deprecated(version, name=key, obj_type="rcparam")
639.             elif key in _deprecated_ignore_map:
640.                 version, alt_key = _deprecated_ignore_map[key]
641.                 _api.warn_deprecated(
642.                     version, name=key, obj_type="rcparam", alternative=alt_key)
643.                 return
644.             elif key == 'backend':
645.                 if val is rcsetup._auto_backend_sentinel:
646.                     if 'backend' in self:
647.                         return
648.             try:
649.                 cval = self.validate[key](val)
650.             except ValueError as ve:
651.                 raise ValueError(f"Key {key}: {ve}") from None
652.             dict.__setitem__(self, key, cval)
653.         except KeyError as err:
654.             raise KeyError(
655.                 f"{key} is not a valid rc parameter (see rcParams.keys() for "
656.                 f"a list of valid parameters)") from err
657. 
658.     def __getitem__(self, key):
659.         if key in _deprecated_map:
660.             version, alt_key, alt_val, inverse_alt = _deprecated_map[key]
661.             _api.warn_deprecated(
662.                 version, name=key, obj_type="rcparam", alternative=alt_key)
663.             return inverse_alt(dict.__getitem__(self, alt_key))
664. 
665.         elif key in _deprecated_ignore_map:
666.             version, alt_key = _deprecated_ignore_map[key]
667.             _api.warn_deprecated(
668.                 version, name=key, obj_type="rcparam", alternative=alt_key)
669.             return dict.__getitem__(self, alt_key) if alt_key else None
670. 
671.         # In theory, this should only ever be used after the global rcParams
672.         # has been set up, but better be safe e.g. in presence of breakpoints.
673.         elif key == "backend" and self is globals().get("rcParams"):
674.             val = dict.__getitem__(self, key)
675.             if val is rcsetup._auto_backend_sentinel:
676.                 from matplotlib import pyplot as plt
677.                 plt.switch_backend(rcsetup._auto_backend_sentinel)
678. 
679.         return dict.__getitem__(self, key)
680. 
681.     def _get_backend_or_none(self):
682.         """Get the requested backend, if any, without triggering resolution."""
683.         backend = dict.__getitem__(self, "backend")
684.         return None if backend is rcsetup._auto_backend_sentinel else backend
685. 
686.     def __repr__(self):
687.         class_name = self.__class__.__name__
688.         indent = len(class_name) + 1
689.         with _api.suppress_matplotlib_deprecation_warning():
690.             repr_split = pprint.pformat(dict(self), indent=1,
691.                                         width=80 - indent).split('\n')
692.         repr_indented = ('\n' + ' ' * indent).join(repr_split)
693.         return '{}({})'.format(class_name, repr_indented)
694. 
695.     def __str__(self):
696.         return '\n'.join(map('{0[0]}: {0[1]}'.format, sorted(self.items())))
697. 
698.     def __iter__(self):
699.         """Yield sorted list of keys."""
700.         with _api.suppress_matplotlib_deprecation_warning():
701.             yield from sorted(dict.__iter__(self))
702. 
703.     def __len__(self):
704.         return dict.__len__(self)
705. 
706.     def find_all(self, pattern):
707.         """
708.         Return the subset of this RcParams dictionary whose keys match,
709.         using :func:`re.search`, the given ``pattern``.
710. 
711.         .. note::
712. 
713.             Changes to the returned dictionary are *not* propagated to
714.             the parent RcParams dictionary.
715. 
716.         """
717.         pattern_re = re.compile(pattern)
718.         return RcParams((key, value)
719.                         for key, value in self.items()
720.                         if pattern_re.search(key))
721. 
722.     def copy(self):
723.         rccopy = RcParams()
724.         for k in self:  # Skip deprecations and revalidation.
725.             dict.__setitem__(rccopy, k, dict.__getitem__(self, k))
726.         return rccopy
727. 
728. 
729. def rc_params(fail_on_error=False):
730.     """Construct a `RcParams` instance from the default Matplotlib rc file."""
731.     return rc_params_from_file(matplotlib_fname(), fail_on_error)
732. 
733. 
734. @_api.deprecated("3.5")
735. def is_url(filename):
736.     """Return whether *filename* is an http, https, ftp, or file URL path."""
737.     return __getattr__("URL_REGEX").match(filename) is not None
738. 
739. 
740. @functools.lru_cache()
741. def _get_ssl_context():
742.     try:
743.         import certifi
744.     except ImportError:
745.         _log.debug("Could not import certifi.")
746.         return None
747.     import ssl
748.     return ssl.create_default_context(cafile=certifi.where())
749. 
750. 
751. @contextlib.contextmanager
752. def _open_file_or_url(fname):
753.     if (isinstance(fname, str)
754.             and fname.startswith(('http://', 'https://', 'ftp://', 'file:'))):
755.         import urllib.request
756.         ssl_ctx = _get_ssl_context()
757.         if ssl_ctx is None:
758.             _log.debug(
759.                 "Could not get certifi ssl context, https may not work."
760.             )
761.         with urllib.request.urlopen(fname, context=ssl_ctx) as f:
762.             yield (line.decode('utf-8') for line in f)
763.     else:
764.         fname = os.path.expanduser(fname)
765.         with open(fname, encoding='utf-8') as f:
766.             yield f
767. 
768. 
769. def _rc_params_in_file(fname, transform=lambda x: x, fail_on_error=False):
770.     """
771.     Construct a `RcParams` instance from file *fname*.
772. 
773.     Unlike `rc_params_from_file`, the configuration class only contains the
774.     parameters specified in the file (i.e. default values are not filled in).
775. 
776.     Parameters
777.     ----------
778.     fname : path-like
779.         The loaded file.
780.     transform : callable, default: the identity function
781.         A function called on each individual line of the file to transform it,
782.         before further parsing.
783.     fail_on_error : bool, default: False
784.         Whether invalid entries should result in an exception or a warning.
785.     """
786.     import matplotlib as mpl
787.     rc_temp = {}
788.     with _open_file_or_url(fname) as fd:
789.         try:
790.             for line_no, line in enumerate(fd, 1):
791.                 line = transform(line)
792.                 strippedline = cbook._strip_comment(line)
793.                 if not strippedline:
794.                     continue
795.                 tup = strippedline.split(':', 1)
796.                 if len(tup) != 2:
797.                     _log.warning('Missing colon in file %r, line %d (%r)',
798.                                  fname, line_no, line.rstrip('\n'))
799.                     continue
800.                 key, val = tup
801.                 key = key.strip()
802.                 val = val.strip()
803.                 if val.startswith('"') and val.endswith('"'):
804.                     val = val[1:-1]  # strip double quotes
805.                 if key in rc_temp:
806.                     _log.warning('Duplicate key in file %r, line %d (%r)',
807.                                  fname, line_no, line.rstrip('\n'))
808.                 rc_temp[key] = (val, line, line_no)
809.         except UnicodeDecodeError:
810.             _log.warning('Cannot decode configuration file %r as utf-8.',
811.                          fname)
812.             raise
813. 
814.     config = RcParams()
815. 
816.     for key, (val, line, line_no) in rc_temp.items():
817.         if key in rcsetup._validators:
818.             if fail_on_error:
819.                 config[key] = val  # try to convert to proper type or raise
820.             else:
821.                 try:
822.                     config[key] = val  # try to convert to proper type or skip
823.                 except Exception as msg:
824.                     _log.warning('Bad value in file %r, line %d (%r): %s',
825.                                  fname, line_no, line.rstrip('\n'), msg)
826.         elif key in _deprecated_ignore_map:
827.             version, alt_key = _deprecated_ignore_map[key]
828.             _api.warn_deprecated(
829.                 version, name=key, alternative=alt_key, obj_type='rcparam',
830.                 addendum="Please update your matplotlibrc.")
831.         else:
832.             # __version__ must be looked up as an attribute to trigger the


File: lib/matplotlib/__init__.py
Line number range: 833 - 884
Content:
833.             # module-level __getattr__.
834.             version = ('main' if '.post' in mpl.__version__
835.                        else f'v{mpl.__version__}')
836.             _log.warning("""
837. Bad key %(key)s in file %(fname)s, line %(line_no)s (%(line)r)
838. You probably need to get an updated matplotlibrc file from
839. https://github.com/matplotlib/matplotlib/blob/%(version)s/matplotlibrc.template
840. or from the matplotlib source distribution""",
841.                          dict(key=key, fname=fname, line_no=line_no,
842.                               line=line.rstrip('\n'), version=version))
843.     return config
844. 
845. 
846. def rc_params_from_file(fname, fail_on_error=False, use_default_template=True):
847.     """
848.     Construct a `RcParams` from file *fname*.
849. 
850.     Parameters
851.     ----------
852.     fname : str or path-like
853.         A file with Matplotlib rc settings.
854.     fail_on_error : bool
855.         If True, raise an error when the parser fails to convert a parameter.
856.     use_default_template : bool
857.         If True, initialize with default parameters before updating with those
858.         in the given file. If False, the configuration class only contains the
859.         parameters specified in the file. (Useful for updating dicts.)
860.     """
861.     config_from_file = _rc_params_in_file(fname, fail_on_error=fail_on_error)
862. 
863.     if not use_default_template:
864.         return config_from_file
865. 
866.     with _api.suppress_matplotlib_deprecation_warning():
867.         config = RcParams({**rcParamsDefault, **config_from_file})
868. 
869.     if "".join(config['text.latex.preamble']):
870.         _log.info("""
871. *****************************************************************
872. You have the following UNSUPPORTED LaTeX preamble customizations:
873. %s
874. Please do not ask for support with these customizations active.
875. *****************************************************************
876. """, '\n'.join(config['text.latex.preamble']))
877.     _log.debug('loaded rc file %s', fname)
878. 
879.     return config
880. 
881. 
882. # When constructing the global instances, we need to perform certain updates
883. # by explicitly calling the superclass (dict.update, dict.items) to avoid
884. # triggering resolution of _auto_backend_sentinel.


File: lib/matplotlib/rcsetup.py
Line number range: 1 - 500
Content:
1. """
2. The rcsetup module contains the validation code for customization using
3. Matplotlib's rc settings.
4. 
5. Each rc setting is assigned a function used to validate any attempted changes
6. to that setting.  The validation functions are defined in the rcsetup module,
7. and are used to construct the rcParams global object which stores the settings
8. and is referenced throughout Matplotlib.
9. 
10. The default values of the rc settings are set in the default matplotlibrc file.
11. Any additions or deletions to the parameter set listed here should also be
12. propagated to the :file:`matplotlibrc.template` in Matplotlib's root source
13. directory.
14. """
15. 
16. import ast
17. from functools import lru_cache, reduce
18. from numbers import Number
19. import operator
20. import os
21. import re
22. 
23. import numpy as np
24. 
25. from matplotlib import _api, cbook
26. from matplotlib.cbook import ls_mapper
27. from matplotlib.colors import Colormap, is_color_like
28. from matplotlib._fontconfig_pattern import parse_fontconfig_pattern
29. from matplotlib._enums import JoinStyle, CapStyle
30. 
31. # Don't let the original cycler collide with our validating cycler
32. from cycler import Cycler, cycler as ccycler
33. 
34. 
35. # The capitalized forms are needed for ipython at present; this may
36. # change for later versions.
37. interactive_bk = [
38.     'GTK3Agg', 'GTK3Cairo', 'GTK4Agg', 'GTK4Cairo',
39.     'MacOSX',
40.     'nbAgg',
41.     'QtAgg', 'QtCairo', 'Qt5Agg', 'Qt5Cairo',
42.     'TkAgg', 'TkCairo',
43.     'WebAgg',
44.     'WX', 'WXAgg', 'WXCairo',
45. ]
46. non_interactive_bk = ['agg', 'cairo',
47.                       'pdf', 'pgf', 'ps', 'svg', 'template']
48. all_backends = interactive_bk + non_interactive_bk
49. 
50. 
51. class ValidateInStrings:
52.     def __init__(self, key, valid, ignorecase=False, *,
53.                  _deprecated_since=None):
54.         """*valid* is a list of legal strings."""
55.         self.key = key
56.         self.ignorecase = ignorecase
57.         self._deprecated_since = _deprecated_since
58. 
59.         def func(s):
60.             if ignorecase:
61.                 return s.lower()
62.             else:
63.                 return s
64.         self.valid = {func(k): k for k in valid}
65. 
66.     def __call__(self, s):
67.         if self._deprecated_since:
68.             name, = (k for k, v in globals().items() if v is self)
69.             _api.warn_deprecated(
70.                 self._deprecated_since, name=name, obj_type="function")
71.         if self.ignorecase:
72.             s = s.lower()
73.         if s in self.valid:
74.             return self.valid[s]
75.         msg = (f"{s!r} is not a valid value for {self.key}; supported values "
76.                f"are {[*self.valid.values()]}")
77.         if (isinstance(s, str)
78.                 and (s.startswith('"') and s.endswith('"')
79.                      or s.startswith("'") and s.endswith("'"))
80.                 and s[1:-1] in self.valid):
81.             msg += "; remove quotes surrounding your string"
82.         raise ValueError(msg)
83. 
84. 
85. @lru_cache()
86. def _listify_validator(scalar_validator, allow_stringlist=False, *,
87.                        n=None, doc=None):
88.     def f(s):
89.         if isinstance(s, str):
90.             try:
91.                 val = [scalar_validator(v.strip()) for v in s.split(',')
92.                        if v.strip()]
93.             except Exception:
94.                 if allow_stringlist:
95.                     # Sometimes, a list of colors might be a single string
96.                     # of single-letter colornames. So give that a shot.
97.                     val = [scalar_validator(v.strip()) for v in s if v.strip()]
98.                 else:
99.                     raise
100.         # Allow any ordered sequence type -- generators, np.ndarray, pd.Series
101.         # -- but not sets, whose iteration order is non-deterministic.
102.         elif np.iterable(s) and not isinstance(s, (set, frozenset)):
103.             # The condition on this list comprehension will preserve the
104.             # behavior of filtering out any empty strings (behavior was
105.             # from the original validate_stringlist()), while allowing
106.             # any non-string/text scalar values such as numbers and arrays.
107.             val = [scalar_validator(v) for v in s
108.                    if not isinstance(v, str) or v]
109.         else:
110.             raise ValueError(
111.                 f"Expected str or other non-set iterable, but got {s}")
112.         if n is not None and len(val) != n:
113.             raise ValueError(
114.                 f"Expected {n} values, but there are {len(val)} values in {s}")
115.         return val
116. 
117.     try:
118.         f.__name__ = "{}list".format(scalar_validator.__name__)
119.     except AttributeError:  # class instance.
120.         f.__name__ = "{}List".format(type(scalar_validator).__name__)
121.     f.__qualname__ = f.__qualname__.rsplit(".", 1)[0] + "." + f.__name__
122.     f.__doc__ = doc if doc is not None else scalar_validator.__doc__
123.     return f
124. 
125. 
126. def validate_any(s):
127.     return s
128. validate_anylist = _listify_validator(validate_any)
129. 
130. 
131. def _validate_date(s):
132.     try:
133.         np.datetime64(s)
134.         return s
135.     except ValueError:
136.         raise ValueError(
137.             f'{s!r} should be a string that can be parsed by numpy.datetime64')
138. 
139. 
140. def validate_bool(b):
141.     """Convert b to ``bool`` or raise."""
142.     if isinstance(b, str):
143.         b = b.lower()
144.     if b in ('t', 'y', 'yes', 'on', 'true', '1', 1, True):
145.         return True
146.     elif b in ('f', 'n', 'no', 'off', 'false', '0', 0, False):
147.         return False
148.     else:
149.         raise ValueError(f'Cannot convert {b!r} to bool')
150. 
151. 
152. def validate_axisbelow(s):
153.     try:
154.         return validate_bool(s)
155.     except ValueError:
156.         if isinstance(s, str):
157.             if s == 'line':
158.                 return 'line'
159.     raise ValueError(f'{s!r} cannot be interpreted as'
160.                      ' True, False, or "line"')
161. 
162. 
163. def validate_dpi(s):
164.     """Confirm s is string 'figure' or convert s to float or raise."""
165.     if s == 'figure':
166.         return s
167.     try:
168.         return float(s)
169.     except ValueError as e:
170.         raise ValueError(f'{s!r} is not string "figure" and '
171.                          f'could not convert {s!r} to float') from e
172. 
173. 
174. def _make_type_validator(cls, *, allow_none=False):
175.     """
176.     Return a validator that converts inputs to *cls* or raises (and possibly
177.     allows ``None`` as well).
178.     """
179. 
180.     def validator(s):
181.         if (allow_none and
182.                 (s is None or isinstance(s, str) and s.lower() == "none")):
183.             return None
184.         if cls is str and not isinstance(s, str):
185.             _api.warn_deprecated(
186.                 "3.5", message="Support for setting an rcParam that expects a "
187.                 "str value to a non-str value is deprecated since %(since)s "
188.                 "and support will be removed %(removal)s.")
189.         try:
190.             return cls(s)
191.         except (TypeError, ValueError) as e:
192.             raise ValueError(
193.                 f'Could not convert {s!r} to {cls.__name__}') from e
194. 
195.     validator.__name__ = f"validate_{cls.__name__}"
196.     if allow_none:
197.         validator.__name__ += "_or_None"
198.     validator.__qualname__ = (
199.         validator.__qualname__.rsplit(".", 1)[0] + "." + validator.__name__)
200.     return validator
201. 
202. 
203. validate_string = _make_type_validator(str)
204. validate_string_or_None = _make_type_validator(str, allow_none=True)
205. validate_stringlist = _listify_validator(
206.     validate_string, doc='return a list of strings')
207. validate_int = _make_type_validator(int)
208. validate_int_or_None = _make_type_validator(int, allow_none=True)
209. validate_float = _make_type_validator(float)
210. validate_float_or_None = _make_type_validator(float, allow_none=True)
211. validate_floatlist = _listify_validator(
212.     validate_float, doc='return a list of floats')
213. 
214. 
215. def _validate_pathlike(s):
216.     if isinstance(s, (str, os.PathLike)):
217.         # Store value as str because savefig.directory needs to distinguish
218.         # between "" (cwd) and "." (cwd, but gets updated by user selections).
219.         return os.fsdecode(s)
220.     else:
221.         return validate_string(s)  # Emit deprecation warning.
222. 
223. 
224. def validate_fonttype(s):
225.     """
226.     Confirm that this is a Postscript or PDF font type that we know how to
227.     convert to.
228.     """
229.     fonttypes = {'type3':    3,
230.                  'truetype': 42}
231.     try:
232.         fonttype = validate_int(s)
233.     except ValueError:
234.         try:
235.             return fonttypes[s.lower()]
236.         except KeyError as e:
237.             raise ValueError('Supported Postscript/PDF font types are %s'
238.                              % list(fonttypes)) from e
239.     else:
240.         if fonttype not in fonttypes.values():
241.             raise ValueError(
242.                 'Supported Postscript/PDF font types are %s' %
243.                 list(fonttypes.values()))
244.         return fonttype
245. 
246. 
247. _validate_standard_backends = ValidateInStrings(
248.     'backend', all_backends, ignorecase=True)
249. _auto_backend_sentinel = object()
250. 
251. 
252. def validate_backend(s):
253.     backend = (
254.         s if s is _auto_backend_sentinel or s.startswith("module://")
255.         else _validate_standard_backends(s))
256.     return backend
257. 
258. 
259. def _validate_toolbar(s):
260.     s = ValidateInStrings(
261.         'toolbar', ['None', 'toolbar2', 'toolmanager'], ignorecase=True)(s)
262.     if s == 'toolmanager':
263.         _api.warn_external(
264.             "Treat the new Tool classes introduced in v1.5 as experimental "
265.             "for now; the API and rcParam may change in future versions.")
266.     return s
267. 
268. 
269. def validate_color_or_inherit(s):
270.     """Return a valid color arg."""
271.     if cbook._str_equal(s, 'inherit'):
272.         return s
273.     return validate_color(s)
274. 
275. 
276. def validate_color_or_auto(s):
277.     if cbook._str_equal(s, 'auto'):
278.         return s
279.     return validate_color(s)
280. 
281. 
282. def validate_color_for_prop_cycle(s):
283.     # N-th color cycle syntax can't go into the color cycle.
284.     if isinstance(s, str) and re.match("^C[0-9]$", s):
285.         raise ValueError(f"Cannot put cycle reference ({s!r}) in prop_cycler")
286.     return validate_color(s)
287. 
288. 
289. def _validate_color_or_linecolor(s):
290.     if cbook._str_equal(s, 'linecolor'):
291.         return s
292.     elif cbook._str_equal(s, 'mfc') or cbook._str_equal(s, 'markerfacecolor'):
293.         return 'markerfacecolor'
294.     elif cbook._str_equal(s, 'mec') or cbook._str_equal(s, 'markeredgecolor'):
295.         return 'markeredgecolor'
296.     elif s is None:
297.         return None
298.     elif isinstance(s, str) and len(s) == 6 or len(s) == 8:
299.         stmp = '#' + s
300.         if is_color_like(stmp):
301.             return stmp
302.         if s.lower() == 'none':
303.             return None
304.     elif is_color_like(s):
305.         return s
306. 
307.     raise ValueError(f'{s!r} does not look like a color arg')
308. 
309. 
310. def validate_color(s):
311.     """Return a valid color arg."""
312.     if isinstance(s, str):
313.         if s.lower() == 'none':
314.             return 'none'
315.         if len(s) == 6 or len(s) == 8:
316.             stmp = '#' + s
317.             if is_color_like(stmp):
318.                 return stmp
319. 
320.     if is_color_like(s):
321.         return s
322. 
323.     # If it is still valid, it must be a tuple (as a string from matplotlibrc).
324.     try:
325.         color = ast.literal_eval(s)
326.     except (SyntaxError, ValueError):
327.         pass
328.     else:
329.         if is_color_like(color):
330.             return color
331. 
332.     raise ValueError(f'{s!r} does not look like a color arg')
333. 
334. 
335. validate_colorlist = _listify_validator(
336.     validate_color, allow_stringlist=True, doc='return a list of colorspecs')
337. 
338. 
339. def _validate_cmap(s):
340.     _api.check_isinstance((str, Colormap), cmap=s)
341.     return s
342. 
343. 
344. def validate_aspect(s):
345.     if s in ('auto', 'equal'):
346.         return s
347.     try:
348.         return float(s)
349.     except ValueError as e:
350.         raise ValueError('not a valid aspect specification') from e
351. 
352. 
353. def validate_fontsize_None(s):
354.     if s is None or s == 'None':
355.         return None
356.     else:
357.         return validate_fontsize(s)
358. 
359. 
360. def validate_fontsize(s):
361.     fontsizes = ['xx-small', 'x-small', 'small', 'medium', 'large',
362.                  'x-large', 'xx-large', 'smaller', 'larger']
363.     if isinstance(s, str):
364.         s = s.lower()
365.     if s in fontsizes:
366.         return s
367.     try:
368.         return float(s)
369.     except ValueError as e:
370.         raise ValueError("%s is not a valid font size. Valid font sizes "
371.                          "are %s." % (s, ", ".join(fontsizes))) from e
372. 
373. 
374. validate_fontsizelist = _listify_validator(validate_fontsize)
375. 
376. 
377. def validate_fontweight(s):
378.     weights = [
379.         'ultralight', 'light', 'normal', 'regular', 'book', 'medium', 'roman',
380.         'semibold', 'demibold', 'demi', 'bold', 'heavy', 'extra bold', 'black']
381.     # Note: Historically, weights have been case-sensitive in Matplotlib
382.     if s in weights:
383.         return s
384.     try:
385.         return int(s)
386.     except (ValueError, TypeError) as e:
387.         raise ValueError(f'{s} is not a valid font weight.') from e
388. 
389. 
390. def validate_fontstretch(s):
391.     stretchvalues = [
392.         'ultra-condensed', 'extra-condensed', 'condensed', 'semi-condensed',
393.         'normal', 'semi-expanded', 'expanded', 'extra-expanded',
394.         'ultra-expanded']
395.     # Note: Historically, stretchvalues have been case-sensitive in Matplotlib
396.     if s in stretchvalues:
397.         return s
398.     try:
399.         return int(s)
400.     except (ValueError, TypeError) as e:
401.         raise ValueError(f'{s} is not a valid font stretch.') from e
402. 
403. 
404. def validate_font_properties(s):
405.     parse_fontconfig_pattern(s)
406.     return s
407. 
408. 
409. def _validate_mathtext_fallback(s):
410.     _fallback_fonts = ['cm', 'stix', 'stixsans']
411.     if isinstance(s, str):
412.         s = s.lower()
413.     if s is None or s == 'none':
414.         return None
415.     elif s.lower() in _fallback_fonts:
416.         return s
417.     else:
418.         raise ValueError(
419.             f"{s} is not a valid fallback font name. Valid fallback font "
420.             f"names are {','.join(_fallback_fonts)}. Passing 'None' will turn "
421.             "fallback off.")
422. 
423. 
424. def validate_whiskers(s):
425.     try:
426.         return _listify_validator(validate_float, n=2)(s)
427.     except (TypeError, ValueError):
428.         try:
429.             return float(s)
430.         except ValueError as e:
431.             raise ValueError("Not a valid whisker value [float, "
432.                              "(float, float)]") from e
433. 
434. 
435. def validate_ps_distiller(s):
436.     if isinstance(s, str):
437.         s = s.lower()
438.     if s in ('none', None, 'false', False):
439.         return None
440.     else:
441.         return ValidateInStrings('ps.usedistiller', ['ghostscript', 'xpdf'])(s)
442. 
443. 
444. # A validator dedicated to the named line styles, based on the items in
445. # ls_mapper, and a list of possible strings read from Line2D.set_linestyle
446. _validate_named_linestyle = ValidateInStrings(
447.     'linestyle',
448.     [*ls_mapper.keys(), *ls_mapper.values(), 'None', 'none', ' ', ''],
449.     ignorecase=True)
450. 
451. 
452. def _validate_linestyle(ls):
453.     """
454.     A validator for all possible line styles, the named ones *and*
455.     the on-off ink sequences.
456.     """
457.     if isinstance(ls, str):
458.         try:  # Look first for a valid named line style, like '--' or 'solid'.
459.             return _validate_named_linestyle(ls)
460.         except ValueError:
461.             pass
462.         try:
463.             ls = ast.literal_eval(ls)  # Parsing matplotlibrc.
464.         except (SyntaxError, ValueError):
465.             pass  # Will error with the ValueError at the end.
466. 
467.     def _is_iterable_not_string_like(x):
468.         # Explicitly exclude bytes/bytearrays so that they are not
469.         # nonsensically interpreted as sequences of numbers (codepoints).
470.         return np.iterable(x) and not isinstance(x, (str, bytes, bytearray))
471. 
472.     if _is_iterable_not_string_like(ls):
473.         if len(ls) == 2 and _is_iterable_not_string_like(ls[1]):
474.             # (offset, (on, off, on, off, ...))
475.             offset, onoff = ls
476.         else:
477.             # For backcompat: (on, off, on, off, ...); the offset is implicit.
478.             offset = 0
479.             onoff = ls
480. 
481.         if (isinstance(offset, Number)
482.                 and len(onoff) % 2 == 0
483.                 and all(isinstance(elem, Number) for elem in onoff)):
484.             return (offset, onoff)
485. 
486.     raise ValueError(f"linestyle {ls!r} is not a valid on-off ink sequence.")
487. 
488. 
489. validate_fillstyle = ValidateInStrings(
490.     'markers.fillstyle', ['full', 'left', 'right', 'bottom', 'top', 'none'])
491. 
492. 
493. validate_fillstylelist = _listify_validator(validate_fillstyle)
494. 
495. 
496. def validate_markevery(s):
497.     """
498.     Validate the markevery property of a Line2D object.
499. 
500.     Parameters


File: lib/matplotlib/tests/test_pyplot.py
Line number range: 1 - 385
Content:
1. import difflib
2. import re
3. 
4. import numpy as np
5. import subprocess
6. import sys
7. from pathlib import Path
8. 
9. import pytest
10. 
11. import matplotlib as mpl
12. from matplotlib import pyplot as plt
13. from matplotlib._api import MatplotlibDeprecationWarning
14. 
15. 
16. def test_pyplot_up_to_date(tmpdir):
17.     gen_script = Path(mpl.__file__).parents[2] / "tools/boilerplate.py"
18.     if not gen_script.exists():
19.         pytest.skip("boilerplate.py not found")
20.     orig_contents = Path(plt.__file__).read_text()
21.     plt_file = tmpdir.join('pyplot.py')
22.     plt_file.write_text(orig_contents, 'utf-8')
23. 
24.     subprocess.run([sys.executable, str(gen_script), str(plt_file)],
25.                    check=True)
26.     new_contents = plt_file.read_text('utf-8')
27. 
28.     if orig_contents != new_contents:
29.         diff_msg = '\n'.join(
30.             difflib.unified_diff(
31.                 orig_contents.split('\n'), new_contents.split('\n'),
32.                 fromfile='found pyplot.py',
33.                 tofile='expected pyplot.py',
34.                 n=0, lineterm=''))
35.         pytest.fail(
36.             "pyplot.py is not up-to-date. Please run "
37.             "'python tools/boilerplate.py' to update pyplot.py. "
38.             "This needs to be done from an environment where your "
39.             "current working copy is installed (e.g. 'pip install -e'd). "
40.             "Here is a diff of unexpected differences:\n%s" % diff_msg
41.         )
42. 
43. 
44. def test_copy_docstring_and_deprecators(recwarn):
45.     @mpl._api.rename_parameter("(version)", "old", "new")
46.     @mpl._api.make_keyword_only("(version)", "kwo")
47.     def func(new, kwo=None):
48.         pass
49. 
50.     @plt._copy_docstring_and_deprecators(func)
51.     def wrapper_func(new, kwo=None):
52.         pass
53. 
54.     wrapper_func(None)
55.     wrapper_func(new=None)
56.     wrapper_func(None, kwo=None)
57.     wrapper_func(new=None, kwo=None)
58.     assert not recwarn
59.     with pytest.warns(MatplotlibDeprecationWarning):
60.         wrapper_func(old=None)
61.     with pytest.warns(MatplotlibDeprecationWarning):
62.         wrapper_func(None, None)
63. 
64. 
65. def test_pyplot_box():
66.     fig, ax = plt.subplots()
67.     plt.box(False)
68.     assert not ax.get_frame_on()
69.     plt.box(True)
70.     assert ax.get_frame_on()
71.     plt.box()
72.     assert not ax.get_frame_on()
73.     plt.box()
74.     assert ax.get_frame_on()
75. 
76. 
77. def test_stackplot_smoke():
78.     # Small smoke test for stackplot (see #12405)
79.     plt.stackplot([1, 2, 3], [1, 2, 3])
80. 
81. 
82. def test_nrows_error():
83.     with pytest.raises(TypeError):
84.         plt.subplot(nrows=1)
85.     with pytest.raises(TypeError):
86.         plt.subplot(ncols=1)
87. 
88. 
89. def test_ioff():
90.     plt.ion()
91.     assert mpl.is_interactive()
92.     with plt.ioff():
93.         assert not mpl.is_interactive()
94.     assert mpl.is_interactive()
95. 
96.     plt.ioff()
97.     assert not mpl.is_interactive()
98.     with plt.ioff():
99.         assert not mpl.is_interactive()
100.     assert not mpl.is_interactive()
101. 
102. 
103. def test_ion():
104.     plt.ioff()
105.     assert not mpl.is_interactive()
106.     with plt.ion():
107.         assert mpl.is_interactive()
108.     assert not mpl.is_interactive()
109. 
110.     plt.ion()
111.     assert mpl.is_interactive()
112.     with plt.ion():
113.         assert mpl.is_interactive()
114.     assert mpl.is_interactive()
115. 
116. 
117. def test_nested_ion_ioff():
118.     # initial state is interactive
119.     plt.ion()
120. 
121.     # mixed ioff/ion
122.     with plt.ioff():
123.         assert not mpl.is_interactive()
124.         with plt.ion():
125.             assert mpl.is_interactive()
126.         assert not mpl.is_interactive()
127.     assert mpl.is_interactive()
128. 
129.     # redundant contexts
130.     with plt.ioff():
131.         with plt.ioff():
132.             assert not mpl.is_interactive()
133.     assert mpl.is_interactive()
134. 
135.     with plt.ion():
136.         plt.ioff()
137.     assert mpl.is_interactive()
138. 
139.     # initial state is not interactive
140.     plt.ioff()
141. 
142.     # mixed ioff/ion
143.     with plt.ion():
144.         assert mpl.is_interactive()
145.         with plt.ioff():
146.             assert not mpl.is_interactive()
147.         assert mpl.is_interactive()
148.     assert not mpl.is_interactive()
149. 
150.     # redundant contexts
151.     with plt.ion():
152.         with plt.ion():
153.             assert mpl.is_interactive()
154.     assert not mpl.is_interactive()
155. 
156.     with plt.ioff():
157.         plt.ion()
158.     assert not mpl.is_interactive()
159. 
160. 
161. def test_close():
162.     try:
163.         plt.close(1.1)
164.     except TypeError as e:
165.         assert str(e) == "close() argument must be a Figure, an int, " \
166.                          "a string, or None, not <class 'float'>"
167. 
168. 
169. def test_subplot_reuse():
170.     ax1 = plt.subplot(121)
171.     assert ax1 is plt.gca()
172.     ax2 = plt.subplot(122)
173.     assert ax2 is plt.gca()
174.     ax3 = plt.subplot(121)
175.     assert ax1 is plt.gca()
176.     assert ax1 is ax3
177. 
178. 
179. def test_axes_kwargs():
180.     # plt.axes() always creates new axes, even if axes kwargs differ.
181.     plt.figure()
182.     ax = plt.axes()
183.     ax1 = plt.axes()
184.     assert ax is not None
185.     assert ax1 is not ax
186.     plt.close()
187. 
188.     plt.figure()
189.     ax = plt.axes(projection='polar')
190.     ax1 = plt.axes(projection='polar')
191.     assert ax is not None
192.     assert ax1 is not ax
193.     plt.close()
194. 
195.     plt.figure()
196.     ax = plt.axes(projection='polar')
197.     ax1 = plt.axes()
198.     assert ax is not None
199.     assert ax1.name == 'rectilinear'
200.     assert ax1 is not ax
201.     plt.close()
202. 
203. 
204. def test_subplot_replace_projection():
205.     # plt.subplot() searches for axes with the same subplot spec, and if one
206.     # exists, and the kwargs match returns it, create a new one if they do not
207.     fig = plt.figure()
208.     ax = plt.subplot(1, 2, 1)
209.     ax1 = plt.subplot(1, 2, 1)
210.     ax2 = plt.subplot(1, 2, 2)
211.     with pytest.warns(MatplotlibDeprecationWarning):
212.         ax3 = plt.subplot(1, 2, 1, projection='polar')
213.     ax4 = plt.subplot(1, 2, 1, projection='polar')
214.     assert ax is not None
215.     assert ax1 is ax
216.     assert ax2 is not ax
217.     assert ax3 is not ax
218.     assert ax3 is ax4
219. 
220.     assert ax not in fig.axes
221.     assert ax2 in fig.axes
222.     assert ax3 in fig.axes
223. 
224.     assert ax.name == 'rectilinear'
225.     assert ax2.name == 'rectilinear'
226.     assert ax3.name == 'polar'
227. 
228. 
229. def test_subplot_kwarg_collision():
230.     ax1 = plt.subplot(projection='polar', theta_offset=0)
231.     ax2 = plt.subplot(projection='polar', theta_offset=0)
232.     assert ax1 is ax2
233.     ax1.remove()
234.     ax3 = plt.subplot(projection='polar', theta_offset=1)
235.     assert ax1 is not ax3
236.     assert ax1 not in plt.gcf().axes
237. 
238. 
239. def test_gca():
240.     # plt.gca() returns an existing axes, unless there were no axes.
241.     plt.figure()
242.     ax = plt.gca()
243.     ax1 = plt.gca()
244.     assert ax is not None
245.     assert ax1 is ax
246.     plt.close()
247. 
248. 
249. def test_subplot_projection_reuse():
250.     # create an Axes
251.     ax1 = plt.subplot(111)
252.     # check that it is current
253.     assert ax1 is plt.gca()
254.     # make sure we get it back if we ask again
255.     assert ax1 is plt.subplot(111)
256.     # remove it
257.     ax1.remove()
258.     # create a polar plot
259.     ax2 = plt.subplot(111, projection='polar')
260.     assert ax2 is plt.gca()
261.     # this should have deleted the first axes
262.     assert ax1 not in plt.gcf().axes
263.     # assert we get it back if no extra parameters passed
264.     assert ax2 is plt.subplot(111)
265.     ax2.remove()
266.     # now check explicitly setting the projection to rectilinear
267.     # makes a new axes
268.     ax3 = plt.subplot(111, projection='rectilinear')
269.     assert ax3 is plt.gca()
270.     assert ax3 is not ax2
271.     assert ax2 not in plt.gcf().axes
272. 
273. 
274. def test_subplot_polar_normalization():
275.     ax1 = plt.subplot(111, projection='polar')
276.     ax2 = plt.subplot(111, polar=True)
277.     ax3 = plt.subplot(111, polar=True, projection='polar')
278.     assert ax1 is ax2
279.     assert ax1 is ax3
280. 
281.     with pytest.raises(ValueError,
282.                        match="polar=True, yet projection='3d'"):
283.         ax2 = plt.subplot(111, polar=True, projection='3d')
284. 
285. 
286. def test_subplot_change_projection():
287.     created_axes = set()
288.     ax = plt.subplot()
289.     created_axes.add(ax)
290.     projections = ('aitoff', 'hammer', 'lambert', 'mollweide',
291.                    'polar', 'rectilinear', '3d')
292.     for proj in projections:
293.         ax.remove()
294.         ax = plt.subplot(projection=proj)
295.         assert ax is plt.subplot()
296.         assert ax.name == proj
297.         created_axes.add(ax)
298.     # Check that each call created a new Axes.
299.     assert len(created_axes) == 1 + len(projections)
300. 
301. 
302. def test_polar_second_call():
303.     # the first call creates the axes with polar projection
304.     ln1, = plt.polar(0., 1., 'ro')
305.     assert isinstance(ln1, mpl.lines.Line2D)
306.     # the second call should reuse the existing axes
307.     ln2, = plt.polar(1.57, .5, 'bo')
308.     assert isinstance(ln2, mpl.lines.Line2D)
309.     assert ln1.axes is ln2.axes
310. 
311. 
312. def test_fallback_position():
313.     # check that position kwarg works if rect not supplied
314.     axref = plt.axes([0.2, 0.2, 0.5, 0.5])
315.     axtest = plt.axes(position=[0.2, 0.2, 0.5, 0.5])
316.     np.testing.assert_allclose(axtest.bbox.get_points(),
317.                                axref.bbox.get_points())
318. 
319.     # check that position kwarg ignored if rect is supplied
320.     axref = plt.axes([0.2, 0.2, 0.5, 0.5])
321.     axtest = plt.axes([0.2, 0.2, 0.5, 0.5], position=[0.1, 0.1, 0.8, 0.8])
322.     np.testing.assert_allclose(axtest.bbox.get_points(),
323.                                axref.bbox.get_points())
324. 
325. 
326. def test_set_current_figure_via_subfigure():
327.     fig1 = plt.figure()
328.     subfigs = fig1.subfigures(2)
329. 
330.     plt.figure()
331.     assert plt.gcf() != fig1
332. 
333.     current = plt.figure(subfigs[1])
334.     assert plt.gcf() == fig1
335.     assert current == fig1
336. 
337. 
338. def test_set_current_axes_on_subfigure():
339.     fig = plt.figure()
340.     subfigs = fig.subfigures(2)
341. 
342.     ax = subfigs[0].subplots(1, squeeze=True)
343.     subfigs[1].subplots(1, squeeze=True)
344. 
345.     assert plt.gca() != ax
346.     plt.sca(ax)
347.     assert plt.gca() == ax
348. 
349. 
350. def test_pylab_integration():
351.     IPython = pytest.importorskip("IPython")
352.     mpl.testing.subprocess_run_helper(
353.         IPython.start_ipython,
354.         "--pylab",
355.         "-c",
356.         ";".join((
357.             "import matplotlib.pyplot as plt",
358.             "assert plt._REPL_DISPLAYHOOK == plt._ReplDisplayHook.IPYTHON",
359.         )),
360.         timeout=60,
361.     )
362. 
363. 
364. def test_doc_pyplot_summary():
365.     """Test that pyplot_summary lists all the plot functions."""
366.     pyplot_docs = Path(__file__).parent / '../../../doc/api/pyplot_summary.rst'
367.     if not pyplot_docs.exists():
368.         pytest.skip("Documentation sources not available")
369. 
370.     lines = pyplot_docs.read_text()
371.     m = re.search(r':nosignatures:\n\n(.*?)\n\n', lines, re.DOTALL)
372.     doc_functions = set(line.strip() for line in m.group(1).split('\n'))
373.     plot_commands = set(plt.get_plot_commands())
374.     missing = plot_commands.difference(doc_functions)
375.     if missing:
376.         raise AssertionError(
377.             f"The following pyplot functions are not listed in the "
378.             f"documentation. Please add them to doc/api/pyplot_summary.rst: "
379.             f"{missing!r}")
380.     extra = doc_functions.difference(plot_commands)
381.     if extra:
382.         raise AssertionError(
383.             f"The following functions are listed in the pyplot documentation, "
384.             f"but they do not exist in pyplot. "
385.             f"Please remove them from doc/api/pyplot_summary.rst: {extra!r}")

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 03:17:32,436 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user query asks for the full content of the file `lib/matplotlib/tests/test_pyplot.py`.\n   - The provided context contains the complete content of this file.\n\n2. Extended relevance:\n   - This context is directly and fully relevant as it represents the entire file requested by the user.', relative_path='lib/matplotlib/tests/test_pyplot.py', start_line=1, end_line=385)]
2025-12-24 03:17:32,438 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_pyplot.py`.
2025-12-24 03:17:32,438 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 03:17:32,438 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 03:17:32,438 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-24 03:17:32,438 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-24 03:17:32,439 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22567-IT.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   ├── 22691-JMK.rst
|   |   |   |   ├── 22745-JMK.rst
|   |   |   |   ├── 23031-AL.rst
|   |   |   |   ├── 23170-JMK.rst
|   |   |   |   ├── 23188-JMK.rst
|   |   |   |   └── 23270-AL.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21584-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22167-EP.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22298-GL.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   ├── 22883-AL.rst
|   |   |   |   ├── 22885-AL.rst
|   |   |   |   ├── 23014-OG.rst
|   |   |   |   ├── 23045-OG.rst
|   |   |   |   ├── 23081-OG.rst
|   |   |   |   ├── 23166-ES.rst
|   |   |   |   ├── 23190-OG.rst
|   |   |   |   ├── 23232-TH.rst
|   |   |   |   ├── 23289-AL.rst
|   |   |   |   ├── 23302-TH.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       ├── 22738-JL.rst
|   |   |       ├── 22886-OG.rst
|   |   |       ├── 22952-TH.rst
|   |   |       ├── 23076-GL.rst
|   |   |       ├── 23077-GL.rst
|   |   |       ├── 23078-GL.rst
|   |   |       ├── 23079-GL.rst
|   |   |       ├── 23093-GL.rst
|   |   |       └── 23237-AL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   └── api_changes_3.5.2.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── rename_ncol_keyword_in_legend.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   ├── striped_lines.rst
|       |   ├── url_active_areas_rotate.rst
|       |   ├── use_contourpy.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   └── whats_new_3.5.2.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `lib/matplotlib/tests/test_pyplot.py`.
Extra Requirements: 
Purpose: I need to analyze this file to find existing test cases that are relevant to the user's reported bug concerning `rc_context` and figure management in `pyplot`.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_pyplot.py
Line number range: 1 - 385
Content:
1. import difflib
2. import re
3. 
4. import numpy as np
5. import subprocess
6. import sys
7. from pathlib import Path
8. 
9. import pytest
10. 
11. import matplotlib as mpl
12. from matplotlib import pyplot as plt
13. from matplotlib._api import MatplotlibDeprecationWarning
14. 
15. 
16. def test_pyplot_up_to_date(tmpdir):
17.     gen_script = Path(mpl.__file__).parents[2] / "tools/boilerplate.py"
18.     if not gen_script.exists():
19.         pytest.skip("boilerplate.py not found")
20.     orig_contents = Path(plt.__file__).read_text()
21.     plt_file = tmpdir.join('pyplot.py')
22.     plt_file.write_text(orig_contents, 'utf-8')
23. 
24.     subprocess.run([sys.executable, str(gen_script), str(plt_file)],
25.                    check=True)
26.     new_contents = plt_file.read_text('utf-8')
27. 
28.     if orig_contents != new_contents:
29.         diff_msg = '\n'.join(
30.             difflib.unified_diff(
31.                 orig_contents.split('\n'), new_contents.split('\n'),
32.                 fromfile='found pyplot.py',
33.                 tofile='expected pyplot.py',
34.                 n=0, lineterm=''))
35.         pytest.fail(
36.             "pyplot.py is not up-to-date. Please run "
37.             "'python tools/boilerplate.py' to update pyplot.py. "
38.             "This needs to be done from an environment where your "
39.             "current working copy is installed (e.g. 'pip install -e'd). "
40.             "Here is a diff of unexpected differences:\n%s" % diff_msg
41.         )
42. 
43. 
44. def test_copy_docstring_and_deprecators(recwarn):
45.     @mpl._api.rename_parameter("(version)", "old", "new")
46.     @mpl._api.make_keyword_only("(version)", "kwo")
47.     def func(new, kwo=None):
48.         pass
49. 
50.     @plt._copy_docstring_and_deprecators(func)
51.     def wrapper_func(new, kwo=None):
52.         pass
53. 
54.     wrapper_func(None)
55.     wrapper_func(new=None)
56.     wrapper_func(None, kwo=None)
57.     wrapper_func(new=None, kwo=None)
58.     assert not recwarn
59.     with pytest.warns(MatplotlibDeprecationWarning):
60.         wrapper_func(old=None)
61.     with pytest.warns(MatplotlibDeprecationWarning):
62.         wrapper_func(None, None)
63. 
64. 
65. def test_pyplot_box():
66.     fig, ax = plt.subplots()
67.     plt.box(False)
68.     assert not ax.get_frame_on()
69.     plt.box(True)
70.     assert ax.get_frame_on()
71.     plt.box()
72.     assert not ax.get_frame_on()
73.     plt.box()
74.     assert ax.get_frame_on()
75. 
76. 
77. def test_stackplot_smoke():
78.     # Small smoke test for stackplot (see #12405)
79.     plt.stackplot([1, 2, 3], [1, 2, 3])
80. 
81. 
82. def test_nrows_error():
83.     with pytest.raises(TypeError):
84.         plt.subplot(nrows=1)
85.     with pytest.raises(TypeError):
86.         plt.subplot(ncols=1)
87. 
88. 
89. def test_ioff():
90.     plt.ion()
91.     assert mpl.is_interactive()
92.     with plt.ioff():
93.         assert not mpl.is_interactive()
94.     assert mpl.is_interactive()
95. 
96.     plt.ioff()
97.     assert not mpl.is_interactive()
98.     with plt.ioff():
99.         assert not mpl.is_interactive()
100.     assert not mpl.is_interactive()
101. 
102. 
103. def test_ion():
104.     plt.ioff()
105.     assert not mpl.is_interactive()
106.     with plt.ion():
107.         assert mpl.is_interactive()
108.     assert not mpl.is_interactive()
109. 
110.     plt.ion()
111.     assert mpl.is_interactive()
112.     with plt.ion():
113.         assert mpl.is_interactive()
114.     assert mpl.is_interactive()
115. 
116. 
117. def test_nested_ion_ioff():
118.     # initial state is interactive
119.     plt.ion()
120. 
121.     # mixed ioff/ion
122.     with plt.ioff():
123.         assert not mpl.is_interactive()
124.         with plt.ion():
125.             assert mpl.is_interactive()
126.         assert not mpl.is_interactive()
127.     assert mpl.is_interactive()
128. 
129.     # redundant contexts
130.     with plt.ioff():
131.         with plt.ioff():
132.             assert not mpl.is_interactive()
133.     assert mpl.is_interactive()
134. 
135.     with plt.ion():
136.         plt.ioff()
137.     assert mpl.is_interactive()
138. 
139.     # initial state is not interactive
140.     plt.ioff()
141. 
142.     # mixed ioff/ion
143.     with plt.ion():
144.         assert mpl.is_interactive()
145.         with plt.ioff():
146.             assert not mpl.is_interactive()
147.         assert mpl.is_interactive()
148.     assert not mpl.is_interactive()
149. 
150.     # redundant contexts
151.     with plt.ion():
152.         with plt.ion():
153.             assert mpl.is_interactive()
154.     assert not mpl.is_interactive()
155. 
156.     with plt.ioff():
157.         plt.ion()
158.     assert not mpl.is_interactive()
159. 
160. 
161. def test_close():
162.     try:
163.         plt.close(1.1)
164.     except TypeError as e:
165.         assert str(e) == "close() argument must be a Figure, an int, " \
166.                          "a string, or None, not <class 'float'>"
167. 
168. 
169. def test_subplot_reuse():
170.     ax1 = plt.subplot(121)
171.     assert ax1 is plt.gca()
172.     ax2 = plt.subplot(122)
173.     assert ax2 is plt.gca()
174.     ax3 = plt.subplot(121)
175.     assert ax1 is plt.gca()
176.     assert ax1 is ax3
177. 
178. 
179. def test_axes_kwargs():
180.     # plt.axes() always creates new axes, even if axes kwargs differ.
181.     plt.figure()
182.     ax = plt.axes()
183.     ax1 = plt.axes()
184.     assert ax is not None
185.     assert ax1 is not ax
186.     plt.close()
187. 
188.     plt.figure()
189.     ax = plt.axes(projection='polar')
190.     ax1 = plt.axes(projection='polar')
191.     assert ax is not None
192.     assert ax1 is not ax
193.     plt.close()
194. 
195.     plt.figure()
196.     ax = plt.axes(projection='polar')
197.     ax1 = plt.axes()
198.     assert ax is not None
199.     assert ax1.name == 'rectilinear'
200.     assert ax1 is not ax
201.     plt.close()
202. 
203. 
204. def test_subplot_replace_projection():
205.     # plt.subplot() searches for axes with the same subplot spec, and if one
206.     # exists, and the kwargs match returns it, create a new one if they do not
207.     fig = plt.figure()
208.     ax = plt.subplot(1, 2, 1)
209.     ax1 = plt.subplot(1, 2, 1)
210.     ax2 = plt.subplot(1, 2, 2)
211.     with pytest.warns(MatplotlibDeprecationWarning):
212.         ax3 = plt.subplot(1, 2, 1, projection='polar')
213.     ax4 = plt.subplot(1, 2, 1, projection='polar')
214.     assert ax is not None
215.     assert ax1 is ax
216.     assert ax2 is not ax
217.     assert ax3 is not ax
218.     assert ax3 is ax4
219. 
220.     assert ax not in fig.axes
221.     assert ax2 in fig.axes
222.     assert ax3 in fig.axes
223. 
224.     assert ax.name == 'rectilinear'
225.     assert ax2.name == 'rectilinear'
226.     assert ax3.name == 'polar'
227. 
228. 
229. def test_subplot_kwarg_collision():
230.     ax1 = plt.subplot(projection='polar', theta_offset=0)
231.     ax2 = plt.subplot(projection='polar', theta_offset=0)
232.     assert ax1 is ax2
233.     ax1.remove()
234.     ax3 = plt.subplot(projection='polar', theta_offset=1)
235.     assert ax1 is not ax3
236.     assert ax1 not in plt.gcf().axes
237. 
238. 
239. def test_gca():
240.     # plt.gca() returns an existing axes, unless there were no axes.
241.     plt.figure()
242.     ax = plt.gca()
243.     ax1 = plt.gca()
244.     assert ax is not None
245.     assert ax1 is ax
246.     plt.close()
247. 
248. 
249. def test_subplot_projection_reuse():
250.     # create an Axes
251.     ax1 = plt.subplot(111)
252.     # check that it is current
253.     assert ax1 is plt.gca()
254.     # make sure we get it back if we ask again
255.     assert ax1 is plt.subplot(111)
256.     # remove it
257.     ax1.remove()
258.     # create a polar plot
259.     ax2 = plt.subplot(111, projection='polar')
260.     assert ax2 is plt.gca()
261.     # this should have deleted the first axes
262.     assert ax1 not in plt.gcf().axes
263.     # assert we get it back if no extra parameters passed
264.     assert ax2 is plt.subplot(111)
265.     ax2.remove()
266.     # now check explicitly setting the projection to rectilinear
267.     # makes a new axes
268.     ax3 = plt.subplot(111, projection='rectilinear')
269.     assert ax3 is plt.gca()
270.     assert ax3 is not ax2
271.     assert ax2 not in plt.gcf().axes
272. 
273. 
274. def test_subplot_polar_normalization():
275.     ax1 = plt.subplot(111, projection='polar')
276.     ax2 = plt.subplot(111, polar=True)
277.     ax3 = plt.subplot(111, polar=True, projection='polar')
278.     assert ax1 is ax2
279.     assert ax1 is ax3
280. 
281.     with pytest.raises(ValueError,
282.                        match="polar=True, yet projection='3d'"):
283.         ax2 = plt.subplot(111, polar=True, projection='3d')
284. 
285. 
286. def test_subplot_change_projection():
287.     created_axes = set()
288.     ax = plt.subplot()
289.     created_axes.add(ax)
290.     projections = ('aitoff', 'hammer', 'lambert', 'mollweide',
291.                    'polar', 'rectilinear', '3d')
292.     for proj in projections:
293.         ax.remove()
294.         ax = plt.subplot(projection=proj)
295.         assert ax is plt.subplot()
296.         assert ax.name == proj
297.         created_axes.add(ax)
298.     # Check that each call created a new Axes.
299.     assert len(created_axes) == 1 + len(projections)
300. 
301. 
302. def test_polar_second_call():
303.     # the first call creates the axes with polar projection
304.     ln1, = plt.polar(0., 1., 'ro')
305.     assert isinstance(ln1, mpl.lines.Line2D)
306.     # the second call should reuse the existing axes
307.     ln2, = plt.polar(1.57, .5, 'bo')
308.     assert isinstance(ln2, mpl.lines.Line2D)
309.     assert ln1.axes is ln2.axes
310. 
311. 
312. def test_fallback_position():
313.     # check that position kwarg works if rect not supplied
314.     axref = plt.axes([0.2, 0.2, 0.5, 0.5])
315.     axtest = plt.axes(position=[0.2, 0.2, 0.5, 0.5])
316.     np.testing.assert_allclose(axtest.bbox.get_points(),
317.                                axref.bbox.get_points())
318. 
319.     # check that position kwarg ignored if rect is supplied
320.     axref = plt.axes([0.2, 0.2, 0.5, 0.5])
321.     axtest = plt.axes([0.2, 0.2, 0.5, 0.5], position=[0.1, 0.1, 0.8, 0.8])
322.     np.testing.assert_allclose(axtest.bbox.get_points(),
323.                                axref.bbox.get_points())
324. 
325. 
326. def test_set_current_figure_via_subfigure():
327.     fig1 = plt.figure()
328.     subfigs = fig1.subfigures(2)
329. 
330.     plt.figure()
331.     assert plt.gcf() != fig1
332. 
333.     current = plt.figure(subfigs[1])
334.     assert plt.gcf() == fig1
335.     assert current == fig1
336. 
337. 
338. def test_set_current_axes_on_subfigure():
339.     fig = plt.figure()
340.     subfigs = fig.subfigures(2)
341. 
342.     ax = subfigs[0].subplots(1, squeeze=True)
343.     subfigs[1].subplots(1, squeeze=True)
344. 
345.     assert plt.gca() != ax
346.     plt.sca(ax)
347.     assert plt.gca() == ax
348. 
349. 
350. def test_pylab_integration():
351.     IPython = pytest.importorskip("IPython")
352.     mpl.testing.subprocess_run_helper(
353.         IPython.start_ipython,
354.         "--pylab",
355.         "-c",
356.         ";".join((
357.             "import matplotlib.pyplot as plt",
358.             "assert plt._REPL_DISPLAYHOOK == plt._ReplDisplayHook.IPYTHON",
359.         )),
360.         timeout=60,
361.     )
362. 
363. 
364. def test_doc_pyplot_summary():
365.     """Test that pyplot_summary lists all the plot functions."""
366.     pyplot_docs = Path(__file__).parent / '../../../doc/api/pyplot_summary.rst'
367.     if not pyplot_docs.exists():
368.         pytest.skip("Documentation sources not available")
369. 
370.     lines = pyplot_docs.read_text()
371.     m = re.search(r':nosignatures:\n\n(.*?)\n\n', lines, re.DOTALL)
372.     doc_functions = set(line.strip() for line in m.group(1).split('\n'))
373.     plot_commands = set(plt.get_plot_commands())
374.     missing = plot_commands.difference(doc_functions)
375.     if missing:
376.         raise AssertionError(
377.             f"The following pyplot functions are not listed in the "
378.             f"documentation. Please add them to doc/api/pyplot_summary.rst: "
379.             f"{missing!r}")
380.     extra = doc_functions.difference(plot_commands)
381.     if extra:
382.         raise AssertionError(
383.             f"The following functions are listed in the pyplot documentation, "
384.             f"but they do not exist in pyplot. "
385.             f"Please remove them from doc/api/pyplot_summary.rst: {extra!r}")

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 03:17:54,228 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug involves the interaction of `rc_context`, `get_backend`, and the global figure manager `Gcf`. The previously provided file, `lib/matplotlib/tests/test_pyplot.py`, does not contain any tests covering this specific interaction, as it lacks tests that use `rc_context` in conjunction with figure creation and backend manipulation. The patch is in `rc_context` itself, so tests for it are most likely in a file testing `rcParams` and configuration management." query='Please provide the full content of the file `lib/matplotlib/tests/test_rcparams.py`.' extra_requirements='' purpose="I need to analyze `lib/matplotlib/tests/test_rcparams.py` to find tests related to `rc_context` and backend handling, which are central to the user's bug report."
2025-12-24 03:17:54,229 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_rcparams.py`.
2025-12-24 03:17:54,229 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 03:17:54,230 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 03:17:54,230 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 03:17:54,230 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `lib/matplotlib/tests/test_rcparams.py`.
Purpose: I need to analyze `lib/matplotlib/tests/test_rcparams.py` to find tests related to `rc_context` and backend handling, which are central to the user's bug report.
2025-12-24 03:17:56,513 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_rcparams.py"}'}, '__gemini_function_call_thought_signatures__': {'2e117c52-fff2-4508-8548-cf22951f7101': 'CuYEAY89a1/u2lDJW69PU9nh1bPBsL5rGiLK3yr9sX4BEG7/Gp7lImr9O3S3Dh0SrKPShthS8C4qlgyBUbV4INGmw1M/MkElKT4bdPvpFXHPx80odKTOrPmVbRbRN0qps27FytX+JfDEIN0VD8CD1SlQmNQn8A2pVfO9mKSyIebJfRjyPVm0FewrhwESrS+htc9DYWmgNq3vfexzTgcIpGhf2Cc/LVcqR0Q3HDAzyb8OcZ+Jt0fXuX7tsWrgLSiEGf5n6UuA9zQ3BLJKbpiVfPWhKaYokqUF5tQ5KBYVFoy8OKzto1wNZztIKnVwqoWQCqYeJBo4gmJvfysK39qhkX5PFjzu2no5+P2vO7FII1T8ekJgHL1H/pHD9I+o7y2OHhK8kHSsdeWQeUbV062PMiu+rmEpcSzlHwAdHYQZfHdTUWhwNX+eEaqBZ6kOB7nSfP5OVRbOkxsWEnP/QePY5r34HbJUXtjOkj+SfR8FMWNgNVgMM2Uf9Ir2JPl90jfQ8qJyvJCZFyzhPLtmRoen30dXqSDbozC/CjK2n5F7hJzuur8vBDLazxmv2qkG2vKdHeK5tq2UWfTaV6S4FjNY/c/pIMFOamXngoRTZRzyifVYfbTJliY7hq5GSURitWXaNnBOYycwmUCjlY8uO4dPybr7QvQbO8cqLltj6FCTYHWaAn8SuYGnYYuhEBcDSwYbTZbxjHNJQ6neo9rqB8VIn1rL3LSuCwWbAldGv3CsvkUfkw6zJ5CdHmJ18vzAzgoV9mUK5OZUVUn2dCDKD+YePnv2Ba4SHTfLplems/J+IVBrBqP8/H5enow='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2150, 'candidates_token_count': 26, 'total_token_count': 2321, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2150}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 26}], 'thoughts_token_count': 145, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.301344082905696, 'model_name': 'gemini-2.5-pro'} id='run--dc7c4ea6-35dc-45e3-92f0-d1e5a29c5683-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_rcparams.py'}, 'id': '2e117c52-fff2-4508-8548-cf22951f7101', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2150, 'output_tokens': 26, 'total_tokens': 2321, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 145}}
2025-12-24 03:17:59,463 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "lib/matplotlib/tests/test_rcparams.py", "end_line": 1000.0}'}, '__gemini_function_call_thought_signatures__': {'5e84974b-73d3-4872-9944-94cca1c5d692': 'CskDAY89a18Uyc4QcH9i54b5LeFdxGpzB8Juq6K9bwl38uQlGMnL4cPr5cWEJEoLmSqaLVV/ITW283m2g2IkR+Gxpx1EQdgJBpH4cOzofBHfswTPCs2zqg4z7sEaIY+etyyXgo++yGO+mMCKgn6fqQFicGSEru7T2a5rflVQFLy3bgjoEZYeN5xw2PrPPUw2oWf/EhmwIXaZK2Eon5CiyoF9UCqyx7lDAWTONarWz5eehOyxxH0rbFCclU8H0UlCHpiBqTkhaTiyqUSPufh9jJh0wQDl0iCT0eR12isjtQYDnE+EHkgEWUYl5E8LSUyJFAn0iLmgS6+XVgayr91OBv8KFV9OYEEodrYODNV5Pq18Xzj1yT43qJuDVHVA+o6oV2HQ7IG2uCB8EcOiEOMO3mj/2cswYrBqKEomXrlWI1672NPyVFu2FnDeVgDzzuvnf2z0INKRzzn4BconUbjUt74AZIu6tseqJm33OuwVZH1LSc/E1/9Cya9Fkd7LMSDFQCFJeyAfleC3qDVaF/oCYMJpzOee0KPAA8d4zocCG7OIXdLb5n605N9M0fR405ObYg2fhl7c6TQmqbNlkpzBceYBSorUB+JUQZLLjg=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10837, 'candidates_token_count': 32, 'total_token_count': 10987, 'cached_content_token_count': 1829, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10982}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1829}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 118}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2783257067203522, 'model_name': 'gemini-2.5-pro'} id='run--c0594595-c1f9-4f35-929b-6e00fbc475ab-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'lib/matplotlib/tests/test_rcparams.py', 'end_line': 1000.0}, 'id': '5e84974b-73d3-4872-9944-94cca1c5d692', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10837, 'output_tokens': 32, 'total_tokens': 10987, 'input_token_details': {'cache_read': 1829}, 'output_token_details': {'reasoning': 118}}
2025-12-24 03:18:05,898 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the full content of the file `lib/matplotlib/tests/test_rcparams.py` by using the available tools. The first 500 lines were retrieved and then the remainder of the file was retrieved in a second call. I have now gathered all the necessary information to fulfill the user's request." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12416, 'candidates_token_count': 68, 'total_token_count': 12838, 'cached_content_token_count': 11035, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12679}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11035}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 68}], 'thoughts_token_count': 354}, 'finish_reason': 'STOP', 'avg_logprobs': -0.8168553745045382, 'model_name': 'gemini-2.5-pro'} id='run--22c77bf5-3dc0-4f4c-8a66-ef5575ce1c8d-0' usage_metadata={'input_tokens': 12416, 'output_tokens': 68, 'total_tokens': 12838, 'input_token_details': {'cache_read': 11035}, 'output_token_details': {'reasoning': 354}}
2025-12-24 03:18:05,900 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `lib/matplotlib/tests/test_rcparams.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze `lib/matplotlib/tests/test_rcparams.py` to find tests related to `rc_context` and backend handling, which are central to the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_rcparams.py
Line number range: 1 - 500
Content:
1. import copy
2. import os
3. from pathlib import Path
4. import subprocess
5. import sys
6. from unittest import mock
7. 
8. from cycler import cycler, Cycler
9. import pytest
10. 
11. import matplotlib as mpl
12. from matplotlib import _api, _c_internal_utils
13. import matplotlib.pyplot as plt
14. import matplotlib.colors as mcolors
15. import numpy as np
16. from matplotlib.rcsetup import (
17.     validate_bool,
18.     validate_color,
19.     validate_colorlist,
20.     _validate_color_or_linecolor,
21.     validate_cycler,
22.     validate_float,
23.     validate_fontstretch,
24.     validate_fontweight,
25.     validate_hatch,
26.     validate_hist_bins,
27.     validate_int,
28.     validate_markevery,
29.     validate_stringlist,
30.     _validate_linestyle,
31.     _listify_validator)
32. 
33. 
34. def test_rcparams(tmpdir):
35.     mpl.rc('text', usetex=False)
36.     mpl.rc('lines', linewidth=22)
37. 
38.     usetex = mpl.rcParams['text.usetex']
39.     linewidth = mpl.rcParams['lines.linewidth']
40. 
41.     rcpath = Path(tmpdir) / 'test_rcparams.rc'
42.     rcpath.write_text('lines.linewidth: 33', encoding='utf-8')
43. 
44.     # test context given dictionary
45.     with mpl.rc_context(rc={'text.usetex': not usetex}):
46.         assert mpl.rcParams['text.usetex'] == (not usetex)
47.     assert mpl.rcParams['text.usetex'] == usetex
48. 
49.     # test context given filename (mpl.rc sets linewidth to 33)
50.     with mpl.rc_context(fname=rcpath):
51.         assert mpl.rcParams['lines.linewidth'] == 33
52.     assert mpl.rcParams['lines.linewidth'] == linewidth
53. 
54.     # test context given filename and dictionary
55.     with mpl.rc_context(fname=rcpath, rc={'lines.linewidth': 44}):
56.         assert mpl.rcParams['lines.linewidth'] == 44
57.     assert mpl.rcParams['lines.linewidth'] == linewidth
58. 
59.     # test context as decorator (and test reusability, by calling func twice)
60.     @mpl.rc_context({'lines.linewidth': 44})
61.     def func():
62.         assert mpl.rcParams['lines.linewidth'] == 44
63. 
64.     func()
65.     func()
66. 
67.     # test rc_file
68.     mpl.rc_file(rcpath)
69.     assert mpl.rcParams['lines.linewidth'] == 33
70. 
71. 
72. def test_RcParams_class():
73.     rc = mpl.RcParams({'font.cursive': ['Apple Chancery',
74.                                         'Textile',
75.                                         'Zapf Chancery',
76.                                         'cursive'],
77.                        'font.family': 'sans-serif',
78.                        'font.weight': 'normal',
79.                        'font.size': 12})
80. 
81.     expected_repr = """
82. RcParams({'font.cursive': ['Apple Chancery',
83.                            'Textile',
84.                            'Zapf Chancery',
85.                            'cursive'],
86.           'font.family': ['sans-serif'],
87.           'font.size': 12.0,
88.           'font.weight': 'normal'})""".lstrip()
89. 
90.     assert expected_repr == repr(rc)
91. 
92.     expected_str = """
93. font.cursive: ['Apple Chancery', 'Textile', 'Zapf Chancery', 'cursive']
94. font.family: ['sans-serif']
95. font.size: 12.0
96. font.weight: normal""".lstrip()
97. 
98.     assert expected_str == str(rc)
99. 
100.     # test the find_all functionality
101.     assert ['font.cursive', 'font.size'] == sorted(rc.find_all('i[vz]'))
102.     assert ['font.family'] == list(rc.find_all('family'))
103. 
104. 
105. def test_rcparams_update():
106.     rc = mpl.RcParams({'figure.figsize': (3.5, 42)})
107.     bad_dict = {'figure.figsize': (3.5, 42, 1)}
108.     # make sure validation happens on input
109.     with pytest.raises(ValueError), \
110.          pytest.warns(UserWarning, match="validate"):
111.         rc.update(bad_dict)
112. 
113. 
114. def test_rcparams_init():
115.     with pytest.raises(ValueError), \
116.          pytest.warns(UserWarning, match="validate"):
117.         mpl.RcParams({'figure.figsize': (3.5, 42, 1)})
118. 
119. 
120. def test_Bug_2543():
121.     # Test that it possible to add all values to itself / deepcopy
122.     # https://github.com/matplotlib/matplotlib/issues/2543
123.     # We filter warnings at this stage since a number of them are raised
124.     # for deprecated rcparams as they should. We don't want these in the
125.     # printed in the test suite.
126.     with _api.suppress_matplotlib_deprecation_warning():
127.         with mpl.rc_context():
128.             _copy = mpl.rcParams.copy()
129.             for key in _copy:
130.                 mpl.rcParams[key] = _copy[key]
131.         with mpl.rc_context():
132.             copy.deepcopy(mpl.rcParams)
133.     with pytest.raises(ValueError):
134.         validate_bool(None)
135.     with pytest.raises(ValueError):
136.         with mpl.rc_context():
137.             mpl.rcParams['svg.fonttype'] = True
138. 
139. 
140. legend_color_tests = [
141.     ('face', {'color': 'r'}, mcolors.to_rgba('r')),
142.     ('face', {'color': 'inherit', 'axes.facecolor': 'r'},
143.      mcolors.to_rgba('r')),
144.     ('face', {'color': 'g', 'axes.facecolor': 'r'}, mcolors.to_rgba('g')),
145.     ('edge', {'color': 'r'}, mcolors.to_rgba('r')),
146.     ('edge', {'color': 'inherit', 'axes.edgecolor': 'r'},
147.      mcolors.to_rgba('r')),
148.     ('edge', {'color': 'g', 'axes.facecolor': 'r'}, mcolors.to_rgba('g'))
149. ]
150. legend_color_test_ids = [
151.     'same facecolor',
152.     'inherited facecolor',
153.     'different facecolor',
154.     'same edgecolor',
155.     'inherited edgecolor',
156.     'different facecolor',
157. ]
158. 
159. 
160. @pytest.mark.parametrize('color_type, param_dict, target', legend_color_tests,
161.                          ids=legend_color_test_ids)
162. def test_legend_colors(color_type, param_dict, target):
163.     param_dict[f'legend.{color_type}color'] = param_dict.pop('color')
164.     get_func = f'get_{color_type}color'
165. 
166.     with mpl.rc_context(param_dict):
167.         _, ax = plt.subplots()
168.         ax.plot(range(3), label='test')
169.         leg = ax.legend()
170.         assert getattr(leg.legendPatch, get_func)() == target
171. 
172. 
173. def test_mfc_rcparams():
174.     mpl.rcParams['lines.markerfacecolor'] = 'r'
175.     ln = mpl.lines.Line2D([1, 2], [1, 2])
176.     assert ln.get_markerfacecolor() == 'r'
177. 
178. 
179. def test_mec_rcparams():
180.     mpl.rcParams['lines.markeredgecolor'] = 'r'
181.     ln = mpl.lines.Line2D([1, 2], [1, 2])
182.     assert ln.get_markeredgecolor() == 'r'
183. 
184. 
185. def test_axes_titlecolor_rcparams():
186.     mpl.rcParams['axes.titlecolor'] = 'r'
187.     _, ax = plt.subplots()
188.     title = ax.set_title("Title")
189.     assert title.get_color() == 'r'
190. 
191. 
192. def test_Issue_1713(tmpdir):
193.     rcpath = Path(tmpdir) / 'test_rcparams.rc'
194.     rcpath.write_text('timezone: UTC', encoding='utf-8')
195.     with mock.patch('locale.getpreferredencoding', return_value='UTF-32-BE'):
196.         rc = mpl.rc_params_from_file(rcpath, True, False)
197.     assert rc.get('timezone') == 'UTC'
198. 
199. 
200. def test_animation_frame_formats():
201.     # Animation frame_format should allow any of the following
202.     # if any of these are not allowed, an exception will be raised
203.     # test for gh issue #17908
204.     for fmt in ['png', 'jpeg', 'tiff', 'raw', 'rgba', 'ppm',
205.                 'sgi', 'bmp', 'pbm', 'svg']:
206.         mpl.rcParams['animation.frame_format'] = fmt
207. 
208. 
209. def generate_validator_testcases(valid):
210.     validation_tests = (
211.         {'validator': validate_bool,
212.          'success': (*((_, True) for _ in
213.                        ('t', 'y', 'yes', 'on', 'true', '1', 1, True)),
214.                      *((_, False) for _ in
215.                        ('f', 'n', 'no', 'off', 'false', '0', 0, False))),
216.          'fail': ((_, ValueError)
217.                   for _ in ('aardvark', 2, -1, [], ))
218.          },
219.         {'validator': validate_stringlist,
220.          'success': (('', []),
221.                      ('a,b', ['a', 'b']),
222.                      ('aardvark', ['aardvark']),
223.                      ('aardvark, ', ['aardvark']),
224.                      ('aardvark, ,', ['aardvark']),
225.                      (['a', 'b'], ['a', 'b']),
226.                      (('a', 'b'), ['a', 'b']),
227.                      (iter(['a', 'b']), ['a', 'b']),
228.                      (np.array(['a', 'b']), ['a', 'b']),
229.                      ),
230.          'fail': ((set(), ValueError),
231.                   (1, ValueError),
232.                   ((1, 2), _api.MatplotlibDeprecationWarning),
233.                   (np.array([1, 2]), _api.MatplotlibDeprecationWarning),
234.                   )
235.          },
236.         {'validator': _listify_validator(validate_int, n=2),
237.          'success': ((_, [1, 2])
238.                      for _ in ('1, 2', [1.5, 2.5], [1, 2],
239.                                (1, 2), np.array((1, 2)))),
240.          'fail': ((_, ValueError)
241.                   for _ in ('aardvark', ('a', 1),
242.                             (1, 2, 3)
243.                             ))
244.          },
245.         {'validator': _listify_validator(validate_float, n=2),
246.          'success': ((_, [1.5, 2.5])
247.                      for _ in ('1.5, 2.5', [1.5, 2.5], [1.5, 2.5],
248.                                (1.5, 2.5), np.array((1.5, 2.5)))),
249.          'fail': ((_, ValueError)
250.                   for _ in ('aardvark', ('a', 1), (1, 2, 3), (None, ), None))
251.          },
252.         {'validator': validate_cycler,
253.          'success': (('cycler("color", "rgb")',
254.                       cycler("color", 'rgb')),
255.                      (cycler('linestyle', ['-', '--']),
256.                       cycler('linestyle', ['-', '--'])),
257.                      ("""(cycler("color", ["r", "g", "b"]) +
258.                           cycler("mew", [2, 3, 5]))""",
259.                       (cycler("color", 'rgb') +
260.                        cycler("markeredgewidth", [2, 3, 5]))),
261.                      ("cycler(c='rgb', lw=[1, 2, 3])",
262.                       cycler('color', 'rgb') + cycler('linewidth', [1, 2, 3])),
263.                      ("cycler('c', 'rgb') * cycler('linestyle', ['-', '--'])",
264.                       (cycler('color', 'rgb') *
265.                        cycler('linestyle', ['-', '--']))),
266.                      (cycler('ls', ['-', '--']),
267.                       cycler('linestyle', ['-', '--'])),
268.                      (cycler(mew=[2, 5]),
269.                       cycler('markeredgewidth', [2, 5])),
270.                      ),
271.          # This is *so* incredibly important: validate_cycler() eval's
272.          # an arbitrary string! I think I have it locked down enough,
273.          # and that is what this is testing.
274.          # TODO: Note that these tests are actually insufficient, as it may
275.          # be that they raised errors, but still did an action prior to
276.          # raising the exception. We should devise some additional tests
277.          # for that...
278.          'fail': ((4, ValueError),  # Gotta be a string or Cycler object
279.                   ('cycler("bleh, [])', ValueError),  # syntax error
280.                   ('Cycler("linewidth", [1, 2, 3])',
281.                    ValueError),  # only 'cycler()' function is allowed
282.                   # do not allow dunder in string literals
283.                   ("cycler('c', [j.__class__(j) for j in ['r', 'b']])",
284.                    ValueError),
285.                   ("cycler('c', [j. __class__(j) for j in ['r', 'b']])",
286.                    ValueError),
287.                   ("cycler('c', [j.\t__class__(j) for j in ['r', 'b']])",
288.                    ValueError),
289.                   ("cycler('c', [j.\u000c__class__(j) for j in ['r', 'b']])",
290.                    ValueError),
291.                   ("cycler('c', [j.__class__(j).lower() for j in ['r', 'b']])",
292.                    ValueError),
293.                   ('1 + 2', ValueError),  # doesn't produce a Cycler object
294.                   ('os.system("echo Gotcha")', ValueError),  # os not available
295.                   ('import os', ValueError),  # should not be able to import
296.                   ('def badjuju(a): return a; badjuju(cycler("color", "rgb"))',
297.                    ValueError),  # Should not be able to define anything
298.                   # even if it does return a cycler
299.                   ('cycler("waka", [1, 2, 3])', ValueError),  # not a property
300.                   ('cycler(c=[1, 2, 3])', ValueError),  # invalid values
301.                   ("cycler(lw=['a', 'b', 'c'])", ValueError),  # invalid values
302.                   (cycler('waka', [1, 3, 5]), ValueError),  # not a property
303.                   (cycler('color', ['C1', 'r', 'g']), ValueError)  # no CN
304.                   )
305.          },
306.         {'validator': validate_hatch,
307.          'success': (('--|', '--|'), ('\\oO', '\\oO'),
308.                      ('/+*/.x', '/+*/.x'), ('', '')),
309.          'fail': (('--_', ValueError),
310.                   (8, ValueError),
311.                   ('X', ValueError)),
312.          },
313.         {'validator': validate_colorlist,
314.          'success': (('r,g,b', ['r', 'g', 'b']),
315.                      (['r', 'g', 'b'], ['r', 'g', 'b']),
316.                      ('r, ,', ['r']),
317.                      (['', 'g', 'blue'], ['g', 'blue']),
318.                      ([np.array([1, 0, 0]), np.array([0, 1, 0])],
319.                      np.array([[1, 0, 0], [0, 1, 0]])),
320.                      (np.array([[1, 0, 0], [0, 1, 0]]),
321.                      np.array([[1, 0, 0], [0, 1, 0]])),
322.                      ),
323.          'fail': (('fish', ValueError),
324.                   ),
325.          },
326.         {'validator': validate_color,
327.          'success': (('None', 'none'),
328.                      ('none', 'none'),
329.                      ('AABBCC', '#AABBCC'),  # RGB hex code
330.                      ('AABBCC00', '#AABBCC00'),  # RGBA hex code
331.                      ('tab:blue', 'tab:blue'),  # named color
332.                      ('C12', 'C12'),  # color from cycle
333.                      ('(0, 1, 0)', (0.0, 1.0, 0.0)),  # RGB tuple
334.                      ((0, 1, 0), (0, 1, 0)),  # non-string version
335.                      ('(0, 1, 0, 1)', (0.0, 1.0, 0.0, 1.0)),  # RGBA tuple
336.                      ((0, 1, 0, 1), (0, 1, 0, 1)),  # non-string version
337.                      ),
338.          'fail': (('tab:veryblue', ValueError),  # invalid name
339.                   ('(0, 1)', ValueError),  # tuple with length < 3
340.                   ('(0, 1, 0, 1, 0)', ValueError),  # tuple with length > 4
341.                   ('(0, 1, none)', ValueError),  # cannot cast none to float
342.                   ('(0, 1, "0.5")', ValueError),  # last one not a float
343.                   ),
344.          },
345.         {'validator': _validate_color_or_linecolor,
346.          'success': (('linecolor', 'linecolor'),
347.                      ('markerfacecolor', 'markerfacecolor'),
348.                      ('mfc', 'markerfacecolor'),
349.                      ('markeredgecolor', 'markeredgecolor'),
350.                      ('mec', 'markeredgecolor')
351.                      ),
352.          'fail': (('line', ValueError),
353.                   ('marker', ValueError)
354.                   )
355.          },
356.         {'validator': validate_hist_bins,
357.          'success': (('auto', 'auto'),
358.                      ('fd', 'fd'),
359.                      ('10', 10),
360.                      ('1, 2, 3', [1, 2, 3]),
361.                      ([1, 2, 3], [1, 2, 3]),
362.                      (np.arange(15), np.arange(15))
363.                      ),
364.          'fail': (('aardvark', ValueError),
365.                   )
366.          },
367.         {'validator': validate_markevery,
368.          'success': ((None, None),
369.                      (1, 1),
370.                      (0.1, 0.1),
371.                      ((1, 1), (1, 1)),
372.                      ((0.1, 0.1), (0.1, 0.1)),
373.                      ([1, 2, 3], [1, 2, 3]),
374.                      (slice(2), slice(None, 2, None)),
375.                      (slice(1, 2, 3), slice(1, 2, 3))
376.                      ),
377.          'fail': (((1, 2, 3), TypeError),
378.                   ([1, 2, 0.3], TypeError),
379.                   (['a', 2, 3], TypeError),
380.                   ([1, 2, 'a'], TypeError),
381.                   ((0.1, 0.2, 0.3), TypeError),
382.                   ((0.1, 2, 3), TypeError),
383.                   ((1, 0.2, 0.3), TypeError),
384.                   ((1, 0.1), TypeError),
385.                   ((0.1, 1), TypeError),
386.                   (('abc'), TypeError),
387.                   ((1, 'a'), TypeError),
388.                   ((0.1, 'b'), TypeError),
389.                   (('a', 1), TypeError),
390.                   (('a', 0.1), TypeError),
391.                   ('abc', TypeError),
392.                   ('a', TypeError),
393.                   (object(), TypeError)
394.                   )
395.          },
396.         {'validator': _validate_linestyle,
397.          'success': (('-', '-'), ('solid', 'solid'),
398.                      ('--', '--'), ('dashed', 'dashed'),
399.                      ('-.', '-.'), ('dashdot', 'dashdot'),
400.                      (':', ':'), ('dotted', 'dotted'),
401.                      ('', ''), (' ', ' '),
402.                      ('None', 'none'), ('none', 'none'),
403.                      ('DoTtEd', 'dotted'),  # case-insensitive
404.                      ('1, 3', (0, (1, 3))),
405.                      ([1.23, 456], (0, [1.23, 456.0])),
406.                      ([1, 2, 3, 4], (0, [1.0, 2.0, 3.0, 4.0])),
407.                      ((0, [1, 2]), (0, [1, 2])),
408.                      ((-1, [1, 2]), (-1, [1, 2])),
409.                      ),
410.          'fail': (('aardvark', ValueError),  # not a valid string
411.                   (b'dotted', ValueError),
412.                   ('dotted'.encode('utf-16'), ValueError),
413.                   ([1, 2, 3], ValueError),  # sequence with odd length
414.                   (1.23, ValueError),  # not a sequence
415.                   (("a", [1, 2]), ValueError),  # wrong explicit offset
416.                   ((None, [1, 2]), ValueError),  # wrong explicit offset
417.                   ((1, [1, 2, 3]), ValueError),  # odd length sequence
418.                   (([1, 2], 1), ValueError),  # inverted offset/onoff
419.                   )
420.          },
421.     )
422. 
423.     for validator_dict in validation_tests:
424.         validator = validator_dict['validator']
425.         if valid:
426.             for arg, target in validator_dict['success']:
427.                 yield validator, arg, target
428.         else:
429.             for arg, error_type in validator_dict['fail']:
430.                 yield validator, arg, error_type
431. 
432. 
433. @pytest.mark.parametrize('validator, arg, target',
434.                          generate_validator_testcases(True))
435. def test_validator_valid(validator, arg, target):
436.     res = validator(arg)
437.     if isinstance(target, np.ndarray):
438.         np.testing.assert_equal(res, target)
439.     elif not isinstance(target, Cycler):
440.         assert res == target
441.     else:
442.         # Cyclers can't simply be asserted equal. They don't implement __eq__
443.         assert list(res) == list(target)
444. 
445. 
446. @pytest.mark.parametrize('validator, arg, exception_type',
447.                          generate_validator_testcases(False))
448. def test_validator_invalid(validator, arg, exception_type):
449.     with pytest.raises(exception_type):
450.         validator(arg)
451. 
452. 
453. @pytest.mark.parametrize('weight, parsed_weight', [
454.     ('bold', 'bold'),
455.     ('BOLD', ValueError),  # weight is case-sensitive
456.     (100, 100),
457.     ('100', 100),
458.     (np.array(100), 100),
459.     # fractional fontweights are not defined. This should actually raise a
460.     # ValueError, but historically did not.
461.     (20.6, 20),
462.     ('20.6', ValueError),
463.     ([100], ValueError),
464. ])
465. def test_validate_fontweight(weight, parsed_weight):
466.     if parsed_weight is ValueError:
467.         with pytest.raises(ValueError):
468.             validate_fontweight(weight)
469.     else:
470.         assert validate_fontweight(weight) == parsed_weight
471. 
472. 
473. @pytest.mark.parametrize('stretch, parsed_stretch', [
474.     ('expanded', 'expanded'),
475.     ('EXPANDED', ValueError),  # stretch is case-sensitive
476.     (100, 100),
477.     ('100', 100),
478.     (np.array(100), 100),
479.     # fractional fontweights are not defined. This should actually raise a
480.     # ValueError, but historically did not.
481.     (20.6, 20),
482.     ('20.6', ValueError),
483.     ([100], ValueError),
484. ])
485. def test_validate_fontstretch(stretch, parsed_stretch):
486.     if parsed_stretch is ValueError:
487.         with pytest.raises(ValueError):
488.             validate_fontstretch(stretch)
489.     else:
490.         assert validate_fontstretch(stretch) == parsed_stretch
491. 
492. 
493. def test_keymaps():
494.     key_list = [k for k in mpl.rcParams if 'keymap' in k]
495.     for k in key_list:
496.         assert isinstance(mpl.rcParams[k], list)
497. 
498. 
499. def test_rcparams_reset_after_fail():
500.     # There was previously a bug that meant that if rc_context failed and


File: lib/matplotlib/tests/test_rcparams.py
Line number range: 501 - 1000
Content:
501.     # raised an exception due to issues in the supplied rc parameters, the
502.     # global rc parameters were left in a modified state.
503.     with mpl.rc_context(rc={'text.usetex': False}):
504.         assert mpl.rcParams['text.usetex'] is False
505.         with pytest.raises(KeyError):
506.             with mpl.rc_context(rc={'text.usetex': True, 'test.blah': True}):
507.                 pass
508.         assert mpl.rcParams['text.usetex'] is False
509. 
510. 
511. @pytest.mark.skipif(sys.platform != "linux", reason="Linux only")
512. def test_backend_fallback_headless(tmpdir):
513.     env = {**os.environ,
514.            "DISPLAY": "", "WAYLAND_DISPLAY": "",
515.            "MPLBACKEND": "", "MPLCONFIGDIR": str(tmpdir)}
516.     with pytest.raises(subprocess.CalledProcessError):
517.         subprocess.run(
518.             [sys.executable, "-c",
519.              "import matplotlib;"
520.              "matplotlib.use('tkagg');"
521.              "import matplotlib.pyplot;"
522.              "matplotlib.pyplot.plot(42);"
523.              ],
524.             env=env, check=True, stderr=subprocess.DEVNULL)
525. 
526. 
527. @pytest.mark.skipif(
528.     sys.platform == "linux" and not _c_internal_utils.display_is_valid(),
529.     reason="headless")
530. def test_backend_fallback_headful(tmpdir):
531.     pytest.importorskip("tkinter")
532.     env = {**os.environ, "MPLBACKEND": "", "MPLCONFIGDIR": str(tmpdir)}
533.     backend = subprocess.check_output(
534.         [sys.executable, "-c",
535.          "import matplotlib as mpl; "
536.          "sentinel = mpl.rcsetup._auto_backend_sentinel; "
537.          # Check that access on another instance does not resolve the sentinel.
538.          "assert mpl.RcParams({'backend': sentinel})['backend'] == sentinel; "
539.          "assert dict.__getitem__(mpl.rcParams, 'backend') == sentinel; "
540.          "import matplotlib.pyplot; "
541.          "print(matplotlib.get_backend())"],
542.         env=env, universal_newlines=True)
543.     # The actual backend will depend on what's installed, but at least tkagg is
544.     # present.
545.     assert backend.strip().lower() != "agg"
546. 
547. 
548. def test_deprecation(monkeypatch):
549.     monkeypatch.setitem(
550.         mpl._deprecated_map, "patch.linewidth",
551.         ("0.0", "axes.linewidth", lambda old: 2 * old, lambda new: new / 2))
552.     with pytest.warns(_api.MatplotlibDeprecationWarning):
553.         assert mpl.rcParams["patch.linewidth"] \
554.             == mpl.rcParams["axes.linewidth"] / 2
555.     with pytest.warns(_api.MatplotlibDeprecationWarning):
556.         mpl.rcParams["patch.linewidth"] = 1
557.     assert mpl.rcParams["axes.linewidth"] == 2
558. 
559.     monkeypatch.setitem(
560.         mpl._deprecated_ignore_map, "patch.edgecolor",
561.         ("0.0", "axes.edgecolor"))
562.     with pytest.warns(_api.MatplotlibDeprecationWarning):
563.         assert mpl.rcParams["patch.edgecolor"] \
564.             == mpl.rcParams["axes.edgecolor"]
565.     with pytest.warns(_api.MatplotlibDeprecationWarning):
566.         mpl.rcParams["patch.edgecolor"] = "#abcd"
567.     assert mpl.rcParams["axes.edgecolor"] != "#abcd"
568. 
569.     monkeypatch.setitem(
570.         mpl._deprecated_ignore_map, "patch.force_edgecolor",
571.         ("0.0", None))
572.     with pytest.warns(_api.MatplotlibDeprecationWarning):
573.         assert mpl.rcParams["patch.force_edgecolor"] is None
574. 
575.     monkeypatch.setitem(
576.         mpl._deprecated_remain_as_none, "svg.hashsalt",
577.         ("0.0",))
578.     with pytest.warns(_api.MatplotlibDeprecationWarning):
579.         mpl.rcParams["svg.hashsalt"] = "foobar"
580.     assert mpl.rcParams["svg.hashsalt"] == "foobar"  # Doesn't warn.
581.     mpl.rcParams["svg.hashsalt"] = None  # Doesn't warn.
582. 
583.     mpl.rcParams.update(mpl.rcParams.copy())  # Doesn't warn.
584.     # Note that the warning suppression actually arises from the
585.     # iteration over the updater rcParams being protected by
586.     # suppress_matplotlib_deprecation_warning, rather than any explicit check.

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 03:18:14,726 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user explicitly asks for the full content of the file `lib/matplotlib/tests/test_rcparams.py`.\n\n2. Extended relevance:\n   - This context contains the first part of the requested file, from line 1 to 500. To provide the full file content, this entire block is necessary.', relative_path='lib/matplotlib/tests/test_rcparams.py', start_line=1, end_line=500), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user explicitly asks for the full content of the file `lib/matplotlib/tests/test_rcparams.py`.\n\n2. Extended relevance:\n   - This context contains the second and final part of the requested file, from line 501 to 586. To provide the full file content, this entire block is necessary.', relative_path='lib/matplotlib/tests/test_rcparams.py', start_line=501, end_line=586)]
2025-12-24 03:18:14,728 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_rcparams.py`.
2025-12-24 03:18:14,728 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 03:18:14,728 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 03:18:14,729 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 1 existing contexts
2025-12-24 03:18:14,729 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-24 03:18:14,730 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22567-IT.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   ├── 22691-JMK.rst
|   |   |   |   ├── 22745-JMK.rst
|   |   |   |   ├── 23031-AL.rst
|   |   |   |   ├── 23170-JMK.rst
|   |   |   |   ├── 23188-JMK.rst
|   |   |   |   └── 23270-AL.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21584-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22167-EP.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22298-GL.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   ├── 22883-AL.rst
|   |   |   |   ├── 22885-AL.rst
|   |   |   |   ├── 23014-OG.rst
|   |   |   |   ├── 23045-OG.rst
|   |   |   |   ├── 23081-OG.rst
|   |   |   |   ├── 23166-ES.rst
|   |   |   |   ├── 23190-OG.rst
|   |   |   |   ├── 23232-TH.rst
|   |   |   |   ├── 23289-AL.rst
|   |   |   |   ├── 23302-TH.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       ├── 22738-JL.rst
|   |   |       ├── 22886-OG.rst
|   |   |       ├── 22952-TH.rst
|   |   |       ├── 23076-GL.rst
|   |   |       ├── 23077-GL.rst
|   |   |       ├── 23078-GL.rst
|   |   |       ├── 23079-GL.rst
|   |   |       ├── 23093-GL.rst
|   |   |       └── 23237-AL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   └── api_changes_3.5.2.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── rename_ncol_keyword_in_legend.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   ├── striped_lines.rst
|       |   ├── url_active_areas_rotate.rst
|       |   ├── use_contourpy.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   └── whats_new_3.5.2.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── cursor_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   ├── semilogx_demo.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stackplot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: get_backend() clears figures from Gcf.figs if they were created under rc_context

Description: ### Bug summary

calling `matplotlib.get_backend()` removes all figures from `Gcf` if the *first* figure in `Gcf.figs` was created in an `rc_context`.

### Code for reproduction

```python
import matplotlib.pyplot as plt
from matplotlib import get_backend, rc_context

# fig1 = plt.figure()  # <- UNCOMMENT THIS LINE AND IT WILL WORK
# plt.ion()            # <- ALTERNATIVELY, UNCOMMENT THIS LINE AND IT WILL ALSO WORK
with rc_context():
    fig2 = plt.figure()
before = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
get_backend()
after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'

assert before == after, '\n' + before + '\n' + after
```


### Actual outcome

```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-fa4d099aa289> in <cell line: 11>()
      9 after = f'{id(plt._pylab_helpers.Gcf)} {plt._pylab_helpers.Gcf.figs!r}'
     10 
---> 11 assert before == after, '\n' + before + '\n' + after
     12 

AssertionError: 
94453354309744 OrderedDict([(1, <matplotlib.backends.backend_qt.FigureManagerQT object at 0x7fb33e26c220>)])
94453354309744 OrderedDict()
```

### Expected outcome

The figure should not be missing from `Gcf`.  Consequences of this are, e.g, `plt.close(fig2)` doesn't work because `Gcf.destroy_fig()` can't find it.

### Additional information

_No response_

### Operating system

Xubuntu

### Matplotlib Version

3.5.2

### Matplotlib Backend

QtAgg

### Python version

Python 3.10.4

### Jupyter version

n/a

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/__init__.py b/lib/matplotlib/__init__.py
index c268a56724..c5c1a8e71a 100644
--- a/lib/matplotlib/__init__.py
+++ b/lib/matplotlib/__init__.py
@@ -1095,7 +1095,19 @@ def rc_context(rc=None, fname=None):
             rcParams.update(rc)
         yield
     finally:
-        dict.update(rcParams, orig)  # Revert to the original rcs.
+        # Revert to the original rcs, but preserve a resolved backend if the
+        # original value was the auto backend sentinel.
+        try:
+            original_backend = dict.__getitem__(orig, "backend")
+        except KeyError:
+            original_backend = None
+        if original_backend is rcsetup._auto_backend_sentinel:
+            # Get current backend without triggering resolution.
+            current_backend = dict.__getitem__(rcParams, "backend")
+            if current_backend is not rcsetup._auto_backend_sentinel:
+                # Preserve the resolved backend selected during the context.
+                dict.__setitem__(orig, "backend", current_backend)
+        dict.update(rcParams, orig)
 
 
 def use(backend, *, force=True):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `lib/matplotlib/tests/test_pyplot.py`.
Extra Requirements: 
Purpose: I need to analyze this file to find existing test cases that are relevant to the user's reported bug concerning `rc_context` and figure management in `pyplot`.

Previous refined query 2:
Essential Query: Please provide the full content of the file `lib/matplotlib/tests/test_rcparams.py`.
Extra Requirements: 
Purpose: I need to analyze `lib/matplotlib/tests/test_rcparams.py` to find tests related to `rc_context` and backend handling, which are central to the user's bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_pyplot.py
Line number range: 1 - 385
Content:
1. import difflib
2. import re
3. 
4. import numpy as np
5. import subprocess
6. import sys
7. from pathlib import Path
8. 
9. import pytest
10. 
11. import matplotlib as mpl
12. from matplotlib import pyplot as plt
13. from matplotlib._api import MatplotlibDeprecationWarning
14. 
15. 
16. def test_pyplot_up_to_date(tmpdir):
17.     gen_script = Path(mpl.__file__).parents[2] / "tools/boilerplate.py"
18.     if not gen_script.exists():
19.         pytest.skip("boilerplate.py not found")
20.     orig_contents = Path(plt.__file__).read_text()
21.     plt_file = tmpdir.join('pyplot.py')
22.     plt_file.write_text(orig_contents, 'utf-8')
23. 
24.     subprocess.run([sys.executable, str(gen_script), str(plt_file)],
25.                    check=True)
26.     new_contents = plt_file.read_text('utf-8')
27. 
28.     if orig_contents != new_contents:
29.         diff_msg = '\n'.join(
30.             difflib.unified_diff(
31.                 orig_contents.split('\n'), new_contents.split('\n'),
32.                 fromfile='found pyplot.py',
33.                 tofile='expected pyplot.py',
34.                 n=0, lineterm=''))
35.         pytest.fail(
36.             "pyplot.py is not up-to-date. Please run "
37.             "'python tools/boilerplate.py' to update pyplot.py. "
38.             "This needs to be done from an environment where your "
39.             "current working copy is installed (e.g. 'pip install -e'd). "
40.             "Here is a diff of unexpected differences:\n%s" % diff_msg
41.         )
42. 
43. 
44. def test_copy_docstring_and_deprecators(recwarn):
45.     @mpl._api.rename_parameter("(version)", "old", "new")
46.     @mpl._api.make_keyword_only("(version)", "kwo")
47.     def func(new, kwo=None):
48.         pass
49. 
50.     @plt._copy_docstring_and_deprecators(func)
51.     def wrapper_func(new, kwo=None):
52.         pass
53. 
54.     wrapper_func(None)
55.     wrapper_func(new=None)
56.     wrapper_func(None, kwo=None)
57.     wrapper_func(new=None, kwo=None)
58.     assert not recwarn
59.     with pytest.warns(MatplotlibDeprecationWarning):
60.         wrapper_func(old=None)
61.     with pytest.warns(MatplotlibDeprecationWarning):
62.         wrapper_func(None, None)
63. 
64. 
65. def test_pyplot_box():
66.     fig, ax = plt.subplots()
67.     plt.box(False)
68.     assert not ax.get_frame_on()
69.     plt.box(True)
70.     assert ax.get_frame_on()
71.     plt.box()
72.     assert not ax.get_frame_on()
73.     plt.box()
74.     assert ax.get_frame_on()
75. 
76. 
77. def test_stackplot_smoke():
78.     # Small smoke test for stackplot (see #12405)
79.     plt.stackplot([1, 2, 3], [1, 2, 3])
80. 
81. 
82. def test_nrows_error():
83.     with pytest.raises(TypeError):
84.         plt.subplot(nrows=1)
85.     with pytest.raises(TypeError):
86.         plt.subplot(ncols=1)
87. 
88. 
89. def test_ioff():
90.     plt.ion()
91.     assert mpl.is_interactive()
92.     with plt.ioff():
93.         assert not mpl.is_interactive()
94.     assert mpl.is_interactive()
95. 
96.     plt.ioff()
97.     assert not mpl.is_interactive()
98.     with plt.ioff():
99.         assert not mpl.is_interactive()
100.     assert not mpl.is_interactive()
101. 
102. 
103. def test_ion():
104.     plt.ioff()
105.     assert not mpl.is_interactive()
106.     with plt.ion():
107.         assert mpl.is_interactive()
108.     assert not mpl.is_interactive()
109. 
110.     plt.ion()
111.     assert mpl.is_interactive()
112.     with plt.ion():
113.         assert mpl.is_interactive()
114.     assert mpl.is_interactive()
115. 
116. 
117. def test_nested_ion_ioff():
118.     # initial state is interactive
119.     plt.ion()
120. 
121.     # mixed ioff/ion
122.     with plt.ioff():
123.         assert not mpl.is_interactive()
124.         with plt.ion():
125.             assert mpl.is_interactive()
126.         assert not mpl.is_interactive()
127.     assert mpl.is_interactive()
128. 
129.     # redundant contexts
130.     with plt.ioff():
131.         with plt.ioff():
132.             assert not mpl.is_interactive()
133.     assert mpl.is_interactive()
134. 
135.     with plt.ion():
136.         plt.ioff()
137.     assert mpl.is_interactive()
138. 
139.     # initial state is not interactive
140.     plt.ioff()
141. 
142.     # mixed ioff/ion
143.     with plt.ion():
144.         assert mpl.is_interactive()
145.         with plt.ioff():
146.             assert not mpl.is_interactive()
147.         assert mpl.is_interactive()
148.     assert not mpl.is_interactive()
149. 
150.     # redundant contexts
151.     with plt.ion():
152.         with plt.ion():
153.             assert mpl.is_interactive()
154.     assert not mpl.is_interactive()
155. 
156.     with plt.ioff():
157.         plt.ion()
158.     assert not mpl.is_interactive()
159. 
160. 
161. def test_close():
162.     try:
163.         plt.close(1.1)
164.     except TypeError as e:
165.         assert str(e) == "close() argument must be a Figure, an int, " \
166.                          "a string, or None, not <class 'float'>"
167. 
168. 
169. def test_subplot_reuse():
170.     ax1 = plt.subplot(121)
171.     assert ax1 is plt.gca()
172.     ax2 = plt.subplot(122)
173.     assert ax2 is plt.gca()
174.     ax3 = plt.subplot(121)
175.     assert ax1 is plt.gca()
176.     assert ax1 is ax3
177. 
178. 
179. def test_axes_kwargs():
180.     # plt.axes() always creates new axes, even if axes kwargs differ.
181.     plt.figure()
182.     ax = plt.axes()
183.     ax1 = plt.axes()
184.     assert ax is not None
185.     assert ax1 is not ax
186.     plt.close()
187. 
188.     plt.figure()
189.     ax = plt.axes(projection='polar')
190.     ax1 = plt.axes(projection='polar')
191.     assert ax is not None
192.     assert ax1 is not ax
193.     plt.close()
194. 
195.     plt.figure()
196.     ax = plt.axes(projection='polar')
197.     ax1 = plt.axes()
198.     assert ax is not None
199.     assert ax1.name == 'rectilinear'
200.     assert ax1 is not ax
201.     plt.close()
202. 
203. 
204. def test_subplot_replace_projection():
205.     # plt.subplot() searches for axes with the same subplot spec, and if one
206.     # exists, and the kwargs match returns it, create a new one if they do not
207.     fig = plt.figure()
208.     ax = plt.subplot(1, 2, 1)
209.     ax1 = plt.subplot(1, 2, 1)
210.     ax2 = plt.subplot(1, 2, 2)
211.     with pytest.warns(MatplotlibDeprecationWarning):
212.         ax3 = plt.subplot(1, 2, 1, projection='polar')
213.     ax4 = plt.subplot(1, 2, 1, projection='polar')
214.     assert ax is not None
215.     assert ax1 is ax
216.     assert ax2 is not ax
217.     assert ax3 is not ax
218.     assert ax3 is ax4
219. 
220.     assert ax not in fig.axes
221.     assert ax2 in fig.axes
222.     assert ax3 in fig.axes
223. 
224.     assert ax.name == 'rectilinear'
225.     assert ax2.name == 'rectilinear'
226.     assert ax3.name == 'polar'
227. 
228. 
229. def test_subplot_kwarg_collision():
230.     ax1 = plt.subplot(projection='polar', theta_offset=0)
231.     ax2 = plt.subplot(projection='polar', theta_offset=0)
232.     assert ax1 is ax2
233.     ax1.remove()
234.     ax3 = plt.subplot(projection='polar', theta_offset=1)
235.     assert ax1 is not ax3
236.     assert ax1 not in plt.gcf().axes
237. 
238. 
239. def test_gca():
240.     # plt.gca() returns an existing axes, unless there were no axes.
241.     plt.figure()
242.     ax = plt.gca()
243.     ax1 = plt.gca()
244.     assert ax is not None
245.     assert ax1 is ax
246.     plt.close()
247. 
248. 
249. def test_subplot_projection_reuse():
250.     # create an Axes
251.     ax1 = plt.subplot(111)
252.     # check that it is current
253.     assert ax1 is plt.gca()
254.     # make sure we get it back if we ask again
255.     assert ax1 is plt.subplot(111)
256.     # remove it
257.     ax1.remove()
258.     # create a polar plot
259.     ax2 = plt.subplot(111, projection='polar')
260.     assert ax2 is plt.gca()
261.     # this should have deleted the first axes
262.     assert ax1 not in plt.gcf().axes
263.     # assert we get it back if no extra parameters passed
264.     assert ax2 is plt.subplot(111)
265.     ax2.remove()
266.     # now check explicitly setting the projection to rectilinear
267.     # makes a new axes
268.     ax3 = plt.subplot(111, projection='rectilinear')
269.     assert ax3 is plt.gca()
270.     assert ax3 is not ax2
271.     assert ax2 not in plt.gcf().axes
272. 
273. 
274. def test_subplot_polar_normalization():
275.     ax1 = plt.subplot(111, projection='polar')
276.     ax2 = plt.subplot(111, polar=True)
277.     ax3 = plt.subplot(111, polar=True, projection='polar')
278.     assert ax1 is ax2
279.     assert ax1 is ax3
280. 
281.     with pytest.raises(ValueError,
282.                        match="polar=True, yet projection='3d'"):
283.         ax2 = plt.subplot(111, polar=True, projection='3d')
284. 
285. 
286. def test_subplot_change_projection():
287.     created_axes = set()
288.     ax = plt.subplot()
289.     created_axes.add(ax)
290.     projections = ('aitoff', 'hammer', 'lambert', 'mollweide',
291.                    'polar', 'rectilinear', '3d')
292.     for proj in projections:
293.         ax.remove()
294.         ax = plt.subplot(projection=proj)
295.         assert ax is plt.subplot()
296.         assert ax.name == proj
297.         created_axes.add(ax)
298.     # Check that each call created a new Axes.
299.     assert len(created_axes) == 1 + len(projections)
300. 
301. 
302. def test_polar_second_call():
303.     # the first call creates the axes with polar projection
304.     ln1, = plt.polar(0., 1., 'ro')
305.     assert isinstance(ln1, mpl.lines.Line2D)
306.     # the second call should reuse the existing axes
307.     ln2, = plt.polar(1.57, .5, 'bo')
308.     assert isinstance(ln2, mpl.lines.Line2D)
309.     assert ln1.axes is ln2.axes
310. 
311. 
312. def test_fallback_position():
313.     # check that position kwarg works if rect not supplied
314.     axref = plt.axes([0.2, 0.2, 0.5, 0.5])
315.     axtest = plt.axes(position=[0.2, 0.2, 0.5, 0.5])
316.     np.testing.assert_allclose(axtest.bbox.get_points(),
317.                                axref.bbox.get_points())
318. 
319.     # check that position kwarg ignored if rect is supplied
320.     axref = plt.axes([0.2, 0.2, 0.5, 0.5])
321.     axtest = plt.axes([0.2, 0.2, 0.5, 0.5], position=[0.1, 0.1, 0.8, 0.8])
322.     np.testing.assert_allclose(axtest.bbox.get_points(),
323.                                axref.bbox.get_points())
324. 
325. 
326. def test_set_current_figure_via_subfigure():
327.     fig1 = plt.figure()
328.     subfigs = fig1.subfigures(2)
329. 
330.     plt.figure()
331.     assert plt.gcf() != fig1
332. 
333.     current = plt.figure(subfigs[1])
334.     assert plt.gcf() == fig1
335.     assert current == fig1
336. 
337. 
338. def test_set_current_axes_on_subfigure():
339.     fig = plt.figure()
340.     subfigs = fig.subfigures(2)
341. 
342.     ax = subfigs[0].subplots(1, squeeze=True)
343.     subfigs[1].subplots(1, squeeze=True)
344. 
345.     assert plt.gca() != ax
346.     plt.sca(ax)
347.     assert plt.gca() == ax
348. 
349. 
350. def test_pylab_integration():
351.     IPython = pytest.importorskip("IPython")
352.     mpl.testing.subprocess_run_helper(
353.         IPython.start_ipython,
354.         "--pylab",
355.         "-c",
356.         ";".join((
357.             "import matplotlib.pyplot as plt",
358.             "assert plt._REPL_DISPLAYHOOK == plt._ReplDisplayHook.IPYTHON",
359.         )),
360.         timeout=60,
361.     )
362. 
363. 
364. def test_doc_pyplot_summary():
365.     """Test that pyplot_summary lists all the plot functions."""
366.     pyplot_docs = Path(__file__).parent / '../../../doc/api/pyplot_summary.rst'
367.     if not pyplot_docs.exists():
368.         pytest.skip("Documentation sources not available")
369. 
370.     lines = pyplot_docs.read_text()
371.     m = re.search(r':nosignatures:\n\n(.*?)\n\n', lines, re.DOTALL)
372.     doc_functions = set(line.strip() for line in m.group(1).split('\n'))
373.     plot_commands = set(plt.get_plot_commands())
374.     missing = plot_commands.difference(doc_functions)
375.     if missing:
376.         raise AssertionError(
377.             f"The following pyplot functions are not listed in the "
378.             f"documentation. Please add them to doc/api/pyplot_summary.rst: "
379.             f"{missing!r}")
380.     extra = doc_functions.difference(plot_commands)
381.     if extra:
382.         raise AssertionError(
383.             f"The following functions are listed in the pyplot documentation, "
384.             f"but they do not exist in pyplot. "
385.             f"Please remove them from doc/api/pyplot_summary.rst: {extra!r}")


File: lib/matplotlib/tests/test_rcparams.py
Line number range: 1 - 500
Content:
1. import copy
2. import os
3. from pathlib import Path
4. import subprocess
5. import sys
6. from unittest import mock
7. 
8. from cycler import cycler, Cycler
9. import pytest
10. 
11. import matplotlib as mpl
12. from matplotlib import _api, _c_internal_utils
13. import matplotlib.pyplot as plt
14. import matplotlib.colors as mcolors
15. import numpy as np
16. from matplotlib.rcsetup import (
17.     validate_bool,
18.     validate_color,
19.     validate_colorlist,
20.     _validate_color_or_linecolor,
21.     validate_cycler,
22.     validate_float,
23.     validate_fontstretch,
24.     validate_fontweight,
25.     validate_hatch,
26.     validate_hist_bins,
27.     validate_int,
28.     validate_markevery,
29.     validate_stringlist,
30.     _validate_linestyle,
31.     _listify_validator)
32. 
33. 
34. def test_rcparams(tmpdir):
35.     mpl.rc('text', usetex=False)
36.     mpl.rc('lines', linewidth=22)
37. 
38.     usetex = mpl.rcParams['text.usetex']
39.     linewidth = mpl.rcParams['lines.linewidth']
40. 
41.     rcpath = Path(tmpdir) / 'test_rcparams.rc'
42.     rcpath.write_text('lines.linewidth: 33', encoding='utf-8')
43. 
44.     # test context given dictionary
45.     with mpl.rc_context(rc={'text.usetex': not usetex}):
46.         assert mpl.rcParams['text.usetex'] == (not usetex)
47.     assert mpl.rcParams['text.usetex'] == usetex
48. 
49.     # test context given filename (mpl.rc sets linewidth to 33)
50.     with mpl.rc_context(fname=rcpath):
51.         assert mpl.rcParams['lines.linewidth'] == 33
52.     assert mpl.rcParams['lines.linewidth'] == linewidth
53. 
54.     # test context given filename and dictionary
55.     with mpl.rc_context(fname=rcpath, rc={'lines.linewidth': 44}):
56.         assert mpl.rcParams['lines.linewidth'] == 44
57.     assert mpl.rcParams['lines.linewidth'] == linewidth
58. 
59.     # test context as decorator (and test reusability, by calling func twice)
60.     @mpl.rc_context({'lines.linewidth': 44})
61.     def func():
62.         assert mpl.rcParams['lines.linewidth'] == 44
63. 
64.     func()
65.     func()
66. 
67.     # test rc_file
68.     mpl.rc_file(rcpath)
69.     assert mpl.rcParams['lines.linewidth'] == 33
70. 
71. 
72. def test_RcParams_class():
73.     rc = mpl.RcParams({'font.cursive': ['Apple Chancery',
74.                                         'Textile',
75.                                         'Zapf Chancery',
76.                                         'cursive'],
77.                        'font.family': 'sans-serif',
78.                        'font.weight': 'normal',
79.                        'font.size': 12})
80. 
81.     expected_repr = """
82. RcParams({'font.cursive': ['Apple Chancery',
83.                            'Textile',
84.                            'Zapf Chancery',
85.                            'cursive'],
86.           'font.family': ['sans-serif'],
87.           'font.size': 12.0,
88.           'font.weight': 'normal'})""".lstrip()
89. 
90.     assert expected_repr == repr(rc)
91. 
92.     expected_str = """
93. font.cursive: ['Apple Chancery', 'Textile', 'Zapf Chancery', 'cursive']
94. font.family: ['sans-serif']
95. font.size: 12.0
96. font.weight: normal""".lstrip()
97. 
98.     assert expected_str == str(rc)
99. 
100.     # test the find_all functionality
101.     assert ['font.cursive', 'font.size'] == sorted(rc.find_all('i[vz]'))
102.     assert ['font.family'] == list(rc.find_all('family'))
103. 
104. 
105. def test_rcparams_update():
106.     rc = mpl.RcParams({'figure.figsize': (3.5, 42)})
107.     bad_dict = {'figure.figsize': (3.5, 42, 1)}
108.     # make sure validation happens on input
109.     with pytest.raises(ValueError), \
110.          pytest.warns(UserWarning, match="validate"):
111.         rc.update(bad_dict)
112. 
113. 
114. def test_rcparams_init():
115.     with pytest.raises(ValueError), \
116.          pytest.warns(UserWarning, match="validate"):
117.         mpl.RcParams({'figure.figsize': (3.5, 42, 1)})
118. 
119. 
120. def test_Bug_2543():
121.     # Test that it possible to add all values to itself / deepcopy
122.     # https://github.com/matplotlib/matplotlib/issues/2543
123.     # We filter warnings at this stage since a number of them are raised
124.     # for deprecated rcparams as they should. We don't want these in the
125.     # printed in the test suite.
126.     with _api.suppress_matplotlib_deprecation_warning():
127.         with mpl.rc_context():
128.             _copy = mpl.rcParams.copy()
129.             for key in _copy:
130.                 mpl.rcParams[key] = _copy[key]
131.         with mpl.rc_context():
132.             copy.deepcopy(mpl.rcParams)
133.     with pytest.raises(ValueError):
134.         validate_bool(None)
135.     with pytest.raises(ValueError):
136.         with mpl.rc_context():
137.             mpl.rcParams['svg.fonttype'] = True
138. 
139. 
140. legend_color_tests = [
141.     ('face', {'color': 'r'}, mcolors.to_rgba('r')),
142.     ('face', {'color': 'inherit', 'axes.facecolor': 'r'},
143.      mcolors.to_rgba('r')),
144.     ('face', {'color': 'g', 'axes.facecolor': 'r'}, mcolors.to_rgba('g')),
145.     ('edge', {'color': 'r'}, mcolors.to_rgba('r')),
146.     ('edge', {'color': 'inherit', 'axes.edgecolor': 'r'},
147.      mcolors.to_rgba('r')),
148.     ('edge', {'color': 'g', 'axes.facecolor': 'r'}, mcolors.to_rgba('g'))
149. ]
150. legend_color_test_ids = [
151.     'same facecolor',
152.     'inherited facecolor',
153.     'different facecolor',
154.     'same edgecolor',
155.     'inherited edgecolor',
156.     'different facecolor',
157. ]
158. 
159. 
160. @pytest.mark.parametrize('color_type, param_dict, target', legend_color_tests,
161.                          ids=legend_color_test_ids)
162. def test_legend_colors(color_type, param_dict, target):
163.     param_dict[f'legend.{color_type}color'] = param_dict.pop('color')
164.     get_func = f'get_{color_type}color'
165. 
166.     with mpl.rc_context(param_dict):
167.         _, ax = plt.subplots()
168.         ax.plot(range(3), label='test')
169.         leg = ax.legend()
170.         assert getattr(leg.legendPatch, get_func)() == target
171. 
172. 
173. def test_mfc_rcparams():
174.     mpl.rcParams['lines.markerfacecolor'] = 'r'
175.     ln = mpl.lines.Line2D([1, 2], [1, 2])
176.     assert ln.get_markerfacecolor() == 'r'
177. 
178. 
179. def test_mec_rcparams():
180.     mpl.rcParams['lines.markeredgecolor'] = 'r'
181.     ln = mpl.lines.Line2D([1, 2], [1, 2])
182.     assert ln.get_markeredgecolor() == 'r'
183. 
184. 
185. def test_axes_titlecolor_rcparams():
186.     mpl.rcParams['axes.titlecolor'] = 'r'
187.     _, ax = plt.subplots()
188.     title = ax.set_title("Title")
189.     assert title.get_color() == 'r'
190. 
191. 
192. def test_Issue_1713(tmpdir):
193.     rcpath = Path(tmpdir) / 'test_rcparams.rc'
194.     rcpath.write_text('timezone: UTC', encoding='utf-8')
195.     with mock.patch('locale.getpreferredencoding', return_value='UTF-32-BE'):
196.         rc = mpl.rc_params_from_file(rcpath, True, False)
197.     assert rc.get('timezone') == 'UTC'
198. 
199. 
200. def test_animation_frame_formats():
201.     # Animation frame_format should allow any of the following
202.     # if any of these are not allowed, an exception will be raised
203.     # test for gh issue #17908
204.     for fmt in ['png', 'jpeg', 'tiff', 'raw', 'rgba', 'ppm',
205.                 'sgi', 'bmp', 'pbm', 'svg']:
206.         mpl.rcParams['animation.frame_format'] = fmt
207. 
208. 
209. def generate_validator_testcases(valid):
210.     validation_tests = (
211.         {'validator': validate_bool,
212.          'success': (*((_, True) for _ in
213.                        ('t', 'y', 'yes', 'on', 'true', '1', 1, True)),
214.                      *((_, False) for _ in
215.                        ('f', 'n', 'no', 'off', 'false', '0', 0, False))),
216.          'fail': ((_, ValueError)
217.                   for _ in ('aardvark', 2, -1, [], ))
218.          },
219.         {'validator': validate_stringlist,
220.          'success': (('', []),
221.                      ('a,b', ['a', 'b']),
222.                      ('aardvark', ['aardvark']),
223.                      ('aardvark, ', ['aardvark']),
224.                      ('aardvark, ,', ['aardvark']),
225.                      (['a', 'b'], ['a', 'b']),
226.                      (('a', 'b'), ['a', 'b']),
227.                      (iter(['a', 'b']), ['a', 'b']),
228.                      (np.array(['a', 'b']), ['a', 'b']),
229.                      ),
230.          'fail': ((set(), ValueError),
231.                   (1, ValueError),
232.                   ((1, 2), _api.MatplotlibDeprecationWarning),
233.                   (np.array([1, 2]), _api.MatplotlibDeprecationWarning),
234.                   )
235.          },
236.         {'validator': _listify_validator(validate_int, n=2),
237.          'success': ((_, [1, 2])
238.                      for _ in ('1, 2', [1.5, 2.5], [1, 2],
239.                                (1, 2), np.array((1, 2)))),
240.          'fail': ((_, ValueError)
241.                   for _ in ('aardvark', ('a', 1),
242.                             (1, 2, 3)
243.                             ))
244.          },
245.         {'validator': _listify_validator(validate_float, n=2),
246.          'success': ((_, [1.5, 2.5])
247.                      for _ in ('1.5, 2.5', [1.5, 2.5], [1.5, 2.5],
248.                                (1.5, 2.5), np.array((1.5, 2.5)))),
249.          'fail': ((_, ValueError)
250.                   for _ in ('aardvark', ('a', 1), (1, 2, 3), (None, ), None))
251.          },
252.         {'validator': validate_cycler,
253.          'success': (('cycler("color", "rgb")',
254.                       cycler("color", 'rgb')),
255.                      (cycler('linestyle', ['-', '--']),
256.                       cycler('linestyle', ['-', '--'])),
257.                      ("""(cycler("color", ["r", "g", "b"]) +
258.                           cycler("mew", [2, 3, 5]))""",
259.                       (cycler("color", 'rgb') +
260.                        cycler("markeredgewidth", [2, 3, 5]))),
261.                      ("cycler(c='rgb', lw=[1, 2, 3])",
262.                       cycler('color', 'rgb') + cycler('linewidth', [1, 2, 3])),
263.                      ("cycler('c', 'rgb') * cycler('linestyle', ['-', '--'])",
264.                       (cycler('color', 'rgb') *
265.                        cycler('linestyle', ['-', '--']))),
266.                      (cycler('ls', ['-', '--']),
267.                       cycler('linestyle', ['-', '--'])),
268.                      (cycler(mew=[2, 5]),
269.                       cycler('markeredgewidth', [2, 5])),
270.                      ),
271.          # This is *so* incredibly important: validate_cycler() eval's
272.          # an arbitrary string! I think I have it locked down enough,
273.          # and that is what this is testing.
274.          # TODO: Note that these tests are actually insufficient, as it may
275.          # be that they raised errors, but still did an action prior to
276.          # raising the exception. We should devise some additional tests
277.          # for that...
278.          'fail': ((4, ValueError),  # Gotta be a string or Cycler object
279.                   ('cycler("bleh, [])', ValueError),  # syntax error
280.                   ('Cycler("linewidth", [1, 2, 3])',
281.                    ValueError),  # only 'cycler()' function is allowed
282.                   # do not allow dunder in string literals
283.                   ("cycler('c', [j.__class__(j) for j in ['r', 'b']])",
284.                    ValueError),
285.                   ("cycler('c', [j. __class__(j) for j in ['r', 'b']])",
286.                    ValueError),
287.                   ("cycler('c', [j.\t__class__(j) for j in ['r', 'b']])",
288.                    ValueError),
289.                   ("cycler('c', [j.\u000c__class__(j) for j in ['r', 'b']])",
290.                    ValueError),
291.                   ("cycler('c', [j.__class__(j).lower() for j in ['r', 'b']])",
292.                    ValueError),
293.                   ('1 + 2', ValueError),  # doesn't produce a Cycler object
294.                   ('os.system("echo Gotcha")', ValueError),  # os not available
295.                   ('import os', ValueError),  # should not be able to import
296.                   ('def badjuju(a): return a; badjuju(cycler("color", "rgb"))',
297.                    ValueError),  # Should not be able to define anything
298.                   # even if it does return a cycler
299.                   ('cycler("waka", [1, 2, 3])', ValueError),  # not a property
300.                   ('cycler(c=[1, 2, 3])', ValueError),  # invalid values
301.                   ("cycler(lw=['a', 'b', 'c'])", ValueError),  # invalid values
302.                   (cycler('waka', [1, 3, 5]), ValueError),  # not a property
303.                   (cycler('color', ['C1', 'r', 'g']), ValueError)  # no CN
304.                   )
305.          },
306.         {'validator': validate_hatch,
307.          'success': (('--|', '--|'), ('\\oO', '\\oO'),
308.                      ('/+*/.x', '/+*/.x'), ('', '')),
309.          'fail': (('--_', ValueError),
310.                   (8, ValueError),
311.                   ('X', ValueError)),
312.          },
313.         {'validator': validate_colorlist,
314.          'success': (('r,g,b', ['r', 'g', 'b']),
315.                      (['r', 'g', 'b'], ['r', 'g', 'b']),
316.                      ('r, ,', ['r']),
317.                      (['', 'g', 'blue'], ['g', 'blue']),
318.                      ([np.array([1, 0, 0]), np.array([0, 1, 0])],
319.                      np.array([[1, 0, 0], [0, 1, 0]])),
320.                      (np.array([[1, 0, 0], [0, 1, 0]]),
321.                      np.array([[1, 0, 0], [0, 1, 0]])),
322.                      ),
323.          'fail': (('fish', ValueError),
324.                   ),
325.          },
326.         {'validator': validate_color,
327.          'success': (('None', 'none'),
328.                      ('none', 'none'),
329.                      ('AABBCC', '#AABBCC'),  # RGB hex code
330.                      ('AABBCC00', '#AABBCC00'),  # RGBA hex code
331.                      ('tab:blue', 'tab:blue'),  # named color
332.                      ('C12', 'C12'),  # color from cycle
333.                      ('(0, 1, 0)', (0.0, 1.0, 0.0)),  # RGB tuple
334.                      ((0, 1, 0), (0, 1, 0)),  # non-string version
335.                      ('(0, 1, 0, 1)', (0.0, 1.0, 0.0, 1.0)),  # RGBA tuple
336.                      ((0, 1, 0, 1), (0, 1, 0, 1)),  # non-string version
337.                      ),
338.          'fail': (('tab:veryblue', ValueError),  # invalid name
339.                   ('(0, 1)', ValueError),  # tuple with length < 3
340.                   ('(0, 1, 0, 1, 0)', ValueError),  # tuple with length > 4
341.                   ('(0, 1, none)', ValueError),  # cannot cast none to float
342.                   ('(0, 1, "0.5")', ValueError),  # last one not a float
343.                   ),
344.          },
345.         {'validator': _validate_color_or_linecolor,
346.          'success': (('linecolor', 'linecolor'),
347.                      ('markerfacecolor', 'markerfacecolor'),
348.                      ('mfc', 'markerfacecolor'),
349.                      ('markeredgecolor', 'markeredgecolor'),
350.                      ('mec', 'markeredgecolor')
351.                      ),
352.          'fail': (('line', ValueError),
353.                   ('marker', ValueError)
354.                   )
355.          },
356.         {'validator': validate_hist_bins,
357.          'success': (('auto', 'auto'),
358.                      ('fd', 'fd'),
359.                      ('10', 10),
360.                      ('1, 2, 3', [1, 2, 3]),
361.                      ([1, 2, 3], [1, 2, 3]),
362.                      (np.arange(15), np.arange(15))
363.                      ),
364.          'fail': (('aardvark', ValueError),
365.                   )
366.          },
367.         {'validator': validate_markevery,
368.          'success': ((None, None),
369.                      (1, 1),
370.                      (0.1, 0.1),
371.                      ((1, 1), (1, 1)),
372.                      ((0.1, 0.1), (0.1, 0.1)),
373.                      ([1, 2, 3], [1, 2, 3]),
374.                      (slice(2), slice(None, 2, None)),
375.                      (slice(1, 2, 3), slice(1, 2, 3))
376.                      ),
377.          'fail': (((1, 2, 3), TypeError),
378.                   ([1, 2, 0.3], TypeError),
379.                   (['a', 2, 3], TypeError),
380.                   ([1, 2, 'a'], TypeError),
381.                   ((0.1, 0.2, 0.3), TypeError),
382.                   ((0.1, 2, 3), TypeError),
383.                   ((1, 0.2, 0.3), TypeError),
384.                   ((1, 0.1), TypeError),
385.                   ((0.1, 1), TypeError),
386.                   (('abc'), TypeError),
387.                   ((1, 'a'), TypeError),
388.                   ((0.1, 'b'), TypeError),
389.                   (('a', 1), TypeError),
390.                   (('a', 0.1), TypeError),
391.                   ('abc', TypeError),
392.                   ('a', TypeError),
393.                   (object(), TypeError)
394.                   )
395.          },
396.         {'validator': _validate_linestyle,
397.          'success': (('-', '-'), ('solid', 'solid'),
398.                      ('--', '--'), ('dashed', 'dashed'),
399.                      ('-.', '-.'), ('dashdot', 'dashdot'),
400.                      (':', ':'), ('dotted', 'dotted'),
401.                      ('', ''), (' ', ' '),
402.                      ('None', 'none'), ('none', 'none'),
403.                      ('DoTtEd', 'dotted'),  # case-insensitive
404.                      ('1, 3', (0, (1, 3))),
405.                      ([1.23, 456], (0, [1.23, 456.0])),
406.                      ([1, 2, 3, 4], (0, [1.0, 2.0, 3.0, 4.0])),
407.                      ((0, [1, 2]), (0, [1, 2])),
408.                      ((-1, [1, 2]), (-1, [1, 2])),
409.                      ),
410.          'fail': (('aardvark', ValueError),  # not a valid string
411.                   (b'dotted', ValueError),
412.                   ('dotted'.encode('utf-16'), ValueError),
413.                   ([1, 2, 3], ValueError),  # sequence with odd length
414.                   (1.23, ValueError),  # not a sequence
415.                   (("a", [1, 2]), ValueError),  # wrong explicit offset
416.                   ((None, [1, 2]), ValueError),  # wrong explicit offset
417.                   ((1, [1, 2, 3]), ValueError),  # odd length sequence
418.                   (([1, 2], 1), ValueError),  # inverted offset/onoff
419.                   )
420.          },
421.     )
422. 
423.     for validator_dict in validation_tests:
424.         validator = validator_dict['validator']
425.         if valid:
426.             for arg, target in validator_dict['success']:
427.                 yield validator, arg, target
428.         else:
429.             for arg, error_type in validator_dict['fail']:
430.                 yield validator, arg, error_type
431. 
432. 
433. @pytest.mark.parametrize('validator, arg, target',
434.                          generate_validator_testcases(True))
435. def test_validator_valid(validator, arg, target):
436.     res = validator(arg)
437.     if isinstance(target, np.ndarray):
438.         np.testing.assert_equal(res, target)
439.     elif not isinstance(target, Cycler):
440.         assert res == target
441.     else:
442.         # Cyclers can't simply be asserted equal. They don't implement __eq__
443.         assert list(res) == list(target)
444. 
445. 
446. @pytest.mark.parametrize('validator, arg, exception_type',
447.                          generate_validator_testcases(False))
448. def test_validator_invalid(validator, arg, exception_type):
449.     with pytest.raises(exception_type):
450.         validator(arg)
451. 
452. 
453. @pytest.mark.parametrize('weight, parsed_weight', [
454.     ('bold', 'bold'),
455.     ('BOLD', ValueError),  # weight is case-sensitive
456.     (100, 100),
457.     ('100', 100),
458.     (np.array(100), 100),
459.     # fractional fontweights are not defined. This should actually raise a
460.     # ValueError, but historically did not.
461.     (20.6, 20),
462.     ('20.6', ValueError),
463.     ([100], ValueError),
464. ])
465. def test_validate_fontweight(weight, parsed_weight):
466.     if parsed_weight is ValueError:
467.         with pytest.raises(ValueError):
468.             validate_fontweight(weight)
469.     else:
470.         assert validate_fontweight(weight) == parsed_weight
471. 
472. 
473. @pytest.mark.parametrize('stretch, parsed_stretch', [
474.     ('expanded', 'expanded'),
475.     ('EXPANDED', ValueError),  # stretch is case-sensitive
476.     (100, 100),
477.     ('100', 100),
478.     (np.array(100), 100),
479.     # fractional fontweights are not defined. This should actually raise a
480.     # ValueError, but historically did not.
481.     (20.6, 20),
482.     ('20.6', ValueError),
483.     ([100], ValueError),
484. ])
485. def test_validate_fontstretch(stretch, parsed_stretch):
486.     if parsed_stretch is ValueError:
487.         with pytest.raises(ValueError):
488.             validate_fontstretch(stretch)
489.     else:
490.         assert validate_fontstretch(stretch) == parsed_stretch
491. 
492. 
493. def test_keymaps():
494.     key_list = [k for k in mpl.rcParams if 'keymap' in k]
495.     for k in key_list:
496.         assert isinstance(mpl.rcParams[k], list)
497. 
498. 
499. def test_rcparams_reset_after_fail():
500.     # There was previously a bug that meant that if rc_context failed and


File: lib/matplotlib/tests/test_rcparams.py
Line number range: 501 - 586
Content:
501.     # raised an exception due to issues in the supplied rc parameters, the
502.     # global rc parameters were left in a modified state.
503.     with mpl.rc_context(rc={'text.usetex': False}):
504.         assert mpl.rcParams['text.usetex'] is False
505.         with pytest.raises(KeyError):
506.             with mpl.rc_context(rc={'text.usetex': True, 'test.blah': True}):
507.                 pass
508.         assert mpl.rcParams['text.usetex'] is False
509. 
510. 
511. @pytest.mark.skipif(sys.platform != "linux", reason="Linux only")
512. def test_backend_fallback_headless(tmpdir):
513.     env = {**os.environ,
514.            "DISPLAY": "", "WAYLAND_DISPLAY": "",
515.            "MPLBACKEND": "", "MPLCONFIGDIR": str(tmpdir)}
516.     with pytest.raises(subprocess.CalledProcessError):
517.         subprocess.run(
518.             [sys.executable, "-c",
519.              "import matplotlib;"
520.              "matplotlib.use('tkagg');"
521.              "import matplotlib.pyplot;"
522.              "matplotlib.pyplot.plot(42);"
523.              ],
524.             env=env, check=True, stderr=subprocess.DEVNULL)
525. 
526. 
527. @pytest.mark.skipif(
528.     sys.platform == "linux" and not _c_internal_utils.display_is_valid(),
529.     reason="headless")
530. def test_backend_fallback_headful(tmpdir):
531.     pytest.importorskip("tkinter")
532.     env = {**os.environ, "MPLBACKEND": "", "MPLCONFIGDIR": str(tmpdir)}
533.     backend = subprocess.check_output(
534.         [sys.executable, "-c",
535.          "import matplotlib as mpl; "
536.          "sentinel = mpl.rcsetup._auto_backend_sentinel; "
537.          # Check that access on another instance does not resolve the sentinel.
538.          "assert mpl.RcParams({'backend': sentinel})['backend'] == sentinel; "
539.          "assert dict.__getitem__(mpl.rcParams, 'backend') == sentinel; "
540.          "import matplotlib.pyplot; "
541.          "print(matplotlib.get_backend())"],
542.         env=env, universal_newlines=True)
543.     # The actual backend will depend on what's installed, but at least tkagg is
544.     # present.
545.     assert backend.strip().lower() != "agg"
546. 
547. 
548. def test_deprecation(monkeypatch):
549.     monkeypatch.setitem(
550.         mpl._deprecated_map, "patch.linewidth",
551.         ("0.0", "axes.linewidth", lambda old: 2 * old, lambda new: new / 2))
552.     with pytest.warns(_api.MatplotlibDeprecationWarning):
553.         assert mpl.rcParams["patch.linewidth"] \
554.             == mpl.rcParams["axes.linewidth"] / 2
555.     with pytest.warns(_api.MatplotlibDeprecationWarning):
556.         mpl.rcParams["patch.linewidth"] = 1
557.     assert mpl.rcParams["axes.linewidth"] == 2
558. 
559.     monkeypatch.setitem(
560.         mpl._deprecated_ignore_map, "patch.edgecolor",
561.         ("0.0", "axes.edgecolor"))
562.     with pytest.warns(_api.MatplotlibDeprecationWarning):
563.         assert mpl.rcParams["patch.edgecolor"] \
564.             == mpl.rcParams["axes.edgecolor"]
565.     with pytest.warns(_api.MatplotlibDeprecationWarning):
566.         mpl.rcParams["patch.edgecolor"] = "#abcd"
567.     assert mpl.rcParams["axes.edgecolor"] != "#abcd"
568. 
569.     monkeypatch.setitem(
570.         mpl._deprecated_ignore_map, "patch.force_edgecolor",
571.         ("0.0", None))
572.     with pytest.warns(_api.MatplotlibDeprecationWarning):
573.         assert mpl.rcParams["patch.force_edgecolor"] is None
574. 
575.     monkeypatch.setitem(
576.         mpl._deprecated_remain_as_none, "svg.hashsalt",
577.         ("0.0",))
578.     with pytest.warns(_api.MatplotlibDeprecationWarning):
579.         mpl.rcParams["svg.hashsalt"] = "foobar"
580.     assert mpl.rcParams["svg.hashsalt"] == "foobar"  # Doesn't warn.
581.     mpl.rcParams["svg.hashsalt"] = None  # Doesn't warn.
582. 
583.     mpl.rcParams.update(mpl.rcParams.copy())  # Doesn't warn.
584.     # Note that the warning suppression actually arises from the
585.     # iteration over the updater rcParams being protected by
586.     # suppress_matplotlib_deprecation_warning, rather than any explicit check.

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 03:19:20,809 - thread-125238176093888.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have analyzed the provided test files, `test_pyplot.py` and `test_rcparams.py`. The bug involves the interaction between `rc_context`, figure creation, and backend resolution. While no single test case perfectly mirrors the user's bug report, I have identified three relevant test cases that cover these different aspects.\n\n1. `test_rcparams.py::test_legend_colors` demonstrates the use of `rc_context` in conjunction with plot creation (`plt.subplots`), which is similar to the bug's scenario.\n2. `test_rcparams.py::test_backend_fallback_headful` tests the automatic backend selection, which is the underlying mechanism triggered by `get_backend()` and is crucial to understanding the bug.\n3. `test_pyplot.py::test_subplot_kwarg_collision` shows how to assert the state of the current figure's axes (`plt.gcf().axes`), which is a similar pattern to what would be needed to test the bug's effect on `Gcf.figs`.\n\nTogether, these three tests provide sufficient insight into how the related components are tested in the codebase. Therefore, I have enough context to proceed." query='' extra_requirements='' purpose=''
2025-12-24 03:19:20,810 - thread-125238176093888.prometheus_context_collector - INFO - Successfully retrieved 3 context snippets
