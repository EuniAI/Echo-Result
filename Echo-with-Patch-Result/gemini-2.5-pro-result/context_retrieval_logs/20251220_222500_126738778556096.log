2025-12-20 22:25:00,177 - thread-126738778556096.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: `is_subset` gives wrong results

Description: @sylee957 Current status on `master`,
```python
>>> a = FiniteSet(1, 2)
>>> b = ProductSet(a, a)
>>> c = FiniteSet((1, 1), (1, 2), (2, 1), (2, 2))
>>> b.intersection(c) == c.intersection(b)
True
>>> b.is_subset(c)
>>> c.is_subset(b)
True
>>> Eq(b, c).simplify()
Traceback (most recent call last):
  File "/usr/lib/python3.6/code.py", line 91, in runcode
    exec(code, self.locals)
  File "<console>", line 1, in <module>
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/basic.py", line 1655, in simplify
    return simplify(self, **kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/simplify/simplify.py", line 559, in simplify
    return _eval_simplify(**kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py", line 646, in _eval_simplify
    e = super(Equality, self)._eval_simplify(**kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py", line 308, in _eval_simplify
    elif dif.equals(0):  # XXX this is expensive
AttributeError: 'Complement' object has no attribute 'equals'
>>> b.rewrite(FiniteSet)
      2
{1, 2} 
>>> 
```

_Originally posted by @czgdp1807 in https://github.com/sympy/sympy/pull/16764#issuecomment-592606532_

Patch information:
diff --git a/sympy/core/relational.py b/sympy/core/relational.py
index e2e0b7fbcc..13fcfb2e84 100644
--- a/sympy/core/relational.py
+++ b/sympy/core/relational.py
@@ -309,9 +309,9 @@ def _eval_simplify(self, **kwargs):
             # replace dif with a valid Number that will
             # allow a definitive comparison with 0
             v = None
-            if dif.is_comparable:
+            if isinstance(dif, Expr) and dif.is_comparable:
                 v = dif.n(2)
-            elif dif.equals(0):  # XXX this is expensive
+            elif hasattr(dif, 'equals') and dif.equals(0):  # XXX this is expensive
                 v = S.Zero
             if v is not None:
                 r = r.func._eval_relation(v, S.Zero)
diff --git a/sympy/sets/handlers/issubset.py b/sympy/sets/handlers/issubset.py
index fdca06025a..7986145130 100644
--- a/sympy/sets/handlers/issubset.py
+++ b/sympy/sets/handlers/issubset.py
@@ -1,7 +1,7 @@
 from sympy import S, Symbol
 from sympy.core.logic import fuzzy_and, fuzzy_bool, fuzzy_not, fuzzy_or
 from sympy.core.relational import Eq
-from sympy.sets.sets import FiniteSet, Interval, Set, Union
+from sympy.sets.sets import FiniteSet, Interval, Set, Union, ProductSet
 from sympy.sets.fancysets import Complexes, Reals, Range, Rationals
 from sympy.multipledispatch import dispatch
 
@@ -133,3 +133,27 @@ def is_subset_sets(a, b): # noqa:F811
 @dispatch(Rationals, Range)  # type: ignore # noqa:F811
 def is_subset_sets(a, b): # noqa:F811
     return False
+
+@dispatch(ProductSet, ProductSet)  # type: ignore # noqa:F811
+def is_subset_sets(a_prod, b_prod): # noqa:F811
+    if len(a_prod.sets) != len(b_prod.sets):
+        return False
+    return fuzzy_and(s.is_subset(t) for s, t in zip(a_prod.sets, b_prod.sets))
+
+@dispatch(ProductSet, FiniteSet)  # type: ignore # noqa:F811
+def is_subset_sets(a_prod, b_fs): # noqa:F811
+    # If product set is known infinite and b_fs is finite, cannot be a subset
+    if a_prod.is_finite_set is False and b_fs.is_finite_set:
+        return False
+    # If sizes are known, use a quick check
+    try:
+        a_size = len(a_prod)
+    except TypeError:
+        a_size = None
+    if a_size is not None:
+        if a_size > len(b_fs):
+            return False
+    try:
+        return fuzzy_and(b_fs.contains(x) for x in a_prod)
+    except TypeError:
+        return None
diff --git a/sympy/sets/sets.py b/sympy/sets/sets.py
index 3c4aa86e36..908c2be63e 100644
--- a/sympy/sets/sets.py
+++ b/sympy/sets/sets.py
@@ -403,6 +403,24 @@ def _eval_is_superset(self, other):
         '''Returns a fuzzy bool for whether self is a subset of other.'''
         return None
 
+    def _eval_Eq(self, other):
+        """Evaluate set equality in terms of mutual subset.
+
+        Returns True if both are definitely subsets of each other, False if
+        either subset relation is definitely False, otherwise None.
+        """
+        if not isinstance(other, Set):
+            return None
+        l = self.is_subset(other)
+        if l is False:
+            return False
+        r = other.is_subset(self)
+        if r is False:
+            return False
+        if l is True and r is True:
+            return True
+        return None
+
     # This should be deprecated:
     def issubset(self, other):
         """


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-20 22:25:00,329 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .github
|   └── workflows
|       └── runtests.yml
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.md
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_optional_dependencies.py
|   ├── test_py2_import.py
|   ├── test_setup.py
|   ├── test_sphinx.sh
|   ├── test_submodule_imports.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── sparse.rst
|       |   |   └── sparsetools.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── control
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   ├── solvers.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── fu.rst
|       |   |   ├── hyperexpand.rst
|       |   |   ├── index.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── testing
|       |   |   ├── index.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   └── runtests.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       ├── intro.rst
|       |       └── vector_integration.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── aptinstall.sh
|   ├── authors.py
|   ├── build_docs.py
|   ├── compare_tar_against_git.py
|   ├── fabfile.py
|   ├── github_release.py
|   ├── helpers.py
|   ├── pull_and_run_rever.sh
|   ├── release.sh
|   ├── releasecheck.py
|   ├── requirements.txt
|   ├── sha256.py
|   ├── test_install.py
|   ├── update_docs.py
|   └── update_requirements.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── numpy_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   ├── scipy_nodes.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_array_utils.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_numpy_nodes.py
    |       ├── test_pyutils.py
    |       ├── test_rewriting.py
    |       └── test_scipy_nodes.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── schur_number.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_schur_number.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── _print_helpers.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── decompositions.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── determinant.py
    |   ├── eigen.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── companion.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── sets.py
    |   |   ├── slice.py
    |   |   ├── special.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_companion.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_sets.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_special.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── graph.py
    |   ├── immutable.py
    |   ├── inverse.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── reductions.py
    |   ├── solvers.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   ├── subspaces.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_commonmatrix.py
    |   |   ├── test_decompositions.py
    |   |   ├── test_densearith.py
    |   |   ├── test_densesolve.py
    |   |   ├── test_densetools.py
    |   |   ├── test_determinant.py
    |   |   ├── test_eigen.py
    |   |   ├── test_graph.py
    |   |   ├── test_immutable.py
    |   |   ├── test_interactions.py
    |   |   ├── test_matrices.py
    |   |   ├── test_normalforms.py
    |   |   ├── test_reductions.py
    |   |   ├── test_solvers.py
    |   |   ├── test_sparse.py
    |   |   ├── test_sparsetools.py
    |   |   └── test_subspaces.py
    |   └── utilities.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── digits.py
    |   ├── ecm.py
    |   ├── egyptian_fraction.py
    |   ├── elliptic_curve.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── qs.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_digits.py
    |       ├── test_ecm.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_elliptic_curve.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       ├── test_qs.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── README.txt
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── control
    |   |   ├── __init__.py
    |   |   ├── lti.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_lti.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domainmatrix.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gaussiandomains.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_domainmatrix.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── c.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxx.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── fortran.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_c.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxx.py
    |   |   ├── test_dot.py
    |   |   ├── test_fortran.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── comparison.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine
    |   |   ├── __init__.py
    |   |   ├── diophantine.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_diophantine.py
    |   ├── inequalities.py
    |   ├── ode
    |   |   ├── __init__.py
    |   |   ├── ode.py
    |   |   ├── single.py
    |   |   ├── subscheck.py
    |   |   ├── systems.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_ode.py
    |   |       ├── test_single.py
    |   |       ├── test_subscheck.py
    |   |       └── test_systems.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── compound_rv.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── matrix_distributions.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_multivariate_probability.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_compound_rv.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_matrix_distributions.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       ├── test_symbolic_multivariate.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── array_derivatives.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_array_derivatives.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── testing
    |   ├── __init__.py
    |   ├── benchmarking.py
    |   ├── matrices.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_module_imports.py
    |   |   └── test_pytest.py
    |   └── tmpfiles.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_matchpy_connector.py
    |   |   ├── test_misc.py
    |   |   ├── test_pickling.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── implicitregion.py
        ├── integrals.py
        ├── operators.py
        ├── orienters.py
        ├── parametricregion.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_implicitregion.py
        |   ├── test_integrals.py
        |   ├── test_operators.py
        |   ├── test_parametricregion.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: `is_subset` gives wrong results

Description: @sylee957 Current status on `master`,
```python
>>> a = FiniteSet(1, 2)
>>> b = ProductSet(a, a)
>>> c = FiniteSet((1, 1), (1, 2), (2, 1), (2, 2))
>>> b.intersection(c) == c.intersection(b)
True
>>> b.is_subset(c)
>>> c.is_subset(b)
True
>>> Eq(b, c).simplify()
Traceback (most recent call last):
  File "/usr/lib/python3.6/code.py", line 91, in runcode
    exec(code, self.locals)
  File "<console>", line 1, in <module>
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/basic.py", line 1655, in simplify
    return simplify(self, **kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/simplify/simplify.py", line 559, in simplify
    return _eval_simplify(**kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py", line 646, in _eval_simplify
    e = super(Equality, self)._eval_simplify(**kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py", line 308, in _eval_simplify
    elif dif.equals(0):  # XXX this is expensive
AttributeError: 'Complement' object has no attribute 'equals'
>>> b.rewrite(FiniteSet)
      2
{1, 2} 
>>> 
```

_Originally posted by @czgdp1807 in https://github.com/sympy/sympy/pull/16764#issuecomment-592606532_

Patch information:
diff --git a/sympy/core/relational.py b/sympy/core/relational.py
index e2e0b7fbcc..13fcfb2e84 100644
--- a/sympy/core/relational.py
+++ b/sympy/core/relational.py
@@ -309,9 +309,9 @@ def _eval_simplify(self, **kwargs):
             # replace dif with a valid Number that will
             # allow a definitive comparison with 0
             v = None
-            if dif.is_comparable:
+            if isinstance(dif, Expr) and dif.is_comparable:
                 v = dif.n(2)
-            elif dif.equals(0):  # XXX this is expensive
+            elif hasattr(dif, 'equals') and dif.equals(0):  # XXX this is expensive
                 v = S.Zero
             if v is not None:
                 r = r.func._eval_relation(v, S.Zero)
diff --git a/sympy/sets/handlers/issubset.py b/sympy/sets/handlers/issubset.py
index fdca06025a..7986145130 100644
--- a/sympy/sets/handlers/issubset.py
+++ b/sympy/sets/handlers/issubset.py
@@ -1,7 +1,7 @@
 from sympy import S, Symbol
 from sympy.core.logic import fuzzy_and, fuzzy_bool, fuzzy_not, fuzzy_or
 from sympy.core.relational import Eq
-from sympy.sets.sets import FiniteSet, Interval, Set, Union
+from sympy.sets.sets import FiniteSet, Interval, Set, Union, ProductSet
 from sympy.sets.fancysets import Complexes, Reals, Range, Rationals
 from sympy.multipledispatch import dispatch
 
@@ -133,3 +133,27 @@ def is_subset_sets(a, b): # noqa:F811
 @dispatch(Rationals, Range)  # type: ignore # noqa:F811
 def is_subset_sets(a, b): # noqa:F811
     return False
+
+@dispatch(ProductSet, ProductSet)  # type: ignore # noqa:F811
+def is_subset_sets(a_prod, b_prod): # noqa:F811
+    if len(a_prod.sets) != len(b_prod.sets):
+        return False
+    return fuzzy_and(s.is_subset(t) for s, t in zip(a_prod.sets, b_prod.sets))
+
+@dispatch(ProductSet, FiniteSet)  # type: ignore # noqa:F811
+def is_subset_sets(a_prod, b_fs): # noqa:F811
+    # If product set is known infinite and b_fs is finite, cannot be a subset
+    if a_prod.is_finite_set is False and b_fs.is_finite_set:
+        return False
+    # If sizes are known, use a quick check
+    try:
+        a_size = len(a_prod)
+    except TypeError:
+        a_size = None
+    if a_size is not None:
+        if a_size > len(b_fs):
+            return False
+    try:
+        return fuzzy_and(b_fs.contains(x) for x in a_prod)
+    except TypeError:
+        return None
diff --git a/sympy/sets/sets.py b/sympy/sets/sets.py
index 3c4aa86e36..908c2be63e 100644
--- a/sympy/sets/sets.py
+++ b/sympy/sets/sets.py
@@ -403,6 +403,24 @@ def _eval_is_superset(self, other):
         '''Returns a fuzzy bool for whether self is a subset of other.'''
         return None
 
+    def _eval_Eq(self, other):
+        """Evaluate set equality in terms of mutual subset.
+
+        Returns True if both are definitely subsets of each other, False if
+        either subset relation is definitely False, otherwise None.
+        """
+        if not isinstance(other, Set):
+            return None
+        l = self.is_subset(other)
+        if l is False:
+            return False
+        r = other.is_subset(self)
+        if r is False:
+            return False
+        if l is True and r is True:
+            return True
+        return None
+
     # This should be deprecated:
     def issubset(self, other):
         """


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-20 22:25:31,440 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug report focuses on the incorrect behavior of `is_subset` and equality comparisons between `ProductSet` and `FiniteSet`. The provided patch modifies `sympy/sets/sets.py` and `sympy/sets/handlers/issubset.py` to fix this. Therefore, the most relevant test cases are expected to be in `sympy/sets/tests/test_sets.py`, which should contain tests for set operations, including subset and equality checks for `ProductSet` and `FiniteSet`." query='Please provide the full content of the file `sympy/sets/tests/test_sets.py`.' extra_requirements='' purpose="I need to analyze the test cases in `sympy/sets/tests/test_sets.py` to find existing tests that cover the interaction between `ProductSet` and `FiniteSet` with respect to `is_subset` and `Eq` to answer the user's request."
2025-12-20 22:25:31,442 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `sympy/sets/tests/test_sets.py`.
2025-12-20 22:25:31,442 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-20 22:25:31,442 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-20 22:25:31,443 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-20 22:25:31,443 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `sympy/sets/tests/test_sets.py`.
Purpose: I need to analyze the test cases in `sympy/sets/tests/test_sets.py` to find existing tests that cover the interaction between `ProductSet` and `FiniteSet` with respect to `is_subset` and `Eq` to answer the user's request.
2025-12-20 22:25:33,669 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of the file `sympy/sets/tests/test_sets.py` to analyze the test cases. This will help in finding existing tests that cover the interaction between `ProductSet` and `FiniteSet` with respect to `is_subset` and `Eq`.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2148, 'candidates_token_count': 86, 'total_token_count': 2328, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2148}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 86}], 'thoughts_token_count': 94, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09091883481935013, 'model_name': 'gemini-2.5-pro'} id='run--ff9f24e2-e1ba-44e5-b603-6e65f54652e9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': '9d757214-e6d8-426b-a9e0-6434982bba84', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2148, 'output_tokens': 86, 'total_tokens': 2328, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 94}}
2025-12-20 22:25:36,295 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the first 500 lines of the requested file. I will now read the remaining lines to provide the complete content.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "end_line": 2000.0, "relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12168, 'candidates_token_count': 59, 'total_token_count': 12365, 'cached_content_token_count': 1894, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12168}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1894}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 59}], 'thoughts_token_count': 138}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3502049203646385, 'model_name': 'gemini-2.5-pro'} id='run--f6ea5e09-cdcc-465d-a42f-844c58a2fadd-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'end_line': 2000.0, 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': '651d36e3-3e7e-4c6b-938e-67474c6e5c20', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12168, 'output_tokens': 59, 'total_tokens': 12365, 'input_token_details': {'cache_read': 1894}, 'output_token_details': {'reasoning': 138}}
2025-12-20 22:25:41,609 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have finished retrieving the content of `sympy/sets/tests/test_sets.py` and will now search for test cases that cover the interaction between `ProductSet` and `FiniteSet` with respect to `is_subset` and `Eq`. I will start by looking for occurrences of `ProductSet` within the file to identify relevant test functions.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "ProductSet", "relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 34317, 'candidates_token_count': 110, 'total_token_count': 34801, 'cached_content_token_count': 11868, 'prompt_tokens_details': [{'modality': 1, 'token_count': 34317}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11868}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 110}], 'thoughts_token_count': 374}, 'finish_reason': 'STOP', 'avg_logprobs': -0.30684661865234375, 'model_name': 'gemini-2.5-pro'} id='run--7e92606f-1896-4df3-b04e-3915adf3dcb8-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'ProductSet', 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': 'd0b2c3b1-f4dd-4cab-8ce0-e00910e61492', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34317, 'output_tokens': 110, 'total_tokens': 34801, 'input_token_details': {'cache_read': 11868}, 'output_token_details': {'reasoning': 374}}
2025-12-20 22:25:44,588 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have found several test functions that use `ProductSet`, and some of them also use `FiniteSet`, which is a good starting point. To narrow down the search, I will now look for the `test_product_basic` and `test_Eq` functions, as their names suggest they might contain the specific interactions I'm looking for. I will start by examining the `test_product_basic` function." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "def test_product_basic", "relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 35276, 'candidates_token_count': 127, 'total_token_count': 35527, 'cached_content_token_count': 33545, 'prompt_tokens_details': [{'modality': 1, 'token_count': 35276}], 'cache_tokens_details': [{'modality': 1, 'token_count': 33545}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 127}], 'thoughts_token_count': 124}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17830276489257812, 'model_name': 'gemini-2.5-pro'} id='run--ec4c5e9b-1ba6-4c12-b2a0-3a166ea3d213-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'def test_product_basic', 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': 'c88e9741-9c59-4d3e-8f1d-875c4d9a4e4f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35276, 'output_tokens': 127, 'total_tokens': 35527, 'input_token_details': {'cache_read': 33545}, 'output_token_details': {'reasoning': 124}}
2025-12-20 22:25:48,375 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I've examined the `test_product_basic` function and found that it includes test cases for `is_subset` involving `ProductSet` and `FiniteSet`. To complete the request, I will now investigate the `test_Eq` function to see if it contains assertions related to the equality of these set types." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "def test_Eq", "relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 36100, 'candidates_token_count': 105, 'total_token_count': 36448, 'cached_content_token_count': 33522, 'prompt_tokens_details': [{'modality': 1, 'token_count': 36100}], 'cache_tokens_details': [{'modality': 1, 'token_count': 33522}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 105}], 'thoughts_token_count': 243}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3101635160900298, 'model_name': 'gemini-2.5-pro'} id='run--9af44f16-005c-4523-9307-8dfd0b17d751-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'def test_Eq', 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': '6f2dcab9-ff91-4c38-9bff-90044f89487f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36100, 'output_tokens': 105, 'total_tokens': 36448, 'input_token_details': {'cache_read': 33522}, 'output_token_details': {'reasoning': 243}}
2025-12-20 22:25:55,203 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have successfully retrieved the entire content of `sympy/sets/tests/test_sets.py` to analyze the test cases. I then located the `test_product_basic` and `test_Eq` functions, which contain the specific test cases for the interaction between `ProductSet` and `FiniteSet` with respect to `is_subset` and `Eq`. These findings will allow me to answer the user's request by providing the relevant code snippets that demonstrate the existing test coverage." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 36754, 'candidates_token_count': 102, 'total_token_count': 37491, 'cached_content_token_count': 35471, 'prompt_tokens_details': [{'modality': 1, 'token_count': 36754}], 'cache_tokens_details': [{'modality': 1, 'token_count': 35471}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 102}], 'thoughts_token_count': 635}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6580948175168505, 'model_name': 'gemini-2.5-pro'} id='run--d870704e-ef46-4927-a146-6904deb02569-0' usage_metadata={'input_tokens': 36754, 'output_tokens': 102, 'total_tokens': 37491, 'input_token_details': {'cache_read': 35471}, 'output_token_details': {'reasoning': 635}}
2025-12-20 22:25:55,206 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `sympy/sets/tests/test_sets.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to analyze the test cases in `sympy/sets/tests/test_sets.py` to find existing tests that cover the interaction between `ProductSet` and `FiniteSet` with respect to `is_subset` and `Eq` to answer the user's request.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/sets/tests/test_sets.py
Line number range: 1 - 500
Content:
1. from sympy import (Symbol, Set, Union, Interval, oo, S, sympify, nan,
2.     Max, Min, Float, DisjointUnion,
3.     FiniteSet, Intersection, imageset, I, true, false, ProductSet,
4.     sqrt, Complement, EmptySet, sin, cos, Lambda, ImageSet, pi,
5.     Pow, Contains, Sum, rootof, SymmetricDifference, Piecewise,
6.     Matrix, Range, Add, symbols, zoo, Rational)
7. from mpmath import mpi
8. 
9. from sympy.core.expr import unchanged
10. from sympy.core.relational import Eq, Ne, Le, Lt, LessThan
11. from sympy.logic import And, Or, Xor
12. from sympy.testing.pytest import raises, XFAIL, warns_deprecated_sympy
13. 
14. from sympy.abc import x, y, z, m, n
15. 
16. 
17. def test_imageset():
18.     ints = S.Integers
19.     assert imageset(x, x - 1, S.Naturals) is S.Naturals0
20.     assert imageset(x, x + 1, S.Naturals0) is S.Naturals
21.     assert imageset(x, abs(x), S.Naturals0) is S.Naturals0
22.     assert imageset(x, abs(x), S.Naturals) is S.Naturals
23.     assert imageset(x, abs(x), S.Integers) is S.Naturals0
24.     # issue 16878a
25.     r = symbols('r', real=True)
26.     assert imageset(x, (x, x), S.Reals)._contains((1, r)) == None
27.     assert imageset(x, (x, x), S.Reals)._contains((1, 2)) == False
28.     assert (r, r) in imageset(x, (x, x), S.Reals)
29.     assert 1 + I in imageset(x, x + I, S.Reals)
30.     assert {1} not in imageset(x, (x,), S.Reals)
31.     assert (1, 1) not in imageset(x, (x,) , S.Reals)
32.     raises(TypeError, lambda: imageset(x, ints))
33.     raises(ValueError, lambda: imageset(x, y, z, ints))
34.     raises(ValueError, lambda: imageset(Lambda(x, cos(x)), y))
35.     assert (1, 2) in imageset(Lambda((x, y), (x, y)), ints, ints)
36.     raises(ValueError, lambda: imageset(Lambda(x, x), ints, ints))
37.     assert imageset(cos, ints) == ImageSet(Lambda(x, cos(x)), ints)
38.     def f(x):
39.         return cos(x)
40.     assert imageset(f, ints) == imageset(x, cos(x), ints)
41.     f = lambda x: cos(x)
42.     assert imageset(f, ints) == ImageSet(Lambda(x, cos(x)), ints)
43.     assert imageset(x, 1, ints) == FiniteSet(1)
44.     assert imageset(x, y, ints) == {y}
45.     assert imageset((x, y), (1, z), ints, S.Reals) == {(1, z)}
46.     clash = Symbol('x', integer=true)
47.     assert (str(imageset(lambda x: x + clash, Interval(-2, 1)).lamda.expr)
48.         in ('x0 + x', 'x + x0'))
49.     x1, x2 = symbols("x1, x2")
50.     assert imageset(lambda x, y:
51.         Add(x, y), Interval(1, 2), Interval(2, 3)).dummy_eq(
52.         ImageSet(Lambda((x1, x2), x1 + x2),
53.         Interval(1, 2), Interval(2, 3)))
54. 
55. 
56. def test_is_empty():
57.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
58.             S.UniversalSet]:
59.         assert s.is_empty is False
60. 
61.     assert S.EmptySet.is_empty is True
62. 
63. 
64. def test_is_finiteset():
65.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
66.             S.UniversalSet]:
67.         assert s.is_finite_set is False
68. 
69.     assert S.EmptySet.is_finite_set is True
70. 
71.     assert FiniteSet(1, 2).is_finite_set is True
72.     assert Interval(1, 2).is_finite_set is False
73.     assert Interval(x, y).is_finite_set is None
74.     assert ProductSet(FiniteSet(1), FiniteSet(2)).is_finite_set is True
75.     assert ProductSet(FiniteSet(1), Interval(1, 2)).is_finite_set is False
76.     assert ProductSet(FiniteSet(1), Interval(x, y)).is_finite_set is None
77.     assert Union(Interval(0, 1), Interval(2, 3)).is_finite_set is False
78.     assert Union(FiniteSet(1), Interval(2, 3)).is_finite_set is False
79.     assert Union(FiniteSet(1), FiniteSet(2)).is_finite_set is True
80.     assert Union(FiniteSet(1), Interval(x, y)).is_finite_set is None
81.     assert Intersection(Interval(x, y), FiniteSet(1)).is_finite_set is True
82.     assert Intersection(Interval(x, y), Interval(1, 2)).is_finite_set is None
83.     assert Intersection(FiniteSet(x), FiniteSet(y)).is_finite_set is True
84.     assert Complement(FiniteSet(1), Interval(x, y)).is_finite_set is True
85.     assert Complement(Interval(x, y), FiniteSet(1)).is_finite_set is None
86.     assert Complement(Interval(1, 2), FiniteSet(x)).is_finite_set is False
87.     assert DisjointUnion(Interval(-5, 3), FiniteSet(x, y)).is_finite_set is False
88.     assert DisjointUnion(S.EmptySet, FiniteSet(x, y), S.EmptySet).is_finite_set is True
89. 
90. 
91. def test_deprecated_is_EmptySet():
92.     with warns_deprecated_sympy():
93.         S.EmptySet.is_EmptySet
94. 
95. 
96. def test_interval_arguments():
97.     assert Interval(0, oo) == Interval(0, oo, False, True)
98.     assert Interval(0, oo).right_open is true
99.     assert Interval(-oo, 0) == Interval(-oo, 0, True, False)
100.     assert Interval(-oo, 0).left_open is true
101.     assert Interval(oo, -oo) == S.EmptySet
102.     assert Interval(oo, oo) == S.EmptySet
103.     assert Interval(-oo, -oo) == S.EmptySet
104.     assert Interval(oo, x) == S.EmptySet
105.     assert Interval(oo, oo) == S.EmptySet
106.     assert Interval(x, -oo) == S.EmptySet
107.     assert Interval(x, x) == {x}
108. 
109.     assert isinstance(Interval(1, 1), FiniteSet)
110.     e = Sum(x, (x, 1, 3))
111.     assert isinstance(Interval(e, e), FiniteSet)
112. 
113.     assert Interval(1, 0) == S.EmptySet
114.     assert Interval(1, 1).measure == 0
115. 
116.     assert Interval(1, 1, False, True) == S.EmptySet
117.     assert Interval(1, 1, True, False) == S.EmptySet
118.     assert Interval(1, 1, True, True) == S.EmptySet
119. 
120. 
121.     assert isinstance(Interval(0, Symbol('a')), Interval)
122.     assert Interval(Symbol('a', real=True, positive=True), 0) == S.EmptySet
123.     raises(ValueError, lambda: Interval(0, S.ImaginaryUnit))
124.     raises(ValueError, lambda: Interval(0, Symbol('z', extended_real=False)))
125.     raises(ValueError, lambda: Interval(x, x + S.ImaginaryUnit))
126. 
127.     raises(NotImplementedError, lambda: Interval(0, 1, And(x, y)))
128.     raises(NotImplementedError, lambda: Interval(0, 1, False, And(x, y)))
129.     raises(NotImplementedError, lambda: Interval(0, 1, z, And(x, y)))
130. 
131. 
132. def test_interval_symbolic_end_points():
133.     a = Symbol('a', real=True)
134. 
135.     assert Union(Interval(0, a), Interval(0, 3)).sup == Max(a, 3)
136.     assert Union(Interval(a, 0), Interval(-3, 0)).inf == Min(-3, a)
137. 
138.     assert Interval(0, a).contains(1) == LessThan(1, a)
139. 
140. 
141. def test_interval_is_empty():
142.     x, y = symbols('x, y')
143.     r = Symbol('r', real=True)
144.     p = Symbol('p', positive=True)
145.     n = Symbol('n', negative=True)
146.     nn = Symbol('nn', nonnegative=True)
147.     assert Interval(1, 2).is_empty == False
148.     assert Interval(3, 3).is_empty == False  # FiniteSet
149.     assert Interval(r, r).is_empty == False  # FiniteSet
150.     assert Interval(r, r + nn).is_empty == False
151.     assert Interval(x, x).is_empty == False
152.     assert Interval(1, oo).is_empty == False
153.     assert Interval(-oo, oo).is_empty == False
154.     assert Interval(-oo, 1).is_empty == False
155.     assert Interval(x, y).is_empty == None
156.     assert Interval(r, oo).is_empty == False  # real implies finite
157.     assert Interval(n, 0).is_empty == False
158.     assert Interval(n, 0, left_open=True).is_empty == False
159.     assert Interval(p, 0).is_empty == True  # EmptySet
160.     assert Interval(nn, 0).is_empty == None
161.     assert Interval(n, p).is_empty == False
162.     assert Interval(0, p, left_open=True).is_empty == False
163.     assert Interval(0, p, right_open=True).is_empty == False
164.     assert Interval(0, nn, left_open=True).is_empty == None
165.     assert Interval(0, nn, right_open=True).is_empty == None
166. 
167. 
168. def test_union():
169.     assert Union(Interval(1, 2), Interval(2, 3)) == Interval(1, 3)
170.     assert Union(Interval(1, 2), Interval(2, 3, True)) == Interval(1, 3)
171.     assert Union(Interval(1, 3), Interval(2, 4)) == Interval(1, 4)
172.     assert Union(Interval(1, 2), Interval(1, 3)) == Interval(1, 3)
173.     assert Union(Interval(1, 3), Interval(1, 2)) == Interval(1, 3)
174.     assert Union(Interval(1, 3, False, True), Interval(1, 2)) == \
175.         Interval(1, 3, False, True)
176.     assert Union(Interval(1, 3), Interval(1, 2, False, True)) == Interval(1, 3)
177.     assert Union(Interval(1, 2, True), Interval(1, 3)) == Interval(1, 3)
178.     assert Union(Interval(1, 2, True), Interval(1, 3, True)) == \
179.         Interval(1, 3, True)
180.     assert Union(Interval(1, 2, True), Interval(1, 3, True, True)) == \
181.         Interval(1, 3, True, True)
182.     assert Union(Interval(1, 2, True, True), Interval(1, 3, True)) == \
183.         Interval(1, 3, True)
184.     assert Union(Interval(1, 3), Interval(2, 3)) == Interval(1, 3)
185.     assert Union(Interval(1, 3, False, True), Interval(2, 3)) == \
186.         Interval(1, 3)
187.     assert Union(Interval(1, 2, False, True), Interval(2, 3, True)) != \
188.         Interval(1, 3)
189.     assert Union(Interval(1, 2), S.EmptySet) == Interval(1, 2)
190.     assert Union(S.EmptySet) == S.EmptySet
191. 
192.     assert Union(Interval(0, 1), *[FiniteSet(1.0/n) for n in range(1, 10)]) == \
193.         Interval(0, 1)
194.     # issue #18241:
195.     x = Symbol('x')
196.     assert Union(Interval(0, 1), FiniteSet(1, x)) == Union(
197.         Interval(0, 1), FiniteSet(x))
198.     assert unchanged(Union, Interval(0, 1), FiniteSet(2, x))
199. 
200.     assert Interval(1, 2).union(Interval(2, 3)) == \
201.         Interval(1, 2) + Interval(2, 3)
202. 
203.     assert Interval(1, 2).union(Interval(2, 3)) == Interval(1, 3)
204. 
205.     assert Union(Set()) == Set()
206. 
207.     assert FiniteSet(1) + FiniteSet(2) + FiniteSet(3) == FiniteSet(1, 2, 3)
208.     assert FiniteSet('ham') + FiniteSet('eggs') == FiniteSet('ham', 'eggs')
209.     assert FiniteSet(1, 2, 3) + S.EmptySet == FiniteSet(1, 2, 3)
210. 
211.     assert FiniteSet(1, 2, 3) & FiniteSet(2, 3, 4) == FiniteSet(2, 3)
212.     assert FiniteSet(1, 2, 3) | FiniteSet(2, 3, 4) == FiniteSet(1, 2, 3, 4)
213. 
214.     assert FiniteSet(1, 2, 3) & S.EmptySet == S.EmptySet
215.     assert FiniteSet(1, 2, 3) | S.EmptySet == FiniteSet(1, 2, 3)
216. 
217.     x = Symbol("x")
218.     y = Symbol("y")
219.     z = Symbol("z")
220.     assert S.EmptySet | FiniteSet(x, FiniteSet(y, z)) == \
221.         FiniteSet(x, FiniteSet(y, z))
222. 
223.     # Test that Intervals and FiniteSets play nicely
224.     assert Interval(1, 3) + FiniteSet(2) == Interval(1, 3)
225.     assert Interval(1, 3, True, True) + FiniteSet(3) == \
226.         Interval(1, 3, True, False)
227.     X = Interval(1, 3) + FiniteSet(5)
228.     Y = Interval(1, 2) + FiniteSet(3)
229.     XandY = X.intersect(Y)
230.     assert 2 in X and 3 in X and 3 in XandY
231.     assert XandY.is_subset(X) and XandY.is_subset(Y)
232. 
233.     raises(TypeError, lambda: Union(1, 2, 3))
234. 
235.     assert X.is_iterable is False
236. 
237.     # issue 7843
238.     assert Union(S.EmptySet, FiniteSet(-sqrt(-I), sqrt(-I))) == \
239.         FiniteSet(-sqrt(-I), sqrt(-I))
240. 
241.     assert Union(S.Reals, S.Integers) == S.Reals
242. 
243. 
244. def test_union_iter():
245.     # Use Range because it is ordered
246.     u = Union(Range(3), Range(5), Range(4), evaluate=False)
247. 
248.     # Round robin
249.     assert list(u) == [0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 4]
250. 
251. 
252. def test_union_is_empty():
253.     assert (Interval(x, y) + FiniteSet(1)).is_empty == False
254.     assert (Interval(x, y) + Interval(-x, y)).is_empty == None
255. 
256. 
257. def test_difference():
258.     assert Interval(1, 3) - Interval(1, 2) == Interval(2, 3, True)
259.     assert Interval(1, 3) - Interval(2, 3) == Interval(1, 2, False, True)
260.     assert Interval(1, 3, True) - Interval(2, 3) == Interval(1, 2, True, True)
261.     assert Interval(1, 3, True) - Interval(2, 3, True) == \
262.         Interval(1, 2, True, False)
263.     assert Interval(0, 2) - FiniteSet(1) == \
264.         Union(Interval(0, 1, False, True), Interval(1, 2, True, False))
265. 
266.     # issue #18119
267.     assert S.Reals - FiniteSet(I) == S.Reals
268.     assert S.Reals - FiniteSet(-I, I) == S.Reals
269.     assert Interval(0, 10) - FiniteSet(-I, I) == Interval(0, 10)
270.     assert Interval(0, 10) - FiniteSet(1, I) == Union(
271.         Interval.Ropen(0, 1), Interval.Lopen(1, 10))
272.     assert S.Reals - FiniteSet(1, 2 + I, x, y**2) == Complement(
273.         Union(Interval.open(-oo, 1), Interval.open(1, oo)), FiniteSet(x, y**2),
274.         evaluate=False)
275. 
276.     assert FiniteSet(1, 2, 3) - FiniteSet(2) == FiniteSet(1, 3)
277.     assert FiniteSet('ham', 'eggs') - FiniteSet('eggs') == FiniteSet('ham')
278.     assert FiniteSet(1, 2, 3, 4) - Interval(2, 10, True, False) == \
279.         FiniteSet(1, 2)
280.     assert FiniteSet(1, 2, 3, 4) - S.EmptySet == FiniteSet(1, 2, 3, 4)
281.     assert Union(Interval(0, 2), FiniteSet(2, 3, 4)) - Interval(1, 3) == \
282.         Union(Interval(0, 1, False, True), FiniteSet(4))
283. 
284.     assert -1 in S.Reals - S.Naturals
285. 
286. 
287. def test_Complement():
288.     A = FiniteSet(1, 3, 4)
289.     B = FiniteSet(3, 4)
290.     C = Interval(1, 3)
291.     D = Interval(1, 2)
292. 
293.     assert Complement(A, B, evaluate=False).is_iterable is True
294.     assert Complement(A, C, evaluate=False).is_iterable is True
295.     assert Complement(C, D, evaluate=False).is_iterable is None
296. 
297.     assert FiniteSet(*Complement(A, B, evaluate=False)) == FiniteSet(1)
298.     assert FiniteSet(*Complement(A, C, evaluate=False)) == FiniteSet(4)
299.     raises(TypeError, lambda: FiniteSet(*Complement(C, A, evaluate=False)))
300. 
301.     assert Complement(Interval(1, 3), Interval(1, 2)) == Interval(2, 3, True)
302.     assert Complement(FiniteSet(1, 3, 4), FiniteSet(3, 4)) == FiniteSet(1)
303.     assert Complement(Union(Interval(0, 2), FiniteSet(2, 3, 4)),
304.                       Interval(1, 3)) == \
305.         Union(Interval(0, 1, False, True), FiniteSet(4))
306. 
307.     assert not 3 in Complement(Interval(0, 5), Interval(1, 4), evaluate=False)
308.     assert -1 in Complement(S.Reals, S.Naturals, evaluate=False)
309.     assert not 1 in Complement(S.Reals, S.Naturals, evaluate=False)
310. 
311.     assert Complement(S.Integers, S.UniversalSet) == EmptySet
312.     assert S.UniversalSet.complement(S.Integers) == EmptySet
313. 
314.     assert (not 0 in S.Reals.intersect(S.Integers - FiniteSet(0)))
315. 
316.     assert S.EmptySet - S.Integers == S.EmptySet
317. 
318.     assert (S.Integers - FiniteSet(0)) - FiniteSet(1) == S.Integers - FiniteSet(0, 1)
319. 
320.     assert S.Reals - Union(S.Naturals, FiniteSet(pi)) == \
321.             Intersection(S.Reals - S.Naturals, S.Reals - FiniteSet(pi))
322.     # issue 12712
323.     assert Complement(FiniteSet(x, y, 2), Interval(-10, 10)) == \
324.             Complement(FiniteSet(x, y), Interval(-10, 10))
325. 
326.     A = FiniteSet(*symbols('a:c'))
327.     B = FiniteSet(*symbols('d:f'))
328.     assert unchanged(Complement, ProductSet(A, A), B)
329. 
330.     A2 = ProductSet(A, A)
331.     B3 = ProductSet(B, B, B)
332.     assert A2 - B3 == A2
333.     assert B3 - A2 == B3
334. 
335. 
336. def test_set_operations_nonsets():
337.     '''Tests that e.g. FiniteSet(1) * 2 raises TypeError'''
338.     ops = [
339.         lambda a, b: a + b,
340.         lambda a, b: a - b,
341.         lambda a, b: a * b,
342.         lambda a, b: a / b,
343.         lambda a, b: a // b,
344.         lambda a, b: a | b,
345.         lambda a, b: a & b,
346.         lambda a, b: a ^ b,
347.         # FiniteSet(1) ** 2 gives a ProductSet
348.         #lambda a, b: a ** b,
349.     ]
350.     Sx = FiniteSet(x)
351.     Sy = FiniteSet(y)
352.     sets = [
353.         {1},
354.         FiniteSet(1),
355.         Interval(1, 2),
356.         Union(Sx, Interval(1, 2)),
357.         Intersection(Sx, Sy),
358.         Complement(Sx, Sy),
359.         ProductSet(Sx, Sy),
360.         S.EmptySet,
361.     ]
362.     nums = [0, 1, 2, S(0), S(1), S(2)]
363. 
364.     for si in sets:
365.         for ni in nums:
366.             for op in ops:
367.                 raises(TypeError, lambda : op(si, ni))
368.                 raises(TypeError, lambda : op(ni, si))
369.         raises(TypeError, lambda: si ** object())
370.         raises(TypeError, lambda: si ** {1})
371. 
372. 
373. def test_complement():
374.     assert Interval(0, 1).complement(S.Reals) == \
375.         Union(Interval(-oo, 0, True, True), Interval(1, oo, True, True))
376.     assert Interval(0, 1, True, False).complement(S.Reals) == \
377.         Union(Interval(-oo, 0, True, False), Interval(1, oo, True, True))
378.     assert Interval(0, 1, False, True).complement(S.Reals) == \
379.         Union(Interval(-oo, 0, True, True), Interval(1, oo, False, True))
380.     assert Interval(0, 1, True, True).complement(S.Reals) == \
381.         Union(Interval(-oo, 0, True, False), Interval(1, oo, False, True))
382. 
383.     assert S.UniversalSet.complement(S.EmptySet) == S.EmptySet
384.     assert S.UniversalSet.complement(S.Reals) == S.EmptySet
385.     assert S.UniversalSet.complement(S.UniversalSet) == S.EmptySet
386. 
387.     assert S.EmptySet.complement(S.Reals) == S.Reals
388. 
389.     assert Union(Interval(0, 1), Interval(2, 3)).complement(S.Reals) == \
390.         Union(Interval(-oo, 0, True, True), Interval(1, 2, True, True),
391.               Interval(3, oo, True, True))
392. 
393.     assert FiniteSet(0).complement(S.Reals) ==  \
394.         Union(Interval(-oo, 0, True, True), Interval(0, oo, True, True))
395. 
396.     assert (FiniteSet(5) + Interval(S.NegativeInfinity,
397.                                     0)).complement(S.Reals) == \
398.         Interval(0, 5, True, True) + Interval(5, S.Infinity, True, True)
399. 
400.     assert FiniteSet(1, 2, 3).complement(S.Reals) == \
401.         Interval(S.NegativeInfinity, 1, True, True) + \
402.         Interval(1, 2, True, True) + Interval(2, 3, True, True) +\
403.         Interval(3, S.Infinity, True, True)
404. 
405.     assert FiniteSet(x).complement(S.Reals) == Complement(S.Reals, FiniteSet(x))
406. 
407.     assert FiniteSet(0, x).complement(S.Reals) == Complement(Interval(-oo, 0, True, True) +
408.                                                              Interval(0, oo, True, True)
409.                                                              , FiniteSet(x), evaluate=False)
410. 
411.     square = Interval(0, 1) * Interval(0, 1)
412.     notsquare = square.complement(S.Reals*S.Reals)
413. 
414.     assert all(pt in square for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
415.     assert not any(
416.         pt in notsquare for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
417.     assert not any(pt in square for pt in [(-1, 0), (1.5, .5), (10, 10)])
418.     assert all(pt in notsquare for pt in [(-1, 0), (1.5, .5), (10, 10)])
419. 
420. 
421. def test_intersect1():
422.     assert all(S.Integers.intersection(i) is i for i in
423.         (S.Naturals, S.Naturals0))
424.     assert all(i.intersection(S.Integers) is i for i in
425.         (S.Naturals, S.Naturals0))
426.     s =  S.Naturals0
427.     assert S.Naturals.intersection(s) is S.Naturals
428.     assert s.intersection(S.Naturals) is S.Naturals
429.     x = Symbol('x')
430.     assert Interval(0, 2).intersect(Interval(1, 2)) == Interval(1, 2)
431.     assert Interval(0, 2).intersect(Interval(1, 2, True)) == \
432.         Interval(1, 2, True)
433.     assert Interval(0, 2, True).intersect(Interval(1, 2)) == \
434.         Interval(1, 2, False, False)
435.     assert Interval(0, 2, True, True).intersect(Interval(1, 2)) == \
436.         Interval(1, 2, False, True)
437.     assert Interval(0, 2).intersect(Union(Interval(0, 1), Interval(2, 3))) == \
438.         Union(Interval(0, 1), Interval(2, 2))
439. 
440.     assert FiniteSet(1, 2).intersect(FiniteSet(1, 2, 3)) == FiniteSet(1, 2)
441.     assert FiniteSet(1, 2, x).intersect(FiniteSet(x)) == FiniteSet(x)
442.     assert FiniteSet('ham', 'eggs').intersect(FiniteSet('ham')) == \
443.         FiniteSet('ham')
444.     assert FiniteSet(1, 2, 3, 4, 5).intersect(S.EmptySet) == S.EmptySet
445. 
446.     assert Interval(0, 5).intersect(FiniteSet(1, 3)) == FiniteSet(1, 3)
447.     assert Interval(0, 1, True, True).intersect(FiniteSet(1)) == S.EmptySet
448. 
449.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2)) == \
450.         Union(Interval(1, 1), Interval(2, 2))
451.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(0, 2)) == \
452.         Union(Interval(0, 1), Interval(2, 2))
453.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2, True, True)) == \
454.         S.EmptySet
455.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(S.EmptySet) == \
456.         S.EmptySet
457.     assert Union(Interval(0, 5), FiniteSet('ham')).intersect(FiniteSet(2, 3, 4, 5, 6)) == \
458.         Intersection(FiniteSet(2, 3, 4, 5, 6), Union(FiniteSet('ham'), Interval(0, 5)))
459.     assert Intersection(FiniteSet(1, 2, 3), Interval(2, x), Interval(3, y)) == \
460.         Intersection(FiniteSet(3), Interval(2, x), Interval(3, y), evaluate=False)
461.     assert Intersection(FiniteSet(1, 2), Interval(0, 3), Interval(x, y)) == \
462.         Intersection({1, 2}, Interval(x, y), evaluate=False)
463.     assert Intersection(FiniteSet(1, 2, 4), Interval(0, 3), Interval(x, y)) == \
464.         Intersection({1, 2}, Interval(x, y), evaluate=False)
465.     # XXX: Is the real=True necessary here?
466.     # https://github.com/sympy/sympy/issues/17532
467.     m, n = symbols('m, n', real=True)
468.     assert Intersection(FiniteSet(m), FiniteSet(m, n), Interval(m, m+1)) == \
469.         FiniteSet(m)
470. 
471.     # issue 8217
472.     assert Intersection(FiniteSet(x), FiniteSet(y)) == \
473.         Intersection(FiniteSet(x), FiniteSet(y), evaluate=False)
474.     assert FiniteSet(x).intersect(S.Reals) == \
475.         Intersection(S.Reals, FiniteSet(x), evaluate=False)
476. 
477.     # tests for the intersection alias
478.     assert Interval(0, 5).intersection(FiniteSet(1, 3)) == FiniteSet(1, 3)
479.     assert Interval(0, 1, True, True).intersection(FiniteSet(1)) == S.EmptySet
480. 
481.     assert Union(Interval(0, 1), Interval(2, 3)).intersection(Interval(1, 2)) == \
482.         Union(Interval(1, 1), Interval(2, 2))
483. 
484. 
485. def test_intersection():
486.     # iterable
487.     i = Intersection(FiniteSet(1, 2, 3), Interval(2, 5), evaluate=False)
488.     assert i.is_iterable
489.     assert set(i) == {S(2), S(3)}
490. 
491.     # challenging intervals
492.     x = Symbol('x', real=True)
493.     i = Intersection(Interval(0, 3), Interval(x, 6))
494.     assert (5 in i) is False
495.     raises(TypeError, lambda: 2 in i)
496. 
497.     # Singleton special cases
498.     assert Intersection(Interval(0, 1), S.EmptySet) == S.EmptySet
499.     assert Intersection(Interval(-oo, oo), Interval(-oo, x)) == Interval(-oo, x)
500.


File: sympy/sets/tests/test_sets.py
Line number range: 501 - 2000
Content:
501.     # Products
502.     line = Interval(0, 5)
503.     i = Intersection(line**2, line**3, evaluate=False)
504.     assert (2, 2) not in i
505.     assert (2, 2, 2) not in i
506.     raises(TypeError, lambda: list(i))
507. 
508.     a = Intersection(Intersection(S.Integers, S.Naturals, evaluate=False), S.Reals, evaluate=False)
509.     assert a._argset == frozenset([Intersection(S.Naturals, S.Integers, evaluate=False), S.Reals])
510. 
511.     assert Intersection(S.Complexes, FiniteSet(S.ComplexInfinity)) == S.EmptySet
512. 
513.     # issue 12178
514.     assert Intersection() == S.UniversalSet
515. 
516.     # issue 16987
517.     assert Intersection({1}, {1}, {x}) == Intersection({1}, {x})
518. 
519. 
520. def test_issue_9623():
521.     n = Symbol('n')
522. 
523.     a = S.Reals
524.     b = Interval(0, oo)
525.     c = FiniteSet(n)
526. 
527.     assert Intersection(a, b, c) == Intersection(b, c)
528.     assert Intersection(Interval(1, 2), Interval(3, 4), FiniteSet(n)) == EmptySet
529. 
530. 
531. def test_is_disjoint():
532.     assert Interval(0, 2).is_disjoint(Interval(1, 2)) == False
533.     assert Interval(0, 2).is_disjoint(Interval(3, 4)) == True
534. 
535. 
536. def test_ProductSet__len__():
537.     A = FiniteSet(1, 2)
538.     B = FiniteSet(1, 2, 3)
539.     assert ProductSet(A).__len__() == 2
540.     assert ProductSet(A).__len__() is not S(2)
541.     assert ProductSet(A, B).__len__() == 6
542.     assert ProductSet(A, B).__len__() is not S(6)
543. 
544. 
545. def test_ProductSet():
546.     # ProductSet is always a set of Tuples
547.     assert ProductSet(S.Reals) == S.Reals ** 1
548.     assert ProductSet(S.Reals, S.Reals) == S.Reals ** 2
549.     assert ProductSet(S.Reals, S.Reals, S.Reals) == S.Reals ** 3
550. 
551.     assert ProductSet(S.Reals) != S.Reals
552.     assert ProductSet(S.Reals, S.Reals) == S.Reals * S.Reals
553.     assert ProductSet(S.Reals, S.Reals, S.Reals) != S.Reals * S.Reals * S.Reals
554.     assert ProductSet(S.Reals, S.Reals, S.Reals) == (S.Reals * S.Reals * S.Reals).flatten()
555. 
556.     assert 1 not in ProductSet(S.Reals)
557.     assert (1,) in ProductSet(S.Reals)
558. 
559.     assert 1 not in ProductSet(S.Reals, S.Reals)
560.     assert (1, 2) in ProductSet(S.Reals, S.Reals)
561.     assert (1, I) not in ProductSet(S.Reals, S.Reals)
562. 
563.     assert (1, 2, 3) in ProductSet(S.Reals, S.Reals, S.Reals)
564.     assert (1, 2, 3) in S.Reals ** 3
565.     assert (1, 2, 3) not in S.Reals * S.Reals * S.Reals
566.     assert ((1, 2), 3) in S.Reals * S.Reals * S.Reals
567.     assert (1, (2, 3)) not in S.Reals * S.Reals * S.Reals
568.     assert (1, (2, 3)) in S.Reals * (S.Reals * S.Reals)
569. 
570.     assert ProductSet() == FiniteSet(())
571.     assert ProductSet(S.Reals, S.EmptySet) == S.EmptySet
572. 
573.     # See GH-17458
574. 
575.     for ni in range(5):
576.         Rn = ProductSet(*(S.Reals,) * ni)
577.         assert (1,) * ni in Rn
578.         assert 1 not in Rn
579. 
580.     assert (S.Reals * S.Reals) * S.Reals != S.Reals * (S.Reals * S.Reals)
581. 
582.     S1 = S.Reals
583.     S2 = S.Integers
584.     x1 = pi
585.     x2 = 3
586.     assert x1 in S1
587.     assert x2 in S2
588.     assert (x1, x2) in S1 * S2
589.     S3 = S1 * S2
590.     x3 = (x1, x2)
591.     assert x3 in S3
592.     assert (x3, x3) in S3 * S3
593.     assert x3 + x3 not in S3 * S3
594. 
595.     raises(ValueError, lambda: S.Reals**-1)
596.     with warns_deprecated_sympy():
597.         ProductSet(FiniteSet(s) for s in range(2))
598.     raises(TypeError, lambda: ProductSet(None))
599. 
600.     S1 = FiniteSet(1, 2)
601.     S2 = FiniteSet(3, 4)
602.     S3 = ProductSet(S1, S2)
603.     assert (S3.as_relational(x, y)
604.             == And(S1.as_relational(x), S2.as_relational(y))
605.             == And(Or(Eq(x, 1), Eq(x, 2)), Or(Eq(y, 3), Eq(y, 4))))
606.     raises(ValueError, lambda: S3.as_relational(x))
607.     raises(ValueError, lambda: S3.as_relational(x, 1))
608.     raises(ValueError, lambda: ProductSet(Interval(0, 1)).as_relational(x, y))
609. 
610.     Z2 = ProductSet(S.Integers, S.Integers)
611.     assert Z2.contains((1, 2)) is S.true
612.     assert Z2.contains((1,)) is S.false
613.     assert Z2.contains(x) == Contains(x, Z2, evaluate=False)
614.     assert Z2.contains(x).subs(x, 1) is S.false
615.     assert Z2.contains((x, 1)).subs(x, 2) is S.true
616.     assert Z2.contains((x, y)) == Contains((x, y), Z2, evaluate=False)
617.     assert unchanged(Contains, (x, y), Z2)
618.     assert Contains((1, 2), Z2) is S.true
619. 
620. 
621. def test_ProductSet_of_single_arg_is_not_arg():
622.     assert unchanged(ProductSet, Interval(0, 1))
623.     assert unchanged(ProductSet, ProductSet(Interval(0, 1)))
624. 
625. 
626. def test_ProductSet_is_empty():
627.     assert ProductSet(S.Integers, S.Reals).is_empty == False
628.     assert ProductSet(Interval(x, 1), S.Reals).is_empty == None
629. 
630. 
631. def test_interval_subs():
632.     a = Symbol('a', real=True)
633. 
634.     assert Interval(0, a).subs(a, 2) == Interval(0, 2)
635.     assert Interval(a, 0).subs(a, 2) == S.EmptySet
636. 
637. 
638. def test_interval_to_mpi():
639.     assert Interval(0, 1).to_mpi() == mpi(0, 1)
640.     assert Interval(0, 1, True, False).to_mpi() == mpi(0, 1)
641.     assert type(Interval(0, 1).to_mpi()) == type(mpi(0, 1))
642. 
643. 
644. def test_set_evalf():
645.     assert Interval(S(11)/64, S.Half).evalf() == Interval(
646.         Float('0.171875'), Float('0.5'))
647.     assert Interval(x, S.Half, right_open=True).evalf() == Interval(
648.         x, Float('0.5'), right_open=True)
649.     assert Interval(-oo, S.Half).evalf() == Interval(-oo, Float('0.5'))
650.     assert FiniteSet(2, x).evalf() == FiniteSet(Float('2.0'), x)
651. 
652. 
653. def test_measure():
654.     a = Symbol('a', real=True)
655. 
656.     assert Interval(1, 3).measure == 2
657.     assert Interval(0, a).measure == a
658.     assert Interval(1, a).measure == a - 1
659. 
660.     assert Union(Interval(1, 2), Interval(3, 4)).measure == 2
661.     assert Union(Interval(1, 2), Interval(3, 4), FiniteSet(5, 6, 7)).measure \
662.         == 2
663. 
664.     assert FiniteSet(1, 2, oo, a, -oo, -5).measure == 0
665. 
666.     assert S.EmptySet.measure == 0
667. 
668.     square = Interval(0, 10) * Interval(0, 10)
669.     offsetsquare = Interval(5, 15) * Interval(5, 15)
670.     band = Interval(-oo, oo) * Interval(2, 4)
671. 
672.     assert square.measure == offsetsquare.measure == 100
673.     assert (square + offsetsquare).measure == 175  # there is some overlap
674.     assert (square - offsetsquare).measure == 75
675.     assert (square * FiniteSet(1, 2, 3)).measure == 0
676.     assert (square.intersect(band)).measure == 20
677.     assert (square + band).measure is oo
678.     assert (band * FiniteSet(1, 2, 3)).measure is nan
679. 
680. 
681. def test_is_subset():
682.     assert Interval(0, 1).is_subset(Interval(0, 2)) is True
683.     assert Interval(0, 3).is_subset(Interval(0, 2)) is False
684.     assert Interval(0, 1).is_subset(FiniteSet(0, 1)) is False
685. 
686.     assert FiniteSet(1, 2).is_subset(FiniteSet(1, 2, 3, 4))
687.     assert FiniteSet(4, 5).is_subset(FiniteSet(1, 2, 3, 4)) is False
688.     assert FiniteSet(1).is_subset(Interval(0, 2))
689.     assert FiniteSet(1, 2).is_subset(Interval(0, 2, True, True)) is False
690.     assert (Interval(1, 2) + FiniteSet(3)).is_subset(
691.         Interval(0, 2, False, True) + FiniteSet(2, 3))
692. 
693.     assert Interval(3, 4).is_subset(Union(Interval(0, 1), Interval(2, 5))) is True
694.     assert Interval(3, 6).is_subset(Union(Interval(0, 1), Interval(2, 5))) is False
695. 
696.     assert FiniteSet(1, 2, 3, 4).is_subset(Interval(0, 5)) is True
697.     assert S.EmptySet.is_subset(FiniteSet(1, 2, 3)) is True
698. 
699.     assert Interval(0, 1).is_subset(S.EmptySet) is False
700.     assert S.EmptySet.is_subset(S.EmptySet) is True
701. 
702.     raises(ValueError, lambda: S.EmptySet.is_subset(1))
703. 
704.     # tests for the issubset alias
705.     assert FiniteSet(1, 2, 3, 4).issubset(Interval(0, 5)) is True
706.     assert S.EmptySet.issubset(FiniteSet(1, 2, 3)) is True
707. 
708.     assert S.Naturals.is_subset(S.Integers)
709.     assert S.Naturals0.is_subset(S.Integers)
710. 
711.     assert FiniteSet(x).is_subset(FiniteSet(y)) is None
712.     assert FiniteSet(x).is_subset(FiniteSet(y).subs(y, x)) is True
713.     assert FiniteSet(x).is_subset(FiniteSet(y).subs(y, x+1)) is False
714. 
715.     assert Interval(0, 1).is_subset(Interval(0, 1, left_open=True)) is False
716.     assert Interval(-2, 3).is_subset(Union(Interval(-oo, -2), Interval(3, oo))) is False
717. 
718.     n = Symbol('n', integer=True)
719.     assert Range(-3, 4, 1).is_subset(FiniteSet(-10, 10)) is False
720.     assert Range(S(10)**100).is_subset(FiniteSet(0, 1, 2)) is False
721.     assert Range(6, 0, -2).is_subset(FiniteSet(2, 4, 6)) is True
722.     assert Range(1, oo).is_subset(FiniteSet(1, 2)) is False
723.     assert Range(-oo, 1).is_subset(FiniteSet(1)) is False
724.     assert Range(3).is_subset(FiniteSet(0, 1, n)) is None
725.     assert Range(n, n + 2).is_subset(FiniteSet(n, n + 1)) is True
726.     assert Range(5).is_subset(Interval(0, 4, right_open=True)) is False
727. 
728. 
729. def test_is_proper_subset():
730.     assert Interval(0, 1).is_proper_subset(Interval(0, 2)) is True
731.     assert Interval(0, 3).is_proper_subset(Interval(0, 2)) is False
732.     assert S.EmptySet.is_proper_subset(FiniteSet(1, 2, 3)) is True
733. 
734.     raises(ValueError, lambda: Interval(0, 1).is_proper_subset(0))
735. 
736. 
737. def test_is_superset():
738.     assert Interval(0, 1).is_superset(Interval(0, 2)) == False
739.     assert Interval(0, 3).is_superset(Interval(0, 2))
740. 
741.     assert FiniteSet(1, 2).is_superset(FiniteSet(1, 2, 3, 4)) == False
742.     assert FiniteSet(4, 5).is_superset(FiniteSet(1, 2, 3, 4)) == False
743.     assert FiniteSet(1).is_superset(Interval(0, 2)) == False
744.     assert FiniteSet(1, 2).is_superset(Interval(0, 2, True, True)) == False
745.     assert (Interval(1, 2) + FiniteSet(3)).is_superset(
746.         Interval(0, 2, False, True) + FiniteSet(2, 3)) == False
747. 
748.     assert Interval(3, 4).is_superset(Union(Interval(0, 1), Interval(2, 5))) == False
749. 
750.     assert FiniteSet(1, 2, 3, 4).is_superset(Interval(0, 5)) == False
751.     assert S.EmptySet.is_superset(FiniteSet(1, 2, 3)) == False
752. 
753.     assert Interval(0, 1).is_superset(S.EmptySet) == True
754.     assert S.EmptySet.is_superset(S.EmptySet) == True
755. 
756.     raises(ValueError, lambda: S.EmptySet.is_superset(1))
757. 
758.     # tests for the issuperset alias
759.     assert Interval(0, 1).issuperset(S.EmptySet) == True
760.     assert S.EmptySet.issuperset(S.EmptySet) == True
761. 
762. 
763. def test_is_proper_superset():
764.     assert Interval(0, 1).is_proper_superset(Interval(0, 2)) is False
765.     assert Interval(0, 3).is_proper_superset(Interval(0, 2)) is True
766.     assert FiniteSet(1, 2, 3).is_proper_superset(S.EmptySet) is True
767. 
768.     raises(ValueError, lambda: Interval(0, 1).is_proper_superset(0))
769. 
770. 
771. def test_contains():
772.     assert Interval(0, 2).contains(1) is S.true
773.     assert Interval(0, 2).contains(3) is S.false
774.     assert Interval(0, 2, True, False).contains(0) is S.false
775.     assert Interval(0, 2, True, False).contains(2) is S.true
776.     assert Interval(0, 2, False, True).contains(0) is S.true
777.     assert Interval(0, 2, False, True).contains(2) is S.false
778.     assert Interval(0, 2, True, True).contains(0) is S.false
779.     assert Interval(0, 2, True, True).contains(2) is S.false
780. 
781.     assert (Interval(0, 2) in Interval(0, 2)) is False
782. 
783.     assert FiniteSet(1, 2, 3).contains(2) is S.true
784.     assert FiniteSet(1, 2, Symbol('x')).contains(Symbol('x')) is S.true
785. 
786.     assert FiniteSet(y)._contains(x) is None
787.     raises(TypeError, lambda: x in FiniteSet(y))
788.     assert FiniteSet({x, y})._contains({x}) is None
789.     assert FiniteSet({x, y}).subs(y, x)._contains({x}) is True
790.     assert FiniteSet({x, y}).subs(y, x+1)._contains({x}) is False
791. 
792.     # issue 8197
793.     from sympy.abc import a, b
794.     assert isinstance(FiniteSet(b).contains(-a), Contains)
795.     assert isinstance(FiniteSet(b).contains(a), Contains)
796.     assert isinstance(FiniteSet(a).contains(1), Contains)
797.     raises(TypeError, lambda: 1 in FiniteSet(a))
798. 
799.     # issue 8209
800.     rad1 = Pow(Pow(2, Rational(1, 3)) - 1, Rational(1, 3))
801.     rad2 = Pow(Rational(1, 9), Rational(1, 3)) - Pow(Rational(2, 9), Rational(1, 3)) + Pow(Rational(4, 9), Rational(1, 3))
802.     s1 = FiniteSet(rad1)
803.     s2 = FiniteSet(rad2)
804.     assert s1 - s2 == S.EmptySet
805. 
806.     items = [1, 2, S.Infinity, S('ham'), -1.1]
807.     fset = FiniteSet(*items)
808.     assert all(item in fset for item in items)
809.     assert all(fset.contains(item) is S.true for item in items)
810. 
811.     assert Union(Interval(0, 1), Interval(2, 5)).contains(3) is S.true
812.     assert Union(Interval(0, 1), Interval(2, 5)).contains(6) is S.false
813.     assert Union(Interval(0, 1), FiniteSet(2, 5)).contains(3) is S.false
814. 
815.     assert S.EmptySet.contains(1) is S.false
816.     assert FiniteSet(rootof(x**3 + x - 1, 0)).contains(S.Infinity) is S.false
817. 
818.     assert rootof(x**5 + x**3 + 1, 0) in S.Reals
819.     assert not rootof(x**5 + x**3 + 1, 1) in S.Reals
820. 
821.     # non-bool results
822.     assert Union(Interval(1, 2), Interval(3, 4)).contains(x) == \
823.         Or(And(S.One <= x, x <= 2), And(S(3) <= x, x <= 4))
824.     assert Intersection(Interval(1, x), Interval(2, 3)).contains(y) == \
825.         And(y <= 3, y <= x, S.One <= y, S(2) <= y)
826. 
827.     assert (S.Complexes).contains(S.ComplexInfinity) == S.false
828. 
829. 
830. def test_interval_symbolic():
831.     x = Symbol('x')
832.     e = Interval(0, 1)
833.     assert e.contains(x) == And(S.Zero <= x, x <= 1)
834.     raises(TypeError, lambda: x in e)
835.     e = Interval(0, 1, True, True)
836.     assert e.contains(x) == And(S.Zero < x, x < 1)
837.     c = Symbol('c', real=False)
838.     assert Interval(x, x + 1).contains(c) == False
839.     e = Symbol('e', extended_real=True)
840.     assert Interval(-oo, oo).contains(e) == And(
841.         S.NegativeInfinity < e, e < S.Infinity)
842. 
843. 
844. def test_union_contains():
845.     x = Symbol('x')
846.     i1 = Interval(0, 1)
847.     i2 = Interval(2, 3)
848.     i3 = Union(i1, i2)
849.     assert i3.as_relational(x) == Or(And(S.Zero <= x, x <= 1), And(S(2) <= x, x <= 3))
850.     raises(TypeError, lambda: x in i3)
851.     e = i3.contains(x)
852.     assert e == i3.as_relational(x)
853.     assert e.subs(x, -0.5) is false
854.     assert e.subs(x, 0.5) is true
855.     assert e.subs(x, 1.5) is false
856.     assert e.subs(x, 2.5) is true
857.     assert e.subs(x, 3.5) is false
858. 
859.     U = Interval(0, 2, True, True) + Interval(10, oo) + FiniteSet(-1, 2, 5, 6)
860.     assert all(el not in U for el in [0, 4, -oo])
861.     assert all(el in U for el in [2, 5, 10])
862. 
863. 
864. def test_is_number():
865.     assert Interval(0, 1).is_number is False
866.     assert Set().is_number is False
867. 
868. 
869. def test_Interval_is_left_unbounded():
870.     assert Interval(3, 4).is_left_unbounded is False
871.     assert Interval(-oo, 3).is_left_unbounded is True
872.     assert Interval(Float("-inf"), 3).is_left_unbounded is True
873. 
874. 
875. def test_Interval_is_right_unbounded():
876.     assert Interval(3, 4).is_right_unbounded is False
877.     assert Interval(3, oo).is_right_unbounded is True
878.     assert Interval(3, Float("+inf")).is_right_unbounded is True
879. 
880. 
881. def test_Interval_as_relational():
882.     x = Symbol('x')
883. 
884.     assert Interval(-1, 2, False, False).as_relational(x) == \
885.         And(Le(-1, x), Le(x, 2))
886.     assert Interval(-1, 2, True, False).as_relational(x) == \
887.         And(Lt(-1, x), Le(x, 2))
888.     assert Interval(-1, 2, False, True).as_relational(x) == \
889.         And(Le(-1, x), Lt(x, 2))
890.     assert Interval(-1, 2, True, True).as_relational(x) == \
891.         And(Lt(-1, x), Lt(x, 2))
892. 
893.     assert Interval(-oo, 2, right_open=False).as_relational(x) == And(Lt(-oo, x), Le(x, 2))
894.     assert Interval(-oo, 2, right_open=True).as_relational(x) == And(Lt(-oo, x), Lt(x, 2))
895. 
896.     assert Interval(-2, oo, left_open=False).as_relational(x) == And(Le(-2, x), Lt(x, oo))
897.     assert Interval(-2, oo, left_open=True).as_relational(x) == And(Lt(-2, x), Lt(x, oo))
898. 
899.     assert Interval(-oo, oo).as_relational(x) == And(Lt(-oo, x), Lt(x, oo))
900.     x = Symbol('x', real=True)
901.     y = Symbol('y', real=True)
902.     assert Interval(x, y).as_relational(x) == (x <= y)
903.     assert Interval(y, x).as_relational(x) == (y <= x)
904. 
905. 
906. def test_Finite_as_relational():
907.     x = Symbol('x')
908.     y = Symbol('y')
909. 
910.     assert FiniteSet(1, 2).as_relational(x) == Or(Eq(x, 1), Eq(x, 2))
911.     assert FiniteSet(y, -5).as_relational(x) == Or(Eq(x, y), Eq(x, -5))
912. 
913. 
914. def test_Union_as_relational():
915.     x = Symbol('x')
916.     assert (Interval(0, 1) + FiniteSet(2)).as_relational(x) == \
917.         Or(And(Le(0, x), Le(x, 1)), Eq(x, 2))
918.     assert (Interval(0, 1, True, True) + FiniteSet(1)).as_relational(x) == \
919.         And(Lt(0, x), Le(x, 1))
920. 
921. 
922. def test_Intersection_as_relational():
923.     x = Symbol('x')
924.     assert (Intersection(Interval(0, 1), FiniteSet(2),
925.             evaluate=False).as_relational(x)
926.             == And(And(Le(0, x), Le(x, 1)), Eq(x, 2)))
927. 
928. 
929. def test_Complement_as_relational():
930.     x = Symbol('x')
931.     expr = Complement(Interval(0, 1), FiniteSet(2), evaluate=False)
932.     assert expr.as_relational(x) == \
933.         And(Le(0, x), Le(x, 1), Ne(x, 2))
934. 
935. 
936. @XFAIL
937. def test_Complement_as_relational_fail():
938.     x = Symbol('x')
939.     expr = Complement(Interval(0, 1), FiniteSet(2), evaluate=False)
940.     # XXX This example fails because 0 <= x changes to x >= 0
941.     # during the evaluation.
942.     assert expr.as_relational(x) == \
943.             (0 <= x) & (x <= 1) & Ne(x, 2)
944. 
945. 
946. def test_SymmetricDifference_as_relational():
947.     x = Symbol('x')
948.     expr = SymmetricDifference(Interval(0, 1), FiniteSet(2), evaluate=False)
949.     assert expr.as_relational(x) == Xor(Eq(x, 2), Le(0, x) & Le(x, 1))
950. 
951. 
952. def test_EmptySet():
953.     assert S.EmptySet.as_relational(Symbol('x')) is S.false
954.     assert S.EmptySet.intersect(S.UniversalSet) == S.EmptySet
955.     assert S.EmptySet.boundary == S.EmptySet
956. 
957. 
958. def test_finite_basic():
959.     x = Symbol('x')
960.     A = FiniteSet(1, 2, 3)
961.     B = FiniteSet(3, 4, 5)
962.     AorB = Union(A, B)
963.     AandB = A.intersect(B)
964.     assert A.is_subset(AorB) and B.is_subset(AorB)
965.     assert AandB.is_subset(A)
966.     assert AandB == FiniteSet(3)
967. 
968.     assert A.inf == 1 and A.sup == 3
969.     assert AorB.inf == 1 and AorB.sup == 5
970.     assert FiniteSet(x, 1, 5).sup == Max(x, 5)
971.     assert FiniteSet(x, 1, 5).inf == Min(x, 1)
972. 
973.     # issue 7335
974.     assert FiniteSet(S.EmptySet) != S.EmptySet
975.     assert FiniteSet(FiniteSet(1, 2, 3)) != FiniteSet(1, 2, 3)
976.     assert FiniteSet((1, 2, 3)) != FiniteSet(1, 2, 3)
977. 
978.     # Ensure a variety of types can exist in a FiniteSet
979.     assert FiniteSet((1, 2), Float, A, -5, x, 'eggs', x**2, Interval)
980. 
981.     assert (A > B) is False
982.     assert (A >= B) is False
983.     assert (A < B) is False
984.     assert (A <= B) is False
985.     assert AorB > A and AorB > B
986.     assert AorB >= A and AorB >= B
987.     assert A >= A and A <= A
988.     assert A >= AandB and B >= AandB
989.     assert A > AandB and B > AandB
990. 
991.     assert FiniteSet(1.0) == FiniteSet(1)
992. 
993. 
994. def test_product_basic():
995.     H, T = 'H', 'T'
996.     unit_line = Interval(0, 1)
997.     d6 = FiniteSet(1, 2, 3, 4, 5, 6)
998.     d4 = FiniteSet(1, 2, 3, 4)
999.     coin = FiniteSet(H, T)
1000. 
1001.     square = unit_line * unit_line
1002. 
1003.     assert (0, 0) in square
1004.     assert 0 not in square
1005.     assert (H, T) in coin ** 2
1006.     assert (.5, .5, .5) in (square * unit_line).flatten()
1007.     assert ((.5, .5), .5) in square * unit_line
1008.     assert (H, 3, 3) in (coin * d6 * d6).flatten()
1009.     assert ((H, 3), 3) in coin * d6 * d6
1010.     HH, TT = sympify(H), sympify(T)
1011.     assert set(coin**2) == {(HH, HH), (HH, TT), (TT, HH), (TT, TT)}
1012. 
1013.     assert (d4*d4).is_subset(d6*d6)
1014. 
1015.     assert square.complement(Interval(-oo, oo)*Interval(-oo, oo)) == Union(
1016.         (Interval(-oo, 0, True, True) +
1017.          Interval(1, oo, True, True))*Interval(-oo, oo),
1018.          Interval(-oo, oo)*(Interval(-oo, 0, True, True) +
1019.                   Interval(1, oo, True, True)))
1020. 
1021.     assert (Interval(-5, 5)**3).is_subset(Interval(-10, 10)**3)
1022.     assert not (Interval(-10, 10)**3).is_subset(Interval(-5, 5)**3)
1023.     assert not (Interval(-5, 5)**2).is_subset(Interval(-10, 10)**3)
1024. 
1025.     assert (Interval(.2, .5)*FiniteSet(.5)).is_subset(square)  # segment in square
1026. 
1027.     assert len(coin*coin*coin) == 8
1028.     assert len(S.EmptySet*S.EmptySet) == 0
1029.     assert len(S.EmptySet*coin) == 0
1030.     raises(TypeError, lambda: len(coin*Interval(0, 2)))
1031. 
1032. 
1033. def test_real():
1034.     x = Symbol('x', real=True, finite=True)
1035. 
1036.     I = Interval(0, 5)
1037.     J = Interval(10, 20)
1038.     A = FiniteSet(1, 2, 30, x, S.Pi)
1039.     B = FiniteSet(-4, 0)
1040.     C = FiniteSet(100)
1041.     D = FiniteSet('Ham', 'Eggs')
1042. 
1043.     assert all(s.is_subset(S.Reals) for s in [I, J, A, B, C])
1044.     assert not D.is_subset(S.Reals)
1045.     assert all((a + b).is_subset(S.Reals) for a in [I, J, A, B, C] for b in [I, J, A, B, C])
1046.     assert not any((a + D).is_subset(S.Reals) for a in [I, J, A, B, C, D])
1047. 
1048.     assert not (I + A + D).is_subset(S.Reals)
1049. 
1050. 
1051. def test_supinf():
1052.     x = Symbol('x', real=True)
1053.     y = Symbol('y', real=True)
1054. 
1055.     assert (Interval(0, 1) + FiniteSet(2)).sup == 2
1056.     assert (Interval(0, 1) + FiniteSet(2)).inf == 0
1057.     assert (Interval(0, 1) + FiniteSet(x)).sup == Max(1, x)
1058.     assert (Interval(0, 1) + FiniteSet(x)).inf == Min(0, x)
1059.     assert FiniteSet(5, 1, x).sup == Max(5, x)
1060.     assert FiniteSet(5, 1, x).inf == Min(1, x)
1061.     assert FiniteSet(5, 1, x, y).sup == Max(5, x, y)
1062.     assert FiniteSet(5, 1, x, y).inf == Min(1, x, y)
1063.     assert FiniteSet(5, 1, x, y, S.Infinity, S.NegativeInfinity).sup == \
1064.         S.Infinity
1065.     assert FiniteSet(5, 1, x, y, S.Infinity, S.NegativeInfinity).inf == \
1066.         S.NegativeInfinity
1067.     assert FiniteSet('Ham', 'Eggs').sup == Max('Ham', 'Eggs')
1068. 
1069. 
1070. def test_universalset():
1071.     U = S.UniversalSet
1072.     x = Symbol('x')
1073.     assert U.as_relational(x) is S.true
1074.     assert U.union(Interval(2, 4)) == U
1075. 
1076.     assert U.intersect(Interval(2, 4)) == Interval(2, 4)
1077.     assert U.measure is S.Infinity
1078.     assert U.boundary == S.EmptySet
1079.     assert U.contains(0) is S.true
1080. 
1081. 
1082. def test_Union_of_ProductSets_shares():
1083.     line = Interval(0, 2)
1084.     points = FiniteSet(0, 1, 2)
1085.     assert Union(line * line, line * points) == line * line
1086. 
1087. 
1088. def test_Interval_free_symbols():
1089.     # issue 6211
1090.     assert Interval(0, 1).free_symbols == set()
1091.     x = Symbol('x', real=True)
1092.     assert Interval(0, x).free_symbols == {x}
1093. 
1094. 
1095. def test_image_interval():
1096.     from sympy.core.numbers import Rational
1097.     x = Symbol('x', real=True)
1098.     a = Symbol('a', real=True)
1099.     assert imageset(x, 2*x, Interval(-2, 1)) == Interval(-4, 2)
1100.     assert imageset(x, 2*x, Interval(-2, 1, True, False)) == \
1101.         Interval(-4, 2, True, False)
1102.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1103.         Interval(0, 4, False, True)
1104.     assert imageset(x, x**2, Interval(-2, 1)) == Interval(0, 4)
1105.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1106.         Interval(0, 4, False, True)
1107.     assert imageset(x, x**2, Interval(-2, 1, True, True)) == \
1108.         Interval(0, 4, False, True)
1109.     assert imageset(x, (x - 2)**2, Interval(1, 3)) == Interval(0, 1)
1110.     assert imageset(x, 3*x**4 - 26*x**3 + 78*x**2 - 90*x, Interval(0, 4)) == \
1111.         Interval(-35, 0)  # Multiple Maxima
1112.     assert imageset(x, x + 1/x, Interval(-oo, oo)) == Interval(-oo, -2) \
1113.         + Interval(2, oo)  # Single Infinite discontinuity
1114.     assert imageset(x, 1/x + 1/(x-1)**2, Interval(0, 2, True, False)) == \
1115.         Interval(Rational(3, 2), oo, False)  # Multiple Infinite discontinuities
1116. 
1117.     # Test for Python lambda
1118.     assert imageset(lambda x: 2*x, Interval(-2, 1)) == Interval(-4, 2)
1119. 
1120.     assert imageset(Lambda(x, a*x), Interval(0, 1)) == \
1121.             ImageSet(Lambda(x, a*x), Interval(0, 1))
1122. 
1123.     assert imageset(Lambda(x, sin(cos(x))), Interval(0, 1)) == \
1124.             ImageSet(Lambda(x, sin(cos(x))), Interval(0, 1))
1125. 
1126. 
1127. def test_image_piecewise():
1128.     f = Piecewise((x, x <= -1), (1/x**2, x <= 5), (x**3, True))
1129.     f1 = Piecewise((0, x <= 1), (1, x <= 2), (2, True))
1130.     assert imageset(x, f, Interval(-5, 5)) == Union(Interval(-5, -1), Interval(Rational(1, 25), oo))
1131.     assert imageset(x, f1, Interval(1, 2)) == FiniteSet(0, 1)
1132. 
1133. 
1134. @XFAIL  # See: https://github.com/sympy/sympy/pull/2723#discussion_r8659826
1135. def test_image_Intersection():
1136.     x = Symbol('x', real=True)
1137.     y = Symbol('y', real=True)
1138.     assert imageset(x, x**2, Interval(-2, 0).intersect(Interval(x, y))) == \
1139.            Interval(0, 4).intersect(Interval(Min(x**2, y**2), Max(x**2, y**2)))
1140. 
1141. 
1142. def test_image_FiniteSet():
1143.     x = Symbol('x', real=True)
1144.     assert imageset(x, 2*x, FiniteSet(1, 2, 3)) == FiniteSet(2, 4, 6)
1145. 
1146. 
1147. def test_image_Union():
1148.     x = Symbol('x', real=True)
1149.     assert imageset(x, x**2, Interval(-2, 0) + FiniteSet(1, 2, 3)) == \
1150.             (Interval(0, 4) + FiniteSet(9))
1151. 
1152. 
1153. def test_image_EmptySet():
1154.     x = Symbol('x', real=True)
1155.     assert imageset(x, 2*x, S.EmptySet) == S.EmptySet
1156. 
1157. 
1158. def test_issue_5724_7680():
1159.     assert I not in S.Reals  # issue 7680
1160.     assert Interval(-oo, oo).contains(I) is S.false
1161. 
1162. 
1163. def test_boundary():
1164.     assert FiniteSet(1).boundary == FiniteSet(1)
1165.     assert all(Interval(0, 1, left_open, right_open).boundary == FiniteSet(0, 1)
1166.             for left_open in (true, false) for right_open in (true, false))
1167. 
1168. 
1169. def test_boundary_Union():
1170.     assert (Interval(0, 1) + Interval(2, 3)).boundary == FiniteSet(0, 1, 2, 3)
1171.     assert ((Interval(0, 1, False, True)
1172.            + Interval(1, 2, True, False)).boundary == FiniteSet(0, 1, 2))
1173. 
1174.     assert (Interval(0, 1) + FiniteSet(2)).boundary == FiniteSet(0, 1, 2)
1175.     assert Union(Interval(0, 10), Interval(5, 15), evaluate=False).boundary \
1176.             == FiniteSet(0, 15)
1177. 
1178.     assert Union(Interval(0, 10), Interval(0, 1), evaluate=False).boundary \
1179.             == FiniteSet(0, 10)
1180.     assert Union(Interval(0, 10, True, True),
1181.                  Interval(10, 15, True, True), evaluate=False).boundary \
1182.             == FiniteSet(0, 10, 15)
1183. 
1184. 
1185. @XFAIL
1186. def test_union_boundary_of_joining_sets():
1187.     """ Testing the boundary of unions is a hard problem """
1188.     assert Union(Interval(0, 10), Interval(10, 15), evaluate=False).boundary \
1189.             == FiniteSet(0, 15)
1190. 
1191. 
1192. def test_boundary_ProductSet():
1193.     open_square = Interval(0, 1, True, True) ** 2
1194.     assert open_square.boundary == (FiniteSet(0, 1) * Interval(0, 1)
1195.                                   + Interval(0, 1) * FiniteSet(0, 1))
1196. 
1197.     second_square = Interval(1, 2, True, True) * Interval(0, 1, True, True)
1198.     assert (open_square + second_square).boundary == (
1199.                 FiniteSet(0, 1) * Interval(0, 1)
1200.               + FiniteSet(1, 2) * Interval(0, 1)
1201.               + Interval(0, 1) * FiniteSet(0, 1)
1202.               + Interval(1, 2) * FiniteSet(0, 1))
1203. 
1204. 
1205. def test_boundary_ProductSet_line():
1206.     line_in_r2 = Interval(0, 1) * FiniteSet(0)
1207.     assert line_in_r2.boundary == line_in_r2
1208. 
1209. 
1210. def test_is_open():
1211.     assert Interval(0, 1, False, False).is_open is False
1212.     assert Interval(0, 1, True, False).is_open is False
1213.     assert Interval(0, 1, True, True).is_open is True
1214.     assert FiniteSet(1, 2, 3).is_open is False
1215. 
1216. 
1217. def test_is_closed():
1218.     assert Interval(0, 1, False, False).is_closed is True
1219.     assert Interval(0, 1, True, False).is_closed is False
1220.     assert FiniteSet(1, 2, 3).is_closed is True
1221. 
1222. 
1223. def test_closure():
1224.     assert Interval(0, 1, False, True).closure == Interval(0, 1, False, False)
1225. 
1226. 
1227. def test_interior():
1228.     assert Interval(0, 1, False, True).interior == Interval(0, 1, True, True)
1229. 
1230. 
1231. def test_issue_7841():
1232.     raises(TypeError, lambda: x in S.Reals)
1233. 
1234. 
1235. def test_Eq():
1236.     assert Eq(Interval(0, 1), Interval(0, 1))
1237.     assert Eq(Interval(0, 1), Interval(0, 2)) == False
1238. 
1239.     s1 = FiniteSet(0, 1)
1240.     s2 = FiniteSet(1, 2)
1241. 
1242.     assert Eq(s1, s1)
1243.     assert Eq(s1, s2) == False
1244. 
1245.     assert Eq(s1*s2, s1*s2)
1246.     assert Eq(s1*s2, s2*s1) == False
1247. 
1248.     assert unchanged(Eq, FiniteSet({x, y}), FiniteSet({x}))
1249.     assert Eq(FiniteSet({x, y}).subs(y, x), FiniteSet({x})) is S.true
1250.     assert Eq(FiniteSet({x, y}), FiniteSet({x})).subs(y, x) is S.true
1251.     assert Eq(FiniteSet({x, y}).subs(y, x+1), FiniteSet({x})) is S.false
1252.     assert Eq(FiniteSet({x, y}), FiniteSet({x})).subs(y, x+1) is S.false
1253. 
1254.     assert Eq(ProductSet({1}, {2}), Interval(1, 2)) not in (S.true, S.false)
1255.     assert Eq(ProductSet({1}), ProductSet({1}, {2})) is S.false
1256. 
1257.     assert Eq(FiniteSet(()), FiniteSet(1)) is S.false
1258.     assert Eq(ProductSet(), FiniteSet(1)) is S.false
1259. 
1260.     i1 = Interval(0, 1)
1261.     i2 = Interval(x, y)
1262.     assert unchanged(Eq, ProductSet(i1, i1), ProductSet(i2, i2))
1263. 
1264. 
1265. def test_SymmetricDifference():
1266.     A = FiniteSet(0, 1, 2, 3, 4, 5)
1267.     B = FiniteSet(2, 4, 6, 8, 10)
1268.     C = Interval(8, 10)
1269. 
1270.     assert SymmetricDifference(A, B, evaluate=False).is_iterable is True
1271.     assert SymmetricDifference(A, C, evaluate=False).is_iterable is None
1272.     assert FiniteSet(*SymmetricDifference(A, B, evaluate=False)) == \
1273.         FiniteSet(0, 1, 3, 5, 6, 8, 10)
1274.     raises(TypeError,
1275.         lambda: FiniteSet(*SymmetricDifference(A, C, evaluate=False)))
1276. 
1277.     assert SymmetricDifference(FiniteSet(0, 1, 2, 3, 4, 5), \
1278.             FiniteSet(2, 4, 6, 8, 10)) == FiniteSet(0, 1, 3, 5, 6, 8, 10)
1279.     assert SymmetricDifference(FiniteSet(2, 3, 4), FiniteSet(2, 3 , 4 , 5)) \
1280.             == FiniteSet(5)
1281.     assert FiniteSet(1, 2, 3, 4, 5) ^ FiniteSet(1, 2, 5, 6) == \
1282.             FiniteSet(3, 4, 6)
1283.     assert Set(1, 2 , 3) ^ Set(2, 3, 4) == Union(Set(1, 2, 3) - Set(2, 3, 4), \
1284.             Set(2, 3, 4) - Set(1, 2, 3))
1285.     assert Interval(0, 4) ^ Interval(2, 5) == Union(Interval(0, 4) - \
1286.             Interval(2, 5), Interval(2, 5) - Interval(0, 4))
1287. 
1288. 
1289. def test_issue_9536():
1290.     from sympy.functions.elementary.exponential import log
1291.     a = Symbol('a', real=True)
1292.     assert FiniteSet(log(a)).intersect(S.Reals) == Intersection(S.Reals, FiniteSet(log(a)))
1293. 
1294. 
1295. def test_issue_9637():
1296.     n = Symbol('n')
1297.     a = FiniteSet(n)
1298.     b = FiniteSet(2, n)
1299.     assert Complement(S.Reals, a) == Complement(S.Reals, a, evaluate=False)
1300.     assert Complement(Interval(1, 3), a) == Complement(Interval(1, 3), a, evaluate=False)
1301.     assert Complement(Interval(1, 3), b) == \
1302.         Complement(Union(Interval(1, 2, False, True), Interval(2, 3, True, False)), a)
1303.     assert Complement(a, S.Reals) == Complement(a, S.Reals, evaluate=False)
1304.     assert Complement(a, Interval(1, 3)) == Complement(a, Interval(1, 3), evaluate=False)
1305. 
1306. 
1307. def test_issue_9808():
1308.     # See https://github.com/sympy/sympy/issues/16342
1309.     assert Complement(FiniteSet(y), FiniteSet(1)) == Complement(FiniteSet(y), FiniteSet(1), evaluate=False)
1310.     assert Complement(FiniteSet(1, 2, x), FiniteSet(x, y, 2, 3)) == \
1311.         Complement(FiniteSet(1), FiniteSet(y), evaluate=False)
1312. 
1313. 
1314. def test_issue_9956():
1315.     assert Union(Interval(-oo, oo), FiniteSet(1)) == Interval(-oo, oo)
1316.     assert Interval(-oo, oo).contains(1) is S.true
1317. 
1318. 
1319. def test_issue_Symbol_inter():
1320.     i = Interval(0, oo)
1321.     r = S.Reals
1322.     mat = Matrix([0, 0, 0])
1323.     assert Intersection(r, i, FiniteSet(m), FiniteSet(m, n)) == \
1324.         Intersection(i, FiniteSet(m))
1325.     assert Intersection(FiniteSet(1, m, n), FiniteSet(m, n, 2), i) == \
1326.         Intersection(i, FiniteSet(m, n))
1327.     assert Intersection(FiniteSet(m, n, x), FiniteSet(m, z), r) == \
1328.         Intersection(Intersection({m, z}, {m, n, x}), r)
1329.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, x), r) == \
1330.         Intersection(FiniteSet(3, m, n), FiniteSet(m, n, x), r, evaluate=False)
1331.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, 2, 3), r) == \
1332.         Intersection(FiniteSet(3, m, n), r)
1333.     assert Intersection(r, FiniteSet(mat, 2, n), FiniteSet(0, mat, n)) == \
1334.         Intersection(r, FiniteSet(n))
1335.     assert Intersection(FiniteSet(sin(x), cos(x)), FiniteSet(sin(x), cos(x), 1), r) == \
1336.         Intersection(r, FiniteSet(sin(x), cos(x)))
1337.     assert Intersection(FiniteSet(x**2, 1, sin(x)), FiniteSet(x**2, 2, sin(x)), r) == \
1338.         Intersection(r, FiniteSet(x**2, sin(x)))
1339. 
1340. 
1341. def test_issue_11827():
1342.     assert S.Naturals0**4
1343. 
1344. 
1345. def test_issue_10113():
1346.     f = x**2/(x**2 - 4)
1347.     assert imageset(x, f, S.Reals) == Union(Interval(-oo, 0), Interval(1, oo, True, True))
1348.     assert imageset(x, f, Interval(-2, 2)) == Interval(-oo, 0)
1349.     assert imageset(x, f, Interval(-2, 3)) == Union(Interval(-oo, 0), Interval(Rational(9, 5), oo))
1350. 
1351. 
1352. def test_issue_10248():
1353.     raises(
1354.         TypeError, lambda: list(Intersection(S.Reals, FiniteSet(x)))
1355.     )
1356.     A = Symbol('A', real=True)
1357.     assert list(Intersection(S.Reals, FiniteSet(A))) == [A]
1358. 
1359. 
1360. def test_issue_9447():
1361.     a = Interval(0, 1) + Interval(2, 3)
1362.     assert Complement(S.UniversalSet, a) == Complement(
1363.             S.UniversalSet, Union(Interval(0, 1), Interval(2, 3)), evaluate=False)
1364.     assert Complement(S.Naturals, a) == Complement(
1365.             S.Naturals, Union(Interval(0, 1), Interval(2, 3)), evaluate=False)
1366. 
1367. 
1368. def test_issue_10337():
1369.     assert (FiniteSet(2) == 3) is False
1370.     assert (FiniteSet(2) != 3) is True
1371.     raises(TypeError, lambda: FiniteSet(2) < 3)
1372.     raises(TypeError, lambda: FiniteSet(2) <= 3)
1373.     raises(TypeError, lambda: FiniteSet(2) > 3)
1374.     raises(TypeError, lambda: FiniteSet(2) >= 3)
1375. 
1376. 
1377. def test_issue_10326():
1378.     bad = [
1379.         EmptySet,
1380.         FiniteSet(1),
1381.         Interval(1, 2),
1382.         S.ComplexInfinity,
1383.         S.ImaginaryUnit,
1384.         S.Infinity,
1385.         S.NaN,
1386.         S.NegativeInfinity,
1387.         ]
1388.     interval = Interval(0, 5)
1389.     for i in bad:
1390.         assert i not in interval
1391. 
1392.     x = Symbol('x', real=True)
1393.     nr = Symbol('nr', extended_real=False)
1394.     assert x + 1 in Interval(x, x + 4)
1395.     assert nr not in Interval(x, x + 4)
1396.     assert Interval(1, 2) in FiniteSet(Interval(0, 5), Interval(1, 2))
1397.     assert Interval(-oo, oo).contains(oo) is S.false
1398.     assert Interval(-oo, oo).contains(-oo) is S.false
1399. 
1400. 
1401. def test_issue_2799():
1402.     U = S.UniversalSet
1403.     a = Symbol('a', real=True)
1404.     inf_interval = Interval(a, oo)
1405.     R = S.Reals
1406. 
1407.     assert U + inf_interval == inf_interval + U
1408.     assert U + R == R + U
1409.     assert R + inf_interval == inf_interval + R
1410. 
1411. 
1412. def test_issue_9706():
1413.     assert Interval(-oo, 0).closure == Interval(-oo, 0, True, False)
1414.     assert Interval(0, oo).closure == Interval(0, oo, False, True)
1415.     assert Interval(-oo, oo).closure == Interval(-oo, oo)
1416. 
1417. 
1418. def test_issue_8257():
1419.     reals_plus_infinity = Union(Interval(-oo, oo), FiniteSet(oo))
1420.     reals_plus_negativeinfinity = Union(Interval(-oo, oo), FiniteSet(-oo))
1421.     assert Interval(-oo, oo) + FiniteSet(oo) == reals_plus_infinity
1422.     assert FiniteSet(oo) + Interval(-oo, oo) == reals_plus_infinity
1423.     assert Interval(-oo, oo) + FiniteSet(-oo) == reals_plus_negativeinfinity
1424.     assert FiniteSet(-oo) + Interval(-oo, oo) == reals_plus_negativeinfinity
1425. 
1426. 
1427. def test_issue_10931():
1428.     assert S.Integers - S.Integers == EmptySet
1429.     assert S.Integers - S.Reals == EmptySet
1430. 
1431. 
1432. def test_issue_11174():
1433.     soln = Intersection(Interval(-oo, oo), FiniteSet(-x), evaluate=False)
1434.     assert Intersection(FiniteSet(-x), S.Reals) == soln
1435. 
1436.     soln = Intersection(S.Reals, FiniteSet(x), evaluate=False)
1437.     assert Intersection(FiniteSet(x), S.Reals) == soln
1438. 
1439. 
1440. def test_issue_18505():
1441.     assert ImageSet(Lambda(n, sqrt(pi*n/2 - 1 + pi/2)), S.Integers).contains(0) == \
1442.             Contains(0, ImageSet(Lambda(n, sqrt(pi*n/2 - 1 + pi/2)), S.Integers))
1443. 
1444. 
1445. def test_finite_set_intersection():
1446.     # The following should not produce recursion errors
1447.     # Note: some of these are not completely correct. See
1448.     # https://github.com/sympy/sympy/issues/16342.
1449.     assert Intersection(FiniteSet(-oo, x), FiniteSet(x)) == FiniteSet(x)
1450.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(0, x)]) == FiniteSet(x)
1451. 
1452.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(x)]) == FiniteSet(x)
1453.     assert Intersection._handle_finite_sets([FiniteSet(2, 3, x, y), FiniteSet(1, 2, x)]) == \
1454.         Intersection._handle_finite_sets([FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)]) == \
1455.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)) == \
1456.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, x, y))
1457. 
1458.     assert FiniteSet(1+x-y) & FiniteSet(1) == \
1459.         FiniteSet(1) & FiniteSet(1+x-y) == \
1460.         Intersection(FiniteSet(1+x-y), FiniteSet(1), evaluate=False)
1461. 
1462.     assert FiniteSet(1) & FiniteSet(x) == FiniteSet(x) & FiniteSet(1) == \
1463.         Intersection(FiniteSet(1), FiniteSet(x), evaluate=False)
1464. 
1465.     assert FiniteSet({x}) & FiniteSet({x, y}) == \
1466.         Intersection(FiniteSet({x}), FiniteSet({x, y}), evaluate=False)
1467. 
1468. 
1469. def test_union_intersection_constructor():
1470.     # The actual exception does not matter here, so long as these fail
1471.     sets = [FiniteSet(1), FiniteSet(2)]
1472.     raises(Exception, lambda: Union(sets))
1473.     raises(Exception, lambda: Intersection(sets))
1474.     raises(Exception, lambda: Union(tuple(sets)))
1475.     raises(Exception, lambda: Intersection(tuple(sets)))
1476.     raises(Exception, lambda: Union(i for i in sets))
1477.     raises(Exception, lambda: Intersection(i for i in sets))
1478. 
1479.     # Python sets are treated the same as FiniteSet
1480.     # The union of a single set (of sets) is the set (of sets) itself
1481.     assert Union(set(sets)) == FiniteSet(*sets)
1482.     assert Intersection(set(sets)) == FiniteSet(*sets)
1483. 
1484.     assert Union({1}, {2}) == FiniteSet(1, 2)
1485.     assert Intersection({1, 2}, {2, 3}) == FiniteSet(2)
1486. 
1487. 
1488. def test_Union_contains():
1489.     assert zoo not in Union(
1490.         Interval.open(-oo, 0), Interval.open(0, oo))
1491. 
1492. 
1493. @XFAIL
1494. def test_issue_16878b():
1495.     # in intersection_sets for (ImageSet, Set) there is no code
1496.     # that handles the base_set of S.Reals like there is
1497.     # for Integers
1498.     assert imageset(x, (x, x), S.Reals).is_subset(S.Reals**2) is True
1499. 
1500. def test_DisjointUnion():
1501.     assert DisjointUnion(FiniteSet(1, 2, 3), FiniteSet(1, 2, 3), FiniteSet(1, 2, 3)).rewrite(Union) == (FiniteSet(1, 2, 3) * FiniteSet(0, 1, 2))
1502.     assert DisjointUnion(Interval(1, 3), Interval(2, 4)).rewrite(Union) == Union(Interval(1, 3) * FiniteSet(0), Interval(2, 4) * FiniteSet(1))
1503.     assert DisjointUnion(Interval(0, 5), Interval(0, 5)).rewrite(Union) == Union(Interval(0, 5) * FiniteSet(0), Interval(0, 5) * FiniteSet(1))
1504.     assert DisjointUnion(Interval(-1, 2), S.EmptySet, S.EmptySet).rewrite(Union) == Interval(-1, 2) * FiniteSet(0)
1505.     assert DisjointUnion(Interval(-1, 2)).rewrite(Union) == Interval(-1, 2) * FiniteSet(0)
1506.     assert DisjointUnion(S.EmptySet, Interval(-1, 2), S.EmptySet).rewrite(Union) == Interval(-1, 2) * FiniteSet(1)
1507.     assert DisjointUnion(Interval(-oo, oo)).rewrite(Union) == Interval(-oo, oo) * FiniteSet(0)
1508.     assert DisjointUnion(S.EmptySet).rewrite(Union) == S.EmptySet
1509.     assert DisjointUnion().rewrite(Union) == S.EmptySet
1510.     raises(TypeError, lambda: DisjointUnion(Symbol('n')))
1511. 
1512.     x = Symbol("x")
1513.     y = Symbol("y")
1514.     z = Symbol("z")
1515.     assert DisjointUnion(FiniteSet(x), FiniteSet(y, z)).rewrite(Union) == (FiniteSet(x) * FiniteSet(0)) + (FiniteSet(y, z) * FiniteSet(1))
1516. 
1517. def test_DisjointUnion_is_empty():
1518.     assert DisjointUnion(S.EmptySet).is_empty is True
1519.     assert DisjointUnion(S.EmptySet, S.EmptySet).is_empty is True
1520.     assert DisjointUnion(S.EmptySet, FiniteSet(1, 2, 3)).is_empty is False
1521. 
1522. def test_DisjointUnion_is_iterable():
1523.     assert DisjointUnion(S.Integers, S.Naturals, S.Rationals).is_iterable is True
1524.     assert DisjointUnion(S.EmptySet, S.Reals).is_iterable is False
1525.     assert DisjointUnion(FiniteSet(1, 2, 3), S.EmptySet, FiniteSet(x, y)).is_iterable is True
1526.     assert DisjointUnion(S.EmptySet, S.EmptySet).is_iterable is False
1527. 
1528. def test_DisjointUnion_contains():
1529.     assert (0, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1530.     assert (0, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1531.     assert (0, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1532.     assert (1, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1533.     assert (1, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1534.     assert (1, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1535.     assert (2, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1536.     assert (2, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1537.     assert (2, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1538.     assert (0, 1, 2) not in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1539.     assert (0, 0.5) not in DisjointUnion(FiniteSet(0.5))
1540.     assert (0, 5) not in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1541.     assert (x, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1542.     assert (y, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1543.     assert (z, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1544.     assert (y, 2) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1545.     assert (0.5, 0) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1546.     assert (0.5, 1) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1547.     assert (1.5, 0) not in DisjointUnion(Interval(0, 1), Interval(0, 2))
1548.     assert (1.5, 1) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1549. 
1550. def test_DisjointUnion_iter():
1551.     D = DisjointUnion(FiniteSet(3, 5, 7, 9), FiniteSet(x, y, z))
1552.     it = iter(D)
1553.     L1 = [(x, 1), (y, 1), (z, 1)]
1554.     L2 = [(3, 0), (5, 0), (7, 0), (9, 0)]
1555.     nxt = next(it)
1556.     assert nxt in L2
1557.     L2.remove(nxt)
1558.     nxt = next(it)
1559.     assert nxt in L1
1560.     L1.remove(nxt)
1561.     nxt = next(it)
1562.     assert nxt in L2
1563.     L2.remove(nxt)
1564.     nxt = next(it)
1565.     assert nxt in L1
1566.     L1.remove(nxt)
1567.     nxt = next(it)
1568.     assert nxt in L2
1569.     L2.remove(nxt)
1570.     nxt = next(it)
1571.     assert nxt in L1
1572.     L1.remove(nxt)
1573.     nxt = next(it)
1574.     assert nxt in L2
1575.     L2.remove(nxt)
1576.     raises(StopIteration, lambda: next(it))
1577. 
1578.     raises(ValueError, lambda: iter(DisjointUnion(Interval(0, 1), S.EmptySet)))
1579. 
1580. def test_DisjointUnion_len():
1581.     assert len(DisjointUnion(FiniteSet(3, 5, 7, 9), FiniteSet(x, y, z))) == 7
1582.     assert len(DisjointUnion(S.EmptySet, S.EmptySet, FiniteSet(x, y, z), S.EmptySet)) == 3
1583.     raises(ValueError, lambda: len(DisjointUnion(Interval(0, 1), S.EmptySet)))
1584. 
1585. def test_issue_20089():
1586.     B = FiniteSet(FiniteSet(1, 2), FiniteSet(1))
1587.     assert not 1 in B
1588.     assert not 1.0 in B
1589.     assert not Eq(1, FiniteSet(1, 2))
1590.     assert FiniteSet(1) in B
1591.     A = FiniteSet(1, 2)
1592.     assert A in B
1593.     assert B.issubset(B)
1594.     assert not A.issubset(B)
1595.     assert 1 in A
1596.     C = FiniteSet(FiniteSet(1, 2), FiniteSet(1), 1, 2)
1597.     assert A.issubset(C)
1598.     assert B.issubset(C)
1599. 
1600. def test_issue_20379():
1601.     #https://github.com/sympy/sympy/issues/20379
1602.     x = pi - 3.14159265358979
1603.     assert FiniteSet(x).evalf(2) == FiniteSet(Float('3.23108914886517e-15', 2))

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-20 22:26:01,811 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file `sympy/sets/tests/test_sets.py`. This context contains the first 500 lines of the file, which is directly relevant to the user's request.", relative_path='sympy/sets/tests/test_sets.py', start_line=1, end_line=500), ContextOutput(reasoning="The user requested the full content of the file `sympy/sets/tests/test_sets.py`. This context contains the remaining lines of the file from 501 to 1603, which is directly relevant to fulfilling the user's request for the full file content.", relative_path='sympy/sets/tests/test_sets.py', start_line=501, end_line=1603)]
2025-12-20 22:26:01,813 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of the file `sympy/sets/tests/test_sets.py`.
2025-12-20 22:26:01,813 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-20 22:26:01,813 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-20 22:26:01,814 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 0 existing contexts
2025-12-20 22:26:01,814 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-20 22:26:01,815 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .github
|   └── workflows
|       └── runtests.yml
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.md
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_optional_dependencies.py
|   ├── test_py2_import.py
|   ├── test_setup.py
|   ├── test_sphinx.sh
|   ├── test_submodule_imports.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── sparse.rst
|       |   |   └── sparsetools.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── control
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   ├── solvers.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── fu.rst
|       |   |   ├── hyperexpand.rst
|       |   |   ├── index.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── testing
|       |   |   ├── index.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   └── runtests.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       ├── intro.rst
|       |       └── vector_integration.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── aptinstall.sh
|   ├── authors.py
|   ├── build_docs.py
|   ├── compare_tar_against_git.py
|   ├── fabfile.py
|   ├── github_release.py
|   ├── helpers.py
|   ├── pull_and_run_rever.sh
|   ├── release.sh
|   ├── releasecheck.py
|   ├── requirements.txt
|   ├── sha256.py
|   ├── test_install.py
|   ├── update_docs.py
|   └── update_requirements.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── numpy_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   ├── scipy_nodes.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_array_utils.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_numpy_nodes.py
    |       ├── test_pyutils.py
    |       ├── test_rewriting.py
    |       └── test_scipy_nodes.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── schur_number.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_schur_number.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── _print_helpers.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── decompositions.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── determinant.py
    |   ├── eigen.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── companion.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── sets.py
    |   |   ├── slice.py
    |   |   ├── special.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_companion.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_sets.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_special.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── graph.py
    |   ├── immutable.py
    |   ├── inverse.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── reductions.py
    |   ├── solvers.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   ├── subspaces.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_commonmatrix.py
    |   |   ├── test_decompositions.py
    |   |   ├── test_densearith.py
    |   |   ├── test_densesolve.py
    |   |   ├── test_densetools.py
    |   |   ├── test_determinant.py
    |   |   ├── test_eigen.py
    |   |   ├── test_graph.py
    |   |   ├── test_immutable.py
    |   |   ├── test_interactions.py
    |   |   ├── test_matrices.py
    |   |   ├── test_normalforms.py
    |   |   ├── test_reductions.py
    |   |   ├── test_solvers.py
    |   |   ├── test_sparse.py
    |   |   ├── test_sparsetools.py
    |   |   └── test_subspaces.py
    |   └── utilities.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── digits.py
    |   ├── ecm.py
    |   ├── egyptian_fraction.py
    |   ├── elliptic_curve.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── qs.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_digits.py
    |       ├── test_ecm.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_elliptic_curve.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       ├── test_qs.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── README.txt
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── control
    |   |   ├── __init__.py
    |   |   ├── lti.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_lti.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domainmatrix.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gaussiandomains.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_domainmatrix.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── c.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxx.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── fortran.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_c.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxx.py
    |   |   ├── test_dot.py
    |   |   ├── test_fortran.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── comparison.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine
    |   |   ├── __init__.py
    |   |   ├── diophantine.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_diophantine.py
    |   ├── inequalities.py
    |   ├── ode
    |   |   ├── __init__.py
    |   |   ├── ode.py
    |   |   ├── single.py
    |   |   ├── subscheck.py
    |   |   ├── systems.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_ode.py
    |   |       ├── test_single.py
    |   |       ├── test_subscheck.py
    |   |       └── test_systems.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── compound_rv.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── matrix_distributions.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_multivariate_probability.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_compound_rv.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_matrix_distributions.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       ├── test_symbolic_multivariate.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── array_derivatives.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_array_derivatives.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── testing
    |   ├── __init__.py
    |   ├── benchmarking.py
    |   ├── matrices.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_module_imports.py
    |   |   └── test_pytest.py
    |   └── tmpfiles.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_matchpy_connector.py
    |   |   ├── test_misc.py
    |   |   ├── test_pickling.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── implicitregion.py
        ├── integrals.py
        ├── operators.py
        ├── orienters.py
        ├── parametricregion.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_implicitregion.py
        |   ├── test_integrals.py
        |   ├── test_operators.py
        |   ├── test_parametricregion.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: `is_subset` gives wrong results

Description: @sylee957 Current status on `master`,
```python
>>> a = FiniteSet(1, 2)
>>> b = ProductSet(a, a)
>>> c = FiniteSet((1, 1), (1, 2), (2, 1), (2, 2))
>>> b.intersection(c) == c.intersection(b)
True
>>> b.is_subset(c)
>>> c.is_subset(b)
True
>>> Eq(b, c).simplify()
Traceback (most recent call last):
  File "/usr/lib/python3.6/code.py", line 91, in runcode
    exec(code, self.locals)
  File "<console>", line 1, in <module>
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/basic.py", line 1655, in simplify
    return simplify(self, **kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/simplify/simplify.py", line 559, in simplify
    return _eval_simplify(**kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py", line 646, in _eval_simplify
    e = super(Equality, self)._eval_simplify(**kwargs)
  File "/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py", line 308, in _eval_simplify
    elif dif.equals(0):  # XXX this is expensive
AttributeError: 'Complement' object has no attribute 'equals'
>>> b.rewrite(FiniteSet)
      2
{1, 2} 
>>> 
```

_Originally posted by @czgdp1807 in https://github.com/sympy/sympy/pull/16764#issuecomment-592606532_

Patch information:
diff --git a/sympy/core/relational.py b/sympy/core/relational.py
index e2e0b7fbcc..13fcfb2e84 100644
--- a/sympy/core/relational.py
+++ b/sympy/core/relational.py
@@ -309,9 +309,9 @@ def _eval_simplify(self, **kwargs):
             # replace dif with a valid Number that will
             # allow a definitive comparison with 0
             v = None
-            if dif.is_comparable:
+            if isinstance(dif, Expr) and dif.is_comparable:
                 v = dif.n(2)
-            elif dif.equals(0):  # XXX this is expensive
+            elif hasattr(dif, 'equals') and dif.equals(0):  # XXX this is expensive
                 v = S.Zero
             if v is not None:
                 r = r.func._eval_relation(v, S.Zero)
diff --git a/sympy/sets/handlers/issubset.py b/sympy/sets/handlers/issubset.py
index fdca06025a..7986145130 100644
--- a/sympy/sets/handlers/issubset.py
+++ b/sympy/sets/handlers/issubset.py
@@ -1,7 +1,7 @@
 from sympy import S, Symbol
 from sympy.core.logic import fuzzy_and, fuzzy_bool, fuzzy_not, fuzzy_or
 from sympy.core.relational import Eq
-from sympy.sets.sets import FiniteSet, Interval, Set, Union
+from sympy.sets.sets import FiniteSet, Interval, Set, Union, ProductSet
 from sympy.sets.fancysets import Complexes, Reals, Range, Rationals
 from sympy.multipledispatch import dispatch
 
@@ -133,3 +133,27 @@ def is_subset_sets(a, b): # noqa:F811
 @dispatch(Rationals, Range)  # type: ignore # noqa:F811
 def is_subset_sets(a, b): # noqa:F811
     return False
+
+@dispatch(ProductSet, ProductSet)  # type: ignore # noqa:F811
+def is_subset_sets(a_prod, b_prod): # noqa:F811
+    if len(a_prod.sets) != len(b_prod.sets):
+        return False
+    return fuzzy_and(s.is_subset(t) for s, t in zip(a_prod.sets, b_prod.sets))
+
+@dispatch(ProductSet, FiniteSet)  # type: ignore # noqa:F811
+def is_subset_sets(a_prod, b_fs): # noqa:F811
+    # If product set is known infinite and b_fs is finite, cannot be a subset
+    if a_prod.is_finite_set is False and b_fs.is_finite_set:
+        return False
+    # If sizes are known, use a quick check
+    try:
+        a_size = len(a_prod)
+    except TypeError:
+        a_size = None
+    if a_size is not None:
+        if a_size > len(b_fs):
+            return False
+    try:
+        return fuzzy_and(b_fs.contains(x) for x in a_prod)
+    except TypeError:
+        return None
diff --git a/sympy/sets/sets.py b/sympy/sets/sets.py
index 3c4aa86e36..908c2be63e 100644
--- a/sympy/sets/sets.py
+++ b/sympy/sets/sets.py
@@ -403,6 +403,24 @@ def _eval_is_superset(self, other):
         '''Returns a fuzzy bool for whether self is a subset of other.'''
         return None
 
+    def _eval_Eq(self, other):
+        """Evaluate set equality in terms of mutual subset.
+
+        Returns True if both are definitely subsets of each other, False if
+        either subset relation is definitely False, otherwise None.
+        """
+        if not isinstance(other, Set):
+            return None
+        l = self.is_subset(other)
+        if l is False:
+            return False
+        r = other.is_subset(self)
+        if r is False:
+            return False
+        if l is True and r is True:
+            return True
+        return None
+
     # This should be deprecated:
     def issubset(self, other):
         """


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `sympy/sets/tests/test_sets.py`.
Extra Requirements: 
Purpose: I need to analyze the test cases in `sympy/sets/tests/test_sets.py` to find existing tests that cover the interaction between `ProductSet` and `FiniteSet` with respect to `is_subset` and `Eq` to answer the user's request.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/sets/tests/test_sets.py
Line number range: 1 - 500
Content:
1. from sympy import (Symbol, Set, Union, Interval, oo, S, sympify, nan,
2.     Max, Min, Float, DisjointUnion,
3.     FiniteSet, Intersection, imageset, I, true, false, ProductSet,
4.     sqrt, Complement, EmptySet, sin, cos, Lambda, ImageSet, pi,
5.     Pow, Contains, Sum, rootof, SymmetricDifference, Piecewise,
6.     Matrix, Range, Add, symbols, zoo, Rational)
7. from mpmath import mpi
8. 
9. from sympy.core.expr import unchanged
10. from sympy.core.relational import Eq, Ne, Le, Lt, LessThan
11. from sympy.logic import And, Or, Xor
12. from sympy.testing.pytest import raises, XFAIL, warns_deprecated_sympy
13. 
14. from sympy.abc import x, y, z, m, n
15. 
16. 
17. def test_imageset():
18.     ints = S.Integers
19.     assert imageset(x, x - 1, S.Naturals) is S.Naturals0
20.     assert imageset(x, x + 1, S.Naturals0) is S.Naturals
21.     assert imageset(x, abs(x), S.Naturals0) is S.Naturals0
22.     assert imageset(x, abs(x), S.Naturals) is S.Naturals
23.     assert imageset(x, abs(x), S.Integers) is S.Naturals0
24.     # issue 16878a
25.     r = symbols('r', real=True)
26.     assert imageset(x, (x, x), S.Reals)._contains((1, r)) == None
27.     assert imageset(x, (x, x), S.Reals)._contains((1, 2)) == False
28.     assert (r, r) in imageset(x, (x, x), S.Reals)
29.     assert 1 + I in imageset(x, x + I, S.Reals)
30.     assert {1} not in imageset(x, (x,), S.Reals)
31.     assert (1, 1) not in imageset(x, (x,) , S.Reals)
32.     raises(TypeError, lambda: imageset(x, ints))
33.     raises(ValueError, lambda: imageset(x, y, z, ints))
34.     raises(ValueError, lambda: imageset(Lambda(x, cos(x)), y))
35.     assert (1, 2) in imageset(Lambda((x, y), (x, y)), ints, ints)
36.     raises(ValueError, lambda: imageset(Lambda(x, x), ints, ints))
37.     assert imageset(cos, ints) == ImageSet(Lambda(x, cos(x)), ints)
38.     def f(x):
39.         return cos(x)
40.     assert imageset(f, ints) == imageset(x, cos(x), ints)
41.     f = lambda x: cos(x)
42.     assert imageset(f, ints) == ImageSet(Lambda(x, cos(x)), ints)
43.     assert imageset(x, 1, ints) == FiniteSet(1)
44.     assert imageset(x, y, ints) == {y}
45.     assert imageset((x, y), (1, z), ints, S.Reals) == {(1, z)}
46.     clash = Symbol('x', integer=true)
47.     assert (str(imageset(lambda x: x + clash, Interval(-2, 1)).lamda.expr)
48.         in ('x0 + x', 'x + x0'))
49.     x1, x2 = symbols("x1, x2")
50.     assert imageset(lambda x, y:
51.         Add(x, y), Interval(1, 2), Interval(2, 3)).dummy_eq(
52.         ImageSet(Lambda((x1, x2), x1 + x2),
53.         Interval(1, 2), Interval(2, 3)))
54. 
55. 
56. def test_is_empty():
57.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
58.             S.UniversalSet]:
59.         assert s.is_empty is False
60. 
61.     assert S.EmptySet.is_empty is True
62. 
63. 
64. def test_is_finiteset():
65.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
66.             S.UniversalSet]:
67.         assert s.is_finite_set is False
68. 
69.     assert S.EmptySet.is_finite_set is True
70. 
71.     assert FiniteSet(1, 2).is_finite_set is True
72.     assert Interval(1, 2).is_finite_set is False
73.     assert Interval(x, y).is_finite_set is None
74.     assert ProductSet(FiniteSet(1), FiniteSet(2)).is_finite_set is True
75.     assert ProductSet(FiniteSet(1), Interval(1, 2)).is_finite_set is False
76.     assert ProductSet(FiniteSet(1), Interval(x, y)).is_finite_set is None
77.     assert Union(Interval(0, 1), Interval(2, 3)).is_finite_set is False
78.     assert Union(FiniteSet(1), Interval(2, 3)).is_finite_set is False
79.     assert Union(FiniteSet(1), FiniteSet(2)).is_finite_set is True
80.     assert Union(FiniteSet(1), Interval(x, y)).is_finite_set is None
81.     assert Intersection(Interval(x, y), FiniteSet(1)).is_finite_set is True
82.     assert Intersection(Interval(x, y), Interval(1, 2)).is_finite_set is None
83.     assert Intersection(FiniteSet(x), FiniteSet(y)).is_finite_set is True
84.     assert Complement(FiniteSet(1), Interval(x, y)).is_finite_set is True
85.     assert Complement(Interval(x, y), FiniteSet(1)).is_finite_set is None
86.     assert Complement(Interval(1, 2), FiniteSet(x)).is_finite_set is False
87.     assert DisjointUnion(Interval(-5, 3), FiniteSet(x, y)).is_finite_set is False
88.     assert DisjointUnion(S.EmptySet, FiniteSet(x, y), S.EmptySet).is_finite_set is True
89. 
90. 
91. def test_deprecated_is_EmptySet():
92.     with warns_deprecated_sympy():
93.         S.EmptySet.is_EmptySet
94. 
95. 
96. def test_interval_arguments():
97.     assert Interval(0, oo) == Interval(0, oo, False, True)
98.     assert Interval(0, oo).right_open is true
99.     assert Interval(-oo, 0) == Interval(-oo, 0, True, False)
100.     assert Interval(-oo, 0).left_open is true
101.     assert Interval(oo, -oo) == S.EmptySet
102.     assert Interval(oo, oo) == S.EmptySet
103.     assert Interval(-oo, -oo) == S.EmptySet
104.     assert Interval(oo, x) == S.EmptySet
105.     assert Interval(oo, oo) == S.EmptySet
106.     assert Interval(x, -oo) == S.EmptySet
107.     assert Interval(x, x) == {x}
108. 
109.     assert isinstance(Interval(1, 1), FiniteSet)
110.     e = Sum(x, (x, 1, 3))
111.     assert isinstance(Interval(e, e), FiniteSet)
112. 
113.     assert Interval(1, 0) == S.EmptySet
114.     assert Interval(1, 1).measure == 0
115. 
116.     assert Interval(1, 1, False, True) == S.EmptySet
117.     assert Interval(1, 1, True, False) == S.EmptySet
118.     assert Interval(1, 1, True, True) == S.EmptySet
119. 
120. 
121.     assert isinstance(Interval(0, Symbol('a')), Interval)
122.     assert Interval(Symbol('a', real=True, positive=True), 0) == S.EmptySet
123.     raises(ValueError, lambda: Interval(0, S.ImaginaryUnit))
124.     raises(ValueError, lambda: Interval(0, Symbol('z', extended_real=False)))
125.     raises(ValueError, lambda: Interval(x, x + S.ImaginaryUnit))
126. 
127.     raises(NotImplementedError, lambda: Interval(0, 1, And(x, y)))
128.     raises(NotImplementedError, lambda: Interval(0, 1, False, And(x, y)))
129.     raises(NotImplementedError, lambda: Interval(0, 1, z, And(x, y)))
130. 
131. 
132. def test_interval_symbolic_end_points():
133.     a = Symbol('a', real=True)
134. 
135.     assert Union(Interval(0, a), Interval(0, 3)).sup == Max(a, 3)
136.     assert Union(Interval(a, 0), Interval(-3, 0)).inf == Min(-3, a)
137. 
138.     assert Interval(0, a).contains(1) == LessThan(1, a)
139. 
140. 
141. def test_interval_is_empty():
142.     x, y = symbols('x, y')
143.     r = Symbol('r', real=True)
144.     p = Symbol('p', positive=True)
145.     n = Symbol('n', negative=True)
146.     nn = Symbol('nn', nonnegative=True)
147.     assert Interval(1, 2).is_empty == False
148.     assert Interval(3, 3).is_empty == False  # FiniteSet
149.     assert Interval(r, r).is_empty == False  # FiniteSet
150.     assert Interval(r, r + nn).is_empty == False
151.     assert Interval(x, x).is_empty == False
152.     assert Interval(1, oo).is_empty == False
153.     assert Interval(-oo, oo).is_empty == False
154.     assert Interval(-oo, 1).is_empty == False
155.     assert Interval(x, y).is_empty == None
156.     assert Interval(r, oo).is_empty == False  # real implies finite
157.     assert Interval(n, 0).is_empty == False
158.     assert Interval(n, 0, left_open=True).is_empty == False
159.     assert Interval(p, 0).is_empty == True  # EmptySet
160.     assert Interval(nn, 0).is_empty == None
161.     assert Interval(n, p).is_empty == False
162.     assert Interval(0, p, left_open=True).is_empty == False
163.     assert Interval(0, p, right_open=True).is_empty == False
164.     assert Interval(0, nn, left_open=True).is_empty == None
165.     assert Interval(0, nn, right_open=True).is_empty == None
166. 
167. 
168. def test_union():
169.     assert Union(Interval(1, 2), Interval(2, 3)) == Interval(1, 3)
170.     assert Union(Interval(1, 2), Interval(2, 3, True)) == Interval(1, 3)
171.     assert Union(Interval(1, 3), Interval(2, 4)) == Interval(1, 4)
172.     assert Union(Interval(1, 2), Interval(1, 3)) == Interval(1, 3)
173.     assert Union(Interval(1, 3), Interval(1, 2)) == Interval(1, 3)
174.     assert Union(Interval(1, 3, False, True), Interval(1, 2)) == \
175.         Interval(1, 3, False, True)
176.     assert Union(Interval(1, 3), Interval(1, 2, False, True)) == Interval(1, 3)
177.     assert Union(Interval(1, 2, True), Interval(1, 3)) == Interval(1, 3)
178.     assert Union(Interval(1, 2, True), Interval(1, 3, True)) == \
179.         Interval(1, 3, True)
180.     assert Union(Interval(1, 2, True), Interval(1, 3, True, True)) == \
181.         Interval(1, 3, True, True)
182.     assert Union(Interval(1, 2, True, True), Interval(1, 3, True)) == \
183.         Interval(1, 3, True)
184.     assert Union(Interval(1, 3), Interval(2, 3)) == Interval(1, 3)
185.     assert Union(Interval(1, 3, False, True), Interval(2, 3)) == \
186.         Interval(1, 3)
187.     assert Union(Interval(1, 2, False, True), Interval(2, 3, True)) != \
188.         Interval(1, 3)
189.     assert Union(Interval(1, 2), S.EmptySet) == Interval(1, 2)
190.     assert Union(S.EmptySet) == S.EmptySet
191. 
192.     assert Union(Interval(0, 1), *[FiniteSet(1.0/n) for n in range(1, 10)]) == \
193.         Interval(0, 1)
194.     # issue #18241:
195.     x = Symbol('x')
196.     assert Union(Interval(0, 1), FiniteSet(1, x)) == Union(
197.         Interval(0, 1), FiniteSet(x))
198.     assert unchanged(Union, Interval(0, 1), FiniteSet(2, x))
199. 
200.     assert Interval(1, 2).union(Interval(2, 3)) == \
201.         Interval(1, 2) + Interval(2, 3)
202. 
203.     assert Interval(1, 2).union(Interval(2, 3)) == Interval(1, 3)
204. 
205.     assert Union(Set()) == Set()
206. 
207.     assert FiniteSet(1) + FiniteSet(2) + FiniteSet(3) == FiniteSet(1, 2, 3)
208.     assert FiniteSet('ham') + FiniteSet('eggs') == FiniteSet('ham', 'eggs')
209.     assert FiniteSet(1, 2, 3) + S.EmptySet == FiniteSet(1, 2, 3)
210. 
211.     assert FiniteSet(1, 2, 3) & FiniteSet(2, 3, 4) == FiniteSet(2, 3)
212.     assert FiniteSet(1, 2, 3) | FiniteSet(2, 3, 4) == FiniteSet(1, 2, 3, 4)
213. 
214.     assert FiniteSet(1, 2, 3) & S.EmptySet == S.EmptySet
215.     assert FiniteSet(1, 2, 3) | S.EmptySet == FiniteSet(1, 2, 3)
216. 
217.     x = Symbol("x")
218.     y = Symbol("y")
219.     z = Symbol("z")
220.     assert S.EmptySet | FiniteSet(x, FiniteSet(y, z)) == \
221.         FiniteSet(x, FiniteSet(y, z))
222. 
223.     # Test that Intervals and FiniteSets play nicely
224.     assert Interval(1, 3) + FiniteSet(2) == Interval(1, 3)
225.     assert Interval(1, 3, True, True) + FiniteSet(3) == \
226.         Interval(1, 3, True, False)
227.     X = Interval(1, 3) + FiniteSet(5)
228.     Y = Interval(1, 2) + FiniteSet(3)
229.     XandY = X.intersect(Y)
230.     assert 2 in X and 3 in X and 3 in XandY
231.     assert XandY.is_subset(X) and XandY.is_subset(Y)
232. 
233.     raises(TypeError, lambda: Union(1, 2, 3))
234. 
235.     assert X.is_iterable is False
236. 
237.     # issue 7843
238.     assert Union(S.EmptySet, FiniteSet(-sqrt(-I), sqrt(-I))) == \
239.         FiniteSet(-sqrt(-I), sqrt(-I))
240. 
241.     assert Union(S.Reals, S.Integers) == S.Reals
242. 
243. 
244. def test_union_iter():
245.     # Use Range because it is ordered
246.     u = Union(Range(3), Range(5), Range(4), evaluate=False)
247. 
248.     # Round robin
249.     assert list(u) == [0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 4]
250. 
251. 
252. def test_union_is_empty():
253.     assert (Interval(x, y) + FiniteSet(1)).is_empty == False
254.     assert (Interval(x, y) + Interval(-x, y)).is_empty == None
255. 
256. 
257. def test_difference():
258.     assert Interval(1, 3) - Interval(1, 2) == Interval(2, 3, True)
259.     assert Interval(1, 3) - Interval(2, 3) == Interval(1, 2, False, True)
260.     assert Interval(1, 3, True) - Interval(2, 3) == Interval(1, 2, True, True)
261.     assert Interval(1, 3, True) - Interval(2, 3, True) == \
262.         Interval(1, 2, True, False)
263.     assert Interval(0, 2) - FiniteSet(1) == \
264.         Union(Interval(0, 1, False, True), Interval(1, 2, True, False))
265. 
266.     # issue #18119
267.     assert S.Reals - FiniteSet(I) == S.Reals
268.     assert S.Reals - FiniteSet(-I, I) == S.Reals
269.     assert Interval(0, 10) - FiniteSet(-I, I) == Interval(0, 10)
270.     assert Interval(0, 10) - FiniteSet(1, I) == Union(
271.         Interval.Ropen(0, 1), Interval.Lopen(1, 10))
272.     assert S.Reals - FiniteSet(1, 2 + I, x, y**2) == Complement(
273.         Union(Interval.open(-oo, 1), Interval.open(1, oo)), FiniteSet(x, y**2),
274.         evaluate=False)
275. 
276.     assert FiniteSet(1, 2, 3) - FiniteSet(2) == FiniteSet(1, 3)
277.     assert FiniteSet('ham', 'eggs') - FiniteSet('eggs') == FiniteSet('ham')
278.     assert FiniteSet(1, 2, 3, 4) - Interval(2, 10, True, False) == \
279.         FiniteSet(1, 2)
280.     assert FiniteSet(1, 2, 3, 4) - S.EmptySet == FiniteSet(1, 2, 3, 4)
281.     assert Union(Interval(0, 2), FiniteSet(2, 3, 4)) - Interval(1, 3) == \
282.         Union(Interval(0, 1, False, True), FiniteSet(4))
283. 
284.     assert -1 in S.Reals - S.Naturals
285. 
286. 
287. def test_Complement():
288.     A = FiniteSet(1, 3, 4)
289.     B = FiniteSet(3, 4)
290.     C = Interval(1, 3)
291.     D = Interval(1, 2)
292. 
293.     assert Complement(A, B, evaluate=False).is_iterable is True
294.     assert Complement(A, C, evaluate=False).is_iterable is True
295.     assert Complement(C, D, evaluate=False).is_iterable is None
296. 
297.     assert FiniteSet(*Complement(A, B, evaluate=False)) == FiniteSet(1)
298.     assert FiniteSet(*Complement(A, C, evaluate=False)) == FiniteSet(4)
299.     raises(TypeError, lambda: FiniteSet(*Complement(C, A, evaluate=False)))
300. 
301.     assert Complement(Interval(1, 3), Interval(1, 2)) == Interval(2, 3, True)
302.     assert Complement(FiniteSet(1, 3, 4), FiniteSet(3, 4)) == FiniteSet(1)
303.     assert Complement(Union(Interval(0, 2), FiniteSet(2, 3, 4)),
304.                       Interval(1, 3)) == \
305.         Union(Interval(0, 1, False, True), FiniteSet(4))
306. 
307.     assert not 3 in Complement(Interval(0, 5), Interval(1, 4), evaluate=False)
308.     assert -1 in Complement(S.Reals, S.Naturals, evaluate=False)
309.     assert not 1 in Complement(S.Reals, S.Naturals, evaluate=False)
310. 
311.     assert Complement(S.Integers, S.UniversalSet) == EmptySet
312.     assert S.UniversalSet.complement(S.Integers) == EmptySet
313. 
314.     assert (not 0 in S.Reals.intersect(S.Integers - FiniteSet(0)))
315. 
316.     assert S.EmptySet - S.Integers == S.EmptySet
317. 
318.     assert (S.Integers - FiniteSet(0)) - FiniteSet(1) == S.Integers - FiniteSet(0, 1)
319. 
320.     assert S.Reals - Union(S.Naturals, FiniteSet(pi)) == \
321.             Intersection(S.Reals - S.Naturals, S.Reals - FiniteSet(pi))
322.     # issue 12712
323.     assert Complement(FiniteSet(x, y, 2), Interval(-10, 10)) == \
324.             Complement(FiniteSet(x, y), Interval(-10, 10))
325. 
326.     A = FiniteSet(*symbols('a:c'))
327.     B = FiniteSet(*symbols('d:f'))
328.     assert unchanged(Complement, ProductSet(A, A), B)
329. 
330.     A2 = ProductSet(A, A)
331.     B3 = ProductSet(B, B, B)
332.     assert A2 - B3 == A2
333.     assert B3 - A2 == B3
334. 
335. 
336. def test_set_operations_nonsets():
337.     '''Tests that e.g. FiniteSet(1) * 2 raises TypeError'''
338.     ops = [
339.         lambda a, b: a + b,
340.         lambda a, b: a - b,
341.         lambda a, b: a * b,
342.         lambda a, b: a / b,
343.         lambda a, b: a // b,
344.         lambda a, b: a | b,
345.         lambda a, b: a & b,
346.         lambda a, b: a ^ b,
347.         # FiniteSet(1) ** 2 gives a ProductSet
348.         #lambda a, b: a ** b,
349.     ]
350.     Sx = FiniteSet(x)
351.     Sy = FiniteSet(y)
352.     sets = [
353.         {1},
354.         FiniteSet(1),
355.         Interval(1, 2),
356.         Union(Sx, Interval(1, 2)),
357.         Intersection(Sx, Sy),
358.         Complement(Sx, Sy),
359.         ProductSet(Sx, Sy),
360.         S.EmptySet,
361.     ]
362.     nums = [0, 1, 2, S(0), S(1), S(2)]
363. 
364.     for si in sets:
365.         for ni in nums:
366.             for op in ops:
367.                 raises(TypeError, lambda : op(si, ni))
368.                 raises(TypeError, lambda : op(ni, si))
369.         raises(TypeError, lambda: si ** object())
370.         raises(TypeError, lambda: si ** {1})
371. 
372. 
373. def test_complement():
374.     assert Interval(0, 1).complement(S.Reals) == \
375.         Union(Interval(-oo, 0, True, True), Interval(1, oo, True, True))
376.     assert Interval(0, 1, True, False).complement(S.Reals) == \
377.         Union(Interval(-oo, 0, True, False), Interval(1, oo, True, True))
378.     assert Interval(0, 1, False, True).complement(S.Reals) == \
379.         Union(Interval(-oo, 0, True, True), Interval(1, oo, False, True))
380.     assert Interval(0, 1, True, True).complement(S.Reals) == \
381.         Union(Interval(-oo, 0, True, False), Interval(1, oo, False, True))
382. 
383.     assert S.UniversalSet.complement(S.EmptySet) == S.EmptySet
384.     assert S.UniversalSet.complement(S.Reals) == S.EmptySet
385.     assert S.UniversalSet.complement(S.UniversalSet) == S.EmptySet
386. 
387.     assert S.EmptySet.complement(S.Reals) == S.Reals
388. 
389.     assert Union(Interval(0, 1), Interval(2, 3)).complement(S.Reals) == \
390.         Union(Interval(-oo, 0, True, True), Interval(1, 2, True, True),
391.               Interval(3, oo, True, True))
392. 
393.     assert FiniteSet(0).complement(S.Reals) ==  \
394.         Union(Interval(-oo, 0, True, True), Interval(0, oo, True, True))
395. 
396.     assert (FiniteSet(5) + Interval(S.NegativeInfinity,
397.                                     0)).complement(S.Reals) == \
398.         Interval(0, 5, True, True) + Interval(5, S.Infinity, True, True)
399. 
400.     assert FiniteSet(1, 2, 3).complement(S.Reals) == \
401.         Interval(S.NegativeInfinity, 1, True, True) + \
402.         Interval(1, 2, True, True) + Interval(2, 3, True, True) +\
403.         Interval(3, S.Infinity, True, True)
404. 
405.     assert FiniteSet(x).complement(S.Reals) == Complement(S.Reals, FiniteSet(x))
406. 
407.     assert FiniteSet(0, x).complement(S.Reals) == Complement(Interval(-oo, 0, True, True) +
408.                                                              Interval(0, oo, True, True)
409.                                                              , FiniteSet(x), evaluate=False)
410. 
411.     square = Interval(0, 1) * Interval(0, 1)
412.     notsquare = square.complement(S.Reals*S.Reals)
413. 
414.     assert all(pt in square for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
415.     assert not any(
416.         pt in notsquare for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
417.     assert not any(pt in square for pt in [(-1, 0), (1.5, .5), (10, 10)])
418.     assert all(pt in notsquare for pt in [(-1, 0), (1.5, .5), (10, 10)])
419. 
420. 
421. def test_intersect1():
422.     assert all(S.Integers.intersection(i) is i for i in
423.         (S.Naturals, S.Naturals0))
424.     assert all(i.intersection(S.Integers) is i for i in
425.         (S.Naturals, S.Naturals0))
426.     s =  S.Naturals0
427.     assert S.Naturals.intersection(s) is S.Naturals
428.     assert s.intersection(S.Naturals) is S.Naturals
429.     x = Symbol('x')
430.     assert Interval(0, 2).intersect(Interval(1, 2)) == Interval(1, 2)
431.     assert Interval(0, 2).intersect(Interval(1, 2, True)) == \
432.         Interval(1, 2, True)
433.     assert Interval(0, 2, True).intersect(Interval(1, 2)) == \
434.         Interval(1, 2, False, False)
435.     assert Interval(0, 2, True, True).intersect(Interval(1, 2)) == \
436.         Interval(1, 2, False, True)
437.     assert Interval(0, 2).intersect(Union(Interval(0, 1), Interval(2, 3))) == \
438.         Union(Interval(0, 1), Interval(2, 2))
439. 
440.     assert FiniteSet(1, 2).intersect(FiniteSet(1, 2, 3)) == FiniteSet(1, 2)
441.     assert FiniteSet(1, 2, x).intersect(FiniteSet(x)) == FiniteSet(x)
442.     assert FiniteSet('ham', 'eggs').intersect(FiniteSet('ham')) == \
443.         FiniteSet('ham')
444.     assert FiniteSet(1, 2, 3, 4, 5).intersect(S.EmptySet) == S.EmptySet
445. 
446.     assert Interval(0, 5).intersect(FiniteSet(1, 3)) == FiniteSet(1, 3)
447.     assert Interval(0, 1, True, True).intersect(FiniteSet(1)) == S.EmptySet
448. 
449.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2)) == \
450.         Union(Interval(1, 1), Interval(2, 2))
451.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(0, 2)) == \
452.         Union(Interval(0, 1), Interval(2, 2))
453.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2, True, True)) == \
454.         S.EmptySet
455.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(S.EmptySet) == \
456.         S.EmptySet
457.     assert Union(Interval(0, 5), FiniteSet('ham')).intersect(FiniteSet(2, 3, 4, 5, 6)) == \
458.         Intersection(FiniteSet(2, 3, 4, 5, 6), Union(FiniteSet('ham'), Interval(0, 5)))
459.     assert Intersection(FiniteSet(1, 2, 3), Interval(2, x), Interval(3, y)) == \
460.         Intersection(FiniteSet(3), Interval(2, x), Interval(3, y), evaluate=False)
461.     assert Intersection(FiniteSet(1, 2), Interval(0, 3), Interval(x, y)) == \
462.         Intersection({1, 2}, Interval(x, y), evaluate=False)
463.     assert Intersection(FiniteSet(1, 2, 4), Interval(0, 3), Interval(x, y)) == \
464.         Intersection({1, 2}, Interval(x, y), evaluate=False)
465.     # XXX: Is the real=True necessary here?
466.     # https://github.com/sympy/sympy/issues/17532
467.     m, n = symbols('m, n', real=True)
468.     assert Intersection(FiniteSet(m), FiniteSet(m, n), Interval(m, m+1)) == \
469.         FiniteSet(m)
470. 
471.     # issue 8217
472.     assert Intersection(FiniteSet(x), FiniteSet(y)) == \
473.         Intersection(FiniteSet(x), FiniteSet(y), evaluate=False)
474.     assert FiniteSet(x).intersect(S.Reals) == \
475.         Intersection(S.Reals, FiniteSet(x), evaluate=False)
476. 
477.     # tests for the intersection alias
478.     assert Interval(0, 5).intersection(FiniteSet(1, 3)) == FiniteSet(1, 3)
479.     assert Interval(0, 1, True, True).intersection(FiniteSet(1)) == S.EmptySet
480. 
481.     assert Union(Interval(0, 1), Interval(2, 3)).intersection(Interval(1, 2)) == \
482.         Union(Interval(1, 1), Interval(2, 2))
483. 
484. 
485. def test_intersection():
486.     # iterable
487.     i = Intersection(FiniteSet(1, 2, 3), Interval(2, 5), evaluate=False)
488.     assert i.is_iterable
489.     assert set(i) == {S(2), S(3)}
490. 
491.     # challenging intervals
492.     x = Symbol('x', real=True)
493.     i = Intersection(Interval(0, 3), Interval(x, 6))
494.     assert (5 in i) is False
495.     raises(TypeError, lambda: 2 in i)
496. 
497.     # Singleton special cases
498.     assert Intersection(Interval(0, 1), S.EmptySet) == S.EmptySet
499.     assert Intersection(Interval(-oo, oo), Interval(-oo, x)) == Interval(-oo, x)
500. 


File: sympy/sets/tests/test_sets.py
Line number range: 501 - 1603
Content:
501.     # Products
502.     line = Interval(0, 5)
503.     i = Intersection(line**2, line**3, evaluate=False)
504.     assert (2, 2) not in i
505.     assert (2, 2, 2) not in i
506.     raises(TypeError, lambda: list(i))
507. 
508.     a = Intersection(Intersection(S.Integers, S.Naturals, evaluate=False), S.Reals, evaluate=False)
509.     assert a._argset == frozenset([Intersection(S.Naturals, S.Integers, evaluate=False), S.Reals])
510. 
511.     assert Intersection(S.Complexes, FiniteSet(S.ComplexInfinity)) == S.EmptySet
512. 
513.     # issue 12178
514.     assert Intersection() == S.UniversalSet
515. 
516.     # issue 16987
517.     assert Intersection({1}, {1}, {x}) == Intersection({1}, {x})
518. 
519. 
520. def test_issue_9623():
521.     n = Symbol('n')
522. 
523.     a = S.Reals
524.     b = Interval(0, oo)
525.     c = FiniteSet(n)
526. 
527.     assert Intersection(a, b, c) == Intersection(b, c)
528.     assert Intersection(Interval(1, 2), Interval(3, 4), FiniteSet(n)) == EmptySet
529. 
530. 
531. def test_is_disjoint():
532.     assert Interval(0, 2).is_disjoint(Interval(1, 2)) == False
533.     assert Interval(0, 2).is_disjoint(Interval(3, 4)) == True
534. 
535. 
536. def test_ProductSet__len__():
537.     A = FiniteSet(1, 2)
538.     B = FiniteSet(1, 2, 3)
539.     assert ProductSet(A).__len__() == 2
540.     assert ProductSet(A).__len__() is not S(2)
541.     assert ProductSet(A, B).__len__() == 6
542.     assert ProductSet(A, B).__len__() is not S(6)
543. 
544. 
545. def test_ProductSet():
546.     # ProductSet is always a set of Tuples
547.     assert ProductSet(S.Reals) == S.Reals ** 1
548.     assert ProductSet(S.Reals, S.Reals) == S.Reals ** 2
549.     assert ProductSet(S.Reals, S.Reals, S.Reals) == S.Reals ** 3
550. 
551.     assert ProductSet(S.Reals) != S.Reals
552.     assert ProductSet(S.Reals, S.Reals) == S.Reals * S.Reals
553.     assert ProductSet(S.Reals, S.Reals, S.Reals) != S.Reals * S.Reals * S.Reals
554.     assert ProductSet(S.Reals, S.Reals, S.Reals) == (S.Reals * S.Reals * S.Reals).flatten()
555. 
556.     assert 1 not in ProductSet(S.Reals)
557.     assert (1,) in ProductSet(S.Reals)
558. 
559.     assert 1 not in ProductSet(S.Reals, S.Reals)
560.     assert (1, 2) in ProductSet(S.Reals, S.Reals)
561.     assert (1, I) not in ProductSet(S.Reals, S.Reals)
562. 
563.     assert (1, 2, 3) in ProductSet(S.Reals, S.Reals, S.Reals)
564.     assert (1, 2, 3) in S.Reals ** 3
565.     assert (1, 2, 3) not in S.Reals * S.Reals * S.Reals
566.     assert ((1, 2), 3) in S.Reals * S.Reals * S.Reals
567.     assert (1, (2, 3)) not in S.Reals * S.Reals * S.Reals
568.     assert (1, (2, 3)) in S.Reals * (S.Reals * S.Reals)
569. 
570.     assert ProductSet() == FiniteSet(())
571.     assert ProductSet(S.Reals, S.EmptySet) == S.EmptySet
572. 
573.     # See GH-17458
574. 
575.     for ni in range(5):
576.         Rn = ProductSet(*(S.Reals,) * ni)
577.         assert (1,) * ni in Rn
578.         assert 1 not in Rn
579. 
580.     assert (S.Reals * S.Reals) * S.Reals != S.Reals * (S.Reals * S.Reals)
581. 
582.     S1 = S.Reals
583.     S2 = S.Integers
584.     x1 = pi
585.     x2 = 3
586.     assert x1 in S1
587.     assert x2 in S2
588.     assert (x1, x2) in S1 * S2
589.     S3 = S1 * S2
590.     x3 = (x1, x2)
591.     assert x3 in S3
592.     assert (x3, x3) in S3 * S3
593.     assert x3 + x3 not in S3 * S3
594. 
595.     raises(ValueError, lambda: S.Reals**-1)
596.     with warns_deprecated_sympy():
597.         ProductSet(FiniteSet(s) for s in range(2))
598.     raises(TypeError, lambda: ProductSet(None))
599. 
600.     S1 = FiniteSet(1, 2)
601.     S2 = FiniteSet(3, 4)
602.     S3 = ProductSet(S1, S2)
603.     assert (S3.as_relational(x, y)
604.             == And(S1.as_relational(x), S2.as_relational(y))
605.             == And(Or(Eq(x, 1), Eq(x, 2)), Or(Eq(y, 3), Eq(y, 4))))
606.     raises(ValueError, lambda: S3.as_relational(x))
607.     raises(ValueError, lambda: S3.as_relational(x, 1))
608.     raises(ValueError, lambda: ProductSet(Interval(0, 1)).as_relational(x, y))
609. 
610.     Z2 = ProductSet(S.Integers, S.Integers)
611.     assert Z2.contains((1, 2)) is S.true
612.     assert Z2.contains((1,)) is S.false
613.     assert Z2.contains(x) == Contains(x, Z2, evaluate=False)
614.     assert Z2.contains(x).subs(x, 1) is S.false
615.     assert Z2.contains((x, 1)).subs(x, 2) is S.true
616.     assert Z2.contains((x, y)) == Contains((x, y), Z2, evaluate=False)
617.     assert unchanged(Contains, (x, y), Z2)
618.     assert Contains((1, 2), Z2) is S.true
619. 
620. 
621. def test_ProductSet_of_single_arg_is_not_arg():
622.     assert unchanged(ProductSet, Interval(0, 1))
623.     assert unchanged(ProductSet, ProductSet(Interval(0, 1)))
624. 
625. 
626. def test_ProductSet_is_empty():
627.     assert ProductSet(S.Integers, S.Reals).is_empty == False
628.     assert ProductSet(Interval(x, 1), S.Reals).is_empty == None
629. 
630. 
631. def test_interval_subs():
632.     a = Symbol('a', real=True)
633. 
634.     assert Interval(0, a).subs(a, 2) == Interval(0, 2)
635.     assert Interval(a, 0).subs(a, 2) == S.EmptySet
636. 
637. 
638. def test_interval_to_mpi():
639.     assert Interval(0, 1).to_mpi() == mpi(0, 1)
640.     assert Interval(0, 1, True, False).to_mpi() == mpi(0, 1)
641.     assert type(Interval(0, 1).to_mpi()) == type(mpi(0, 1))
642. 
643. 
644. def test_set_evalf():
645.     assert Interval(S(11)/64, S.Half).evalf() == Interval(
646.         Float('0.171875'), Float('0.5'))
647.     assert Interval(x, S.Half, right_open=True).evalf() == Interval(
648.         x, Float('0.5'), right_open=True)
649.     assert Interval(-oo, S.Half).evalf() == Interval(-oo, Float('0.5'))
650.     assert FiniteSet(2, x).evalf() == FiniteSet(Float('2.0'), x)
651. 
652. 
653. def test_measure():
654.     a = Symbol('a', real=True)
655. 
656.     assert Interval(1, 3).measure == 2
657.     assert Interval(0, a).measure == a
658.     assert Interval(1, a).measure == a - 1
659. 
660.     assert Union(Interval(1, 2), Interval(3, 4)).measure == 2
661.     assert Union(Interval(1, 2), Interval(3, 4), FiniteSet(5, 6, 7)).measure \
662.         == 2
663. 
664.     assert FiniteSet(1, 2, oo, a, -oo, -5).measure == 0
665. 
666.     assert S.EmptySet.measure == 0
667. 
668.     square = Interval(0, 10) * Interval(0, 10)
669.     offsetsquare = Interval(5, 15) * Interval(5, 15)
670.     band = Interval(-oo, oo) * Interval(2, 4)
671. 
672.     assert square.measure == offsetsquare.measure == 100
673.     assert (square + offsetsquare).measure == 175  # there is some overlap
674.     assert (square - offsetsquare).measure == 75
675.     assert (square * FiniteSet(1, 2, 3)).measure == 0
676.     assert (square.intersect(band)).measure == 20
677.     assert (square + band).measure is oo
678.     assert (band * FiniteSet(1, 2, 3)).measure is nan
679. 
680. 
681. def test_is_subset():
682.     assert Interval(0, 1).is_subset(Interval(0, 2)) is True
683.     assert Interval(0, 3).is_subset(Interval(0, 2)) is False
684.     assert Interval(0, 1).is_subset(FiniteSet(0, 1)) is False
685. 
686.     assert FiniteSet(1, 2).is_subset(FiniteSet(1, 2, 3, 4))
687.     assert FiniteSet(4, 5).is_subset(FiniteSet(1, 2, 3, 4)) is False
688.     assert FiniteSet(1).is_subset(Interval(0, 2))
689.     assert FiniteSet(1, 2).is_subset(Interval(0, 2, True, True)) is False
690.     assert (Interval(1, 2) + FiniteSet(3)).is_subset(
691.         Interval(0, 2, False, True) + FiniteSet(2, 3))
692. 
693.     assert Interval(3, 4).is_subset(Union(Interval(0, 1), Interval(2, 5))) is True
694.     assert Interval(3, 6).is_subset(Union(Interval(0, 1), Interval(2, 5))) is False
695. 
696.     assert FiniteSet(1, 2, 3, 4).is_subset(Interval(0, 5)) is True
697.     assert S.EmptySet.is_subset(FiniteSet(1, 2, 3)) is True
698. 
699.     assert Interval(0, 1).is_subset(S.EmptySet) is False
700.     assert S.EmptySet.is_subset(S.EmptySet) is True
701. 
702.     raises(ValueError, lambda: S.EmptySet.is_subset(1))
703. 
704.     # tests for the issubset alias
705.     assert FiniteSet(1, 2, 3, 4).issubset(Interval(0, 5)) is True
706.     assert S.EmptySet.issubset(FiniteSet(1, 2, 3)) is True
707. 
708.     assert S.Naturals.is_subset(S.Integers)
709.     assert S.Naturals0.is_subset(S.Integers)
710. 
711.     assert FiniteSet(x).is_subset(FiniteSet(y)) is None
712.     assert FiniteSet(x).is_subset(FiniteSet(y).subs(y, x)) is True
713.     assert FiniteSet(x).is_subset(FiniteSet(y).subs(y, x+1)) is False
714. 
715.     assert Interval(0, 1).is_subset(Interval(0, 1, left_open=True)) is False
716.     assert Interval(-2, 3).is_subset(Union(Interval(-oo, -2), Interval(3, oo))) is False
717. 
718.     n = Symbol('n', integer=True)
719.     assert Range(-3, 4, 1).is_subset(FiniteSet(-10, 10)) is False
720.     assert Range(S(10)**100).is_subset(FiniteSet(0, 1, 2)) is False
721.     assert Range(6, 0, -2).is_subset(FiniteSet(2, 4, 6)) is True
722.     assert Range(1, oo).is_subset(FiniteSet(1, 2)) is False
723.     assert Range(-oo, 1).is_subset(FiniteSet(1)) is False
724.     assert Range(3).is_subset(FiniteSet(0, 1, n)) is None
725.     assert Range(n, n + 2).is_subset(FiniteSet(n, n + 1)) is True
726.     assert Range(5).is_subset(Interval(0, 4, right_open=True)) is False
727. 
728. 
729. def test_is_proper_subset():
730.     assert Interval(0, 1).is_proper_subset(Interval(0, 2)) is True
731.     assert Interval(0, 3).is_proper_subset(Interval(0, 2)) is False
732.     assert S.EmptySet.is_proper_subset(FiniteSet(1, 2, 3)) is True
733. 
734.     raises(ValueError, lambda: Interval(0, 1).is_proper_subset(0))
735. 
736. 
737. def test_is_superset():
738.     assert Interval(0, 1).is_superset(Interval(0, 2)) == False
739.     assert Interval(0, 3).is_superset(Interval(0, 2))
740. 
741.     assert FiniteSet(1, 2).is_superset(FiniteSet(1, 2, 3, 4)) == False
742.     assert FiniteSet(4, 5).is_superset(FiniteSet(1, 2, 3, 4)) == False
743.     assert FiniteSet(1).is_superset(Interval(0, 2)) == False
744.     assert FiniteSet(1, 2).is_superset(Interval(0, 2, True, True)) == False
745.     assert (Interval(1, 2) + FiniteSet(3)).is_superset(
746.         Interval(0, 2, False, True) + FiniteSet(2, 3)) == False
747. 
748.     assert Interval(3, 4).is_superset(Union(Interval(0, 1), Interval(2, 5))) == False
749. 
750.     assert FiniteSet(1, 2, 3, 4).is_superset(Interval(0, 5)) == False
751.     assert S.EmptySet.is_superset(FiniteSet(1, 2, 3)) == False
752. 
753.     assert Interval(0, 1).is_superset(S.EmptySet) == True
754.     assert S.EmptySet.is_superset(S.EmptySet) == True
755. 
756.     raises(ValueError, lambda: S.EmptySet.is_superset(1))
757. 
758.     # tests for the issuperset alias
759.     assert Interval(0, 1).issuperset(S.EmptySet) == True
760.     assert S.EmptySet.issuperset(S.EmptySet) == True
761. 
762. 
763. def test_is_proper_superset():
764.     assert Interval(0, 1).is_proper_superset(Interval(0, 2)) is False
765.     assert Interval(0, 3).is_proper_superset(Interval(0, 2)) is True
766.     assert FiniteSet(1, 2, 3).is_proper_superset(S.EmptySet) is True
767. 
768.     raises(ValueError, lambda: Interval(0, 1).is_proper_superset(0))
769. 
770. 
771. def test_contains():
772.     assert Interval(0, 2).contains(1) is S.true
773.     assert Interval(0, 2).contains(3) is S.false
774.     assert Interval(0, 2, True, False).contains(0) is S.false
775.     assert Interval(0, 2, True, False).contains(2) is S.true
776.     assert Interval(0, 2, False, True).contains(0) is S.true
777.     assert Interval(0, 2, False, True).contains(2) is S.false
778.     assert Interval(0, 2, True, True).contains(0) is S.false
779.     assert Interval(0, 2, True, True).contains(2) is S.false
780. 
781.     assert (Interval(0, 2) in Interval(0, 2)) is False
782. 
783.     assert FiniteSet(1, 2, 3).contains(2) is S.true
784.     assert FiniteSet(1, 2, Symbol('x')).contains(Symbol('x')) is S.true
785. 
786.     assert FiniteSet(y)._contains(x) is None
787.     raises(TypeError, lambda: x in FiniteSet(y))
788.     assert FiniteSet({x, y})._contains({x}) is None
789.     assert FiniteSet({x, y}).subs(y, x)._contains({x}) is True
790.     assert FiniteSet({x, y}).subs(y, x+1)._contains({x}) is False
791. 
792.     # issue 8197
793.     from sympy.abc import a, b
794.     assert isinstance(FiniteSet(b).contains(-a), Contains)
795.     assert isinstance(FiniteSet(b).contains(a), Contains)
796.     assert isinstance(FiniteSet(a).contains(1), Contains)
797.     raises(TypeError, lambda: 1 in FiniteSet(a))
798. 
799.     # issue 8209
800.     rad1 = Pow(Pow(2, Rational(1, 3)) - 1, Rational(1, 3))
801.     rad2 = Pow(Rational(1, 9), Rational(1, 3)) - Pow(Rational(2, 9), Rational(1, 3)) + Pow(Rational(4, 9), Rational(1, 3))
802.     s1 = FiniteSet(rad1)
803.     s2 = FiniteSet(rad2)
804.     assert s1 - s2 == S.EmptySet
805. 
806.     items = [1, 2, S.Infinity, S('ham'), -1.1]
807.     fset = FiniteSet(*items)
808.     assert all(item in fset for item in items)
809.     assert all(fset.contains(item) is S.true for item in items)
810. 
811.     assert Union(Interval(0, 1), Interval(2, 5)).contains(3) is S.true
812.     assert Union(Interval(0, 1), Interval(2, 5)).contains(6) is S.false
813.     assert Union(Interval(0, 1), FiniteSet(2, 5)).contains(3) is S.false
814. 
815.     assert S.EmptySet.contains(1) is S.false
816.     assert FiniteSet(rootof(x**3 + x - 1, 0)).contains(S.Infinity) is S.false
817. 
818.     assert rootof(x**5 + x**3 + 1, 0) in S.Reals
819.     assert not rootof(x**5 + x**3 + 1, 1) in S.Reals
820. 
821.     # non-bool results
822.     assert Union(Interval(1, 2), Interval(3, 4)).contains(x) == \
823.         Or(And(S.One <= x, x <= 2), And(S(3) <= x, x <= 4))
824.     assert Intersection(Interval(1, x), Interval(2, 3)).contains(y) == \
825.         And(y <= 3, y <= x, S.One <= y, S(2) <= y)
826. 
827.     assert (S.Complexes).contains(S.ComplexInfinity) == S.false
828. 
829. 
830. def test_interval_symbolic():
831.     x = Symbol('x')
832.     e = Interval(0, 1)
833.     assert e.contains(x) == And(S.Zero <= x, x <= 1)
834.     raises(TypeError, lambda: x in e)
835.     e = Interval(0, 1, True, True)
836.     assert e.contains(x) == And(S.Zero < x, x < 1)
837.     c = Symbol('c', real=False)
838.     assert Interval(x, x + 1).contains(c) == False
839.     e = Symbol('e', extended_real=True)
840.     assert Interval(-oo, oo).contains(e) == And(
841.         S.NegativeInfinity < e, e < S.Infinity)
842. 
843. 
844. def test_union_contains():
845.     x = Symbol('x')
846.     i1 = Interval(0, 1)
847.     i2 = Interval(2, 3)
848.     i3 = Union(i1, i2)
849.     assert i3.as_relational(x) == Or(And(S.Zero <= x, x <= 1), And(S(2) <= x, x <= 3))
850.     raises(TypeError, lambda: x in i3)
851.     e = i3.contains(x)
852.     assert e == i3.as_relational(x)
853.     assert e.subs(x, -0.5) is false
854.     assert e.subs(x, 0.5) is true
855.     assert e.subs(x, 1.5) is false
856.     assert e.subs(x, 2.5) is true
857.     assert e.subs(x, 3.5) is false
858. 
859.     U = Interval(0, 2, True, True) + Interval(10, oo) + FiniteSet(-1, 2, 5, 6)
860.     assert all(el not in U for el in [0, 4, -oo])
861.     assert all(el in U for el in [2, 5, 10])
862. 
863. 
864. def test_is_number():
865.     assert Interval(0, 1).is_number is False
866.     assert Set().is_number is False
867. 
868. 
869. def test_Interval_is_left_unbounded():
870.     assert Interval(3, 4).is_left_unbounded is False
871.     assert Interval(-oo, 3).is_left_unbounded is True
872.     assert Interval(Float("-inf"), 3).is_left_unbounded is True
873. 
874. 
875. def test_Interval_is_right_unbounded():
876.     assert Interval(3, 4).is_right_unbounded is False
877.     assert Interval(3, oo).is_right_unbounded is True
878.     assert Interval(3, Float("+inf")).is_right_unbounded is True
879. 
880. 
881. def test_Interval_as_relational():
882.     x = Symbol('x')
883. 
884.     assert Interval(-1, 2, False, False).as_relational(x) == \
885.         And(Le(-1, x), Le(x, 2))
886.     assert Interval(-1, 2, True, False).as_relational(x) == \
887.         And(Lt(-1, x), Le(x, 2))
888.     assert Interval(-1, 2, False, True).as_relational(x) == \
889.         And(Le(-1, x), Lt(x, 2))
890.     assert Interval(-1, 2, True, True).as_relational(x) == \
891.         And(Lt(-1, x), Lt(x, 2))
892. 
893.     assert Interval(-oo, 2, right_open=False).as_relational(x) == And(Lt(-oo, x), Le(x, 2))
894.     assert Interval(-oo, 2, right_open=True).as_relational(x) == And(Lt(-oo, x), Lt(x, 2))
895. 
896.     assert Interval(-2, oo, left_open=False).as_relational(x) == And(Le(-2, x), Lt(x, oo))
897.     assert Interval(-2, oo, left_open=True).as_relational(x) == And(Lt(-2, x), Lt(x, oo))
898. 
899.     assert Interval(-oo, oo).as_relational(x) == And(Lt(-oo, x), Lt(x, oo))
900.     x = Symbol('x', real=True)
901.     y = Symbol('y', real=True)
902.     assert Interval(x, y).as_relational(x) == (x <= y)
903.     assert Interval(y, x).as_relational(x) == (y <= x)
904. 
905. 
906. def test_Finite_as_relational():
907.     x = Symbol('x')
908.     y = Symbol('y')
909. 
910.     assert FiniteSet(1, 2).as_relational(x) == Or(Eq(x, 1), Eq(x, 2))
911.     assert FiniteSet(y, -5).as_relational(x) == Or(Eq(x, y), Eq(x, -5))
912. 
913. 
914. def test_Union_as_relational():
915.     x = Symbol('x')
916.     assert (Interval(0, 1) + FiniteSet(2)).as_relational(x) == \
917.         Or(And(Le(0, x), Le(x, 1)), Eq(x, 2))
918.     assert (Interval(0, 1, True, True) + FiniteSet(1)).as_relational(x) == \
919.         And(Lt(0, x), Le(x, 1))
920. 
921. 
922. def test_Intersection_as_relational():
923.     x = Symbol('x')
924.     assert (Intersection(Interval(0, 1), FiniteSet(2),
925.             evaluate=False).as_relational(x)
926.             == And(And(Le(0, x), Le(x, 1)), Eq(x, 2)))
927. 
928. 
929. def test_Complement_as_relational():
930.     x = Symbol('x')
931.     expr = Complement(Interval(0, 1), FiniteSet(2), evaluate=False)
932.     assert expr.as_relational(x) == \
933.         And(Le(0, x), Le(x, 1), Ne(x, 2))
934. 
935. 
936. @XFAIL
937. def test_Complement_as_relational_fail():
938.     x = Symbol('x')
939.     expr = Complement(Interval(0, 1), FiniteSet(2), evaluate=False)
940.     # XXX This example fails because 0 <= x changes to x >= 0
941.     # during the evaluation.
942.     assert expr.as_relational(x) == \
943.             (0 <= x) & (x <= 1) & Ne(x, 2)
944. 
945. 
946. def test_SymmetricDifference_as_relational():
947.     x = Symbol('x')
948.     expr = SymmetricDifference(Interval(0, 1), FiniteSet(2), evaluate=False)
949.     assert expr.as_relational(x) == Xor(Eq(x, 2), Le(0, x) & Le(x, 1))
950. 
951. 
952. def test_EmptySet():
953.     assert S.EmptySet.as_relational(Symbol('x')) is S.false
954.     assert S.EmptySet.intersect(S.UniversalSet) == S.EmptySet
955.     assert S.EmptySet.boundary == S.EmptySet
956. 
957. 
958. def test_finite_basic():
959.     x = Symbol('x')
960.     A = FiniteSet(1, 2, 3)
961.     B = FiniteSet(3, 4, 5)
962.     AorB = Union(A, B)
963.     AandB = A.intersect(B)
964.     assert A.is_subset(AorB) and B.is_subset(AorB)
965.     assert AandB.is_subset(A)
966.     assert AandB == FiniteSet(3)
967. 
968.     assert A.inf == 1 and A.sup == 3
969.     assert AorB.inf == 1 and AorB.sup == 5
970.     assert FiniteSet(x, 1, 5).sup == Max(x, 5)
971.     assert FiniteSet(x, 1, 5).inf == Min(x, 1)
972. 
973.     # issue 7335
974.     assert FiniteSet(S.EmptySet) != S.EmptySet
975.     assert FiniteSet(FiniteSet(1, 2, 3)) != FiniteSet(1, 2, 3)
976.     assert FiniteSet((1, 2, 3)) != FiniteSet(1, 2, 3)
977. 
978.     # Ensure a variety of types can exist in a FiniteSet
979.     assert FiniteSet((1, 2), Float, A, -5, x, 'eggs', x**2, Interval)
980. 
981.     assert (A > B) is False
982.     assert (A >= B) is False
983.     assert (A < B) is False
984.     assert (A <= B) is False
985.     assert AorB > A and AorB > B
986.     assert AorB >= A and AorB >= B
987.     assert A >= A and A <= A
988.     assert A >= AandB and B >= AandB
989.     assert A > AandB and B > AandB
990. 
991.     assert FiniteSet(1.0) == FiniteSet(1)
992. 
993. 
994. def test_product_basic():
995.     H, T = 'H', 'T'
996.     unit_line = Interval(0, 1)
997.     d6 = FiniteSet(1, 2, 3, 4, 5, 6)
998.     d4 = FiniteSet(1, 2, 3, 4)
999.     coin = FiniteSet(H, T)
1000. 
1001.     square = unit_line * unit_line
1002. 
1003.     assert (0, 0) in square
1004.     assert 0 not in square
1005.     assert (H, T) in coin ** 2
1006.     assert (.5, .5, .5) in (square * unit_line).flatten()
1007.     assert ((.5, .5), .5) in square * unit_line
1008.     assert (H, 3, 3) in (coin * d6 * d6).flatten()
1009.     assert ((H, 3), 3) in coin * d6 * d6
1010.     HH, TT = sympify(H), sympify(T)
1011.     assert set(coin**2) == {(HH, HH), (HH, TT), (TT, HH), (TT, TT)}
1012. 
1013.     assert (d4*d4).is_subset(d6*d6)
1014. 
1015.     assert square.complement(Interval(-oo, oo)*Interval(-oo, oo)) == Union(
1016.         (Interval(-oo, 0, True, True) +
1017.          Interval(1, oo, True, True))*Interval(-oo, oo),
1018.          Interval(-oo, oo)*(Interval(-oo, 0, True, True) +
1019.                   Interval(1, oo, True, True)))
1020. 
1021.     assert (Interval(-5, 5)**3).is_subset(Interval(-10, 10)**3)
1022.     assert not (Interval(-10, 10)**3).is_subset(Interval(-5, 5)**3)
1023.     assert not (Interval(-5, 5)**2).is_subset(Interval(-10, 10)**3)
1024. 
1025.     assert (Interval(.2, .5)*FiniteSet(.5)).is_subset(square)  # segment in square
1026. 
1027.     assert len(coin*coin*coin) == 8
1028.     assert len(S.EmptySet*S.EmptySet) == 0
1029.     assert len(S.EmptySet*coin) == 0
1030.     raises(TypeError, lambda: len(coin*Interval(0, 2)))
1031. 
1032. 
1033. def test_real():
1034.     x = Symbol('x', real=True, finite=True)
1035. 
1036.     I = Interval(0, 5)
1037.     J = Interval(10, 20)
1038.     A = FiniteSet(1, 2, 30, x, S.Pi)
1039.     B = FiniteSet(-4, 0)
1040.     C = FiniteSet(100)
1041.     D = FiniteSet('Ham', 'Eggs')
1042. 
1043.     assert all(s.is_subset(S.Reals) for s in [I, J, A, B, C])
1044.     assert not D.is_subset(S.Reals)
1045.     assert all((a + b).is_subset(S.Reals) for a in [I, J, A, B, C] for b in [I, J, A, B, C])
1046.     assert not any((a + D).is_subset(S.Reals) for a in [I, J, A, B, C, D])
1047. 
1048.     assert not (I + A + D).is_subset(S.Reals)
1049. 
1050. 
1051. def test_supinf():
1052.     x = Symbol('x', real=True)
1053.     y = Symbol('y', real=True)
1054. 
1055.     assert (Interval(0, 1) + FiniteSet(2)).sup == 2
1056.     assert (Interval(0, 1) + FiniteSet(2)).inf == 0
1057.     assert (Interval(0, 1) + FiniteSet(x)).sup == Max(1, x)
1058.     assert (Interval(0, 1) + FiniteSet(x)).inf == Min(0, x)
1059.     assert FiniteSet(5, 1, x).sup == Max(5, x)
1060.     assert FiniteSet(5, 1, x).inf == Min(1, x)
1061.     assert FiniteSet(5, 1, x, y).sup == Max(5, x, y)
1062.     assert FiniteSet(5, 1, x, y).inf == Min(1, x, y)
1063.     assert FiniteSet(5, 1, x, y, S.Infinity, S.NegativeInfinity).sup == \
1064.         S.Infinity
1065.     assert FiniteSet(5, 1, x, y, S.Infinity, S.NegativeInfinity).inf == \
1066.         S.NegativeInfinity
1067.     assert FiniteSet('Ham', 'Eggs').sup == Max('Ham', 'Eggs')
1068. 
1069. 
1070. def test_universalset():
1071.     U = S.UniversalSet
1072.     x = Symbol('x')
1073.     assert U.as_relational(x) is S.true
1074.     assert U.union(Interval(2, 4)) == U
1075. 
1076.     assert U.intersect(Interval(2, 4)) == Interval(2, 4)
1077.     assert U.measure is S.Infinity
1078.     assert U.boundary == S.EmptySet
1079.     assert U.contains(0) is S.true
1080. 
1081. 
1082. def test_Union_of_ProductSets_shares():
1083.     line = Interval(0, 2)
1084.     points = FiniteSet(0, 1, 2)
1085.     assert Union(line * line, line * points) == line * line
1086. 
1087. 
1088. def test_Interval_free_symbols():
1089.     # issue 6211
1090.     assert Interval(0, 1).free_symbols == set()
1091.     x = Symbol('x', real=True)
1092.     assert Interval(0, x).free_symbols == {x}
1093. 
1094. 
1095. def test_image_interval():
1096.     from sympy.core.numbers import Rational
1097.     x = Symbol('x', real=True)
1098.     a = Symbol('a', real=True)
1099.     assert imageset(x, 2*x, Interval(-2, 1)) == Interval(-4, 2)
1100.     assert imageset(x, 2*x, Interval(-2, 1, True, False)) == \
1101.         Interval(-4, 2, True, False)
1102.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1103.         Interval(0, 4, False, True)
1104.     assert imageset(x, x**2, Interval(-2, 1)) == Interval(0, 4)
1105.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1106.         Interval(0, 4, False, True)
1107.     assert imageset(x, x**2, Interval(-2, 1, True, True)) == \
1108.         Interval(0, 4, False, True)
1109.     assert imageset(x, (x - 2)**2, Interval(1, 3)) == Interval(0, 1)
1110.     assert imageset(x, 3*x**4 - 26*x**3 + 78*x**2 - 90*x, Interval(0, 4)) == \
1111.         Interval(-35, 0)  # Multiple Maxima
1112.     assert imageset(x, x + 1/x, Interval(-oo, oo)) == Interval(-oo, -2) \
1113.         + Interval(2, oo)  # Single Infinite discontinuity
1114.     assert imageset(x, 1/x + 1/(x-1)**2, Interval(0, 2, True, False)) == \
1115.         Interval(Rational(3, 2), oo, False)  # Multiple Infinite discontinuities
1116. 
1117.     # Test for Python lambda
1118.     assert imageset(lambda x: 2*x, Interval(-2, 1)) == Interval(-4, 2)
1119. 
1120.     assert imageset(Lambda(x, a*x), Interval(0, 1)) == \
1121.             ImageSet(Lambda(x, a*x), Interval(0, 1))
1122. 
1123.     assert imageset(Lambda(x, sin(cos(x))), Interval(0, 1)) == \
1124.             ImageSet(Lambda(x, sin(cos(x))), Interval(0, 1))
1125. 
1126. 
1127. def test_image_piecewise():
1128.     f = Piecewise((x, x <= -1), (1/x**2, x <= 5), (x**3, True))
1129.     f1 = Piecewise((0, x <= 1), (1, x <= 2), (2, True))
1130.     assert imageset(x, f, Interval(-5, 5)) == Union(Interval(-5, -1), Interval(Rational(1, 25), oo))
1131.     assert imageset(x, f1, Interval(1, 2)) == FiniteSet(0, 1)
1132. 
1133. 
1134. @XFAIL  # See: https://github.com/sympy/sympy/pull/2723#discussion_r8659826
1135. def test_image_Intersection():
1136.     x = Symbol('x', real=True)
1137.     y = Symbol('y', real=True)
1138.     assert imageset(x, x**2, Interval(-2, 0).intersect(Interval(x, y))) == \
1139.            Interval(0, 4).intersect(Interval(Min(x**2, y**2), Max(x**2, y**2)))
1140. 
1141. 
1142. def test_image_FiniteSet():
1143.     x = Symbol('x', real=True)
1144.     assert imageset(x, 2*x, FiniteSet(1, 2, 3)) == FiniteSet(2, 4, 6)
1145. 
1146. 
1147. def test_image_Union():
1148.     x = Symbol('x', real=True)
1149.     assert imageset(x, x**2, Interval(-2, 0) + FiniteSet(1, 2, 3)) == \
1150.             (Interval(0, 4) + FiniteSet(9))
1151. 
1152. 
1153. def test_image_EmptySet():
1154.     x = Symbol('x', real=True)
1155.     assert imageset(x, 2*x, S.EmptySet) == S.EmptySet
1156. 
1157. 
1158. def test_issue_5724_7680():
1159.     assert I not in S.Reals  # issue 7680
1160.     assert Interval(-oo, oo).contains(I) is S.false
1161. 
1162. 
1163. def test_boundary():
1164.     assert FiniteSet(1).boundary == FiniteSet(1)
1165.     assert all(Interval(0, 1, left_open, right_open).boundary == FiniteSet(0, 1)
1166.             for left_open in (true, false) for right_open in (true, false))
1167. 
1168. 
1169. def test_boundary_Union():
1170.     assert (Interval(0, 1) + Interval(2, 3)).boundary == FiniteSet(0, 1, 2, 3)
1171.     assert ((Interval(0, 1, False, True)
1172.            + Interval(1, 2, True, False)).boundary == FiniteSet(0, 1, 2))
1173. 
1174.     assert (Interval(0, 1) + FiniteSet(2)).boundary == FiniteSet(0, 1, 2)
1175.     assert Union(Interval(0, 10), Interval(5, 15), evaluate=False).boundary \
1176.             == FiniteSet(0, 15)
1177. 
1178.     assert Union(Interval(0, 10), Interval(0, 1), evaluate=False).boundary \
1179.             == FiniteSet(0, 10)
1180.     assert Union(Interval(0, 10, True, True),
1181.                  Interval(10, 15, True, True), evaluate=False).boundary \
1182.             == FiniteSet(0, 10, 15)
1183. 
1184. 
1185. @XFAIL
1186. def test_union_boundary_of_joining_sets():
1187.     """ Testing the boundary of unions is a hard problem """
1188.     assert Union(Interval(0, 10), Interval(10, 15), evaluate=False).boundary \
1189.             == FiniteSet(0, 15)
1190. 
1191. 
1192. def test_boundary_ProductSet():
1193.     open_square = Interval(0, 1, True, True) ** 2
1194.     assert open_square.boundary == (FiniteSet(0, 1) * Interval(0, 1)
1195.                                   + Interval(0, 1) * FiniteSet(0, 1))
1196. 
1197.     second_square = Interval(1, 2, True, True) * Interval(0, 1, True, True)
1198.     assert (open_square + second_square).boundary == (
1199.                 FiniteSet(0, 1) * Interval(0, 1)
1200.               + FiniteSet(1, 2) * Interval(0, 1)
1201.               + Interval(0, 1) * FiniteSet(0, 1)
1202.               + Interval(1, 2) * FiniteSet(0, 1))
1203. 
1204. 
1205. def test_boundary_ProductSet_line():
1206.     line_in_r2 = Interval(0, 1) * FiniteSet(0)
1207.     assert line_in_r2.boundary == line_in_r2
1208. 
1209. 
1210. def test_is_open():
1211.     assert Interval(0, 1, False, False).is_open is False
1212.     assert Interval(0, 1, True, False).is_open is False
1213.     assert Interval(0, 1, True, True).is_open is True
1214.     assert FiniteSet(1, 2, 3).is_open is False
1215. 
1216. 
1217. def test_is_closed():
1218.     assert Interval(0, 1, False, False).is_closed is True
1219.     assert Interval(0, 1, True, False).is_closed is False
1220.     assert FiniteSet(1, 2, 3).is_closed is True
1221. 
1222. 
1223. def test_closure():
1224.     assert Interval(0, 1, False, True).closure == Interval(0, 1, False, False)
1225. 
1226. 
1227. def test_interior():
1228.     assert Interval(0, 1, False, True).interior == Interval(0, 1, True, True)
1229. 
1230. 
1231. def test_issue_7841():
1232.     raises(TypeError, lambda: x in S.Reals)
1233. 
1234. 
1235. def test_Eq():
1236.     assert Eq(Interval(0, 1), Interval(0, 1))
1237.     assert Eq(Interval(0, 1), Interval(0, 2)) == False
1238. 
1239.     s1 = FiniteSet(0, 1)
1240.     s2 = FiniteSet(1, 2)
1241. 
1242.     assert Eq(s1, s1)
1243.     assert Eq(s1, s2) == False
1244. 
1245.     assert Eq(s1*s2, s1*s2)
1246.     assert Eq(s1*s2, s2*s1) == False
1247. 
1248.     assert unchanged(Eq, FiniteSet({x, y}), FiniteSet({x}))
1249.     assert Eq(FiniteSet({x, y}).subs(y, x), FiniteSet({x})) is S.true
1250.     assert Eq(FiniteSet({x, y}), FiniteSet({x})).subs(y, x) is S.true
1251.     assert Eq(FiniteSet({x, y}).subs(y, x+1), FiniteSet({x})) is S.false
1252.     assert Eq(FiniteSet({x, y}), FiniteSet({x})).subs(y, x+1) is S.false
1253. 
1254.     assert Eq(ProductSet({1}, {2}), Interval(1, 2)) not in (S.true, S.false)
1255.     assert Eq(ProductSet({1}), ProductSet({1}, {2})) is S.false
1256. 
1257.     assert Eq(FiniteSet(()), FiniteSet(1)) is S.false
1258.     assert Eq(ProductSet(), FiniteSet(1)) is S.false
1259. 
1260.     i1 = Interval(0, 1)
1261.     i2 = Interval(x, y)
1262.     assert unchanged(Eq, ProductSet(i1, i1), ProductSet(i2, i2))
1263. 
1264. 
1265. def test_SymmetricDifference():
1266.     A = FiniteSet(0, 1, 2, 3, 4, 5)
1267.     B = FiniteSet(2, 4, 6, 8, 10)
1268.     C = Interval(8, 10)
1269. 
1270.     assert SymmetricDifference(A, B, evaluate=False).is_iterable is True
1271.     assert SymmetricDifference(A, C, evaluate=False).is_iterable is None
1272.     assert FiniteSet(*SymmetricDifference(A, B, evaluate=False)) == \
1273.         FiniteSet(0, 1, 3, 5, 6, 8, 10)
1274.     raises(TypeError,
1275.         lambda: FiniteSet(*SymmetricDifference(A, C, evaluate=False)))
1276. 
1277.     assert SymmetricDifference(FiniteSet(0, 1, 2, 3, 4, 5), \
1278.             FiniteSet(2, 4, 6, 8, 10)) == FiniteSet(0, 1, 3, 5, 6, 8, 10)
1279.     assert SymmetricDifference(FiniteSet(2, 3, 4), FiniteSet(2, 3 , 4 , 5)) \
1280.             == FiniteSet(5)
1281.     assert FiniteSet(1, 2, 3, 4, 5) ^ FiniteSet(1, 2, 5, 6) == \
1282.             FiniteSet(3, 4, 6)
1283.     assert Set(1, 2 , 3) ^ Set(2, 3, 4) == Union(Set(1, 2, 3) - Set(2, 3, 4), \
1284.             Set(2, 3, 4) - Set(1, 2, 3))
1285.     assert Interval(0, 4) ^ Interval(2, 5) == Union(Interval(0, 4) - \
1286.             Interval(2, 5), Interval(2, 5) - Interval(0, 4))
1287. 
1288. 
1289. def test_issue_9536():
1290.     from sympy.functions.elementary.exponential import log
1291.     a = Symbol('a', real=True)
1292.     assert FiniteSet(log(a)).intersect(S.Reals) == Intersection(S.Reals, FiniteSet(log(a)))
1293. 
1294. 
1295. def test_issue_9637():
1296.     n = Symbol('n')
1297.     a = FiniteSet(n)
1298.     b = FiniteSet(2, n)
1299.     assert Complement(S.Reals, a) == Complement(S.Reals, a, evaluate=False)
1300.     assert Complement(Interval(1, 3), a) == Complement(Interval(1, 3), a, evaluate=False)
1301.     assert Complement(Interval(1, 3), b) == \
1302.         Complement(Union(Interval(1, 2, False, True), Interval(2, 3, True, False)), a)
1303.     assert Complement(a, S.Reals) == Complement(a, S.Reals, evaluate=False)
1304.     assert Complement(a, Interval(1, 3)) == Complement(a, Interval(1, 3), evaluate=False)
1305. 
1306. 
1307. def test_issue_9808():
1308.     # See https://github.com/sympy/sympy/issues/16342
1309.     assert Complement(FiniteSet(y), FiniteSet(1)) == Complement(FiniteSet(y), FiniteSet(1), evaluate=False)
1310.     assert Complement(FiniteSet(1, 2, x), FiniteSet(x, y, 2, 3)) == \
1311.         Complement(FiniteSet(1), FiniteSet(y), evaluate=False)
1312. 
1313. 
1314. def test_issue_9956():
1315.     assert Union(Interval(-oo, oo), FiniteSet(1)) == Interval(-oo, oo)
1316.     assert Interval(-oo, oo).contains(1) is S.true
1317. 
1318. 
1319. def test_issue_Symbol_inter():
1320.     i = Interval(0, oo)
1321.     r = S.Reals
1322.     mat = Matrix([0, 0, 0])
1323.     assert Intersection(r, i, FiniteSet(m), FiniteSet(m, n)) == \
1324.         Intersection(i, FiniteSet(m))
1325.     assert Intersection(FiniteSet(1, m, n), FiniteSet(m, n, 2), i) == \
1326.         Intersection(i, FiniteSet(m, n))
1327.     assert Intersection(FiniteSet(m, n, x), FiniteSet(m, z), r) == \
1328.         Intersection(Intersection({m, z}, {m, n, x}), r)
1329.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, x), r) == \
1330.         Intersection(FiniteSet(3, m, n), FiniteSet(m, n, x), r, evaluate=False)
1331.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, 2, 3), r) == \
1332.         Intersection(FiniteSet(3, m, n), r)
1333.     assert Intersection(r, FiniteSet(mat, 2, n), FiniteSet(0, mat, n)) == \
1334.         Intersection(r, FiniteSet(n))
1335.     assert Intersection(FiniteSet(sin(x), cos(x)), FiniteSet(sin(x), cos(x), 1), r) == \
1336.         Intersection(r, FiniteSet(sin(x), cos(x)))
1337.     assert Intersection(FiniteSet(x**2, 1, sin(x)), FiniteSet(x**2, 2, sin(x)), r) == \
1338.         Intersection(r, FiniteSet(x**2, sin(x)))
1339. 
1340. 
1341. def test_issue_11827():
1342.     assert S.Naturals0**4
1343. 
1344. 
1345. def test_issue_10113():
1346.     f = x**2/(x**2 - 4)
1347.     assert imageset(x, f, S.Reals) == Union(Interval(-oo, 0), Interval(1, oo, True, True))
1348.     assert imageset(x, f, Interval(-2, 2)) == Interval(-oo, 0)
1349.     assert imageset(x, f, Interval(-2, 3)) == Union(Interval(-oo, 0), Interval(Rational(9, 5), oo))
1350. 
1351. 
1352. def test_issue_10248():
1353.     raises(
1354.         TypeError, lambda: list(Intersection(S.Reals, FiniteSet(x)))
1355.     )
1356.     A = Symbol('A', real=True)
1357.     assert list(Intersection(S.Reals, FiniteSet(A))) == [A]
1358. 
1359. 
1360. def test_issue_9447():
1361.     a = Interval(0, 1) + Interval(2, 3)
1362.     assert Complement(S.UniversalSet, a) == Complement(
1363.             S.UniversalSet, Union(Interval(0, 1), Interval(2, 3)), evaluate=False)
1364.     assert Complement(S.Naturals, a) == Complement(
1365.             S.Naturals, Union(Interval(0, 1), Interval(2, 3)), evaluate=False)
1366. 
1367. 
1368. def test_issue_10337():
1369.     assert (FiniteSet(2) == 3) is False
1370.     assert (FiniteSet(2) != 3) is True
1371.     raises(TypeError, lambda: FiniteSet(2) < 3)
1372.     raises(TypeError, lambda: FiniteSet(2) <= 3)
1373.     raises(TypeError, lambda: FiniteSet(2) > 3)
1374.     raises(TypeError, lambda: FiniteSet(2) >= 3)
1375. 
1376. 
1377. def test_issue_10326():
1378.     bad = [
1379.         EmptySet,
1380.         FiniteSet(1),
1381.         Interval(1, 2),
1382.         S.ComplexInfinity,
1383.         S.ImaginaryUnit,
1384.         S.Infinity,
1385.         S.NaN,
1386.         S.NegativeInfinity,
1387.         ]
1388.     interval = Interval(0, 5)
1389.     for i in bad:
1390.         assert i not in interval
1391. 
1392.     x = Symbol('x', real=True)
1393.     nr = Symbol('nr', extended_real=False)
1394.     assert x + 1 in Interval(x, x + 4)
1395.     assert nr not in Interval(x, x + 4)
1396.     assert Interval(1, 2) in FiniteSet(Interval(0, 5), Interval(1, 2))
1397.     assert Interval(-oo, oo).contains(oo) is S.false
1398.     assert Interval(-oo, oo).contains(-oo) is S.false
1399. 
1400. 
1401. def test_issue_2799():
1402.     U = S.UniversalSet
1403.     a = Symbol('a', real=True)
1404.     inf_interval = Interval(a, oo)
1405.     R = S.Reals
1406. 
1407.     assert U + inf_interval == inf_interval + U
1408.     assert U + R == R + U
1409.     assert R + inf_interval == inf_interval + R
1410. 
1411. 
1412. def test_issue_9706():
1413.     assert Interval(-oo, 0).closure == Interval(-oo, 0, True, False)
1414.     assert Interval(0, oo).closure == Interval(0, oo, False, True)
1415.     assert Interval(-oo, oo).closure == Interval(-oo, oo)
1416. 
1417. 
1418. def test_issue_8257():
1419.     reals_plus_infinity = Union(Interval(-oo, oo), FiniteSet(oo))
1420.     reals_plus_negativeinfinity = Union(Interval(-oo, oo), FiniteSet(-oo))
1421.     assert Interval(-oo, oo) + FiniteSet(oo) == reals_plus_infinity
1422.     assert FiniteSet(oo) + Interval(-oo, oo) == reals_plus_infinity
1423.     assert Interval(-oo, oo) + FiniteSet(-oo) == reals_plus_negativeinfinity
1424.     assert FiniteSet(-oo) + Interval(-oo, oo) == reals_plus_negativeinfinity
1425. 
1426. 
1427. def test_issue_10931():
1428.     assert S.Integers - S.Integers == EmptySet
1429.     assert S.Integers - S.Reals == EmptySet
1430. 
1431. 
1432. def test_issue_11174():
1433.     soln = Intersection(Interval(-oo, oo), FiniteSet(-x), evaluate=False)
1434.     assert Intersection(FiniteSet(-x), S.Reals) == soln
1435. 
1436.     soln = Intersection(S.Reals, FiniteSet(x), evaluate=False)
1437.     assert Intersection(FiniteSet(x), S.Reals) == soln
1438. 
1439. 
1440. def test_issue_18505():
1441.     assert ImageSet(Lambda(n, sqrt(pi*n/2 - 1 + pi/2)), S.Integers).contains(0) == \
1442.             Contains(0, ImageSet(Lambda(n, sqrt(pi*n/2 - 1 + pi/2)), S.Integers))
1443. 
1444. 
1445. def test_finite_set_intersection():
1446.     # The following should not produce recursion errors
1447.     # Note: some of these are not completely correct. See
1448.     # https://github.com/sympy/sympy/issues/16342.
1449.     assert Intersection(FiniteSet(-oo, x), FiniteSet(x)) == FiniteSet(x)
1450.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(0, x)]) == FiniteSet(x)
1451. 
1452.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(x)]) == FiniteSet(x)
1453.     assert Intersection._handle_finite_sets([FiniteSet(2, 3, x, y), FiniteSet(1, 2, x)]) == \
1454.         Intersection._handle_finite_sets([FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)]) == \
1455.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)) == \
1456.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, x, y))
1457. 
1458.     assert FiniteSet(1+x-y) & FiniteSet(1) == \
1459.         FiniteSet(1) & FiniteSet(1+x-y) == \
1460.         Intersection(FiniteSet(1+x-y), FiniteSet(1), evaluate=False)
1461. 
1462.     assert FiniteSet(1) & FiniteSet(x) == FiniteSet(x) & FiniteSet(1) == \
1463.         Intersection(FiniteSet(1), FiniteSet(x), evaluate=False)
1464. 
1465.     assert FiniteSet({x}) & FiniteSet({x, y}) == \
1466.         Intersection(FiniteSet({x}), FiniteSet({x, y}), evaluate=False)
1467. 
1468. 
1469. def test_union_intersection_constructor():
1470.     # The actual exception does not matter here, so long as these fail
1471.     sets = [FiniteSet(1), FiniteSet(2)]
1472.     raises(Exception, lambda: Union(sets))
1473.     raises(Exception, lambda: Intersection(sets))
1474.     raises(Exception, lambda: Union(tuple(sets)))
1475.     raises(Exception, lambda: Intersection(tuple(sets)))
1476.     raises(Exception, lambda: Union(i for i in sets))
1477.     raises(Exception, lambda: Intersection(i for i in sets))
1478. 
1479.     # Python sets are treated the same as FiniteSet
1480.     # The union of a single set (of sets) is the set (of sets) itself
1481.     assert Union(set(sets)) == FiniteSet(*sets)
1482.     assert Intersection(set(sets)) == FiniteSet(*sets)
1483. 
1484.     assert Union({1}, {2}) == FiniteSet(1, 2)
1485.     assert Intersection({1, 2}, {2, 3}) == FiniteSet(2)
1486. 
1487. 
1488. def test_Union_contains():
1489.     assert zoo not in Union(
1490.         Interval.open(-oo, 0), Interval.open(0, oo))
1491. 
1492. 
1493. @XFAIL
1494. def test_issue_16878b():
1495.     # in intersection_sets for (ImageSet, Set) there is no code
1496.     # that handles the base_set of S.Reals like there is
1497.     # for Integers
1498.     assert imageset(x, (x, x), S.Reals).is_subset(S.Reals**2) is True
1499. 
1500. def test_DisjointUnion():
1501.     assert DisjointUnion(FiniteSet(1, 2, 3), FiniteSet(1, 2, 3), FiniteSet(1, 2, 3)).rewrite(Union) == (FiniteSet(1, 2, 3) * FiniteSet(0, 1, 2))
1502.     assert DisjointUnion(Interval(1, 3), Interval(2, 4)).rewrite(Union) == Union(Interval(1, 3) * FiniteSet(0), Interval(2, 4) * FiniteSet(1))
1503.     assert DisjointUnion(Interval(0, 5), Interval(0, 5)).rewrite(Union) == Union(Interval(0, 5) * FiniteSet(0), Interval(0, 5) * FiniteSet(1))
1504.     assert DisjointUnion(Interval(-1, 2), S.EmptySet, S.EmptySet).rewrite(Union) == Interval(-1, 2) * FiniteSet(0)
1505.     assert DisjointUnion(Interval(-1, 2)).rewrite(Union) == Interval(-1, 2) * FiniteSet(0)
1506.     assert DisjointUnion(S.EmptySet, Interval(-1, 2), S.EmptySet).rewrite(Union) == Interval(-1, 2) * FiniteSet(1)
1507.     assert DisjointUnion(Interval(-oo, oo)).rewrite(Union) == Interval(-oo, oo) * FiniteSet(0)
1508.     assert DisjointUnion(S.EmptySet).rewrite(Union) == S.EmptySet
1509.     assert DisjointUnion().rewrite(Union) == S.EmptySet
1510.     raises(TypeError, lambda: DisjointUnion(Symbol('n')))
1511. 
1512.     x = Symbol("x")
1513.     y = Symbol("y")
1514.     z = Symbol("z")
1515.     assert DisjointUnion(FiniteSet(x), FiniteSet(y, z)).rewrite(Union) == (FiniteSet(x) * FiniteSet(0)) + (FiniteSet(y, z) * FiniteSet(1))
1516. 
1517. def test_DisjointUnion_is_empty():
1518.     assert DisjointUnion(S.EmptySet).is_empty is True
1519.     assert DisjointUnion(S.EmptySet, S.EmptySet).is_empty is True
1520.     assert DisjointUnion(S.EmptySet, FiniteSet(1, 2, 3)).is_empty is False
1521. 
1522. def test_DisjointUnion_is_iterable():
1523.     assert DisjointUnion(S.Integers, S.Naturals, S.Rationals).is_iterable is True
1524.     assert DisjointUnion(S.EmptySet, S.Reals).is_iterable is False
1525.     assert DisjointUnion(FiniteSet(1, 2, 3), S.EmptySet, FiniteSet(x, y)).is_iterable is True
1526.     assert DisjointUnion(S.EmptySet, S.EmptySet).is_iterable is False
1527. 
1528. def test_DisjointUnion_contains():
1529.     assert (0, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1530.     assert (0, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1531.     assert (0, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1532.     assert (1, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1533.     assert (1, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1534.     assert (1, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1535.     assert (2, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1536.     assert (2, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1537.     assert (2, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1538.     assert (0, 1, 2) not in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1539.     assert (0, 0.5) not in DisjointUnion(FiniteSet(0.5))
1540.     assert (0, 5) not in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1541.     assert (x, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1542.     assert (y, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1543.     assert (z, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1544.     assert (y, 2) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1545.     assert (0.5, 0) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1546.     assert (0.5, 1) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1547.     assert (1.5, 0) not in DisjointUnion(Interval(0, 1), Interval(0, 2))
1548.     assert (1.5, 1) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1549. 
1550. def test_DisjointUnion_iter():
1551.     D = DisjointUnion(FiniteSet(3, 5, 7, 9), FiniteSet(x, y, z))
1552.     it = iter(D)
1553.     L1 = [(x, 1), (y, 1), (z, 1)]
1554.     L2 = [(3, 0), (5, 0), (7, 0), (9, 0)]
1555.     nxt = next(it)
1556.     assert nxt in L2
1557.     L2.remove(nxt)
1558.     nxt = next(it)
1559.     assert nxt in L1
1560.     L1.remove(nxt)
1561.     nxt = next(it)
1562.     assert nxt in L2
1563.     L2.remove(nxt)
1564.     nxt = next(it)
1565.     assert nxt in L1
1566.     L1.remove(nxt)
1567.     nxt = next(it)
1568.     assert nxt in L2
1569.     L2.remove(nxt)
1570.     nxt = next(it)
1571.     assert nxt in L1
1572.     L1.remove(nxt)
1573.     nxt = next(it)
1574.     assert nxt in L2
1575.     L2.remove(nxt)
1576.     raises(StopIteration, lambda: next(it))
1577. 
1578.     raises(ValueError, lambda: iter(DisjointUnion(Interval(0, 1), S.EmptySet)))
1579. 
1580. def test_DisjointUnion_len():
1581.     assert len(DisjointUnion(FiniteSet(3, 5, 7, 9), FiniteSet(x, y, z))) == 7
1582.     assert len(DisjointUnion(S.EmptySet, S.EmptySet, FiniteSet(x, y, z), S.EmptySet)) == 3
1583.     raises(ValueError, lambda: len(DisjointUnion(Interval(0, 1), S.EmptySet)))
1584. 
1585. def test_issue_20089():
1586.     B = FiniteSet(FiniteSet(1, 2), FiniteSet(1))
1587.     assert not 1 in B
1588.     assert not 1.0 in B
1589.     assert not Eq(1, FiniteSet(1, 2))
1590.     assert FiniteSet(1) in B
1591.     A = FiniteSet(1, 2)
1592.     assert A in B
1593.     assert B.issubset(B)
1594.     assert not A.issubset(B)
1595.     assert 1 in A
1596.     C = FiniteSet(FiniteSet(1, 2), FiniteSet(1), 1, 2)
1597.     assert A.issubset(C)
1598.     assert B.issubset(C)
1599. 
1600. def test_issue_20379():
1601.     #https://github.com/sympy/sympy/issues/20379
1602.     x = pi - 3.14159265358979
1603.     assert FiniteSet(x).evalf(2) == FiniteSet(Float('3.23108914886517e-15', 2))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-20 22:26:33,620 - thread-126738778556096.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='I have analyzed the provided test file `sympy/sets/tests/test_sets.py` and found three relevant test functions (`test_product_basic`, `test_Eq`, and `test_is_subset`) that cover `is_subset` and `Eq` functionalities for `ProductSet` and other set types. This is sufficient to extract the most relevant existing test cases that demonstrate similar functionality to what is described in the bug report. Therefore, no additional context is needed.' query='' extra_requirements='' purpose=''
2025-12-20 22:26:33,621 - thread-126738778556096.prometheus_context_collector - INFO - Successfully retrieved 2 context snippets
