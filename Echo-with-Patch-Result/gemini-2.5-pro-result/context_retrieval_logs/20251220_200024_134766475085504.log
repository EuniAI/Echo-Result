2025-12-20 20:00:24,059 - thread-134766475085504.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: [Bug]: ConciseDateFormatter not showing year anywhere when plotting <12 months

Description: ### Bug summary

When I plot < 1 year and January is not included in the x-axis, the year doesn't show up anywhere.
This bug is different from bug #21670 (fixed in #21785).

### Code for reproduction

```python
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
from datetime import datetime, timedelta

#create time array
initial = datetime(2021,2,14,0,0,0)
time_array = [initial + timedelta(days=x) for x in range(1,200)]

#create data array
data = [-x**2/20000 for x in range(1,200)]


#plot data
fig,ax = plt.subplots()
ax.plot(time_array,data) 
        
locator = mdates.AutoDateLocator()
formatter = mdates.ConciseDateFormatter(locator)

ax.grid(True)
ax.set_ylabel("Temperature ($\degree$C)")
ax.xaxis.set_major_locator(locator)   
ax.xaxis.set_major_formatter(formatter)
fig.autofmt_xdate() #automatically makes the x-labels rotate
```


### Actual outcome

![image](https://user-images.githubusercontent.com/15143365/154090257-c7813f1c-f9ea-4252-86bf-f84e449c2f46.png)


### Expected outcome

I expect the year "2021" to show in the offset, to the right of the x-axis

### Additional information

I'm using Spyder IDE, v5.1.5

### Operating system

Windows 10

### Matplotlib Version

3.4.3

### Matplotlib Backend

Qt5Agg

### Python version

3.9.1

### Jupyter version

_No response_

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/dates.py b/lib/matplotlib/dates.py
index 4d8ddf3ee5..0ee2287519 100644
--- a/lib/matplotlib/dates.py
+++ b/lib/matplotlib/dates.py
@@ -797,14 +797,24 @@ class ConciseDateFormatter(ticker.Formatter):
         # 3: hours, 4: minutes, 5: seconds, 6: microseconds
         for level in range(5, -1, -1):
             if len(np.unique(tickdate[:, level])) > 1:
-                if level < 2:
-                    show_offset = False
                 break
             elif level == 0:
                 # all tickdate are the same, so only micros might be different
                 # set to the most precise (6: microseconds doesn't exist...)
                 level = 5
 
+        # Decide whether to show the offset based on the determined level.
+        # For yearly labels, offset is redundant.
+        if level == 0:
+            show_offset = False
+        elif level == 1:
+            # For monthly labels, only suppress the offset if a January tick
+            # exists (zero-format will provide the year on that tick).
+            # If January is absent, keep the offset (typically showing the year)
+            # to ensure the axis conveys full date context.
+            if np.any(tickdate[:, 1] == 1):
+                show_offset = False
+
         # level is the basic level we will label at.
         # now loop through and decide the actual ticklabels
         zerovals = [0, 1, 1, 0, 0, 0, 0]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-20 20:00:24,132 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   └── check_wheel_licenses.py
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   └── 22691-JMK.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       └── 22738-JL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.5.0.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   └── whats_new_3.5.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── frontpage
|   |   ├── 3D.py
|   |   ├── README.txt
|   |   ├── contour_frontpage.py
|   |   ├── histogram.py
|   |   └── membrane.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── cursor_demo.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── log_test.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc_sgskip.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── inset_locator.py
|   |   |   └── parasite_axes.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _contour.cpp
|   ├── _contour_wrapper.cpp
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: ConciseDateFormatter not showing year anywhere when plotting <12 months

Description: ### Bug summary

When I plot < 1 year and January is not included in the x-axis, the year doesn't show up anywhere.
This bug is different from bug #21670 (fixed in #21785).

### Code for reproduction

```python
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
from datetime import datetime, timedelta

#create time array
initial = datetime(2021,2,14,0,0,0)
time_array = [initial + timedelta(days=x) for x in range(1,200)]

#create data array
data = [-x**2/20000 for x in range(1,200)]


#plot data
fig,ax = plt.subplots()
ax.plot(time_array,data) 
        
locator = mdates.AutoDateLocator()
formatter = mdates.ConciseDateFormatter(locator)

ax.grid(True)
ax.set_ylabel("Temperature ($\degree$C)")
ax.xaxis.set_major_locator(locator)   
ax.xaxis.set_major_formatter(formatter)
fig.autofmt_xdate() #automatically makes the x-labels rotate
```


### Actual outcome

![image](https://user-images.githubusercontent.com/15143365/154090257-c7813f1c-f9ea-4252-86bf-f84e449c2f46.png)


### Expected outcome

I expect the year "2021" to show in the offset, to the right of the x-axis

### Additional information

I'm using Spyder IDE, v5.1.5

### Operating system

Windows 10

### Matplotlib Version

3.4.3

### Matplotlib Backend

Qt5Agg

### Python version

3.9.1

### Jupyter version

_No response_

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/dates.py b/lib/matplotlib/dates.py
index 4d8ddf3ee5..0ee2287519 100644
--- a/lib/matplotlib/dates.py
+++ b/lib/matplotlib/dates.py
@@ -797,14 +797,24 @@ class ConciseDateFormatter(ticker.Formatter):
         # 3: hours, 4: minutes, 5: seconds, 6: microseconds
         for level in range(5, -1, -1):
             if len(np.unique(tickdate[:, level])) > 1:
-                if level < 2:
-                    show_offset = False
                 break
             elif level == 0:
                 # all tickdate are the same, so only micros might be different
                 # set to the most precise (6: microseconds doesn't exist...)
                 level = 5
 
+        # Decide whether to show the offset based on the determined level.
+        # For yearly labels, offset is redundant.
+        if level == 0:
+            show_offset = False
+        elif level == 1:
+            # For monthly labels, only suppress the offset if a January tick
+            # exists (zero-format will provide the year on that tick).
+            # If January is absent, keep the offset (typically showing the year)
+            # to ensure the axis conveys full date context.
+            if np.any(tickdate[:, 1] == 1):
+                show_offset = False
+
         # level is the basic level we will label at.
         # now loop through and decide the actual ticklabels
         zerovals = [0, 1, 1, 0, 0, 0, 0]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-20 20:00:30,650 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to a bug in `ConciseDateFormatter`. The bug occurs when plotting a date range of less than a year that does not include January, where the year is not displayed. The relevant code is in `lib/matplotlib/dates.py`. To find relevant test cases, I need to examine the tests for this module. The file `lib/matplotlib/tests/test_dates.py` seems to be the correct place for these tests, but I do not have its content. Therefore, I need to request this file.' query='Please provide the full content of lib/matplotlib/tests/test_dates.py.' extra_requirements='' purpose='I need to find 3 relevant test cases for the `ConciseDateFormatter` bug, and this file should contain them.'
2025-12-20 20:00:30,651 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of lib/matplotlib/tests/test_dates.py.
2025-12-20 20:00:30,651 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-20 20:00:30,652 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-20 20:00:30,652 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-20 20:00:30,652 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of lib/matplotlib/tests/test_dates.py.
Purpose: I need to find 3 relevant test cases for the `ConciseDateFormatter` bug, and this file should contain them.
2025-12-20 20:00:33,475 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of the file `lib/matplotlib/tests/test_dates.py` as you requested.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_dates.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2140, 'candidates_token_count': 51, 'total_token_count': 2395, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2140}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 51}], 'thoughts_token_count': 204, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2149498322430779, 'model_name': 'gemini-2.5-pro'} id='run--a9d386be-15c2-485a-a343-df173b8fe78f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py'}, 'id': '237a87ea-f960-43a5-b14e-4b2ba9f70733', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2140, 'output_tokens': 51, 'total_tokens': 2395, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 204}}
2025-12-20 20:00:36,332 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have located the test cases that use `ConciseDateFormatter` in the file `lib/matplotlib/tests/test_dates.py`. Now, I will analyze them to identify the three most relevant examples for the bug you are addressing.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "ConciseDateFormatter", "relative_path": "lib/matplotlib/tests/test_dates.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 13816, 'candidates_token_count': 88, 'total_token_count': 14016, 'cached_content_token_count': 1882, 'prompt_tokens_details': [{'modality': 1, 'token_count': 13816}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1882}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 88}], 'thoughts_token_count': 112}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1952822208404541, 'model_name': 'gemini-2.5-pro'} id='run--e57a87d4-7531-4eed-b8ee-11a0186c5774-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'ConciseDateFormatter', 'relative_path': 'lib/matplotlib/tests/test_dates.py'}, 'id': 'da2ac16c-b7ae-4ed1-8674-6c651f6e4344', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13816, 'output_tokens': 88, 'total_tokens': 14016, 'input_token_details': {'cache_read': 1882}, 'output_token_details': {'reasoning': 112}}
2025-12-20 20:00:42,756 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the test cases for `ConciseDateFormatter` and will now retrieve the code for `test_concise_formatter_subsecond`, `test_concise_formatter_show_offset`, and `test_offset_changes`. These three tests appear to be the most relevant for investigating the bug you mentioned, as they cover sub-second formatting, offset behavior with varying time scales, and dynamic offset changes.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_dates.py", "end_line": 635.0, "start_line": 616.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 15426, 'candidates_token_count': 180, 'total_token_count': 15848, 'cached_content_token_count': 13155, 'prompt_tokens_details': [{'modality': 1, 'token_count': 15426}], 'cache_tokens_details': [{'modality': 1, 'token_count': 13155}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 180}], 'thoughts_token_count': 242}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1452170795864529, 'model_name': 'gemini-2.5-pro'} id='run--d7f04940-7300-4b03-a73d-2ac35f1c9cb2-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py', 'end_line': 540.0, 'start_line': 532.0}, 'id': 'fbfbdfc3-bba7-4c94-b8ac-8273de55f505', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py', 'end_line': 613.0, 'start_line': 592.0}, 'id': 'fbb25450-4615-4941-b517-764f35c2a11e', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py', 'end_line': 635.0, 'start_line': 616.0}, 'id': '5c278351-3183-44b3-b434-047a5d449a60', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15426, 'output_tokens': 180, 'total_tokens': 15848, 'input_token_details': {'cache_read': 13155}, 'output_token_details': {'reasoning': 242}}
2025-12-20 20:00:49,822 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have gathered the content of `lib/matplotlib/tests/test_dates.py` and identified three test cases that are highly relevant to your `ConciseDateFormatter` bug investigation. The selected tests cover a range of scenarios, including sub-second time formatting, the display of offsets across different time scales, and the dynamic updating of those offsets. The code for these tests is provided below to help you in your debugging process.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16815, 'candidates_token_count': 88, 'total_token_count': 17517, 'cached_content_token_count': 15003, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16815}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15003}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 88}], 'thoughts_token_count': 614}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7537056316028942, 'model_name': 'gemini-2.5-pro'} id='run--737baaee-286d-47ea-82eb-1b8587acf5e6-0' usage_metadata={'input_tokens': 16815, 'output_tokens': 88, 'total_tokens': 17517, 'input_token_details': {'cache_read': 15003}, 'output_token_details': {'reasoning': 614}}
2025-12-20 20:00:49,823 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of lib/matplotlib/tests/test_dates.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find 3 relevant test cases for the `ConciseDateFormatter` bug, and this file should contain them.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_dates.py
Line number range: 1 - 500
Content:
1. import datetime
2. 
3. import dateutil.tz
4. import dateutil.rrule
5. import functools
6. import numpy as np
7. import pytest
8. 
9. from matplotlib import _api, rc_context, style
10. import matplotlib.dates as mdates
11. import matplotlib.pyplot as plt
12. from matplotlib.testing.decorators import image_comparison
13. import matplotlib.ticker as mticker
14. 
15. 
16. def test_date_numpyx():
17.     # test that numpy dates work properly...
18.     base = datetime.datetime(2017, 1, 1)
19.     time = [base + datetime.timedelta(days=x) for x in range(0, 3)]
20.     timenp = np.array(time, dtype='datetime64[ns]')
21.     data = np.array([0., 2., 1.])
22.     fig = plt.figure(figsize=(10, 2))
23.     ax = fig.add_subplot(1, 1, 1)
24.     h, = ax.plot(time, data)
25.     hnp, = ax.plot(timenp, data)
26.     np.testing.assert_equal(h.get_xdata(orig=False), hnp.get_xdata(orig=False))
27.     fig = plt.figure(figsize=(10, 2))
28.     ax = fig.add_subplot(1, 1, 1)
29.     h, = ax.plot(data, time)
30.     hnp, = ax.plot(data, timenp)
31.     np.testing.assert_equal(h.get_ydata(orig=False), hnp.get_ydata(orig=False))
32. 
33. 
34. @pytest.mark.parametrize('t0', [datetime.datetime(2017, 1, 1, 0, 1, 1),
35. 
36.                                 [datetime.datetime(2017, 1, 1, 0, 1, 1),
37.                                  datetime.datetime(2017, 1, 1, 1, 1, 1)],
38. 
39.                                 [[datetime.datetime(2017, 1, 1, 0, 1, 1),
40.                                   datetime.datetime(2017, 1, 1, 1, 1, 1)],
41.                                  [datetime.datetime(2017, 1, 1, 2, 1, 1),
42.                                   datetime.datetime(2017, 1, 1, 3, 1, 1)]]])
43. @pytest.mark.parametrize('dtype', ['datetime64[s]',
44.                                    'datetime64[us]',
45.                                    'datetime64[ms]',
46.                                    'datetime64[ns]'])
47. def test_date_date2num_numpy(t0, dtype):
48.     time = mdates.date2num(t0)
49.     tnp = np.array(t0, dtype=dtype)
50.     nptime = mdates.date2num(tnp)
51.     np.testing.assert_equal(time, nptime)
52. 
53. 
54. @pytest.mark.parametrize('dtype', ['datetime64[s]',
55.                                    'datetime64[us]',
56.                                    'datetime64[ms]',
57.                                    'datetime64[ns]'])
58. def test_date2num_NaT(dtype):
59.     t0 = datetime.datetime(2017, 1, 1, 0, 1, 1)
60.     tmpl = [mdates.date2num(t0), np.nan]
61.     tnp = np.array([t0, 'NaT'], dtype=dtype)
62.     nptime = mdates.date2num(tnp)
63.     np.testing.assert_array_equal(tmpl, nptime)
64. 
65. 
66. @pytest.mark.parametrize('units', ['s', 'ms', 'us', 'ns'])
67. def test_date2num_NaT_scalar(units):
68.     tmpl = mdates.date2num(np.datetime64('NaT', units))
69.     assert np.isnan(tmpl)
70. 
71. 
72. def test_date_empty():
73.     # make sure we do the right thing when told to plot dates even
74.     # if no date data has been presented, cf
75.     # http://sourceforge.net/tracker/?func=detail&aid=2850075&group_id=80706&atid=560720
76.     fig, ax = plt.subplots()
77.     ax.xaxis_date()
78.     fig.draw_without_rendering()
79.     np.testing.assert_allclose(ax.get_xlim(),
80.                                [mdates.date2num(np.datetime64('2000-01-01')),
81.                                 mdates.date2num(np.datetime64('2010-01-01'))])
82. 
83.     mdates._reset_epoch_test_example()
84.     mdates.set_epoch('0000-12-31')
85.     fig, ax = plt.subplots()
86.     ax.xaxis_date()
87.     fig.draw_without_rendering()
88.     np.testing.assert_allclose(ax.get_xlim(),
89.                                [mdates.date2num(np.datetime64('2000-01-01')),
90.                                 mdates.date2num(np.datetime64('2010-01-01'))])
91.     mdates._reset_epoch_test_example()
92. 
93. 
94. def test_date_not_empty():
95.     fig = plt.figure()
96.     ax = fig.add_subplot()
97. 
98.     ax.plot([50, 70], [1, 2])
99.     ax.xaxis.axis_date()
100.     np.testing.assert_allclose(ax.get_xlim(), [50, 70])
101. 
102. 
103. def test_axhline():
104.     # make sure that axhline doesn't set the xlimits...
105.     fig, ax = plt.subplots()
106.     ax.axhline(1.5)
107.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
108.     np.testing.assert_allclose(ax.get_xlim(),
109.                                [mdates.date2num(np.datetime64('2016-01-01')),
110.                                 mdates.date2num(np.datetime64('2016-01-02'))])
111. 
112.     mdates._reset_epoch_test_example()
113.     mdates.set_epoch('0000-12-31')
114.     fig, ax = plt.subplots()
115.     ax.axhline(1.5)
116.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
117.     np.testing.assert_allclose(ax.get_xlim(),
118.                                [mdates.date2num(np.datetime64('2016-01-01')),
119.                                 mdates.date2num(np.datetime64('2016-01-02'))])
120.     mdates._reset_epoch_test_example()
121. 
122. 
123. @image_comparison(['date_axhspan.png'])
124. def test_date_axhspan():
125.     # test axhspan with date inputs
126.     t0 = datetime.datetime(2009, 1, 20)
127.     tf = datetime.datetime(2009, 1, 21)
128.     fig, ax = plt.subplots()
129.     ax.axhspan(t0, tf, facecolor="blue", alpha=0.25)
130.     ax.set_ylim(t0 - datetime.timedelta(days=5),
131.                 tf + datetime.timedelta(days=5))
132.     fig.subplots_adjust(left=0.25)
133. 
134. 
135. @image_comparison(['date_axvspan.png'])
136. def test_date_axvspan():
137.     # test axvspan with date inputs
138.     t0 = datetime.datetime(2000, 1, 20)
139.     tf = datetime.datetime(2010, 1, 21)
140.     fig, ax = plt.subplots()
141.     ax.axvspan(t0, tf, facecolor="blue", alpha=0.25)
142.     ax.set_xlim(t0 - datetime.timedelta(days=720),
143.                 tf + datetime.timedelta(days=720))
144.     fig.autofmt_xdate()
145. 
146. 
147. @image_comparison(['date_axhline.png'])
148. def test_date_axhline():
149.     # test axhline with date inputs
150.     t0 = datetime.datetime(2009, 1, 20)
151.     tf = datetime.datetime(2009, 1, 31)
152.     fig, ax = plt.subplots()
153.     ax.axhline(t0, color="blue", lw=3)
154.     ax.set_ylim(t0 - datetime.timedelta(days=5),
155.                 tf + datetime.timedelta(days=5))
156.     fig.subplots_adjust(left=0.25)
157. 
158. 
159. @image_comparison(['date_axvline.png'])
160. def test_date_axvline():
161.     # test axvline with date inputs
162.     t0 = datetime.datetime(2000, 1, 20)
163.     tf = datetime.datetime(2000, 1, 21)
164.     fig, ax = plt.subplots()
165.     ax.axvline(t0, color="red", lw=3)
166.     ax.set_xlim(t0 - datetime.timedelta(days=5),
167.                 tf + datetime.timedelta(days=5))
168.     fig.autofmt_xdate()
169. 
170. 
171. def test_too_many_date_ticks(caplog):
172.     # Attempt to test SF 2715172, see
173.     # https://sourceforge.net/tracker/?func=detail&aid=2715172&group_id=80706&atid=560720
174.     # setting equal datetimes triggers and expander call in
175.     # transforms.nonsingular which results in too many ticks in the
176.     # DayLocator.  This should emit a log at WARNING level.
177.     caplog.set_level("WARNING")
178.     t0 = datetime.datetime(2000, 1, 20)
179.     tf = datetime.datetime(2000, 1, 20)
180.     fig, ax = plt.subplots()
181.     with pytest.warns(UserWarning) as rec:
182.         ax.set_xlim((t0, tf), auto=True)
183.         assert len(rec) == 1
184.         assert ('Attempting to set identical low and high xlims'
185.                 in str(rec[0].message))
186.     ax.plot([], [])
187.     ax.xaxis.set_major_locator(mdates.DayLocator())
188.     v = ax.xaxis.get_major_locator()()
189.     assert len(v) > 1000
190.     # The warning is emitted multiple times because the major locator is also
191.     # called both when placing the minor ticks (for overstriking detection) and
192.     # during tick label positioning.
193.     assert caplog.records and all(
194.         record.name == "matplotlib.ticker" and record.levelname == "WARNING"
195.         for record in caplog.records)
196.     assert len(caplog.records) > 0
197. 
198. 
199. def _new_epoch_decorator(thefunc):
200.     @functools.wraps(thefunc)
201.     def wrapper():
202.         mdates._reset_epoch_test_example()
203.         mdates.set_epoch('2000-01-01')
204.         thefunc()
205.         mdates._reset_epoch_test_example()
206.     return wrapper
207. 
208. 
209. @image_comparison(['RRuleLocator_bounds.png'])
210. def test_RRuleLocator():
211.     import matplotlib.testing.jpl_units as units
212.     units.register()
213.     # This will cause the RRuleLocator to go out of bounds when it tries
214.     # to add padding to the limits, so we make sure it caps at the correct
215.     # boundary values.
216.     t0 = datetime.datetime(1000, 1, 1)
217.     tf = datetime.datetime(6000, 1, 1)
218. 
219.     fig = plt.figure()
220.     ax = plt.subplot()
221.     ax.set_autoscale_on(True)
222.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
223. 
224.     rrule = mdates.rrulewrapper(dateutil.rrule.YEARLY, interval=500)
225.     locator = mdates.RRuleLocator(rrule)
226.     ax.xaxis.set_major_locator(locator)
227.     ax.xaxis.set_major_formatter(mdates.AutoDateFormatter(locator))
228. 
229.     ax.autoscale_view()
230.     fig.autofmt_xdate()
231. 
232. 
233. def test_RRuleLocator_dayrange():
234.     loc = mdates.DayLocator()
235.     x1 = datetime.datetime(year=1, month=1, day=1, tzinfo=mdates.UTC)
236.     y1 = datetime.datetime(year=1, month=1, day=16, tzinfo=mdates.UTC)
237.     loc.tick_values(x1, y1)
238.     # On success, no overflow error shall be thrown
239. 
240. 
241. def test_RRuleLocator_close_minmax():
242.     # if d1 and d2 are very close together, rrule cannot create
243.     # reasonable tick intervals; ensure that this is handled properly
244.     rrule = mdates.rrulewrapper(dateutil.rrule.SECONDLY, interval=5)
245.     loc = mdates.RRuleLocator(rrule)
246.     d1 = datetime.datetime(year=2020, month=1, day=1)
247.     d2 = datetime.datetime(year=2020, month=1, day=1, microsecond=1)
248.     expected = ['2020-01-01 00:00:00+00:00',
249.                 '2020-01-01 00:00:00.000001+00:00']
250.     assert list(map(str, mdates.num2date(loc.tick_values(d1, d2)))) == expected
251. 
252. 
253. @image_comparison(['DateFormatter_fractionalSeconds.png'])
254. def test_DateFormatter():
255.     import matplotlib.testing.jpl_units as units
256.     units.register()
257. 
258.     # Lets make sure that DateFormatter will allow us to have tick marks
259.     # at intervals of fractional seconds.
260. 
261.     t0 = datetime.datetime(2001, 1, 1, 0, 0, 0)
262.     tf = datetime.datetime(2001, 1, 1, 0, 0, 1)
263. 
264.     fig = plt.figure()
265.     ax = plt.subplot()
266.     ax.set_autoscale_on(True)
267.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
268. 
269.     # rrule = mpldates.rrulewrapper( dateutil.rrule.YEARLY, interval=500 )
270.     # locator = mpldates.RRuleLocator( rrule )
271.     # ax.xaxis.set_major_locator( locator )
272.     # ax.xaxis.set_major_formatter( mpldates.AutoDateFormatter(locator) )
273. 
274.     ax.autoscale_view()
275.     fig.autofmt_xdate()
276. 
277. 
278. def test_locator_set_formatter():
279.     """
280.     Test if setting the locator only will update the AutoDateFormatter to use
281.     the new locator.
282.     """
283.     plt.rcParams["date.autoformatter.minute"] = "%d %H:%M"
284.     t = [datetime.datetime(2018, 9, 30, 8, 0),
285.          datetime.datetime(2018, 9, 30, 8, 59),
286.          datetime.datetime(2018, 9, 30, 10, 30)]
287.     x = [2, 3, 1]
288. 
289.     fig, ax = plt.subplots()
290.     ax.plot(t, x)
291.     ax.xaxis.set_major_locator(mdates.MinuteLocator((0, 30)))
292.     fig.canvas.draw()
293.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels()]
294.     expected = ['30 08:00', '30 08:30', '30 09:00',
295.                 '30 09:30', '30 10:00', '30 10:30']
296.     assert ticklabels == expected
297. 
298.     ax.xaxis.set_major_locator(mticker.NullLocator())
299.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((5, 55)))
300.     decoy_loc = mdates.MinuteLocator((12, 27))
301.     ax.xaxis.set_minor_formatter(mdates.AutoDateFormatter(decoy_loc))
302. 
303.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((15, 45)))
304.     fig.canvas.draw()
305.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels(which="minor")]
306.     expected = ['30 08:15', '30 08:45', '30 09:15', '30 09:45', '30 10:15']
307.     assert ticklabels == expected
308. 
309. 
310. def test_date_formatter_callable():
311. 
312.     class _Locator:
313.         def _get_unit(self): return -11
314. 
315.     def callable_formatting_function(dates, _):
316.         return [dt.strftime('%d-%m//%Y') for dt in dates]
317. 
318.     formatter = mdates.AutoDateFormatter(_Locator())
319.     formatter.scaled[-10] = callable_formatting_function
320.     assert formatter([datetime.datetime(2014, 12, 25)]) == ['25-12//2014']
321. 
322. 
323. @pytest.mark.parametrize('delta, expected', [
324.     (datetime.timedelta(weeks=52 * 200),
325.      range(1990, 2171, 20)),
326.     (datetime.timedelta(days=30),
327.      ['1990-01-%02d' % day for day in range(1, 32, 3)]),
328.     (datetime.timedelta(hours=20),
329.      ['01-01 %02d' % hour for hour in range(0, 21, 2)]),
330.     (datetime.timedelta(minutes=10),
331.      ['01 00:%02d' % minu for minu in range(0, 11)]),
332. ])
333. def test_date_formatter_usetex(delta, expected):
334.     style.use("default")
335. 
336.     d1 = datetime.datetime(1990, 1, 1)
337.     d2 = d1 + delta
338. 
339.     locator = mdates.AutoDateLocator(interval_multiples=False)
340.     locator.create_dummy_axis()
341.     locator.axis.set_view_interval(mdates.date2num(d1), mdates.date2num(d2))
342. 
343.     formatter = mdates.AutoDateFormatter(locator, usetex=True)
344.     assert [formatter(loc) for loc in locator()] == [
345.         r'{\fontfamily{\familydefault}\selectfont %s}' % s for s in expected]
346. 
347. 
348. def test_drange():
349.     """
350.     This test should check if drange works as expected, and if all the
351.     rounding errors are fixed
352.     """
353.     start = datetime.datetime(2011, 1, 1, tzinfo=mdates.UTC)
354.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
355.     delta = datetime.timedelta(hours=1)
356.     # We expect 24 values in drange(start, end, delta), because drange returns
357.     # dates from an half open interval [start, end)
358.     assert len(mdates.drange(start, end, delta)) == 24
359. 
360.     # if end is a little bit later, we expect the range to contain one element
361.     # more
362.     end = end + datetime.timedelta(microseconds=1)
363.     assert len(mdates.drange(start, end, delta)) == 25
364. 
365.     # reset end
366.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
367. 
368.     # and tst drange with "complicated" floats:
369.     # 4 hours = 1/6 day, this is an "dangerous" float
370.     delta = datetime.timedelta(hours=4)
371.     daterange = mdates.drange(start, end, delta)
372.     assert len(daterange) == 6
373.     assert mdates.num2date(daterange[-1]) == (end - delta)
374. 
375. 
376. @_new_epoch_decorator
377. def test_auto_date_locator():
378.     def _create_auto_date_locator(date1, date2):
379.         locator = mdates.AutoDateLocator(interval_multiples=False)
380.         locator.create_dummy_axis()
381.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
382.         return locator
383. 
384.     d1 = datetime.datetime(1990, 1, 1)
385.     results = ([datetime.timedelta(weeks=52 * 200),
386.                 ['1990-01-01 00:00:00+00:00', '2010-01-01 00:00:00+00:00',
387.                  '2030-01-01 00:00:00+00:00', '2050-01-01 00:00:00+00:00',
388.                  '2070-01-01 00:00:00+00:00', '2090-01-01 00:00:00+00:00',
389.                  '2110-01-01 00:00:00+00:00', '2130-01-01 00:00:00+00:00',
390.                  '2150-01-01 00:00:00+00:00', '2170-01-01 00:00:00+00:00']
391.                 ],
392.                [datetime.timedelta(weeks=52),
393.                 ['1990-01-01 00:00:00+00:00', '1990-02-01 00:00:00+00:00',
394.                  '1990-03-01 00:00:00+00:00', '1990-04-01 00:00:00+00:00',
395.                  '1990-05-01 00:00:00+00:00', '1990-06-01 00:00:00+00:00',
396.                  '1990-07-01 00:00:00+00:00', '1990-08-01 00:00:00+00:00',
397.                  '1990-09-01 00:00:00+00:00', '1990-10-01 00:00:00+00:00',
398.                  '1990-11-01 00:00:00+00:00', '1990-12-01 00:00:00+00:00']
399.                 ],
400.                [datetime.timedelta(days=141),
401.                 ['1990-01-05 00:00:00+00:00', '1990-01-26 00:00:00+00:00',
402.                  '1990-02-16 00:00:00+00:00', '1990-03-09 00:00:00+00:00',
403.                  '1990-03-30 00:00:00+00:00', '1990-04-20 00:00:00+00:00',
404.                  '1990-05-11 00:00:00+00:00']
405.                 ],
406.                [datetime.timedelta(days=40),
407.                 ['1990-01-03 00:00:00+00:00', '1990-01-10 00:00:00+00:00',
408.                  '1990-01-17 00:00:00+00:00', '1990-01-24 00:00:00+00:00',
409.                  '1990-01-31 00:00:00+00:00', '1990-02-07 00:00:00+00:00']
410.                 ],
411.                [datetime.timedelta(hours=40),
412.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 04:00:00+00:00',
413.                  '1990-01-01 08:00:00+00:00', '1990-01-01 12:00:00+00:00',
414.                  '1990-01-01 16:00:00+00:00', '1990-01-01 20:00:00+00:00',
415.                  '1990-01-02 00:00:00+00:00', '1990-01-02 04:00:00+00:00',
416.                  '1990-01-02 08:00:00+00:00', '1990-01-02 12:00:00+00:00',
417.                  '1990-01-02 16:00:00+00:00']
418.                 ],
419.                [datetime.timedelta(minutes=20),
420.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:05:00+00:00',
421.                  '1990-01-01 00:10:00+00:00', '1990-01-01 00:15:00+00:00',
422.                  '1990-01-01 00:20:00+00:00']
423.                 ],
424.                [datetime.timedelta(seconds=40),
425.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:00:05+00:00',
426.                  '1990-01-01 00:00:10+00:00', '1990-01-01 00:00:15+00:00',
427.                  '1990-01-01 00:00:20+00:00', '1990-01-01 00:00:25+00:00',
428.                  '1990-01-01 00:00:30+00:00', '1990-01-01 00:00:35+00:00',
429.                  '1990-01-01 00:00:40+00:00']
430.                 ],
431.                [datetime.timedelta(microseconds=1500),
432.                 ['1989-12-31 23:59:59.999500+00:00',
433.                  '1990-01-01 00:00:00+00:00',
434.                  '1990-01-01 00:00:00.000500+00:00',
435.                  '1990-01-01 00:00:00.001000+00:00',
436.                  '1990-01-01 00:00:00.001500+00:00',
437.                  '1990-01-01 00:00:00.002000+00:00']
438.                 ],
439.                )
440. 
441.     for t_delta, expected in results:
442.         d2 = d1 + t_delta
443.         locator = _create_auto_date_locator(d1, d2)
444.         assert list(map(str, mdates.num2date(locator()))) == expected
445. 
446.     locator = mdates.AutoDateLocator(interval_multiples=False)
447.     assert locator.maxticks == {0: 11, 1: 12, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
448. 
449.     locator = mdates.AutoDateLocator(maxticks={dateutil.rrule.MONTHLY: 5})
450.     assert locator.maxticks == {0: 11, 1: 5, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
451. 
452.     locator = mdates.AutoDateLocator(maxticks=5)
453.     assert locator.maxticks == {0: 5, 1: 5, 3: 5, 4: 5, 5: 5, 6: 5, 7: 5}
454. 
455. 
456. @_new_epoch_decorator
457. def test_auto_date_locator_intmult():
458.     def _create_auto_date_locator(date1, date2):
459.         locator = mdates.AutoDateLocator(interval_multiples=True)
460.         locator.create_dummy_axis()
461.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
462.         return locator
463. 
464.     results = ([datetime.timedelta(weeks=52 * 200),
465.                 ['1980-01-01 00:00:00+00:00', '2000-01-01 00:00:00+00:00',
466.                  '2020-01-01 00:00:00+00:00', '2040-01-01 00:00:00+00:00',
467.                  '2060-01-01 00:00:00+00:00', '2080-01-01 00:00:00+00:00',
468.                  '2100-01-01 00:00:00+00:00', '2120-01-01 00:00:00+00:00',
469.                  '2140-01-01 00:00:00+00:00', '2160-01-01 00:00:00+00:00',
470.                  '2180-01-01 00:00:00+00:00', '2200-01-01 00:00:00+00:00']
471.                 ],
472.                [datetime.timedelta(weeks=52),
473.                 ['1997-01-01 00:00:00+00:00', '1997-02-01 00:00:00+00:00',
474.                  '1997-03-01 00:00:00+00:00', '1997-04-01 00:00:00+00:00',
475.                  '1997-05-01 00:00:00+00:00', '1997-06-01 00:00:00+00:00',
476.                  '1997-07-01 00:00:00+00:00', '1997-08-01 00:00:00+00:00',
477.                  '1997-09-01 00:00:00+00:00', '1997-10-01 00:00:00+00:00',
478.                  '1997-11-01 00:00:00+00:00', '1997-12-01 00:00:00+00:00']
479.                 ],
480.                [datetime.timedelta(days=141),
481.                 ['1997-01-01 00:00:00+00:00', '1997-01-15 00:00:00+00:00',
482.                  '1997-02-01 00:00:00+00:00', '1997-02-15 00:00:00+00:00',
483.                  '1997-03-01 00:00:00+00:00', '1997-03-15 00:00:00+00:00',
484.                  '1997-04-01 00:00:00+00:00', '1997-04-15 00:00:00+00:00',
485.                  '1997-05-01 00:00:00+00:00', '1997-05-15 00:00:00+00:00']
486.                 ],
487.                [datetime.timedelta(days=40),
488.                 ['1997-01-01 00:00:00+00:00', '1997-01-05 00:00:00+00:00',
489.                  '1997-01-09 00:00:00+00:00', '1997-01-13 00:00:00+00:00',
490.                  '1997-01-17 00:00:00+00:00', '1997-01-21 00:00:00+00:00',
491.                  '1997-01-25 00:00:00+00:00', '1997-01-29 00:00:00+00:00',
492.                  '1997-02-01 00:00:00+00:00', '1997-02-05 00:00:00+00:00',
493.                  '1997-02-09 00:00:00+00:00']
494.                 ],
495.                [datetime.timedelta(hours=40),
496.                 ['1997-01-01 00:00:00+00:00', '1997-01-01 04:00:00+00:00',
497.                  '1997-01-01 08:00:00+00:00', '1997-01-01 12:00:00+00:00',
498.                  '1997-01-01 16:00:00+00:00', '1997-01-01 20:00:00+00:00',
499.                  '1997-01-02 00:00:00+00:00', '1997-01-02 04:00:00+00:00',
500.                  '1997-01-02 08:00:00+00:00', '1997-01-02 12:00:00+00:00',


File: lib/matplotlib/tests/test_dates.py
Line number range: 532 - 540
Content:
def test_concise_formatter_subsecond():
    locator = mdates.AutoDateLocator(interval_multiples=True)
    formatter = mdates.ConciseDateFormatter(locator)
    year_1996 = 9861.0
    strings = formatter.format_ticks([
        year_1996,
        year_1996 + 500 / mdates.MUSECONDS_PER_DAY,
        year_1996 + 900 / mdates.MUSECONDS_PER_DAY])
    assert strings == ['00:00', '00.0005', '00.0009']


File: lib/matplotlib/tests/test_dates.py
Line number range: 592 - 613
Content:
@pytest.mark.parametrize('t_delta, expected', [
    (datetime.timedelta(seconds=0.01), '1997-Jan-01 00:00'),
    (datetime.timedelta(minutes=1), '1997-Jan-01 00:01'),
    (datetime.timedelta(hours=1), '1997-Jan-01'),
    (datetime.timedelta(days=1), '1997-Jan-02'),
    (datetime.timedelta(weeks=1), '1997-Jan'),
    (datetime.timedelta(weeks=26), ''),
    (datetime.timedelta(weeks=520), '')
])
def test_concise_formatter_show_offset(t_delta, expected):
    d1 = datetime.datetime(1997, 1, 1)
    d2 = d1 + t_delta

    fig, ax = plt.subplots()
    locator = mdates.AutoDateLocator()
    formatter = mdates.ConciseDateFormatter(locator)
    ax.xaxis.set_major_locator(locator)
    ax.xaxis.set_major_formatter(formatter)

    ax.plot([d1, d2], [0, 0])
    fig.canvas.draw()
    assert formatter.get_offset() == expected


File: lib/matplotlib/tests/test_dates.py
Line number range: 616 - 635
Content:
def test_offset_changes():
    fig, ax = plt.subplots()

    d1 = datetime.datetime(1997, 1, 1)
    d2 = d1 + datetime.timedelta(weeks=520)

    locator = mdates.AutoDateLocator()
    formatter = mdates.ConciseDateFormatter(locator)
    ax.xaxis.set_major_locator(locator)
    ax.xaxis.set_major_formatter(formatter)

    ax.plot([d1, d2], [0, 0])
    fig.draw_without_rendering()
    assert formatter.get_offset() == ''
    ax.set_xlim(d1, d1 + datetime.timedelta(weeks=3))
    fig.draw_without_rendering()
    assert formatter.get_offset() == '1997-Jan'
    ax.set_xlim(d1, d1 + datetime.timedelta(weeks=520))
    fig.draw_without_rendering()
    assert formatter.get_offset() == ''


File: lib/matplotlib/tests/test_dates.py
Line number range: 1289 - 1300
Content:
def test_concise_formatter_exceptions():
    locator = mdates.AutoDateLocator()
    with pytest.raises(ValueError, match="formats argument must be a list"):
        mdates.ConciseDateFormatter(locator, formats=['', '%Y'])

    with pytest.raises(ValueError,
                       match="zero_formats argument must be a list"):
        mdates.ConciseDateFormatter(locator, zero_formats=['', '%Y'])

    with pytest.raises(ValueError,
                       match="offset_formats argument must be a list"):
        mdates.ConciseDateFormatter(locator, offset_formats=['', '%Y'])


File: lib/matplotlib/tests/test_dates.py
Line number range: 1303 - 1307
Content:
def test_concise_formatter_call():
    locator = mdates.AutoDateLocator()
    formatter = mdates.ConciseDateFormatter(locator)
    assert formatter(19002.0) == '2022'
    assert formatter.format_data_short(19002.0) == '2022-01-10 00:00:00'

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-20 20:01:50,510 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requested the full content of `lib/matplotlib/tests/test_dates.py`.\n   - This context is a part of that file.\n2. Extended relevance:\n   - This context is relevant as it forms part of the file requested by the user.', relative_path='lib/matplotlib/tests/test_dates.py', start_line=1, end_line=500), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of `lib/matplotlib/tests/test_dates.py`.\n   - This context is a part of that file.\n2. Extended relevance:\n   - This test case is relevant to the user's purpose of finding tests for `ConciseDateFormatter`.", relative_path='lib/matplotlib/tests/test_dates.py', start_line=532, end_line=540), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of `lib/matplotlib/tests/test_dates.py`.\n   - This context is a part of that file.\n2. Extended relevance:\n   - This test case is relevant to the user's purpose of finding tests for `ConciseDateFormatter`.", relative_path='lib/matplotlib/tests/test_dates.py', start_line=592, end_line=613), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of `lib/matplotlib/tests/test_dates.py`.\n   - This context is a part of that file.\n2. Extended relevance:\n   - This test case is relevant to the user's purpose of finding tests for `ConciseDateFormatter`.", relative_path='lib/matplotlib/tests/test_dates.py', start_line=616, end_line=635), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of `lib/matplotlib/tests/test_dates.py`.\n   - This context is a part of that file.\n2. Extended relevance:\n   - This test case is relevant to the user's purpose of finding tests for `ConciseDateFormatter`.", relative_path='lib/matplotlib/tests/test_dates.py', start_line=1289, end_line=1300), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of `lib/matplotlib/tests/test_dates.py`.\n   - This context is a part of that file.\n2. Extended relevance:\n   - This test case is relevant to the user's purpose of finding tests for `ConciseDateFormatter`.", relative_path='lib/matplotlib/tests/test_dates.py', start_line=1303, end_line=1307)]
2025-12-20 20:01:50,513 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 6 contexts to memory for query: Please provide the full content of lib/matplotlib/tests/test_dates.py.
2025-12-20 20:01:50,514 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-20 20:01:50,514 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-20 20:01:50,514 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 6 new contexts to 0 existing contexts
2025-12-20 20:01:50,514 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 6 total contexts (removed 0 duplicates)
2025-12-20 20:01:50,515 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   └── check_wheel_licenses.py
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   └── 22691-JMK.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       └── 22738-JL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.5.0.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   └── whats_new_3.5.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── frontpage
|   |   ├── 3D.py
|   |   ├── README.txt
|   |   ├── contour_frontpage.py
|   |   ├── histogram.py
|   |   └── membrane.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── cursor_demo.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── log_test.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc_sgskip.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── inset_locator.py
|   |   |   └── parasite_axes.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _contour.cpp
|   ├── _contour_wrapper.cpp
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: ConciseDateFormatter not showing year anywhere when plotting <12 months

Description: ### Bug summary

When I plot < 1 year and January is not included in the x-axis, the year doesn't show up anywhere.
This bug is different from bug #21670 (fixed in #21785).

### Code for reproduction

```python
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
from datetime import datetime, timedelta

#create time array
initial = datetime(2021,2,14,0,0,0)
time_array = [initial + timedelta(days=x) for x in range(1,200)]

#create data array
data = [-x**2/20000 for x in range(1,200)]


#plot data
fig,ax = plt.subplots()
ax.plot(time_array,data) 
        
locator = mdates.AutoDateLocator()
formatter = mdates.ConciseDateFormatter(locator)

ax.grid(True)
ax.set_ylabel("Temperature ($\degree$C)")
ax.xaxis.set_major_locator(locator)   
ax.xaxis.set_major_formatter(formatter)
fig.autofmt_xdate() #automatically makes the x-labels rotate
```


### Actual outcome

![image](https://user-images.githubusercontent.com/15143365/154090257-c7813f1c-f9ea-4252-86bf-f84e449c2f46.png)


### Expected outcome

I expect the year "2021" to show in the offset, to the right of the x-axis

### Additional information

I'm using Spyder IDE, v5.1.5

### Operating system

Windows 10

### Matplotlib Version

3.4.3

### Matplotlib Backend

Qt5Agg

### Python version

3.9.1

### Jupyter version

_No response_

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/dates.py b/lib/matplotlib/dates.py
index 4d8ddf3ee5..0ee2287519 100644
--- a/lib/matplotlib/dates.py
+++ b/lib/matplotlib/dates.py
@@ -797,14 +797,24 @@ class ConciseDateFormatter(ticker.Formatter):
         # 3: hours, 4: minutes, 5: seconds, 6: microseconds
         for level in range(5, -1, -1):
             if len(np.unique(tickdate[:, level])) > 1:
-                if level < 2:
-                    show_offset = False
                 break
             elif level == 0:
                 # all tickdate are the same, so only micros might be different
                 # set to the most precise (6: microseconds doesn't exist...)
                 level = 5
 
+        # Decide whether to show the offset based on the determined level.
+        # For yearly labels, offset is redundant.
+        if level == 0:
+            show_offset = False
+        elif level == 1:
+            # For monthly labels, only suppress the offset if a January tick
+            # exists (zero-format will provide the year on that tick).
+            # If January is absent, keep the offset (typically showing the year)
+            # to ensure the axis conveys full date context.
+            if np.any(tickdate[:, 1] == 1):
+                show_offset = False
+
         # level is the basic level we will label at.
         # now loop through and decide the actual ticklabels
         zerovals = [0, 1, 1, 0, 0, 0, 0]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of lib/matplotlib/tests/test_dates.py.
Extra Requirements: 
Purpose: I need to find 3 relevant test cases for the `ConciseDateFormatter` bug, and this file should contain them.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_dates.py
Line number range: 1 - 500
Content:
1. import datetime
2. 
3. import dateutil.tz
4. import dateutil.rrule
5. import functools
6. import numpy as np
7. import pytest
8. 
9. from matplotlib import _api, rc_context, style
10. import matplotlib.dates as mdates
11. import matplotlib.pyplot as plt
12. from matplotlib.testing.decorators import image_comparison
13. import matplotlib.ticker as mticker
14. 
15. 
16. def test_date_numpyx():
17.     # test that numpy dates work properly...
18.     base = datetime.datetime(2017, 1, 1)
19.     time = [base + datetime.timedelta(days=x) for x in range(0, 3)]
20.     timenp = np.array(time, dtype='datetime64[ns]')
21.     data = np.array([0., 2., 1.])
22.     fig = plt.figure(figsize=(10, 2))
23.     ax = fig.add_subplot(1, 1, 1)
24.     h, = ax.plot(time, data)
25.     hnp, = ax.plot(timenp, data)
26.     np.testing.assert_equal(h.get_xdata(orig=False), hnp.get_xdata(orig=False))
27.     fig = plt.figure(figsize=(10, 2))
28.     ax = fig.add_subplot(1, 1, 1)
29.     h, = ax.plot(data, time)
30.     hnp, = ax.plot(data, timenp)
31.     np.testing.assert_equal(h.get_ydata(orig=False), hnp.get_ydata(orig=False))
32. 
33. 
34. @pytest.mark.parametrize('t0', [datetime.datetime(2017, 1, 1, 0, 1, 1),
35. 
36.                                 [datetime.datetime(2017, 1, 1, 0, 1, 1),
37.                                  datetime.datetime(2017, 1, 1, 1, 1, 1)],
38. 
39.                                 [[datetime.datetime(2017, 1, 1, 0, 1, 1),
40.                                   datetime.datetime(2017, 1, 1, 1, 1, 1)],
41.                                  [datetime.datetime(2017, 1, 1, 2, 1, 1),
42.                                   datetime.datetime(2017, 1, 1, 3, 1, 1)]]])
43. @pytest.mark.parametrize('dtype', ['datetime64[s]',
44.                                    'datetime64[us]',
45.                                    'datetime64[ms]',
46.                                    'datetime64[ns]'])
47. def test_date_date2num_numpy(t0, dtype):
48.     time = mdates.date2num(t0)
49.     tnp = np.array(t0, dtype=dtype)
50.     nptime = mdates.date2num(tnp)
51.     np.testing.assert_equal(time, nptime)
52. 
53. 
54. @pytest.mark.parametrize('dtype', ['datetime64[s]',
55.                                    'datetime64[us]',
56.                                    'datetime64[ms]',
57.                                    'datetime64[ns]'])
58. def test_date2num_NaT(dtype):
59.     t0 = datetime.datetime(2017, 1, 1, 0, 1, 1)
60.     tmpl = [mdates.date2num(t0), np.nan]
61.     tnp = np.array([t0, 'NaT'], dtype=dtype)
62.     nptime = mdates.date2num(tnp)
63.     np.testing.assert_array_equal(tmpl, nptime)
64. 
65. 
66. @pytest.mark.parametrize('units', ['s', 'ms', 'us', 'ns'])
67. def test_date2num_NaT_scalar(units):
68.     tmpl = mdates.date2num(np.datetime64('NaT', units))
69.     assert np.isnan(tmpl)
70. 
71. 
72. def test_date_empty():
73.     # make sure we do the right thing when told to plot dates even
74.     # if no date data has been presented, cf
75.     # http://sourceforge.net/tracker/?func=detail&aid=2850075&group_id=80706&atid=560720
76.     fig, ax = plt.subplots()
77.     ax.xaxis_date()
78.     fig.draw_without_rendering()
79.     np.testing.assert_allclose(ax.get_xlim(),
80.                                [mdates.date2num(np.datetime64('2000-01-01')),
81.                                 mdates.date2num(np.datetime64('2010-01-01'))])
82. 
83.     mdates._reset_epoch_test_example()
84.     mdates.set_epoch('0000-12-31')
85.     fig, ax = plt.subplots()
86.     ax.xaxis_date()
87.     fig.draw_without_rendering()
88.     np.testing.assert_allclose(ax.get_xlim(),
89.                                [mdates.date2num(np.datetime64('2000-01-01')),
90.                                 mdates.date2num(np.datetime64('2010-01-01'))])
91.     mdates._reset_epoch_test_example()
92. 
93. 
94. def test_date_not_empty():
95.     fig = plt.figure()
96.     ax = fig.add_subplot()
97. 
98.     ax.plot([50, 70], [1, 2])
99.     ax.xaxis.axis_date()
100.     np.testing.assert_allclose(ax.get_xlim(), [50, 70])
101. 
102. 
103. def test_axhline():
104.     # make sure that axhline doesn't set the xlimits...
105.     fig, ax = plt.subplots()
106.     ax.axhline(1.5)
107.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
108.     np.testing.assert_allclose(ax.get_xlim(),
109.                                [mdates.date2num(np.datetime64('2016-01-01')),
110.                                 mdates.date2num(np.datetime64('2016-01-02'))])
111. 
112.     mdates._reset_epoch_test_example()
113.     mdates.set_epoch('0000-12-31')
114.     fig, ax = plt.subplots()
115.     ax.axhline(1.5)
116.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
117.     np.testing.assert_allclose(ax.get_xlim(),
118.                                [mdates.date2num(np.datetime64('2016-01-01')),
119.                                 mdates.date2num(np.datetime64('2016-01-02'))])
120.     mdates._reset_epoch_test_example()
121. 
122. 
123. @image_comparison(['date_axhspan.png'])
124. def test_date_axhspan():
125.     # test axhspan with date inputs
126.     t0 = datetime.datetime(2009, 1, 20)
127.     tf = datetime.datetime(2009, 1, 21)
128.     fig, ax = plt.subplots()
129.     ax.axhspan(t0, tf, facecolor="blue", alpha=0.25)
130.     ax.set_ylim(t0 - datetime.timedelta(days=5),
131.                 tf + datetime.timedelta(days=5))
132.     fig.subplots_adjust(left=0.25)
133. 
134. 
135. @image_comparison(['date_axvspan.png'])
136. def test_date_axvspan():
137.     # test axvspan with date inputs
138.     t0 = datetime.datetime(2000, 1, 20)
139.     tf = datetime.datetime(2010, 1, 21)
140.     fig, ax = plt.subplots()
141.     ax.axvspan(t0, tf, facecolor="blue", alpha=0.25)
142.     ax.set_xlim(t0 - datetime.timedelta(days=720),
143.                 tf + datetime.timedelta(days=720))
144.     fig.autofmt_xdate()
145. 
146. 
147. @image_comparison(['date_axhline.png'])
148. def test_date_axhline():
149.     # test axhline with date inputs
150.     t0 = datetime.datetime(2009, 1, 20)
151.     tf = datetime.datetime(2009, 1, 31)
152.     fig, ax = plt.subplots()
153.     ax.axhline(t0, color="blue", lw=3)
154.     ax.set_ylim(t0 - datetime.timedelta(days=5),
155.                 tf + datetime.timedelta(days=5))
156.     fig.subplots_adjust(left=0.25)
157. 
158. 
159. @image_comparison(['date_axvline.png'])
160. def test_date_axvline():
161.     # test axvline with date inputs
162.     t0 = datetime.datetime(2000, 1, 20)
163.     tf = datetime.datetime(2000, 1, 21)
164.     fig, ax = plt.subplots()
165.     ax.axvline(t0, color="red", lw=3)
166.     ax.set_xlim(t0 - datetime.timedelta(days=5),
167.                 tf + datetime.timedelta(days=5))
168.     fig.autofmt_xdate()
169. 
170. 
171. def test_too_many_date_ticks(caplog):
172.     # Attempt to test SF 2715172, see
173.     # https://sourceforge.net/tracker/?func=detail&aid=2715172&group_id=80706&atid=560720
174.     # setting equal datetimes triggers and expander call in
175.     # transforms.nonsingular which results in too many ticks in the
176.     # DayLocator.  This should emit a log at WARNING level.
177.     caplog.set_level("WARNING")
178.     t0 = datetime.datetime(2000, 1, 20)
179.     tf = datetime.datetime(2000, 1, 20)
180.     fig, ax = plt.subplots()
181.     with pytest.warns(UserWarning) as rec:
182.         ax.set_xlim((t0, tf), auto=True)
183.         assert len(rec) == 1
184.         assert ('Attempting to set identical low and high xlims'
185.                 in str(rec[0].message))
186.     ax.plot([], [])
187.     ax.xaxis.set_major_locator(mdates.DayLocator())
188.     v = ax.xaxis.get_major_locator()()
189.     assert len(v) > 1000
190.     # The warning is emitted multiple times because the major locator is also
191.     # called both when placing the minor ticks (for overstriking detection) and
192.     # during tick label positioning.
193.     assert caplog.records and all(
194.         record.name == "matplotlib.ticker" and record.levelname == "WARNING"
195.         for record in caplog.records)
196.     assert len(caplog.records) > 0
197. 
198. 
199. def _new_epoch_decorator(thefunc):
200.     @functools.wraps(thefunc)
201.     def wrapper():
202.         mdates._reset_epoch_test_example()
203.         mdates.set_epoch('2000-01-01')
204.         thefunc()
205.         mdates._reset_epoch_test_example()
206.     return wrapper
207. 
208. 
209. @image_comparison(['RRuleLocator_bounds.png'])
210. def test_RRuleLocator():
211.     import matplotlib.testing.jpl_units as units
212.     units.register()
213.     # This will cause the RRuleLocator to go out of bounds when it tries
214.     # to add padding to the limits, so we make sure it caps at the correct
215.     # boundary values.
216.     t0 = datetime.datetime(1000, 1, 1)
217.     tf = datetime.datetime(6000, 1, 1)
218. 
219.     fig = plt.figure()
220.     ax = plt.subplot()
221.     ax.set_autoscale_on(True)
222.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
223. 
224.     rrule = mdates.rrulewrapper(dateutil.rrule.YEARLY, interval=500)
225.     locator = mdates.RRuleLocator(rrule)
226.     ax.xaxis.set_major_locator(locator)
227.     ax.xaxis.set_major_formatter(mdates.AutoDateFormatter(locator))
228. 
229.     ax.autoscale_view()
230.     fig.autofmt_xdate()
231. 
232. 
233. def test_RRuleLocator_dayrange():
234.     loc = mdates.DayLocator()
235.     x1 = datetime.datetime(year=1, month=1, day=1, tzinfo=mdates.UTC)
236.     y1 = datetime.datetime(year=1, month=1, day=16, tzinfo=mdates.UTC)
237.     loc.tick_values(x1, y1)
238.     # On success, no overflow error shall be thrown
239. 
240. 
241. def test_RRuleLocator_close_minmax():
242.     # if d1 and d2 are very close together, rrule cannot create
243.     # reasonable tick intervals; ensure that this is handled properly
244.     rrule = mdates.rrulewrapper(dateutil.rrule.SECONDLY, interval=5)
245.     loc = mdates.RRuleLocator(rrule)
246.     d1 = datetime.datetime(year=2020, month=1, day=1)
247.     d2 = datetime.datetime(year=2020, month=1, day=1, microsecond=1)
248.     expected = ['2020-01-01 00:00:00+00:00',
249.                 '2020-01-01 00:00:00.000001+00:00']
250.     assert list(map(str, mdates.num2date(loc.tick_values(d1, d2)))) == expected
251. 
252. 
253. @image_comparison(['DateFormatter_fractionalSeconds.png'])
254. def test_DateFormatter():
255.     import matplotlib.testing.jpl_units as units
256.     units.register()
257. 
258.     # Lets make sure that DateFormatter will allow us to have tick marks
259.     # at intervals of fractional seconds.
260. 
261.     t0 = datetime.datetime(2001, 1, 1, 0, 0, 0)
262.     tf = datetime.datetime(2001, 1, 1, 0, 0, 1)
263. 
264.     fig = plt.figure()
265.     ax = plt.subplot()
266.     ax.set_autoscale_on(True)
267.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
268. 
269.     # rrule = mpldates.rrulewrapper( dateutil.rrule.YEARLY, interval=500 )
270.     # locator = mpldates.RRuleLocator( rrule )
271.     # ax.xaxis.set_major_locator( locator )
272.     # ax.xaxis.set_major_formatter( mpldates.AutoDateFormatter(locator) )
273. 
274.     ax.autoscale_view()
275.     fig.autofmt_xdate()
276. 
277. 
278. def test_locator_set_formatter():
279.     """
280.     Test if setting the locator only will update the AutoDateFormatter to use
281.     the new locator.
282.     """
283.     plt.rcParams["date.autoformatter.minute"] = "%d %H:%M"
284.     t = [datetime.datetime(2018, 9, 30, 8, 0),
285.          datetime.datetime(2018, 9, 30, 8, 59),
286.          datetime.datetime(2018, 9, 30, 10, 30)]
287.     x = [2, 3, 1]
288. 
289.     fig, ax = plt.subplots()
290.     ax.plot(t, x)
291.     ax.xaxis.set_major_locator(mdates.MinuteLocator((0, 30)))
292.     fig.canvas.draw()
293.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels()]
294.     expected = ['30 08:00', '30 08:30', '30 09:00',
295.                 '30 09:30', '30 10:00', '30 10:30']
296.     assert ticklabels == expected
297. 
298.     ax.xaxis.set_major_locator(mticker.NullLocator())
299.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((5, 55)))
300.     decoy_loc = mdates.MinuteLocator((12, 27))
301.     ax.xaxis.set_minor_formatter(mdates.AutoDateFormatter(decoy_loc))
302. 
303.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((15, 45)))
304.     fig.canvas.draw()
305.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels(which="minor")]
306.     expected = ['30 08:15', '30 08:45', '30 09:15', '30 09:45', '30 10:15']
307.     assert ticklabels == expected
308. 
309. 
310. def test_date_formatter_callable():
311. 
312.     class _Locator:
313.         def _get_unit(self): return -11
314. 
315.     def callable_formatting_function(dates, _):
316.         return [dt.strftime('%d-%m//%Y') for dt in dates]
317. 
318.     formatter = mdates.AutoDateFormatter(_Locator())
319.     formatter.scaled[-10] = callable_formatting_function
320.     assert formatter([datetime.datetime(2014, 12, 25)]) == ['25-12//2014']
321. 
322. 
323. @pytest.mark.parametrize('delta, expected', [
324.     (datetime.timedelta(weeks=52 * 200),
325.      range(1990, 2171, 20)),
326.     (datetime.timedelta(days=30),
327.      ['1990-01-%02d' % day for day in range(1, 32, 3)]),
328.     (datetime.timedelta(hours=20),
329.      ['01-01 %02d' % hour for hour in range(0, 21, 2)]),
330.     (datetime.timedelta(minutes=10),
331.      ['01 00:%02d' % minu for minu in range(0, 11)]),
332. ])
333. def test_date_formatter_usetex(delta, expected):
334.     style.use("default")
335. 
336.     d1 = datetime.datetime(1990, 1, 1)
337.     d2 = d1 + delta
338. 
339.     locator = mdates.AutoDateLocator(interval_multiples=False)
340.     locator.create_dummy_axis()
341.     locator.axis.set_view_interval(mdates.date2num(d1), mdates.date2num(d2))
342. 
343.     formatter = mdates.AutoDateFormatter(locator, usetex=True)
344.     assert [formatter(loc) for loc in locator()] == [
345.         r'{\fontfamily{\familydefault}\selectfont %s}' % s for s in expected]
346. 
347. 
348. def test_drange():
349.     """
350.     This test should check if drange works as expected, and if all the
351.     rounding errors are fixed
352.     """
353.     start = datetime.datetime(2011, 1, 1, tzinfo=mdates.UTC)
354.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
355.     delta = datetime.timedelta(hours=1)
356.     # We expect 24 values in drange(start, end, delta), because drange returns
357.     # dates from an half open interval [start, end)
358.     assert len(mdates.drange(start, end, delta)) == 24
359. 
360.     # if end is a little bit later, we expect the range to contain one element
361.     # more
362.     end = end + datetime.timedelta(microseconds=1)
363.     assert len(mdates.drange(start, end, delta)) == 25
364. 
365.     # reset end
366.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
367. 
368.     # and tst drange with "complicated" floats:
369.     # 4 hours = 1/6 day, this is an "dangerous" float
370.     delta = datetime.timedelta(hours=4)
371.     daterange = mdates.drange(start, end, delta)
372.     assert len(daterange) == 6
373.     assert mdates.num2date(daterange[-1]) == (end - delta)
374. 
375. 
376. @_new_epoch_decorator
377. def test_auto_date_locator():
378.     def _create_auto_date_locator(date1, date2):
379.         locator = mdates.AutoDateLocator(interval_multiples=False)
380.         locator.create_dummy_axis()
381.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
382.         return locator
383. 
384.     d1 = datetime.datetime(1990, 1, 1)
385.     results = ([datetime.timedelta(weeks=52 * 200),
386.                 ['1990-01-01 00:00:00+00:00', '2010-01-01 00:00:00+00:00',
387.                  '2030-01-01 00:00:00+00:00', '2050-01-01 00:00:00+00:00',
388.                  '2070-01-01 00:00:00+00:00', '2090-01-01 00:00:00+00:00',
389.                  '2110-01-01 00:00:00+00:00', '2130-01-01 00:00:00+00:00',
390.                  '2150-01-01 00:00:00+00:00', '2170-01-01 00:00:00+00:00']
391.                 ],
392.                [datetime.timedelta(weeks=52),
393.                 ['1990-01-01 00:00:00+00:00', '1990-02-01 00:00:00+00:00',
394.                  '1990-03-01 00:00:00+00:00', '1990-04-01 00:00:00+00:00',
395.                  '1990-05-01 00:00:00+00:00', '1990-06-01 00:00:00+00:00',
396.                  '1990-07-01 00:00:00+00:00', '1990-08-01 00:00:00+00:00',
397.                  '1990-09-01 00:00:00+00:00', '1990-10-01 00:00:00+00:00',
398.                  '1990-11-01 00:00:00+00:00', '1990-12-01 00:00:00+00:00']
399.                 ],
400.                [datetime.timedelta(days=141),
401.                 ['1990-01-05 00:00:00+00:00', '1990-01-26 00:00:00+00:00',
402.                  '1990-02-16 00:00:00+00:00', '1990-03-09 00:00:00+00:00',
403.                  '1990-03-30 00:00:00+00:00', '1990-04-20 00:00:00+00:00',
404.                  '1990-05-11 00:00:00+00:00']
405.                 ],
406.                [datetime.timedelta(days=40),
407.                 ['1990-01-03 00:00:00+00:00', '1990-01-10 00:00:00+00:00',
408.                  '1990-01-17 00:00:00+00:00', '1990-01-24 00:00:00+00:00',
409.                  '1990-01-31 00:00:00+00:00', '1990-02-07 00:00:00+00:00']
410.                 ],
411.                [datetime.timedelta(hours=40),
412.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 04:00:00+00:00',
413.                  '1990-01-01 08:00:00+00:00', '1990-01-01 12:00:00+00:00',
414.                  '1990-01-01 16:00:00+00:00', '1990-01-01 20:00:00+00:00',
415.                  '1990-01-02 00:00:00+00:00', '1990-01-02 04:00:00+00:00',
416.                  '1990-01-02 08:00:00+00:00', '1990-01-02 12:00:00+00:00',
417.                  '1990-01-02 16:00:00+00:00']
418.                 ],
419.                [datetime.timedelta(minutes=20),
420.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:05:00+00:00',
421.                  '1990-01-01 00:10:00+00:00', '1990-01-01 00:15:00+00:00',
422.                  '1990-01-01 00:20:00+00:00']
423.                 ],
424.                [datetime.timedelta(seconds=40),
425.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:00:05+00:00',
426.                  '1990-01-01 00:00:10+00:00', '1990-01-01 00:00:15+00:00',
427.                  '1990-01-01 00:00:20+00:00', '1990-01-01 00:00:25+00:00',
428.                  '1990-01-01 00:00:30+00:00', '1990-01-01 00:00:35+00:00',
429.                  '1990-01-01 00:00:40+00:00']
430.                 ],
431.                [datetime.timedelta(microseconds=1500),
432.                 ['1989-12-31 23:59:59.999500+00:00',
433.                  '1990-01-01 00:00:00+00:00',
434.                  '1990-01-01 00:00:00.000500+00:00',
435.                  '1990-01-01 00:00:00.001000+00:00',
436.                  '1990-01-01 00:00:00.001500+00:00',
437.                  '1990-01-01 00:00:00.002000+00:00']
438.                 ],
439.                )
440. 
441.     for t_delta, expected in results:
442.         d2 = d1 + t_delta
443.         locator = _create_auto_date_locator(d1, d2)
444.         assert list(map(str, mdates.num2date(locator()))) == expected
445. 
446.     locator = mdates.AutoDateLocator(interval_multiples=False)
447.     assert locator.maxticks == {0: 11, 1: 12, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
448. 
449.     locator = mdates.AutoDateLocator(maxticks={dateutil.rrule.MONTHLY: 5})
450.     assert locator.maxticks == {0: 11, 1: 5, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
451. 
452.     locator = mdates.AutoDateLocator(maxticks=5)
453.     assert locator.maxticks == {0: 5, 1: 5, 3: 5, 4: 5, 5: 5, 6: 5, 7: 5}
454. 
455. 
456. @_new_epoch_decorator
457. def test_auto_date_locator_intmult():
458.     def _create_auto_date_locator(date1, date2):
459.         locator = mdates.AutoDateLocator(interval_multiples=True)
460.         locator.create_dummy_axis()
461.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
462.         return locator
463. 
464.     results = ([datetime.timedelta(weeks=52 * 200),
465.                 ['1980-01-01 00:00:00+00:00', '2000-01-01 00:00:00+00:00',
466.                  '2020-01-01 00:00:00+00:00', '2040-01-01 00:00:00+00:00',
467.                  '2060-01-01 00:00:00+00:00', '2080-01-01 00:00:00+00:00',
468.                  '2100-01-01 00:00:00+00:00', '2120-01-01 00:00:00+00:00',
469.                  '2140-01-01 00:00:00+00:00', '2160-01-01 00:00:00+00:00',
470.                  '2180-01-01 00:00:00+00:00', '2200-01-01 00:00:00+00:00']
471.                 ],
472.                [datetime.timedelta(weeks=52),
473.                 ['1997-01-01 00:00:00+00:00', '1997-02-01 00:00:00+00:00',
474.                  '1997-03-01 00:00:00+00:00', '1997-04-01 00:00:00+00:00',
475.                  '1997-05-01 00:00:00+00:00', '1997-06-01 00:00:00+00:00',
476.                  '1997-07-01 00:00:00+00:00', '1997-08-01 00:00:00+00:00',
477.                  '1997-09-01 00:00:00+00:00', '1997-10-01 00:00:00+00:00',
478.                  '1997-11-01 00:00:00+00:00', '1997-12-01 00:00:00+00:00']
479.                 ],
480.                [datetime.timedelta(days=141),
481.                 ['1997-01-01 00:00:00+00:00', '1997-01-15 00:00:00+00:00',
482.                  '1997-02-01 00:00:00+00:00', '1997-02-15 00:00:00+00:00',
483.                  '1997-03-01 00:00:00+00:00', '1997-03-15 00:00:00+00:00',
484.                  '1997-04-01 00:00:00+00:00', '1997-04-15 00:00:00+00:00',
485.                  '1997-05-01 00:00:00+00:00', '1997-05-15 00:00:00+00:00']
486.                 ],
487.                [datetime.timedelta(days=40),
488.                 ['1997-01-01 00:00:00+00:00', '1997-01-05 00:00:00+00:00',
489.                  '1997-01-09 00:00:00+00:00', '1997-01-13 00:00:00+00:00',
490.                  '1997-01-17 00:00:00+00:00', '1997-01-21 00:00:00+00:00',
491.                  '1997-01-25 00:00:00+00:00', '1997-01-29 00:00:00+00:00',
492.                  '1997-02-01 00:00:00+00:00', '1997-02-05 00:00:00+00:00',
493.                  '1997-02-09 00:00:00+00:00']
494.                 ],
495.                [datetime.timedelta(hours=40),
496.                 ['1997-01-01 00:00:00+00:00', '1997-01-01 04:00:00+00:00',
497.                  '1997-01-01 08:00:00+00:00', '1997-01-01 12:00:00+00:00',
498.                  '1997-01-01 16:00:00+00:00', '1997-01-01 20:00:00+00:00',
499.                  '1997-01-02 00:00:00+00:00', '1997-01-02 04:00:00+00:00',
500.                  '1997-01-02 08:00:00+00:00', '1997-01-02 12:00:00+00:00',


File: lib/matplotlib/tests/test_dates.py
Line number range: 532 - 540
Content:
532. def test_concise_formatter_subsecond():
533.     locator = mdates.AutoDateLocator(interval_multiples=True)
534.     formatter = mdates.ConciseDateFormatter(locator)
535.     year_1996 = 9861.0
536.     strings = formatter.format_ticks([
537.         year_1996,
538.         year_1996 + 500 / mdates.MUSECONDS_PER_DAY,
539.         year_1996 + 900 / mdates.MUSECONDS_PER_DAY])
540.     assert strings == ['00:00', '00.0005', '00.0009']


File: lib/matplotlib/tests/test_dates.py
Line number range: 592 - 613
Content:
592. @pytest.mark.parametrize('t_delta, expected', [
593.     (datetime.timedelta(seconds=0.01), '1997-Jan-01 00:00'),
594.     (datetime.timedelta(minutes=1), '1997-Jan-01 00:01'),
595.     (datetime.timedelta(hours=1), '1997-Jan-01'),
596.     (datetime.timedelta(days=1), '1997-Jan-02'),
597.     (datetime.timedelta(weeks=1), '1997-Jan'),
598.     (datetime.timedelta(weeks=26), ''),
599.     (datetime.timedelta(weeks=520), '')
600. ])
601. def test_concise_formatter_show_offset(t_delta, expected):
602.     d1 = datetime.datetime(1997, 1, 1)
603.     d2 = d1 + t_delta
604. 
605.     fig, ax = plt.subplots()
606.     locator = mdates.AutoDateLocator()
607.     formatter = mdates.ConciseDateFormatter(locator)
608.     ax.xaxis.set_major_locator(locator)
609.     ax.xaxis.set_major_formatter(formatter)
610. 
611.     ax.plot([d1, d2], [0, 0])
612.     fig.canvas.draw()
613.     assert formatter.get_offset() == expected


File: lib/matplotlib/tests/test_dates.py
Line number range: 616 - 635
Content:
616. def test_offset_changes():
617.     fig, ax = plt.subplots()
618. 
619.     d1 = datetime.datetime(1997, 1, 1)
620.     d2 = d1 + datetime.timedelta(weeks=520)
621. 
622.     locator = mdates.AutoDateLocator()
623.     formatter = mdates.ConciseDateFormatter(locator)
624.     ax.xaxis.set_major_locator(locator)
625.     ax.xaxis.set_major_formatter(formatter)
626. 
627.     ax.plot([d1, d2], [0, 0])
628.     fig.draw_without_rendering()
629.     assert formatter.get_offset() == ''
630.     ax.set_xlim(d1, d1 + datetime.timedelta(weeks=3))
631.     fig.draw_without_rendering()
632.     assert formatter.get_offset() == '1997-Jan'
633.     ax.set_xlim(d1, d1 + datetime.timedelta(weeks=520))
634.     fig.draw_without_rendering()
635.     assert formatter.get_offset() == ''


File: lib/matplotlib/tests/test_dates.py
Line number range: 1289 - 1300
Content:
1289. def test_concise_formatter_exceptions():
1290.     locator = mdates.AutoDateLocator()
1291.     with pytest.raises(ValueError, match="formats argument must be a list"):
1292.         mdates.ConciseDateFormatter(locator, formats=['', '%Y'])
1293. 
1294.     with pytest.raises(ValueError,
1295.                        match="zero_formats argument must be a list"):
1296.         mdates.ConciseDateFormatter(locator, zero_formats=['', '%Y'])
1297. 
1298.     with pytest.raises(ValueError,
1299.                        match="offset_formats argument must be a list"):
1300.         mdates.ConciseDateFormatter(locator, offset_formats=['', '%Y'])


File: lib/matplotlib/tests/test_dates.py
Line number range: 1303 - 1307
Content:
1303. def test_concise_formatter_call():
1304.     locator = mdates.AutoDateLocator()
1305.     formatter = mdates.ConciseDateFormatter(locator)
1306.     assert formatter(19002.0) == '2022'
1307.     assert formatter.format_data_short(19002.0) == '2022-01-10 00:00:00'

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-20 20:02:33,722 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have found two relevant tests for `ConciseDateFormatter`'s offset logic (`test_concise_formatter_show_offset` and `test_offset_changes`), but to find a third test case that is highly relevant to the visual bug, I need to see the image comparison tests which are not in the current context. The bug is about the visual output of the formatter, so an image comparison test would be the most relevant kind of test." query='Please provide all image comparison tests that use `ConciseDateFormatter` from `lib/matplotlib/tests/test_dates.py`.' extra_requirements='If no such tests exist, please provide any other tests from that file that use `ConciseDateFormatter` on a date range that does not include the month of January.' purpose='This will help find a third, highly relevant test case that either reproduces the bug or tests the intended behavior for the scenario described in the bug report.'
2025-12-20 20:02:33,723 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide all image comparison tests that use `ConciseDateFormatter` from `lib/matplotlib/tests/test_dates.py`.
2025-12-20 20:02:33,723 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-20 20:02:33,723 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-20 20:02:33,724 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-20 20:02:33,724 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide all image comparison tests that use `ConciseDateFormatter` from `lib/matplotlib/tests/test_dates.py`.
Extra requirements: If no such tests exist, please provide any other tests from that file that use `ConciseDateFormatter` on a date range that does not include the month of January.
Purpose: This will help find a third, highly relevant test case that either reproduces the bug or tests the intended behavior for the scenario described in the bug report.
2025-12-20 20:02:37,219 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will begin by searching for the file `lib/matplotlib/tests/test_dates.py` to confirm its location. Once found, I will look for all occurrences of `ConciseDateFormatter` within that file to identify any relevant tests. Finally, I will analyze the code of those tests to determine if they meet the specified criteria.' additional_kwargs={'function_call': {'name': 'find_file_node_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_dates.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2193, 'candidates_token_count': 95, 'total_token_count': 2465, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2193}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 95}], 'thoughts_token_count': 177, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1494618064478824, 'model_name': 'gemini-2.5-pro'} id='run--e023072d-4bc4-434d-9ea9-ca2ff515a817-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py'}, 'id': '8ed73b53-7b6e-4df3-b5cc-8061330bcd2d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2193, 'output_tokens': 95, 'total_tokens': 2465, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 177}}
2025-12-20 20:02:40,034 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have located the file `lib/matplotlib/tests/test_dates.py` and will now search for all occurrences of `ConciseDateFormatter` within it. This will allow me to identify the relevant tests and analyze their code to determine if they meet the specified criteria.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "ConciseDateFormatter", "relative_path": "lib/matplotlib/tests/test_dates.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2349, 'candidates_token_count': 95, 'total_token_count': 2577, 'cached_content_token_count': 1491, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2349}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1491}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 95}], 'thoughts_token_count': 133}, 'finish_reason': 'STOP', 'avg_logprobs': -0.14591169859233655, 'model_name': 'gemini-2.5-pro'} id='run--95388e71-978b-4544-8e4d-48f2a863aed7-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'ConciseDateFormatter', 'relative_path': 'lib/matplotlib/tests/test_dates.py'}, 'id': '1ca6b63d-50c1-4cf7-a03a-6bd4ad59df7d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2349, 'output_tokens': 95, 'total_tokens': 2577, 'input_token_details': {'cache_read': 1491}, 'output_token_details': {'reasoning': 133}}
2025-12-20 20:02:46,937 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have found five tests that use `ConciseDateFormatter` in `lib/matplotlib/tests/test_dates.py`. I will now read the entire file to analyze the context of these tests and determine which of them are image comparison tests and whether they use a date range that does not include the month of January, as requested.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_dates.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3966, 'candidates_token_count': 94, 'total_token_count': 4649, 'cached_content_token_count': 1621, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3966}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1621}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 589}, 'finish_reason': 'STOP', 'avg_logprobs': -0.888912687910364, 'model_name': 'gemini-2.5-pro'} id='run--ce38dc5d-ec15-46bc-9263-d11319fd8f1e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py'}, 'id': '4a640051-b04f-4cbc-8001-17fd2a2f146b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3966, 'output_tokens': 94, 'total_tokens': 4649, 'input_token_details': {'cache_read': 1621}, 'output_token_details': {'reasoning': 589}}
2025-12-20 20:02:49,611 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have reviewed the initial section of `lib/matplotlib/tests/test_dates.py` and located several tests that utilize `ConciseDateFormatter`. To ensure a comprehensive analysis and identify all relevant test cases, I will now proceed to examine the remainder of the file.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_dates.py", "end_line": 1001.0, "start_line": 501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 15685, 'candidates_token_count': 87, 'total_token_count': 15834, 'cached_content_token_count': 3755, 'prompt_tokens_details': [{'modality': 1, 'token_count': 15685}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3755}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 87}], 'thoughts_token_count': 62}, 'finish_reason': 'STOP', 'avg_logprobs': -0.147398444427841, 'model_name': 'gemini-2.5-pro'} id='run--08b1d936-3636-439a-b93d-818b7a0e6b02-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py', 'end_line': 1001.0, 'start_line': 501.0}, 'id': 'df43f8c1-9d17-4231-b563-5fd42f142bbb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15685, 'output_tokens': 87, 'total_tokens': 15834, 'input_token_details': {'cache_read': 3755}, 'output_token_details': {'reasoning': 62}}
2025-12-20 20:02:51,771 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now reviewed the first 1000 lines of the test file and have a better understanding of the tests that use `ConciseDateFormatter`. To complete my analysis, I will now read the rest of the file.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_dates.py", "end_line": 1501.0, "start_line": 1001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 27144, 'candidates_token_count': 78, 'total_token_count': 27222, 'cached_content_token_count': 15239, 'prompt_tokens_details': [{'modality': 1, 'token_count': 27144}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15239}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 78}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.09717617890773675, 'model_name': 'gemini-2.5-pro'} id='run--9c8a26e7-d462-4884-bf43-296fbf6a2ca4-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py', 'end_line': 1501.0, 'start_line': 1001.0}, 'id': 'cdc8af5d-b01c-49e1-a5a2-1bc1cbb1cfe1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27144, 'output_tokens': 78, 'total_tokens': 27222, 'input_token_details': {'cache_read': 15239}}
2025-12-20 20:03:28,268 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have completed a thorough analysis of the `lib/matplotlib/tests/test_dates.py` file to identify relevant test cases. My search for image comparison tests that use `ConciseDateFormatter` yielded no results. However, I did find a test that uses `ConciseDateFormatter` on a date range outside of January, which I have provided as a relevant example. All other tests using this formatter within the file appear to operate on dates in January.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 34266, 'candidates_token_count': 95, 'total_token_count': 38935, 'cached_content_token_count': 26893, 'prompt_tokens_details': [{'modality': 1, 'token_count': 34266}], 'cache_tokens_details': [{'modality': 1, 'token_count': 26893}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 95}], 'thoughts_token_count': 4574}, 'finish_reason': 'STOP', 'avg_logprobs': -5.03304154245477, 'model_name': 'gemini-2.5-pro'} id='run--f2a401e5-df56-4a7b-91b5-694db9a892cf-0' usage_metadata={'input_tokens': 34266, 'output_tokens': 95, 'total_tokens': 38935, 'input_token_details': {'cache_read': 26893}, 'output_token_details': {'reasoning': 4574}}
2025-12-20 20:03:28,271 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide all image comparison tests that use `ConciseDateFormatter` from `lib/matplotlib/tests/test_dates.py`.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If no such tests exist, please provide any other tests from that file that use `ConciseDateFormatter` on a date range that does not include the month of January.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
This will help find a third, highly relevant test case that either reproduces the bug or tests the intended behavior for the scenario described in the bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_dates.py
Line number range: 1 - 500
Content:
1. import datetime
2. 
3. import dateutil.tz
4. import dateutil.rrule
5. import functools
6. import numpy as np
7. import pytest
8. 
9. from matplotlib import _api, rc_context, style
10. import matplotlib.dates as mdates
11. import matplotlib.pyplot as plt
12. from matplotlib.testing.decorators import image_comparison
13. import matplotlib.ticker as mticker
14. 
15. 
16. def test_date_numpyx():
17.     # test that numpy dates work properly...
18.     base = datetime.datetime(2017, 1, 1)
19.     time = [base + datetime.timedelta(days=x) for x in range(0, 3)]
20.     timenp = np.array(time, dtype='datetime64[ns]')
21.     data = np.array([0., 2., 1.])
22.     fig = plt.figure(figsize=(10, 2))
23.     ax = fig.add_subplot(1, 1, 1)
24.     h, = ax.plot(time, data)
25.     hnp, = ax.plot(timenp, data)
26.     np.testing.assert_equal(h.get_xdata(orig=False), hnp.get_xdata(orig=False))
27.     fig = plt.figure(figsize=(10, 2))
28.     ax = fig.add_subplot(1, 1, 1)
29.     h, = ax.plot(data, time)
30.     hnp, = ax.plot(data, timenp)
31.     np.testing.assert_equal(h.get_ydata(orig=False), hnp.get_ydata(orig=False))
32. 
33. 
34. @pytest.mark.parametrize('t0', [datetime.datetime(2017, 1, 1, 0, 1, 1),
35. 
36.                                 [datetime.datetime(2017, 1, 1, 0, 1, 1),
37.                                  datetime.datetime(2017, 1, 1, 1, 1, 1)],
38. 
39.                                 [[datetime.datetime(2017, 1, 1, 0, 1, 1),
40.                                   datetime.datetime(2017, 1, 1, 1, 1, 1)],
41.                                  [datetime.datetime(2017, 1, 1, 2, 1, 1),
42.                                   datetime.datetime(2017, 1, 1, 3, 1, 1)]]])
43. @pytest.mark.parametrize('dtype', ['datetime64[s]',
44.                                    'datetime64[us]',
45.                                    'datetime64[ms]',
46.                                    'datetime64[ns]'])
47. def test_date_date2num_numpy(t0, dtype):
48.     time = mdates.date2num(t0)
49.     tnp = np.array(t0, dtype=dtype)
50.     nptime = mdates.date2num(tnp)
51.     np.testing.assert_equal(time, nptime)
52. 
53. 
54. @pytest.mark.parametrize('dtype', ['datetime64[s]',
55.                                    'datetime64[us]',
56.                                    'datetime64[ms]',
57.                                    'datetime64[ns]'])
58. def test_date2num_NaT(dtype):
59.     t0 = datetime.datetime(2017, 1, 1, 0, 1, 1)
60.     tmpl = [mdates.date2num(t0), np.nan]
61.     tnp = np.array([t0, 'NaT'], dtype=dtype)
62.     nptime = mdates.date2num(tnp)
63.     np.testing.assert_array_equal(tmpl, nptime)
64. 
65. 
66. @pytest.mark.parametrize('units', ['s', 'ms', 'us', 'ns'])
67. def test_date2num_NaT_scalar(units):
68.     tmpl = mdates.date2num(np.datetime64('NaT', units))
69.     assert np.isnan(tmpl)
70. 
71. 
72. def test_date_empty():
73.     # make sure we do the right thing when told to plot dates even
74.     # if no date data has been presented, cf
75.     # http://sourceforge.net/tracker/?func=detail&aid=2850075&group_id=80706&atid=560720
76.     fig, ax = plt.subplots()
77.     ax.xaxis_date()
78.     fig.draw_without_rendering()
79.     np.testing.assert_allclose(ax.get_xlim(),
80.                                [mdates.date2num(np.datetime64('2000-01-01')),
81.                                 mdates.date2num(np.datetime64('2010-01-01'))])
82. 
83.     mdates._reset_epoch_test_example()
84.     mdates.set_epoch('0000-12-31')
85.     fig, ax = plt.subplots()
86.     ax.xaxis_date()
87.     fig.draw_without_rendering()
88.     np.testing.assert_allclose(ax.get_xlim(),
89.                                [mdates.date2num(np.datetime64('2000-01-01')),
90.                                 mdates.date2num(np.datetime64('2010-01-01'))])
91.     mdates._reset_epoch_test_example()
92. 
93. 
94. def test_date_not_empty():
95.     fig = plt.figure()
96.     ax = fig.add_subplot()
97. 
98.     ax.plot([50, 70], [1, 2])
99.     ax.xaxis.axis_date()
100.     np.testing.assert_allclose(ax.get_xlim(), [50, 70])
101. 
102. 
103. def test_axhline():
104.     # make sure that axhline doesn't set the xlimits...
105.     fig, ax = plt.subplots()
106.     ax.axhline(1.5)
107.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
108.     np.testing.assert_allclose(ax.get_xlim(),
109.                                [mdates.date2num(np.datetime64('2016-01-01')),
110.                                 mdates.date2num(np.datetime64('2016-01-02'))])
111. 
112.     mdates._reset_epoch_test_example()
113.     mdates.set_epoch('0000-12-31')
114.     fig, ax = plt.subplots()
115.     ax.axhline(1.5)
116.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
117.     np.testing.assert_allclose(ax.get_xlim(),
118.                                [mdates.date2num(np.datetime64('2016-01-01')),
119.                                 mdates.date2num(np.datetime64('2016-01-02'))])
120.     mdates._reset_epoch_test_example()
121. 
122. 
123. @image_comparison(['date_axhspan.png'])
124. def test_date_axhspan():
125.     # test axhspan with date inputs
126.     t0 = datetime.datetime(2009, 1, 20)
127.     tf = datetime.datetime(2009, 1, 21)
128.     fig, ax = plt.subplots()
129.     ax.axhspan(t0, tf, facecolor="blue", alpha=0.25)
130.     ax.set_ylim(t0 - datetime.timedelta(days=5),
131.                 tf + datetime.timedelta(days=5))
132.     fig.subplots_adjust(left=0.25)
133. 
134. 
135. @image_comparison(['date_axvspan.png'])
136. def test_date_axvspan():
137.     # test axvspan with date inputs
138.     t0 = datetime.datetime(2000, 1, 20)
139.     tf = datetime.datetime(2010, 1, 21)
140.     fig, ax = plt.subplots()
141.     ax.axvspan(t0, tf, facecolor="blue", alpha=0.25)
142.     ax.set_xlim(t0 - datetime.timedelta(days=720),
143.                 tf + datetime.timedelta(days=720))
144.     fig.autofmt_xdate()
145. 
146. 
147. @image_comparison(['date_axhline.png'])
148. def test_date_axhline():
149.     # test axhline with date inputs
150.     t0 = datetime.datetime(2009, 1, 20)
151.     tf = datetime.datetime(2009, 1, 31)
152.     fig, ax = plt.subplots()
153.     ax.axhline(t0, color="blue", lw=3)
154.     ax.set_ylim(t0 - datetime.timedelta(days=5),
155.                 tf + datetime.timedelta(days=5))
156.     fig.subplots_adjust(left=0.25)
157. 
158. 
159. @image_comparison(['date_axvline.png'])
160. def test_date_axvline():
161.     # test axvline with date inputs
162.     t0 = datetime.datetime(2000, 1, 20)
163.     tf = datetime.datetime(2000, 1, 21)
164.     fig, ax = plt.subplots()
165.     ax.axvline(t0, color="red", lw=3)
166.     ax.set_xlim(t0 - datetime.timedelta(days=5),
167.                 tf + datetime.timedelta(days=5))
168.     fig.autofmt_xdate()
169. 
170. 
171. def test_too_many_date_ticks(caplog):
172.     # Attempt to test SF 2715172, see
173.     # https://sourceforge.net/tracker/?func=detail&aid=2715172&group_id=80706&atid=560720
174.     # setting equal datetimes triggers and expander call in
175.     # transforms.nonsingular which results in too many ticks in the
176.     # DayLocator.  This should emit a log at WARNING level.
177.     caplog.set_level("WARNING")
178.     t0 = datetime.datetime(2000, 1, 20)
179.     tf = datetime.datetime(2000, 1, 20)
180.     fig, ax = plt.subplots()
181.     with pytest.warns(UserWarning) as rec:
182.         ax.set_xlim((t0, tf), auto=True)
183.         assert len(rec) == 1
184.         assert ('Attempting to set identical low and high xlims'
185.                 in str(rec[0].message))
186.     ax.plot([], [])
187.     ax.xaxis.set_major_locator(mdates.DayLocator())
188.     v = ax.xaxis.get_major_locator()()
189.     assert len(v) > 1000
190.     # The warning is emitted multiple times because the major locator is also
191.     # called both when placing the minor ticks (for overstriking detection) and
192.     # during tick label positioning.
193.     assert caplog.records and all(
194.         record.name == "matplotlib.ticker" and record.levelname == "WARNING"
195.         for record in caplog.records)
196.     assert len(caplog.records) > 0
197. 
198. 
199. def _new_epoch_decorator(thefunc):
200.     @functools.wraps(thefunc)
201.     def wrapper():
202.         mdates._reset_epoch_test_example()
203.         mdates.set_epoch('2000-01-01')
204.         thefunc()
205.         mdates._reset_epoch_test_example()
206.     return wrapper
207. 
208. 
209. @image_comparison(['RRuleLocator_bounds.png'])
210. def test_RRuleLocator():
211.     import matplotlib.testing.jpl_units as units
212.     units.register()
213.     # This will cause the RRuleLocator to go out of bounds when it tries
214.     # to add padding to the limits, so we make sure it caps at the correct
215.     # boundary values.
216.     t0 = datetime.datetime(1000, 1, 1)
217.     tf = datetime.datetime(6000, 1, 1)
218. 
219.     fig = plt.figure()
220.     ax = plt.subplot()
221.     ax.set_autoscale_on(True)
222.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
223. 
224.     rrule = mdates.rrulewrapper(dateutil.rrule.YEARLY, interval=500)
225.     locator = mdates.RRuleLocator(rrule)
226.     ax.xaxis.set_major_locator(locator)
227.     ax.xaxis.set_major_formatter(mdates.AutoDateFormatter(locator))
228. 
229.     ax.autoscale_view()
230.     fig.autofmt_xdate()
231. 
232. 
233. def test_RRuleLocator_dayrange():
234.     loc = mdates.DayLocator()
235.     x1 = datetime.datetime(year=1, month=1, day=1, tzinfo=mdates.UTC)
236.     y1 = datetime.datetime(year=1, month=1, day=16, tzinfo=mdates.UTC)
237.     loc.tick_values(x1, y1)
238.     # On success, no overflow error shall be thrown
239. 
240. 
241. def test_RRuleLocator_close_minmax():
242.     # if d1 and d2 are very close together, rrule cannot create
243.     # reasonable tick intervals; ensure that this is handled properly
244.     rrule = mdates.rrulewrapper(dateutil.rrule.SECONDLY, interval=5)
245.     loc = mdates.RRuleLocator(rrule)
246.     d1 = datetime.datetime(year=2020, month=1, day=1)
247.     d2 = datetime.datetime(year=2020, month=1, day=1, microsecond=1)
248.     expected = ['2020-01-01 00:00:00+00:00',
249.                 '2020-01-01 00:00:00.000001+00:00']
250.     assert list(map(str, mdates.num2date(loc.tick_values(d1, d2)))) == expected
251. 
252. 
253. @image_comparison(['DateFormatter_fractionalSeconds.png'])
254. def test_DateFormatter():
255.     import matplotlib.testing.jpl_units as units
256.     units.register()
257. 
258.     # Lets make sure that DateFormatter will allow us to have tick marks
259.     # at intervals of fractional seconds.
260. 
261.     t0 = datetime.datetime(2001, 1, 1, 0, 0, 0)
262.     tf = datetime.datetime(2001, 1, 1, 0, 0, 1)
263. 
264.     fig = plt.figure()
265.     ax = plt.subplot()
266.     ax.set_autoscale_on(True)
267.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
268. 
269.     # rrule = mpldates.rrulewrapper( dateutil.rrule.YEARLY, interval=500 )
270.     # locator = mpldates.RRuleLocator( rrule )
271.     # ax.xaxis.set_major_locator( locator )
272.     # ax.xaxis.set_major_formatter( mpldates.AutoDateFormatter(locator) )
273. 
274.     ax.autoscale_view()
275.     fig.autofmt_xdate()
276. 
277. 
278. def test_locator_set_formatter():
279.     """
280.     Test if setting the locator only will update the AutoDateFormatter to use
281.     the new locator.
282.     """
283.     plt.rcParams["date.autoformatter.minute"] = "%d %H:%M"
284.     t = [datetime.datetime(2018, 9, 30, 8, 0),
285.          datetime.datetime(2018, 9, 30, 8, 59),
286.          datetime.datetime(2018, 9, 30, 10, 30)]
287.     x = [2, 3, 1]
288. 
289.     fig, ax = plt.subplots()
290.     ax.plot(t, x)
291.     ax.xaxis.set_major_locator(mdates.MinuteLocator((0, 30)))
292.     fig.canvas.draw()
293.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels()]
294.     expected = ['30 08:00', '30 08:30', '30 09:00',
295.                 '30 09:30', '30 10:00', '30 10:30']
296.     assert ticklabels == expected
297. 
298.     ax.xaxis.set_major_locator(mticker.NullLocator())
299.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((5, 55)))
300.     decoy_loc = mdates.MinuteLocator((12, 27))
301.     ax.xaxis.set_minor_formatter(mdates.AutoDateFormatter(decoy_loc))
302. 
303.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((15, 45)))
304.     fig.canvas.draw()
305.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels(which="minor")]
306.     expected = ['30 08:15', '30 08:45', '30 09:15', '30 09:45', '30 10:15']
307.     assert ticklabels == expected
308. 
309. 
310. def test_date_formatter_callable():
311. 
312.     class _Locator:
313.         def _get_unit(self): return -11
314. 
315.     def callable_formatting_function(dates, _):
316.         return [dt.strftime('%d-%m//%Y') for dt in dates]
317. 
318.     formatter = mdates.AutoDateFormatter(_Locator())
319.     formatter.scaled[-10] = callable_formatting_function
320.     assert formatter([datetime.datetime(2014, 12, 25)]) == ['25-12//2014']
321. 
322. 
323. @pytest.mark.parametrize('delta, expected', [
324.     (datetime.timedelta(weeks=52 * 200),
325.      range(1990, 2171, 20)),
326.     (datetime.timedelta(days=30),
327.      ['1990-01-%02d' % day for day in range(1, 32, 3)]),
328.     (datetime.timedelta(hours=20),
329.      ['01-01 %02d' % hour for hour in range(0, 21, 2)]),
330.     (datetime.timedelta(minutes=10),
331.      ['01 00:%02d' % minu for minu in range(0, 11)]),
332. ])
333. def test_date_formatter_usetex(delta, expected):
334.     style.use("default")
335. 
336.     d1 = datetime.datetime(1990, 1, 1)
337.     d2 = d1 + delta
338. 
339.     locator = mdates.AutoDateLocator(interval_multiples=False)
340.     locator.create_dummy_axis()
341.     locator.axis.set_view_interval(mdates.date2num(d1), mdates.date2num(d2))
342. 
343.     formatter = mdates.AutoDateFormatter(locator, usetex=True)
344.     assert [formatter(loc) for loc in locator()] == [
345.         r'{\fontfamily{\familydefault}\selectfont %s}' % s for s in expected]
346. 
347. 
348. def test_drange():
349.     """
350.     This test should check if drange works as expected, and if all the
351.     rounding errors are fixed
352.     """
353.     start = datetime.datetime(2011, 1, 1, tzinfo=mdates.UTC)
354.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
355.     delta = datetime.timedelta(hours=1)
356.     # We expect 24 values in drange(start, end, delta), because drange returns
357.     # dates from an half open interval [start, end)
358.     assert len(mdates.drange(start, end, delta)) == 24
359. 
360.     # if end is a little bit later, we expect the range to contain one element
361.     # more
362.     end = end + datetime.timedelta(microseconds=1)
363.     assert len(mdates.drange(start, end, delta)) == 25
364. 
365.     # reset end
366.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
367. 
368.     # and tst drange with "complicated" floats:
369.     # 4 hours = 1/6 day, this is an "dangerous" float
370.     delta = datetime.timedelta(hours=4)
371.     daterange = mdates.drange(start, end, delta)
372.     assert len(daterange) == 6
373.     assert mdates.num2date(daterange[-1]) == (end - delta)
374. 
375. 
376. @_new_epoch_decorator
377. def test_auto_date_locator():
378.     def _create_auto_date_locator(date1, date2):
379.         locator = mdates.AutoDateLocator(interval_multiples=False)
380.         locator.create_dummy_axis()
381.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
382.         return locator
383. 
384.     d1 = datetime.datetime(1990, 1, 1)
385.     results = ([datetime.timedelta(weeks=52 * 200),
386.                 ['1990-01-01 00:00:00+00:00', '2010-01-01 00:00:00+00:00',
387.                  '2030-01-01 00:00:00+00:00', '2050-01-01 00:00:00+00:00',
388.                  '2070-01-01 00:00:00+00:00', '2090-01-01 00:00:00+00:00',
389.                  '2110-01-01 00:00:00+00:00', '2130-01-01 00:00:00+00:00',
390.                  '2150-01-01 00:00:00+00:00', '2170-01-01 00:00:00+00:00']
391.                 ],
392.                [datetime.timedelta(weeks=52),
393.                 ['1990-01-01 00:00:00+00:00', '1990-02-01 00:00:00+00:00',
394.                  '1990-03-01 00:00:00+00:00', '1990-04-01 00:00:00+00:00',
395.                  '1990-05-01 00:00:00+00:00', '1990-06-01 00:00:00+00:00',
396.                  '1990-07-01 00:00:00+00:00', '1990-08-01 00:00:00+00:00',
397.                  '1990-09-01 00:00:00+00:00', '1990-10-01 00:00:00+00:00',
398.                  '1990-11-01 00:00:00+00:00', '1990-12-01 00:00:00+00:00']
399.                 ],
400.                [datetime.timedelta(days=141),
401.                 ['1990-01-05 00:00:00+00:00', '1990-01-26 00:00:00+00:00',
402.                  '1990-02-16 00:00:00+00:00', '1990-03-09 00:00:00+00:00',
403.                  '1990-03-30 00:00:00+00:00', '1990-04-20 00:00:00+00:00',
404.                  '1990-05-11 00:00:00+00:00']
405.                 ],
406.                [datetime.timedelta(days=40),
407.                 ['1990-01-03 00:00:00+00:00', '1990-01-10 00:00:00+00:00',
408.                  '1990-01-17 00:00:00+00:00', '1990-01-24 00:00:00+00:00',
409.                  '1990-01-31 00:00:00+00:00', '1990-02-07 00:00:00+00:00']
410.                 ],
411.                [datetime.timedelta(hours=40),
412.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 04:00:00+00:00',
413.                  '1990-01-01 08:00:00+00:00', '1990-01-01 12:00:00+00:00',
414.                  '1990-01-01 16:00:00+00:00', '1990-01-01 20:00:00+00:00',
415.                  '1990-01-02 00:00:00+00:00', '1990-01-02 04:00:00+00:00',
416.                  '1990-01-02 08:00:00+00:00', '1990-01-02 12:00:00+00:00',
417.                  '1990-01-02 16:00:00+00:00']
418.                 ],
419.                [datetime.timedelta(minutes=20),
420.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:05:00+00:00',
421.                  '1990-01-01 00:10:00+00:00', '1990-01-01 00:15:00+00:00',
422.                  '1990-01-01 00:20:00+00:00']
423.                 ],
424.                [datetime.timedelta(seconds=40),
425.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:00:05+00:00',
426.                  '1990-01-01 00:00:10+00:00', '1990-01-01 00:00:15+00:00',
427.                  '1990-01-01 00:00:20+00:00', '1990-01-01 00:00:25+00:00',
428.                  '1990-01-01 00:00:30+00:00', '1990-01-01 00:00:35+00:00',
429.                  '1990-01-01 00:00:40+00:00']
430.                 ],
431.                [datetime.timedelta(microseconds=1500),
432.                 ['1989-12-31 23:59:59.999500+00:00',
433.                  '1990-01-01 00:00:00+00:00',
434.                  '1990-01-01 00:00:00.000500+00:00',
435.                  '1990-01-01 00:00:00.001000+00:00',
436.                  '1990-01-01 00:00:00.001500+00:00',
437.                  '1990-01-01 00:00:00.002000+00:00']
438.                 ],
439.                )
440. 
441.     for t_delta, expected in results:
442.         d2 = d1 + t_delta
443.         locator = _create_auto_date_locator(d1, d2)
444.         assert list(map(str, mdates.num2date(locator()))) == expected
445. 
446.     locator = mdates.AutoDateLocator(interval_multiples=False)
447.     assert locator.maxticks == {0: 11, 1: 12, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
448. 
449.     locator = mdates.AutoDateLocator(maxticks={dateutil.rrule.MONTHLY: 5})
450.     assert locator.maxticks == {0: 11, 1: 5, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
451. 
452.     locator = mdates.AutoDateLocator(maxticks=5)
453.     assert locator.maxticks == {0: 5, 1: 5, 3: 5, 4: 5, 5: 5, 6: 5, 7: 5}
454. 
455. 
456. @_new_epoch_decorator
457. def test_auto_date_locator_intmult():
458.     def _create_auto_date_locator(date1, date2):
459.         locator = mdates.AutoDateLocator(interval_multiples=True)
460.         locator.create_dummy_axis()
461.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
462.         return locator
463. 
464.     results = ([datetime.timedelta(weeks=52 * 200),
465.                 ['1980-01-01 00:00:00+00:00', '2000-01-01 00:00:00+00:00',
466.                  '2020-01-01 00:00:00+00:00', '2040-01-01 00:00:00+00:00',
467.                  '2060-01-01 00:00:00+00:00', '2080-01-01 00:00:00+00:00',
468.                  '2100-01-01 00:00:00+00:00', '2120-01-01 00:00:00+00:00',
469.                  '2140-01-01 00:00:00+00:00', '2160-01-01 00:00:00+00:00',
470.                  '2180-01-01 00:00:00+00:00', '2200-01-01 00:00:00+00:00']
471.                 ],
472.                [datetime.timedelta(weeks=52),
473.                 ['1997-01-01 00:00:00+00:00', '1997-02-01 00:00:00+00:00',
474.                  '1997-03-01 00:00:00+00:00', '1997-04-01 00:00:00+00:00',
475.                  '1997-05-01 00:00:00+00:00', '1997-06-01 00:00:00+00:00',
476.                  '1997-07-01 00:00:00+00:00', '1997-08-01 00:00:00+00:00',
477.                  '1997-09-01 00:00:00+00:00', '1997-10-01 00:00:00+00:00',
478.                  '1997-11-01 00:00:00+00:00', '1997-12-01 00:00:00+00:00']
479.                 ],
480.                [datetime.timedelta(days=141),
481.                 ['1997-01-01 00:00:00+00:00', '1997-01-15 00:00:00+00:00',
482.                  '1997-02-01 00:00:00+00:00', '1997-02-15 00:00:00+00:00',
483.                  '1997-03-01 00:00:00+00:00', '1997-03-15 00:00:00+00:00',
484.                  '1997-04-01 00:00:00+00:00', '1997-04-15 00:00:00+00:00',
485.                  '1997-05-01 00:00:00+00:00', '1997-05-15 00:00:00+00:00']
486.                 ],
487.                [datetime.timedelta(days=40),
488.                 ['1997-01-01 00:00:00+00:00', '1997-01-05 00:00:00+00:00',
489.                  '1997-01-09 00:00:00+00:00', '1997-01-13 00:00:00+00:00',
490.                  '1997-01-17 00:00:00+00:00', '1997-01-21 00:00:00+00:00',
491.                  '1997-01-25 00:00:00+00:00', '1997-01-29 00:00:00+00:00',
492.                  '1997-02-01 00:00:00+00:00', '1997-02-05 00:00:00+00:00',
493.                  '1997-02-09 00:00:00+00:00']
494.                 ],
495.                [datetime.timedelta(hours=40),
496.                 ['1997-01-01 00:00:00+00:00', '1997-01-01 04:00:00+00:00',
497.                  '1997-01-01 08:00:00+00:00', '1997-01-01 12:00:00+00:00',
498.                  '1997-01-01 16:00:00+00:00', '1997-01-01 20:00:00+00:00',
499.                  '1997-01-02 00:00:00+00:00', '1997-01-02 04:00:00+00:00',
500.                  '1997-01-02 08:00:00+00:00', '1997-01-02 12:00:00+00:00',


File: lib/matplotlib/tests/test_dates.py
Line number range: 501 - 1001
Content:
501.                  '1997-01-02 16:00:00+00:00']
502.                 ],
503.                [datetime.timedelta(minutes=20),
504.                 ['1997-01-01 00:00:00+00:00', '1997-01-01 00:05:00+00:00',
505.                  '1997-01-01 00:10:00+00:00', '1997-01-01 00:15:00+00:00',
506.                  '1997-01-01 00:20:00+00:00']
507.                 ],
508.                [datetime.timedelta(seconds=40),
509.                 ['1997-01-01 00:00:00+00:00', '1997-01-01 00:00:05+00:00',
510.                  '1997-01-01 00:00:10+00:00', '1997-01-01 00:00:15+00:00',
511.                  '1997-01-01 00:00:20+00:00', '1997-01-01 00:00:25+00:00',
512.                  '1997-01-01 00:00:30+00:00', '1997-01-01 00:00:35+00:00',
513.                  '1997-01-01 00:00:40+00:00']
514.                 ],
515.                [datetime.timedelta(microseconds=1500),
516.                 ['1996-12-31 23:59:59.999500+00:00',
517.                  '1997-01-01 00:00:00+00:00',
518.                  '1997-01-01 00:00:00.000500+00:00',
519.                  '1997-01-01 00:00:00.001000+00:00',
520.                  '1997-01-01 00:00:00.001500+00:00',
521.                  '1997-01-01 00:00:00.002000+00:00']
522.                 ],
523.                )
524. 
525.     d1 = datetime.datetime(1997, 1, 1)
526.     for t_delta, expected in results:
527.         d2 = d1 + t_delta
528.         locator = _create_auto_date_locator(d1, d2)
529.         assert list(map(str, mdates.num2date(locator()))) == expected
530. 
531. 
532. def test_concise_formatter_subsecond():
533.     locator = mdates.AutoDateLocator(interval_multiples=True)
534.     formatter = mdates.ConciseDateFormatter(locator)
535.     year_1996 = 9861.0
536.     strings = formatter.format_ticks([
537.         year_1996,
538.         year_1996 + 500 / mdates.MUSECONDS_PER_DAY,
539.         year_1996 + 900 / mdates.MUSECONDS_PER_DAY])
540.     assert strings == ['00:00', '00.0005', '00.0009']
541. 
542. 
543. def test_concise_formatter():
544.     def _create_auto_date_locator(date1, date2):
545.         fig, ax = plt.subplots()
546. 
547.         locator = mdates.AutoDateLocator(interval_multiples=True)
548.         formatter = mdates.ConciseDateFormatter(locator)
549.         ax.yaxis.set_major_locator(locator)
550.         ax.yaxis.set_major_formatter(formatter)
551.         ax.set_ylim(date1, date2)
552.         fig.canvas.draw()
553.         sts = [st.get_text() for st in ax.get_yticklabels()]
554.         return sts
555. 
556.     d1 = datetime.datetime(1997, 1, 1)
557.     results = ([datetime.timedelta(weeks=52 * 200),
558.                 [str(t) for t in range(1980, 2201, 20)]
559.                 ],
560.                [datetime.timedelta(weeks=52),
561.                 ['1997', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug',
562.                  'Sep', 'Oct', 'Nov', 'Dec']
563.                 ],
564.                [datetime.timedelta(days=141),
565.                 ['Jan', '15', 'Feb', '15', 'Mar', '15', 'Apr', '15',
566.                  'May', '15']
567.                 ],
568.                [datetime.timedelta(days=40),
569.                 ['Jan', '05', '09', '13', '17', '21', '25', '29', 'Feb',
570.                  '05', '09']
571.                 ],
572.                [datetime.timedelta(hours=40),
573.                 ['Jan-01', '04:00', '08:00', '12:00', '16:00', '20:00',
574.                  'Jan-02', '04:00', '08:00', '12:00', '16:00']
575.                 ],
576.                [datetime.timedelta(minutes=20),
577.                 ['00:00', '00:05', '00:10', '00:15', '00:20']
578.                 ],
579.                [datetime.timedelta(seconds=40),
580.                 ['00:00', '05', '10', '15', '20', '25', '30', '35', '40']
581.                 ],
582.                [datetime.timedelta(seconds=2),
583.                 ['59.5', '00:00', '00.5', '01.0', '01.5', '02.0', '02.5']
584.                 ],
585.                )
586.     for t_delta, expected in results:
587.         d2 = d1 + t_delta
588.         strings = _create_auto_date_locator(d1, d2)
589.         assert strings == expected
590. 
591. 
592. @pytest.mark.parametrize('t_delta, expected', [
593.     (datetime.timedelta(seconds=0.01), '1997-Jan-01 00:00'),
594.     (datetime.timedelta(minutes=1), '1997-Jan-01 00:01'),
595.     (datetime.timedelta(hours=1), '1997-Jan-01'),
596.     (datetime.timedelta(days=1), '1997-Jan-02'),
597.     (datetime.timedelta(weeks=1), '1997-Jan'),
598.     (datetime.timedelta(weeks=26), ''),
599.     (datetime.timedelta(weeks=520), '')
600. ])
601. def test_concise_formatter_show_offset(t_delta, expected):
602.     d1 = datetime.datetime(1997, 1, 1)
603.     d2 = d1 + t_delta
604. 
605.     fig, ax = plt.subplots()
606.     locator = mdates.AutoDateLocator()
607.     formatter = mdates.ConciseDateFormatter(locator)
608.     ax.xaxis.set_major_locator(locator)
609.     ax.xaxis.set_major_formatter(formatter)
610. 
611.     ax.plot([d1, d2], [0, 0])
612.     fig.canvas.draw()
613.     assert formatter.get_offset() == expected
614. 
615. 
616. def test_offset_changes():
617.     fig, ax = plt.subplots()
618. 
619.     d1 = datetime.datetime(1997, 1, 1)
620.     d2 = d1 + datetime.timedelta(weeks=520)
621. 
622.     locator = mdates.AutoDateLocator()
623.     formatter = mdates.ConciseDateFormatter(locator)
624.     ax.xaxis.set_major_locator(locator)
625.     ax.xaxis.set_major_formatter(formatter)
626. 
627.     ax.plot([d1, d2], [0, 0])
628.     fig.draw_without_rendering()
629.     assert formatter.get_offset() == ''
630.     ax.set_xlim(d1, d1 + datetime.timedelta(weeks=3))
631.     fig.draw_without_rendering()
632.     assert formatter.get_offset() == '1997-Jan'
633.     ax.set_xlim(d1, d1 + datetime.timedelta(weeks=520))
634.     fig.draw_without_rendering()
635.     assert formatter.get_offset() == ''
636. 
637. 
638. @pytest.mark.parametrize('t_delta, expected', [
639.     (datetime.timedelta(weeks=52 * 200),
640.      range(1980, 2201, 20)),
641.     (datetime.timedelta(days=40),
642.      ['Jan', '05', '09', '13', '17', '21', '25', '29', 'Feb', '05', '09']),
643.     (datetime.timedelta(hours=40),
644.      ['Jan-01', '04:00', '08:00', '12:00', '16:00', '20:00',
645.       'Jan-02', '04:00', '08:00', '12:00', '16:00']),
646.     (datetime.timedelta(seconds=2),
647.      ['59.5', '00:00', '00.5', '01.0', '01.5', '02.0', '02.5']),
648. ])
649. def test_concise_formatter_usetex(t_delta, expected):
650.     d1 = datetime.datetime(1997, 1, 1)
651.     d2 = d1 + t_delta
652. 
653.     locator = mdates.AutoDateLocator(interval_multiples=True)
654.     locator.create_dummy_axis()
655.     locator.axis.set_view_interval(mdates.date2num(d1), mdates.date2num(d2))
656. 
657.     formatter = mdates.ConciseDateFormatter(locator, usetex=True)
658.     assert formatter.format_ticks(locator()) == [
659.         r'{\fontfamily{\familydefault}\selectfont %s}' % s for s in expected]
660. 
661. 
662. def test_concise_formatter_formats():
663.     formats = ['%Y', '%m/%Y', 'day: %d',
664.                '%H hr %M min', '%H hr %M min', '%S.%f sec']
665. 
666.     def _create_auto_date_locator(date1, date2):
667.         fig, ax = plt.subplots()
668. 
669.         locator = mdates.AutoDateLocator(interval_multiples=True)
670.         formatter = mdates.ConciseDateFormatter(locator, formats=formats)
671.         ax.yaxis.set_major_locator(locator)
672.         ax.yaxis.set_major_formatter(formatter)
673.         ax.set_ylim(date1, date2)
674.         fig.canvas.draw()
675.         sts = [st.get_text() for st in ax.get_yticklabels()]
676.         return sts
677. 
678.     d1 = datetime.datetime(1997, 1, 1)
679.     results = (
680.         [datetime.timedelta(weeks=52 * 200), [str(t) for t in range(1980,
681.          2201, 20)]],
682.         [datetime.timedelta(weeks=52), [
683.             '1997', '02/1997', '03/1997', '04/1997', '05/1997', '06/1997',
684.             '07/1997', '08/1997', '09/1997', '10/1997', '11/1997', '12/1997',
685.             ]],
686.         [datetime.timedelta(days=141), [
687.             '01/1997', 'day: 15', '02/1997', 'day: 15', '03/1997', 'day: 15',
688.             '04/1997', 'day: 15', '05/1997', 'day: 15',
689.             ]],
690.         [datetime.timedelta(days=40), [
691.             '01/1997', 'day: 05', 'day: 09', 'day: 13', 'day: 17', 'day: 21',
692.             'day: 25', 'day: 29', '02/1997', 'day: 05', 'day: 09',
693.             ]],
694.         [datetime.timedelta(hours=40), [
695.             'day: 01', '04 hr 00 min', '08 hr 00 min', '12 hr 00 min',
696.             '16 hr 00 min', '20 hr 00 min', 'day: 02', '04 hr 00 min',
697.             '08 hr 00 min', '12 hr 00 min', '16 hr 00 min',
698.             ]],
699.         [datetime.timedelta(minutes=20), ['00 hr 00 min', '00 hr 05 min',
700.          '00 hr 10 min', '00 hr 15 min', '00 hr 20 min']],
701.         [datetime.timedelta(seconds=40), [
702.             '00 hr 00 min', '05.000000 sec', '10.000000 sec',
703.             '15.000000 sec', '20.000000 sec', '25.000000 sec',
704.             '30.000000 sec', '35.000000 sec', '40.000000 sec',
705.             ]],
706.         [datetime.timedelta(seconds=2), [
707.             '59.500000 sec', '00 hr 00 min', '00.500000 sec', '01.000000 sec',
708.             '01.500000 sec', '02.000000 sec', '02.500000 sec',
709.             ]],
710.         )
711.     for t_delta, expected in results:
712.         d2 = d1 + t_delta
713.         strings = _create_auto_date_locator(d1, d2)
714.         assert strings == expected
715. 
716. 
717. def test_concise_formatter_zformats():
718.     zero_formats = ['', "'%y", '%B', '%m-%d', '%S', '%S.%f']
719. 
720.     def _create_auto_date_locator(date1, date2):
721.         fig, ax = plt.subplots()
722. 
723.         locator = mdates.AutoDateLocator(interval_multiples=True)
724.         formatter = mdates.ConciseDateFormatter(
725.             locator, zero_formats=zero_formats)
726.         ax.yaxis.set_major_locator(locator)
727.         ax.yaxis.set_major_formatter(formatter)
728.         ax.set_ylim(date1, date2)
729.         fig.canvas.draw()
730.         sts = [st.get_text() for st in ax.get_yticklabels()]
731.         return sts
732. 
733.     d1 = datetime.datetime(1997, 1, 1)
734.     results = ([datetime.timedelta(weeks=52 * 200),
735.                 [str(t) for t in range(1980, 2201, 20)]
736.                 ],
737.                [datetime.timedelta(weeks=52),
738.                 ["'97", 'Feb', 'Mar', 'Apr', 'May', 'Jun',
739.                     'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
740.                 ],
741.                [datetime.timedelta(days=141),
742.                 ['January', '15', 'February', '15', 'March',
743.                     '15', 'April', '15', 'May', '15']
744.                 ],
745.                [datetime.timedelta(days=40),
746.                 ['January', '05', '09', '13', '17', '21',
747.                     '25', '29', 'February', '05', '09']
748.                 ],
749.                [datetime.timedelta(hours=40),
750.                 ['01-01', '04:00', '08:00', '12:00', '16:00', '20:00',
751.                     '01-02', '04:00', '08:00', '12:00', '16:00']
752.                 ],
753.                [datetime.timedelta(minutes=20),
754.                 ['00', '00:05', '00:10', '00:15', '00:20']
755.                 ],
756.                [datetime.timedelta(seconds=40),
757.                 ['00', '05', '10', '15', '20', '25', '30', '35', '40']
758.                 ],
759.                [datetime.timedelta(seconds=2),
760.                 ['59.5', '00.0', '00.5', '01.0', '01.5', '02.0', '02.5']
761.                 ],
762.                )
763.     for t_delta, expected in results:
764.         d2 = d1 + t_delta
765.         strings = _create_auto_date_locator(d1, d2)
766.         assert strings == expected
767. 
768. 
769. def test_concise_formatter_tz():
770.     def _create_auto_date_locator(date1, date2, tz):
771.         fig, ax = plt.subplots()
772. 
773.         locator = mdates.AutoDateLocator(interval_multiples=True)
774.         formatter = mdates.ConciseDateFormatter(locator, tz=tz)
775.         ax.yaxis.set_major_locator(locator)
776.         ax.yaxis.set_major_formatter(formatter)
777.         ax.set_ylim(date1, date2)
778.         fig.canvas.draw()
779.         sts = [st.get_text() for st in ax.get_yticklabels()]
780.         return sts, ax.yaxis.get_offset_text().get_text()
781. 
782.     d1 = datetime.datetime(1997, 1, 1).replace(tzinfo=datetime.timezone.utc)
783.     results = ([datetime.timedelta(hours=40),
784.                 ['03:00', '07:00', '11:00', '15:00', '19:00', '23:00',
785.                  '03:00', '07:00', '11:00', '15:00', '19:00'],
786.                 "1997-Jan-02"
787.                 ],
788.                [datetime.timedelta(minutes=20),
789.                 ['03:00', '03:05', '03:10', '03:15', '03:20'],
790.                 "1997-Jan-01"
791.                 ],
792.                [datetime.timedelta(seconds=40),
793.                 ['03:00', '05', '10', '15', '20', '25', '30', '35', '40'],
794.                 "1997-Jan-01 03:00"
795.                 ],
796.                [datetime.timedelta(seconds=2),
797.                 ['59.5', '03:00', '00.5', '01.0', '01.5', '02.0', '02.5'],
798.                 "1997-Jan-01 03:00"
799.                 ],
800.                )
801. 
802.     new_tz = datetime.timezone(datetime.timedelta(hours=3))
803.     for t_delta, expected_strings, expected_offset in results:
804.         d2 = d1 + t_delta
805.         strings, offset = _create_auto_date_locator(d1, d2, new_tz)
806.         assert strings == expected_strings
807.         assert offset == expected_offset
808. 
809. 
810. def test_auto_date_locator_intmult_tz():
811.     def _create_auto_date_locator(date1, date2, tz):
812.         locator = mdates.AutoDateLocator(interval_multiples=True, tz=tz)
813.         locator.create_dummy_axis()
814.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
815.         return locator
816. 
817.     results = ([datetime.timedelta(weeks=52*200),
818.                 ['1980-01-01 00:00:00-08:00', '2000-01-01 00:00:00-08:00',
819.                  '2020-01-01 00:00:00-08:00', '2040-01-01 00:00:00-08:00',
820.                  '2060-01-01 00:00:00-08:00', '2080-01-01 00:00:00-08:00',
821.                  '2100-01-01 00:00:00-08:00', '2120-01-01 00:00:00-08:00',
822.                  '2140-01-01 00:00:00-08:00', '2160-01-01 00:00:00-08:00',
823.                  '2180-01-01 00:00:00-08:00', '2200-01-01 00:00:00-08:00']
824.                 ],
825.                [datetime.timedelta(weeks=52),
826.                 ['1997-01-01 00:00:00-08:00', '1997-02-01 00:00:00-08:00',
827.                  '1997-03-01 00:00:00-08:00', '1997-04-01 00:00:00-08:00',
828.                  '1997-05-01 00:00:00-07:00', '1997-06-01 00:00:00-07:00',
829.                  '1997-07-01 00:00:00-07:00', '1997-08-01 00:00:00-07:00',
830.                  '1997-09-01 00:00:00-07:00', '1997-10-01 00:00:00-07:00',
831.                  '1997-11-01 00:00:00-08:00', '1997-12-01 00:00:00-08:00']
832.                 ],
833.                [datetime.timedelta(days=141),
834.                 ['1997-01-01 00:00:00-08:00', '1997-01-15 00:00:00-08:00',
835.                  '1997-02-01 00:00:00-08:00', '1997-02-15 00:00:00-08:00',
836.                  '1997-03-01 00:00:00-08:00', '1997-03-15 00:00:00-08:00',
837.                  '1997-04-01 00:00:00-08:00', '1997-04-15 00:00:00-07:00',
838.                  '1997-05-01 00:00:00-07:00', '1997-05-15 00:00:00-07:00']
839.                 ],
840.                [datetime.timedelta(days=40),
841.                 ['1997-01-01 00:00:00-08:00', '1997-01-05 00:00:00-08:00',
842.                  '1997-01-09 00:00:00-08:00', '1997-01-13 00:00:00-08:00',
843.                  '1997-01-17 00:00:00-08:00', '1997-01-21 00:00:00-08:00',
844.                  '1997-01-25 00:00:00-08:00', '1997-01-29 00:00:00-08:00',
845.                  '1997-02-01 00:00:00-08:00', '1997-02-05 00:00:00-08:00',
846.                  '1997-02-09 00:00:00-08:00']
847.                 ],
848.                [datetime.timedelta(hours=40),
849.                 ['1997-01-01 00:00:00-08:00', '1997-01-01 04:00:00-08:00',
850.                  '1997-01-01 08:00:00-08:00', '1997-01-01 12:00:00-08:00',
851.                  '1997-01-01 16:00:00-08:00', '1997-01-01 20:00:00-08:00',
852.                  '1997-01-02 00:00:00-08:00', '1997-01-02 04:00:00-08:00',
853.                  '1997-01-02 08:00:00-08:00', '1997-01-02 12:00:00-08:00',
854.                  '1997-01-02 16:00:00-08:00']
855.                 ],
856.                [datetime.timedelta(minutes=20),
857.                 ['1997-01-01 00:00:00-08:00', '1997-01-01 00:05:00-08:00',
858.                  '1997-01-01 00:10:00-08:00', '1997-01-01 00:15:00-08:00',
859.                  '1997-01-01 00:20:00-08:00']
860.                 ],
861.                [datetime.timedelta(seconds=40),
862.                 ['1997-01-01 00:00:00-08:00', '1997-01-01 00:00:05-08:00',
863.                  '1997-01-01 00:00:10-08:00', '1997-01-01 00:00:15-08:00',
864.                  '1997-01-01 00:00:20-08:00', '1997-01-01 00:00:25-08:00',
865.                  '1997-01-01 00:00:30-08:00', '1997-01-01 00:00:35-08:00',
866.                  '1997-01-01 00:00:40-08:00']
867.                 ]
868.                )
869. 
870.     tz = dateutil.tz.gettz('Canada/Pacific')
871.     d1 = datetime.datetime(1997, 1, 1, tzinfo=tz)
872.     for t_delta, expected in results:
873.         with rc_context({'_internal.classic_mode': False}):
874.             d2 = d1 + t_delta
875.             locator = _create_auto_date_locator(d1, d2, tz)
876.             st = list(map(str, mdates.num2date(locator(), tz=tz)))
877.             assert st == expected
878. 
879. 
880. @image_comparison(['date_inverted_limit.png'])
881. def test_date_inverted_limit():
882.     # test ax hline with date inputs
883.     t0 = datetime.datetime(2009, 1, 20)
884.     tf = datetime.datetime(2009, 1, 31)
885.     fig, ax = plt.subplots()
886.     ax.axhline(t0, color="blue", lw=3)
887.     ax.set_ylim(t0 - datetime.timedelta(days=5),
888.                 tf + datetime.timedelta(days=5))
889.     ax.invert_yaxis()
890.     fig.subplots_adjust(left=0.25)
891. 
892. 
893. def _test_date2num_dst(date_range, tz_convert):
894.     # Timezones
895. 
896.     BRUSSELS = dateutil.tz.gettz('Europe/Brussels')
897.     UTC = mdates.UTC
898. 
899.     # Create a list of timezone-aware datetime objects in UTC
900.     # Interval is 0b0.0000011 days, to prevent float rounding issues
901.     dtstart = datetime.datetime(2014, 3, 30, 0, 0, tzinfo=UTC)
902.     interval = datetime.timedelta(minutes=33, seconds=45)
903.     interval_days = interval.seconds / 86400
904.     N = 8
905. 
906.     dt_utc = date_range(start=dtstart, freq=interval, periods=N)
907.     dt_bxl = tz_convert(dt_utc, BRUSSELS)
908.     t0 = 735322.0 + mdates.date2num(np.datetime64('0000-12-31'))
909.     expected_ordinalf = [t0 + (i * interval_days) for i in range(N)]
910.     actual_ordinalf = list(mdates.date2num(dt_bxl))
911. 
912.     assert actual_ordinalf == expected_ordinalf
913. 
914. 
915. def test_date2num_dst():
916.     # Test for github issue #3896, but in date2num around DST transitions
917.     # with a timezone-aware pandas date_range object.
918. 
919.     class dt_tzaware(datetime.datetime):
920.         """
921.         This bug specifically occurs because of the normalization behavior of
922.         pandas Timestamp objects, so in order to replicate it, we need a
923.         datetime-like object that applies timezone normalization after
924.         subtraction.
925.         """
926. 
927.         def __sub__(self, other):
928.             r = super().__sub__(other)
929.             tzinfo = getattr(r, 'tzinfo', None)
930. 
931.             if tzinfo is not None:
932.                 localizer = getattr(tzinfo, 'normalize', None)
933.                 if localizer is not None:
934.                     r = tzinfo.normalize(r)
935. 
936.             if isinstance(r, datetime.datetime):
937.                 r = self.mk_tzaware(r)
938. 
939.             return r
940. 
941.         def __add__(self, other):
942.             return self.mk_tzaware(super().__add__(other))
943. 
944.         def astimezone(self, tzinfo):
945.             dt = super().astimezone(tzinfo)
946.             return self.mk_tzaware(dt)
947. 
948.         @classmethod
949.         def mk_tzaware(cls, datetime_obj):
950.             kwargs = {}
951.             attrs = ('year',
952.                      'month',
953.                      'day',
954.                      'hour',
955.                      'minute',
956.                      'second',
957.                      'microsecond',
958.                      'tzinfo')
959. 
960.             for attr in attrs:
961.                 val = getattr(datetime_obj, attr, None)
962.                 if val is not None:
963.                     kwargs[attr] = val
964. 
965.             return cls(**kwargs)
966. 
967.     # Define a date_range function similar to pandas.date_range
968.     def date_range(start, freq, periods):
969.         dtstart = dt_tzaware.mk_tzaware(start)
970. 
971.         return [dtstart + (i * freq) for i in range(periods)]
972. 
973.     # Define a tz_convert function that converts a list to a new timezone.
974.     def tz_convert(dt_list, tzinfo):
975.         return [d.astimezone(tzinfo) for d in dt_list]
976. 
977.     _test_date2num_dst(date_range, tz_convert)
978. 
979. 
980. def test_date2num_dst_pandas(pd):
981.     # Test for github issue #3896, but in date2num around DST transitions
982.     # with a timezone-aware pandas date_range object.
983. 
984.     def tz_convert(*args):
985.         return pd.DatetimeIndex.tz_convert(*args).astype(object)
986. 
987.     _test_date2num_dst(pd.date_range, tz_convert)
988. 
989. 
990. def _test_rrulewrapper(attach_tz, get_tz):
991.     SYD = get_tz('Australia/Sydney')
992. 
993.     dtstart = attach_tz(datetime.datetime(2017, 4, 1, 0), SYD)
994.     dtend = attach_tz(datetime.datetime(2017, 4, 4, 0), SYD)
995. 
996.     rule = mdates.rrulewrapper(freq=dateutil.rrule.DAILY, dtstart=dtstart)
997. 
998.     act = rule.between(dtstart, dtend)
999.     exp = [datetime.datetime(2017, 4, 1, 13, tzinfo=dateutil.tz.tzutc()),
1000.            datetime.datetime(2017, 4, 2, 14, tzinfo=dateutil.tz.tzutc())]


File: lib/matplotlib/tests/test_dates.py
Line number range: 1001 - 1501
Content:
1001. 
1002.     assert act == exp
1003. 
1004. 
1005. def test_rrulewrapper():
1006.     def attach_tz(dt, zi):
1007.         return dt.replace(tzinfo=zi)
1008. 
1009.     _test_rrulewrapper(attach_tz, dateutil.tz.gettz)
1010. 
1011. 
1012. @pytest.mark.pytz
1013. def test_rrulewrapper_pytz():
1014.     # Test to make sure pytz zones are supported in rrules
1015.     pytz = pytest.importorskip("pytz")
1016. 
1017.     def attach_tz(dt, zi):
1018.         return zi.localize(dt)
1019. 
1020.     _test_rrulewrapper(attach_tz, pytz.timezone)
1021. 
1022. 
1023. @pytest.mark.pytz
1024. def test_yearlocator_pytz():
1025.     pytz = pytest.importorskip("pytz")
1026. 
1027.     tz = pytz.timezone('America/New_York')
1028.     x = [tz.localize(datetime.datetime(2010, 1, 1))
1029.          + datetime.timedelta(i) for i in range(2000)]
1030.     locator = mdates.AutoDateLocator(interval_multiples=True, tz=tz)
1031.     locator.create_dummy_axis()
1032.     locator.axis.set_view_interval(mdates.date2num(x[0])-1.0,
1033.                                    mdates.date2num(x[-1])+1.0)
1034.     t = np.array([733408.208333, 733773.208333, 734138.208333,
1035.                   734503.208333, 734869.208333, 735234.208333, 735599.208333])
1036.     # convert to new epoch from old...
1037.     t = t + mdates.date2num(np.datetime64('0000-12-31'))
1038.     np.testing.assert_allclose(t, locator())
1039.     expected = ['2009-01-01 00:00:00-05:00',
1040.                 '2010-01-01 00:00:00-05:00', '2011-01-01 00:00:00-05:00',
1041.                 '2012-01-01 00:00:00-05:00', '2013-01-01 00:00:00-05:00',
1042.                 '2014-01-01 00:00:00-05:00', '2015-01-01 00:00:00-05:00']
1043.     st = list(map(str, mdates.num2date(locator(), tz=tz)))
1044.     assert st == expected
1045. 
1046. 
1047. def test_YearLocator():
1048.     def _create_year_locator(date1, date2, **kwargs):
1049.         locator = mdates.YearLocator(**kwargs)
1050.         locator.create_dummy_axis()
1051.         locator.axis.set_view_interval(mdates.date2num(date1),
1052.                                        mdates.date2num(date2))
1053.         return locator
1054. 
1055.     d1 = datetime.datetime(1990, 1, 1)
1056.     results = ([datetime.timedelta(weeks=52 * 200),
1057.                 {'base': 20, 'month': 1, 'day': 1},
1058.                 ['1980-01-01 00:00:00+00:00', '2000-01-01 00:00:00+00:00',
1059.                  '2020-01-01 00:00:00+00:00', '2040-01-01 00:00:00+00:00',
1060.                  '2060-01-01 00:00:00+00:00', '2080-01-01 00:00:00+00:00',
1061.                  '2100-01-01 00:00:00+00:00', '2120-01-01 00:00:00+00:00',
1062.                  '2140-01-01 00:00:00+00:00', '2160-01-01 00:00:00+00:00',
1063.                  '2180-01-01 00:00:00+00:00', '2200-01-01 00:00:00+00:00']
1064.                 ],
1065.                [datetime.timedelta(weeks=52 * 200),
1066.                 {'base': 20, 'month': 5, 'day': 16},
1067.                 ['1980-05-16 00:00:00+00:00', '2000-05-16 00:00:00+00:00',
1068.                  '2020-05-16 00:00:00+00:00', '2040-05-16 00:00:00+00:00',
1069.                  '2060-05-16 00:00:00+00:00', '2080-05-16 00:00:00+00:00',
1070.                  '2100-05-16 00:00:00+00:00', '2120-05-16 00:00:00+00:00',
1071.                  '2140-05-16 00:00:00+00:00', '2160-05-16 00:00:00+00:00',
1072.                  '2180-05-16 00:00:00+00:00', '2200-05-16 00:00:00+00:00']
1073.                 ],
1074.                [datetime.timedelta(weeks=52 * 5),
1075.                 {'base': 20, 'month': 9, 'day': 25},
1076.                 ['1980-09-25 00:00:00+00:00', '2000-09-25 00:00:00+00:00']
1077.                 ],
1078.                )
1079. 
1080.     for delta, arguments, expected in results:
1081.         d2 = d1 + delta
1082.         locator = _create_year_locator(d1, d2, **arguments)
1083.         assert list(map(str, mdates.num2date(locator()))) == expected
1084. 
1085. 
1086. def test_DayLocator():
1087.     with pytest.raises(ValueError):
1088.         mdates.DayLocator(interval=-1)
1089.     with pytest.raises(ValueError):
1090.         mdates.DayLocator(interval=-1.5)
1091.     with pytest.raises(ValueError):
1092.         mdates.DayLocator(interval=0)
1093.     with pytest.raises(ValueError):
1094.         mdates.DayLocator(interval=1.3)
1095.     mdates.DayLocator(interval=1.0)
1096. 
1097. 
1098. def test_tz_utc():
1099.     dt = datetime.datetime(1970, 1, 1, tzinfo=mdates.UTC)
1100.     assert dt.tzname() == 'UTC'
1101. 
1102. 
1103. @pytest.mark.parametrize("x, tdelta",
1104.                          [(1, datetime.timedelta(days=1)),
1105.                           ([1, 1.5], [datetime.timedelta(days=1),
1106.                                       datetime.timedelta(days=1.5)])])
1107. def test_num2timedelta(x, tdelta):
1108.     dt = mdates.num2timedelta(x)
1109.     assert dt == tdelta
1110. 
1111. 
1112. def test_datetime64_in_list():
1113.     dt = [np.datetime64('2000-01-01'), np.datetime64('2001-01-01')]
1114.     dn = mdates.date2num(dt)
1115.     # convert fixed values from old to new epoch
1116.     t = (np.array([730120.,  730486.]) +
1117.          mdates.date2num(np.datetime64('0000-12-31')))
1118.     np.testing.assert_equal(dn, t)
1119. 
1120. 
1121. def test_change_epoch():
1122.     date = np.datetime64('2000-01-01')
1123. 
1124.     # use private method to clear the epoch and allow it to be set...
1125.     mdates._reset_epoch_test_example()
1126.     mdates.get_epoch()  # Set default.
1127. 
1128.     with pytest.raises(RuntimeError):
1129.         # this should fail here because there is a sentinel on the epoch
1130.         # if the epoch has been used then it cannot be set.
1131.         mdates.set_epoch('0000-01-01')
1132. 
1133.     mdates._reset_epoch_test_example()
1134.     mdates.set_epoch('1970-01-01')
1135.     dt = (date - np.datetime64('1970-01-01')).astype('datetime64[D]')
1136.     dt = dt.astype('int')
1137.     np.testing.assert_equal(mdates.date2num(date), float(dt))
1138. 
1139.     mdates._reset_epoch_test_example()
1140.     mdates.set_epoch('0000-12-31')
1141.     np.testing.assert_equal(mdates.date2num(date), 730120.0)
1142. 
1143.     mdates._reset_epoch_test_example()
1144.     mdates.set_epoch('1970-01-01T01:00:00')
1145.     np.testing.assert_allclose(mdates.date2num(date), dt - 1./24.)
1146.     mdates._reset_epoch_test_example()
1147.     mdates.set_epoch('1970-01-01T00:00:00')
1148.     np.testing.assert_allclose(
1149.         mdates.date2num(np.datetime64('1970-01-01T12:00:00')),
1150.         0.5)
1151. 
1152. 
1153. def test_warn_notintervals():
1154.     dates = np.arange('2001-01-10', '2001-03-04', dtype='datetime64[D]')
1155.     locator = mdates.AutoDateLocator(interval_multiples=False)
1156.     locator.intervald[3] = [2]
1157.     locator.create_dummy_axis()
1158.     locator.axis.set_view_interval(mdates.date2num(dates[0]),
1159.                                    mdates.date2num(dates[-1]))
1160.     with pytest.warns(UserWarning, match="AutoDateLocator was unable") as rec:
1161.         locs = locator()
1162. 
1163. 
1164. def test_change_converter():
1165.     plt.rcParams['date.converter'] = 'concise'
1166.     dates = np.arange('2020-01-01', '2020-05-01', dtype='datetime64[D]')
1167.     fig, ax = plt.subplots()
1168. 
1169.     ax.plot(dates, np.arange(len(dates)))
1170.     fig.canvas.draw()
1171.     assert ax.get_xticklabels()[0].get_text() == 'Jan'
1172.     assert ax.get_xticklabels()[1].get_text() == '15'
1173. 
1174.     plt.rcParams['date.converter'] = 'auto'
1175.     fig, ax = plt.subplots()
1176. 
1177.     ax.plot(dates, np.arange(len(dates)))
1178.     fig.canvas.draw()
1179.     assert ax.get_xticklabels()[0].get_text() == 'Jan 01 2020'
1180.     assert ax.get_xticklabels()[1].get_text() == 'Jan 15 2020'
1181.     with pytest.raises(ValueError):
1182.         plt.rcParams['date.converter'] = 'boo'
1183. 
1184. 
1185. def test_change_interval_multiples():
1186.     plt.rcParams['date.interval_multiples'] = False
1187.     dates = np.arange('2020-01-10', '2020-05-01', dtype='datetime64[D]')
1188.     fig, ax = plt.subplots()
1189. 
1190.     ax.plot(dates, np.arange(len(dates)))
1191.     fig.canvas.draw()
1192.     assert ax.get_xticklabels()[0].get_text() == 'Jan 10 2020'
1193.     assert ax.get_xticklabels()[1].get_text() == 'Jan 24 2020'
1194. 
1195.     plt.rcParams['date.interval_multiples'] = 'True'
1196.     fig, ax = plt.subplots()
1197. 
1198.     ax.plot(dates, np.arange(len(dates)))
1199.     fig.canvas.draw()
1200.     assert ax.get_xticklabels()[0].get_text() == 'Jan 15 2020'
1201.     assert ax.get_xticklabels()[1].get_text() == 'Feb 01 2020'
1202. 
1203. 
1204. def test_epoch2num():
1205.     with _api.suppress_matplotlib_deprecation_warning():
1206.         mdates._reset_epoch_test_example()
1207.         mdates.set_epoch('0000-12-31')
1208.         assert mdates.epoch2num(86400) == 719164.0
1209.         assert mdates.num2epoch(719165.0) == 86400 * 2
1210.         # set back to the default
1211.         mdates._reset_epoch_test_example()
1212.         mdates.set_epoch('1970-01-01T00:00:00')
1213.         assert mdates.epoch2num(86400) == 1.0
1214.         assert mdates.num2epoch(2.0) == 86400 * 2
1215. 
1216. 
1217. def test_julian2num():
1218.     mdates._reset_epoch_test_example()
1219.     mdates.set_epoch('0000-12-31')
1220.     # 2440587.5 is julian date for 1970-01-01T00:00:00
1221.     # https://en.wikipedia.org/wiki/Julian_day
1222.     assert mdates.julian2num(2440588.5) == 719164.0
1223.     assert mdates.num2julian(719165.0) == 2440589.5
1224.     # set back to the default
1225.     mdates._reset_epoch_test_example()
1226.     mdates.set_epoch('1970-01-01T00:00:00')
1227.     assert mdates.julian2num(2440588.5) == 1.0
1228.     assert mdates.num2julian(2.0) == 2440589.5
1229. 
1230. 
1231. def test_DateLocator():
1232.     locator = mdates.DateLocator()
1233.     # Test nonsingular
1234.     assert locator.nonsingular(0, np.inf) == (10957.0, 14610.0)
1235.     assert locator.nonsingular(0, 1) == (0, 1)
1236.     assert locator.nonsingular(1, 0) == (0, 1)
1237.     assert locator.nonsingular(0, 0) == (-2, 2)
1238.     locator.create_dummy_axis()
1239.     # default values
1240.     assert locator.datalim_to_dt() == (
1241.         datetime.datetime(1970, 1, 1, 0, 0, tzinfo=datetime.timezone.utc),
1242.         datetime.datetime(1970, 1, 2, 0, 0, tzinfo=datetime.timezone.utc))
1243. 
1244.     # Check default is UTC
1245.     assert locator.tz == mdates.UTC
1246.     tz_str = 'Iceland'
1247.     iceland_tz = dateutil.tz.gettz(tz_str)
1248.     # Check not Iceland
1249.     assert locator.tz != iceland_tz
1250.     # Set it to to Iceland
1251.     locator.set_tzinfo('Iceland')
1252.     # Check now it is Iceland
1253.     assert locator.tz == iceland_tz
1254.     locator.create_dummy_axis()
1255.     locator.axis.set_data_interval(*mdates.date2num(["2022-01-10",
1256.                                                      "2022-01-08"]))
1257.     assert locator.datalim_to_dt() == (
1258.         datetime.datetime(2022, 1, 8, 0, 0, tzinfo=iceland_tz),
1259.         datetime.datetime(2022, 1, 10, 0, 0, tzinfo=iceland_tz))
1260. 
1261.     # Set rcParam
1262.     plt.rcParams['timezone'] = tz_str
1263. 
1264.     # Create a new one in a similar way
1265.     locator = mdates.DateLocator()
1266.     # Check now it is Iceland
1267.     assert locator.tz == iceland_tz
1268. 
1269.     # Test invalid tz values
1270.     with pytest.raises(ValueError, match="Aiceland is not a valid timezone"):
1271.         mdates.DateLocator(tz="Aiceland")
1272.     with pytest.raises(TypeError,
1273.                        match="tz must be string or tzinfo subclass."):
1274.         mdates.DateLocator(tz=1)
1275. 
1276. 
1277. def test_datestr2num():
1278.     assert mdates.datestr2num('2022-01-10') == 19002.0
1279.     dt = datetime.date(year=2022, month=1, day=10)
1280.     assert mdates.datestr2num('2022-01', default=dt) == 19002.0
1281.     assert np.all(mdates.datestr2num(
1282.         ['2022-01', '2022-02'], default=dt
1283.         ) == np.array([19002., 19033.]))
1284.     assert mdates.datestr2num([]).size == 0
1285.     assert mdates.datestr2num([], datetime.date(year=2022,
1286.                                                 month=1, day=10)).size == 0
1287. 
1288. 
1289. def test_concise_formatter_exceptions():
1290.     locator = mdates.AutoDateLocator()
1291.     with pytest.raises(ValueError, match="formats argument must be a list"):
1292.         mdates.ConciseDateFormatter(locator, formats=['', '%Y'])
1293. 
1294.     with pytest.raises(ValueError,
1295.                        match="zero_formats argument must be a list"):
1296.         mdates.ConciseDateFormatter(locator, zero_formats=['', '%Y'])
1297. 
1298.     with pytest.raises(ValueError,
1299.                        match="offset_formats argument must be a list"):
1300.         mdates.ConciseDateFormatter(locator, offset_formats=['', '%Y'])
1301. 
1302. 
1303. def test_concise_formatter_call():
1304.     locator = mdates.AutoDateLocator()
1305.     formatter = mdates.ConciseDateFormatter(locator)
1306.     assert formatter(19002.0) == '2022'
1307.     assert formatter.format_data_short(19002.0) == '2022-01-10 00:00:00'
1308. 
1309. 
1310. @pytest.mark.parametrize('span, expected_locator',
1311.                          ((0.02, mdates.MinuteLocator),
1312.                           (1, mdates.HourLocator),
1313.                           (19, mdates.DayLocator),
1314.                           (40, mdates.WeekdayLocator),
1315.                           (200, mdates.MonthLocator),
1316.                           (2000, mdates.YearLocator)))
1317. def test_date_ticker_factory(span, expected_locator):
1318.     locator, _ = mdates.date_ticker_factory(span)
1319.     assert isinstance(locator, expected_locator)
1320. 
1321. 
1322. def test_usetex_newline():
1323.     fig, ax = plt.subplots()
1324.     ax.xaxis.set_major_formatter(mdates.DateFormatter('%d/%m\n%Y'))
1325.     fig.canvas.draw()

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-20 20:04:15,316 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user is asking for image comparison tests that use `ConciseDateFormatter`.\n   - There are no image comparison tests that use `ConciseDateFormatter` in the provided file.\n   - The user provides a fallback to find any other test that uses `ConciseDateFormatter` on a date range that does not include the month of January.\n   - The test `test_concise_formatter_subsecond` uses `ConciseDateFormatter`.\n   - The date range used in this test is based on the variable `year_1996` which is the floating point number `9861.0`. With the default epoch ('1970-01-01'), this corresponds to the date '1996-12-31'. The test checks formatting for sub-second timescales around this date.\n   - Therefore, this test uses a date range that does not include January.\n\n2. Extended relevance:\n   - This is the only test in the file that matches the user's specific fallback criteria of using `ConciseDateFormatter` on a date range not including January.", relative_path='lib/matplotlib/tests/test_dates.py', start_line=532, end_line=541)]
2025-12-20 20:04:15,318 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide all image comparison tests that use `ConciseDateFormatter` from `lib/matplotlib/tests/test_dates.py`.
2025-12-20 20:04:15,318 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-20 20:04:15,318 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-20 20:04:15,318 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 6 existing contexts
2025-12-20 20:04:15,319 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 6 total contexts (removed 1 duplicates)
2025-12-20 20:04:15,319 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   └── deploy-docs.sh
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.rst
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   └── check_wheel_licenses.py
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── blocking_input_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── fontconfig_pattern_api.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 19214-DS.rst
|   |   |   |   ├── 19368-DS.rst
|   |   |   |   ├── 20426-JK.rst
|   |   |   |   ├── 20715-JKS.rst
|   |   |   |   ├── 21026-DS.rst
|   |   |   |   ├── 21042-AL.rst
|   |   |   |   ├── 21238-AL.rst
|   |   |   |   ├── 21983-AL.rst
|   |   |   |   ├── 22013-AL.rst
|   |   |   |   ├── 22063-SR.rst
|   |   |   |   ├── 22204-AL.rst
|   |   |   |   ├── 22229-TAC.rst
|   |   |   |   ├── 22485-TH.rst
|   |   |   |   ├── 22639-RA.rst
|   |   |   |   └── 22691-JMK.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 20071-AL.rst
|   |   |   |   ├── 20839-EP.rst
|   |   |   |   ├── 20995-AL.rst
|   |   |   |   ├── 21056-AL.rst
|   |   |   |   ├── 21187-AL.rst
|   |   |   |   ├── 21356-AL.rst
|   |   |   |   ├── 21412-AL.rst
|   |   |   |   ├── 21425-AL.rst
|   |   |   |   ├── 21962-AL.rst
|   |   |   |   ├── 21965-AL.rst
|   |   |   |   ├── 21981-AL.rst
|   |   |   |   ├── 21982-AL.rst
|   |   |   |   ├── 21992-AL.rst
|   |   |   |   ├── 21995-AL.rst
|   |   |   |   ├── 22021-AL.rst
|   |   |   |   ├── 22025-AL.rst
|   |   |   |   ├── 22050-AL.rst
|   |   |   |   ├── 22051-AL.rst
|   |   |   |   ├── 22084-SS.rst
|   |   |   |   ├── 22097-AL.rst
|   |   |   |   ├── 22098-AL.rst
|   |   |   |   ├── 22123-TH.rst
|   |   |   |   ├── 22133-OG.rst
|   |   |   |   ├── 22134-OG.rst
|   |   |   |   ├── 22148-OG.rst
|   |   |   |   ├── 22245-AL.rst
|   |   |   |   ├── 22268-OG.rst
|   |   |   |   ├── 22317-AL.rst
|   |   |   |   ├── 22323-GL.rst
|   |   |   |   ├── 22345-JK.rst
|   |   |   |   ├── 22415-AL.rst
|   |   |   |   ├── 22418-AL.rst
|   |   |   |   ├── 22421-AL.rst
|   |   |   |   ├── 22422-AL.rst
|   |   |   |   ├── 22490-AL.rst
|   |   |   |   ├── 22503-AL.rst
|   |   |   |   ├── 22509-AL.rst
|   |   |   |   ├── 22539-AL.rst
|   |   |   |   ├── 22547-AL.rst
|   |   |   |   ├── 22554-AL.rst
|   |   |   |   ├── 22697-OG.rst
|   |   |   |   ├── 22725-AL.rst
|   |   |   |   ├── 22797-OG.rst
|   |   |   |   ├── 22813-GL.rst
|   |   |   |   └── ZZZZZ-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 21415-AL.rst
|   |   |   |   ├── 22205-ES.rst
|   |   |   |   └── 22550-AL.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 00001-DS.rst
|   |   |       ├── 20990-AL.rst
|   |   |       ├── 21395-AL.rst
|   |   |       ├── 21591-AL.rst
|   |   |       ├── 21980-CC.rst
|   |   |       ├── 22081-AL.rst
|   |   |       ├── 22107-OG.rst
|   |   |       ├── 22365-OG.rst
|   |   |       ├── 22465-AL.rst
|   |   |       ├── 22486-OG.rst
|   |   |       ├── 22514-OG.rst
|   |   |       ├── 22516-OG.rst
|   |   |       └── 22738-JL.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.5.0.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── textpath_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid.rst
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   └── faq.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── documenting_mpl.rst
|   |   ├── gitwash
|   |   |   ├── configure_git.rst
|   |   |   ├── development_workflow.rst
|   |   |   ├── dot2_dot3.rst
|   |   |   ├── following_latest.rst
|   |   |   ├── forking_hell.rst
|   |   |   ├── git_development.rst
|   |   |   ├── git_install.rst
|   |   |   ├── git_intro.rst
|   |   |   ├── git_resources.rst
|   |   |   ├── index.rst
|   |   |   ├── maintainer_workflow.rst
|   |   |   ├── patching.rst
|   |   |   └── set_up_fork.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   └── performance.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── 3d_plot_focal_length.rst
|       |   ├── 3d_plot_roll_angle.rst
|       |   ├── README.rst
|       |   ├── asinh_scale.rst
|       |   ├── color_support_for_math_to_image.rst
|       |   ├── custom_cap_widths.rst
|       |   ├── double_quotes_matplolibrc.rst
|       |   ├── extending_MarkerStyle.rst
|       |   ├── inset_axes_improvements.rst
|       |   ├── layout_engine.rst
|       |   ├── list_font_names.rst
|       |   ├── marker_none.rst
|       |   ├── min_macos_version.rst
|       |   ├── modify_stairs_fill_edge_behaviour.rst
|       |   ├── no_broken_streamlines.rst
|       |   ├── polygon_selector_box.rst
|       |   ├── polygon_vert_setter.rst
|       |   ├── rectangle_patch_rotation.rst
|       |   ├── selector_improvement.rst
|       |   ├── snap_selector.rst
|       |   └── windows_arm64.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   └── whats_new_3.5.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   └── license.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── examples
|   ├── README.txt
|   ├── animation
|   |   ├── README.txt
|   |   ├── animate_decay.py
|   |   ├── animated_histogram.py
|   |   ├── animation_demo.py
|   |   ├── bayes_update.py
|   |   ├── double_pendulum.py
|   |   ├── dynamic_image.py
|   |   ├── frame_grabbing_sgskip.py
|   |   ├── pause_resume.py
|   |   ├── rain.py
|   |   ├── random_walk.py
|   |   ├── simple_anim.py
|   |   ├── strip_chart.py
|   |   └── unchained.py
|   ├── axes_grid1
|   |   ├── README.txt
|   |   ├── demo_anchored_direction_arrows.py
|   |   ├── demo_axes_divider.py
|   |   ├── demo_axes_grid.py
|   |   ├── demo_axes_grid2.py
|   |   ├── demo_axes_hbox_divider.py
|   |   ├── demo_axes_rgb.py
|   |   ├── demo_colorbar_of_inset_axes.py
|   |   ├── demo_colorbar_with_axes_divider.py
|   |   ├── demo_colorbar_with_inset_locator.py
|   |   ├── demo_edge_colorbar.py
|   |   ├── demo_fixed_size_axes.py
|   |   ├── demo_imagegrid_aspect.py
|   |   ├── inset_locator_demo.py
|   |   ├── inset_locator_demo2.py
|   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   ├── parasite_simple.py
|   |   ├── parasite_simple2.py
|   |   ├── scatter_hist_locatable_axes.py
|   |   ├── simple_anchored_artists.py
|   |   ├── simple_axes_divider1.py
|   |   ├── simple_axes_divider3.py
|   |   ├── simple_axesgrid.py
|   |   ├── simple_axesgrid2.py
|   |   ├── simple_axisline4.py
|   |   └── simple_colorbar.py
|   ├── axisartist
|   |   ├── README.txt
|   |   ├── axis_direction.py
|   |   ├── demo_axis_direction.py
|   |   ├── demo_axisline_style.py
|   |   ├── demo_curvelinear_grid.py
|   |   ├── demo_curvelinear_grid2.py
|   |   ├── demo_floating_axes.py
|   |   ├── demo_floating_axis.py
|   |   ├── demo_parasite_axes.py
|   |   ├── demo_parasite_axes2.py
|   |   ├── demo_ticklabel_alignment.py
|   |   ├── demo_ticklabel_direction.py
|   |   ├── simple_axis_direction01.py
|   |   ├── simple_axis_direction03.py
|   |   ├── simple_axis_pad.py
|   |   ├── simple_axisartist1.py
|   |   ├── simple_axisline.py
|   |   └── simple_axisline3.py
|   ├── color
|   |   ├── README.txt
|   |   ├── color_by_yvalue.py
|   |   ├── color_cycle_default.py
|   |   ├── color_demo.py
|   |   ├── colorbar_basics.py
|   |   ├── colormap_reference.py
|   |   ├── custom_cmap.py
|   |   └── named_colors.py
|   ├── event_handling
|   |   ├── README.txt
|   |   ├── close_event.py
|   |   ├── coords_demo.py
|   |   ├── data_browser.py
|   |   ├── figure_axes_enter_leave.py
|   |   ├── ginput_manual_clabel_sgskip.py
|   |   ├── image_slices_viewer.py
|   |   ├── keypress_demo.py
|   |   ├── lasso_demo.py
|   |   ├── legend_picking.py
|   |   ├── looking_glass.py
|   |   ├── path_editor.py
|   |   ├── pick_event_demo.py
|   |   ├── pick_event_demo2.py
|   |   ├── poly_editor.py
|   |   ├── pong_sgskip.py
|   |   ├── resample.py
|   |   ├── timers.py
|   |   ├── trifinder_event_demo.py
|   |   ├── viewlims.py
|   |   └── zoom_window.py
|   ├── frontpage
|   |   ├── 3D.py
|   |   ├── README.txt
|   |   ├── contour_frontpage.py
|   |   ├── histogram.py
|   |   └── membrane.py
|   ├── images_contours_and_fields
|   |   ├── README.txt
|   |   ├── affine_image.py
|   |   ├── barb_demo.py
|   |   ├── barcode_demo.py
|   |   ├── colormap_interactive_adjustment.py
|   |   ├── colormap_normalizations.py
|   |   ├── colormap_normalizations_symlognorm.py
|   |   ├── contour_corner_mask.py
|   |   ├── contour_demo.py
|   |   ├── contour_image.py
|   |   ├── contour_label_demo.py
|   |   ├── contourf_demo.py
|   |   ├── contourf_hatching.py
|   |   ├── contourf_log.py
|   |   ├── contours_in_optimization_demo.py
|   |   ├── demo_bboximage.py
|   |   ├── figimage_demo.py
|   |   ├── image_annotated_heatmap.py
|   |   ├── image_antialiasing.py
|   |   ├── image_clip_path.py
|   |   ├── image_demo.py
|   |   ├── image_masked.py
|   |   ├── image_nonuniform.py
|   |   ├── image_transparency_blend.py
|   |   ├── image_zcoord.py
|   |   ├── interpolation_methods.py
|   |   ├── irregulardatagrid.py
|   |   ├── layer_images.py
|   |   ├── matshow.py
|   |   ├── multi_image.py
|   |   ├── pcolor_demo.py
|   |   ├── pcolormesh_grids.py
|   |   ├── pcolormesh_levels.py
|   |   ├── plot_streamplot.py
|   |   ├── quadmesh_demo.py
|   |   ├── quiver_demo.py
|   |   ├── quiver_simple_demo.py
|   |   ├── shading_example.py
|   |   ├── specgram_demo.py
|   |   ├── spy_demos.py
|   |   ├── tricontour_demo.py
|   |   ├── tricontour_smooth_delaunay.py
|   |   ├── tricontour_smooth_user.py
|   |   ├── trigradient_demo.py
|   |   ├── triinterp_demo.py
|   |   ├── tripcolor_demo.py
|   |   ├── triplot_demo.py
|   |   └── watermark_image.py
|   ├── lines_bars_and_markers
|   |   ├── README.txt
|   |   ├── bar_label_demo.py
|   |   ├── bar_stacked.py
|   |   ├── barchart.py
|   |   ├── barh.py
|   |   ├── broken_barh.py
|   |   ├── capstyle.py
|   |   ├── categorical_variables.py
|   |   ├── cohere.py
|   |   ├── csd_demo.py
|   |   ├── curve_error_band.py
|   |   ├── errorbar_limits_simple.py
|   |   ├── errorbar_subsample.py
|   |   ├── eventcollection_demo.py
|   |   ├── eventplot_demo.py
|   |   ├── fill.py
|   |   ├── fill_between_alpha.py
|   |   ├── fill_between_demo.py
|   |   ├── fill_betweenx_demo.py
|   |   ├── filled_step.py
|   |   ├── gradient_bar.py
|   |   ├── hat_graph.py
|   |   ├── horizontal_barchart_distribution.py
|   |   ├── joinstyle.py
|   |   ├── line_demo_dash_control.py
|   |   ├── lines_with_ticks_demo.py
|   |   ├── linestyles.py
|   |   ├── marker_reference.py
|   |   ├── markevery_demo.py
|   |   ├── masked_demo.py
|   |   ├── multicolored_line.py
|   |   ├── multivariate_marker_plot.py
|   |   ├── psd_demo.py
|   |   ├── scatter_custom_symbol.py
|   |   ├── scatter_demo2.py
|   |   ├── scatter_hist.py
|   |   ├── scatter_masked.py
|   |   ├── scatter_star_poly.py
|   |   ├── scatter_with_legend.py
|   |   ├── simple_plot.py
|   |   ├── span_regions.py
|   |   ├── spectrum_demo.py
|   |   ├── stackplot_demo.py
|   |   ├── stairs_demo.py
|   |   ├── stem_plot.py
|   |   ├── step_demo.py
|   |   ├── timeline.py
|   |   ├── vline_hline_demo.py
|   |   └── xcorr_acorr_demo.py
|   ├── misc
|   |   ├── README.txt
|   |   ├── anchored_artists.py
|   |   ├── bbox_intersect.py
|   |   ├── contour_manual.py
|   |   ├── coords_report.py
|   |   ├── cursor_demo.py
|   |   ├── custom_projection.py
|   |   ├── customize_rc.py
|   |   ├── demo_agg_filter.py
|   |   ├── demo_ribbon_box.py
|   |   ├── fill_spiral.py
|   |   ├── findobj_demo.py
|   |   ├── font_indexing.py
|   |   ├── ftface_props.py
|   |   ├── histogram_path.py
|   |   ├── hyperlinks_sgskip.py
|   |   ├── image_thumbnail_sgskip.py
|   |   ├── keyword_plotting.py
|   |   ├── logos2.py
|   |   ├── multipage_pdf.py
|   |   ├── multiprocess_sgskip.py
|   |   ├── packed_bubbles.py
|   |   ├── patheffect_demo.py
|   |   ├── print_stdout_sgskip.py
|   |   ├── pythonic_matplotlib.py
|   |   ├── rasterization_demo.py
|   |   ├── set_and_get.py
|   |   ├── svg_filter_line.py
|   |   ├── svg_filter_pie.py
|   |   ├── table_demo.py
|   |   ├── tickedstroke_demo.py
|   |   ├── transoffset.py
|   |   └── zorder_demo.py
|   ├── mplot3d
|   |   ├── 2dcollections3d.py
|   |   ├── 3d_bars.py
|   |   ├── README.txt
|   |   ├── bars3d.py
|   |   ├── box3d.py
|   |   ├── contour3d.py
|   |   ├── contour3d_2.py
|   |   ├── contour3d_3.py
|   |   ├── contourf3d.py
|   |   ├── contourf3d_2.py
|   |   ├── custom_shaded_3d_surface.py
|   |   ├── errorbar3d.py
|   |   ├── hist3d.py
|   |   ├── lines3d.py
|   |   ├── lorenz_attractor.py
|   |   ├── mixed_subplots.py
|   |   ├── offset.py
|   |   ├── pathpatch3d.py
|   |   ├── polys3d.py
|   |   ├── projections.py
|   |   ├── quiver3d.py
|   |   ├── rotate_axes3d_sgskip.py
|   |   ├── scatter3d.py
|   |   ├── stem3d_demo.py
|   |   ├── subplot3d.py
|   |   ├── surface3d.py
|   |   ├── surface3d_2.py
|   |   ├── surface3d_3.py
|   |   ├── surface3d_radial.py
|   |   ├── text3d.py
|   |   ├── tricontour3d.py
|   |   ├── tricontourf3d.py
|   |   ├── trisurf3d.py
|   |   ├── trisurf3d_2.py
|   |   ├── voxels.py
|   |   ├── voxels_numpy_logo.py
|   |   ├── voxels_rgb.py
|   |   ├── voxels_torus.py
|   |   ├── wire3d.py
|   |   ├── wire3d_animation_sgskip.py
|   |   └── wire3d_zero_stride.py
|   ├── pie_and_polar_charts
|   |   ├── README.txt
|   |   ├── bar_of_pie.py
|   |   ├── nested_pie.py
|   |   ├── pie_and_donut_labels.py
|   |   ├── pie_demo2.py
|   |   ├── pie_features.py
|   |   ├── polar_bar.py
|   |   ├── polar_demo.py
|   |   ├── polar_legend.py
|   |   └── polar_scatter.py
|   ├── pyplots
|   |   ├── README.txt
|   |   ├── align_ylabels.py
|   |   ├── annotate_transform.py
|   |   ├── annotation_basic.py
|   |   ├── annotation_polar.py
|   |   ├── auto_subplots_adjust.py
|   |   ├── axline.py
|   |   ├── boxplot_demo_pyplot.py
|   |   ├── dollar_ticks.py
|   |   ├── fig_axes_customize_simple.py
|   |   ├── fig_axes_labels_simple.py
|   |   ├── fig_x.py
|   |   ├── pyplot_formatstr.py
|   |   ├── pyplot_mathtext.py
|   |   ├── pyplot_simple.py
|   |   ├── pyplot_text.py
|   |   ├── pyplot_three.py
|   |   ├── pyplot_two_subplots.py
|   |   ├── text_commands.py
|   |   └── text_layout.py
|   ├── scales
|   |   ├── README.txt
|   |   ├── asinh_demo.py
|   |   ├── aspect_loglog.py
|   |   ├── custom_scale.py
|   |   ├── log_bar.py
|   |   ├── log_demo.py
|   |   ├── log_test.py
|   |   ├── logit_demo.py
|   |   ├── power_norm.py
|   |   ├── scales.py
|   |   └── symlog_demo.py
|   ├── shapes_and_collections
|   |   ├── README.txt
|   |   ├── arrow_guide.py
|   |   ├── artist_reference.py
|   |   ├── collections.py
|   |   ├── compound_path.py
|   |   ├── dolphin.py
|   |   ├── donut.py
|   |   ├── ellipse_collection.py
|   |   ├── ellipse_demo.py
|   |   ├── fancybox_demo.py
|   |   ├── hatch_demo.py
|   |   ├── hatch_style_reference.py
|   |   ├── line_collection.py
|   |   ├── patch_collection.py
|   |   ├── path_patch.py
|   |   ├── quad_bezier.py
|   |   └── scatter.py
|   ├── showcase
|   |   ├── README.txt
|   |   ├── anatomy.py
|   |   ├── bachelors_degrees_by_gender.py
|   |   ├── firefox.py
|   |   ├── integral.py
|   |   ├── mandelbrot.py
|   |   └── xkcd.py
|   ├── specialty_plots
|   |   ├── README.txt
|   |   ├── advanced_hillshading.py
|   |   ├── anscombe.py
|   |   ├── hinton_demo.py
|   |   ├── leftventricle_bulleye.py
|   |   ├── mri_demo.py
|   |   ├── mri_with_eeg.py
|   |   ├── radar_chart.py
|   |   ├── sankey_basics.py
|   |   ├── sankey_links.py
|   |   ├── sankey_rankine.py
|   |   ├── skewt.py
|   |   └── topographic_hillshading.py
|   ├── spines
|   |   ├── README.txt
|   |   ├── centered_spines_with_arrows.py
|   |   ├── multiple_yaxis_with_spines.py
|   |   ├── spine_placement_demo.py
|   |   ├── spines.py
|   |   ├── spines_bounds.py
|   |   └── spines_dropped.py
|   ├── statistics
|   |   ├── README.txt
|   |   ├── barchart_demo.py
|   |   ├── boxplot.py
|   |   ├── boxplot_color.py
|   |   ├── boxplot_demo.py
|   |   ├── boxplot_vs_violin.py
|   |   ├── bxp.py
|   |   ├── confidence_ellipse.py
|   |   ├── customized_violin.py
|   |   ├── errorbar.py
|   |   ├── errorbar_features.py
|   |   ├── errorbar_limits.py
|   |   ├── errorbars_and_boxes.py
|   |   ├── hexbin_demo.py
|   |   ├── hist.py
|   |   ├── histogram_cumulative.py
|   |   ├── histogram_features.py
|   |   ├── histogram_histtypes.py
|   |   ├── histogram_multihist.py
|   |   ├── multiple_histograms_side_by_side.py
|   |   ├── time_series_histogram.py
|   |   └── violinplot.py
|   ├── style_sheets
|   |   ├── README.txt
|   |   ├── bmh.py
|   |   ├── dark_background.py
|   |   ├── fivethirtyeight.py
|   |   ├── ggplot.py
|   |   ├── grayscale.py
|   |   ├── plot_solarizedlight2.py
|   |   └── style_sheets_reference.py
|   ├── subplots_axes_and_figures
|   |   ├── README.txt
|   |   ├── align_labels_demo.py
|   |   ├── axes_box_aspect.py
|   |   ├── axes_demo.py
|   |   ├── axes_margins.py
|   |   ├── axes_props.py
|   |   ├── axes_zoom_effect.py
|   |   ├── axhspan_demo.py
|   |   ├── axis_equal_demo.py
|   |   ├── axis_labels_demo.py
|   |   ├── broken_axis.py
|   |   ├── colorbar_placement.py
|   |   ├── custom_figure_class.py
|   |   ├── demo_constrained_layout.py
|   |   ├── demo_tight_layout.py
|   |   ├── fahrenheit_celsius_scales.py
|   |   ├── figure_size_units.py
|   |   ├── figure_title.py
|   |   ├── ganged_plots.py
|   |   ├── geo_demo.py
|   |   ├── gridspec_and_subplots.py
|   |   ├── gridspec_multicolumn.py
|   |   ├── gridspec_nested.py
|   |   ├── invert_axes.py
|   |   ├── multiple_figs_demo.py
|   |   ├── secondary_axis.py
|   |   ├── share_axis_lims_views.py
|   |   ├── shared_axis_demo.py
|   |   ├── subfigures.py
|   |   ├── subplot.py
|   |   ├── subplots_adjust.py
|   |   ├── subplots_demo.py
|   |   ├── two_scales.py
|   |   └── zoom_inset_axes.py
|   ├── text_labels_and_annotations
|   |   ├── README.txt
|   |   ├── accented_text.py
|   |   ├── angle_annotation.py
|   |   ├── annotation_demo.py
|   |   ├── arrow_demo.py
|   |   ├── autowrap.py
|   |   ├── custom_legends.py
|   |   ├── date.py
|   |   ├── demo_annotation_box.py
|   |   ├── demo_text_path.py
|   |   ├── demo_text_rotation_mode.py
|   |   ├── dfrac_demo.py
|   |   ├── engineering_formatter.py
|   |   ├── fancyarrow_demo.py
|   |   ├── fancytextbox_demo.py
|   |   ├── figlegend_demo.py
|   |   ├── font_family_rc_sgskip.py
|   |   ├── font_file.py
|   |   ├── font_table.py
|   |   ├── fonts_demo.py
|   |   ├── fonts_demo_kw.py
|   |   ├── label_subplots.py
|   |   ├── legend.py
|   |   ├── legend_demo.py
|   |   ├── line_with_text.py
|   |   ├── mathtext_asarray.py
|   |   ├── mathtext_demo.py
|   |   ├── mathtext_examples.py
|   |   ├── mathtext_fontfamily_example.py
|   |   ├── multiline.py
|   |   ├── placing_text_boxes.py
|   |   ├── rainbow_text.py
|   |   ├── stix_fonts_demo.py
|   |   ├── tex_demo.py
|   |   ├── text_alignment.py
|   |   ├── text_fontdict.py
|   |   ├── text_rotation.py
|   |   ├── text_rotation_relative_to_line.py
|   |   ├── titles_demo.py
|   |   ├── unicode_minus.py
|   |   ├── usetex_baseline_test.py
|   |   ├── usetex_fonteffects.py
|   |   └── watermark_text.py
|   ├── ticks
|   |   ├── README.txt
|   |   ├── auto_ticks.py
|   |   ├── centered_ticklabels.py
|   |   ├── colorbar_tick_labelling_demo.py
|   |   ├── custom_ticker1.py
|   |   ├── date_concise_formatter.py
|   |   ├── date_demo_convert.py
|   |   ├── date_demo_rrule.py
|   |   ├── date_formatters_locators.py
|   |   ├── date_index_formatter.py
|   |   ├── date_precision_and_epochs.py
|   |   ├── major_minor_demo.py
|   |   ├── scalarformatter.py
|   |   ├── tick-formatters.py
|   |   ├── tick-locators.py
|   |   ├── tick_label_right.py
|   |   ├── tick_labels_from_values.py
|   |   ├── tick_xlabel_top.py
|   |   ├── ticklabels_rotation.py
|   |   └── ticks_too_many.py
|   ├── units
|   |   ├── README.txt
|   |   ├── annotate_with_units.py
|   |   ├── artist_tests.py
|   |   ├── bar_demo2.py
|   |   ├── bar_unit_demo.py
|   |   ├── basic_units.py
|   |   ├── ellipse_with_units.py
|   |   ├── evans_test.py
|   |   ├── radian_demo.py
|   |   ├── units_sample.py
|   |   └── units_scatter.py
|   ├── user_interfaces
|   |   ├── README.txt
|   |   ├── canvasagg.py
|   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   ├── embedding_in_gtk3_sgskip.py
|   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   ├── embedding_in_gtk4_sgskip.py
|   |   ├── embedding_in_qt_sgskip.py
|   |   ├── embedding_in_tk_sgskip.py
|   |   ├── embedding_in_wx2_sgskip.py
|   |   ├── embedding_in_wx3_sgskip.py
|   |   ├── embedding_in_wx4_sgskip.py
|   |   ├── embedding_in_wx5_sgskip.py
|   |   ├── embedding_webagg_sgskip.py
|   |   ├── fourier_demo_wx_sgskip.py
|   |   ├── gtk3_spreadsheet_sgskip.py
|   |   ├── gtk4_spreadsheet_sgskip.py
|   |   ├── mathtext_wx_sgskip.py
|   |   ├── mpl_with_glade3_sgskip.py
|   |   ├── pylab_with_gtk3_sgskip.py
|   |   ├── pylab_with_gtk4_sgskip.py
|   |   ├── svg_histogram_sgskip.py
|   |   ├── svg_tooltip_sgskip.py
|   |   ├── toolmanager_sgskip.py
|   |   ├── web_application_server_sgskip.py
|   |   └── wxcursor_demo_sgskip.py
|   ├── userdemo
|   |   ├── README.txt
|   |   ├── anchored_box04.py
|   |   ├── annotate_explain.py
|   |   ├── annotate_simple01.py
|   |   ├── annotate_simple02.py
|   |   ├── annotate_simple03.py
|   |   ├── annotate_simple04.py
|   |   ├── annotate_simple_coord01.py
|   |   ├── annotate_simple_coord02.py
|   |   ├── annotate_simple_coord03.py
|   |   ├── annotate_text_arrow.py
|   |   ├── connect_simple01.py
|   |   ├── connectionstyle_demo.py
|   |   ├── custom_boxstyle01.py
|   |   ├── demo_gridspec01.py
|   |   ├── demo_gridspec03.py
|   |   ├── demo_gridspec06.py
|   |   ├── pgf_fonts.py
|   |   ├── pgf_preamble_sgskip.py
|   |   ├── pgf_texsystem.py
|   |   ├── simple_annotate01.py
|   |   ├── simple_legend01.py
|   |   └── simple_legend02.py
|   └── widgets
|       ├── README.txt
|       ├── annotated_cursor.py
|       ├── buttons.py
|       ├── check_buttons.py
|       ├── cursor.py
|       ├── lasso_selector_demo_sgskip.py
|       ├── menu.py
|       ├── mouse_cursor.py
|       ├── multicursor.py
|       ├── polygon_selector_demo.py
|       ├── polygon_selector_simple.py
|       ├── radio_buttons.py
|       ├── range_slider.py
|       ├── rectangle_selector.py
|       ├── slider_demo.py
|       ├── slider_snap_demo.py
|       ├── span_selector.py
|       └── textbox.py
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── afm.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   ├── _secondary_axes.py
|   |   |   └── _subplots.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── blocking_input.py
|   |   ├── category.py
|   |   ├── cbook
|   |   |   └── __init__.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── docstring.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── fontconfig_pattern.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── tight_bbox.py
|   |   ├── tight_layout.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── type1font.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── inset_locator.py
|   |   |   └── parasite_axes.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   └── parasite_axes.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── clip_path.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   └── parasite_axes.py
|   |   ├── mplot3d
|   |   |   ├── __init__.py
|   |   |   ├── art3d.py
|   |   |   ├── axes3d.py
|   |   |   ├── axis3d.py
|   |   |   └── proj3d.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── baseline_images
|   |       |   ├── test_axes_grid
|   |       |   ├── test_axes_grid1
|   |       |   ├── test_axisartist_axis_artist
|   |       |   ├── test_axisartist_axislines
|   |       |   ├── test_axisartist_clip_path
|   |       |   ├── test_axisartist_floating_axes
|   |       |   ├── test_axisartist_grid_helper_curvelinear
|   |       |   └── test_mplot3d
|   |       ├── conftest.py
|   |       ├── test_axes_grid.py
|   |       ├── test_axes_grid1.py
|   |       ├── test_axisartist_angle_helper.py
|   |       ├── test_axisartist_axis_artist.py
|   |       ├── test_axisartist_axislines.py
|   |       ├── test_axisartist_clip_path.py
|   |       ├── test_axisartist_floating_axes.py
|   |       ├── test_axisartist_grid_finder.py
|   |       ├── test_axisartist_grid_helper_curvelinear.py
|   |       └── test_mplot3d.py
|   └── pylab.py
├── plot_types
|   ├── README.rst
|   ├── arrays
|   |   ├── README.rst
|   |   ├── barbs.py
|   |   ├── contour.py
|   |   ├── contourf.py
|   |   ├── imshow.py
|   |   ├── pcolormesh.py
|   |   ├── quiver.py
|   |   └── streamplot.py
|   ├── basic
|   |   ├── README.rst
|   |   ├── bar.py
|   |   ├── fill_between.py
|   |   ├── plot.py
|   |   ├── scatter_plot.py
|   |   ├── stem.py
|   |   └── step.py
|   ├── stats
|   |   ├── README.rst
|   |   ├── boxplot_plot.py
|   |   ├── errorbar_plot.py
|   |   ├── eventplot.py
|   |   ├── hexbin.py
|   |   ├── hist2d.py
|   |   ├── hist_plot.py
|   |   ├── pie.py
|   |   └── violin.py
|   └── unstructured
|       ├── README.rst
|       ├── tricontour.py
|       ├── tricontourf.py
|       ├── tripcolor.py
|       └── triplot.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _contour.cpp
|   ├── _contour_wrapper.cpp
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
├── tests.py
├── tools
|   ├── README.txt
|   ├── boilerplate.py
|   ├── cache_zenodo_svg.py
|   ├── create_DejaVuDisplay.sh
|   ├── embed_js.py
|   ├── gh_api.py
|   ├── github_stats.py
|   ├── make_icons.py
|   ├── memleak.py
|   ├── run_examples.py
|   ├── subset.py
|   ├── triage_tests.py
|   └── visualize_tests.py
└── tutorials
    ├── README.txt
    ├── advanced
    |   ├── README.txt
    |   ├── blitting.py
    |   ├── path_tutorial.py
    |   ├── patheffects_guide.py
    |   └── transforms_tutorial.py
    ├── colors
    |   ├── README.txt
    |   ├── colorbar_only.py
    |   ├── colormap-manipulation.py
    |   ├── colormapnorms.py
    |   ├── colormaps.py
    |   └── colors.py
    ├── intermediate
    |   ├── README.txt
    |   ├── arranging_axes.py
    |   ├── artists.py
    |   ├── autoscale.py
    |   ├── color_cycle.py
    |   ├── constrainedlayout_guide.py
    |   ├── imshow_extent.py
    |   ├── legend_guide.py
    |   └── tight_layout_guide.py
    ├── introductory
    |   ├── README.txt
    |   ├── customizing.py
    |   ├── images.py
    |   ├── lifecycle.py
    |   ├── pyplot.py
    |   └── quick_start.py
    ├── provisional
    |   ├── README.txt
    |   └── mosaic.py
    ├── text
    |   ├── README.txt
    |   ├── annotations.py
    |   ├── mathtext.py
    |   ├── pgf.py
    |   ├── text_intro.py
    |   ├── text_props.py
    |   └── usetex.py
    └── toolkits
        ├── README.txt
        ├── axes_grid.py
        ├── axisartist.py
        └── mplot3d.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: ConciseDateFormatter not showing year anywhere when plotting <12 months

Description: ### Bug summary

When I plot < 1 year and January is not included in the x-axis, the year doesn't show up anywhere.
This bug is different from bug #21670 (fixed in #21785).

### Code for reproduction

```python
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
from datetime import datetime, timedelta

#create time array
initial = datetime(2021,2,14,0,0,0)
time_array = [initial + timedelta(days=x) for x in range(1,200)]

#create data array
data = [-x**2/20000 for x in range(1,200)]


#plot data
fig,ax = plt.subplots()
ax.plot(time_array,data) 
        
locator = mdates.AutoDateLocator()
formatter = mdates.ConciseDateFormatter(locator)

ax.grid(True)
ax.set_ylabel("Temperature ($\degree$C)")
ax.xaxis.set_major_locator(locator)   
ax.xaxis.set_major_formatter(formatter)
fig.autofmt_xdate() #automatically makes the x-labels rotate
```


### Actual outcome

![image](https://user-images.githubusercontent.com/15143365/154090257-c7813f1c-f9ea-4252-86bf-f84e449c2f46.png)


### Expected outcome

I expect the year "2021" to show in the offset, to the right of the x-axis

### Additional information

I'm using Spyder IDE, v5.1.5

### Operating system

Windows 10

### Matplotlib Version

3.4.3

### Matplotlib Backend

Qt5Agg

### Python version

3.9.1

### Jupyter version

_No response_

### Installation

conda

Patch information:
diff --git a/lib/matplotlib/dates.py b/lib/matplotlib/dates.py
index 4d8ddf3ee5..0ee2287519 100644
--- a/lib/matplotlib/dates.py
+++ b/lib/matplotlib/dates.py
@@ -797,14 +797,24 @@ class ConciseDateFormatter(ticker.Formatter):
         # 3: hours, 4: minutes, 5: seconds, 6: microseconds
         for level in range(5, -1, -1):
             if len(np.unique(tickdate[:, level])) > 1:
-                if level < 2:
-                    show_offset = False
                 break
             elif level == 0:
                 # all tickdate are the same, so only micros might be different
                 # set to the most precise (6: microseconds doesn't exist...)
                 level = 5
 
+        # Decide whether to show the offset based on the determined level.
+        # For yearly labels, offset is redundant.
+        if level == 0:
+            show_offset = False
+        elif level == 1:
+            # For monthly labels, only suppress the offset if a January tick
+            # exists (zero-format will provide the year on that tick).
+            # If January is absent, keep the offset (typically showing the year)
+            # to ensure the axis conveys full date context.
+            if np.any(tickdate[:, 1] == 1):
+                show_offset = False
+
         # level is the basic level we will label at.
         # now loop through and decide the actual ticklabels
         zerovals = [0, 1, 1, 0, 0, 0, 0]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of lib/matplotlib/tests/test_dates.py.
Extra Requirements: 
Purpose: I need to find 3 relevant test cases for the `ConciseDateFormatter` bug, and this file should contain them.

Previous refined query 2:
Essential Query: Please provide all image comparison tests that use `ConciseDateFormatter` from `lib/matplotlib/tests/test_dates.py`.
Extra Requirements: If no such tests exist, please provide any other tests from that file that use `ConciseDateFormatter` on a date range that does not include the month of January.
Purpose: This will help find a third, highly relevant test case that either reproduces the bug or tests the intended behavior for the scenario described in the bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_dates.py
Line number range: 1 - 500
Content:
1. import datetime
2. 
3. import dateutil.tz
4. import dateutil.rrule
5. import functools
6. import numpy as np
7. import pytest
8. 
9. from matplotlib import _api, rc_context, style
10. import matplotlib.dates as mdates
11. import matplotlib.pyplot as plt
12. from matplotlib.testing.decorators import image_comparison
13. import matplotlib.ticker as mticker
14. 
15. 
16. def test_date_numpyx():
17.     # test that numpy dates work properly...
18.     base = datetime.datetime(2017, 1, 1)
19.     time = [base + datetime.timedelta(days=x) for x in range(0, 3)]
20.     timenp = np.array(time, dtype='datetime64[ns]')
21.     data = np.array([0., 2., 1.])
22.     fig = plt.figure(figsize=(10, 2))
23.     ax = fig.add_subplot(1, 1, 1)
24.     h, = ax.plot(time, data)
25.     hnp, = ax.plot(timenp, data)
26.     np.testing.assert_equal(h.get_xdata(orig=False), hnp.get_xdata(orig=False))
27.     fig = plt.figure(figsize=(10, 2))
28.     ax = fig.add_subplot(1, 1, 1)
29.     h, = ax.plot(data, time)
30.     hnp, = ax.plot(data, timenp)
31.     np.testing.assert_equal(h.get_ydata(orig=False), hnp.get_ydata(orig=False))
32. 
33. 
34. @pytest.mark.parametrize('t0', [datetime.datetime(2017, 1, 1, 0, 1, 1),
35. 
36.                                 [datetime.datetime(2017, 1, 1, 0, 1, 1),
37.                                  datetime.datetime(2017, 1, 1, 1, 1, 1)],
38. 
39.                                 [[datetime.datetime(2017, 1, 1, 0, 1, 1),
40.                                   datetime.datetime(2017, 1, 1, 1, 1, 1)],
41.                                  [datetime.datetime(2017, 1, 1, 2, 1, 1),
42.                                   datetime.datetime(2017, 1, 1, 3, 1, 1)]]])
43. @pytest.mark.parametrize('dtype', ['datetime64[s]',
44.                                    'datetime64[us]',
45.                                    'datetime64[ms]',
46.                                    'datetime64[ns]'])
47. def test_date_date2num_numpy(t0, dtype):
48.     time = mdates.date2num(t0)
49.     tnp = np.array(t0, dtype=dtype)
50.     nptime = mdates.date2num(tnp)
51.     np.testing.assert_equal(time, nptime)
52. 
53. 
54. @pytest.mark.parametrize('dtype', ['datetime64[s]',
55.                                    'datetime64[us]',
56.                                    'datetime64[ms]',
57.                                    'datetime64[ns]'])
58. def test_date2num_NaT(dtype):
59.     t0 = datetime.datetime(2017, 1, 1, 0, 1, 1)
60.     tmpl = [mdates.date2num(t0), np.nan]
61.     tnp = np.array([t0, 'NaT'], dtype=dtype)
62.     nptime = mdates.date2num(tnp)
63.     np.testing.assert_array_equal(tmpl, nptime)
64. 
65. 
66. @pytest.mark.parametrize('units', ['s', 'ms', 'us', 'ns'])
67. def test_date2num_NaT_scalar(units):
68.     tmpl = mdates.date2num(np.datetime64('NaT', units))
69.     assert np.isnan(tmpl)
70. 
71. 
72. def test_date_empty():
73.     # make sure we do the right thing when told to plot dates even
74.     # if no date data has been presented, cf
75.     # http://sourceforge.net/tracker/?func=detail&aid=2850075&group_id=80706&atid=560720
76.     fig, ax = plt.subplots()
77.     ax.xaxis_date()
78.     fig.draw_without_rendering()
79.     np.testing.assert_allclose(ax.get_xlim(),
80.                                [mdates.date2num(np.datetime64('2000-01-01')),
81.                                 mdates.date2num(np.datetime64('2010-01-01'))])
82. 
83.     mdates._reset_epoch_test_example()
84.     mdates.set_epoch('0000-12-31')
85.     fig, ax = plt.subplots()
86.     ax.xaxis_date()
87.     fig.draw_without_rendering()
88.     np.testing.assert_allclose(ax.get_xlim(),
89.                                [mdates.date2num(np.datetime64('2000-01-01')),
90.                                 mdates.date2num(np.datetime64('2010-01-01'))])
91.     mdates._reset_epoch_test_example()
92. 
93. 
94. def test_date_not_empty():
95.     fig = plt.figure()
96.     ax = fig.add_subplot()
97. 
98.     ax.plot([50, 70], [1, 2])
99.     ax.xaxis.axis_date()
100.     np.testing.assert_allclose(ax.get_xlim(), [50, 70])
101. 
102. 
103. def test_axhline():
104.     # make sure that axhline doesn't set the xlimits...
105.     fig, ax = plt.subplots()
106.     ax.axhline(1.5)
107.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
108.     np.testing.assert_allclose(ax.get_xlim(),
109.                                [mdates.date2num(np.datetime64('2016-01-01')),
110.                                 mdates.date2num(np.datetime64('2016-01-02'))])
111. 
112.     mdates._reset_epoch_test_example()
113.     mdates.set_epoch('0000-12-31')
114.     fig, ax = plt.subplots()
115.     ax.axhline(1.5)
116.     ax.plot([np.datetime64('2016-01-01'), np.datetime64('2016-01-02')], [1, 2])
117.     np.testing.assert_allclose(ax.get_xlim(),
118.                                [mdates.date2num(np.datetime64('2016-01-01')),
119.                                 mdates.date2num(np.datetime64('2016-01-02'))])
120.     mdates._reset_epoch_test_example()
121. 
122. 
123. @image_comparison(['date_axhspan.png'])
124. def test_date_axhspan():
125.     # test axhspan with date inputs
126.     t0 = datetime.datetime(2009, 1, 20)
127.     tf = datetime.datetime(2009, 1, 21)
128.     fig, ax = plt.subplots()
129.     ax.axhspan(t0, tf, facecolor="blue", alpha=0.25)
130.     ax.set_ylim(t0 - datetime.timedelta(days=5),
131.                 tf + datetime.timedelta(days=5))
132.     fig.subplots_adjust(left=0.25)
133. 
134. 
135. @image_comparison(['date_axvspan.png'])
136. def test_date_axvspan():
137.     # test axvspan with date inputs
138.     t0 = datetime.datetime(2000, 1, 20)
139.     tf = datetime.datetime(2010, 1, 21)
140.     fig, ax = plt.subplots()
141.     ax.axvspan(t0, tf, facecolor="blue", alpha=0.25)
142.     ax.set_xlim(t0 - datetime.timedelta(days=720),
143.                 tf + datetime.timedelta(days=720))
144.     fig.autofmt_xdate()
145. 
146. 
147. @image_comparison(['date_axhline.png'])
148. def test_date_axhline():
149.     # test axhline with date inputs
150.     t0 = datetime.datetime(2009, 1, 20)
151.     tf = datetime.datetime(2009, 1, 31)
152.     fig, ax = plt.subplots()
153.     ax.axhline(t0, color="blue", lw=3)
154.     ax.set_ylim(t0 - datetime.timedelta(days=5),
155.                 tf + datetime.timedelta(days=5))
156.     fig.subplots_adjust(left=0.25)
157. 
158. 
159. @image_comparison(['date_axvline.png'])
160. def test_date_axvline():
161.     # test axvline with date inputs
162.     t0 = datetime.datetime(2000, 1, 20)
163.     tf = datetime.datetime(2000, 1, 21)
164.     fig, ax = plt.subplots()
165.     ax.axvline(t0, color="red", lw=3)
166.     ax.set_xlim(t0 - datetime.timedelta(days=5),
167.                 tf + datetime.timedelta(days=5))
168.     fig.autofmt_xdate()
169. 
170. 
171. def test_too_many_date_ticks(caplog):
172.     # Attempt to test SF 2715172, see
173.     # https://sourceforge.net/tracker/?func=detail&aid=2715172&group_id=80706&atid=560720
174.     # setting equal datetimes triggers and expander call in
175.     # transforms.nonsingular which results in too many ticks in the
176.     # DayLocator.  This should emit a log at WARNING level.
177.     caplog.set_level("WARNING")
178.     t0 = datetime.datetime(2000, 1, 20)
179.     tf = datetime.datetime(2000, 1, 20)
180.     fig, ax = plt.subplots()
181.     with pytest.warns(UserWarning) as rec:
182.         ax.set_xlim((t0, tf), auto=True)
183.         assert len(rec) == 1
184.         assert ('Attempting to set identical low and high xlims'
185.                 in str(rec[0].message))
186.     ax.plot([], [])
187.     ax.xaxis.set_major_locator(mdates.DayLocator())
188.     v = ax.xaxis.get_major_locator()()
189.     assert len(v) > 1000
190.     # The warning is emitted multiple times because the major locator is also
191.     # called both when placing the minor ticks (for overstriking detection) and
192.     # during tick label positioning.
193.     assert caplog.records and all(
194.         record.name == "matplotlib.ticker" and record.levelname == "WARNING"
195.         for record in caplog.records)
196.     assert len(caplog.records) > 0
197. 
198. 
199. def _new_epoch_decorator(thefunc):
200.     @functools.wraps(thefunc)
201.     def wrapper():
202.         mdates._reset_epoch_test_example()
203.         mdates.set_epoch('2000-01-01')
204.         thefunc()
205.         mdates._reset_epoch_test_example()
206.     return wrapper
207. 
208. 
209. @image_comparison(['RRuleLocator_bounds.png'])
210. def test_RRuleLocator():
211.     import matplotlib.testing.jpl_units as units
212.     units.register()
213.     # This will cause the RRuleLocator to go out of bounds when it tries
214.     # to add padding to the limits, so we make sure it caps at the correct
215.     # boundary values.
216.     t0 = datetime.datetime(1000, 1, 1)
217.     tf = datetime.datetime(6000, 1, 1)
218. 
219.     fig = plt.figure()
220.     ax = plt.subplot()
221.     ax.set_autoscale_on(True)
222.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
223. 
224.     rrule = mdates.rrulewrapper(dateutil.rrule.YEARLY, interval=500)
225.     locator = mdates.RRuleLocator(rrule)
226.     ax.xaxis.set_major_locator(locator)
227.     ax.xaxis.set_major_formatter(mdates.AutoDateFormatter(locator))
228. 
229.     ax.autoscale_view()
230.     fig.autofmt_xdate()
231. 
232. 
233. def test_RRuleLocator_dayrange():
234.     loc = mdates.DayLocator()
235.     x1 = datetime.datetime(year=1, month=1, day=1, tzinfo=mdates.UTC)
236.     y1 = datetime.datetime(year=1, month=1, day=16, tzinfo=mdates.UTC)
237.     loc.tick_values(x1, y1)
238.     # On success, no overflow error shall be thrown
239. 
240. 
241. def test_RRuleLocator_close_minmax():
242.     # if d1 and d2 are very close together, rrule cannot create
243.     # reasonable tick intervals; ensure that this is handled properly
244.     rrule = mdates.rrulewrapper(dateutil.rrule.SECONDLY, interval=5)
245.     loc = mdates.RRuleLocator(rrule)
246.     d1 = datetime.datetime(year=2020, month=1, day=1)
247.     d2 = datetime.datetime(year=2020, month=1, day=1, microsecond=1)
248.     expected = ['2020-01-01 00:00:00+00:00',
249.                 '2020-01-01 00:00:00.000001+00:00']
250.     assert list(map(str, mdates.num2date(loc.tick_values(d1, d2)))) == expected
251. 
252. 
253. @image_comparison(['DateFormatter_fractionalSeconds.png'])
254. def test_DateFormatter():
255.     import matplotlib.testing.jpl_units as units
256.     units.register()
257. 
258.     # Lets make sure that DateFormatter will allow us to have tick marks
259.     # at intervals of fractional seconds.
260. 
261.     t0 = datetime.datetime(2001, 1, 1, 0, 0, 0)
262.     tf = datetime.datetime(2001, 1, 1, 0, 0, 1)
263. 
264.     fig = plt.figure()
265.     ax = plt.subplot()
266.     ax.set_autoscale_on(True)
267.     ax.plot([t0, tf], [0.0, 1.0], marker='o')
268. 
269.     # rrule = mpldates.rrulewrapper( dateutil.rrule.YEARLY, interval=500 )
270.     # locator = mpldates.RRuleLocator( rrule )
271.     # ax.xaxis.set_major_locator( locator )
272.     # ax.xaxis.set_major_formatter( mpldates.AutoDateFormatter(locator) )
273. 
274.     ax.autoscale_view()
275.     fig.autofmt_xdate()
276. 
277. 
278. def test_locator_set_formatter():
279.     """
280.     Test if setting the locator only will update the AutoDateFormatter to use
281.     the new locator.
282.     """
283.     plt.rcParams["date.autoformatter.minute"] = "%d %H:%M"
284.     t = [datetime.datetime(2018, 9, 30, 8, 0),
285.          datetime.datetime(2018, 9, 30, 8, 59),
286.          datetime.datetime(2018, 9, 30, 10, 30)]
287.     x = [2, 3, 1]
288. 
289.     fig, ax = plt.subplots()
290.     ax.plot(t, x)
291.     ax.xaxis.set_major_locator(mdates.MinuteLocator((0, 30)))
292.     fig.canvas.draw()
293.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels()]
294.     expected = ['30 08:00', '30 08:30', '30 09:00',
295.                 '30 09:30', '30 10:00', '30 10:30']
296.     assert ticklabels == expected
297. 
298.     ax.xaxis.set_major_locator(mticker.NullLocator())
299.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((5, 55)))
300.     decoy_loc = mdates.MinuteLocator((12, 27))
301.     ax.xaxis.set_minor_formatter(mdates.AutoDateFormatter(decoy_loc))
302. 
303.     ax.xaxis.set_minor_locator(mdates.MinuteLocator((15, 45)))
304.     fig.canvas.draw()
305.     ticklabels = [tl.get_text() for tl in ax.get_xticklabels(which="minor")]
306.     expected = ['30 08:15', '30 08:45', '30 09:15', '30 09:45', '30 10:15']
307.     assert ticklabels == expected
308. 
309. 
310. def test_date_formatter_callable():
311. 
312.     class _Locator:
313.         def _get_unit(self): return -11
314. 
315.     def callable_formatting_function(dates, _):
316.         return [dt.strftime('%d-%m//%Y') for dt in dates]
317. 
318.     formatter = mdates.AutoDateFormatter(_Locator())
319.     formatter.scaled[-10] = callable_formatting_function
320.     assert formatter([datetime.datetime(2014, 12, 25)]) == ['25-12//2014']
321. 
322. 
323. @pytest.mark.parametrize('delta, expected', [
324.     (datetime.timedelta(weeks=52 * 200),
325.      range(1990, 2171, 20)),
326.     (datetime.timedelta(days=30),
327.      ['1990-01-%02d' % day for day in range(1, 32, 3)]),
328.     (datetime.timedelta(hours=20),
329.      ['01-01 %02d' % hour for hour in range(0, 21, 2)]),
330.     (datetime.timedelta(minutes=10),
331.      ['01 00:%02d' % minu for minu in range(0, 11)]),
332. ])
333. def test_date_formatter_usetex(delta, expected):
334.     style.use("default")
335. 
336.     d1 = datetime.datetime(1990, 1, 1)
337.     d2 = d1 + delta
338. 
339.     locator = mdates.AutoDateLocator(interval_multiples=False)
340.     locator.create_dummy_axis()
341.     locator.axis.set_view_interval(mdates.date2num(d1), mdates.date2num(d2))
342. 
343.     formatter = mdates.AutoDateFormatter(locator, usetex=True)
344.     assert [formatter(loc) for loc in locator()] == [
345.         r'{\fontfamily{\familydefault}\selectfont %s}' % s for s in expected]
346. 
347. 
348. def test_drange():
349.     """
350.     This test should check if drange works as expected, and if all the
351.     rounding errors are fixed
352.     """
353.     start = datetime.datetime(2011, 1, 1, tzinfo=mdates.UTC)
354.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
355.     delta = datetime.timedelta(hours=1)
356.     # We expect 24 values in drange(start, end, delta), because drange returns
357.     # dates from an half open interval [start, end)
358.     assert len(mdates.drange(start, end, delta)) == 24
359. 
360.     # if end is a little bit later, we expect the range to contain one element
361.     # more
362.     end = end + datetime.timedelta(microseconds=1)
363.     assert len(mdates.drange(start, end, delta)) == 25
364. 
365.     # reset end
366.     end = datetime.datetime(2011, 1, 2, tzinfo=mdates.UTC)
367. 
368.     # and tst drange with "complicated" floats:
369.     # 4 hours = 1/6 day, this is an "dangerous" float
370.     delta = datetime.timedelta(hours=4)
371.     daterange = mdates.drange(start, end, delta)
372.     assert len(daterange) == 6
373.     assert mdates.num2date(daterange[-1]) == (end - delta)
374. 
375. 
376. @_new_epoch_decorator
377. def test_auto_date_locator():
378.     def _create_auto_date_locator(date1, date2):
379.         locator = mdates.AutoDateLocator(interval_multiples=False)
380.         locator.create_dummy_axis()
381.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
382.         return locator
383. 
384.     d1 = datetime.datetime(1990, 1, 1)
385.     results = ([datetime.timedelta(weeks=52 * 200),
386.                 ['1990-01-01 00:00:00+00:00', '2010-01-01 00:00:00+00:00',
387.                  '2030-01-01 00:00:00+00:00', '2050-01-01 00:00:00+00:00',
388.                  '2070-01-01 00:00:00+00:00', '2090-01-01 00:00:00+00:00',
389.                  '2110-01-01 00:00:00+00:00', '2130-01-01 00:00:00+00:00',
390.                  '2150-01-01 00:00:00+00:00', '2170-01-01 00:00:00+00:00']
391.                 ],
392.                [datetime.timedelta(weeks=52),
393.                 ['1990-01-01 00:00:00+00:00', '1990-02-01 00:00:00+00:00',
394.                  '1990-03-01 00:00:00+00:00', '1990-04-01 00:00:00+00:00',
395.                  '1990-05-01 00:00:00+00:00', '1990-06-01 00:00:00+00:00',
396.                  '1990-07-01 00:00:00+00:00', '1990-08-01 00:00:00+00:00',
397.                  '1990-09-01 00:00:00+00:00', '1990-10-01 00:00:00+00:00',
398.                  '1990-11-01 00:00:00+00:00', '1990-12-01 00:00:00+00:00']
399.                 ],
400.                [datetime.timedelta(days=141),
401.                 ['1990-01-05 00:00:00+00:00', '1990-01-26 00:00:00+00:00',
402.                  '1990-02-16 00:00:00+00:00', '1990-03-09 00:00:00+00:00',
403.                  '1990-03-30 00:00:00+00:00', '1990-04-20 00:00:00+00:00',
404.                  '1990-05-11 00:00:00+00:00']
405.                 ],
406.                [datetime.timedelta(days=40),
407.                 ['1990-01-03 00:00:00+00:00', '1990-01-10 00:00:00+00:00',
408.                  '1990-01-17 00:00:00+00:00', '1990-01-24 00:00:00+00:00',
409.                  '1990-01-31 00:00:00+00:00', '1990-02-07 00:00:00+00:00']
410.                 ],
411.                [datetime.timedelta(hours=40),
412.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 04:00:00+00:00',
413.                  '1990-01-01 08:00:00+00:00', '1990-01-01 12:00:00+00:00',
414.                  '1990-01-01 16:00:00+00:00', '1990-01-01 20:00:00+00:00',
415.                  '1990-01-02 00:00:00+00:00', '1990-01-02 04:00:00+00:00',
416.                  '1990-01-02 08:00:00+00:00', '1990-01-02 12:00:00+00:00',
417.                  '1990-01-02 16:00:00+00:00']
418.                 ],
419.                [datetime.timedelta(minutes=20),
420.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:05:00+00:00',
421.                  '1990-01-01 00:10:00+00:00', '1990-01-01 00:15:00+00:00',
422.                  '1990-01-01 00:20:00+00:00']
423.                 ],
424.                [datetime.timedelta(seconds=40),
425.                 ['1990-01-01 00:00:00+00:00', '1990-01-01 00:00:05+00:00',
426.                  '1990-01-01 00:00:10+00:00', '1990-01-01 00:00:15+00:00',
427.                  '1990-01-01 00:00:20+00:00', '1990-01-01 00:00:25+00:00',
428.                  '1990-01-01 00:00:30+00:00', '1990-01-01 00:00:35+00:00',
429.                  '1990-01-01 00:00:40+00:00']
430.                 ],
431.                [datetime.timedelta(microseconds=1500),
432.                 ['1989-12-31 23:59:59.999500+00:00',
433.                  '1990-01-01 00:00:00+00:00',
434.                  '1990-01-01 00:00:00.000500+00:00',
435.                  '1990-01-01 00:00:00.001000+00:00',
436.                  '1990-01-01 00:00:00.001500+00:00',
437.                  '1990-01-01 00:00:00.002000+00:00']
438.                 ],
439.                )
440. 
441.     for t_delta, expected in results:
442.         d2 = d1 + t_delta
443.         locator = _create_auto_date_locator(d1, d2)
444.         assert list(map(str, mdates.num2date(locator()))) == expected
445. 
446.     locator = mdates.AutoDateLocator(interval_multiples=False)
447.     assert locator.maxticks == {0: 11, 1: 12, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
448. 
449.     locator = mdates.AutoDateLocator(maxticks={dateutil.rrule.MONTHLY: 5})
450.     assert locator.maxticks == {0: 11, 1: 5, 3: 11, 4: 12, 5: 11, 6: 11, 7: 8}
451. 
452.     locator = mdates.AutoDateLocator(maxticks=5)
453.     assert locator.maxticks == {0: 5, 1: 5, 3: 5, 4: 5, 5: 5, 6: 5, 7: 5}
454. 
455. 
456. @_new_epoch_decorator
457. def test_auto_date_locator_intmult():
458.     def _create_auto_date_locator(date1, date2):
459.         locator = mdates.AutoDateLocator(interval_multiples=True)
460.         locator.create_dummy_axis()
461.         locator.axis.set_view_interval(*mdates.date2num([date1, date2]))
462.         return locator
463. 
464.     results = ([datetime.timedelta(weeks=52 * 200),
465.                 ['1980-01-01 00:00:00+00:00', '2000-01-01 00:00:00+00:00',
466.                  '2020-01-01 00:00:00+00:00', '2040-01-01 00:00:00+00:00',
467.                  '2060-01-01 00:00:00+00:00', '2080-01-01 00:00:00+00:00',
468.                  '2100-01-01 00:00:00+00:00', '2120-01-01 00:00:00+00:00',
469.                  '2140-01-01 00:00:00+00:00', '2160-01-01 00:00:00+00:00',
470.                  '2180-01-01 00:00:00+00:00', '2200-01-01 00:00:00+00:00']
471.                 ],
472.                [datetime.timedelta(weeks=52),
473.                 ['1997-01-01 00:00:00+00:00', '1997-02-01 00:00:00+00:00',
474.                  '1997-03-01 00:00:00+00:00', '1997-04-01 00:00:00+00:00',
475.                  '1997-05-01 00:00:00+00:00', '1997-06-01 00:00:00+00:00',
476.                  '1997-07-01 00:00:00+00:00', '1997-08-01 00:00:00+00:00',
477.                  '1997-09-01 00:00:00+00:00', '1997-10-01 00:00:00+00:00',
478.                  '1997-11-01 00:00:00+00:00', '1997-12-01 00:00:00+00:00']
479.                 ],
480.                [datetime.timedelta(days=141),
481.                 ['1997-01-01 00:00:00+00:00', '1997-01-15 00:00:00+00:00',
482.                  '1997-02-01 00:00:00+00:00', '1997-02-15 00:00:00+00:00',
483.                  '1997-03-01 00:00:00+00:00', '1997-03-15 00:00:00+00:00',
484.                  '1997-04-01 00:00:00+00:00', '1997-04-15 00:00:00+00:00',
485.                  '1997-05-01 00:00:00+00:00', '1997-05-15 00:00:00+00:00']
486.                 ],
487.                [datetime.timedelta(days=40),
488.                 ['1997-01-01 00:00:00+00:00', '1997-01-05 00:00:00+00:00',
489.                  '1997-01-09 00:00:00+00:00', '1997-01-13 00:00:00+00:00',
490.                  '1997-01-17 00:00:00+00:00', '1997-01-21 00:00:00+00:00',
491.                  '1997-01-25 00:00:00+00:00', '1997-01-29 00:00:00+00:00',
492.                  '1997-02-01 00:00:00+00:00', '1997-02-05 00:00:00+00:00',
493.                  '1997-02-09 00:00:00+00:00']
494.                 ],
495.                [datetime.timedelta(hours=40),
496.                 ['1997-01-01 00:00:00+00:00', '1997-01-01 04:00:00+00:00',
497.                  '1997-01-01 08:00:00+00:00', '1997-01-01 12:00:00+00:00',
498.                  '1997-01-01 16:00:00+00:00', '1997-01-01 20:00:00+00:00',
499.                  '1997-01-02 00:00:00+00:00', '1997-01-02 04:00:00+00:00',
500.                  '1997-01-02 08:00:00+00:00', '1997-01-02 12:00:00+00:00',


File: lib/matplotlib/tests/test_dates.py
Line number range: 532 - 541
Content:
532. def test_concise_formatter_subsecond():
533.     locator = mdates.AutoDateLocator(interval_multiples=True)
534.     formatter = mdates.ConciseDateFormatter(locator)
535.     year_1996 = 9861.0
536.     strings = formatter.format_ticks([
537.         year_1996,
538.         year_1996 + 500 / mdates.MUSECONDS_PER_DAY,
539.         year_1996 + 900 / mdates.MUSECONDS_PER_DAY])
540.     assert strings == ['00:00', '00.0005', '00.0009']
541. 


File: lib/matplotlib/tests/test_dates.py
Line number range: 592 - 613
Content:
592. @pytest.mark.parametrize('t_delta, expected', [
593.     (datetime.timedelta(seconds=0.01), '1997-Jan-01 00:00'),
594.     (datetime.timedelta(minutes=1), '1997-Jan-01 00:01'),
595.     (datetime.timedelta(hours=1), '1997-Jan-01'),
596.     (datetime.timedelta(days=1), '1997-Jan-02'),
597.     (datetime.timedelta(weeks=1), '1997-Jan'),
598.     (datetime.timedelta(weeks=26), ''),
599.     (datetime.timedelta(weeks=520), '')
600. ])
601. def test_concise_formatter_show_offset(t_delta, expected):
602.     d1 = datetime.datetime(1997, 1, 1)
603.     d2 = d1 + t_delta
604. 
605.     fig, ax = plt.subplots()
606.     locator = mdates.AutoDateLocator()
607.     formatter = mdates.ConciseDateFormatter(locator)
608.     ax.xaxis.set_major_locator(locator)
609.     ax.xaxis.set_major_formatter(formatter)
610. 
611.     ax.plot([d1, d2], [0, 0])
612.     fig.canvas.draw()
613.     assert formatter.get_offset() == expected


File: lib/matplotlib/tests/test_dates.py
Line number range: 616 - 635
Content:
616. def test_offset_changes():
617.     fig, ax = plt.subplots()
618. 
619.     d1 = datetime.datetime(1997, 1, 1)
620.     d2 = d1 + datetime.timedelta(weeks=520)
621. 
622.     locator = mdates.AutoDateLocator()
623.     formatter = mdates.ConciseDateFormatter(locator)
624.     ax.xaxis.set_major_locator(locator)
625.     ax.xaxis.set_major_formatter(formatter)
626. 
627.     ax.plot([d1, d2], [0, 0])
628.     fig.draw_without_rendering()
629.     assert formatter.get_offset() == ''
630.     ax.set_xlim(d1, d1 + datetime.timedelta(weeks=3))
631.     fig.draw_without_rendering()
632.     assert formatter.get_offset() == '1997-Jan'
633.     ax.set_xlim(d1, d1 + datetime.timedelta(weeks=520))
634.     fig.draw_without_rendering()
635.     assert formatter.get_offset() == ''


File: lib/matplotlib/tests/test_dates.py
Line number range: 1289 - 1300
Content:
1289. def test_concise_formatter_exceptions():
1290.     locator = mdates.AutoDateLocator()
1291.     with pytest.raises(ValueError, match="formats argument must be a list"):
1292.         mdates.ConciseDateFormatter(locator, formats=['', '%Y'])
1293. 
1294.     with pytest.raises(ValueError,
1295.                        match="zero_formats argument must be a list"):
1296.         mdates.ConciseDateFormatter(locator, zero_formats=['', '%Y'])
1297. 
1298.     with pytest.raises(ValueError,
1299.                        match="offset_formats argument must be a list"):
1300.         mdates.ConciseDateFormatter(locator, offset_formats=['', '%Y'])


File: lib/matplotlib/tests/test_dates.py
Line number range: 1303 - 1307
Content:
1303. def test_concise_formatter_call():
1304.     locator = mdates.AutoDateLocator()
1305.     formatter = mdates.ConciseDateFormatter(locator)
1306.     assert formatter(19002.0) == '2022'
1307.     assert formatter.format_data_short(19002.0) == '2022-01-10 00:00:00'

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-20 20:04:59,063 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have identified two relevant tests for `ConciseDateFormatter` (`test_concise_formatter_show_offset` and `test_offset_changes`), but I need a third to satisfy the user's request. The provided context for `lib/matplotlib/tests/test_dates.py` has a gap between lines 541 and 592, a region that is surrounded by other tests for `ConciseDateFormatter`. It is likely that another relevant test exists in this missing section." query='Please provide the content of `lib/matplotlib/tests/test_dates.py` between lines 542 and 591.' extra_requirements='' purpose="This is to find a third relevant test case for `ConciseDateFormatter` to fully address the user's request."
2025-12-20 20:04:59,064 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the content of `lib/matplotlib/tests/test_dates.py` between lines 542 and 591.
2025-12-20 20:04:59,065 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-20 20:04:59,065 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-20 20:04:59,066 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-20 20:04:59,066 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the content of `lib/matplotlib/tests/test_dates.py` between lines 542 and 591.
Purpose: This is to find a third relevant test case for `ConciseDateFormatter` to fully address the user's request.
2025-12-20 20:05:01,200 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_dates.py", "end_line": 591.0, "start_line": 542.0}'}, '__gemini_function_call_thought_signatures__': {'074c1c0f-6082-499b-a3d6-f9ad6bd0ac7a': 'CtEDAY89a1+0KHO7sQOlsnbdjgDdvEmE8jaso2H7pZCoMR8rl50zIvTSSShHj4jo/MFH5zdWwNVW8HImJ2nY0IUuao6gHRteFqHb8COF8C87WsucUDRKdNTJaw0fo1qBFKXH6XoKY5qXmmkIdyQ94yEsIuNy85MzOOPm6ZeGiXlP7tyyt2uueL6O5k23mWLNn53dOLeolsf1oscHcryo12h/80vkP2QZw6pRIal1oaJrEv/WgjY4Zj4XGALs3zTxdgCRLsTjA9TPUsyGM11ms2SwlKE/lB0APVfLVPExNUZWbXqMG1R/S4g/jeDQFT+KE4vhHBVN6sGWa9+/+fLCD24wCdYeDvGQVF0AazMsJtW2fkQtr0zZIthqKXjQlbrI2FpCpOVDWM3Y/3+UmoZOfhkue9ljMO4S64p1B56spQuicjwsOMIbWzPaL9qboWMD+nKYYrNvZVviTfFoXpg2Jn+hjS3QHvMr6hVJq5tzqWT7dp/UrmVAAp3Nen3dFgl2tR8p/N80drYtZDuGrFZGwIJqc7fePp/hLiszDJdzW2lBQXsjYPOikF9cJVU2X0v+YTjUgYfRvYbLPL8cKpxIiGmCioBK+z9lB3EgEZnOd1aVHsd0'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2151, 'candidates_token_count': 31, 'total_token_count': 2312, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2151}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 31}], 'thoughts_token_count': 130, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.13584975273378433, 'model_name': 'gemini-2.5-pro'} id='run--d564aed9-b1b9-457d-939d-d853932e4e2c-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_dates.py', 'end_line': 591.0, 'start_line': 542.0}, 'id': '074c1c0f-6082-499b-a3d6-f9ad6bd0ac7a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2151, 'output_tokens': 31, 'total_tokens': 2312, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 130}}
2025-12-20 20:05:03,249 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the content of `lib/matplotlib/tests/test_dates.py` from line 542 to 591. This snippet includes the `test_concise_formatter` function, which contains test cases for the `ConciseDateFormatter`. This should provide the user with the relevant test case they were looking for.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3183, 'candidates_token_count': 72, 'total_token_count': 3339, 'cached_content_token_count': 1579, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3313}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1579}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 72}], 'thoughts_token_count': 84}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1363367239634196, 'model_name': 'gemini-2.5-pro'} id='run--c10cd988-ff97-4f01-9961-8ff1060c4543-0' usage_metadata={'input_tokens': 3183, 'output_tokens': 72, 'total_tokens': 3339, 'input_token_details': {'cache_read': 1579}, 'output_token_details': {'reasoning': 84}}
2025-12-20 20:05:03,251 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the content of `lib/matplotlib/tests/test_dates.py` between lines 542 and 591.
--- END QUERY ---



--- BEGIN PURPOSE ---
This is to find a third relevant test case for `ConciseDateFormatter` to fully address the user's request.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_dates.py
Line number range: 542 - 591
Content:
542. 
543. def test_concise_formatter():
544.     def _create_auto_date_locator(date1, date2):
545.         fig, ax = plt.subplots()
546. 
547.         locator = mdates.AutoDateLocator(interval_multiples=True)
548.         formatter = mdates.ConciseDateFormatter(locator)
549.         ax.yaxis.set_major_locator(locator)
550.         ax.yaxis.set_major_formatter(formatter)
551.         ax.set_ylim(date1, date2)
552.         fig.canvas.draw()
553.         sts = [st.get_text() for st in ax.get_yticklabels()]
554.         return sts
555. 
556.     d1 = datetime.datetime(1997, 1, 1)
557.     results = ([datetime.timedelta(weeks=52 * 200),
558.                 [str(t) for t in range(1980, 2201, 20)]
559.                 ],
560.                [datetime.timedelta(weeks=52),
561.                 ['1997', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug',
562.                  'Sep', 'Oct', 'Nov', 'Dec']
563.                 ],
564.                [datetime.timedelta(days=141),
565.                 ['Jan', '15', 'Feb', '15', 'Mar', '15', 'Apr', '15',
566.                  'May', '15']
567.                 ],
568.                [datetime.timedelta(days=40),
569.                 ['Jan', '05', '09', '13', '17', '21', '25', '29', 'Feb',
570.                  '05', '09']
571.                 ],
572.                [datetime.timedelta(hours=40),
573.                 ['Jan-01', '04:00', '08:00', '12:00', '16:00', '20:00',
574.                  'Jan-02', '04:00', '08:00', '12:00', '16:00']
575.                 ],
576.                [datetime.timedelta(minutes=20),
577.                 ['00:00', '00:05', '00:10', '00:15', '00:20']
578.                 ],
579.                [datetime.timedelta(seconds=40),
580.                 ['00:00', '05', '10', '15', '20', '25', '30', '35', '40']
581.                 ],
582.                [datetime.timedelta(seconds=2),
583.                 ['59.5', '00:00', '00.5', '01.0', '01.5', '02.0', '02.5']
584.                 ],
585.                )
586.     for t_delta, expected in results:
587.         d2 = d1 + t_delta
588.         strings = _create_auto_date_locator(d1, d2)
589.         assert strings == expected
590.

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-20 20:05:08,452 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user query specifically asks for the content of the file `lib/matplotlib/tests/test_dates.py` between lines 542 and 591.\n\n2. Extended relevance:\n   - The provided context exactly matches the file path and line range specified in the query.\n   - This block of code contains the `test_concise_formatter` function, which is a test case for `ConciseDateFormatter` as mentioned in the purpose.', relative_path='lib/matplotlib/tests/test_dates.py', start_line=542, end_line=591)]
2025-12-20 20:05:08,453 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the content of `lib/matplotlib/tests/test_dates.py` between lines 542 and 591.
2025-12-20 20:05:08,454 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-20 20:05:08,454 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-20 20:05:08,454 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 6 existing contexts
2025-12-20 20:05:08,454 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 7 total contexts (removed 0 duplicates)
2025-12-20 20:05:08,455 - thread-134766475085504.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-20 20:05:08,456 - thread-134766475085504.prometheus_context_collector - INFO - Successfully retrieved 7 context snippets
