2025-12-21 04:36:43,165 - thread-132654548649664.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: [Bug]: Unable to pickle figure with draggable legend

Description: ### Bug summary

I am unable to pickle figure with draggable legend. Same error comes for draggable annotations.





### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax = fig.add_subplot(111)

time=[0,1,2,3,4]
speed=[40,43,45,47,48]

ax.plot(time,speed,label="speed")

leg=ax.legend()
leg.set_draggable(True) #pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome

`TypeError: cannot pickle 'FigureCanvasQTAgg' object`

### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows 10

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

3.10

### Jupyter version

_No response_

### Installation

pip

Patch information:
diff --git a/lib/matplotlib/legend.py b/lib/matplotlib/legend.py
index ff6abdb958..b3bb2e7c91 100644
--- a/lib/matplotlib/legend.py
+++ b/lib/matplotlib/legend.py
@@ -1208,6 +1208,12 @@ class Legend(Artist):
         """Return ``True`` if the legend is draggable, ``False`` otherwise."""
         return self._draggable is not None
 
+    def __getstate__(self):
+        d = super().__getstate__()
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas.
+        d['_draggable'] = None
+        return d
+
 
 # Helper functions to parse legend arguments for both `figure.legend` and
 # `axes.legend`:
diff --git a/lib/matplotlib/text.py b/lib/matplotlib/text.py
index 0f874ba33d..ee28309f8b 100644
--- a/lib/matplotlib/text.py
+++ b/lib/matplotlib/text.py
@@ -236,6 +236,10 @@ class Text(Artist):
         d = super().__getstate__()
         # remove the cached _renderer (if it exists)
         d['_renderer'] = None
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas via
+        # DraggableAnnotation.
+        if '_draggable' in d:
+            d['_draggable'] = None
         return d
 
     def contains(self, mouseevent):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 04:36:43,240 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   ├── 25112-GG.rst
|   |   |   |   ├── 25192-DS.rst
|   |   |   |   └── 25255-RR.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   ├── 24990-OG.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   └── 25282-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 24923-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.6.0.rst
|   |   |   ├── api_changes_3.6.1.rst
|   |   |   ├── api_changes_3.7.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.7.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── README.rst
|       |   ├── pie_hatch.rst
|       |   ├── savefig_bbox_layout.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── github_stats_3.6.0.rst
|       |   ├── github_stats_3.6.1.rst
|       |   ├── github_stats_3.6.2.rst
|       |   ├── github_stats_3.6.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   ├── whats_new_3.6.0.rst
|       |   └── whats_new_3.7.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── galleries
|   ├── examples
|   |   ├── README.txt
|   |   ├── animation
|   |   |   ├── README.txt
|   |   |   ├── animate_decay.py
|   |   |   ├── animated_histogram.py
|   |   |   ├── animation_demo.py
|   |   |   ├── bayes_update.py
|   |   |   ├── double_pendulum.py
|   |   |   ├── dynamic_image.py
|   |   |   ├── frame_grabbing_sgskip.py
|   |   |   ├── multiple_axes.py
|   |   |   ├── pause_resume.py
|   |   |   ├── rain.py
|   |   |   ├── random_walk.py
|   |   |   ├── simple_anim.py
|   |   |   ├── simple_scatter.py
|   |   |   ├── strip_chart.py
|   |   |   └── unchained.py
|   |   ├── axes_grid1
|   |   |   ├── README.txt
|   |   |   ├── demo_anchored_direction_arrows.py
|   |   |   ├── demo_axes_divider.py
|   |   |   ├── demo_axes_grid.py
|   |   |   ├── demo_axes_grid2.py
|   |   |   ├── demo_axes_hbox_divider.py
|   |   |   ├── demo_axes_rgb.py
|   |   |   ├── demo_colorbar_of_inset_axes.py
|   |   |   ├── demo_colorbar_with_axes_divider.py
|   |   |   ├── demo_colorbar_with_inset_locator.py
|   |   |   ├── demo_edge_colorbar.py
|   |   |   ├── demo_fixed_size_axes.py
|   |   |   ├── demo_imagegrid_aspect.py
|   |   |   ├── inset_locator_demo.py
|   |   |   ├── inset_locator_demo2.py
|   |   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   |   ├── parasite_simple.py
|   |   |   ├── parasite_simple2.py
|   |   |   ├── scatter_hist_locatable_axes.py
|   |   |   ├── simple_anchored_artists.py
|   |   |   ├── simple_axes_divider1.py
|   |   |   ├── simple_axes_divider3.py
|   |   |   ├── simple_axesgrid.py
|   |   |   ├── simple_axesgrid2.py
|   |   |   ├── simple_axisline4.py
|   |   |   └── simple_colorbar.py
|   |   ├── axisartist
|   |   |   ├── README.txt
|   |   |   ├── axis_direction.py
|   |   |   ├── demo_axis_direction.py
|   |   |   ├── demo_axisline_style.py
|   |   |   ├── demo_curvelinear_grid.py
|   |   |   ├── demo_curvelinear_grid2.py
|   |   |   ├── demo_floating_axes.py
|   |   |   ├── demo_floating_axis.py
|   |   |   ├── demo_parasite_axes.py
|   |   |   ├── demo_parasite_axes2.py
|   |   |   ├── demo_ticklabel_alignment.py
|   |   |   ├── demo_ticklabel_direction.py
|   |   |   ├── simple_axis_direction01.py
|   |   |   ├── simple_axis_direction03.py
|   |   |   ├── simple_axis_pad.py
|   |   |   ├── simple_axisartist1.py
|   |   |   ├── simple_axisline.py
|   |   |   └── simple_axisline3.py
|   |   ├── color
|   |   |   ├── README.txt
|   |   |   ├── color_by_yvalue.py
|   |   |   ├── color_cycle_default.py
|   |   |   ├── color_demo.py
|   |   |   ├── colorbar_basics.py
|   |   |   ├── colormap_reference.py
|   |   |   ├── custom_cmap.py
|   |   |   └── named_colors.py
|   |   ├── event_handling
|   |   |   ├── README.txt
|   |   |   ├── close_event.py
|   |   |   ├── coords_demo.py
|   |   |   ├── cursor_demo.py
|   |   |   ├── data_browser.py
|   |   |   ├── figure_axes_enter_leave.py
|   |   |   ├── ginput_manual_clabel_sgskip.py
|   |   |   ├── image_slices_viewer.py
|   |   |   ├── keypress_demo.py
|   |   |   ├── lasso_demo.py
|   |   |   ├── legend_picking.py
|   |   |   ├── looking_glass.py
|   |   |   ├── path_editor.py
|   |   |   ├── pick_event_demo.py
|   |   |   ├── pick_event_demo2.py
|   |   |   ├── poly_editor.py
|   |   |   ├── pong_sgskip.py
|   |   |   ├── resample.py
|   |   |   ├── timers.py
|   |   |   ├── trifinder_event_demo.py
|   |   |   ├── viewlims.py
|   |   |   └── zoom_window.py
|   |   ├── images_contours_and_fields
|   |   |   ├── README.txt
|   |   |   ├── affine_image.py
|   |   |   ├── barb_demo.py
|   |   |   ├── barcode_demo.py
|   |   |   ├── colormap_interactive_adjustment.py
|   |   |   ├── colormap_normalizations.py
|   |   |   ├── colormap_normalizations_symlognorm.py
|   |   |   ├── contour_corner_mask.py
|   |   |   ├── contour_demo.py
|   |   |   ├── contour_image.py
|   |   |   ├── contour_label_demo.py
|   |   |   ├── contourf_demo.py
|   |   |   ├── contourf_hatching.py
|   |   |   ├── contourf_log.py
|   |   |   ├── contours_in_optimization_demo.py
|   |   |   ├── demo_bboximage.py
|   |   |   ├── figimage_demo.py
|   |   |   ├── image_annotated_heatmap.py
|   |   |   ├── image_antialiasing.py
|   |   |   ├── image_clip_path.py
|   |   |   ├── image_demo.py
|   |   |   ├── image_masked.py
|   |   |   ├── image_nonuniform.py
|   |   |   ├── image_transparency_blend.py
|   |   |   ├── image_zcoord.py
|   |   |   ├── interpolation_methods.py
|   |   |   ├── irregulardatagrid.py
|   |   |   ├── layer_images.py
|   |   |   ├── matshow.py
|   |   |   ├── multi_image.py
|   |   |   ├── pcolor_demo.py
|   |   |   ├── pcolormesh_grids.py
|   |   |   ├── pcolormesh_levels.py
|   |   |   ├── plot_streamplot.py
|   |   |   ├── quadmesh_demo.py
|   |   |   ├── quiver_demo.py
|   |   |   ├── quiver_simple_demo.py
|   |   |   ├── shading_example.py
|   |   |   ├── specgram_demo.py
|   |   |   ├── spy_demos.py
|   |   |   ├── tricontour_demo.py
|   |   |   ├── tricontour_smooth_delaunay.py
|   |   |   ├── tricontour_smooth_user.py
|   |   |   ├── trigradient_demo.py
|   |   |   ├── triinterp_demo.py
|   |   |   ├── tripcolor_demo.py
|   |   |   ├── triplot_demo.py
|   |   |   └── watermark_image.py
|   |   ├── lines_bars_and_markers
|   |   |   ├── README.txt
|   |   |   ├── bar_colors.py
|   |   |   ├── bar_label_demo.py
|   |   |   ├── bar_stacked.py
|   |   |   ├── barchart.py
|   |   |   ├── barh.py
|   |   |   ├── broken_barh.py
|   |   |   ├── capstyle.py
|   |   |   ├── categorical_variables.py
|   |   |   ├── cohere.py
|   |   |   ├── csd_demo.py
|   |   |   ├── curve_error_band.py
|   |   |   ├── errorbar_limits_simple.py
|   |   |   ├── errorbar_subsample.py
|   |   |   ├── eventcollection_demo.py
|   |   |   ├── eventplot_demo.py
|   |   |   ├── fill.py
|   |   |   ├── fill_between_alpha.py
|   |   |   ├── fill_between_demo.py
|   |   |   ├── fill_betweenx_demo.py
|   |   |   ├── filled_step.py
|   |   |   ├── gradient_bar.py
|   |   |   ├── hat_graph.py
|   |   |   ├── horizontal_barchart_distribution.py
|   |   |   ├── joinstyle.py
|   |   |   ├── line_demo_dash_control.py
|   |   |   ├── lines_with_ticks_demo.py
|   |   |   ├── linestyles.py
|   |   |   ├── marker_reference.py
|   |   |   ├── markevery_demo.py
|   |   |   ├── masked_demo.py
|   |   |   ├── multicolored_line.py
|   |   |   ├── multivariate_marker_plot.py
|   |   |   ├── psd_demo.py
|   |   |   ├── scatter_custom_symbol.py
|   |   |   ├── scatter_demo2.py
|   |   |   ├── scatter_hist.py
|   |   |   ├── scatter_masked.py
|   |   |   ├── scatter_star_poly.py
|   |   |   ├── scatter_with_legend.py
|   |   |   ├── simple_plot.py
|   |   |   ├── span_regions.py
|   |   |   ├── spectrum_demo.py
|   |   |   ├── stackplot_demo.py
|   |   |   ├── stairs_demo.py
|   |   |   ├── stem_plot.py
|   |   |   ├── step_demo.py
|   |   |   ├── timeline.py
|   |   |   ├── vline_hline_demo.py
|   |   |   └── xcorr_acorr_demo.py
|   |   ├── misc
|   |   |   ├── README.txt
|   |   |   ├── anchored_artists.py
|   |   |   ├── bbox_intersect.py
|   |   |   ├── contour_manual.py
|   |   |   ├── coords_report.py
|   |   |   ├── custom_projection.py
|   |   |   ├── customize_rc.py
|   |   |   ├── demo_agg_filter.py
|   |   |   ├── demo_ribbon_box.py
|   |   |   ├── fig_x.py
|   |   |   ├── fill_spiral.py
|   |   |   ├── findobj_demo.py
|   |   |   ├── font_indexing.py
|   |   |   ├── ftface_props.py
|   |   |   ├── histogram_path.py
|   |   |   ├── hyperlinks_sgskip.py
|   |   |   ├── image_thumbnail_sgskip.py
|   |   |   ├── keyword_plotting.py
|   |   |   ├── logos2.py
|   |   |   ├── multipage_pdf.py
|   |   |   ├── multiprocess_sgskip.py
|   |   |   ├── packed_bubbles.py
|   |   |   ├── patheffect_demo.py
|   |   |   ├── print_stdout_sgskip.py
|   |   |   ├── rasterization_demo.py
|   |   |   ├── set_and_get.py
|   |   |   ├── svg_filter_line.py
|   |   |   ├── svg_filter_pie.py
|   |   |   ├── table_demo.py
|   |   |   ├── tickedstroke_demo.py
|   |   |   ├── transoffset.py
|   |   |   └── zorder_demo.py
|   |   ├── mplot3d
|   |   |   ├── 2dcollections3d.py
|   |   |   ├── 3d_bars.py
|   |   |   ├── README.txt
|   |   |   ├── bars3d.py
|   |   |   ├── box3d.py
|   |   |   ├── contour3d.py
|   |   |   ├── contour3d_2.py
|   |   |   ├── contour3d_3.py
|   |   |   ├── contourf3d.py
|   |   |   ├── contourf3d_2.py
|   |   |   ├── custom_shaded_3d_surface.py
|   |   |   ├── errorbar3d.py
|   |   |   ├── hist3d.py
|   |   |   ├── lines3d.py
|   |   |   ├── lorenz_attractor.py
|   |   |   ├── mixed_subplots.py
|   |   |   ├── offset.py
|   |   |   ├── pathpatch3d.py
|   |   |   ├── polys3d.py
|   |   |   ├── projections.py
|   |   |   ├── quiver3d.py
|   |   |   ├── rotate_axes3d_sgskip.py
|   |   |   ├── scatter3d.py
|   |   |   ├── stem3d_demo.py
|   |   |   ├── subplot3d.py
|   |   |   ├── surface3d.py
|   |   |   ├── surface3d_2.py
|   |   |   ├── surface3d_3.py
|   |   |   ├── surface3d_radial.py
|   |   |   ├── text3d.py
|   |   |   ├── tricontour3d.py
|   |   |   ├── tricontourf3d.py
|   |   |   ├── trisurf3d.py
|   |   |   ├── trisurf3d_2.py
|   |   |   ├── view_planes_3d.py
|   |   |   ├── voxels.py
|   |   |   ├── voxels_numpy_logo.py
|   |   |   ├── voxels_rgb.py
|   |   |   ├── voxels_torus.py
|   |   |   ├── wire3d.py
|   |   |   ├── wire3d_animation_sgskip.py
|   |   |   └── wire3d_zero_stride.py
|   |   ├── pie_and_polar_charts
|   |   |   ├── README.txt
|   |   |   ├── bar_of_pie.py
|   |   |   ├── nested_pie.py
|   |   |   ├── pie_and_donut_labels.py
|   |   |   ├── pie_demo2.py
|   |   |   ├── pie_features.py
|   |   |   ├── polar_bar.py
|   |   |   ├── polar_demo.py
|   |   |   ├── polar_error_caps.py
|   |   |   ├── polar_legend.py
|   |   |   └── polar_scatter.py
|   |   ├── pyplots
|   |   |   ├── README.txt
|   |   |   ├── axline.py
|   |   |   ├── pyplot_simple.py
|   |   |   ├── pyplot_text.py
|   |   |   ├── pyplot_three.py
|   |   |   └── pyplot_two_subplots.py
|   |   ├── scales
|   |   |   ├── README.txt
|   |   |   ├── asinh_demo.py
|   |   |   ├── aspect_loglog.py
|   |   |   ├── custom_scale.py
|   |   |   ├── log_bar.py
|   |   |   ├── log_demo.py
|   |   |   ├── logit_demo.py
|   |   |   ├── power_norm.py
|   |   |   ├── scales.py
|   |   |   ├── semilogx_demo.py
|   |   |   └── symlog_demo.py
|   |   ├── shapes_and_collections
|   |   |   ├── README.txt
|   |   |   ├── arrow_guide.py
|   |   |   ├── artist_reference.py
|   |   |   ├── collections.py
|   |   |   ├── compound_path.py
|   |   |   ├── dolphin.py
|   |   |   ├── donut.py
|   |   |   ├── ellipse_collection.py
|   |   |   ├── ellipse_demo.py
|   |   |   ├── fancybox_demo.py
|   |   |   ├── hatch_demo.py
|   |   |   ├── hatch_style_reference.py
|   |   |   ├── line_collection.py
|   |   |   ├── patch_collection.py
|   |   |   ├── path_patch.py
|   |   |   ├── quad_bezier.py
|   |   |   └── scatter.py
|   |   ├── showcase
|   |   |   ├── README.txt
|   |   |   ├── anatomy.py
|   |   |   ├── firefox.py
|   |   |   ├── integral.py
|   |   |   ├── mandelbrot.py
|   |   |   ├── stock_prices.py
|   |   |   └── xkcd.py
|   |   ├── specialty_plots
|   |   |   ├── README.txt
|   |   |   ├── advanced_hillshading.py
|   |   |   ├── anscombe.py
|   |   |   ├── hinton_demo.py
|   |   |   ├── leftventricle_bullseye.py
|   |   |   ├── mri_demo.py
|   |   |   ├── mri_with_eeg.py
|   |   |   ├── radar_chart.py
|   |   |   ├── sankey_basics.py
|   |   |   ├── sankey_links.py
|   |   |   ├── sankey_rankine.py
|   |   |   ├── skewt.py
|   |   |   └── topographic_hillshading.py
|   |   ├── spines
|   |   |   ├── README.txt
|   |   |   ├── centered_spines_with_arrows.py
|   |   |   ├── multiple_yaxis_with_spines.py
|   |   |   ├── spine_placement_demo.py
|   |   |   ├── spines.py
|   |   |   └── spines_dropped.py
|   |   ├── statistics
|   |   |   ├── README.txt
|   |   |   ├── barchart_demo.py
|   |   |   ├── boxplot.py
|   |   |   ├── boxplot_color.py
|   |   |   ├── boxplot_demo.py
|   |   |   ├── boxplot_vs_violin.py
|   |   |   ├── bxp.py
|   |   |   ├── confidence_ellipse.py
|   |   |   ├── customized_violin.py
|   |   |   ├── errorbar.py
|   |   |   ├── errorbar_features.py
|   |   |   ├── errorbar_limits.py
|   |   |   ├── errorbars_and_boxes.py
|   |   |   ├── hexbin_demo.py
|   |   |   ├── hist.py
|   |   |   ├── histogram_cumulative.py
|   |   |   ├── histogram_features.py
|   |   |   ├── histogram_histtypes.py
|   |   |   ├── histogram_multihist.py
|   |   |   ├── multiple_histograms_side_by_side.py
|   |   |   ├── time_series_histogram.py
|   |   |   └── violinplot.py
|   |   ├── style_sheets
|   |   |   ├── README.txt
|   |   |   ├── bmh.py
|   |   |   ├── dark_background.py
|   |   |   ├── fivethirtyeight.py
|   |   |   ├── ggplot.py
|   |   |   ├── grayscale.py
|   |   |   ├── plot_solarizedlight2.py
|   |   |   └── style_sheets_reference.py
|   |   ├── subplots_axes_and_figures
|   |   |   ├── README.txt
|   |   |   ├── align_labels_demo.py
|   |   |   ├── auto_subplots_adjust.py
|   |   |   ├── axes_box_aspect.py
|   |   |   ├── axes_demo.py
|   |   |   ├── axes_margins.py
|   |   |   ├── axes_props.py
|   |   |   ├── axes_zoom_effect.py
|   |   |   ├── axhspan_demo.py
|   |   |   ├── axis_equal_demo.py
|   |   |   ├── axis_labels_demo.py
|   |   |   ├── broken_axis.py
|   |   |   ├── colorbar_placement.py
|   |   |   ├── custom_figure_class.py
|   |   |   ├── demo_constrained_layout.py
|   |   |   ├── demo_tight_layout.py
|   |   |   ├── fahrenheit_celsius_scales.py
|   |   |   ├── figure_size_units.py
|   |   |   ├── figure_title.py
|   |   |   ├── ganged_plots.py
|   |   |   ├── geo_demo.py
|   |   |   ├── gridspec_and_subplots.py
|   |   |   ├── gridspec_multicolumn.py
|   |   |   ├── gridspec_nested.py
|   |   |   ├── invert_axes.py
|   |   |   ├── mosaic.py
|   |   |   ├── multiple_figs_demo.py
|   |   |   ├── secondary_axis.py
|   |   |   ├── share_axis_lims_views.py
|   |   |   ├── shared_axis_demo.py
|   |   |   ├── subfigures.py
|   |   |   ├── subplot.py
|   |   |   ├── subplots_adjust.py
|   |   |   ├── subplots_demo.py
|   |   |   ├── two_scales.py
|   |   |   └── zoom_inset_axes.py
|   |   ├── text_labels_and_annotations
|   |   |   ├── README.txt
|   |   |   ├── accented_text.py
|   |   |   ├── align_ylabels.py
|   |   |   ├── angle_annotation.py
|   |   |   ├── angles_on_bracket_arrows.py
|   |   |   ├── annotate_transform.py
|   |   |   ├── annotation_basic.py
|   |   |   ├── annotation_demo.py
|   |   |   ├── annotation_polar.py
|   |   |   ├── arrow_demo.py
|   |   |   ├── autowrap.py
|   |   |   ├── custom_legends.py
|   |   |   ├── date.py
|   |   |   ├── demo_annotation_box.py
|   |   |   ├── demo_text_path.py
|   |   |   ├── demo_text_rotation_mode.py
|   |   |   ├── dfrac_demo.py
|   |   |   ├── engineering_formatter.py
|   |   |   ├── fancyarrow_demo.py
|   |   |   ├── fancytextbox_demo.py
|   |   |   ├── figlegend_demo.py
|   |   |   ├── font_family_rc.py
|   |   |   ├── font_file.py
|   |   |   ├── font_table.py
|   |   |   ├── fonts_demo.py
|   |   |   ├── fonts_demo_kw.py
|   |   |   ├── label_subplots.py
|   |   |   ├── legend.py
|   |   |   ├── legend_demo.py
|   |   |   ├── line_with_text.py
|   |   |   ├── mathtext_asarray.py
|   |   |   ├── mathtext_demo.py
|   |   |   ├── mathtext_examples.py
|   |   |   ├── mathtext_fontfamily_example.py
|   |   |   ├── multiline.py
|   |   |   ├── placing_text_boxes.py
|   |   |   ├── rainbow_text.py
|   |   |   ├── stix_fonts_demo.py
|   |   |   ├── tex_demo.py
|   |   |   ├── text_alignment.py
|   |   |   ├── text_commands.py
|   |   |   ├── text_fontdict.py
|   |   |   ├── text_rotation_relative_to_line.py
|   |   |   ├── titles_demo.py
|   |   |   ├── unicode_minus.py
|   |   |   ├── usetex_baseline_test.py
|   |   |   ├── usetex_fonteffects.py
|   |   |   └── watermark_text.py
|   |   ├── ticks
|   |   |   ├── README.txt
|   |   |   ├── auto_ticks.py
|   |   |   ├── centered_ticklabels.py
|   |   |   ├── colorbar_tick_labelling_demo.py
|   |   |   ├── custom_ticker1.py
|   |   |   ├── date_concise_formatter.py
|   |   |   ├── date_demo_convert.py
|   |   |   ├── date_demo_rrule.py
|   |   |   ├── date_formatters_locators.py
|   |   |   ├── date_index_formatter.py
|   |   |   ├── date_precision_and_epochs.py
|   |   |   ├── dollar_ticks.py
|   |   |   ├── fig_axes_customize_simple.py
|   |   |   ├── major_minor_demo.py
|   |   |   ├── scalarformatter.py
|   |   |   ├── tick-formatters.py
|   |   |   ├── tick-locators.py
|   |   |   ├── tick_label_right.py
|   |   |   ├── tick_labels_from_values.py
|   |   |   ├── tick_xlabel_top.py
|   |   |   ├── ticklabels_rotation.py
|   |   |   └── ticks_too_many.py
|   |   ├── units
|   |   |   ├── README.txt
|   |   |   ├── annotate_with_units.py
|   |   |   ├── artist_tests.py
|   |   |   ├── bar_demo2.py
|   |   |   ├── bar_unit_demo.py
|   |   |   ├── basic_units.py
|   |   |   ├── ellipse_with_units.py
|   |   |   ├── evans_test.py
|   |   |   ├── radian_demo.py
|   |   |   ├── units_sample.py
|   |   |   └── units_scatter.py
|   |   ├── user_interfaces
|   |   |   ├── README.txt
|   |   |   ├── canvasagg.py
|   |   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk3_sgskip.py
|   |   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk4_sgskip.py
|   |   |   ├── embedding_in_qt_sgskip.py
|   |   |   ├── embedding_in_tk_sgskip.py
|   |   |   ├── embedding_in_wx2_sgskip.py
|   |   |   ├── embedding_in_wx3_sgskip.py
|   |   |   ├── embedding_in_wx4_sgskip.py
|   |   |   ├── embedding_in_wx5_sgskip.py
|   |   |   ├── embedding_webagg_sgskip.py
|   |   |   ├── fourier_demo_wx_sgskip.py
|   |   |   ├── gtk3_spreadsheet_sgskip.py
|   |   |   ├── gtk4_spreadsheet_sgskip.py
|   |   |   ├── images
|   |   |   ├── mathtext_wx_sgskip.py
|   |   |   ├── mpl_with_glade3_sgskip.py
|   |   |   ├── mplcvd.py
|   |   |   ├── pylab_with_gtk3_sgskip.py
|   |   |   ├── pylab_with_gtk4_sgskip.py
|   |   |   ├── svg_histogram_sgskip.py
|   |   |   ├── svg_tooltip_sgskip.py
|   |   |   ├── toolmanager_sgskip.py
|   |   |   ├── web_application_server_sgskip.py
|   |   |   └── wxcursor_demo_sgskip.py
|   |   ├── userdemo
|   |   |   ├── README.txt
|   |   |   ├── annotate_explain.py
|   |   |   ├── annotate_simple_coord02.py
|   |   |   ├── annotate_text_arrow.py
|   |   |   ├── connect_simple01.py
|   |   |   ├── connectionstyle_demo.py
|   |   |   ├── custom_boxstyle01.py
|   |   |   ├── demo_gridspec01.py
|   |   |   ├── demo_gridspec03.py
|   |   |   ├── demo_gridspec06.py
|   |   |   ├── pgf_fonts.py
|   |   |   ├── pgf_preamble_sgskip.py
|   |   |   ├── pgf_texsystem.py
|   |   |   ├── simple_annotate01.py
|   |   |   ├── simple_legend01.py
|   |   |   └── simple_legend02.py
|   |   └── widgets
|   |       ├── README.txt
|   |       ├── annotated_cursor.py
|   |       ├── buttons.py
|   |       ├── check_buttons.py
|   |       ├── cursor.py
|   |       ├── lasso_selector_demo_sgskip.py
|   |       ├── menu.py
|   |       ├── mouse_cursor.py
|   |       ├── multicursor.py
|   |       ├── polygon_selector_demo.py
|   |       ├── polygon_selector_simple.py
|   |       ├── radio_buttons.py
|   |       ├── range_slider.py
|   |       ├── rectangle_selector.py
|   |       ├── slider_demo.py
|   |       ├── slider_snap_demo.py
|   |       ├── span_selector.py
|   |       └── textbox.py
|   ├── plot_types
|   |   ├── 3D
|   |   |   ├── README.rst
|   |   |   ├── scatter3d_simple.py
|   |   |   ├── surface3d_simple.py
|   |   |   ├── trisurf3d_simple.py
|   |   |   ├── voxels_simple.py
|   |   |   └── wire3d_simple.py
|   |   ├── README.rst
|   |   ├── arrays
|   |   |   ├── README.rst
|   |   |   ├── barbs.py
|   |   |   ├── contour.py
|   |   |   ├── contourf.py
|   |   |   ├── imshow.py
|   |   |   ├── pcolormesh.py
|   |   |   ├── quiver.py
|   |   |   └── streamplot.py
|   |   ├── basic
|   |   |   ├── README.rst
|   |   |   ├── bar.py
|   |   |   ├── fill_between.py
|   |   |   ├── plot.py
|   |   |   ├── scatter_plot.py
|   |   |   ├── stackplot.py
|   |   |   ├── stem.py
|   |   |   └── step.py
|   |   ├── stats
|   |   |   ├── README.rst
|   |   |   ├── boxplot_plot.py
|   |   |   ├── errorbar_plot.py
|   |   |   ├── eventplot.py
|   |   |   ├── hexbin.py
|   |   |   ├── hist2d.py
|   |   |   ├── hist_plot.py
|   |   |   ├── pie.py
|   |   |   └── violin.py
|   |   └── unstructured
|   |       ├── README.rst
|   |       ├── tricontour.py
|   |       ├── tricontourf.py
|   |       ├── tripcolor.py
|   |       └── triplot.py
|   └── tutorials
|       ├── README.txt
|       ├── advanced
|       |   ├── README.txt
|       |   ├── blitting.py
|       |   ├── path_tutorial.py
|       |   ├── patheffects_guide.py
|       |   └── transforms_tutorial.py
|       ├── colors
|       |   ├── README.txt
|       |   ├── colorbar_only.py
|       |   ├── colormap-manipulation.py
|       |   ├── colormapnorms.py
|       |   ├── colormaps.py
|       |   └── colors.py
|       ├── intermediate
|       |   ├── README.txt
|       |   ├── arranging_axes.py
|       |   ├── artists.py
|       |   ├── autoscale.py
|       |   ├── color_cycle.py
|       |   ├── constrainedlayout_guide.py
|       |   ├── imshow_extent.py
|       |   ├── legend_guide.py
|       |   └── tight_layout_guide.py
|       ├── introductory
|       |   ├── README.txt
|       |   ├── animation_tutorial.py
|       |   ├── customizing.py
|       |   ├── images.py
|       |   ├── lifecycle.py
|       |   ├── pyplot.py
|       |   └── quick_start.py
|       ├── provisional
|       |   └── README.txt
|       ├── text
|       |   ├── README.txt
|       |   ├── annotations.py
|       |   ├── mathtext.py
|       |   ├── pgf.py
|       |   ├── text_intro.py
|       |   ├── text_props.py
|       |   └── usetex.py
|       └── toolkits
|           ├── README.txt
|           ├── axes_grid.py
|           ├── axisartist.py
|           └── mplot3d.py
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
└── tools
    ├── README.txt
    ├── boilerplate.py
    ├── cache_zenodo_svg.py
    ├── create_DejaVuDisplay.sh
    ├── embed_js.py
    ├── gh_api.py
    ├── github_stats.py
    ├── make_icons.py
    ├── memleak.py
    ├── run_examples.py
    ├── subset.py
    ├── triage_tests.py
    └── visualize_tests.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Unable to pickle figure with draggable legend

Description: ### Bug summary

I am unable to pickle figure with draggable legend. Same error comes for draggable annotations.





### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax = fig.add_subplot(111)

time=[0,1,2,3,4]
speed=[40,43,45,47,48]

ax.plot(time,speed,label="speed")

leg=ax.legend()
leg.set_draggable(True) #pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome

`TypeError: cannot pickle 'FigureCanvasQTAgg' object`

### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows 10

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

3.10

### Jupyter version

_No response_

### Installation

pip

Patch information:
diff --git a/lib/matplotlib/legend.py b/lib/matplotlib/legend.py
index ff6abdb958..b3bb2e7c91 100644
--- a/lib/matplotlib/legend.py
+++ b/lib/matplotlib/legend.py
@@ -1208,6 +1208,12 @@ class Legend(Artist):
         """Return ``True`` if the legend is draggable, ``False`` otherwise."""
         return self._draggable is not None
 
+    def __getstate__(self):
+        d = super().__getstate__()
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas.
+        d['_draggable'] = None
+        return d
+
 
 # Helper functions to parse legend arguments for both `figure.legend` and
 # `axes.legend`:
diff --git a/lib/matplotlib/text.py b/lib/matplotlib/text.py
index 0f874ba33d..ee28309f8b 100644
--- a/lib/matplotlib/text.py
+++ b/lib/matplotlib/text.py
@@ -236,6 +236,10 @@ class Text(Artist):
         d = super().__getstate__()
         # remove the cached _renderer (if it exists)
         d['_renderer'] = None
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas via
+        # DraggableAnnotation.
+        if '_draggable' in d:
+            d['_draggable'] = None
         return d
 
     def contains(self, mouseevent):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 04:36:55,750 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user wants to find test cases related to a pickling bug. The most relevant file for this task is likely `lib/matplotlib/tests/test_pickle.py`, as its name suggests it contains tests for pickling matplotlib objects. I need the content of this file to identify suitable test cases that demonstrate pickling of figures or artists, which is central to the user's bug report." query='Please provide the full content of the file `lib/matplotlib/tests/test_pickle.py`.' extra_requirements='' purpose="I need to examine the existing tests for pickling matplotlib objects to find 3 relevant examples for the user's bug report."
2025-12-21 04:36:55,751 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_pickle.py`.
2025-12-21 04:36:55,751 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 04:36:55,752 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 04:36:55,753 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 04:36:55,753 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `lib/matplotlib/tests/test_pickle.py`.
Purpose: I need to examine the existing tests for pickling matplotlib objects to find 3 relevant examples for the user's bug report.
2025-12-21 04:36:57,669 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the full content of the file `lib/matplotlib/tests/test_pickle.py` so that you can examine the existing tests for pickling matplotlib objects. This will help you find relevant examples for the user's bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_pickle.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2139, 'candidates_token_count': 76, 'total_token_count': 2277, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2139}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 76}], 'thoughts_token_count': 62, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.05059759240401419, 'model_name': 'gemini-2.5-pro'} id='run--f7f8d53d-84f8-4435-9f85-902bd725091b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_pickle.py'}, 'id': '1923eae4-5fd5-47e9-b44b-debfef1a7324', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2139, 'output_tokens': 76, 'total_tokens': 2277, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 62}}
2025-12-21 04:37:02,985 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `lib/matplotlib/tests/test_pickle.py` as you requested. You can now examine the various tests for pickling matplotlib objects to identify the three most relevant examples for your bug report. Let me know if you need me to perform a more targeted search within this file.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 6191, 'candidates_token_count': 65, 'total_token_count': 6657, 'cached_content_token_count': 1778, 'prompt_tokens_details': [{'modality': 1, 'token_count': 6191}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1778}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 65}], 'thoughts_token_count': 401}, 'finish_reason': 'STOP', 'avg_logprobs': -0.956060791015625, 'model_name': 'gemini-2.5-pro'} id='run--d3e278a8-da21-47df-9422-0f6ac757fa74-0' usage_metadata={'input_tokens': 6191, 'output_tokens': 65, 'total_tokens': 6657, 'input_token_details': {'cache_read': 1778}, 'output_token_details': {'reasoning': 401}}
2025-12-21 04:37:02,987 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `lib/matplotlib/tests/test_pickle.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to examine the existing tests for pickling matplotlib objects to find 3 relevant examples for the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_pickle.py
Line number range: 1 - 284
Content:
1. from io import BytesIO
2. import ast
3. import pickle
4. 
5. import numpy as np
6. import pytest
7. 
8. import matplotlib as mpl
9. from matplotlib import cm
10. from matplotlib.testing import subprocess_run_helper
11. from matplotlib.testing.decorators import check_figures_equal
12. from matplotlib.dates import rrulewrapper
13. from matplotlib.lines import VertexSelector
14. import matplotlib.pyplot as plt
15. import matplotlib.transforms as mtransforms
16. import matplotlib.figure as mfigure
17. from mpl_toolkits.axes_grid1 import parasite_axes
18. 
19. 
20. def test_simple():
21.     fig = plt.figure()
22.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
23. 
24.     ax = plt.subplot(121)
25.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
26. 
27.     ax = plt.axes(projection='polar')
28.     plt.plot(np.arange(10), label='foobar')
29.     plt.legend()
30. 
31.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
32. 
33. #    ax = plt.subplot(121, projection='hammer')
34. #    pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
35. 
36.     plt.figure()
37.     plt.bar(x=np.arange(10), height=np.arange(10))
38.     pickle.dump(plt.gca(), BytesIO(), pickle.HIGHEST_PROTOCOL)
39. 
40.     fig = plt.figure()
41.     ax = plt.axes()
42.     plt.plot(np.arange(10))
43.     ax.set_yscale('log')
44.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
45. 
46. 
47. def _generate_complete_test_figure(fig_ref):
48.     fig_ref.set_size_inches((10, 6))
49.     plt.figure(fig_ref)
50. 
51.     plt.suptitle('Can you fit any more in a figure?')
52. 
53.     # make some arbitrary data
54.     x, y = np.arange(8), np.arange(10)
55.     data = u = v = np.linspace(0, 10, 80).reshape(10, 8)
56.     v = np.sin(v * -0.6)
57. 
58.     # Ensure lists also pickle correctly.
59.     plt.subplot(3, 3, 1)
60.     plt.plot(list(range(10)))
61. 
62.     plt.subplot(3, 3, 2)
63.     plt.contourf(data, hatches=['//', 'ooo'])
64.     plt.colorbar()
65. 
66.     plt.subplot(3, 3, 3)
67.     plt.pcolormesh(data)
68. 
69.     plt.subplot(3, 3, 4)
70.     plt.imshow(data)
71. 
72.     plt.subplot(3, 3, 5)
73.     plt.pcolor(data)
74. 
75.     ax = plt.subplot(3, 3, 6)
76.     ax.set_xlim(0, 7)
77.     ax.set_ylim(0, 9)
78.     plt.streamplot(x, y, u, v)
79. 
80.     ax = plt.subplot(3, 3, 7)
81.     ax.set_xlim(0, 7)
82.     ax.set_ylim(0, 9)
83.     plt.quiver(x, y, u, v)
84. 
85.     plt.subplot(3, 3, 8)
86.     plt.scatter(x, x ** 2, label='$x^2$')
87.     plt.legend(loc='upper left')
88. 
89.     plt.subplot(3, 3, 9)
90.     plt.errorbar(x, x * -0.5, xerr=0.2, yerr=0.4)
91. 
92. 
93. @mpl.style.context("default")
94. @check_figures_equal(extensions=["png"])
95. def test_complete(fig_test, fig_ref):
96.     _generate_complete_test_figure(fig_ref)
97.     # plotting is done, now test its pickle-ability
98.     pkl = BytesIO()
99.     pickle.dump(fig_ref, pkl, pickle.HIGHEST_PROTOCOL)
100.     loaded = pickle.loads(pkl.getbuffer())
101.     loaded.canvas.draw()
102. 
103.     fig_test.set_size_inches(loaded.get_size_inches())
104.     fig_test.figimage(loaded.canvas.renderer.buffer_rgba())
105. 
106.     plt.close(loaded)
107. 
108. 
109. def _pickle_load_subprocess():
110.     import os
111.     import pickle
112. 
113.     path = os.environ['PICKLE_FILE_PATH']
114. 
115.     with open(path, 'rb') as blob:
116.         fig = pickle.load(blob)
117. 
118.     print(str(pickle.dumps(fig)))
119. 
120. 
121. @mpl.style.context("default")
122. @check_figures_equal(extensions=['png'])
123. def test_pickle_load_from_subprocess(fig_test, fig_ref, tmp_path):
124.     _generate_complete_test_figure(fig_ref)
125. 
126.     fp = tmp_path / 'sinus.pickle'
127.     assert not fp.exists()
128. 
129.     with fp.open('wb') as file:
130.         pickle.dump(fig_ref, file, pickle.HIGHEST_PROTOCOL)
131.     assert fp.exists()
132. 
133.     proc = subprocess_run_helper(
134.         _pickle_load_subprocess,
135.         timeout=60,
136.         extra_env={'PICKLE_FILE_PATH': str(fp)}
137.     )
138. 
139.     loaded_fig = pickle.loads(ast.literal_eval(proc.stdout))
140. 
141.     loaded_fig.canvas.draw()
142. 
143.     fig_test.set_size_inches(loaded_fig.get_size_inches())
144.     fig_test.figimage(loaded_fig.canvas.renderer.buffer_rgba())
145. 
146.     plt.close(loaded_fig)
147. 
148. 
149. def test_gcf():
150.     fig = plt.figure("a label")
151.     buf = BytesIO()
152.     pickle.dump(fig, buf, pickle.HIGHEST_PROTOCOL)
153.     plt.close("all")
154.     assert plt._pylab_helpers.Gcf.figs == {}  # No figures must be left.
155.     fig = pickle.loads(buf.getbuffer())
156.     assert plt._pylab_helpers.Gcf.figs != {}  # A manager is there again.
157.     assert fig.get_label() == "a label"
158. 
159. 
160. def test_no_pyplot():
161.     # tests pickle-ability of a figure not created with pyplot
162.     from matplotlib.backends.backend_pdf import FigureCanvasPdf
163.     fig = mfigure.Figure()
164.     _ = FigureCanvasPdf(fig)
165.     ax = fig.add_subplot(1, 1, 1)
166.     ax.plot([1, 2, 3], [1, 2, 3])
167.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
168. 
169. 
170. def test_renderer():
171.     from matplotlib.backends.backend_agg import RendererAgg
172.     renderer = RendererAgg(10, 20, 30)
173.     pickle.dump(renderer, BytesIO())
174. 
175. 
176. def test_image():
177.     # Prior to v1.4.0 the Image would cache data which was not picklable
178.     # once it had been drawn.
179.     from matplotlib.backends.backend_agg import new_figure_manager
180.     manager = new_figure_manager(1000)
181.     fig = manager.canvas.figure
182.     ax = fig.add_subplot(1, 1, 1)
183.     ax.imshow(np.arange(12).reshape(3, 4))
184.     manager.canvas.draw()
185.     pickle.dump(fig, BytesIO())
186. 
187. 
188. def test_polar():
189.     plt.subplot(polar=True)
190.     fig = plt.gcf()
191.     pf = pickle.dumps(fig)
192.     pickle.loads(pf)
193.     plt.draw()
194. 
195. 
196. class TransformBlob:
197.     def __init__(self):
198.         self.identity = mtransforms.IdentityTransform()
199.         self.identity2 = mtransforms.IdentityTransform()
200.         # Force use of the more complex composition.
201.         self.composite = mtransforms.CompositeGenericTransform(
202.             self.identity,
203.             self.identity2)
204.         # Check parent -> child links of TransformWrapper.
205.         self.wrapper = mtransforms.TransformWrapper(self.composite)
206.         # Check child -> parent links of TransformWrapper.
207.         self.composite2 = mtransforms.CompositeGenericTransform(
208.             self.wrapper,
209.             self.identity)
210. 
211. 
212. def test_transform():
213.     obj = TransformBlob()
214.     pf = pickle.dumps(obj)
215.     del obj
216. 
217.     obj = pickle.loads(pf)
218.     # Check parent -> child links of TransformWrapper.
219.     assert obj.wrapper._child == obj.composite
220.     # Check child -> parent links of TransformWrapper.
221.     assert [v() for v in obj.wrapper._parents.values()] == [obj.composite2]
222.     # Check input and output dimensions are set as expected.
223.     assert obj.wrapper.input_dims == obj.composite.input_dims
224.     assert obj.wrapper.output_dims == obj.composite.output_dims
225. 
226. 
227. def test_rrulewrapper():
228.     r = rrulewrapper(2)
229.     try:
230.         pickle.loads(pickle.dumps(r))
231.     except RecursionError:
232.         print('rrulewrapper pickling test failed')
233.         raise
234. 
235. 
236. def test_shared():
237.     fig, axs = plt.subplots(2, sharex=True)
238.     fig = pickle.loads(pickle.dumps(fig))
239.     fig.axes[0].set_xlim(10, 20)
240.     assert fig.axes[1].get_xlim() == (10, 20)
241. 
242. 
243. def test_inset_and_secondary():
244.     fig, ax = plt.subplots()
245.     ax.inset_axes([.1, .1, .3, .3])
246.     ax.secondary_xaxis("top", functions=(np.square, np.sqrt))
247.     pickle.loads(pickle.dumps(fig))
248. 
249. 
250. @pytest.mark.parametrize("cmap", cm._colormaps.values())
251. def test_cmap(cmap):
252.     pickle.dumps(cmap)
253. 
254. 
255. def test_unpickle_canvas():
256.     fig = mfigure.Figure()
257.     assert fig.canvas is not None
258.     out = BytesIO()
259.     pickle.dump(fig, out)
260.     out.seek(0)
261.     fig2 = pickle.load(out)
262.     assert fig2.canvas is not None
263. 
264. 
265. def test_mpl_toolkits():
266.     ax = parasite_axes.host_axes([0, 0, 1, 1])
267.     assert type(pickle.loads(pickle.dumps(ax))) == parasite_axes.HostAxes
268. 
269. 
270. def test_standard_norm():
271.     assert type(pickle.loads(pickle.dumps(mpl.colors.LogNorm()))) \
272.         == mpl.colors.LogNorm
273. 
274. 
275. def test_dynamic_norm():
276.     logit_norm_instance = mpl.colors.make_norm_from_scale(
277.         mpl.scale.LogitScale, mpl.colors.Normalize)()
278.     assert type(pickle.loads(pickle.dumps(logit_norm_instance))) \
279.         == type(logit_norm_instance)
280. 
281. 
282. def test_vertexselector():
283.     line, = plt.plot([0, 1], picker=True)
284.     pickle.loads(pickle.dumps(VertexSelector(line)))

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 04:37:07,091 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly requested the full content of the file `lib/matplotlib/tests/test_pickle.py`.\n\n2. Extended relevance:\n   - To fulfill the user's request, the entire file content is necessary. No part of it can be omitted.", relative_path='lib/matplotlib/tests/test_pickle.py', start_line=1, end_line=284)]
2025-12-21 04:37:07,092 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_pickle.py`.
2025-12-21 04:37:07,092 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 04:37:07,092 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 04:37:07,092 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 04:37:07,093 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 04:37:07,093 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   ├── 25112-GG.rst
|   |   |   |   ├── 25192-DS.rst
|   |   |   |   └── 25255-RR.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   ├── 24990-OG.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   └── 25282-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 24923-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.6.0.rst
|   |   |   ├── api_changes_3.6.1.rst
|   |   |   ├── api_changes_3.7.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.7.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── README.rst
|       |   ├── pie_hatch.rst
|       |   ├── savefig_bbox_layout.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── github_stats_3.6.0.rst
|       |   ├── github_stats_3.6.1.rst
|       |   ├── github_stats_3.6.2.rst
|       |   ├── github_stats_3.6.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   ├── whats_new_3.6.0.rst
|       |   └── whats_new_3.7.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── galleries
|   ├── examples
|   |   ├── README.txt
|   |   ├── animation
|   |   |   ├── README.txt
|   |   |   ├── animate_decay.py
|   |   |   ├── animated_histogram.py
|   |   |   ├── animation_demo.py
|   |   |   ├── bayes_update.py
|   |   |   ├── double_pendulum.py
|   |   |   ├── dynamic_image.py
|   |   |   ├── frame_grabbing_sgskip.py
|   |   |   ├── multiple_axes.py
|   |   |   ├── pause_resume.py
|   |   |   ├── rain.py
|   |   |   ├── random_walk.py
|   |   |   ├── simple_anim.py
|   |   |   ├── simple_scatter.py
|   |   |   ├── strip_chart.py
|   |   |   └── unchained.py
|   |   ├── axes_grid1
|   |   |   ├── README.txt
|   |   |   ├── demo_anchored_direction_arrows.py
|   |   |   ├── demo_axes_divider.py
|   |   |   ├── demo_axes_grid.py
|   |   |   ├── demo_axes_grid2.py
|   |   |   ├── demo_axes_hbox_divider.py
|   |   |   ├── demo_axes_rgb.py
|   |   |   ├── demo_colorbar_of_inset_axes.py
|   |   |   ├── demo_colorbar_with_axes_divider.py
|   |   |   ├── demo_colorbar_with_inset_locator.py
|   |   |   ├── demo_edge_colorbar.py
|   |   |   ├── demo_fixed_size_axes.py
|   |   |   ├── demo_imagegrid_aspect.py
|   |   |   ├── inset_locator_demo.py
|   |   |   ├── inset_locator_demo2.py
|   |   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   |   ├── parasite_simple.py
|   |   |   ├── parasite_simple2.py
|   |   |   ├── scatter_hist_locatable_axes.py
|   |   |   ├── simple_anchored_artists.py
|   |   |   ├── simple_axes_divider1.py
|   |   |   ├── simple_axes_divider3.py
|   |   |   ├── simple_axesgrid.py
|   |   |   ├── simple_axesgrid2.py
|   |   |   ├── simple_axisline4.py
|   |   |   └── simple_colorbar.py
|   |   ├── axisartist
|   |   |   ├── README.txt
|   |   |   ├── axis_direction.py
|   |   |   ├── demo_axis_direction.py
|   |   |   ├── demo_axisline_style.py
|   |   |   ├── demo_curvelinear_grid.py
|   |   |   ├── demo_curvelinear_grid2.py
|   |   |   ├── demo_floating_axes.py
|   |   |   ├── demo_floating_axis.py
|   |   |   ├── demo_parasite_axes.py
|   |   |   ├── demo_parasite_axes2.py
|   |   |   ├── demo_ticklabel_alignment.py
|   |   |   ├── demo_ticklabel_direction.py
|   |   |   ├── simple_axis_direction01.py
|   |   |   ├── simple_axis_direction03.py
|   |   |   ├── simple_axis_pad.py
|   |   |   ├── simple_axisartist1.py
|   |   |   ├── simple_axisline.py
|   |   |   └── simple_axisline3.py
|   |   ├── color
|   |   |   ├── README.txt
|   |   |   ├── color_by_yvalue.py
|   |   |   ├── color_cycle_default.py
|   |   |   ├── color_demo.py
|   |   |   ├── colorbar_basics.py
|   |   |   ├── colormap_reference.py
|   |   |   ├── custom_cmap.py
|   |   |   └── named_colors.py
|   |   ├── event_handling
|   |   |   ├── README.txt
|   |   |   ├── close_event.py
|   |   |   ├── coords_demo.py
|   |   |   ├── cursor_demo.py
|   |   |   ├── data_browser.py
|   |   |   ├── figure_axes_enter_leave.py
|   |   |   ├── ginput_manual_clabel_sgskip.py
|   |   |   ├── image_slices_viewer.py
|   |   |   ├── keypress_demo.py
|   |   |   ├── lasso_demo.py
|   |   |   ├── legend_picking.py
|   |   |   ├── looking_glass.py
|   |   |   ├── path_editor.py
|   |   |   ├── pick_event_demo.py
|   |   |   ├── pick_event_demo2.py
|   |   |   ├── poly_editor.py
|   |   |   ├── pong_sgskip.py
|   |   |   ├── resample.py
|   |   |   ├── timers.py
|   |   |   ├── trifinder_event_demo.py
|   |   |   ├── viewlims.py
|   |   |   └── zoom_window.py
|   |   ├── images_contours_and_fields
|   |   |   ├── README.txt
|   |   |   ├── affine_image.py
|   |   |   ├── barb_demo.py
|   |   |   ├── barcode_demo.py
|   |   |   ├── colormap_interactive_adjustment.py
|   |   |   ├── colormap_normalizations.py
|   |   |   ├── colormap_normalizations_symlognorm.py
|   |   |   ├── contour_corner_mask.py
|   |   |   ├── contour_demo.py
|   |   |   ├── contour_image.py
|   |   |   ├── contour_label_demo.py
|   |   |   ├── contourf_demo.py
|   |   |   ├── contourf_hatching.py
|   |   |   ├── contourf_log.py
|   |   |   ├── contours_in_optimization_demo.py
|   |   |   ├── demo_bboximage.py
|   |   |   ├── figimage_demo.py
|   |   |   ├── image_annotated_heatmap.py
|   |   |   ├── image_antialiasing.py
|   |   |   ├── image_clip_path.py
|   |   |   ├── image_demo.py
|   |   |   ├── image_masked.py
|   |   |   ├── image_nonuniform.py
|   |   |   ├── image_transparency_blend.py
|   |   |   ├── image_zcoord.py
|   |   |   ├── interpolation_methods.py
|   |   |   ├── irregulardatagrid.py
|   |   |   ├── layer_images.py
|   |   |   ├── matshow.py
|   |   |   ├── multi_image.py
|   |   |   ├── pcolor_demo.py
|   |   |   ├── pcolormesh_grids.py
|   |   |   ├── pcolormesh_levels.py
|   |   |   ├── plot_streamplot.py
|   |   |   ├── quadmesh_demo.py
|   |   |   ├── quiver_demo.py
|   |   |   ├── quiver_simple_demo.py
|   |   |   ├── shading_example.py
|   |   |   ├── specgram_demo.py
|   |   |   ├── spy_demos.py
|   |   |   ├── tricontour_demo.py
|   |   |   ├── tricontour_smooth_delaunay.py
|   |   |   ├── tricontour_smooth_user.py
|   |   |   ├── trigradient_demo.py
|   |   |   ├── triinterp_demo.py
|   |   |   ├── tripcolor_demo.py
|   |   |   ├── triplot_demo.py
|   |   |   └── watermark_image.py
|   |   ├── lines_bars_and_markers
|   |   |   ├── README.txt
|   |   |   ├── bar_colors.py
|   |   |   ├── bar_label_demo.py
|   |   |   ├── bar_stacked.py
|   |   |   ├── barchart.py
|   |   |   ├── barh.py
|   |   |   ├── broken_barh.py
|   |   |   ├── capstyle.py
|   |   |   ├── categorical_variables.py
|   |   |   ├── cohere.py
|   |   |   ├── csd_demo.py
|   |   |   ├── curve_error_band.py
|   |   |   ├── errorbar_limits_simple.py
|   |   |   ├── errorbar_subsample.py
|   |   |   ├── eventcollection_demo.py
|   |   |   ├── eventplot_demo.py
|   |   |   ├── fill.py
|   |   |   ├── fill_between_alpha.py
|   |   |   ├── fill_between_demo.py
|   |   |   ├── fill_betweenx_demo.py
|   |   |   ├── filled_step.py
|   |   |   ├── gradient_bar.py
|   |   |   ├── hat_graph.py
|   |   |   ├── horizontal_barchart_distribution.py
|   |   |   ├── joinstyle.py
|   |   |   ├── line_demo_dash_control.py
|   |   |   ├── lines_with_ticks_demo.py
|   |   |   ├── linestyles.py
|   |   |   ├── marker_reference.py
|   |   |   ├── markevery_demo.py
|   |   |   ├── masked_demo.py
|   |   |   ├── multicolored_line.py
|   |   |   ├── multivariate_marker_plot.py
|   |   |   ├── psd_demo.py
|   |   |   ├── scatter_custom_symbol.py
|   |   |   ├── scatter_demo2.py
|   |   |   ├── scatter_hist.py
|   |   |   ├── scatter_masked.py
|   |   |   ├── scatter_star_poly.py
|   |   |   ├── scatter_with_legend.py
|   |   |   ├── simple_plot.py
|   |   |   ├── span_regions.py
|   |   |   ├── spectrum_demo.py
|   |   |   ├── stackplot_demo.py
|   |   |   ├── stairs_demo.py
|   |   |   ├── stem_plot.py
|   |   |   ├── step_demo.py
|   |   |   ├── timeline.py
|   |   |   ├── vline_hline_demo.py
|   |   |   └── xcorr_acorr_demo.py
|   |   ├── misc
|   |   |   ├── README.txt
|   |   |   ├── anchored_artists.py
|   |   |   ├── bbox_intersect.py
|   |   |   ├── contour_manual.py
|   |   |   ├── coords_report.py
|   |   |   ├── custom_projection.py
|   |   |   ├── customize_rc.py
|   |   |   ├── demo_agg_filter.py
|   |   |   ├── demo_ribbon_box.py
|   |   |   ├── fig_x.py
|   |   |   ├── fill_spiral.py
|   |   |   ├── findobj_demo.py
|   |   |   ├── font_indexing.py
|   |   |   ├── ftface_props.py
|   |   |   ├── histogram_path.py
|   |   |   ├── hyperlinks_sgskip.py
|   |   |   ├── image_thumbnail_sgskip.py
|   |   |   ├── keyword_plotting.py
|   |   |   ├── logos2.py
|   |   |   ├── multipage_pdf.py
|   |   |   ├── multiprocess_sgskip.py
|   |   |   ├── packed_bubbles.py
|   |   |   ├── patheffect_demo.py
|   |   |   ├── print_stdout_sgskip.py
|   |   |   ├── rasterization_demo.py
|   |   |   ├── set_and_get.py
|   |   |   ├── svg_filter_line.py
|   |   |   ├── svg_filter_pie.py
|   |   |   ├── table_demo.py
|   |   |   ├── tickedstroke_demo.py
|   |   |   ├── transoffset.py
|   |   |   └── zorder_demo.py
|   |   ├── mplot3d
|   |   |   ├── 2dcollections3d.py
|   |   |   ├── 3d_bars.py
|   |   |   ├── README.txt
|   |   |   ├── bars3d.py
|   |   |   ├── box3d.py
|   |   |   ├── contour3d.py
|   |   |   ├── contour3d_2.py
|   |   |   ├── contour3d_3.py
|   |   |   ├── contourf3d.py
|   |   |   ├── contourf3d_2.py
|   |   |   ├── custom_shaded_3d_surface.py
|   |   |   ├── errorbar3d.py
|   |   |   ├── hist3d.py
|   |   |   ├── lines3d.py
|   |   |   ├── lorenz_attractor.py
|   |   |   ├── mixed_subplots.py
|   |   |   ├── offset.py
|   |   |   ├── pathpatch3d.py
|   |   |   ├── polys3d.py
|   |   |   ├── projections.py
|   |   |   ├── quiver3d.py
|   |   |   ├── rotate_axes3d_sgskip.py
|   |   |   ├── scatter3d.py
|   |   |   ├── stem3d_demo.py
|   |   |   ├── subplot3d.py
|   |   |   ├── surface3d.py
|   |   |   ├── surface3d_2.py
|   |   |   ├── surface3d_3.py
|   |   |   ├── surface3d_radial.py
|   |   |   ├── text3d.py
|   |   |   ├── tricontour3d.py
|   |   |   ├── tricontourf3d.py
|   |   |   ├── trisurf3d.py
|   |   |   ├── trisurf3d_2.py
|   |   |   ├── view_planes_3d.py
|   |   |   ├── voxels.py
|   |   |   ├── voxels_numpy_logo.py
|   |   |   ├── voxels_rgb.py
|   |   |   ├── voxels_torus.py
|   |   |   ├── wire3d.py
|   |   |   ├── wire3d_animation_sgskip.py
|   |   |   └── wire3d_zero_stride.py
|   |   ├── pie_and_polar_charts
|   |   |   ├── README.txt
|   |   |   ├── bar_of_pie.py
|   |   |   ├── nested_pie.py
|   |   |   ├── pie_and_donut_labels.py
|   |   |   ├── pie_demo2.py
|   |   |   ├── pie_features.py
|   |   |   ├── polar_bar.py
|   |   |   ├── polar_demo.py
|   |   |   ├── polar_error_caps.py
|   |   |   ├── polar_legend.py
|   |   |   └── polar_scatter.py
|   |   ├── pyplots
|   |   |   ├── README.txt
|   |   |   ├── axline.py
|   |   |   ├── pyplot_simple.py
|   |   |   ├── pyplot_text.py
|   |   |   ├── pyplot_three.py
|   |   |   └── pyplot_two_subplots.py
|   |   ├── scales
|   |   |   ├── README.txt
|   |   |   ├── asinh_demo.py
|   |   |   ├── aspect_loglog.py
|   |   |   ├── custom_scale.py
|   |   |   ├── log_bar.py
|   |   |   ├── log_demo.py
|   |   |   ├── logit_demo.py
|   |   |   ├── power_norm.py
|   |   |   ├── scales.py
|   |   |   ├── semilogx_demo.py
|   |   |   └── symlog_demo.py
|   |   ├── shapes_and_collections
|   |   |   ├── README.txt
|   |   |   ├── arrow_guide.py
|   |   |   ├── artist_reference.py
|   |   |   ├── collections.py
|   |   |   ├── compound_path.py
|   |   |   ├── dolphin.py
|   |   |   ├── donut.py
|   |   |   ├── ellipse_collection.py
|   |   |   ├── ellipse_demo.py
|   |   |   ├── fancybox_demo.py
|   |   |   ├── hatch_demo.py
|   |   |   ├── hatch_style_reference.py
|   |   |   ├── line_collection.py
|   |   |   ├── patch_collection.py
|   |   |   ├── path_patch.py
|   |   |   ├── quad_bezier.py
|   |   |   └── scatter.py
|   |   ├── showcase
|   |   |   ├── README.txt
|   |   |   ├── anatomy.py
|   |   |   ├── firefox.py
|   |   |   ├── integral.py
|   |   |   ├── mandelbrot.py
|   |   |   ├── stock_prices.py
|   |   |   └── xkcd.py
|   |   ├── specialty_plots
|   |   |   ├── README.txt
|   |   |   ├── advanced_hillshading.py
|   |   |   ├── anscombe.py
|   |   |   ├── hinton_demo.py
|   |   |   ├── leftventricle_bullseye.py
|   |   |   ├── mri_demo.py
|   |   |   ├── mri_with_eeg.py
|   |   |   ├── radar_chart.py
|   |   |   ├── sankey_basics.py
|   |   |   ├── sankey_links.py
|   |   |   ├── sankey_rankine.py
|   |   |   ├── skewt.py
|   |   |   └── topographic_hillshading.py
|   |   ├── spines
|   |   |   ├── README.txt
|   |   |   ├── centered_spines_with_arrows.py
|   |   |   ├── multiple_yaxis_with_spines.py
|   |   |   ├── spine_placement_demo.py
|   |   |   ├── spines.py
|   |   |   └── spines_dropped.py
|   |   ├── statistics
|   |   |   ├── README.txt
|   |   |   ├── barchart_demo.py
|   |   |   ├── boxplot.py
|   |   |   ├── boxplot_color.py
|   |   |   ├── boxplot_demo.py
|   |   |   ├── boxplot_vs_violin.py
|   |   |   ├── bxp.py
|   |   |   ├── confidence_ellipse.py
|   |   |   ├── customized_violin.py
|   |   |   ├── errorbar.py
|   |   |   ├── errorbar_features.py
|   |   |   ├── errorbar_limits.py
|   |   |   ├── errorbars_and_boxes.py
|   |   |   ├── hexbin_demo.py
|   |   |   ├── hist.py
|   |   |   ├── histogram_cumulative.py
|   |   |   ├── histogram_features.py
|   |   |   ├── histogram_histtypes.py
|   |   |   ├── histogram_multihist.py
|   |   |   ├── multiple_histograms_side_by_side.py
|   |   |   ├── time_series_histogram.py
|   |   |   └── violinplot.py
|   |   ├── style_sheets
|   |   |   ├── README.txt
|   |   |   ├── bmh.py
|   |   |   ├── dark_background.py
|   |   |   ├── fivethirtyeight.py
|   |   |   ├── ggplot.py
|   |   |   ├── grayscale.py
|   |   |   ├── plot_solarizedlight2.py
|   |   |   └── style_sheets_reference.py
|   |   ├── subplots_axes_and_figures
|   |   |   ├── README.txt
|   |   |   ├── align_labels_demo.py
|   |   |   ├── auto_subplots_adjust.py
|   |   |   ├── axes_box_aspect.py
|   |   |   ├── axes_demo.py
|   |   |   ├── axes_margins.py
|   |   |   ├── axes_props.py
|   |   |   ├── axes_zoom_effect.py
|   |   |   ├── axhspan_demo.py
|   |   |   ├── axis_equal_demo.py
|   |   |   ├── axis_labels_demo.py
|   |   |   ├── broken_axis.py
|   |   |   ├── colorbar_placement.py
|   |   |   ├── custom_figure_class.py
|   |   |   ├── demo_constrained_layout.py
|   |   |   ├── demo_tight_layout.py
|   |   |   ├── fahrenheit_celsius_scales.py
|   |   |   ├── figure_size_units.py
|   |   |   ├── figure_title.py
|   |   |   ├── ganged_plots.py
|   |   |   ├── geo_demo.py
|   |   |   ├── gridspec_and_subplots.py
|   |   |   ├── gridspec_multicolumn.py
|   |   |   ├── gridspec_nested.py
|   |   |   ├── invert_axes.py
|   |   |   ├── mosaic.py
|   |   |   ├── multiple_figs_demo.py
|   |   |   ├── secondary_axis.py
|   |   |   ├── share_axis_lims_views.py
|   |   |   ├── shared_axis_demo.py
|   |   |   ├── subfigures.py
|   |   |   ├── subplot.py
|   |   |   ├── subplots_adjust.py
|   |   |   ├── subplots_demo.py
|   |   |   ├── two_scales.py
|   |   |   └── zoom_inset_axes.py
|   |   ├── text_labels_and_annotations
|   |   |   ├── README.txt
|   |   |   ├── accented_text.py
|   |   |   ├── align_ylabels.py
|   |   |   ├── angle_annotation.py
|   |   |   ├── angles_on_bracket_arrows.py
|   |   |   ├── annotate_transform.py
|   |   |   ├── annotation_basic.py
|   |   |   ├── annotation_demo.py
|   |   |   ├── annotation_polar.py
|   |   |   ├── arrow_demo.py
|   |   |   ├── autowrap.py
|   |   |   ├── custom_legends.py
|   |   |   ├── date.py
|   |   |   ├── demo_annotation_box.py
|   |   |   ├── demo_text_path.py
|   |   |   ├── demo_text_rotation_mode.py
|   |   |   ├── dfrac_demo.py
|   |   |   ├── engineering_formatter.py
|   |   |   ├── fancyarrow_demo.py
|   |   |   ├── fancytextbox_demo.py
|   |   |   ├── figlegend_demo.py
|   |   |   ├── font_family_rc.py
|   |   |   ├── font_file.py
|   |   |   ├── font_table.py
|   |   |   ├── fonts_demo.py
|   |   |   ├── fonts_demo_kw.py
|   |   |   ├── label_subplots.py
|   |   |   ├── legend.py
|   |   |   ├── legend_demo.py
|   |   |   ├── line_with_text.py
|   |   |   ├── mathtext_asarray.py
|   |   |   ├── mathtext_demo.py
|   |   |   ├── mathtext_examples.py
|   |   |   ├── mathtext_fontfamily_example.py
|   |   |   ├── multiline.py
|   |   |   ├── placing_text_boxes.py
|   |   |   ├── rainbow_text.py
|   |   |   ├── stix_fonts_demo.py
|   |   |   ├── tex_demo.py
|   |   |   ├── text_alignment.py
|   |   |   ├── text_commands.py
|   |   |   ├── text_fontdict.py
|   |   |   ├── text_rotation_relative_to_line.py
|   |   |   ├── titles_demo.py
|   |   |   ├── unicode_minus.py
|   |   |   ├── usetex_baseline_test.py
|   |   |   ├── usetex_fonteffects.py
|   |   |   └── watermark_text.py
|   |   ├── ticks
|   |   |   ├── README.txt
|   |   |   ├── auto_ticks.py
|   |   |   ├── centered_ticklabels.py
|   |   |   ├── colorbar_tick_labelling_demo.py
|   |   |   ├── custom_ticker1.py
|   |   |   ├── date_concise_formatter.py
|   |   |   ├── date_demo_convert.py
|   |   |   ├── date_demo_rrule.py
|   |   |   ├── date_formatters_locators.py
|   |   |   ├── date_index_formatter.py
|   |   |   ├── date_precision_and_epochs.py
|   |   |   ├── dollar_ticks.py
|   |   |   ├── fig_axes_customize_simple.py
|   |   |   ├── major_minor_demo.py
|   |   |   ├── scalarformatter.py
|   |   |   ├── tick-formatters.py
|   |   |   ├── tick-locators.py
|   |   |   ├── tick_label_right.py
|   |   |   ├── tick_labels_from_values.py
|   |   |   ├── tick_xlabel_top.py
|   |   |   ├── ticklabels_rotation.py
|   |   |   └── ticks_too_many.py
|   |   ├── units
|   |   |   ├── README.txt
|   |   |   ├── annotate_with_units.py
|   |   |   ├── artist_tests.py
|   |   |   ├── bar_demo2.py
|   |   |   ├── bar_unit_demo.py
|   |   |   ├── basic_units.py
|   |   |   ├── ellipse_with_units.py
|   |   |   ├── evans_test.py
|   |   |   ├── radian_demo.py
|   |   |   ├── units_sample.py
|   |   |   └── units_scatter.py
|   |   ├── user_interfaces
|   |   |   ├── README.txt
|   |   |   ├── canvasagg.py
|   |   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk3_sgskip.py
|   |   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk4_sgskip.py
|   |   |   ├── embedding_in_qt_sgskip.py
|   |   |   ├── embedding_in_tk_sgskip.py
|   |   |   ├── embedding_in_wx2_sgskip.py
|   |   |   ├── embedding_in_wx3_sgskip.py
|   |   |   ├── embedding_in_wx4_sgskip.py
|   |   |   ├── embedding_in_wx5_sgskip.py
|   |   |   ├── embedding_webagg_sgskip.py
|   |   |   ├── fourier_demo_wx_sgskip.py
|   |   |   ├── gtk3_spreadsheet_sgskip.py
|   |   |   ├── gtk4_spreadsheet_sgskip.py
|   |   |   ├── images
|   |   |   ├── mathtext_wx_sgskip.py
|   |   |   ├── mpl_with_glade3_sgskip.py
|   |   |   ├── mplcvd.py
|   |   |   ├── pylab_with_gtk3_sgskip.py
|   |   |   ├── pylab_with_gtk4_sgskip.py
|   |   |   ├── svg_histogram_sgskip.py
|   |   |   ├── svg_tooltip_sgskip.py
|   |   |   ├── toolmanager_sgskip.py
|   |   |   ├── web_application_server_sgskip.py
|   |   |   └── wxcursor_demo_sgskip.py
|   |   ├── userdemo
|   |   |   ├── README.txt
|   |   |   ├── annotate_explain.py
|   |   |   ├── annotate_simple_coord02.py
|   |   |   ├── annotate_text_arrow.py
|   |   |   ├── connect_simple01.py
|   |   |   ├── connectionstyle_demo.py
|   |   |   ├── custom_boxstyle01.py
|   |   |   ├── demo_gridspec01.py
|   |   |   ├── demo_gridspec03.py
|   |   |   ├── demo_gridspec06.py
|   |   |   ├── pgf_fonts.py
|   |   |   ├── pgf_preamble_sgskip.py
|   |   |   ├── pgf_texsystem.py
|   |   |   ├── simple_annotate01.py
|   |   |   ├── simple_legend01.py
|   |   |   └── simple_legend02.py
|   |   └── widgets
|   |       ├── README.txt
|   |       ├── annotated_cursor.py
|   |       ├── buttons.py
|   |       ├── check_buttons.py
|   |       ├── cursor.py
|   |       ├── lasso_selector_demo_sgskip.py
|   |       ├── menu.py
|   |       ├── mouse_cursor.py
|   |       ├── multicursor.py
|   |       ├── polygon_selector_demo.py
|   |       ├── polygon_selector_simple.py
|   |       ├── radio_buttons.py
|   |       ├── range_slider.py
|   |       ├── rectangle_selector.py
|   |       ├── slider_demo.py
|   |       ├── slider_snap_demo.py
|   |       ├── span_selector.py
|   |       └── textbox.py
|   ├── plot_types
|   |   ├── 3D
|   |   |   ├── README.rst
|   |   |   ├── scatter3d_simple.py
|   |   |   ├── surface3d_simple.py
|   |   |   ├── trisurf3d_simple.py
|   |   |   ├── voxels_simple.py
|   |   |   └── wire3d_simple.py
|   |   ├── README.rst
|   |   ├── arrays
|   |   |   ├── README.rst
|   |   |   ├── barbs.py
|   |   |   ├── contour.py
|   |   |   ├── contourf.py
|   |   |   ├── imshow.py
|   |   |   ├── pcolormesh.py
|   |   |   ├── quiver.py
|   |   |   └── streamplot.py
|   |   ├── basic
|   |   |   ├── README.rst
|   |   |   ├── bar.py
|   |   |   ├── fill_between.py
|   |   |   ├── plot.py
|   |   |   ├── scatter_plot.py
|   |   |   ├── stackplot.py
|   |   |   ├── stem.py
|   |   |   └── step.py
|   |   ├── stats
|   |   |   ├── README.rst
|   |   |   ├── boxplot_plot.py
|   |   |   ├── errorbar_plot.py
|   |   |   ├── eventplot.py
|   |   |   ├── hexbin.py
|   |   |   ├── hist2d.py
|   |   |   ├── hist_plot.py
|   |   |   ├── pie.py
|   |   |   └── violin.py
|   |   └── unstructured
|   |       ├── README.rst
|   |       ├── tricontour.py
|   |       ├── tricontourf.py
|   |       ├── tripcolor.py
|   |       └── triplot.py
|   └── tutorials
|       ├── README.txt
|       ├── advanced
|       |   ├── README.txt
|       |   ├── blitting.py
|       |   ├── path_tutorial.py
|       |   ├── patheffects_guide.py
|       |   └── transforms_tutorial.py
|       ├── colors
|       |   ├── README.txt
|       |   ├── colorbar_only.py
|       |   ├── colormap-manipulation.py
|       |   ├── colormapnorms.py
|       |   ├── colormaps.py
|       |   └── colors.py
|       ├── intermediate
|       |   ├── README.txt
|       |   ├── arranging_axes.py
|       |   ├── artists.py
|       |   ├── autoscale.py
|       |   ├── color_cycle.py
|       |   ├── constrainedlayout_guide.py
|       |   ├── imshow_extent.py
|       |   ├── legend_guide.py
|       |   └── tight_layout_guide.py
|       ├── introductory
|       |   ├── README.txt
|       |   ├── animation_tutorial.py
|       |   ├── customizing.py
|       |   ├── images.py
|       |   ├── lifecycle.py
|       |   ├── pyplot.py
|       |   └── quick_start.py
|       ├── provisional
|       |   └── README.txt
|       ├── text
|       |   ├── README.txt
|       |   ├── annotations.py
|       |   ├── mathtext.py
|       |   ├── pgf.py
|       |   ├── text_intro.py
|       |   ├── text_props.py
|       |   └── usetex.py
|       └── toolkits
|           ├── README.txt
|           ├── axes_grid.py
|           ├── axisartist.py
|           └── mplot3d.py
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
└── tools
    ├── README.txt
    ├── boilerplate.py
    ├── cache_zenodo_svg.py
    ├── create_DejaVuDisplay.sh
    ├── embed_js.py
    ├── gh_api.py
    ├── github_stats.py
    ├── make_icons.py
    ├── memleak.py
    ├── run_examples.py
    ├── subset.py
    ├── triage_tests.py
    └── visualize_tests.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Unable to pickle figure with draggable legend

Description: ### Bug summary

I am unable to pickle figure with draggable legend. Same error comes for draggable annotations.





### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax = fig.add_subplot(111)

time=[0,1,2,3,4]
speed=[40,43,45,47,48]

ax.plot(time,speed,label="speed")

leg=ax.legend()
leg.set_draggable(True) #pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome

`TypeError: cannot pickle 'FigureCanvasQTAgg' object`

### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows 10

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

3.10

### Jupyter version

_No response_

### Installation

pip

Patch information:
diff --git a/lib/matplotlib/legend.py b/lib/matplotlib/legend.py
index ff6abdb958..b3bb2e7c91 100644
--- a/lib/matplotlib/legend.py
+++ b/lib/matplotlib/legend.py
@@ -1208,6 +1208,12 @@ class Legend(Artist):
         """Return ``True`` if the legend is draggable, ``False`` otherwise."""
         return self._draggable is not None
 
+    def __getstate__(self):
+        d = super().__getstate__()
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas.
+        d['_draggable'] = None
+        return d
+
 
 # Helper functions to parse legend arguments for both `figure.legend` and
 # `axes.legend`:
diff --git a/lib/matplotlib/text.py b/lib/matplotlib/text.py
index 0f874ba33d..ee28309f8b 100644
--- a/lib/matplotlib/text.py
+++ b/lib/matplotlib/text.py
@@ -236,6 +236,10 @@ class Text(Artist):
         d = super().__getstate__()
         # remove the cached _renderer (if it exists)
         d['_renderer'] = None
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas via
+        # DraggableAnnotation.
+        if '_draggable' in d:
+            d['_draggable'] = None
         return d
 
     def contains(self, mouseevent):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `lib/matplotlib/tests/test_pickle.py`.
Extra Requirements: 
Purpose: I need to examine the existing tests for pickling matplotlib objects to find 3 relevant examples for the user's bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_pickle.py
Line number range: 1 - 284
Content:
1. from io import BytesIO
2. import ast
3. import pickle
4. 
5. import numpy as np
6. import pytest
7. 
8. import matplotlib as mpl
9. from matplotlib import cm
10. from matplotlib.testing import subprocess_run_helper
11. from matplotlib.testing.decorators import check_figures_equal
12. from matplotlib.dates import rrulewrapper
13. from matplotlib.lines import VertexSelector
14. import matplotlib.pyplot as plt
15. import matplotlib.transforms as mtransforms
16. import matplotlib.figure as mfigure
17. from mpl_toolkits.axes_grid1 import parasite_axes
18. 
19. 
20. def test_simple():
21.     fig = plt.figure()
22.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
23. 
24.     ax = plt.subplot(121)
25.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
26. 
27.     ax = plt.axes(projection='polar')
28.     plt.plot(np.arange(10), label='foobar')
29.     plt.legend()
30. 
31.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
32. 
33. #    ax = plt.subplot(121, projection='hammer')
34. #    pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
35. 
36.     plt.figure()
37.     plt.bar(x=np.arange(10), height=np.arange(10))
38.     pickle.dump(plt.gca(), BytesIO(), pickle.HIGHEST_PROTOCOL)
39. 
40.     fig = plt.figure()
41.     ax = plt.axes()
42.     plt.plot(np.arange(10))
43.     ax.set_yscale('log')
44.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
45. 
46. 
47. def _generate_complete_test_figure(fig_ref):
48.     fig_ref.set_size_inches((10, 6))
49.     plt.figure(fig_ref)
50. 
51.     plt.suptitle('Can you fit any more in a figure?')
52. 
53.     # make some arbitrary data
54.     x, y = np.arange(8), np.arange(10)
55.     data = u = v = np.linspace(0, 10, 80).reshape(10, 8)
56.     v = np.sin(v * -0.6)
57. 
58.     # Ensure lists also pickle correctly.
59.     plt.subplot(3, 3, 1)
60.     plt.plot(list(range(10)))
61. 
62.     plt.subplot(3, 3, 2)
63.     plt.contourf(data, hatches=['//', 'ooo'])
64.     plt.colorbar()
65. 
66.     plt.subplot(3, 3, 3)
67.     plt.pcolormesh(data)
68. 
69.     plt.subplot(3, 3, 4)
70.     plt.imshow(data)
71. 
72.     plt.subplot(3, 3, 5)
73.     plt.pcolor(data)
74. 
75.     ax = plt.subplot(3, 3, 6)
76.     ax.set_xlim(0, 7)
77.     ax.set_ylim(0, 9)
78.     plt.streamplot(x, y, u, v)
79. 
80.     ax = plt.subplot(3, 3, 7)
81.     ax.set_xlim(0, 7)
82.     ax.set_ylim(0, 9)
83.     plt.quiver(x, y, u, v)
84. 
85.     plt.subplot(3, 3, 8)
86.     plt.scatter(x, x ** 2, label='$x^2$')
87.     plt.legend(loc='upper left')
88. 
89.     plt.subplot(3, 3, 9)
90.     plt.errorbar(x, x * -0.5, xerr=0.2, yerr=0.4)
91. 
92. 
93. @mpl.style.context("default")
94. @check_figures_equal(extensions=["png"])
95. def test_complete(fig_test, fig_ref):
96.     _generate_complete_test_figure(fig_ref)
97.     # plotting is done, now test its pickle-ability
98.     pkl = BytesIO()
99.     pickle.dump(fig_ref, pkl, pickle.HIGHEST_PROTOCOL)
100.     loaded = pickle.loads(pkl.getbuffer())
101.     loaded.canvas.draw()
102. 
103.     fig_test.set_size_inches(loaded.get_size_inches())
104.     fig_test.figimage(loaded.canvas.renderer.buffer_rgba())
105. 
106.     plt.close(loaded)
107. 
108. 
109. def _pickle_load_subprocess():
110.     import os
111.     import pickle
112. 
113.     path = os.environ['PICKLE_FILE_PATH']
114. 
115.     with open(path, 'rb') as blob:
116.         fig = pickle.load(blob)
117. 
118.     print(str(pickle.dumps(fig)))
119. 
120. 
121. @mpl.style.context("default")
122. @check_figures_equal(extensions=['png'])
123. def test_pickle_load_from_subprocess(fig_test, fig_ref, tmp_path):
124.     _generate_complete_test_figure(fig_ref)
125. 
126.     fp = tmp_path / 'sinus.pickle'
127.     assert not fp.exists()
128. 
129.     with fp.open('wb') as file:
130.         pickle.dump(fig_ref, file, pickle.HIGHEST_PROTOCOL)
131.     assert fp.exists()
132. 
133.     proc = subprocess_run_helper(
134.         _pickle_load_subprocess,
135.         timeout=60,
136.         extra_env={'PICKLE_FILE_PATH': str(fp)}
137.     )
138. 
139.     loaded_fig = pickle.loads(ast.literal_eval(proc.stdout))
140. 
141.     loaded_fig.canvas.draw()
142. 
143.     fig_test.set_size_inches(loaded_fig.get_size_inches())
144.     fig_test.figimage(loaded_fig.canvas.renderer.buffer_rgba())
145. 
146.     plt.close(loaded_fig)
147. 
148. 
149. def test_gcf():
150.     fig = plt.figure("a label")
151.     buf = BytesIO()
152.     pickle.dump(fig, buf, pickle.HIGHEST_PROTOCOL)
153.     plt.close("all")
154.     assert plt._pylab_helpers.Gcf.figs == {}  # No figures must be left.
155.     fig = pickle.loads(buf.getbuffer())
156.     assert plt._pylab_helpers.Gcf.figs != {}  # A manager is there again.
157.     assert fig.get_label() == "a label"
158. 
159. 
160. def test_no_pyplot():
161.     # tests pickle-ability of a figure not created with pyplot
162.     from matplotlib.backends.backend_pdf import FigureCanvasPdf
163.     fig = mfigure.Figure()
164.     _ = FigureCanvasPdf(fig)
165.     ax = fig.add_subplot(1, 1, 1)
166.     ax.plot([1, 2, 3], [1, 2, 3])
167.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
168. 
169. 
170. def test_renderer():
171.     from matplotlib.backends.backend_agg import RendererAgg
172.     renderer = RendererAgg(10, 20, 30)
173.     pickle.dump(renderer, BytesIO())
174. 
175. 
176. def test_image():
177.     # Prior to v1.4.0 the Image would cache data which was not picklable
178.     # once it had been drawn.
179.     from matplotlib.backends.backend_agg import new_figure_manager
180.     manager = new_figure_manager(1000)
181.     fig = manager.canvas.figure
182.     ax = fig.add_subplot(1, 1, 1)
183.     ax.imshow(np.arange(12).reshape(3, 4))
184.     manager.canvas.draw()
185.     pickle.dump(fig, BytesIO())
186. 
187. 
188. def test_polar():
189.     plt.subplot(polar=True)
190.     fig = plt.gcf()
191.     pf = pickle.dumps(fig)
192.     pickle.loads(pf)
193.     plt.draw()
194. 
195. 
196. class TransformBlob:
197.     def __init__(self):
198.         self.identity = mtransforms.IdentityTransform()
199.         self.identity2 = mtransforms.IdentityTransform()
200.         # Force use of the more complex composition.
201.         self.composite = mtransforms.CompositeGenericTransform(
202.             self.identity,
203.             self.identity2)
204.         # Check parent -> child links of TransformWrapper.
205.         self.wrapper = mtransforms.TransformWrapper(self.composite)
206.         # Check child -> parent links of TransformWrapper.
207.         self.composite2 = mtransforms.CompositeGenericTransform(
208.             self.wrapper,
209.             self.identity)
210. 
211. 
212. def test_transform():
213.     obj = TransformBlob()
214.     pf = pickle.dumps(obj)
215.     del obj
216. 
217.     obj = pickle.loads(pf)
218.     # Check parent -> child links of TransformWrapper.
219.     assert obj.wrapper._child == obj.composite
220.     # Check child -> parent links of TransformWrapper.
221.     assert [v() for v in obj.wrapper._parents.values()] == [obj.composite2]
222.     # Check input and output dimensions are set as expected.
223.     assert obj.wrapper.input_dims == obj.composite.input_dims
224.     assert obj.wrapper.output_dims == obj.composite.output_dims
225. 
226. 
227. def test_rrulewrapper():
228.     r = rrulewrapper(2)
229.     try:
230.         pickle.loads(pickle.dumps(r))
231.     except RecursionError:
232.         print('rrulewrapper pickling test failed')
233.         raise
234. 
235. 
236. def test_shared():
237.     fig, axs = plt.subplots(2, sharex=True)
238.     fig = pickle.loads(pickle.dumps(fig))
239.     fig.axes[0].set_xlim(10, 20)
240.     assert fig.axes[1].get_xlim() == (10, 20)
241. 
242. 
243. def test_inset_and_secondary():
244.     fig, ax = plt.subplots()
245.     ax.inset_axes([.1, .1, .3, .3])
246.     ax.secondary_xaxis("top", functions=(np.square, np.sqrt))
247.     pickle.loads(pickle.dumps(fig))
248. 
249. 
250. @pytest.mark.parametrize("cmap", cm._colormaps.values())
251. def test_cmap(cmap):
252.     pickle.dumps(cmap)
253. 
254. 
255. def test_unpickle_canvas():
256.     fig = mfigure.Figure()
257.     assert fig.canvas is not None
258.     out = BytesIO()
259.     pickle.dump(fig, out)
260.     out.seek(0)
261.     fig2 = pickle.load(out)
262.     assert fig2.canvas is not None
263. 
264. 
265. def test_mpl_toolkits():
266.     ax = parasite_axes.host_axes([0, 0, 1, 1])
267.     assert type(pickle.loads(pickle.dumps(ax))) == parasite_axes.HostAxes
268. 
269. 
270. def test_standard_norm():
271.     assert type(pickle.loads(pickle.dumps(mpl.colors.LogNorm()))) \
272.         == mpl.colors.LogNorm
273. 
274. 
275. def test_dynamic_norm():
276.     logit_norm_instance = mpl.colors.make_norm_from_scale(
277.         mpl.scale.LogitScale, mpl.colors.Normalize)()
278.     assert type(pickle.loads(pickle.dumps(logit_norm_instance))) \
279.         == type(logit_norm_instance)
280. 
281. 
282. def test_vertexselector():
283.     line, = plt.plot([0, 1], picker=True)
284.     pickle.loads(pickle.dumps(VertexSelector(line)))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 04:37:38,123 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug is about pickling draggable legends and annotations. The patch modifies `legend.py` and `text.py`. While `test_pickle.py` provides general pickling tests, `test_text.py` is likely to contain more specific tests for pickling `Text` and `Annotation` objects, which is also mentioned in the bug report. This will help find a more diverse and relevant set of test cases." query='Please provide the full content of the file `lib/matplotlib/tests/test_text.py`.' extra_requirements='' purpose='To find test cases related to pickling `Text` or `Annotation` objects, which are directly related to the bug concerning draggable annotations.'
2025-12-21 04:37:38,124 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_text.py`.
2025-12-21 04:37:38,124 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 04:37:38,125 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 04:37:38,126 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 04:37:38,126 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `lib/matplotlib/tests/test_text.py`.
Purpose: To find test cases related to pickling `Text` or `Annotation` objects, which are directly related to the bug concerning draggable annotations.
2025-12-21 04:37:41,540 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of `lib/matplotlib/tests/test_text.py`. This file contains various test cases for the `Text` and `Annotation` objects in Matplotlib. I will now examine its contents to find tests related to pickling, which may reveal how these objects are serialized and deserialized. This will help in understanding and fixing the bug with draggable annotations.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2141, 'candidates_token_count': 104, 'total_token_count': 2456, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2141}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 104}], 'thoughts_token_count': 211, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11633613476386437, 'model_name': 'gemini-2.5-pro'} id='run--dc4fae80-6b1f-41d8-a511-f14e33a1d6b6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py'}, 'id': '10b8542b-159b-4d42-ba17-638ebf363e19', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2141, 'output_tokens': 104, 'total_tokens': 2456, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 211}}
2025-12-21 04:37:46,032 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the content of `lib/matplotlib/tests/test_text.py` and found a test case specifically for pickling a `Text` object. This test, named `test_pickle_text`, pickles and then unpickles a `Text` object, verifying that the text content remains the same after the process. This is a crucial piece of information for understanding how `Text` objects are serialized, which is directly related to the bug with draggable annotations.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py", "text": "pickle"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10357, 'candidates_token_count': 132, 'total_token_count': 10720, 'cached_content_token_count': 1853, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10357}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1853}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 132}], 'thoughts_token_count': 231}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1704752372972893, 'model_name': 'gemini-2.5-pro'} id='run--cce46e78-d959-4e26-848b-c059fdb0a787-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py', 'text': 'pickle'}, 'id': '0d0ae7c4-8414-4f6e-bacb-c02687a3befc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10357, 'output_tokens': 132, 'total_tokens': 10720, 'input_token_details': {'cache_read': 1853}, 'output_token_details': {'reasoning': 231}}
2025-12-21 04:37:49,619 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I was unable to find any test cases related to pickling by searching for the term "pickle" within the file\'s abstract syntax tree. To continue my investigation, I will now retrieve all function definitions from `lib/matplotlib/tests/test_text.py`. By examining the names of these functions, I can identify any that are likely related to pickling, which will help me understand how `Text` and `Annotation` objects are serialized.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_type_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py", "type": "function_definition"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10521, 'candidates_token_count': 129, 'total_token_count': 10826, 'cached_content_token_count': 9254, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10521}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9254}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 129}], 'thoughts_token_count': 176}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2661994815796845, 'model_name': 'gemini-2.5-pro'} id='run--d3e78dec-7603-4cbd-b875-7f89e074d125-0' tool_calls=[{'name': 'find_ast_node_with_type_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py', 'type': 'function_definition'}, 'id': '1c318123-94f5-4f25-94a6-11edb6f5174b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10521, 'output_tokens': 129, 'total_tokens': 10826, 'input_token_details': {'cache_read': 9254}, 'output_token_details': {'reasoning': 176}}
2025-12-21 04:37:55,069 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I previously attempted to locate pickling-related tests by searching the abstract syntax tree, which yielded no results. To broaden my search, I am now examining all function definitions within `lib/matplotlib/tests/test_text.py`. By reviewing the function names, I aim to identify any tests relevant to object serialization, which will help in understanding the pickling behavior of `Text` and `Annotation` objects.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_type_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py", "type": "function_definition"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11367, 'candidates_token_count': 121, 'total_token_count': 11801, 'cached_content_token_count': 9229, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11367}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9229}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 121}], 'thoughts_token_count': 313}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6895114488838133, 'model_name': 'gemini-2.5-pro'} id='run--941ee585-e2ef-495e-8c92-638608c64ee9-0' tool_calls=[{'name': 'find_ast_node_with_type_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py', 'type': 'function_definition'}, 'id': 'c9cd4e8b-168a-4252-a54b-b1d1940e8eda', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11367, 'output_tokens': 121, 'total_tokens': 11801, 'input_token_details': {'cache_read': 9229}, 'output_token_details': {'reasoning': 313}}
2025-12-21 04:37:58,404 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have already retrieved the file content and searched for functions, but I haven't found the pickling-related test case I was looking for. To locate the `test_pickle_text` function, I will now search for its definition within `lib/matplotlib/tests/test_text.py`. This will allow me to examine its implementation and understand how `Text` objects are pickled and unpickled." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py", "text": "test_pickle_text"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12205, 'candidates_token_count': 124, 'total_token_count': 12471, 'cached_content_token_count': 11047, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12205}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11047}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 124}], 'thoughts_token_count': 142}, 'finish_reason': 'STOP', 'avg_logprobs': -0.20903236635269656, 'model_name': 'gemini-2.5-pro'} id='run--4b0de469-2de7-4978-aa9b-a700a5293699-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py', 'text': 'test_pickle_text'}, 'id': '712a6611-8232-4f70-ab04-c924af0d2467', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12205, 'output_tokens': 124, 'total_tokens': 12471, 'input_token_details': {'cache_read': 11047}, 'output_token_details': {'reasoning': 142}}
2025-12-21 04:38:05,312 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have previously attempted to locate the `test_pickle_text` function by searching the file's abstract syntax tree, but these searches were unsuccessful. I also tried reading the beginning of the file, but the function was not present in the first 500 lines. To ensure I can find the test case, I will now read the next 500 lines of `lib/matplotlib/tests/test_text.py`, starting from line 501, which should contain the relevant test case." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py", "end_line": 1001.0, "start_line": 501.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12361, 'candidates_token_count': 137, 'total_token_count': 13048, 'cached_content_token_count': 11033, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12361}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11033}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 137}], 'thoughts_token_count': 550}, 'finish_reason': 'STOP', 'avg_logprobs': -0.500503372972029, 'model_name': 'gemini-2.5-pro'} id='run--78061805-142c-406a-a71d-20403267eebd-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py', 'end_line': 1001.0, 'start_line': 501.0}, 'id': '21a4c020-b8a8-4512-bb67-6ebf2e794369', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12361, 'output_tokens': 137, 'total_tokens': 13048, 'input_token_details': {'cache_read': 11033}, 'output_token_details': {'reasoning': 550}}
2025-12-21 04:38:08,380 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After failing to find the `test_pickle_text` function through various search methods, I am now reading the final section of `lib/matplotlib/tests/test_text.py`, starting from line 1002. This last attempt will ensure I have reviewed the entire file to locate the pickling-related test case. This will help me understand how `Text` and `Annotation` objects are serialized.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py", "end_line": 1502.0, "start_line": 1002.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18569, 'candidates_token_count': 117, 'total_token_count': 18786, 'cached_content_token_count': 11286, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18569}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11286}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 117}], 'thoughts_token_count': 100}, 'finish_reason': 'STOP', 'avg_logprobs': -0.23375105246519431, 'model_name': 'gemini-2.5-pro'} id='run--67aa0eb7-b23e-4ec2-ac81-07270352f1f8-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py', 'end_line': 1502.0, 'start_line': 1002.0}, 'id': 'a6fdc98d-9dca-4baf-b3a4-da35f197c326', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18569, 'output_tokens': 117, 'total_tokens': 18786, 'input_token_details': {'cache_read': 11286}, 'output_token_details': {'reasoning': 100}}
2025-12-21 04:38:15,317 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have been unable to locate the `test_pickle_text` function in `lib/matplotlib/tests/test_text.py` using various search methods, including reading the file in chunks. It appears the test case may not be in this file, or I may have missed it. To ensure I have the full context, I will now attempt to read the entire file content at once, which will help me find the relevant test case and understand how pickling is handled for `Text` and `Annotation` objects.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18776, 'candidates_token_count': 132, 'total_token_count': 19427, 'cached_content_token_count': 16898, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18776}], 'cache_tokens_details': [{'modality': 1, 'token_count': 16898}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 132}], 'thoughts_token_count': 519}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5739073319868608, 'model_name': 'gemini-2.5-pro'} id='run--aee44b1b-4b0d-483e-8ec0-cb9a89bcc9a0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py'}, 'id': '0c73311d-57a4-4313-a701-8161028b0275', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18776, 'output_tokens': 132, 'total_tokens': 19427, 'input_token_details': {'cache_read': 16898}, 'output_token_details': {'reasoning': 519}}
2025-12-21 04:38:25,623 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After several unsuccessful attempts to locate the pickling-related test cases, I have now retrieved the full content of `lib/matplotlib/tests/test_text.py`. My previous searches were inconclusive because I was only examining partial segments of the file. With the complete file content, I can now perform a thorough search for any tests related to pickling `Text` or `Annotation` objects, which will provide the necessary context to address the bug.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_text.py", "end_line": 2000.0, "start_line": 1.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 27020, 'candidates_token_count': 122, 'total_token_count': 28119, 'cached_content_token_count': 19101, 'prompt_tokens_details': [{'modality': 1, 'token_count': 27020}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19101}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 122}], 'thoughts_token_count': 977}, 'finish_reason': 'STOP', 'avg_logprobs': -0.9924744777992124, 'model_name': 'gemini-2.5-pro'} id='run--62ef3009-c0b4-4975-8c13-f8b2f22aab54-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_text.py', 'end_line': 2000.0, 'start_line': 1.0}, 'id': '63a6a2fc-7cbc-41ee-86f2-bfe62c235605', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27020, 'output_tokens': 122, 'total_tokens': 28119, 'input_token_details': {'cache_read': 19101}, 'output_token_details': {'reasoning': 977}}
2025-12-21 04:38:33,539 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After my initial searches within `lib/matplotlib/tests/test_text.py` were unsuccessful, I retrieved the entire file content to perform a comprehensive analysis. This allowed me to find the `test_pickle_text` function, which was not discoverable when reading the file in smaller chunks. This function serves as a smoke test for pickling `Text` objects and is directly relevant to your query.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 41237, 'candidates_token_count': 83, 'total_token_count': 42006, 'cached_content_token_count': 27098, 'prompt_tokens_details': [{'modality': 1, 'token_count': 41237}], 'cache_tokens_details': [{'modality': 1, 'token_count': 27098}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 83}], 'thoughts_token_count': 686}, 'finish_reason': 'STOP', 'avg_logprobs': -1.137589879782803, 'model_name': 'gemini-2.5-pro'} id='run--e17b8f20-d88c-4d8a-9e89-63dd17479e5f-0' usage_metadata={'input_tokens': 41237, 'output_tokens': 83, 'total_tokens': 42006, 'input_token_details': {'cache_read': 27098}, 'output_token_details': {'reasoning': 686}}
2025-12-21 04:38:33,542 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `lib/matplotlib/tests/test_text.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
To find test cases related to pickling `Text` or `Annotation` objects, which are directly related to the bug concerning draggable annotations.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_text.py
Line number range: 1 - 2000
Content:
1. from datetime import datetime
2. import io
3. import warnings
4. 
5. import numpy as np
6. from numpy.testing import assert_almost_equal
7. import pytest
8. 
9. import matplotlib as mpl
10. from matplotlib.backend_bases import MouseEvent
11. from matplotlib.font_manager import FontProperties
12. import matplotlib.patches as mpatches
13. import matplotlib.pyplot as plt
14. import matplotlib.transforms as mtransforms
15. from matplotlib.testing.decorators import check_figures_equal, image_comparison
16. from matplotlib.testing._markers import needs_usetex
17. from matplotlib.text import Text
18. 
19. 
20. @image_comparison(['font_styles'])
21. def test_font_styles():
22. 
23.     def find_matplotlib_font(**kw):
24.         prop = FontProperties(**kw)
25.         path = findfont(prop, directory=mpl.get_data_path())
26.         return FontProperties(fname=path)
27. 
28.     from matplotlib.font_manager import FontProperties, findfont
29.     warnings.filterwarnings(
30.         'ignore',
31.         r"findfont: Font family \[u?'Foo'\] not found. Falling back to .",
32.         UserWarning,
33.         module='matplotlib.font_manager')
34. 
35.     fig, ax = plt.subplots()
36. 
37.     normal_font = find_matplotlib_font(
38.         family="sans-serif",
39.         style="normal",
40.         variant="normal",
41.         size=14)
42.     a = ax.annotate(
43.         "Normal Font",
44.         (0.1, 0.1),
45.         xycoords='axes fraction',
46.         fontproperties=normal_font)
47.     assert a.get_fontname() == 'DejaVu Sans'
48.     assert a.get_fontstyle() == 'normal'
49.     assert a.get_fontvariant() == 'normal'
50.     assert a.get_weight() == 'normal'
51.     assert a.get_stretch() == 'normal'
52. 
53.     bold_font = find_matplotlib_font(
54.         family="Foo",
55.         style="normal",
56.         variant="normal",
57.         weight="bold",
58.         stretch=500,
59.         size=14)
60.     ax.annotate(
61.         "Bold Font",
62.         (0.1, 0.2),
63.         xycoords='axes fraction',
64.         fontproperties=bold_font)
65. 
66.     bold_italic_font = find_matplotlib_font(
67.         family="sans serif",
68.         style="italic",
69.         variant="normal",
70.         weight=750,
71.         stretch=500,
72.         size=14)
73.     ax.annotate(
74.         "Bold Italic Font",
75.         (0.1, 0.3),
76.         xycoords='axes fraction',
77.         fontproperties=bold_italic_font)
78. 
79.     light_font = find_matplotlib_font(
80.         family="sans-serif",
81.         style="normal",
82.         variant="normal",
83.         weight=200,
84.         stretch=500,
85.         size=14)
86.     ax.annotate(
87.         "Light Font",
88.         (0.1, 0.4),
89.         xycoords='axes fraction',
90.         fontproperties=light_font)
91. 
92.     condensed_font = find_matplotlib_font(
93.         family="sans-serif",
94.         style="normal",
95.         variant="normal",
96.         weight=500,
97.         stretch=100,
98.         size=14)
99.     ax.annotate(
100.         "Condensed Font",
101.         (0.1, 0.5),
102.         xycoords='axes fraction',
103.         fontproperties=condensed_font)
104. 
105.     ax.set_xticks([])
106.     ax.set_yticks([])
107. 
108. 
109. @image_comparison(['multiline'])
110. def test_multiline():
111.     plt.figure()
112.     ax = plt.subplot(1, 1, 1)
113.     ax.set_title("multiline\ntext alignment")
114. 
115.     plt.text(
116.         0.2, 0.5, "TpTpTp\n$M$\nTpTpTp", size=20, ha="center", va="top")
117. 
118.     plt.text(
119.         0.5, 0.5, "TpTpTp\n$M^{M^{M^{M}}}$\nTpTpTp", size=20,
120.         ha="center", va="top")
121. 
122.     plt.text(
123.         0.8, 0.5, "TpTpTp\n$M_{q_{q_{q}}}$\nTpTpTp", size=20,
124.         ha="center", va="top")
125. 
126.     plt.xlim(0, 1)
127.     plt.ylim(0, 0.8)
128. 
129.     ax.set_xticks([])
130.     ax.set_yticks([])
131. 
132. 
133. @image_comparison(['multiline2'], style='mpl20')
134. def test_multiline2():
135.     # Remove this line when this test image is regenerated.
136.     plt.rcParams['text.kerning_factor'] = 6
137. 
138.     fig, ax = plt.subplots()
139. 
140.     ax.set_xlim([0, 1.4])
141.     ax.set_ylim([0, 2])
142.     ax.axhline(0.5, color='C2', linewidth=0.3)
143.     sts = ['Line', '2 Lineg\n 2 Lg', '$\\sum_i x $', 'hi $\\sum_i x $\ntest',
144.            'test\n $\\sum_i x $', '$\\sum_i x $\n $\\sum_i x $']
145.     renderer = fig.canvas.get_renderer()
146. 
147.     def draw_box(ax, tt):
148.         r = mpatches.Rectangle((0, 0), 1, 1, clip_on=False,
149.                                transform=ax.transAxes)
150.         r.set_bounds(
151.             tt.get_window_extent(renderer)
152.             .transformed(ax.transAxes.inverted())
153.             .bounds)
154.         ax.add_patch(r)
155. 
156.     horal = 'left'
157.     for nn, st in enumerate(sts):
158.         tt = ax.text(0.2 * nn + 0.1, 0.5, st, horizontalalignment=horal,
159.                      verticalalignment='bottom')
160.         draw_box(ax, tt)
161.     ax.text(1.2, 0.5, 'Bottom align', color='C2')
162. 
163.     ax.axhline(1.3, color='C2', linewidth=0.3)
164.     for nn, st in enumerate(sts):
165.         tt = ax.text(0.2 * nn + 0.1, 1.3, st, horizontalalignment=horal,
166.                      verticalalignment='top')
167.         draw_box(ax, tt)
168.     ax.text(1.2, 1.3, 'Top align', color='C2')
169. 
170.     ax.axhline(1.8, color='C2', linewidth=0.3)
171.     for nn, st in enumerate(sts):
172.         tt = ax.text(0.2 * nn + 0.1, 1.8, st, horizontalalignment=horal,
173.                      verticalalignment='baseline')
174.         draw_box(ax, tt)
175.     ax.text(1.2, 1.8, 'Baseline align', color='C2')
176. 
177.     ax.axhline(0.1, color='C2', linewidth=0.3)
178.     for nn, st in enumerate(sts):
179.         tt = ax.text(0.2 * nn + 0.1, 0.1, st, horizontalalignment=horal,
180.                      verticalalignment='bottom', rotation=20)
181.         draw_box(ax, tt)
182.     ax.text(1.2, 0.1, 'Bot align, rot20', color='C2')
183. 
184. 
185. @image_comparison(['antialiased.png'])
186. def test_antialiasing():
187.     mpl.rcParams['text.antialiased'] = True
188. 
189.     fig = plt.figure(figsize=(5.25, 0.75))
190.     fig.text(0.5, 0.75, "antialiased", horizontalalignment='center',
191.              verticalalignment='center')
192.     fig.text(0.5, 0.25, r"$\sqrt{x}$", horizontalalignment='center',
193.              verticalalignment='center')
194.     # NOTE: We don't need to restore the rcParams here, because the
195.     # test cleanup will do it for us.  In fact, if we do it here, it
196.     # will turn antialiasing back off before the images are actually
197.     # rendered.
198. 
199. 
200. def test_afm_kerning():
201.     fn = mpl.font_manager.findfont("Helvetica", fontext="afm")
202.     with open(fn, 'rb') as fh:
203.         afm = mpl._afm.AFM(fh)
204.     assert afm.string_width_height('VAVAVAVAVAVA') == (7174.0, 718)
205. 
206. 
207. @image_comparison(['text_contains.png'])
208. def test_contains():
209.     fig = plt.figure()
210.     ax = plt.axes()
211. 
212.     mevent = MouseEvent('button_press_event', fig.canvas, 0.5, 0.5, 1, None)
213. 
214.     xs = np.linspace(0.25, 0.75, 30)
215.     ys = np.linspace(0.25, 0.75, 30)
216.     xs, ys = np.meshgrid(xs, ys)
217. 
218.     txt = plt.text(
219.         0.5, 0.4, 'hello world', ha='center', fontsize=30, rotation=30)
220.     # uncomment to draw the text's bounding box
221.     # txt.set_bbox(dict(edgecolor='black', facecolor='none'))
222. 
223.     # draw the text. This is important, as the contains method can only work
224.     # when a renderer exists.
225.     fig.canvas.draw()
226. 
227.     for x, y in zip(xs.flat, ys.flat):
228.         mevent.x, mevent.y = plt.gca().transAxes.transform([x, y])
229.         contains, _ = txt.contains(mevent)
230.         color = 'yellow' if contains else 'red'
231. 
232.         # capture the viewLim, plot a point, and reset the viewLim
233.         vl = ax.viewLim.frozen()
234.         ax.plot(x, y, 'o', color=color)
235.         ax.viewLim.set(vl)
236. 
237. 
238. def test_annotation_contains():
239.     # Check that Annotation.contains looks at the bboxes of the text and the
240.     # arrow separately, not at the joint bbox.
241.     fig, ax = plt.subplots()
242.     ann = ax.annotate(
243.         "hello", xy=(.4, .4), xytext=(.6, .6), arrowprops={"arrowstyle": "->"})
244.     fig.canvas.draw()  # Needed for the same reason as in test_contains.
245.     event = MouseEvent(
246.         "button_press_event", fig.canvas, *ax.transData.transform((.5, .6)))
247.     assert ann.contains(event) == (False, {})
248. 
249. 
250. @pytest.mark.parametrize('err, xycoords, match', (
251.     (RuntimeError, print, "Unknown return type"),
252.     (RuntimeError, [0, 0], r"Unknown coordinate type: \[0, 0\]"),
253.     (ValueError, "foo", "'foo' is not a recognized coordinate"),
254.     (ValueError, "foo bar", "'foo bar' is not a recognized coordinate"),
255.     (ValueError, "offset foo", "xycoords cannot be an offset coordinate"),
256.     (ValueError, "axes foo", "'foo' is not a recognized unit"),
257. ))
258. def test_annotate_errors(err, xycoords, match):
259.     fig, ax = plt.subplots()
260.     with pytest.raises(err, match=match):
261.         ax.annotate('xy', (0, 0), xytext=(0.5, 0.5), xycoords=xycoords)
262.         fig.canvas.draw()
263. 
264. 
265. @image_comparison(['titles'])
266. def test_titles():
267.     # left and right side titles
268.     plt.figure()
269.     ax = plt.subplot(1, 1, 1)
270.     ax.set_title("left title", loc="left")
271.     ax.set_title("right title", loc="right")
272.     ax.set_xticks([])
273.     ax.set_yticks([])
274. 
275. 
276. @image_comparison(['text_alignment'], style='mpl20')
277. def test_alignment():
278.     plt.figure()
279.     ax = plt.subplot(1, 1, 1)
280. 
281.     x = 0.1
282.     for rotation in (0, 30):
283.         for alignment in ('top', 'bottom', 'baseline', 'center'):
284.             ax.text(
285.                 x, 0.5, alignment + " Tj", va=alignment, rotation=rotation,
286.                 bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))
287.             ax.text(
288.                 x, 1.0, r'$\sum_{i=0}^{j}$', va=alignment, rotation=rotation)
289.             x += 0.1
290. 
291.     ax.plot([0, 1], [0.5, 0.5])
292.     ax.plot([0, 1], [1.0, 1.0])
293. 
294.     ax.set_xlim([0, 1])
295.     ax.set_ylim([0, 1.5])
296.     ax.set_xticks([])
297.     ax.set_yticks([])
298. 
299. 
300. @image_comparison(['axes_titles.png'])
301. def test_axes_titles():
302.     # Related to issue #3327
303.     plt.figure()
304.     ax = plt.subplot(1, 1, 1)
305.     ax.set_title('center', loc='center', fontsize=20, fontweight=700)
306.     ax.set_title('left', loc='left', fontsize=12, fontweight=400)
307.     ax.set_title('right', loc='right', fontsize=12, fontweight=400)
308. 
309. 
310. def test_set_position():
311.     fig, ax = plt.subplots()
312. 
313.     # test set_position
314.     ann = ax.annotate(
315.         'test', (0, 0), xytext=(0, 0), textcoords='figure pixels')
316.     fig.canvas.draw()
317. 
318.     init_pos = ann.get_window_extent(fig.canvas.renderer)
319.     shift_val = 15
320.     ann.set_position((shift_val, shift_val))
321.     fig.canvas.draw()
322.     post_pos = ann.get_window_extent(fig.canvas.renderer)
323. 
324.     for a, b in zip(init_pos.min, post_pos.min):
325.         assert a + shift_val == b
326. 
327.     # test xyann
328.     ann = ax.annotate(
329.         'test', (0, 0), xytext=(0, 0), textcoords='figure pixels')
330.     fig.canvas.draw()
331. 
332.     init_pos = ann.get_window_extent(fig.canvas.renderer)
333.     shift_val = 15
334.     ann.xyann = (shift_val, shift_val)
335.     fig.canvas.draw()
336.     post_pos = ann.get_window_extent(fig.canvas.renderer)
337. 
338.     for a, b in zip(init_pos.min, post_pos.min):
339.         assert a + shift_val == b
340. 
341. 
342. def test_char_index_at():
343.     fig = plt.figure()
344.     text = fig.text(0.1, 0.9, "")
345. 
346.     text.set_text("i")
347.     bbox = text.get_window_extent()
348.     size_i = bbox.x1 - bbox.x0
349. 
350.     text.set_text("m")
351.     bbox = text.get_window_extent()
352.     size_m = bbox.x1 - bbox.x0
353. 
354.     text.set_text("iiiimmmm")
355.     bbox = text.get_window_extent()
356.     origin = bbox.x0
357. 
358.     assert text._char_index_at(origin - size_i) == 0  # left of first char
359.     assert text._char_index_at(origin) == 0
360.     assert text._char_index_at(origin + 0.499*size_i) == 0
361.     assert text._char_index_at(origin + 0.501*size_i) == 1
362.     assert text._char_index_at(origin + size_i*3) == 3
363.     assert text._char_index_at(origin + size_i*4 + size_m*3) == 7
364.     assert text._char_index_at(origin + size_i*4 + size_m*4) == 8
365.     assert text._char_index_at(origin + size_i*4 + size_m*10) == 8
366. 
367. 
368. @pytest.mark.parametrize('text', ['', 'O'], ids=['empty', 'non-empty'])
369. def test_non_default_dpi(text):
370.     fig, ax = plt.subplots()
371. 
372.     t1 = ax.text(0.5, 0.5, text, ha='left', va='bottom')
373.     fig.canvas.draw()
374.     dpi = fig.dpi
375. 
376.     bbox1 = t1.get_window_extent()
377.     bbox2 = t1.get_window_extent(dpi=dpi * 10)
378.     np.testing.assert_allclose(bbox2.get_points(), bbox1.get_points() * 10,
379.                                rtol=5e-2)
380.     # Text.get_window_extent should not permanently change dpi.
381.     assert fig.dpi == dpi
382. 
383. 
384. def test_get_rotation_string():
385.     assert Text(rotation='horizontal').get_rotation() == 0.
386.     assert Text(rotation='vertical').get_rotation() == 90.
387. 
388. 
389. def test_get_rotation_float():
390.     for i in [15., 16.70, 77.4]:
391.         assert Text(rotation=i).get_rotation() == i
392. 
393. 
394. def test_get_rotation_int():
395.     for i in [67, 16, 41]:
396.         assert Text(rotation=i).get_rotation() == float(i)
397. 
398. 
399. def test_get_rotation_raises():
400.     with pytest.raises(ValueError):
401.         Text(rotation='hozirontal')
402. 
403. 
404. def test_get_rotation_none():
405.     assert Text(rotation=None).get_rotation() == 0.0
406. 
407. 
408. def test_get_rotation_mod360():
409.     for i, j in zip([360., 377., 720+177.2], [0., 17., 177.2]):
410.         assert_almost_equal(Text(rotation=i).get_rotation(), j)
411. 
412. 
413. @pytest.mark.parametrize("ha", ["center", "right", "left"])
414. @pytest.mark.parametrize("va", ["center", "top", "bottom",
415.                                 "baseline", "center_baseline"])
416. def test_null_rotation_with_rotation_mode(ha, va):
417.     fig, ax = plt.subplots()
418.     kw = dict(rotation=0, va=va, ha=ha)
419.     t0 = ax.text(.5, .5, 'test', rotation_mode='anchor', **kw)
420.     t1 = ax.text(.5, .5, 'test', rotation_mode='default', **kw)
421.     fig.canvas.draw()
422.     assert_almost_equal(t0.get_window_extent(fig.canvas.renderer).get_points(),
423.                         t1.get_window_extent(fig.canvas.renderer).get_points())
424. 
425. 
426. @image_comparison(['text_bboxclip'])
427. def test_bbox_clipping():
428.     plt.text(0.9, 0.2, 'Is bbox clipped?', backgroundcolor='r', clip_on=True)
429.     t = plt.text(0.9, 0.5, 'Is fancy bbox clipped?', clip_on=True)
430.     t.set_bbox({"boxstyle": "round, pad=0.1"})
431. 
432. 
433. @image_comparison(['annotation_negative_ax_coords.png'])
434. def test_annotation_negative_ax_coords():
435.     fig, ax = plt.subplots()
436. 
437.     ax.annotate('+ pts',
438.                 xytext=[30, 20], textcoords='axes points',
439.                 xy=[30, 20], xycoords='axes points', fontsize=32)
440.     ax.annotate('- pts',
441.                 xytext=[30, -20], textcoords='axes points',
442.                 xy=[30, -20], xycoords='axes points', fontsize=32,
443.                 va='top')
444.     ax.annotate('+ frac',
445.                 xytext=[0.75, 0.05], textcoords='axes fraction',
446.                 xy=[0.75, 0.05], xycoords='axes fraction', fontsize=32)
447.     ax.annotate('- frac',
448.                 xytext=[0.75, -0.05], textcoords='axes fraction',
449.                 xy=[0.75, -0.05], xycoords='axes fraction', fontsize=32,
450.                 va='top')
451. 
452.     ax.annotate('+ pixels',
453.                 xytext=[160, 25], textcoords='axes pixels',
454.                 xy=[160, 25], xycoords='axes pixels', fontsize=32)
455.     ax.annotate('- pixels',
456.                 xytext=[160, -25], textcoords='axes pixels',
457.                 xy=[160, -25], xycoords='axes pixels', fontsize=32,
458.                 va='top')
459. 
460. 
461. @image_comparison(['annotation_negative_fig_coords.png'])
462. def test_annotation_negative_fig_coords():
463.     fig, ax = plt.subplots()
464. 
465.     ax.annotate('+ pts',
466.                 xytext=[10, 120], textcoords='figure points',
467.                 xy=[10, 120], xycoords='figure points', fontsize=32)
468.     ax.annotate('- pts',
469.                 xytext=[-10, 180], textcoords='figure points',
470.                 xy=[-10, 180], xycoords='figure points', fontsize=32,
471.                 va='top')
472.     ax.annotate('+ frac',
473.                 xytext=[0.05, 0.55], textcoords='figure fraction',
474.                 xy=[0.05, 0.55], xycoords='figure fraction', fontsize=32)
475.     ax.annotate('- frac',
476.                 xytext=[-0.05, 0.5], textcoords='figure fraction',
477.                 xy=[-0.05, 0.5], xycoords='figure fraction', fontsize=32,
478.                 va='top')
479. 
480.     ax.annotate('+ pixels',
481.                 xytext=[50, 50], textcoords='figure pixels',
482.                 xy=[50, 50], xycoords='figure pixels', fontsize=32)
483.     ax.annotate('- pixels',
484.                 xytext=[-50, 100], textcoords='figure pixels',
485.                 xy=[-50, 100], xycoords='figure pixels', fontsize=32,
486.                 va='top')
487. 
488. 
489. def test_text_stale():
490.     fig, (ax1, ax2) = plt.subplots(1, 2)
491.     plt.draw_all()
492.     assert not ax1.stale
493.     assert not ax2.stale
494.     assert not fig.stale
495. 
496.     txt1 = ax1.text(.5, .5, 'aardvark')
497.     assert ax1.stale
498.     assert txt1.stale
499.     assert fig.stale
500. 
501.     ann1 = ax2.annotate('aardvark', xy=[.5, .5])
502.     assert ax2.stale
503.     assert ann1.stale
504.     assert fig.stale
505. 
506.     plt.draw_all()
507.     assert not ax1.stale
508.     assert not ax2.stale
509.     assert not fig.stale
510. 
511. 
512. @image_comparison(['agg_text_clip.png'])
513. def test_agg_text_clip():
514.     np.random.seed(1)
515.     fig, (ax1, ax2) = plt.subplots(2)
516.     for x, y in np.random.rand(10, 2):
517.         ax1.text(x, y, "foo", clip_on=True)
518.         ax2.text(x, y, "foo")
519. 
520. 
521. def test_text_size_binding():
522.     mpl.rcParams['font.size'] = 10
523.     fp = mpl.font_manager.FontProperties(size='large')
524.     sz1 = fp.get_size_in_points()
525.     mpl.rcParams['font.size'] = 100
526. 
527.     assert sz1 == fp.get_size_in_points()
528. 
529. 
530. @image_comparison(['font_scaling.pdf'])
531. def test_font_scaling():
532.     mpl.rcParams['pdf.fonttype'] = 42
533.     fig, ax = plt.subplots(figsize=(6.4, 12.4))
534.     ax.xaxis.set_major_locator(plt.NullLocator())
535.     ax.yaxis.set_major_locator(plt.NullLocator())
536.     ax.set_ylim(-10, 600)
537. 
538.     for i, fs in enumerate(range(4, 43, 2)):
539.         ax.text(0.1, i*30, f"{fs} pt font size", fontsize=fs)
540. 
541. 
542. @pytest.mark.parametrize('spacing1, spacing2', [(0.4, 2), (2, 0.4), (2, 2)])
543. def test_two_2line_texts(spacing1, spacing2):
544.     text_string = 'line1\nline2'
545.     fig = plt.figure()
546.     renderer = fig.canvas.get_renderer()
547. 
548.     text1 = fig.text(0.25, 0.5, text_string, linespacing=spacing1)
549.     text2 = fig.text(0.25, 0.5, text_string, linespacing=spacing2)
550.     fig.canvas.draw()
551. 
552.     box1 = text1.get_window_extent(renderer=renderer)
553.     box2 = text2.get_window_extent(renderer=renderer)
554. 
555.     # line spacing only affects height
556.     assert box1.width == box2.width
557.     if spacing1 == spacing2:
558.         assert box1.height == box2.height
559.     else:
560.         assert box1.height != box2.height
561. 
562. 
563. def test_validate_linespacing():
564.     with pytest.raises(TypeError):
565.         plt.text(.25, .5, "foo", linespacing="abc")
566. 
567. 
568. def test_nonfinite_pos():
569.     fig, ax = plt.subplots()
570.     ax.text(0, np.nan, 'nan')
571.     ax.text(np.inf, 0, 'inf')
572.     fig.canvas.draw()
573. 
574. 
575. def test_hinting_factor_backends():
576.     plt.rcParams['text.hinting_factor'] = 1
577.     fig = plt.figure()
578.     t = fig.text(0.5, 0.5, 'some text')
579. 
580.     fig.savefig(io.BytesIO(), format='svg')
581.     expected = t.get_window_extent().intervalx
582. 
583.     fig.savefig(io.BytesIO(), format='png')
584.     # Backends should apply hinting_factor consistently (within 10%).
585.     np.testing.assert_allclose(t.get_window_extent().intervalx, expected,
586.                                rtol=0.1)
587. 
588. 
589. @needs_usetex
590. def test_usetex_is_copied():
591.     # Indirectly tests that update_from (which is used to copy tick label
592.     # properties) copies usetex state.
593.     fig = plt.figure()
594.     plt.rcParams["text.usetex"] = False
595.     ax1 = fig.add_subplot(121)
596.     plt.rcParams["text.usetex"] = True
597.     ax2 = fig.add_subplot(122)
598.     fig.canvas.draw()
599.     for ax, usetex in [(ax1, False), (ax2, True)]:
600.         for t in ax.xaxis.majorTicks:
601.             assert t.label1.get_usetex() == usetex
602. 
603. 
604. @needs_usetex
605. def test_single_artist_usetex():
606.     # Check that a single artist marked with usetex does not get passed through
607.     # the mathtext parser at all (for the Agg backend) (the mathtext parser
608.     # currently fails to parse \frac12, requiring \frac{1}{2} instead).
609.     fig = plt.figure()
610.     fig.text(.5, .5, r"$\frac12$", usetex=True)
611.     fig.canvas.draw()
612. 
613. 
614. @pytest.mark.parametrize("fmt", ["png", "pdf", "svg"])
615. def test_single_artist_usenotex(fmt):
616.     # Check that a single artist can be marked as not-usetex even though the
617.     # rcParam is on ("2_2_2" fails if passed to TeX).  This currently skips
618.     # postscript output as the ps renderer doesn't support mixing usetex and
619.     # non-usetex.
620.     plt.rcParams["text.usetex"] = True
621.     fig = plt.figure()
622.     fig.text(.5, .5, "2_2_2", usetex=False)
623.     fig.savefig(io.BytesIO(), format=fmt)
624. 
625. 
626. @image_comparison(['text_as_path_opacity.svg'])
627. def test_text_as_path_opacity():
628.     plt.figure()
629.     plt.gca().set_axis_off()
630.     plt.text(0.25, 0.25, 'c', color=(0, 0, 0, 0.5))
631.     plt.text(0.25, 0.5, 'a', alpha=0.5)
632.     plt.text(0.25, 0.75, 'x', alpha=0.5, color=(0, 0, 0, 1))
633. 
634. 
635. @image_comparison(['text_as_text_opacity.svg'])
636. def test_text_as_text_opacity():
637.     mpl.rcParams['svg.fonttype'] = 'none'
638.     plt.figure()
639.     plt.gca().set_axis_off()
640.     plt.text(0.25, 0.25, '50% using `color`', color=(0, 0, 0, 0.5))
641.     plt.text(0.25, 0.5, '50% using `alpha`', alpha=0.5)
642.     plt.text(0.25, 0.75, '50% using `alpha` and 100% `color`', alpha=0.5,
643.              color=(0, 0, 0, 1))
644. 
645. 
646. def test_text_repr():
647.     # smoketest to make sure text repr doesn't error for category
648.     plt.plot(['A', 'B'], [1, 2])
649.     repr(plt.text(['A'], 0.5, 'Boo'))
650. 
651. 
652. def test_annotation_update():
653.     fig, ax = plt.subplots(1, 1)
654.     an = ax.annotate('annotation', xy=(0.5, 0.5))
655.     extent1 = an.get_window_extent(fig.canvas.get_renderer())
656.     fig.tight_layout()
657.     extent2 = an.get_window_extent(fig.canvas.get_renderer())
658. 
659.     assert not np.allclose(extent1.get_points(), extent2.get_points(),
660.                            rtol=1e-6)
661. 
662. 
663. @check_figures_equal(extensions=["png"])
664. def test_annotation_units(fig_test, fig_ref):
665.     ax = fig_test.add_subplot()
666.     ax.plot(datetime.now(), 1, "o")  # Implicitly set axes extents.
667.     ax.annotate("x", (datetime.now(), 0.5), xycoords=("data", "axes fraction"),
668.                 # This used to crash before.
669.                 xytext=(0, 0), textcoords="offset points")
670.     ax = fig_ref.add_subplot()
671.     ax.plot(datetime.now(), 1, "o")
672.     ax.annotate("x", (datetime.now(), 0.5), xycoords=("data", "axes fraction"))
673. 
674. 
675. @image_comparison(['large_subscript_title.png'], style='mpl20')
676. def test_large_subscript_title():
677.     # Remove this line when this test image is regenerated.
678.     plt.rcParams['text.kerning_factor'] = 6
679.     plt.rcParams['axes.titley'] = None
680. 
681.     fig, axs = plt.subplots(1, 2, figsize=(9, 2.5), constrained_layout=True)
682.     ax = axs[0]
683.     ax.set_title(r'$\sum_{i} x_i$')
684.     ax.set_title('New way', loc='left')
685.     ax.set_xticklabels([])
686. 
687.     ax = axs[1]
688.     ax.set_title(r'$\sum_{i} x_i$', y=1.01)
689.     ax.set_title('Old Way', loc='left')
690.     ax.set_xticklabels([])
691. 
692. 
693. def test_wrap():
694.     fig = plt.figure(figsize=(6, 4))
695.     s = 'This is a very long text that should be wrapped multiple times.'
696.     text = fig.text(0.7, 0.5, s, wrap=True)
697.     fig.canvas.draw()
698.     assert text._get_wrapped_text() == ('This is a very long\n'
699.                                         'text that should be\n'
700.                                         'wrapped multiple\n'
701.                                         'times.')
702. 
703. 
704. def test_long_word_wrap():
705.     fig = plt.figure(figsize=(6, 4))
706.     text = fig.text(9.5, 8, 'Alonglineoftexttowrap', wrap=True)
707.     fig.canvas.draw()
708.     assert text._get_wrapped_text() == 'Alonglineoftexttowrap'
709. 
710. 
711. def test_wrap_no_wrap():
712.     fig = plt.figure(figsize=(6, 4))
713.     text = fig.text(0, 0, 'non wrapped text', wrap=True)
714.     fig.canvas.draw()
715.     assert text._get_wrapped_text() == 'non wrapped text'
716. 
717. 
718. @check_figures_equal(extensions=["png"])
719. def test_buffer_size(fig_test, fig_ref):
720.     # On old versions of the Agg renderer, large non-ascii single-character
721.     # strings (here, "€") would be rendered clipped because the rendering
722.     # buffer would be set by the physical size of the smaller "a" character.
723.     ax = fig_test.add_subplot()
724.     ax.set_yticks([0, 1])
725.     ax.set_yticklabels(["€", "a"])
726.     ax.yaxis.majorTicks[1].label1.set_color("w")
727.     ax = fig_ref.add_subplot()
728.     ax.set_yticks([0, 1])
729.     ax.set_yticklabels(["€", ""])
730. 
731. 
732. def test_fontproperties_kwarg_precedence():
733.     """Test that kwargs take precedence over fontproperties defaults."""
734.     plt.figure()
735.     text1 = plt.xlabel("value", fontproperties='Times New Roman', size=40.0)
736.     text2 = plt.ylabel("counts", size=40.0, fontproperties='Times New Roman')
737.     assert text1.get_size() == 40.0
738.     assert text2.get_size() == 40.0
739. 
740. 
741. def test_transform_rotates_text():
742.     ax = plt.gca()
743.     transform = mtransforms.Affine2D().rotate_deg(30)
744.     text = ax.text(0, 0, 'test', transform=transform,
745.                    transform_rotates_text=True)
746.     result = text.get_rotation()
747.     assert_almost_equal(result, 30)
748. 
749. 
750. def test_update_mutate_input():
751.     inp = dict(fontproperties=FontProperties(weight="bold"),
752.                bbox=None)
753.     cache = dict(inp)
754.     t = Text()
755.     t.update(inp)
756.     assert inp['fontproperties'] == cache['fontproperties']
757.     assert inp['bbox'] == cache['bbox']
758. 
759. 
760. @pytest.mark.parametrize('rotation', ['invalid string', [90]])
761. def test_invalid_rotation_values(rotation):
762.     with pytest.raises(
763.             ValueError,
764.             match=("rotation must be 'vertical', 'horizontal' or a number")):
765.         Text(0, 0, 'foo', rotation=rotation)
766. 
767. 
768. def test_invalid_color():
769.     with pytest.raises(ValueError):
770.         plt.figtext(.5, .5, "foo", c="foobar")
771. 
772. 
773. @image_comparison(['text_pdf_kerning.pdf'], style='mpl20')
774. def test_pdf_kerning():
775.     plt.figure()
776.     plt.figtext(0.1, 0.5, "ATATATATATATATATATA", size=30)
777. 
778. 
779. def test_unsupported_script(recwarn):
780.     fig = plt.figure()
781.     fig.text(.5, .5, "\N{BENGALI DIGIT ZERO}")
782.     fig.canvas.draw()
783.     assert all(isinstance(warn.message, UserWarning) for warn in recwarn)
784.     assert (
785.         [warn.message.args for warn in recwarn] ==
786.         [(r"Glyph 2534 (\N{BENGALI DIGIT ZERO}) missing from current font.",),
787.          (r"Matplotlib currently does not support Bengali natively.",)])
788. 
789. 
790. def test_parse_math():
791.     fig, ax = plt.subplots()
792.     ax.text(0, 0, r"$ \wrong{math} $", parse_math=False)
793.     fig.canvas.draw()
794. 
795.     ax.text(0, 0, r"$ \wrong{math} $", parse_math=True)
796.     with pytest.raises(ValueError, match='Unknown symbol'):
797.         fig.canvas.draw()
798. 
799. 
800. def test_parse_math_rcparams():
801.     # Default is True
802.     fig, ax = plt.subplots()
803.     ax.text(0, 0, r"$ \wrong{math} $")
804.     with pytest.raises(ValueError, match='Unknown symbol'):
805.         fig.canvas.draw()
806. 
807.     # Setting rcParams to False
808.     with mpl.rc_context({'text.parse_math': False}):
809.         fig, ax = plt.subplots()
810.         ax.text(0, 0, r"$ \wrong{math} $")
811.         fig.canvas.draw()
812. 
813. 
814. @image_comparison(['text_pdf_font42_kerning.pdf'], style='mpl20')
815. def test_pdf_font42_kerning():
816.     plt.rcParams['pdf.fonttype'] = 42
817.     plt.figure()
818.     plt.figtext(0.1, 0.5, "ATAVATAVATAVATAVATA", size=30)
819. 
820. 
821. @image_comparison(['text_pdf_chars_beyond_bmp.pdf'], style='mpl20')
822. def test_pdf_chars_beyond_bmp():
823.     plt.rcParams['pdf.fonttype'] = 42
824.     plt.rcParams['mathtext.fontset'] = 'stixsans'
825.     plt.figure()
826.     plt.figtext(0.1, 0.5, "Mass $m$ \U00010308", size=30)
827. 
828. 
829. @needs_usetex
830. def test_metrics_cache():
831.     mpl.text._get_text_metrics_with_cache_impl.cache_clear()
832. 
833.     fig = plt.figure()
834.     fig.text(.3, .5, "foo\nbar")
835.     fig.text(.3, .5, "foo\nbar", usetex=True)
836.     fig.text(.5, .5, "foo\nbar", usetex=True)
837.     fig.canvas.draw()
838.     renderer = fig._get_renderer()
839.     ys = {}  # mapping of strings to where they were drawn in y with draw_tex.
840. 
841.     def call(*args, **kwargs):
842.         renderer, x, y, s, *_ = args
843.         ys.setdefault(s, set()).add(y)
844. 
845.     renderer.draw_tex = call
846.     fig.canvas.draw()
847.     assert [*ys] == ["foo", "bar"]
848.     # Check that both TeX strings were drawn with the same y-position for both
849.     # single-line substrings.  Previously, there used to be an incorrect cache
850.     # collision with the non-TeX string (drawn first here) whose metrics would
851.     # get incorrectly reused by the first TeX string.
852.     assert len(ys["foo"]) == len(ys["bar"]) == 1
853. 
854.     info = mpl.text._get_text_metrics_with_cache_impl.cache_info()
855.     # Every string gets a miss for the first layouting (extents), then a hit
856.     # when drawing, but "foo\nbar" gets two hits as it's drawn twice.
857.     assert info.hits > info.misses

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 04:38:38,673 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user has requested the full content of the file `lib/matplotlib/tests/test_text.py`. The provided context contains the entire content of this file, so the whole file is relevant to the user's query.", relative_path='lib/matplotlib/tests/test_text.py', start_line=1, end_line=857)]
2025-12-21 04:38:38,676 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file `lib/matplotlib/tests/test_text.py`.
2025-12-21 04:38:38,676 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 04:38:38,676 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 04:38:38,676 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-21 04:38:38,676 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 04:38:38,677 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   ├── 25112-GG.rst
|   |   |   |   ├── 25192-DS.rst
|   |   |   |   └── 25255-RR.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   ├── 24990-OG.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   └── 25282-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 24923-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.6.0.rst
|   |   |   ├── api_changes_3.6.1.rst
|   |   |   ├── api_changes_3.7.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.7.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── README.rst
|       |   ├── pie_hatch.rst
|       |   ├── savefig_bbox_layout.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── github_stats_3.6.0.rst
|       |   ├── github_stats_3.6.1.rst
|       |   ├── github_stats_3.6.2.rst
|       |   ├── github_stats_3.6.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   ├── whats_new_3.6.0.rst
|       |   └── whats_new_3.7.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── galleries
|   ├── examples
|   |   ├── README.txt
|   |   ├── animation
|   |   |   ├── README.txt
|   |   |   ├── animate_decay.py
|   |   |   ├── animated_histogram.py
|   |   |   ├── animation_demo.py
|   |   |   ├── bayes_update.py
|   |   |   ├── double_pendulum.py
|   |   |   ├── dynamic_image.py
|   |   |   ├── frame_grabbing_sgskip.py
|   |   |   ├── multiple_axes.py
|   |   |   ├── pause_resume.py
|   |   |   ├── rain.py
|   |   |   ├── random_walk.py
|   |   |   ├── simple_anim.py
|   |   |   ├── simple_scatter.py
|   |   |   ├── strip_chart.py
|   |   |   └── unchained.py
|   |   ├── axes_grid1
|   |   |   ├── README.txt
|   |   |   ├── demo_anchored_direction_arrows.py
|   |   |   ├── demo_axes_divider.py
|   |   |   ├── demo_axes_grid.py
|   |   |   ├── demo_axes_grid2.py
|   |   |   ├── demo_axes_hbox_divider.py
|   |   |   ├── demo_axes_rgb.py
|   |   |   ├── demo_colorbar_of_inset_axes.py
|   |   |   ├── demo_colorbar_with_axes_divider.py
|   |   |   ├── demo_colorbar_with_inset_locator.py
|   |   |   ├── demo_edge_colorbar.py
|   |   |   ├── demo_fixed_size_axes.py
|   |   |   ├── demo_imagegrid_aspect.py
|   |   |   ├── inset_locator_demo.py
|   |   |   ├── inset_locator_demo2.py
|   |   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   |   ├── parasite_simple.py
|   |   |   ├── parasite_simple2.py
|   |   |   ├── scatter_hist_locatable_axes.py
|   |   |   ├── simple_anchored_artists.py
|   |   |   ├── simple_axes_divider1.py
|   |   |   ├── simple_axes_divider3.py
|   |   |   ├── simple_axesgrid.py
|   |   |   ├── simple_axesgrid2.py
|   |   |   ├── simple_axisline4.py
|   |   |   └── simple_colorbar.py
|   |   ├── axisartist
|   |   |   ├── README.txt
|   |   |   ├── axis_direction.py
|   |   |   ├── demo_axis_direction.py
|   |   |   ├── demo_axisline_style.py
|   |   |   ├── demo_curvelinear_grid.py
|   |   |   ├── demo_curvelinear_grid2.py
|   |   |   ├── demo_floating_axes.py
|   |   |   ├── demo_floating_axis.py
|   |   |   ├── demo_parasite_axes.py
|   |   |   ├── demo_parasite_axes2.py
|   |   |   ├── demo_ticklabel_alignment.py
|   |   |   ├── demo_ticklabel_direction.py
|   |   |   ├── simple_axis_direction01.py
|   |   |   ├── simple_axis_direction03.py
|   |   |   ├── simple_axis_pad.py
|   |   |   ├── simple_axisartist1.py
|   |   |   ├── simple_axisline.py
|   |   |   └── simple_axisline3.py
|   |   ├── color
|   |   |   ├── README.txt
|   |   |   ├── color_by_yvalue.py
|   |   |   ├── color_cycle_default.py
|   |   |   ├── color_demo.py
|   |   |   ├── colorbar_basics.py
|   |   |   ├── colormap_reference.py
|   |   |   ├── custom_cmap.py
|   |   |   └── named_colors.py
|   |   ├── event_handling
|   |   |   ├── README.txt
|   |   |   ├── close_event.py
|   |   |   ├── coords_demo.py
|   |   |   ├── cursor_demo.py
|   |   |   ├── data_browser.py
|   |   |   ├── figure_axes_enter_leave.py
|   |   |   ├── ginput_manual_clabel_sgskip.py
|   |   |   ├── image_slices_viewer.py
|   |   |   ├── keypress_demo.py
|   |   |   ├── lasso_demo.py
|   |   |   ├── legend_picking.py
|   |   |   ├── looking_glass.py
|   |   |   ├── path_editor.py
|   |   |   ├── pick_event_demo.py
|   |   |   ├── pick_event_demo2.py
|   |   |   ├── poly_editor.py
|   |   |   ├── pong_sgskip.py
|   |   |   ├── resample.py
|   |   |   ├── timers.py
|   |   |   ├── trifinder_event_demo.py
|   |   |   ├── viewlims.py
|   |   |   └── zoom_window.py
|   |   ├── images_contours_and_fields
|   |   |   ├── README.txt
|   |   |   ├── affine_image.py
|   |   |   ├── barb_demo.py
|   |   |   ├── barcode_demo.py
|   |   |   ├── colormap_interactive_adjustment.py
|   |   |   ├── colormap_normalizations.py
|   |   |   ├── colormap_normalizations_symlognorm.py
|   |   |   ├── contour_corner_mask.py
|   |   |   ├── contour_demo.py
|   |   |   ├── contour_image.py
|   |   |   ├── contour_label_demo.py
|   |   |   ├── contourf_demo.py
|   |   |   ├── contourf_hatching.py
|   |   |   ├── contourf_log.py
|   |   |   ├── contours_in_optimization_demo.py
|   |   |   ├── demo_bboximage.py
|   |   |   ├── figimage_demo.py
|   |   |   ├── image_annotated_heatmap.py
|   |   |   ├── image_antialiasing.py
|   |   |   ├── image_clip_path.py
|   |   |   ├── image_demo.py
|   |   |   ├── image_masked.py
|   |   |   ├── image_nonuniform.py
|   |   |   ├── image_transparency_blend.py
|   |   |   ├── image_zcoord.py
|   |   |   ├── interpolation_methods.py
|   |   |   ├── irregulardatagrid.py
|   |   |   ├── layer_images.py
|   |   |   ├── matshow.py
|   |   |   ├── multi_image.py
|   |   |   ├── pcolor_demo.py
|   |   |   ├── pcolormesh_grids.py
|   |   |   ├── pcolormesh_levels.py
|   |   |   ├── plot_streamplot.py
|   |   |   ├── quadmesh_demo.py
|   |   |   ├── quiver_demo.py
|   |   |   ├── quiver_simple_demo.py
|   |   |   ├── shading_example.py
|   |   |   ├── specgram_demo.py
|   |   |   ├── spy_demos.py
|   |   |   ├── tricontour_demo.py
|   |   |   ├── tricontour_smooth_delaunay.py
|   |   |   ├── tricontour_smooth_user.py
|   |   |   ├── trigradient_demo.py
|   |   |   ├── triinterp_demo.py
|   |   |   ├── tripcolor_demo.py
|   |   |   ├── triplot_demo.py
|   |   |   └── watermark_image.py
|   |   ├── lines_bars_and_markers
|   |   |   ├── README.txt
|   |   |   ├── bar_colors.py
|   |   |   ├── bar_label_demo.py
|   |   |   ├── bar_stacked.py
|   |   |   ├── barchart.py
|   |   |   ├── barh.py
|   |   |   ├── broken_barh.py
|   |   |   ├── capstyle.py
|   |   |   ├── categorical_variables.py
|   |   |   ├── cohere.py
|   |   |   ├── csd_demo.py
|   |   |   ├── curve_error_band.py
|   |   |   ├── errorbar_limits_simple.py
|   |   |   ├── errorbar_subsample.py
|   |   |   ├── eventcollection_demo.py
|   |   |   ├── eventplot_demo.py
|   |   |   ├── fill.py
|   |   |   ├── fill_between_alpha.py
|   |   |   ├── fill_between_demo.py
|   |   |   ├── fill_betweenx_demo.py
|   |   |   ├── filled_step.py
|   |   |   ├── gradient_bar.py
|   |   |   ├── hat_graph.py
|   |   |   ├── horizontal_barchart_distribution.py
|   |   |   ├── joinstyle.py
|   |   |   ├── line_demo_dash_control.py
|   |   |   ├── lines_with_ticks_demo.py
|   |   |   ├── linestyles.py
|   |   |   ├── marker_reference.py
|   |   |   ├── markevery_demo.py
|   |   |   ├── masked_demo.py
|   |   |   ├── multicolored_line.py
|   |   |   ├── multivariate_marker_plot.py
|   |   |   ├── psd_demo.py
|   |   |   ├── scatter_custom_symbol.py
|   |   |   ├── scatter_demo2.py
|   |   |   ├── scatter_hist.py
|   |   |   ├── scatter_masked.py
|   |   |   ├── scatter_star_poly.py
|   |   |   ├── scatter_with_legend.py
|   |   |   ├── simple_plot.py
|   |   |   ├── span_regions.py
|   |   |   ├── spectrum_demo.py
|   |   |   ├── stackplot_demo.py
|   |   |   ├── stairs_demo.py
|   |   |   ├── stem_plot.py
|   |   |   ├── step_demo.py
|   |   |   ├── timeline.py
|   |   |   ├── vline_hline_demo.py
|   |   |   └── xcorr_acorr_demo.py
|   |   ├── misc
|   |   |   ├── README.txt
|   |   |   ├── anchored_artists.py
|   |   |   ├── bbox_intersect.py
|   |   |   ├── contour_manual.py
|   |   |   ├── coords_report.py
|   |   |   ├── custom_projection.py
|   |   |   ├── customize_rc.py
|   |   |   ├── demo_agg_filter.py
|   |   |   ├── demo_ribbon_box.py
|   |   |   ├── fig_x.py
|   |   |   ├── fill_spiral.py
|   |   |   ├── findobj_demo.py
|   |   |   ├── font_indexing.py
|   |   |   ├── ftface_props.py
|   |   |   ├── histogram_path.py
|   |   |   ├── hyperlinks_sgskip.py
|   |   |   ├── image_thumbnail_sgskip.py
|   |   |   ├── keyword_plotting.py
|   |   |   ├── logos2.py
|   |   |   ├── multipage_pdf.py
|   |   |   ├── multiprocess_sgskip.py
|   |   |   ├── packed_bubbles.py
|   |   |   ├── patheffect_demo.py
|   |   |   ├── print_stdout_sgskip.py
|   |   |   ├── rasterization_demo.py
|   |   |   ├── set_and_get.py
|   |   |   ├── svg_filter_line.py
|   |   |   ├── svg_filter_pie.py
|   |   |   ├── table_demo.py
|   |   |   ├── tickedstroke_demo.py
|   |   |   ├── transoffset.py
|   |   |   └── zorder_demo.py
|   |   ├── mplot3d
|   |   |   ├── 2dcollections3d.py
|   |   |   ├── 3d_bars.py
|   |   |   ├── README.txt
|   |   |   ├── bars3d.py
|   |   |   ├── box3d.py
|   |   |   ├── contour3d.py
|   |   |   ├── contour3d_2.py
|   |   |   ├── contour3d_3.py
|   |   |   ├── contourf3d.py
|   |   |   ├── contourf3d_2.py
|   |   |   ├── custom_shaded_3d_surface.py
|   |   |   ├── errorbar3d.py
|   |   |   ├── hist3d.py
|   |   |   ├── lines3d.py
|   |   |   ├── lorenz_attractor.py
|   |   |   ├── mixed_subplots.py
|   |   |   ├── offset.py
|   |   |   ├── pathpatch3d.py
|   |   |   ├── polys3d.py
|   |   |   ├── projections.py
|   |   |   ├── quiver3d.py
|   |   |   ├── rotate_axes3d_sgskip.py
|   |   |   ├── scatter3d.py
|   |   |   ├── stem3d_demo.py
|   |   |   ├── subplot3d.py
|   |   |   ├── surface3d.py
|   |   |   ├── surface3d_2.py
|   |   |   ├── surface3d_3.py
|   |   |   ├── surface3d_radial.py
|   |   |   ├── text3d.py
|   |   |   ├── tricontour3d.py
|   |   |   ├── tricontourf3d.py
|   |   |   ├── trisurf3d.py
|   |   |   ├── trisurf3d_2.py
|   |   |   ├── view_planes_3d.py
|   |   |   ├── voxels.py
|   |   |   ├── voxels_numpy_logo.py
|   |   |   ├── voxels_rgb.py
|   |   |   ├── voxels_torus.py
|   |   |   ├── wire3d.py
|   |   |   ├── wire3d_animation_sgskip.py
|   |   |   └── wire3d_zero_stride.py
|   |   ├── pie_and_polar_charts
|   |   |   ├── README.txt
|   |   |   ├── bar_of_pie.py
|   |   |   ├── nested_pie.py
|   |   |   ├── pie_and_donut_labels.py
|   |   |   ├── pie_demo2.py
|   |   |   ├── pie_features.py
|   |   |   ├── polar_bar.py
|   |   |   ├── polar_demo.py
|   |   |   ├── polar_error_caps.py
|   |   |   ├── polar_legend.py
|   |   |   └── polar_scatter.py
|   |   ├── pyplots
|   |   |   ├── README.txt
|   |   |   ├── axline.py
|   |   |   ├── pyplot_simple.py
|   |   |   ├── pyplot_text.py
|   |   |   ├── pyplot_three.py
|   |   |   └── pyplot_two_subplots.py
|   |   ├── scales
|   |   |   ├── README.txt
|   |   |   ├── asinh_demo.py
|   |   |   ├── aspect_loglog.py
|   |   |   ├── custom_scale.py
|   |   |   ├── log_bar.py
|   |   |   ├── log_demo.py
|   |   |   ├── logit_demo.py
|   |   |   ├── power_norm.py
|   |   |   ├── scales.py
|   |   |   ├── semilogx_demo.py
|   |   |   └── symlog_demo.py
|   |   ├── shapes_and_collections
|   |   |   ├── README.txt
|   |   |   ├── arrow_guide.py
|   |   |   ├── artist_reference.py
|   |   |   ├── collections.py
|   |   |   ├── compound_path.py
|   |   |   ├── dolphin.py
|   |   |   ├── donut.py
|   |   |   ├── ellipse_collection.py
|   |   |   ├── ellipse_demo.py
|   |   |   ├── fancybox_demo.py
|   |   |   ├── hatch_demo.py
|   |   |   ├── hatch_style_reference.py
|   |   |   ├── line_collection.py
|   |   |   ├── patch_collection.py
|   |   |   ├── path_patch.py
|   |   |   ├── quad_bezier.py
|   |   |   └── scatter.py
|   |   ├── showcase
|   |   |   ├── README.txt
|   |   |   ├── anatomy.py
|   |   |   ├── firefox.py
|   |   |   ├── integral.py
|   |   |   ├── mandelbrot.py
|   |   |   ├── stock_prices.py
|   |   |   └── xkcd.py
|   |   ├── specialty_plots
|   |   |   ├── README.txt
|   |   |   ├── advanced_hillshading.py
|   |   |   ├── anscombe.py
|   |   |   ├── hinton_demo.py
|   |   |   ├── leftventricle_bullseye.py
|   |   |   ├── mri_demo.py
|   |   |   ├── mri_with_eeg.py
|   |   |   ├── radar_chart.py
|   |   |   ├── sankey_basics.py
|   |   |   ├── sankey_links.py
|   |   |   ├── sankey_rankine.py
|   |   |   ├── skewt.py
|   |   |   └── topographic_hillshading.py
|   |   ├── spines
|   |   |   ├── README.txt
|   |   |   ├── centered_spines_with_arrows.py
|   |   |   ├── multiple_yaxis_with_spines.py
|   |   |   ├── spine_placement_demo.py
|   |   |   ├── spines.py
|   |   |   └── spines_dropped.py
|   |   ├── statistics
|   |   |   ├── README.txt
|   |   |   ├── barchart_demo.py
|   |   |   ├── boxplot.py
|   |   |   ├── boxplot_color.py
|   |   |   ├── boxplot_demo.py
|   |   |   ├── boxplot_vs_violin.py
|   |   |   ├── bxp.py
|   |   |   ├── confidence_ellipse.py
|   |   |   ├── customized_violin.py
|   |   |   ├── errorbar.py
|   |   |   ├── errorbar_features.py
|   |   |   ├── errorbar_limits.py
|   |   |   ├── errorbars_and_boxes.py
|   |   |   ├── hexbin_demo.py
|   |   |   ├── hist.py
|   |   |   ├── histogram_cumulative.py
|   |   |   ├── histogram_features.py
|   |   |   ├── histogram_histtypes.py
|   |   |   ├── histogram_multihist.py
|   |   |   ├── multiple_histograms_side_by_side.py
|   |   |   ├── time_series_histogram.py
|   |   |   └── violinplot.py
|   |   ├── style_sheets
|   |   |   ├── README.txt
|   |   |   ├── bmh.py
|   |   |   ├── dark_background.py
|   |   |   ├── fivethirtyeight.py
|   |   |   ├── ggplot.py
|   |   |   ├── grayscale.py
|   |   |   ├── plot_solarizedlight2.py
|   |   |   └── style_sheets_reference.py
|   |   ├── subplots_axes_and_figures
|   |   |   ├── README.txt
|   |   |   ├── align_labels_demo.py
|   |   |   ├── auto_subplots_adjust.py
|   |   |   ├── axes_box_aspect.py
|   |   |   ├── axes_demo.py
|   |   |   ├── axes_margins.py
|   |   |   ├── axes_props.py
|   |   |   ├── axes_zoom_effect.py
|   |   |   ├── axhspan_demo.py
|   |   |   ├── axis_equal_demo.py
|   |   |   ├── axis_labels_demo.py
|   |   |   ├── broken_axis.py
|   |   |   ├── colorbar_placement.py
|   |   |   ├── custom_figure_class.py
|   |   |   ├── demo_constrained_layout.py
|   |   |   ├── demo_tight_layout.py
|   |   |   ├── fahrenheit_celsius_scales.py
|   |   |   ├── figure_size_units.py
|   |   |   ├── figure_title.py
|   |   |   ├── ganged_plots.py
|   |   |   ├── geo_demo.py
|   |   |   ├── gridspec_and_subplots.py
|   |   |   ├── gridspec_multicolumn.py
|   |   |   ├── gridspec_nested.py
|   |   |   ├── invert_axes.py
|   |   |   ├── mosaic.py
|   |   |   ├── multiple_figs_demo.py
|   |   |   ├── secondary_axis.py
|   |   |   ├── share_axis_lims_views.py
|   |   |   ├── shared_axis_demo.py
|   |   |   ├── subfigures.py
|   |   |   ├── subplot.py
|   |   |   ├── subplots_adjust.py
|   |   |   ├── subplots_demo.py
|   |   |   ├── two_scales.py
|   |   |   └── zoom_inset_axes.py
|   |   ├── text_labels_and_annotations
|   |   |   ├── README.txt
|   |   |   ├── accented_text.py
|   |   |   ├── align_ylabels.py
|   |   |   ├── angle_annotation.py
|   |   |   ├── angles_on_bracket_arrows.py
|   |   |   ├── annotate_transform.py
|   |   |   ├── annotation_basic.py
|   |   |   ├── annotation_demo.py
|   |   |   ├── annotation_polar.py
|   |   |   ├── arrow_demo.py
|   |   |   ├── autowrap.py
|   |   |   ├── custom_legends.py
|   |   |   ├── date.py
|   |   |   ├── demo_annotation_box.py
|   |   |   ├── demo_text_path.py
|   |   |   ├── demo_text_rotation_mode.py
|   |   |   ├── dfrac_demo.py
|   |   |   ├── engineering_formatter.py
|   |   |   ├── fancyarrow_demo.py
|   |   |   ├── fancytextbox_demo.py
|   |   |   ├── figlegend_demo.py
|   |   |   ├── font_family_rc.py
|   |   |   ├── font_file.py
|   |   |   ├── font_table.py
|   |   |   ├── fonts_demo.py
|   |   |   ├── fonts_demo_kw.py
|   |   |   ├── label_subplots.py
|   |   |   ├── legend.py
|   |   |   ├── legend_demo.py
|   |   |   ├── line_with_text.py
|   |   |   ├── mathtext_asarray.py
|   |   |   ├── mathtext_demo.py
|   |   |   ├── mathtext_examples.py
|   |   |   ├── mathtext_fontfamily_example.py
|   |   |   ├── multiline.py
|   |   |   ├── placing_text_boxes.py
|   |   |   ├── rainbow_text.py
|   |   |   ├── stix_fonts_demo.py
|   |   |   ├── tex_demo.py
|   |   |   ├── text_alignment.py
|   |   |   ├── text_commands.py
|   |   |   ├── text_fontdict.py
|   |   |   ├── text_rotation_relative_to_line.py
|   |   |   ├── titles_demo.py
|   |   |   ├── unicode_minus.py
|   |   |   ├── usetex_baseline_test.py
|   |   |   ├── usetex_fonteffects.py
|   |   |   └── watermark_text.py
|   |   ├── ticks
|   |   |   ├── README.txt
|   |   |   ├── auto_ticks.py
|   |   |   ├── centered_ticklabels.py
|   |   |   ├── colorbar_tick_labelling_demo.py
|   |   |   ├── custom_ticker1.py
|   |   |   ├── date_concise_formatter.py
|   |   |   ├── date_demo_convert.py
|   |   |   ├── date_demo_rrule.py
|   |   |   ├── date_formatters_locators.py
|   |   |   ├── date_index_formatter.py
|   |   |   ├── date_precision_and_epochs.py
|   |   |   ├── dollar_ticks.py
|   |   |   ├── fig_axes_customize_simple.py
|   |   |   ├── major_minor_demo.py
|   |   |   ├── scalarformatter.py
|   |   |   ├── tick-formatters.py
|   |   |   ├── tick-locators.py
|   |   |   ├── tick_label_right.py
|   |   |   ├── tick_labels_from_values.py
|   |   |   ├── tick_xlabel_top.py
|   |   |   ├── ticklabels_rotation.py
|   |   |   └── ticks_too_many.py
|   |   ├── units
|   |   |   ├── README.txt
|   |   |   ├── annotate_with_units.py
|   |   |   ├── artist_tests.py
|   |   |   ├── bar_demo2.py
|   |   |   ├── bar_unit_demo.py
|   |   |   ├── basic_units.py
|   |   |   ├── ellipse_with_units.py
|   |   |   ├── evans_test.py
|   |   |   ├── radian_demo.py
|   |   |   ├── units_sample.py
|   |   |   └── units_scatter.py
|   |   ├── user_interfaces
|   |   |   ├── README.txt
|   |   |   ├── canvasagg.py
|   |   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk3_sgskip.py
|   |   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk4_sgskip.py
|   |   |   ├── embedding_in_qt_sgskip.py
|   |   |   ├── embedding_in_tk_sgskip.py
|   |   |   ├── embedding_in_wx2_sgskip.py
|   |   |   ├── embedding_in_wx3_sgskip.py
|   |   |   ├── embedding_in_wx4_sgskip.py
|   |   |   ├── embedding_in_wx5_sgskip.py
|   |   |   ├── embedding_webagg_sgskip.py
|   |   |   ├── fourier_demo_wx_sgskip.py
|   |   |   ├── gtk3_spreadsheet_sgskip.py
|   |   |   ├── gtk4_spreadsheet_sgskip.py
|   |   |   ├── images
|   |   |   ├── mathtext_wx_sgskip.py
|   |   |   ├── mpl_with_glade3_sgskip.py
|   |   |   ├── mplcvd.py
|   |   |   ├── pylab_with_gtk3_sgskip.py
|   |   |   ├── pylab_with_gtk4_sgskip.py
|   |   |   ├── svg_histogram_sgskip.py
|   |   |   ├── svg_tooltip_sgskip.py
|   |   |   ├── toolmanager_sgskip.py
|   |   |   ├── web_application_server_sgskip.py
|   |   |   └── wxcursor_demo_sgskip.py
|   |   ├── userdemo
|   |   |   ├── README.txt
|   |   |   ├── annotate_explain.py
|   |   |   ├── annotate_simple_coord02.py
|   |   |   ├── annotate_text_arrow.py
|   |   |   ├── connect_simple01.py
|   |   |   ├── connectionstyle_demo.py
|   |   |   ├── custom_boxstyle01.py
|   |   |   ├── demo_gridspec01.py
|   |   |   ├── demo_gridspec03.py
|   |   |   ├── demo_gridspec06.py
|   |   |   ├── pgf_fonts.py
|   |   |   ├── pgf_preamble_sgskip.py
|   |   |   ├── pgf_texsystem.py
|   |   |   ├── simple_annotate01.py
|   |   |   ├── simple_legend01.py
|   |   |   └── simple_legend02.py
|   |   └── widgets
|   |       ├── README.txt
|   |       ├── annotated_cursor.py
|   |       ├── buttons.py
|   |       ├── check_buttons.py
|   |       ├── cursor.py
|   |       ├── lasso_selector_demo_sgskip.py
|   |       ├── menu.py
|   |       ├── mouse_cursor.py
|   |       ├── multicursor.py
|   |       ├── polygon_selector_demo.py
|   |       ├── polygon_selector_simple.py
|   |       ├── radio_buttons.py
|   |       ├── range_slider.py
|   |       ├── rectangle_selector.py
|   |       ├── slider_demo.py
|   |       ├── slider_snap_demo.py
|   |       ├── span_selector.py
|   |       └── textbox.py
|   ├── plot_types
|   |   ├── 3D
|   |   |   ├── README.rst
|   |   |   ├── scatter3d_simple.py
|   |   |   ├── surface3d_simple.py
|   |   |   ├── trisurf3d_simple.py
|   |   |   ├── voxels_simple.py
|   |   |   └── wire3d_simple.py
|   |   ├── README.rst
|   |   ├── arrays
|   |   |   ├── README.rst
|   |   |   ├── barbs.py
|   |   |   ├── contour.py
|   |   |   ├── contourf.py
|   |   |   ├── imshow.py
|   |   |   ├── pcolormesh.py
|   |   |   ├── quiver.py
|   |   |   └── streamplot.py
|   |   ├── basic
|   |   |   ├── README.rst
|   |   |   ├── bar.py
|   |   |   ├── fill_between.py
|   |   |   ├── plot.py
|   |   |   ├── scatter_plot.py
|   |   |   ├── stackplot.py
|   |   |   ├── stem.py
|   |   |   └── step.py
|   |   ├── stats
|   |   |   ├── README.rst
|   |   |   ├── boxplot_plot.py
|   |   |   ├── errorbar_plot.py
|   |   |   ├── eventplot.py
|   |   |   ├── hexbin.py
|   |   |   ├── hist2d.py
|   |   |   ├── hist_plot.py
|   |   |   ├── pie.py
|   |   |   └── violin.py
|   |   └── unstructured
|   |       ├── README.rst
|   |       ├── tricontour.py
|   |       ├── tricontourf.py
|   |       ├── tripcolor.py
|   |       └── triplot.py
|   └── tutorials
|       ├── README.txt
|       ├── advanced
|       |   ├── README.txt
|       |   ├── blitting.py
|       |   ├── path_tutorial.py
|       |   ├── patheffects_guide.py
|       |   └── transforms_tutorial.py
|       ├── colors
|       |   ├── README.txt
|       |   ├── colorbar_only.py
|       |   ├── colormap-manipulation.py
|       |   ├── colormapnorms.py
|       |   ├── colormaps.py
|       |   └── colors.py
|       ├── intermediate
|       |   ├── README.txt
|       |   ├── arranging_axes.py
|       |   ├── artists.py
|       |   ├── autoscale.py
|       |   ├── color_cycle.py
|       |   ├── constrainedlayout_guide.py
|       |   ├── imshow_extent.py
|       |   ├── legend_guide.py
|       |   └── tight_layout_guide.py
|       ├── introductory
|       |   ├── README.txt
|       |   ├── animation_tutorial.py
|       |   ├── customizing.py
|       |   ├── images.py
|       |   ├── lifecycle.py
|       |   ├── pyplot.py
|       |   └── quick_start.py
|       ├── provisional
|       |   └── README.txt
|       ├── text
|       |   ├── README.txt
|       |   ├── annotations.py
|       |   ├── mathtext.py
|       |   ├── pgf.py
|       |   ├── text_intro.py
|       |   ├── text_props.py
|       |   └── usetex.py
|       └── toolkits
|           ├── README.txt
|           ├── axes_grid.py
|           ├── axisartist.py
|           └── mplot3d.py
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
└── tools
    ├── README.txt
    ├── boilerplate.py
    ├── cache_zenodo_svg.py
    ├── create_DejaVuDisplay.sh
    ├── embed_js.py
    ├── gh_api.py
    ├── github_stats.py
    ├── make_icons.py
    ├── memleak.py
    ├── run_examples.py
    ├── subset.py
    ├── triage_tests.py
    └── visualize_tests.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Unable to pickle figure with draggable legend

Description: ### Bug summary

I am unable to pickle figure with draggable legend. Same error comes for draggable annotations.





### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax = fig.add_subplot(111)

time=[0,1,2,3,4]
speed=[40,43,45,47,48]

ax.plot(time,speed,label="speed")

leg=ax.legend()
leg.set_draggable(True) #pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome

`TypeError: cannot pickle 'FigureCanvasQTAgg' object`

### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows 10

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

3.10

### Jupyter version

_No response_

### Installation

pip

Patch information:
diff --git a/lib/matplotlib/legend.py b/lib/matplotlib/legend.py
index ff6abdb958..b3bb2e7c91 100644
--- a/lib/matplotlib/legend.py
+++ b/lib/matplotlib/legend.py
@@ -1208,6 +1208,12 @@ class Legend(Artist):
         """Return ``True`` if the legend is draggable, ``False`` otherwise."""
         return self._draggable is not None
 
+    def __getstate__(self):
+        d = super().__getstate__()
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas.
+        d['_draggable'] = None
+        return d
+
 
 # Helper functions to parse legend arguments for both `figure.legend` and
 # `axes.legend`:
diff --git a/lib/matplotlib/text.py b/lib/matplotlib/text.py
index 0f874ba33d..ee28309f8b 100644
--- a/lib/matplotlib/text.py
+++ b/lib/matplotlib/text.py
@@ -236,6 +236,10 @@ class Text(Artist):
         d = super().__getstate__()
         # remove the cached _renderer (if it exists)
         d['_renderer'] = None
+        # Drop draggable helper to avoid pickling the (unpicklable) canvas via
+        # DraggableAnnotation.
+        if '_draggable' in d:
+            d['_draggable'] = None
         return d
 
     def contains(self, mouseevent):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `lib/matplotlib/tests/test_pickle.py`.
Extra Requirements: 
Purpose: I need to examine the existing tests for pickling matplotlib objects to find 3 relevant examples for the user's bug report.

Previous refined query 2:
Essential Query: Please provide the full content of the file `lib/matplotlib/tests/test_text.py`.
Extra Requirements: 
Purpose: To find test cases related to pickling `Text` or `Annotation` objects, which are directly related to the bug concerning draggable annotations.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_pickle.py
Line number range: 1 - 284
Content:
1. from io import BytesIO
2. import ast
3. import pickle
4. 
5. import numpy as np
6. import pytest
7. 
8. import matplotlib as mpl
9. from matplotlib import cm
10. from matplotlib.testing import subprocess_run_helper
11. from matplotlib.testing.decorators import check_figures_equal
12. from matplotlib.dates import rrulewrapper
13. from matplotlib.lines import VertexSelector
14. import matplotlib.pyplot as plt
15. import matplotlib.transforms as mtransforms
16. import matplotlib.figure as mfigure
17. from mpl_toolkits.axes_grid1 import parasite_axes
18. 
19. 
20. def test_simple():
21.     fig = plt.figure()
22.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
23. 
24.     ax = plt.subplot(121)
25.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
26. 
27.     ax = plt.axes(projection='polar')
28.     plt.plot(np.arange(10), label='foobar')
29.     plt.legend()
30. 
31.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
32. 
33. #    ax = plt.subplot(121, projection='hammer')
34. #    pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
35. 
36.     plt.figure()
37.     plt.bar(x=np.arange(10), height=np.arange(10))
38.     pickle.dump(plt.gca(), BytesIO(), pickle.HIGHEST_PROTOCOL)
39. 
40.     fig = plt.figure()
41.     ax = plt.axes()
42.     plt.plot(np.arange(10))
43.     ax.set_yscale('log')
44.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
45. 
46. 
47. def _generate_complete_test_figure(fig_ref):
48.     fig_ref.set_size_inches((10, 6))
49.     plt.figure(fig_ref)
50. 
51.     plt.suptitle('Can you fit any more in a figure?')
52. 
53.     # make some arbitrary data
54.     x, y = np.arange(8), np.arange(10)
55.     data = u = v = np.linspace(0, 10, 80).reshape(10, 8)
56.     v = np.sin(v * -0.6)
57. 
58.     # Ensure lists also pickle correctly.
59.     plt.subplot(3, 3, 1)
60.     plt.plot(list(range(10)))
61. 
62.     plt.subplot(3, 3, 2)
63.     plt.contourf(data, hatches=['//', 'ooo'])
64.     plt.colorbar()
65. 
66.     plt.subplot(3, 3, 3)
67.     plt.pcolormesh(data)
68. 
69.     plt.subplot(3, 3, 4)
70.     plt.imshow(data)
71. 
72.     plt.subplot(3, 3, 5)
73.     plt.pcolor(data)
74. 
75.     ax = plt.subplot(3, 3, 6)
76.     ax.set_xlim(0, 7)
77.     ax.set_ylim(0, 9)
78.     plt.streamplot(x, y, u, v)
79. 
80.     ax = plt.subplot(3, 3, 7)
81.     ax.set_xlim(0, 7)
82.     ax.set_ylim(0, 9)
83.     plt.quiver(x, y, u, v)
84. 
85.     plt.subplot(3, 3, 8)
86.     plt.scatter(x, x ** 2, label='$x^2$')
87.     plt.legend(loc='upper left')
88. 
89.     plt.subplot(3, 3, 9)
90.     plt.errorbar(x, x * -0.5, xerr=0.2, yerr=0.4)
91. 
92. 
93. @mpl.style.context("default")
94. @check_figures_equal(extensions=["png"])
95. def test_complete(fig_test, fig_ref):
96.     _generate_complete_test_figure(fig_ref)
97.     # plotting is done, now test its pickle-ability
98.     pkl = BytesIO()
99.     pickle.dump(fig_ref, pkl, pickle.HIGHEST_PROTOCOL)
100.     loaded = pickle.loads(pkl.getbuffer())
101.     loaded.canvas.draw()
102. 
103.     fig_test.set_size_inches(loaded.get_size_inches())
104.     fig_test.figimage(loaded.canvas.renderer.buffer_rgba())
105. 
106.     plt.close(loaded)
107. 
108. 
109. def _pickle_load_subprocess():
110.     import os
111.     import pickle
112. 
113.     path = os.environ['PICKLE_FILE_PATH']
114. 
115.     with open(path, 'rb') as blob:
116.         fig = pickle.load(blob)
117. 
118.     print(str(pickle.dumps(fig)))
119. 
120. 
121. @mpl.style.context("default")
122. @check_figures_equal(extensions=['png'])
123. def test_pickle_load_from_subprocess(fig_test, fig_ref, tmp_path):
124.     _generate_complete_test_figure(fig_ref)
125. 
126.     fp = tmp_path / 'sinus.pickle'
127.     assert not fp.exists()
128. 
129.     with fp.open('wb') as file:
130.         pickle.dump(fig_ref, file, pickle.HIGHEST_PROTOCOL)
131.     assert fp.exists()
132. 
133.     proc = subprocess_run_helper(
134.         _pickle_load_subprocess,
135.         timeout=60,
136.         extra_env={'PICKLE_FILE_PATH': str(fp)}
137.     )
138. 
139.     loaded_fig = pickle.loads(ast.literal_eval(proc.stdout))
140. 
141.     loaded_fig.canvas.draw()
142. 
143.     fig_test.set_size_inches(loaded_fig.get_size_inches())
144.     fig_test.figimage(loaded_fig.canvas.renderer.buffer_rgba())
145. 
146.     plt.close(loaded_fig)
147. 
148. 
149. def test_gcf():
150.     fig = plt.figure("a label")
151.     buf = BytesIO()
152.     pickle.dump(fig, buf, pickle.HIGHEST_PROTOCOL)
153.     plt.close("all")
154.     assert plt._pylab_helpers.Gcf.figs == {}  # No figures must be left.
155.     fig = pickle.loads(buf.getbuffer())
156.     assert plt._pylab_helpers.Gcf.figs != {}  # A manager is there again.
157.     assert fig.get_label() == "a label"
158. 
159. 
160. def test_no_pyplot():
161.     # tests pickle-ability of a figure not created with pyplot
162.     from matplotlib.backends.backend_pdf import FigureCanvasPdf
163.     fig = mfigure.Figure()
164.     _ = FigureCanvasPdf(fig)
165.     ax = fig.add_subplot(1, 1, 1)
166.     ax.plot([1, 2, 3], [1, 2, 3])
167.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
168. 
169. 
170. def test_renderer():
171.     from matplotlib.backends.backend_agg import RendererAgg
172.     renderer = RendererAgg(10, 20, 30)
173.     pickle.dump(renderer, BytesIO())
174. 
175. 
176. def test_image():
177.     # Prior to v1.4.0 the Image would cache data which was not picklable
178.     # once it had been drawn.
179.     from matplotlib.backends.backend_agg import new_figure_manager
180.     manager = new_figure_manager(1000)
181.     fig = manager.canvas.figure
182.     ax = fig.add_subplot(1, 1, 1)
183.     ax.imshow(np.arange(12).reshape(3, 4))
184.     manager.canvas.draw()
185.     pickle.dump(fig, BytesIO())
186. 
187. 
188. def test_polar():
189.     plt.subplot(polar=True)
190.     fig = plt.gcf()
191.     pf = pickle.dumps(fig)
192.     pickle.loads(pf)
193.     plt.draw()
194. 
195. 
196. class TransformBlob:
197.     def __init__(self):
198.         self.identity = mtransforms.IdentityTransform()
199.         self.identity2 = mtransforms.IdentityTransform()
200.         # Force use of the more complex composition.
201.         self.composite = mtransforms.CompositeGenericTransform(
202.             self.identity,
203.             self.identity2)
204.         # Check parent -> child links of TransformWrapper.
205.         self.wrapper = mtransforms.TransformWrapper(self.composite)
206.         # Check child -> parent links of TransformWrapper.
207.         self.composite2 = mtransforms.CompositeGenericTransform(
208.             self.wrapper,
209.             self.identity)
210. 
211. 
212. def test_transform():
213.     obj = TransformBlob()
214.     pf = pickle.dumps(obj)
215.     del obj
216. 
217.     obj = pickle.loads(pf)
218.     # Check parent -> child links of TransformWrapper.
219.     assert obj.wrapper._child == obj.composite
220.     # Check child -> parent links of TransformWrapper.
221.     assert [v() for v in obj.wrapper._parents.values()] == [obj.composite2]
222.     # Check input and output dimensions are set as expected.
223.     assert obj.wrapper.input_dims == obj.composite.input_dims
224.     assert obj.wrapper.output_dims == obj.composite.output_dims
225. 
226. 
227. def test_rrulewrapper():
228.     r = rrulewrapper(2)
229.     try:
230.         pickle.loads(pickle.dumps(r))
231.     except RecursionError:
232.         print('rrulewrapper pickling test failed')
233.         raise
234. 
235. 
236. def test_shared():
237.     fig, axs = plt.subplots(2, sharex=True)
238.     fig = pickle.loads(pickle.dumps(fig))
239.     fig.axes[0].set_xlim(10, 20)
240.     assert fig.axes[1].get_xlim() == (10, 20)
241. 
242. 
243. def test_inset_and_secondary():
244.     fig, ax = plt.subplots()
245.     ax.inset_axes([.1, .1, .3, .3])
246.     ax.secondary_xaxis("top", functions=(np.square, np.sqrt))
247.     pickle.loads(pickle.dumps(fig))
248. 
249. 
250. @pytest.mark.parametrize("cmap", cm._colormaps.values())
251. def test_cmap(cmap):
252.     pickle.dumps(cmap)
253. 
254. 
255. def test_unpickle_canvas():
256.     fig = mfigure.Figure()
257.     assert fig.canvas is not None
258.     out = BytesIO()
259.     pickle.dump(fig, out)
260.     out.seek(0)
261.     fig2 = pickle.load(out)
262.     assert fig2.canvas is not None
263. 
264. 
265. def test_mpl_toolkits():
266.     ax = parasite_axes.host_axes([0, 0, 1, 1])
267.     assert type(pickle.loads(pickle.dumps(ax))) == parasite_axes.HostAxes
268. 
269. 
270. def test_standard_norm():
271.     assert type(pickle.loads(pickle.dumps(mpl.colors.LogNorm()))) \
272.         == mpl.colors.LogNorm
273. 
274. 
275. def test_dynamic_norm():
276.     logit_norm_instance = mpl.colors.make_norm_from_scale(
277.         mpl.scale.LogitScale, mpl.colors.Normalize)()
278.     assert type(pickle.loads(pickle.dumps(logit_norm_instance))) \
279.         == type(logit_norm_instance)
280. 
281. 
282. def test_vertexselector():
283.     line, = plt.plot([0, 1], picker=True)
284.     pickle.loads(pickle.dumps(VertexSelector(line)))


File: lib/matplotlib/tests/test_text.py
Line number range: 1 - 857
Content:
1. from datetime import datetime
2. import io
3. import warnings
4. 
5. import numpy as np
6. from numpy.testing import assert_almost_equal
7. import pytest
8. 
9. import matplotlib as mpl
10. from matplotlib.backend_bases import MouseEvent
11. from matplotlib.font_manager import FontProperties
12. import matplotlib.patches as mpatches
13. import matplotlib.pyplot as plt
14. import matplotlib.transforms as mtransforms
15. from matplotlib.testing.decorators import check_figures_equal, image_comparison
16. from matplotlib.testing._markers import needs_usetex
17. from matplotlib.text import Text
18. 
19. 
20. @image_comparison(['font_styles'])
21. def test_font_styles():
22. 
23.     def find_matplotlib_font(**kw):
24.         prop = FontProperties(**kw)
25.         path = findfont(prop, directory=mpl.get_data_path())
26.         return FontProperties(fname=path)
27. 
28.     from matplotlib.font_manager import FontProperties, findfont
29.     warnings.filterwarnings(
30.         'ignore',
31.         r"findfont: Font family \[u?'Foo'\] not found. Falling back to .",
32.         UserWarning,
33.         module='matplotlib.font_manager')
34. 
35.     fig, ax = plt.subplots()
36. 
37.     normal_font = find_matplotlib_font(
38.         family="sans-serif",
39.         style="normal",
40.         variant="normal",
41.         size=14)
42.     a = ax.annotate(
43.         "Normal Font",
44.         (0.1, 0.1),
45.         xycoords='axes fraction',
46.         fontproperties=normal_font)
47.     assert a.get_fontname() == 'DejaVu Sans'
48.     assert a.get_fontstyle() == 'normal'
49.     assert a.get_fontvariant() == 'normal'
50.     assert a.get_weight() == 'normal'
51.     assert a.get_stretch() == 'normal'
52. 
53.     bold_font = find_matplotlib_font(
54.         family="Foo",
55.         style="normal",
56.         variant="normal",
57.         weight="bold",
58.         stretch=500,
59.         size=14)
60.     ax.annotate(
61.         "Bold Font",
62.         (0.1, 0.2),
63.         xycoords='axes fraction',
64.         fontproperties=bold_font)
65. 
66.     bold_italic_font = find_matplotlib_font(
67.         family="sans serif",
68.         style="italic",
69.         variant="normal",
70.         weight=750,
71.         stretch=500,
72.         size=14)
73.     ax.annotate(
74.         "Bold Italic Font",
75.         (0.1, 0.3),
76.         xycoords='axes fraction',
77.         fontproperties=bold_italic_font)
78. 
79.     light_font = find_matplotlib_font(
80.         family="sans-serif",
81.         style="normal",
82.         variant="normal",
83.         weight=200,
84.         stretch=500,
85.         size=14)
86.     ax.annotate(
87.         "Light Font",
88.         (0.1, 0.4),
89.         xycoords='axes fraction',
90.         fontproperties=light_font)
91. 
92.     condensed_font = find_matplotlib_font(
93.         family="sans-serif",
94.         style="normal",
95.         variant="normal",
96.         weight=500,
97.         stretch=100,
98.         size=14)
99.     ax.annotate(
100.         "Condensed Font",
101.         (0.1, 0.5),
102.         xycoords='axes fraction',
103.         fontproperties=condensed_font)
104. 
105.     ax.set_xticks([])
106.     ax.set_yticks([])
107. 
108. 
109. @image_comparison(['multiline'])
110. def test_multiline():
111.     plt.figure()
112.     ax = plt.subplot(1, 1, 1)
113.     ax.set_title("multiline\ntext alignment")
114. 
115.     plt.text(
116.         0.2, 0.5, "TpTpTp\n$M$\nTpTpTp", size=20, ha="center", va="top")
117. 
118.     plt.text(
119.         0.5, 0.5, "TpTpTp\n$M^{M^{M^{M}}}$\nTpTpTp", size=20,
120.         ha="center", va="top")
121. 
122.     plt.text(
123.         0.8, 0.5, "TpTpTp\n$M_{q_{q_{q}}}$\nTpTpTp", size=20,
124.         ha="center", va="top")
125. 
126.     plt.xlim(0, 1)
127.     plt.ylim(0, 0.8)
128. 
129.     ax.set_xticks([])
130.     ax.set_yticks([])
131. 
132. 
133. @image_comparison(['multiline2'], style='mpl20')
134. def test_multiline2():
135.     # Remove this line when this test image is regenerated.
136.     plt.rcParams['text.kerning_factor'] = 6
137. 
138.     fig, ax = plt.subplots()
139. 
140.     ax.set_xlim([0, 1.4])
141.     ax.set_ylim([0, 2])
142.     ax.axhline(0.5, color='C2', linewidth=0.3)
143.     sts = ['Line', '2 Lineg\n 2 Lg', '$\\sum_i x $', 'hi $\\sum_i x $\ntest',
144.            'test\n $\\sum_i x $', '$\\sum_i x $\n $\\sum_i x $']
145.     renderer = fig.canvas.get_renderer()
146. 
147.     def draw_box(ax, tt):
148.         r = mpatches.Rectangle((0, 0), 1, 1, clip_on=False,
149.                                transform=ax.transAxes)
150.         r.set_bounds(
151.             tt.get_window_extent(renderer)
152.             .transformed(ax.transAxes.inverted())
153.             .bounds)
154.         ax.add_patch(r)
155. 
156.     horal = 'left'
157.     for nn, st in enumerate(sts):
158.         tt = ax.text(0.2 * nn + 0.1, 0.5, st, horizontalalignment=horal,
159.                      verticalalignment='bottom')
160.         draw_box(ax, tt)
161.     ax.text(1.2, 0.5, 'Bottom align', color='C2')
162. 
163.     ax.axhline(1.3, color='C2', linewidth=0.3)
164.     for nn, st in enumerate(sts):
165.         tt = ax.text(0.2 * nn + 0.1, 1.3, st, horizontalalignment=horal,
166.                      verticalalignment='top')
167.         draw_box(ax, tt)
168.     ax.text(1.2, 1.3, 'Top align', color='C2')
169. 
170.     ax.axhline(1.8, color='C2', linewidth=0.3)
171.     for nn, st in enumerate(sts):
172.         tt = ax.text(0.2 * nn + 0.1, 1.8, st, horizontalalignment=horal,
173.                      verticalalignment='baseline')
174.         draw_box(ax, tt)
175.     ax.text(1.2, 1.8, 'Baseline align', color='C2')
176. 
177.     ax.axhline(0.1, color='C2', linewidth=0.3)
178.     for nn, st in enumerate(sts):
179.         tt = ax.text(0.2 * nn + 0.1, 0.1, st, horizontalalignment=horal,
180.                      verticalalignment='bottom', rotation=20)
181.         draw_box(ax, tt)
182.     ax.text(1.2, 0.1, 'Bot align, rot20', color='C2')
183. 
184. 
185. @image_comparison(['antialiased.png'])
186. def test_antialiasing():
187.     mpl.rcParams['text.antialiased'] = True
188. 
189.     fig = plt.figure(figsize=(5.25, 0.75))
190.     fig.text(0.5, 0.75, "antialiased", horizontalalignment='center',
191.              verticalalignment='center')
192.     fig.text(0.5, 0.25, r"$\sqrt{x}$", horizontalalignment='center',
193.              verticalalignment='center')
194.     # NOTE: We don't need to restore the rcParams here, because the
195.     # test cleanup will do it for us.  In fact, if we do it here, it
196.     # will turn antialiasing back off before the images are actually
197.     # rendered.
198. 
199. 
200. def test_afm_kerning():
201.     fn = mpl.font_manager.findfont("Helvetica", fontext="afm")
202.     with open(fn, 'rb') as fh:
203.         afm = mpl._afm.AFM(fh)
204.     assert afm.string_width_height('VAVAVAVAVAVA') == (7174.0, 718)
205. 
206. 
207. @image_comparison(['text_contains.png'])
208. def test_contains():
209.     fig = plt.figure()
210.     ax = plt.axes()
211. 
212.     mevent = MouseEvent('button_press_event', fig.canvas, 0.5, 0.5, 1, None)
213. 
214.     xs = np.linspace(0.25, 0.75, 30)
215.     ys = np.linspace(0.25, 0.75, 30)
216.     xs, ys = np.meshgrid(xs, ys)
217. 
218.     txt = plt.text(
219.         0.5, 0.4, 'hello world', ha='center', fontsize=30, rotation=30)
220.     # uncomment to draw the text's bounding box
221.     # txt.set_bbox(dict(edgecolor='black', facecolor='none'))
222. 
223.     # draw the text. This is important, as the contains method can only work
224.     # when a renderer exists.
225.     fig.canvas.draw()
226. 
227.     for x, y in zip(xs.flat, ys.flat):
228.         mevent.x, mevent.y = plt.gca().transAxes.transform([x, y])
229.         contains, _ = txt.contains(mevent)
230.         color = 'yellow' if contains else 'red'
231. 
232.         # capture the viewLim, plot a point, and reset the viewLim
233.         vl = ax.viewLim.frozen()
234.         ax.plot(x, y, 'o', color=color)
235.         ax.viewLim.set(vl)
236. 
237. 
238. def test_annotation_contains():
239.     # Check that Annotation.contains looks at the bboxes of the text and the
240.     # arrow separately, not at the joint bbox.
241.     fig, ax = plt.subplots()
242.     ann = ax.annotate(
243.         "hello", xy=(.4, .4), xytext=(.6, .6), arrowprops={"arrowstyle": "->"})
244.     fig.canvas.draw()  # Needed for the same reason as in test_contains.
245.     event = MouseEvent(
246.         "button_press_event", fig.canvas, *ax.transData.transform((.5, .6)))
247.     assert ann.contains(event) == (False, {})
248. 
249. 
250. @pytest.mark.parametrize('err, xycoords, match', (
251.     (RuntimeError, print, "Unknown return type"),
252.     (RuntimeError, [0, 0], r"Unknown coordinate type: \[0, 0\]"),
253.     (ValueError, "foo", "'foo' is not a recognized coordinate"),
254.     (ValueError, "foo bar", "'foo bar' is not a recognized coordinate"),
255.     (ValueError, "offset foo", "xycoords cannot be an offset coordinate"),
256.     (ValueError, "axes foo", "'foo' is not a recognized unit"),
257. ))
258. def test_annotate_errors(err, xycoords, match):
259.     fig, ax = plt.subplots()
260.     with pytest.raises(err, match=match):
261.         ax.annotate('xy', (0, 0), xytext=(0.5, 0.5), xycoords=xycoords)
262.         fig.canvas.draw()
263. 
264. 
265. @image_comparison(['titles'])
266. def test_titles():
267.     # left and right side titles
268.     plt.figure()
269.     ax = plt.subplot(1, 1, 1)
270.     ax.set_title("left title", loc="left")
271.     ax.set_title("right title", loc="right")
272.     ax.set_xticks([])
273.     ax.set_yticks([])
274. 
275. 
276. @image_comparison(['text_alignment'], style='mpl20')
277. def test_alignment():
278.     plt.figure()
279.     ax = plt.subplot(1, 1, 1)
280. 
281.     x = 0.1
282.     for rotation in (0, 30):
283.         for alignment in ('top', 'bottom', 'baseline', 'center'):
284.             ax.text(
285.                 x, 0.5, alignment + " Tj", va=alignment, rotation=rotation,
286.                 bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))
287.             ax.text(
288.                 x, 1.0, r'$\sum_{i=0}^{j}$', va=alignment, rotation=rotation)
289.             x += 0.1
290. 
291.     ax.plot([0, 1], [0.5, 0.5])
292.     ax.plot([0, 1], [1.0, 1.0])
293. 
294.     ax.set_xlim([0, 1])
295.     ax.set_ylim([0, 1.5])
296.     ax.set_xticks([])
297.     ax.set_yticks([])
298. 
299. 
300. @image_comparison(['axes_titles.png'])
301. def test_axes_titles():
302.     # Related to issue #3327
303.     plt.figure()
304.     ax = plt.subplot(1, 1, 1)
305.     ax.set_title('center', loc='center', fontsize=20, fontweight=700)
306.     ax.set_title('left', loc='left', fontsize=12, fontweight=400)
307.     ax.set_title('right', loc='right', fontsize=12, fontweight=400)
308. 
309. 
310. def test_set_position():
311.     fig, ax = plt.subplots()
312. 
313.     # test set_position
314.     ann = ax.annotate(
315.         'test', (0, 0), xytext=(0, 0), textcoords='figure pixels')
316.     fig.canvas.draw()
317. 
318.     init_pos = ann.get_window_extent(fig.canvas.renderer)
319.     shift_val = 15
320.     ann.set_position((shift_val, shift_val))
321.     fig.canvas.draw()
322.     post_pos = ann.get_window_extent(fig.canvas.renderer)
323. 
324.     for a, b in zip(init_pos.min, post_pos.min):
325.         assert a + shift_val == b
326. 
327.     # test xyann
328.     ann = ax.annotate(
329.         'test', (0, 0), xytext=(0, 0), textcoords='figure pixels')
330.     fig.canvas.draw()
331. 
332.     init_pos = ann.get_window_extent(fig.canvas.renderer)
333.     shift_val = 15
334.     ann.xyann = (shift_val, shift_val)
335.     fig.canvas.draw()
336.     post_pos = ann.get_window_extent(fig.canvas.renderer)
337. 
338.     for a, b in zip(init_pos.min, post_pos.min):
339.         assert a + shift_val == b
340. 
341. 
342. def test_char_index_at():
343.     fig = plt.figure()
344.     text = fig.text(0.1, 0.9, "")
345. 
346.     text.set_text("i")
347.     bbox = text.get_window_extent()
348.     size_i = bbox.x1 - bbox.x0
349. 
350.     text.set_text("m")
351.     bbox = text.get_window_extent()
352.     size_m = bbox.x1 - bbox.x0
353. 
354.     text.set_text("iiiimmmm")
355.     bbox = text.get_window_extent()
356.     origin = bbox.x0
357. 
358.     assert text._char_index_at(origin - size_i) == 0  # left of first char
359.     assert text._char_index_at(origin) == 0
360.     assert text._char_index_at(origin + 0.499*size_i) == 0
361.     assert text._char_index_at(origin + 0.501*size_i) == 1
362.     assert text._char_index_at(origin + size_i*3) == 3
363.     assert text._char_index_at(origin + size_i*4 + size_m*3) == 7
364.     assert text._char_index_at(origin + size_i*4 + size_m*4) == 8
365.     assert text._char_index_at(origin + size_i*4 + size_m*10) == 8
366. 
367. 
368. @pytest.mark.parametrize('text', ['', 'O'], ids=['empty', 'non-empty'])
369. def test_non_default_dpi(text):
370.     fig, ax = plt.subplots()
371. 
372.     t1 = ax.text(0.5, 0.5, text, ha='left', va='bottom')
373.     fig.canvas.draw()
374.     dpi = fig.dpi
375. 
376.     bbox1 = t1.get_window_extent()
377.     bbox2 = t1.get_window_extent(dpi=dpi * 10)
378.     np.testing.assert_allclose(bbox2.get_points(), bbox1.get_points() * 10,
379.                                rtol=5e-2)
380.     # Text.get_window_extent should not permanently change dpi.
381.     assert fig.dpi == dpi
382. 
383. 
384. def test_get_rotation_string():
385.     assert Text(rotation='horizontal').get_rotation() == 0.
386.     assert Text(rotation='vertical').get_rotation() == 90.
387. 
388. 
389. def test_get_rotation_float():
390.     for i in [15., 16.70, 77.4]:
391.         assert Text(rotation=i).get_rotation() == i
392. 
393. 
394. def test_get_rotation_int():
395.     for i in [67, 16, 41]:
396.         assert Text(rotation=i).get_rotation() == float(i)
397. 
398. 
399. def test_get_rotation_raises():
400.     with pytest.raises(ValueError):
401.         Text(rotation='hozirontal')
402. 
403. 
404. def test_get_rotation_none():
405.     assert Text(rotation=None).get_rotation() == 0.0
406. 
407. 
408. def test_get_rotation_mod360():
409.     for i, j in zip([360., 377., 720+177.2], [0., 17., 177.2]):
410.         assert_almost_equal(Text(rotation=i).get_rotation(), j)
411. 
412. 
413. @pytest.mark.parametrize("ha", ["center", "right", "left"])
414. @pytest.mark.parametrize("va", ["center", "top", "bottom",
415.                                 "baseline", "center_baseline"])
416. def test_null_rotation_with_rotation_mode(ha, va):
417.     fig, ax = plt.subplots()
418.     kw = dict(rotation=0, va=va, ha=ha)
419.     t0 = ax.text(.5, .5, 'test', rotation_mode='anchor', **kw)
420.     t1 = ax.text(.5, .5, 'test', rotation_mode='default', **kw)
421.     fig.canvas.draw()
422.     assert_almost_equal(t0.get_window_extent(fig.canvas.renderer).get_points(),
423.                         t1.get_window_extent(fig.canvas.renderer).get_points())
424. 
425. 
426. @image_comparison(['text_bboxclip'])
427. def test_bbox_clipping():
428.     plt.text(0.9, 0.2, 'Is bbox clipped?', backgroundcolor='r', clip_on=True)
429.     t = plt.text(0.9, 0.5, 'Is fancy bbox clipped?', clip_on=True)
430.     t.set_bbox({"boxstyle": "round, pad=0.1"})
431. 
432. 
433. @image_comparison(['annotation_negative_ax_coords.png'])
434. def test_annotation_negative_ax_coords():
435.     fig, ax = plt.subplots()
436. 
437.     ax.annotate('+ pts',
438.                 xytext=[30, 20], textcoords='axes points',
439.                 xy=[30, 20], xycoords='axes points', fontsize=32)
440.     ax.annotate('- pts',
441.                 xytext=[30, -20], textcoords='axes points',
442.                 xy=[30, -20], xycoords='axes points', fontsize=32,
443.                 va='top')
444.     ax.annotate('+ frac',
445.                 xytext=[0.75, 0.05], textcoords='axes fraction',
446.                 xy=[0.75, 0.05], xycoords='axes fraction', fontsize=32)
447.     ax.annotate('- frac',
448.                 xytext=[0.75, -0.05], textcoords='axes fraction',
449.                 xy=[0.75, -0.05], xycoords='axes fraction', fontsize=32,
450.                 va='top')
451. 
452.     ax.annotate('+ pixels',
453.                 xytext=[160, 25], textcoords='axes pixels',
454.                 xy=[160, 25], xycoords='axes pixels', fontsize=32)
455.     ax.annotate('- pixels',
456.                 xytext=[160, -25], textcoords='axes pixels',
457.                 xy=[160, -25], xycoords='axes pixels', fontsize=32,
458.                 va='top')
459. 
460. 
461. @image_comparison(['annotation_negative_fig_coords.png'])
462. def test_annotation_negative_fig_coords():
463.     fig, ax = plt.subplots()
464. 
465.     ax.annotate('+ pts',
466.                 xytext=[10, 120], textcoords='figure points',
467.                 xy=[10, 120], xycoords='figure points', fontsize=32)
468.     ax.annotate('- pts',
469.                 xytext=[-10, 180], textcoords='figure points',
470.                 xy=[-10, 180], xycoords='figure points', fontsize=32,
471.                 va='top')
472.     ax.annotate('+ frac',
473.                 xytext=[0.05, 0.55], textcoords='figure fraction',
474.                 xy=[0.05, 0.55], xycoords='figure fraction', fontsize=32)
475.     ax.annotate('- frac',
476.                 xytext=[-0.05, 0.5], textcoords='figure fraction',
477.                 xy=[-0.05, 0.5], xycoords='figure fraction', fontsize=32,
478.                 va='top')
479. 
480.     ax.annotate('+ pixels',
481.                 xytext=[50, 50], textcoords='figure pixels',
482.                 xy=[50, 50], xycoords='figure pixels', fontsize=32)
483.     ax.annotate('- pixels',
484.                 xytext=[-50, 100], textcoords='figure pixels',
485.                 xy=[-50, 100], xycoords='figure pixels', fontsize=32,
486.                 va='top')
487. 
488. 
489. def test_text_stale():
490.     fig, (ax1, ax2) = plt.subplots(1, 2)
491.     plt.draw_all()
492.     assert not ax1.stale
493.     assert not ax2.stale
494.     assert not fig.stale
495. 
496.     txt1 = ax1.text(.5, .5, 'aardvark')
497.     assert ax1.stale
498.     assert txt1.stale
499.     assert fig.stale
500. 
501.     ann1 = ax2.annotate('aardvark', xy=[.5, .5])
502.     assert ax2.stale
503.     assert ann1.stale
504.     assert fig.stale
505. 
506.     plt.draw_all()
507.     assert not ax1.stale
508.     assert not ax2.stale
509.     assert not fig.stale
510. 
511. 
512. @image_comparison(['agg_text_clip.png'])
513. def test_agg_text_clip():
514.     np.random.seed(1)
515.     fig, (ax1, ax2) = plt.subplots(2)
516.     for x, y in np.random.rand(10, 2):
517.         ax1.text(x, y, "foo", clip_on=True)
518.         ax2.text(x, y, "foo")
519. 
520. 
521. def test_text_size_binding():
522.     mpl.rcParams['font.size'] = 10
523.     fp = mpl.font_manager.FontProperties(size='large')
524.     sz1 = fp.get_size_in_points()
525.     mpl.rcParams['font.size'] = 100
526. 
527.     assert sz1 == fp.get_size_in_points()
528. 
529. 
530. @image_comparison(['font_scaling.pdf'])
531. def test_font_scaling():
532.     mpl.rcParams['pdf.fonttype'] = 42
533.     fig, ax = plt.subplots(figsize=(6.4, 12.4))
534.     ax.xaxis.set_major_locator(plt.NullLocator())
535.     ax.yaxis.set_major_locator(plt.NullLocator())
536.     ax.set_ylim(-10, 600)
537. 
538.     for i, fs in enumerate(range(4, 43, 2)):
539.         ax.text(0.1, i*30, f"{fs} pt font size", fontsize=fs)
540. 
541. 
542. @pytest.mark.parametrize('spacing1, spacing2', [(0.4, 2), (2, 0.4), (2, 2)])
543. def test_two_2line_texts(spacing1, spacing2):
544.     text_string = 'line1\nline2'
545.     fig = plt.figure()
546.     renderer = fig.canvas.get_renderer()
547. 
548.     text1 = fig.text(0.25, 0.5, text_string, linespacing=spacing1)
549.     text2 = fig.text(0.25, 0.5, text_string, linespacing=spacing2)
550.     fig.canvas.draw()
551. 
552.     box1 = text1.get_window_extent(renderer=renderer)
553.     box2 = text2.get_window_extent(renderer=renderer)
554. 
555.     # line spacing only affects height
556.     assert box1.width == box2.width
557.     if spacing1 == spacing2:
558.         assert box1.height == box2.height
559.     else:
560.         assert box1.height != box2.height
561. 
562. 
563. def test_validate_linespacing():
564.     with pytest.raises(TypeError):
565.         plt.text(.25, .5, "foo", linespacing="abc")
566. 
567. 
568. def test_nonfinite_pos():
569.     fig, ax = plt.subplots()
570.     ax.text(0, np.nan, 'nan')
571.     ax.text(np.inf, 0, 'inf')
572.     fig.canvas.draw()
573. 
574. 
575. def test_hinting_factor_backends():
576.     plt.rcParams['text.hinting_factor'] = 1
577.     fig = plt.figure()
578.     t = fig.text(0.5, 0.5, 'some text')
579. 
580.     fig.savefig(io.BytesIO(), format='svg')
581.     expected = t.get_window_extent().intervalx
582. 
583.     fig.savefig(io.BytesIO(), format='png')
584.     # Backends should apply hinting_factor consistently (within 10%).
585.     np.testing.assert_allclose(t.get_window_extent().intervalx, expected,
586.                                rtol=0.1)
587. 
588. 
589. @needs_usetex
590. def test_usetex_is_copied():
591.     # Indirectly tests that update_from (which is used to copy tick label
592.     # properties) copies usetex state.
593.     fig = plt.figure()
594.     plt.rcParams["text.usetex"] = False
595.     ax1 = fig.add_subplot(121)
596.     plt.rcParams["text.usetex"] = True
597.     ax2 = fig.add_subplot(122)
598.     fig.canvas.draw()
599.     for ax, usetex in [(ax1, False), (ax2, True)]:
600.         for t in ax.xaxis.majorTicks:
601.             assert t.label1.get_usetex() == usetex
602. 
603. 
604. @needs_usetex
605. def test_single_artist_usetex():
606.     # Check that a single artist marked with usetex does not get passed through
607.     # the mathtext parser at all (for the Agg backend) (the mathtext parser
608.     # currently fails to parse \frac12, requiring \frac{1}{2} instead).
609.     fig = plt.figure()
610.     fig.text(.5, .5, r"$\frac12$", usetex=True)
611.     fig.canvas.draw()
612. 
613. 
614. @pytest.mark.parametrize("fmt", ["png", "pdf", "svg"])
615. def test_single_artist_usenotex(fmt):
616.     # Check that a single artist can be marked as not-usetex even though the
617.     # rcParam is on ("2_2_2" fails if passed to TeX).  This currently skips
618.     # postscript output as the ps renderer doesn't support mixing usetex and
619.     # non-usetex.
620.     plt.rcParams["text.usetex"] = True
621.     fig = plt.figure()
622.     fig.text(.5, .5, "2_2_2", usetex=False)
623.     fig.savefig(io.BytesIO(), format=fmt)
624. 
625. 
626. @image_comparison(['text_as_path_opacity.svg'])
627. def test_text_as_path_opacity():
628.     plt.figure()
629.     plt.gca().set_axis_off()
630.     plt.text(0.25, 0.25, 'c', color=(0, 0, 0, 0.5))
631.     plt.text(0.25, 0.5, 'a', alpha=0.5)
632.     plt.text(0.25, 0.75, 'x', alpha=0.5, color=(0, 0, 0, 1))
633. 
634. 
635. @image_comparison(['text_as_text_opacity.svg'])
636. def test_text_as_text_opacity():
637.     mpl.rcParams['svg.fonttype'] = 'none'
638.     plt.figure()
639.     plt.gca().set_axis_off()
640.     plt.text(0.25, 0.25, '50% using `color`', color=(0, 0, 0, 0.5))
641.     plt.text(0.25, 0.5, '50% using `alpha`', alpha=0.5)
642.     plt.text(0.25, 0.75, '50% using `alpha` and 100% `color`', alpha=0.5,
643.              color=(0, 0, 0, 1))
644. 
645. 
646. def test_text_repr():
647.     # smoketest to make sure text repr doesn't error for category
648.     plt.plot(['A', 'B'], [1, 2])
649.     repr(plt.text(['A'], 0.5, 'Boo'))
650. 
651. 
652. def test_annotation_update():
653.     fig, ax = plt.subplots(1, 1)
654.     an = ax.annotate('annotation', xy=(0.5, 0.5))
655.     extent1 = an.get_window_extent(fig.canvas.get_renderer())
656.     fig.tight_layout()
657.     extent2 = an.get_window_extent(fig.canvas.get_renderer())
658. 
659.     assert not np.allclose(extent1.get_points(), extent2.get_points(),
660.                            rtol=1e-6)
661. 
662. 
663. @check_figures_equal(extensions=["png"])
664. def test_annotation_units(fig_test, fig_ref):
665.     ax = fig_test.add_subplot()
666.     ax.plot(datetime.now(), 1, "o")  # Implicitly set axes extents.
667.     ax.annotate("x", (datetime.now(), 0.5), xycoords=("data", "axes fraction"),
668.                 # This used to crash before.
669.                 xytext=(0, 0), textcoords="offset points")
670.     ax = fig_ref.add_subplot()
671.     ax.plot(datetime.now(), 1, "o")
672.     ax.annotate("x", (datetime.now(), 0.5), xycoords=("data", "axes fraction"))
673. 
674. 
675. @image_comparison(['large_subscript_title.png'], style='mpl20')
676. def test_large_subscript_title():
677.     # Remove this line when this test image is regenerated.
678.     plt.rcParams['text.kerning_factor'] = 6
679.     plt.rcParams['axes.titley'] = None
680. 
681.     fig, axs = plt.subplots(1, 2, figsize=(9, 2.5), constrained_layout=True)
682.     ax = axs[0]
683.     ax.set_title(r'$\sum_{i} x_i$')
684.     ax.set_title('New way', loc='left')
685.     ax.set_xticklabels([])
686. 
687.     ax = axs[1]
688.     ax.set_title(r'$\sum_{i} x_i$', y=1.01)
689.     ax.set_title('Old Way', loc='left')
690.     ax.set_xticklabels([])
691. 
692. 
693. def test_wrap():
694.     fig = plt.figure(figsize=(6, 4))
695.     s = 'This is a very long text that should be wrapped multiple times.'
696.     text = fig.text(0.7, 0.5, s, wrap=True)
697.     fig.canvas.draw()
698.     assert text._get_wrapped_text() == ('This is a very long\n'
699.                                         'text that should be\n'
700.                                         'wrapped multiple\n'
701.                                         'times.')
702. 
703. 
704. def test_long_word_wrap():
705.     fig = plt.figure(figsize=(6, 4))
706.     text = fig.text(9.5, 8, 'Alonglineoftexttowrap', wrap=True)
707.     fig.canvas.draw()
708.     assert text._get_wrapped_text() == 'Alonglineoftexttowrap'
709. 
710. 
711. def test_wrap_no_wrap():
712.     fig = plt.figure(figsize=(6, 4))
713.     text = fig.text(0, 0, 'non wrapped text', wrap=True)
714.     fig.canvas.draw()
715.     assert text._get_wrapped_text() == 'non wrapped text'
716. 
717. 
718. @check_figures_equal(extensions=["png"])
719. def test_buffer_size(fig_test, fig_ref):
720.     # On old versions of the Agg renderer, large non-ascii single-character
721.     # strings (here, "€") would be rendered clipped because the rendering
722.     # buffer would be set by the physical size of the smaller "a" character.
723.     ax = fig_test.add_subplot()
724.     ax.set_yticks([0, 1])
725.     ax.set_yticklabels(["€", "a"])
726.     ax.yaxis.majorTicks[1].label1.set_color("w")
727.     ax = fig_ref.add_subplot()
728.     ax.set_yticks([0, 1])
729.     ax.set_yticklabels(["€", ""])
730. 
731. 
732. def test_fontproperties_kwarg_precedence():
733.     """Test that kwargs take precedence over fontproperties defaults."""
734.     plt.figure()
735.     text1 = plt.xlabel("value", fontproperties='Times New Roman', size=40.0)
736.     text2 = plt.ylabel("counts", size=40.0, fontproperties='Times New Roman')
737.     assert text1.get_size() == 40.0
738.     assert text2.get_size() == 40.0
739. 
740. 
741. def test_transform_rotates_text():
742.     ax = plt.gca()
743.     transform = mtransforms.Affine2D().rotate_deg(30)
744.     text = ax.text(0, 0, 'test', transform=transform,
745.                    transform_rotates_text=True)
746.     result = text.get_rotation()
747.     assert_almost_equal(result, 30)
748. 
749. 
750. def test_update_mutate_input():
751.     inp = dict(fontproperties=FontProperties(weight="bold"),
752.                bbox=None)
753.     cache = dict(inp)
754.     t = Text()
755.     t.update(inp)
756.     assert inp['fontproperties'] == cache['fontproperties']
757.     assert inp['bbox'] == cache['bbox']
758. 
759. 
760. @pytest.mark.parametrize('rotation', ['invalid string', [90]])
761. def test_invalid_rotation_values(rotation):
762.     with pytest.raises(
763.             ValueError,
764.             match=("rotation must be 'vertical', 'horizontal' or a number")):
765.         Text(0, 0, 'foo', rotation=rotation)
766. 
767. 
768. def test_invalid_color():
769.     with pytest.raises(ValueError):
770.         plt.figtext(.5, .5, "foo", c="foobar")
771. 
772. 
773. @image_comparison(['text_pdf_kerning.pdf'], style='mpl20')
774. def test_pdf_kerning():
775.     plt.figure()
776.     plt.figtext(0.1, 0.5, "ATATATATATATATATATA", size=30)
777. 
778. 
779. def test_unsupported_script(recwarn):
780.     fig = plt.figure()
781.     fig.text(.5, .5, "\N{BENGALI DIGIT ZERO}")
782.     fig.canvas.draw()
783.     assert all(isinstance(warn.message, UserWarning) for warn in recwarn)
784.     assert (
785.         [warn.message.args for warn in recwarn] ==
786.         [(r"Glyph 2534 (\N{BENGALI DIGIT ZERO}) missing from current font.",),
787.          (r"Matplotlib currently does not support Bengali natively.",)])
788. 
789. 
790. def test_parse_math():
791.     fig, ax = plt.subplots()
792.     ax.text(0, 0, r"$ \wrong{math} $", parse_math=False)
793.     fig.canvas.draw()
794. 
795.     ax.text(0, 0, r"$ \wrong{math} $", parse_math=True)
796.     with pytest.raises(ValueError, match='Unknown symbol'):
797.         fig.canvas.draw()
798. 
799. 
800. def test_parse_math_rcparams():
801.     # Default is True
802.     fig, ax = plt.subplots()
803.     ax.text(0, 0, r"$ \wrong{math} $")
804.     with pytest.raises(ValueError, match='Unknown symbol'):
805.         fig.canvas.draw()
806. 
807.     # Setting rcParams to False
808.     with mpl.rc_context({'text.parse_math': False}):
809.         fig, ax = plt.subplots()
810.         ax.text(0, 0, r"$ \wrong{math} $")
811.         fig.canvas.draw()
812. 
813. 
814. @image_comparison(['text_pdf_font42_kerning.pdf'], style='mpl20')
815. def test_pdf_font42_kerning():
816.     plt.rcParams['pdf.fonttype'] = 42
817.     plt.figure()
818.     plt.figtext(0.1, 0.5, "ATAVATAVATAVATAVATA", size=30)
819. 
820. 
821. @image_comparison(['text_pdf_chars_beyond_bmp.pdf'], style='mpl20')
822. def test_pdf_chars_beyond_bmp():
823.     plt.rcParams['pdf.fonttype'] = 42
824.     plt.rcParams['mathtext.fontset'] = 'stixsans'
825.     plt.figure()
826.     plt.figtext(0.1, 0.5, "Mass $m$ \U00010308", size=30)
827. 
828. 
829. @needs_usetex
830. def test_metrics_cache():
831.     mpl.text._get_text_metrics_with_cache_impl.cache_clear()
832. 
833.     fig = plt.figure()
834.     fig.text(.3, .5, "foo\nbar")
835.     fig.text(.3, .5, "foo\nbar", usetex=True)
836.     fig.text(.5, .5, "foo\nbar", usetex=True)
837.     fig.canvas.draw()
838.     renderer = fig._get_renderer()
839.     ys = {}  # mapping of strings to where they were drawn in y with draw_tex.
840. 
841.     def call(*args, **kwargs):
842.         renderer, x, y, s, *_ = args
843.         ys.setdefault(s, set()).add(y)
844. 
845.     renderer.draw_tex = call
846.     fig.canvas.draw()
847.     assert [*ys] == ["foo", "bar"]
848.     # Check that both TeX strings were drawn with the same y-position for both
849.     # single-line substrings.  Previously, there used to be an incorrect cache
850.     # collision with the non-TeX string (drawn first here) whose metrics would
851.     # get incorrectly reused by the first TeX string.
852.     assert len(ys["foo"]) == len(ys["bar"]) == 1
853. 
854.     info = mpl.text._get_text_metrics_with_cache_impl.cache_info()
855.     # Every string gets a miss for the first layouting (extents), then a hit
856.     # when drawing, but "foo\nbar" gets two hits as it's drawn twice.
857.     assert info.hits > info.misses

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 04:39:21,062 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug is about pickling a draggable legend. I have already examined `test_pickle.py` and `test_text.py`. While `test_pickle.py` has generic pickling tests, `lib/matplotlib/tests/test_legend.py` is likely to contain tests more specific to the `Legend` class. This file could contain tests for pickling legends or for the draggable functionality, which would be more relevant to the bug report. I do not have the content of this file." query='Please provide the full content of the file lib/matplotlib/tests/test_legend.py.' extra_requirements='' purpose="To find test cases related to pickling Legend objects or testing draggable legends, which is directly related to the user's bug report."
2025-12-21 04:39:21,063 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file lib/matplotlib/tests/test_legend.py.
2025-12-21 04:39:21,063 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 04:39:21,064 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 04:39:21,065 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 04:39:21,065 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file lib/matplotlib/tests/test_legend.py.
Purpose: To find test cases related to pickling Legend objects or testing draggable legends, which is directly related to the user's bug report.
2025-12-21 04:39:23,158 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the full content of the file lib/matplotlib/tests/test_legend.py. This will allow me to examine the test cases related to legends, which may be relevant to the user's issue. I will now analyze the content of this file to identify tests related to pickling or dragging legends." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_legend.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2139, 'candidates_token_count': 90, 'total_token_count': 2293, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2139}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 90}], 'thoughts_token_count': 64, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.12276972664727105, 'model_name': 'gemini-2.5-pro'} id='run--2ff02b93-7b88-4637-9c6a-f5ba82322290-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_legend.py'}, 'id': '175d10bb-5db0-491a-850e-2ad2a53882c6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2139, 'output_tokens': 90, 'total_tokens': 2293, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 64}}
2025-12-21 04:39:31,682 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the content of `lib/matplotlib/tests/test_legend.py` to find test cases related to pickling and dragging legends. I found two relevant tests: `test_pickle` and `test_legend_draggable`. I will now retrieve the content of these specific tests to provide the most relevant code to the user.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_legend.py", "end_line": 1230.0, "start_line": 1200.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11345, 'candidates_token_count': 101, 'total_token_count': 12160, 'cached_content_token_count': 1860, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11345}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1860}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 101}], 'thoughts_token_count': 714}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0240076650487315, 'model_name': 'gemini-2.5-pro'} id='run--c49a0430-5db2-49b7-96f2-e2415ce2d4ab-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_legend.py', 'end_line': 1230.0, 'start_line': 1200.0}, 'id': '77411767-9345-46f6-af5f-c32c0a4b6f97', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11345, 'output_tokens': 101, 'total_tokens': 12160, 'input_token_details': {'cache_read': 1860}, 'output_token_details': {'reasoning': 714}}
2025-12-21 04:39:33,675 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_legend.py"}'}, '__gemini_function_call_thought_signatures__': {'1980f853-4504-4faa-b7b9-c29a2081c323': 'CrEDAY89a1/kXdhZoG9z9t3jIwIHLznO1utCs5tmX5CvbFa8OITZpcKcXRY/WAgn0ORF4SZr2vAqcN0gWD5qSWZREAdZkAqKWBoYofU9TXHaD6UPFLY4rzkKBVRxWG6DYgEZ8kKI5G7WDPI6EW61p0F6fDgbsXrVNvxNYmQxVrAcXKq0vs9xRczV6q+1RKfJLwM8pSAlsac2P5vqS93EngAu0NyvyoJlb7evyGj2zqA2tfaRBzqlZoHQA19HhCUfz4cWJBr2IEaGd3n137/tcy77pJvggHPXmSEJ5agrHPKA19mFeOQM0fhd46b2eYxGrKSKxBHxVGkq7dRvnMcZuLyfYXO50DyzzOlpT06FRNKQLI9HrOgYC6h0PkD/u/xWgsBJbsqPZBezNta72YeF3vxlsHu+VhZsEL+6G+JJ14QiVmEAifsTHBXh/Wca8Iq5HrezVGhGgFiH/sYJ2jAAk2lQX8E3+aZFIi64LafZi41yPcX7Rb21z8eJqJ/EkbNyT9/4Sn59jLsN9KoUXwBQUWT3DKlTjkInehZoYgNV71J+R5iUlqab6lpOT+8lU3GfPftbdQ=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11918, 'candidates_token_count': 25, 'total_token_count': 12035, 'cached_content_token_count': 11159, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11918}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11159}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 25}], 'thoughts_token_count': 92}, 'finish_reason': 'STOP', 'avg_logprobs': -0.5671716690063476, 'model_name': 'gemini-2.5-pro'} id='run--3ccfde93-5578-4d1f-b225-dde900f540e1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_legend.py'}, 'id': '1980f853-4504-4faa-b7b9-c29a2081c323', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11918, 'output_tokens': 25, 'total_tokens': 12035, 'input_token_details': {'cache_read': 11159}, 'output_token_details': {'reasoning': 92}}
2025-12-21 04:39:35,866 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have re-read the file `lib/matplotlib/tests/test_legend.py`. I will now search for the `test_pickle` and `test_legend_draggable` functions within this file to get the specific line numbers, and then I will retrieve the code for those functions.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_legend.py", "text": "def test_legend_draggable"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 21059, 'candidates_token_count': 139, 'total_token_count': 21198, 'cached_content_token_count': 11468, 'prompt_tokens_details': [{'modality': 1, 'token_count': 21151}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11468}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 139}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.06436187414814243, 'model_name': 'gemini-2.5-pro'} id='run--f6e34b74-9dc5-44c2-a165-0a0f7b61efaf-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_legend.py', 'text': 'def test_pickle'}, 'id': '1f5c68e8-cb7f-45ca-b1fc-fbebb664d9a1', 'type': 'tool_call'}, {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_legend.py', 'text': 'def test_legend_draggable'}, 'id': 'fcd33a34-2940-406d-ad70-11817774c0e3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21059, 'output_tokens': 139, 'total_tokens': 21198, 'input_token_details': {'cache_read': 11468}}
2025-12-21 04:39:37,978 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_legend.py", "text": "pickle"}'}, '__gemini_function_call_thought_signatures__': {'700fd455-c8cd-42ca-99b7-e896754dc4d1': 'CrkDAY89a1+KIKqH+6eaB6Jh6/TZ138FsGh3yZsl6mS3oi+5Oi9tg+J+MBg5LsvF7rfqhjp2GJTJCQ2Ha7Cv0jpZFDCbAeFJXa523A8XbnQ/hY7NPjLtwRmpzNZmq+RE9u0argaedusIpPRr0WyegJvOQRi8olHbEQ8vIRoekiUiYTdkNDp+kvsJZ3TcaU6wxO+0eld/inKTjnLhHpNQlXp1GxKggddrkiHBvVafBQ/55JHA+V91G4dUJWg80sjJ6COnVWY3fLHs2KWmnS0tckwo0jIXMQH28yIyb6bWgVGFDynEiV0mAKgRhnQneKpXZ5Vu3nNj3f8VzRq4pFMr/bNrqEZbaro6hHHreFW+1WcaMNUK/DgKUhunbehbJZ5UkhD2vheCxoTYaEy9XoImzwbavxt0r1Tw8SM+9YtK8v3lI+nKzIhGnKIZ6K9dOohC3lYz6qXp5gs0O8UvWBUDGNqv2JjyDEo6gwTqUGyhUtJOQ52j3wHOrPsoqzNfkeIsEcqBuuZz4ZgrF+NV9X5uWyJVFVqZdXvP0JNchibMcofhG36FGubxp0EVh4j/Cd0haR8VHIboUEv0UhOt'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 21427, 'candidates_token_count': 35, 'total_token_count': 21558, 'cached_content_token_count': 20977, 'prompt_tokens_details': [{'modality': 1, 'token_count': 21519}], 'cache_tokens_details': [{'modality': 1, 'token_count': 20977}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 35}], 'thoughts_token_count': 96}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2821507862636021, 'model_name': 'gemini-2.5-pro'} id='run--1d23cc49-caa4-4a08-a0d7-88e3ffd6b741-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_legend.py', 'text': 'pickle'}, 'id': '700fd455-c8cd-42ca-99b7-e896754dc4d1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21427, 'output_tokens': 35, 'total_tokens': 21558, 'input_token_details': {'cache_read': 20977}, 'output_token_details': {'reasoning': 96}}
2025-12-21 04:39:40,464 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_legend.py", "end_line": 1040.0, "start_line": 1035.0}'}, '__gemini_function_call_thought_signatures__': {'6ef5f8c0-b51f-4a53-b8d8-f2390c663f16': 'CvkDAY89a1+ebVzP6qFB5/D1W3b8qnxFpClqrOPfKXykX7mLDO0vqcRI20hUZ8uMrhlTZOq5SVoAz5Nzl3jfQmPPuR/n5Dmy7Ux70mDwKaEPzlxbJ/WTJsGiy+wmc0Qx21IEN0IbpumSe1FvthsjWlVQsgHWUNV05b5vxv8lDso+kdttsmYJohmGfPZZfM6bXmWRZh7Dftj2GucKeIZXDnNlxM54LK9uAWJrvb5K7ASh0v1xKfujqVIVM41cJeXyawgAK5YiVHXq8CJRSFM/nPcCVd6FptFvcTHu9Beaseicc8+cXrGduVXNrjIvEOoSjtzwdEO+xin9/MX83y8hNmD2i7gtljtMFUQtYPzL3dAg+pD0+II135BxGTXdU0JvA6XSOjF2bUqS02CiDMdlOXyuYQ8gBTxqY73h6UP2YKmN022+Rl/TIdDtI6eq1xuaD14BoqGbyajTtwGWmbPGAr/GMZdSXHM8yxhs6gHqw1QMfo+bEXyzLB204wfbXA1jsg4vr9l9FB2F+XKAhOkmM+k+aFyDIWoBEo+KKN77LgN+4e4uDbk8aQkqm2zW4pbyxos+rD/Ac0So1J0lvE22hdrIQq4pwJ57OlEgDbBZ1IiZLD5isZKUV4U1vzaDPn8HfwPfifizDnQ7o7vGbDZjQ2rNb/vG5saH1/yTeg=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 21494, 'candidates_token_count': 42, 'total_token_count': 21647, 'cached_content_token_count': 20952, 'prompt_tokens_details': [{'modality': 1, 'token_count': 21682}], 'cache_tokens_details': [{'modality': 1, 'token_count': 20952}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 42}], 'thoughts_token_count': 111}, 'finish_reason': 'STOP', 'avg_logprobs': -0.21464899608067103, 'model_name': 'gemini-2.5-pro'} id='run--ad6d79cc-62ee-4e9d-85a1-94b59a747d23-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'pickle'}, 'id': '6ef5f8c0-b51f-4a53-b8d8-f2390c663f16', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_legend.py', 'end_line': 1040.0, 'start_line': 1035.0}, 'id': '12a8df73-433d-4bac-afc1-9979edffabe3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21494, 'output_tokens': 42, 'total_tokens': 21647, 'input_token_details': {'cache_read': 20952}, 'output_token_details': {'reasoning': 111}}
2025-12-21 04:39:43,107 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_text_node_with_text', 'arguments': '{"text": "pickle"}'}, '__gemini_function_call_thought_signatures__': {'fa51b0a1-9fa2-451c-9a6d-4ea309fd3bbd': 'CvkEAY89a1/0BAcHVku+Igalh5kUYfJJHmaiXZbV92w0695ohcR4LXF24+8bXqZcc7Yc2DNZ/ST2wHEvP+qOYviu9W26bH9S90rpn+VNbDEpovnczA6di6fW6WqtGniYGbbI64LSqA6aTvO/9GqEjLP1be5FTOT51Ni1P4YWMS5XTnprmMB9rjqM0/5ItWq9jho1iaGoJVuqQtFN8JrBCiOhJTcLHA4NHguujWjF1BoeTr5QbCuUSk7xyKi+CWLOZg1p9+1MhRJ9Be/+BbYT2ZSkjMISSDE72u+30022vAKZb8ljYoFS24RMCRqUXgPpiEfwF17WhPMx9tuRA1/ixJnDURiDxF8Gjnv1sVPPHDKcLf1AOf686GQftgRI+PibE5kE7Rauv7Tcfvzwee2MZ467W2ZVZJll8bPk3f+vRxkCf5xFaUpOVoH/83h4xeCSvC3jMuwwT1iZY4DXziUBd1ZCtNGXlgDMd+qtw2WZ0H1zwqfR0d9CqlN5/dFHiZhLiS2QZ7Q2CFUSWKgzn8nARrMIUr5j/m8wuKrPGGt8KjKZU9DamIJNPq2pe9XmEFp021/EdE5pu5VEkY0dkuAJJFf96ON2G6M31qkZB3m6K1qzQpzGHENIVRpwOkxFiQINumLlnqWsXRNiz/kQl75hyW1LBRT9NzlKISSxvb3UyFQPfquT6PD5oPqlpLhN8JEPAgaUGE89BgYwaZhoEWgcPpzyGByV7G3wqezNMKg033fiuyCKFMd91N/gTDd00oZNsr5dWmhwFDSo5Dm2ihrWRg7jJ5L1ot9i7E0yckCSc9ij/sG5cQti9U4LFYqGSr4OyqXZ00Zk4CTwToND'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 21755, 'candidates_token_count': 11, 'total_token_count': 21899, 'cached_content_token_count': 20902, 'prompt_tokens_details': [{'modality': 1, 'token_count': 22054}], 'cache_tokens_details': [{'modality': 1, 'token_count': 20902}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 11}], 'thoughts_token_count': 133}, 'finish_reason': 'STOP', 'avg_logprobs': -1.4816173206676135, 'model_name': 'gemini-2.5-pro'} id='run--f8a03ae2-cb14-4c36-b0f2-9e085bf49d07-0' tool_calls=[{'name': 'find_text_node_with_text', 'args': {'text': 'pickle'}, 'id': 'fa51b0a1-9fa2-451c-9a6d-4ea309fd3bbd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21755, 'output_tokens': 11, 'total_tokens': 21899, 'input_token_details': {'cache_read': 20902}, 'output_token_details': {'reasoning': 133}}
2025-12-21 04:39:46,223 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_file_node_with_basename', 'arguments': '{"basename": "test_pickle"}'}, '__gemini_function_call_thought_signatures__': {'19111a8d-5e33-407f-9fe7-434f81d08b74': 'CugFAY89a19HhbH4tiHwuJ+A/X3sF9lbUsCIjDsmTK0Ue3m79jd3a9Lok10nPBwhtOKp3s5fYZYg9nf/8hpy3DVnNQ0k2f4COj/H8zsd6quttBI1P5CrB0VKR2WTBFuuCJnCMjuIyX6aTrjW+8ZRwBtx9sSefViz7CpbXUQs3C9ZfqlZO6MoXD6se/95e9oG9OW+sEj8Kyw8DlKL7q0HhuZhAIOUB/nlxbnUa2kisfrolG5Bvv4F0yvG9ue0FGBnjlUx+T3zUhxMeIEKrLb5udl9ltznmp++2YqSj4o2hKYGqBM/S/AADwC8i+MENZU3aDvYeobRjiUCzrxZelTdTmF9pcki2QhCLVjF7c3MJwUFYFsGpKpRL+4nKuJP6qwZnYqLlvR9yLpCuLuGnlsqd9/gTNQ6mrEHY36lF3oAzgUMI8Fa0UxVKKavPE/dRKbv79PkF+0mh9JtpDCtHBXzCb712gvNL9VTlN1MK68lBH3OlilBKpWqOk5pJU4F70nHOzhNaD49irBCnk+L4pYvlWlJqFOUEMf7pdMSHlMrlo87DWXtDIWwzL00MsgsE8sMibNaMp5VxYcR94XR3XpzKYiKyQp68+yfw6oR3KjL2ZqPQx6D85UJLCEzorYClcDMn0bRYA+G529pkGbVTR2dmqwthaidT0DYeqYTWFAti4w8aYmL1akQ++lOGfHnqe2DwqALhL2qrhdukMphCIlnKko6NaVjiOrRtNcHtHexj19/w7PiQw2tqwoxwEtvqX+JYDhNc+axIL7sK8u8f7AFJsDRJowvSaG1gIvz/pxa86bi1zOHUPMERtyW+O1gO09ZYnZWdQ7KEmPkBggpAsavTzemK6N5MIr4Rcmr3JVllE6Mg9E/VIqt0ovV2ASGrsP+hCALOvWN0wo7p+TVglw1Vne8bCj+kQaC9OjI9c3NKbqQMRoyXcB15MW5ukT7ZOxn+gYbDYT9iWSxJF4KR/mP1vwWhUkidt3MYzK6'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 30801, 'candidates_token_count': 13, 'total_token_count': 30973, 'cached_content_token_count': 21248, 'prompt_tokens_details': [{'modality': 1, 'token_count': 31233}], 'cache_tokens_details': [{'modality': 1, 'token_count': 21248}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 13}], 'thoughts_token_count': 159}, 'finish_reason': 'STOP', 'avg_logprobs': -1.6983321263239934, 'model_name': 'gemini-2.5-pro'} id='run--25222522-9b75-41fc-b51b-6aea4dacbafb-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'test_pickle'}, 'id': '19111a8d-5e33-407f-9fe7-434f81d08b74', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30801, 'output_tokens': 13, 'total_tokens': 30973, 'input_token_details': {'cache_read': 21248}, 'output_token_details': {'reasoning': 159}}
2025-12-21 04:40:17,882 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have provided the full content of the file `lib/matplotlib/tests/test_legend.py`. I then searched for the `test_pickle` and `test_legend_draggable` functions. I found `test_legend_draggable` and provided its code. I was unable to find a test named `test_pickle`. I then broadened my search to look for any file with "pickle" in its name, and for the text "pickle" in the entire codebase. These searches did not reveal a specific test for pickling legends. It is possible that the test is named differently or is part of a larger test suite. I have exhausted the reasonable search strategies with the available tools. I will now present the code for `test_legend_draggable` as it is the most relevant information I have found.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 30836, 'candidates_token_count': 167, 'total_token_count': 32076, 'cached_content_token_count': 30885, 'prompt_tokens_details': [{'modality': 1, 'token_count': 31427}], 'cache_tokens_details': [{'modality': 1, 'token_count': 30885}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 167}], 'thoughts_token_count': 1073}, 'finish_reason': 'STOP', 'avg_logprobs': -0.717913005166425, 'model_name': 'gemini-2.5-pro'} id='run--7130c2e6-9136-4e7b-aa42-1bc2317b2588-0' usage_metadata={'input_tokens': 30836, 'output_tokens': 167, 'total_tokens': 32076, 'input_token_details': {'cache_read': 30885}, 'output_token_details': {'reasoning': 1073}}
2025-12-21 04:40:17,884 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file lib/matplotlib/tests/test_legend.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
To find test cases related to pickling Legend objects or testing draggable legends, which is directly related to the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: doc/users/prev_whats_new/github_stats_3.2.0.rst
Line number range: 1026 - 1092
Content:
* :ghissue:`16487`: Add link to blog to front page
* :ghissue:`16478`: The bottom parameter of plt.hist() shifts the data as well, not just the baseline
* :ghissue:`16280`: SymLogNorm colorbar incorrect on master
* :ghissue:`16448`: Bad interaction between shared axes and pcolormesh sticky edges
* :ghissue:`16451`: InvertedLogTransform inherits from deprecated base
* :ghissue:`16420`: Error when adding colorbar to pcolormesh of a boolean array
* :ghissue:`16114`: Prose error on website (first paragraph)
* :ghissue:`8291`: Unable to pickle.load(fig) with mpl in jupyter notebook
* :ghissue:`16173`: Constrained_layout creates extra axes when used with subgridspec
* :ghissue:`16127`: nbformat 5.0.0 missing schema files
* :ghissue:`15849`: Using pandas.Timestamp in blended coordinate system of ax.annotate.
* :ghissue:`6015`: scatterplot axis autoscale fails for small data values
* :ghissue:`15806`: 3.2.0 may break some Cartopy tests
* :ghissue:`15852`: Lasso selector does not show in Jupyter notebook
* :ghissue:`15820`: Show incomplete tick labels when using mixed chinese and english characters
* :ghissue:`15770`: DOCS 2D Line label option ``_nolegend_`` is not documented
* :ghissue:`15332`: Type promotion error with datetime bins in hist
* :ghissue:`15611`: BUG: Qt5Agg window size regression
* :ghissue:`7130`: Incorrect autoscaling of polar plot limits after scatter
* :ghissue:`15576`: Multi-line ticks cause cut-offs
* :ghissue:`8609`: Clipped tick labels
* :ghissue:`15517`: antialiased image check seems wrong when used on zoomed image
* :ghissue:`13400`: Qt Embedding w/ Spyder
* :ghissue:`14724`: drawstyle parameter of line needs example
* :ghissue:`13619`: Importing matplotlib.animation prevents python script from executing in the background
* :ghissue:`14270`: Secondary axis called with [0, 1] might produce exceptions in case these are invalid data
* :ghissue:`15417`: Why is smart_bounds() being deprecated?
* :ghissue:`9778`: Blanks in colorbar just inside of 'extend' arrowpoints when using AxesGrid
* :ghissue:`15336`: DivergingNorm is a misleading name
* :ghissue:`15399`: OSError: [Errno 86] Bad CPU type in executable: 'convert' on import matplotlib.animation
* :ghissue:`15109`: matplotlib.collections inheritance diagram small/blurry
* :ghissue:`15331`: Log Scale: FloatingPointError: underflow encountered in power
* :ghissue:`15251`: Large memory growth with log scaling and linear ticking
* :ghissue:`15247`: Colorbar tick placement issues with ImageGrid and LogNorm
* :ghissue:`15306`: Footer off centre
* :ghissue:`13485`: Matplotlib NavigationToolbar2Tk disappears when reducing window size
* :ghissue:`15232`: DOC: Automatic default rcParam expansion creates misleading sentences
* :ghissue:`14141`: setting spine position on a log plot fails
* :ghissue:`15138`: Make plt.style.use accept path-like objects in addition to string
* :ghissue:`14207`: Check if point is in path or not by contains_point
* :ghissue:`13591`: Style issues when building the docs with (future) Sphinx 2.0
* :ghissue:`8089`: Using Minute Locator to set x-axis ticks exceeds Locator.MAXTICKS
* :ghissue:`15075`: sphinxext.missing_references does not specify if it supports parallel file read.
* :ghissue:`10963`: Replace \pgfimage by \includegraphics in PGF backend
* :ghissue:`15156`: ax.text fails with positional argument error
* :ghissue:`14439`: hist() fails when all data points are np.nan
* :ghissue:`15042`: How to handle sphinx nitpicky mode
* :ghissue:`14060`: quiver(C=...) argument is not reasonably validated
* :ghissue:`11335`: TST: testing not catching bad escape sequences in doc strings
* :ghissue:`15040`: Wrong figure window size after calling fig.set_size_inches() repeatedly
* :ghissue:`15100`: Issue with creating QApplication in QT backend
* :ghissue:`14887`: kerning seems generally wrong
* :ghissue:`14800`: default tick formatter could switch to scientific notation earlier
* :ghissue:`14503`: Add a test for #14451
* :ghissue:`14907`: ConnectionPatch across axes needs to be excluded from layout management
* :ghissue:`14911`: Removing a shared axes via ``ax.remove()`` leads to an error.
* :ghissue:`12462`: cbar.add_lines should allow manually adding lines, not just contour sets
* :ghissue:`14796`: Show user how to use Agg buffer in example
* :ghissue:`14883`: MinSize not respected using wx backend causes wxAssertionError. Bug fix included.
* :ghissue:`15014`: Wrapping of text adds leading newline character if first word is long
* :ghissue:`14918`: constrained_layout fails with hidden axis...
* :ghissue:`14981`: Barplot call crashes when called with yscale="log" and bins with h=0
* :ghissue:`4621`: Default bottom of Stepfilled histograms should be set according to ymin
* :ghissue:`15030`: Doc build broken
* :ghissue:`8093`: set_ylim not working with plt.axis('equal')
* :ghissue:`6055`: Serious problems on the axes documentation
* :ghissue:`9979`: Axis limits are set badly with small values in scatter().


File: doc/users/prev_whats_new/github_stats_3.4.0.rst
Line number range: 456 - 531
Content:
* :ghpull:`19161`: Simplify test_backend_pdf::test_multipage_properfinalize.
* :ghpull:`19141`: FIX: suppress offset text in ConciseDateFormatter when largest scale is in years
* :ghpull:`19150`: Move from @cbook._classproperty to @_api.classproperty
* :ghpull:`19144`: Move from cbook._warn_external() to _api.warn_external()
* :ghpull:`19119`: Don't lose unit change handlers when pickling/unpickling.
* :ghpull:`19145`: Move from cbook._deprecate_*() to _api.deprecate_*()
* :ghpull:`19123`: Use Qt events to refresh pixel ratio.
* :ghpull:`19056`: Support raw/rgba frame format in FFMpegFileWriter
* :ghpull:`19140`: Fix the docstring of suptitle/subxlabel/supylabel.
* :ghpull:`19132`: Normalize docstring interpolation label for kwdoc() property lists
* :ghpull:`19134`: Switch internal API function calls from cbook to _api
* :ghpull:`19138`: Added non-code contributions to incubator docs
* :ghpull:`19125`: DOC: contributor incubator
* :ghpull:`18948`: DOC: Fix latexpdf build
* :ghpull:`18753`: Remove several more deprecations
* :ghpull:`19083`: Fix headless tests on Wayland.
* :ghpull:`19127`: Cleanups to webagg & friends.
* :ghpull:`19122`: FIX/DOC - make Text doscstring interp more easily searchable
* :ghpull:`19106`: Support setting rcParams["image.cmap"] to Colormap instances.
* :ghpull:`19085`: FIX: update a transfrom from transFigure to transSubfigure
* :ghpull:`19117`: Rename a confusing variable.
* :ghpull:`18647`: Axes.axline: implement support transform argument (for points but not slope)
* :ghpull:`16220`: Fix interaction with unpickled 3d plots.
* :ghpull:`19059`: Support blitting in webagg backend
* :ghpull:`19107`: Update pyplot.py
* :ghpull:`19044`: Cleanup Animation frame_formats.
* :ghpull:`19087`: FIX/TST: recursively remove ticks
* :ghpull:`19094`: Suppress -Wunused-function about _import_array when compiling tkagg.cpp.
* :ghpull:`19092`: Fix use transform mplot3d
* :ghpull:`19097`: DOC: add FuncScale to set_x/yscale
* :ghpull:`19089`: ENH: allow passing a scale instance to set_scale
* :ghpull:`19086`: FIX: add a default scale to Normalize
* :ghpull:`19073`: Mention in a few more places that artists default to not-pickable.
* :ghpull:`19079`: Remove incorrect statement about ``hist(..., log=True)``.
* :ghpull:`19076`: Small improvements to aitoff projection.
* :ghpull:`19071`: DOC: Add 'blackman' to list of imshow interpolations
* :ghpull:`17524`: ENH: add supxlabel and supylabel
* :ghpull:`18840`: Add tutorial about autoscaling
* :ghpull:`19042`: Simplify GridHelper invalidation.
* :ghpull:`19048`: Remove _draw_{ticks2,label2}; skip extents computation in _update_ticks.
* :ghpull:`18983`: Pass norm argument to spy
* :ghpull:`18802`: Add code of conduct
* :ghpull:`19060`: Fix broken link in Readme
* :ghpull:`18569`: More generic value snapping for Slider widgets
* :ghpull:`19055`: Fix kwargs handling in AnnotationBbox
* :ghpull:`19041`: Reword docs for exception_handler in CallbackRegistry.
* :ghpull:`19046`: Prepare inlining MovieWriter.cleanup() into MovieWriter.finish().
* :ghpull:`19050`: Better validate tick direction.
* :ghpull:`19038`: Fix markup in interactive figures doc.
* :ghpull:`19035`: grid_helper_curvelinear cleanups.
* :ghpull:`19022`: Update event handling docs.
* :ghpull:`19025`: Remove individual doc entries for some methods Axes inherits from Artist
* :ghpull:`19018`: Inline and optimize ContourLabeler.get_label_coords.
* :ghpull:`19019`: Deprecate never used ``resize_callback`` param to FigureCanvasTk.
* :ghpull:`19023`: Cleanup comments/docs in backend_macosx, backend_pdf.
* :ghpull:`19020`: Replace mathtext assertions by unpacking.
* :ghpull:`19024`: Dedupe docs of GridSpec.subplots.
* :ghpull:`19013`: Improve docs of _get_packed_offsets, _get_aligned_offsets.
* :ghpull:`19009`: Compactify the implementation of ContourLabeler.add_label_near.
* :ghpull:`19008`: Deprecate event processing wrapper methods on FigureManagerBase.
* :ghpull:`19015`: Better document multilinebaseline (and other small TextArea fixes)
* :ghpull:`19012`: Common ``__init__`` for VPacker and HPacker.
* :ghpull:`19014`: Support normalize_kwargs(None) (== {}).
* :ghpull:`19010`: Inline _print_pdf_to_fh, _print_png_to_fh.
* :ghpull:`19003`: Remove reference to unicode-math in pgf preamble.
* :ghpull:`18847`: Cleanup interactive pan/zoom.
* :ghpull:`18868`: Expire _make_keyword_only deprecations from 3.2
* :ghpull:`18903`: Move cbook._suppress_matplotlib_deprecation_warning() from cbook to _api
* :ghpull:`18997`: Micro-optimize check_isinstance.
* :ghpull:`18995`: Fix the doc of GraphicsContextBase.set_clip_rectangle.
* :ghpull:`18996`: Fix API change message from #18989
* :ghpull:`18993`: Don't access private renderer attributes in tkagg blit.
* :ghpull:`18980`: DOC: fix typos
* :ghpull:`18989`: The Artist property rasterized cannot be None anymore
* :ghpull:`18987`: Fix punctuation in doc.
* :ghpull:`18894`: Use selectfont instead of findfont + scalefont + setfont in PostScript.


File: doc/users/prev_whats_new/github_stats_3.4.0.rst
Line number range: 971 - 1040
Content:
* :ghissue:`19701`: Notebook plotting regression in 3.4.0rc*
* :ghissue:`19754`: add space in python -mpip
* :ghissue:`18364`: ``Axes3d`` attaches itself to a figure, where as ``Axes`` does not
* :ghissue:`19700`: Setting pickradius regression in 3.4.0rc
* :ghissue:`19594`: code of conduct link 404s
* :ghissue:`19576`: duplicate pick events firing
* :ghissue:`19560`: segfault due to font objects when multi-threading
* :ghissue:`19598`: Axes order changed in 3.4.0rc1
* :ghissue:`19631`: subplot mosaic 1 element list
* :ghissue:`19581`: Missing kerning for single-byte strings in PDF
* :ghissue:`17769`: interactive figure close with wxpython 4.1 causes freeze / crash (segfault?)
* :ghissue:`19427`: Fix mistake in documentation
* :ghissue:`19624`: Cannot add colorbar to figure after pickle
* :ghissue:`19544`: Regression in 3.4.0rc1 in creating ListedColormap from a set
* :ghissue:`5855`: plt.step(..., where="auto")
* :ghissue:`19474`: Memory leak with CallbackRegistry
* :ghissue:`19345`: legend is eating up huge amounts of memory
* :ghissue:`19066`: plt.scatter, error with NaN values and edge color
* :ghissue:`19432`: Unexpected change in behavior in plt.subplot
* :ghissue:`18020`: Scatter3D: facecolor or color to "none" leads to an error
* :ghissue:`18939`: Warn re: Axes3D constructor behavior change in mpl3.4
* :ghissue:`19128`: webagg reports incorrect values for non-alphanumeric key events on non-qwerty keyboards
* :ghissue:`16558`: Request: for non-interactive backends make fig.canvas.draw() force the render
* :ghissue:`19234`: tick labels displaced vertically with text.usetex and xcolor
* :ghissue:`18407`: pgf backend no longer supports fig.draw
* :ghissue:`2298`: axes.xmargin/ymargin rcParam behaves differently than pyplot.margins()
* :ghissue:`19473`: Animations in Tkinter window advance non-uniformly
* :ghissue:`8688`: document moved examples
* :ghissue:`9553`: Display warning on out-of-date documentation websites
* :ghissue:`9556`: Examples page version is out of date
* :ghissue:`12374`: Examples in docs should be redirected to latest version number
* :ghissue:`19486`: Figure.tight_layout() raises MatplotlibDeprecationWarning
* :ghissue:`19445`: axline transform support broke axline in loglog scale
* :ghissue:`19178`: mathtext \lim is vertically misaligned
* :ghissue:`19446`: Better document and error handle third dimension in pyplot.text() positional argument
* :ghissue:`8790`: Inconsistent doc vs behavior for RendererXXX.draw_markers
* :ghissue:`18815`: Patch3D object does not return correct face color with get_facecolor
* :ghissue:`19152`: Automatically Aligned Labels outside Figure with Constrained Layout in Exported File
* :ghissue:`18934`: stairs() crashes with no values and one edge
* :ghissue:`11296`: Image in github repo does not match matplotlib.org (breaks image tutorial)
* :ghissue:`18699`: Issue with downloading stinkbug for "Image Tutorial"
* :ghissue:`19405`: TypeError constructor returned NULL in wayland session
* :ghissue:`18962`: Table CSS needs cleanup
* :ghissue:`19417`: CI failing on numpy...
* :ghissue:`17849`: Problems caused by changes to logic of scatter coloring in matplotlib 3.3.0.rc1
* :ghissue:`18648`: Drop support for directly imread()ing urls.
* :ghissue:`19366`: Current CI doc builds fail
* :ghissue:`19372`: matplotlib.axes.Axes.indicate_inset default label value is incompatible with LaTeX
* :ghissue:`17100`: Is it a better solution to access one of the spines by class attribute?
* :ghissue:`17375`: Proposal: add_subfigs....
* :ghissue:`19339`: constrained_layout + fixed-aspect axes + bbox_inches="tight"
* :ghissue:`19308`: Reduce whitespace in Choosing Colormaps tutorial plots
* :ghissue:`18832`: MNT: Remove AxesStack and deprecated behavior of reuse of existing axes with same arguments
* :ghissue:`19084`: Arrow coordinates slightly off when used with annotation text
* :ghissue:`17765`: PGF xelatex can't find fonts in special-character paths
* :ghissue:`19274`: Missing marker in documentation of plot
* :ghissue:`18241`: LaTeX overset: unknown symbol
* :ghissue:`19292`: Non interpolated placeholder value in docstring.
* :ghissue:`18119`: Can no longer deepcopy LogNorm objects on master
* :ghissue:`8665`: Noninteger Bases in mathtext sqrt
* :ghissue:`19243`: matplotlib doesn't build with qhull-2020.2
* :ghissue:`19275`: Double specifications of plot attributes
* :ghissue:`15066`: Feature request: stem3
* :ghissue:`19209`: Segfault when trying to create gigapixel image with agg backend
* :ghissue:`4321`: clabel ticks and axes limits with eps zoom output
* :ghissue:`16376`: ``SymLogNorm`` and ``SymLogScale`` give inconsistent results....
* :ghissue:`19239`: _make_norm_from_scale needs to process values
* :ghissue:`16552`: Scatter autoscaling still has issues with log scaling and zero values
* :ghissue:`18417`: Documentation issue template should ask for matplotlib version
* :ghissue:`19206`: matplotlib.cbook.Grouper: Example raise exception:


File: doc/users/prev_whats_new/github_stats_3.5.3.rst
Line number range: 40 - 103
Content:
* :ghpull:`23591`: Backport PR #23549 on branch v3.5.x (Don't clip colorbar dividers)
* :ghpull:`23593`: STY: Fix whitespace error from new flake8
* :ghpull:`23549`: Don't clip colorbar dividers
* :ghpull:`23528`: Backport PR #23523 on branch v3.5.x (TST: Update Quantity test class)
* :ghpull:`23523`: TST: Update Quantity test class
* :ghpull:`23508`: Add explicit registration of units in examples
* :ghpull:`23515`: Backport PR #23462: Fix AttributeError for pickle load of Figure class
* :ghpull:`23518`: Backport PR #23514 on branch v3.5.x (Fix doc build)
* :ghpull:`23517`: Backport PR #23511 on branch v3.5.x (supporting IBM i OS)
* :ghpull:`23511`: supporting IBM i OS
* :ghpull:`23462`: Fix AttributeError for pickle load of Figure class
* :ghpull:`23488`: Backport PR #23066 on branch v3.5.x (BLD: Define PyErr_SetFromWindowsErr on Cygwin.)
* :ghpull:`23066`: BLD: Define PyErr_SetFromWindowsErr on Cygwin.
* :ghpull:`23479`: Pin setuptools_scm on v3.5.x
* :ghpull:`22998`: Backport PR #22987 on branch v3.5.x (CI: bump test limit from tkagg on osx)
* :ghpull:`23478`: Backport PR #23476: FIX: reset to original DPI in getstate
* :ghpull:`23476`: FIX: reset to original DPI in getstate
* :ghpull:`23458`: Backport PR #23445 on branch v3.5.x (Compare thread native ids when checking whether running on main thread.)
* :ghpull:`23440`: Backport PR #23430 on branch v3.5.x (Fix divide by 0 runtime warning)
* :ghpull:`23430`: Fix divide by 0 runtime warning
* :ghpull:`23344`: Backport PR #23333: Fix errorbar handling of nan.
* :ghpull:`23333`: Fix errorbar handling of nan.
* :ghpull:`23338`: Backport PR #23278: Remove internal use of get/set dpi
* :ghpull:`23331`: Backport PR #22835 on branch v3.5.x (Fix BoundaryNorm cursor data output)
* :ghpull:`22835`: Fix BoundaryNorm cursor data output
* :ghpull:`23292`: Backport PR #23232 on branch v3.5.x (Fix passing stem markerfmt positionally when locs are not given)
* :ghpull:`23275`: Backport PR #23260 on branch v3.5.x (Fix Colorbar extend patches to have correct alpha)
* :ghpull:`23312`: Pin to an older pydata-sphinx-theme for v3.5.x
* :ghpull:`23278`: Remove internal use of get/set dpi
* :ghpull:`23232`: Fix passing stem markerfmt positionally when locs are not given
* :ghpull:`22865`: Fix issue with colorbar extend and drawedges
* :ghpull:`23260`: Fix Colorbar extend patches to have correct alpha
* :ghpull:`23245`: Backport PR #23144 on branch v3.5.x (Only import setuptools_scm when we are in a matplotlib git repo)
* :ghpull:`23144`: Only import setuptools_scm when we are in a matplotlib git repo
* :ghpull:`23242`: Backport PR #23203 on branch v3.5.x (Honour ``panchor`` keyword for colorbar on subplot)
* :ghpull:`23203`: Honour ``panchor`` keyword for colorbar on subplot
* :ghpull:`23228`: Backport PR #23209 on branch v3.5.x (Fix the vertical alignment of overunder symbols.)
* :ghpull:`23209`: Fix the vertical alignment of overunder symbols.
* :ghpull:`23184`: Backport PR #23174: Make sure SubFigure has _cachedRenderer
* :ghpull:`23194`: Backport PR #23095: Try to unbreak CI by xfailing OSX Tk tests
* :ghpull:`23113`: Backport PR #23057 and #23106
* :ghpull:`23185`: Backport PR #23168 on branch v3.5.x (Corrected docstring for artist.Artist.set_agg_filter)
* :ghpull:`23168`: Corrected docstring for artist.Artist.set_agg_filter
* :ghpull:`23174`: Make sure SubFigure has _cachedRenderer
* :ghpull:`23110`: Tweak subprocess_run_helper.
* :ghpull:`23138`: Backport PR #23137 on branch v3.5.x (DOC fix typo)
* :ghpull:`23137`: DOC fix typo
* :ghpull:`23125`: Backport PR #23122 on branch v3.5.x (Remove redundant rcparam default)
* :ghpull:`23120`: Backport PR #23115 on branch v3.5.x (DOC fixed duplicate/wrong default)
* :ghpull:`23095`: Try to unbreak CI by xfailing OSX Tk tests
* :ghpull:`23106`: Reuse subprocess_run_helper in test_pylab_integration.
* :ghpull:`23112`: Backport PR #23111 on branch v3.5.x (Fix _g_sig_digits for value<0 and delta=0.)
* :ghpull:`23111`: Fix _g_sig_digits for value<0 and delta=0.
* :ghpull:`23057`: FIX: ensure switching the backend installs repl hook
* :ghpull:`23075`: Backport PR #23069 on branch v3.5.x (TST: forgive more failures on pyside2 / pyside6 cross imports)
* :ghpull:`23069`: TST: forgive more failures on pyside2 / pyside6 cross imports
* :ghpull:`22981`: Backport PR #22979 on branch v3.5.x (Skip additional backend tests on import error)
* :ghpull:`23064`: Backport PR #22975 on branch v3.5.x (MNT: fix __array__ to numpy)
* :ghpull:`22975`: MNT: fix __array__ to numpy
* :ghpull:`23058`: Backport PR #23051 on branch v3.5.x (Fix variable initialization due to jump bypassing it)
* :ghpull:`23051`: Fix variable initialization due to jump bypassing it
* :ghpull:`23010`: Backport PR #23000 on branch v3.5.x (Additional details on VS install on installation page)
* :ghpull:`22995`: Backport PR #22994 on branch v3.5.x (Docs: ignore >>> on code prompts on documentation prompts)
* :ghpull:`23001`: CI: Add trivial pre-commit.ci config to avoid CI failure


File: doc/users/prev_whats_new/whats_new_1.2.rst
Line number range: 1 - 150
Content:
.. _whats-new-1-2:


What's new in Matplotlib 1.2 (Nov 9, 2012)
==========================================

.. contents:: Table of Contents
   :depth: 2


.. note::

   matplotlib 1.2 supports Python 2.6, 2.7, and 3.1

Python 3.x support
------------------

Matplotlib 1.2 is the first version to support Python 3.x,
specifically Python 3.1 and 3.2.  To make this happen in a reasonable
way, we also had to drop support for Python versions earlier than 2.6.

This work was done by Michael Droettboom, the Cape Town Python Users'
Group, many others and supported financially in part by the SAGE
project.

The following GUI backends work under Python 3.x: Gtk3Cairo, Qt4Agg,
TkAgg and MacOSX.  The other GUI backends do not yet have adequate
bindings for Python 3.x, but continue to work on Python 2.6 and 2.7,
particularly the Qt and QtAgg backends (which have been
deprecated). The non-GUI backends, such as PDF, PS and SVG, work on
both Python 2.x and 3.x.

Features that depend on the Python Imaging Library, such as JPEG
handling, do not work, since the version of PIL for Python 3.x is not
sufficiently mature.

PGF/TikZ backend
----------------
Peter Würtz wrote a backend that allows matplotlib to export figures as
drawing commands for LaTeX. These can be processed by PdfLaTeX, XeLaTeX or
LuaLaTeX using the PGF/TikZ package. Usage examples and documentation are
found in :doc:`/tutorials/text/pgf`.

.. image:: /_static/pgf_preamble.*

Locator interface
-----------------

Philip Elson exposed the intelligence behind the tick Locator classes with a
simple interface. For instance, to get no more than 5 sensible steps which
span the values 10 and 19.5::

    >>> import matplotlib.ticker as mticker
    >>> locator = mticker.MaxNLocator(nbins=5)
    >>> print(locator.tick_values(10, 19.5))
    [ 10.  12.  14.  16.  18.  20.]

Tri-Surface Plots
-----------------

Damon McDougall added a new plotting method for the
:mod:`~mpl_toolkits.mplot3d` toolkit called
:meth:`~mpl_toolkits.mplot3d.axes3d.Axes3D.plot_trisurf`.

.. figure:: ../../gallery/mplot3d/images/sphx_glr_trisurf3d_001.png
   :target: ../../gallery/mplot3d/trisurf3d.html
   :align: center
   :scale: 50

Control the lengths of colorbar extensions
------------------------------------------

Andrew Dawson added a new keyword argument *extendfrac* to
:meth:`~matplotlib.pyplot.colorbar` to control the length of
minimum and maximum colorbar extensions.

.. plot::

    import matplotlib.pyplot as plt
    import numpy as np

    x = y = np.linspace(0., 2*np.pi, 100)
    X, Y = np.meshgrid(x, y)
    Z = np.cos(X) * np.sin(0.5*Y)

    clevs = [-.75, -.5, -.25, 0., .25, .5, .75]
    cmap = plt.cm.get_cmap(name='jet', lut=8)

    ax1 = plt.subplot(211)
    cs1 = plt.contourf(x, y, Z, clevs, cmap=cmap, extend='both')
    cb1 = plt.colorbar(orientation='horizontal', extendfrac=None)
    cb1.set_label('Default length colorbar extensions')

    ax2 = plt.subplot(212)
    cs2 = plt.contourf(x, y, Z, clevs, cmap=cmap, extend='both')
    cb2 = plt.colorbar(orientation='horizontal', extendfrac='auto')
    cb2.set_label('Custom length colorbar extensions')

    plt.show()


Figures are picklable
---------------------

Philip Elson added an experimental feature to make figures picklable
for quick and easy short-term storage of plots. Pickle files
are not designed for long term storage, are unsupported when restoring a pickle
saved in another matplotlib version and are insecure when restoring a pickle
from an untrusted source. Having said this, they are useful for short term
storage for later modification inside matplotlib.


Set default bounding box in matplotlibrc
------------------------------------------

Two new defaults are available in the matplotlibrc configuration file:
``savefig.bbox``, which can be set to 'standard' or 'tight', and
``savefig.pad_inches``, which controls the bounding box padding.


New Boxplot Functionality
-------------------------

Users can now incorporate their own methods for computing the median and its
confidence intervals into the `~.Axes.boxplot` method. For
every column of data passed to boxplot, the user can specify an accompanying
median and confidence interval.

.. figure:: ../../gallery/statistics/images/sphx_glr_boxplot_demo_003.png
   :target: ../../gallery/statistics/boxplot_demo.html
   :align: center
   :scale: 50

New RC parameter functionality
------------------------------

Matthew Emmett added a function and a context manager to help manage RC
parameters: :func:`~matplotlib.rc_file` and :class:`~matplotlib.rc_context`.
To load RC parameters from a file::

  >>> mpl.rc_file('mpl.rc')

To temporarily use RC parameters::

  >>> with mpl.rc_context(fname='mpl.rc', rc={'text.usetex': True}):
  >>>     ...


Streamplot
----------


File: lib/matplotlib/tests/test_legend.py
Line number range: 1 - 500
Content:
1. import collections
2. import platform
3. from unittest import mock
4. import warnings
5. 
6. import numpy as np
7. from numpy.testing import assert_allclose
8. import pytest
9. 
10. from matplotlib.testing.decorators import check_figures_equal, image_comparison
11. from matplotlib.testing._markers import needs_usetex
12. import matplotlib.pyplot as plt
13. import matplotlib as mpl
14. import matplotlib.patches as mpatches
15. import matplotlib.transforms as mtransforms
16. import matplotlib.collections as mcollections
17. import matplotlib.lines as mlines
18. from matplotlib.legend_handler import HandlerTuple
19. import matplotlib.legend as mlegend
20. from matplotlib import rc_context
21. from matplotlib.font_manager import FontProperties
22. 
23. 
24. def test_legend_ordereddict():
25.     # smoketest that ordereddict inputs work...
26. 
27.     X = np.random.randn(10)
28.     Y = np.random.randn(10)
29.     labels = ['a'] * 5 + ['b'] * 5
30.     colors = ['r'] * 5 + ['g'] * 5
31. 
32.     fig, ax = plt.subplots()
33.     for x, y, label, color in zip(X, Y, labels, colors):
34.         ax.scatter(x, y, label=label, c=color)
35. 
36.     handles, labels = ax.get_legend_handles_labels()
37.     legend = collections.OrderedDict(zip(labels, handles))
38.     ax.legend(legend.values(), legend.keys(),
39.               loc='center left', bbox_to_anchor=(1, .5))
40. 
41. 
42. @image_comparison(['legend_auto1'], remove_text=True)
43. def test_legend_auto1():
44.     """Test automatic legend placement"""
45.     fig, ax = plt.subplots()
46.     x = np.arange(100)
47.     ax.plot(x, 50 - x, 'o', label='y=1')
48.     ax.plot(x, x - 50, 'o', label='y=-1')
49.     ax.legend(loc='best')
50. 
51. 
52. @image_comparison(['legend_auto2'], remove_text=True)
53. def test_legend_auto2():
54.     """Test automatic legend placement"""
55.     fig, ax = plt.subplots()
56.     x = np.arange(100)
57.     b1 = ax.bar(x, x, align='edge', color='m')
58.     b2 = ax.bar(x, x[::-1], align='edge', color='g')
59.     ax.legend([b1[0], b2[0]], ['up', 'down'], loc='best')
60. 
61. 
62. @image_comparison(['legend_auto3'])
63. def test_legend_auto3():
64.     """Test automatic legend placement"""
65.     fig, ax = plt.subplots()
66.     x = [0.9, 0.1, 0.1, 0.9, 0.9, 0.5]
67.     y = [0.95, 0.95, 0.05, 0.05, 0.5, 0.5]
68.     ax.plot(x, y, 'o-', label='line')
69.     ax.set_xlim(0.0, 1.0)
70.     ax.set_ylim(0.0, 1.0)
71.     ax.legend(loc='best')
72. 
73. 
74. def test_legend_auto4():
75.     """
76.     Check that the legend location with automatic placement is the same,
77.     whatever the histogram type is. Related to issue #9580.
78.     """
79.     # NB: barstacked is pointless with a single dataset.
80.     fig, axs = plt.subplots(ncols=3, figsize=(6.4, 2.4))
81.     leg_bboxes = []
82.     for ax, ht in zip(axs.flat, ('bar', 'step', 'stepfilled')):
83.         ax.set_title(ht)
84.         # A high bar on the left but an even higher one on the right.
85.         ax.hist([0] + 5*[9], bins=range(10), label="Legend", histtype=ht)
86.         leg = ax.legend(loc="best")
87.         fig.canvas.draw()
88.         leg_bboxes.append(
89.             leg.get_window_extent().transformed(ax.transAxes.inverted()))
90. 
91.     # The histogram type "bar" is assumed to be the correct reference.
92.     assert_allclose(leg_bboxes[1].bounds, leg_bboxes[0].bounds)
93.     assert_allclose(leg_bboxes[2].bounds, leg_bboxes[0].bounds)
94. 
95. 
96. def test_legend_auto5():
97.     """
98.     Check that the automatic placement handle a rather complex
99.     case with non rectangular patch. Related to issue #9580.
100.     """
101.     fig, axs = plt.subplots(ncols=2, figsize=(9.6, 4.8))
102. 
103.     leg_bboxes = []
104.     for ax, loc in zip(axs.flat, ("center", "best")):
105.         # An Ellipse patch at the top, a U-shaped Polygon patch at the
106.         # bottom and a ring-like Wedge patch: the correct placement of
107.         # the legend should be in the center.
108.         for _patch in [
109.                 mpatches.Ellipse(
110.                     xy=(0.5, 0.9), width=0.8, height=0.2, fc="C1"),
111.                 mpatches.Polygon(np.array([
112.                     [0, 1], [0, 0], [1, 0], [1, 1], [0.9, 1.0], [0.9, 0.1],
113.                     [0.1, 0.1], [0.1, 1.0], [0.1, 1.0]]), fc="C1"),
114.                 mpatches.Wedge((0.5, 0.5), 0.5, 0, 360, width=0.05, fc="C0")
115.                 ]:
116.             ax.add_patch(_patch)
117. 
118.         ax.plot([0.1, 0.9], [0.9, 0.9], label="A segment")  # sthg to label
119. 
120.         leg = ax.legend(loc=loc)
121.         fig.canvas.draw()
122.         leg_bboxes.append(
123.             leg.get_window_extent().transformed(ax.transAxes.inverted()))
124. 
125.     assert_allclose(leg_bboxes[1].bounds, leg_bboxes[0].bounds)
126. 
127. 
128. @image_comparison(['legend_various_labels'], remove_text=True)
129. def test_various_labels():
130.     # tests all sorts of label types
131.     fig = plt.figure()
132.     ax = fig.add_subplot(121)
133.     ax.plot(np.arange(4), 'o', label=1)
134.     ax.plot(np.linspace(4, 4.1), 'o', label='Développés')
135.     ax.plot(np.arange(4, 1, -1), 'o', label='__nolegend__')
136.     ax.legend(numpoints=1, loc='best')
137. 
138. 
139. def test_legend_label_with_leading_underscore():
140.     """
141.     Test that artists with labels starting with an underscore are not added to
142.     the legend, and that a warning is issued if one tries to add them
143.     explicitly.
144.     """
145.     fig, ax = plt.subplots()
146.     line, = ax.plot([0, 1], label='_foo')
147.     with pytest.warns(UserWarning,
148.                       match=r"starts with '_'.*excluded from the legend."):
149.         legend = ax.legend(handles=[line])
150.     assert len(legend.legend_handles) == 0
151. 
152. 
153. @image_comparison(['legend_labels_first.png'], remove_text=True)
154. def test_labels_first():
155.     # test labels to left of markers
156.     fig, ax = plt.subplots()
157.     ax.plot(np.arange(10), '-o', label=1)
158.     ax.plot(np.ones(10)*5, ':x', label="x")
159.     ax.plot(np.arange(20, 10, -1), 'd', label="diamond")
160.     ax.legend(loc='best', markerfirst=False)
161. 
162. 
163. @image_comparison(['legend_multiple_keys.png'], remove_text=True)
164. def test_multiple_keys():
165.     # test legend entries with multiple keys
166.     fig, ax = plt.subplots()
167.     p1, = ax.plot([1, 2, 3], '-o')
168.     p2, = ax.plot([2, 3, 4], '-x')
169.     p3, = ax.plot([3, 4, 5], '-d')
170.     ax.legend([(p1, p2), (p2, p1), p3], ['two keys', 'pad=0', 'one key'],
171.               numpoints=1,
172.               handler_map={(p1, p2): HandlerTuple(ndivide=None),
173.                            (p2, p1): HandlerTuple(ndivide=None, pad=0)})
174. 
175. 
176. @image_comparison(['rgba_alpha.png'], remove_text=True,
177.                   tol=0 if platform.machine() == 'x86_64' else 0.01)
178. def test_alpha_rgba():
179.     fig, ax = plt.subplots()
180.     ax.plot(range(10), lw=5)
181.     leg = plt.legend(['Longlabel that will go away'], loc='center')
182.     leg.legendPatch.set_facecolor([1, 0, 0, 0.5])
183. 
184. 
185. @image_comparison(['rcparam_alpha.png'], remove_text=True,
186.                   tol=0 if platform.machine() == 'x86_64' else 0.01)
187. def test_alpha_rcparam():
188.     fig, ax = plt.subplots()
189.     ax.plot(range(10), lw=5)
190.     with mpl.rc_context(rc={'legend.framealpha': .75}):
191.         leg = plt.legend(['Longlabel that will go away'], loc='center')
192.         # this alpha is going to be over-ridden by the rcparam with
193.         # sets the alpha of the patch to be non-None which causes the alpha
194.         # value of the face color to be discarded.  This behavior may not be
195.         # ideal, but it is what it is and we should keep track of it changing
196.         leg.legendPatch.set_facecolor([1, 0, 0, 0.5])
197. 
198. 
199. @image_comparison(['fancy'], remove_text=True)
200. def test_fancy():
201.     # using subplot triggers some offsetbox functionality untested elsewhere
202.     plt.subplot(121)
203.     plt.plot([5] * 10, 'o--', label='XX')
204.     plt.scatter(np.arange(10), np.arange(10, 0, -1), label='XX\nXX')
205.     plt.errorbar(np.arange(10), np.arange(10), xerr=0.5,
206.                  yerr=0.5, label='XX')
207.     plt.legend(loc="center left", bbox_to_anchor=[1.0, 0.5],
208.                ncols=2, shadow=True, title="My legend", numpoints=1)
209. 
210. 
211. @image_comparison(['framealpha'], remove_text=True,
212.                   tol=0 if platform.machine() == 'x86_64' else 0.02)
213. def test_framealpha():
214.     x = np.linspace(1, 100, 100)
215.     y = x
216.     plt.plot(x, y, label='mylabel', lw=10)
217.     plt.legend(framealpha=0.5)
218. 
219. 
220. @image_comparison(['scatter_rc3', 'scatter_rc1'], remove_text=True)
221. def test_rc():
222.     # using subplot triggers some offsetbox functionality untested elsewhere
223.     plt.figure()
224.     ax = plt.subplot(121)
225.     ax.scatter(np.arange(10), np.arange(10, 0, -1), label='three')
226.     ax.legend(loc="center left", bbox_to_anchor=[1.0, 0.5],
227.               title="My legend")
228. 
229.     mpl.rcParams['legend.scatterpoints'] = 1
230.     plt.figure()
231.     ax = plt.subplot(121)
232.     ax.scatter(np.arange(10), np.arange(10, 0, -1), label='one')
233.     ax.legend(loc="center left", bbox_to_anchor=[1.0, 0.5],
234.               title="My legend")
235. 
236. 
237. @image_comparison(['legend_expand'], remove_text=True)
238. def test_legend_expand():
239.     """Test expand mode"""
240.     legend_modes = [None, "expand"]
241.     fig, axs = plt.subplots(len(legend_modes), 1)
242.     x = np.arange(100)
243.     for ax, mode in zip(axs, legend_modes):
244.         ax.plot(x, 50 - x, 'o', label='y=1')
245.         l1 = ax.legend(loc='upper left', mode=mode)
246.         ax.add_artist(l1)
247.         ax.plot(x, x - 50, 'o', label='y=-1')
248.         l2 = ax.legend(loc='right', mode=mode)
249.         ax.add_artist(l2)
250.         ax.legend(loc='lower left', mode=mode, ncols=2)
251. 
252. 
253. @image_comparison(['hatching'], remove_text=True, style='default')
254. def test_hatching():
255.     # Remove this line when this test image is regenerated.
256.     plt.rcParams['text.kerning_factor'] = 6
257. 
258.     fig, ax = plt.subplots()
259. 
260.     # Patches
261.     patch = plt.Rectangle((0, 0), 0.3, 0.3, hatch='xx',
262.                           label='Patch\ndefault color\nfilled')
263.     ax.add_patch(patch)
264.     patch = plt.Rectangle((0.33, 0), 0.3, 0.3, hatch='||', edgecolor='C1',
265.                           label='Patch\nexplicit color\nfilled')
266.     ax.add_patch(patch)
267.     patch = plt.Rectangle((0, 0.4), 0.3, 0.3, hatch='xx', fill=False,
268.                           label='Patch\ndefault color\nunfilled')
269.     ax.add_patch(patch)
270.     patch = plt.Rectangle((0.33, 0.4), 0.3, 0.3, hatch='||', fill=False,
271.                           edgecolor='C1',
272.                           label='Patch\nexplicit color\nunfilled')
273.     ax.add_patch(patch)
274. 
275.     # Paths
276.     ax.fill_between([0, .15, .3], [.8, .8, .8], [.9, 1.0, .9],
277.                     hatch='+', label='Path\ndefault color')
278.     ax.fill_between([.33, .48, .63], [.8, .8, .8], [.9, 1.0, .9],
279.                     hatch='+', edgecolor='C2', label='Path\nexplicit color')
280. 
281.     ax.set_xlim(-0.01, 1.1)
282.     ax.set_ylim(-0.01, 1.1)
283.     ax.legend(handlelength=4, handleheight=4)
284. 
285. 
286. def test_legend_remove():
287.     fig, ax = plt.subplots()
288.     lines = ax.plot(range(10))
289.     leg = fig.legend(lines, "test")
290.     leg.remove()
291.     assert fig.legends == []
292.     leg = ax.legend("test")
293.     leg.remove()
294.     assert ax.get_legend() is None
295. 
296. 
297. def test_reverse_legend_handles_and_labels():
298.     """Check that the legend handles and labels are reversed."""
299.     fig, ax = plt.subplots()
300.     x = 1
301.     y = 1
302.     labels = ["First label", "Second label", "Third label"]
303.     markers = ['.', ',', 'o']
304. 
305.     ax.plot(x, y, markers[0], label=labels[0])
306.     ax.plot(x, y, markers[1], label=labels[1])
307.     ax.plot(x, y, markers[2], label=labels[2])
308.     leg = ax.legend(reverse=True)
309.     actual_labels = [t.get_text() for t in leg.get_texts()]
310.     actual_markers = [h.get_marker() for h in leg.legend_handles]
311.     assert actual_labels == list(reversed(labels))
312.     assert actual_markers == list(reversed(markers))
313. 
314. 
315. @check_figures_equal(extensions=["png"])
316. def test_reverse_legend_display(fig_test, fig_ref):
317.     """Check that the rendered legend entries are reversed"""
318.     ax = fig_test.subplots()
319.     ax.plot([1], 'ro', label="first")
320.     ax.plot([2], 'bx', label="second")
321.     ax.legend(reverse=True)
322. 
323.     ax = fig_ref.subplots()
324.     ax.plot([2], 'bx', label="second")
325.     ax.plot([1], 'ro', label="first")
326.     ax.legend()
327. 
328. 
329. class TestLegendFunction:
330.     # Tests the legend function on the Axes and pyplot.
331.     def test_legend_no_args(self):
332.         lines = plt.plot(range(10), label='hello world')
333.         with mock.patch('matplotlib.legend.Legend') as Legend:
334.             plt.legend()
335.         Legend.assert_called_with(plt.gca(), lines, ['hello world'])
336. 
337.     def test_legend_positional_handles_labels(self):
338.         lines = plt.plot(range(10))
339.         with mock.patch('matplotlib.legend.Legend') as Legend:
340.             plt.legend(lines, ['hello world'])
341.         Legend.assert_called_with(plt.gca(), lines, ['hello world'])
342. 
343.     def test_legend_positional_handles_only(self):
344.         lines = plt.plot(range(10))
345.         with pytest.raises(TypeError, match='but found an Artist'):
346.             # a single arg is interpreted as labels
347.             # it's a common error to just pass handles
348.             plt.legend(lines)
349. 
350.     def test_legend_positional_labels_only(self):
351.         lines = plt.plot(range(10), label='hello world')
352.         with mock.patch('matplotlib.legend.Legend') as Legend:
353.             plt.legend(['foobar'])
354.         Legend.assert_called_with(plt.gca(), lines, ['foobar'])
355. 
356.     def test_legend_three_args(self):
357.         lines = plt.plot(range(10), label='hello world')
358.         with mock.patch('matplotlib.legend.Legend') as Legend:
359.             plt.legend(lines, ['foobar'], loc='right')
360.         Legend.assert_called_with(plt.gca(), lines, ['foobar'], loc='right')
361. 
362.     def test_legend_handler_map(self):
363.         lines = plt.plot(range(10), label='hello world')
364.         with mock.patch('matplotlib.legend.'
365.                         '_get_legend_handles_labels') as handles_labels:
366.             handles_labels.return_value = lines, ['hello world']
367.             plt.legend(handler_map={'1': 2})
368.         handles_labels.assert_called_with([plt.gca()], {'1': 2})
369. 
370.     def test_legend_kwargs_handles_only(self):
371.         fig, ax = plt.subplots()
372.         x = np.linspace(0, 1, 11)
373.         ln1, = ax.plot(x, x, label='x')
374.         ln2, = ax.plot(x, 2*x, label='2x')
375.         ln3, = ax.plot(x, 3*x, label='3x')
376.         with mock.patch('matplotlib.legend.Legend') as Legend:
377.             ax.legend(handles=[ln3, ln2])  # reversed and not ln1
378.         Legend.assert_called_with(ax, [ln3, ln2], ['3x', '2x'])
379. 
380.     def test_legend_kwargs_labels_only(self):
381.         fig, ax = plt.subplots()
382.         x = np.linspace(0, 1, 11)
383.         ln1, = ax.plot(x, x)
384.         ln2, = ax.plot(x, 2*x)
385.         with mock.patch('matplotlib.legend.Legend') as Legend:
386.             ax.legend(labels=['x', '2x'])
387.         Legend.assert_called_with(ax, [ln1, ln2], ['x', '2x'])
388. 
389.     def test_legend_kwargs_handles_labels(self):
390.         fig, ax = plt.subplots()
391.         th = np.linspace(0, 2*np.pi, 1024)
392.         lns, = ax.plot(th, np.sin(th), label='sin')
393.         lnc, = ax.plot(th, np.cos(th), label='cos')
394.         with mock.patch('matplotlib.legend.Legend') as Legend:
395.             # labels of lns, lnc are overwritten with explicit ('a', 'b')
396.             ax.legend(labels=('a', 'b'), handles=(lnc, lns))
397.         Legend.assert_called_with(ax, (lnc, lns), ('a', 'b'))
398. 
399.     def test_warn_mixed_args_and_kwargs(self):
400.         fig, ax = plt.subplots()
401.         th = np.linspace(0, 2*np.pi, 1024)
402.         lns, = ax.plot(th, np.sin(th), label='sin')
403.         lnc, = ax.plot(th, np.cos(th), label='cos')
404.         with pytest.warns(UserWarning) as record:
405.             ax.legend((lnc, lns), labels=('a', 'b'))
406.         assert len(record) == 1
407.         assert str(record[0].message) == (
408.             "You have mixed positional and keyword arguments, some input may "
409.             "be discarded.")
410. 
411.     def test_parasite(self):
412.         from mpl_toolkits.axes_grid1 import host_subplot
413. 
414.         host = host_subplot(111)
415.         par = host.twinx()
416. 
417.         p1, = host.plot([0, 1, 2], [0, 1, 2], label="Density")
418.         p2, = par.plot([0, 1, 2], [0, 3, 2], label="Temperature")
419. 
420.         with mock.patch('matplotlib.legend.Legend') as Legend:
421.             plt.legend()
422.         Legend.assert_called_with(host, [p1, p2], ['Density', 'Temperature'])
423. 
424. 
425. class TestLegendFigureFunction:
426.     # Tests the legend function for figure
427.     def test_legend_handle_label(self):
428.         fig, ax = plt.subplots()
429.         lines = ax.plot(range(10))
430.         with mock.patch('matplotlib.legend.Legend') as Legend:
431.             fig.legend(lines, ['hello world'])
432.         Legend.assert_called_with(fig, lines, ['hello world'],
433.                                   bbox_transform=fig.transFigure)
434. 
435.     def test_legend_no_args(self):
436.         fig, ax = plt.subplots()
437.         lines = ax.plot(range(10), label='hello world')
438.         with mock.patch('matplotlib.legend.Legend') as Legend:
439.             fig.legend()
440.         Legend.assert_called_with(fig, lines, ['hello world'],
441.                                   bbox_transform=fig.transFigure)
442. 
443.     def test_legend_label_arg(self):
444.         fig, ax = plt.subplots()
445.         lines = ax.plot(range(10))
446.         with mock.patch('matplotlib.legend.Legend') as Legend:
447.             fig.legend(['foobar'])
448.         Legend.assert_called_with(fig, lines, ['foobar'],
449.                                   bbox_transform=fig.transFigure)
450. 
451.     def test_legend_label_three_args(self):
452.         fig, ax = plt.subplots()
453.         lines = ax.plot(range(10))
454.         with mock.patch('matplotlib.legend.Legend') as Legend:
455.             fig.legend(lines, ['foobar'], 'right')
456.         Legend.assert_called_with(fig, lines, ['foobar'], 'right',
457.                                   bbox_transform=fig.transFigure)
458. 
459.     def test_legend_label_three_args_pluskw(self):
460.         # test that third argument and loc=  called together give
461.         # Exception
462.         fig, ax = plt.subplots()
463.         lines = ax.plot(range(10))
464.         with pytest.raises(Exception):
465.             fig.legend(lines, ['foobar'], 'right', loc='left')
466. 
467.     def test_legend_kw_args(self):
468.         fig, axs = plt.subplots(1, 2)
469.         lines = axs[0].plot(range(10))
470.         lines2 = axs[1].plot(np.arange(10) * 2.)
471.         with mock.patch('matplotlib.legend.Legend') as Legend:
472.             fig.legend(loc='right', labels=('a', 'b'), handles=(lines, lines2))
473.         Legend.assert_called_with(
474.             fig, (lines, lines2), ('a', 'b'), loc='right',
475.             bbox_transform=fig.transFigure)
476. 
477.     def test_warn_args_kwargs(self):
478.         fig, axs = plt.subplots(1, 2)
479.         lines = axs[0].plot(range(10))
480.         lines2 = axs[1].plot(np.arange(10) * 2.)
481.         with pytest.warns(UserWarning) as record:
482.             fig.legend((lines, lines2), labels=('a', 'b'))
483.         assert len(record) == 1
484.         assert str(record[0].message) == (
485.             "You have mixed positional and keyword arguments, some input may "
486.             "be discarded.")
487. 
488. 
489. def test_figure_legend_outside():
490.     todos = ['upper ' + pos for pos in ['left', 'center', 'right']]
491.     todos += ['lower ' + pos for pos in ['left', 'center', 'right']]
492.     todos += ['left ' + pos for pos in ['lower', 'center', 'upper']]
493.     todos += ['right ' + pos for pos in ['lower', 'center', 'upper']]
494. 
495.     upperext = [20.347556,  27.722556, 790.583, 545.499]
496.     lowerext = [20.347556,  71.056556, 790.583, 588.833]
497.     leftext = [151.681556, 27.722556, 790.583, 588.833]
498.     rightext = [20.347556,  27.722556, 659.249, 588.833]
499.     axbb = [upperext, upperext, upperext,
500.             lowerext, lowerext, lowerext,


File: lib/matplotlib/tests/test_legend.py
Line number range: 1035 - 1040
Content:
@pytest.mark.parametrize('draggable', (True, False))
def test_legend_draggable(draggable):
    fig, ax = plt.subplots()
    ax.plot(range(10), label='shabnams')
    leg = ax.legend(draggable=draggable)
    assert leg.get_draggable() is draggable


File: lib/matplotlib/tests/test_legend.py
Line number range: 1200 - 1230
Content:
1200.     _markers = ['.', '*', 'v']
1201.     fig, ax = plt.subplots()
1202.     lines = [mlines.Line2D([0], [0], ls='None', marker=mark)
1203.              for mark in _markers]
1204.     labels = ["foo", "bar", "xyzzy"]
1205.     markers = [line.get_marker() for line in lines]
1206.     legend = ax.legend(lines, labels)
1207. 
1208.     new_markers = [line.get_marker() for line in legend.get_lines()]
1209.     new_labels = [text.get_text() for text in legend.get_texts()]
1210. 
1211.     assert markers == new_markers == _markers
1212.     assert labels == new_labels
1213. 
1214. 
1215. @check_figures_equal()
1216. def test_ncol_ncols(fig_test, fig_ref):
1217.     # Test that both ncol and ncols work
1218.     strings = ["a", "b", "c", "d", "e", "f"]
1219.     ncols = 3
1220.     fig_test.legend(strings, ncol=ncols)
1221.     fig_ref.legend(strings, ncols=ncols)

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 04:40:24,741 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user has requested the full content of the file 'lib/matplotlib/tests/test_legend.py'. This context is a part of that file.", relative_path='lib/matplotlib/tests/test_legend.py', start_line=1, end_line=500), ContextOutput(reasoning="The user has requested the full content of the file 'lib/matplotlib/tests/test_legend.py'. This context is a part of that file.", relative_path='lib/matplotlib/tests/test_legend.py', start_line=1035, end_line=1040), ContextOutput(reasoning="The user has requested the full content of the file 'lib/matplotlib/tests/test_legend.py'. This context is a part of that file.", relative_path='lib/matplotlib/tests/test_legend.py', start_line=1200, end_line=1221)]
2025-12-21 04:40:24,744 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of the file lib/matplotlib/tests/test_legend.py.
2025-12-21 04:40:24,744 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 04:40:24,744 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 04:40:24,745 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 2 existing contexts
2025-12-21 04:40:24,745 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 5 total contexts (removed 0 duplicates)
2025-12-21 04:40:24,745 - thread-132654548649664.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-21 04:40:24,746 - thread-132654548649664.prometheus_context_collector - INFO - Successfully retrieved 5 context snippets
