2025-12-21 18:39:37,436 - thread-132499082577600.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Statement created by _create_unique_sql makes references_column always false

Description: Description
	
This is due to an instance of Table is passed as an argument to Columns when a string is expected.

Patch information:
diff --git a/django/db/backends/base/schema.py b/django/db/backends/base/schema.py
index ad2f5a7da1..4c018624fb 100644
--- a/django/db/backends/base/schema.py
+++ b/django/db/backends/base/schema.py
@@ -1251,7 +1251,7 @@ class BaseDatabaseSchemaEditor:
         else:
             sql = self.sql_create_unique
         if columns:
-            columns = self._index_columns(table, columns, col_suffixes=(), opclasses=opclasses)
+            columns = self._index_columns(model._meta.db_table, columns, col_suffixes=(), opclasses=opclasses)
         else:
             columns = Expressions(model._meta.db_table, expressions, compiler, self.quote_value)
         return Statement(


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 18:39:37,530 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── explicit_default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── explicit_default_config_empty_apps
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── explicit_default_config_mismatch_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── not_apps.py
    |   ├── explicit_default_config_without_apps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_autoreloader.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Statement created by _create_unique_sql makes references_column always false

Description: Description
	
This is due to an instance of Table is passed as an argument to Columns when a string is expected.

Patch information:
diff --git a/django/db/backends/base/schema.py b/django/db/backends/base/schema.py
index ad2f5a7da1..4c018624fb 100644
--- a/django/db/backends/base/schema.py
+++ b/django/db/backends/base/schema.py
@@ -1251,7 +1251,7 @@ class BaseDatabaseSchemaEditor:
         else:
             sql = self.sql_create_unique
         if columns:
-            columns = self._index_columns(table, columns, col_suffixes=(), opclasses=opclasses)
+            columns = self._index_columns(model._meta.db_table, columns, col_suffixes=(), opclasses=opclasses)
         else:
             columns = Expressions(model._meta.db_table, expressions, compiler, self.quote_value)
         return Statement(


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 18:40:39,015 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to a bug in `_create_unique_sql` in `django/db/backends/base/schema.py`. This bug affects the creation of unique constraints. To find relevant tests, I need to examine test files that cover schema modifications, particularly the creation of unique constraints. The file `tests/schema/tests.py` is the most likely candidate to contain such tests as it should directly test the `SchemaEditor` class. The current context is empty, so I need to request this file.' query='Please provide the full content of `tests/schema/tests.py`.' extra_requirements='If the file is too large, please provide all tests related to unique constraints, indexes, or the `create_model` method.' purpose='This file is needed to find test cases that exercise the creation of unique constraints, which is where the reported bug occurs.'
2025-12-21 18:40:39,016 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/schema/tests.py`.
2025-12-21 18:40:39,016 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 18:40:39,017 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 18:40:39,017 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 18:40:39,017 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/schema/tests.py`.
Extra requirements: If the file is too large, please provide all tests related to unique constraints, indexes, or the `create_model` method.
Purpose: This file is needed to find test cases that exercise the creation of unique constraints, which is where the reported bug occurs.
2025-12-21 18:40:43,591 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/schema/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'930cf7d0-7f9b-4b53-85fb-f201ba357895': 'CooMAY89a19pkMuqLLbITgZcNcXk/7CnXngUMJhUCMy/1GSDfij1Mz2jiTiAK3WZrFmAIEfPIIE9Oo1vPreEBxznvkoJAtO8WbrPyzPbVdVJqQ1DsV6kfh7o3STJnaplFHm/+1Oi6r4+wZ19NtMWuh8neSBiUkeVsyqkT5GG5m/2RL6sjeXXOc5rRwBmNu49Umwzl0LgFWUAi2RHulBwaoj5H9kgBjnfLCTMXB2AnZ0yRgXoE+0jWsurc41MY89jK+ciTqxWVcVxfePvgEIC4nptGfNvpCGbLMWUtG4QrNZW2pBOjduiqnldzeazabOvBsM/XlCF5YVug4INQzGD5dpjjRY05ismvMDrp5HrDBiVqPrEbFlOcOEb2BrPmkPciXy1xThYAuFsZlHC4ifOg+JlrVGQTvQc2XsPDFUtKJX/VUeo6CPOdm+tBbfdT86nL2FGLhsw0VX1pibmDtohK0j3/rABcE5S4iPBaqURe4IEZo4E/Yod0SKSmkQ5kZjHM7xv+UV5U98WQx5M+K3hrg2JEord5Dlx164ggec5uo2TMl61L2VOTa0b94fqW8sgBQemp4P2WoGMIXSGjbuFZZWJ0bvomr5SgH1a0P930iWJYba+aI/eiNR6VrQJf9Vhu9itL9jahd5pA8iSCCwqe83LqN0pNLqMLAZfY0mfvpwcMMRKTtiLK1Zpq97rR9hAjnra37AgJHoZqez8KJIehW6uz0OpM4iCLok/aegysTCEZrSJHSUGPexOSxDMPijbbL3JTge1ZREGLFgzG96u+lh4v7qbWRM/ZGsLEhefHdC1yBT5HrBv5R2pcyOLBQHFrQMIhyPoQ0u/bn/b1N47unWYmCZa2pSw3LULB/3gvgn2eE/g0dYMnB+LVAU+QxSHsB5/ECdhtel0V0Fy53tEtM5LCSiKliNHQHsTIZQojR4FgS2kYA19Ks/kJLO07YkPROZd8JqvQMUTkS4dQ+FQrokoDy2CNLtxThRMYccO2T1ufaLymcL9W8eYpaNh9ttoOjhZFGDT4NUh9kF1Bl+OZaRMcQlavT65KNfZ6m1p7sJmrUKDSn6oSuNNqS3w8vHoQqG0w2rvuR5oy2FFynj0jQpO8Qkv/PexZLL8Zyh3N1516oUNPfqGCVuGU3nKTYmuw1BGQAgVa8GDnb8FzzvrUp3t8DCZKkExVYmjJLIaH1WJ08M94q2GDe43W7WaJNIGrcZNuJKCYa93xasP3pEsE49wzTNLa5xZtIE9ryiJawk27SxVgzFeVj+hHxcKP6Ag3g8A3rrWGKg7iZxz1/vwCsl/rL4qlJBraUZTXL6vaVs8let0Mak8hHA5pxJc5HRPA8uAZ6zZXwjDplLzZeEc/Log0zW1dvkpV1N09WWPehimKU2wjcFUCifhji8LiK3vC2jpJkYswAyzhu0tYOd/53hwFpLNBLHniAjkJyDkyRXscfgLrclN3FTk/qq9hMvXyk7HM1TO3+r5rerBoVh0+qKhTWyaEJIlze0EBvDdKA0eyReg35Ww6CmhBJj1qIg5dnmOPXZ4UMQSuikRAdSFCkrjkfiKmarLdiIqOamg/yTosLaKvdsrchBdWS+tuCM4b7YftyyRavnUAUyKRh8sKZdnR+vRXb6IaR2mPXco3JvEAf4QbiAFYs2F9/CM+NyambRfU+zQbRDpR5erRyWKe6OjT2A/CPBJ+9CXh5GDtrBhOlwk48EDe/kpjrqpM6kNRl3gLI0zovzWJ615txuamBoTzYGuLUCqMSzyCCaG44N2JpB6B3EA6eWx/sRKtLaMtMxHnilI9AdwiOk6H+685BnN0pjU4I1yDMUEyGLEoxFlebsvs/TBFBj1XLfHhBTiDo/Y7d3aO/Fa5Cf3NjFVSZFtFyQ8qazvAys0g6Z2lKLfvl0jKfa3Ub8jgglMjYvwYVMqSQpa3P5tACMbbc3doIetKBOnMR3RnKumoQ62vJHgQK5MHSpLh6SRmesxXBKuMUnkJS+/M5rlEwQq2fgIKWViA2o34QZdiEYlw19IcCxwzHckJyqSRNptJdG9QUtaSxrzSLdevkRLUgvwOg=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2130, 'candidates_token_count': 21, 'total_token_count': 2567, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2130}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 21}], 'thoughts_token_count': 416, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.4268351055326915, 'model_name': 'gemini-2.5-pro'} id='run--a524b513-cb35-4526-9466-700e41943cac-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/schema/tests.py'}, 'id': '930cf7d0-7f9b-4b53-85fb-f201ba357895', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2130, 'output_tokens': 21, 'total_tokens': 2567, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 416}}
2025-12-21 18:41:36,253 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "create_model", "relative_path": "tests/schema/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'731d9fd7-4ee5-4920-9e6c-6e6b5611f625': 'CuYEAY89a1+A+WvFDaX+4LCX+y9V69g2uMAcB2hNHdJvqfLM5zMqKLcTcDScIVlBAl5NMowtfVAM5xcueCIcCm4SwWWsicDXdK8dyWsFVJRaKEt9S4aJ/cpTNiGxw1owcvS7bmm3Wa/jgBJIU6n0LAQ/UdUQKNrdTDLdFrl2ocYRx8/Z+pBdru3pALkSE5v4cgK4PJMztWvJ5Idyrz6XrSWFAS4pDM1SZbIxIjTanzvoIAKg48TKmry1esflr0vnRe2z5OhA0NG28Pq2bXFQMj1TXTlYCsurXL4frPb815twEsQSI69WKCgSUACd0bsoy2RwkevkD2rgz2bbWCTQmaPsARkxyomilysEJfw3Trg+LbwmZruH4F/pTtaiLuIxHGfL9JJ/2Zy6a+yEAN3305J6HaN5ARsaPeUU4JKCAPh11Q21O+DogQAHWda8/LF8g1pSdLMyrtin5pHlBgPff0wpYIbU6sYBzAwWSoweWiyVJ/xZCdgNU/1SODw1w9ev978EjBVt8MrERMkeNA2q05DC3EU56wzj7S0RXJVA7OnQDaoKuCkMNjAi5rOqoaA6oxGpz8D452UBJ1uFCVukIkBUcKeocM03mmhmwUel2uVZMa1UjMXSQlYS1pnxst5YqKOjpWFhNFgU6J5n3BPYG6S9MCSQnzLDfQDWkXm8x59hI5DovTp+136REC8BB4ja9Dtz30rCoV0LHkIo1fhFQpRtiTNlx9655boGwetVIkCdsSfwJIlChDZByLzoflZqGpPZ/4pOqcuNEUdRfr+yWJnVRzP7FOwYkT/h4naFmvHq1Qrj3mdj6uw='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10131, 'candidates_token_count': 33, 'total_token_count': 16275, 'cached_content_token_count': 1857, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10547}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1857}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 33}], 'thoughts_token_count': 6111}, 'finish_reason': 'STOP', 'avg_logprobs': -18.816300825639203, 'model_name': 'gemini-2.5-pro'} id='run--28b26106-ef0d-49a3-8615-c40cae05c938-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'create_model', 'relative_path': 'tests/schema/tests.py'}, 'id': '731d9fd7-4ee5-4920-9e6c-6e6b5611f625', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10131, 'output_tokens': 33, 'total_tokens': 16275, 'input_token_details': {'cache_read': 1857}, 'output_token_details': {'reasoning': 6111}}
2025-12-21 18:41:41,908 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "unique constraint", "relative_path": "tests/schema/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'91f3720f-c0ca-4b30-a3c1-14d43decd813': 'CqsGAY89a18dB1yJnMrxT41uJX4jrlQTylXkQ7mWQMEEMw3FMPHxcd0nVAy/CSYLwNWllYtYkwOw8HmENfhVhslq22qS61J0zg/cHUsslaUKVOcq4m0iPwivQ2jBj0PpLpSdxE+beDm5SGQbsafL1KVPJeY+By9VymL5cLg64S400FSKMJxmiyIWzwjMfLlIWrdyuixmVgQ8/+BIe+uPkkETSqleKFO6J7LdGn3sQE8vFXQk7RoL5yY0EhsPfXCk4S7mPmFj9OgpzsmzbahwlXuTU64zO8LxFwgyllKsKMok+TEu1NtJdB1WhSo5xdm9nrM9ipWfoeCu1s+//Sj/+4WpGAn9bc9pvrmmsZhOf33N+vF0x6mY6yNVBGYu+12v6LIP5Hn+QSPDpFfktuyH34yvdRUE+chM6vlYBCxkM/nOVLKX+0VQohlzrS0ha9ptNM8Py5hRf7qWSlvnHHkQK7bP8nBQz72A+XX59Rg/n4lBwxzukvV+OmtXdolJHTZvI6T43sbFYYamx5URysbocbTilQdJrHBDPESeFsuhMKpClABABbt1odI6Ylcp/2mlF1ZF3IJLUHxTw94ynfw20y2VaLqqpBab/4bU33wSpLcxJyIoJxrZo7DDva9uMgUL1a+jiWf+JkKFPPV8eliauiGRTK3o0kOlnnzzc7f+aIdTUfgTokay/ijogeJ0zyxiVst3B1pNcEqth/RPsYiw6whnAq9JEkQ86jMJvLgVi9Sjc7u2j0SES4BMW+I34gHn8NVbl8fg/YE9V6IfFIH9YiyewCYFJqHuJdBVylgDmHKa4ZmriXFyGUW6BRgpLeWpLWJo+G3tZckg7NrnkpL7vlqJnObcfVX/kZ3v0lPldwPJMZLh4encoakntzi/QJUgsItALrJPQ25GXKwy5ZbGWBc4VOnxDLgkObn3XUBiQkufBEDh9XH5u+wMu0PJevWckVY4QwLam2/cMLYQAcrL/BEtmTMWdkmJkqULISnVQ8xDkXoNyjwib/HfSQgz4KY52rcnLOHQfFOJoxskbb2h9WzEGQtcPonl58Xef8RreFa+ZRI5pUNswFzuAEa0Ow=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 62450, 'candidates_token_count': 32, 'total_token_count': 62689, 'cached_content_token_count': 62801, 'prompt_tokens_details': [{'modality': 1, 'token_count': 63016}], 'cache_tokens_details': [{'modality': 1, 'token_count': 62801}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 207}, 'finish_reason': 'STOP', 'avg_logprobs': -1.1754080057144165, 'model_name': 'gemini-2.5-pro'} id='run--44420073-001b-4dca-a56f-9e46eefb035a-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'unique constraint', 'relative_path': 'tests/schema/tests.py'}, 'id': '91f3720f-c0ca-4b30-a3c1-14d43decd813', 'type': 'tool_call'}] usage_metadata={'input_tokens': 62450, 'output_tokens': 32, 'total_tokens': 62689, 'input_token_details': {'cache_read': 62801}, 'output_token_details': {'reasoning': 207}}
2025-12-21 18:41:45,965 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_type_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/schema/tests.py", "type": "function_definition"}'}, '__gemini_function_call_thought_signatures__': {'01f68667-2cfe-418a-a58f-f2bdaa7c77de': 'CpsEAY89a1+zfQvNP/TVrKVMGhntwPW1dYchtuiRLH4q/87TX7TiovNbeJKKPLEA18rgJzcCMRlOA7y1hIIoALEvrSOKvsuOmJPD2u7XfJ9faWjFXNoDZT0Kk6Y2r2i7KY8i2DRilnyWaAbJLI48F4tk0/n/BaE1xFRb/jNE16FzsdRvehapozTq8pC3asNcKE2NZ7zY9VBm/BkYUpSX67aK68sTMnbF2apKQGG7jinAfo1Ek+fHBa2hXJ4nUmb0Srz+Neh5qSAkOuwCQRz+c8G1Z7nBK/nCL0MB84d3ApEH5KooHMm3mXpUSGgIzhkhTxJ7/Y8tyXd5eKjgAtS1aGJ9/19jmZTsTyCeNcOmIz2K0v/8nXXo8A+qBe6ZZcfuO4rD0VsJybpEuYuBC3azK4ch3YePyQyHGhEc2DKWRIT+JDXmclotDKdwkAnXa4Q3q0KXI2UgsqyYVEO8rLFdUv1OeQAAsDlhUqFFl0VEj2RPQkuMHZ9PZ+eTnkv/4KLSxLLLj9Rv7IkuoR3ZWeYryFFEu7GWnFIvSRJ1TJMzgNJHpQxtgJZs0Pj5xKrPvrkp3l85zsZffPL3Ietsql5jdJRwJdMCYEYXha3HH2NKfLXzwdASv/fYj3LYYAHytaU/E6tCb/TYaHp9gjk94yDCC1Oiv8uOat4jNEaaU0GrdqM0aqQp3tm4RH8cixFHtiMFFJnTgq7m0VFBKKxMP34='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 114768, 'candidates_token_count': 33, 'total_token_count': 114905, 'cached_content_token_count': 63129, 'prompt_tokens_details': [{'modality': 1, 'token_count': 115541}], 'cache_tokens_details': [{'modality': 1, 'token_count': 63129}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 33}], 'thoughts_token_count': 104}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4570678942131274, 'model_name': 'gemini-2.5-pro'} id='run--ea95e947-9eed-43a5-b833-3a3f95184ff7-0' tool_calls=[{'name': 'find_ast_node_with_type_in_file_with_relative_path', 'args': {'relative_path': 'tests/schema/tests.py', 'type': 'function_definition'}, 'id': '01f68667-2cfe-418a-a58f-f2bdaa7c77de', 'type': 'tool_call'}] usage_metadata={'input_tokens': 114768, 'output_tokens': 33, 'total_tokens': 114905, 'input_token_details': {'cache_read': 63129}, 'output_token_details': {'reasoning': 104}}
2025-12-21 18:41:50,820 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "UniqueConstraint", "relative_path": "tests/schema/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'3d9a5700-c0dc-4585-81f8-da1f6a734a5f': 'CoYHAY89a1/bpngzcOcmC5wwwaDVjV4F7azArT2Ccw+uPbK6E5cXPtwyN7Tbn5Zcdk6kE6NdaPZw7173xpQ5AXIfasHOUm6Bavm230b824IEdt1/wJ5HTf8e42HeICbodAR9psDeSPKBbpF3entS2ISxbhJ6XV1I4S+gScNskxsfcYTXmZpAundppyqOEbjtQcDE3aBAM3ag+JxWH47vip47+0mKbYyDKZjyccDBh5ISQZxnKIHEirHOWwnF0YD7pxCts02IY+JxmzSRGx+DA3/QC/B/WNRDPNj9Eo/wUqBTN4Qvb43huJT1zhGN6kRBLUNlxMPeumDsMyHJMEodwCwXHBzfObChFFl6bwGRkrD3ga5SyeJRtRhMKzkrD85w2HgCwUekZcOxeeHSrd3Clg7fAwRTp8bQIb/wSkY9D0ZwqFef//uGdhF8McdQVls8XrCrii4m3kciPQN05nBWMmS82CpJzLDKz2Al3bTDH3oIzpGxYo0p5px23TU2AyeANWR9xDyGcNwB+93dHeoB2QbmH12kY43gw1TUkK4DGC9kWnf498Opm4YDYPKCO40RLdOZQc3bDhtdOirBzTlfX78kLsct8x1zw2LmJzCGuM3ExMdAjKxlEDegWcR6lePXkHGXdoMhTJ8C2mzkH0U+VfWs/v51Tl1ym882RG1hPrJRFPu3bJHZj1IwKu7XHWWLks5WDUQqEPRQ9Ed4JarXriupopi5/URhaAPXULJNs3yH+qJcBzGQBNAC+djFO9qBd1hUZZkgu0JbIANQEnsM504LmuND36gc4YPsfWw7pBa4vDjTXRZ+RD6POs7mR7j6WILrjmdwzy/q0reLT0tdbfxC6TF7xsjxCdZURMKfIocaw3WVRThluNT5hG0ifMRdFVpMAaJl2vXQ2BdgGsfDORGv3Qj1XER3earzOoJq1isfkvVSjdNZ18c2kMN0PKlmv7x0fdXGFlVVZeXteUkWjVh05K/Qh6Kd6Gs0eqW8ZOEe9LBnpoQIMRywSIntZmaI67NrAtHb9l2aOiAqkluAbClCKjR1B03spUxfkj/rs7z0Ny/hrDiopd6+9jz81jpAwVXwxiQI0fYH9PpetDZwWlYONn1HiuOqHEZPGCZjEiPrDW2AVAnb3CF+AvMWJ2yoUAMqo6/CKs8YkuAMfOzENz2Rcvvuvo4TGZZa/ejr6LD2HQNaKg9CdeM='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 114833, 'candidates_token_count': 32, 'total_token_count': 115076, 'cached_content_token_count': 114391, 'prompt_tokens_details': [{'modality': 1, 'token_count': 115710}], 'cache_tokens_details': [{'modality': 1, 'token_count': 114391}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 32}], 'thoughts_token_count': 211}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7988117337226868, 'model_name': 'gemini-2.5-pro'} id='run--6699d7c2-7a23-470c-9d12-bdde6fc6a8ed-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'UniqueConstraint', 'relative_path': 'tests/schema/tests.py'}, 'id': '3d9a5700-c0dc-4585-81f8-da1f6a734a5f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 114833, 'output_tokens': 32, 'total_tokens': 115076, 'input_token_details': {'cache_read': 114391}, 'output_token_details': {'reasoning': 211}}
2025-12-21 18:41:58,170 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1.0, "relative_path": "tests/schema/tests.py", "end_line": 4500.0}'}, '__gemini_function_call_thought_signatures__': {'5617b33d-b6c7-4f7d-885e-8140bf3a9a6e': 'CrgJAY89a18bnUflL27JMZGW/b1TVRIEFdoufjOVmwyHRlOmmUUkQ7JVnnBNqueMUK6+ZCXAR0f/vaVkjWem6I/X73VO1sW5Q/kzQKvwf0JMbLCHhstzoiUVQDTtse8vyqwWtmM+9iufHOUFPerpbLAkidkCZmNNQ59C9K0seXRls30F7ltl5Xr8D5g1E2E1OM7UKJfiXnNdsuUwuSKzNwWQ5TrcoNgp394eVacUhq0Cvozoepg4ASPwsnvLRwNHKXDSMOyQXWcY2zhHatkLDNlFLETZlHVBouqFE1lFcolHprik7amOoH8r/OjFS2USi22/dchHpyLLhf5rXJ6pkbzX3B/vVOi0kTzeYm8iiEmi+74e6Rpsj/5rZnEpCbl9coxKEkNSlqZtmVel7v+9fdJ4Tcmjb9ITCTD0WJCqXEVNLB237HNNCw/V9OO+fQwD02IAmZNF8uW7L+BcH+eyQgsNyj3YzNHb21lc3VfQK7S2h+1cLmRou6m442QSPw958HEjnLsP+5plb892SySF2KOTZHwPVtutSZxNBw5ZcR2UQet1BViAUmSVhaIC1gBs6Pu3U7mxA2b957jDRIjIZhPqmEmatIJTADaJs3Vk8F53qd8f4YgDNKdxj1RCyZGv3KcxT/WBW1vwpwH64OUcyp6smv2mBo2Ibw5DCtzGsow6JA/yyKzYdlo/zKwwZKgVsn7LUEPWYfV6pYatj4UGiEitKjvYaAT/uo+Rzz2PegZpw2bxH9eexBUc5YlhcVXug9PWusXN0C5rXD/5AR1Zw9J3gNOQkbAou7QFkcKVR6EISZZ5DI08mcPIQnuBQE80/Zk6mclzk/MlGo8aknM+P4KCU115DoUG1QO3XgunduhuYde+sLfWQqvorgxv/Fk7gaEZl4vCf0ZlIZpIgHGXbjmgP+CEF1owihMp2vP6GrqkCkQKi/n2Rwvsyy+V4mR3VX+1fR5SX3Cz21PpYZa5scbROZQoZLgofn0BH3WUXNG9juazKAOTjLmDF7KPekbReXa2v7D8MIGErx367t6KXYwidMx+mzEJEjiPd8fHn4nWjT6V8aLuq15SKJY1yzmkAkTfZ92rq5Qcp5ZpGsFso+B0nBhbI6eQZV5FtUNkSKO2sV+ARTjQUBTzId63YeUoX1/WNkVgCxSiQFWl9K+miVwzbLrk9mSCUDAO1NRspRD1A3ZXUKHvUBbhedxXZe23IlGf5YC9YBwk4rVIDl4dFbSE8gPiO9MboMgmLtOO160G5sY73YqiGBNY/I5OLCQPNEnJLsHxNblKlk0WggeXrHWSVzAKdDoWZDaTdFYllf/xwILcg8bEwnFGFoy0uaroEHVt90lZp5jyYOP6UHQlsVqaBvR6nmZ1N/XOaSz8L8LpGWW82Sb3QQRNJfG/8PDPaqgo34ky8guJyJuvP8ibSpPzGsp2Cozj51bbQpV39PWLSpL2m5s91NA2jd51SQ5BoaiU3+h+dauCFiZNEeuFOHgi0PHTAez2ADP9cl1srSePA1koEJOs/0LbDwdPKJbWbknKKR7hcjUV/3enO77+cVFiqtyFSIv1cOgPxmG4ocAJ8ZGpir9/C+Vp6XG03B7jflN+jrTHyN9mbB8='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 167360, 'candidates_token_count': 27, 'total_token_count': 167725, 'prompt_tokens_details': [{'modality': 1, 'token_count': 168448}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 27}], 'thoughts_token_count': 338, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0292241838243272, 'model_name': 'gemini-2.5-pro'} id='run--fa466201-a8b5-41dc-9cda-0ca45f62c82c-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1.0, 'relative_path': 'tests/schema/tests.py', 'end_line': 4500.0}, 'id': '5617b33d-b6c7-4f7d-885e-8140bf3a9a6e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 167360, 'output_tokens': 27, 'total_tokens': 167725, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 338}}
2025-12-21 18:42:08,060 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the content of `tests/schema/tests.py`. The file is quite large, so I have extracted the specific tests related to unique constraints, indexes, and the `create_model` method as you requested. I have found several test functions that cover creation and deletion of models, unique constraints, and indexes. I have also included tests for more specific cases like functional unique constraints and indexes on text fields.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 239340, 'candidates_token_count': 87, 'total_token_count': 239921, 'cached_content_token_count': 166635, 'prompt_tokens_details': [{'modality': 1, 'token_count': 240766}], 'cache_tokens_details': [{'modality': 1, 'token_count': 166635}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 87}], 'thoughts_token_count': 494}, 'finish_reason': 'STOP', 'avg_logprobs': -0.693524020841752, 'model_name': 'gemini-2.5-pro'} id='run--18f8a7a7-35d1-4c8f-a872-3744d1a5e5d1-0' usage_metadata={'input_tokens': 239340, 'output_tokens': 87, 'total_tokens': 239921, 'input_token_details': {'cache_read': 166635}, 'output_token_details': {'reasoning': 494}}
2025-12-21 18:42:08,065 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/schema/tests.py`.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If the file is too large, please provide all tests related to unique constraints, indexes, or the `create_model` method.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
This file is needed to find test cases that exercise the creation of unique constraints, which is where the reported bug occurs.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/schema/tests.py
Line number range: 1 - 4500
Content:
1. import datetime
2. import itertools
3. import unittest
4. from copy import copy
5. from unittest import mock
6. 
7. from django.core.exceptions import FieldError
8. from django.core.management.color import no_style
9. from django.db import (
10.     DatabaseError, DataError, IntegrityError, OperationalError, connection,
11. )
12. from django.db.models import (
13.     CASCADE, PROTECT, AutoField, BigAutoField, BigIntegerField, BinaryField,
14.     BooleanField, CharField, CheckConstraint, DateField, DateTimeField,
15.     DecimalField, F, FloatField, ForeignKey, ForeignObject, Index,
16.     IntegerField, JSONField, ManyToManyField, Model, OneToOneField, OrderBy,
17.     PositiveIntegerField, Q, SlugField, SmallAutoField, SmallIntegerField,
18.     TextField, TimeField, UniqueConstraint, UUIDField, Value,
19. )
20. from django.db.models.fields.json import KeyTextTransform
21. from django.db.models.functions import Abs, Cast, Collate, Lower, Random, Upper
22. from django.db.models.indexes import IndexExpression
23. from django.db.transaction import TransactionManagementError, atomic
24. from django.test import (
25.     TransactionTestCase, skipIfDBFeature, skipUnlessDBFeature,
26. )
27. from django.test.utils import (
28.     CaptureQueriesContext, isolate_apps, register_lookup,
29. )
30. from django.utils import timezone
31. 
32. from .fields import (
33.     CustomManyToManyField, InheritedManyToManyField, MediumBlobField,
34. )
35. from .models import (
36.     Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
37.     AuthorWithDefaultHeight, AuthorWithEvenLongerName, AuthorWithIndexedName,
38.     AuthorWithIndexedNameAndBirthday, AuthorWithUniqueName,
39.     AuthorWithUniqueNameAndBirthday, Book, BookForeignObj, BookWeak,
40.     BookWithLongName, BookWithO2O, BookWithoutAuthor, BookWithSlug, IntegerPK,
41.     Node, Note, NoteRename, Tag, TagIndexed, TagM2MTest, TagUniqueRename,
42.     Thing, UniqueTest, new_apps,
43. )
44. 
45. 
46. class SchemaTests(TransactionTestCase):
47.     """
48.     Tests for the schema-alteration code.
49. 
50.     Be aware that these tests are more liable than most to false results,
51.     as sometimes the code to check if a test has worked is almost as complex
52.     as the code it is testing.
53.     """
54. 
55.     available_apps = []
56. 
57.     models = [
58.         Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
59.         AuthorWithDefaultHeight, AuthorWithEvenLongerName, Book, BookWeak,
60.         BookWithLongName, BookWithO2O, BookWithSlug, IntegerPK, Node, Note,
61.         Tag, TagIndexed, TagM2MTest, TagUniqueRename, Thing, UniqueTest,
62.     ]
63. 
64.     # Utility functions
65. 
66.     def setUp(self):
67.         # local_models should contain test dependent model classes that will be
68.         # automatically removed from the app cache on test tear down.
69.         self.local_models = []
70.         # isolated_local_models contains models that are in test methods
71.         # decorated with @isolate_apps.
72.         self.isolated_local_models = []
73. 
74.     def tearDown(self):
75.         # Delete any tables made for our models
76.         self.delete_tables()
77.         new_apps.clear_cache()
78.         for model in new_apps.get_models():
79.             model._meta._expire_cache()
80.         if 'schema' in new_apps.all_models:
81.             for model in self.local_models:
82.                 for many_to_many in model._meta.many_to_many:
83.                     through = many_to_many.remote_field.through
84.                     if through and through._meta.auto_created:
85.                         del new_apps.all_models['schema'][through._meta.model_name]
86.                 del new_apps.all_models['schema'][model._meta.model_name]
87.         if self.isolated_local_models:
88.             with connection.schema_editor() as editor:
89.                 for model in self.isolated_local_models:
90.                     editor.delete_model(model)
91. 
92.     def delete_tables(self):
93.         "Deletes all model tables for our models for a clean test environment"
94.         converter = connection.introspection.identifier_converter
95.         with connection.schema_editor() as editor:
96.             connection.disable_constraint_checking()
97.             table_names = connection.introspection.table_names()
98.             if connection.features.ignores_table_name_case:
99.                 table_names = [table_name.lower() for table_name in table_names]
100.             for model in itertools.chain(SchemaTests.models, self.local_models):
101.                 tbl = converter(model._meta.db_table)
102.                 if connection.features.ignores_table_name_case:
103.                     tbl = tbl.lower()
104.                 if tbl in table_names:
105.                     editor.delete_model(model)
106.                     table_names.remove(tbl)
107.             connection.enable_constraint_checking()
108. 
109.     def column_classes(self, model):
110.         with connection.cursor() as cursor:
111.             columns = {
112.                 d[0]: (connection.introspection.get_field_type(d[1], d), d)
113.                 for d in connection.introspection.get_table_description(
114.                     cursor,
115.                     model._meta.db_table,
116.                 )
117.             }
118.         # SQLite has a different format for field_type
119.         for name, (type, desc) in columns.items():
120.             if isinstance(type, tuple):
121.                 columns[name] = (type[0], desc)
122.         # SQLite also doesn't error properly
123.         if not columns:
124.             raise DatabaseError("Table does not exist (empty pragma)")
125.         return columns
126. 
127.     def get_primary_key(self, table):
128.         with connection.cursor() as cursor:
129.             return connection.introspection.get_primary_key_column(cursor, table)
130. 
131.     def get_indexes(self, table):
132.         """
133.         Get the indexes on the table using a new cursor.
134.         """
135.         with connection.cursor() as cursor:
136.             return [
137.                 c['columns'][0]
138.                 for c in connection.introspection.get_constraints(cursor, table).values()
139.                 if c['index'] and len(c['columns']) == 1
140.             ]
141. 
142.     def get_uniques(self, table):
143.         with connection.cursor() as cursor:
144.             return [
145.                 c['columns'][0]
146.                 for c in connection.introspection.get_constraints(cursor, table).values()
147.                 if c['unique'] and len(c['columns']) == 1
148.             ]
149. 
150.     def get_constraints(self, table):
151.         """
152.         Get the constraints on a table using a new cursor.
153.         """
154.         with connection.cursor() as cursor:
155.             return connection.introspection.get_constraints(cursor, table)
156. 
157.     def get_constraints_for_column(self, model, column_name):
158.         constraints = self.get_constraints(model._meta.db_table)
159.         constraints_for_column = []
160.         for name, details in constraints.items():
161.             if details['columns'] == [column_name]:
162.                 constraints_for_column.append(name)
163.         return sorted(constraints_for_column)
164. 
165.     def check_added_field_default(self, schema_editor, model, field, field_name, expected_default,
166.                                   cast_function=None):
167.         with connection.cursor() as cursor:
168.             schema_editor.add_field(model, field)
169.             cursor.execute("SELECT {} FROM {};".format(field_name, model._meta.db_table))
170.             database_default = cursor.fetchall()[0][0]
171.             if cast_function and type(database_default) != type(expected_default):
172.                 database_default = cast_function(database_default)
173.             self.assertEqual(database_default, expected_default)
174. 
175.     def get_constraints_count(self, table, column, fk_to):
176.         """
177.         Return a dict with keys 'fks', 'uniques, and 'indexes' indicating the
178.         number of foreign keys, unique constraints, and indexes on
179.         `table`.`column`. The `fk_to` argument is a 2-tuple specifying the
180.         expected foreign key relationship's (table, column).
181.         """
182.         with connection.cursor() as cursor:
183.             constraints = connection.introspection.get_constraints(cursor, table)
184.         counts = {'fks': 0, 'uniques': 0, 'indexes': 0}
185.         for c in constraints.values():
186.             if c['columns'] == [column]:
187.                 if c['foreign_key'] == fk_to:
188.                     counts['fks'] += 1
189.                 if c['unique']:
190.                     counts['uniques'] += 1
191.                 elif c['index']:
192.                     counts['indexes'] += 1
193.         return counts
194. 
195.     def get_column_collation(self, table, column):
196.         with connection.cursor() as cursor:
197.             return next(
198.                 f.collation
199.                 for f in connection.introspection.get_table_description(cursor, table)
200.                 if f.name == column
201.             )
202. 
203.     def assertIndexOrder(self, table, index, order):
204.         constraints = self.get_constraints(table)
205.         self.assertIn(index, constraints)
206.         index_orders = constraints[index]['orders']
207.         self.assertTrue(all(val == expected for val, expected in zip(index_orders, order)))
208. 
209.     def assertForeignKeyExists(self, model, column, expected_fk_table, field='id'):
210.         """
211.         Fail if the FK constraint on `model.Meta.db_table`.`column` to
212.         `expected_fk_table`.id doesn't exist.
213.         """
214.         constraints = self.get_constraints(model._meta.db_table)
215.         constraint_fk = None
216.         for details in constraints.values():
217.             if details['columns'] == [column] and details['foreign_key']:
218.                 constraint_fk = details['foreign_key']
219.                 break
220.         self.assertEqual(constraint_fk, (expected_fk_table, field))
221. 
222.     def assertForeignKeyNotExists(self, model, column, expected_fk_table):
223.         with self.assertRaises(AssertionError):
224.             self.assertForeignKeyExists(model, column, expected_fk_table)
225. 
226.     # Tests
227.     def test_creation_deletion(self):
228.         """
229.         Tries creating a model's table, and then deleting it.
230.         """
231.         with connection.schema_editor() as editor:
232.             # Create the table
233.             editor.create_model(Author)
234.             # The table is there
235.             list(Author.objects.all())
236.             # Clean up that table
237.             editor.delete_model(Author)
238.             # No deferred SQL should be left over.
239.             self.assertEqual(editor.deferred_sql, [])
240.         # The table is gone
241.         with self.assertRaises(DatabaseError):
242.             list(Author.objects.all())
243. 
244.     @skipUnlessDBFeature('supports_foreign_keys')
245.     def test_fk(self):
246.         "Creating tables out of FK order, then repointing, works"
247.         # Create the table
248.         with connection.schema_editor() as editor:
249.             editor.create_model(Book)
250.             editor.create_model(Author)
251.             editor.create_model(Tag)
252.         # Initial tables are there
253.         list(Author.objects.all())
254.         list(Book.objects.all())
255.         # Make sure the FK constraint is present
256.         with self.assertRaises(IntegrityError):
257.             Book.objects.create(
258.                 author_id=1,
259.                 title="Much Ado About Foreign Keys",
260.                 pub_date=datetime.datetime.now(),
261.             )
262.         # Repoint the FK constraint
263.         old_field = Book._meta.get_field("author")
264.         new_field = ForeignKey(Tag, CASCADE)
265.         new_field.set_attributes_from_name("author")
266.         with connection.schema_editor() as editor:
267.             editor.alter_field(Book, old_field, new_field, strict=True)
268.         self.assertForeignKeyExists(Book, 'author_id', 'schema_tag')
269. 
270.     @skipUnlessDBFeature('can_create_inline_fk')
271.     def test_inline_fk(self):
272.         # Create some tables.
273.         with connection.schema_editor() as editor:
274.             editor.create_model(Author)
275.             editor.create_model(Book)
276.             editor.create_model(Note)
277.         self.assertForeignKeyNotExists(Note, 'book_id', 'schema_book')
278.         # Add a foreign key from one to the other.
279.         with connection.schema_editor() as editor:
280.             new_field = ForeignKey(Book, CASCADE)
281.             new_field.set_attributes_from_name('book')
282.             editor.add_field(Note, new_field)
283.         self.assertForeignKeyExists(Note, 'book_id', 'schema_book')
284.         # Creating a FK field with a constraint uses a single statement without
285.         # a deferred ALTER TABLE.
286.         self.assertFalse([
287.             sql for sql in (str(statement) for statement in editor.deferred_sql)
288.             if sql.startswith('ALTER TABLE') and 'ADD CONSTRAINT' in sql
289.         ])
290. 
291.     @skipUnlessDBFeature('can_create_inline_fk')
292.     def test_add_inline_fk_update_data(self):
293.         with connection.schema_editor() as editor:
294.             editor.create_model(Node)
295.         # Add an inline foreign key and update data in the same transaction.
296.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
297.         new_field.set_attributes_from_name('new_parent_fk')
298.         parent = Node.objects.create()
299.         with connection.schema_editor() as editor:
300.             editor.add_field(Node, new_field)
301.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
302.         assertIndex = (
303.             self.assertIn
304.             if connection.features.indexes_foreign_keys
305.             else self.assertNotIn
306.         )
307.         assertIndex('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
308. 
309.     @skipUnlessDBFeature(
310.         'can_create_inline_fk',
311.         'allows_multiple_constraints_on_same_fields',
312.     )
313.     @isolate_apps('schema')
314.     def test_add_inline_fk_index_update_data(self):
315.         class Node(Model):
316.             class Meta:
317.                 app_label = 'schema'
318. 
319.         with connection.schema_editor() as editor:
320.             editor.create_model(Node)
321.         # Add an inline foreign key, update data, and an index in the same
322.         # transaction.
323.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
324.         new_field.set_attributes_from_name('new_parent_fk')
325.         parent = Node.objects.create()
326.         with connection.schema_editor() as editor:
327.             editor.add_field(Node, new_field)
328.             Node._meta.add_field(new_field)
329.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
330.             editor.add_index(Node, Index(fields=['new_parent_fk'], name='new_parent_inline_fk_idx'))
331.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
332. 
333.     @skipUnlessDBFeature('supports_foreign_keys')
334.     def test_char_field_with_db_index_to_fk(self):
335.         # Create the table
336.         with connection.schema_editor() as editor:
337.             editor.create_model(Author)
338.             editor.create_model(AuthorCharFieldWithIndex)
339.         # Change CharField to FK
340.         old_field = AuthorCharFieldWithIndex._meta.get_field('char_field')
341.         new_field = ForeignKey(Author, CASCADE, blank=True)
342.         new_field.set_attributes_from_name('char_field')
343.         with connection.schema_editor() as editor:
344.             editor.alter_field(AuthorCharFieldWithIndex, old_field, new_field, strict=True)
345.         self.assertForeignKeyExists(AuthorCharFieldWithIndex, 'char_field_id', 'schema_author')
346. 
347.     @skipUnlessDBFeature('supports_foreign_keys')
348.     @skipUnlessDBFeature('supports_index_on_text_field')
349.     def test_text_field_with_db_index_to_fk(self):
350.         # Create the table
351.         with connection.schema_editor() as editor:
352.             editor.create_model(Author)
353.             editor.create_model(AuthorTextFieldWithIndex)
354.         # Change TextField to FK
355.         old_field = AuthorTextFieldWithIndex._meta.get_field('text_field')
356.         new_field = ForeignKey(Author, CASCADE, blank=True)
357.         new_field.set_attributes_from_name('text_field')
358.         with connection.schema_editor() as editor:
359.             editor.alter_field(AuthorTextFieldWithIndex, old_field, new_field, strict=True)
360.         self.assertForeignKeyExists(AuthorTextFieldWithIndex, 'text_field_id', 'schema_author')
361. 
362.     @isolate_apps('schema')
363.     def test_char_field_pk_to_auto_field(self):
364.         class Foo(Model):
365.             id = CharField(max_length=255, primary_key=True)
366. 
367.             class Meta:
368.                 app_label = 'schema'
369. 
370.         with connection.schema_editor() as editor:
371.             editor.create_model(Foo)
372.         self.isolated_local_models = [Foo]
373.         old_field = Foo._meta.get_field('id')
374.         new_field = AutoField(primary_key=True)
375.         new_field.set_attributes_from_name('id')
376.         new_field.model = Foo
377.         with connection.schema_editor() as editor:
378.             editor.alter_field(Foo, old_field, new_field, strict=True)
379. 
380.     @skipUnlessDBFeature('supports_foreign_keys')
381.     def test_fk_to_proxy(self):
382.         "Creating a FK to a proxy model creates database constraints."
383.         class AuthorProxy(Author):
384.             class Meta:
385.                 app_label = 'schema'
386.                 apps = new_apps
387.                 proxy = True
388. 
389.         class AuthorRef(Model):
390.             author = ForeignKey(AuthorProxy, on_delete=CASCADE)
391. 
392.             class Meta:
393.                 app_label = 'schema'
394.                 apps = new_apps
395. 
396.         self.local_models = [AuthorProxy, AuthorRef]
397. 
398.         # Create the table
399.         with connection.schema_editor() as editor:
400.             editor.create_model(Author)
401.             editor.create_model(AuthorRef)
402.         self.assertForeignKeyExists(AuthorRef, 'author_id', 'schema_author')
403. 
404.     @skipUnlessDBFeature('supports_foreign_keys')
405.     def test_fk_db_constraint(self):
406.         "The db_constraint parameter is respected"
407.         # Create the table
408.         with connection.schema_editor() as editor:
409.             editor.create_model(Tag)
410.             editor.create_model(Author)
411.             editor.create_model(BookWeak)
412.         # Initial tables are there
413.         list(Author.objects.all())
414.         list(Tag.objects.all())
415.         list(BookWeak.objects.all())
416.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
417.         # Make a db_constraint=False FK
418.         new_field = ForeignKey(Tag, CASCADE, db_constraint=False)
419.         new_field.set_attributes_from_name("tag")
420.         with connection.schema_editor() as editor:
421.             editor.add_field(Author, new_field)
422.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
423.         # Alter to one with a constraint
424.         new_field2 = ForeignKey(Tag, CASCADE)
425.         new_field2.set_attributes_from_name("tag")
426.         with connection.schema_editor() as editor:
427.             editor.alter_field(Author, new_field, new_field2, strict=True)
428.         self.assertForeignKeyExists(Author, 'tag_id', 'schema_tag')
429.         # Alter to one without a constraint again
430.         new_field2 = ForeignKey(Tag, CASCADE)
431.         new_field2.set_attributes_from_name("tag")
432.         with connection.schema_editor() as editor:
433.             editor.alter_field(Author, new_field2, new_field, strict=True)
434.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
435. 
436.     @isolate_apps('schema')
437.     def test_no_db_constraint_added_during_primary_key_change(self):
438.         """
439.         When a primary key that's pointed to by a ForeignKey with
440.         db_constraint=False is altered, a foreign key constraint isn't added.
441.         """
442.         class Author(Model):
443.             class Meta:
444.                 app_label = 'schema'
445. 
446.         class BookWeak(Model):
447.             author = ForeignKey(Author, CASCADE, db_constraint=False)
448. 
449.             class Meta:
450.                 app_label = 'schema'
451. 
452.         with connection.schema_editor() as editor:
453.             editor.create_model(Author)
454.             editor.create_model(BookWeak)
455.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
456.         old_field = Author._meta.get_field('id')
457.         new_field = BigAutoField(primary_key=True)
458.         new_field.model = Author
459.         new_field.set_attributes_from_name('id')
460.         # @isolate_apps() and inner models are needed to have the model
461.         # relations populated, otherwise this doesn't act as a regression test.
462.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
463.         with connection.schema_editor() as editor:
464.             editor.alter_field(Author, old_field, new_field, strict=True)
465.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
466. 
467.     def _test_m2m_db_constraint(self, M2MFieldClass):
468.         class LocalAuthorWithM2M(Model):
469.             name = CharField(max_length=255)
470. 
471.             class Meta:
472.                 app_label = 'schema'
473.                 apps = new_apps
474. 
475.         self.local_models = [LocalAuthorWithM2M]
476. 
477.         # Create the table
478.         with connection.schema_editor() as editor:
479.             editor.create_model(Tag)
480.             editor.create_model(LocalAuthorWithM2M)
481.         # Initial tables are there
482.         list(LocalAuthorWithM2M.objects.all())
483.         list(Tag.objects.all())
484.         # Make a db_constraint=False FK
485.         new_field = M2MFieldClass(Tag, related_name="authors", db_constraint=False)
486.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
487.         # Add the field
488.         with connection.schema_editor() as editor:
489.             editor.add_field(LocalAuthorWithM2M, new_field)
490.         self.assertForeignKeyNotExists(new_field.remote_field.through, 'tag_id', 'schema_tag')
491. 
492.     @skipUnlessDBFeature('supports_foreign_keys')
493.     def test_m2m_db_constraint(self):
494.         self._test_m2m_db_constraint(ManyToManyField)
495. 
496.     @skipUnlessDBFeature('supports_foreign_keys')
497.     def test_m2m_db_constraint_custom(self):
498.         self._test_m2m_db_constraint(CustomManyToManyField)
499. 
500.     @skipUnlessDBFeature('supports_foreign_keys')
501.     def test_m2m_db_constraint_inherited(self):
502.         self._test_m2m_db_constraint(InheritedManyToManyField)
503. 
504.     def test_add_field(self):
505.         """
506.         Tests adding fields to models
507.         """
508.         # Create the table
509.         with connection.schema_editor() as editor:
510.             editor.create_model(Author)
511.         # Ensure there's no age field
512.         columns = self.column_classes(Author)
513.         self.assertNotIn("age", columns)
514.         # Add the new field
515.         new_field = IntegerField(null=True)
516.         new_field.set_attributes_from_name("age")
517.         with CaptureQueriesContext(connection) as ctx, connection.schema_editor() as editor:
518.             editor.add_field(Author, new_field)
519.         drop_default_sql = editor.sql_alter_column_no_default % {
520.             'column': editor.quote_name(new_field.name),
521.         }
522.         self.assertFalse(any(drop_default_sql in query['sql'] for query in ctx.captured_queries))
523.         # Ensure the field is right afterwards
524.         columns = self.column_classes(Author)
525.         self.assertEqual(columns['age'][0], connection.features.introspected_field_types['IntegerField'])
526.         self.assertTrue(columns['age'][1][6])
527. 
528.     def test_add_field_remove_field(self):
529.         """
530.         Adding a field and removing it removes all deferred sql referring to it.
531.         """
532.         with connection.schema_editor() as editor:
533.             # Create a table with a unique constraint on the slug field.
534.             editor.create_model(Tag)
535.             # Remove the slug column.
536.             editor.remove_field(Tag, Tag._meta.get_field('slug'))
537.         self.assertEqual(editor.deferred_sql, [])
538. 
539.     def test_add_field_temp_default(self):
540.         """
541.         Tests adding fields to models with a temporary default
542.         """
543.         # Create the table
544.         with connection.schema_editor() as editor:
545.             editor.create_model(Author)
546.         # Ensure there's no age field
547.         columns = self.column_classes(Author)
548.         self.assertNotIn("age", columns)
549.         # Add some rows of data
550.         Author.objects.create(name="Andrew", height=30)
551.         Author.objects.create(name="Andrea")
552.         # Add a not-null field
553.         new_field = CharField(max_length=30, default="Godwin")
554.         new_field.set_attributes_from_name("surname")
555.         with connection.schema_editor() as editor:
556.             editor.add_field(Author, new_field)
557.         # Ensure the field is right afterwards
558.         columns = self.column_classes(Author)
559.         self.assertEqual(columns['surname'][0], connection.features.introspected_field_types['CharField'])
560.         self.assertEqual(columns['surname'][1][6],
561.                          connection.features.interprets_empty_strings_as_nulls)
562. 
563.     def test_add_field_temp_default_boolean(self):
564.         """
565.         Tests adding fields to models with a temporary default where
566.         the default is False. (#21783)
567.         """
568.         # Create the table
569.         with connection.schema_editor() as editor:
570.             editor.create_model(Author)
571.         # Ensure there's no age field
572.         columns = self.column_classes(Author)
573.         self.assertNotIn("age", columns)
574.         # Add some rows of data
575.         Author.objects.create(name="Andrew", height=30)
576.         Author.objects.create(name="Andrea")
577.         # Add a not-null field
578.         new_field = BooleanField(default=False)
579.         new_field.set_attributes_from_name("awesome")
580.         with connection.schema_editor() as editor:
581.             editor.add_field(Author, new_field)
582.         # Ensure the field is right afterwards
583.         columns = self.column_classes(Author)
584.         # BooleanField are stored as TINYINT(1) on MySQL.
585.         field_type = columns['awesome'][0]
586.         self.assertEqual(field_type, connection.features.introspected_field_types['BooleanField'])
587. 
588.     def test_add_field_default_transform(self):
589.         """
590.         Tests adding fields to models with a default that is not directly
591.         valid in the database (#22581)
592.         """
593. 
594.         class TestTransformField(IntegerField):
595. 
596.             # Weird field that saves the count of items in its value
597.             def get_default(self):
598.                 return self.default
599. 
600.             def get_prep_value(self, value):
601.                 if value is None:
602.                     return 0
603.                 return len(value)
604. 
605.         # Create the table
606.         with connection.schema_editor() as editor:
607.             editor.create_model(Author)
608.         # Add some rows of data
609.         Author.objects.create(name="Andrew", height=30)
610.         Author.objects.create(name="Andrea")
611.         # Add the field with a default it needs to cast (to string in this case)
612.         new_field = TestTransformField(default={1: 2})
613.         new_field.set_attributes_from_name("thing")
614.         with connection.schema_editor() as editor:
615.             editor.add_field(Author, new_field)
616.         # Ensure the field is there
617.         columns = self.column_classes(Author)
618.         field_type, field_info = columns['thing']
619.         self.assertEqual(field_type, connection.features.introspected_field_types['IntegerField'])
620.         # Make sure the values were transformed correctly
621.         self.assertEqual(Author.objects.extra(where=["thing = 1"]).count(), 2)
622. 
623.     def test_add_field_binary(self):
624.         """
625.         Tests binary fields get a sane default (#22851)
626.         """
627.         # Create the table
628.         with connection.schema_editor() as editor:
629.             editor.create_model(Author)
630.         # Add the new field
631.         new_field = BinaryField(blank=True)
632.         new_field.set_attributes_from_name("bits")
633.         with connection.schema_editor() as editor:
634.             editor.add_field(Author, new_field)
635.         # Ensure the field is right afterwards
636.         columns = self.column_classes(Author)
637.         # MySQL annoyingly uses the same backend, so it'll come back as one of
638.         # these two types.
639.         self.assertIn(columns['bits'][0], ("BinaryField", "TextField"))
640. 
641.     @unittest.skipUnless(connection.vendor == 'mysql', "MySQL specific")
642.     def test_add_binaryfield_mediumblob(self):
643.         """
644.         Test adding a custom-sized binary field on MySQL (#24846).
645.         """
646.         # Create the table
647.         with connection.schema_editor() as editor:
648.             editor.create_model(Author)
649.         # Add the new field with default
650.         new_field = MediumBlobField(blank=True, default=b'123')
651.         new_field.set_attributes_from_name('bits')
652.         with connection.schema_editor() as editor:
653.             editor.add_field(Author, new_field)
654.         columns = self.column_classes(Author)
655.         # Introspection treats BLOBs as TextFields
656.         self.assertEqual(columns['bits'][0], "TextField")
657. 
658.     def test_alter(self):
659.         """
660.         Tests simple altering of fields
661.         """
662.         # Create the table
663.         with connection.schema_editor() as editor:
664.             editor.create_model(Author)
665.         # Ensure the field is right to begin with
666.         columns = self.column_classes(Author)
667.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
668.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
669.         # Alter the name field to a TextField
670.         old_field = Author._meta.get_field("name")
671.         new_field = TextField(null=True)
672.         new_field.set_attributes_from_name("name")
673.         with connection.schema_editor() as editor:
674.             editor.alter_field(Author, old_field, new_field, strict=True)
675.         # Ensure the field is right afterwards
676.         columns = self.column_classes(Author)
677.         self.assertEqual(columns['name'][0], "TextField")
678.         self.assertTrue(columns['name'][1][6])
679.         # Change nullability again
680.         new_field2 = TextField(null=False)
681.         new_field2.set_attributes_from_name("name")
682.         with connection.schema_editor() as editor:
683.             editor.alter_field(Author, new_field, new_field2, strict=True)
684.         # Ensure the field is right afterwards
685.         columns = self.column_classes(Author)
686.         self.assertEqual(columns['name'][0], "TextField")
687.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
688. 
689.     def test_alter_auto_field_to_integer_field(self):
690.         # Create the table
691.         with connection.schema_editor() as editor:
692.             editor.create_model(Author)
693.         # Change AutoField to IntegerField
694.         old_field = Author._meta.get_field('id')
695.         new_field = IntegerField(primary_key=True)
696.         new_field.set_attributes_from_name('id')
697.         new_field.model = Author
698.         with connection.schema_editor() as editor:
699.             editor.alter_field(Author, old_field, new_field, strict=True)
700.         # Now that ID is an IntegerField, the database raises an error if it
701.         # isn't provided.
702.         if not connection.features.supports_unspecified_pk:
703.             with self.assertRaises(DatabaseError):
704.                 Author.objects.create()
705. 
706.     def test_alter_auto_field_to_char_field(self):
707.         # Create the table
708.         with connection.schema_editor() as editor:
709.             editor.create_model(Author)
710.         # Change AutoField to CharField
711.         old_field = Author._meta.get_field('id')
712.         new_field = CharField(primary_key=True, max_length=50)
713.         new_field.set_attributes_from_name('id')
714.         new_field.model = Author
715.         with connection.schema_editor() as editor:
716.             editor.alter_field(Author, old_field, new_field, strict=True)
717. 
718.     @isolate_apps('schema')
719.     def test_alter_auto_field_quoted_db_column(self):
720.         class Foo(Model):
721.             id = AutoField(primary_key=True, db_column='"quoted_id"')
722. 
723.             class Meta:
724.                 app_label = 'schema'
725. 
726.         with connection.schema_editor() as editor:
727.             editor.create_model(Foo)
728.         self.isolated_local_models = [Foo]
729.         old_field = Foo._meta.get_field('id')
730.         new_field = BigAutoField(primary_key=True)
731.         new_field.model = Foo
732.         new_field.db_column = '"quoted_id"'
733.         new_field.set_attributes_from_name('id')
734.         with connection.schema_editor() as editor:
735.             editor.alter_field(Foo, old_field, new_field, strict=True)
736.         Foo.objects.create()
737. 
738.     def test_alter_not_unique_field_to_primary_key(self):
739.         # Create the table.
740.         with connection.schema_editor() as editor:
741.             editor.create_model(Author)
742.         # Change UUIDField to primary key.
743.         old_field = Author._meta.get_field('uuid')
744.         new_field = UUIDField(primary_key=True)
745.         new_field.set_attributes_from_name('uuid')
746.         new_field.model = Author
747.         with connection.schema_editor() as editor:
748.             editor.remove_field(Author, Author._meta.get_field('id'))
749.             editor.alter_field(Author, old_field, new_field, strict=True)
750. 
751.     @isolate_apps('schema')
752.     def test_alter_primary_key_quoted_db_table(self):
753.         class Foo(Model):
754.             class Meta:
755.                 app_label = 'schema'
756.                 db_table = '"foo"'
757. 
758.         with connection.schema_editor() as editor:
759.             editor.create_model(Foo)
760.         self.isolated_local_models = [Foo]
761.         old_field = Foo._meta.get_field('id')
762.         new_field = BigAutoField(primary_key=True)
763.         new_field.model = Foo
764.         new_field.set_attributes_from_name('id')
765.         with connection.schema_editor() as editor:
766.             editor.alter_field(Foo, old_field, new_field, strict=True)
767.         Foo.objects.create()
768. 
769.     def test_alter_text_field(self):
770.         # Regression for "BLOB/TEXT column 'info' can't have a default value")
771.         # on MySQL.
772.         # Create the table
773.         with connection.schema_editor() as editor:
774.             editor.create_model(Note)
775.         old_field = Note._meta.get_field("info")
776.         new_field = TextField(blank=True)
777.         new_field.set_attributes_from_name("info")
778.         with connection.schema_editor() as editor:
779.             editor.alter_field(Note, old_field, new_field, strict=True)
780. 
781.     def test_alter_text_field_to_not_null_with_default_value(self):
782.         with connection.schema_editor() as editor:
783.             editor.create_model(Note)
784.         old_field = Note._meta.get_field('address')
785.         new_field = TextField(blank=True, default='', null=False)
786.         new_field.set_attributes_from_name('address')
787.         with connection.schema_editor() as editor:
788.             editor.alter_field(Note, old_field, new_field, strict=True)
789. 
790.     @skipUnlessDBFeature('can_defer_constraint_checks', 'can_rollback_ddl')
791.     def test_alter_fk_checks_deferred_constraints(self):
792.         """
793.         #25492 - Altering a foreign key's structure and data in the same
794.         transaction.
795.         """
796.         with connection.schema_editor() as editor:
797.             editor.create_model(Node)
798.         old_field = Node._meta.get_field('parent')
799.         new_field = ForeignKey(Node, CASCADE)
800.         new_field.set_attributes_from_name('parent')
801.         parent = Node.objects.create()
802.         with connection.schema_editor() as editor:
803.             # Update the parent FK to create a deferred constraint check.
804.             Node.objects.update(parent=parent)
805.             editor.alter_field(Node, old_field, new_field, strict=True)
806. 
807.     def test_alter_text_field_to_date_field(self):
808.         """
809.         #25002 - Test conversion of text field to date field.
810.         """
811.         with connection.schema_editor() as editor:
812.             editor.create_model(Note)
813.         Note.objects.create(info='1988-05-05')
814.         old_field = Note._meta.get_field('info')
815.         new_field = DateField(blank=True)
816.         new_field.set_attributes_from_name('info')
817.         with connection.schema_editor() as editor:
818.             editor.alter_field(Note, old_field, new_field, strict=True)
819.         # Make sure the field isn't nullable
820.         columns = self.column_classes(Note)
821.         self.assertFalse(columns['info'][1][6])
822. 
823.     def test_alter_text_field_to_datetime_field(self):
824.         """
825.         #25002 - Test conversion of text field to datetime field.
826.         """
827.         with connection.schema_editor() as editor:
828.             editor.create_model(Note)
829.         Note.objects.create(info='1988-05-05 3:16:17.4567')
830.         old_field = Note._meta.get_field('info')
831.         new_field = DateTimeField(blank=True)
832.         new_field.set_attributes_from_name('info')
833.         with connection.schema_editor() as editor:
834.             editor.alter_field(Note, old_field, new_field, strict=True)
835.         # Make sure the field isn't nullable
836.         columns = self.column_classes(Note)
837.         self.assertFalse(columns['info'][1][6])
838. 
839.     def test_alter_text_field_to_time_field(self):
840.         """
841.         #25002 - Test conversion of text field to time field.
842.         """
843.         with connection.schema_editor() as editor:
844.             editor.create_model(Note)
845.         Note.objects.create(info='3:16:17.4567')
846.         old_field = Note._meta.get_field('info')
847.         new_field = TimeField(blank=True)
848.         new_field.set_attributes_from_name('info')
849.         with connection.schema_editor() as editor:
850.             editor.alter_field(Note, old_field, new_field, strict=True)
851.         # Make sure the field isn't nullable
852.         columns = self.column_classes(Note)
853.         self.assertFalse(columns['info'][1][6])
854. 
855.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
856.     def test_alter_textual_field_keep_null_status(self):
857.         """
858.         Changing a field type shouldn't affect the not null status.
859.         """
860.         with connection.schema_editor() as editor:
861.             editor.create_model(Note)
862.         with self.assertRaises(IntegrityError):
863.             Note.objects.create(info=None)
864.         old_field = Note._meta.get_field("info")
865.         new_field = CharField(max_length=50)
866.         new_field.set_attributes_from_name("info")
867.         with connection.schema_editor() as editor:
868.             editor.alter_field(Note, old_field, new_field, strict=True)
869.         with self.assertRaises(IntegrityError):
870.             Note.objects.create(info=None)
871. 
872.     def test_alter_numeric_field_keep_null_status(self):
873.         """
874.         Changing a field type shouldn't affect the not null status.
875.         """
876.         with connection.schema_editor() as editor:
877.             editor.create_model(UniqueTest)
878.         with self.assertRaises(IntegrityError):
879.             UniqueTest.objects.create(year=None, slug='aaa')
880.         old_field = UniqueTest._meta.get_field("year")
881.         new_field = BigIntegerField()
882.         new_field.set_attributes_from_name("year")
883.         with connection.schema_editor() as editor:
884.             editor.alter_field(UniqueTest, old_field, new_field, strict=True)
885.         with self.assertRaises(IntegrityError):
886.             UniqueTest.objects.create(year=None, slug='bbb')
887. 
888.     def test_alter_null_to_not_null(self):
889.         """
890.         #23609 - Tests handling of default values when altering from NULL to NOT NULL.
891.         """
892.         # Create the table
893.         with connection.schema_editor() as editor:
894.             editor.create_model(Author)
895.         # Ensure the field is right to begin with
896.         columns = self.column_classes(Author)
897.         self.assertTrue(columns['height'][1][6])
898.         # Create some test data
899.         Author.objects.create(name='Not null author', height=12)
900.         Author.objects.create(name='Null author')
901.         # Verify null value
902.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
903.         self.assertIsNone(Author.objects.get(name='Null author').height)
904.         # Alter the height field to NOT NULL with default
905.         old_field = Author._meta.get_field("height")
906.         new_field = PositiveIntegerField(default=42)
907.         new_field.set_attributes_from_name("height")
908.         with connection.schema_editor() as editor:
909.             editor.alter_field(Author, old_field, new_field, strict=True)
910.         # Ensure the field is right afterwards
911.         columns = self.column_classes(Author)
912.         self.assertFalse(columns['height'][1][6])
913.         # Verify default value
914.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
915.         self.assertEqual(Author.objects.get(name='Null author').height, 42)
916. 
917.     def test_alter_charfield_to_null(self):
918.         """
919.         #24307 - Should skip an alter statement on databases with
920.         interprets_empty_strings_as_null when changing a CharField to null.
921.         """
922.         # Create the table
923.         with connection.schema_editor() as editor:
924.             editor.create_model(Author)
925.         # Change the CharField to null
926.         old_field = Author._meta.get_field('name')
927.         new_field = copy(old_field)
928.         new_field.null = True
929.         with connection.schema_editor() as editor:
930.             editor.alter_field(Author, old_field, new_field, strict=True)
931. 
932.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
933.     def test_alter_char_field_decrease_length(self):
934.         # Create the table.
935.         with connection.schema_editor() as editor:
936.             editor.create_model(Author)
937.         Author.objects.create(name='x' * 255)
938.         # Change max_length of CharField.
939.         old_field = Author._meta.get_field('name')
940.         new_field = CharField(max_length=254)
941.         new_field.set_attributes_from_name('name')
942.         with connection.schema_editor() as editor:
943.             msg = 'value too long for type character varying(254)'
944.             with self.assertRaisesMessage(DataError, msg):
945.                 editor.alter_field(Author, old_field, new_field, strict=True)
946. 
947.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
948.     def test_alter_field_with_custom_db_type(self):
949.         from django.contrib.postgres.fields import ArrayField
950. 
951.         class Foo(Model):
952.             field = ArrayField(CharField(max_length=255))
953. 
954.             class Meta:
955.                 app_label = 'schema'
956. 
957.         with connection.schema_editor() as editor:
958.             editor.create_model(Foo)
959.         self.isolated_local_models = [Foo]
960.         old_field = Foo._meta.get_field('field')
961.         new_field = ArrayField(CharField(max_length=16))
962.         new_field.set_attributes_from_name('field')
963.         new_field.model = Foo
964.         with connection.schema_editor() as editor:
965.             editor.alter_field(Foo, old_field, new_field, strict=True)
966. 
967.     @isolate_apps('schema')
968.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
969.     def test_alter_array_field_decrease_base_field_length(self):
970.         from django.contrib.postgres.fields import ArrayField
971. 
972.         class ArrayModel(Model):
973.             field = ArrayField(CharField(max_length=16))
974. 
975.             class Meta:
976.                 app_label = 'schema'
977. 
978.         with connection.schema_editor() as editor:
979.             editor.create_model(ArrayModel)
980.         self.isolated_local_models = [ArrayModel]
981.         ArrayModel.objects.create(field=['x' * 16])
982.         old_field = ArrayModel._meta.get_field('field')
983.         new_field = ArrayField(CharField(max_length=15))
984.         new_field.set_attributes_from_name('field')
985.         new_field.model = ArrayModel
986.         with connection.schema_editor() as editor:
987.             msg = 'value too long for type character varying(15)'
988.             with self.assertRaisesMessage(DataError, msg):
989.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
990. 
991.     @isolate_apps('schema')
992.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
993.     def test_alter_array_field_decrease_nested_base_field_length(self):
994.         from django.contrib.postgres.fields import ArrayField
995. 
996.         class ArrayModel(Model):
997.             field = ArrayField(ArrayField(CharField(max_length=16)))
998. 
999.             class Meta:
1000.                 app_label = 'schema'
1001. 
1002.         with connection.schema_editor() as editor:
1003.             editor.create_model(ArrayModel)
1004.         self.isolated_local_models = [ArrayModel]
1005.         ArrayModel.objects.create(field=[['x' * 16]])
1006.         old_field = ArrayModel._meta.get_field('field')
1007.         new_field = ArrayField(ArrayField(CharField(max_length=15)))
1008.         new_field.set_attributes_from_name('field')
1009.         new_field.model = ArrayModel
1010.         with connection.schema_editor() as editor:
1011.             msg = 'value too long for type character varying(15)'
1012.             with self.assertRaisesMessage(DataError, msg):
1013.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
1014. 
1015.     def test_alter_textfield_to_null(self):
1016.         """
1017.         #24307 - Should skip an alter statement on databases with
1018.         interprets_empty_strings_as_null when changing a TextField to null.
1019.         """
1020.         # Create the table
1021.         with connection.schema_editor() as editor:
1022.             editor.create_model(Note)
1023.         # Change the TextField to null
1024.         old_field = Note._meta.get_field('info')
1025.         new_field = copy(old_field)
1026.         new_field.null = True
1027.         with connection.schema_editor() as editor:
1028.             editor.alter_field(Note, old_field, new_field, strict=True)
1029. 
1030.     @skipUnlessDBFeature('supports_combined_alters')
1031.     def test_alter_null_to_not_null_keeping_default(self):
1032.         """
1033.         #23738 - Can change a nullable field with default to non-nullable
1034.         with the same default.
1035.         """
1036.         # Create the table
1037.         with connection.schema_editor() as editor:
1038.             editor.create_model(AuthorWithDefaultHeight)
1039.         # Ensure the field is right to begin with
1040.         columns = self.column_classes(AuthorWithDefaultHeight)
1041.         self.assertTrue(columns['height'][1][6])
1042.         # Alter the height field to NOT NULL keeping the previous default
1043.         old_field = AuthorWithDefaultHeight._meta.get_field("height")
1044.         new_field = PositiveIntegerField(default=42)
1045.         new_field.set_attributes_from_name("height")
1046.         with connection.schema_editor() as editor:
1047.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
1048.         # Ensure the field is right afterwards
1049.         columns = self.column_classes(AuthorWithDefaultHeight)
1050.         self.assertFalse(columns['height'][1][6])
1051. 
1052.     @skipUnlessDBFeature('supports_foreign_keys')
1053.     def test_alter_fk(self):
1054.         """
1055.         Tests altering of FKs
1056.         """
1057.         # Create the table
1058.         with connection.schema_editor() as editor:
1059.             editor.create_model(Author)
1060.             editor.create_model(Book)
1061.         # Ensure the field is right to begin with
1062.         columns = self.column_classes(Book)
1063.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1064.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1065.         # Alter the FK
1066.         old_field = Book._meta.get_field("author")
1067.         new_field = ForeignKey(Author, CASCADE, editable=False)
1068.         new_field.set_attributes_from_name("author")
1069.         with connection.schema_editor() as editor:
1070.             editor.alter_field(Book, old_field, new_field, strict=True)
1071.         # Ensure the field is right afterwards
1072.         columns = self.column_classes(Book)
1073.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1074.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1075. 
1076.     @skipUnlessDBFeature('supports_foreign_keys')
1077.     def test_alter_to_fk(self):
1078.         """
1079.         #24447 - Tests adding a FK constraint for an existing column
1080.         """
1081.         class LocalBook(Model):
1082.             author = IntegerField()
1083.             title = CharField(max_length=100, db_index=True)
1084.             pub_date = DateTimeField()
1085. 
1086.             class Meta:
1087.                 app_label = 'schema'
1088.                 apps = new_apps
1089. 
1090.         self.local_models = [LocalBook]
1091. 
1092.         # Create the tables
1093.         with connection.schema_editor() as editor:
1094.             editor.create_model(Author)
1095.             editor.create_model(LocalBook)
1096.         # Ensure no FK constraint exists
1097.         constraints = self.get_constraints(LocalBook._meta.db_table)
1098.         for details in constraints.values():
1099.             if details['foreign_key']:
1100.                 self.fail('Found an unexpected FK constraint to %s' % details['columns'])
1101.         old_field = LocalBook._meta.get_field("author")
1102.         new_field = ForeignKey(Author, CASCADE)
1103.         new_field.set_attributes_from_name("author")
1104.         with connection.schema_editor() as editor:
1105.             editor.alter_field(LocalBook, old_field, new_field, strict=True)
1106.         self.assertForeignKeyExists(LocalBook, 'author_id', 'schema_author')
1107. 
1108.     @skipUnlessDBFeature('supports_foreign_keys')
1109.     def test_alter_o2o_to_fk(self):
1110.         """
1111.         #24163 - Tests altering of OneToOneField to ForeignKey
1112.         """
1113.         # Create the table
1114.         with connection.schema_editor() as editor:
1115.             editor.create_model(Author)
1116.             editor.create_model(BookWithO2O)
1117.         # Ensure the field is right to begin with
1118.         columns = self.column_classes(BookWithO2O)
1119.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1120.         # Ensure the field is unique
1121.         author = Author.objects.create(name="Joe")
1122.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1123.         with self.assertRaises(IntegrityError):
1124.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1125.         BookWithO2O.objects.all().delete()
1126.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1127.         # Alter the OneToOneField to ForeignKey
1128.         old_field = BookWithO2O._meta.get_field("author")
1129.         new_field = ForeignKey(Author, CASCADE)
1130.         new_field.set_attributes_from_name("author")
1131.         with connection.schema_editor() as editor:
1132.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1133.         # Ensure the field is right afterwards
1134.         columns = self.column_classes(Book)
1135.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1136.         # Ensure the field is not unique anymore
1137.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1138.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1139.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1140. 
1141.     @skipUnlessDBFeature('supports_foreign_keys')
1142.     def test_alter_fk_to_o2o(self):
1143.         """
1144.         #24163 - Tests altering of ForeignKey to OneToOneField
1145.         """
1146.         # Create the table
1147.         with connection.schema_editor() as editor:
1148.             editor.create_model(Author)
1149.             editor.create_model(Book)
1150.         # Ensure the field is right to begin with
1151.         columns = self.column_classes(Book)
1152.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1153.         # Ensure the field is not unique
1154.         author = Author.objects.create(name="Joe")
1155.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1156.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1157.         Book.objects.all().delete()
1158.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1159.         # Alter the ForeignKey to OneToOneField
1160.         old_field = Book._meta.get_field("author")
1161.         new_field = OneToOneField(Author, CASCADE)
1162.         new_field.set_attributes_from_name("author")
1163.         with connection.schema_editor() as editor:
1164.             editor.alter_field(Book, old_field, new_field, strict=True)
1165.         # Ensure the field is right afterwards
1166.         columns = self.column_classes(BookWithO2O)
1167.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1168.         # Ensure the field is unique now
1169.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1170.         with self.assertRaises(IntegrityError):
1171.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1172.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1173. 
1174.     def test_alter_field_fk_to_o2o(self):
1175.         with connection.schema_editor() as editor:
1176.             editor.create_model(Author)
1177.             editor.create_model(Book)
1178.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1179.         expected_indexes = 1 if connection.features.indexes_foreign_keys else 0
1180. 
1181.         # Check the index is right to begin with.
1182.         counts = self.get_constraints_count(
1183.             Book._meta.db_table,
1184.             Book._meta.get_field('author').column,
1185.             (Author._meta.db_table, Author._meta.pk.column),
1186.         )
1187.         self.assertEqual(
1188.             counts,
1189.             {'fks': expected_fks, 'uniques': 0, 'indexes': expected_indexes},
1190.         )
1191. 
1192.         old_field = Book._meta.get_field('author')
1193.         new_field = OneToOneField(Author, CASCADE)
1194.         new_field.set_attributes_from_name('author')
1195.         with connection.schema_editor() as editor:
1196.             editor.alter_field(Book, old_field, new_field, strict=True)
1197. 
1198.         counts = self.get_constraints_count(
1199.             Book._meta.db_table,
1200.             Book._meta.get_field('author').column,
1201.             (Author._meta.db_table, Author._meta.pk.column),
1202.         )
1203.         # The index on ForeignKey is replaced with a unique constraint for OneToOneField.
1204.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1205. 
1206.     def test_alter_field_fk_keeps_index(self):
1207.         with connection.schema_editor() as editor:
1208.             editor.create_model(Author)
1209.             editor.create_model(Book)
1210.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1211.         expected_indexes = 1 if connection.features.indexes_foreign_keys else 0
1212. 
1213.         # Check the index is right to begin with.
1214.         counts = self.get_constraints_count(
1215.             Book._meta.db_table,
1216.             Book._meta.get_field('author').column,
1217.             (Author._meta.db_table, Author._meta.pk.column),
1218.         )
1219.         self.assertEqual(
1220.             counts,
1221.             {'fks': expected_fks, 'uniques': 0, 'indexes': expected_indexes},
1222.         )
1223. 
1224.         old_field = Book._meta.get_field('author')
1225.         # on_delete changed from CASCADE.
1226.         new_field = ForeignKey(Author, PROTECT)
1227.         new_field.set_attributes_from_name('author')
1228.         with connection.schema_editor() as editor:
1229.             editor.alter_field(Book, old_field, new_field, strict=True)
1230. 
1231.         counts = self.get_constraints_count(
1232.             Book._meta.db_table,
1233.             Book._meta.get_field('author').column,
1234.             (Author._meta.db_table, Author._meta.pk.column),
1235.         )
1236.         # The index remains.
1237.         self.assertEqual(
1238.             counts,
1239.             {'fks': expected_fks, 'uniques': 0, 'indexes': expected_indexes},
1240.         )
1241. 
1242.     def test_alter_field_o2o_to_fk(self):
1243.         with connection.schema_editor() as editor:
1244.             editor.create_model(Author)
1245.             editor.create_model(BookWithO2O)
1246.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1247. 
1248.         # Check the unique constraint is right to begin with.
1249.         counts = self.get_constraints_count(
1250.             BookWithO2O._meta.db_table,
1251.             BookWithO2O._meta.get_field('author').column,
1252.             (Author._meta.db_table, Author._meta.pk.column),
1253.         )
1254.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1255. 
1256.         old_field = BookWithO2O._meta.get_field('author')
1257.         new_field = ForeignKey(Author, CASCADE)
1258.         new_field.set_attributes_from_name('author')
1259.         with connection.schema_editor() as editor:
1260.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1261. 
1262.         counts = self.get_constraints_count(
1263.             BookWithO2O._meta.db_table,
1264.             BookWithO2O._meta.get_field('author').column,
1265.             (Author._meta.db_table, Author._meta.pk.column),
1266.         )
1267.         # The unique constraint on OneToOneField is replaced with an index for ForeignKey.
1268.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1269. 
1270.     def test_alter_field_o2o_keeps_unique(self):
1271.         with connection.schema_editor() as editor:
1272.             editor.create_model(Author)
1273.             editor.create_model(BookWithO2O)
1274.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1275. 
1276.         # Check the unique constraint is right to begin with.
1277.         counts = self.get_constraints_count(
1278.             BookWithO2O._meta.db_table,
1279.             BookWithO2O._meta.get_field('author').column,
1280.             (Author._meta.db_table, Author._meta.pk.column),
1281.         )
1282.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1283. 
1284.         old_field = BookWithO2O._meta.get_field('author')
1285.         # on_delete changed from CASCADE.
1286.         new_field = OneToOneField(Author, PROTECT)
1287.         new_field.set_attributes_from_name('author')
1288.         with connection.schema_editor() as editor:
1289.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1290. 
1291.         counts = self.get_constraints_count(
1292.             BookWithO2O._meta.db_table,
1293.             BookWithO2O._meta.get_field('author').column,
1294.             (Author._meta.db_table, Author._meta.pk.column),
1295.         )
1296.         # The unique constraint remains.
1297.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1298. 
1299.     @skipUnlessDBFeature('ignores_table_name_case')
1300.     def test_alter_db_table_case(self):
1301.         # Create the table
1302.         with connection.schema_editor() as editor:
1303.             editor.create_model(Author)
1304.         # Alter the case of the table
1305.         old_table_name = Author._meta.db_table
1306.         with connection.schema_editor() as editor:
1307.             editor.alter_db_table(Author, old_table_name, old_table_name.upper())
1308. 
1309.     def test_alter_implicit_id_to_explicit(self):
1310.         """
1311.         Should be able to convert an implicit "id" field to an explicit "id"
1312.         primary key field.
1313.         """
1314.         with connection.schema_editor() as editor:
1315.             editor.create_model(Author)
1316. 
1317.         old_field = Author._meta.get_field("id")
1318.         new_field = AutoField(primary_key=True)
1319.         new_field.set_attributes_from_name("id")
1320.         new_field.model = Author
1321.         with connection.schema_editor() as editor:
1322.             editor.alter_field(Author, old_field, new_field, strict=True)
1323.         # This will fail if DROP DEFAULT is inadvertently executed on this
1324.         # field which drops the id sequence, at least on PostgreSQL.
1325.         Author.objects.create(name='Foo')
1326.         Author.objects.create(name='Bar')
1327. 
1328.     def test_alter_autofield_pk_to_bigautofield_pk_sequence_owner(self):
1329.         """
1330.         Converting an implicit PK to BigAutoField(primary_key=True) should keep
1331.         a sequence owner on PostgreSQL.
1332.         """
1333.         with connection.schema_editor() as editor:
1334.             editor.create_model(Author)
1335.         old_field = Author._meta.get_field('id')
1336.         new_field = BigAutoField(primary_key=True)
1337.         new_field.set_attributes_from_name('id')
1338.         new_field.model = Author
1339.         with connection.schema_editor() as editor:
1340.             editor.alter_field(Author, old_field, new_field, strict=True)
1341. 
1342.         Author.objects.create(name='Foo', pk=1)
1343.         with connection.cursor() as cursor:
1344.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1345.             if sequence_reset_sqls:
1346.                 cursor.execute(sequence_reset_sqls[0])
1347.         # Fail on PostgreSQL if sequence is missing an owner.
1348.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1349. 
1350.     def test_alter_autofield_pk_to_smallautofield_pk_sequence_owner(self):
1351.         """
1352.         Converting an implicit PK to SmallAutoField(primary_key=True) should
1353.         keep a sequence owner on PostgreSQL.
1354.         """
1355.         with connection.schema_editor() as editor:
1356.             editor.create_model(Author)
1357.         old_field = Author._meta.get_field('id')
1358.         new_field = SmallAutoField(primary_key=True)
1359.         new_field.set_attributes_from_name('id')
1360.         new_field.model = Author
1361.         with connection.schema_editor() as editor:
1362.             editor.alter_field(Author, old_field, new_field, strict=True)
1363. 
1364.         Author.objects.create(name='Foo', pk=1)
1365.         with connection.cursor() as cursor:
1366.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1367.             if sequence_reset_sqls:
1368.                 cursor.execute(sequence_reset_sqls[0])
1369.         # Fail on PostgreSQL if sequence is missing an owner.
1370.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1371. 
1372.     def test_alter_int_pk_to_autofield_pk(self):
1373.         """
1374.         Should be able to rename an IntegerField(primary_key=True) to
1375.         AutoField(primary_key=True).
1376.         """
1377.         with connection.schema_editor() as editor:
1378.             editor.create_model(IntegerPK)
1379. 
1380.         old_field = IntegerPK._meta.get_field('i')
1381.         new_field = AutoField(primary_key=True)
1382.         new_field.model = IntegerPK
1383.         new_field.set_attributes_from_name('i')
1384. 
1385.         with connection.schema_editor() as editor:
1386.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1387. 
1388.         # A model representing the updated model.
1389.         class IntegerPKToAutoField(Model):
1390.             i = AutoField(primary_key=True)
1391.             j = IntegerField(unique=True)
1392. 
1393.             class Meta:
1394.                 app_label = 'schema'
1395.                 apps = new_apps
1396.                 db_table = IntegerPK._meta.db_table
1397. 
1398.         # An id (i) is generated by the database.
1399.         obj = IntegerPKToAutoField.objects.create(j=1)
1400.         self.assertIsNotNone(obj.i)
1401. 
1402.     def test_alter_int_pk_to_bigautofield_pk(self):
1403.         """
1404.         Should be able to rename an IntegerField(primary_key=True) to
1405.         BigAutoField(primary_key=True).
1406.         """
1407.         with connection.schema_editor() as editor:
1408.             editor.create_model(IntegerPK)
1409. 
1410.         old_field = IntegerPK._meta.get_field('i')
1411.         new_field = BigAutoField(primary_key=True)
1412.         new_field.model = IntegerPK
1413.         new_field.set_attributes_from_name('i')
1414. 
1415.         with connection.schema_editor() as editor:
1416.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1417. 
1418.         # A model representing the updated model.
1419.         class IntegerPKToBigAutoField(Model):
1420.             i = BigAutoField(primary_key=True)
1421.             j = IntegerField(unique=True)
1422. 
1423.             class Meta:
1424.                 app_label = 'schema'
1425.                 apps = new_apps
1426.                 db_table = IntegerPK._meta.db_table
1427. 
1428.         # An id (i) is generated by the database.
1429.         obj = IntegerPKToBigAutoField.objects.create(j=1)
1430.         self.assertIsNotNone(obj.i)
1431. 
1432.     @isolate_apps('schema')
1433.     def test_alter_smallint_pk_to_smallautofield_pk(self):
1434.         """
1435.         Should be able to rename an SmallIntegerField(primary_key=True) to
1436.         SmallAutoField(primary_key=True).
1437.         """
1438.         class SmallIntegerPK(Model):
1439.             i = SmallIntegerField(primary_key=True)
1440. 
1441.             class Meta:
1442.                 app_label = 'schema'
1443. 
1444.         with connection.schema_editor() as editor:
1445.             editor.create_model(SmallIntegerPK)
1446.         self.isolated_local_models = [SmallIntegerPK]
1447.         old_field = SmallIntegerPK._meta.get_field('i')
1448.         new_field = SmallAutoField(primary_key=True)
1449.         new_field.model = SmallIntegerPK
1450.         new_field.set_attributes_from_name('i')
1451.         with connection.schema_editor() as editor:
1452.             editor.alter_field(SmallIntegerPK, old_field, new_field, strict=True)
1453. 
1454.     def test_alter_int_pk_to_int_unique(self):
1455.         """
1456.         Should be able to rename an IntegerField(primary_key=True) to
1457.         IntegerField(unique=True).
1458.         """
1459.         with connection.schema_editor() as editor:
1460.             editor.create_model(IntegerPK)
1461.         # Delete the old PK
1462.         old_field = IntegerPK._meta.get_field('i')
1463.         new_field = IntegerField(unique=True)
1464.         new_field.model = IntegerPK
1465.         new_field.set_attributes_from_name('i')
1466.         with connection.schema_editor() as editor:
1467.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1468.         # The primary key constraint is gone. Result depends on database:
1469.         # 'id' for SQLite, None for others (must not be 'i').
1470.         self.assertIn(self.get_primary_key(IntegerPK._meta.db_table), ('id', None))
1471. 
1472.         # Set up a model class as it currently stands. The original IntegerPK
1473.         # class is now out of date and some backends make use of the whole
1474.         # model class when modifying a field (such as sqlite3 when remaking a
1475.         # table) so an outdated model class leads to incorrect results.
1476.         class Transitional(Model):
1477.             i = IntegerField(unique=True)
1478.             j = IntegerField(unique=True)
1479. 
1480.             class Meta:
1481.                 app_label = 'schema'
1482.                 apps = new_apps
1483.                 db_table = 'INTEGERPK'
1484. 
1485.         # model requires a new PK
1486.         old_field = Transitional._meta.get_field('j')
1487.         new_field = IntegerField(primary_key=True)
1488.         new_field.model = Transitional
1489.         new_field.set_attributes_from_name('j')
1490. 
1491.         with connection.schema_editor() as editor:
1492.             editor.alter_field(Transitional, old_field, new_field, strict=True)
1493. 
1494.         # Create a model class representing the updated model.
1495.         class IntegerUnique(Model):
1496.             i = IntegerField(unique=True)
1497.             j = IntegerField(primary_key=True)
1498. 
1499.             class Meta:
1500.                 app_label = 'schema'
1501.                 apps = new_apps
1502.                 db_table = 'INTEGERPK'
1503. 
1504.         # Ensure unique constraint works.
1505.         IntegerUnique.objects.create(i=1, j=1)
1506.         with self.assertRaises(IntegrityError):
1507.             IntegerUnique.objects.create(i=1, j=2)
1508. 
1509.     def test_rename(self):
1510.         """
1511.         Tests simple altering of fields
1512.         """
1513.         # Create the table
1514.         with connection.schema_editor() as editor:
1515.             editor.create_model(Author)
1516.         # Ensure the field is right to begin with
1517.         columns = self.column_classes(Author)
1518.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
1519.         self.assertNotIn("display_name", columns)
1520.         # Alter the name field's name
1521.         old_field = Author._meta.get_field("name")
1522.         new_field = CharField(max_length=254)
1523.         new_field.set_attributes_from_name("display_name")
1524.         with connection.schema_editor() as editor:
1525.             editor.alter_field(Author, old_field, new_field, strict=True)
1526.         # Ensure the field is right afterwards
1527.         columns = self.column_classes(Author)
1528.         self.assertEqual(columns['display_name'][0], connection.features.introspected_field_types['CharField'])
1529.         self.assertNotIn("name", columns)
1530. 
1531.     @isolate_apps('schema')
1532.     def test_rename_referenced_field(self):
1533.         class Author(Model):
1534.             name = CharField(max_length=255, unique=True)
1535. 
1536.             class Meta:
1537.                 app_label = 'schema'
1538. 
1539.         class Book(Model):
1540.             author = ForeignKey(Author, CASCADE, to_field='name')
1541. 
1542.             class Meta:
1543.                 app_label = 'schema'
1544. 
1545.         with connection.schema_editor() as editor:
1546.             editor.create_model(Author)
1547.             editor.create_model(Book)
1548.         new_field = CharField(max_length=255, unique=True)
1549.         new_field.set_attributes_from_name('renamed')
1550.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
1551.             editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1552.         # Ensure the foreign key reference was updated.
1553.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author', 'renamed')
1554. 
1555.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
1556.     def test_rename_keep_null_status(self):
1557.         """
1558.         Renaming a field shouldn't affect the not null status.
1559.         """
1560.         with connection.schema_editor() as editor:
1561.             editor.create_model(Note)
1562.         with self.assertRaises(IntegrityError):
1563.             Note.objects.create(info=None)
1564.         old_field = Note._meta.get_field("info")
1565.         new_field = TextField()
1566.         new_field.set_attributes_from_name("detail_info")
1567.         with connection.schema_editor() as editor:
1568.             editor.alter_field(Note, old_field, new_field, strict=True)
1569.         columns = self.column_classes(Note)
1570.         self.assertEqual(columns['detail_info'][0], "TextField")
1571.         self.assertNotIn("info", columns)
1572.         with self.assertRaises(IntegrityError):
1573.             NoteRename.objects.create(detail_info=None)
1574. 
1575.     def _test_m2m_create(self, M2MFieldClass):
1576.         """
1577.         Tests M2M fields on models during creation
1578.         """
1579.         class LocalBookWithM2M(Model):
1580.             author = ForeignKey(Author, CASCADE)
1581.             title = CharField(max_length=100, db_index=True)
1582.             pub_date = DateTimeField()
1583.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1584. 
1585.             class Meta:
1586.                 app_label = 'schema'
1587.                 apps = new_apps
1588.         self.local_models = [LocalBookWithM2M]
1589.         # Create the tables
1590.         with connection.schema_editor() as editor:
1591.             editor.create_model(Author)
1592.             editor.create_model(TagM2MTest)
1593.             editor.create_model(LocalBookWithM2M)
1594.         # Ensure there is now an m2m table there
1595.         columns = self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1596.         self.assertEqual(columns['tagm2mtest_id'][0], connection.features.introspected_field_types['IntegerField'])
1597. 
1598.     def test_m2m_create(self):
1599.         self._test_m2m_create(ManyToManyField)
1600. 
1601.     def test_m2m_create_custom(self):
1602.         self._test_m2m_create(CustomManyToManyField)
1603. 
1604.     def test_m2m_create_inherited(self):
1605.         self._test_m2m_create(InheritedManyToManyField)
1606. 
1607.     def _test_m2m_create_through(self, M2MFieldClass):
1608.         """
1609.         Tests M2M fields on models during creation with through models
1610.         """
1611.         class LocalTagThrough(Model):
1612.             book = ForeignKey("schema.LocalBookWithM2MThrough", CASCADE)
1613.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1614. 
1615.             class Meta:
1616.                 app_label = 'schema'
1617.                 apps = new_apps
1618. 
1619.         class LocalBookWithM2MThrough(Model):
1620.             tags = M2MFieldClass("TagM2MTest", related_name="books", through=LocalTagThrough)
1621. 
1622.             class Meta:
1623.                 app_label = 'schema'
1624.                 apps = new_apps
1625. 
1626.         self.local_models = [LocalTagThrough, LocalBookWithM2MThrough]
1627. 
1628.         # Create the tables
1629.         with connection.schema_editor() as editor:
1630.             editor.create_model(LocalTagThrough)
1631.             editor.create_model(TagM2MTest)
1632.             editor.create_model(LocalBookWithM2MThrough)
1633.         # Ensure there is now an m2m table there
1634.         columns = self.column_classes(LocalTagThrough)
1635.         self.assertEqual(columns['book_id'][0], connection.features.introspected_field_types['IntegerField'])
1636.         self.assertEqual(columns['tag_id'][0], connection.features.introspected_field_types['IntegerField'])
1637. 
1638.     def test_m2m_create_through(self):
1639.         self._test_m2m_create_through(ManyToManyField)
1640. 
1641.     def test_m2m_create_through_custom(self):
1642.         self._test_m2m_create_through(CustomManyToManyField)
1643. 
1644.     def test_m2m_create_through_inherited(self):
1645.         self._test_m2m_create_through(InheritedManyToManyField)
1646. 
1647.     def _test_m2m(self, M2MFieldClass):
1648.         """
1649.         Tests adding/removing M2M fields on models
1650.         """
1651.         class LocalAuthorWithM2M(Model):
1652.             name = CharField(max_length=255)
1653. 
1654.             class Meta:
1655.                 app_label = 'schema'
1656.                 apps = new_apps
1657. 
1658.         self.local_models = [LocalAuthorWithM2M]
1659. 
1660.         # Create the tables
1661.         with connection.schema_editor() as editor:
1662.             editor.create_model(LocalAuthorWithM2M)
1663.             editor.create_model(TagM2MTest)
1664.         # Create an M2M field
1665.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors")
1666.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
1667.         # Ensure there's no m2m table there
1668.         with self.assertRaises(DatabaseError):
1669.             self.column_classes(new_field.remote_field.through)
1670.         # Add the field
1671.         with connection.schema_editor() as editor:
1672.             editor.add_field(LocalAuthorWithM2M, new_field)
1673.         # Ensure there is now an m2m table there
1674.         columns = self.column_classes(new_field.remote_field.through)
1675.         self.assertEqual(columns['tagm2mtest_id'][0], connection.features.introspected_field_types['IntegerField'])
1676. 
1677.         # "Alter" the field. This should not rename the DB table to itself.
1678.         with connection.schema_editor() as editor:
1679.             editor.alter_field(LocalAuthorWithM2M, new_field, new_field, strict=True)
1680. 
1681.         # Remove the M2M table again
1682.         with connection.schema_editor() as editor:
1683.             editor.remove_field(LocalAuthorWithM2M, new_field)
1684.         # Ensure there's no m2m table there
1685.         with self.assertRaises(DatabaseError):
1686.             self.column_classes(new_field.remote_field.through)
1687. 
1688.         # Make sure the model state is coherent with the table one now that
1689.         # we've removed the tags field.
1690.         opts = LocalAuthorWithM2M._meta
1691.         opts.local_many_to_many.remove(new_field)
1692.         del new_apps.all_models['schema'][new_field.remote_field.through._meta.model_name]
1693.         opts._expire_cache()
1694. 
1695.     def test_m2m(self):
1696.         self._test_m2m(ManyToManyField)
1697. 
1698.     def test_m2m_custom(self):
1699.         self._test_m2m(CustomManyToManyField)
1700. 
1701.     def test_m2m_inherited(self):
1702.         self._test_m2m(InheritedManyToManyField)
1703. 
1704.     def _test_m2m_through_alter(self, M2MFieldClass):
1705.         """
1706.         Tests altering M2Ms with explicit through models (should no-op)
1707.         """
1708.         class LocalAuthorTag(Model):
1709.             author = ForeignKey("schema.LocalAuthorWithM2MThrough", CASCADE)
1710.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1711. 
1712.             class Meta:
1713.                 app_label = 'schema'
1714.                 apps = new_apps
1715. 
1716.         class LocalAuthorWithM2MThrough(Model):
1717.             name = CharField(max_length=255)
1718.             tags = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1719. 
1720.             class Meta:
1721.                 app_label = 'schema'
1722.                 apps = new_apps
1723. 
1724.         self.local_models = [LocalAuthorTag, LocalAuthorWithM2MThrough]
1725. 
1726.         # Create the tables
1727.         with connection.schema_editor() as editor:
1728.             editor.create_model(LocalAuthorTag)
1729.             editor.create_model(LocalAuthorWithM2MThrough)
1730.             editor.create_model(TagM2MTest)
1731.         # Ensure the m2m table is there
1732.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1733.         # "Alter" the field's blankness. This should not actually do anything.
1734.         old_field = LocalAuthorWithM2MThrough._meta.get_field("tags")
1735.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1736.         new_field.contribute_to_class(LocalAuthorWithM2MThrough, "tags")
1737.         with connection.schema_editor() as editor:
1738.             editor.alter_field(LocalAuthorWithM2MThrough, old_field, new_field, strict=True)
1739.         # Ensure the m2m table is still there
1740.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1741. 
1742.     def test_m2m_through_alter(self):
1743.         self._test_m2m_through_alter(ManyToManyField)
1744. 
1745.     def test_m2m_through_alter_custom(self):
1746.         self._test_m2m_through_alter(CustomManyToManyField)
1747. 
1748.     def test_m2m_through_alter_inherited(self):
1749.         self._test_m2m_through_alter(InheritedManyToManyField)
1750. 
1751.     def _test_m2m_repoint(self, M2MFieldClass):
1752.         """
1753.         Tests repointing M2M fields
1754.         """
1755.         class LocalBookWithM2M(Model):
1756.             author = ForeignKey(Author, CASCADE)
1757.             title = CharField(max_length=100, db_index=True)
1758.             pub_date = DateTimeField()
1759.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1760. 
1761.             class Meta:
1762.                 app_label = 'schema'
1763.                 apps = new_apps
1764.         self.local_models = [LocalBookWithM2M]
1765.         # Create the tables
1766.         with connection.schema_editor() as editor:
1767.             editor.create_model(Author)
1768.             editor.create_model(LocalBookWithM2M)
1769.             editor.create_model(TagM2MTest)
1770.             editor.create_model(UniqueTest)
1771.         # Ensure the M2M exists and points to TagM2MTest
1772.         if connection.features.supports_foreign_keys:
1773.             self.assertForeignKeyExists(
1774.                 LocalBookWithM2M._meta.get_field("tags").remote_field.through,
1775.                 'tagm2mtest_id',
1776.                 'schema_tagm2mtest',
1777.             )
1778.         # Repoint the M2M
1779.         old_field = LocalBookWithM2M._meta.get_field("tags")
1780.         new_field = M2MFieldClass(UniqueTest)
1781.         new_field.contribute_to_class(LocalBookWithM2M, "uniques")
1782.         with connection.schema_editor() as editor:
1783.             editor.alter_field(LocalBookWithM2M, old_field, new_field, strict=True)
1784.         # Ensure old M2M is gone
1785.         with self.assertRaises(DatabaseError):
1786.             self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1787. 
1788.         # This model looks like the new model and is used for teardown.
1789.         opts = LocalBookWithM2M._meta
1790.         opts.local_many_to_many.remove(old_field)
1791.         # Ensure the new M2M exists and points to UniqueTest
1792.         if connection.features.supports_foreign_keys:
1793.             self.assertForeignKeyExists(new_field.remote_field.through, 'uniquetest_id', 'schema_uniquetest')
1794. 
1795.     def test_m2m_repoint(self):
1796.         self._test_m2m_repoint(ManyToManyField)
1797. 
1798.     def test_m2m_repoint_custom(self):
1799.         self._test_m2m_repoint(CustomManyToManyField)
1800. 
1801.     def test_m2m_repoint_inherited(self):
1802.         self._test_m2m_repoint(InheritedManyToManyField)
1803. 
1804.     @isolate_apps('schema')
1805.     def test_m2m_rename_field_in_target_model(self):
1806.         class LocalTagM2MTest(Model):
1807.             title = CharField(max_length=255)
1808. 
1809.             class Meta:
1810.                 app_label = 'schema'
1811. 
1812.         class LocalM2M(Model):
1813.             tags = ManyToManyField(LocalTagM2MTest)
1814. 
1815.             class Meta:
1816.                 app_label = 'schema'
1817. 
1818.         # Create the tables.
1819.         with connection.schema_editor() as editor:
1820.             editor.create_model(LocalM2M)
1821.             editor.create_model(LocalTagM2MTest)
1822.         self.isolated_local_models = [LocalM2M, LocalTagM2MTest]
1823.         # Ensure the m2m table is there.
1824.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1825.         # Alter a field in LocalTagM2MTest.
1826.         old_field = LocalTagM2MTest._meta.get_field('title')
1827.         new_field = CharField(max_length=254)
1828.         new_field.contribute_to_class(LocalTagM2MTest, 'title1')
1829.         # @isolate_apps() and inner models are needed to have the model
1830.         # relations populated, otherwise this doesn't act as a regression test.
1831.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
1832.         with connection.schema_editor() as editor:
1833.             editor.alter_field(LocalTagM2MTest, old_field, new_field, strict=True)
1834.         # Ensure the m2m table is still there.
1835.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1836. 
1837.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1838.     def test_check_constraints(self):
1839.         """
1840.         Tests creating/deleting CHECK constraints
1841.         """
1842.         # Create the tables
1843.         with connection.schema_editor() as editor:
1844.             editor.create_model(Author)
1845.         # Ensure the constraint exists
1846.         constraints = self.get_constraints(Author._meta.db_table)
1847.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1848.             self.fail("No check constraint for height found")
1849.         # Alter the column to remove it
1850.         old_field = Author._meta.get_field("height")
1851.         new_field = IntegerField(null=True, blank=True)
1852.         new_field.set_attributes_from_name("height")
1853.         with connection.schema_editor() as editor:
1854.             editor.alter_field(Author, old_field, new_field, strict=True)
1855.         constraints = self.get_constraints(Author._meta.db_table)
1856.         for details in constraints.values():
1857.             if details['columns'] == ["height"] and details['check']:
1858.                 self.fail("Check constraint for height found")
1859.         # Alter the column to re-add it
1860.         new_field2 = Author._meta.get_field("height")
1861.         with connection.schema_editor() as editor:
1862.             editor.alter_field(Author, new_field, new_field2, strict=True)
1863.         constraints = self.get_constraints(Author._meta.db_table)
1864.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1865.             self.fail("No check constraint for height found")
1866. 
1867.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1868.     def test_remove_field_check_does_not_remove_meta_constraints(self):
1869.         with connection.schema_editor() as editor:
1870.             editor.create_model(Author)
1871.         # Add the custom check constraint
1872.         constraint = CheckConstraint(check=Q(height__gte=0), name='author_height_gte_0_check')
1873.         custom_constraint_name = constraint.name
1874.         Author._meta.constraints = [constraint]
1875.         with connection.schema_editor() as editor:
1876.             editor.add_constraint(Author, constraint)
1877.         # Ensure the constraints exist
1878.         constraints = self.get_constraints(Author._meta.db_table)
1879.         self.assertIn(custom_constraint_name, constraints)
1880.         other_constraints = [
1881.             name for name, details in constraints.items()
1882.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1883.         ]
1884.         self.assertEqual(len(other_constraints), 1)
1885.         # Alter the column to remove field check
1886.         old_field = Author._meta.get_field('height')
1887.         new_field = IntegerField(null=True, blank=True)
1888.         new_field.set_attributes_from_name('height')
1889.         with connection.schema_editor() as editor:
1890.             editor.alter_field(Author, old_field, new_field, strict=True)
1891.         constraints = self.get_constraints(Author._meta.db_table)
1892.         self.assertIn(custom_constraint_name, constraints)
1893.         other_constraints = [
1894.             name for name, details in constraints.items()
1895.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1896.         ]
1897.         self.assertEqual(len(other_constraints), 0)
1898.         # Alter the column to re-add field check
1899.         new_field2 = Author._meta.get_field('height')
1900.         with connection.schema_editor() as editor:
1901.             editor.alter_field(Author, new_field, new_field2, strict=True)
1902.         constraints = self.get_constraints(Author._meta.db_table)
1903.         self.assertIn(custom_constraint_name, constraints)
1904.         other_constraints = [
1905.             name for name, details in constraints.items()
1906.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1907.         ]
1908.         self.assertEqual(len(other_constraints), 1)
1909.         # Drop the check constraint
1910.         with connection.schema_editor() as editor:
1911.             Author._meta.constraints = []
1912.             editor.remove_constraint(Author, constraint)
1913. 
1914.     def test_unique(self):
1915.         """
1916.         Tests removing and adding unique constraints to a single column.
1917.         """
1918.         # Create the table
1919.         with connection.schema_editor() as editor:
1920.             editor.create_model(Tag)
1921.         # Ensure the field is unique to begin with
1922.         Tag.objects.create(title="foo", slug="foo")
1923.         with self.assertRaises(IntegrityError):
1924.             Tag.objects.create(title="bar", slug="foo")
1925.         Tag.objects.all().delete()
1926.         # Alter the slug field to be non-unique
1927.         old_field = Tag._meta.get_field("slug")
1928.         new_field = SlugField(unique=False)
1929.         new_field.set_attributes_from_name("slug")
1930.         with connection.schema_editor() as editor:
1931.             editor.alter_field(Tag, old_field, new_field, strict=True)
1932.         # Ensure the field is no longer unique
1933.         Tag.objects.create(title="foo", slug="foo")
1934.         Tag.objects.create(title="bar", slug="foo")
1935.         Tag.objects.all().delete()
1936.         # Alter the slug field to be unique
1937.         new_field2 = SlugField(unique=True)
1938.         new_field2.set_attributes_from_name("slug")
1939.         with connection.schema_editor() as editor:
1940.             editor.alter_field(Tag, new_field, new_field2, strict=True)
1941.         # Ensure the field is unique again
1942.         Tag.objects.create(title="foo", slug="foo")
1943.         with self.assertRaises(IntegrityError):
1944.             Tag.objects.create(title="bar", slug="foo")
1945.         Tag.objects.all().delete()
1946.         # Rename the field
1947.         new_field3 = SlugField(unique=True)
1948.         new_field3.set_attributes_from_name("slug2")
1949.         with connection.schema_editor() as editor:
1950.             editor.alter_field(Tag, new_field2, new_field3, strict=True)
1951.         # Ensure the field is still unique
1952.         TagUniqueRename.objects.create(title="foo", slug2="foo")
1953.         with self.assertRaises(IntegrityError):
1954.             TagUniqueRename.objects.create(title="bar", slug2="foo")
1955.         Tag.objects.all().delete()
1956. 
1957.     def test_unique_name_quoting(self):
1958.         old_table_name = TagUniqueRename._meta.db_table
1959.         try:
1960.             with connection.schema_editor() as editor:
1961.                 editor.create_model(TagUniqueRename)
1962.                 editor.alter_db_table(TagUniqueRename, old_table_name, 'unique-table')
1963.                 TagUniqueRename._meta.db_table = 'unique-table'
1964.                 # This fails if the unique index name isn't quoted.
1965.                 editor.alter_unique_together(TagUniqueRename, [], (('title', 'slug2'),))
1966.         finally:
1967.             TagUniqueRename._meta.db_table = old_table_name
1968. 
1969.     @isolate_apps('schema')
1970.     @skipUnlessDBFeature('supports_foreign_keys')
1971.     def test_unique_no_unnecessary_fk_drops(self):
1972.         """
1973.         If AlterField isn't selective about dropping foreign key constraints
1974.         when modifying a field with a unique constraint, the AlterField
1975.         incorrectly drops and recreates the Book.author foreign key even though
1976.         it doesn't restrict the field being changed (#29193).
1977.         """
1978.         class Author(Model):
1979.             name = CharField(max_length=254, unique=True)
1980. 
1981.             class Meta:
1982.                 app_label = 'schema'
1983. 
1984.         class Book(Model):
1985.             author = ForeignKey(Author, CASCADE)
1986. 
1987.             class Meta:
1988.                 app_label = 'schema'
1989. 
1990.         with connection.schema_editor() as editor:
1991.             editor.create_model(Author)
1992.             editor.create_model(Book)
1993.         new_field = CharField(max_length=255, unique=True)
1994.         new_field.model = Author
1995.         new_field.set_attributes_from_name('name')
1996.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1997.             with connection.schema_editor() as editor:
1998.                 editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1999.         # One SQL statement is executed to alter the field.
2000.         self.assertEqual(len(cm.records), 1)
2001. 
2002.     @isolate_apps('schema')
2003.     def test_unique_and_reverse_m2m(self):
2004.         """
2005.         AlterField can modify a unique field when there's a reverse M2M
2006.         relation on the model.
2007.         """
2008.         class Tag(Model):
2009.             title = CharField(max_length=255)
2010.             slug = SlugField(unique=True)
2011. 
2012.             class Meta:
2013.                 app_label = 'schema'
2014. 
2015.         class Book(Model):
2016.             tags = ManyToManyField(Tag, related_name='books')
2017. 
2018.             class Meta:
2019.                 app_label = 'schema'
2020. 
2021.         self.isolated_local_models = [Book._meta.get_field('tags').remote_field.through]
2022.         with connection.schema_editor() as editor:
2023.             editor.create_model(Tag)
2024.             editor.create_model(Book)
2025.         new_field = SlugField(max_length=75, unique=True)
2026.         new_field.model = Tag
2027.         new_field.set_attributes_from_name('slug')
2028.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
2029.             with connection.schema_editor() as editor:
2030.                 editor.alter_field(Tag, Tag._meta.get_field('slug'), new_field)
2031.         # One SQL statement is executed to alter the field.
2032.         self.assertEqual(len(cm.records), 1)
2033.         # Ensure that the field is still unique.
2034.         Tag.objects.create(title='foo', slug='foo')
2035.         with self.assertRaises(IntegrityError):
2036.             Tag.objects.create(title='bar', slug='foo')
2037. 
2038.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2039.     def test_remove_field_unique_does_not_remove_meta_constraints(self):
2040.         with connection.schema_editor() as editor:
2041.             editor.create_model(AuthorWithUniqueName)
2042.         # Add the custom unique constraint
2043.         constraint = UniqueConstraint(fields=['name'], name='author_name_uniq')
2044.         custom_constraint_name = constraint.name
2045.         AuthorWithUniqueName._meta.constraints = [constraint]
2046.         with connection.schema_editor() as editor:
2047.             editor.add_constraint(AuthorWithUniqueName, constraint)
2048.         # Ensure the constraints exist
2049.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
2050.         self.assertIn(custom_constraint_name, constraints)
2051.         other_constraints = [
2052.             name for name, details in constraints.items()
2053.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2054.         ]
2055.         self.assertEqual(len(other_constraints), 1)
2056.         # Alter the column to remove field uniqueness
2057.         old_field = AuthorWithUniqueName._meta.get_field('name')
2058.         new_field = CharField(max_length=255)
2059.         new_field.set_attributes_from_name('name')
2060.         with connection.schema_editor() as editor:
2061.             editor.alter_field(AuthorWithUniqueName, old_field, new_field, strict=True)
2062.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
2063.         self.assertIn(custom_constraint_name, constraints)
2064.         other_constraints = [
2065.             name for name, details in constraints.items()
2066.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2067.         ]
2068.         self.assertEqual(len(other_constraints), 0)
2069.         # Alter the column to re-add field uniqueness
2070.         new_field2 = AuthorWithUniqueName._meta.get_field('name')
2071.         with connection.schema_editor() as editor:
2072.             editor.alter_field(AuthorWithUniqueName, new_field, new_field2, strict=True)
2073.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
2074.         self.assertIn(custom_constraint_name, constraints)
2075.         other_constraints = [
2076.             name for name, details in constraints.items()
2077.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2078.         ]
2079.         self.assertEqual(len(other_constraints), 1)
2080.         # Drop the unique constraint
2081.         with connection.schema_editor() as editor:
2082.             AuthorWithUniqueName._meta.constraints = []
2083.             editor.remove_constraint(AuthorWithUniqueName, constraint)
2084. 
2085.     def test_unique_together(self):
2086.         """
2087.         Tests removing and adding unique_together constraints on a model.
2088.         """
2089.         # Create the table
2090.         with connection.schema_editor() as editor:
2091.             editor.create_model(UniqueTest)
2092.         # Ensure the fields are unique to begin with
2093.         UniqueTest.objects.create(year=2012, slug="foo")
2094.         UniqueTest.objects.create(year=2011, slug="foo")
2095.         UniqueTest.objects.create(year=2011, slug="bar")
2096.         with self.assertRaises(IntegrityError):
2097.             UniqueTest.objects.create(year=2012, slug="foo")
2098.         UniqueTest.objects.all().delete()
2099.         # Alter the model to its non-unique-together companion
2100.         with connection.schema_editor() as editor:
2101.             editor.alter_unique_together(UniqueTest, UniqueTest._meta.unique_together, [])
2102.         # Ensure the fields are no longer unique
2103.         UniqueTest.objects.create(year=2012, slug="foo")
2104.         UniqueTest.objects.create(year=2012, slug="foo")
2105.         UniqueTest.objects.all().delete()
2106.         # Alter it back
2107.         new_field2 = SlugField(unique=True)
2108.         new_field2.set_attributes_from_name("slug")
2109.         with connection.schema_editor() as editor:
2110.             editor.alter_unique_together(UniqueTest, [], UniqueTest._meta.unique_together)
2111.         # Ensure the fields are unique again
2112.         UniqueTest.objects.create(year=2012, slug="foo")
2113.         with self.assertRaises(IntegrityError):
2114.             UniqueTest.objects.create(year=2012, slug="foo")
2115.         UniqueTest.objects.all().delete()
2116. 
2117.     def test_unique_together_with_fk(self):
2118.         """
2119.         Tests removing and adding unique_together constraints that include
2120.         a foreign key.
2121.         """
2122.         # Create the table
2123.         with connection.schema_editor() as editor:
2124.             editor.create_model(Author)
2125.             editor.create_model(Book)
2126.         # Ensure the fields are unique to begin with
2127.         self.assertEqual(Book._meta.unique_together, ())
2128.         # Add the unique_together constraint
2129.         with connection.schema_editor() as editor:
2130.             editor.alter_unique_together(Book, [], [['author', 'title']])
2131.         # Alter it back
2132.         with connection.schema_editor() as editor:
2133.             editor.alter_unique_together(Book, [['author', 'title']], [])
2134. 
2135.     def test_unique_together_with_fk_with_existing_index(self):
2136.         """
2137.         Tests removing and adding unique_together constraints that include
2138.         a foreign key, where the foreign key is added after the model is
2139.         created.
2140.         """
2141.         # Create the tables
2142.         with connection.schema_editor() as editor:
2143.             editor.create_model(Author)
2144.             editor.create_model(BookWithoutAuthor)
2145.             new_field = ForeignKey(Author, CASCADE)
2146.             new_field.set_attributes_from_name('author')
2147.             editor.add_field(BookWithoutAuthor, new_field)
2148.         # Ensure the fields aren't unique to begin with
2149.         self.assertEqual(Book._meta.unique_together, ())
2150.         # Add the unique_together constraint
2151.         with connection.schema_editor() as editor:
2152.             editor.alter_unique_together(Book, [], [['author', 'title']])
2153.         # Alter it back
2154.         with connection.schema_editor() as editor:
2155.             editor.alter_unique_together(Book, [['author', 'title']], [])
2156. 
2157.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2158.     def test_remove_unique_together_does_not_remove_meta_constraints(self):
2159.         with connection.schema_editor() as editor:
2160.             editor.create_model(AuthorWithUniqueNameAndBirthday)
2161.         # Add the custom unique constraint
2162.         constraint = UniqueConstraint(fields=['name', 'birthday'], name='author_name_birthday_uniq')
2163.         custom_constraint_name = constraint.name
2164.         AuthorWithUniqueNameAndBirthday._meta.constraints = [constraint]
2165.         with connection.schema_editor() as editor:
2166.             editor.add_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2167.         # Ensure the constraints exist
2168.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2169.         self.assertIn(custom_constraint_name, constraints)
2170.         other_constraints = [
2171.             name for name, details in constraints.items()
2172.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2173.         ]
2174.         self.assertEqual(len(other_constraints), 1)
2175.         # Remove unique together
2176.         unique_together = AuthorWithUniqueNameAndBirthday._meta.unique_together
2177.         with connection.schema_editor() as editor:
2178.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, unique_together, [])
2179.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2180.         self.assertIn(custom_constraint_name, constraints)
2181.         other_constraints = [
2182.             name for name, details in constraints.items()
2183.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2184.         ]
2185.         self.assertEqual(len(other_constraints), 0)
2186.         # Re-add unique together
2187.         with connection.schema_editor() as editor:
2188.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, [], unique_together)
2189.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2190.         self.assertIn(custom_constraint_name, constraints)
2191.         other_constraints = [
2192.             name for name, details in constraints.items()
2193.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2194.         ]
2195.         self.assertEqual(len(other_constraints), 1)
2196.         # Drop the unique constraint
2197.         with connection.schema_editor() as editor:
2198.             AuthorWithUniqueNameAndBirthday._meta.constraints = []
2199.             editor.remove_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2200. 
2201.     @skipUnlessDBFeature('supports_expression_indexes')
2202.     def test_func_unique_constraint(self):
2203.         with connection.schema_editor() as editor:
2204.             editor.create_model(Author)
2205.         constraint = UniqueConstraint(Upper('name').desc(), name='func_upper_uq')
2206.         # Add constraint.
2207.         with connection.schema_editor() as editor:
2208.             editor.add_constraint(Author, constraint)
2209.             sql = constraint.create_sql(Author, editor)
2210.         table = Author._meta.db_table
2211.         constraints = self.get_constraints(table)
2212.         if connection.features.supports_index_column_ordering:
2213.             self.assertIndexOrder(table, constraint.name, ['DESC'])
2214.         self.assertIn(constraint.name, constraints)
2215.         self.assertIs(constraints[constraint.name]['unique'], True)
2216.         # SQL contains a database function.
2217.         self.assertIs(sql.references_column(table, 'name'), True)
2218.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), str(sql))
2219.         # Remove constraint.
2220.         with connection.schema_editor() as editor:
2221.             editor.remove_constraint(Author, constraint)
2222.         self.assertNotIn(constraint.name, self.get_constraints(table))
2223. 
2224.     @skipUnlessDBFeature('supports_expression_indexes')
2225.     def test_composite_func_unique_constraint(self):
2226.         with connection.schema_editor() as editor:
2227.             editor.create_model(Author)
2228.             editor.create_model(BookWithSlug)
2229.         constraint = UniqueConstraint(
2230.             Upper('title'),
2231.             Lower('slug'),
2232.             name='func_upper_lower_unq',
2233.         )
2234.         # Add constraint.
2235.         with connection.schema_editor() as editor:
2236.             editor.add_constraint(BookWithSlug, constraint)
2237.             sql = constraint.create_sql(BookWithSlug, editor)
2238.         table = BookWithSlug._meta.db_table
2239.         constraints = self.get_constraints(table)
2240.         self.assertIn(constraint.name, constraints)
2241.         self.assertIs(constraints[constraint.name]['unique'], True)
2242.         # SQL contains database functions.
2243.         self.assertIs(sql.references_column(table, 'title'), True)
2244.         self.assertIs(sql.references_column(table, 'slug'), True)
2245.         sql = str(sql)
2246.         self.assertIn('UPPER(%s)' % editor.quote_name('title'), sql)
2247.         self.assertIn('LOWER(%s)' % editor.quote_name('slug'), sql)
2248.         self.assertLess(sql.index('UPPER'), sql.index('LOWER'))
2249.         # Remove constraint.
2250.         with connection.schema_editor() as editor:
2251.             editor.remove_constraint(BookWithSlug, constraint)
2252.         self.assertNotIn(constraint.name, self.get_constraints(table))
2253. 
2254.     @skipUnlessDBFeature('supports_expression_indexes')
2255.     def test_unique_constraint_field_and_expression(self):
2256.         with connection.schema_editor() as editor:
2257.             editor.create_model(Author)
2258.         constraint = UniqueConstraint(
2259.             F('height').desc(),
2260.             'uuid',
2261.             Lower('name').asc(),
2262.             name='func_f_lower_field_unq',
2263.         )
2264.         # Add constraint.
2265.         with connection.schema_editor() as editor:
2266.             editor.add_constraint(Author, constraint)
2267.             sql = constraint.create_sql(Author, editor)
2268.         table = Author._meta.db_table
2269.         if connection.features.supports_index_column_ordering:
2270.             self.assertIndexOrder(table, constraint.name, ['DESC', 'ASC', 'ASC'])
2271.         constraints = self.get_constraints(table)
2272.         self.assertIs(constraints[constraint.name]['unique'], True)
2273.         self.assertEqual(len(constraints[constraint.name]['columns']), 3)
2274.         self.assertEqual(constraints[constraint.name]['columns'][1], 'uuid')
2275.         # SQL contains database functions and columns.
2276.         self.assertIs(sql.references_column(table, 'height'), True)
2277.         self.assertIs(sql.references_column(table, 'name'), True)
2278.         self.assertIs(sql.references_column(table, 'uuid'), True)
2279.         self.assertIn('LOWER(%s)' % editor.quote_name('name'), str(sql))
2280.         # Remove constraint.
2281.         with connection.schema_editor() as editor:
2282.             editor.remove_constraint(Author, constraint)
2283.         self.assertNotIn(constraint.name, self.get_constraints(table))
2284. 
2285.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_partial_indexes')
2286.     def test_func_unique_constraint_partial(self):
2287.         with connection.schema_editor() as editor:
2288.             editor.create_model(Author)
2289.         constraint = UniqueConstraint(
2290.             Upper('name'),
2291.             name='func_upper_cond_weight_uq',
2292.             condition=Q(weight__isnull=False),
2293.         )
2294.         # Add constraint.
2295.         with connection.schema_editor() as editor:
2296.             editor.add_constraint(Author, constraint)
2297.             sql = constraint.create_sql(Author, editor)
2298.         table = Author._meta.db_table
2299.         constraints = self.get_constraints(table)
2300.         self.assertIn(constraint.name, constraints)
2301.         self.assertIs(constraints[constraint.name]['unique'], True)
2302.         self.assertIs(sql.references_column(table, 'name'), True)
2303.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), str(sql))
2304.         self.assertIn(
2305.             'WHERE %s IS NOT NULL' % editor.quote_name('weight'),
2306.             str(sql),
2307.         )
2308.         # Remove constraint.
2309.         with connection.schema_editor() as editor:
2310.             editor.remove_constraint(Author, constraint)
2311.         self.assertNotIn(constraint.name, self.get_constraints(table))
2312. 
2313.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_covering_indexes')
2314.     def test_func_unique_constraint_covering(self):
2315.         with connection.schema_editor() as editor:
2316.             editor.create_model(Author)
2317.         constraint = UniqueConstraint(
2318.             Upper('name'),
2319.             name='func_upper_covering_uq',
2320.             include=['weight', 'height'],
2321.         )
2322.         # Add constraint.
2323.         with connection.schema_editor() as editor:
2324.             editor.add_constraint(Author, constraint)
2325.             sql = constraint.create_sql(Author, editor)
2326.         table = Author._meta.db_table
2327.         constraints = self.get_constraints(table)
2328.         self.assertIn(constraint.name, constraints)
2329.         self.assertIs(constraints[constraint.name]['unique'], True)
2330.         self.assertEqual(
2331.             constraints[constraint.name]['columns'],
2332.             [None, 'weight', 'height'],
2333.         )
2334.         self.assertIs(sql.references_column(table, 'name'), True)
2335.         self.assertIs(sql.references_column(table, 'weight'), True)
2336.         self.assertIs(sql.references_column(table, 'height'), True)
2337.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), str(sql))
2338.         self.assertIn(
2339.             'INCLUDE (%s, %s)' % (
2340.                 editor.quote_name('weight'),
2341.                 editor.quote_name('height'),
2342.             ),
2343.             str(sql),
2344.         )
2345.         # Remove constraint.
2346.         with connection.schema_editor() as editor:
2347.             editor.remove_constraint(Author, constraint)
2348.         self.assertNotIn(constraint.name, self.get_constraints(table))
2349. 
2350.     @skipUnlessDBFeature('supports_expression_indexes')
2351.     def test_func_unique_constraint_lookups(self):
2352.         with connection.schema_editor() as editor:
2353.             editor.create_model(Author)
2354.         with register_lookup(CharField, Lower), register_lookup(IntegerField, Abs):
2355.             constraint = UniqueConstraint(
2356.                 F('name__lower'),
2357.                 F('weight__abs'),
2358.                 name='func_lower_abs_lookup_uq',
2359.             )
2360.             # Add constraint.
2361.             with connection.schema_editor() as editor:
2362.                 editor.add_constraint(Author, constraint)
2363.                 sql = constraint.create_sql(Author, editor)
2364.         table = Author._meta.db_table
2365.         constraints = self.get_constraints(table)
2366.         self.assertIn(constraint.name, constraints)
2367.         self.assertIs(constraints[constraint.name]['unique'], True)
2368.         # SQL contains columns.
2369.         self.assertIs(sql.references_column(table, 'name'), True)
2370.         self.assertIs(sql.references_column(table, 'weight'), True)
2371.         # Remove constraint.
2372.         with connection.schema_editor() as editor:
2373.             editor.remove_constraint(Author, constraint)
2374.         self.assertNotIn(constraint.name, self.get_constraints(table))
2375. 
2376.     @skipUnlessDBFeature('supports_expression_indexes')
2377.     def test_func_unique_constraint_collate(self):
2378.         collation = connection.features.test_collations.get('non_default')
2379.         if not collation:
2380.             self.skipTest(
2381.                 'This backend does not support case-insensitive collations.'
2382.             )
2383.         with connection.schema_editor() as editor:
2384.             editor.create_model(Author)
2385.             editor.create_model(BookWithSlug)
2386.         constraint = UniqueConstraint(
2387.             Collate(F('title'), collation=collation).desc(),
2388.             Collate('slug', collation=collation),
2389.             name='func_collate_uq',
2390.         )
2391.         # Add constraint.
2392.         with connection.schema_editor() as editor:
2393.             editor.add_constraint(BookWithSlug, constraint)
2394.             sql = constraint.create_sql(BookWithSlug, editor)
2395.         table = BookWithSlug._meta.db_table
2396.         constraints = self.get_constraints(table)
2397.         self.assertIn(constraint.name, constraints)
2398.         self.assertIs(constraints[constraint.name]['unique'], True)
2399.         if connection.features.supports_index_column_ordering:
2400.             self.assertIndexOrder(table, constraint.name, ['DESC', 'ASC'])
2401.         # SQL contains columns and a collation.
2402.         self.assertIs(sql.references_column(table, 'title'), True)
2403.         self.assertIs(sql.references_column(table, 'slug'), True)
2404.         self.assertIn('COLLATE %s' % editor.quote_name(collation), str(sql))
2405.         # Remove constraint.
2406.         with connection.schema_editor() as editor:
2407.             editor.remove_constraint(BookWithSlug, constraint)
2408.         self.assertNotIn(constraint.name, self.get_constraints(table))
2409. 
2410.     @skipIfDBFeature('supports_expression_indexes')
2411.     def test_func_unique_constraint_unsupported(self):
2412.         # UniqueConstraint is ignored on databases that don't support indexes on
2413.         # expressions.
2414.         with connection.schema_editor() as editor:
2415.             editor.create_model(Author)
2416.         constraint = UniqueConstraint(F('name'), name='func_name_uq')
2417.         with connection.schema_editor() as editor, self.assertNumQueries(0):
2418.             self.assertIsNone(editor.add_constraint(Author, constraint))
2419.             self.assertIsNone(editor.remove_constraint(Author, constraint))
2420. 
2421.     @skipUnlessDBFeature('supports_expression_indexes')
2422.     def test_func_unique_constraint_nonexistent_field(self):
2423.         constraint = UniqueConstraint(Lower('nonexistent'), name='func_nonexistent_uq')
2424.         msg = (
2425.             "Cannot resolve keyword 'nonexistent' into field. Choices are: "
2426.             "height, id, name, uuid, weight"
2427.         )
2428.         with self.assertRaisesMessage(FieldError, msg):
2429.             with connection.schema_editor() as editor:
2430.                 editor.add_constraint(Author, constraint)
2431. 
2432.     @skipUnlessDBFeature('supports_expression_indexes')
2433.     def test_func_unique_constraint_nondeterministic(self):
2434.         with connection.schema_editor() as editor:
2435.             editor.create_model(Author)
2436.         constraint = UniqueConstraint(Random(), name='func_random_uq')
2437.         with connection.schema_editor() as editor:
2438.             with self.assertRaises(DatabaseError):
2439.                 editor.add_constraint(Author, constraint)
2440. 
2441.     def test_index_together(self):
2442.         """
2443.         Tests removing and adding index_together constraints on a model.
2444.         """
2445.         # Create the table
2446.         with connection.schema_editor() as editor:
2447.             editor.create_model(Tag)
2448.         # Ensure there's no index on the year/slug columns first
2449.         self.assertIs(
2450.             any(
2451.                 c["index"]
2452.                 for c in self.get_constraints("schema_tag").values()
2453.                 if c['columns'] == ["slug", "title"]
2454.             ),
2455.             False,
2456.         )
2457.         # Alter the model to add an index
2458.         with connection.schema_editor() as editor:
2459.             editor.alter_index_together(Tag, [], [("slug", "title")])
2460.         # Ensure there is now an index
2461.         self.assertIs(
2462.             any(
2463.                 c["index"]
2464.                 for c in self.get_constraints("schema_tag").values()
2465.                 if c['columns'] == ["slug", "title"]
2466.             ),
2467.             True,
2468.         )
2469.         # Alter it back
2470.         new_field2 = SlugField(unique=True)
2471.         new_field2.set_attributes_from_name("slug")
2472.         with connection.schema_editor() as editor:
2473.             editor.alter_index_together(Tag, [("slug", "title")], [])
2474.         # Ensure there's no index
2475.         self.assertIs(
2476.             any(
2477.                 c["index"]
2478.                 for c in self.get_constraints("schema_tag").values()
2479.                 if c['columns'] == ["slug", "title"]
2480.             ),
2481.             False,
2482.         )
2483. 
2484.     def test_index_together_with_fk(self):
2485.         """
2486.         Tests removing and adding index_together constraints that include
2487.         a foreign key.
2488.         """
2489.         # Create the table
2490.         with connection.schema_editor() as editor:
2491.             editor.create_model(Author)
2492.             editor.create_model(Book)
2493.         # Ensure the fields are unique to begin with
2494.         self.assertEqual(Book._meta.index_together, ())
2495.         # Add the unique_together constraint
2496.         with connection.schema_editor() as editor:
2497.             editor.alter_index_together(Book, [], [['author', 'title']])
2498.         # Alter it back
2499.         with connection.schema_editor() as editor:
2500.             editor.alter_index_together(Book, [['author', 'title']], [])
2501. 
2502.     def test_create_index_together(self):
2503.         """
2504.         Tests creating models with index_together already defined
2505.         """
2506.         # Create the table
2507.         with connection.schema_editor() as editor:
2508.             editor.create_model(TagIndexed)
2509.         # Ensure there is an index
2510.         self.assertIs(
2511.             any(
2512.                 c["index"]
2513.                 for c in self.get_constraints("schema_tagindexed").values()
2514.                 if c['columns'] == ["slug", "title"]
2515.             ),
2516.             True,
2517.         )
2518. 
2519.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2520.     def test_remove_index_together_does_not_remove_meta_indexes(self):
2521.         with connection.schema_editor() as editor:
2522.             editor.create_model(AuthorWithIndexedNameAndBirthday)
2523.         # Add the custom index
2524.         index = Index(fields=['name', 'birthday'], name='author_name_birthday_idx')
2525.         custom_index_name = index.name
2526.         AuthorWithIndexedNameAndBirthday._meta.indexes = [index]
2527.         with connection.schema_editor() as editor:
2528.             editor.add_index(AuthorWithIndexedNameAndBirthday, index)
2529.         # Ensure the indexes exist
2530.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2531.         self.assertIn(custom_index_name, constraints)
2532.         other_constraints = [
2533.             name for name, details in constraints.items()
2534.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2535.         ]
2536.         self.assertEqual(len(other_constraints), 1)
2537.         # Remove index together
2538.         index_together = AuthorWithIndexedNameAndBirthday._meta.index_together
2539.         with connection.schema_editor() as editor:
2540.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, index_together, [])
2541.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2542.         self.assertIn(custom_index_name, constraints)
2543.         other_constraints = [
2544.             name for name, details in constraints.items()
2545.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2546.         ]
2547.         self.assertEqual(len(other_constraints), 0)
2548.         # Re-add index together
2549.         with connection.schema_editor() as editor:
2550.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, [], index_together)
2551.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2552.         self.assertIn(custom_index_name, constraints)
2553.         other_constraints = [
2554.             name for name, details in constraints.items()
2555.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2556.         ]
2557.         self.assertEqual(len(other_constraints), 1)
2558.         # Drop the index
2559.         with connection.schema_editor() as editor:
2560.             AuthorWithIndexedNameAndBirthday._meta.indexes = []
2561.             editor.remove_index(AuthorWithIndexedNameAndBirthday, index)
2562. 
2563.     @isolate_apps('schema')
2564.     def test_db_table(self):
2565.         """
2566.         Tests renaming of the table
2567.         """
2568.         class Author(Model):
2569.             name = CharField(max_length=255)
2570. 
2571.             class Meta:
2572.                 app_label = 'schema'
2573. 
2574.         class Book(Model):
2575.             author = ForeignKey(Author, CASCADE)
2576. 
2577.             class Meta:
2578.                 app_label = 'schema'
2579. 
2580.         # Create the table and one referring it.
2581.         with connection.schema_editor() as editor:
2582.             editor.create_model(Author)
2583.             editor.create_model(Book)
2584.         # Ensure the table is there to begin with
2585.         columns = self.column_classes(Author)
2586.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
2587.         # Alter the table
2588.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2589.             editor.alter_db_table(Author, "schema_author", "schema_otherauthor")
2590.         # Ensure the table is there afterwards
2591.         Author._meta.db_table = "schema_otherauthor"
2592.         columns = self.column_classes(Author)
2593.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
2594.         # Ensure the foreign key reference was updated
2595.         self.assertForeignKeyExists(Book, "author_id", "schema_otherauthor")
2596.         # Alter the table again
2597.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2598.             editor.alter_db_table(Author, "schema_otherauthor", "schema_author")
2599.         # Ensure the table is still there
2600.         Author._meta.db_table = "schema_author"
2601.         columns = self.column_classes(Author)
2602.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
2603. 
2604.     def test_add_remove_index(self):
2605.         """
2606.         Tests index addition and removal
2607.         """
2608.         # Create the table
2609.         with connection.schema_editor() as editor:
2610.             editor.create_model(Author)
2611.         # Ensure the table is there and has no index
2612.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2613.         # Add the index
2614.         index = Index(fields=['name'], name='author_title_idx')
2615.         with connection.schema_editor() as editor:
2616.             editor.add_index(Author, index)
2617.         self.assertIn('name', self.get_indexes(Author._meta.db_table))
2618.         # Drop the index
2619.         with connection.schema_editor() as editor:
2620.             editor.remove_index(Author, index)
2621.         self.assertNotIn('name', self.get_indexes(Author._meta.db_table))
2622. 
2623.     def test_remove_db_index_doesnt_remove_custom_indexes(self):
2624.         """
2625.         Changing db_index to False doesn't remove indexes from Meta.indexes.
2626.         """
2627.         with connection.schema_editor() as editor:
2628.             editor.create_model(AuthorWithIndexedName)
2629.         # Ensure the table has its index
2630.         self.assertIn('name', self.get_indexes(AuthorWithIndexedName._meta.db_table))
2631. 
2632.         # Add the custom index
2633.         index = Index(fields=['-name'], name='author_name_idx')
2634.         author_index_name = index.name
2635.         with connection.schema_editor() as editor:
2636.             db_index_name = editor._create_index_name(
2637.                 table_name=AuthorWithIndexedName._meta.db_table,
2638.                 column_names=('name',),
2639.             )
2640.         try:
2641.             AuthorWithIndexedName._meta.indexes = [index]
2642.             with connection.schema_editor() as editor:
2643.                 editor.add_index(AuthorWithIndexedName, index)
2644.             old_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2645.             self.assertIn(author_index_name, old_constraints)
2646.             self.assertIn(db_index_name, old_constraints)
2647.             # Change name field to db_index=False
2648.             old_field = AuthorWithIndexedName._meta.get_field('name')
2649.             new_field = CharField(max_length=255)
2650.             new_field.set_attributes_from_name('name')
2651.             with connection.schema_editor() as editor:
2652.                 editor.alter_field(AuthorWithIndexedName, old_field, new_field, strict=True)
2653.             new_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2654.             self.assertNotIn(db_index_name, new_constraints)
2655.             # The index from Meta.indexes is still in the database.
2656.             self.assertIn(author_index_name, new_constraints)
2657.             # Drop the index
2658.             with connection.schema_editor() as editor:
2659.                 editor.remove_index(AuthorWithIndexedName, index)
2660.         finally:
2661.             AuthorWithIndexedName._meta.indexes = []
2662. 
2663.     def test_order_index(self):
2664.         """
2665.         Indexes defined with ordering (ASC/DESC) defined on column
2666.         """
2667.         with connection.schema_editor() as editor:
2668.             editor.create_model(Author)
2669.         # The table doesn't have an index
2670.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2671.         index_name = 'author_name_idx'
2672.         # Add the index
2673.         index = Index(fields=['name', '-weight'], name=index_name)
2674.         with connection.schema_editor() as editor:
2675.             editor.add_index(Author, index)
2676.         if connection.features.supports_index_column_ordering:
2677.             self.assertIndexOrder(Author._meta.db_table, index_name, ['ASC', 'DESC'])
2678.         # Drop the index
2679.         with connection.schema_editor() as editor:
2680.             editor.remove_index(Author, index)
2681. 
2682.     def test_indexes(self):
2683.         """
2684.         Tests creation/altering of indexes
2685.         """
2686.         # Create the table
2687.         with connection.schema_editor() as editor:
2688.             editor.create_model(Author)
2689.             editor.create_model(Book)
2690.         # Ensure the table is there and has the right index
2691.         self.assertIn(
2692.             "title",
2693.             self.get_indexes(Book._meta.db_table),
2694.         )
2695.         # Alter to remove the index
2696.         old_field = Book._meta.get_field("title")
2697.         new_field = CharField(max_length=100, db_index=False)
2698.         new_field.set_attributes_from_name("title")
2699.         with connection.schema_editor() as editor:
2700.             editor.alter_field(Book, old_field, new_field, strict=True)
2701.         # Ensure the table is there and has no index
2702.         self.assertNotIn(
2703.             "title",
2704.             self.get_indexes(Book._meta.db_table),
2705.         )
2706.         # Alter to re-add the index
2707.         new_field2 = Book._meta.get_field("title")
2708.         with connection.schema_editor() as editor:
2709.             editor.alter_field(Book, new_field, new_field2, strict=True)
2710.         # Ensure the table is there and has the index again
2711.         self.assertIn(
2712.             "title",
2713.             self.get_indexes(Book._meta.db_table),
2714.         )
2715.         # Add a unique column, verify that creates an implicit index
2716.         new_field3 = BookWithSlug._meta.get_field("slug")
2717.         with connection.schema_editor() as editor:
2718.             editor.add_field(Book, new_field3)
2719.         self.assertIn(
2720.             "slug",
2721.             self.get_uniques(Book._meta.db_table),
2722.         )
2723.         # Remove the unique, check the index goes with it
2724.         new_field4 = CharField(max_length=20, unique=False)
2725.         new_field4.set_attributes_from_name("slug")
2726.         with connection.schema_editor() as editor:
2727.             editor.alter_field(BookWithSlug, new_field3, new_field4, strict=True)
2728.         self.assertNotIn(
2729.             "slug",
2730.             self.get_uniques(Book._meta.db_table),
2731.         )
2732. 
2733.     def test_text_field_with_db_index(self):
2734.         with connection.schema_editor() as editor:
2735.             editor.create_model(AuthorTextFieldWithIndex)
2736.         # The text_field index is present if the database supports it.
2737.         assertion = self.assertIn if connection.features.supports_index_on_text_field else self.assertNotIn
2738.         assertion('text_field', self.get_indexes(AuthorTextFieldWithIndex._meta.db_table))
2739. 
2740.     def _index_expressions_wrappers(self):
2741.         index_expression = IndexExpression()
2742.         index_expression.set_wrapper_classes(connection)
2743.         return ', '.join([
2744.             wrapper_cls.__qualname__ for wrapper_cls in index_expression.wrapper_classes
2745.         ])
2746. 
2747.     @skipUnlessDBFeature('supports_expression_indexes')
2748.     def test_func_index_multiple_wrapper_references(self):
2749.         index = Index(OrderBy(F('name').desc(), descending=True), name='name')
2750.         msg = (
2751.             "Multiple references to %s can't be used in an indexed expression."
2752.             % self._index_expressions_wrappers()
2753.         )
2754.         with connection.schema_editor() as editor:
2755.             with self.assertRaisesMessage(ValueError, msg):
2756.                 editor.add_index(Author, index)
2757. 
2758.     @skipUnlessDBFeature('supports_expression_indexes')
2759.     def test_func_index_invalid_topmost_expressions(self):
2760.         index = Index(Upper(F('name').desc()), name='name')
2761.         msg = (
2762.             '%s must be topmost expressions in an indexed expression.'
2763.             % self._index_expressions_wrappers()
2764.         )
2765.         with connection.schema_editor() as editor:
2766.             with self.assertRaisesMessage(ValueError, msg):
2767.                 editor.add_index(Author, index)
2768. 
2769.     @skipUnlessDBFeature('supports_expression_indexes')
2770.     def test_func_index(self):
2771.         with connection.schema_editor() as editor:
2772.             editor.create_model(Author)
2773.         index = Index(Lower('name').desc(), name='func_lower_idx')
2774.         # Add index.
2775.         with connection.schema_editor() as editor:
2776.             editor.add_index(Author, index)
2777.             sql = index.create_sql(Author, editor)
2778.         table = Author._meta.db_table
2779.         if connection.features.supports_index_column_ordering:
2780.             self.assertIndexOrder(table, index.name, ['DESC'])
2781.         # SQL contains a database function.
2782.         self.assertIs(sql.references_column(table, 'name'), True)
2783.         self.assertIn('LOWER(%s)' % editor.quote_name('name'), str(sql))
2784.         # Remove index.
2785.         with connection.schema_editor() as editor:
2786.             editor.remove_index(Author, index)
2787.         self.assertNotIn(index.name, self.get_constraints(table))
2788. 
2789.     @skipUnlessDBFeature('supports_expression_indexes')
2790.     def test_func_index_f(self):
2791.         with connection.schema_editor() as editor:
2792.             editor.create_model(Tag)
2793.         index = Index('slug', F('title').desc(), name='func_f_idx')
2794.         # Add index.
2795.         with connection.schema_editor() as editor:
2796.             editor.add_index(Tag, index)
2797.             sql = index.create_sql(Tag, editor)
2798.         table = Tag._meta.db_table
2799.         self.assertIn(index.name, self.get_constraints(table))
2800.         if connection.features.supports_index_column_ordering:
2801.             self.assertIndexOrder(Tag._meta.db_table, index.name, ['ASC', 'DESC'])
2802.         # SQL contains columns.
2803.         self.assertIs(sql.references_column(table, 'slug'), True)
2804.         self.assertIs(sql.references_column(table, 'title'), True)
2805.         # Remove index.
2806.         with connection.schema_editor() as editor:
2807.             editor.remove_index(Tag, index)
2808.         self.assertNotIn(index.name, self.get_constraints(table))
2809. 
2810.     @skipUnlessDBFeature('supports_expression_indexes')
2811.     def test_func_index_lookups(self):
2812.         with connection.schema_editor() as editor:
2813.             editor.create_model(Author)
2814.         with register_lookup(CharField, Lower), register_lookup(IntegerField, Abs):
2815.             index = Index(
2816.                 F('name__lower'),
2817.                 F('weight__abs'),
2818.                 name='func_lower_abs_lookup_idx',
2819.             )
2820.             # Add index.
2821.             with connection.schema_editor() as editor:
2822.                 editor.add_index(Author, index)
2823.                 sql = index.create_sql(Author, editor)
2824.         table = Author._meta.db_table
2825.         self.assertIn(index.name, self.get_constraints(table))
2826.         # SQL contains columns.
2827.         self.assertIs(sql.references_column(table, 'name'), True)
2828.         self.assertIs(sql.references_column(table, 'weight'), True)
2829.         # Remove index.
2830.         with connection.schema_editor() as editor:
2831.             editor.remove_index(Author, index)
2832.         self.assertNotIn(index.name, self.get_constraints(table))
2833. 
2834.     @skipUnlessDBFeature('supports_expression_indexes')
2835.     def test_composite_func_index(self):
2836.         with connection.schema_editor() as editor:
2837.             editor.create_model(Author)
2838.         index = Index(Lower('name'), Upper('name'), name='func_lower_upper_idx')
2839.         # Add index.
2840.         with connection.schema_editor() as editor:
2841.             editor.add_index(Author, index)
2842.             sql = index.create_sql(Author, editor)
2843.         table = Author._meta.db_table
2844.         self.assertIn(index.name, self.get_constraints(table))
2845.         # SQL contains database functions.
2846.         self.assertIs(sql.references_column(table, 'name'), True)
2847.         sql = str(sql)
2848.         self.assertIn('LOWER(%s)' % editor.quote_name('name'), sql)
2849.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), sql)
2850.         self.assertLess(sql.index('LOWER'), sql.index('UPPER'))
2851.         # Remove index.
2852.         with connection.schema_editor() as editor:
2853.             editor.remove_index(Author, index)
2854.         self.assertNotIn(index.name, self.get_constraints(table))
2855. 
2856.     @skipUnlessDBFeature('supports_expression_indexes')
2857.     def test_composite_func_index_field_and_expression(self):
2858.         with connection.schema_editor() as editor:
2859.             editor.create_model(Author)
2860.             editor.create_model(Book)
2861.         index = Index(
2862.             F('author').desc(),
2863.             Lower('title').asc(),
2864.             'pub_date',
2865.             name='func_f_lower_field_idx',
2866.         )
2867.         # Add index.
2868.         with connection.schema_editor() as editor:
2869.             editor.add_index(Book, index)
2870.             sql = index.create_sql(Book, editor)
2871.         table = Book._meta.db_table
2872.         constraints = self.get_constraints(table)
2873.         if connection.features.supports_index_column_ordering:
2874.             self.assertIndexOrder(table, index.name, ['DESC', 'ASC', 'ASC'])
2875.         self.assertEqual(len(constraints[index.name]['columns']), 3)
2876.         self.assertEqual(constraints[index.name]['columns'][2], 'pub_date')
2877.         # SQL contains database functions and columns.
2878.         self.assertIs(sql.references_column(table, 'author_id'), True)
2879.         self.assertIs(sql.references_column(table, 'title'), True)
2880.         self.assertIs(sql.references_column(table, 'pub_date'), True)
2881.         self.assertIn('LOWER(%s)' % editor.quote_name('title'), str(sql))
2882.         # Remove index.
2883.         with connection.schema_editor() as editor:
2884.             editor.remove_index(Book, index)
2885.         self.assertNotIn(index.name, self.get_constraints(table))
2886. 
2887.     @skipUnlessDBFeature('supports_expression_indexes')
2888.     @isolate_apps('schema')
2889.     def test_func_index_f_decimalfield(self):
2890.         class Node(Model):
2891.             value = DecimalField(max_digits=5, decimal_places=2)
2892. 
2893.             class Meta:
2894.                 app_label = 'schema'
2895. 
2896.         with connection.schema_editor() as editor:
2897.             editor.create_model(Node)
2898.         index = Index(F('value'), name='func_f_decimalfield_idx')
2899.         # Add index.
2900.         with connection.schema_editor() as editor:
2901.             editor.add_index(Node, index)
2902.             sql = index.create_sql(Node, editor)
2903.         table = Node._meta.db_table
2904.         self.assertIn(index.name, self.get_constraints(table))
2905.         self.assertIs(sql.references_column(table, 'value'), True)
2906.         # SQL doesn't contain casting.
2907.         self.assertNotIn('CAST', str(sql))
2908.         # Remove index.
2909.         with connection.schema_editor() as editor:
2910.             editor.remove_index(Node, index)
2911.         self.assertNotIn(index.name, self.get_constraints(table))
2912. 
2913.     @skipUnlessDBFeature('supports_expression_indexes')
2914.     def test_func_index_cast(self):
2915.         with connection.schema_editor() as editor:
2916.             editor.create_model(Author)
2917.         index = Index(Cast('weight', FloatField()), name='func_cast_idx')
2918.         # Add index.
2919.         with connection.schema_editor() as editor:
2920.             editor.add_index(Author, index)
2921.             sql = index.create_sql(Author, editor)
2922.         table = Author._meta.db_table
2923.         self.assertIn(index.name, self.get_constraints(table))
2924.         self.assertIs(sql.references_column(table, 'weight'), True)
2925.         # Remove index.
2926.         with connection.schema_editor() as editor:
2927.             editor.remove_index(Author, index)
2928.         self.assertNotIn(index.name, self.get_constraints(table))
2929. 
2930.     @skipUnlessDBFeature('supports_expression_indexes')
2931.     def test_func_index_collate(self):
2932.         collation = connection.features.test_collations.get('non_default')
2933.         if not collation:
2934.             self.skipTest(
2935.                 'This backend does not support case-insensitive collations.'
2936.             )
2937.         with connection.schema_editor() as editor:
2938.             editor.create_model(Author)
2939.             editor.create_model(BookWithSlug)
2940.         index = Index(
2941.             Collate(F('title'), collation=collation).desc(),
2942.             Collate('slug', collation=collation),
2943.             name='func_collate_idx',
2944.         )
2945.         # Add index.
2946.         with connection.schema_editor() as editor:
2947.             editor.add_index(BookWithSlug, index)
2948.             sql = index.create_sql(BookWithSlug, editor)
2949.         table = Book._meta.db_table
2950.         self.assertIn(index.name, self.get_constraints(table))
2951.         if connection.features.supports_index_column_ordering:
2952.             self.assertIndexOrder(table, index.name, ['DESC', 'ASC'])
2953.         # SQL contains columns and a collation.
2954.         self.assertIs(sql.references_column(table, 'title'), True)
2955.         self.assertIs(sql.references_column(table, 'slug'), True)
2956.         self.assertIn('COLLATE %s' % editor.quote_name(collation), str(sql))
2957.         # Remove index.
2958.         with connection.schema_editor() as editor:
2959.             editor.remove_index(Book, index)
2960.         self.assertNotIn(index.name, self.get_constraints(table))
2961. 
2962.     @skipUnlessDBFeature('supports_expression_indexes')
2963.     @skipIfDBFeature('collate_as_index_expression')
2964.     def test_func_index_collate_f_ordered(self):
2965.         collation = connection.features.test_collations.get('non_default')
2966.         if not collation:
2967.             self.skipTest(
2968.                 'This backend does not support case-insensitive collations.'
2969.             )
2970.         with connection.schema_editor() as editor:
2971.             editor.create_model(Author)
2972.         index = Index(
2973.             Collate(F('name').desc(), collation=collation),
2974.             name='func_collate_f_desc_idx',
2975.         )
2976.         # Add index.
2977.         with connection.schema_editor() as editor:
2978.             editor.add_index(Author, index)
2979.             sql = index.create_sql(Author, editor)
2980.         table = Author._meta.db_table
2981.         self.assertIn(index.name, self.get_constraints(table))
2982.         if connection.features.supports_index_column_ordering:
2983.             self.assertIndexOrder(table, index.name, ['DESC'])
2984.         # SQL contains columns and a collation.
2985.         self.assertIs(sql.references_column(table, 'name'), True)
2986.         self.assertIn('COLLATE %s' % editor.quote_name(collation), str(sql))
2987.         # Remove index.
2988.         with connection.schema_editor() as editor:
2989.             editor.remove_index(Author, index)
2990.         self.assertNotIn(index.name, self.get_constraints(table))
2991. 
2992.     @skipUnlessDBFeature('supports_expression_indexes')
2993.     def test_func_index_calc(self):
2994.         with connection.schema_editor() as editor:
2995.             editor.create_model(Author)
2996.         index = Index(F('height') / (F('weight') + Value(5)), name='func_calc_idx')
2997.         # Add index.
2998.         with connection.schema_editor() as editor:
2999.             editor.add_index(Author, index)
3000.             sql = index.create_sql(Author, editor)
3001.         table = Author._meta.db_table
3002.         self.assertIn(index.name, self.get_constraints(table))
3003.         # SQL contains columns and expressions.
3004.         self.assertIs(sql.references_column(table, 'height'), True)
3005.         self.assertIs(sql.references_column(table, 'weight'), True)
3006.         sql = str(sql)
3007.         self.assertIs(
3008.             sql.index(editor.quote_name('height')) <
3009.             sql.index('/') <
3010.             sql.index(editor.quote_name('weight')) <
3011.             sql.index('+') <
3012.             sql.index('5'),
3013.             True,
3014.         )
3015.         # Remove index.
3016.         with connection.schema_editor() as editor:
3017.             editor.remove_index(Author, index)
3018.         self.assertNotIn(index.name, self.get_constraints(table))
3019. 
3020.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_json_field')
3021.     @isolate_apps('schema')
3022.     def test_func_index_json_key_transform(self):
3023.         class JSONModel(Model):
3024.             field = JSONField()
3025. 
3026.             class Meta:
3027.                 app_label = 'schema'
3028. 
3029.         with connection.schema_editor() as editor:
3030.             editor.create_model(JSONModel)
3031.         self.isolated_local_models = [JSONModel]
3032.         index = Index('field__some_key', name='func_json_key_idx')
3033.         with connection.schema_editor() as editor:
3034.             editor.add_index(JSONModel, index)
3035.             sql = index.create_sql(JSONModel, editor)
3036.         table = JSONModel._meta.db_table
3037.         self.assertIn(index.name, self.get_constraints(table))
3038.         self.assertIs(sql.references_column(table, 'field'), True)
3039.         with connection.schema_editor() as editor:
3040.             editor.remove_index(JSONModel, index)
3041.         self.assertNotIn(index.name, self.get_constraints(table))
3042. 
3043.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_json_field')
3044.     @isolate_apps('schema')
3045.     def test_func_index_json_key_transform_cast(self):
3046.         class JSONModel(Model):
3047.             field = JSONField()
3048. 
3049.             class Meta:
3050.                 app_label = 'schema'
3051. 
3052.         with connection.schema_editor() as editor:
3053.             editor.create_model(JSONModel)
3054.         self.isolated_local_models = [JSONModel]
3055.         index = Index(
3056.             Cast(KeyTextTransform('some_key', 'field'), IntegerField()),
3057.             name='func_json_key_cast_idx',
3058.         )
3059.         with connection.schema_editor() as editor:
3060.             editor.add_index(JSONModel, index)
3061.             sql = index.create_sql(JSONModel, editor)
3062.         table = JSONModel._meta.db_table
3063.         self.assertIn(index.name, self.get_constraints(table))
3064.         self.assertIs(sql.references_column(table, 'field'), True)
3065.         with connection.schema_editor() as editor:
3066.             editor.remove_index(JSONModel, index)
3067.         self.assertNotIn(index.name, self.get_constraints(table))
3068. 
3069.     @skipIfDBFeature('supports_expression_indexes')
3070.     def test_func_index_unsupported(self):
3071.         # Index is ignored on databases that don't support indexes on
3072.         # expressions.
3073.         with connection.schema_editor() as editor:
3074.             editor.create_model(Author)
3075.         index = Index(F('name'), name='random_idx')
3076.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3077.             self.assertIsNone(editor.add_index(Author, index))
3078.             self.assertIsNone(editor.remove_index(Author, index))
3079. 
3080.     @skipUnlessDBFeature('supports_expression_indexes')
3081.     def test_func_index_nonexistent_field(self):
3082.         index = Index(Lower('nonexistent'), name='func_nonexistent_idx')
3083.         msg = (
3084.             "Cannot resolve keyword 'nonexistent' into field. Choices are: "
3085.             "height, id, name, uuid, weight"
3086.         )
3087.         with self.assertRaisesMessage(FieldError, msg):
3088.             with connection.schema_editor() as editor:
3089.                 editor.add_index(Author, index)
3090. 
3091.     @skipUnlessDBFeature('supports_expression_indexes')
3092.     def test_func_index_nondeterministic(self):
3093.         with connection.schema_editor() as editor:
3094.             editor.create_model(Author)
3095.         index = Index(Random(), name='func_random_idx')
3096.         with connection.schema_editor() as editor:
3097.             with self.assertRaises(DatabaseError):
3098.                 editor.add_index(Author, index)
3099. 
3100.     def test_primary_key(self):
3101.         """
3102.         Tests altering of the primary key
3103.         """
3104.         # Create the table
3105.         with connection.schema_editor() as editor:
3106.             editor.create_model(Tag)
3107.         # Ensure the table is there and has the right PK
3108.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'id')
3109.         # Alter to change the PK
3110.         id_field = Tag._meta.get_field("id")
3111.         old_field = Tag._meta.get_field("slug")
3112.         new_field = SlugField(primary_key=True)
3113.         new_field.set_attributes_from_name("slug")
3114.         new_field.model = Tag
3115.         with connection.schema_editor() as editor:
3116.             editor.remove_field(Tag, id_field)
3117.             editor.alter_field(Tag, old_field, new_field)
3118.         # Ensure the PK changed
3119.         self.assertNotIn(
3120.             'id',
3121.             self.get_indexes(Tag._meta.db_table),
3122.         )
3123.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'slug')
3124. 
3125.     def test_context_manager_exit(self):
3126.         """
3127.         Ensures transaction is correctly closed when an error occurs
3128.         inside a SchemaEditor context.
3129.         """
3130.         class SomeError(Exception):
3131.             pass
3132.         try:
3133.             with connection.schema_editor():
3134.                 raise SomeError
3135.         except SomeError:
3136.             self.assertFalse(connection.in_atomic_block)
3137. 
3138.     @skipIfDBFeature('can_rollback_ddl')
3139.     def test_unsupported_transactional_ddl_disallowed(self):
3140.         message = (
3141.             "Executing DDL statements while in a transaction on databases "
3142.             "that can't perform a rollback is prohibited."
3143.         )
3144.         with atomic(), connection.schema_editor() as editor:
3145.             with self.assertRaisesMessage(TransactionManagementError, message):
3146.                 editor.execute(editor.sql_create_table % {'table': 'foo', 'definition': ''})
3147. 
3148.     @skipUnlessDBFeature('supports_foreign_keys', 'indexes_foreign_keys')
3149.     def test_foreign_key_index_long_names_regression(self):
3150.         """
3151.         Regression test for #21497.
3152.         Only affects databases that supports foreign keys.
3153.         """
3154.         # Create the table
3155.         with connection.schema_editor() as editor:
3156.             editor.create_model(AuthorWithEvenLongerName)
3157.             editor.create_model(BookWithLongName)
3158.         # Find the properly shortened column name
3159.         column_name = connection.ops.quote_name("author_foreign_key_with_really_long_field_name_id")
3160.         column_name = column_name[1:-1].lower()  # unquote, and, for Oracle, un-upcase
3161.         # Ensure the table is there and has an index on the column
3162.         self.assertIn(
3163.             column_name,
3164.             self.get_indexes(BookWithLongName._meta.db_table),
3165.         )
3166. 
3167.     @skipUnlessDBFeature('supports_foreign_keys')
3168.     def test_add_foreign_key_long_names(self):
3169.         """
3170.         Regression test for #23009.
3171.         Only affects databases that supports foreign keys.
3172.         """
3173.         # Create the initial tables
3174.         with connection.schema_editor() as editor:
3175.             editor.create_model(AuthorWithEvenLongerName)
3176.             editor.create_model(BookWithLongName)
3177.         # Add a second FK, this would fail due to long ref name before the fix
3178.         new_field = ForeignKey(AuthorWithEvenLongerName, CASCADE, related_name="something")
3179.         new_field.set_attributes_from_name("author_other_really_long_named_i_mean_so_long_fk")
3180.         with connection.schema_editor() as editor:
3181.             editor.add_field(BookWithLongName, new_field)
3182. 
3183.     @isolate_apps('schema')
3184.     @skipUnlessDBFeature('supports_foreign_keys')
3185.     def test_add_foreign_key_quoted_db_table(self):
3186.         class Author(Model):
3187.             class Meta:
3188.                 db_table = '"table_author_double_quoted"'
3189.                 app_label = 'schema'
3190. 
3191.         class Book(Model):
3192.             author = ForeignKey(Author, CASCADE)
3193. 
3194.             class Meta:
3195.                 app_label = 'schema'
3196. 
3197.         with connection.schema_editor() as editor:
3198.             editor.create_model(Author)
3199.             editor.create_model(Book)
3200.         if connection.vendor == 'mysql':
3201.             self.assertForeignKeyExists(Book, 'author_id', '"table_author_double_quoted"')
3202.         else:
3203.             self.assertForeignKeyExists(Book, 'author_id', 'table_author_double_quoted')
3204. 
3205.     def test_add_foreign_object(self):
3206.         with connection.schema_editor() as editor:
3207.             editor.create_model(BookForeignObj)
3208. 
3209.         new_field = ForeignObject(Author, on_delete=CASCADE, from_fields=['author_id'], to_fields=['id'])
3210.         new_field.set_attributes_from_name('author')
3211.         with connection.schema_editor() as editor:
3212.             editor.add_field(BookForeignObj, new_field)
3213. 
3214.     def test_creation_deletion_reserved_names(self):
3215.         """
3216.         Tries creating a model's table, and then deleting it when it has a
3217.         SQL reserved name.
3218.         """
3219.         # Create the table
3220.         with connection.schema_editor() as editor:
3221.             try:
3222.                 editor.create_model(Thing)
3223.             except OperationalError as e:
3224.                 self.fail("Errors when applying initial migration for a model "
3225.                           "with a table named after an SQL reserved word: %s" % e)
3226.         # The table is there
3227.         list(Thing.objects.all())
3228.         # Clean up that table
3229.         with connection.schema_editor() as editor:
3230.             editor.delete_model(Thing)
3231.         # The table is gone
3232.         with self.assertRaises(DatabaseError):
3233.             list(Thing.objects.all())
3234. 
3235.     def test_remove_constraints_capital_letters(self):
3236.         """
3237.         #23065 - Constraint names must be quoted if they contain capital letters.
3238.         """
3239.         def get_field(*args, field_class=IntegerField, **kwargs):
3240.             kwargs['db_column'] = "CamelCase"
3241.             field = field_class(*args, **kwargs)
3242.             field.set_attributes_from_name("CamelCase")
3243.             return field
3244. 
3245.         model = Author
3246.         field = get_field()
3247.         table = model._meta.db_table
3248.         column = field.column
3249.         identifier_converter = connection.introspection.identifier_converter
3250. 
3251.         with connection.schema_editor() as editor:
3252.             editor.create_model(model)
3253.             editor.add_field(model, field)
3254. 
3255.             constraint_name = 'CamelCaseIndex'
3256.             expected_constraint_name = identifier_converter(constraint_name)
3257.             editor.execute(
3258.                 editor.sql_create_index % {
3259.                     "table": editor.quote_name(table),
3260.                     "name": editor.quote_name(constraint_name),
3261.                     "using": "",
3262.                     "columns": editor.quote_name(column),
3263.                     "extra": "",
3264.                     "condition": "",
3265.                     "include": "",
3266.                 }
3267.             )
3268.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3269.             editor.alter_field(model, get_field(db_index=True), field, strict=True)
3270.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3271. 
3272.             constraint_name = 'CamelCaseUniqConstraint'
3273.             expected_constraint_name = identifier_converter(constraint_name)
3274.             editor.execute(editor._create_unique_sql(model, [field.column], constraint_name))
3275.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3276.             editor.alter_field(model, get_field(unique=True), field, strict=True)
3277.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3278. 
3279.             if editor.sql_create_fk:
3280.                 constraint_name = 'CamelCaseFKConstraint'
3281.                 expected_constraint_name = identifier_converter(constraint_name)
3282.                 editor.execute(
3283.                     editor.sql_create_fk % {
3284.                         "table": editor.quote_name(table),
3285.                         "name": editor.quote_name(constraint_name),
3286.                         "column": editor.quote_name(column),
3287.                         "to_table": editor.quote_name(table),
3288.                         "to_column": editor.quote_name(model._meta.auto_field.column),
3289.                         "deferrable": connection.ops.deferrable_sql(),
3290.                     }
3291.                 )
3292.                 self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3293.                 editor.alter_field(model, get_field(Author, CASCADE, field_class=ForeignKey), field, strict=True)
3294.                 self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3295. 
3296.     def test_add_field_use_effective_default(self):
3297.         """
3298.         #23987 - effective_default() should be used as the field default when
3299.         adding a new field.
3300.         """
3301.         # Create the table
3302.         with connection.schema_editor() as editor:
3303.             editor.create_model(Author)
3304.         # Ensure there's no surname field
3305.         columns = self.column_classes(Author)
3306.         self.assertNotIn("surname", columns)
3307.         # Create a row
3308.         Author.objects.create(name='Anonymous1')
3309.         # Add new CharField to ensure default will be used from effective_default
3310.         new_field = CharField(max_length=15, blank=True)
3311.         new_field.set_attributes_from_name("surname")
3312.         with connection.schema_editor() as editor:
3313.             editor.add_field(Author, new_field)
3314.         # Ensure field was added with the right default
3315.         with connection.cursor() as cursor:
3316.             cursor.execute("SELECT surname FROM schema_author;")
3317.             item = cursor.fetchall()[0]
3318.             self.assertEqual(item[0], None if connection.features.interprets_empty_strings_as_nulls else '')
3319. 
3320.     def test_add_field_default_dropped(self):
3321.         # Create the table
3322.         with connection.schema_editor() as editor:
3323.             editor.create_model(Author)
3324.         # Ensure there's no surname field
3325.         columns = self.column_classes(Author)
3326.         self.assertNotIn("surname", columns)
3327.         # Create a row
3328.         Author.objects.create(name='Anonymous1')
3329.         # Add new CharField with a default
3330.         new_field = CharField(max_length=15, blank=True, default='surname default')
3331.         new_field.set_attributes_from_name("surname")
3332.         with connection.schema_editor() as editor:
3333.             editor.add_field(Author, new_field)
3334.         # Ensure field was added with the right default
3335.         with connection.cursor() as cursor:
3336.             cursor.execute("SELECT surname FROM schema_author;")
3337.             item = cursor.fetchall()[0]
3338.             self.assertEqual(item[0], 'surname default')
3339.             # And that the default is no longer set in the database.
3340.             field = next(
3341.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
3342.                 if f.name == "surname"
3343.             )
3344.             if connection.features.can_introspect_default:
3345.                 self.assertIsNone(field.default)
3346. 
3347.     def test_add_field_default_nullable(self):
3348.         with connection.schema_editor() as editor:
3349.             editor.create_model(Author)
3350.         # Add new nullable CharField with a default.
3351.         new_field = CharField(max_length=15, blank=True, null=True, default='surname')
3352.         new_field.set_attributes_from_name('surname')
3353.         with connection.schema_editor() as editor:
3354.             editor.add_field(Author, new_field)
3355.         Author.objects.create(name='Anonymous1')
3356.         with connection.cursor() as cursor:
3357.             cursor.execute('SELECT surname FROM schema_author;')
3358.             item = cursor.fetchall()[0]
3359.             self.assertIsNone(item[0])
3360.             field = next(
3361.                 f
3362.                 for f in connection.introspection.get_table_description(
3363.                     cursor,
3364.                     'schema_author',
3365.                 )
3366.                 if f.name == 'surname'
3367.             )
3368.             # Field is still nullable.
3369.             self.assertTrue(field.null_ok)
3370.             # The database default is no longer set.
3371.             if connection.features.can_introspect_default:
3372.                 self.assertIn(field.default, ['NULL', None])
3373. 
3374.     def test_alter_field_default_dropped(self):
3375.         # Create the table
3376.         with connection.schema_editor() as editor:
3377.             editor.create_model(Author)
3378.         # Create a row
3379.         Author.objects.create(name='Anonymous1')
3380.         self.assertIsNone(Author.objects.get().height)
3381.         old_field = Author._meta.get_field('height')
3382.         # The default from the new field is used in updating existing rows.
3383.         new_field = IntegerField(blank=True, default=42)
3384.         new_field.set_attributes_from_name('height')
3385.         with connection.schema_editor() as editor:
3386.             editor.alter_field(Author, old_field, new_field, strict=True)
3387.         self.assertEqual(Author.objects.get().height, 42)
3388.         # The database default should be removed.
3389.         with connection.cursor() as cursor:
3390.             field = next(
3391.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
3392.                 if f.name == "height"
3393.             )
3394.             if connection.features.can_introspect_default:
3395.                 self.assertIsNone(field.default)
3396. 
3397.     def test_alter_field_default_doesnt_perform_queries(self):
3398.         """
3399.         No queries are performed if a field default changes and the field's
3400.         not changing from null to non-null.
3401.         """
3402.         with connection.schema_editor() as editor:
3403.             editor.create_model(AuthorWithDefaultHeight)
3404.         old_field = AuthorWithDefaultHeight._meta.get_field('height')
3405.         new_default = old_field.default * 2
3406.         new_field = PositiveIntegerField(null=True, blank=True, default=new_default)
3407.         new_field.set_attributes_from_name('height')
3408.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3409.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
3410. 
3411.     @skipUnlessDBFeature('supports_foreign_keys')
3412.     def test_alter_field_fk_attributes_noop(self):
3413.         """
3414.         No queries are performed when changing field attributes that don't
3415.         affect the schema.
3416.         """
3417.         with connection.schema_editor() as editor:
3418.             editor.create_model(Author)
3419.             editor.create_model(Book)
3420.         old_field = Book._meta.get_field('author')
3421.         new_field = ForeignKey(
3422.             Author,
3423.             blank=True,
3424.             editable=False,
3425.             error_messages={'invalid': 'error message'},
3426.             help_text='help text',
3427.             limit_choices_to={'limit': 'choice'},
3428.             on_delete=PROTECT,
3429.             related_name='related_name',
3430.             related_query_name='related_query_name',
3431.             validators=[lambda x: x],
3432.             verbose_name='verbose name',
3433.         )
3434.         new_field.set_attributes_from_name('author')
3435.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3436.             editor.alter_field(Book, old_field, new_field, strict=True)
3437.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3438.             editor.alter_field(Book, new_field, old_field, strict=True)
3439. 
3440.     def test_add_textfield_unhashable_default(self):
3441.         # Create the table
3442.         with connection.schema_editor() as editor:
3443.             editor.create_model(Author)
3444.         # Create a row
3445.         Author.objects.create(name='Anonymous1')
3446.         # Create a field that has an unhashable default
3447.         new_field = TextField(default={})
3448.         new_field.set_attributes_from_name("info")
3449.         with connection.schema_editor() as editor:
3450.             editor.add_field(Author, new_field)
3451. 
3452.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3453.     def test_add_indexed_charfield(self):
3454.         field = CharField(max_length=255, db_index=True)
3455.         field.set_attributes_from_name('nom_de_plume')
3456.         with connection.schema_editor() as editor:
3457.             editor.create_model(Author)
3458.             editor.add_field(Author, field)
3459.         # Should create two indexes; one for like operator.
3460.         self.assertEqual(
3461.             self.get_constraints_for_column(Author, 'nom_de_plume'),
3462.             ['schema_author_nom_de_plume_7570a851', 'schema_author_nom_de_plume_7570a851_like'],
3463.         )
3464. 
3465.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3466.     def test_add_unique_charfield(self):
3467.         field = CharField(max_length=255, unique=True)
3468.         field.set_attributes_from_name('nom_de_plume')
3469.         with connection.schema_editor() as editor:
3470.             editor.create_model(Author)
3471.             editor.add_field(Author, field)
3472.         # Should create two indexes; one for like operator.
3473.         self.assertEqual(
3474.             self.get_constraints_for_column(Author, 'nom_de_plume'),
3475.             ['schema_author_nom_de_plume_7570a851_like', 'schema_author_nom_de_plume_key']
3476.         )
3477. 
3478.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3479.     def test_alter_field_add_index_to_charfield(self):
3480.         # Create the table and verify no initial indexes.
3481.         with connection.schema_editor() as editor:
3482.             editor.create_model(Author)
3483.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3484.         # Alter to add db_index=True and create 2 indexes.
3485.         old_field = Author._meta.get_field('name')
3486.         new_field = CharField(max_length=255, db_index=True)
3487.         new_field.set_attributes_from_name('name')
3488.         with connection.schema_editor() as editor:
3489.             editor.alter_field(Author, old_field, new_field, strict=True)
3490.         self.assertEqual(
3491.             self.get_constraints_for_column(Author, 'name'),
3492.             ['schema_author_name_1fbc5617', 'schema_author_name_1fbc5617_like']
3493.         )
3494.         # Remove db_index=True to drop both indexes.
3495.         with connection.schema_editor() as editor:
3496.             editor.alter_field(Author, new_field, old_field, strict=True)
3497.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3498. 
3499.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3500.     def test_alter_field_add_unique_to_charfield(self):
3501.         # Create the table and verify no initial indexes.
3502.         with connection.schema_editor() as editor:
3503.             editor.create_model(Author)
3504.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3505.         # Alter to add unique=True and create 2 indexes.
3506.         old_field = Author._meta.get_field('name')
3507.         new_field = CharField(max_length=255, unique=True)
3508.         new_field.set_attributes_from_name('name')
3509.         with connection.schema_editor() as editor:
3510.             editor.alter_field(Author, old_field, new_field, strict=True)
3511.         self.assertEqual(
3512.             self.get_constraints_for_column(Author, 'name'),
3513.             ['schema_author_name_1fbc5617_like', 'schema_author_name_1fbc5617_uniq']
3514.         )
3515.         # Remove unique=True to drop both indexes.
3516.         with connection.schema_editor() as editor:
3517.             editor.alter_field(Author, new_field, old_field, strict=True)
3518.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3519. 
3520.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3521.     def test_alter_field_add_index_to_textfield(self):
3522.         # Create the table and verify no initial indexes.
3523.         with connection.schema_editor() as editor:
3524.             editor.create_model(Note)
3525.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
3526.         # Alter to add db_index=True and create 2 indexes.
3527.         old_field = Note._meta.get_field('info')
3528.         new_field = TextField(db_index=True)
3529.         new_field.set_attributes_from_name('info')
3530.         with connection.schema_editor() as editor:
3531.             editor.alter_field(Note, old_field, new_field, strict=True)
3532.         self.assertEqual(
3533.             self.get_constraints_for_column(Note, 'info'),
3534.             ['schema_note_info_4b0ea695', 'schema_note_info_4b0ea695_like']
3535.         )
3536.         # Remove db_index=True to drop both indexes.
3537.         with connection.schema_editor() as editor:
3538.             editor.alter_field(Note, new_field, old_field, strict=True)
3539.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
3540. 
3541.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3542.     def test_alter_field_add_unique_to_charfield_with_db_index(self):
3543.         # Create the table and verify initial indexes.
3544.         with connection.schema_editor() as editor:
3545.             editor.create_model(BookWithoutAuthor)
3546.         self.assertEqual(
3547.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3548.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3549.         )
3550.         # Alter to add unique=True (should replace the index)
3551.         old_field = BookWithoutAuthor._meta.get_field('title')
3552.         new_field = CharField(max_length=100, db_index=True, unique=True)
3553.         new_field.set_attributes_from_name('title')
3554.         with connection.schema_editor() as editor:
3555.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
3556.         self.assertEqual(
3557.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3558.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
3559.         )
3560.         # Alter to remove unique=True (should drop unique index)
3561.         new_field2 = CharField(max_length=100, db_index=True)
3562.         new_field2.set_attributes_from_name('title')
3563.         with connection.schema_editor() as editor:
3564.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
3565.         self.assertEqual(
3566.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3567.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3568.         )
3569. 
3570.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3571.     def test_alter_field_remove_unique_and_db_index_from_charfield(self):
3572.         # Create the table and verify initial indexes.
3573.         with connection.schema_editor() as editor:
3574.             editor.create_model(BookWithoutAuthor)
3575.         self.assertEqual(
3576.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3577.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3578.         )
3579.         # Alter to add unique=True (should replace the index)
3580.         old_field = BookWithoutAuthor._meta.get_field('title')
3581.         new_field = CharField(max_length=100, db_index=True, unique=True)
3582.         new_field.set_attributes_from_name('title')
3583.         with connection.schema_editor() as editor:
3584.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
3585.         self.assertEqual(
3586.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3587.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
3588.         )
3589.         # Alter to remove both unique=True and db_index=True (should drop all indexes)
3590.         new_field2 = CharField(max_length=100)
3591.         new_field2.set_attributes_from_name('title')
3592.         with connection.schema_editor() as editor:
3593.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
3594.         self.assertEqual(self.get_constraints_for_column(BookWithoutAuthor, 'title'), [])
3595. 
3596.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3597.     def test_alter_field_swap_unique_and_db_index_with_charfield(self):
3598.         # Create the table and verify initial indexes.
3599.         with connection.schema_editor() as editor:
3600.             editor.create_model(BookWithoutAuthor)
3601.         self.assertEqual(
3602.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3603.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3604.         )
3605.         # Alter to set unique=True and remove db_index=True (should replace the index)
3606.         old_field = BookWithoutAuthor._meta.get_field('title')
3607.         new_field = CharField(max_length=100, unique=True)
3608.         new_field.set_attributes_from_name('title')
3609.         with connection.schema_editor() as editor:
3610.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
3611.         self.assertEqual(
3612.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3613.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
3614.         )
3615.         # Alter to set db_index=True and remove unique=True (should restore index)
3616.         new_field2 = CharField(max_length=100, db_index=True)
3617.         new_field2.set_attributes_from_name('title')
3618.         with connection.schema_editor() as editor:
3619.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
3620.         self.assertEqual(
3621.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3622.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3623.         )
3624. 
3625.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3626.     def test_alter_field_add_db_index_to_charfield_with_unique(self):
3627.         # Create the table and verify initial indexes.
3628.         with connection.schema_editor() as editor:
3629.             editor.create_model(Tag)
3630.         self.assertEqual(
3631.             self.get_constraints_for_column(Tag, 'slug'),
3632.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
3633.         )
3634.         # Alter to add db_index=True
3635.         old_field = Tag._meta.get_field('slug')
3636.         new_field = SlugField(db_index=True, unique=True)
3637.         new_field.set_attributes_from_name('slug')
3638.         with connection.schema_editor() as editor:
3639.             editor.alter_field(Tag, old_field, new_field, strict=True)
3640.         self.assertEqual(
3641.             self.get_constraints_for_column(Tag, 'slug'),
3642.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
3643.         )
3644.         # Alter to remove db_index=True
3645.         new_field2 = SlugField(unique=True)
3646.         new_field2.set_attributes_from_name('slug')
3647.         with connection.schema_editor() as editor:
3648.             editor.alter_field(Tag, new_field, new_field2, strict=True)
3649.         self.assertEqual(
3650.             self.get_constraints_for_column(Tag, 'slug'),
3651.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
3652.         )
3653. 
3654.     def test_alter_field_add_index_to_integerfield(self):
3655.         # Create the table and verify no initial indexes.
3656.         with connection.schema_editor() as editor:
3657.             editor.create_model(Author)
3658.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
3659. 
3660.         # Alter to add db_index=True and create index.
3661.         old_field = Author._meta.get_field('weight')
3662.         new_field = IntegerField(null=True, db_index=True)
3663.         new_field.set_attributes_from_name('weight')
3664.         with connection.schema_editor() as editor:
3665.             editor.alter_field(Author, old_field, new_field, strict=True)
3666.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), ['schema_author_weight_587740f9'])
3667. 
3668.         # Remove db_index=True to drop index.
3669.         with connection.schema_editor() as editor:
3670.             editor.alter_field(Author, new_field, old_field, strict=True)
3671.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
3672. 
3673.     def test_alter_pk_with_self_referential_field(self):
3674.         """
3675.         Changing the primary key field name of a model with a self-referential
3676.         foreign key (#26384).
3677.         """
3678.         with connection.schema_editor() as editor:
3679.             editor.create_model(Node)
3680.         old_field = Node._meta.get_field('node_id')
3681.         new_field = AutoField(primary_key=True)
3682.         new_field.set_attributes_from_name('id')
3683.         with connection.schema_editor() as editor:
3684.             editor.alter_field(Node, old_field, new_field, strict=True)
3685.         self.assertForeignKeyExists(Node, 'parent_id', Node._meta.db_table)
3686. 
3687.     @mock.patch('django.db.backends.base.schema.datetime')
3688.     @mock.patch('django.db.backends.base.schema.timezone')
3689.     def test_add_datefield_and_datetimefield_use_effective_default(self, mocked_datetime, mocked_tz):
3690.         """
3691.         effective_default() should be used for DateField, DateTimeField, and
3692.         TimeField if auto_now or auto_now_add is set (#25005).
3693.         """
3694.         now = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1)
3695.         now_tz = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1, tzinfo=timezone.utc)
3696.         mocked_datetime.now = mock.MagicMock(return_value=now)
3697.         mocked_tz.now = mock.MagicMock(return_value=now_tz)
3698.         # Create the table
3699.         with connection.schema_editor() as editor:
3700.             editor.create_model(Author)
3701.         # Check auto_now/auto_now_add attributes are not defined
3702.         columns = self.column_classes(Author)
3703.         self.assertNotIn("dob_auto_now", columns)
3704.         self.assertNotIn("dob_auto_now_add", columns)
3705.         self.assertNotIn("dtob_auto_now", columns)
3706.         self.assertNotIn("dtob_auto_now_add", columns)
3707.         self.assertNotIn("tob_auto_now", columns)
3708.         self.assertNotIn("tob_auto_now_add", columns)
3709.         # Create a row
3710.         Author.objects.create(name='Anonymous1')
3711.         # Ensure fields were added with the correct defaults
3712.         dob_auto_now = DateField(auto_now=True)
3713.         dob_auto_now.set_attributes_from_name('dob_auto_now')
3714.         self.check_added_field_default(
3715.             editor, Author, dob_auto_now, 'dob_auto_now', now.date(),
3716.             cast_function=lambda x: x.date(),
3717.         )
3718.         dob_auto_now_add = DateField(auto_now_add=True)
3719.         dob_auto_now_add.set_attributes_from_name('dob_auto_now_add')
3720.         self.check_added_field_default(
3721.             editor, Author, dob_auto_now_add, 'dob_auto_now_add', now.date(),
3722.             cast_function=lambda x: x.date(),
3723.         )
3724.         dtob_auto_now = DateTimeField(auto_now=True)
3725.         dtob_auto_now.set_attributes_from_name('dtob_auto_now')
3726.         self.check_added_field_default(
3727.             editor, Author, dtob_auto_now, 'dtob_auto_now', now,
3728.         )
3729.         dt_tm_of_birth_auto_now_add = DateTimeField(auto_now_add=True)
3730.         dt_tm_of_birth_auto_now_add.set_attributes_from_name('dtob_auto_now_add')
3731.         self.check_added_field_default(
3732.             editor, Author, dt_tm_of_birth_auto_now_add, 'dtob_auto_now_add', now,
3733.         )
3734.         tob_auto_now = TimeField(auto_now=True)
3735.         tob_auto_now.set_attributes_from_name('tob_auto_now')
3736.         self.check_added_field_default(
3737.             editor, Author, tob_auto_now, 'tob_auto_now', now.time(),
3738.             cast_function=lambda x: x.time(),
3739.         )
3740.         tob_auto_now_add = TimeField(auto_now_add=True)
3741.         tob_auto_now_add.set_attributes_from_name('tob_auto_now_add')
3742.         self.check_added_field_default(
3743.             editor, Author, tob_auto_now_add, 'tob_auto_now_add', now.time(),
3744.             cast_function=lambda x: x.time(),
3745.         )
3746. 
3747.     def test_namespaced_db_table_create_index_name(self):
3748.         """
3749.         Table names are stripped of their namespace/schema before being used to
3750.         generate index names.
3751.         """
3752.         with connection.schema_editor() as editor:
3753.             max_name_length = connection.ops.max_name_length() or 200
3754.             namespace = 'n' * max_name_length
3755.             table_name = 't' * max_name_length
3756.             namespaced_table_name = '"%s"."%s"' % (namespace, table_name)
3757.             self.assertEqual(
3758.                 editor._create_index_name(table_name, []),
3759.                 editor._create_index_name(namespaced_table_name, []),
3760.             )
3761. 
3762.     @unittest.skipUnless(connection.vendor == 'oracle', 'Oracle specific db_table syntax')
3763.     def test_creation_with_db_table_double_quotes(self):
3764.         oracle_user = connection.creation._test_database_user()
3765. 
3766.         class Student(Model):
3767.             name = CharField(max_length=30)
3768. 
3769.             class Meta:
3770.                 app_label = 'schema'
3771.                 apps = new_apps
3772.                 db_table = '"%s"."DJANGO_STUDENT_TABLE"' % oracle_user
3773. 
3774.         class Document(Model):
3775.             name = CharField(max_length=30)
3776.             students = ManyToManyField(Student)
3777. 
3778.             class Meta:
3779.                 app_label = 'schema'
3780.                 apps = new_apps
3781.                 db_table = '"%s"."DJANGO_DOCUMENT_TABLE"' % oracle_user
3782. 
3783.         self.local_models = [Student, Document]
3784. 
3785.         with connection.schema_editor() as editor:
3786.             editor.create_model(Student)
3787.             editor.create_model(Document)
3788. 
3789.         doc = Document.objects.create(name='Test Name')
3790.         student = Student.objects.create(name='Some man')
3791.         doc.students.add(student)
3792. 
3793.     @isolate_apps('schema')
3794.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific db_table syntax.')
3795.     def test_namespaced_db_table_foreign_key_reference(self):
3796.         with connection.cursor() as cursor:
3797.             cursor.execute('CREATE SCHEMA django_schema_tests')
3798. 
3799.         def delete_schema():
3800.             with connection.cursor() as cursor:
3801.                 cursor.execute('DROP SCHEMA django_schema_tests CASCADE')
3802. 
3803.         self.addCleanup(delete_schema)
3804. 
3805.         class Author(Model):
3806.             class Meta:
3807.                 app_label = 'schema'
3808. 
3809.         class Book(Model):
3810.             class Meta:
3811.                 app_label = 'schema'
3812.                 db_table = '"django_schema_tests"."schema_book"'
3813. 
3814.         author = ForeignKey(Author, CASCADE)
3815.         author.set_attributes_from_name('author')
3816. 
3817.         with connection.schema_editor() as editor:
3818.             editor.create_model(Author)
3819.             editor.create_model(Book)
3820.             editor.add_field(Book, author)
3821. 
3822.     def test_rename_table_renames_deferred_sql_references(self):
3823.         atomic_rename = connection.features.supports_atomic_references_rename
3824.         with connection.schema_editor(atomic=atomic_rename) as editor:
3825.             editor.create_model(Author)
3826.             editor.create_model(Book)
3827.             editor.alter_db_table(Author, 'schema_author', 'schema_renamed_author')
3828.             editor.alter_db_table(Author, 'schema_book', 'schema_renamed_book')
3829.             try:
3830.                 self.assertGreater(len(editor.deferred_sql), 0)
3831.                 for statement in editor.deferred_sql:
3832.                     self.assertIs(statement.references_table('schema_author'), False)
3833.                     self.assertIs(statement.references_table('schema_book'), False)
3834.             finally:
3835.                 editor.alter_db_table(Author, 'schema_renamed_author', 'schema_author')
3836.                 editor.alter_db_table(Author, 'schema_renamed_book', 'schema_book')
3837. 
3838.     def test_rename_column_renames_deferred_sql_references(self):
3839.         with connection.schema_editor() as editor:
3840.             editor.create_model(Author)
3841.             editor.create_model(Book)
3842.             old_title = Book._meta.get_field('title')
3843.             new_title = CharField(max_length=100, db_index=True)
3844.             new_title.set_attributes_from_name('renamed_title')
3845.             editor.alter_field(Book, old_title, new_title)
3846.             old_author = Book._meta.get_field('author')
3847.             new_author = ForeignKey(Author, CASCADE)
3848.             new_author.set_attributes_from_name('renamed_author')
3849.             editor.alter_field(Book, old_author, new_author)
3850.             self.assertGreater(len(editor.deferred_sql), 0)
3851.             for statement in editor.deferred_sql:
3852.                 self.assertIs(statement.references_column('book', 'title'), False)
3853.                 self.assertIs(statement.references_column('book', 'author_id'), False)
3854. 
3855.     @isolate_apps('schema')
3856.     def test_referenced_field_without_constraint_rename_inside_atomic_block(self):
3857.         """
3858.         Foreign keys without database level constraint don't prevent the field
3859.         they reference from being renamed in an atomic block.
3860.         """
3861.         class Foo(Model):
3862.             field = CharField(max_length=255, unique=True)
3863. 
3864.             class Meta:
3865.                 app_label = 'schema'
3866. 
3867.         class Bar(Model):
3868.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3869. 
3870.             class Meta:
3871.                 app_label = 'schema'
3872. 
3873.         self.isolated_local_models = [Foo, Bar]
3874.         with connection.schema_editor() as editor:
3875.             editor.create_model(Foo)
3876.             editor.create_model(Bar)
3877. 
3878.         new_field = CharField(max_length=255, unique=True)
3879.         new_field.set_attributes_from_name('renamed')
3880.         with connection.schema_editor(atomic=True) as editor:
3881.             editor.alter_field(Foo, Foo._meta.get_field('field'), new_field)
3882. 
3883.     @isolate_apps('schema')
3884.     def test_referenced_table_without_constraint_rename_inside_atomic_block(self):
3885.         """
3886.         Foreign keys without database level constraint don't prevent the table
3887.         they reference from being renamed in an atomic block.
3888.         """
3889.         class Foo(Model):
3890.             field = CharField(max_length=255, unique=True)
3891. 
3892.             class Meta:
3893.                 app_label = 'schema'
3894. 
3895.         class Bar(Model):
3896.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3897. 
3898.             class Meta:
3899.                 app_label = 'schema'
3900. 
3901.         self.isolated_local_models = [Foo, Bar]
3902.         with connection.schema_editor() as editor:
3903.             editor.create_model(Foo)
3904.             editor.create_model(Bar)
3905. 
3906.         new_field = CharField(max_length=255, unique=True)
3907.         new_field.set_attributes_from_name('renamed')
3908.         with connection.schema_editor(atomic=True) as editor:
3909.             editor.alter_db_table(Foo, Foo._meta.db_table, 'renamed_table')
3910.         Foo._meta.db_table = 'renamed_table'
3911. 
3912.     @isolate_apps('schema')
3913.     @skipUnlessDBFeature('supports_collation_on_charfield')
3914.     def test_db_collation_charfield(self):
3915.         collation = connection.features.test_collations.get('non_default')
3916.         if not collation:
3917.             self.skipTest('Language collations are not supported.')
3918. 
3919.         class Foo(Model):
3920.             field = CharField(max_length=255, db_collation=collation)
3921. 
3922.             class Meta:
3923.                 app_label = 'schema'
3924. 
3925.         self.isolated_local_models = [Foo]
3926.         with connection.schema_editor() as editor:
3927.             editor.create_model(Foo)
3928. 
3929.         self.assertEqual(
3930.             self.get_column_collation(Foo._meta.db_table, 'field'),
3931.             collation,
3932.         )
3933. 
3934.     @isolate_apps('schema')
3935.     @skipUnlessDBFeature('supports_collation_on_textfield')
3936.     def test_db_collation_textfield(self):
3937.         collation = connection.features.test_collations.get('non_default')
3938.         if not collation:
3939.             self.skipTest('Language collations are not supported.')
3940. 
3941.         class Foo(Model):
3942.             field = TextField(db_collation=collation)
3943. 
3944.             class Meta:
3945.                 app_label = 'schema'
3946. 
3947.         self.isolated_local_models = [Foo]
3948.         with connection.schema_editor() as editor:
3949.             editor.create_model(Foo)
3950. 
3951.         self.assertEqual(
3952.             self.get_column_collation(Foo._meta.db_table, 'field'),
3953.             collation,
3954.         )
3955. 
3956.     @skipUnlessDBFeature('supports_collation_on_charfield')
3957.     def test_add_field_db_collation(self):
3958.         collation = connection.features.test_collations.get('non_default')
3959.         if not collation:
3960.             self.skipTest('Language collations are not supported.')
3961. 
3962.         with connection.schema_editor() as editor:
3963.             editor.create_model(Author)
3964. 
3965.         new_field = CharField(max_length=255, db_collation=collation)
3966.         new_field.set_attributes_from_name('alias')
3967.         with connection.schema_editor() as editor:
3968.             editor.add_field(Author, new_field)
3969.         columns = self.column_classes(Author)
3970.         self.assertEqual(
3971.             columns['alias'][0],
3972.             connection.features.introspected_field_types['CharField'],
3973.         )
3974.         self.assertEqual(columns['alias'][1][8], collation)
3975. 
3976.     @skipUnlessDBFeature('supports_collation_on_charfield')
3977.     def test_alter_field_db_collation(self):
3978.         collation = connection.features.test_collations.get('non_default')
3979.         if not collation:
3980.             self.skipTest('Language collations are not supported.')
3981. 
3982.         with connection.schema_editor() as editor:
3983.             editor.create_model(Author)
3984. 
3985.         old_field = Author._meta.get_field('name')
3986.         new_field = CharField(max_length=255, db_collation=collation)
3987.         new_field.set_attributes_from_name('name')
3988.         new_field.model = Author
3989.         with connection.schema_editor() as editor:
3990.             editor.alter_field(Author, old_field, new_field, strict=True)
3991.         self.assertEqual(
3992.             self.get_column_collation(Author._meta.db_table, 'name'),
3993.             collation,
3994.         )
3995.         with connection.schema_editor() as editor:
3996.             editor.alter_field(Author, new_field, old_field, strict=True)
3997.         self.assertIsNone(self.get_column_collation(Author._meta.db_table, 'name'))
3998. 
3999.     @skipUnlessDBFeature('supports_collation_on_charfield')
4000.     def test_alter_field_type_and_db_collation(self):
4001.         collation = connection.features.test_collations.get('non_default')
4002.         if not collation:
4003.             self.skipTest('Language collations are not supported.')
4004. 
4005.         with connection.schema_editor() as editor:
4006.             editor.create_model(Note)
4007. 
4008.         old_field = Note._meta.get_field('info')
4009.         new_field = CharField(max_length=255, db_collation=collation)
4010.         new_field.set_attributes_from_name('info')
4011.         new_field.model = Note
4012.         with connection.schema_editor() as editor:
4013.             editor.alter_field(Note, old_field, new_field, strict=True)
4014.         columns = self.column_classes(Note)
4015.         self.assertEqual(
4016.             columns['info'][0],
4017.             connection.features.introspected_field_types['CharField'],
4018.         )
4019.         self.assertEqual(columns['info'][1][8], collation)
4020.         with connection.schema_editor() as editor:
4021.             editor.alter_field(Note, new_field, old_field, strict=True)
4022.         columns = self.column_classes(Note)
4023.         self.assertEqual(columns['info'][0], 'TextField')
4024.         self.assertIsNone(columns['info'][1][8])
4025. 
4026.     @skipUnlessDBFeature(
4027.         'supports_collation_on_charfield',
4028.         'supports_non_deterministic_collations',
4029.     )
4030.     def test_ci_cs_db_collation(self):
4031.         cs_collation = connection.features.test_collations.get('cs')
4032.         ci_collation = connection.features.test_collations.get('ci')
4033.         try:
4034.             if connection.vendor == 'mysql':
4035.                 cs_collation = 'latin1_general_cs'
4036.             elif connection.vendor == 'postgresql':
4037.                 cs_collation = 'en-x-icu'
4038.                 with connection.cursor() as cursor:
4039.                     cursor.execute(
4040.                         "CREATE COLLATION IF NOT EXISTS case_insensitive "
4041.                         "(provider = icu, locale = 'und-u-ks-level2', "
4042.                         "deterministic = false)"
4043.                     )
4044.                     ci_collation = 'case_insensitive'
4045.             # Create the table.
4046.             with connection.schema_editor() as editor:
4047.                 editor.create_model(Author)
4048.             # Case-insensitive collation.
4049.             old_field = Author._meta.get_field('name')
4050.             new_field_ci = CharField(max_length=255, db_collation=ci_collation)
4051.             new_field_ci.set_attributes_from_name('name')
4052.             new_field_ci.model = Author
4053.             with connection.schema_editor() as editor:
4054.                 editor.alter_field(Author, old_field, new_field_ci, strict=True)
4055.             Author.objects.create(name='ANDREW')
4056.             self.assertIs(Author.objects.filter(name='Andrew').exists(), True)
4057.             # Case-sensitive collation.
4058.             new_field_cs = CharField(max_length=255, db_collation=cs_collation)
4059.             new_field_cs.set_attributes_from_name('name')
4060.             new_field_cs.model = Author
4061.             with connection.schema_editor() as editor:
4062.                 editor.alter_field(Author, new_field_ci, new_field_cs, strict=True)
4063.             self.assertIs(Author.objects.filter(name='Andrew').exists(), False)
4064.         finally:
4065.             if connection.vendor == 'postgresql':
4066.                 with connection.cursor() as cursor:
4067.                     cursor.execute('DROP COLLATION IF EXISTS case_insensitive')

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 18:44:29,705 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of the file `tests/schema/tests.py`.\n   - The file is provided in its entirety to fulfill this primary request.\n2. Extended relevance:\n   - The user's purpose is to find test cases related to the creation of unique constraints. This file contains numerous tests for schema alterations, including those for unique constraints, indexes, and model creation, which are all relevant to the user's goal.", relative_path='tests/schema/tests.py', start_line=1, end_line=4067)]
2025-12-21 18:44:29,710 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/schema/tests.py`.
2025-12-21 18:44:29,710 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 18:44:29,710 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 18:44:29,711 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 18:44:29,711 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 18:44:29,712 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── explicit_default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── explicit_default_config_empty_apps
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── explicit_default_config_mismatch_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── not_apps.py
    |   ├── explicit_default_config_without_apps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_autoreloader.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Statement created by _create_unique_sql makes references_column always false

Description: Description
	
This is due to an instance of Table is passed as an argument to Columns when a string is expected.

Patch information:
diff --git a/django/db/backends/base/schema.py b/django/db/backends/base/schema.py
index ad2f5a7da1..4c018624fb 100644
--- a/django/db/backends/base/schema.py
+++ b/django/db/backends/base/schema.py
@@ -1251,7 +1251,7 @@ class BaseDatabaseSchemaEditor:
         else:
             sql = self.sql_create_unique
         if columns:
-            columns = self._index_columns(table, columns, col_suffixes=(), opclasses=opclasses)
+            columns = self._index_columns(model._meta.db_table, columns, col_suffixes=(), opclasses=opclasses)
         else:
             columns = Expressions(model._meta.db_table, expressions, compiler, self.quote_value)
         return Statement(


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/schema/tests.py`.
Extra Requirements: If the file is too large, please provide all tests related to unique constraints, indexes, or the `create_model` method.
Purpose: This file is needed to find test cases that exercise the creation of unique constraints, which is where the reported bug occurs.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/schema/tests.py
Line number range: 1 - 4067
Content:
1. import datetime
2. import itertools
3. import unittest
4. from copy import copy
5. from unittest import mock
6. 
7. from django.core.exceptions import FieldError
8. from django.core.management.color import no_style
9. from django.db import (
10.     DatabaseError, DataError, IntegrityError, OperationalError, connection,
11. )
12. from django.db.models import (
13.     CASCADE, PROTECT, AutoField, BigAutoField, BigIntegerField, BinaryField,
14.     BooleanField, CharField, CheckConstraint, DateField, DateTimeField,
15.     DecimalField, F, FloatField, ForeignKey, ForeignObject, Index,
16.     IntegerField, JSONField, ManyToManyField, Model, OneToOneField, OrderBy,
17.     PositiveIntegerField, Q, SlugField, SmallAutoField, SmallIntegerField,
18.     TextField, TimeField, UniqueConstraint, UUIDField, Value,
19. )
20. from django.db.models.fields.json import KeyTextTransform
21. from django.db.models.functions import Abs, Cast, Collate, Lower, Random, Upper
22. from django.db.models.indexes import IndexExpression
23. from django.db.transaction import TransactionManagementError, atomic
24. from django.test import (
25.     TransactionTestCase, skipIfDBFeature, skipUnlessDBFeature,
26. )
27. from django.test.utils import (
28.     CaptureQueriesContext, isolate_apps, register_lookup,
29. )
30. from django.utils import timezone
31. 
32. from .fields import (
33.     CustomManyToManyField, InheritedManyToManyField, MediumBlobField,
34. )
35. from .models import (
36.     Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
37.     AuthorWithDefaultHeight, AuthorWithEvenLongerName, AuthorWithIndexedName,
38.     AuthorWithIndexedNameAndBirthday, AuthorWithUniqueName,
39.     AuthorWithUniqueNameAndBirthday, Book, BookForeignObj, BookWeak,
40.     BookWithLongName, BookWithO2O, BookWithoutAuthor, BookWithSlug, IntegerPK,
41.     Node, Note, NoteRename, Tag, TagIndexed, TagM2MTest, TagUniqueRename,
42.     Thing, UniqueTest, new_apps,
43. )
44. 
45. 
46. class SchemaTests(TransactionTestCase):
47.     """
48.     Tests for the schema-alteration code.
49. 
50.     Be aware that these tests are more liable than most to false results,
51.     as sometimes the code to check if a test has worked is almost as complex
52.     as the code it is testing.
53.     """
54. 
55.     available_apps = []
56. 
57.     models = [
58.         Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
59.         AuthorWithDefaultHeight, AuthorWithEvenLongerName, Book, BookWeak,
60.         BookWithLongName, BookWithO2O, BookWithSlug, IntegerPK, Node, Note,
61.         Tag, TagIndexed, TagM2MTest, TagUniqueRename, Thing, UniqueTest,
62.     ]
63. 
64.     # Utility functions
65. 
66.     def setUp(self):
67.         # local_models should contain test dependent model classes that will be
68.         # automatically removed from the app cache on test tear down.
69.         self.local_models = []
70.         # isolated_local_models contains models that are in test methods
71.         # decorated with @isolate_apps.
72.         self.isolated_local_models = []
73. 
74.     def tearDown(self):
75.         # Delete any tables made for our models
76.         self.delete_tables()
77.         new_apps.clear_cache()
78.         for model in new_apps.get_models():
79.             model._meta._expire_cache()
80.         if 'schema' in new_apps.all_models:
81.             for model in self.local_models:
82.                 for many_to_many in model._meta.many_to_many:
83.                     through = many_to_many.remote_field.through
84.                     if through and through._meta.auto_created:
85.                         del new_apps.all_models['schema'][through._meta.model_name]
86.                 del new_apps.all_models['schema'][model._meta.model_name]
87.         if self.isolated_local_models:
88.             with connection.schema_editor() as editor:
89.                 for model in self.isolated_local_models:
90.                     editor.delete_model(model)
91. 
92.     def delete_tables(self):
93.         "Deletes all model tables for our models for a clean test environment"
94.         converter = connection.introspection.identifier_converter
95.         with connection.schema_editor() as editor:
96.             connection.disable_constraint_checking()
97.             table_names = connection.introspection.table_names()
98.             if connection.features.ignores_table_name_case:
99.                 table_names = [table_name.lower() for table_name in table_names]
100.             for model in itertools.chain(SchemaTests.models, self.local_models):
101.                 tbl = converter(model._meta.db_table)
102.                 if connection.features.ignores_table_name_case:
103.                     tbl = tbl.lower()
104.                 if tbl in table_names:
105.                     editor.delete_model(model)
106.                     table_names.remove(tbl)
107.             connection.enable_constraint_checking()
108. 
109.     def column_classes(self, model):
110.         with connection.cursor() as cursor:
111.             columns = {
112.                 d[0]: (connection.introspection.get_field_type(d[1], d), d)
113.                 for d in connection.introspection.get_table_description(
114.                     cursor,
115.                     model._meta.db_table,
116.                 )
117.             }
118.         # SQLite has a different format for field_type
119.         for name, (type, desc) in columns.items():
120.             if isinstance(type, tuple):
121.                 columns[name] = (type[0], desc)
122.         # SQLite also doesn't error properly
123.         if not columns:
124.             raise DatabaseError("Table does not exist (empty pragma)")
125.         return columns
126. 
127.     def get_primary_key(self, table):
128.         with connection.cursor() as cursor:
129.             return connection.introspection.get_primary_key_column(cursor, table)
130. 
131.     def get_indexes(self, table):
132.         """
133.         Get the indexes on the table using a new cursor.
134.         """
135.         with connection.cursor() as cursor:
136.             return [
137.                 c['columns'][0]
138.                 for c in connection.introspection.get_constraints(cursor, table).values()
139.                 if c['index'] and len(c['columns']) == 1
140.             ]
141. 
142.     def get_uniques(self, table):
143.         with connection.cursor() as cursor:
144.             return [
145.                 c['columns'][0]
146.                 for c in connection.introspection.get_constraints(cursor, table).values()
147.                 if c['unique'] and len(c['columns']) == 1
148.             ]
149. 
150.     def get_constraints(self, table):
151.         """
152.         Get the constraints on a table using a new cursor.
153.         """
154.         with connection.cursor() as cursor:
155.             return connection.introspection.get_constraints(cursor, table)
156. 
157.     def get_constraints_for_column(self, model, column_name):
158.         constraints = self.get_constraints(model._meta.db_table)
159.         constraints_for_column = []
160.         for name, details in constraints.items():
161.             if details['columns'] == [column_name]:
162.                 constraints_for_column.append(name)
163.         return sorted(constraints_for_column)
164. 
165.     def check_added_field_default(self, schema_editor, model, field, field_name, expected_default,
166.                                   cast_function=None):
167.         with connection.cursor() as cursor:
168.             schema_editor.add_field(model, field)
169.             cursor.execute("SELECT {} FROM {};".format(field_name, model._meta.db_table))
170.             database_default = cursor.fetchall()[0][0]
171.             if cast_function and type(database_default) != type(expected_default):
172.                 database_default = cast_function(database_default)
173.             self.assertEqual(database_default, expected_default)
174. 
175.     def get_constraints_count(self, table, column, fk_to):
176.         """
177.         Return a dict with keys 'fks', 'uniques, and 'indexes' indicating the
178.         number of foreign keys, unique constraints, and indexes on
179.         `table`.`column`. The `fk_to` argument is a 2-tuple specifying the
180.         expected foreign key relationship's (table, column).
181.         """
182.         with connection.cursor() as cursor:
183.             constraints = connection.introspection.get_constraints(cursor, table)
184.         counts = {'fks': 0, 'uniques': 0, 'indexes': 0}
185.         for c in constraints.values():
186.             if c['columns'] == [column]:
187.                 if c['foreign_key'] == fk_to:
188.                     counts['fks'] += 1
189.                 if c['unique']:
190.                     counts['uniques'] += 1
191.                 elif c['index']:
192.                     counts['indexes'] += 1
193.         return counts
194. 
195.     def get_column_collation(self, table, column):
196.         with connection.cursor() as cursor:
197.             return next(
198.                 f.collation
199.                 for f in connection.introspection.get_table_description(cursor, table)
200.                 if f.name == column
201.             )
202. 
203.     def assertIndexOrder(self, table, index, order):
204.         constraints = self.get_constraints(table)
205.         self.assertIn(index, constraints)
206.         index_orders = constraints[index]['orders']
207.         self.assertTrue(all(val == expected for val, expected in zip(index_orders, order)))
208. 
209.     def assertForeignKeyExists(self, model, column, expected_fk_table, field='id'):
210.         """
211.         Fail if the FK constraint on `model.Meta.db_table`.`column` to
212.         `expected_fk_table`.id doesn't exist.
213.         """
214.         constraints = self.get_constraints(model._meta.db_table)
215.         constraint_fk = None
216.         for details in constraints.values():
217.             if details['columns'] == [column] and details['foreign_key']:
218.                 constraint_fk = details['foreign_key']
219.                 break
220.         self.assertEqual(constraint_fk, (expected_fk_table, field))
221. 
222.     def assertForeignKeyNotExists(self, model, column, expected_fk_table):
223.         with self.assertRaises(AssertionError):
224.             self.assertForeignKeyExists(model, column, expected_fk_table)
225. 
226.     # Tests
227.     def test_creation_deletion(self):
228.         """
229.         Tries creating a model's table, and then deleting it.
230.         """
231.         with connection.schema_editor() as editor:
232.             # Create the table
233.             editor.create_model(Author)
234.             # The table is there
235.             list(Author.objects.all())
236.             # Clean up that table
237.             editor.delete_model(Author)
238.             # No deferred SQL should be left over.
239.             self.assertEqual(editor.deferred_sql, [])
240.         # The table is gone
241.         with self.assertRaises(DatabaseError):
242.             list(Author.objects.all())
243. 
244.     @skipUnlessDBFeature('supports_foreign_keys')
245.     def test_fk(self):
246.         "Creating tables out of FK order, then repointing, works"
247.         # Create the table
248.         with connection.schema_editor() as editor:
249.             editor.create_model(Book)
250.             editor.create_model(Author)
251.             editor.create_model(Tag)
252.         # Initial tables are there
253.         list(Author.objects.all())
254.         list(Book.objects.all())
255.         # Make sure the FK constraint is present
256.         with self.assertRaises(IntegrityError):
257.             Book.objects.create(
258.                 author_id=1,
259.                 title="Much Ado About Foreign Keys",
260.                 pub_date=datetime.datetime.now(),
261.             )
262.         # Repoint the FK constraint
263.         old_field = Book._meta.get_field("author")
264.         new_field = ForeignKey(Tag, CASCADE)
265.         new_field.set_attributes_from_name("author")
266.         with connection.schema_editor() as editor:
267.             editor.alter_field(Book, old_field, new_field, strict=True)
268.         self.assertForeignKeyExists(Book, 'author_id', 'schema_tag')
269. 
270.     @skipUnlessDBFeature('can_create_inline_fk')
271.     def test_inline_fk(self):
272.         # Create some tables.
273.         with connection.schema_editor() as editor:
274.             editor.create_model(Author)
275.             editor.create_model(Book)
276.             editor.create_model(Note)
277.         self.assertForeignKeyNotExists(Note, 'book_id', 'schema_book')
278.         # Add a foreign key from one to the other.
279.         with connection.schema_editor() as editor:
280.             new_field = ForeignKey(Book, CASCADE)
281.             new_field.set_attributes_from_name('book')
282.             editor.add_field(Note, new_field)
283.         self.assertForeignKeyExists(Note, 'book_id', 'schema_book')
284.         # Creating a FK field with a constraint uses a single statement without
285.         # a deferred ALTER TABLE.
286.         self.assertFalse([
287.             sql for sql in (str(statement) for statement in editor.deferred_sql)
288.             if sql.startswith('ALTER TABLE') and 'ADD CONSTRAINT' in sql
289.         ])
290. 
291.     @skipUnlessDBFeature('can_create_inline_fk')
292.     def test_add_inline_fk_update_data(self):
293.         with connection.schema_editor() as editor:
294.             editor.create_model(Node)
295.         # Add an inline foreign key and update data in the same transaction.
296.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
297.         new_field.set_attributes_from_name('new_parent_fk')
298.         parent = Node.objects.create()
299.         with connection.schema_editor() as editor:
300.             editor.add_field(Node, new_field)
301.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
302.         assertIndex = (
303.             self.assertIn
304.             if connection.features.indexes_foreign_keys
305.             else self.assertNotIn
306.         )
307.         assertIndex('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
308. 
309.     @skipUnlessDBFeature(
310.         'can_create_inline_fk',
311.         'allows_multiple_constraints_on_same_fields',
312.     )
313.     @isolate_apps('schema')
314.     def test_add_inline_fk_index_update_data(self):
315.         class Node(Model):
316.             class Meta:
317.                 app_label = 'schema'
318. 
319.         with connection.schema_editor() as editor:
320.             editor.create_model(Node)
321.         # Add an inline foreign key, update data, and an index in the same
322.         # transaction.
323.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
324.         new_field.set_attributes_from_name('new_parent_fk')
325.         parent = Node.objects.create()
326.         with connection.schema_editor() as editor:
327.             editor.add_field(Node, new_field)
328.             Node._meta.add_field(new_field)
329.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
330.             editor.add_index(Node, Index(fields=['new_parent_fk'], name='new_parent_inline_fk_idx'))
331.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
332. 
333.     @skipUnlessDBFeature('supports_foreign_keys')
334.     def test_char_field_with_db_index_to_fk(self):
335.         # Create the table
336.         with connection.schema_editor() as editor:
337.             editor.create_model(Author)
338.             editor.create_model(AuthorCharFieldWithIndex)
339.         # Change CharField to FK
340.         old_field = AuthorCharFieldWithIndex._meta.get_field('char_field')
341.         new_field = ForeignKey(Author, CASCADE, blank=True)
342.         new_field.set_attributes_from_name('char_field')
343.         with connection.schema_editor() as editor:
344.             editor.alter_field(AuthorCharFieldWithIndex, old_field, new_field, strict=True)
345.         self.assertForeignKeyExists(AuthorCharFieldWithIndex, 'char_field_id', 'schema_author')
346. 
347.     @skipUnlessDBFeature('supports_foreign_keys')
348.     @skipUnlessDBFeature('supports_index_on_text_field')
349.     def test_text_field_with_db_index_to_fk(self):
350.         # Create the table
351.         with connection.schema_editor() as editor:
352.             editor.create_model(Author)
353.             editor.create_model(AuthorTextFieldWithIndex)
354.         # Change TextField to FK
355.         old_field = AuthorTextFieldWithIndex._meta.get_field('text_field')
356.         new_field = ForeignKey(Author, CASCADE, blank=True)
357.         new_field.set_attributes_from_name('text_field')
358.         with connection.schema_editor() as editor:
359.             editor.alter_field(AuthorTextFieldWithIndex, old_field, new_field, strict=True)
360.         self.assertForeignKeyExists(AuthorTextFieldWithIndex, 'text_field_id', 'schema_author')
361. 
362.     @isolate_apps('schema')
363.     def test_char_field_pk_to_auto_field(self):
364.         class Foo(Model):
365.             id = CharField(max_length=255, primary_key=True)
366. 
367.             class Meta:
368.                 app_label = 'schema'
369. 
370.         with connection.schema_editor() as editor:
371.             editor.create_model(Foo)
372.         self.isolated_local_models = [Foo]
373.         old_field = Foo._meta.get_field('id')
374.         new_field = AutoField(primary_key=True)
375.         new_field.set_attributes_from_name('id')
376.         new_field.model = Foo
377.         with connection.schema_editor() as editor:
378.             editor.alter_field(Foo, old_field, new_field, strict=True)
379. 
380.     @skipUnlessDBFeature('supports_foreign_keys')
381.     def test_fk_to_proxy(self):
382.         "Creating a FK to a proxy model creates database constraints."
383.         class AuthorProxy(Author):
384.             class Meta:
385.                 app_label = 'schema'
386.                 apps = new_apps
387.                 proxy = True
388. 
389.         class AuthorRef(Model):
390.             author = ForeignKey(AuthorProxy, on_delete=CASCADE)
391. 
392.             class Meta:
393.                 app_label = 'schema'
394.                 apps = new_apps
395. 
396.         self.local_models = [AuthorProxy, AuthorRef]
397. 
398.         # Create the table
399.         with connection.schema_editor() as editor:
400.             editor.create_model(Author)
401.             editor.create_model(AuthorRef)
402.         self.assertForeignKeyExists(AuthorRef, 'author_id', 'schema_author')
403. 
404.     @skipUnlessDBFeature('supports_foreign_keys')
405.     def test_fk_db_constraint(self):
406.         "The db_constraint parameter is respected"
407.         # Create the table
408.         with connection.schema_editor() as editor:
409.             editor.create_model(Tag)
410.             editor.create_model(Author)
411.             editor.create_model(BookWeak)
412.         # Initial tables are there
413.         list(Author.objects.all())
414.         list(Tag.objects.all())
415.         list(BookWeak.objects.all())
416.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
417.         # Make a db_constraint=False FK
418.         new_field = ForeignKey(Tag, CASCADE, db_constraint=False)
419.         new_field.set_attributes_from_name("tag")
420.         with connection.schema_editor() as editor:
421.             editor.add_field(Author, new_field)
422.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
423.         # Alter to one with a constraint
424.         new_field2 = ForeignKey(Tag, CASCADE)
425.         new_field2.set_attributes_from_name("tag")
426.         with connection.schema_editor() as editor:
427.             editor.alter_field(Author, new_field, new_field2, strict=True)
428.         self.assertForeignKeyExists(Author, 'tag_id', 'schema_tag')
429.         # Alter to one without a constraint again
430.         new_field2 = ForeignKey(Tag, CASCADE)
431.         new_field2.set_attributes_from_name("tag")
432.         with connection.schema_editor() as editor:
433.             editor.alter_field(Author, new_field2, new_field, strict=True)
434.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
435. 
436.     @isolate_apps('schema')
437.     def test_no_db_constraint_added_during_primary_key_change(self):
438.         """
439.         When a primary key that's pointed to by a ForeignKey with
440.         db_constraint=False is altered, a foreign key constraint isn't added.
441.         """
442.         class Author(Model):
443.             class Meta:
444.                 app_label = 'schema'
445. 
446.         class BookWeak(Model):
447.             author = ForeignKey(Author, CASCADE, db_constraint=False)
448. 
449.             class Meta:
450.                 app_label = 'schema'
451. 
452.         with connection.schema_editor() as editor:
453.             editor.create_model(Author)
454.             editor.create_model(BookWeak)
455.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
456.         old_field = Author._meta.get_field('id')
457.         new_field = BigAutoField(primary_key=True)
458.         new_field.model = Author
459.         new_field.set_attributes_from_name('id')
460.         # @isolate_apps() and inner models are needed to have the model
461.         # relations populated, otherwise this doesn't act as a regression test.
462.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
463.         with connection.schema_editor() as editor:
464.             editor.alter_field(Author, old_field, new_field, strict=True)
465.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
466. 
467.     def _test_m2m_db_constraint(self, M2MFieldClass):
468.         class LocalAuthorWithM2M(Model):
469.             name = CharField(max_length=255)
470. 
471.             class Meta:
472.                 app_label = 'schema'
473.                 apps = new_apps
474. 
475.         self.local_models = [LocalAuthorWithM2M]
476. 
477.         # Create the table
478.         with connection.schema_editor() as editor:
479.             editor.create_model(Tag)
480.             editor.create_model(LocalAuthorWithM2M)
481.         # Initial tables are there
482.         list(LocalAuthorWithM2M.objects.all())
483.         list(Tag.objects.all())
484.         # Make a db_constraint=False FK
485.         new_field = M2MFieldClass(Tag, related_name="authors", db_constraint=False)
486.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
487.         # Add the field
488.         with connection.schema_editor() as editor:
489.             editor.add_field(LocalAuthorWithM2M, new_field)
490.         self.assertForeignKeyNotExists(new_field.remote_field.through, 'tag_id', 'schema_tag')
491. 
492.     @skipUnlessDBFeature('supports_foreign_keys')
493.     def test_m2m_db_constraint(self):
494.         self._test_m2m_db_constraint(ManyToManyField)
495. 
496.     @skipUnlessDBFeature('supports_foreign_keys')
497.     def test_m2m_db_constraint_custom(self):
498.         self._test_m2m_db_constraint(CustomManyToManyField)
499. 
500.     @skipUnlessDBFeature('supports_foreign_keys')
501.     def test_m2m_db_constraint_inherited(self):
502.         self._test_m2m_db_constraint(InheritedManyToManyField)
503. 
504.     def test_add_field(self):
505.         """
506.         Tests adding fields to models
507.         """
508.         # Create the table
509.         with connection.schema_editor() as editor:
510.             editor.create_model(Author)
511.         # Ensure there's no age field
512.         columns = self.column_classes(Author)
513.         self.assertNotIn("age", columns)
514.         # Add the new field
515.         new_field = IntegerField(null=True)
516.         new_field.set_attributes_from_name("age")
517.         with CaptureQueriesContext(connection) as ctx, connection.schema_editor() as editor:
518.             editor.add_field(Author, new_field)
519.         drop_default_sql = editor.sql_alter_column_no_default % {
520.             'column': editor.quote_name(new_field.name),
521.         }
522.         self.assertFalse(any(drop_default_sql in query['sql'] for query in ctx.captured_queries))
523.         # Ensure the field is right afterwards
524.         columns = self.column_classes(Author)
525.         self.assertEqual(columns['age'][0], connection.features.introspected_field_types['IntegerField'])
526.         self.assertTrue(columns['age'][1][6])
527. 
528.     def test_add_field_remove_field(self):
529.         """
530.         Adding a field and removing it removes all deferred sql referring to it.
531.         """
532.         with connection.schema_editor() as editor:
533.             # Create a table with a unique constraint on the slug field.
534.             editor.create_model(Tag)
535.             # Remove the slug column.
536.             editor.remove_field(Tag, Tag._meta.get_field('slug'))
537.         self.assertEqual(editor.deferred_sql, [])
538. 
539.     def test_add_field_temp_default(self):
540.         """
541.         Tests adding fields to models with a temporary default
542.         """
543.         # Create the table
544.         with connection.schema_editor() as editor:
545.             editor.create_model(Author)
546.         # Ensure there's no age field
547.         columns = self.column_classes(Author)
548.         self.assertNotIn("age", columns)
549.         # Add some rows of data
550.         Author.objects.create(name="Andrew", height=30)
551.         Author.objects.create(name="Andrea")
552.         # Add a not-null field
553.         new_field = CharField(max_length=30, default="Godwin")
554.         new_field.set_attributes_from_name("surname")
555.         with connection.schema_editor() as editor:
556.             editor.add_field(Author, new_field)
557.         # Ensure the field is right afterwards
558.         columns = self.column_classes(Author)
559.         self.assertEqual(columns['surname'][0], connection.features.introspected_field_types['CharField'])
560.         self.assertEqual(columns['surname'][1][6],
561.                          connection.features.interprets_empty_strings_as_nulls)
562. 
563.     def test_add_field_temp_default_boolean(self):
564.         """
565.         Tests adding fields to models with a temporary default where
566.         the default is False. (#21783)
567.         """
568.         # Create the table
569.         with connection.schema_editor() as editor:
570.             editor.create_model(Author)
571.         # Ensure there's no age field
572.         columns = self.column_classes(Author)
573.         self.assertNotIn("age", columns)
574.         # Add some rows of data
575.         Author.objects.create(name="Andrew", height=30)
576.         Author.objects.create(name="Andrea")
577.         # Add a not-null field
578.         new_field = BooleanField(default=False)
579.         new_field.set_attributes_from_name("awesome")
580.         with connection.schema_editor() as editor:
581.             editor.add_field(Author, new_field)
582.         # Ensure the field is right afterwards
583.         columns = self.column_classes(Author)
584.         # BooleanField are stored as TINYINT(1) on MySQL.
585.         field_type = columns['awesome'][0]
586.         self.assertEqual(field_type, connection.features.introspected_field_types['BooleanField'])
587. 
588.     def test_add_field_default_transform(self):
589.         """
590.         Tests adding fields to models with a default that is not directly
591.         valid in the database (#22581)
592.         """
593. 
594.         class TestTransformField(IntegerField):
595. 
596.             # Weird field that saves the count of items in its value
597.             def get_default(self):
598.                 return self.default
599. 
600.             def get_prep_value(self, value):
601.                 if value is None:
602.                     return 0
603.                 return len(value)
604. 
605.         # Create the table
606.         with connection.schema_editor() as editor:
607.             editor.create_model(Author)
608.         # Add some rows of data
609.         Author.objects.create(name="Andrew", height=30)
610.         Author.objects.create(name="Andrea")
611.         # Add the field with a default it needs to cast (to string in this case)
612.         new_field = TestTransformField(default={1: 2})
613.         new_field.set_attributes_from_name("thing")
614.         with connection.schema_editor() as editor:
615.             editor.add_field(Author, new_field)
616.         # Ensure the field is there
617.         columns = self.column_classes(Author)
618.         field_type, field_info = columns['thing']
619.         self.assertEqual(field_type, connection.features.introspected_field_types['IntegerField'])
620.         # Make sure the values were transformed correctly
621.         self.assertEqual(Author.objects.extra(where=["thing = 1"]).count(), 2)
622. 
623.     def test_add_field_binary(self):
624.         """
625.         Tests binary fields get a sane default (#22851)
626.         """
627.         # Create the table
628.         with connection.schema_editor() as editor:
629.             editor.create_model(Author)
630.         # Add the new field
631.         new_field = BinaryField(blank=True)
632.         new_field.set_attributes_from_name("bits")
633.         with connection.schema_editor() as editor:
634.             editor.add_field(Author, new_field)
635.         # Ensure the field is right afterwards
636.         columns = self.column_classes(Author)
637.         # MySQL annoyingly uses the same backend, so it'll come back as one of
638.         # these two types.
639.         self.assertIn(columns['bits'][0], ("BinaryField", "TextField"))
640. 
641.     @unittest.skipUnless(connection.vendor == 'mysql', "MySQL specific")
642.     def test_add_binaryfield_mediumblob(self):
643.         """
644.         Test adding a custom-sized binary field on MySQL (#24846).
645.         """
646.         # Create the table
647.         with connection.schema_editor() as editor:
648.             editor.create_model(Author)
649.         # Add the new field with default
650.         new_field = MediumBlobField(blank=True, default=b'123')
651.         new_field.set_attributes_from_name('bits')
652.         with connection.schema_editor() as editor:
653.             editor.add_field(Author, new_field)
654.         columns = self.column_classes(Author)
655.         # Introspection treats BLOBs as TextFields
656.         self.assertEqual(columns['bits'][0], "TextField")
657. 
658.     def test_alter(self):
659.         """
660.         Tests simple altering of fields
661.         """
662.         # Create the table
663.         with connection.schema_editor() as editor:
664.             editor.create_model(Author)
665.         # Ensure the field is right to begin with
666.         columns = self.column_classes(Author)
667.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
668.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
669.         # Alter the name field to a TextField
670.         old_field = Author._meta.get_field("name")
671.         new_field = TextField(null=True)
672.         new_field.set_attributes_from_name("name")
673.         with connection.schema_editor() as editor:
674.             editor.alter_field(Author, old_field, new_field, strict=True)
675.         # Ensure the field is right afterwards
676.         columns = self.column_classes(Author)
677.         self.assertEqual(columns['name'][0], "TextField")
678.         self.assertTrue(columns['name'][1][6])
679.         # Change nullability again
680.         new_field2 = TextField(null=False)
681.         new_field2.set_attributes_from_name("name")
682.         with connection.schema_editor() as editor:
683.             editor.alter_field(Author, new_field, new_field2, strict=True)
684.         # Ensure the field is right afterwards
685.         columns = self.column_classes(Author)
686.         self.assertEqual(columns['name'][0], "TextField")
687.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
688. 
689.     def test_alter_auto_field_to_integer_field(self):
690.         # Create the table
691.         with connection.schema_editor() as editor:
692.             editor.create_model(Author)
693.         # Change AutoField to IntegerField
694.         old_field = Author._meta.get_field('id')
695.         new_field = IntegerField(primary_key=True)
696.         new_field.set_attributes_from_name('id')
697.         new_field.model = Author
698.         with connection.schema_editor() as editor:
699.             editor.alter_field(Author, old_field, new_field, strict=True)
700.         # Now that ID is an IntegerField, the database raises an error if it
701.         # isn't provided.
702.         if not connection.features.supports_unspecified_pk:
703.             with self.assertRaises(DatabaseError):
704.                 Author.objects.create()
705. 
706.     def test_alter_auto_field_to_char_field(self):
707.         # Create the table
708.         with connection.schema_editor() as editor:
709.             editor.create_model(Author)
710.         # Change AutoField to CharField
711.         old_field = Author._meta.get_field('id')
712.         new_field = CharField(primary_key=True, max_length=50)
713.         new_field.set_attributes_from_name('id')
714.         new_field.model = Author
715.         with connection.schema_editor() as editor:
716.             editor.alter_field(Author, old_field, new_field, strict=True)
717. 
718.     @isolate_apps('schema')
719.     def test_alter_auto_field_quoted_db_column(self):
720.         class Foo(Model):
721.             id = AutoField(primary_key=True, db_column='"quoted_id"')
722. 
723.             class Meta:
724.                 app_label = 'schema'
725. 
726.         with connection.schema_editor() as editor:
727.             editor.create_model(Foo)
728.         self.isolated_local_models = [Foo]
729.         old_field = Foo._meta.get_field('id')
730.         new_field = BigAutoField(primary_key=True)
731.         new_field.model = Foo
732.         new_field.db_column = '"quoted_id"'
733.         new_field.set_attributes_from_name('id')
734.         with connection.schema_editor() as editor:
735.             editor.alter_field(Foo, old_field, new_field, strict=True)
736.         Foo.objects.create()
737. 
738.     def test_alter_not_unique_field_to_primary_key(self):
739.         # Create the table.
740.         with connection.schema_editor() as editor:
741.             editor.create_model(Author)
742.         # Change UUIDField to primary key.
743.         old_field = Author._meta.get_field('uuid')
744.         new_field = UUIDField(primary_key=True)
745.         new_field.set_attributes_from_name('uuid')
746.         new_field.model = Author
747.         with connection.schema_editor() as editor:
748.             editor.remove_field(Author, Author._meta.get_field('id'))
749.             editor.alter_field(Author, old_field, new_field, strict=True)
750. 
751.     @isolate_apps('schema')
752.     def test_alter_primary_key_quoted_db_table(self):
753.         class Foo(Model):
754.             class Meta:
755.                 app_label = 'schema'
756.                 db_table = '"foo"'
757. 
758.         with connection.schema_editor() as editor:
759.             editor.create_model(Foo)
760.         self.isolated_local_models = [Foo]
761.         old_field = Foo._meta.get_field('id')
762.         new_field = BigAutoField(primary_key=True)
763.         new_field.model = Foo
764.         new_field.set_attributes_from_name('id')
765.         with connection.schema_editor() as editor:
766.             editor.alter_field(Foo, old_field, new_field, strict=True)
767.         Foo.objects.create()
768. 
769.     def test_alter_text_field(self):
770.         # Regression for "BLOB/TEXT column 'info' can't have a default value")
771.         # on MySQL.
772.         # Create the table
773.         with connection.schema_editor() as editor:
774.             editor.create_model(Note)
775.         old_field = Note._meta.get_field("info")
776.         new_field = TextField(blank=True)
777.         new_field.set_attributes_from_name("info")
778.         with connection.schema_editor() as editor:
779.             editor.alter_field(Note, old_field, new_field, strict=True)
780. 
781.     def test_alter_text_field_to_not_null_with_default_value(self):
782.         with connection.schema_editor() as editor:
783.             editor.create_model(Note)
784.         old_field = Note._meta.get_field('address')
785.         new_field = TextField(blank=True, default='', null=False)
786.         new_field.set_attributes_from_name('address')
787.         with connection.schema_editor() as editor:
788.             editor.alter_field(Note, old_field, new_field, strict=True)
789. 
790.     @skipUnlessDBFeature('can_defer_constraint_checks', 'can_rollback_ddl')
791.     def test_alter_fk_checks_deferred_constraints(self):
792.         """
793.         #25492 - Altering a foreign key's structure and data in the same
794.         transaction.
795.         """
796.         with connection.schema_editor() as editor:
797.             editor.create_model(Node)
798.         old_field = Node._meta.get_field('parent')
799.         new_field = ForeignKey(Node, CASCADE)
800.         new_field.set_attributes_from_name('parent')
801.         parent = Node.objects.create()
802.         with connection.schema_editor() as editor:
803.             # Update the parent FK to create a deferred constraint check.
804.             Node.objects.update(parent=parent)
805.             editor.alter_field(Node, old_field, new_field, strict=True)
806. 
807.     def test_alter_text_field_to_date_field(self):
808.         """
809.         #25002 - Test conversion of text field to date field.
810.         """
811.         with connection.schema_editor() as editor:
812.             editor.create_model(Note)
813.         Note.objects.create(info='1988-05-05')
814.         old_field = Note._meta.get_field('info')
815.         new_field = DateField(blank=True)
816.         new_field.set_attributes_from_name('info')
817.         with connection.schema_editor() as editor:
818.             editor.alter_field(Note, old_field, new_field, strict=True)
819.         # Make sure the field isn't nullable
820.         columns = self.column_classes(Note)
821.         self.assertFalse(columns['info'][1][6])
822. 
823.     def test_alter_text_field_to_datetime_field(self):
824.         """
825.         #25002 - Test conversion of text field to datetime field.
826.         """
827.         with connection.schema_editor() as editor:
828.             editor.create_model(Note)
829.         Note.objects.create(info='1988-05-05 3:16:17.4567')
830.         old_field = Note._meta.get_field('info')
831.         new_field = DateTimeField(blank=True)
832.         new_field.set_attributes_from_name('info')
833.         with connection.schema_editor() as editor:
834.             editor.alter_field(Note, old_field, new_field, strict=True)
835.         # Make sure the field isn't nullable
836.         columns = self.column_classes(Note)
837.         self.assertFalse(columns['info'][1][6])
838. 
839.     def test_alter_text_field_to_time_field(self):
840.         """
841.         #25002 - Test conversion of text field to time field.
842.         """
843.         with connection.schema_editor() as editor:
844.             editor.create_model(Note)
845.         Note.objects.create(info='3:16:17.4567')
846.         old_field = Note._meta.get_field('info')
847.         new_field = TimeField(blank=True)
848.         new_field.set_attributes_from_name('info')
849.         with connection.schema_editor() as editor:
850.             editor.alter_field(Note, old_field, new_field, strict=True)
851.         # Make sure the field isn't nullable
852.         columns = self.column_classes(Note)
853.         self.assertFalse(columns['info'][1][6])
854. 
855.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
856.     def test_alter_textual_field_keep_null_status(self):
857.         """
858.         Changing a field type shouldn't affect the not null status.
859.         """
860.         with connection.schema_editor() as editor:
861.             editor.create_model(Note)
862.         with self.assertRaises(IntegrityError):
863.             Note.objects.create(info=None)
864.         old_field = Note._meta.get_field("info")
865.         new_field = CharField(max_length=50)
866.         new_field.set_attributes_from_name("info")
867.         with connection.schema_editor() as editor:
868.             editor.alter_field(Note, old_field, new_field, strict=True)
869.         with self.assertRaises(IntegrityError):
870.             Note.objects.create(info=None)
871. 
872.     def test_alter_numeric_field_keep_null_status(self):
873.         """
874.         Changing a field type shouldn't affect the not null status.
875.         """
876.         with connection.schema_editor() as editor:
877.             editor.create_model(UniqueTest)
878.         with self.assertRaises(IntegrityError):
879.             UniqueTest.objects.create(year=None, slug='aaa')
880.         old_field = UniqueTest._meta.get_field("year")
881.         new_field = BigIntegerField()
882.         new_field.set_attributes_from_name("year")
883.         with connection.schema_editor() as editor:
884.             editor.alter_field(UniqueTest, old_field, new_field, strict=True)
885.         with self.assertRaises(IntegrityError):
886.             UniqueTest.objects.create(year=None, slug='bbb')
887. 
888.     def test_alter_null_to_not_null(self):
889.         """
890.         #23609 - Tests handling of default values when altering from NULL to NOT NULL.
891.         """
892.         # Create the table
893.         with connection.schema_editor() as editor:
894.             editor.create_model(Author)
895.         # Ensure the field is right to begin with
896.         columns = self.column_classes(Author)
897.         self.assertTrue(columns['height'][1][6])
898.         # Create some test data
899.         Author.objects.create(name='Not null author', height=12)
900.         Author.objects.create(name='Null author')
901.         # Verify null value
902.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
903.         self.assertIsNone(Author.objects.get(name='Null author').height)
904.         # Alter the height field to NOT NULL with default
905.         old_field = Author._meta.get_field("height")
906.         new_field = PositiveIntegerField(default=42)
907.         new_field.set_attributes_from_name("height")
908.         with connection.schema_editor() as editor:
909.             editor.alter_field(Author, old_field, new_field, strict=True)
910.         # Ensure the field is right afterwards
911.         columns = self.column_classes(Author)
912.         self.assertFalse(columns['height'][1][6])
913.         # Verify default value
914.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
915.         self.assertEqual(Author.objects.get(name='Null author').height, 42)
916. 
917.     def test_alter_charfield_to_null(self):
918.         """
919.         #24307 - Should skip an alter statement on databases with
920.         interprets_empty_strings_as_null when changing a CharField to null.
921.         """
922.         # Create the table
923.         with connection.schema_editor() as editor:
924.             editor.create_model(Author)
925.         # Change the CharField to null
926.         old_field = Author._meta.get_field('name')
927.         new_field = copy(old_field)
928.         new_field.null = True
929.         with connection.schema_editor() as editor:
930.             editor.alter_field(Author, old_field, new_field, strict=True)
931. 
932.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
933.     def test_alter_char_field_decrease_length(self):
934.         # Create the table.
935.         with connection.schema_editor() as editor:
936.             editor.create_model(Author)
937.         Author.objects.create(name='x' * 255)
938.         # Change max_length of CharField.
939.         old_field = Author._meta.get_field('name')
940.         new_field = CharField(max_length=254)
941.         new_field.set_attributes_from_name('name')
942.         with connection.schema_editor() as editor:
943.             msg = 'value too long for type character varying(254)'
944.             with self.assertRaisesMessage(DataError, msg):
945.                 editor.alter_field(Author, old_field, new_field, strict=True)
946. 
947.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
948.     def test_alter_field_with_custom_db_type(self):
949.         from django.contrib.postgres.fields import ArrayField
950. 
951.         class Foo(Model):
952.             field = ArrayField(CharField(max_length=255))
953. 
954.             class Meta:
955.                 app_label = 'schema'
956. 
957.         with connection.schema_editor() as editor:
958.             editor.create_model(Foo)
959.         self.isolated_local_models = [Foo]
960.         old_field = Foo._meta.get_field('field')
961.         new_field = ArrayField(CharField(max_length=16))
962.         new_field.set_attributes_from_name('field')
963.         new_field.model = Foo
964.         with connection.schema_editor() as editor:
965.             editor.alter_field(Foo, old_field, new_field, strict=True)
966. 
967.     @isolate_apps('schema')
968.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
969.     def test_alter_array_field_decrease_base_field_length(self):
970.         from django.contrib.postgres.fields import ArrayField
971. 
972.         class ArrayModel(Model):
973.             field = ArrayField(CharField(max_length=16))
974. 
975.             class Meta:
976.                 app_label = 'schema'
977. 
978.         with connection.schema_editor() as editor:
979.             editor.create_model(ArrayModel)
980.         self.isolated_local_models = [ArrayModel]
981.         ArrayModel.objects.create(field=['x' * 16])
982.         old_field = ArrayModel._meta.get_field('field')
983.         new_field = ArrayField(CharField(max_length=15))
984.         new_field.set_attributes_from_name('field')
985.         new_field.model = ArrayModel
986.         with connection.schema_editor() as editor:
987.             msg = 'value too long for type character varying(15)'
988.             with self.assertRaisesMessage(DataError, msg):
989.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
990. 
991.     @isolate_apps('schema')
992.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
993.     def test_alter_array_field_decrease_nested_base_field_length(self):
994.         from django.contrib.postgres.fields import ArrayField
995. 
996.         class ArrayModel(Model):
997.             field = ArrayField(ArrayField(CharField(max_length=16)))
998. 
999.             class Meta:
1000.                 app_label = 'schema'
1001. 
1002.         with connection.schema_editor() as editor:
1003.             editor.create_model(ArrayModel)
1004.         self.isolated_local_models = [ArrayModel]
1005.         ArrayModel.objects.create(field=[['x' * 16]])
1006.         old_field = ArrayModel._meta.get_field('field')
1007.         new_field = ArrayField(ArrayField(CharField(max_length=15)))
1008.         new_field.set_attributes_from_name('field')
1009.         new_field.model = ArrayModel
1010.         with connection.schema_editor() as editor:
1011.             msg = 'value too long for type character varying(15)'
1012.             with self.assertRaisesMessage(DataError, msg):
1013.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
1014. 
1015.     def test_alter_textfield_to_null(self):
1016.         """
1017.         #24307 - Should skip an alter statement on databases with
1018.         interprets_empty_strings_as_null when changing a TextField to null.
1019.         """
1020.         # Create the table
1021.         with connection.schema_editor() as editor:
1022.             editor.create_model(Note)
1023.         # Change the TextField to null
1024.         old_field = Note._meta.get_field('info')
1025.         new_field = copy(old_field)
1026.         new_field.null = True
1027.         with connection.schema_editor() as editor:
1028.             editor.alter_field(Note, old_field, new_field, strict=True)
1029. 
1030.     @skipUnlessDBFeature('supports_combined_alters')
1031.     def test_alter_null_to_not_null_keeping_default(self):
1032.         """
1033.         #23738 - Can change a nullable field with default to non-nullable
1034.         with the same default.
1035.         """
1036.         # Create the table
1037.         with connection.schema_editor() as editor:
1038.             editor.create_model(AuthorWithDefaultHeight)
1039.         # Ensure the field is right to begin with
1040.         columns = self.column_classes(AuthorWithDefaultHeight)
1041.         self.assertTrue(columns['height'][1][6])
1042.         # Alter the height field to NOT NULL keeping the previous default
1043.         old_field = AuthorWithDefaultHeight._meta.get_field("height")
1044.         new_field = PositiveIntegerField(default=42)
1045.         new_field.set_attributes_from_name("height")
1046.         with connection.schema_editor() as editor:
1047.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
1048.         # Ensure the field is right afterwards
1049.         columns = self.column_classes(AuthorWithDefaultHeight)
1050.         self.assertFalse(columns['height'][1][6])
1051. 
1052.     @skipUnlessDBFeature('supports_foreign_keys')
1053.     def test_alter_fk(self):
1054.         """
1055.         Tests altering of FKs
1056.         """
1057.         # Create the table
1058.         with connection.schema_editor() as editor:
1059.             editor.create_model(Author)
1060.             editor.create_model(Book)
1061.         # Ensure the field is right to begin with
1062.         columns = self.column_classes(Book)
1063.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1064.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1065.         # Alter the FK
1066.         old_field = Book._meta.get_field("author")
1067.         new_field = ForeignKey(Author, CASCADE, editable=False)
1068.         new_field.set_attributes_from_name("author")
1069.         with connection.schema_editor() as editor:
1070.             editor.alter_field(Book, old_field, new_field, strict=True)
1071.         # Ensure the field is right afterwards
1072.         columns = self.column_classes(Book)
1073.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1074.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1075. 
1076.     @skipUnlessDBFeature('supports_foreign_keys')
1077.     def test_alter_to_fk(self):
1078.         """
1079.         #24447 - Tests adding a FK constraint for an existing column
1080.         """
1081.         class LocalBook(Model):
1082.             author = IntegerField()
1083.             title = CharField(max_length=100, db_index=True)
1084.             pub_date = DateTimeField()
1085. 
1086.             class Meta:
1087.                 app_label = 'schema'
1088.                 apps = new_apps
1089. 
1090.         self.local_models = [LocalBook]
1091. 
1092.         # Create the tables
1093.         with connection.schema_editor() as editor:
1094.             editor.create_model(Author)
1095.             editor.create_model(LocalBook)
1096.         # Ensure no FK constraint exists
1097.         constraints = self.get_constraints(LocalBook._meta.db_table)
1098.         for details in constraints.values():
1099.             if details['foreign_key']:
1100.                 self.fail('Found an unexpected FK constraint to %s' % details['columns'])
1101.         old_field = LocalBook._meta.get_field("author")
1102.         new_field = ForeignKey(Author, CASCADE)
1103.         new_field.set_attributes_from_name("author")
1104.         with connection.schema_editor() as editor:
1105.             editor.alter_field(LocalBook, old_field, new_field, strict=True)
1106.         self.assertForeignKeyExists(LocalBook, 'author_id', 'schema_author')
1107. 
1108.     @skipUnlessDBFeature('supports_foreign_keys')
1109.     def test_alter_o2o_to_fk(self):
1110.         """
1111.         #24163 - Tests altering of OneToOneField to ForeignKey
1112.         """
1113.         # Create the table
1114.         with connection.schema_editor() as editor:
1115.             editor.create_model(Author)
1116.             editor.create_model(BookWithO2O)
1117.         # Ensure the field is right to begin with
1118.         columns = self.column_classes(BookWithO2O)
1119.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1120.         # Ensure the field is unique
1121.         author = Author.objects.create(name="Joe")
1122.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1123.         with self.assertRaises(IntegrityError):
1124.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1125.         BookWithO2O.objects.all().delete()
1126.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1127.         # Alter the OneToOneField to ForeignKey
1128.         old_field = BookWithO2O._meta.get_field("author")
1129.         new_field = ForeignKey(Author, CASCADE)
1130.         new_field.set_attributes_from_name("author")
1131.         with connection.schema_editor() as editor:
1132.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1133.         # Ensure the field is right afterwards
1134.         columns = self.column_classes(Book)
1135.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1136.         # Ensure the field is not unique anymore
1137.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1138.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1139.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1140. 
1141.     @skipUnlessDBFeature('supports_foreign_keys')
1142.     def test_alter_fk_to_o2o(self):
1143.         """
1144.         #24163 - Tests altering of ForeignKey to OneToOneField
1145.         """
1146.         # Create the table
1147.         with connection.schema_editor() as editor:
1148.             editor.create_model(Author)
1149.             editor.create_model(Book)
1150.         # Ensure the field is right to begin with
1151.         columns = self.column_classes(Book)
1152.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1153.         # Ensure the field is not unique
1154.         author = Author.objects.create(name="Joe")
1155.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1156.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1157.         Book.objects.all().delete()
1158.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1159.         # Alter the ForeignKey to OneToOneField
1160.         old_field = Book._meta.get_field("author")
1161.         new_field = OneToOneField(Author, CASCADE)
1162.         new_field.set_attributes_from_name("author")
1163.         with connection.schema_editor() as editor:
1164.             editor.alter_field(Book, old_field, new_field, strict=True)
1165.         # Ensure the field is right afterwards
1166.         columns = self.column_classes(BookWithO2O)
1167.         self.assertEqual(columns['author_id'][0], connection.features.introspected_field_types['IntegerField'])
1168.         # Ensure the field is unique now
1169.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1170.         with self.assertRaises(IntegrityError):
1171.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1172.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1173. 
1174.     def test_alter_field_fk_to_o2o(self):
1175.         with connection.schema_editor() as editor:
1176.             editor.create_model(Author)
1177.             editor.create_model(Book)
1178.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1179.         expected_indexes = 1 if connection.features.indexes_foreign_keys else 0
1180. 
1181.         # Check the index is right to begin with.
1182.         counts = self.get_constraints_count(
1183.             Book._meta.db_table,
1184.             Book._meta.get_field('author').column,
1185.             (Author._meta.db_table, Author._meta.pk.column),
1186.         )
1187.         self.assertEqual(
1188.             counts,
1189.             {'fks': expected_fks, 'uniques': 0, 'indexes': expected_indexes},
1190.         )
1191. 
1192.         old_field = Book._meta.get_field('author')
1193.         new_field = OneToOneField(Author, CASCADE)
1194.         new_field.set_attributes_from_name('author')
1195.         with connection.schema_editor() as editor:
1196.             editor.alter_field(Book, old_field, new_field, strict=True)
1197. 
1198.         counts = self.get_constraints_count(
1199.             Book._meta.db_table,
1200.             Book._meta.get_field('author').column,
1201.             (Author._meta.db_table, Author._meta.pk.column),
1202.         )
1203.         # The index on ForeignKey is replaced with a unique constraint for OneToOneField.
1204.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1205. 
1206.     def test_alter_field_fk_keeps_index(self):
1207.         with connection.schema_editor() as editor:
1208.             editor.create_model(Author)
1209.             editor.create_model(Book)
1210.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1211.         expected_indexes = 1 if connection.features.indexes_foreign_keys else 0
1212. 
1213.         # Check the index is right to begin with.
1214.         counts = self.get_constraints_count(
1215.             Book._meta.db_table,
1216.             Book._meta.get_field('author').column,
1217.             (Author._meta.db_table, Author._meta.pk.column),
1218.         )
1219.         self.assertEqual(
1220.             counts,
1221.             {'fks': expected_fks, 'uniques': 0, 'indexes': expected_indexes},
1222.         )
1223. 
1224.         old_field = Book._meta.get_field('author')
1225.         # on_delete changed from CASCADE.
1226.         new_field = ForeignKey(Author, PROTECT)
1227.         new_field.set_attributes_from_name('author')
1228.         with connection.schema_editor() as editor:
1229.             editor.alter_field(Book, old_field, new_field, strict=True)
1230. 
1231.         counts = self.get_constraints_count(
1232.             Book._meta.db_table,
1233.             Book._meta.get_field('author').column,
1234.             (Author._meta.db_table, Author._meta.pk.column),
1235.         )
1236.         # The index remains.
1237.         self.assertEqual(
1238.             counts,
1239.             {'fks': expected_fks, 'uniques': 0, 'indexes': expected_indexes},
1240.         )
1241. 
1242.     def test_alter_field_o2o_to_fk(self):
1243.         with connection.schema_editor() as editor:
1244.             editor.create_model(Author)
1245.             editor.create_model(BookWithO2O)
1246.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1247. 
1248.         # Check the unique constraint is right to begin with.
1249.         counts = self.get_constraints_count(
1250.             BookWithO2O._meta.db_table,
1251.             BookWithO2O._meta.get_field('author').column,
1252.             (Author._meta.db_table, Author._meta.pk.column),
1253.         )
1254.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1255. 
1256.         old_field = BookWithO2O._meta.get_field('author')
1257.         new_field = ForeignKey(Author, CASCADE)
1258.         new_field.set_attributes_from_name('author')
1259.         with connection.schema_editor() as editor:
1260.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1261. 
1262.         counts = self.get_constraints_count(
1263.             BookWithO2O._meta.db_table,
1264.             BookWithO2O._meta.get_field('author').column,
1265.             (Author._meta.db_table, Author._meta.pk.column),
1266.         )
1267.         # The unique constraint on OneToOneField is replaced with an index for ForeignKey.
1268.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1269. 
1270.     def test_alter_field_o2o_keeps_unique(self):
1271.         with connection.schema_editor() as editor:
1272.             editor.create_model(Author)
1273.             editor.create_model(BookWithO2O)
1274.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1275. 
1276.         # Check the unique constraint is right to begin with.
1277.         counts = self.get_constraints_count(
1278.             BookWithO2O._meta.db_table,
1279.             BookWithO2O._meta.get_field('author').column,
1280.             (Author._meta.db_table, Author._meta.pk.column),
1281.         )
1282.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1283. 
1284.         old_field = BookWithO2O._meta.get_field('author')
1285.         # on_delete changed from CASCADE.
1286.         new_field = OneToOneField(Author, PROTECT)
1287.         new_field.set_attributes_from_name('author')
1288.         with connection.schema_editor() as editor:
1289.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1290. 
1291.         counts = self.get_constraints_count(
1292.             BookWithO2O._meta.db_table,
1293.             BookWithO2O._meta.get_field('author').column,
1294.             (Author._meta.db_table, Author._meta.pk.column),
1295.         )
1296.         # The unique constraint remains.
1297.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1298. 
1299.     @skipUnlessDBFeature('ignores_table_name_case')
1300.     def test_alter_db_table_case(self):
1301.         # Create the table
1302.         with connection.schema_editor() as editor:
1303.             editor.create_model(Author)
1304.         # Alter the case of the table
1305.         old_table_name = Author._meta.db_table
1306.         with connection.schema_editor() as editor:
1307.             editor.alter_db_table(Author, old_table_name, old_table_name.upper())
1308. 
1309.     def test_alter_implicit_id_to_explicit(self):
1310.         """
1311.         Should be able to convert an implicit "id" field to an explicit "id"
1312.         primary key field.
1313.         """
1314.         with connection.schema_editor() as editor:
1315.             editor.create_model(Author)
1316. 
1317.         old_field = Author._meta.get_field("id")
1318.         new_field = AutoField(primary_key=True)
1319.         new_field.set_attributes_from_name("id")
1320.         new_field.model = Author
1321.         with connection.schema_editor() as editor:
1322.             editor.alter_field(Author, old_field, new_field, strict=True)
1323.         # This will fail if DROP DEFAULT is inadvertently executed on this
1324.         # field which drops the id sequence, at least on PostgreSQL.
1325.         Author.objects.create(name='Foo')
1326.         Author.objects.create(name='Bar')
1327. 
1328.     def test_alter_autofield_pk_to_bigautofield_pk_sequence_owner(self):
1329.         """
1330.         Converting an implicit PK to BigAutoField(primary_key=True) should keep
1331.         a sequence owner on PostgreSQL.
1332.         """
1333.         with connection.schema_editor() as editor:
1334.             editor.create_model(Author)
1335.         old_field = Author._meta.get_field('id')
1336.         new_field = BigAutoField(primary_key=True)
1337.         new_field.set_attributes_from_name('id')
1338.         new_field.model = Author
1339.         with connection.schema_editor() as editor:
1340.             editor.alter_field(Author, old_field, new_field, strict=True)
1341. 
1342.         Author.objects.create(name='Foo', pk=1)
1343.         with connection.cursor() as cursor:
1344.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1345.             if sequence_reset_sqls:
1346.                 cursor.execute(sequence_reset_sqls[0])
1347.         # Fail on PostgreSQL if sequence is missing an owner.
1348.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1349. 
1350.     def test_alter_autofield_pk_to_smallautofield_pk_sequence_owner(self):
1351.         """
1352.         Converting an implicit PK to SmallAutoField(primary_key=True) should
1353.         keep a sequence owner on PostgreSQL.
1354.         """
1355.         with connection.schema_editor() as editor:
1356.             editor.create_model(Author)
1357.         old_field = Author._meta.get_field('id')
1358.         new_field = SmallAutoField(primary_key=True)
1359.         new_field.set_attributes_from_name('id')
1360.         new_field.model = Author
1361.         with connection.schema_editor() as editor:
1362.             editor.alter_field(Author, old_field, new_field, strict=True)
1363. 
1364.         Author.objects.create(name='Foo', pk=1)
1365.         with connection.cursor() as cursor:
1366.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1367.             if sequence_reset_sqls:
1368.                 cursor.execute(sequence_reset_sqls[0])
1369.         # Fail on PostgreSQL if sequence is missing an owner.
1370.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1371. 
1372.     def test_alter_int_pk_to_autofield_pk(self):
1373.         """
1374.         Should be able to rename an IntegerField(primary_key=True) to
1375.         AutoField(primary_key=True).
1376.         """
1377.         with connection.schema_editor() as editor:
1378.             editor.create_model(IntegerPK)
1379. 
1380.         old_field = IntegerPK._meta.get_field('i')
1381.         new_field = AutoField(primary_key=True)
1382.         new_field.model = IntegerPK
1383.         new_field.set_attributes_from_name('i')
1384. 
1385.         with connection.schema_editor() as editor:
1386.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1387. 
1388.         # A model representing the updated model.
1389.         class IntegerPKToAutoField(Model):
1390.             i = AutoField(primary_key=True)
1391.             j = IntegerField(unique=True)
1392. 
1393.             class Meta:
1394.                 app_label = 'schema'
1395.                 apps = new_apps
1396.                 db_table = IntegerPK._meta.db_table
1397. 
1398.         # An id (i) is generated by the database.
1399.         obj = IntegerPKToAutoField.objects.create(j=1)
1400.         self.assertIsNotNone(obj.i)
1401. 
1402.     def test_alter_int_pk_to_bigautofield_pk(self):
1403.         """
1404.         Should be able to rename an IntegerField(primary_key=True) to
1405.         BigAutoField(primary_key=True).
1406.         """
1407.         with connection.schema_editor() as editor:
1408.             editor.create_model(IntegerPK)
1409. 
1410.         old_field = IntegerPK._meta.get_field('i')
1411.         new_field = BigAutoField(primary_key=True)
1412.         new_field.model = IntegerPK
1413.         new_field.set_attributes_from_name('i')
1414. 
1415.         with connection.schema_editor() as editor:
1416.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1417. 
1418.         # A model representing the updated model.
1419.         class IntegerPKToBigAutoField(Model):
1420.             i = BigAutoField(primary_key=True)
1421.             j = IntegerField(unique=True)
1422. 
1423.             class Meta:
1424.                 app_label = 'schema'
1425.                 apps = new_apps
1426.                 db_table = IntegerPK._meta.db_table
1427. 
1428.         # An id (i) is generated by the database.
1429.         obj = IntegerPKToBigAutoField.objects.create(j=1)
1430.         self.assertIsNotNone(obj.i)
1431. 
1432.     @isolate_apps('schema')
1433.     def test_alter_smallint_pk_to_smallautofield_pk(self):
1434.         """
1435.         Should be able to rename an SmallIntegerField(primary_key=True) to
1436.         SmallAutoField(primary_key=True).
1437.         """
1438.         class SmallIntegerPK(Model):
1439.             i = SmallIntegerField(primary_key=True)
1440. 
1441.             class Meta:
1442.                 app_label = 'schema'
1443. 
1444.         with connection.schema_editor() as editor:
1445.             editor.create_model(SmallIntegerPK)
1446.         self.isolated_local_models = [SmallIntegerPK]
1447.         old_field = SmallIntegerPK._meta.get_field('i')
1448.         new_field = SmallAutoField(primary_key=True)
1449.         new_field.model = SmallIntegerPK
1450.         new_field.set_attributes_from_name('i')
1451.         with connection.schema_editor() as editor:
1452.             editor.alter_field(SmallIntegerPK, old_field, new_field, strict=True)
1453. 
1454.     def test_alter_int_pk_to_int_unique(self):
1455.         """
1456.         Should be able to rename an IntegerField(primary_key=True) to
1457.         IntegerField(unique=True).
1458.         """
1459.         with connection.schema_editor() as editor:
1460.             editor.create_model(IntegerPK)
1461.         # Delete the old PK
1462.         old_field = IntegerPK._meta.get_field('i')
1463.         new_field = IntegerField(unique=True)
1464.         new_field.model = IntegerPK
1465.         new_field.set_attributes_from_name('i')
1466.         with connection.schema_editor() as editor:
1467.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1468.         # The primary key constraint is gone. Result depends on database:
1469.         # 'id' for SQLite, None for others (must not be 'i').
1470.         self.assertIn(self.get_primary_key(IntegerPK._meta.db_table), ('id', None))
1471. 
1472.         # Set up a model class as it currently stands. The original IntegerPK
1473.         # class is now out of date and some backends make use of the whole
1474.         # model class when modifying a field (such as sqlite3 when remaking a
1475.         # table) so an outdated model class leads to incorrect results.
1476.         class Transitional(Model):
1477.             i = IntegerField(unique=True)
1478.             j = IntegerField(unique=True)
1479. 
1480.             class Meta:
1481.                 app_label = 'schema'
1482.                 apps = new_apps
1483.                 db_table = 'INTEGERPK'
1484. 
1485.         # model requires a new PK
1486.         old_field = Transitional._meta.get_field('j')
1487.         new_field = IntegerField(primary_key=True)
1488.         new_field.model = Transitional
1489.         new_field.set_attributes_from_name('j')
1490. 
1491.         with connection.schema_editor() as editor:
1492.             editor.alter_field(Transitional, old_field, new_field, strict=True)
1493. 
1494.         # Create a model class representing the updated model.
1495.         class IntegerUnique(Model):
1496.             i = IntegerField(unique=True)
1497.             j = IntegerField(primary_key=True)
1498. 
1499.             class Meta:
1500.                 app_label = 'schema'
1501.                 apps = new_apps
1502.                 db_table = 'INTEGERPK'
1503. 
1504.         # Ensure unique constraint works.
1505.         IntegerUnique.objects.create(i=1, j=1)
1506.         with self.assertRaises(IntegrityError):
1507.             IntegerUnique.objects.create(i=1, j=2)
1508. 
1509.     def test_rename(self):
1510.         """
1511.         Tests simple altering of fields
1512.         """
1513.         # Create the table
1514.         with connection.schema_editor() as editor:
1515.             editor.create_model(Author)
1516.         # Ensure the field is right to begin with
1517.         columns = self.column_classes(Author)
1518.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
1519.         self.assertNotIn("display_name", columns)
1520.         # Alter the name field's name
1521.         old_field = Author._meta.get_field("name")
1522.         new_field = CharField(max_length=254)
1523.         new_field.set_attributes_from_name("display_name")
1524.         with connection.schema_editor() as editor:
1525.             editor.alter_field(Author, old_field, new_field, strict=True)
1526.         # Ensure the field is right afterwards
1527.         columns = self.column_classes(Author)
1528.         self.assertEqual(columns['display_name'][0], connection.features.introspected_field_types['CharField'])
1529.         self.assertNotIn("name", columns)
1530. 
1531.     @isolate_apps('schema')
1532.     def test_rename_referenced_field(self):
1533.         class Author(Model):
1534.             name = CharField(max_length=255, unique=True)
1535. 
1536.             class Meta:
1537.                 app_label = 'schema'
1538. 
1539.         class Book(Model):
1540.             author = ForeignKey(Author, CASCADE, to_field='name')
1541. 
1542.             class Meta:
1543.                 app_label = 'schema'
1544. 
1545.         with connection.schema_editor() as editor:
1546.             editor.create_model(Author)
1547.             editor.create_model(Book)
1548.         new_field = CharField(max_length=255, unique=True)
1549.         new_field.set_attributes_from_name('renamed')
1550.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
1551.             editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1552.         # Ensure the foreign key reference was updated.
1553.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author', 'renamed')
1554. 
1555.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
1556.     def test_rename_keep_null_status(self):
1557.         """
1558.         Renaming a field shouldn't affect the not null status.
1559.         """
1560.         with connection.schema_editor() as editor:
1561.             editor.create_model(Note)
1562.         with self.assertRaises(IntegrityError):
1563.             Note.objects.create(info=None)
1564.         old_field = Note._meta.get_field("info")
1565.         new_field = TextField()
1566.         new_field.set_attributes_from_name("detail_info")
1567.         with connection.schema_editor() as editor:
1568.             editor.alter_field(Note, old_field, new_field, strict=True)
1569.         columns = self.column_classes(Note)
1570.         self.assertEqual(columns['detail_info'][0], "TextField")
1571.         self.assertNotIn("info", columns)
1572.         with self.assertRaises(IntegrityError):
1573.             NoteRename.objects.create(detail_info=None)
1574. 
1575.     def _test_m2m_create(self, M2MFieldClass):
1576.         """
1577.         Tests M2M fields on models during creation
1578.         """
1579.         class LocalBookWithM2M(Model):
1580.             author = ForeignKey(Author, CASCADE)
1581.             title = CharField(max_length=100, db_index=True)
1582.             pub_date = DateTimeField()
1583.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1584. 
1585.             class Meta:
1586.                 app_label = 'schema'
1587.                 apps = new_apps
1588.         self.local_models = [LocalBookWithM2M]
1589.         # Create the tables
1590.         with connection.schema_editor() as editor:
1591.             editor.create_model(Author)
1592.             editor.create_model(TagM2MTest)
1593.             editor.create_model(LocalBookWithM2M)
1594.         # Ensure there is now an m2m table there
1595.         columns = self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1596.         self.assertEqual(columns['tagm2mtest_id'][0], connection.features.introspected_field_types['IntegerField'])
1597. 
1598.     def test_m2m_create(self):
1599.         self._test_m2m_create(ManyToManyField)
1600. 
1601.     def test_m2m_create_custom(self):
1602.         self._test_m2m_create(CustomManyToManyField)
1603. 
1604.     def test_m2m_create_inherited(self):
1605.         self._test_m2m_create(InheritedManyToManyField)
1606. 
1607.     def _test_m2m_create_through(self, M2MFieldClass):
1608.         """
1609.         Tests M2M fields on models during creation with through models
1610.         """
1611.         class LocalTagThrough(Model):
1612.             book = ForeignKey("schema.LocalBookWithM2MThrough", CASCADE)
1613.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1614. 
1615.             class Meta:
1616.                 app_label = 'schema'
1617.                 apps = new_apps
1618. 
1619.         class LocalBookWithM2MThrough(Model):
1620.             tags = M2MFieldClass("TagM2MTest", related_name="books", through=LocalTagThrough)
1621. 
1622.             class Meta:
1623.                 app_label = 'schema'
1624.                 apps = new_apps
1625. 
1626.         self.local_models = [LocalTagThrough, LocalBookWithM2MThrough]
1627. 
1628.         # Create the tables
1629.         with connection.schema_editor() as editor:
1630.             editor.create_model(LocalTagThrough)
1631.             editor.create_model(TagM2MTest)
1632.             editor.create_model(LocalBookWithM2MThrough)
1633.         # Ensure there is now an m2m table there
1634.         columns = self.column_classes(LocalTagThrough)
1635.         self.assertEqual(columns['book_id'][0], connection.features.introspected_field_types['IntegerField'])
1636.         self.assertEqual(columns['tag_id'][0], connection.features.introspected_field_types['IntegerField'])
1637. 
1638.     def test_m2m_create_through(self):
1639.         self._test_m2m_create_through(ManyToManyField)
1640. 
1641.     def test_m2m_create_through_custom(self):
1642.         self._test_m2m_create_through(CustomManyToManyField)
1643. 
1644.     def test_m2m_create_through_inherited(self):
1645.         self._test_m2m_create_through(InheritedManyToManyField)
1646. 
1647.     def _test_m2m(self, M2MFieldClass):
1648.         """
1649.         Tests adding/removing M2M fields on models
1650.         """
1651.         class LocalAuthorWithM2M(Model):
1652.             name = CharField(max_length=255)
1653. 
1654.             class Meta:
1655.                 app_label = 'schema'
1656.                 apps = new_apps
1657. 
1658.         self.local_models = [LocalAuthorWithM2M]
1659. 
1660.         # Create the tables
1661.         with connection.schema_editor() as editor:
1662.             editor.create_model(LocalAuthorWithM2M)
1663.             editor.create_model(TagM2MTest)
1664.         # Create an M2M field
1665.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors")
1666.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
1667.         # Ensure there's no m2m table there
1668.         with self.assertRaises(DatabaseError):
1669.             self.column_classes(new_field.remote_field.through)
1670.         # Add the field
1671.         with connection.schema_editor() as editor:
1672.             editor.add_field(LocalAuthorWithM2M, new_field)
1673.         # Ensure there is now an m2m table there
1674.         columns = self.column_classes(new_field.remote_field.through)
1675.         self.assertEqual(columns['tagm2mtest_id'][0], connection.features.introspected_field_types['IntegerField'])
1676. 
1677.         # "Alter" the field. This should not rename the DB table to itself.
1678.         with connection.schema_editor() as editor:
1679.             editor.alter_field(LocalAuthorWithM2M, new_field, new_field, strict=True)
1680. 
1681.         # Remove the M2M table again
1682.         with connection.schema_editor() as editor:
1683.             editor.remove_field(LocalAuthorWithM2M, new_field)
1684.         # Ensure there's no m2m table there
1685.         with self.assertRaises(DatabaseError):
1686.             self.column_classes(new_field.remote_field.through)
1687. 
1688.         # Make sure the model state is coherent with the table one now that
1689.         # we've removed the tags field.
1690.         opts = LocalAuthorWithM2M._meta
1691.         opts.local_many_to_many.remove(new_field)
1692.         del new_apps.all_models['schema'][new_field.remote_field.through._meta.model_name]
1693.         opts._expire_cache()
1694. 
1695.     def test_m2m(self):
1696.         self._test_m2m(ManyToManyField)
1697. 
1698.     def test_m2m_custom(self):
1699.         self._test_m2m(CustomManyToManyField)
1700. 
1701.     def test_m2m_inherited(self):
1702.         self._test_m2m(InheritedManyToManyField)
1703. 
1704.     def _test_m2m_through_alter(self, M2MFieldClass):
1705.         """
1706.         Tests altering M2Ms with explicit through models (should no-op)
1707.         """
1708.         class LocalAuthorTag(Model):
1709.             author = ForeignKey("schema.LocalAuthorWithM2MThrough", CASCADE)
1710.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1711. 
1712.             class Meta:
1713.                 app_label = 'schema'
1714.                 apps = new_apps
1715. 
1716.         class LocalAuthorWithM2MThrough(Model):
1717.             name = CharField(max_length=255)
1718.             tags = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1719. 
1720.             class Meta:
1721.                 app_label = 'schema'
1722.                 apps = new_apps
1723. 
1724.         self.local_models = [LocalAuthorTag, LocalAuthorWithM2MThrough]
1725. 
1726.         # Create the tables
1727.         with connection.schema_editor() as editor:
1728.             editor.create_model(LocalAuthorTag)
1729.             editor.create_model(LocalAuthorWithM2MThrough)
1730.             editor.create_model(TagM2MTest)
1731.         # Ensure the m2m table is there
1732.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1733.         # "Alter" the field's blankness. This should not actually do anything.
1734.         old_field = LocalAuthorWithM2MThrough._meta.get_field("tags")
1735.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1736.         new_field.contribute_to_class(LocalAuthorWithM2MThrough, "tags")
1737.         with connection.schema_editor() as editor:
1738.             editor.alter_field(LocalAuthorWithM2MThrough, old_field, new_field, strict=True)
1739.         # Ensure the m2m table is still there
1740.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1741. 
1742.     def test_m2m_through_alter(self):
1743.         self._test_m2m_through_alter(ManyToManyField)
1744. 
1745.     def test_m2m_through_alter_custom(self):
1746.         self._test_m2m_through_alter(CustomManyToManyField)
1747. 
1748.     def test_m2m_through_alter_inherited(self):
1749.         self._test_m2m_through_alter(InheritedManyToManyField)
1750. 
1751.     def _test_m2m_repoint(self, M2MFieldClass):
1752.         """
1753.         Tests repointing M2M fields
1754.         """
1755.         class LocalBookWithM2M(Model):
1756.             author = ForeignKey(Author, CASCADE)
1757.             title = CharField(max_length=100, db_index=True)
1758.             pub_date = DateTimeField()
1759.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1760. 
1761.             class Meta:
1762.                 app_label = 'schema'
1763.                 apps = new_apps
1764.         self.local_models = [LocalBookWithM2M]
1765.         # Create the tables
1766.         with connection.schema_editor() as editor:
1767.             editor.create_model(Author)
1768.             editor.create_model(LocalBookWithM2M)
1769.             editor.create_model(TagM2MTest)
1770.             editor.create_model(UniqueTest)
1771.         # Ensure the M2M exists and points to TagM2MTest
1772.         if connection.features.supports_foreign_keys:
1773.             self.assertForeignKeyExists(
1774.                 LocalBookWithM2M._meta.get_field("tags").remote_field.through,
1775.                 'tagm2mtest_id',
1776.                 'schema_tagm2mtest',
1777.             )
1778.         # Repoint the M2M
1779.         old_field = LocalBookWithM2M._meta.get_field("tags")
1780.         new_field = M2MFieldClass(UniqueTest)
1781.         new_field.contribute_to_class(LocalBookWithM2M, "uniques")
1782.         with connection.schema_editor() as editor:
1783.             editor.alter_field(LocalBookWithM2M, old_field, new_field, strict=True)
1784.         # Ensure old M2M is gone
1785.         with self.assertRaises(DatabaseError):
1786.             self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1787. 
1788.         # This model looks like the new model and is used for teardown.
1789.         opts = LocalBookWithM2M._meta
1790.         opts.local_many_to_many.remove(old_field)
1791.         # Ensure the new M2M exists and points to UniqueTest
1792.         if connection.features.supports_foreign_keys:
1793.             self.assertForeignKeyExists(new_field.remote_field.through, 'uniquetest_id', 'schema_uniquetest')
1794. 
1795.     def test_m2m_repoint(self):
1796.         self._test_m2m_repoint(ManyToManyField)
1797. 
1798.     def test_m2m_repoint_custom(self):
1799.         self._test_m2m_repoint(CustomManyToManyField)
1800. 
1801.     def test_m2m_repoint_inherited(self):
1802.         self._test_m2m_repoint(InheritedManyToManyField)
1803. 
1804.     @isolate_apps('schema')
1805.     def test_m2m_rename_field_in_target_model(self):
1806.         class LocalTagM2MTest(Model):
1807.             title = CharField(max_length=255)
1808. 
1809.             class Meta:
1810.                 app_label = 'schema'
1811. 
1812.         class LocalM2M(Model):
1813.             tags = ManyToManyField(LocalTagM2MTest)
1814. 
1815.             class Meta:
1816.                 app_label = 'schema'
1817. 
1818.         # Create the tables.
1819.         with connection.schema_editor() as editor:
1820.             editor.create_model(LocalM2M)
1821.             editor.create_model(LocalTagM2MTest)
1822.         self.isolated_local_models = [LocalM2M, LocalTagM2MTest]
1823.         # Ensure the m2m table is there.
1824.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1825.         # Alter a field in LocalTagM2MTest.
1826.         old_field = LocalTagM2MTest._meta.get_field('title')
1827.         new_field = CharField(max_length=254)
1828.         new_field.contribute_to_class(LocalTagM2MTest, 'title1')
1829.         # @isolate_apps() and inner models are needed to have the model
1830.         # relations populated, otherwise this doesn't act as a regression test.
1831.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
1832.         with connection.schema_editor() as editor:
1833.             editor.alter_field(LocalTagM2MTest, old_field, new_field, strict=True)
1834.         # Ensure the m2m table is still there.
1835.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1836. 
1837.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1838.     def test_check_constraints(self):
1839.         """
1840.         Tests creating/deleting CHECK constraints
1841.         """
1842.         # Create the tables
1843.         with connection.schema_editor() as editor:
1844.             editor.create_model(Author)
1845.         # Ensure the constraint exists
1846.         constraints = self.get_constraints(Author._meta.db_table)
1847.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1848.             self.fail("No check constraint for height found")
1849.         # Alter the column to remove it
1850.         old_field = Author._meta.get_field("height")
1851.         new_field = IntegerField(null=True, blank=True)
1852.         new_field.set_attributes_from_name("height")
1853.         with connection.schema_editor() as editor:
1854.             editor.alter_field(Author, old_field, new_field, strict=True)
1855.         constraints = self.get_constraints(Author._meta.db_table)
1856.         for details in constraints.values():
1857.             if details['columns'] == ["height"] and details['check']:
1858.                 self.fail("Check constraint for height found")
1859.         # Alter the column to re-add it
1860.         new_field2 = Author._meta.get_field("height")
1861.         with connection.schema_editor() as editor:
1862.             editor.alter_field(Author, new_field, new_field2, strict=True)
1863.         constraints = self.get_constraints(Author._meta.db_table)
1864.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1865.             self.fail("No check constraint for height found")
1866. 
1867.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1868.     def test_remove_field_check_does_not_remove_meta_constraints(self):
1869.         with connection.schema_editor() as editor:
1870.             editor.create_model(Author)
1871.         # Add the custom check constraint
1872.         constraint = CheckConstraint(check=Q(height__gte=0), name='author_height_gte_0_check')
1873.         custom_constraint_name = constraint.name
1874.         Author._meta.constraints = [constraint]
1875.         with connection.schema_editor() as editor:
1876.             editor.add_constraint(Author, constraint)
1877.         # Ensure the constraints exist
1878.         constraints = self.get_constraints(Author._meta.db_table)
1879.         self.assertIn(custom_constraint_name, constraints)
1880.         other_constraints = [
1881.             name for name, details in constraints.items()
1882.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1883.         ]
1884.         self.assertEqual(len(other_constraints), 1)
1885.         # Alter the column to remove field check
1886.         old_field = Author._meta.get_field('height')
1887.         new_field = IntegerField(null=True, blank=True)
1888.         new_field.set_attributes_from_name('height')
1889.         with connection.schema_editor() as editor:
1890.             editor.alter_field(Author, old_field, new_field, strict=True)
1891.         constraints = self.get_constraints(Author._meta.db_table)
1892.         self.assertIn(custom_constraint_name, constraints)
1893.         other_constraints = [
1894.             name for name, details in constraints.items()
1895.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1896.         ]
1897.         self.assertEqual(len(other_constraints), 0)
1898.         # Alter the column to re-add field check
1899.         new_field2 = Author._meta.get_field('height')
1900.         with connection.schema_editor() as editor:
1901.             editor.alter_field(Author, new_field, new_field2, strict=True)
1902.         constraints = self.get_constraints(Author._meta.db_table)
1903.         self.assertIn(custom_constraint_name, constraints)
1904.         other_constraints = [
1905.             name for name, details in constraints.items()
1906.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1907.         ]
1908.         self.assertEqual(len(other_constraints), 1)
1909.         # Drop the check constraint
1910.         with connection.schema_editor() as editor:
1911.             Author._meta.constraints = []
1912.             editor.remove_constraint(Author, constraint)
1913. 
1914.     def test_unique(self):
1915.         """
1916.         Tests removing and adding unique constraints to a single column.
1917.         """
1918.         # Create the table
1919.         with connection.schema_editor() as editor:
1920.             editor.create_model(Tag)
1921.         # Ensure the field is unique to begin with
1922.         Tag.objects.create(title="foo", slug="foo")
1923.         with self.assertRaises(IntegrityError):
1924.             Tag.objects.create(title="bar", slug="foo")
1925.         Tag.objects.all().delete()
1926.         # Alter the slug field to be non-unique
1927.         old_field = Tag._meta.get_field("slug")
1928.         new_field = SlugField(unique=False)
1929.         new_field.set_attributes_from_name("slug")
1930.         with connection.schema_editor() as editor:
1931.             editor.alter_field(Tag, old_field, new_field, strict=True)
1932.         # Ensure the field is no longer unique
1933.         Tag.objects.create(title="foo", slug="foo")
1934.         Tag.objects.create(title="bar", slug="foo")
1935.         Tag.objects.all().delete()
1936.         # Alter the slug field to be unique
1937.         new_field2 = SlugField(unique=True)
1938.         new_field2.set_attributes_from_name("slug")
1939.         with connection.schema_editor() as editor:
1940.             editor.alter_field(Tag, new_field, new_field2, strict=True)
1941.         # Ensure the field is unique again
1942.         Tag.objects.create(title="foo", slug="foo")
1943.         with self.assertRaises(IntegrityError):
1944.             Tag.objects.create(title="bar", slug="foo")
1945.         Tag.objects.all().delete()
1946.         # Rename the field
1947.         new_field3 = SlugField(unique=True)
1948.         new_field3.set_attributes_from_name("slug2")
1949.         with connection.schema_editor() as editor:
1950.             editor.alter_field(Tag, new_field2, new_field3, strict=True)
1951.         # Ensure the field is still unique
1952.         TagUniqueRename.objects.create(title="foo", slug2="foo")
1953.         with self.assertRaises(IntegrityError):
1954.             TagUniqueRename.objects.create(title="bar", slug2="foo")
1955.         Tag.objects.all().delete()
1956. 
1957.     def test_unique_name_quoting(self):
1958.         old_table_name = TagUniqueRename._meta.db_table
1959.         try:
1960.             with connection.schema_editor() as editor:
1961.                 editor.create_model(TagUniqueRename)
1962.                 editor.alter_db_table(TagUniqueRename, old_table_name, 'unique-table')
1963.                 TagUniqueRename._meta.db_table = 'unique-table'
1964.                 # This fails if the unique index name isn't quoted.
1965.                 editor.alter_unique_together(TagUniqueRename, [], (('title', 'slug2'),))
1966.         finally:
1967.             TagUniqueRename._meta.db_table = old_table_name
1968. 
1969.     @isolate_apps('schema')
1970.     @skipUnlessDBFeature('supports_foreign_keys')
1971.     def test_unique_no_unnecessary_fk_drops(self):
1972.         """
1973.         If AlterField isn't selective about dropping foreign key constraints
1974.         when modifying a field with a unique constraint, the AlterField
1975.         incorrectly drops and recreates the Book.author foreign key even though
1976.         it doesn't restrict the field being changed (#29193).
1977.         """
1978.         class Author(Model):
1979.             name = CharField(max_length=254, unique=True)
1980. 
1981.             class Meta:
1982.                 app_label = 'schema'
1983. 
1984.         class Book(Model):
1985.             author = ForeignKey(Author, CASCADE)
1986. 
1987.             class Meta:
1988.                 app_label = 'schema'
1989. 
1990.         with connection.schema_editor() as editor:
1991.             editor.create_model(Author)
1992.             editor.create_model(Book)
1993.         new_field = CharField(max_length=255, unique=True)
1994.         new_field.model = Author
1995.         new_field.set_attributes_from_name('name')
1996.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1997.             with connection.schema_editor() as editor:
1998.                 editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1999.         # One SQL statement is executed to alter the field.
2000.         self.assertEqual(len(cm.records), 1)
2001. 
2002.     @isolate_apps('schema')
2003.     def test_unique_and_reverse_m2m(self):
2004.         """
2005.         AlterField can modify a unique field when there's a reverse M2M
2006.         relation on the model.
2007.         """
2008.         class Tag(Model):
2009.             title = CharField(max_length=255)
2010.             slug = SlugField(unique=True)
2011. 
2012.             class Meta:
2013.                 app_label = 'schema'
2014. 
2015.         class Book(Model):
2016.             tags = ManyToManyField(Tag, related_name='books')
2017. 
2018.             class Meta:
2019.                 app_label = 'schema'
2020. 
2021.         self.isolated_local_models = [Book._meta.get_field('tags').remote_field.through]
2022.         with connection.schema_editor() as editor:
2023.             editor.create_model(Tag)
2024.             editor.create_model(Book)
2025.         new_field = SlugField(max_length=75, unique=True)
2026.         new_field.model = Tag
2027.         new_field.set_attributes_from_name('slug')
2028.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
2029.             with connection.schema_editor() as editor:
2030.                 editor.alter_field(Tag, Tag._meta.get_field('slug'), new_field)
2031.         # One SQL statement is executed to alter the field.
2032.         self.assertEqual(len(cm.records), 1)
2033.         # Ensure that the field is still unique.
2034.         Tag.objects.create(title='foo', slug='foo')
2035.         with self.assertRaises(IntegrityError):
2036.             Tag.objects.create(title='bar', slug='foo')
2037. 
2038.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2039.     def test_remove_field_unique_does_not_remove_meta_constraints(self):
2040.         with connection.schema_editor() as editor:
2041.             editor.create_model(AuthorWithUniqueName)
2042.         # Add the custom unique constraint
2043.         constraint = UniqueConstraint(fields=['name'], name='author_name_uniq')
2044.         custom_constraint_name = constraint.name
2045.         AuthorWithUniqueName._meta.constraints = [constraint]
2046.         with connection.schema_editor() as editor:
2047.             editor.add_constraint(AuthorWithUniqueName, constraint)
2048.         # Ensure the constraints exist
2049.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
2050.         self.assertIn(custom_constraint_name, constraints)
2051.         other_constraints = [
2052.             name for name, details in constraints.items()
2053.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2054.         ]
2055.         self.assertEqual(len(other_constraints), 1)
2056.         # Alter the column to remove field uniqueness
2057.         old_field = AuthorWithUniqueName._meta.get_field('name')
2058.         new_field = CharField(max_length=255)
2059.         new_field.set_attributes_from_name('name')
2060.         with connection.schema_editor() as editor:
2061.             editor.alter_field(AuthorWithUniqueName, old_field, new_field, strict=True)
2062.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
2063.         self.assertIn(custom_constraint_name, constraints)
2064.         other_constraints = [
2065.             name for name, details in constraints.items()
2066.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2067.         ]
2068.         self.assertEqual(len(other_constraints), 0)
2069.         # Alter the column to re-add field uniqueness
2070.         new_field2 = AuthorWithUniqueName._meta.get_field('name')
2071.         with connection.schema_editor() as editor:
2072.             editor.alter_field(AuthorWithUniqueName, new_field, new_field2, strict=True)
2073.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
2074.         self.assertIn(custom_constraint_name, constraints)
2075.         other_constraints = [
2076.             name for name, details in constraints.items()
2077.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2078.         ]
2079.         self.assertEqual(len(other_constraints), 1)
2080.         # Drop the unique constraint
2081.         with connection.schema_editor() as editor:
2082.             AuthorWithUniqueName._meta.constraints = []
2083.             editor.remove_constraint(AuthorWithUniqueName, constraint)
2084. 
2085.     def test_unique_together(self):
2086.         """
2087.         Tests removing and adding unique_together constraints on a model.
2088.         """
2089.         # Create the table
2090.         with connection.schema_editor() as editor:
2091.             editor.create_model(UniqueTest)
2092.         # Ensure the fields are unique to begin with
2093.         UniqueTest.objects.create(year=2012, slug="foo")
2094.         UniqueTest.objects.create(year=2011, slug="foo")
2095.         UniqueTest.objects.create(year=2011, slug="bar")
2096.         with self.assertRaises(IntegrityError):
2097.             UniqueTest.objects.create(year=2012, slug="foo")
2098.         UniqueTest.objects.all().delete()
2099.         # Alter the model to its non-unique-together companion
2100.         with connection.schema_editor() as editor:
2101.             editor.alter_unique_together(UniqueTest, UniqueTest._meta.unique_together, [])
2102.         # Ensure the fields are no longer unique
2103.         UniqueTest.objects.create(year=2012, slug="foo")
2104.         UniqueTest.objects.create(year=2012, slug="foo")
2105.         UniqueTest.objects.all().delete()
2106.         # Alter it back
2107.         new_field2 = SlugField(unique=True)
2108.         new_field2.set_attributes_from_name("slug")
2109.         with connection.schema_editor() as editor:
2110.             editor.alter_unique_together(UniqueTest, [], UniqueTest._meta.unique_together)
2111.         # Ensure the fields are unique again
2112.         UniqueTest.objects.create(year=2012, slug="foo")
2113.         with self.assertRaises(IntegrityError):
2114.             UniqueTest.objects.create(year=2012, slug="foo")
2115.         UniqueTest.objects.all().delete()
2116. 
2117.     def test_unique_together_with_fk(self):
2118.         """
2119.         Tests removing and adding unique_together constraints that include
2120.         a foreign key.
2121.         """
2122.         # Create the table
2123.         with connection.schema_editor() as editor:
2124.             editor.create_model(Author)
2125.             editor.create_model(Book)
2126.         # Ensure the fields are unique to begin with
2127.         self.assertEqual(Book._meta.unique_together, ())
2128.         # Add the unique_together constraint
2129.         with connection.schema_editor() as editor:
2130.             editor.alter_unique_together(Book, [], [['author', 'title']])
2131.         # Alter it back
2132.         with connection.schema_editor() as editor:
2133.             editor.alter_unique_together(Book, [['author', 'title']], [])
2134. 
2135.     def test_unique_together_with_fk_with_existing_index(self):
2136.         """
2137.         Tests removing and adding unique_together constraints that include
2138.         a foreign key, where the foreign key is added after the model is
2139.         created.
2140.         """
2141.         # Create the tables
2142.         with connection.schema_editor() as editor:
2143.             editor.create_model(Author)
2144.             editor.create_model(BookWithoutAuthor)
2145.             new_field = ForeignKey(Author, CASCADE)
2146.             new_field.set_attributes_from_name('author')
2147.             editor.add_field(BookWithoutAuthor, new_field)
2148.         # Ensure the fields aren't unique to begin with
2149.         self.assertEqual(Book._meta.unique_together, ())
2150.         # Add the unique_together constraint
2151.         with connection.schema_editor() as editor:
2152.             editor.alter_unique_together(Book, [], [['author', 'title']])
2153.         # Alter it back
2154.         with connection.schema_editor() as editor:
2155.             editor.alter_unique_together(Book, [['author', 'title']], [])
2156. 
2157.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2158.     def test_remove_unique_together_does_not_remove_meta_constraints(self):
2159.         with connection.schema_editor() as editor:
2160.             editor.create_model(AuthorWithUniqueNameAndBirthday)
2161.         # Add the custom unique constraint
2162.         constraint = UniqueConstraint(fields=['name', 'birthday'], name='author_name_birthday_uniq')
2163.         custom_constraint_name = constraint.name
2164.         AuthorWithUniqueNameAndBirthday._meta.constraints = [constraint]
2165.         with connection.schema_editor() as editor:
2166.             editor.add_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2167.         # Ensure the constraints exist
2168.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2169.         self.assertIn(custom_constraint_name, constraints)
2170.         other_constraints = [
2171.             name for name, details in constraints.items()
2172.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2173.         ]
2174.         self.assertEqual(len(other_constraints), 1)
2175.         # Remove unique together
2176.         unique_together = AuthorWithUniqueNameAndBirthday._meta.unique_together
2177.         with connection.schema_editor() as editor:
2178.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, unique_together, [])
2179.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2180.         self.assertIn(custom_constraint_name, constraints)
2181.         other_constraints = [
2182.             name for name, details in constraints.items()
2183.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2184.         ]
2185.         self.assertEqual(len(other_constraints), 0)
2186.         # Re-add unique together
2187.         with connection.schema_editor() as editor:
2188.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, [], unique_together)
2189.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2190.         self.assertIn(custom_constraint_name, constraints)
2191.         other_constraints = [
2192.             name for name, details in constraints.items()
2193.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2194.         ]
2195.         self.assertEqual(len(other_constraints), 1)
2196.         # Drop the unique constraint
2197.         with connection.schema_editor() as editor:
2198.             AuthorWithUniqueNameAndBirthday._meta.constraints = []
2199.             editor.remove_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2200. 
2201.     @skipUnlessDBFeature('supports_expression_indexes')
2202.     def test_func_unique_constraint(self):
2203.         with connection.schema_editor() as editor:
2204.             editor.create_model(Author)
2205.         constraint = UniqueConstraint(Upper('name').desc(), name='func_upper_uq')
2206.         # Add constraint.
2207.         with connection.schema_editor() as editor:
2208.             editor.add_constraint(Author, constraint)
2209.             sql = constraint.create_sql(Author, editor)
2210.         table = Author._meta.db_table
2211.         constraints = self.get_constraints(table)
2212.         if connection.features.supports_index_column_ordering:
2213.             self.assertIndexOrder(table, constraint.name, ['DESC'])
2214.         self.assertIn(constraint.name, constraints)
2215.         self.assertIs(constraints[constraint.name]['unique'], True)
2216.         # SQL contains a database function.
2217.         self.assertIs(sql.references_column(table, 'name'), True)
2218.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), str(sql))
2219.         # Remove constraint.
2220.         with connection.schema_editor() as editor:
2221.             editor.remove_constraint(Author, constraint)
2222.         self.assertNotIn(constraint.name, self.get_constraints(table))
2223. 
2224.     @skipUnlessDBFeature('supports_expression_indexes')
2225.     def test_composite_func_unique_constraint(self):
2226.         with connection.schema_editor() as editor:
2227.             editor.create_model(Author)
2228.             editor.create_model(BookWithSlug)
2229.         constraint = UniqueConstraint(
2230.             Upper('title'),
2231.             Lower('slug'),
2232.             name='func_upper_lower_unq',
2233.         )
2234.         # Add constraint.
2235.         with connection.schema_editor() as editor:
2236.             editor.add_constraint(BookWithSlug, constraint)
2237.             sql = constraint.create_sql(BookWithSlug, editor)
2238.         table = BookWithSlug._meta.db_table
2239.         constraints = self.get_constraints(table)
2240.         self.assertIn(constraint.name, constraints)
2241.         self.assertIs(constraints[constraint.name]['unique'], True)
2242.         # SQL contains database functions.
2243.         self.assertIs(sql.references_column(table, 'title'), True)
2244.         self.assertIs(sql.references_column(table, 'slug'), True)
2245.         sql = str(sql)
2246.         self.assertIn('UPPER(%s)' % editor.quote_name('title'), sql)
2247.         self.assertIn('LOWER(%s)' % editor.quote_name('slug'), sql)
2248.         self.assertLess(sql.index('UPPER'), sql.index('LOWER'))
2249.         # Remove constraint.
2250.         with connection.schema_editor() as editor:
2251.             editor.remove_constraint(BookWithSlug, constraint)
2252.         self.assertNotIn(constraint.name, self.get_constraints(table))
2253. 
2254.     @skipUnlessDBFeature('supports_expression_indexes')
2255.     def test_unique_constraint_field_and_expression(self):
2256.         with connection.schema_editor() as editor:
2257.             editor.create_model(Author)
2258.         constraint = UniqueConstraint(
2259.             F('height').desc(),
2260.             'uuid',
2261.             Lower('name').asc(),
2262.             name='func_f_lower_field_unq',
2263.         )
2264.         # Add constraint.
2265.         with connection.schema_editor() as editor:
2266.             editor.add_constraint(Author, constraint)
2267.             sql = constraint.create_sql(Author, editor)
2268.         table = Author._meta.db_table
2269.         if connection.features.supports_index_column_ordering:
2270.             self.assertIndexOrder(table, constraint.name, ['DESC', 'ASC', 'ASC'])
2271.         constraints = self.get_constraints(table)
2272.         self.assertIs(constraints[constraint.name]['unique'], True)
2273.         self.assertEqual(len(constraints[constraint.name]['columns']), 3)
2274.         self.assertEqual(constraints[constraint.name]['columns'][1], 'uuid')
2275.         # SQL contains database functions and columns.
2276.         self.assertIs(sql.references_column(table, 'height'), True)
2277.         self.assertIs(sql.references_column(table, 'name'), True)
2278.         self.assertIs(sql.references_column(table, 'uuid'), True)
2279.         self.assertIn('LOWER(%s)' % editor.quote_name('name'), str(sql))
2280.         # Remove constraint.
2281.         with connection.schema_editor() as editor:
2282.             editor.remove_constraint(Author, constraint)
2283.         self.assertNotIn(constraint.name, self.get_constraints(table))
2284. 
2285.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_partial_indexes')
2286.     def test_func_unique_constraint_partial(self):
2287.         with connection.schema_editor() as editor:
2288.             editor.create_model(Author)
2289.         constraint = UniqueConstraint(
2290.             Upper('name'),
2291.             name='func_upper_cond_weight_uq',
2292.             condition=Q(weight__isnull=False),
2293.         )
2294.         # Add constraint.
2295.         with connection.schema_editor() as editor:
2296.             editor.add_constraint(Author, constraint)
2297.             sql = constraint.create_sql(Author, editor)
2298.         table = Author._meta.db_table
2299.         constraints = self.get_constraints(table)
2300.         self.assertIn(constraint.name, constraints)
2301.         self.assertIs(constraints[constraint.name]['unique'], True)
2302.         self.assertIs(sql.references_column(table, 'name'), True)
2303.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), str(sql))
2304.         self.assertIn(
2305.             'WHERE %s IS NOT NULL' % editor.quote_name('weight'),
2306.             str(sql),
2307.         )
2308.         # Remove constraint.
2309.         with connection.schema_editor() as editor:
2310.             editor.remove_constraint(Author, constraint)
2311.         self.assertNotIn(constraint.name, self.get_constraints(table))
2312. 
2313.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_covering_indexes')
2314.     def test_func_unique_constraint_covering(self):
2315.         with connection.schema_editor() as editor:
2316.             editor.create_model(Author)
2317.         constraint = UniqueConstraint(
2318.             Upper('name'),
2319.             name='func_upper_covering_uq',
2320.             include=['weight', 'height'],
2321.         )
2322.         # Add constraint.
2323.         with connection.schema_editor() as editor:
2324.             editor.add_constraint(Author, constraint)
2325.             sql = constraint.create_sql(Author, editor)
2326.         table = Author._meta.db_table
2327.         constraints = self.get_constraints(table)
2328.         self.assertIn(constraint.name, constraints)
2329.         self.assertIs(constraints[constraint.name]['unique'], True)
2330.         self.assertEqual(
2331.             constraints[constraint.name]['columns'],
2332.             [None, 'weight', 'height'],
2333.         )
2334.         self.assertIs(sql.references_column(table, 'name'), True)
2335.         self.assertIs(sql.references_column(table, 'weight'), True)
2336.         self.assertIs(sql.references_column(table, 'height'), True)
2337.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), str(sql))
2338.         self.assertIn(
2339.             'INCLUDE (%s, %s)' % (
2340.                 editor.quote_name('weight'),
2341.                 editor.quote_name('height'),
2342.             ),
2343.             str(sql),
2344.         )
2345.         # Remove constraint.
2346.         with connection.schema_editor() as editor:
2347.             editor.remove_constraint(Author, constraint)
2348.         self.assertNotIn(constraint.name, self.get_constraints(table))
2349. 
2350.     @skipUnlessDBFeature('supports_expression_indexes')
2351.     def test_func_unique_constraint_lookups(self):
2352.         with connection.schema_editor() as editor:
2353.             editor.create_model(Author)
2354.         with register_lookup(CharField, Lower), register_lookup(IntegerField, Abs):
2355.             constraint = UniqueConstraint(
2356.                 F('name__lower'),
2357.                 F('weight__abs'),
2358.                 name='func_lower_abs_lookup_uq',
2359.             )
2360.             # Add constraint.
2361.             with connection.schema_editor() as editor:
2362.                 editor.add_constraint(Author, constraint)
2363.                 sql = constraint.create_sql(Author, editor)
2364.         table = Author._meta.db_table
2365.         constraints = self.get_constraints(table)
2366.         self.assertIn(constraint.name, constraints)
2367.         self.assertIs(constraints[constraint.name]['unique'], True)
2368.         # SQL contains columns.
2369.         self.assertIs(sql.references_column(table, 'name'), True)
2370.         self.assertIs(sql.references_column(table, 'weight'), True)
2371.         # Remove constraint.
2372.         with connection.schema_editor() as editor:
2373.             editor.remove_constraint(Author, constraint)
2374.         self.assertNotIn(constraint.name, self.get_constraints(table))
2375. 
2376.     @skipUnlessDBFeature('supports_expression_indexes')
2377.     def test_func_unique_constraint_collate(self):
2378.         collation = connection.features.test_collations.get('non_default')
2379.         if not collation:
2380.             self.skipTest(
2381.                 'This backend does not support case-insensitive collations.'
2382.             )
2383.         with connection.schema_editor() as editor:
2384.             editor.create_model(Author)
2385.             editor.create_model(BookWithSlug)
2386.         constraint = UniqueConstraint(
2387.             Collate(F('title'), collation=collation).desc(),
2388.             Collate('slug', collation=collation),
2389.             name='func_collate_uq',
2390.         )
2391.         # Add constraint.
2392.         with connection.schema_editor() as editor:
2393.             editor.add_constraint(BookWithSlug, constraint)
2394.             sql = constraint.create_sql(BookWithSlug, editor)
2395.         table = BookWithSlug._meta.db_table
2396.         constraints = self.get_constraints(table)
2397.         self.assertIn(constraint.name, constraints)
2398.         self.assertIs(constraints[constraint.name]['unique'], True)
2399.         if connection.features.supports_index_column_ordering:
2400.             self.assertIndexOrder(table, constraint.name, ['DESC', 'ASC'])
2401.         # SQL contains columns and a collation.
2402.         self.assertIs(sql.references_column(table, 'title'), True)
2403.         self.assertIs(sql.references_column(table, 'slug'), True)
2404.         self.assertIn('COLLATE %s' % editor.quote_name(collation), str(sql))
2405.         # Remove constraint.
2406.         with connection.schema_editor() as editor:
2407.             editor.remove_constraint(BookWithSlug, constraint)
2408.         self.assertNotIn(constraint.name, self.get_constraints(table))
2409. 
2410.     @skipIfDBFeature('supports_expression_indexes')
2411.     def test_func_unique_constraint_unsupported(self):
2412.         # UniqueConstraint is ignored on databases that don't support indexes on
2413.         # expressions.
2414.         with connection.schema_editor() as editor:
2415.             editor.create_model(Author)
2416.         constraint = UniqueConstraint(F('name'), name='func_name_uq')
2417.         with connection.schema_editor() as editor, self.assertNumQueries(0):
2418.             self.assertIsNone(editor.add_constraint(Author, constraint))
2419.             self.assertIsNone(editor.remove_constraint(Author, constraint))
2420. 
2421.     @skipUnlessDBFeature('supports_expression_indexes')
2422.     def test_func_unique_constraint_nonexistent_field(self):
2423.         constraint = UniqueConstraint(Lower('nonexistent'), name='func_nonexistent_uq')
2424.         msg = (
2425.             "Cannot resolve keyword 'nonexistent' into field. Choices are: "
2426.             "height, id, name, uuid, weight"
2427.         )
2428.         with self.assertRaisesMessage(FieldError, msg):
2429.             with connection.schema_editor() as editor:
2430.                 editor.add_constraint(Author, constraint)
2431. 
2432.     @skipUnlessDBFeature('supports_expression_indexes')
2433.     def test_func_unique_constraint_nondeterministic(self):
2434.         with connection.schema_editor() as editor:
2435.             editor.create_model(Author)
2436.         constraint = UniqueConstraint(Random(), name='func_random_uq')
2437.         with connection.schema_editor() as editor:
2438.             with self.assertRaises(DatabaseError):
2439.                 editor.add_constraint(Author, constraint)
2440. 
2441.     def test_index_together(self):
2442.         """
2443.         Tests removing and adding index_together constraints on a model.
2444.         """
2445.         # Create the table
2446.         with connection.schema_editor() as editor:
2447.             editor.create_model(Tag)
2448.         # Ensure there's no index on the year/slug columns first
2449.         self.assertIs(
2450.             any(
2451.                 c["index"]
2452.                 for c in self.get_constraints("schema_tag").values()
2453.                 if c['columns'] == ["slug", "title"]
2454.             ),
2455.             False,
2456.         )
2457.         # Alter the model to add an index
2458.         with connection.schema_editor() as editor:
2459.             editor.alter_index_together(Tag, [], [("slug", "title")])
2460.         # Ensure there is now an index
2461.         self.assertIs(
2462.             any(
2463.                 c["index"]
2464.                 for c in self.get_constraints("schema_tag").values()
2465.                 if c['columns'] == ["slug", "title"]
2466.             ),
2467.             True,
2468.         )
2469.         # Alter it back
2470.         new_field2 = SlugField(unique=True)
2471.         new_field2.set_attributes_from_name("slug")
2472.         with connection.schema_editor() as editor:
2473.             editor.alter_index_together(Tag, [("slug", "title")], [])
2474.         # Ensure there's no index
2475.         self.assertIs(
2476.             any(
2477.                 c["index"]
2478.                 for c in self.get_constraints("schema_tag").values()
2479.                 if c['columns'] == ["slug", "title"]
2480.             ),
2481.             False,
2482.         )
2483. 
2484.     def test_index_together_with_fk(self):
2485.         """
2486.         Tests removing and adding index_together constraints that include
2487.         a foreign key.
2488.         """
2489.         # Create the table
2490.         with connection.schema_editor() as editor:
2491.             editor.create_model(Author)
2492.             editor.create_model(Book)
2493.         # Ensure the fields are unique to begin with
2494.         self.assertEqual(Book._meta.index_together, ())
2495.         # Add the unique_together constraint
2496.         with connection.schema_editor() as editor:
2497.             editor.alter_index_together(Book, [], [['author', 'title']])
2498.         # Alter it back
2499.         with connection.schema_editor() as editor:
2500.             editor.alter_index_together(Book, [['author', 'title']], [])
2501. 
2502.     def test_create_index_together(self):
2503.         """
2504.         Tests creating models with index_together already defined
2505.         """
2506.         # Create the table
2507.         with connection.schema_editor() as editor:
2508.             editor.create_model(TagIndexed)
2509.         # Ensure there is an index
2510.         self.assertIs(
2511.             any(
2512.                 c["index"]
2513.                 for c in self.get_constraints("schema_tagindexed").values()
2514.                 if c['columns'] == ["slug", "title"]
2515.             ),
2516.             True,
2517.         )
2518. 
2519.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2520.     def test_remove_index_together_does_not_remove_meta_indexes(self):
2521.         with connection.schema_editor() as editor:
2522.             editor.create_model(AuthorWithIndexedNameAndBirthday)
2523.         # Add the custom index
2524.         index = Index(fields=['name', 'birthday'], name='author_name_birthday_idx')
2525.         custom_index_name = index.name
2526.         AuthorWithIndexedNameAndBirthday._meta.indexes = [index]
2527.         with connection.schema_editor() as editor:
2528.             editor.add_index(AuthorWithIndexedNameAndBirthday, index)
2529.         # Ensure the indexes exist
2530.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2531.         self.assertIn(custom_index_name, constraints)
2532.         other_constraints = [
2533.             name for name, details in constraints.items()
2534.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2535.         ]
2536.         self.assertEqual(len(other_constraints), 1)
2537.         # Remove index together
2538.         index_together = AuthorWithIndexedNameAndBirthday._meta.index_together
2539.         with connection.schema_editor() as editor:
2540.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, index_together, [])
2541.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2542.         self.assertIn(custom_index_name, constraints)
2543.         other_constraints = [
2544.             name for name, details in constraints.items()
2545.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2546.         ]
2547.         self.assertEqual(len(other_constraints), 0)
2548.         # Re-add index together
2549.         with connection.schema_editor() as editor:
2550.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, [], index_together)
2551.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2552.         self.assertIn(custom_index_name, constraints)
2553.         other_constraints = [
2554.             name for name, details in constraints.items()
2555.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2556.         ]
2557.         self.assertEqual(len(other_constraints), 1)
2558.         # Drop the index
2559.         with connection.schema_editor() as editor:
2560.             AuthorWithIndexedNameAndBirthday._meta.indexes = []
2561.             editor.remove_index(AuthorWithIndexedNameAndBirthday, index)
2562. 
2563.     @isolate_apps('schema')
2564.     def test_db_table(self):
2565.         """
2566.         Tests renaming of the table
2567.         """
2568.         class Author(Model):
2569.             name = CharField(max_length=255)
2570. 
2571.             class Meta:
2572.                 app_label = 'schema'
2573. 
2574.         class Book(Model):
2575.             author = ForeignKey(Author, CASCADE)
2576. 
2577.             class Meta:
2578.                 app_label = 'schema'
2579. 
2580.         # Create the table and one referring it.
2581.         with connection.schema_editor() as editor:
2582.             editor.create_model(Author)
2583.             editor.create_model(Book)
2584.         # Ensure the table is there to begin with
2585.         columns = self.column_classes(Author)
2586.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
2587.         # Alter the table
2588.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2589.             editor.alter_db_table(Author, "schema_author", "schema_otherauthor")
2590.         # Ensure the table is there afterwards
2591.         Author._meta.db_table = "schema_otherauthor"
2592.         columns = self.column_classes(Author)
2593.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
2594.         # Ensure the foreign key reference was updated
2595.         self.assertForeignKeyExists(Book, "author_id", "schema_otherauthor")
2596.         # Alter the table again
2597.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2598.             editor.alter_db_table(Author, "schema_otherauthor", "schema_author")
2599.         # Ensure the table is still there
2600.         Author._meta.db_table = "schema_author"
2601.         columns = self.column_classes(Author)
2602.         self.assertEqual(columns['name'][0], connection.features.introspected_field_types['CharField'])
2603. 
2604.     def test_add_remove_index(self):
2605.         """
2606.         Tests index addition and removal
2607.         """
2608.         # Create the table
2609.         with connection.schema_editor() as editor:
2610.             editor.create_model(Author)
2611.         # Ensure the table is there and has no index
2612.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2613.         # Add the index
2614.         index = Index(fields=['name'], name='author_title_idx')
2615.         with connection.schema_editor() as editor:
2616.             editor.add_index(Author, index)
2617.         self.assertIn('name', self.get_indexes(Author._meta.db_table))
2618.         # Drop the index
2619.         with connection.schema_editor() as editor:
2620.             editor.remove_index(Author, index)
2621.         self.assertNotIn('name', self.get_indexes(Author._meta.db_table))
2622. 
2623.     def test_remove_db_index_doesnt_remove_custom_indexes(self):
2624.         """
2625.         Changing db_index to False doesn't remove indexes from Meta.indexes.
2626.         """
2627.         with connection.schema_editor() as editor:
2628.             editor.create_model(AuthorWithIndexedName)
2629.         # Ensure the table has its index
2630.         self.assertIn('name', self.get_indexes(AuthorWithIndexedName._meta.db_table))
2631. 
2632.         # Add the custom index
2633.         index = Index(fields=['-name'], name='author_name_idx')
2634.         author_index_name = index.name
2635.         with connection.schema_editor() as editor:
2636.             db_index_name = editor._create_index_name(
2637.                 table_name=AuthorWithIndexedName._meta.db_table,
2638.                 column_names=('name',),
2639.             )
2640.         try:
2641.             AuthorWithIndexedName._meta.indexes = [index]
2642.             with connection.schema_editor() as editor:
2643.                 editor.add_index(AuthorWithIndexedName, index)
2644.             old_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2645.             self.assertIn(author_index_name, old_constraints)
2646.             self.assertIn(db_index_name, old_constraints)
2647.             # Change name field to db_index=False
2648.             old_field = AuthorWithIndexedName._meta.get_field('name')
2649.             new_field = CharField(max_length=255)
2650.             new_field.set_attributes_from_name('name')
2651.             with connection.schema_editor() as editor:
2652.                 editor.alter_field(AuthorWithIndexedName, old_field, new_field, strict=True)
2653.             new_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2654.             self.assertNotIn(db_index_name, new_constraints)
2655.             # The index from Meta.indexes is still in the database.
2656.             self.assertIn(author_index_name, new_constraints)
2657.             # Drop the index
2658.             with connection.schema_editor() as editor:
2659.                 editor.remove_index(AuthorWithIndexedName, index)
2660.         finally:
2661.             AuthorWithIndexedName._meta.indexes = []
2662. 
2663.     def test_order_index(self):
2664.         """
2665.         Indexes defined with ordering (ASC/DESC) defined on column
2666.         """
2667.         with connection.schema_editor() as editor:
2668.             editor.create_model(Author)
2669.         # The table doesn't have an index
2670.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2671.         index_name = 'author_name_idx'
2672.         # Add the index
2673.         index = Index(fields=['name', '-weight'], name=index_name)
2674.         with connection.schema_editor() as editor:
2675.             editor.add_index(Author, index)
2676.         if connection.features.supports_index_column_ordering:
2677.             self.assertIndexOrder(Author._meta.db_table, index_name, ['ASC', 'DESC'])
2678.         # Drop the index
2679.         with connection.schema_editor() as editor:
2680.             editor.remove_index(Author, index)
2681. 
2682.     def test_indexes(self):
2683.         """
2684.         Tests creation/altering of indexes
2685.         """
2686.         # Create the table
2687.         with connection.schema_editor() as editor:
2688.             editor.create_model(Author)
2689.             editor.create_model(Book)
2690.         # Ensure the table is there and has the right index
2691.         self.assertIn(
2692.             "title",
2693.             self.get_indexes(Book._meta.db_table),
2694.         )
2695.         # Alter to remove the index
2696.         old_field = Book._meta.get_field("title")
2697.         new_field = CharField(max_length=100, db_index=False)
2698.         new_field.set_attributes_from_name("title")
2699.         with connection.schema_editor() as editor:
2700.             editor.alter_field(Book, old_field, new_field, strict=True)
2701.         # Ensure the table is there and has no index
2702.         self.assertNotIn(
2703.             "title",
2704.             self.get_indexes(Book._meta.db_table),
2705.         )
2706.         # Alter to re-add the index
2707.         new_field2 = Book._meta.get_field("title")
2708.         with connection.schema_editor() as editor:
2709.             editor.alter_field(Book, new_field, new_field2, strict=True)
2710.         # Ensure the table is there and has the index again
2711.         self.assertIn(
2712.             "title",
2713.             self.get_indexes(Book._meta.db_table),
2714.         )
2715.         # Add a unique column, verify that creates an implicit index
2716.         new_field3 = BookWithSlug._meta.get_field("slug")
2717.         with connection.schema_editor() as editor:
2718.             editor.add_field(Book, new_field3)
2719.         self.assertIn(
2720.             "slug",
2721.             self.get_uniques(Book._meta.db_table),
2722.         )
2723.         # Remove the unique, check the index goes with it
2724.         new_field4 = CharField(max_length=20, unique=False)
2725.         new_field4.set_attributes_from_name("slug")
2726.         with connection.schema_editor() as editor:
2727.             editor.alter_field(BookWithSlug, new_field3, new_field4, strict=True)
2728.         self.assertNotIn(
2729.             "slug",
2730.             self.get_uniques(Book._meta.db_table),
2731.         )
2732. 
2733.     def test_text_field_with_db_index(self):
2734.         with connection.schema_editor() as editor:
2735.             editor.create_model(AuthorTextFieldWithIndex)
2736.         # The text_field index is present if the database supports it.
2737.         assertion = self.assertIn if connection.features.supports_index_on_text_field else self.assertNotIn
2738.         assertion('text_field', self.get_indexes(AuthorTextFieldWithIndex._meta.db_table))
2739. 
2740.     def _index_expressions_wrappers(self):
2741.         index_expression = IndexExpression()
2742.         index_expression.set_wrapper_classes(connection)
2743.         return ', '.join([
2744.             wrapper_cls.__qualname__ for wrapper_cls in index_expression.wrapper_classes
2745.         ])
2746. 
2747.     @skipUnlessDBFeature('supports_expression_indexes')
2748.     def test_func_index_multiple_wrapper_references(self):
2749.         index = Index(OrderBy(F('name').desc(), descending=True), name='name')
2750.         msg = (
2751.             "Multiple references to %s can't be used in an indexed expression."
2752.             % self._index_expressions_wrappers()
2753.         )
2754.         with connection.schema_editor() as editor:
2755.             with self.assertRaisesMessage(ValueError, msg):
2756.                 editor.add_index(Author, index)
2757. 
2758.     @skipUnlessDBFeature('supports_expression_indexes')
2759.     def test_func_index_invalid_topmost_expressions(self):
2760.         index = Index(Upper(F('name').desc()), name='name')
2761.         msg = (
2762.             '%s must be topmost expressions in an indexed expression.'
2763.             % self._index_expressions_wrappers()
2764.         )
2765.         with connection.schema_editor() as editor:
2766.             with self.assertRaisesMessage(ValueError, msg):
2767.                 editor.add_index(Author, index)
2768. 
2769.     @skipUnlessDBFeature('supports_expression_indexes')
2770.     def test_func_index(self):
2771.         with connection.schema_editor() as editor:
2772.             editor.create_model(Author)
2773.         index = Index(Lower('name').desc(), name='func_lower_idx')
2774.         # Add index.
2775.         with connection.schema_editor() as editor:
2776.             editor.add_index(Author, index)
2777.             sql = index.create_sql(Author, editor)
2778.         table = Author._meta.db_table
2779.         if connection.features.supports_index_column_ordering:
2780.             self.assertIndexOrder(table, index.name, ['DESC'])
2781.         # SQL contains a database function.
2782.         self.assertIs(sql.references_column(table, 'name'), True)
2783.         self.assertIn('LOWER(%s)' % editor.quote_name('name'), str(sql))
2784.         # Remove index.
2785.         with connection.schema_editor() as editor:
2786.             editor.remove_index(Author, index)
2787.         self.assertNotIn(index.name, self.get_constraints(table))
2788. 
2789.     @skipUnlessDBFeature('supports_expression_indexes')
2790.     def test_func_index_f(self):
2791.         with connection.schema_editor() as editor:
2792.             editor.create_model(Tag)
2793.         index = Index('slug', F('title').desc(), name='func_f_idx')
2794.         # Add index.
2795.         with connection.schema_editor() as editor:
2796.             editor.add_index(Tag, index)
2797.             sql = index.create_sql(Tag, editor)
2798.         table = Tag._meta.db_table
2799.         self.assertIn(index.name, self.get_constraints(table))
2800.         if connection.features.supports_index_column_ordering:
2801.             self.assertIndexOrder(Tag._meta.db_table, index.name, ['ASC', 'DESC'])
2802.         # SQL contains columns.
2803.         self.assertIs(sql.references_column(table, 'slug'), True)
2804.         self.assertIs(sql.references_column(table, 'title'), True)
2805.         # Remove index.
2806.         with connection.schema_editor() as editor:
2807.             editor.remove_index(Tag, index)
2808.         self.assertNotIn(index.name, self.get_constraints(table))
2809. 
2810.     @skipUnlessDBFeature('supports_expression_indexes')
2811.     def test_func_index_lookups(self):
2812.         with connection.schema_editor() as editor:
2813.             editor.create_model(Author)
2814.         with register_lookup(CharField, Lower), register_lookup(IntegerField, Abs):
2815.             index = Index(
2816.                 F('name__lower'),
2817.                 F('weight__abs'),
2818.                 name='func_lower_abs_lookup_idx',
2819.             )
2820.             # Add index.
2821.             with connection.schema_editor() as editor:
2822.                 editor.add_index(Author, index)
2823.                 sql = index.create_sql(Author, editor)
2824.         table = Author._meta.db_table
2825.         self.assertIn(index.name, self.get_constraints(table))
2826.         # SQL contains columns.
2827.         self.assertIs(sql.references_column(table, 'name'), True)
2828.         self.assertIs(sql.references_column(table, 'weight'), True)
2829.         # Remove index.
2830.         with connection.schema_editor() as editor:
2831.             editor.remove_index(Author, index)
2832.         self.assertNotIn(index.name, self.get_constraints(table))
2833. 
2834.     @skipUnlessDBFeature('supports_expression_indexes')
2835.     def test_composite_func_index(self):
2836.         with connection.schema_editor() as editor:
2837.             editor.create_model(Author)
2838.         index = Index(Lower('name'), Upper('name'), name='func_lower_upper_idx')
2839.         # Add index.
2840.         with connection.schema_editor() as editor:
2841.             editor.add_index(Author, index)
2842.             sql = index.create_sql(Author, editor)
2843.         table = Author._meta.db_table
2844.         self.assertIn(index.name, self.get_constraints(table))
2845.         # SQL contains database functions.
2846.         self.assertIs(sql.references_column(table, 'name'), True)
2847.         sql = str(sql)
2848.         self.assertIn('LOWER(%s)' % editor.quote_name('name'), sql)
2849.         self.assertIn('UPPER(%s)' % editor.quote_name('name'), sql)
2850.         self.assertLess(sql.index('LOWER'), sql.index('UPPER'))
2851.         # Remove index.
2852.         with connection.schema_editor() as editor:
2853.             editor.remove_index(Author, index)
2854.         self.assertNotIn(index.name, self.get_constraints(table))
2855. 
2856.     @skipUnlessDBFeature('supports_expression_indexes')
2857.     def test_composite_func_index_field_and_expression(self):
2858.         with connection.schema_editor() as editor:
2859.             editor.create_model(Author)
2860.             editor.create_model(Book)
2861.         index = Index(
2862.             F('author').desc(),
2863.             Lower('title').asc(),
2864.             'pub_date',
2865.             name='func_f_lower_field_idx',
2866.         )
2867.         # Add index.
2868.         with connection.schema_editor() as editor:
2869.             editor.add_index(Book, index)
2870.             sql = index.create_sql(Book, editor)
2871.         table = Book._meta.db_table
2872.         constraints = self.get_constraints(table)
2873.         if connection.features.supports_index_column_ordering:
2874.             self.assertIndexOrder(table, index.name, ['DESC', 'ASC', 'ASC'])
2875.         self.assertEqual(len(constraints[index.name]['columns']), 3)
2876.         self.assertEqual(constraints[index.name]['columns'][2], 'pub_date')
2877.         # SQL contains database functions and columns.
2878.         self.assertIs(sql.references_column(table, 'author_id'), True)
2879.         self.assertIs(sql.references_column(table, 'title'), True)
2880.         self.assertIs(sql.references_column(table, 'pub_date'), True)
2881.         self.assertIn('LOWER(%s)' % editor.quote_name('title'), str(sql))
2882.         # Remove index.
2883.         with connection.schema_editor() as editor:
2884.             editor.remove_index(Book, index)
2885.         self.assertNotIn(index.name, self.get_constraints(table))
2886. 
2887.     @skipUnlessDBFeature('supports_expression_indexes')
2888.     @isolate_apps('schema')
2889.     def test_func_index_f_decimalfield(self):
2890.         class Node(Model):
2891.             value = DecimalField(max_digits=5, decimal_places=2)
2892. 
2893.             class Meta:
2894.                 app_label = 'schema'
2895. 
2896.         with connection.schema_editor() as editor:
2897.             editor.create_model(Node)
2898.         index = Index(F('value'), name='func_f_decimalfield_idx')
2899.         # Add index.
2900.         with connection.schema_editor() as editor:
2901.             editor.add_index(Node, index)
2902.             sql = index.create_sql(Node, editor)
2903.         table = Node._meta.db_table
2904.         self.assertIn(index.name, self.get_constraints(table))
2905.         self.assertIs(sql.references_column(table, 'value'), True)
2906.         # SQL doesn't contain casting.
2907.         self.assertNotIn('CAST', str(sql))
2908.         # Remove index.
2909.         with connection.schema_editor() as editor:
2910.             editor.remove_index(Node, index)
2911.         self.assertNotIn(index.name, self.get_constraints(table))
2912. 
2913.     @skipUnlessDBFeature('supports_expression_indexes')
2914.     def test_func_index_cast(self):
2915.         with connection.schema_editor() as editor:
2916.             editor.create_model(Author)
2917.         index = Index(Cast('weight', FloatField()), name='func_cast_idx')
2918.         # Add index.
2919.         with connection.schema_editor() as editor:
2920.             editor.add_index(Author, index)
2921.             sql = index.create_sql(Author, editor)
2922.         table = Author._meta.db_table
2923.         self.assertIn(index.name, self.get_constraints(table))
2924.         self.assertIs(sql.references_column(table, 'weight'), True)
2925.         # Remove index.
2926.         with connection.schema_editor() as editor:
2927.             editor.remove_index(Author, index)
2928.         self.assertNotIn(index.name, self.get_constraints(table))
2929. 
2930.     @skipUnlessDBFeature('supports_expression_indexes')
2931.     def test_func_index_collate(self):
2932.         collation = connection.features.test_collations.get('non_default')
2933.         if not collation:
2934.             self.skipTest(
2935.                 'This backend does not support case-insensitive collations.'
2936.             )
2937.         with connection.schema_editor() as editor:
2938.             editor.create_model(Author)
2939.             editor.create_model(BookWithSlug)
2940.         index = Index(
2941.             Collate(F('title'), collation=collation).desc(),
2942.             Collate('slug', collation=collation),
2943.             name='func_collate_idx',
2944.         )
2945.         # Add index.
2946.         with connection.schema_editor() as editor:
2947.             editor.add_index(BookWithSlug, index)
2948.             sql = index.create_sql(BookWithSlug, editor)
2949.         table = Book._meta.db_table
2950.         self.assertIn(index.name, self.get_constraints(table))
2951.         if connection.features.supports_index_column_ordering:
2952.             self.assertIndexOrder(table, index.name, ['DESC', 'ASC'])
2953.         # SQL contains columns and a collation.
2954.         self.assertIs(sql.references_column(table, 'title'), True)
2955.         self.assertIs(sql.references_column(table, 'slug'), True)
2956.         self.assertIn('COLLATE %s' % editor.quote_name(collation), str(sql))
2957.         # Remove index.
2958.         with connection.schema_editor() as editor:
2959.             editor.remove_index(Book, index)
2960.         self.assertNotIn(index.name, self.get_constraints(table))
2961. 
2962.     @skipUnlessDBFeature('supports_expression_indexes')
2963.     @skipIfDBFeature('collate_as_index_expression')
2964.     def test_func_index_collate_f_ordered(self):
2965.         collation = connection.features.test_collations.get('non_default')
2966.         if not collation:
2967.             self.skipTest(
2968.                 'This backend does not support case-insensitive collations.'
2969.             )
2970.         with connection.schema_editor() as editor:
2971.             editor.create_model(Author)
2972.         index = Index(
2973.             Collate(F('name').desc(), collation=collation),
2974.             name='func_collate_f_desc_idx',
2975.         )
2976.         # Add index.
2977.         with connection.schema_editor() as editor:
2978.             editor.add_index(Author, index)
2979.             sql = index.create_sql(Author, editor)
2980.         table = Author._meta.db_table
2981.         self.assertIn(index.name, self.get_constraints(table))
2982.         if connection.features.supports_index_column_ordering:
2983.             self.assertIndexOrder(table, index.name, ['DESC'])
2984.         # SQL contains columns and a collation.
2985.         self.assertIs(sql.references_column(table, 'name'), True)
2986.         self.assertIn('COLLATE %s' % editor.quote_name(collation), str(sql))
2987.         # Remove index.
2988.         with connection.schema_editor() as editor:
2989.             editor.remove_index(Author, index)
2990.         self.assertNotIn(index.name, self.get_constraints(table))
2991. 
2992.     @skipUnlessDBFeature('supports_expression_indexes')
2993.     def test_func_index_calc(self):
2994.         with connection.schema_editor() as editor:
2995.             editor.create_model(Author)
2996.         index = Index(F('height') / (F('weight') + Value(5)), name='func_calc_idx')
2997.         # Add index.
2998.         with connection.schema_editor() as editor:
2999.             editor.add_index(Author, index)
3000.             sql = index.create_sql(Author, editor)
3001.         table = Author._meta.db_table
3002.         self.assertIn(index.name, self.get_constraints(table))
3003.         # SQL contains columns and expressions.
3004.         self.assertIs(sql.references_column(table, 'height'), True)
3005.         self.assertIs(sql.references_column(table, 'weight'), True)
3006.         sql = str(sql)
3007.         self.assertIs(
3008.             sql.index(editor.quote_name('height')) <
3009.             sql.index('/') <
3010.             sql.index(editor.quote_name('weight')) <
3011.             sql.index('+') <
3012.             sql.index('5'),
3013.             True,
3014.         )
3015.         # Remove index.
3016.         with connection.schema_editor() as editor:
3017.             editor.remove_index(Author, index)
3018.         self.assertNotIn(index.name, self.get_constraints(table))
3019. 
3020.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_json_field')
3021.     @isolate_apps('schema')
3022.     def test_func_index_json_key_transform(self):
3023.         class JSONModel(Model):
3024.             field = JSONField()
3025. 
3026.             class Meta:
3027.                 app_label = 'schema'
3028. 
3029.         with connection.schema_editor() as editor:
3030.             editor.create_model(JSONModel)
3031.         self.isolated_local_models = [JSONModel]
3032.         index = Index('field__some_key', name='func_json_key_idx')
3033.         with connection.schema_editor() as editor:
3034.             editor.add_index(JSONModel, index)
3035.             sql = index.create_sql(JSONModel, editor)
3036.         table = JSONModel._meta.db_table
3037.         self.assertIn(index.name, self.get_constraints(table))
3038.         self.assertIs(sql.references_column(table, 'field'), True)
3039.         with connection.schema_editor() as editor:
3040.             editor.remove_index(JSONModel, index)
3041.         self.assertNotIn(index.name, self.get_constraints(table))
3042. 
3043.     @skipUnlessDBFeature('supports_expression_indexes', 'supports_json_field')
3044.     @isolate_apps('schema')
3045.     def test_func_index_json_key_transform_cast(self):
3046.         class JSONModel(Model):
3047.             field = JSONField()
3048. 
3049.             class Meta:
3050.                 app_label = 'schema'
3051. 
3052.         with connection.schema_editor() as editor:
3053.             editor.create_model(JSONModel)
3054.         self.isolated_local_models = [JSONModel]
3055.         index = Index(
3056.             Cast(KeyTextTransform('some_key', 'field'), IntegerField()),
3057.             name='func_json_key_cast_idx',
3058.         )
3059.         with connection.schema_editor() as editor:
3060.             editor.add_index(JSONModel, index)
3061.             sql = index.create_sql(JSONModel, editor)
3062.         table = JSONModel._meta.db_table
3063.         self.assertIn(index.name, self.get_constraints(table))
3064.         self.assertIs(sql.references_column(table, 'field'), True)
3065.         with connection.schema_editor() as editor:
3066.             editor.remove_index(JSONModel, index)
3067.         self.assertNotIn(index.name, self.get_constraints(table))
3068. 
3069.     @skipIfDBFeature('supports_expression_indexes')
3070.     def test_func_index_unsupported(self):
3071.         # Index is ignored on databases that don't support indexes on
3072.         # expressions.
3073.         with connection.schema_editor() as editor:
3074.             editor.create_model(Author)
3075.         index = Index(F('name'), name='random_idx')
3076.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3077.             self.assertIsNone(editor.add_index(Author, index))
3078.             self.assertIsNone(editor.remove_index(Author, index))
3079. 
3080.     @skipUnlessDBFeature('supports_expression_indexes')
3081.     def test_func_index_nonexistent_field(self):
3082.         index = Index(Lower('nonexistent'), name='func_nonexistent_idx')
3083.         msg = (
3084.             "Cannot resolve keyword 'nonexistent' into field. Choices are: "
3085.             "height, id, name, uuid, weight"
3086.         )
3087.         with self.assertRaisesMessage(FieldError, msg):
3088.             with connection.schema_editor() as editor:
3089.                 editor.add_index(Author, index)
3090. 
3091.     @skipUnlessDBFeature('supports_expression_indexes')
3092.     def test_func_index_nondeterministic(self):
3093.         with connection.schema_editor() as editor:
3094.             editor.create_model(Author)
3095.         index = Index(Random(), name='func_random_idx')
3096.         with connection.schema_editor() as editor:
3097.             with self.assertRaises(DatabaseError):
3098.                 editor.add_index(Author, index)
3099. 
3100.     def test_primary_key(self):
3101.         """
3102.         Tests altering of the primary key
3103.         """
3104.         # Create the table
3105.         with connection.schema_editor() as editor:
3106.             editor.create_model(Tag)
3107.         # Ensure the table is there and has the right PK
3108.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'id')
3109.         # Alter to change the PK
3110.         id_field = Tag._meta.get_field("id")
3111.         old_field = Tag._meta.get_field("slug")
3112.         new_field = SlugField(primary_key=True)
3113.         new_field.set_attributes_from_name("slug")
3114.         new_field.model = Tag
3115.         with connection.schema_editor() as editor:
3116.             editor.remove_field(Tag, id_field)
3117.             editor.alter_field(Tag, old_field, new_field)
3118.         # Ensure the PK changed
3119.         self.assertNotIn(
3120.             'id',
3121.             self.get_indexes(Tag._meta.db_table),
3122.         )
3123.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'slug')
3124. 
3125.     def test_context_manager_exit(self):
3126.         """
3127.         Ensures transaction is correctly closed when an error occurs
3128.         inside a SchemaEditor context.
3129.         """
3130.         class SomeError(Exception):
3131.             pass
3132.         try:
3133.             with connection.schema_editor():
3134.                 raise SomeError
3135.         except SomeError:
3136.             self.assertFalse(connection.in_atomic_block)
3137. 
3138.     @skipIfDBFeature('can_rollback_ddl')
3139.     def test_unsupported_transactional_ddl_disallowed(self):
3140.         message = (
3141.             "Executing DDL statements while in a transaction on databases "
3142.             "that can't perform a rollback is prohibited."
3143.         )
3144.         with atomic(), connection.schema_editor() as editor:
3145.             with self.assertRaisesMessage(TransactionManagementError, message):
3146.                 editor.execute(editor.sql_create_table % {'table': 'foo', 'definition': ''})
3147. 
3148.     @skipUnlessDBFeature('supports_foreign_keys', 'indexes_foreign_keys')
3149.     def test_foreign_key_index_long_names_regression(self):
3150.         """
3151.         Regression test for #21497.
3152.         Only affects databases that supports foreign keys.
3153.         """
3154.         # Create the table
3155.         with connection.schema_editor() as editor:
3156.             editor.create_model(AuthorWithEvenLongerName)
3157.             editor.create_model(BookWithLongName)
3158.         # Find the properly shortened column name
3159.         column_name = connection.ops.quote_name("author_foreign_key_with_really_long_field_name_id")
3160.         column_name = column_name[1:-1].lower()  # unquote, and, for Oracle, un-upcase
3161.         # Ensure the table is there and has an index on the column
3162.         self.assertIn(
3163.             column_name,
3164.             self.get_indexes(BookWithLongName._meta.db_table),
3165.         )
3166. 
3167.     @skipUnlessDBFeature('supports_foreign_keys')
3168.     def test_add_foreign_key_long_names(self):
3169.         """
3170.         Regression test for #23009.
3171.         Only affects databases that supports foreign keys.
3172.         """
3173.         # Create the initial tables
3174.         with connection.schema_editor() as editor:
3175.             editor.create_model(AuthorWithEvenLongerName)
3176.             editor.create_model(BookWithLongName)
3177.         # Add a second FK, this would fail due to long ref name before the fix
3178.         new_field = ForeignKey(AuthorWithEvenLongerName, CASCADE, related_name="something")
3179.         new_field.set_attributes_from_name("author_other_really_long_named_i_mean_so_long_fk")
3180.         with connection.schema_editor() as editor:
3181.             editor.add_field(BookWithLongName, new_field)
3182. 
3183.     @isolate_apps('schema')
3184.     @skipUnlessDBFeature('supports_foreign_keys')
3185.     def test_add_foreign_key_quoted_db_table(self):
3186.         class Author(Model):
3187.             class Meta:
3188.                 db_table = '"table_author_double_quoted"'
3189.                 app_label = 'schema'
3190. 
3191.         class Book(Model):
3192.             author = ForeignKey(Author, CASCADE)
3193. 
3194.             class Meta:
3195.                 app_label = 'schema'
3196. 
3197.         with connection.schema_editor() as editor:
3198.             editor.create_model(Author)
3199.             editor.create_model(Book)
3200.         if connection.vendor == 'mysql':
3201.             self.assertForeignKeyExists(Book, 'author_id', '"table_author_double_quoted"')
3202.         else:
3203.             self.assertForeignKeyExists(Book, 'author_id', 'table_author_double_quoted')
3204. 
3205.     def test_add_foreign_object(self):
3206.         with connection.schema_editor() as editor:
3207.             editor.create_model(BookForeignObj)
3208. 
3209.         new_field = ForeignObject(Author, on_delete=CASCADE, from_fields=['author_id'], to_fields=['id'])
3210.         new_field.set_attributes_from_name('author')
3211.         with connection.schema_editor() as editor:
3212.             editor.add_field(BookForeignObj, new_field)
3213. 
3214.     def test_creation_deletion_reserved_names(self):
3215.         """
3216.         Tries creating a model's table, and then deleting it when it has a
3217.         SQL reserved name.
3218.         """
3219.         # Create the table
3220.         with connection.schema_editor() as editor:
3221.             try:
3222.                 editor.create_model(Thing)
3223.             except OperationalError as e:
3224.                 self.fail("Errors when applying initial migration for a model "
3225.                           "with a table named after an SQL reserved word: %s" % e)
3226.         # The table is there
3227.         list(Thing.objects.all())
3228.         # Clean up that table
3229.         with connection.schema_editor() as editor:
3230.             editor.delete_model(Thing)
3231.         # The table is gone
3232.         with self.assertRaises(DatabaseError):
3233.             list(Thing.objects.all())
3234. 
3235.     def test_remove_constraints_capital_letters(self):
3236.         """
3237.         #23065 - Constraint names must be quoted if they contain capital letters.
3238.         """
3239.         def get_field(*args, field_class=IntegerField, **kwargs):
3240.             kwargs['db_column'] = "CamelCase"
3241.             field = field_class(*args, **kwargs)
3242.             field.set_attributes_from_name("CamelCase")
3243.             return field
3244. 
3245.         model = Author
3246.         field = get_field()
3247.         table = model._meta.db_table
3248.         column = field.column
3249.         identifier_converter = connection.introspection.identifier_converter
3250. 
3251.         with connection.schema_editor() as editor:
3252.             editor.create_model(model)
3253.             editor.add_field(model, field)
3254. 
3255.             constraint_name = 'CamelCaseIndex'
3256.             expected_constraint_name = identifier_converter(constraint_name)
3257.             editor.execute(
3258.                 editor.sql_create_index % {
3259.                     "table": editor.quote_name(table),
3260.                     "name": editor.quote_name(constraint_name),
3261.                     "using": "",
3262.                     "columns": editor.quote_name(column),
3263.                     "extra": "",
3264.                     "condition": "",
3265.                     "include": "",
3266.                 }
3267.             )
3268.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3269.             editor.alter_field(model, get_field(db_index=True), field, strict=True)
3270.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3271. 
3272.             constraint_name = 'CamelCaseUniqConstraint'
3273.             expected_constraint_name = identifier_converter(constraint_name)
3274.             editor.execute(editor._create_unique_sql(model, [field.column], constraint_name))
3275.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3276.             editor.alter_field(model, get_field(unique=True), field, strict=True)
3277.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3278. 
3279.             if editor.sql_create_fk:
3280.                 constraint_name = 'CamelCaseFKConstraint'
3281.                 expected_constraint_name = identifier_converter(constraint_name)
3282.                 editor.execute(
3283.                     editor.sql_create_fk % {
3284.                         "table": editor.quote_name(table),
3285.                         "name": editor.quote_name(constraint_name),
3286.                         "column": editor.quote_name(column),
3287.                         "to_table": editor.quote_name(table),
3288.                         "to_column": editor.quote_name(model._meta.auto_field.column),
3289.                         "deferrable": connection.ops.deferrable_sql(),
3290.                     }
3291.                 )
3292.                 self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3293.                 editor.alter_field(model, get_field(Author, CASCADE, field_class=ForeignKey), field, strict=True)
3294.                 self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
3295. 
3296.     def test_add_field_use_effective_default(self):
3297.         """
3298.         #23987 - effective_default() should be used as the field default when
3299.         adding a new field.
3300.         """
3301.         # Create the table
3302.         with connection.schema_editor() as editor:
3303.             editor.create_model(Author)
3304.         # Ensure there's no surname field
3305.         columns = self.column_classes(Author)
3306.         self.assertNotIn("surname", columns)
3307.         # Create a row
3308.         Author.objects.create(name='Anonymous1')
3309.         # Add new CharField to ensure default will be used from effective_default
3310.         new_field = CharField(max_length=15, blank=True)
3311.         new_field.set_attributes_from_name("surname")
3312.         with connection.schema_editor() as editor:
3313.             editor.add_field(Author, new_field)
3314.         # Ensure field was added with the right default
3315.         with connection.cursor() as cursor:
3316.             cursor.execute("SELECT surname FROM schema_author;")
3317.             item = cursor.fetchall()[0]
3318.             self.assertEqual(item[0], None if connection.features.interprets_empty_strings_as_nulls else '')
3319. 
3320.     def test_add_field_default_dropped(self):
3321.         # Create the table
3322.         with connection.schema_editor() as editor:
3323.             editor.create_model(Author)
3324.         # Ensure there's no surname field
3325.         columns = self.column_classes(Author)
3326.         self.assertNotIn("surname", columns)
3327.         # Create a row
3328.         Author.objects.create(name='Anonymous1')
3329.         # Add new CharField with a default
3330.         new_field = CharField(max_length=15, blank=True, default='surname default')
3331.         new_field.set_attributes_from_name("surname")
3332.         with connection.schema_editor() as editor:
3333.             editor.add_field(Author, new_field)
3334.         # Ensure field was added with the right default
3335.         with connection.cursor() as cursor:
3336.             cursor.execute("SELECT surname FROM schema_author;")
3337.             item = cursor.fetchall()[0]
3338.             self.assertEqual(item[0], 'surname default')
3339.             # And that the default is no longer set in the database.
3340.             field = next(
3341.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
3342.                 if f.name == "surname"
3343.             )
3344.             if connection.features.can_introspect_default:
3345.                 self.assertIsNone(field.default)
3346. 
3347.     def test_add_field_default_nullable(self):
3348.         with connection.schema_editor() as editor:
3349.             editor.create_model(Author)
3350.         # Add new nullable CharField with a default.
3351.         new_field = CharField(max_length=15, blank=True, null=True, default='surname')
3352.         new_field.set_attributes_from_name('surname')
3353.         with connection.schema_editor() as editor:
3354.             editor.add_field(Author, new_field)
3355.         Author.objects.create(name='Anonymous1')
3356.         with connection.cursor() as cursor:
3357.             cursor.execute('SELECT surname FROM schema_author;')
3358.             item = cursor.fetchall()[0]
3359.             self.assertIsNone(item[0])
3360.             field = next(
3361.                 f
3362.                 for f in connection.introspection.get_table_description(
3363.                     cursor,
3364.                     'schema_author',
3365.                 )
3366.                 if f.name == 'surname'
3367.             )
3368.             # Field is still nullable.
3369.             self.assertTrue(field.null_ok)
3370.             # The database default is no longer set.
3371.             if connection.features.can_introspect_default:
3372.                 self.assertIn(field.default, ['NULL', None])
3373. 
3374.     def test_alter_field_default_dropped(self):
3375.         # Create the table
3376.         with connection.schema_editor() as editor:
3377.             editor.create_model(Author)
3378.         # Create a row
3379.         Author.objects.create(name='Anonymous1')
3380.         self.assertIsNone(Author.objects.get().height)
3381.         old_field = Author._meta.get_field('height')
3382.         # The default from the new field is used in updating existing rows.
3383.         new_field = IntegerField(blank=True, default=42)
3384.         new_field.set_attributes_from_name('height')
3385.         with connection.schema_editor() as editor:
3386.             editor.alter_field(Author, old_field, new_field, strict=True)
3387.         self.assertEqual(Author.objects.get().height, 42)
3388.         # The database default should be removed.
3389.         with connection.cursor() as cursor:
3390.             field = next(
3391.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
3392.                 if f.name == "height"
3393.             )
3394.             if connection.features.can_introspect_default:
3395.                 self.assertIsNone(field.default)
3396. 
3397.     def test_alter_field_default_doesnt_perform_queries(self):
3398.         """
3399.         No queries are performed if a field default changes and the field's
3400.         not changing from null to non-null.
3401.         """
3402.         with connection.schema_editor() as editor:
3403.             editor.create_model(AuthorWithDefaultHeight)
3404.         old_field = AuthorWithDefaultHeight._meta.get_field('height')
3405.         new_default = old_field.default * 2
3406.         new_field = PositiveIntegerField(null=True, blank=True, default=new_default)
3407.         new_field.set_attributes_from_name('height')
3408.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3409.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
3410. 
3411.     @skipUnlessDBFeature('supports_foreign_keys')
3412.     def test_alter_field_fk_attributes_noop(self):
3413.         """
3414.         No queries are performed when changing field attributes that don't
3415.         affect the schema.
3416.         """
3417.         with connection.schema_editor() as editor:
3418.             editor.create_model(Author)
3419.             editor.create_model(Book)
3420.         old_field = Book._meta.get_field('author')
3421.         new_field = ForeignKey(
3422.             Author,
3423.             blank=True,
3424.             editable=False,
3425.             error_messages={'invalid': 'error message'},
3426.             help_text='help text',
3427.             limit_choices_to={'limit': 'choice'},
3428.             on_delete=PROTECT,
3429.             related_name='related_name',
3430.             related_query_name='related_query_name',
3431.             validators=[lambda x: x],
3432.             verbose_name='verbose name',
3433.         )
3434.         new_field.set_attributes_from_name('author')
3435.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3436.             editor.alter_field(Book, old_field, new_field, strict=True)
3437.         with connection.schema_editor() as editor, self.assertNumQueries(0):
3438.             editor.alter_field(Book, new_field, old_field, strict=True)
3439. 
3440.     def test_add_textfield_unhashable_default(self):
3441.         # Create the table
3442.         with connection.schema_editor() as editor:
3443.             editor.create_model(Author)
3444.         # Create a row
3445.         Author.objects.create(name='Anonymous1')
3446.         # Create a field that has an unhashable default
3447.         new_field = TextField(default={})
3448.         new_field.set_attributes_from_name("info")
3449.         with connection.schema_editor() as editor:
3450.             editor.add_field(Author, new_field)
3451. 
3452.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3453.     def test_add_indexed_charfield(self):
3454.         field = CharField(max_length=255, db_index=True)
3455.         field.set_attributes_from_name('nom_de_plume')
3456.         with connection.schema_editor() as editor:
3457.             editor.create_model(Author)
3458.             editor.add_field(Author, field)
3459.         # Should create two indexes; one for like operator.
3460.         self.assertEqual(
3461.             self.get_constraints_for_column(Author, 'nom_de_plume'),
3462.             ['schema_author_nom_de_plume_7570a851', 'schema_author_nom_de_plume_7570a851_like'],
3463.         )
3464. 
3465.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3466.     def test_add_unique_charfield(self):
3467.         field = CharField(max_length=255, unique=True)
3468.         field.set_attributes_from_name('nom_de_plume')
3469.         with connection.schema_editor() as editor:
3470.             editor.create_model(Author)
3471.             editor.add_field(Author, field)
3472.         # Should create two indexes; one for like operator.
3473.         self.assertEqual(
3474.             self.get_constraints_for_column(Author, 'nom_de_plume'),
3475.             ['schema_author_nom_de_plume_7570a851_like', 'schema_author_nom_de_plume_key']
3476.         )
3477. 
3478.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3479.     def test_alter_field_add_index_to_charfield(self):
3480.         # Create the table and verify no initial indexes.
3481.         with connection.schema_editor() as editor:
3482.             editor.create_model(Author)
3483.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3484.         # Alter to add db_index=True and create 2 indexes.
3485.         old_field = Author._meta.get_field('name')
3486.         new_field = CharField(max_length=255, db_index=True)
3487.         new_field.set_attributes_from_name('name')
3488.         with connection.schema_editor() as editor:
3489.             editor.alter_field(Author, old_field, new_field, strict=True)
3490.         self.assertEqual(
3491.             self.get_constraints_for_column(Author, 'name'),
3492.             ['schema_author_name_1fbc5617', 'schema_author_name_1fbc5617_like']
3493.         )
3494.         # Remove db_index=True to drop both indexes.
3495.         with connection.schema_editor() as editor:
3496.             editor.alter_field(Author, new_field, old_field, strict=True)
3497.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3498. 
3499.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3500.     def test_alter_field_add_unique_to_charfield(self):
3501.         # Create the table and verify no initial indexes.
3502.         with connection.schema_editor() as editor:
3503.             editor.create_model(Author)
3504.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3505.         # Alter to add unique=True and create 2 indexes.
3506.         old_field = Author._meta.get_field('name')
3507.         new_field = CharField(max_length=255, unique=True)
3508.         new_field.set_attributes_from_name('name')
3509.         with connection.schema_editor() as editor:
3510.             editor.alter_field(Author, old_field, new_field, strict=True)
3511.         self.assertEqual(
3512.             self.get_constraints_for_column(Author, 'name'),
3513.             ['schema_author_name_1fbc5617_like', 'schema_author_name_1fbc5617_uniq']
3514.         )
3515.         # Remove unique=True to drop both indexes.
3516.         with connection.schema_editor() as editor:
3517.             editor.alter_field(Author, new_field, old_field, strict=True)
3518.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
3519. 
3520.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3521.     def test_alter_field_add_index_to_textfield(self):
3522.         # Create the table and verify no initial indexes.
3523.         with connection.schema_editor() as editor:
3524.             editor.create_model(Note)
3525.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
3526.         # Alter to add db_index=True and create 2 indexes.
3527.         old_field = Note._meta.get_field('info')
3528.         new_field = TextField(db_index=True)
3529.         new_field.set_attributes_from_name('info')
3530.         with connection.schema_editor() as editor:
3531.             editor.alter_field(Note, old_field, new_field, strict=True)
3532.         self.assertEqual(
3533.             self.get_constraints_for_column(Note, 'info'),
3534.             ['schema_note_info_4b0ea695', 'schema_note_info_4b0ea695_like']
3535.         )
3536.         # Remove db_index=True to drop both indexes.
3537.         with connection.schema_editor() as editor:
3538.             editor.alter_field(Note, new_field, old_field, strict=True)
3539.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
3540. 
3541.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3542.     def test_alter_field_add_unique_to_charfield_with_db_index(self):
3543.         # Create the table and verify initial indexes.
3544.         with connection.schema_editor() as editor:
3545.             editor.create_model(BookWithoutAuthor)
3546.         self.assertEqual(
3547.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3548.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3549.         )
3550.         # Alter to add unique=True (should replace the index)
3551.         old_field = BookWithoutAuthor._meta.get_field('title')
3552.         new_field = CharField(max_length=100, db_index=True, unique=True)
3553.         new_field.set_attributes_from_name('title')
3554.         with connection.schema_editor() as editor:
3555.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
3556.         self.assertEqual(
3557.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3558.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
3559.         )
3560.         # Alter to remove unique=True (should drop unique index)
3561.         new_field2 = CharField(max_length=100, db_index=True)
3562.         new_field2.set_attributes_from_name('title')
3563.         with connection.schema_editor() as editor:
3564.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
3565.         self.assertEqual(
3566.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3567.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3568.         )
3569. 
3570.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3571.     def test_alter_field_remove_unique_and_db_index_from_charfield(self):
3572.         # Create the table and verify initial indexes.
3573.         with connection.schema_editor() as editor:
3574.             editor.create_model(BookWithoutAuthor)
3575.         self.assertEqual(
3576.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3577.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3578.         )
3579.         # Alter to add unique=True (should replace the index)
3580.         old_field = BookWithoutAuthor._meta.get_field('title')
3581.         new_field = CharField(max_length=100, db_index=True, unique=True)
3582.         new_field.set_attributes_from_name('title')
3583.         with connection.schema_editor() as editor:
3584.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
3585.         self.assertEqual(
3586.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3587.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
3588.         )
3589.         # Alter to remove both unique=True and db_index=True (should drop all indexes)
3590.         new_field2 = CharField(max_length=100)
3591.         new_field2.set_attributes_from_name('title')
3592.         with connection.schema_editor() as editor:
3593.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
3594.         self.assertEqual(self.get_constraints_for_column(BookWithoutAuthor, 'title'), [])
3595. 
3596.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3597.     def test_alter_field_swap_unique_and_db_index_with_charfield(self):
3598.         # Create the table and verify initial indexes.
3599.         with connection.schema_editor() as editor:
3600.             editor.create_model(BookWithoutAuthor)
3601.         self.assertEqual(
3602.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3603.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3604.         )
3605.         # Alter to set unique=True and remove db_index=True (should replace the index)
3606.         old_field = BookWithoutAuthor._meta.get_field('title')
3607.         new_field = CharField(max_length=100, unique=True)
3608.         new_field.set_attributes_from_name('title')
3609.         with connection.schema_editor() as editor:
3610.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
3611.         self.assertEqual(
3612.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3613.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
3614.         )
3615.         # Alter to set db_index=True and remove unique=True (should restore index)
3616.         new_field2 = CharField(max_length=100, db_index=True)
3617.         new_field2.set_attributes_from_name('title')
3618.         with connection.schema_editor() as editor:
3619.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
3620.         self.assertEqual(
3621.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
3622.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
3623.         )
3624. 
3625.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
3626.     def test_alter_field_add_db_index_to_charfield_with_unique(self):
3627.         # Create the table and verify initial indexes.
3628.         with connection.schema_editor() as editor:
3629.             editor.create_model(Tag)
3630.         self.assertEqual(
3631.             self.get_constraints_for_column(Tag, 'slug'),
3632.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
3633.         )
3634.         # Alter to add db_index=True
3635.         old_field = Tag._meta.get_field('slug')
3636.         new_field = SlugField(db_index=True, unique=True)
3637.         new_field.set_attributes_from_name('slug')
3638.         with connection.schema_editor() as editor:
3639.             editor.alter_field(Tag, old_field, new_field, strict=True)
3640.         self.assertEqual(
3641.             self.get_constraints_for_column(Tag, 'slug'),
3642.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
3643.         )
3644.         # Alter to remove db_index=True
3645.         new_field2 = SlugField(unique=True)
3646.         new_field2.set_attributes_from_name('slug')
3647.         with connection.schema_editor() as editor:
3648.             editor.alter_field(Tag, new_field, new_field2, strict=True)
3649.         self.assertEqual(
3650.             self.get_constraints_for_column(Tag, 'slug'),
3651.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
3652.         )
3653. 
3654.     def test_alter_field_add_index_to_integerfield(self):
3655.         # Create the table and verify no initial indexes.
3656.         with connection.schema_editor() as editor:
3657.             editor.create_model(Author)
3658.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
3659. 
3660.         # Alter to add db_index=True and create index.
3661.         old_field = Author._meta.get_field('weight')
3662.         new_field = IntegerField(null=True, db_index=True)
3663.         new_field.set_attributes_from_name('weight')
3664.         with connection.schema_editor() as editor:
3665.             editor.alter_field(Author, old_field, new_field, strict=True)
3666.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), ['schema_author_weight_587740f9'])
3667. 
3668.         # Remove db_index=True to drop index.
3669.         with connection.schema_editor() as editor:
3670.             editor.alter_field(Author, new_field, old_field, strict=True)
3671.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
3672. 
3673.     def test_alter_pk_with_self_referential_field(self):
3674.         """
3675.         Changing the primary key field name of a model with a self-referential
3676.         foreign key (#26384).
3677.         """
3678.         with connection.schema_editor() as editor:
3679.             editor.create_model(Node)
3680.         old_field = Node._meta.get_field('node_id')
3681.         new_field = AutoField(primary_key=True)
3682.         new_field.set_attributes_from_name('id')
3683.         with connection.schema_editor() as editor:
3684.             editor.alter_field(Node, old_field, new_field, strict=True)
3685.         self.assertForeignKeyExists(Node, 'parent_id', Node._meta.db_table)
3686. 
3687.     @mock.patch('django.db.backends.base.schema.datetime')
3688.     @mock.patch('django.db.backends.base.schema.timezone')
3689.     def test_add_datefield_and_datetimefield_use_effective_default(self, mocked_datetime, mocked_tz):
3690.         """
3691.         effective_default() should be used for DateField, DateTimeField, and
3692.         TimeField if auto_now or auto_now_add is set (#25005).
3693.         """
3694.         now = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1)
3695.         now_tz = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1, tzinfo=timezone.utc)
3696.         mocked_datetime.now = mock.MagicMock(return_value=now)
3697.         mocked_tz.now = mock.MagicMock(return_value=now_tz)
3698.         # Create the table
3699.         with connection.schema_editor() as editor:
3700.             editor.create_model(Author)
3701.         # Check auto_now/auto_now_add attributes are not defined
3702.         columns = self.column_classes(Author)
3703.         self.assertNotIn("dob_auto_now", columns)
3704.         self.assertNotIn("dob_auto_now_add", columns)
3705.         self.assertNotIn("dtob_auto_now", columns)
3706.         self.assertNotIn("dtob_auto_now_add", columns)
3707.         self.assertNotIn("tob_auto_now", columns)
3708.         self.assertNotIn("tob_auto_now_add", columns)
3709.         # Create a row
3710.         Author.objects.create(name='Anonymous1')
3711.         # Ensure fields were added with the correct defaults
3712.         dob_auto_now = DateField(auto_now=True)
3713.         dob_auto_now.set_attributes_from_name('dob_auto_now')
3714.         self.check_added_field_default(
3715.             editor, Author, dob_auto_now, 'dob_auto_now', now.date(),
3716.             cast_function=lambda x: x.date(),
3717.         )
3718.         dob_auto_now_add = DateField(auto_now_add=True)
3719.         dob_auto_now_add.set_attributes_from_name('dob_auto_now_add')
3720.         self.check_added_field_default(
3721.             editor, Author, dob_auto_now_add, 'dob_auto_now_add', now.date(),
3722.             cast_function=lambda x: x.date(),
3723.         )
3724.         dtob_auto_now = DateTimeField(auto_now=True)
3725.         dtob_auto_now.set_attributes_from_name('dtob_auto_now')
3726.         self.check_added_field_default(
3727.             editor, Author, dtob_auto_now, 'dtob_auto_now', now,
3728.         )
3729.         dt_tm_of_birth_auto_now_add = DateTimeField(auto_now_add=True)
3730.         dt_tm_of_birth_auto_now_add.set_attributes_from_name('dtob_auto_now_add')
3731.         self.check_added_field_default(
3732.             editor, Author, dt_tm_of_birth_auto_now_add, 'dtob_auto_now_add', now,
3733.         )
3734.         tob_auto_now = TimeField(auto_now=True)
3735.         tob_auto_now.set_attributes_from_name('tob_auto_now')
3736.         self.check_added_field_default(
3737.             editor, Author, tob_auto_now, 'tob_auto_now', now.time(),
3738.             cast_function=lambda x: x.time(),
3739.         )
3740.         tob_auto_now_add = TimeField(auto_now_add=True)
3741.         tob_auto_now_add.set_attributes_from_name('tob_auto_now_add')
3742.         self.check_added_field_default(
3743.             editor, Author, tob_auto_now_add, 'tob_auto_now_add', now.time(),
3744.             cast_function=lambda x: x.time(),
3745.         )
3746. 
3747.     def test_namespaced_db_table_create_index_name(self):
3748.         """
3749.         Table names are stripped of their namespace/schema before being used to
3750.         generate index names.
3751.         """
3752.         with connection.schema_editor() as editor:
3753.             max_name_length = connection.ops.max_name_length() or 200
3754.             namespace = 'n' * max_name_length
3755.             table_name = 't' * max_name_length
3756.             namespaced_table_name = '"%s"."%s"' % (namespace, table_name)
3757.             self.assertEqual(
3758.                 editor._create_index_name(table_name, []),
3759.                 editor._create_index_name(namespaced_table_name, []),
3760.             )
3761. 
3762.     @unittest.skipUnless(connection.vendor == 'oracle', 'Oracle specific db_table syntax')
3763.     def test_creation_with_db_table_double_quotes(self):
3764.         oracle_user = connection.creation._test_database_user()
3765. 
3766.         class Student(Model):
3767.             name = CharField(max_length=30)
3768. 
3769.             class Meta:
3770.                 app_label = 'schema'
3771.                 apps = new_apps
3772.                 db_table = '"%s"."DJANGO_STUDENT_TABLE"' % oracle_user
3773. 
3774.         class Document(Model):
3775.             name = CharField(max_length=30)
3776.             students = ManyToManyField(Student)
3777. 
3778.             class Meta:
3779.                 app_label = 'schema'
3780.                 apps = new_apps
3781.                 db_table = '"%s"."DJANGO_DOCUMENT_TABLE"' % oracle_user
3782. 
3783.         self.local_models = [Student, Document]
3784. 
3785.         with connection.schema_editor() as editor:
3786.             editor.create_model(Student)
3787.             editor.create_model(Document)
3788. 
3789.         doc = Document.objects.create(name='Test Name')
3790.         student = Student.objects.create(name='Some man')
3791.         doc.students.add(student)
3792. 
3793.     @isolate_apps('schema')
3794.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific db_table syntax.')
3795.     def test_namespaced_db_table_foreign_key_reference(self):
3796.         with connection.cursor() as cursor:
3797.             cursor.execute('CREATE SCHEMA django_schema_tests')
3798. 
3799.         def delete_schema():
3800.             with connection.cursor() as cursor:
3801.                 cursor.execute('DROP SCHEMA django_schema_tests CASCADE')
3802. 
3803.         self.addCleanup(delete_schema)
3804. 
3805.         class Author(Model):
3806.             class Meta:
3807.                 app_label = 'schema'
3808. 
3809.         class Book(Model):
3810.             class Meta:
3811.                 app_label = 'schema'
3812.                 db_table = '"django_schema_tests"."schema_book"'
3813. 
3814.         author = ForeignKey(Author, CASCADE)
3815.         author.set_attributes_from_name('author')
3816. 
3817.         with connection.schema_editor() as editor:
3818.             editor.create_model(Author)
3819.             editor.create_model(Book)
3820.             editor.add_field(Book, author)
3821. 
3822.     def test_rename_table_renames_deferred_sql_references(self):
3823.         atomic_rename = connection.features.supports_atomic_references_rename
3824.         with connection.schema_editor(atomic=atomic_rename) as editor:
3825.             editor.create_model(Author)
3826.             editor.create_model(Book)
3827.             editor.alter_db_table(Author, 'schema_author', 'schema_renamed_author')
3828.             editor.alter_db_table(Author, 'schema_book', 'schema_renamed_book')
3829.             try:
3830.                 self.assertGreater(len(editor.deferred_sql), 0)
3831.                 for statement in editor.deferred_sql:
3832.                     self.assertIs(statement.references_table('schema_author'), False)
3833.                     self.assertIs(statement.references_table('schema_book'), False)
3834.             finally:
3835.                 editor.alter_db_table(Author, 'schema_renamed_author', 'schema_author')
3836.                 editor.alter_db_table(Author, 'schema_renamed_book', 'schema_book')
3837. 
3838.     def test_rename_column_renames_deferred_sql_references(self):
3839.         with connection.schema_editor() as editor:
3840.             editor.create_model(Author)
3841.             editor.create_model(Book)
3842.             old_title = Book._meta.get_field('title')
3843.             new_title = CharField(max_length=100, db_index=True)
3844.             new_title.set_attributes_from_name('renamed_title')
3845.             editor.alter_field(Book, old_title, new_title)
3846.             old_author = Book._meta.get_field('author')
3847.             new_author = ForeignKey(Author, CASCADE)
3848.             new_author.set_attributes_from_name('renamed_author')
3849.             editor.alter_field(Book, old_author, new_author)
3850.             self.assertGreater(len(editor.deferred_sql), 0)
3851.             for statement in editor.deferred_sql:
3852.                 self.assertIs(statement.references_column('book', 'title'), False)
3853.                 self.assertIs(statement.references_column('book', 'author_id'), False)
3854. 
3855.     @isolate_apps('schema')
3856.     def test_referenced_field_without_constraint_rename_inside_atomic_block(self):
3857.         """
3858.         Foreign keys without database level constraint don't prevent the field
3859.         they reference from being renamed in an atomic block.
3860.         """
3861.         class Foo(Model):
3862.             field = CharField(max_length=255, unique=True)
3863. 
3864.             class Meta:
3865.                 app_label = 'schema'
3866. 
3867.         class Bar(Model):
3868.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3869. 
3870.             class Meta:
3871.                 app_label = 'schema'
3872. 
3873.         self.isolated_local_models = [Foo, Bar]
3874.         with connection.schema_editor() as editor:
3875.             editor.create_model(Foo)
3876.             editor.create_model(Bar)
3877. 
3878.         new_field = CharField(max_length=255, unique=True)
3879.         new_field.set_attributes_from_name('renamed')
3880.         with connection.schema_editor(atomic=True) as editor:
3881.             editor.alter_field(Foo, Foo._meta.get_field('field'), new_field)
3882. 
3883.     @isolate_apps('schema')
3884.     def test_referenced_table_without_constraint_rename_inside_atomic_block(self):
3885.         """
3886.         Foreign keys without database level constraint don't prevent the table
3887.         they reference from being renamed in an atomic block.
3888.         """
3889.         class Foo(Model):
3890.             field = CharField(max_length=255, unique=True)
3891. 
3892.             class Meta:
3893.                 app_label = 'schema'
3894. 
3895.         class Bar(Model):
3896.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3897. 
3898.             class Meta:
3899.                 app_label = 'schema'
3900. 
3901.         self.isolated_local_models = [Foo, Bar]
3902.         with connection.schema_editor() as editor:
3903.             editor.create_model(Foo)
3904.             editor.create_model(Bar)
3905. 
3906.         new_field = CharField(max_length=255, unique=True)
3907.         new_field.set_attributes_from_name('renamed')
3908.         with connection.schema_editor(atomic=True) as editor:
3909.             editor.alter_db_table(Foo, Foo._meta.db_table, 'renamed_table')
3910.         Foo._meta.db_table = 'renamed_table'
3911. 
3912.     @isolate_apps('schema')
3913.     @skipUnlessDBFeature('supports_collation_on_charfield')
3914.     def test_db_collation_charfield(self):
3915.         collation = connection.features.test_collations.get('non_default')
3916.         if not collation:
3917.             self.skipTest('Language collations are not supported.')
3918. 
3919.         class Foo(Model):
3920.             field = CharField(max_length=255, db_collation=collation)
3921. 
3922.             class Meta:
3923.                 app_label = 'schema'
3924. 
3925.         self.isolated_local_models = [Foo]
3926.         with connection.schema_editor() as editor:
3927.             editor.create_model(Foo)
3928. 
3929.         self.assertEqual(
3930.             self.get_column_collation(Foo._meta.db_table, 'field'),
3931.             collation,
3932.         )
3933. 
3934.     @isolate_apps('schema')
3935.     @skipUnlessDBFeature('supports_collation_on_textfield')
3936.     def test_db_collation_textfield(self):
3937.         collation = connection.features.test_collations.get('non_default')
3938.         if not collation:
3939.             self.skipTest('Language collations are not supported.')
3940. 
3941.         class Foo(Model):
3942.             field = TextField(db_collation=collation)
3943. 
3944.             class Meta:
3945.                 app_label = 'schema'
3946. 
3947.         self.isolated_local_models = [Foo]
3948.         with connection.schema_editor() as editor:
3949.             editor.create_model(Foo)
3950. 
3951.         self.assertEqual(
3952.             self.get_column_collation(Foo._meta.db_table, 'field'),
3953.             collation,
3954.         )
3955. 
3956.     @skipUnlessDBFeature('supports_collation_on_charfield')
3957.     def test_add_field_db_collation(self):
3958.         collation = connection.features.test_collations.get('non_default')
3959.         if not collation:
3960.             self.skipTest('Language collations are not supported.')
3961. 
3962.         with connection.schema_editor() as editor:
3963.             editor.create_model(Author)
3964. 
3965.         new_field = CharField(max_length=255, db_collation=collation)
3966.         new_field.set_attributes_from_name('alias')
3967.         with connection.schema_editor() as editor:
3968.             editor.add_field(Author, new_field)
3969.         columns = self.column_classes(Author)
3970.         self.assertEqual(
3971.             columns['alias'][0],
3972.             connection.features.introspected_field_types['CharField'],
3973.         )
3974.         self.assertEqual(columns['alias'][1][8], collation)
3975. 
3976.     @skipUnlessDBFeature('supports_collation_on_charfield')
3977.     def test_alter_field_db_collation(self):
3978.         collation = connection.features.test_collations.get('non_default')
3979.         if not collation:
3980.             self.skipTest('Language collations are not supported.')
3981. 
3982.         with connection.schema_editor() as editor:
3983.             editor.create_model(Author)
3984. 
3985.         old_field = Author._meta.get_field('name')
3986.         new_field = CharField(max_length=255, db_collation=collation)
3987.         new_field.set_attributes_from_name('name')
3988.         new_field.model = Author
3989.         with connection.schema_editor() as editor:
3990.             editor.alter_field(Author, old_field, new_field, strict=True)
3991.         self.assertEqual(
3992.             self.get_column_collation(Author._meta.db_table, 'name'),
3993.             collation,
3994.         )
3995.         with connection.schema_editor() as editor:
3996.             editor.alter_field(Author, new_field, old_field, strict=True)
3997.         self.assertIsNone(self.get_column_collation(Author._meta.db_table, 'name'))
3998. 
3999.     @skipUnlessDBFeature('supports_collation_on_charfield')
4000.     def test_alter_field_type_and_db_collation(self):
4001.         collation = connection.features.test_collations.get('non_default')
4002.         if not collation:
4003.             self.skipTest('Language collations are not supported.')
4004. 
4005.         with connection.schema_editor() as editor:
4006.             editor.create_model(Note)
4007. 
4008.         old_field = Note._meta.get_field('info')
4009.         new_field = CharField(max_length=255, db_collation=collation)
4010.         new_field.set_attributes_from_name('info')
4011.         new_field.model = Note
4012.         with connection.schema_editor() as editor:
4013.             editor.alter_field(Note, old_field, new_field, strict=True)
4014.         columns = self.column_classes(Note)
4015.         self.assertEqual(
4016.             columns['info'][0],
4017.             connection.features.introspected_field_types['CharField'],
4018.         )
4019.         self.assertEqual(columns['info'][1][8], collation)
4020.         with connection.schema_editor() as editor:
4021.             editor.alter_field(Note, new_field, old_field, strict=True)
4022.         columns = self.column_classes(Note)
4023.         self.assertEqual(columns['info'][0], 'TextField')
4024.         self.assertIsNone(columns['info'][1][8])
4025. 
4026.     @skipUnlessDBFeature(
4027.         'supports_collation_on_charfield',
4028.         'supports_non_deterministic_collations',
4029.     )
4030.     def test_ci_cs_db_collation(self):
4031.         cs_collation = connection.features.test_collations.get('cs')
4032.         ci_collation = connection.features.test_collations.get('ci')
4033.         try:
4034.             if connection.vendor == 'mysql':
4035.                 cs_collation = 'latin1_general_cs'
4036.             elif connection.vendor == 'postgresql':
4037.                 cs_collation = 'en-x-icu'
4038.                 with connection.cursor() as cursor:
4039.                     cursor.execute(
4040.                         "CREATE COLLATION IF NOT EXISTS case_insensitive "
4041.                         "(provider = icu, locale = 'und-u-ks-level2', "
4042.                         "deterministic = false)"
4043.                     )
4044.                     ci_collation = 'case_insensitive'
4045.             # Create the table.
4046.             with connection.schema_editor() as editor:
4047.                 editor.create_model(Author)
4048.             # Case-insensitive collation.
4049.             old_field = Author._meta.get_field('name')
4050.             new_field_ci = CharField(max_length=255, db_collation=ci_collation)
4051.             new_field_ci.set_attributes_from_name('name')
4052.             new_field_ci.model = Author
4053.             with connection.schema_editor() as editor:
4054.                 editor.alter_field(Author, old_field, new_field_ci, strict=True)
4055.             Author.objects.create(name='ANDREW')
4056.             self.assertIs(Author.objects.filter(name='Andrew').exists(), True)
4057.             # Case-sensitive collation.
4058.             new_field_cs = CharField(max_length=255, db_collation=cs_collation)
4059.             new_field_cs.set_attributes_from_name('name')
4060.             new_field_cs.model = Author
4061.             with connection.schema_editor() as editor:
4062.                 editor.alter_field(Author, new_field_ci, new_field_cs, strict=True)
4063.             self.assertIs(Author.objects.filter(name='Andrew').exists(), False)
4064.         finally:
4065.             if connection.vendor == 'postgresql':
4066.                 with connection.cursor() as cursor:
4067.                     cursor.execute('DROP COLLATION IF EXISTS case_insensitive')

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 18:45:34,357 - thread-132499082577600.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The provided context, which is the full content of `tests/schema/tests.py`, is sufficient to answer the user's query. This file contains the `SchemaTests` class, which includes tests for creating unique constraints. I have identified three highly relevant test cases: `test_func_unique_constraint`, `test_unique_constraint_field_and_expression`, and `test_composite_func_unique_constraint`. These tests exercise the functionality related to the bug (creating unique constraints with expressions) and contain assertions that would fail without the patch, specifically checking `sql.references_column()`. The file contains all necessary imports, the test class setup, and helper methods. The models are imported, and their full definitions are not required to understand the schema manipulation logic being tested." query='' extra_requirements='' purpose=''
2025-12-21 18:45:34,358 - thread-132499082577600.prometheus_context_collector - INFO - Successfully retrieved 1 context snippets
