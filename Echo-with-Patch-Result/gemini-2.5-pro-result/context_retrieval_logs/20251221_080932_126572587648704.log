2025-12-21 08:09:32,169 - thread-126572587648704.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Modeling's `separability_matrix` does not compute separability correctly for nested CompoundModels

Description: Consider the following model:

```python
from astropy.modeling import models as m
from astropy.modeling.separable import separability_matrix

cm = m.Linear1D(10) & m.Linear1D(5)
```

It's separability matrix as you might expect is a diagonal:

```python
>>> separability_matrix(cm)
array([[ True, False],
       [False,  True]])
```

If I make the model more complex:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5))
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True, False],
       [False, False, False,  True]])
```

The output matrix is again, as expected, the outputs and inputs to the linear models are separable and independent of each other.

If however, I nest these compound models:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & cm)
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True,  True],
       [False, False,  True,  True]])
```
Suddenly the inputs and outputs are no longer separable?

This feels like a bug to me, but I might be missing something?

Patch information:
diff --git a/astropy/modeling/separable.py b/astropy/modeling/separable.py
index a308e27297..45bea36085 100644
--- a/astropy/modeling/separable.py
+++ b/astropy/modeling/separable.py
@@ -242,7 +242,7 @@ def _cstack(left, right):
         cright = _coord_matrix(right, 'right', noutp)
     else:
         cright = np.zeros((noutp, right.shape[1]))
-        cright[-right.shape[0]:, -right.shape[1]:] = 1
+        cright[-right.shape[0]:, -right.shape[1]:] = right
 
     return np.hstack([cleft, cright])
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 08:09:32,236 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── labeler.yml
|   └── workflows
|       ├── cancel_workflows.yml
|       ├── check_changelog.yml
|       ├── ci_cron_daily.yml
|       ├── ci_cron_weekly.yml
|       ├── ci_workflows.yml
|       ├── codeql-analysis.yml
|       ├── open_actions.yml
|       └── stalebot.yml
├── .pep8speaks.yml
├── .pre-commit-config.yaml
├── .pyinstaller
|   ├── hooks
|   |   └── hook-skyfield.py
|   └── run_astropy_tests.py
├── .readthedocs.yml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── LICENSE.rst
├── README.rst
├── astropy
|   ├── __init__.py
|   ├── _dev
|   |   ├── __init__.py
|   |   └── scm_version.py
|   ├── _erfa
|   |   └── __init__.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── affiliated.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── astropyconst40.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── codata2018.py
|   |   ├── config.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_prior_version.py
|   |   |   └── test_sciencestate.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── convolve.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_formats.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── equatorial.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hadec.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── icrs_observed_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── erfa_astrom.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── jparser.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── sky_coordinate_parsers.py
|   |   ├── solar_system.py
|   |   ├── spectral_coordinate.py
|   |   ├── spectral_quantity.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── generate_spectralcoord_ref.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── test_angle_generators.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_erfa_astrom.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_geodetic_representations.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_icrs_observed_transformations.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_spectral_coordinate.py
|   |   |   ├── test_spectral_quantity.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_utils.py
|   |   |   └── test_velocity_corrs.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── connect.py
|   |   ├── core.py
|   |   ├── data
|   |   ├── flrw.py
|   |   ├── funcs.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── cosmology.py
|   |   |   ├── ecsv.py
|   |   |   ├── mapping.py
|   |   |   ├── model.py
|   |   |   ├── row.py
|   |   |   ├── table.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── test_cosmology.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_json.py
|   |   |   |   ├── test_mapping.py
|   |   |   |   ├── test_model.py
|   |   |   |   ├── test_row.py
|   |   |   |   ├── test_table.py
|   |   |   |   └── test_yaml.py
|   |   |   ├── utils.py
|   |   |   └── yaml.py
|   |   ├── parameter.py
|   |   ├── parameters.py
|   |   ├── realizations.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── conftest.py
|   |   |   ├── mypackage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── cosmology.py
|   |   |   |   └── io
|   |   |   ├── test_connect.py
|   |   |   ├── test_core.py
|   |   |   ├── test_cosmology.py
|   |   |   ├── test_flrw.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_parameter.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_realizations.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   ├── units.py
|   |   └── utils.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── _strptime.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── jquery
|   |   |   ├── __init__.py
|   |   |   └── data
|   |   |       ├── css
|   |   |       ├── images
|   |   |       └── js
|   |   └── ply
|   |       ├── __init__.py
|   |       ├── cpp.py
|   |       ├── ctokens.py
|   |       ├── lex.py
|   |       ├── yacc.py
|   |       └── ygen.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── docs.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── mrt.py
|   |   |   ├── qdp.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── data
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_qdp.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── setup_package.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_image_dask.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── connect.py
|   |   |   |   ├── data
|   |   |   |   ├── extension.py
|   |   |   |   ├── tags
|   |   |   |   ├── tests
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pandas
|   |   |   |   ├── __init__.py
|   |   |   |   └── connect.py
|   |   |   ├── parquet.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pandas.py
|   |   |   |   ├── test_parquet.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── compat.py
|   |   |   ├── core.py
|   |   |   ├── interface.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_registries.py
|   |   |       └── test_registry_help.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── mixin_columns.py
|   |   |   └── safeio.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   └── result.py
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── bounding_box.py
|   |   ├── convolution.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── math_functions.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── physical_models.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── setup_package.py
|   |   ├── spline.py
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── __init__.py
|   |   |   |   └── spec.txt
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_bounding_box.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_convolution.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_math_func.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_physical_models.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_spline.py
|   |   |   ├── test_statistics.py
|   |   |   ├── test_units_mapping.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── _testing.py
|   |   ├── bitmask.py
|   |   ├── blocks.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_bitmask.py
|   |   |   ├── test_blocks.py
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── bls
|   |   |   └── __init__.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   └── __init__.py
|   |   ├── setup_package.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   ├── src
|   |   |   ├── compute_bounds.c
|   |   |   ├── fast_sigma_clip.c
|   |   |   └── wirth_select.c
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── connect.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── dask.py
|   |   |   ├── registry.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_dask.py
|   |   |       └── test_registry.py
|   |   ├── ndarray_mixin.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── soco.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── helper.py
|   |   ├── image_tests.py
|   |   ├── runner.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── parse_times.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_custom_formats.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_fast_parser.py
|   |   |   ├── test_functions.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   ├── test_update_leap_seconds.py
|   |   |   └── test_ut1.py
|   |   └── utils.py
|   ├── timeseries
|   |   ├── __init__.py
|   |   ├── binned.py
|   |   ├── core.py
|   |   ├── downsample.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── kepler.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_kepler.py
|   |   ├── periodograms
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── bls
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core.py
|   |   |   |   ├── methods.py
|   |   |   |   ├── setup_package.py
|   |   |   |   └── tests
|   |   |   └── lombscargle
|   |   |       ├── __init__.py
|   |   |       ├── _statistics.py
|   |   |       ├── core.py
|   |   |       ├── implementations
|   |   |       ├── tests
|   |   |       └── utils.py
|   |   ├── sampled.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       ├── test_binned.py
|   |       ├── test_common.py
|   |       ├── test_downsample.py
|   |       └── test_sampled.py
|   ├── uncertainty
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── distributions.py
|   |   └── tests
|   |       ├── __init__.py
|   |       └── test_distribution.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── _typing.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── misc.py
|   |   ├── photometric.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper
|   |   |   ├── __init__.py
|   |   |   ├── converters.py
|   |   |   ├── erfa.py
|   |   |   ├── function_helpers.py
|   |   |   ├── helpers.py
|   |   |   └── scipy_special.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── structured.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_aliases.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_photometric.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_annotations.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_helpers.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_typing.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   ├── test_structured.py
|   |   |   ├── test_structured_erfa_ufuncs.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpycompat.py
|   |   |   └── optional_deps.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── diff.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── update_builtin_iers.sh
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── data
|   |   |       ├── test_iers.py
|   |   |       └── test_leap_second.py
|   |   ├── introspection.py
|   |   ├── masked
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── function_helpers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_containers.py
|   |   |       ├── test_function_helpers.py
|   |   |       ├── test_functions.py
|   |   |       ├── test_masked.py
|   |   |       └── test_table.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── parsing.py
|   |   ├── setup_package.py
|   |   ├── shapes.py
|   |   ├── src
|   |   |   └── compiler.c
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── dataurl
|   |   |   |   ├── dataurl_mirror
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_diff.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_parsing.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_shapes.py
|   |   |   ├── test_state.py
|   |   |   └── test_xml.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── version.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   ├── test_time.py
|   |   |   └── test_units.py
|   |   ├── time.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_grid_paths.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   ├── test_utils.py
|   |       |   └── test_wcsapi.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       ├── utils.py
|   |       └── wcsapi.py
|   └── wcs
|       ├── __init__.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_auxprm_wrap.c
|       |   ├── wcslib_celprm_wrap.c
|       |   ├── wcslib_prjprm_wrap.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   ├── wcslib_wrap.c
|       |   └── wcslib_wtbarr_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   ├── maps
|       |   |   ├── spectra
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   ├── validate.6.txt
|       |   |   ├── validate.7.4.txt
|       |   |   ├── validate.7.6.txt
|       |   |   └── validate.txt
|       |   ├── helper.py
|       |   ├── test_auxprm.py
|       |   ├── test_celprm.py
|       |   ├── test_pickle.py
|       |   ├── test_prjprm.py
|       |   ├── test_profiling.py
|       |   ├── test_tab.py
|       |   ├── test_tabprm.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   ├── test_wcsprm.py
|       |   └── test_wtbarr.py
|       ├── utils.py
|       ├── wcs.py
|       ├── wcsapi
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   └── ucds.txt
|       |   ├── fitswcs.py
|       |   ├── high_level_api.py
|       |   ├── high_level_wcs_wrapper.py
|       |   ├── low_level_api.py
|       |   ├── sliced_low_level_wcs.py
|       |   ├── tests
|       |   |   ├── __init__.py
|       |   |   ├── test_fitswcs.py
|       |   |   ├── test_high_level_api.py
|       |   |   ├── test_high_level_wcs_wrapper.py
|       |   |   ├── test_low_level_api.py
|       |   |   └── test_utils.py
|       |   ├── utils.py
|       |   └── wrappers
|       |       ├── __init__.py
|       |       ├── base.py
|       |       ├── sliced_wcs.py
|       |       └── tests
|       └── wcslint.py
├── azure-pipelines.yml
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.txt
|   |   ├── docs
|   |   |   └── changes.txt
|   |   ├── lib
|   |   |   ├── buffers.c
|   |   |   ├── cfileio.c
|   |   |   ├── checksum.c
|   |   |   ├── drvrfile.c
|   |   |   ├── drvrmem.c
|   |   |   ├── drvrnet.c
|   |   |   ├── drvrsmem.c
|   |   |   ├── editcol.c
|   |   |   ├── edithdu.c
|   |   |   ├── eval_f.c
|   |   |   ├── eval_l.c
|   |   |   ├── eval_y.c
|   |   |   ├── fits_hcompress.c
|   |   |   ├── fits_hdecompress.c
|   |   |   ├── fitscore.c
|   |   |   ├── getcol.c
|   |   |   ├── getcolb.c
|   |   |   ├── getcold.c
|   |   |   ├── getcole.c
|   |   |   ├── getcoli.c
|   |   |   ├── getcolj.c
|   |   |   ├── getcolk.c
|   |   |   ├── getcoll.c
|   |   |   ├── getcols.c
|   |   |   ├── getcolsb.c
|   |   |   ├── getcolui.c
|   |   |   ├── getcoluj.c
|   |   |   ├── getcoluk.c
|   |   |   ├── getkey.c
|   |   |   ├── group.c
|   |   |   ├── grparser.c
|   |   |   ├── histo.c
|   |   |   ├── imcompress.c
|   |   |   ├── iraffits.c
|   |   |   ├── modkey.c
|   |   |   ├── pliocomp.c
|   |   |   ├── putcol.c
|   |   |   ├── putcolb.c
|   |   |   ├── putcold.c
|   |   |   ├── putcole.c
|   |   |   ├── putcoli.c
|   |   |   ├── putcolj.c
|   |   |   ├── putcolk.c
|   |   |   ├── putcoll.c
|   |   |   ├── putcols.c
|   |   |   ├── putcolsb.c
|   |   |   ├── putcolu.c
|   |   |   ├── putcolui.c
|   |   |   ├── putcoluj.c
|   |   |   ├── putcoluk.c
|   |   |   ├── putkey.c
|   |   |   ├── quantize.c
|   |   |   ├── region.c
|   |   |   ├── ricecomp.c
|   |   |   ├── scalnull.c
|   |   |   ├── simplerng.c
|   |   |   ├── swapproc.c
|   |   |   ├── wcssub.c
|   |   |   ├── wcsutil.c
|   |   |   ├── zcompress.c
|   |   |   └── zuncompress.c
|   |   └── zlib
|   |       ├── adler32.c
|   |       ├── crc32.c
|   |       ├── deflate.c
|   |       ├── infback.c
|   |       ├── inffast.c
|   |       ├── inflate.c
|   |       ├── inftrees.c
|   |       ├── trees.c
|   |       ├── uncompr.c
|   |       └── zutil.c
|   ├── expat
|   |   ├── README.md
|   |   ├── README.txt
|   |   └── lib
|   |       ├── xmlparse.c
|   |       ├── xmlrole.c
|   |       ├── xmltok.c
|   |       ├── xmltok_impl.c
|   |       └── xmltok_ns.c
|   ├── trim_cfitsio.sh
|   ├── trim_expat.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── codecov.yml
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── _templates
|   |   └── layout.html
|   ├── changelog.rst
|   ├── changes
|   |   ├── README.rst
|   |   ├── config
|   |   ├── constants
|   |   ├── convolution
|   |   ├── coordinates
|   |   ├── cosmology
|   |   |   ├── 12279.feature.rst
|   |   |   ├── 12313.feature.rst
|   |   |   ├── 12354.api.rst
|   |   |   ├── 12375.api.rst
|   |   |   ├── 12479.feature.rst
|   |   |   ├── 12590.feature.rst
|   |   |   ├── 12606.feature.rst
|   |   |   ├── 12612.api.rst
|   |   |   ├── 12624.api.rst
|   |   |   ├── 12710.feature.rst
|   |   |   ├── 12736.feature.rst
|   |   |   ├── 12740.feature.rst
|   |   |   └── 12746.api.rst
|   |   ├── extern
|   |   ├── io.ascii
|   |   |   ├── 12631.bugfix.rst
|   |   |   └── 12880.bugfix.rst
|   |   ├── io.fits
|   |   |   ├── 11843.feature.rst
|   |   |   └── 12258.api.rst
|   |   ├── io.misc
|   |   |   ├── 10198.feature.rst
|   |   |   ├── 12279.feature.rst
|   |   |   ├── 12800.bugfix.rst
|   |   |   ├── 12895.feature.rst
|   |   |   └── 12897.feature.rst
|   |   ├── io.registry
|   |   ├── io.votable
|   |   |   └── 12604.bugfix.rst
|   |   ├── modeling
|   |   |   ├── 12384.feature.rst
|   |   |   ├── 12558.feature.rst
|   |   |   ├── 12585.api.rst
|   |   |   └── 12900.feature.rst
|   |   ├── nddata
|   |   ├── samp
|   |   ├── stats
|   |   |   └── 12896.bugfix.rst
|   |   ├── table
|   |   |   ├── 12631.api.rst
|   |   |   ├── 12637.api.rst
|   |   |   ├── 12637.feature.rst
|   |   |   ├── 12680.feature.rst
|   |   |   └── 12716.bugfix.rst
|   |   ├── template.rst
|   |   ├── tests
|   |   |   ├── 12633.api.1.rst
|   |   |   ├── 12633.api.2.rst
|   |   |   ├── 12633.api.3.rst
|   |   |   └── 12633.api.4.rst
|   |   ├── time
|   |   |   └── 12888.api.rst
|   |   ├── timeseries
|   |   ├── uncertainty
|   |   ├── units
|   |   |   ├── 12486.feature.rst
|   |   |   ├── 12566.feature.rst
|   |   |   └── 12709.feature.rst
|   |   ├── utils
|   |   ├── visualization
|   |   └── wcs
|   |       ├── 12514.feature.rst
|   |       └── 12844.bugfix.rst
|   ├── common_links.txt
|   ├── conf.py
|   ├── config
|   |   ├── astropy_config.rst
|   |   └── index.rst
|   ├── conftest.py
|   ├── constants
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   ├── performance.inc.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── common_errors.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── performance.inc.rst
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── satellites.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── spectralcoord.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   ├── dev.rst
|   |   ├── index.rst
|   |   ├── io.rst
|   |   └── units.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── docrules.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── style-guide.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   ├── when_to_rebase.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_install.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       ├── patches.rst
|   |       └── virtual_pythons.rst
|   ├── getting_started.rst
|   ├── glossary.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── ecsv.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── asdf-schemas.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   └── usage
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       ├── performance.inc.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── lts_policy.rst
|   ├── modeling
|   |   ├── add-units.rst
|   |   ├── compound-models.rst
|   |   ├── example-fitting-constraints.rst
|   |   ├── example-fitting-line.rst
|   |   ├── example-fitting-model-sets.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── jointfitter.rst
|   |   ├── models.rst
|   |   ├── new-fitter.rst
|   |   ├── new-model.rst
|   |   ├── parameters.rst
|   |   ├── performance.rst
|   |   ├── physical_models.rst
|   |   ├── polynomial_models.rst
|   |   ├── predef_models1D.rst
|   |   ├── predef_models2D.rst
|   |   ├── reference_api.rst
|   |   ├── spline_models.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── bitmask.rst
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── examples
|   |   |   └── cutout2d_tofits.py
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── performance.inc.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── robots.txt
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── performance.inc.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── performance.inc.rst
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── timeseries
|   |   ├── analysis.rst
|   |   ├── bls.rst
|   |   ├── data_access.rst
|   |   ├── index.rst
|   |   ├── initializing.rst
|   |   ├── io.rst
|   |   ├── lombscargle.rst
|   |   ├── masking.rst
|   |   ├── pandas.rst
|   |   └── times.rst
|   ├── uncertainty
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── constants_versions.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── performance.inc.rst
|   |   ├── physical_types.rst
|   |   ├── quantity.rst
|   |   ├── standard_units.rst
|   |   ├── structured_units.rst
|   |   └── type_hints.rst
|   ├── utils
|   |   ├── data.rst
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── masked
|   |       └── index.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── matplotlib_integration.rst
|   |   ├── normalization.rst
|   |   ├── performance.inc.rst
|   |   ├── rgb.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── generic_transforms.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── example_create_imaging.rst
|   |   ├── example_cube_wcs.rst
|   |   ├── examples
|   |   |   ├── cube_wcs.py
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── legacy_interface.rst
|   |   ├── loading_from_fits.rst
|   |   ├── note_sip.rst
|   |   ├── performance.inc.rst
|   |   ├── reference_api.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   ├── relax.rst
|   |   ├── supported_projections.rst
|   |   ├── validation.rst
|   |   ├── wcsapi.rst
|   |   └── wcstools.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       ├── 3.2.rst
|       ├── 4.0.rst
|       ├── 4.1.rst
|       ├── 4.2.rst
|       ├── 4.3.rst
|       ├── 5.0.rst
|       ├── 5.1.rst
|       └── index.rst
├── examples
|   ├── README.rst
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── PYTHON.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
└── setup.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Modeling's `separability_matrix` does not compute separability correctly for nested CompoundModels

Description: Consider the following model:

```python
from astropy.modeling import models as m
from astropy.modeling.separable import separability_matrix

cm = m.Linear1D(10) & m.Linear1D(5)
```

It's separability matrix as you might expect is a diagonal:

```python
>>> separability_matrix(cm)
array([[ True, False],
       [False,  True]])
```

If I make the model more complex:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5))
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True, False],
       [False, False, False,  True]])
```

The output matrix is again, as expected, the outputs and inputs to the linear models are separable and independent of each other.

If however, I nest these compound models:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & cm)
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True,  True],
       [False, False,  True,  True]])
```
Suddenly the inputs and outputs are no longer separable?

This feels like a bug to me, but I might be missing something?

Patch information:
diff --git a/astropy/modeling/separable.py b/astropy/modeling/separable.py
index a308e27297..45bea36085 100644
--- a/astropy/modeling/separable.py
+++ b/astropy/modeling/separable.py
@@ -242,7 +242,7 @@ def _cstack(left, right):
         cright = _coord_matrix(right, 'right', noutp)
     else:
         cright = np.zeros((noutp, right.shape[1]))
-        cright[-right.shape[0]:, -right.shape[1]:] = 1
+        cright[-right.shape[0]:, -right.shape[1]:] = right
 
     return np.hstack([cleft, cright])
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 08:09:45,191 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user is reporting a bug in the `separability_matrix` function within the `astropy.modeling.separable` module, specifically concerning how it handles nested `CompoundModel` instances. To find relevant test cases, I need to examine the tests for the `separable` module. The most relevant file for this purpose is `astropy/modeling/tests/test_separable.py`. I will start by requesting the content of this file to identify tests that cover `separability_matrix` with `CompoundModel`.' query='Please provide the full content of the file `astropy/modeling/tests/test_separable.py`.' extra_requirements='' purpose="I need to find existing test cases for `separability_matrix` to see how compound models are tested and to find examples similar to the user's bug report."
2025-12-21 08:09:45,193 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `astropy/modeling/tests/test_separable.py`.
2025-12-21 08:09:45,193 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 08:09:45,193 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 08:09:45,194 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 08:09:45,194 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `astropy/modeling/tests/test_separable.py`.
Purpose: I need to find existing test cases for `separability_matrix` to see how compound models are tested and to find examples similar to the user's bug report.
2025-12-21 08:09:48,165 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I will read the full content of the file `astropy/modeling/tests/test_separable.py` to understand the existing test cases for `separability_matrix`. This will help me find examples of how compound models are tested and identify test cases that might be similar to the user's bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "astropy/modeling/tests/test_separable.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2131, 'candidates_token_count': 90, 'total_token_count': 2323, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2131}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 90}], 'thoughts_token_count': 102, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.07979142930772569, 'model_name': 'gemini-2.5-pro'} id='run--f1f85180-02ac-47a5-996b-f812ea7d7020-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'astropy/modeling/tests/test_separable.py'}, 'id': 'e738fb67-9480-44ac-8cbe-b0c9d6d7efbf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2131, 'output_tokens': 90, 'total_tokens': 2323, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 102}}
2025-12-21 08:09:51,548 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of the file `astropy/modeling/tests/test_separable.py`. This file contains various test cases that verify the functionality of `separability_matrix` for different kinds of models, including simple and compound ones. The tests also cover custom models and demonstrate how separability is assessed in different scenarios.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 4641, 'candidates_token_count': 70, 'total_token_count': 4870, 'cached_content_token_count': 1710, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4641}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1710}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 70}], 'thoughts_token_count': 159}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1955956322806222, 'model_name': 'gemini-2.5-pro'} id='run--715b92a1-7a54-4ac9-bfa9-6a7721eb6065-0' usage_metadata={'input_tokens': 4641, 'output_tokens': 70, 'total_tokens': 4870, 'input_token_details': {'cache_read': 1710}, 'output_token_details': {'reasoning': 159}}
2025-12-21 08:09:51,550 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `astropy/modeling/tests/test_separable.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find existing test cases for `separability_matrix` to see how compound models are tested and to find examples similar to the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: astropy/modeling/tests/test_separable.py
Line number range: 1 - 150
Content:
1. # Licensed under a 3-clause BSD style license - see LICENSE.rst
2. """
3. Test separability of models.
4. 
5. """
6. # pylint: disable=invalid-name
7. import pytest
8. import numpy as np
9. from numpy.testing import assert_allclose
10. 
11. from astropy.modeling import custom_model, models
12. from astropy.modeling.models import Mapping
13. from astropy.modeling.separable import (_coord_matrix, is_separable, _cdot,
14.                                         _cstack, _arith_oper, separability_matrix)
15. from astropy.modeling.core import ModelDefinitionError
16. 
17. 
18. sh1 = models.Shift(1, name='shift1')
19. sh2 = models.Shift(2, name='sh2')
20. scl1 = models.Scale(1, name='scl1')
21. scl2 = models.Scale(2, name='scl2')
22. map1 = Mapping((0, 1, 0, 1), name='map1')
23. map2 = Mapping((0, 0, 1), name='map2')
24. map3 = Mapping((0, 0), name='map3')
25. rot = models.Rotation2D(2, name='rotation')
26. p2 = models.Polynomial2D(1, name='p2')
27. p22 = models.Polynomial2D(2, name='p22')
28. p1 = models.Polynomial1D(1, name='p1')
29. 
30. 
31. compound_models = {
32.     'cm1': (map3 & sh1 | rot & sh1 | sh1 & sh2 & sh1,
33.             (np.array([False, False, True]),
34.              np.array([[True, False], [True, False], [False, True]]))
35.             ),
36.     'cm2': (sh1 & sh2 | rot | map1 | p2 & p22,
37.             (np.array([False, False]),
38.              np.array([[True, True], [True, True]]))
39.             ),
40.     'cm3': (map2 | rot & scl1,
41.             (np.array([False, False, True]),
42.              np.array([[True, False], [True, False], [False, True]]))
43.             ),
44.     'cm4': (sh1 & sh2 | map2 | rot & scl1,
45.             (np.array([False, False, True]),
46.              np.array([[True, False], [True, False], [False, True]]))
47.             ),
48.     'cm5': (map3 | sh1 & sh2 | scl1 & scl2,
49.             (np.array([False, False]),
50.              np.array([[True], [True]]))
51.             ),
52.     'cm7': (map2 | p2 & sh1,
53.             (np.array([False, True]),
54.              np.array([[True, False], [False, True]]))
55.             )
56. }
57. 
58. 
59. def test_coord_matrix():
60.     c = _coord_matrix(p2, 'left', 2)
61.     assert_allclose(np.array([[1, 1], [0, 0]]), c)
62.     c = _coord_matrix(p2, 'right', 2)
63.     assert_allclose(np.array([[0, 0], [1, 1]]), c)
64.     c = _coord_matrix(p1, 'left', 2)
65.     assert_allclose(np.array([[1], [0]]), c)
66.     c = _coord_matrix(p1, 'left', 1)
67.     assert_allclose(np.array([[1]]), c)
68.     c = _coord_matrix(sh1, 'left', 2)
69.     assert_allclose(np.array([[1], [0]]), c)
70.     c = _coord_matrix(sh1, 'right', 2)
71.     assert_allclose(np.array([[0], [1]]), c)
72.     c = _coord_matrix(sh1, 'right', 3)
73.     assert_allclose(np.array([[0], [0], [1]]), c)
74.     c = _coord_matrix(map3, 'left', 2)
75.     assert_allclose(np.array([[1], [1]]), c)
76.     c = _coord_matrix(map3, 'left', 3)
77.     assert_allclose(np.array([[1], [1], [0]]), c)
78. 
79. 
80. def test_cdot():
81.     result = _cdot(sh1, scl1)
82.     assert_allclose(result, np.array([[1]]))
83. 
84.     result = _cdot(rot, p2)
85.     assert_allclose(result, np.array([[2, 2]]))
86. 
87.     result = _cdot(rot, rot)
88.     assert_allclose(result, np.array([[2, 2], [2, 2]]))
89. 
90.     result = _cdot(Mapping((0, 0)), rot)
91.     assert_allclose(result, np.array([[2], [2]]))
92. 
93.     with pytest.raises(ModelDefinitionError,
94.                        match=r"Models cannot be combined with the \"|\" operator; .*"):
95.         _cdot(sh1, map1)
96. 
97. 
98. def test_cstack():
99.     result = _cstack(sh1, scl1)
100.     assert_allclose(result, np.array([[1, 0], [0, 1]]))
101. 
102.     result = _cstack(sh1, rot)
103.     assert_allclose(result,
104.                     np.array([[1, 0, 0],
105.                               [0, 1, 1],
106.                               [0, 1, 1]])
107.                     )
108.     result = _cstack(rot, sh1)
109.     assert_allclose(result,
110.                     np.array([[1, 1, 0],
111.                               [1, 1, 0],
112.                               [0, 0, 1]])
113.                     )
114. 
115. 
116. def test_arith_oper():
117.     # Models as inputs
118.     result = _arith_oper(sh1, scl1)
119.     assert_allclose(result, np.array([[1]]))
120.     result = _arith_oper(rot, rot)
121.     assert_allclose(result, np.array([[1, 1], [1, 1]]))
122. 
123.     # ndarray
124.     result = _arith_oper(np.array([[1, 2], [3, 4]]), np.array([[1, 2], [3, 4]]))
125.     assert_allclose(result, np.array([[1, 1], [1, 1]]))
126. 
127.     # Error
128.     with pytest.raises(ModelDefinitionError, match=r"Unsupported operands for arithmetic operator: .*"):
129.         _arith_oper(sh1, map1)
130. 
131. 
132. @pytest.mark.parametrize(('compound_model', 'result'), compound_models.values())
133. def test_separable(compound_model, result):
134.     assert_allclose(is_separable(compound_model), result[0])
135.     assert_allclose(separability_matrix(compound_model), result[1])
136. 
137. 
138. def test_custom_model_separable():
139.     @custom_model
140.     def model_a(x):
141.         return x
142. 
143.     assert model_a().separable
144. 
145.     @custom_model
146.     def model_c(x, y):
147.         return x + y
148. 
149.     assert not model_c().separable
150.     assert np.all(separability_matrix(model_c()) == [True, True])

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 08:10:00,507 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly requested the full content of the file `astropy/modeling/tests/test_separable.py`.\n\n2. Extended relevance:\n   - The user's purpose is to find test cases for `separability_matrix` to understand how compound models are tested. This file contains exactly those tests.\n   - The entire file is relevant as it provides the complete context of the tests, including model definitions, helper functions, and various test cases that are crucial for understanding the functionality.", relative_path='astropy/modeling/tests/test_separable.py', start_line=1, end_line=150)]
2025-12-21 08:10:00,508 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file `astropy/modeling/tests/test_separable.py`.
2025-12-21 08:10:00,508 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 08:10:00,508 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 08:10:00,509 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 08:10:00,509 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 08:10:00,509 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── labeler.yml
|   └── workflows
|       ├── cancel_workflows.yml
|       ├── check_changelog.yml
|       ├── ci_cron_daily.yml
|       ├── ci_cron_weekly.yml
|       ├── ci_workflows.yml
|       ├── codeql-analysis.yml
|       ├── open_actions.yml
|       └── stalebot.yml
├── .pep8speaks.yml
├── .pre-commit-config.yaml
├── .pyinstaller
|   ├── hooks
|   |   └── hook-skyfield.py
|   └── run_astropy_tests.py
├── .readthedocs.yml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── LICENSE.rst
├── README.rst
├── astropy
|   ├── __init__.py
|   ├── _dev
|   |   ├── __init__.py
|   |   └── scm_version.py
|   ├── _erfa
|   |   └── __init__.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── affiliated.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── astropyconst40.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── codata2018.py
|   |   ├── config.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_prior_version.py
|   |   |   └── test_sciencestate.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── convolve.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_formats.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── equatorial.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hadec.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── icrs_observed_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── erfa_astrom.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── jparser.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── sky_coordinate_parsers.py
|   |   ├── solar_system.py
|   |   ├── spectral_coordinate.py
|   |   ├── spectral_quantity.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── generate_spectralcoord_ref.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── test_angle_generators.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_erfa_astrom.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_geodetic_representations.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_icrs_observed_transformations.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_spectral_coordinate.py
|   |   |   ├── test_spectral_quantity.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_utils.py
|   |   |   └── test_velocity_corrs.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── connect.py
|   |   ├── core.py
|   |   ├── data
|   |   ├── flrw.py
|   |   ├── funcs.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── cosmology.py
|   |   |   ├── ecsv.py
|   |   |   ├── mapping.py
|   |   |   ├── model.py
|   |   |   ├── row.py
|   |   |   ├── table.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── test_cosmology.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_json.py
|   |   |   |   ├── test_mapping.py
|   |   |   |   ├── test_model.py
|   |   |   |   ├── test_row.py
|   |   |   |   ├── test_table.py
|   |   |   |   └── test_yaml.py
|   |   |   ├── utils.py
|   |   |   └── yaml.py
|   |   ├── parameter.py
|   |   ├── parameters.py
|   |   ├── realizations.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── conftest.py
|   |   |   ├── mypackage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── cosmology.py
|   |   |   |   └── io
|   |   |   ├── test_connect.py
|   |   |   ├── test_core.py
|   |   |   ├── test_cosmology.py
|   |   |   ├── test_flrw.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_parameter.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_realizations.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   ├── units.py
|   |   └── utils.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── _strptime.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── jquery
|   |   |   ├── __init__.py
|   |   |   └── data
|   |   |       ├── css
|   |   |       ├── images
|   |   |       └── js
|   |   └── ply
|   |       ├── __init__.py
|   |       ├── cpp.py
|   |       ├── ctokens.py
|   |       ├── lex.py
|   |       ├── yacc.py
|   |       └── ygen.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── docs.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── mrt.py
|   |   |   ├── qdp.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── data
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_qdp.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── setup_package.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_image_dask.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── connect.py
|   |   |   |   ├── data
|   |   |   |   ├── extension.py
|   |   |   |   ├── tags
|   |   |   |   ├── tests
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pandas
|   |   |   |   ├── __init__.py
|   |   |   |   └── connect.py
|   |   |   ├── parquet.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pandas.py
|   |   |   |   ├── test_parquet.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── compat.py
|   |   |   ├── core.py
|   |   |   ├── interface.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_registries.py
|   |   |       └── test_registry_help.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── mixin_columns.py
|   |   |   └── safeio.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   └── result.py
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── bounding_box.py
|   |   ├── convolution.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── math_functions.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── physical_models.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── setup_package.py
|   |   ├── spline.py
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── __init__.py
|   |   |   |   └── spec.txt
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_bounding_box.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_convolution.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_math_func.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_physical_models.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_spline.py
|   |   |   ├── test_statistics.py
|   |   |   ├── test_units_mapping.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── _testing.py
|   |   ├── bitmask.py
|   |   ├── blocks.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_bitmask.py
|   |   |   ├── test_blocks.py
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── bls
|   |   |   └── __init__.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   └── __init__.py
|   |   ├── setup_package.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   ├── src
|   |   |   ├── compute_bounds.c
|   |   |   ├── fast_sigma_clip.c
|   |   |   └── wirth_select.c
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── connect.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── dask.py
|   |   |   ├── registry.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_dask.py
|   |   |       └── test_registry.py
|   |   ├── ndarray_mixin.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── soco.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── helper.py
|   |   ├── image_tests.py
|   |   ├── runner.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── parse_times.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_custom_formats.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_fast_parser.py
|   |   |   ├── test_functions.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   ├── test_update_leap_seconds.py
|   |   |   └── test_ut1.py
|   |   └── utils.py
|   ├── timeseries
|   |   ├── __init__.py
|   |   ├── binned.py
|   |   ├── core.py
|   |   ├── downsample.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── kepler.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_kepler.py
|   |   ├── periodograms
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── bls
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core.py
|   |   |   |   ├── methods.py
|   |   |   |   ├── setup_package.py
|   |   |   |   └── tests
|   |   |   └── lombscargle
|   |   |       ├── __init__.py
|   |   |       ├── _statistics.py
|   |   |       ├── core.py
|   |   |       ├── implementations
|   |   |       ├── tests
|   |   |       └── utils.py
|   |   ├── sampled.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       ├── test_binned.py
|   |       ├── test_common.py
|   |       ├── test_downsample.py
|   |       └── test_sampled.py
|   ├── uncertainty
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── distributions.py
|   |   └── tests
|   |       ├── __init__.py
|   |       └── test_distribution.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── _typing.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── misc.py
|   |   ├── photometric.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper
|   |   |   ├── __init__.py
|   |   |   ├── converters.py
|   |   |   ├── erfa.py
|   |   |   ├── function_helpers.py
|   |   |   ├── helpers.py
|   |   |   └── scipy_special.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── structured.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_aliases.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_photometric.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_annotations.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_helpers.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_typing.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   ├── test_structured.py
|   |   |   ├── test_structured_erfa_ufuncs.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpycompat.py
|   |   |   └── optional_deps.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── diff.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── update_builtin_iers.sh
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── data
|   |   |       ├── test_iers.py
|   |   |       └── test_leap_second.py
|   |   ├── introspection.py
|   |   ├── masked
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── function_helpers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_containers.py
|   |   |       ├── test_function_helpers.py
|   |   |       ├── test_functions.py
|   |   |       ├── test_masked.py
|   |   |       └── test_table.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── parsing.py
|   |   ├── setup_package.py
|   |   ├── shapes.py
|   |   ├── src
|   |   |   └── compiler.c
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── dataurl
|   |   |   |   ├── dataurl_mirror
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_diff.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_parsing.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_shapes.py
|   |   |   ├── test_state.py
|   |   |   └── test_xml.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── version.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   ├── test_time.py
|   |   |   └── test_units.py
|   |   ├── time.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_grid_paths.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   ├── test_utils.py
|   |       |   └── test_wcsapi.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       ├── utils.py
|   |       └── wcsapi.py
|   └── wcs
|       ├── __init__.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_auxprm_wrap.c
|       |   ├── wcslib_celprm_wrap.c
|       |   ├── wcslib_prjprm_wrap.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   ├── wcslib_wrap.c
|       |   └── wcslib_wtbarr_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   ├── maps
|       |   |   ├── spectra
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   ├── validate.6.txt
|       |   |   ├── validate.7.4.txt
|       |   |   ├── validate.7.6.txt
|       |   |   └── validate.txt
|       |   ├── helper.py
|       |   ├── test_auxprm.py
|       |   ├── test_celprm.py
|       |   ├── test_pickle.py
|       |   ├── test_prjprm.py
|       |   ├── test_profiling.py
|       |   ├── test_tab.py
|       |   ├── test_tabprm.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   ├── test_wcsprm.py
|       |   └── test_wtbarr.py
|       ├── utils.py
|       ├── wcs.py
|       ├── wcsapi
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   └── ucds.txt
|       |   ├── fitswcs.py
|       |   ├── high_level_api.py
|       |   ├── high_level_wcs_wrapper.py
|       |   ├── low_level_api.py
|       |   ├── sliced_low_level_wcs.py
|       |   ├── tests
|       |   |   ├── __init__.py
|       |   |   ├── test_fitswcs.py
|       |   |   ├── test_high_level_api.py
|       |   |   ├── test_high_level_wcs_wrapper.py
|       |   |   ├── test_low_level_api.py
|       |   |   └── test_utils.py
|       |   ├── utils.py
|       |   └── wrappers
|       |       ├── __init__.py
|       |       ├── base.py
|       |       ├── sliced_wcs.py
|       |       └── tests
|       └── wcslint.py
├── azure-pipelines.yml
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.txt
|   |   ├── docs
|   |   |   └── changes.txt
|   |   ├── lib
|   |   |   ├── buffers.c
|   |   |   ├── cfileio.c
|   |   |   ├── checksum.c
|   |   |   ├── drvrfile.c
|   |   |   ├── drvrmem.c
|   |   |   ├── drvrnet.c
|   |   |   ├── drvrsmem.c
|   |   |   ├── editcol.c
|   |   |   ├── edithdu.c
|   |   |   ├── eval_f.c
|   |   |   ├── eval_l.c
|   |   |   ├── eval_y.c
|   |   |   ├── fits_hcompress.c
|   |   |   ├── fits_hdecompress.c
|   |   |   ├── fitscore.c
|   |   |   ├── getcol.c
|   |   |   ├── getcolb.c
|   |   |   ├── getcold.c
|   |   |   ├── getcole.c
|   |   |   ├── getcoli.c
|   |   |   ├── getcolj.c
|   |   |   ├── getcolk.c
|   |   |   ├── getcoll.c
|   |   |   ├── getcols.c
|   |   |   ├── getcolsb.c
|   |   |   ├── getcolui.c
|   |   |   ├── getcoluj.c
|   |   |   ├── getcoluk.c
|   |   |   ├── getkey.c
|   |   |   ├── group.c
|   |   |   ├── grparser.c
|   |   |   ├── histo.c
|   |   |   ├── imcompress.c
|   |   |   ├── iraffits.c
|   |   |   ├── modkey.c
|   |   |   ├── pliocomp.c
|   |   |   ├── putcol.c
|   |   |   ├── putcolb.c
|   |   |   ├── putcold.c
|   |   |   ├── putcole.c
|   |   |   ├── putcoli.c
|   |   |   ├── putcolj.c
|   |   |   ├── putcolk.c
|   |   |   ├── putcoll.c
|   |   |   ├── putcols.c
|   |   |   ├── putcolsb.c
|   |   |   ├── putcolu.c
|   |   |   ├── putcolui.c
|   |   |   ├── putcoluj.c
|   |   |   ├── putcoluk.c
|   |   |   ├── putkey.c
|   |   |   ├── quantize.c
|   |   |   ├── region.c
|   |   |   ├── ricecomp.c
|   |   |   ├── scalnull.c
|   |   |   ├── simplerng.c
|   |   |   ├── swapproc.c
|   |   |   ├── wcssub.c
|   |   |   ├── wcsutil.c
|   |   |   ├── zcompress.c
|   |   |   └── zuncompress.c
|   |   └── zlib
|   |       ├── adler32.c
|   |       ├── crc32.c
|   |       ├── deflate.c
|   |       ├── infback.c
|   |       ├── inffast.c
|   |       ├── inflate.c
|   |       ├── inftrees.c
|   |       ├── trees.c
|   |       ├── uncompr.c
|   |       └── zutil.c
|   ├── expat
|   |   ├── README.md
|   |   ├── README.txt
|   |   └── lib
|   |       ├── xmlparse.c
|   |       ├── xmlrole.c
|   |       ├── xmltok.c
|   |       ├── xmltok_impl.c
|   |       └── xmltok_ns.c
|   ├── trim_cfitsio.sh
|   ├── trim_expat.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── codecov.yml
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── _templates
|   |   └── layout.html
|   ├── changelog.rst
|   ├── changes
|   |   ├── README.rst
|   |   ├── config
|   |   ├── constants
|   |   ├── convolution
|   |   ├── coordinates
|   |   ├── cosmology
|   |   |   ├── 12279.feature.rst
|   |   |   ├── 12313.feature.rst
|   |   |   ├── 12354.api.rst
|   |   |   ├── 12375.api.rst
|   |   |   ├── 12479.feature.rst
|   |   |   ├── 12590.feature.rst
|   |   |   ├── 12606.feature.rst
|   |   |   ├── 12612.api.rst
|   |   |   ├── 12624.api.rst
|   |   |   ├── 12710.feature.rst
|   |   |   ├── 12736.feature.rst
|   |   |   ├── 12740.feature.rst
|   |   |   └── 12746.api.rst
|   |   ├── extern
|   |   ├── io.ascii
|   |   |   ├── 12631.bugfix.rst
|   |   |   └── 12880.bugfix.rst
|   |   ├── io.fits
|   |   |   ├── 11843.feature.rst
|   |   |   └── 12258.api.rst
|   |   ├── io.misc
|   |   |   ├── 10198.feature.rst
|   |   |   ├── 12279.feature.rst
|   |   |   ├── 12800.bugfix.rst
|   |   |   ├── 12895.feature.rst
|   |   |   └── 12897.feature.rst
|   |   ├── io.registry
|   |   ├── io.votable
|   |   |   └── 12604.bugfix.rst
|   |   ├── modeling
|   |   |   ├── 12384.feature.rst
|   |   |   ├── 12558.feature.rst
|   |   |   ├── 12585.api.rst
|   |   |   └── 12900.feature.rst
|   |   ├── nddata
|   |   ├── samp
|   |   ├── stats
|   |   |   └── 12896.bugfix.rst
|   |   ├── table
|   |   |   ├── 12631.api.rst
|   |   |   ├── 12637.api.rst
|   |   |   ├── 12637.feature.rst
|   |   |   ├── 12680.feature.rst
|   |   |   └── 12716.bugfix.rst
|   |   ├── template.rst
|   |   ├── tests
|   |   |   ├── 12633.api.1.rst
|   |   |   ├── 12633.api.2.rst
|   |   |   ├── 12633.api.3.rst
|   |   |   └── 12633.api.4.rst
|   |   ├── time
|   |   |   └── 12888.api.rst
|   |   ├── timeseries
|   |   ├── uncertainty
|   |   ├── units
|   |   |   ├── 12486.feature.rst
|   |   |   ├── 12566.feature.rst
|   |   |   └── 12709.feature.rst
|   |   ├── utils
|   |   ├── visualization
|   |   └── wcs
|   |       ├── 12514.feature.rst
|   |       └── 12844.bugfix.rst
|   ├── common_links.txt
|   ├── conf.py
|   ├── config
|   |   ├── astropy_config.rst
|   |   └── index.rst
|   ├── conftest.py
|   ├── constants
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   ├── performance.inc.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── common_errors.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── performance.inc.rst
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── satellites.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── spectralcoord.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   ├── dev.rst
|   |   ├── index.rst
|   |   ├── io.rst
|   |   └── units.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── docrules.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── style-guide.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   ├── when_to_rebase.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_install.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       ├── patches.rst
|   |       └── virtual_pythons.rst
|   ├── getting_started.rst
|   ├── glossary.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── ecsv.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── asdf-schemas.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   └── usage
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       ├── performance.inc.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── lts_policy.rst
|   ├── modeling
|   |   ├── add-units.rst
|   |   ├── compound-models.rst
|   |   ├── example-fitting-constraints.rst
|   |   ├── example-fitting-line.rst
|   |   ├── example-fitting-model-sets.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── jointfitter.rst
|   |   ├── models.rst
|   |   ├── new-fitter.rst
|   |   ├── new-model.rst
|   |   ├── parameters.rst
|   |   ├── performance.rst
|   |   ├── physical_models.rst
|   |   ├── polynomial_models.rst
|   |   ├── predef_models1D.rst
|   |   ├── predef_models2D.rst
|   |   ├── reference_api.rst
|   |   ├── spline_models.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── bitmask.rst
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── examples
|   |   |   └── cutout2d_tofits.py
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── performance.inc.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── robots.txt
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── performance.inc.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── performance.inc.rst
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── timeseries
|   |   ├── analysis.rst
|   |   ├── bls.rst
|   |   ├── data_access.rst
|   |   ├── index.rst
|   |   ├── initializing.rst
|   |   ├── io.rst
|   |   ├── lombscargle.rst
|   |   ├── masking.rst
|   |   ├── pandas.rst
|   |   └── times.rst
|   ├── uncertainty
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── constants_versions.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── performance.inc.rst
|   |   ├── physical_types.rst
|   |   ├── quantity.rst
|   |   ├── standard_units.rst
|   |   ├── structured_units.rst
|   |   └── type_hints.rst
|   ├── utils
|   |   ├── data.rst
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── masked
|   |       └── index.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── matplotlib_integration.rst
|   |   ├── normalization.rst
|   |   ├── performance.inc.rst
|   |   ├── rgb.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── generic_transforms.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── example_create_imaging.rst
|   |   ├── example_cube_wcs.rst
|   |   ├── examples
|   |   |   ├── cube_wcs.py
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── legacy_interface.rst
|   |   ├── loading_from_fits.rst
|   |   ├── note_sip.rst
|   |   ├── performance.inc.rst
|   |   ├── reference_api.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   ├── relax.rst
|   |   ├── supported_projections.rst
|   |   ├── validation.rst
|   |   ├── wcsapi.rst
|   |   └── wcstools.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       ├── 3.2.rst
|       ├── 4.0.rst
|       ├── 4.1.rst
|       ├── 4.2.rst
|       ├── 4.3.rst
|       ├── 5.0.rst
|       ├── 5.1.rst
|       └── index.rst
├── examples
|   ├── README.rst
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── PYTHON.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
└── setup.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Modeling's `separability_matrix` does not compute separability correctly for nested CompoundModels

Description: Consider the following model:

```python
from astropy.modeling import models as m
from astropy.modeling.separable import separability_matrix

cm = m.Linear1D(10) & m.Linear1D(5)
```

It's separability matrix as you might expect is a diagonal:

```python
>>> separability_matrix(cm)
array([[ True, False],
       [False,  True]])
```

If I make the model more complex:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5))
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True, False],
       [False, False, False,  True]])
```

The output matrix is again, as expected, the outputs and inputs to the linear models are separable and independent of each other.

If however, I nest these compound models:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & cm)
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True,  True],
       [False, False,  True,  True]])
```
Suddenly the inputs and outputs are no longer separable?

This feels like a bug to me, but I might be missing something?

Patch information:
diff --git a/astropy/modeling/separable.py b/astropy/modeling/separable.py
index a308e27297..45bea36085 100644
--- a/astropy/modeling/separable.py
+++ b/astropy/modeling/separable.py
@@ -242,7 +242,7 @@ def _cstack(left, right):
         cright = _coord_matrix(right, 'right', noutp)
     else:
         cright = np.zeros((noutp, right.shape[1]))
-        cright[-right.shape[0]:, -right.shape[1]:] = 1
+        cright[-right.shape[0]:, -right.shape[1]:] = right
 
     return np.hstack([cleft, cright])
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `astropy/modeling/tests/test_separable.py`.
Extra Requirements: 
Purpose: I need to find existing test cases for `separability_matrix` to see how compound models are tested and to find examples similar to the user's bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: astropy/modeling/tests/test_separable.py
Line number range: 1 - 150
Content:
1. # Licensed under a 3-clause BSD style license - see LICENSE.rst
2. """
3. Test separability of models.
4. 
5. """
6. # pylint: disable=invalid-name
7. import pytest
8. import numpy as np
9. from numpy.testing import assert_allclose
10. 
11. from astropy.modeling import custom_model, models
12. from astropy.modeling.models import Mapping
13. from astropy.modeling.separable import (_coord_matrix, is_separable, _cdot,
14.                                         _cstack, _arith_oper, separability_matrix)
15. from astropy.modeling.core import ModelDefinitionError
16. 
17. 
18. sh1 = models.Shift(1, name='shift1')
19. sh2 = models.Shift(2, name='sh2')
20. scl1 = models.Scale(1, name='scl1')
21. scl2 = models.Scale(2, name='scl2')
22. map1 = Mapping((0, 1, 0, 1), name='map1')
23. map2 = Mapping((0, 0, 1), name='map2')
24. map3 = Mapping((0, 0), name='map3')
25. rot = models.Rotation2D(2, name='rotation')
26. p2 = models.Polynomial2D(1, name='p2')
27. p22 = models.Polynomial2D(2, name='p22')
28. p1 = models.Polynomial1D(1, name='p1')
29. 
30. 
31. compound_models = {
32.     'cm1': (map3 & sh1 | rot & sh1 | sh1 & sh2 & sh1,
33.             (np.array([False, False, True]),
34.              np.array([[True, False], [True, False], [False, True]]))
35.             ),
36.     'cm2': (sh1 & sh2 | rot | map1 | p2 & p22,
37.             (np.array([False, False]),
38.              np.array([[True, True], [True, True]]))
39.             ),
40.     'cm3': (map2 | rot & scl1,
41.             (np.array([False, False, True]),
42.              np.array([[True, False], [True, False], [False, True]]))
43.             ),
44.     'cm4': (sh1 & sh2 | map2 | rot & scl1,
45.             (np.array([False, False, True]),
46.              np.array([[True, False], [True, False], [False, True]]))
47.             ),
48.     'cm5': (map3 | sh1 & sh2 | scl1 & scl2,
49.             (np.array([False, False]),
50.              np.array([[True], [True]]))
51.             ),
52.     'cm7': (map2 | p2 & sh1,
53.             (np.array([False, True]),
54.              np.array([[True, False], [False, True]]))
55.             )
56. }
57. 
58. 
59. def test_coord_matrix():
60.     c = _coord_matrix(p2, 'left', 2)
61.     assert_allclose(np.array([[1, 1], [0, 0]]), c)
62.     c = _coord_matrix(p2, 'right', 2)
63.     assert_allclose(np.array([[0, 0], [1, 1]]), c)
64.     c = _coord_matrix(p1, 'left', 2)
65.     assert_allclose(np.array([[1], [0]]), c)
66.     c = _coord_matrix(p1, 'left', 1)
67.     assert_allclose(np.array([[1]]), c)
68.     c = _coord_matrix(sh1, 'left', 2)
69.     assert_allclose(np.array([[1], [0]]), c)
70.     c = _coord_matrix(sh1, 'right', 2)
71.     assert_allclose(np.array([[0], [1]]), c)
72.     c = _coord_matrix(sh1, 'right', 3)
73.     assert_allclose(np.array([[0], [0], [1]]), c)
74.     c = _coord_matrix(map3, 'left', 2)
75.     assert_allclose(np.array([[1], [1]]), c)
76.     c = _coord_matrix(map3, 'left', 3)
77.     assert_allclose(np.array([[1], [1], [0]]), c)
78. 
79. 
80. def test_cdot():
81.     result = _cdot(sh1, scl1)
82.     assert_allclose(result, np.array([[1]]))
83. 
84.     result = _cdot(rot, p2)
85.     assert_allclose(result, np.array([[2, 2]]))
86. 
87.     result = _cdot(rot, rot)
88.     assert_allclose(result, np.array([[2, 2], [2, 2]]))
89. 
90.     result = _cdot(Mapping((0, 0)), rot)
91.     assert_allclose(result, np.array([[2], [2]]))
92. 
93.     with pytest.raises(ModelDefinitionError,
94.                        match=r"Models cannot be combined with the \"|\" operator; .*"):
95.         _cdot(sh1, map1)
96. 
97. 
98. def test_cstack():
99.     result = _cstack(sh1, scl1)
100.     assert_allclose(result, np.array([[1, 0], [0, 1]]))
101. 
102.     result = _cstack(sh1, rot)
103.     assert_allclose(result,
104.                     np.array([[1, 0, 0],
105.                               [0, 1, 1],
106.                               [0, 1, 1]])
107.                     )
108.     result = _cstack(rot, sh1)
109.     assert_allclose(result,
110.                     np.array([[1, 1, 0],
111.                               [1, 1, 0],
112.                               [0, 0, 1]])
113.                     )
114. 
115. 
116. def test_arith_oper():
117.     # Models as inputs
118.     result = _arith_oper(sh1, scl1)
119.     assert_allclose(result, np.array([[1]]))
120.     result = _arith_oper(rot, rot)
121.     assert_allclose(result, np.array([[1, 1], [1, 1]]))
122. 
123.     # ndarray
124.     result = _arith_oper(np.array([[1, 2], [3, 4]]), np.array([[1, 2], [3, 4]]))
125.     assert_allclose(result, np.array([[1, 1], [1, 1]]))
126. 
127.     # Error
128.     with pytest.raises(ModelDefinitionError, match=r"Unsupported operands for arithmetic operator: .*"):
129.         _arith_oper(sh1, map1)
130. 
131. 
132. @pytest.mark.parametrize(('compound_model', 'result'), compound_models.values())
133. def test_separable(compound_model, result):
134.     assert_allclose(is_separable(compound_model), result[0])
135.     assert_allclose(separability_matrix(compound_model), result[1])
136. 
137. 
138. def test_custom_model_separable():
139.     @custom_model
140.     def model_a(x):
141.         return x
142. 
143.     assert model_a().separable
144. 
145.     @custom_model
146.     def model_c(x, y):
147.         return x + y
148. 
149.     assert not model_c().separable
150.     assert np.all(separability_matrix(model_c()) == [True, True])

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 08:10:16,125 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug report highlights an issue with `separability_matrix` when dealing with nested compound models. The provided context from `astropy/modeling/tests/test_separable.py` contains tests for compound models, but none of them seem to replicate the specific nested structure `A & (B & C)` that triggers the bug. To find more relevant test cases, I need to examine tests that specifically focus on the creation and behavior of compound models. The file `astropy/modeling/tests/test_compound.py` is the most logical place to find such tests." query='Please provide the full content of the file `astropy/modeling/tests/test_compound.py`.' extra_requirements='' purpose="I need to find test cases that construct and test nested compound models to find examples that are structurally similar to the user's bug report."
2025-12-21 08:10:16,126 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of the file `astropy/modeling/tests/test_compound.py`.
2025-12-21 08:10:16,126 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 08:10:16,127 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 08:10:16,127 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 08:10:16,127 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of the file `astropy/modeling/tests/test_compound.py`.
Purpose: I need to find test cases that construct and test nested compound models to find examples that are structurally similar to the user's bug report.
2025-12-21 08:10:18,691 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the full content of the file `astropy/modeling/tests/test_compound.py` as you requested. This will allow you to examine the test cases for nested compound models and identify examples that are relevant to the user's bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "astropy/modeling/tests/test_compound.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2125, 'candidates_token_count': 80, 'total_token_count': 2332, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2125}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 80}], 'thoughts_token_count': 127, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1064785361289978, 'model_name': 'gemini-2.5-pro'} id='run--88b9345d-c66e-45e1-8ca6-158a2d4fd7aa-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'astropy/modeling/tests/test_compound.py'}, 'id': 'b2c55698-39cf-417a-ae1b-8da124a7cd8f', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2125, 'output_tokens': 80, 'total_tokens': 2332, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 127}}
2025-12-21 08:10:27,641 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the file `astropy/modeling/tests/test_compound.py` to find test cases involving nested compound models. My search identified several relevant examples, including tests for the number of submodels, expression formatting, and model composition. Specifically, functions like `test_n_submodels` and `test_expression_formatting` create and test compound models that are composed of other compound models, which should provide you with the structurally similar examples you need.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10333, 'candidates_token_count': 96, 'total_token_count': 11297, 'cached_content_token_count': 1853, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10333}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1853}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 96}], 'thoughts_token_count': 868}, 'finish_reason': 'STOP', 'avg_logprobs': -0.7829415003458658, 'model_name': 'gemini-2.5-pro'} id='run--15a449d4-5728-425b-af61-afb9c3120563-0' usage_metadata={'input_tokens': 10333, 'output_tokens': 96, 'total_tokens': 11297, 'input_token_details': {'cache_read': 1853}, 'output_token_details': {'reasoning': 868}}
2025-12-21 08:10:27,643 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of the file `astropy/modeling/tests/test_compound.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find test cases that construct and test nested compound models to find examples that are structurally similar to the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: astropy/modeling/tests/test_compound.py
Line number range: 1 - 500
Content:
1. # Licensed under a 3-clause BSD style license - see LICENSE.rst
2. # pylint: disable=invalid-name, pointless-statement
3. 
4. import pickle
5. import pytest
6. 
7. import numpy as np
8. 
9. from numpy.testing import assert_allclose, assert_array_equal
10. 
11. from astropy.utils import minversion
12. from astropy.modeling.core import Model, ModelDefinitionError, CompoundModel
13. from astropy.modeling.parameters import Parameter
14. from astropy.modeling.models import (Const1D, Shift, Scale, Rotation2D, Gaussian1D,
15.                                      Gaussian2D, Polynomial1D, Polynomial2D,
16.                                      Chebyshev2D, Legendre2D, Chebyshev1D, Legendre1D,
17.                                      Identity, Mapping, Linear1D,
18.                                      Tabular1D, fix_inputs,)
19. from astropy.modeling.fitting import LevMarLSQFitter
20. import astropy.units as u
21. from astropy.utils.compat.optional_deps import HAS_SCIPY  # noqa
22. 
23. 
24. @pytest.mark.parametrize(('expr', 'result'),
25.                          [(lambda x, y: x + y, [5.0, 5.0]),
26.                           (lambda x, y: x - y, [-1.0, -1.0]),
27.                           (lambda x, y: x * y, [6.0, 6.0]),
28.                           (lambda x, y: x / y, [2.0 / 3.0, 2.0 / 3.0]),
29.                           (lambda x, y: x ** y, [8.0, 8.0])])
30. def test_model_set(expr, result):
31.     s = expr(Const1D((2, 2), n_models=2), Const1D((3, 3), n_models=2))
32.     out = s(0, model_set_axis=False)
33.     assert_array_equal(out, result)
34. 
35. 
36. @pytest.mark.parametrize(('expr', 'result'),
37.                          [(lambda x, y: x + y, [5.0, 5.0]),
38.                           (lambda x, y: x - y, [-1.0, -1.0]),
39.                           (lambda x, y: x * y, [6.0, 6.0]),
40.                           (lambda x, y: x / y, [2.0 / 3.0, 2.0 / 3.0]),
41.                           (lambda x, y: x ** y, [8.0, 8.0])])
42. def test_model_set_raises_value_error(expr, result):
43.     """Check that creating model sets with components whose _n_models are
44.        different raise a value error
45.     """
46.     with pytest.raises(ValueError):
47.         expr(Const1D((2, 2), n_models=2), Const1D(3, n_models=1))
48. 
49. 
50. @pytest.mark.parametrize(('expr', 'result'),
51.                          [(lambda x, y: x + y, 5.0),
52.                           (lambda x, y: x - y, -1.0),
53.                           (lambda x, y: x * y, 6.0),
54.                           (lambda x, y: x / y, 2.0 / 3.0),
55.                           (lambda x, y: x ** y, 8.0)])
56. def test_two_model_instance_arithmetic_1d(expr, result):
57.     """
58.     Like test_two_model_class_arithmetic_1d, but creates a new model from two
59.     model *instances* with fixed parameters.
60.     """
61. 
62.     s = expr(Const1D(2), Const1D(3))
63. 
64.     assert isinstance(s, CompoundModel)
65.     assert s.n_inputs == 1
66.     assert s.n_outputs == 1
67. 
68.     out = s(0)
69.     assert out == result
70. 
71.     assert isinstance(out, float)
72. 
73. 
74. def test_simple_two_model_compose_1d():
75.     """
76.     Shift and Scale are two of the simplest models to test model composition
77.     with.
78.     """
79. 
80.     S1 = Shift(2) | Scale(3)  # First shift then scale
81.     assert isinstance(S1, CompoundModel)
82.     assert S1.n_inputs == 1
83.     assert S1.n_outputs == 1
84.     assert S1(1) == 9.0
85. 
86.     S2 = Scale(2) | Shift(3)  # First scale then shift
87.     assert isinstance(S2, CompoundModel)
88.     assert S2.n_inputs == 1
89.     assert S2.n_outputs == 1
90.     assert S2(1) == 5.0
91. 
92.     # Test with array inputs
93.     assert_array_equal(S2([1, 2, 3]), [5.0, 7.0, 9.0])
94. 
95. 
96. def test_simple_two_model_compose_2d():
97.     """
98.     A simple example consisting of two rotations.
99.     """
100. 
101.     r1 = Rotation2D(45) | Rotation2D(45)
102. 
103.     assert isinstance(r1, CompoundModel)
104.     assert r1.n_inputs == 2
105.     assert r1.n_outputs == 2
106.     assert_allclose(r1(0, 1), (-1, 0), atol=1e-10)
107. 
108.     r2 = Rotation2D(90) | Rotation2D(90)  # Rotate twice by 90 degrees
109.     assert_allclose(r2(0, 1), (0, -1), atol=1e-10)
110. 
111.     # Compose R with itself to produce 4 rotations
112.     r3 = r1 | r1
113. 
114.     assert_allclose(r3(0, 1), (0, -1), atol=1e-10)
115. 
116. 
117. def test_n_submodels():
118.     """
119.     Test that CompoundModel.n_submodels properly returns the number
120.     of components.
121.     """
122. 
123.     g2 = Gaussian1D() + Gaussian1D()
124.     assert g2.n_submodels == 2
125. 
126.     g3 = g2 + Gaussian1D()
127.     assert g3.n_submodels == 3
128. 
129.     g5 = g3 | g2
130.     assert g5.n_submodels == 5
131. 
132.     g7 = g5 / g2
133.     assert g7.n_submodels == 7
134. 
135. 
136. def test_expression_formatting():
137.     """
138.     Test that the expression strings from compound models are formatted
139.     correctly.
140.     """
141. 
142.     # For the purposes of this test it doesn't matter a great deal what
143.     # model(s) are used in the expression, I don't think
144.     G = Gaussian1D(1, 1, 1)
145.     G2 = Gaussian2D(1, 2, 3, 4, 5, 6)
146. 
147.     M = G + G
148.     assert M._format_expression() == '[0] + [1]'
149. 
150.     M = G + G + G
151.     assert M._format_expression() == '[0] + [1] + [2]'
152. 
153.     M = G + G * G
154.     assert M._format_expression() == '[0] + [1] * [2]'
155. 
156.     M = G * G + G
157.     assert M._format_expression() == '[0] * [1] + [2]'
158. 
159.     M = G + G * G + G
160.     assert M._format_expression() == '[0] + [1] * [2] + [3]'
161. 
162.     M = (G + G) * (G + G)
163.     assert M._format_expression() == '([0] + [1]) * ([2] + [3])'
164. 
165.     # This example uses parentheses in the expression, but those won't be
166.     # preserved in the expression formatting since they technically aren't
167.     # necessary, and there's no way to know that they were originally
168.     # parenthesized (short of some deep, and probably not worthwhile
169.     # introspection)
170.     M = (G * G) + (G * G)
171.     assert M._format_expression() == '[0] * [1] + [2] * [3]'
172. 
173.     M = G ** G
174.     assert M._format_expression() == '[0] ** [1]'
175. 
176.     M = G + G ** G
177.     assert M._format_expression() == '[0] + [1] ** [2]'
178. 
179.     M = (G + G) ** G
180.     assert M._format_expression() == '([0] + [1]) ** [2]'
181. 
182.     M = G + G | G
183.     assert M._format_expression() == '[0] + [1] | [2]'
184. 
185.     M = G + (G | G)
186.     assert M._format_expression() == '[0] + ([1] | [2])'
187. 
188.     M = G & G | G2
189.     assert M._format_expression() == '[0] & [1] | [2]'
190. 
191.     M = G & (G | G)
192.     assert M._format_expression() == '[0] & ([1] | [2])'
193. 
194. 
195. def test_basic_compound_inverse():
196.     """
197.     Test basic inversion of compound models in the limited sense supported for
198.     models made from compositions and joins only.
199.     """
200. 
201.     t = (Shift(2) & Shift(3)) | (Scale(2) & Scale(3)) | Rotation2D(90)
202.     assert_allclose(t.inverse(*t(0, 1)), (0, 1))
203. 
204. 
205. @pytest.mark.parametrize('model', [
206.     Shift(0) + Shift(0) | Shift(0),
207.     Shift(0) - Shift(0) | Shift(0),
208.     Shift(0) * Shift(0) | Shift(0),
209.     Shift(0) / Shift(0) | Shift(0),
210.     Shift(0) ** Shift(0) | Shift(0),
211.     Gaussian1D(1, 2, 3) | Gaussian1D(4, 5, 6)])
212. def test_compound_unsupported_inverse(model):
213.     """
214.     Ensure inverses aren't supported in cases where it shouldn't be.
215.     """
216. 
217.     with pytest.raises(NotImplementedError):
218.         model.inverse
219. 
220. 
221. def test_mapping_basic_permutations():
222.     """
223.     Tests a couple basic examples of the Mapping model--specifically examples
224.     that merely permute the outputs.
225.     """
226. 
227.     x, y = Rotation2D(90)(1, 2)
228. 
229.     rs = Rotation2D(90) | Mapping((1, 0))
230.     x_prime, y_prime = rs(1, 2)
231.     assert_allclose((x, y), (y_prime, x_prime))
232. 
233.     # A more complicated permutation
234.     m = Rotation2D(90) & Scale(2)
235.     x, y, z = m(1, 2, 3)
236. 
237.     ms = m | Mapping((2, 0, 1))
238.     x_prime, y_prime, z_prime = ms(1, 2, 3)
239.     assert_allclose((x, y, z), (y_prime, z_prime, x_prime))
240. 
241. 
242. def test_mapping_inverse():
243.     """Tests inverting a compound model that includes a `Mapping`."""
244. 
245.     rs1 = Rotation2D(12.1) & Scale(13.2)
246.     rs2 = Rotation2D(14.3) & Scale(15.4)
247. 
248.     # Rotates 2 of the coordinates and scales the third--then rotates on a
249.     # different axis and scales on the axis of rotation.  No physical meaning
250.     # here just a simple test
251.     m = rs1 | Mapping([2, 0, 1]) | rs2
252. 
253.     assert_allclose((0, 1, 2), m.inverse(*m(0, 1, 2)), atol=1e-08)
254. 
255. 
256. def test_identity_input():
257.     """
258.     Test a case where an Identity (or Mapping) model is the first in a chain
259.     of composite models and thus is responsible for handling input broadcasting
260.     properly.
261. 
262.     Regression test for https://github.com/astropy/astropy/pull/3362
263.     """
264. 
265.     ident1 = Identity(1)
266.     shift = Shift(1)
267.     rotation = Rotation2D(angle=90)
268.     model = ident1 & shift | rotation
269.     assert_allclose(model(1, 2), [-3.0, 1.0])
270. 
271. 
272. def test_invalid_operands():
273.     """
274.     Test that certain operators do not work with models whose inputs/outputs do
275.     not match up correctly.
276.     """
277. 
278.     with pytest.raises(ModelDefinitionError):
279.         Rotation2D(90) | Gaussian1D(1, 0, 0.1)
280. 
281.     with pytest.raises(ModelDefinitionError):
282.         Rotation2D(90) + Gaussian1D(1, 0, 0.1)
283. 
284. 
285. @pytest.mark.parametrize('poly', [Chebyshev2D(1, 2), Polynomial2D(2), Legendre2D(1, 2)])
286. def test_compound_with_polynomials_2d(poly):
287.     """
288.     Tests that polynomials are scaled when used in compound models.
289.     Issue #3699
290.     """
291.     poly.parameters = [1, 2, 3, 4, 1, 2]
292.     shift = Shift(3)
293.     model = poly | shift
294.     x, y = np.mgrid[:20, :37]
295.     result_compound = model(x, y)
296.     result = shift(poly(x, y))
297.     assert_allclose(result, result_compound)
298. 
299. 
300. def test_fix_inputs():
301.     g1 = Gaussian2D(1, 0, 0, 1, 2)
302.     g2 = Gaussian2D(1.5, .5, -.2, .5, .3)
303.     sg1_1 = fix_inputs(g1, {1: 0})
304.     assert_allclose(sg1_1(0), g1(0, 0))
305.     assert_allclose(sg1_1([0, 1, 3]), g1([0, 1, 3], [0, 0, 0]))
306.     sg1_2 = fix_inputs(g1, {'x': 1})
307.     assert_allclose(sg1_2(1.5), g1(1, 1.5))
308.     gg1 = g1 & g2
309.     sgg1_1 = fix_inputs(gg1, {1: 0.1, 3: 0.2})
310.     assert_allclose(sgg1_1(0, 0), gg1(0, 0.1, 0, 0.2))
311.     sgg1_2 = fix_inputs(gg1, {'x0': -.1, 2: .1})
312.     assert_allclose(sgg1_2(1, 1), gg1(-0.1, 1, 0.1, 1))
313.     assert_allclose(sgg1_2(y0=1, y1=1), gg1(-0.1, 1, 0.1, 1))
314. 
315. 
316. def test_fix_inputs_invalid():
317.     g1 = Gaussian2D(1, 0, 0, 1, 2)
318.     with pytest.raises(ValueError):
319.         fix_inputs(g1, {'x0': 0, 0: 0})
320. 
321.     with pytest.raises(ValueError):
322.         fix_inputs(g1, (0, 1))
323. 
324.     with pytest.raises(ValueError):
325.         fix_inputs(g1, {3: 2})
326. 
327.     with pytest.raises(ValueError):
328.         fix_inputs(g1, {np.int32(3): 2})
329. 
330.     with pytest.raises(ValueError):
331.         fix_inputs(g1, {np.int64(3): 2})
332. 
333.     with pytest.raises(ValueError):
334.         fix_inputs(g1, {'w': 2})
335. 
336.     with pytest.raises(ModelDefinitionError):
337.         CompoundModel('#', g1, g1)
338. 
339.     with pytest.raises(ValueError):
340.         gg1 = fix_inputs(g1, {0: 1})
341.         gg1(2, y=2)
342. 
343.     with pytest.raises(ValueError):
344.         gg1 = fix_inputs(g1, {np.int32(0): 1})
345.         gg1(2, y=2)
346. 
347.     with pytest.raises(ValueError):
348.         gg1 = fix_inputs(g1, {np.int64(0): 1})
349.         gg1(2, y=2)
350. 
351. 
352. def test_fix_inputs_with_bounding_box():
353.     g1 = Gaussian2D(1, 0, 0, 1, 1)
354.     g2 = Gaussian2D(1, 0, 0, 1, 1)
355.     assert g1.bounding_box == ((-5.5, 5.5), (-5.5, 5.5))
356. 
357.     gg1 = g1 & g2
358.     gg1.bounding_box = ((-5.5, 5.5), (-5.4, 5.4), (-5.3, 5.3), (-5.2, 5.2))
359.     assert gg1.bounding_box == ((-5.5, 5.5), (-5.4, 5.4), (-5.3, 5.3), (-5.2, 5.2))
360. 
361.     sg = fix_inputs(gg1, {0: 0, 2: 0})
362.     assert sg.bounding_box == ((-5.5, 5.5), (-5.3, 5.3))
363. 
364.     g1 = Gaussian1D(10, 3, 1)
365.     g = g1 & g1
366.     g.bounding_box = ((1, 4), (6, 8))
367.     gf = fix_inputs(g, {0: 1})
368.     assert gf.bounding_box == (1, 4)
369. 
370. 
371. def test_indexing_on_instance():
372.     """Test indexing on compound model instances."""
373. 
374.     m = Gaussian1D(1, 0, 0.1) + Const1D(2)
375.     assert isinstance(m[0], Gaussian1D)
376.     assert isinstance(m[1], Const1D)
377.     assert m.param_names == ('amplitude_0', 'mean_0', 'stddev_0', 'amplitude_1')
378. 
379.     # Test parameter equivalence
380.     assert m[0].amplitude == 1 == m.amplitude_0
381.     assert m[0].mean == 0 == m.mean_0
382.     assert m[0].stddev == 0.1 == m.stddev_0
383.     assert m[1].amplitude == 2 == m.amplitude_1
384. 
385.     # Test that parameter value updates are symmetric between the compound
386.     # model and the submodel returned by indexing
387.     const = m[1]
388.     m.amplitude_1 = 42
389.     assert const.amplitude == 42
390.     const.amplitude = 137
391.     assert m.amplitude_1 == 137
392. 
393.     # Similar couple of tests, but now where the compound model was created
394.     # from model instances
395.     g = Gaussian1D(1, 2, 3, name='g')
396.     p = Polynomial1D(2, name='p')
397.     m = g + p
398.     assert m[0].name == 'g'
399.     assert m[1].name == 'p'
400.     assert m['g'].name == 'g'
401.     assert m['p'].name == 'p'
402. 
403.     poly = m[1]
404.     m.c0_1 = 12345
405.     assert poly.c0 == 12345
406.     poly.c1 = 6789
407.     assert m.c1_1 == 6789
408. 
409.     # Test negative indexing
410.     assert isinstance(m[-1], Polynomial1D)
411.     assert isinstance(m[-2], Gaussian1D)
412. 
413.     with pytest.raises(IndexError):
414.         m[42]
415. 
416.     with pytest.raises(IndexError):
417.         m['foobar']
418. 
419.     # Confirm index-by-name works with fix_inputs
420.     g = Gaussian2D(1, 2, 3, 4, 5, name='g')
421.     m = fix_inputs(g, {0: 1})
422.     assert m['g'].name == 'g'
423. 
424.     # Test string slicing
425.     A = Const1D(1.1, name='A')
426.     B = Const1D(2.1, name='B')
427.     C = Const1D(3.1, name='C')
428.     M = A + B * C
429.     assert_allclose(M['B':'C'](1), 6.510000000000001)
430. 
431. 
432. class _ConstraintsTestA(Model):
433.     stddev = Parameter(default=0, min=0, max=0.3)
434.     mean = Parameter(default=0, fixed=True)
435. 
436.     @staticmethod
437.     def evaluate(stddev, mean):
438.         return stddev, mean
439. 
440. 
441. class _ConstraintsTestB(Model):
442.     mean = Parameter(default=0, fixed=True)
443. 
444.     @staticmethod
445.     def evaluate(mean):
446.         return mean
447. 
448. 
449. def test_inherit_constraints():
450.     """
451.     Various tests for copying of constraint values between compound models and
452.     their members.
453. 
454.     Regression test for https://github.com/astropy/astropy/issues/3481
455.     """
456.     model = (Gaussian1D(bounds={'stddev': (0, 0.3)}, fixed={'mean': True}) +
457.              Gaussian1D(fixed={'mean': True}))
458. 
459.     # Lots of assertions in this test as there are multiple interfaces to
460.     # parameter constraints
461. 
462.     assert 'stddev_0' in model.bounds
463.     assert model.bounds['stddev_0'] == (0, 0.3)
464.     assert model.stddev_0.bounds == (0, 0.3)
465.     assert 'mean_0' in model.fixed
466.     assert model.fixed['mean_0'] is True
467.     assert model.mean_0.fixed is True
468.     assert 'mean_1' in model.fixed
469.     assert model.fixed['mean_1'] is True
470.     assert model.mean_1.fixed is True
471. 
472.     assert model.stddev_0 is model[0].stddev
473.     # Great, all the constraints were inherited properly
474.     # Now what about if we update them through the sub-models?
475.     model.stddev_0.bounds = (0, 0.4)
476.     assert model[0].stddev.bounds == (0, 0.4)
477.     assert model[0].bounds['stddev'] == (0, 0.4)
478. 
479.     model.stddev_0.bounds = (0.1, 0.5)
480.     assert model[0].stddev.bounds == (0.1, 0.5)
481.     assert model[0].bounds['stddev'] == (0.1, 0.5)
482. 
483.     model[1].mean.fixed = False
484.     assert model.mean_1.fixed is False
485.     assert model[1].mean.fixed is False
486. 
487.     # Now turn off syncing of constraints
488.     assert model.bounds['stddev_0']  == (0.1, 0.5)
489.     model.sync_constraints = False
490.     model[0].stddev.bounds = (0, 0.2)
491.     assert model.bounds['stddev_0'] == (0.1, 0.5)
492.     model.sync_constraints = True
493.     assert model.bounds['stddev_0'] == (0, 0.2)
494. 
495. 
496. def test_compound_custom_inverse():
497.     """
498.     Test that a compound model with a custom inverse has that inverse applied
499.     when the inverse of another model, of which it is a component, is computed.
500.     Regression test for https://github.com/astropy/astropy/issues/3542

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 08:10:33,449 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user explicitly requested the full content of the file `astropy/modeling/tests/test_compound.py`.\n\n2. Extended relevance:\n   - The purpose is to find test cases for nested compound models. Providing the entire test file is the most direct way to satisfy this request, as it contains all relevant examples within that file.', relative_path='astropy/modeling/tests/test_compound.py', start_line=1, end_line=500)]
2025-12-21 08:10:33,451 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of the file `astropy/modeling/tests/test_compound.py`.
2025-12-21 08:10:33,451 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 08:10:33,451 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 08:10:33,452 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-21 08:10:33,452 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 08:10:33,453 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
astropy
├── .circleci
|   └── config.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.md
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── labeler.yml
|   └── workflows
|       ├── cancel_workflows.yml
|       ├── check_changelog.yml
|       ├── ci_cron_daily.yml
|       ├── ci_cron_weekly.yml
|       ├── ci_workflows.yml
|       ├── codeql-analysis.yml
|       ├── open_actions.yml
|       └── stalebot.yml
├── .pep8speaks.yml
├── .pre-commit-config.yaml
├── .pyinstaller
|   ├── hooks
|   |   └── hook-skyfield.py
|   └── run_astropy_tests.py
├── .readthedocs.yml
├── CHANGES.rst
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── LICENSE.rst
├── README.rst
├── astropy
|   ├── __init__.py
|   ├── _dev
|   |   ├── __init__.py
|   |   └── scm_version.py
|   ├── _erfa
|   |   └── __init__.py
|   ├── config
|   |   ├── __init__.py
|   |   ├── affiliated.py
|   |   ├── configuration.py
|   |   ├── paths.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       └── test_configs.py
|   ├── conftest.py
|   ├── constants
|   |   ├── __init__.py
|   |   ├── astropyconst13.py
|   |   ├── astropyconst20.py
|   |   ├── astropyconst40.py
|   |   ├── cgs.py
|   |   ├── codata2010.py
|   |   ├── codata2014.py
|   |   ├── codata2018.py
|   |   ├── config.py
|   |   ├── constant.py
|   |   ├── iau2012.py
|   |   ├── iau2015.py
|   |   ├── si.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_constant.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_prior_version.py
|   |   |   └── test_sciencestate.py
|   |   └── utils.py
|   ├── convolution
|   |   ├── __init__.py
|   |   ├── convolve.py
|   |   ├── core.py
|   |   ├── kernels.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── convolve.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_convolve.py
|   |   |   ├── test_convolve_fft.py
|   |   |   ├── test_convolve_kernels.py
|   |   |   ├── test_convolve_models.py
|   |   |   ├── test_convolve_nddata.py
|   |   |   ├── test_convolve_speeds.py
|   |   |   ├── test_discretize.py
|   |   |   ├── test_kernel_class.py
|   |   |   └── test_pickle.py
|   |   └── utils.py
|   ├── coordinates
|   |   ├── __init__.py
|   |   ├── angle_formats.py
|   |   ├── angle_lextab.py
|   |   ├── angle_parsetab.py
|   |   ├── angle_utilities.py
|   |   ├── angles.py
|   |   ├── attributes.py
|   |   ├── baseframe.py
|   |   ├── builtin_frames
|   |   |   ├── __init__.py
|   |   |   ├── altaz.py
|   |   |   ├── baseradec.py
|   |   |   ├── cirs.py
|   |   |   ├── cirs_observed_transforms.py
|   |   |   ├── ecliptic.py
|   |   |   ├── ecliptic_transforms.py
|   |   |   ├── equatorial.py
|   |   |   ├── fk4.py
|   |   |   ├── fk4_fk5_transforms.py
|   |   |   ├── fk5.py
|   |   |   ├── galactic.py
|   |   |   ├── galactic_transforms.py
|   |   |   ├── galactocentric.py
|   |   |   ├── gcrs.py
|   |   |   ├── hadec.py
|   |   |   ├── hcrs.py
|   |   |   ├── icrs.py
|   |   |   ├── icrs_cirs_transforms.py
|   |   |   ├── icrs_fk5_transforms.py
|   |   |   ├── icrs_observed_transforms.py
|   |   |   ├── intermediate_rotation_transforms.py
|   |   |   ├── itrs.py
|   |   |   ├── lsr.py
|   |   |   ├── skyoffset.py
|   |   |   ├── supergalactic.py
|   |   |   ├── supergalactic_transforms.py
|   |   |   └── utils.py
|   |   ├── calculation.py
|   |   ├── data
|   |   ├── distances.py
|   |   ├── earth.py
|   |   ├── earth_orientation.py
|   |   ├── erfa_astrom.py
|   |   ├── errors.py
|   |   ├── funcs.py
|   |   ├── jparser.py
|   |   ├── matching.py
|   |   ├── matrix_utilities.py
|   |   ├── name_resolve.py
|   |   ├── orbital_elements.py
|   |   ├── representation.py
|   |   ├── sites.py
|   |   ├── sky_coordinate.py
|   |   ├── sky_coordinate_parsers.py
|   |   ├── solar_system.py
|   |   ├── spectral_coordinate.py
|   |   ├── spectral_quantity.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── accuracy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── generate_ref_ast.py
|   |   |   |   ├── generate_spectralcoord_ref.py
|   |   |   |   ├── test_altaz_icrs.py
|   |   |   |   ├── test_ecliptic.py
|   |   |   |   ├── test_fk4_no_e_fk4.py
|   |   |   |   ├── test_fk4_no_e_fk5.py
|   |   |   |   ├── test_galactic_fk4.py
|   |   |   |   └── test_icrs_fk5.py
|   |   |   ├── test_angle_generators.py
|   |   |   ├── test_angles.py
|   |   |   ├── test_angular_separation.py
|   |   |   ├── test_api_ape5.py
|   |   |   ├── test_arrays.py
|   |   |   ├── test_atc_replacements.py
|   |   |   ├── test_celestial_transformations.py
|   |   |   ├── test_distance.py
|   |   |   ├── test_earth.py
|   |   |   ├── test_erfa_astrom.py
|   |   |   ├── test_finite_difference_velocities.py
|   |   |   ├── test_formatting.py
|   |   |   ├── test_frames.py
|   |   |   ├── test_frames_with_velocity.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_geodetic_representations.py
|   |   |   ├── test_iau_fullstack.py
|   |   |   ├── test_icrs_observed_transformations.py
|   |   |   ├── test_intermediate_transformations.py
|   |   |   ├── test_matching.py
|   |   |   ├── test_matrix_utilities.py
|   |   |   ├── test_name_resolve.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_regression.py
|   |   |   ├── test_representation.py
|   |   |   ├── test_representation_arithmetic.py
|   |   |   ├── test_representation_methods.py
|   |   |   ├── test_shape_manipulation.py
|   |   |   ├── test_sites.py
|   |   |   ├── test_sky_coord.py
|   |   |   ├── test_sky_coord_velocities.py
|   |   |   ├── test_skyoffset_transformations.py
|   |   |   ├── test_solar_system.py
|   |   |   ├── test_spectral_coordinate.py
|   |   |   ├── test_spectral_quantity.py
|   |   |   ├── test_transformations.py
|   |   |   ├── test_unit_representation.py
|   |   |   ├── test_utils.py
|   |   |   └── test_velocity_corrs.py
|   |   └── transformations.py
|   ├── cosmology
|   |   ├── __init__.py
|   |   ├── connect.py
|   |   ├── core.py
|   |   ├── data
|   |   ├── flrw.py
|   |   ├── funcs.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── cosmology.py
|   |   |   ├── ecsv.py
|   |   |   ├── mapping.py
|   |   |   ├── model.py
|   |   |   ├── row.py
|   |   |   ├── table.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── test_cosmology.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_json.py
|   |   |   |   ├── test_mapping.py
|   |   |   |   ├── test_model.py
|   |   |   |   ├── test_row.py
|   |   |   |   ├── test_table.py
|   |   |   |   └── test_yaml.py
|   |   |   ├── utils.py
|   |   |   └── yaml.py
|   |   ├── parameter.py
|   |   ├── parameters.py
|   |   ├── realizations.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── conftest.py
|   |   |   ├── mypackage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── cosmology.py
|   |   |   |   └── io
|   |   |   ├── test_connect.py
|   |   |   ├── test_core.py
|   |   |   ├── test_cosmology.py
|   |   |   ├── test_flrw.py
|   |   |   ├── test_funcs.py
|   |   |   ├── test_parameter.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_realizations.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   ├── units.py
|   |   └── utils.py
|   ├── extern
|   |   ├── README.rst
|   |   ├── __init__.py
|   |   ├── _strptime.py
|   |   ├── configobj
|   |   |   ├── __init__.py
|   |   |   ├── configobj.py
|   |   |   └── validate.py
|   |   ├── jquery
|   |   |   ├── __init__.py
|   |   |   └── data
|   |   |       ├── css
|   |   |       ├── images
|   |   |       └── js
|   |   └── ply
|   |       ├── __init__.py
|   |       ├── cpp.py
|   |       ├── ctokens.py
|   |       ├── lex.py
|   |       ├── yacc.py
|   |       └── ygen.py
|   ├── io
|   |   ├── __init__.py
|   |   ├── ascii
|   |   |   ├── __init__.py
|   |   |   ├── basic.py
|   |   |   ├── cds.py
|   |   |   ├── connect.py
|   |   |   ├── core.py
|   |   |   ├── daophot.py
|   |   |   ├── docs.py
|   |   |   ├── ecsv.py
|   |   |   ├── fastbasic.py
|   |   |   ├── fixedwidth.py
|   |   |   ├── html.py
|   |   |   ├── ipac.py
|   |   |   ├── latex.py
|   |   |   ├── misc.py
|   |   |   ├── mrt.py
|   |   |   ├── qdp.py
|   |   |   ├── rst.py
|   |   |   ├── setup_package.py
|   |   |   ├── sextractor.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── common.py
|   |   |   |   ├── data
|   |   |   |   ├── test_c_reader.py
|   |   |   |   ├── test_cds.py
|   |   |   |   ├── test_cds_header_from_readme.py
|   |   |   |   ├── test_compressed.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_ecsv.py
|   |   |   |   ├── test_fixedwidth.py
|   |   |   |   ├── test_html.py
|   |   |   |   ├── test_ipac_definitions.py
|   |   |   |   ├── test_qdp.py
|   |   |   |   ├── test_read.py
|   |   |   |   ├── test_rst.py
|   |   |   |   ├── test_types.py
|   |   |   |   └── test_write.py
|   |   |   └── ui.py
|   |   ├── fits
|   |   |   ├── __init__.py
|   |   |   ├── card.py
|   |   |   ├── column.py
|   |   |   ├── connect.py
|   |   |   ├── convenience.py
|   |   |   ├── diff.py
|   |   |   ├── file.py
|   |   |   ├── fitsrec.py
|   |   |   ├── fitstime.py
|   |   |   ├── hdu
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── compressed.py
|   |   |   |   ├── groups.py
|   |   |   |   ├── hdulist.py
|   |   |   |   ├── image.py
|   |   |   |   ├── nonstandard.py
|   |   |   |   ├── streaming.py
|   |   |   |   └── table.py
|   |   |   ├── header.py
|   |   |   ├── scripts
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fitscheck.py
|   |   |   |   ├── fitsdiff.py
|   |   |   |   ├── fitsheader.py
|   |   |   |   └── fitsinfo.py
|   |   |   ├── setup_package.py
|   |   |   ├── src
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_checksum.py
|   |   |   |   ├── test_compression_failures.py
|   |   |   |   ├── test_connect.py
|   |   |   |   ├── test_convenience.py
|   |   |   |   ├── test_core.py
|   |   |   |   ├── test_diff.py
|   |   |   |   ├── test_division.py
|   |   |   |   ├── test_fitscheck.py
|   |   |   |   ├── test_fitsdiff.py
|   |   |   |   ├── test_fitsheader.py
|   |   |   |   ├── test_fitsinfo.py
|   |   |   |   ├── test_fitstime.py
|   |   |   |   ├── test_groups.py
|   |   |   |   ├── test_hdulist.py
|   |   |   |   ├── test_header.py
|   |   |   |   ├── test_image.py
|   |   |   |   ├── test_image_dask.py
|   |   |   |   ├── test_nonstandard.py
|   |   |   |   ├── test_structured.py
|   |   |   |   ├── test_table.py
|   |   |   |   ├── test_uint.py
|   |   |   |   └── test_util.py
|   |   |   ├── util.py
|   |   |   └── verify.py
|   |   ├── misc
|   |   |   ├── __init__.py
|   |   |   ├── asdf
|   |   |   |   ├── __init__.py
|   |   |   |   ├── connect.py
|   |   |   |   ├── data
|   |   |   |   ├── extension.py
|   |   |   |   ├── tags
|   |   |   |   ├── tests
|   |   |   |   └── types.py
|   |   |   ├── connect.py
|   |   |   ├── hdf5.py
|   |   |   ├── pandas
|   |   |   |   ├── __init__.py
|   |   |   |   └── connect.py
|   |   |   ├── parquet.py
|   |   |   ├── pickle_helpers.py
|   |   |   ├── tests
|   |   |   |   ├── __init__.py
|   |   |   |   ├── data
|   |   |   |   ├── test_hdf5.py
|   |   |   |   ├── test_pandas.py
|   |   |   |   ├── test_parquet.py
|   |   |   |   ├── test_pickle_helpers.py
|   |   |   |   └── test_yaml.py
|   |   |   └── yaml.py
|   |   ├── registry
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── compat.py
|   |   |   ├── core.py
|   |   |   ├── interface.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_registries.py
|   |   |       └── test_registry_help.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── mixin_columns.py
|   |   |   └── safeio.py
|   |   └── votable
|   |       ├── __init__.py
|   |       ├── connect.py
|   |       ├── converters.py
|   |       ├── data
|   |       |   └── ucd1p-words.txt
|   |       ├── exceptions.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── tablewriter.c
|   |       ├── table.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── converter_test.py
|   |       |   ├── data
|   |       |   ├── exception_test.py
|   |       |   ├── resource_test.py
|   |       |   ├── table_test.py
|   |       |   ├── tree_test.py
|   |       |   ├── ucd_test.py
|   |       |   ├── util_test.py
|   |       |   └── vo_test.py
|   |       ├── tree.py
|   |       ├── ucd.py
|   |       ├── util.py
|   |       ├── validator
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── html.py
|   |       |   ├── main.py
|   |       |   └── result.py
|   |       ├── volint.py
|   |       └── xmlutil.py
|   ├── logger.py
|   ├── modeling
|   |   ├── __init__.py
|   |   ├── bounding_box.py
|   |   ├── convolution.py
|   |   ├── core.py
|   |   ├── fitting.py
|   |   ├── functional_models.py
|   |   ├── mappings.py
|   |   ├── math_functions.py
|   |   ├── models.py
|   |   ├── optimizers.py
|   |   ├── parameters.py
|   |   ├── physical_models.py
|   |   ├── polynomial.py
|   |   ├── powerlaws.py
|   |   ├── projections.py
|   |   ├── rotations.py
|   |   ├── separable.py
|   |   ├── setup_package.py
|   |   ├── spline.py
|   |   ├── statistic.py
|   |   ├── tabular.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── __init__.py
|   |   |   |   └── spec.txt
|   |   |   ├── example_models.py
|   |   |   ├── irafutil.py
|   |   |   ├── test_bounding_box.py
|   |   |   ├── test_compound.py
|   |   |   ├── test_constraints.py
|   |   |   ├── test_convolution.py
|   |   |   ├── test_core.py
|   |   |   ├── test_fitters.py
|   |   |   ├── test_functional_models.py
|   |   |   ├── test_input.py
|   |   |   ├── test_mappings.py
|   |   |   ├── test_math_func.py
|   |   |   ├── test_model_sets.py
|   |   |   ├── test_models.py
|   |   |   ├── test_models_quantities.py
|   |   |   ├── test_parameters.py
|   |   |   ├── test_physical_models.py
|   |   |   ├── test_polynomial.py
|   |   |   ├── test_projections.py
|   |   |   ├── test_quantities_evaluation.py
|   |   |   ├── test_quantities_fitting.py
|   |   |   ├── test_quantities_model.py
|   |   |   ├── test_quantities_parameters.py
|   |   |   ├── test_quantities_rotations.py
|   |   |   ├── test_rotations.py
|   |   |   ├── test_separable.py
|   |   |   ├── test_spline.py
|   |   |   ├── test_statistics.py
|   |   |   ├── test_units_mapping.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── nddata
|   |   ├── __init__.py
|   |   ├── _testing.py
|   |   ├── bitmask.py
|   |   ├── blocks.py
|   |   ├── ccddata.py
|   |   ├── compat.py
|   |   ├── decorators.py
|   |   ├── flag_collection.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── ndarithmetic.py
|   |   |   ├── ndio.py
|   |   |   ├── ndslicing.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_ndarithmetic.py
|   |   |       ├── test_ndio.py
|   |   |       └── test_ndslicing.py
|   |   ├── nddata.py
|   |   ├── nddata_base.py
|   |   ├── nddata_withmixins.py
|   |   ├── nduncertainty.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   ├── test_bitmask.py
|   |   |   ├── test_blocks.py
|   |   |   ├── test_ccddata.py
|   |   |   ├── test_compat.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_flag_collection.py
|   |   |   ├── test_nddata.py
|   |   |   ├── test_nddata_base.py
|   |   |   ├── test_nduncertainty.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── samp
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── constants.py
|   |   ├── data
|   |   |   ├── clientaccesspolicy.xml
|   |   |   └── crossdomain.xml
|   |   ├── errors.py
|   |   ├── hub.py
|   |   ├── hub_proxy.py
|   |   ├── hub_script.py
|   |   ├── integrated_client.py
|   |   ├── lockfile_helpers.py
|   |   ├── setup_package.py
|   |   ├── standard_profile.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_client.py
|   |   |   ├── test_errors.py
|   |   |   ├── test_helpers.py
|   |   |   ├── test_hub.py
|   |   |   ├── test_hub_proxy.py
|   |   |   ├── test_hub_script.py
|   |   |   ├── test_standard_profile.py
|   |   |   ├── test_web_profile.py
|   |   |   └── web_profile_test_helpers.py
|   |   ├── utils.py
|   |   └── web_profile.py
|   ├── stats
|   |   ├── __init__.py
|   |   ├── bayesian_blocks.py
|   |   ├── biweight.py
|   |   ├── bls
|   |   |   └── __init__.py
|   |   ├── circstats.py
|   |   ├── funcs.py
|   |   ├── histogram.py
|   |   ├── info_theory.py
|   |   ├── jackknife.py
|   |   ├── lombscargle
|   |   |   └── __init__.py
|   |   ├── setup_package.py
|   |   ├── sigma_clipping.py
|   |   ├── spatial.py
|   |   ├── src
|   |   |   ├── compute_bounds.c
|   |   |   ├── fast_sigma_clip.c
|   |   |   └── wirth_select.c
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_bayesian_blocks.py
|   |       ├── test_biweight.py
|   |       ├── test_circstats.py
|   |       ├── test_funcs.py
|   |       ├── test_histogram.py
|   |       ├── test_info_theory.py
|   |       ├── test_jackknife.py
|   |       ├── test_sigma_clipping.py
|   |       └── test_spatial.py
|   ├── table
|   |   ├── __init__.py
|   |   ├── bst.py
|   |   ├── column.py
|   |   ├── connect.py
|   |   ├── groups.py
|   |   ├── index.py
|   |   ├── info.py
|   |   ├── jsviewer.py
|   |   ├── meta.py
|   |   ├── mixins
|   |   |   ├── __init__.py
|   |   |   ├── dask.py
|   |   |   ├── registry.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_dask.py
|   |   |       └── test_registry.py
|   |   ├── ndarray_mixin.py
|   |   ├── np_utils.py
|   |   ├── operations.py
|   |   ├── pandas.py
|   |   ├── pprint.py
|   |   ├── row.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   └── showtable.py
|   |   ├── serialize.py
|   |   ├── setup_package.py
|   |   ├── soco.py
|   |   ├── sorted_array.py
|   |   ├── table.py
|   |   ├── table_helpers.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── conftest.py
|   |       ├── test_array.py
|   |       ├── test_bst.py
|   |       ├── test_column.py
|   |       ├── test_groups.py
|   |       ├── test_index.py
|   |       ├── test_info.py
|   |       ├── test_init_table.py
|   |       ├── test_item_access.py
|   |       ├── test_jsviewer.py
|   |       ├── test_masked.py
|   |       ├── test_mixin.py
|   |       ├── test_np_utils.py
|   |       ├── test_operations.py
|   |       ├── test_pickle.py
|   |       ├── test_pprint.py
|   |       ├── test_row.py
|   |       ├── test_showtable.py
|   |       ├── test_subclass.py
|   |       └── test_table.py
|   ├── tests
|   |   ├── __init__.py
|   |   ├── command.py
|   |   ├── helper.py
|   |   ├── image_tests.py
|   |   ├── runner.py
|   |   ├── test_logger.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── test_imports.py
|   |       ├── test_quantity_helpers.py
|   |       ├── test_run_tests.py
|   |       └── test_runner.py
|   ├── time
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── formats.py
|   |   ├── setup_package.py
|   |   ├── src
|   |   |   └── parse_times.c
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_comparisons.py
|   |   |   ├── test_corrs.py
|   |   |   ├── test_custom_formats.py
|   |   |   ├── test_delta.py
|   |   |   ├── test_fast_parser.py
|   |   |   ├── test_functions.py
|   |   |   ├── test_guess.py
|   |   |   ├── test_mask.py
|   |   |   ├── test_methods.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_precision.py
|   |   |   ├── test_quantity_interaction.py
|   |   |   ├── test_sidereal.py
|   |   |   ├── test_update_leap_seconds.py
|   |   |   └── test_ut1.py
|   |   └── utils.py
|   ├── timeseries
|   |   ├── __init__.py
|   |   ├── binned.py
|   |   ├── core.py
|   |   ├── downsample.py
|   |   ├── io
|   |   |   ├── __init__.py
|   |   |   ├── kepler.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_kepler.py
|   |   ├── periodograms
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── bls
|   |   |   |   ├── __init__.py
|   |   |   |   ├── core.py
|   |   |   |   ├── methods.py
|   |   |   |   ├── setup_package.py
|   |   |   |   └── tests
|   |   |   └── lombscargle
|   |   |       ├── __init__.py
|   |   |       ├── _statistics.py
|   |   |       ├── core.py
|   |   |       ├── implementations
|   |   |       ├── tests
|   |   |       └── utils.py
|   |   ├── sampled.py
|   |   └── tests
|   |       ├── __init__.py
|   |       ├── data
|   |       ├── test_binned.py
|   |       ├── test_common.py
|   |       ├── test_downsample.py
|   |       └── test_sampled.py
|   ├── uncertainty
|   |   ├── __init__.py
|   |   ├── core.py
|   |   ├── distributions.py
|   |   └── tests
|   |       ├── __init__.py
|   |       └── test_distribution.py
|   ├── units
|   |   ├── __init__.py
|   |   ├── _typing.py
|   |   ├── astrophys.py
|   |   ├── cds.py
|   |   ├── cgs.py
|   |   ├── core.py
|   |   ├── decorators.py
|   |   ├── deprecated.py
|   |   ├── equivalencies.py
|   |   ├── format
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── cds.py
|   |   |   ├── cds_lextab.py
|   |   |   ├── cds_parsetab.py
|   |   |   ├── console.py
|   |   |   ├── fits.py
|   |   |   ├── generic.py
|   |   |   ├── generic_lextab.py
|   |   |   ├── generic_parsetab.py
|   |   |   ├── latex.py
|   |   |   ├── ogip.py
|   |   |   ├── ogip_lextab.py
|   |   |   ├── ogip_parsetab.py
|   |   |   ├── unicode_format.py
|   |   |   ├── utils.py
|   |   |   └── vounit.py
|   |   ├── function
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── logarithmic.py
|   |   |   ├── mixin.py
|   |   |   └── units.py
|   |   ├── imperial.py
|   |   ├── misc.py
|   |   ├── photometric.py
|   |   ├── physical.py
|   |   ├── quantity.py
|   |   ├── quantity_helper
|   |   |   ├── __init__.py
|   |   |   ├── converters.py
|   |   |   ├── erfa.py
|   |   |   ├── function_helpers.py
|   |   |   ├── helpers.py
|   |   |   └── scipy_special.py
|   |   ├── required_by_vounit.py
|   |   ├── si.py
|   |   ├── structured.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_aliases.py
|   |   |   ├── test_deprecated.py
|   |   |   ├── test_equivalencies.py
|   |   |   ├── test_format.py
|   |   |   ├── test_logarithmic.py
|   |   |   ├── test_photometric.py
|   |   |   ├── test_physical.py
|   |   |   ├── test_quantity.py
|   |   |   ├── test_quantity_annotations.py
|   |   |   ├── test_quantity_array_methods.py
|   |   |   ├── test_quantity_decorator.py
|   |   |   ├── test_quantity_helpers.py
|   |   |   ├── test_quantity_non_ufuncs.py
|   |   |   ├── test_quantity_typing.py
|   |   |   ├── test_quantity_ufuncs.py
|   |   |   ├── test_structured.py
|   |   |   ├── test_structured_erfa_ufuncs.py
|   |   |   ├── test_units.py
|   |   |   └── test_utils.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── argparse.py
|   |   ├── codegen.py
|   |   ├── collections.py
|   |   ├── compat
|   |   |   ├── __init__.py
|   |   |   ├── misc.py
|   |   |   ├── numpycompat.py
|   |   |   └── optional_deps.py
|   |   ├── console.py
|   |   ├── data.py
|   |   ├── data_info.py
|   |   ├── decorators.py
|   |   ├── diff.py
|   |   ├── exceptions.py
|   |   ├── iers
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   └── update_builtin_iers.sh
|   |   |   ├── iers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── data
|   |   |       ├── test_iers.py
|   |   |       └── test_leap_second.py
|   |   ├── introspection.py
|   |   ├── masked
|   |   |   ├── __init__.py
|   |   |   ├── core.py
|   |   |   ├── function_helpers.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── test_containers.py
|   |   |       ├── test_function_helpers.py
|   |   |       ├── test_functions.py
|   |   |       ├── test_masked.py
|   |   |       └── test_table.py
|   |   ├── metadata.py
|   |   ├── misc.py
|   |   ├── parsing.py
|   |   ├── setup_package.py
|   |   ├── shapes.py
|   |   ├── src
|   |   |   └── compiler.c
|   |   ├── state.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── data
|   |   |   |   ├── .hidden_file.txt
|   |   |   |   ├── dataurl
|   |   |   |   ├── dataurl_mirror
|   |   |   |   ├── test_package
|   |   |   |   └── unicode.txt
|   |   |   ├── test_codegen.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_console.py
|   |   |   ├── test_data.py
|   |   |   ├── test_data_info.py
|   |   |   ├── test_decorators.py
|   |   |   ├── test_diff.py
|   |   |   ├── test_introspection.py
|   |   |   ├── test_metadata.py
|   |   |   ├── test_misc.py
|   |   |   ├── test_parsing.py
|   |   |   ├── test_progress_bar_func.py
|   |   |   ├── test_shapes.py
|   |   |   ├── test_state.py
|   |   |   └── test_xml.py
|   |   └── xml
|   |       ├── __init__.py
|   |       ├── check.py
|   |       ├── iterparser.py
|   |       ├── setup_package.py
|   |       ├── src
|   |       |   └── iterparse.c
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   └── test_iterparse.py
|   |       ├── unescaper.py
|   |       ├── validate.py
|   |       └── writer.py
|   ├── version.py
|   ├── visualization
|   |   ├── __init__.py
|   |   ├── hist.py
|   |   ├── interval.py
|   |   ├── lupton_rgb.py
|   |   ├── mpl_normalize.py
|   |   ├── mpl_style.py
|   |   ├── scripts
|   |   |   ├── __init__.py
|   |   |   ├── fits2bitmap.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       └── test_fits2bitmap.py
|   |   ├── stretch.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── test_histogram.py
|   |   |   ├── test_interval.py
|   |   |   ├── test_lupton_rgb.py
|   |   |   ├── test_norm.py
|   |   |   ├── test_stretch.py
|   |   |   ├── test_time.py
|   |   |   └── test_units.py
|   |   ├── time.py
|   |   ├── transform.py
|   |   ├── units.py
|   |   └── wcsaxes
|   |       ├── __init__.py
|   |       ├── axislabels.py
|   |       ├── coordinate_helpers.py
|   |       ├── coordinate_range.py
|   |       ├── coordinates_map.py
|   |       ├── core.py
|   |       ├── formatter_locator.py
|   |       ├── frame.py
|   |       ├── grid_paths.py
|   |       ├── patches.py
|   |       ├── tests
|   |       |   ├── __init__.py
|   |       |   ├── data
|   |       |   ├── test_coordinate_helpers.py
|   |       |   ├── test_display_world_coordinates.py
|   |       |   ├── test_formatter_locator.py
|   |       |   ├── test_frame.py
|   |       |   ├── test_grid_paths.py
|   |       |   ├── test_images.py
|   |       |   ├── test_misc.py
|   |       |   ├── test_transform_coord_meta.py
|   |       |   ├── test_transforms.py
|   |       |   ├── test_utils.py
|   |       |   └── test_wcsapi.py
|   |       ├── ticklabels.py
|   |       ├── ticks.py
|   |       ├── transforms.py
|   |       ├── utils.py
|   |       └── wcsapi.py
|   └── wcs
|       ├── __init__.py
|       ├── docstrings.py
|       ├── include
|       |   ├── astropy_wcs
|       |   └── wcslib
|       ├── setup_package.py
|       ├── src
|       |   ├── astropy_wcs.c
|       |   ├── astropy_wcs_api.c
|       |   ├── distortion.c
|       |   ├── distortion_wrap.c
|       |   ├── pipeline.c
|       |   ├── pyutil.c
|       |   ├── sip.c
|       |   ├── sip_wrap.c
|       |   ├── str_list_proxy.c
|       |   ├── unit_list_proxy.c
|       |   ├── util.c
|       |   ├── wcslib_auxprm_wrap.c
|       |   ├── wcslib_celprm_wrap.c
|       |   ├── wcslib_prjprm_wrap.c
|       |   ├── wcslib_tabprm_wrap.c
|       |   ├── wcslib_wrap.c
|       |   └── wcslib_wtbarr_wrap.c
|       ├── tests
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   ├── maps
|       |   |   ├── spectra
|       |   |   ├── validate.5.0.txt
|       |   |   ├── validate.5.13.txt
|       |   |   ├── validate.6.txt
|       |   |   ├── validate.7.4.txt
|       |   |   ├── validate.7.6.txt
|       |   |   └── validate.txt
|       |   ├── helper.py
|       |   ├── test_auxprm.py
|       |   ├── test_celprm.py
|       |   ├── test_pickle.py
|       |   ├── test_prjprm.py
|       |   ├── test_profiling.py
|       |   ├── test_tab.py
|       |   ├── test_tabprm.py
|       |   ├── test_utils.py
|       |   ├── test_wcs.py
|       |   ├── test_wcsprm.py
|       |   └── test_wtbarr.py
|       ├── utils.py
|       ├── wcs.py
|       ├── wcsapi
|       |   ├── __init__.py
|       |   ├── conftest.py
|       |   ├── data
|       |   |   └── ucds.txt
|       |   ├── fitswcs.py
|       |   ├── high_level_api.py
|       |   ├── high_level_wcs_wrapper.py
|       |   ├── low_level_api.py
|       |   ├── sliced_low_level_wcs.py
|       |   ├── tests
|       |   |   ├── __init__.py
|       |   |   ├── test_fitswcs.py
|       |   |   ├── test_high_level_api.py
|       |   |   ├── test_high_level_wcs_wrapper.py
|       |   |   ├── test_low_level_api.py
|       |   |   └── test_utils.py
|       |   ├── utils.py
|       |   └── wrappers
|       |       ├── __init__.py
|       |       ├── base.py
|       |       ├── sliced_wcs.py
|       |       └── tests
|       └── wcslint.py
├── azure-pipelines.yml
├── cextern
|   ├── README.rst
|   ├── cfitsio
|   |   ├── License.txt
|   |   ├── README.txt
|   |   ├── docs
|   |   |   └── changes.txt
|   |   ├── lib
|   |   |   ├── buffers.c
|   |   |   ├── cfileio.c
|   |   |   ├── checksum.c
|   |   |   ├── drvrfile.c
|   |   |   ├── drvrmem.c
|   |   |   ├── drvrnet.c
|   |   |   ├── drvrsmem.c
|   |   |   ├── editcol.c
|   |   |   ├── edithdu.c
|   |   |   ├── eval_f.c
|   |   |   ├── eval_l.c
|   |   |   ├── eval_y.c
|   |   |   ├── fits_hcompress.c
|   |   |   ├── fits_hdecompress.c
|   |   |   ├── fitscore.c
|   |   |   ├── getcol.c
|   |   |   ├── getcolb.c
|   |   |   ├── getcold.c
|   |   |   ├── getcole.c
|   |   |   ├── getcoli.c
|   |   |   ├── getcolj.c
|   |   |   ├── getcolk.c
|   |   |   ├── getcoll.c
|   |   |   ├── getcols.c
|   |   |   ├── getcolsb.c
|   |   |   ├── getcolui.c
|   |   |   ├── getcoluj.c
|   |   |   ├── getcoluk.c
|   |   |   ├── getkey.c
|   |   |   ├── group.c
|   |   |   ├── grparser.c
|   |   |   ├── histo.c
|   |   |   ├── imcompress.c
|   |   |   ├── iraffits.c
|   |   |   ├── modkey.c
|   |   |   ├── pliocomp.c
|   |   |   ├── putcol.c
|   |   |   ├── putcolb.c
|   |   |   ├── putcold.c
|   |   |   ├── putcole.c
|   |   |   ├── putcoli.c
|   |   |   ├── putcolj.c
|   |   |   ├── putcolk.c
|   |   |   ├── putcoll.c
|   |   |   ├── putcols.c
|   |   |   ├── putcolsb.c
|   |   |   ├── putcolu.c
|   |   |   ├── putcolui.c
|   |   |   ├── putcoluj.c
|   |   |   ├── putcoluk.c
|   |   |   ├── putkey.c
|   |   |   ├── quantize.c
|   |   |   ├── region.c
|   |   |   ├── ricecomp.c
|   |   |   ├── scalnull.c
|   |   |   ├── simplerng.c
|   |   |   ├── swapproc.c
|   |   |   ├── wcssub.c
|   |   |   ├── wcsutil.c
|   |   |   ├── zcompress.c
|   |   |   └── zuncompress.c
|   |   └── zlib
|   |       ├── adler32.c
|   |       ├── crc32.c
|   |       ├── deflate.c
|   |       ├── infback.c
|   |       ├── inffast.c
|   |       ├── inflate.c
|   |       ├── inftrees.c
|   |       ├── trees.c
|   |       ├── uncompr.c
|   |       └── zutil.c
|   ├── expat
|   |   ├── README.md
|   |   ├── README.txt
|   |   └── lib
|   |       ├── xmlparse.c
|   |       ├── xmlrole.c
|   |       ├── xmltok.c
|   |       ├── xmltok_impl.c
|   |       └── xmltok_ns.c
|   ├── trim_cfitsio.sh
|   ├── trim_expat.sh
|   ├── trim_wcslib.sh
|   └── wcslib
|       ├── C
|       |   ├── cel.c
|       |   ├── dis.c
|       |   ├── flexed
|       |   |   ├── fitshdr.c
|       |   |   ├── wcsbth.c
|       |   |   ├── wcspih.c
|       |   |   ├── wcsulex.c
|       |   |   └── wcsutrn.c
|       |   ├── getwcstab.c
|       |   ├── lin.c
|       |   ├── log.c
|       |   ├── prj.c
|       |   ├── spc.c
|       |   ├── sph.c
|       |   ├── spx.c
|       |   ├── tab.c
|       |   ├── wcs.c
|       |   ├── wcserr.c
|       |   ├── wcsfix.c
|       |   ├── wcshdr.c
|       |   ├── wcsprintf.c
|       |   ├── wcstrig.c
|       |   ├── wcsunits.c
|       |   └── wcsutil.c
|       └── config
├── codecov.yml
├── conftest.py
├── docs
|   ├── _pkgtemplate.rst
|   ├── _static
|   ├── _templates
|   |   └── layout.html
|   ├── changelog.rst
|   ├── changes
|   |   ├── README.rst
|   |   ├── config
|   |   ├── constants
|   |   ├── convolution
|   |   ├── coordinates
|   |   ├── cosmology
|   |   |   ├── 12279.feature.rst
|   |   |   ├── 12313.feature.rst
|   |   |   ├── 12354.api.rst
|   |   |   ├── 12375.api.rst
|   |   |   ├── 12479.feature.rst
|   |   |   ├── 12590.feature.rst
|   |   |   ├── 12606.feature.rst
|   |   |   ├── 12612.api.rst
|   |   |   ├── 12624.api.rst
|   |   |   ├── 12710.feature.rst
|   |   |   ├── 12736.feature.rst
|   |   |   ├── 12740.feature.rst
|   |   |   └── 12746.api.rst
|   |   ├── extern
|   |   ├── io.ascii
|   |   |   ├── 12631.bugfix.rst
|   |   |   └── 12880.bugfix.rst
|   |   ├── io.fits
|   |   |   ├── 11843.feature.rst
|   |   |   └── 12258.api.rst
|   |   ├── io.misc
|   |   |   ├── 10198.feature.rst
|   |   |   ├── 12279.feature.rst
|   |   |   ├── 12800.bugfix.rst
|   |   |   ├── 12895.feature.rst
|   |   |   └── 12897.feature.rst
|   |   ├── io.registry
|   |   ├── io.votable
|   |   |   └── 12604.bugfix.rst
|   |   ├── modeling
|   |   |   ├── 12384.feature.rst
|   |   |   ├── 12558.feature.rst
|   |   |   ├── 12585.api.rst
|   |   |   └── 12900.feature.rst
|   |   ├── nddata
|   |   ├── samp
|   |   ├── stats
|   |   |   └── 12896.bugfix.rst
|   |   ├── table
|   |   |   ├── 12631.api.rst
|   |   |   ├── 12637.api.rst
|   |   |   ├── 12637.feature.rst
|   |   |   ├── 12680.feature.rst
|   |   |   └── 12716.bugfix.rst
|   |   ├── template.rst
|   |   ├── tests
|   |   |   ├── 12633.api.1.rst
|   |   |   ├── 12633.api.2.rst
|   |   |   ├── 12633.api.3.rst
|   |   |   └── 12633.api.4.rst
|   |   ├── time
|   |   |   └── 12888.api.rst
|   |   ├── timeseries
|   |   ├── uncertainty
|   |   ├── units
|   |   |   ├── 12486.feature.rst
|   |   |   ├── 12566.feature.rst
|   |   |   └── 12709.feature.rst
|   |   ├── utils
|   |   ├── visualization
|   |   └── wcs
|   |       ├── 12514.feature.rst
|   |       └── 12844.bugfix.rst
|   ├── common_links.txt
|   ├── conf.py
|   ├── config
|   |   ├── astropy_config.rst
|   |   └── index.rst
|   ├── conftest.py
|   ├── constants
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── convolution
|   |   ├── images
|   |   ├── index.rst
|   |   ├── kernels.rst
|   |   ├── non_normalized_kernels.rst
|   |   ├── performance.inc.rst
|   |   └── using.rst
|   ├── coordinates
|   |   ├── angles.rst
|   |   ├── apply_space_motion.rst
|   |   ├── common_errors.rst
|   |   ├── definitions.rst
|   |   ├── formatting.rst
|   |   ├── frames.rst
|   |   ├── galactocentric.rst
|   |   ├── index.rst
|   |   ├── inplace.rst
|   |   ├── matchsep.rst
|   |   ├── performance.inc.rst
|   |   ├── remote_methods.rst
|   |   ├── representations.rst
|   |   ├── satellites.rst
|   |   ├── skycoord.rst
|   |   ├── solarsystem.rst
|   |   ├── spectralcoord.rst
|   |   ├── transforming.rst
|   |   └── velocities.rst
|   ├── cosmology
|   |   ├── dev.rst
|   |   ├── index.rst
|   |   ├── io.rst
|   |   └── units.rst
|   ├── credits.rst
|   ├── development
|   |   ├── astropy-package-template.rst
|   |   ├── building.rst
|   |   ├── ccython.rst
|   |   ├── codeguide.rst
|   |   ├── codeguide_emacs.rst
|   |   ├── docguide.rst
|   |   ├── docrules.rst
|   |   ├── releasing.rst
|   |   ├── scripts.rst
|   |   ├── style-guide.rst
|   |   ├── testguide.rst
|   |   ├── vision.rst
|   |   ├── when_to_rebase.rst
|   |   └── workflow
|   |       ├── additional_git_topics.rst
|   |       ├── development_workflow.rst
|   |       ├── get_devel_version.rst
|   |       ├── git_edit_workflow_examples.rst
|   |       ├── git_install.rst
|   |       ├── git_resources.rst
|   |       ├── maintainer_workflow.rst
|   |       ├── patches.rst
|   |       └── virtual_pythons.rst
|   ├── getting_started.rst
|   ├── glossary.rst
|   ├── importing_astropy.rst
|   ├── index.rst
|   ├── install.rst
|   ├── io
|   |   ├── ascii
|   |   |   ├── base_classes.rst
|   |   |   ├── ecsv.rst
|   |   |   ├── extension_classes.rst
|   |   |   ├── fast_ascii_io.rst
|   |   |   ├── fixed_width_gallery.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   ├── read.rst
|   |   |   ├── references.txt
|   |   |   ├── toc.txt
|   |   |   └── write.rst
|   |   ├── asdf-schemas.rst
|   |   ├── fits
|   |   |   ├── api
|   |   |   |   ├── cards.rst
|   |   |   |   ├── diff.rst
|   |   |   |   ├── files.rst
|   |   |   |   ├── hdulists.rst
|   |   |   |   ├── hdus.rst
|   |   |   |   ├── headers.rst
|   |   |   |   ├── images.rst
|   |   |   |   ├── tables.rst
|   |   |   |   └── verification.rst
|   |   |   ├── appendix
|   |   |   |   ├── faq.rst
|   |   |   |   ├── header_transition.rst
|   |   |   |   └── history.rst
|   |   |   ├── index.rst
|   |   |   ├── performance.inc.rst
|   |   |   └── usage
|   |   |       ├── headers.rst
|   |   |       ├── image.rst
|   |   |       ├── misc.rst
|   |   |       ├── scripts.rst
|   |   |       ├── table.rst
|   |   |       ├── unfamiliar.rst
|   |   |       └── verification.rst
|   |   ├── misc.rst
|   |   ├── registry.rst
|   |   ├── unified.rst
|   |   └── votable
|   |       ├── api_exceptions.rst
|   |       ├── index.rst
|   |       ├── performance.inc.rst
|   |       └── references.txt
|   ├── known_issues.rst
|   ├── license.rst
|   ├── logging.rst
|   ├── lts_policy.rst
|   ├── modeling
|   |   ├── add-units.rst
|   |   ├── compound-models.rst
|   |   ├── example-fitting-constraints.rst
|   |   ├── example-fitting-line.rst
|   |   ├── example-fitting-model-sets.rst
|   |   ├── fitting.rst
|   |   ├── index.rst
|   |   ├── jointfitter.rst
|   |   ├── models.rst
|   |   ├── new-fitter.rst
|   |   ├── new-model.rst
|   |   ├── parameters.rst
|   |   ├── performance.rst
|   |   ├── physical_models.rst
|   |   ├── polynomial_models.rst
|   |   ├── predef_models1D.rst
|   |   ├── predef_models2D.rst
|   |   ├── reference_api.rst
|   |   ├── spline_models.rst
|   |   └── units.rst
|   ├── nddata
|   |   ├── bitmask.rst
|   |   ├── ccddata.rst
|   |   ├── decorator.rst
|   |   ├── examples
|   |   |   └── cutout2d_tofits.py
|   |   ├── index.rst
|   |   ├── mixins
|   |   |   ├── index.rst
|   |   |   ├── ndarithmetic.rst
|   |   |   ├── ndio.rst
|   |   |   └── ndslicing.rst
|   |   ├── nddata.rst
|   |   ├── performance.inc.rst
|   |   ├── subclassing.rst
|   |   └── utils.rst
|   ├── overview.rst
|   ├── robots.txt
|   ├── samp
|   |   ├── advanced_embed_samp_hub.rst
|   |   ├── example_clients.rst
|   |   ├── example_hub.rst
|   |   ├── example_table_image.rst
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── stats
|   |   ├── circ.rst
|   |   ├── index.rst
|   |   ├── performance.inc.rst
|   |   ├── ripley.rst
|   |   └── robust.rst
|   ├── table
|   |   ├── access_table.rst
|   |   ├── construct_table.rst
|   |   ├── implementation_details.rst
|   |   ├── index.rst
|   |   ├── indexing.rst
|   |   ├── io.rst
|   |   ├── masking.rst
|   |   ├── mixin_columns.rst
|   |   ├── modify_table.rst
|   |   ├── operations.rst
|   |   ├── pandas.rst
|   |   └── performance.inc.rst
|   ├── testhelpers.rst
|   ├── time
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── timeseries
|   |   ├── analysis.rst
|   |   ├── bls.rst
|   |   ├── data_access.rst
|   |   ├── index.rst
|   |   ├── initializing.rst
|   |   ├── io.rst
|   |   ├── lombscargle.rst
|   |   ├── masking.rst
|   |   ├── pandas.rst
|   |   └── times.rst
|   ├── uncertainty
|   |   ├── index.rst
|   |   └── performance.inc.rst
|   ├── units
|   |   ├── combining_and_defining.rst
|   |   ├── constants_versions.rst
|   |   ├── conversion.rst
|   |   ├── decomposing_and_composing.rst
|   |   ├── equivalencies.rst
|   |   ├── format.rst
|   |   ├── index.rst
|   |   ├── logarithmic_units.rst
|   |   ├── performance.inc.rst
|   |   ├── physical_types.rst
|   |   ├── quantity.rst
|   |   ├── standard_units.rst
|   |   ├── structured_units.rst
|   |   └── type_hints.rst
|   ├── utils
|   |   ├── data.rst
|   |   ├── iers.rst
|   |   ├── index.rst
|   |   └── masked
|   |       └── index.rst
|   ├── visualization
|   |   ├── histogram.rst
|   |   ├── index.rst
|   |   ├── matplotlib_integration.rst
|   |   ├── normalization.rst
|   |   ├── performance.inc.rst
|   |   ├── rgb.rst
|   |   └── wcsaxes
|   |       ├── controlling_axes.rst
|   |       ├── custom_frames.rst
|   |       ├── generic_transforms.rst
|   |       ├── images_contours.rst
|   |       ├── index.rst
|   |       ├── initializing_axes.rst
|   |       ├── overlaying_coordinate_systems.rst
|   |       ├── overlays.rst
|   |       ├── slicing_datacubes.rst
|   |       └── ticks_labels_grid.rst
|   ├── warnings.rst
|   ├── wcs
|   |   ├── example_create_imaging.rst
|   |   ├── example_cube_wcs.rst
|   |   ├── examples
|   |   |   ├── cube_wcs.py
|   |   |   ├── from_file.py
|   |   |   └── programmatic.py
|   |   ├── history.rst
|   |   ├── index.rst
|   |   ├── legacy_interface.rst
|   |   ├── loading_from_fits.rst
|   |   ├── note_sip.rst
|   |   ├── performance.inc.rst
|   |   ├── reference_api.rst
|   |   ├── references.rst
|   |   ├── references.txt
|   |   ├── relax.rst
|   |   ├── supported_projections.rst
|   |   ├── validation.rst
|   |   ├── wcsapi.rst
|   |   └── wcstools.rst
|   └── whatsnew
|       ├── 0.1.rst
|       ├── 0.2.rst
|       ├── 0.3.rst
|       ├── 0.4.rst
|       ├── 1.0.rst
|       ├── 1.1.rst
|       ├── 1.2.rst
|       ├── 1.3.rst
|       ├── 2.0.rst
|       ├── 3.0.rst
|       ├── 3.1.rst
|       ├── 3.2.rst
|       ├── 4.0.rst
|       ├── 4.1.rst
|       ├── 4.2.rst
|       ├── 4.3.rst
|       ├── 5.0.rst
|       ├── 5.1.rst
|       └── index.rst
├── examples
|   ├── README.rst
|   ├── coordinates
|   |   ├── README.txt
|   |   ├── plot_galactocentric-frame.py
|   |   ├── plot_obs-planning.py
|   |   ├── plot_sgr-coordinate-frame.py
|   |   └── rv-to-gsr.py
|   ├── io
|   |   ├── README.txt
|   |   ├── create-mef.py
|   |   ├── fits-tables.py
|   |   ├── modify-fits-header.py
|   |   ├── plot_fits-image.py
|   |   ├── skip_create-large-fits.py
|   |   └── split-jpeg-to-fits.py
|   └── template
|       └── example-template.py
├── licenses
|   ├── AURA_LICENSE.rst
|   ├── CONFIGOBJ_LICENSE.rst
|   ├── DATATABLES_LICENSE.rst
|   ├── ERFA.rst
|   ├── EXPAT_LICENSE.rst
|   ├── JQUERY_LICENSE.rst
|   ├── NUMPY_LICENSE.rst
|   ├── PLY_LICENSE.rst
|   ├── PYFITS.rst
|   ├── PYTHON.rst
|   ├── README.rst
|   └── WCSLIB_LICENSE.rst
└── setup.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Modeling's `separability_matrix` does not compute separability correctly for nested CompoundModels

Description: Consider the following model:

```python
from astropy.modeling import models as m
from astropy.modeling.separable import separability_matrix

cm = m.Linear1D(10) & m.Linear1D(5)
```

It's separability matrix as you might expect is a diagonal:

```python
>>> separability_matrix(cm)
array([[ True, False],
       [False,  True]])
```

If I make the model more complex:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5))
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True, False],
       [False, False, False,  True]])
```

The output matrix is again, as expected, the outputs and inputs to the linear models are separable and independent of each other.

If however, I nest these compound models:
```python
>>> separability_matrix(m.Pix2Sky_TAN() & cm)
array([[ True,  True, False, False],
       [ True,  True, False, False],
       [False, False,  True,  True],
       [False, False,  True,  True]])
```
Suddenly the inputs and outputs are no longer separable?

This feels like a bug to me, but I might be missing something?

Patch information:
diff --git a/astropy/modeling/separable.py b/astropy/modeling/separable.py
index a308e27297..45bea36085 100644
--- a/astropy/modeling/separable.py
+++ b/astropy/modeling/separable.py
@@ -242,7 +242,7 @@ def _cstack(left, right):
         cright = _coord_matrix(right, 'right', noutp)
     else:
         cright = np.zeros((noutp, right.shape[1]))
-        cright[-right.shape[0]:, -right.shape[1]:] = 1
+        cright[-right.shape[0]:, -right.shape[1]:] = right
 
     return np.hstack([cleft, cright])
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of the file `astropy/modeling/tests/test_separable.py`.
Extra Requirements: 
Purpose: I need to find existing test cases for `separability_matrix` to see how compound models are tested and to find examples similar to the user's bug report.

Previous refined query 2:
Essential Query: Please provide the full content of the file `astropy/modeling/tests/test_compound.py`.
Extra Requirements: 
Purpose: I need to find test cases that construct and test nested compound models to find examples that are structurally similar to the user's bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: astropy/modeling/tests/test_compound.py
Line number range: 1 - 500
Content:
1. # Licensed under a 3-clause BSD style license - see LICENSE.rst
2. # pylint: disable=invalid-name, pointless-statement
3. 
4. import pickle
5. import pytest
6. 
7. import numpy as np
8. 
9. from numpy.testing import assert_allclose, assert_array_equal
10. 
11. from astropy.utils import minversion
12. from astropy.modeling.core import Model, ModelDefinitionError, CompoundModel
13. from astropy.modeling.parameters import Parameter
14. from astropy.modeling.models import (Const1D, Shift, Scale, Rotation2D, Gaussian1D,
15.                                      Gaussian2D, Polynomial1D, Polynomial2D,
16.                                      Chebyshev2D, Legendre2D, Chebyshev1D, Legendre1D,
17.                                      Identity, Mapping, Linear1D,
18.                                      Tabular1D, fix_inputs,)
19. from astropy.modeling.fitting import LevMarLSQFitter
20. import astropy.units as u
21. from astropy.utils.compat.optional_deps import HAS_SCIPY  # noqa
22. 
23. 
24. @pytest.mark.parametrize(('expr', 'result'),
25.                          [(lambda x, y: x + y, [5.0, 5.0]),
26.                           (lambda x, y: x - y, [-1.0, -1.0]),
27.                           (lambda x, y: x * y, [6.0, 6.0]),
28.                           (lambda x, y: x / y, [2.0 / 3.0, 2.0 / 3.0]),
29.                           (lambda x, y: x ** y, [8.0, 8.0])])
30. def test_model_set(expr, result):
31.     s = expr(Const1D((2, 2), n_models=2), Const1D((3, 3), n_models=2))
32.     out = s(0, model_set_axis=False)
33.     assert_array_equal(out, result)
34. 
35. 
36. @pytest.mark.parametrize(('expr', 'result'),
37.                          [(lambda x, y: x + y, [5.0, 5.0]),
38.                           (lambda x, y: x - y, [-1.0, -1.0]),
39.                           (lambda x, y: x * y, [6.0, 6.0]),
40.                           (lambda x, y: x / y, [2.0 / 3.0, 2.0 / 3.0]),
41.                           (lambda x, y: x ** y, [8.0, 8.0])])
42. def test_model_set_raises_value_error(expr, result):
43.     """Check that creating model sets with components whose _n_models are
44.        different raise a value error
45.     """
46.     with pytest.raises(ValueError):
47.         expr(Const1D((2, 2), n_models=2), Const1D(3, n_models=1))
48. 
49. 
50. @pytest.mark.parametrize(('expr', 'result'),
51.                          [(lambda x, y: x + y, 5.0),
52.                           (lambda x, y: x - y, -1.0),
53.                           (lambda x, y: x * y, 6.0),
54.                           (lambda x, y: x / y, 2.0 / 3.0),
55.                           (lambda x, y: x ** y, 8.0)])
56. def test_two_model_instance_arithmetic_1d(expr, result):
57.     """
58.     Like test_two_model_class_arithmetic_1d, but creates a new model from two
59.     model *instances* with fixed parameters.
60.     """
61. 
62.     s = expr(Const1D(2), Const1D(3))
63. 
64.     assert isinstance(s, CompoundModel)
65.     assert s.n_inputs == 1
66.     assert s.n_outputs == 1
67. 
68.     out = s(0)
69.     assert out == result
70. 
71.     assert isinstance(out, float)
72. 
73. 
74. def test_simple_two_model_compose_1d():
75.     """
76.     Shift and Scale are two of the simplest models to test model composition
77.     with.
78.     """
79. 
80.     S1 = Shift(2) | Scale(3)  # First shift then scale
81.     assert isinstance(S1, CompoundModel)
82.     assert S1.n_inputs == 1
83.     assert S1.n_outputs == 1
84.     assert S1(1) == 9.0
85. 
86.     S2 = Scale(2) | Shift(3)  # First scale then shift
87.     assert isinstance(S2, CompoundModel)
88.     assert S2.n_inputs == 1
89.     assert S2.n_outputs == 1
90.     assert S2(1) == 5.0
91. 
92.     # Test with array inputs
93.     assert_array_equal(S2([1, 2, 3]), [5.0, 7.0, 9.0])
94. 
95. 
96. def test_simple_two_model_compose_2d():
97.     """
98.     A simple example consisting of two rotations.
99.     """
100. 
101.     r1 = Rotation2D(45) | Rotation2D(45)
102. 
103.     assert isinstance(r1, CompoundModel)
104.     assert r1.n_inputs == 2
105.     assert r1.n_outputs == 2
106.     assert_allclose(r1(0, 1), (-1, 0), atol=1e-10)
107. 
108.     r2 = Rotation2D(90) | Rotation2D(90)  # Rotate twice by 90 degrees
109.     assert_allclose(r2(0, 1), (0, -1), atol=1e-10)
110. 
111.     # Compose R with itself to produce 4 rotations
112.     r3 = r1 | r1
113. 
114.     assert_allclose(r3(0, 1), (0, -1), atol=1e-10)
115. 
116. 
117. def test_n_submodels():
118.     """
119.     Test that CompoundModel.n_submodels properly returns the number
120.     of components.
121.     """
122. 
123.     g2 = Gaussian1D() + Gaussian1D()
124.     assert g2.n_submodels == 2
125. 
126.     g3 = g2 + Gaussian1D()
127.     assert g3.n_submodels == 3
128. 
129.     g5 = g3 | g2
130.     assert g5.n_submodels == 5
131. 
132.     g7 = g5 / g2
133.     assert g7.n_submodels == 7
134. 
135. 
136. def test_expression_formatting():
137.     """
138.     Test that the expression strings from compound models are formatted
139.     correctly.
140.     """
141. 
142.     # For the purposes of this test it doesn't matter a great deal what
143.     # model(s) are used in the expression, I don't think
144.     G = Gaussian1D(1, 1, 1)
145.     G2 = Gaussian2D(1, 2, 3, 4, 5, 6)
146. 
147.     M = G + G
148.     assert M._format_expression() == '[0] + [1]'
149. 
150.     M = G + G + G
151.     assert M._format_expression() == '[0] + [1] + [2]'
152. 
153.     M = G + G * G
154.     assert M._format_expression() == '[0] + [1] * [2]'
155. 
156.     M = G * G + G
157.     assert M._format_expression() == '[0] * [1] + [2]'
158. 
159.     M = G + G * G + G
160.     assert M._format_expression() == '[0] + [1] * [2] + [3]'
161. 
162.     M = (G + G) * (G + G)
163.     assert M._format_expression() == '([0] + [1]) * ([2] + [3])'
164. 
165.     # This example uses parentheses in the expression, but those won't be
166.     # preserved in the expression formatting since they technically aren't
167.     # necessary, and there's no way to know that they were originally
168.     # parenthesized (short of some deep, and probably not worthwhile
169.     # introspection)
170.     M = (G * G) + (G * G)
171.     assert M._format_expression() == '[0] * [1] + [2] * [3]'
172. 
173.     M = G ** G
174.     assert M._format_expression() == '[0] ** [1]'
175. 
176.     M = G + G ** G
177.     assert M._format_expression() == '[0] + [1] ** [2]'
178. 
179.     M = (G + G) ** G
180.     assert M._format_expression() == '([0] + [1]) ** [2]'
181. 
182.     M = G + G | G
183.     assert M._format_expression() == '[0] + [1] | [2]'
184. 
185.     M = G + (G | G)
186.     assert M._format_expression() == '[0] + ([1] | [2])'
187. 
188.     M = G & G | G2
189.     assert M._format_expression() == '[0] & [1] | [2]'
190. 
191.     M = G & (G | G)
192.     assert M._format_expression() == '[0] & ([1] | [2])'
193. 
194. 
195. def test_basic_compound_inverse():
196.     """
197.     Test basic inversion of compound models in the limited sense supported for
198.     models made from compositions and joins only.
199.     """
200. 
201.     t = (Shift(2) & Shift(3)) | (Scale(2) & Scale(3)) | Rotation2D(90)
202.     assert_allclose(t.inverse(*t(0, 1)), (0, 1))
203. 
204. 
205. @pytest.mark.parametrize('model', [
206.     Shift(0) + Shift(0) | Shift(0),
207.     Shift(0) - Shift(0) | Shift(0),
208.     Shift(0) * Shift(0) | Shift(0),
209.     Shift(0) / Shift(0) | Shift(0),
210.     Shift(0) ** Shift(0) | Shift(0),
211.     Gaussian1D(1, 2, 3) | Gaussian1D(4, 5, 6)])
212. def test_compound_unsupported_inverse(model):
213.     """
214.     Ensure inverses aren't supported in cases where it shouldn't be.
215.     """
216. 
217.     with pytest.raises(NotImplementedError):
218.         model.inverse
219. 
220. 
221. def test_mapping_basic_permutations():
222.     """
223.     Tests a couple basic examples of the Mapping model--specifically examples
224.     that merely permute the outputs.
225.     """
226. 
227.     x, y = Rotation2D(90)(1, 2)
228. 
229.     rs = Rotation2D(90) | Mapping((1, 0))
230.     x_prime, y_prime = rs(1, 2)
231.     assert_allclose((x, y), (y_prime, x_prime))
232. 
233.     # A more complicated permutation
234.     m = Rotation2D(90) & Scale(2)
235.     x, y, z = m(1, 2, 3)
236. 
237.     ms = m | Mapping((2, 0, 1))
238.     x_prime, y_prime, z_prime = ms(1, 2, 3)
239.     assert_allclose((x, y, z), (y_prime, z_prime, x_prime))
240. 
241. 
242. def test_mapping_inverse():
243.     """Tests inverting a compound model that includes a `Mapping`."""
244. 
245.     rs1 = Rotation2D(12.1) & Scale(13.2)
246.     rs2 = Rotation2D(14.3) & Scale(15.4)
247. 
248.     # Rotates 2 of the coordinates and scales the third--then rotates on a
249.     # different axis and scales on the axis of rotation.  No physical meaning
250.     # here just a simple test
251.     m = rs1 | Mapping([2, 0, 1]) | rs2
252. 
253.     assert_allclose((0, 1, 2), m.inverse(*m(0, 1, 2)), atol=1e-08)
254. 
255. 
256. def test_identity_input():
257.     """
258.     Test a case where an Identity (or Mapping) model is the first in a chain
259.     of composite models and thus is responsible for handling input broadcasting
260.     properly.
261. 
262.     Regression test for https://github.com/astropy/astropy/pull/3362
263.     """
264. 
265.     ident1 = Identity(1)
266.     shift = Shift(1)
267.     rotation = Rotation2D(angle=90)
268.     model = ident1 & shift | rotation
269.     assert_allclose(model(1, 2), [-3.0, 1.0])
270. 
271. 
272. def test_invalid_operands():
273.     """
274.     Test that certain operators do not work with models whose inputs/outputs do
275.     not match up correctly.
276.     """
277. 
278.     with pytest.raises(ModelDefinitionError):
279.         Rotation2D(90) | Gaussian1D(1, 0, 0.1)
280. 
281.     with pytest.raises(ModelDefinitionError):
282.         Rotation2D(90) + Gaussian1D(1, 0, 0.1)
283. 
284. 
285. @pytest.mark.parametrize('poly', [Chebyshev2D(1, 2), Polynomial2D(2), Legendre2D(1, 2)])
286. def test_compound_with_polynomials_2d(poly):
287.     """
288.     Tests that polynomials are scaled when used in compound models.
289.     Issue #3699
290.     """
291.     poly.parameters = [1, 2, 3, 4, 1, 2]
292.     shift = Shift(3)
293.     model = poly | shift
294.     x, y = np.mgrid[:20, :37]
295.     result_compound = model(x, y)
296.     result = shift(poly(x, y))
297.     assert_allclose(result, result_compound)
298. 
299. 
300. def test_fix_inputs():
301.     g1 = Gaussian2D(1, 0, 0, 1, 2)
302.     g2 = Gaussian2D(1.5, .5, -.2, .5, .3)
303.     sg1_1 = fix_inputs(g1, {1: 0})
304.     assert_allclose(sg1_1(0), g1(0, 0))
305.     assert_allclose(sg1_1([0, 1, 3]), g1([0, 1, 3], [0, 0, 0]))
306.     sg1_2 = fix_inputs(g1, {'x': 1})
307.     assert_allclose(sg1_2(1.5), g1(1, 1.5))
308.     gg1 = g1 & g2
309.     sgg1_1 = fix_inputs(gg1, {1: 0.1, 3: 0.2})
310.     assert_allclose(sgg1_1(0, 0), gg1(0, 0.1, 0, 0.2))
311.     sgg1_2 = fix_inputs(gg1, {'x0': -.1, 2: .1})
312.     assert_allclose(sgg1_2(1, 1), gg1(-0.1, 1, 0.1, 1))
313.     assert_allclose(sgg1_2(y0=1, y1=1), gg1(-0.1, 1, 0.1, 1))
314. 
315. 
316. def test_fix_inputs_invalid():
317.     g1 = Gaussian2D(1, 0, 0, 1, 2)
318.     with pytest.raises(ValueError):
319.         fix_inputs(g1, {'x0': 0, 0: 0})
320. 
321.     with pytest.raises(ValueError):
322.         fix_inputs(g1, (0, 1))
323. 
324.     with pytest.raises(ValueError):
325.         fix_inputs(g1, {3: 2})
326. 
327.     with pytest.raises(ValueError):
328.         fix_inputs(g1, {np.int32(3): 2})
329. 
330.     with pytest.raises(ValueError):
331.         fix_inputs(g1, {np.int64(3): 2})
332. 
333.     with pytest.raises(ValueError):
334.         fix_inputs(g1, {'w': 2})
335. 
336.     with pytest.raises(ModelDefinitionError):
337.         CompoundModel('#', g1, g1)
338. 
339.     with pytest.raises(ValueError):
340.         gg1 = fix_inputs(g1, {0: 1})
341.         gg1(2, y=2)
342. 
343.     with pytest.raises(ValueError):
344.         gg1 = fix_inputs(g1, {np.int32(0): 1})
345.         gg1(2, y=2)
346. 
347.     with pytest.raises(ValueError):
348.         gg1 = fix_inputs(g1, {np.int64(0): 1})
349.         gg1(2, y=2)
350. 
351. 
352. def test_fix_inputs_with_bounding_box():
353.     g1 = Gaussian2D(1, 0, 0, 1, 1)
354.     g2 = Gaussian2D(1, 0, 0, 1, 1)
355.     assert g1.bounding_box == ((-5.5, 5.5), (-5.5, 5.5))
356. 
357.     gg1 = g1 & g2
358.     gg1.bounding_box = ((-5.5, 5.5), (-5.4, 5.4), (-5.3, 5.3), (-5.2, 5.2))
359.     assert gg1.bounding_box == ((-5.5, 5.5), (-5.4, 5.4), (-5.3, 5.3), (-5.2, 5.2))
360. 
361.     sg = fix_inputs(gg1, {0: 0, 2: 0})
362.     assert sg.bounding_box == ((-5.5, 5.5), (-5.3, 5.3))
363. 
364.     g1 = Gaussian1D(10, 3, 1)
365.     g = g1 & g1
366.     g.bounding_box = ((1, 4), (6, 8))
367.     gf = fix_inputs(g, {0: 1})
368.     assert gf.bounding_box == (1, 4)
369. 
370. 
371. def test_indexing_on_instance():
372.     """Test indexing on compound model instances."""
373. 
374.     m = Gaussian1D(1, 0, 0.1) + Const1D(2)
375.     assert isinstance(m[0], Gaussian1D)
376.     assert isinstance(m[1], Const1D)
377.     assert m.param_names == ('amplitude_0', 'mean_0', 'stddev_0', 'amplitude_1')
378. 
379.     # Test parameter equivalence
380.     assert m[0].amplitude == 1 == m.amplitude_0
381.     assert m[0].mean == 0 == m.mean_0
382.     assert m[0].stddev == 0.1 == m.stddev_0
383.     assert m[1].amplitude == 2 == m.amplitude_1
384. 
385.     # Test that parameter value updates are symmetric between the compound
386.     # model and the submodel returned by indexing
387.     const = m[1]
388.     m.amplitude_1 = 42
389.     assert const.amplitude == 42
390.     const.amplitude = 137
391.     assert m.amplitude_1 == 137
392. 
393.     # Similar couple of tests, but now where the compound model was created
394.     # from model instances
395.     g = Gaussian1D(1, 2, 3, name='g')
396.     p = Polynomial1D(2, name='p')
397.     m = g + p
398.     assert m[0].name == 'g'
399.     assert m[1].name == 'p'
400.     assert m['g'].name == 'g'
401.     assert m['p'].name == 'p'
402. 
403.     poly = m[1]
404.     m.c0_1 = 12345
405.     assert poly.c0 == 12345
406.     poly.c1 = 6789
407.     assert m.c1_1 == 6789
408. 
409.     # Test negative indexing
410.     assert isinstance(m[-1], Polynomial1D)
411.     assert isinstance(m[-2], Gaussian1D)
412. 
413.     with pytest.raises(IndexError):
414.         m[42]
415. 
416.     with pytest.raises(IndexError):
417.         m['foobar']
418. 
419.     # Confirm index-by-name works with fix_inputs
420.     g = Gaussian2D(1, 2, 3, 4, 5, name='g')
421.     m = fix_inputs(g, {0: 1})
422.     assert m['g'].name == 'g'
423. 
424.     # Test string slicing
425.     A = Const1D(1.1, name='A')
426.     B = Const1D(2.1, name='B')
427.     C = Const1D(3.1, name='C')
428.     M = A + B * C
429.     assert_allclose(M['B':'C'](1), 6.510000000000001)
430. 
431. 
432. class _ConstraintsTestA(Model):
433.     stddev = Parameter(default=0, min=0, max=0.3)
434.     mean = Parameter(default=0, fixed=True)
435. 
436.     @staticmethod
437.     def evaluate(stddev, mean):
438.         return stddev, mean
439. 
440. 
441. class _ConstraintsTestB(Model):
442.     mean = Parameter(default=0, fixed=True)
443. 
444.     @staticmethod
445.     def evaluate(mean):
446.         return mean
447. 
448. 
449. def test_inherit_constraints():
450.     """
451.     Various tests for copying of constraint values between compound models and
452.     their members.
453. 
454.     Regression test for https://github.com/astropy/astropy/issues/3481
455.     """
456.     model = (Gaussian1D(bounds={'stddev': (0, 0.3)}, fixed={'mean': True}) +
457.              Gaussian1D(fixed={'mean': True}))
458. 
459.     # Lots of assertions in this test as there are multiple interfaces to
460.     # parameter constraints
461. 
462.     assert 'stddev_0' in model.bounds
463.     assert model.bounds['stddev_0'] == (0, 0.3)
464.     assert model.stddev_0.bounds == (0, 0.3)
465.     assert 'mean_0' in model.fixed
466.     assert model.fixed['mean_0'] is True
467.     assert model.mean_0.fixed is True
468.     assert 'mean_1' in model.fixed
469.     assert model.fixed['mean_1'] is True
470.     assert model.mean_1.fixed is True
471. 
472.     assert model.stddev_0 is model[0].stddev
473.     # Great, all the constraints were inherited properly
474.     # Now what about if we update them through the sub-models?
475.     model.stddev_0.bounds = (0, 0.4)
476.     assert model[0].stddev.bounds == (0, 0.4)
477.     assert model[0].bounds['stddev'] == (0, 0.4)
478. 
479.     model.stddev_0.bounds = (0.1, 0.5)
480.     assert model[0].stddev.bounds == (0.1, 0.5)
481.     assert model[0].bounds['stddev'] == (0.1, 0.5)
482. 
483.     model[1].mean.fixed = False
484.     assert model.mean_1.fixed is False
485.     assert model[1].mean.fixed is False
486. 
487.     # Now turn off syncing of constraints
488.     assert model.bounds['stddev_0']  == (0.1, 0.5)
489.     model.sync_constraints = False
490.     model[0].stddev.bounds = (0, 0.2)
491.     assert model.bounds['stddev_0'] == (0.1, 0.5)
492.     model.sync_constraints = True
493.     assert model.bounds['stddev_0'] == (0, 0.2)
494. 
495. 
496. def test_compound_custom_inverse():
497.     """
498.     Test that a compound model with a custom inverse has that inverse applied
499.     when the inverse of another model, of which it is a component, is computed.
500.     Regression test for https://github.com/astropy/astropy/issues/3542


File: astropy/modeling/tests/test_separable.py
Line number range: 1 - 150
Content:
1. # Licensed under a 3-clause BSD style license - see LICENSE.rst
2. """
3. Test separability of models.
4. 
5. """
6. # pylint: disable=invalid-name
7. import pytest
8. import numpy as np
9. from numpy.testing import assert_allclose
10. 
11. from astropy.modeling import custom_model, models
12. from astropy.modeling.models import Mapping
13. from astropy.modeling.separable import (_coord_matrix, is_separable, _cdot,
14.                                         _cstack, _arith_oper, separability_matrix)
15. from astropy.modeling.core import ModelDefinitionError
16. 
17. 
18. sh1 = models.Shift(1, name='shift1')
19. sh2 = models.Shift(2, name='sh2')
20. scl1 = models.Scale(1, name='scl1')
21. scl2 = models.Scale(2, name='scl2')
22. map1 = Mapping((0, 1, 0, 1), name='map1')
23. map2 = Mapping((0, 0, 1), name='map2')
24. map3 = Mapping((0, 0), name='map3')
25. rot = models.Rotation2D(2, name='rotation')
26. p2 = models.Polynomial2D(1, name='p2')
27. p22 = models.Polynomial2D(2, name='p22')
28. p1 = models.Polynomial1D(1, name='p1')
29. 
30. 
31. compound_models = {
32.     'cm1': (map3 & sh1 | rot & sh1 | sh1 & sh2 & sh1,
33.             (np.array([False, False, True]),
34.              np.array([[True, False], [True, False], [False, True]]))
35.             ),
36.     'cm2': (sh1 & sh2 | rot | map1 | p2 & p22,
37.             (np.array([False, False]),
38.              np.array([[True, True], [True, True]]))
39.             ),
40.     'cm3': (map2 | rot & scl1,
41.             (np.array([False, False, True]),
42.              np.array([[True, False], [True, False], [False, True]]))
43.             ),
44.     'cm4': (sh1 & sh2 | map2 | rot & scl1,
45.             (np.array([False, False, True]),
46.              np.array([[True, False], [True, False], [False, True]]))
47.             ),
48.     'cm5': (map3 | sh1 & sh2 | scl1 & scl2,
49.             (np.array([False, False]),
50.              np.array([[True], [True]]))
51.             ),
52.     'cm7': (map2 | p2 & sh1,
53.             (np.array([False, True]),
54.              np.array([[True, False], [False, True]]))
55.             )
56. }
57. 
58. 
59. def test_coord_matrix():
60.     c = _coord_matrix(p2, 'left', 2)
61.     assert_allclose(np.array([[1, 1], [0, 0]]), c)
62.     c = _coord_matrix(p2, 'right', 2)
63.     assert_allclose(np.array([[0, 0], [1, 1]]), c)
64.     c = _coord_matrix(p1, 'left', 2)
65.     assert_allclose(np.array([[1], [0]]), c)
66.     c = _coord_matrix(p1, 'left', 1)
67.     assert_allclose(np.array([[1]]), c)
68.     c = _coord_matrix(sh1, 'left', 2)
69.     assert_allclose(np.array([[1], [0]]), c)
70.     c = _coord_matrix(sh1, 'right', 2)
71.     assert_allclose(np.array([[0], [1]]), c)
72.     c = _coord_matrix(sh1, 'right', 3)
73.     assert_allclose(np.array([[0], [0], [1]]), c)
74.     c = _coord_matrix(map3, 'left', 2)
75.     assert_allclose(np.array([[1], [1]]), c)
76.     c = _coord_matrix(map3, 'left', 3)
77.     assert_allclose(np.array([[1], [1], [0]]), c)
78. 
79. 
80. def test_cdot():
81.     result = _cdot(sh1, scl1)
82.     assert_allclose(result, np.array([[1]]))
83. 
84.     result = _cdot(rot, p2)
85.     assert_allclose(result, np.array([[2, 2]]))
86. 
87.     result = _cdot(rot, rot)
88.     assert_allclose(result, np.array([[2, 2], [2, 2]]))
89. 
90.     result = _cdot(Mapping((0, 0)), rot)
91.     assert_allclose(result, np.array([[2], [2]]))
92. 
93.     with pytest.raises(ModelDefinitionError,
94.                        match=r"Models cannot be combined with the \"|\" operator; .*"):
95.         _cdot(sh1, map1)
96. 
97. 
98. def test_cstack():
99.     result = _cstack(sh1, scl1)
100.     assert_allclose(result, np.array([[1, 0], [0, 1]]))
101. 
102.     result = _cstack(sh1, rot)
103.     assert_allclose(result,
104.                     np.array([[1, 0, 0],
105.                               [0, 1, 1],
106.                               [0, 1, 1]])
107.                     )
108.     result = _cstack(rot, sh1)
109.     assert_allclose(result,
110.                     np.array([[1, 1, 0],
111.                               [1, 1, 0],
112.                               [0, 0, 1]])
113.                     )
114. 
115. 
116. def test_arith_oper():
117.     # Models as inputs
118.     result = _arith_oper(sh1, scl1)
119.     assert_allclose(result, np.array([[1]]))
120.     result = _arith_oper(rot, rot)
121.     assert_allclose(result, np.array([[1, 1], [1, 1]]))
122. 
123.     # ndarray
124.     result = _arith_oper(np.array([[1, 2], [3, 4]]), np.array([[1, 2], [3, 4]]))
125.     assert_allclose(result, np.array([[1, 1], [1, 1]]))
126. 
127.     # Error
128.     with pytest.raises(ModelDefinitionError, match=r"Unsupported operands for arithmetic operator: .*"):
129.         _arith_oper(sh1, map1)
130. 
131. 
132. @pytest.mark.parametrize(('compound_model', 'result'), compound_models.values())
133. def test_separable(compound_model, result):
134.     assert_allclose(is_separable(compound_model), result[0])
135.     assert_allclose(separability_matrix(compound_model), result[1])
136. 
137. 
138. def test_custom_model_separable():
139.     @custom_model
140.     def model_a(x):
141.         return x
142. 
143.     assert model_a().separable
144. 
145.     @custom_model
146.     def model_c(x, y):
147.         return x + y
148. 
149.     assert not model_c().separable
150.     assert np.all(separability_matrix(model_c()) == [True, True])

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 08:12:05,843 - thread-126572587648704.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find 3 test cases related to a bug in `separability_matrix` for nested compound models. The provided context contains `astropy/modeling/tests/test_separable.py` and `astropy/modeling/tests/test_compound.py`. The file `test_separable.py` contains `test_separable`, a parameterized test that invokes `separability_matrix` on various compound models, including ones with the `&` operator and nested structures. The file `test_compound.py` includes tests like `test_n_submodels` and `test_expression_formatting` that demonstrate the construction of nested compound models. This context is sufficient to extract multiple relevant test cases that test similar functionality. Therefore, no additional context is needed.' query='' extra_requirements='' purpose=''
2025-12-21 08:12:05,844 - thread-126572587648704.prometheus_context_collector - INFO - Successfully retrieved 2 context snippets
