2025-12-23 03:57:56,111 - thread-130892567656128.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: lambdify(modules='mpmath') doesn't wrap rationals

Description: ```py
>>> eqn = Eq(rf(18,x), 77 + S(1)/3)
>>> f = lambdify(x, eqn.lhs - eqn.rhs, 'mpmath')
>>> print(inspect.getsource(f))
def _lambdifygenerated(x):
    return (  # Not supported in Python:
  # RisingFactorial
RisingFactorial(18, x) - 232/3)
```

This results in reduced precision results from `nsolve`, because the 232/3 isn't evaluated at full precision. 

```py
>>> eqn = Eq(rf(18,x), 77 + S(1)/3)
>>> x0 = nsolve(eqn, Float('1.5', 64), prec=64)
>>> rf(18, x0).evalf(64)
77.33333333333332859638176159933209419250488281250000000000000000
```

Originally reported at https://github.com/sympy/sympy/pull/14971

Patch information:
diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py
index d06901425d..8612ff78bb 100644
--- a/sympy/printing/pycode.py
+++ b/sympy/printing/pycode.py
@@ -305,6 +305,8 @@ def pycode(expr, **settings):
 _in_mpmath = [(k, v) for k, v in _known_functions_math.items() if k not in _not_in_mpmath]
 _known_functions_mpmath = dict(_in_mpmath, **{
     'sign': 'sign',
+    'RisingFactorial': 'rf',
+    'FallingFactorial': 'ff',
 })
 _known_constants_mpmath = {
     'Pi': 'pi'
@@ -331,6 +333,14 @@ def _print_Float(self, e):
         args = str(tuple(map(int, e._mpf_)))
         return '{func}({args})'.format(func=self._module_format('mpmath.mpf'), args=args)
 
+    def _print_Rational(self, expr):
+        # Ensure rationals are evaluated with full mpmath precision
+        p, q = int(expr.p), int(expr.q)
+        mpf = self._module_format('mpmath.mpf')
+        if p < 0:
+            return '-({mpf}({num})/{mpf}({den}))'.format(mpf=mpf, num=abs(p), den=q)
+        return '({mpf}({num})/{mpf}({den}))'.format(mpf=mpf, num=p, den=q)
+
 
     def _print_uppergamma(self, e):
         return "{0}({1}, {2}, {3})".format(


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 03:57:56,191 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   └── tensor.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── python-comparisons.rst
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── evaluate.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_evaluate.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolution.py
    |   ├── recurrence.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolution.py
    |   |   ├── test_recurrence.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_1_2.py
    |   |   |   ├── test_1_3.py
    |   |   |   ├── test_1_4.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   └── dpll2.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── unitsystems.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_plot.py
    |   |   └── test_plot_implicit.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   └── test_theanocode.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_mix.py
    |       ├── test_rv.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_functions.py
    |       ├── test_index_methods.py
    |       ├── test_indexed.py
    |       └── test_tensor.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   └── timeutils.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: lambdify(modules='mpmath') doesn't wrap rationals

Description: ```py
>>> eqn = Eq(rf(18,x), 77 + S(1)/3)
>>> f = lambdify(x, eqn.lhs - eqn.rhs, 'mpmath')
>>> print(inspect.getsource(f))
def _lambdifygenerated(x):
    return (  # Not supported in Python:
  # RisingFactorial
RisingFactorial(18, x) - 232/3)
```

This results in reduced precision results from `nsolve`, because the 232/3 isn't evaluated at full precision. 

```py
>>> eqn = Eq(rf(18,x), 77 + S(1)/3)
>>> x0 = nsolve(eqn, Float('1.5', 64), prec=64)
>>> rf(18, x0).evalf(64)
77.33333333333332859638176159933209419250488281250000000000000000
```

Originally reported at https://github.com/sympy/sympy/pull/14971

Patch information:
diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py
index d06901425d..8612ff78bb 100644
--- a/sympy/printing/pycode.py
+++ b/sympy/printing/pycode.py
@@ -305,6 +305,8 @@ def pycode(expr, **settings):
 _in_mpmath = [(k, v) for k, v in _known_functions_math.items() if k not in _not_in_mpmath]
 _known_functions_mpmath = dict(_in_mpmath, **{
     'sign': 'sign',
+    'RisingFactorial': 'rf',
+    'FallingFactorial': 'ff',
 })
 _known_constants_mpmath = {
     'Pi': 'pi'
@@ -331,6 +333,14 @@ def _print_Float(self, e):
         args = str(tuple(map(int, e._mpf_)))
         return '{func}({args})'.format(func=self._module_format('mpmath.mpf'), args=args)
 
+    def _print_Rational(self, expr):
+        # Ensure rationals are evaluated with full mpmath precision
+        p, q = int(expr.p), int(expr.q)
+        mpf = self._module_format('mpmath.mpf')
+        if p < 0:
+            return '-({mpf}({num})/{mpf}({den}))'.format(mpf=mpf, num=abs(p), den=q)
+        return '({mpf}({num})/{mpf}({den}))'.format(mpf=mpf, num=p, den=q)
+
 
     def _print_uppergamma(self, e):
         return "{0}({1}, {2}, {3})".format(


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 03:58:09,467 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find relevant test cases for a bug related to `lambdify` and `mpmath`. To do this, I need to examine the tests for `lambdify` and the python code printer used by it. The current context is empty. Therefore, I need to get the content of the relevant test files.' query='Please provide the full content of `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`.' extra_requirements='' purpose='I need the content of these files to find existing test cases that are relevant to the bug concerning `lambdify` with the `mpmath` module and `Rational` numbers.'
2025-12-23 03:58:09,468 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`.
2025-12-23 03:58:09,468 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 03:58:09,468 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 03:58:09,469 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 03:58:09,469 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`.
Purpose: I need the content of these files to find existing test cases that are relevant to the bug concerning `lambdify` with the `mpmath` module and `Rational` numbers.
2025-12-23 03:58:12,858 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have started by reading the contents of both `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py` to get a better understanding of the existing test cases. This will help in identifying any relevant tests concerning the `lambdify` function, `mpmath` module, and `Rational` numbers.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/printing/tests/test_pycode.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2131, 'candidates_token_count': 132, 'total_token_count': 2434, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2131}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 132}], 'thoughts_token_count': 171, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.07590481006737912, 'model_name': 'gemini-2.5-pro'} id='run--2fe96c98-b8fb-4c76-9bef-bd8cd21a1eec-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/utilities/tests/test_lambdify.py'}, 'id': '0694f3c3-1f03-4a8a-8470-e6b88a8fe210', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/printing/tests/test_pycode.py'}, 'id': '9baaf647-53a1-4c33-983f-2d148d72c151', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2131, 'output_tokens': 132, 'total_tokens': 2434, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 171}}
2025-12-23 03:58:17,685 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the contents of both `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`. My next step is to analyze these files to locate existing test cases that involve the `lambdify` function, the `mpmath` module, and `Rational` numbers. This will help determine if the bug is covered by existing tests or if new ones need to be created. I will start by searching for occurrences of "mpmath" within the `test_lambdify.py` file.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "sympy/utilities/tests/test_lambdify.py", "text": "mpmath"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12476, 'candidates_token_count': 158, 'total_token_count': 12910, 'cached_content_token_count': 1883, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12476}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1883}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 158}], 'thoughts_token_count': 276}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17617405517191825, 'model_name': 'gemini-2.5-pro'} id='run--1c5b8d79-5a83-4d25-ac22-76a09914a701-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'sympy/utilities/tests/test_lambdify.py', 'text': 'mpmath'}, 'id': '1c36cdbf-55d9-4c6d-b567-a392dfad60b0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12476, 'output_tokens': 158, 'total_tokens': 12910, 'input_token_details': {'cache_read': 1883}, 'output_token_details': {'reasoning': 276}}
2025-12-23 03:58:21,318 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the content of `test_lambdify.py` and found several references to `mpmath`. I then cross-referenced these with the usage of `Rational` within the same file to find relevant test cases. It appears that there are no existing tests that specifically combine `lambdify`, `mpmath`, and `Rational` numbers.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "sympy/utilities/tests/test_lambdify.py", "text": "Rational"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 13376, 'candidates_token_count': 110, 'total_token_count': 13669, 'cached_content_token_count': 11264, 'prompt_tokens_details': [{'modality': 1, 'token_count': 13376}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11264}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 110}], 'thoughts_token_count': 183}, 'finish_reason': 'STOP', 'avg_logprobs': -0.31154129721901636, 'model_name': 'gemini-2.5-pro'} id='run--667a3578-aa15-4a95-8b94-aa4893868c51-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'sympy/utilities/tests/test_lambdify.py', 'text': 'Rational'}, 'id': 'bbc9f1cc-7325-47fe-b077-ababca6dff51', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13376, 'output_tokens': 110, 'total_tokens': 13669, 'input_token_details': {'cache_read': 11264}, 'output_token_details': {'reasoning': 183}}
2025-12-23 03:58:26,765 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now also searched for the term "mpmath" in the second file, `sympy/printing/tests/test_pycode.py`, to ensure all bases are covered. This will help me determine if there are any other relevant test cases that might not be in the main `test_lambdify.py` file. After this final search, I will have a complete picture of the existing tests related to `lambdify`, `mpmath`, and `Rational` numbers.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "sympy/printing/tests/test_pycode.py", "text": "mpmath"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 14405, 'candidates_token_count': 138, 'total_token_count': 14888, 'cached_content_token_count': 13135, 'prompt_tokens_details': [{'modality': 1, 'token_count': 14405}], 'cache_tokens_details': [{'modality': 1, 'token_count': 13135}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 138}], 'thoughts_token_count': 345}, 'finish_reason': 'STOP', 'avg_logprobs': -0.25670040517613507, 'model_name': 'gemini-2.5-pro'} id='run--ae1beeb0-30d0-4363-8253-0bb263770692-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'sympy/printing/tests/test_pycode.py', 'text': 'mpmath'}, 'id': 'f51e632f-47b0-4709-9b6f-91515acc41c5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14405, 'output_tokens': 138, 'total_tokens': 14888, 'input_token_details': {'cache_read': 13135}, 'output_token_details': {'reasoning': 345}}
2025-12-23 03:58:36,045 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now completed a thorough review of both `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`. My analysis, which included searching for "mpmath" and "Rational" in both files, reveals that there are no existing test cases that specifically address the combination of `lambdify` with the `mpmath` module and `Rational` numbers. While I found tests that cover these features separately, the particular scenario of interest for the bug is not covered.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 14994, 'candidates_token_count': 112, 'total_token_count': 15948, 'cached_content_token_count': 13103, 'prompt_tokens_details': [{'modality': 1, 'token_count': 14994}], 'cache_tokens_details': [{'modality': 1, 'token_count': 13103}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 112}], 'thoughts_token_count': 842}, 'finish_reason': 'STOP', 'avg_logprobs': -0.8140411376953125, 'model_name': 'gemini-2.5-pro'} id='run--05bbedcb-8c91-41fe-b4ce-e31b6600c58f-0' usage_metadata={'input_tokens': 14994, 'output_tokens': 112, 'total_tokens': 15948, 'input_token_details': {'cache_read': 13103}, 'output_token_details': {'reasoning': 842}}
2025-12-23 03:58:36,047 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need the content of these files to find existing test cases that are relevant to the bug concerning `lambdify` with the `mpmath` module and `Rational` numbers.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/printing/tests/test_pycode.py
Line number range: 1 - 91
Content:
1. # -*- coding: utf-8 -*-
2. from __future__ import (absolute_import, division, print_function)
3. 
4. from sympy.codegen import Assignment
5. from sympy.core import Expr, Mod, symbols, Eq, Le, Gt, zoo, oo
6. from sympy.core.numbers import pi
7. from sympy.codegen.ast import none
8. from sympy.external import import_module
9. from sympy.logic import And, Or
10. from sympy.functions import acos, Piecewise, sign
11. from sympy.matrices import SparseMatrix
12. from sympy.printing.pycode import (
13.     MpmathPrinter, NumPyPrinter, PythonCodePrinter, pycode, SciPyPrinter
14. )
15. from sympy.utilities.pytest import raises
16. 
17. x, y, z = symbols('x y z')
18. 
19. 
20. def test_PythonCodePrinter():
21.     prntr = PythonCodePrinter()
22.     assert not prntr.module_imports
23.     assert prntr.doprint(x**y) == 'x**y'
24.     assert prntr.doprint(Mod(x, 2)) == 'x % 2'
25.     assert prntr.doprint(And(x, y)) == 'x and y'
26.     assert prntr.doprint(Or(x, y)) == 'x or y'
27.     assert not prntr.module_imports
28.     assert prntr.doprint(pi) == 'math.pi'
29.     assert prntr.module_imports == {'math': {'pi'}}
30.     assert prntr.doprint(acos(x)) == 'math.acos(x)'
31.     assert prntr.doprint(Assignment(x, 2)) == 'x = 2'
32.     assert prntr.doprint(Piecewise((1, Eq(x, 0)),
33.                         (2, x>6))) == '((1) if (x == 0) else (2) if (x > 6) else None)'
34.     assert prntr.doprint(Piecewise((2, Le(x, 0)),
35.                         (3, Gt(x, 0)), evaluate=False)) == '((2) if (x <= 0) else'\
36.                                                         ' (3) if (x > 0) else None)'
37.     assert prntr.doprint(sign(x)) == '(0.0 if x == 0 else math.copysign(1, x))'
38. 
39. 
40. def test_MpmathPrinter():
41.     p = MpmathPrinter()
42.     assert p.doprint(sign(x)) == 'mpmath.sign(x)'
43. 
44. 
45. def test_NumPyPrinter():
46.     p = NumPyPrinter()
47.     assert p.doprint(sign(x)) == 'numpy.sign(x)'
48. 
49. 
50. def test_SciPyPrinter():
51.     p = SciPyPrinter()
52.     expr = acos(x)
53.     assert 'numpy' not in p.module_imports
54.     assert p.doprint(expr) == 'numpy.arccos(x)'
55.     assert 'numpy' in p.module_imports
56.     assert not any(m.startswith('scipy') for m in p.module_imports)
57.     smat = SparseMatrix(2, 5, {(0, 1): 3})
58.     assert p.doprint(smat) == 'scipy.sparse.coo_matrix([3], ([0], [1]), shape=(2, 5))'
59.     assert 'scipy.sparse' in p.module_imports
60. 
61. 
62. def test_pycode_reserved_words():
63.     s1, s2 = symbols('if else')
64.     raises(ValueError, lambda: pycode(s1 + s2, error_on_reserved=True))
65.     py_str = pycode(s1 + s2)
66.     assert py_str in ('else_ + if_', 'if_ + else_')
67. 
68. 
69. class CustomPrintedObject(Expr):
70.     def _numpycode(self, printer):
71.         return 'numpy'
72. 
73.     def _mpmathcode(self, printer):
74.         return 'mpmath'
75. 
76. 
77. def test_printmethod():
78.     obj = CustomPrintedObject()
79.     assert NumPyPrinter().doprint(obj) == 'numpy'
80.     assert MpmathPrinter().doprint(obj) == 'mpmath'
81. 
82. 
83. def test_codegen_ast_nodes():
84.     assert pycode(none) == 'None'
85. 
86. 
87. def test_issue_14283():
88.     prntr = PythonCodePrinter()
89. 
90.     assert prntr.doprint(zoo) == "float('nan')"
91.     assert prntr.doprint(-oo) == "float('-inf')"


File: sympy/utilities/tests/test_lambdify.py
Line number range: 1 - 500
Content:
1. from distutils.version import LooseVersion as V
2. from itertools import product
3. import math
4. import inspect
5. 
6. import mpmath
7. from sympy.utilities.pytest import XFAIL, raises
8. from sympy import (
9.     symbols, lambdify, sqrt, sin, cos, tan, pi, acos, acosh, Rational,
10.     Float, Matrix, Lambda, Piecewise, exp, Integral, oo, I, Abs, Function,
11.     true, false, And, Or, Not, ITE, Min, Max, floor, diff, IndexedBase, Sum,
12.     DotProduct, Eq, Dummy, sinc)
13. from sympy.printing.lambdarepr import LambdaPrinter
14. from sympy.utilities.lambdify import implemented_function
15. from sympy.utilities.pytest import skip
16. from sympy.utilities.decorator import conserve_mpmath_dps
17. from sympy.external import import_module
18. from sympy.functions.special.gamma_functions import uppergamma,lowergamma
19. 
20. import sympy
21. 
22. 
23. MutableDenseMatrix = Matrix
24. 
25. numpy = import_module('numpy')
26. numexpr = import_module('numexpr')
27. tensorflow = import_module('tensorflow')
28. 
29. if tensorflow:
30.     # Hide Tensorflow warnings
31.     import os
32.     os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
33. 
34. w, x, y, z = symbols('w,x,y,z')
35. 
36. #================== Test different arguments =======================
37. 
38. 
39. def test_no_args():
40.     f = lambdify([], 1)
41.     raises(TypeError, lambda: f(-1))
42.     assert f() == 1
43. 
44. 
45. def test_single_arg():
46.     f = lambdify(x, 2*x)
47.     assert f(1) == 2
48. 
49. 
50. def test_list_args():
51.     f = lambdify([x, y], x + y)
52.     assert f(1, 2) == 3
53. 
54. def test_nested_args():
55.     f1 = lambdify([[w, x]], [w, x])
56.     assert f1([91, 2]) == [91, 2]
57.     raises(TypeError, lambda: f1(1, 2))
58. 
59.     f2 = lambdify([(w, x), (y, z)], [w, x, y, z])
60.     assert f2((18, 12), (73, 4)) == [18, 12, 73, 4]
61.     raises(TypeError, lambda: f2(3, 4))
62. 
63.     f3 = lambdify([w, [[[x]], y], z], [w, x, y, z])
64.     assert f3(10, [[[52]], 31], 44) == [10, 52, 31, 44]
65. 
66. def test_str_args():
67.     f = lambdify('x,y,z', 'z,y,x')
68.     assert f(3, 2, 1) == (1, 2, 3)
69.     assert f(1.0, 2.0, 3.0) == (3.0, 2.0, 1.0)
70.     # make sure correct number of args required
71.     raises(TypeError, lambda: f(0))
72. 
73. 
74. def test_own_namespace_1():
75.     myfunc = lambda x: 1
76.     f = lambdify(x, sin(x), {"sin": myfunc})
77.     assert f(0.1) == 1
78.     assert f(100) == 1
79. 
80. 
81. def test_own_namespace_2():
82.     def myfunc(x):
83.         return 1
84.     f = lambdify(x, sin(x), {'sin': myfunc})
85.     assert f(0.1) == 1
86.     assert f(100) == 1
87. 
88. 
89. def test_own_module():
90.     f = lambdify(x, sin(x), math)
91.     assert f(0) == 0.0
92. 
93. 
94. def test_bad_args():
95.     # no vargs given
96.     raises(TypeError, lambda: lambdify(1))
97.     # same with vector exprs
98.     raises(TypeError, lambda: lambdify([1, 2]))
99. 
100. 
101. def test_atoms():
102.     # Non-Symbol atoms should not be pulled out from the expression namespace
103.     f = lambdify(x, pi + x, {"pi": 3.14})
104.     assert f(0) == 3.14
105.     f = lambdify(x, I + x, {"I": 1j})
106.     assert f(1) == 1 + 1j
107. 
108. #================== Test different modules =========================
109. 
110. # high precision output of sin(0.2*pi) is used to detect if precision is lost unwanted
111. 
112. 
113. @conserve_mpmath_dps
114. def test_sympy_lambda():
115.     mpmath.mp.dps = 50
116.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
117.     f = lambdify(x, sin(x), "sympy")
118.     assert f(x) == sin(x)
119.     prec = 1e-15
120.     assert -prec < f(Rational(1, 5)).evalf() - Float(str(sin02)) < prec
121.     # arctan is in numpy module and should not be available
122.     raises(NameError, lambda: lambdify(x, arctan(x), "sympy"))
123. 
124. 
125. @conserve_mpmath_dps
126. def test_math_lambda():
127.     mpmath.mp.dps = 50
128.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
129.     f = lambdify(x, sin(x), "math")
130.     prec = 1e-15
131.     assert -prec < f(0.2) - sin02 < prec
132.     raises(TypeError, lambda: f(x))
133.            # if this succeeds, it can't be a python math function
134. 
135. 
136. @conserve_mpmath_dps
137. def test_mpmath_lambda():
138.     mpmath.mp.dps = 50
139.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
140.     f = lambdify(x, sin(x), "mpmath")
141.     prec = 1e-49  # mpmath precision is around 50 decimal places
142.     assert -prec < f(mpmath.mpf("0.2")) - sin02 < prec
143.     raises(TypeError, lambda: f(x))
144.            # if this succeeds, it can't be a mpmath function
145. 
146. 
147. @conserve_mpmath_dps
148. def test_number_precision():
149.     mpmath.mp.dps = 50
150.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
151.     f = lambdify(x, sin02, "mpmath")
152.     prec = 1e-49  # mpmath precision is around 50 decimal places
153.     assert -prec < f(0) - sin02 < prec
154. 
155. @conserve_mpmath_dps
156. def test_mpmath_precision():
157.     mpmath.mp.dps = 100
158.     assert str(lambdify((), pi.evalf(100), 'mpmath')()) == str(pi.evalf(100))
159. 
160. #================== Test Translations ==============================
161. # We can only check if all translated functions are valid. It has to be checked
162. # by hand if they are complete.
163. 
164. 
165. def test_math_transl():
166.     from sympy.utilities.lambdify import MATH_TRANSLATIONS
167.     for sym, mat in MATH_TRANSLATIONS.items():
168.         assert sym in sympy.__dict__
169.         assert mat in math.__dict__
170. 
171. 
172. def test_mpmath_transl():
173.     from sympy.utilities.lambdify import MPMATH_TRANSLATIONS
174.     for sym, mat in MPMATH_TRANSLATIONS.items():
175.         assert sym in sympy.__dict__ or sym == 'Matrix'
176.         assert mat in mpmath.__dict__
177. 
178. 
179. def test_numpy_transl():
180.     if not numpy:
181.         skip("numpy not installed.")
182. 
183.     from sympy.utilities.lambdify import NUMPY_TRANSLATIONS
184.     for sym, nump in NUMPY_TRANSLATIONS.items():
185.         assert sym in sympy.__dict__
186.         assert nump in numpy.__dict__
187. 
188. def test_tensorflow_transl():
189.     if not tensorflow:
190.         skip("tensorflow not installed")
191. 
192.     from sympy.utilities.lambdify import TENSORFLOW_TRANSLATIONS
193.     for sym, tens in TENSORFLOW_TRANSLATIONS.items():
194.         assert sym in sympy.__dict__
195.         assert tens in tensorflow.__dict__
196. 
197. def test_numpy_translation_abs():
198.     if not numpy:
199.         skip("numpy not installed.")
200. 
201.     f = lambdify(x, Abs(x), "numpy")
202.     assert f(-1) == 1
203.     assert f(1) == 1
204. 
205. def test_numexpr_printer():
206.     if not numexpr:
207.         skip("numexpr not installed.")
208. 
209.     # if translation/printing is done incorrectly then evaluating
210.     # a lambdified numexpr expression will throw an exception
211.     from sympy.printing.lambdarepr import NumExprPrinter
212.     from sympy import S
213. 
214.     blacklist = ('where', 'complex', 'contains')
215.     arg_tuple = (x, y, z) # some functions take more than one argument
216.     for sym in NumExprPrinter._numexpr_functions.keys():
217.         if sym in blacklist:
218.             continue
219.         ssym = S(sym)
220.         if hasattr(ssym, '_nargs'):
221.             nargs = ssym._nargs[0]
222.         else:
223.             nargs = 1
224.         args = arg_tuple[:nargs]
225.         f = lambdify(args, ssym(*args), modules='numexpr')
226.         assert f(*(1, )*nargs) is not None
227. 
228. def test_issue_9334():
229.     if not numexpr:
230.         skip("numexpr not installed.")
231.     if not numpy:
232.         skip("numpy not installed.")
233.     expr = sympy.S('b*a - sqrt(a**2)')
234.     a, b = sorted(expr.free_symbols, key=lambda s: s.name)
235.     func_numexpr = lambdify((a,b), expr, modules=[numexpr], dummify=False)
236.     foo, bar = numpy.random.random((2, 4))
237.     func_numexpr(foo, bar)
238. 
239. #================== Test some functions ============================
240. 
241. 
242. def test_exponentiation():
243.     f = lambdify(x, x**2)
244.     assert f(-1) == 1
245.     assert f(0) == 0
246.     assert f(1) == 1
247.     assert f(-2) == 4
248.     assert f(2) == 4
249.     assert f(2.5) == 6.25
250. 
251. 
252. def test_sqrt():
253.     f = lambdify(x, sqrt(x))
254.     assert f(0) == 0.0
255.     assert f(1) == 1.0
256.     assert f(4) == 2.0
257.     assert abs(f(2) - 1.414) < 0.001
258.     assert f(6.25) == 2.5
259. 
260. 
261. def test_trig():
262.     f = lambdify([x], [cos(x), sin(x)], 'math')
263.     d = f(pi)
264.     prec = 1e-11
265.     assert -prec < d[0] + 1 < prec
266.     assert -prec < d[1] < prec
267.     d = f(3.14159)
268.     prec = 1e-5
269.     assert -prec < d[0] + 1 < prec
270.     assert -prec < d[1] < prec
271. 
272. #================== Test vectors ===================================
273. 
274. 
275. def test_vector_simple():
276.     f = lambdify((x, y, z), (z, y, x))
277.     assert f(3, 2, 1) == (1, 2, 3)
278.     assert f(1.0, 2.0, 3.0) == (3.0, 2.0, 1.0)
279.     # make sure correct number of args required
280.     raises(TypeError, lambda: f(0))
281. 
282. 
283. def test_vector_discontinuous():
284.     f = lambdify(x, (-1/x, 1/x))
285.     raises(ZeroDivisionError, lambda: f(0))
286.     assert f(1) == (-1.0, 1.0)
287.     assert f(2) == (-0.5, 0.5)
288.     assert f(-2) == (0.5, -0.5)
289. 
290. 
291. def test_trig_symbolic():
292.     f = lambdify([x], [cos(x), sin(x)], 'math')
293.     d = f(pi)
294.     assert abs(d[0] + 1) < 0.0001
295.     assert abs(d[1] - 0) < 0.0001
296. 
297. 
298. def test_trig_float():
299.     f = lambdify([x], [cos(x), sin(x)])
300.     d = f(3.14159)
301.     assert abs(d[0] + 1) < 0.0001
302.     assert abs(d[1] - 0) < 0.0001
303. 
304. 
305. def test_docs():
306.     f = lambdify(x, x**2)
307.     assert f(2) == 4
308.     f = lambdify([x, y, z], [z, y, x])
309.     assert f(1, 2, 3) == [3, 2, 1]
310.     f = lambdify(x, sqrt(x))
311.     assert f(4) == 2.0
312.     f = lambdify((x, y), sin(x*y)**2)
313.     assert f(0, 5) == 0
314. 
315. 
316. def test_math():
317.     f = lambdify((x, y), sin(x), modules="math")
318.     assert f(0, 5) == 0
319. 
320. 
321. def test_sin():
322.     f = lambdify(x, sin(x)**2)
323.     assert isinstance(f(2), float)
324.     f = lambdify(x, sin(x)**2, modules="math")
325.     assert isinstance(f(2), float)
326. 
327. 
328. def test_matrix():
329.     A = Matrix([[x, x*y], [sin(z) + 4, x**z]])
330.     sol = Matrix([[1, 2], [sin(3) + 4, 1]])
331.     f = lambdify((x, y, z), A, modules="sympy")
332.     assert f(1, 2, 3) == sol
333.     f = lambdify((x, y, z), (A, [A]), modules="sympy")
334.     assert f(1, 2, 3) == (sol, [sol])
335.     J = Matrix((x, x + y)).jacobian((x, y))
336.     v = Matrix((x, y))
337.     sol = Matrix([[1, 0], [1, 1]])
338.     assert lambdify(v, J, modules='sympy')(1, 2) == sol
339.     assert lambdify(v.T, J, modules='sympy')(1, 2) == sol
340. 
341. def test_numpy_matrix():
342.     if not numpy:
343.         skip("numpy not installed.")
344.     A = Matrix([[x, x*y], [sin(z) + 4, x**z]])
345.     sol_arr = numpy.array([[1, 2], [numpy.sin(3) + 4, 1]])
346.     #Lambdify array first, to ensure return to array as default
347.     f = lambdify((x, y, z), A, ['numpy'])
348.     numpy.testing.assert_allclose(f(1, 2, 3), sol_arr)
349.     #Check that the types are arrays and matrices
350.     assert isinstance(f(1, 2, 3), numpy.ndarray)
351. 
352. def test_numpy_transpose():
353.     if not numpy:
354.         skip("numpy not installed.")
355.     A = Matrix([[1, x], [0, 1]])
356.     f = lambdify((x), A.T, modules="numpy")
357.     numpy.testing.assert_array_equal(f(2), numpy.array([[1, 0], [2, 1]]))
358. 
359. def test_numpy_dotproduct():
360.     if not numpy:
361.         skip("numpy not installed")
362.     A = Matrix([x, y, z])
363.     f1 = lambdify([x, y, z], DotProduct(A, A), modules='numpy')
364.     f2 = lambdify([x, y, z], DotProduct(A, A.T), modules='numpy')
365.     f3 = lambdify([x, y, z], DotProduct(A.T, A), modules='numpy')
366.     f4 = lambdify([x, y, z], DotProduct(A, A.T), modules='numpy')
367. 
368.     assert f1(1, 2, 3) == \
369.            f2(1, 2, 3) == \
370.            f3(1, 2, 3) == \
371.            f4(1, 2, 3) == \
372.            numpy.array([14])
373. 
374. def test_numpy_inverse():
375.     if not numpy:
376.         skip("numpy not installed.")
377.     A = Matrix([[1, x], [0, 1]])
378.     f = lambdify((x), A**-1, modules="numpy")
379.     numpy.testing.assert_array_equal(f(2), numpy.array([[1, -2], [0,  1]]))
380. 
381. def test_numpy_old_matrix():
382.     if not numpy:
383.         skip("numpy not installed.")
384.     A = Matrix([[x, x*y], [sin(z) + 4, x**z]])
385.     sol_arr = numpy.array([[1, 2], [numpy.sin(3) + 4, 1]])
386.     f = lambdify((x, y, z), A, [{'ImmutableDenseMatrix': numpy.matrix}, 'numpy'])
387.     numpy.testing.assert_allclose(f(1, 2, 3), sol_arr)
388.     assert isinstance(f(1, 2, 3), numpy.matrix)
389. 
390. def test_python_div_zero_issue_11306():
391.     if not numpy:
392.         skip("numpy not installed.")
393.     p = Piecewise((1 / x, y < -1), (x, y < 1), (1 / x, True))
394.     f = lambdify([x, y], p, modules='numpy')
395.     numpy.seterr(divide='ignore')
396.     assert float(f(numpy.array([0]),numpy.array([0.5]))) == 0
397.     assert str(float(f(numpy.array([0]),numpy.array([1])))) == 'inf'
398.     numpy.seterr(divide='warn')
399. 
400. def test_issue9474():
401.     mods = [None, 'math']
402.     if numpy:
403.         mods.append('numpy')
404.     if mpmath:
405.         mods.append('mpmath')
406.     for mod in mods:
407.         f = lambdify(x, sympy.S(1)/x, modules=mod)
408.         assert f(2) == 0.5
409.         f = lambdify(x, floor(sympy.S(1)/x), modules=mod)
410.         assert f(2) == 0
411. 
412.     for absfunc, modules in product([Abs, abs], mods):
413.         f = lambdify(x, absfunc(x), modules=modules)
414.         assert f(-1) == 1
415.         assert f(1) == 1
416.         assert f(3+4j) == 5
417. 
418. 
419. def test_issue_9871():
420.     if not numexpr:
421.         skip("numexpr not installed.")
422.     if not numpy:
423.         skip("numpy not installed.")
424. 
425.     r = sqrt(x**2 + y**2)
426.     expr = diff(1/r, x)
427. 
428.     xn = yn = numpy.linspace(1, 10, 16)
429.     # expr(xn, xn) = -xn/(sqrt(2)*xn)^3
430.     fv_exact = -numpy.sqrt(2.)**-3 * xn**-2
431. 
432.     fv_numpy = lambdify((x, y), expr, modules='numpy')(xn, yn)
433.     fv_numexpr = lambdify((x, y), expr, modules='numexpr')(xn, yn)
434.     numpy.testing.assert_allclose(fv_numpy, fv_exact, rtol=1e-10)
435.     numpy.testing.assert_allclose(fv_numexpr, fv_exact, rtol=1e-10)
436. 
437. 
438. def test_numpy_piecewise():
439.     if not numpy:
440.         skip("numpy not installed.")
441.     pieces = Piecewise((x, x < 3), (x**2, x > 5), (0, True))
442.     f = lambdify(x, pieces, modules="numpy")
443.     numpy.testing.assert_array_equal(f(numpy.arange(10)),
444.                                      numpy.array([0, 1, 2, 0, 0, 0, 36, 49, 64, 81]))
445.     # If we evaluate somewhere all conditions are False, we should get back NaN
446.     nodef_func = lambdify(x, Piecewise((x, x > 0), (-x, x < 0)))
447.     numpy.testing.assert_array_equal(nodef_func(numpy.array([-1, 0, 1])),
448.                                      numpy.array([1, numpy.nan, 1]))
449. 
450. def test_numpy_logical_ops():
451.     if not numpy:
452.         skip("numpy not installed.")
453.     and_func = lambdify((x, y), And(x, y), modules="numpy")
454.     and_func_3 = lambdify((x, y, z), And(x, y, z), modules="numpy")
455.     or_func = lambdify((x, y), Or(x, y), modules="numpy")
456.     or_func_3 = lambdify((x, y, z), Or(x, y, z), modules="numpy")
457.     not_func = lambdify((x), Not(x), modules="numpy")
458.     arr1 = numpy.array([True, True])
459.     arr2 = numpy.array([False, True])
460.     arr3 = numpy.array([True, False])
461.     numpy.testing.assert_array_equal(and_func(arr1, arr2), numpy.array([False, True]))
462.     numpy.testing.assert_array_equal(and_func_3(arr1, arr2, arr3), numpy.array([False, False]))
463.     numpy.testing.assert_array_equal(or_func(arr1, arr2), numpy.array([True, True]))
464.     numpy.testing.assert_array_equal(or_func_3(arr1, arr2, arr3), numpy.array([True, True]))
465.     numpy.testing.assert_array_equal(not_func(arr2), numpy.array([True, False]))
466. 
467. def test_numpy_matmul():
468.     if not numpy:
469.         skip("numpy not installed.")
470.     xmat = Matrix([[x, y], [z, 1+z]])
471.     ymat = Matrix([[x**2], [Abs(x)]])
472.     mat_func = lambdify((x, y, z), xmat*ymat, modules="numpy")
473.     numpy.testing.assert_array_equal(mat_func(0.5, 3, 4), numpy.array([[1.625], [3.5]]))
474.     numpy.testing.assert_array_equal(mat_func(-0.5, 3, 4), numpy.array([[1.375], [3.5]]))
475.     # Multiple matrices chained together in multiplication
476.     f = lambdify((x, y, z), xmat*xmat*xmat, modules="numpy")
477.     numpy.testing.assert_array_equal(f(0.5, 3, 4), numpy.array([[72.125, 119.25],
478.                                                                 [159, 251]]))
479. 
480. def test_numpy_numexpr():
481.     if not numpy:
482.         skip("numpy not installed.")
483.     if not numexpr:
484.         skip("numexpr not installed.")
485.     a, b, c = numpy.random.randn(3, 128, 128)
486.     # ensure that numpy and numexpr return same value for complicated expression
487.     expr = sin(x) + cos(y) + tan(z)**2 + Abs(z-y)*acos(sin(y*z)) + \
488.            Abs(y-z)*acosh(2+exp(y-x))- sqrt(x**2+I*y**2)
489.     npfunc = lambdify((x, y, z), expr, modules='numpy')
490.     nefunc = lambdify((x, y, z), expr, modules='numexpr')
491.     assert numpy.allclose(npfunc(a, b, c), nefunc(a, b, c))
492. 
493. def test_numexpr_userfunctions():
494.     if not numpy:
495.         skip("numpy not installed.")
496.     if not numexpr:
497.         skip("numexpr not installed.")
498.     a, b = numpy.random.randn(2, 10)
499.     uf = type('uf', (Function, ),
500.               {'eval' : classmethod(lambda x, y : y**2+1)})


File: sympy/utilities/tests/test_lambdify.py
Line number range: 765 - 788
Content:
def test_special_printers():
    class IntervalPrinter(LambdaPrinter):
        """Use ``lambda`` printer but print numbers as ``mpi`` intervals. """

        def _print_Integer(self, expr):
            return "mpi('%s')" % super(IntervalPrinter, self)._print_Integer(expr)

        def _print_Rational(self, expr):
            return "mpi('%s')" % super(IntervalPrinter, self)._print_Rational(expr)

    def intervalrepr(expr):
        return IntervalPrinter().doprint(expr)

    expr = sympy.sqrt(sympy.sqrt(2) + sympy.sqrt(3)) + sympy.S(1)/2

    func0 = lambdify((), expr, modules="mpmath", printer=intervalrepr)
    func1 = lambdify((), expr, modules="mpmath", printer=IntervalPrinter)
    func2 = lambdify((), expr, modules="mpmath", printer=IntervalPrinter())

    mpi = type(mpmath.mpi(1, 2))

    assert isinstance(func0(), mpi)
    assert isinstance(func1(), mpi)
    assert isinstance(func2(), mpi)


File: sympy/utilities/tests/test_lambdify.py
Line number range: 837 - 839
Content:
def test_sinc_mpmath():
    f = lambdify(x, sinc(x), "mpmath")
    assert Abs(f(1) - sinc(1)).n() < 1e-15

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 03:58:44,797 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of the file `sympy/printing/tests/test_pycode.py`. This context represents the entire content of that file that is available.', relative_path='sympy/printing/tests/test_pycode.py', start_line=1, end_line=91), ContextOutput(reasoning='The user requested the full content of the file `sympy/utilities/tests/test_lambdify.py`. This context is a part of that file.', relative_path='sympy/utilities/tests/test_lambdify.py', start_line=1, end_line=500), ContextOutput(reasoning='The user requested the full content of the file `sympy/utilities/tests/test_lambdify.py`. This context is a part of that file.', relative_path='sympy/utilities/tests/test_lambdify.py', start_line=765, end_line=788), ContextOutput(reasoning='The user requested the full content of the file `sympy/utilities/tests/test_lambdify.py`. This context is a part of that file.', relative_path='sympy/utilities/tests/test_lambdify.py', start_line=837, end_line=839)]
2025-12-23 03:58:44,799 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 4 contexts to memory for query: Please provide the full content of `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`.
2025-12-23 03:58:44,799 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 03:58:44,799 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 03:58:44,800 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 4 new contexts to 0 existing contexts
2025-12-23 03:58:44,800 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 4 total contexts (removed 0 duplicates)
2025-12-23 03:58:44,801 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   └── tensor.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── python-comparisons.rst
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── evaluate.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_evaluate.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolution.py
    |   ├── recurrence.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolution.py
    |   |   ├── test_recurrence.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_1_2.py
    |   |   |   ├── test_1_3.py
    |   |   |   ├── test_1_4.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   └── dpll2.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── unitsystems.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_plot.py
    |   |   └── test_plot_implicit.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   └── test_theanocode.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_mix.py
    |       ├── test_rv.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_functions.py
    |       ├── test_index_methods.py
    |       ├── test_indexed.py
    |       └── test_tensor.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   └── timeutils.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: lambdify(modules='mpmath') doesn't wrap rationals

Description: ```py
>>> eqn = Eq(rf(18,x), 77 + S(1)/3)
>>> f = lambdify(x, eqn.lhs - eqn.rhs, 'mpmath')
>>> print(inspect.getsource(f))
def _lambdifygenerated(x):
    return (  # Not supported in Python:
  # RisingFactorial
RisingFactorial(18, x) - 232/3)
```

This results in reduced precision results from `nsolve`, because the 232/3 isn't evaluated at full precision. 

```py
>>> eqn = Eq(rf(18,x), 77 + S(1)/3)
>>> x0 = nsolve(eqn, Float('1.5', 64), prec=64)
>>> rf(18, x0).evalf(64)
77.33333333333332859638176159933209419250488281250000000000000000
```

Originally reported at https://github.com/sympy/sympy/pull/14971

Patch information:
diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py
index d06901425d..8612ff78bb 100644
--- a/sympy/printing/pycode.py
+++ b/sympy/printing/pycode.py
@@ -305,6 +305,8 @@ def pycode(expr, **settings):
 _in_mpmath = [(k, v) for k, v in _known_functions_math.items() if k not in _not_in_mpmath]
 _known_functions_mpmath = dict(_in_mpmath, **{
     'sign': 'sign',
+    'RisingFactorial': 'rf',
+    'FallingFactorial': 'ff',
 })
 _known_constants_mpmath = {
     'Pi': 'pi'
@@ -331,6 +333,14 @@ def _print_Float(self, e):
         args = str(tuple(map(int, e._mpf_)))
         return '{func}({args})'.format(func=self._module_format('mpmath.mpf'), args=args)
 
+    def _print_Rational(self, expr):
+        # Ensure rationals are evaluated with full mpmath precision
+        p, q = int(expr.p), int(expr.q)
+        mpf = self._module_format('mpmath.mpf')
+        if p < 0:
+            return '-({mpf}({num})/{mpf}({den}))'.format(mpf=mpf, num=abs(p), den=q)
+        return '({mpf}({num})/{mpf}({den}))'.format(mpf=mpf, num=p, den=q)
+
 
     def _print_uppergamma(self, e):
         return "{0}({1}, {2}, {3})".format(


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py`.
Extra Requirements: 
Purpose: I need the content of these files to find existing test cases that are relevant to the bug concerning `lambdify` with the `mpmath` module and `Rational` numbers.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/printing/tests/test_pycode.py
Line number range: 1 - 91
Content:
1. # -*- coding: utf-8 -*-
2. from __future__ import (absolute_import, division, print_function)
3. 
4. from sympy.codegen import Assignment
5. from sympy.core import Expr, Mod, symbols, Eq, Le, Gt, zoo, oo
6. from sympy.core.numbers import pi
7. from sympy.codegen.ast import none
8. from sympy.external import import_module
9. from sympy.logic import And, Or
10. from sympy.functions import acos, Piecewise, sign
11. from sympy.matrices import SparseMatrix
12. from sympy.printing.pycode import (
13.     MpmathPrinter, NumPyPrinter, PythonCodePrinter, pycode, SciPyPrinter
14. )
15. from sympy.utilities.pytest import raises
16. 
17. x, y, z = symbols('x y z')
18. 
19. 
20. def test_PythonCodePrinter():
21.     prntr = PythonCodePrinter()
22.     assert not prntr.module_imports
23.     assert prntr.doprint(x**y) == 'x**y'
24.     assert prntr.doprint(Mod(x, 2)) == 'x % 2'
25.     assert prntr.doprint(And(x, y)) == 'x and y'
26.     assert prntr.doprint(Or(x, y)) == 'x or y'
27.     assert not prntr.module_imports
28.     assert prntr.doprint(pi) == 'math.pi'
29.     assert prntr.module_imports == {'math': {'pi'}}
30.     assert prntr.doprint(acos(x)) == 'math.acos(x)'
31.     assert prntr.doprint(Assignment(x, 2)) == 'x = 2'
32.     assert prntr.doprint(Piecewise((1, Eq(x, 0)),
33.                         (2, x>6))) == '((1) if (x == 0) else (2) if (x > 6) else None)'
34.     assert prntr.doprint(Piecewise((2, Le(x, 0)),
35.                         (3, Gt(x, 0)), evaluate=False)) == '((2) if (x <= 0) else'\
36.                                                         ' (3) if (x > 0) else None)'
37.     assert prntr.doprint(sign(x)) == '(0.0 if x == 0 else math.copysign(1, x))'
38. 
39. 
40. def test_MpmathPrinter():
41.     p = MpmathPrinter()
42.     assert p.doprint(sign(x)) == 'mpmath.sign(x)'
43. 
44. 
45. def test_NumPyPrinter():
46.     p = NumPyPrinter()
47.     assert p.doprint(sign(x)) == 'numpy.sign(x)'
48. 
49. 
50. def test_SciPyPrinter():
51.     p = SciPyPrinter()
52.     expr = acos(x)
53.     assert 'numpy' not in p.module_imports
54.     assert p.doprint(expr) == 'numpy.arccos(x)'
55.     assert 'numpy' in p.module_imports
56.     assert not any(m.startswith('scipy') for m in p.module_imports)
57.     smat = SparseMatrix(2, 5, {(0, 1): 3})
58.     assert p.doprint(smat) == 'scipy.sparse.coo_matrix([3], ([0], [1]), shape=(2, 5))'
59.     assert 'scipy.sparse' in p.module_imports
60. 
61. 
62. def test_pycode_reserved_words():
63.     s1, s2 = symbols('if else')
64.     raises(ValueError, lambda: pycode(s1 + s2, error_on_reserved=True))
65.     py_str = pycode(s1 + s2)
66.     assert py_str in ('else_ + if_', 'if_ + else_')
67. 
68. 
69. class CustomPrintedObject(Expr):
70.     def _numpycode(self, printer):
71.         return 'numpy'
72. 
73.     def _mpmathcode(self, printer):
74.         return 'mpmath'
75. 
76. 
77. def test_printmethod():
78.     obj = CustomPrintedObject()
79.     assert NumPyPrinter().doprint(obj) == 'numpy'
80.     assert MpmathPrinter().doprint(obj) == 'mpmath'
81. 
82. 
83. def test_codegen_ast_nodes():
84.     assert pycode(none) == 'None'
85. 
86. 
87. def test_issue_14283():
88.     prntr = PythonCodePrinter()
89. 
90.     assert prntr.doprint(zoo) == "float('nan')"
91.     assert prntr.doprint(-oo) == "float('-inf')"


File: sympy/utilities/tests/test_lambdify.py
Line number range: 1 - 500
Content:
1. from distutils.version import LooseVersion as V
2. from itertools import product
3. import math
4. import inspect
5. 
6. import mpmath
7. from sympy.utilities.pytest import XFAIL, raises
8. from sympy import (
9.     symbols, lambdify, sqrt, sin, cos, tan, pi, acos, acosh, Rational,
10.     Float, Matrix, Lambda, Piecewise, exp, Integral, oo, I, Abs, Function,
11.     true, false, And, Or, Not, ITE, Min, Max, floor, diff, IndexedBase, Sum,
12.     DotProduct, Eq, Dummy, sinc)
13. from sympy.printing.lambdarepr import LambdaPrinter
14. from sympy.utilities.lambdify import implemented_function
15. from sympy.utilities.pytest import skip
16. from sympy.utilities.decorator import conserve_mpmath_dps
17. from sympy.external import import_module
18. from sympy.functions.special.gamma_functions import uppergamma,lowergamma
19. 
20. import sympy
21. 
22. 
23. MutableDenseMatrix = Matrix
24. 
25. numpy = import_module('numpy')
26. numexpr = import_module('numexpr')
27. tensorflow = import_module('tensorflow')
28. 
29. if tensorflow:
30.     # Hide Tensorflow warnings
31.     import os
32.     os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
33. 
34. w, x, y, z = symbols('w,x,y,z')
35. 
36. #================== Test different arguments =======================
37. 
38. 
39. def test_no_args():
40.     f = lambdify([], 1)
41.     raises(TypeError, lambda: f(-1))
42.     assert f() == 1
43. 
44. 
45. def test_single_arg():
46.     f = lambdify(x, 2*x)
47.     assert f(1) == 2
48. 
49. 
50. def test_list_args():
51.     f = lambdify([x, y], x + y)
52.     assert f(1, 2) == 3
53. 
54. def test_nested_args():
55.     f1 = lambdify([[w, x]], [w, x])
56.     assert f1([91, 2]) == [91, 2]
57.     raises(TypeError, lambda: f1(1, 2))
58. 
59.     f2 = lambdify([(w, x), (y, z)], [w, x, y, z])
60.     assert f2((18, 12), (73, 4)) == [18, 12, 73, 4]
61.     raises(TypeError, lambda: f2(3, 4))
62. 
63.     f3 = lambdify([w, [[[x]], y], z], [w, x, y, z])
64.     assert f3(10, [[[52]], 31], 44) == [10, 52, 31, 44]
65. 
66. def test_str_args():
67.     f = lambdify('x,y,z', 'z,y,x')
68.     assert f(3, 2, 1) == (1, 2, 3)
69.     assert f(1.0, 2.0, 3.0) == (3.0, 2.0, 1.0)
70.     # make sure correct number of args required
71.     raises(TypeError, lambda: f(0))
72. 
73. 
74. def test_own_namespace_1():
75.     myfunc = lambda x: 1
76.     f = lambdify(x, sin(x), {"sin": myfunc})
77.     assert f(0.1) == 1
78.     assert f(100) == 1
79. 
80. 
81. def test_own_namespace_2():
82.     def myfunc(x):
83.         return 1
84.     f = lambdify(x, sin(x), {'sin': myfunc})
85.     assert f(0.1) == 1
86.     assert f(100) == 1
87. 
88. 
89. def test_own_module():
90.     f = lambdify(x, sin(x), math)
91.     assert f(0) == 0.0
92. 
93. 
94. def test_bad_args():
95.     # no vargs given
96.     raises(TypeError, lambda: lambdify(1))
97.     # same with vector exprs
98.     raises(TypeError, lambda: lambdify([1, 2]))
99. 
100. 
101. def test_atoms():
102.     # Non-Symbol atoms should not be pulled out from the expression namespace
103.     f = lambdify(x, pi + x, {"pi": 3.14})
104.     assert f(0) == 3.14
105.     f = lambdify(x, I + x, {"I": 1j})
106.     assert f(1) == 1 + 1j
107. 
108. #================== Test different modules =========================
109. 
110. # high precision output of sin(0.2*pi) is used to detect if precision is lost unwanted
111. 
112. 
113. @conserve_mpmath_dps
114. def test_sympy_lambda():
115.     mpmath.mp.dps = 50
116.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
117.     f = lambdify(x, sin(x), "sympy")
118.     assert f(x) == sin(x)
119.     prec = 1e-15
120.     assert -prec < f(Rational(1, 5)).evalf() - Float(str(sin02)) < prec
121.     # arctan is in numpy module and should not be available
122.     raises(NameError, lambda: lambdify(x, arctan(x), "sympy"))
123. 
124. 
125. @conserve_mpmath_dps
126. def test_math_lambda():
127.     mpmath.mp.dps = 50
128.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
129.     f = lambdify(x, sin(x), "math")
130.     prec = 1e-15
131.     assert -prec < f(0.2) - sin02 < prec
132.     raises(TypeError, lambda: f(x))
133.            # if this succeeds, it can't be a python math function
134. 
135. 
136. @conserve_mpmath_dps
137. def test_mpmath_lambda():
138.     mpmath.mp.dps = 50
139.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
140.     f = lambdify(x, sin(x), "mpmath")
141.     prec = 1e-49  # mpmath precision is around 50 decimal places
142.     assert -prec < f(mpmath.mpf("0.2")) - sin02 < prec
143.     raises(TypeError, lambda: f(x))
144.            # if this succeeds, it can't be a mpmath function
145. 
146. 
147. @conserve_mpmath_dps
148. def test_number_precision():
149.     mpmath.mp.dps = 50
150.     sin02 = mpmath.mpf("0.19866933079506121545941262711838975037020672954020")
151.     f = lambdify(x, sin02, "mpmath")
152.     prec = 1e-49  # mpmath precision is around 50 decimal places
153.     assert -prec < f(0) - sin02 < prec
154. 
155. @conserve_mpmath_dps
156. def test_mpmath_precision():
157.     mpmath.mp.dps = 100
158.     assert str(lambdify((), pi.evalf(100), 'mpmath')()) == str(pi.evalf(100))
159. 
160. #================== Test Translations ==============================
161. # We can only check if all translated functions are valid. It has to be checked
162. # by hand if they are complete.
163. 
164. 
165. def test_math_transl():
166.     from sympy.utilities.lambdify import MATH_TRANSLATIONS
167.     for sym, mat in MATH_TRANSLATIONS.items():
168.         assert sym in sympy.__dict__
169.         assert mat in math.__dict__
170. 
171. 
172. def test_mpmath_transl():
173.     from sympy.utilities.lambdify import MPMATH_TRANSLATIONS
174.     for sym, mat in MPMATH_TRANSLATIONS.items():
175.         assert sym in sympy.__dict__ or sym == 'Matrix'
176.         assert mat in mpmath.__dict__
177. 
178. 
179. def test_numpy_transl():
180.     if not numpy:
181.         skip("numpy not installed.")
182. 
183.     from sympy.utilities.lambdify import NUMPY_TRANSLATIONS
184.     for sym, nump in NUMPY_TRANSLATIONS.items():
185.         assert sym in sympy.__dict__
186.         assert nump in numpy.__dict__
187. 
188. def test_tensorflow_transl():
189.     if not tensorflow:
190.         skip("tensorflow not installed")
191. 
192.     from sympy.utilities.lambdify import TENSORFLOW_TRANSLATIONS
193.     for sym, tens in TENSORFLOW_TRANSLATIONS.items():
194.         assert sym in sympy.__dict__
195.         assert tens in tensorflow.__dict__
196. 
197. def test_numpy_translation_abs():
198.     if not numpy:
199.         skip("numpy not installed.")
200. 
201.     f = lambdify(x, Abs(x), "numpy")
202.     assert f(-1) == 1
203.     assert f(1) == 1
204. 
205. def test_numexpr_printer():
206.     if not numexpr:
207.         skip("numexpr not installed.")
208. 
209.     # if translation/printing is done incorrectly then evaluating
210.     # a lambdified numexpr expression will throw an exception
211.     from sympy.printing.lambdarepr import NumExprPrinter
212.     from sympy import S
213. 
214.     blacklist = ('where', 'complex', 'contains')
215.     arg_tuple = (x, y, z) # some functions take more than one argument
216.     for sym in NumExprPrinter._numexpr_functions.keys():
217.         if sym in blacklist:
218.             continue
219.         ssym = S(sym)
220.         if hasattr(ssym, '_nargs'):
221.             nargs = ssym._nargs[0]
222.         else:
223.             nargs = 1
224.         args = arg_tuple[:nargs]
225.         f = lambdify(args, ssym(*args), modules='numexpr')
226.         assert f(*(1, )*nargs) is not None
227. 
228. def test_issue_9334():
229.     if not numexpr:
230.         skip("numexpr not installed.")
231.     if not numpy:
232.         skip("numpy not installed.")
233.     expr = sympy.S('b*a - sqrt(a**2)')
234.     a, b = sorted(expr.free_symbols, key=lambda s: s.name)
235.     func_numexpr = lambdify((a,b), expr, modules=[numexpr], dummify=False)
236.     foo, bar = numpy.random.random((2, 4))
237.     func_numexpr(foo, bar)
238. 
239. #================== Test some functions ============================
240. 
241. 
242. def test_exponentiation():
243.     f = lambdify(x, x**2)
244.     assert f(-1) == 1
245.     assert f(0) == 0
246.     assert f(1) == 1
247.     assert f(-2) == 4
248.     assert f(2) == 4
249.     assert f(2.5) == 6.25
250. 
251. 
252. def test_sqrt():
253.     f = lambdify(x, sqrt(x))
254.     assert f(0) == 0.0
255.     assert f(1) == 1.0
256.     assert f(4) == 2.0
257.     assert abs(f(2) - 1.414) < 0.001
258.     assert f(6.25) == 2.5
259. 
260. 
261. def test_trig():
262.     f = lambdify([x], [cos(x), sin(x)], 'math')
263.     d = f(pi)
264.     prec = 1e-11
265.     assert -prec < d[0] + 1 < prec
266.     assert -prec < d[1] < prec
267.     d = f(3.14159)
268.     prec = 1e-5
269.     assert -prec < d[0] + 1 < prec
270.     assert -prec < d[1] < prec
271. 
272. #================== Test vectors ===================================
273. 
274. 
275. def test_vector_simple():
276.     f = lambdify((x, y, z), (z, y, x))
277.     assert f(3, 2, 1) == (1, 2, 3)
278.     assert f(1.0, 2.0, 3.0) == (3.0, 2.0, 1.0)
279.     # make sure correct number of args required
280.     raises(TypeError, lambda: f(0))
281. 
282. 
283. def test_vector_discontinuous():
284.     f = lambdify(x, (-1/x, 1/x))
285.     raises(ZeroDivisionError, lambda: f(0))
286.     assert f(1) == (-1.0, 1.0)
287.     assert f(2) == (-0.5, 0.5)
288.     assert f(-2) == (0.5, -0.5)
289. 
290. 
291. def test_trig_symbolic():
292.     f = lambdify([x], [cos(x), sin(x)], 'math')
293.     d = f(pi)
294.     assert abs(d[0] + 1) < 0.0001
295.     assert abs(d[1] - 0) < 0.0001
296. 
297. 
298. def test_trig_float():
299.     f = lambdify([x], [cos(x), sin(x)])
300.     d = f(3.14159)
301.     assert abs(d[0] + 1) < 0.0001
302.     assert abs(d[1] - 0) < 0.0001
303. 
304. 
305. def test_docs():
306.     f = lambdify(x, x**2)
307.     assert f(2) == 4
308.     f = lambdify([x, y, z], [z, y, x])
309.     assert f(1, 2, 3) == [3, 2, 1]
310.     f = lambdify(x, sqrt(x))
311.     assert f(4) == 2.0
312.     f = lambdify((x, y), sin(x*y)**2)
313.     assert f(0, 5) == 0
314. 
315. 
316. def test_math():
317.     f = lambdify((x, y), sin(x), modules="math")
318.     assert f(0, 5) == 0
319. 
320. 
321. def test_sin():
322.     f = lambdify(x, sin(x)**2)
323.     assert isinstance(f(2), float)
324.     f = lambdify(x, sin(x)**2, modules="math")
325.     assert isinstance(f(2), float)
326. 
327. 
328. def test_matrix():
329.     A = Matrix([[x, x*y], [sin(z) + 4, x**z]])
330.     sol = Matrix([[1, 2], [sin(3) + 4, 1]])
331.     f = lambdify((x, y, z), A, modules="sympy")
332.     assert f(1, 2, 3) == sol
333.     f = lambdify((x, y, z), (A, [A]), modules="sympy")
334.     assert f(1, 2, 3) == (sol, [sol])
335.     J = Matrix((x, x + y)).jacobian((x, y))
336.     v = Matrix((x, y))
337.     sol = Matrix([[1, 0], [1, 1]])
338.     assert lambdify(v, J, modules='sympy')(1, 2) == sol
339.     assert lambdify(v.T, J, modules='sympy')(1, 2) == sol
340. 
341. def test_numpy_matrix():
342.     if not numpy:
343.         skip("numpy not installed.")
344.     A = Matrix([[x, x*y], [sin(z) + 4, x**z]])
345.     sol_arr = numpy.array([[1, 2], [numpy.sin(3) + 4, 1]])
346.     #Lambdify array first, to ensure return to array as default
347.     f = lambdify((x, y, z), A, ['numpy'])
348.     numpy.testing.assert_allclose(f(1, 2, 3), sol_arr)
349.     #Check that the types are arrays and matrices
350.     assert isinstance(f(1, 2, 3), numpy.ndarray)
351. 
352. def test_numpy_transpose():
353.     if not numpy:
354.         skip("numpy not installed.")
355.     A = Matrix([[1, x], [0, 1]])
356.     f = lambdify((x), A.T, modules="numpy")
357.     numpy.testing.assert_array_equal(f(2), numpy.array([[1, 0], [2, 1]]))
358. 
359. def test_numpy_dotproduct():
360.     if not numpy:
361.         skip("numpy not installed")
362.     A = Matrix([x, y, z])
363.     f1 = lambdify([x, y, z], DotProduct(A, A), modules='numpy')
364.     f2 = lambdify([x, y, z], DotProduct(A, A.T), modules='numpy')
365.     f3 = lambdify([x, y, z], DotProduct(A.T, A), modules='numpy')
366.     f4 = lambdify([x, y, z], DotProduct(A, A.T), modules='numpy')
367. 
368.     assert f1(1, 2, 3) == \
369.            f2(1, 2, 3) == \
370.            f3(1, 2, 3) == \
371.            f4(1, 2, 3) == \
372.            numpy.array([14])
373. 
374. def test_numpy_inverse():
375.     if not numpy:
376.         skip("numpy not installed.")
377.     A = Matrix([[1, x], [0, 1]])
378.     f = lambdify((x), A**-1, modules="numpy")
379.     numpy.testing.assert_array_equal(f(2), numpy.array([[1, -2], [0,  1]]))
380. 
381. def test_numpy_old_matrix():
382.     if not numpy:
383.         skip("numpy not installed.")
384.     A = Matrix([[x, x*y], [sin(z) + 4, x**z]])
385.     sol_arr = numpy.array([[1, 2], [numpy.sin(3) + 4, 1]])
386.     f = lambdify((x, y, z), A, [{'ImmutableDenseMatrix': numpy.matrix}, 'numpy'])
387.     numpy.testing.assert_allclose(f(1, 2, 3), sol_arr)
388.     assert isinstance(f(1, 2, 3), numpy.matrix)
389. 
390. def test_python_div_zero_issue_11306():
391.     if not numpy:
392.         skip("numpy not installed.")
393.     p = Piecewise((1 / x, y < -1), (x, y < 1), (1 / x, True))
394.     f = lambdify([x, y], p, modules='numpy')
395.     numpy.seterr(divide='ignore')
396.     assert float(f(numpy.array([0]),numpy.array([0.5]))) == 0
397.     assert str(float(f(numpy.array([0]),numpy.array([1])))) == 'inf'
398.     numpy.seterr(divide='warn')
399. 
400. def test_issue9474():
401.     mods = [None, 'math']
402.     if numpy:
403.         mods.append('numpy')
404.     if mpmath:
405.         mods.append('mpmath')
406.     for mod in mods:
407.         f = lambdify(x, sympy.S(1)/x, modules=mod)
408.         assert f(2) == 0.5
409.         f = lambdify(x, floor(sympy.S(1)/x), modules=mod)
410.         assert f(2) == 0
411. 
412.     for absfunc, modules in product([Abs, abs], mods):
413.         f = lambdify(x, absfunc(x), modules=modules)
414.         assert f(-1) == 1
415.         assert f(1) == 1
416.         assert f(3+4j) == 5
417. 
418. 
419. def test_issue_9871():
420.     if not numexpr:
421.         skip("numexpr not installed.")
422.     if not numpy:
423.         skip("numpy not installed.")
424. 
425.     r = sqrt(x**2 + y**2)
426.     expr = diff(1/r, x)
427. 
428.     xn = yn = numpy.linspace(1, 10, 16)
429.     # expr(xn, xn) = -xn/(sqrt(2)*xn)^3
430.     fv_exact = -numpy.sqrt(2.)**-3 * xn**-2
431. 
432.     fv_numpy = lambdify((x, y), expr, modules='numpy')(xn, yn)
433.     fv_numexpr = lambdify((x, y), expr, modules='numexpr')(xn, yn)
434.     numpy.testing.assert_allclose(fv_numpy, fv_exact, rtol=1e-10)
435.     numpy.testing.assert_allclose(fv_numexpr, fv_exact, rtol=1e-10)
436. 
437. 
438. def test_numpy_piecewise():
439.     if not numpy:
440.         skip("numpy not installed.")
441.     pieces = Piecewise((x, x < 3), (x**2, x > 5), (0, True))
442.     f = lambdify(x, pieces, modules="numpy")
443.     numpy.testing.assert_array_equal(f(numpy.arange(10)),
444.                                      numpy.array([0, 1, 2, 0, 0, 0, 36, 49, 64, 81]))
445.     # If we evaluate somewhere all conditions are False, we should get back NaN
446.     nodef_func = lambdify(x, Piecewise((x, x > 0), (-x, x < 0)))
447.     numpy.testing.assert_array_equal(nodef_func(numpy.array([-1, 0, 1])),
448.                                      numpy.array([1, numpy.nan, 1]))
449. 
450. def test_numpy_logical_ops():
451.     if not numpy:
452.         skip("numpy not installed.")
453.     and_func = lambdify((x, y), And(x, y), modules="numpy")
454.     and_func_3 = lambdify((x, y, z), And(x, y, z), modules="numpy")
455.     or_func = lambdify((x, y), Or(x, y), modules="numpy")
456.     or_func_3 = lambdify((x, y, z), Or(x, y, z), modules="numpy")
457.     not_func = lambdify((x), Not(x), modules="numpy")
458.     arr1 = numpy.array([True, True])
459.     arr2 = numpy.array([False, True])
460.     arr3 = numpy.array([True, False])
461.     numpy.testing.assert_array_equal(and_func(arr1, arr2), numpy.array([False, True]))
462.     numpy.testing.assert_array_equal(and_func_3(arr1, arr2, arr3), numpy.array([False, False]))
463.     numpy.testing.assert_array_equal(or_func(arr1, arr2), numpy.array([True, True]))
464.     numpy.testing.assert_array_equal(or_func_3(arr1, arr2, arr3), numpy.array([True, True]))
465.     numpy.testing.assert_array_equal(not_func(arr2), numpy.array([True, False]))
466. 
467. def test_numpy_matmul():
468.     if not numpy:
469.         skip("numpy not installed.")
470.     xmat = Matrix([[x, y], [z, 1+z]])
471.     ymat = Matrix([[x**2], [Abs(x)]])
472.     mat_func = lambdify((x, y, z), xmat*ymat, modules="numpy")
473.     numpy.testing.assert_array_equal(mat_func(0.5, 3, 4), numpy.array([[1.625], [3.5]]))
474.     numpy.testing.assert_array_equal(mat_func(-0.5, 3, 4), numpy.array([[1.375], [3.5]]))
475.     # Multiple matrices chained together in multiplication
476.     f = lambdify((x, y, z), xmat*xmat*xmat, modules="numpy")
477.     numpy.testing.assert_array_equal(f(0.5, 3, 4), numpy.array([[72.125, 119.25],
478.                                                                 [159, 251]]))
479. 
480. def test_numpy_numexpr():
481.     if not numpy:
482.         skip("numpy not installed.")
483.     if not numexpr:
484.         skip("numexpr not installed.")
485.     a, b, c = numpy.random.randn(3, 128, 128)
486.     # ensure that numpy and numexpr return same value for complicated expression
487.     expr = sin(x) + cos(y) + tan(z)**2 + Abs(z-y)*acos(sin(y*z)) + \
488.            Abs(y-z)*acosh(2+exp(y-x))- sqrt(x**2+I*y**2)
489.     npfunc = lambdify((x, y, z), expr, modules='numpy')
490.     nefunc = lambdify((x, y, z), expr, modules='numexpr')
491.     assert numpy.allclose(npfunc(a, b, c), nefunc(a, b, c))
492. 
493. def test_numexpr_userfunctions():
494.     if not numpy:
495.         skip("numpy not installed.")
496.     if not numexpr:
497.         skip("numexpr not installed.")
498.     a, b = numpy.random.randn(2, 10)
499.     uf = type('uf', (Function, ),
500.               {'eval' : classmethod(lambda x, y : y**2+1)})


File: sympy/utilities/tests/test_lambdify.py
Line number range: 765 - 788
Content:
765. def test_special_printers():
766.     class IntervalPrinter(LambdaPrinter):
767.         """Use ``lambda`` printer but print numbers as ``mpi`` intervals. """
768. 
769.         def _print_Integer(self, expr):
770.             return "mpi('%s')" % super(IntervalPrinter, self)._print_Integer(expr)
771. 
772.         def _print_Rational(self, expr):
773.             return "mpi('%s')" % super(IntervalPrinter, self)._print_Rational(expr)
774. 
775.     def intervalrepr(expr):
776.         return IntervalPrinter().doprint(expr)
777. 
778.     expr = sympy.sqrt(sympy.sqrt(2) + sympy.sqrt(3)) + sympy.S(1)/2
779. 
780.     func0 = lambdify((), expr, modules="mpmath", printer=intervalrepr)
781.     func1 = lambdify((), expr, modules="mpmath", printer=IntervalPrinter)
782.     func2 = lambdify((), expr, modules="mpmath", printer=IntervalPrinter())
783. 
784.     mpi = type(mpmath.mpi(1, 2))
785. 
786.     assert isinstance(func0(), mpi)
787.     assert isinstance(func1(), mpi)
788.     assert isinstance(func2(), mpi)


File: sympy/utilities/tests/test_lambdify.py
Line number range: 837 - 839
Content:
837. def test_sinc_mpmath():
838.     f = lambdify(x, sinc(x), "mpmath")
839.     assert Abs(f(1) - sinc(1)).n() < 1e-15

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 03:59:23,537 - thread-130892567656128.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The previously provided context from `sympy/utilities/tests/test_lambdify.py` and `sympy/printing/tests/test_pycode.py` is sufficient. I have identified three relevant test cases that demonstrate functionality similar to the bug report. `test_special_printers` shows custom handling of `Rational` types with `mpmath`, which is directly related to the patch. `test_mpmath_precision` and `test_number_precision` test the preservation of precision for numeric constants when using `lambdify` with `mpmath`, which is the core issue of the bug. I have all the necessary code and imports for these test cases from the existing context.' query='' extra_requirements='' purpose=''
2025-12-23 03:59:23,538 - thread-130892567656128.prometheus_context_collector - INFO - Successfully retrieved 4 context snippets
