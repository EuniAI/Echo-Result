2025-12-21 18:25:06,014 - thread-127567216510656.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Product(n + 1 / 2**k, [k, 0, n-1]) is incorrect

Description:     >>> from sympy import *
    >>> from sympy.abc import n,k
    >>> p = Product(n + 1 / 2**k, [k, 0, n-1]).doit()
    >>> print(simplify(p))
    2**(n*(-n + 1)/2) + n**n
    >>> print(p.subs(n,2))
    9/2

This is incorrect- for example, the product for `n=2` is `(2 + 2^0) * (2 + 2^(-1)) = 15/2`. The correct expression involves the [q-Pochhammer symbol](https://www.wolframalpha.com/input/?i=product+of+n+%2B+1%2F2%5Ek+from+k%3D0+to+n-1).

Patch information:
diff --git a/sympy/concrete/products.py b/sympy/concrete/products.py
index 66aafde2d6..e9179532e3 100644
--- a/sympy/concrete/products.py
+++ b/sympy/concrete/products.py
@@ -275,18 +275,39 @@ def _eval_product(self, term, limits):
             return poly.LC()**(n - a + 1) * A * B
 
         elif term.is_Add:
+            # Handle special form: A + B*C**(alpha*k + beta) with A, B, C independent of k
+            A0, Rsum = term.as_independent(k)
+            if (not A0.has(k)) and (A0.is_zero is not True) and (Rsum.is_zero is not True):
+                B0, R = Rsum.as_independent(k, as_Add=False)
+                if R.is_Pow and not R.base.has(k):
+                    E = R.exp
+                    Ep = E.as_poly(k)
+                    if Ep is not None and Ep.degree() == 1:
+                        alpha, beta = Ep.all_coeffs()
+                        if alpha.is_zero is True:
+                            return None
+                        qbase = R.base**alpha
+                        Bprime = B0 * (R.base**beta)
+                        m = n - a + 1
+                        q_poch = None
+                        try:
+                            from sympy.functions.special.q_functions import q_pochhammer as q_poch
+                        except ImportError:
+                            try:
+                                from sympy import q_pochhammer as q_poch
+                            except ImportError:
+                                q_poch = None
+                        if q_poch is not None:
+                            return A0**m * q_poch(-(Bprime/A0)*qbase**a, qbase, m)
+            # Conservative handling for generic Add: avoid distributing product over addition
             p, q = term.as_numer_denom()
-            q = self._eval_product(q, (k, a, n))
-            if q.is_Number:
-
-                # There is expression, which couldn't change by
-                # as_numer_denom(). E.g. n**(2/3) + 1 --> (n**(2/3) + 1, 1).
-                # We have to catch this case.
-
-                p = sum([self._eval_product(i, (k, a, n)) for i in p.as_coeff_Add()])
-            else:
-                p = self._eval_product(p, (k, a, n))
-            return p / q
+            q_eval = self._eval_product(q, (k, a, n))
+            p_eval = self._eval_product(p, (k, a, n))
+            if p_eval is not None and q_eval is not None:
+                return p_eval / q_eval
+            if q_eval is not None:
+                return self.func(p, (k, a, n)) / q_eval
+            return None
 
         elif term.is_Mul:
             exclude, include = [], []
diff --git a/sympy/functions/__init__.py b/sympy/functions/__init__.py
index 0c8fda287d..3b7daa507c 100644
--- a/sympy/functions/__init__.py
+++ b/sympy/functions/__init__.py
@@ -46,4 +46,5 @@
 from sympy.functions.special.beta_functions import beta
 from sympy.functions.special.mathieu_functions import (mathieus, mathieuc,
         mathieusprime, mathieucprime)
+from sympy.functions.special.q_functions import q_pochhammer
 ln = log
diff --git a/sympy/functions/special/__init__.py b/sympy/functions/special/__init__.py
index f227799549..13b67d53a4 100644
--- a/sympy/functions/special/__init__.py
+++ b/sympy/functions/special/__init__.py
@@ -9,3 +9,4 @@
 from . import singularity_functions
 
 from . import polynomials
+from . import q_functions
diff --git a/sympy/functions/special/q_functions.py b/sympy/functions/special/q_functions.py
new file mode 100644
index 0000000000..d3c6f0c5f3
--- /dev/null
+++ b/sympy/functions/special/q_functions.py
@@ -0,0 +1,37 @@
+from __future__ import print_function, division
+
+from sympy.core import S, sympify
+from sympy.core.function import Function, ArgumentIndexError
+from sympy.core.mul import Mul
+from sympy.core.compatibility import range
+
+class q_pochhammer(Function):
+    """
+    The q-Pochhammer symbol (a; q)_m defined as:
+        (a; q)_m = Product_{i=0}^{m-1} (1 - a*q**i)
+    This minimal implementation evaluates for nonnegative integer m.
+    """
+    @classmethod
+    def eval(cls, a, q, m):
+        a = sympify(a)
+        q = sympify(q)
+        m = sympify(m)
+        if m.is_Number:
+            if m is S.NaN:
+                return S.NaN
+            if m.is_Integer:
+                if m.is_negative:
+                    # Leave unevaluated for negative m in this minimal implementation
+                    return
+                mm = int(m)
+                if mm == 0:
+                    return S.One
+                # finite product
+                res = S.One
+                for i in range(mm):
+                    res *= (S.One - a*q**i)
+                return res
+
+    def fdiff(self, argindex=3):
+        # Derivatives not implemented in this minimal version
+        raise ArgumentIndexError(self, argindex)


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 18:25:06,131 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   └── tensor.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── python-comparisons.rst
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── ffunctions.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_ffunctions.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── evaluate.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_eval_power.py
    |   |   ├── test_evalf.py
    |   |   ├── test_evaluate.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_1_2.py
    |   |   |   ├── test_1_3.py
    |   |   |   ├── test_1_4.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   └── dpll2.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sympy_parser.py
    |   ├── sympy_tokenize.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── unitsystems.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_plot.py
    |   |   └── test_plot_implicit.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   └── test_theanocode.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_mix.py
    |       ├── test_rv.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       └── test_mutable_ndim_array.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_index_methods.py
    |       ├── test_indexed.py
    |       └── test_tensor.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   └── timeutils.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Product(n + 1 / 2**k, [k, 0, n-1]) is incorrect

Description:     >>> from sympy import *
    >>> from sympy.abc import n,k
    >>> p = Product(n + 1 / 2**k, [k, 0, n-1]).doit()
    >>> print(simplify(p))
    2**(n*(-n + 1)/2) + n**n
    >>> print(p.subs(n,2))
    9/2

This is incorrect- for example, the product for `n=2` is `(2 + 2^0) * (2 + 2^(-1)) = 15/2`. The correct expression involves the [q-Pochhammer symbol](https://www.wolframalpha.com/input/?i=product+of+n+%2B+1%2F2%5Ek+from+k%3D0+to+n-1).

Patch information:
diff --git a/sympy/concrete/products.py b/sympy/concrete/products.py
index 66aafde2d6..e9179532e3 100644
--- a/sympy/concrete/products.py
+++ b/sympy/concrete/products.py
@@ -275,18 +275,39 @@ def _eval_product(self, term, limits):
             return poly.LC()**(n - a + 1) * A * B
 
         elif term.is_Add:
+            # Handle special form: A + B*C**(alpha*k + beta) with A, B, C independent of k
+            A0, Rsum = term.as_independent(k)
+            if (not A0.has(k)) and (A0.is_zero is not True) and (Rsum.is_zero is not True):
+                B0, R = Rsum.as_independent(k, as_Add=False)
+                if R.is_Pow and not R.base.has(k):
+                    E = R.exp
+                    Ep = E.as_poly(k)
+                    if Ep is not None and Ep.degree() == 1:
+                        alpha, beta = Ep.all_coeffs()
+                        if alpha.is_zero is True:
+                            return None
+                        qbase = R.base**alpha
+                        Bprime = B0 * (R.base**beta)
+                        m = n - a + 1
+                        q_poch = None
+                        try:
+                            from sympy.functions.special.q_functions import q_pochhammer as q_poch
+                        except ImportError:
+                            try:
+                                from sympy import q_pochhammer as q_poch
+                            except ImportError:
+                                q_poch = None
+                        if q_poch is not None:
+                            return A0**m * q_poch(-(Bprime/A0)*qbase**a, qbase, m)
+            # Conservative handling for generic Add: avoid distributing product over addition
             p, q = term.as_numer_denom()
-            q = self._eval_product(q, (k, a, n))
-            if q.is_Number:
-
-                # There is expression, which couldn't change by
-                # as_numer_denom(). E.g. n**(2/3) + 1 --> (n**(2/3) + 1, 1).
-                # We have to catch this case.
-
-                p = sum([self._eval_product(i, (k, a, n)) for i in p.as_coeff_Add()])
-            else:
-                p = self._eval_product(p, (k, a, n))
-            return p / q
+            q_eval = self._eval_product(q, (k, a, n))
+            p_eval = self._eval_product(p, (k, a, n))
+            if p_eval is not None and q_eval is not None:
+                return p_eval / q_eval
+            if q_eval is not None:
+                return self.func(p, (k, a, n)) / q_eval
+            return None
 
         elif term.is_Mul:
             exclude, include = [], []
diff --git a/sympy/functions/__init__.py b/sympy/functions/__init__.py
index 0c8fda287d..3b7daa507c 100644
--- a/sympy/functions/__init__.py
+++ b/sympy/functions/__init__.py
@@ -46,4 +46,5 @@
 from sympy.functions.special.beta_functions import beta
 from sympy.functions.special.mathieu_functions import (mathieus, mathieuc,
         mathieusprime, mathieucprime)
+from sympy.functions.special.q_functions import q_pochhammer
 ln = log
diff --git a/sympy/functions/special/__init__.py b/sympy/functions/special/__init__.py
index f227799549..13b67d53a4 100644
--- a/sympy/functions/special/__init__.py
+++ b/sympy/functions/special/__init__.py
@@ -9,3 +9,4 @@
 from . import singularity_functions
 
 from . import polynomials
+from . import q_functions
diff --git a/sympy/functions/special/q_functions.py b/sympy/functions/special/q_functions.py
new file mode 100644
index 0000000000..d3c6f0c5f3
--- /dev/null
+++ b/sympy/functions/special/q_functions.py
@@ -0,0 +1,37 @@
+from __future__ import print_function, division
+
+from sympy.core import S, sympify
+from sympy.core.function import Function, ArgumentIndexError
+from sympy.core.mul import Mul
+from sympy.core.compatibility import range
+
+class q_pochhammer(Function):
+    """
+    The q-Pochhammer symbol (a; q)_m defined as:
+        (a; q)_m = Product_{i=0}^{m-1} (1 - a*q**i)
+    This minimal implementation evaluates for nonnegative integer m.
+    """
+    @classmethod
+    def eval(cls, a, q, m):
+        a = sympify(a)
+        q = sympify(q)
+        m = sympify(m)
+        if m.is_Number:
+            if m is S.NaN:
+                return S.NaN
+            if m.is_Integer:
+                if m.is_negative:
+                    # Leave unevaluated for negative m in this minimal implementation
+                    return
+                mm = int(m)
+                if mm == 0:
+                    return S.One
+                # finite product
+                res = S.One
+                for i in range(mm):
+                    res *= (S.One - a*q**i)
+                return res
+
+    def fdiff(self, argindex=3):
+        # Derivatives not implemented in this minimal version
+        raise ArgumentIndexError(self, argindex)


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 18:25:35,017 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find three relevant existing test cases for a bug in the `Product` function. The bug occurs in `sympy.concrete.products.py` when dealing with products over sums. The test cases for this functionality are most likely located in `sympy/concrete/tests/test_products.py` or `sympy/concrete/tests/test_sums_products.py`. I have no content for either of these files, so I need to request at least one of them to proceed.' query='Please provide the full content of `sympy/concrete/tests/test_products.py`.' extra_requirements='If the file is too large, please at least provide all test functions that involve `Product`.' purpose='I need to inspect the tests for the `Product` class to find existing test cases that are similar to the failing case described in the bug report, which involves a product of a sum.'
2025-12-21 18:25:35,018 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `sympy/concrete/tests/test_products.py`.
2025-12-21 18:25:35,018 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 18:25:35,019 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 18:25:35,019 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 18:25:35,020 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `sympy/concrete/tests/test_products.py`.
Extra requirements: If the file is too large, please at least provide all test functions that involve `Product`.
Purpose: I need to inspect the tests for the `Product` class to find existing test cases that are similar to the failing case described in the bug report, which involves a product of a sum.
2025-12-21 18:25:39,553 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I will first attempt to read the entire content of the specified file, `sympy/concrete/tests/test_products.py`, to provide you with the full context of the test cases. If the file proves to be too large for a single read, I will then specifically search for and provide all test functions within that file that reference the `Product` class, as you requested. This will allow you to efficiently locate the relevant test cases for your investigation.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/concrete/tests/test_products.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2136, 'candidates_token_count': 118, 'total_token_count': 2512, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2136}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 118}], 'thoughts_token_count': 258, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.241387884495622, 'model_name': 'gemini-2.5-pro'} id='run--05594f05-6d80-42e0-9ea3-2d62088ba691-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/concrete/tests/test_products.py'}, 'id': '0511264d-4dab-4084-b6e9-fe85369c79e8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2136, 'output_tokens': 118, 'total_tokens': 2512, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 258}}
2025-12-21 18:25:48,723 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the entire content of `sympy/concrete/tests/test_products.py`. The file contains a comprehensive suite of tests for the `Product` class, covering a wide range of scenarios including basic products, multiple products, rational and special products, and various manipulations like simplification and index changes. You can now examine the provided code to find test cases that are relevant to your bug report, especially those that involve interactions between `Product` and `Sum`.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9188, 'candidates_token_count': 95, 'total_token_count': 9995, 'cached_content_token_count': 1846, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9188}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1846}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 95}], 'thoughts_token_count': 712}, 'finish_reason': 'STOP', 'avg_logprobs': -1.084361427708676, 'model_name': 'gemini-2.5-pro'} id='run--fd62a8e0-9edf-48b1-ad8a-82de97bc637f-0' usage_metadata={'input_tokens': 9188, 'output_tokens': 95, 'total_tokens': 9995, 'input_token_details': {'cache_read': 1846}, 'output_token_details': {'reasoning': 712}}
2025-12-21 18:25:48,725 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `sympy/concrete/tests/test_products.py`.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If the file is too large, please at least provide all test functions that involve `Product`.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need to inspect the tests for the `Product` class to find existing test cases that are similar to the failing case described in the bug report, which involves a product of a sum.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/concrete/tests/test_products.py
Line number range: 1 - 360
Content:
1. from sympy import (symbols, Symbol, product, factorial, rf, sqrt, cos,
2.                    Function, Product, Rational, Sum, oo, exp, log, S)
3. from sympy.utilities.pytest import raises
4. from sympy import simplify
5. 
6. a, k, n, m, x = symbols('a,k,n,m,x', integer=True)
7. f = Function('f')
8. 
9. 
10. def test_karr_convention():
11.     # Test the Karr product convention that we want to hold.
12.     # See his paper "Summation in Finite Terms" for a detailed
13.     # reasoning why we really want exactly this definition.
14.     # The convention is described for sums on page 309 and
15.     # essentially in section 1.4, definition 3. For products
16.     # we can find in analogy:
17.     #
18.     # \prod_{m <= i < n} f(i) 'has the obvious meaning'      for m < n
19.     # \prod_{m <= i < n} f(i) = 0                            for m = n
20.     # \prod_{m <= i < n} f(i) = 1 / \prod_{n <= i < m} f(i)  for m > n
21.     #
22.     # It is important to note that he defines all products with
23.     # the upper limit being *exclusive*.
24.     # In contrast, sympy and the usual mathematical notation has:
25.     #
26.     # prod_{i = a}^b f(i) = f(a) * f(a+1) * ... * f(b-1) * f(b)
27.     #
28.     # with the upper limit *inclusive*. So translating between
29.     # the two we find that:
30.     #
31.     # \prod_{m <= i < n} f(i) = \prod_{i = m}^{n-1} f(i)
32.     #
33.     # where we intentionally used two different ways to typeset the
34.     # products and its limits.
35. 
36.     i = Symbol("i", integer=True)
37.     k = Symbol("k", integer=True)
38.     j = Symbol("j", integer=True)
39. 
40.     # A simple example with a concrete factors and symbolic limits.
41. 
42.     # The normal product: m = k and n = k + j and therefore m < n:
43.     m = k
44.     n = k + j
45. 
46.     a = m
47.     b = n - 1
48.     S1 = Product(i**2, (i, a, b)).doit()
49. 
50.     # The reversed product: m = k + j and n = k and therefore m > n:
51.     m = k + j
52.     n = k
53. 
54.     a = m
55.     b = n - 1
56.     S2 = Product(i**2, (i, a, b)).doit()
57. 
58.     assert simplify(S1 * S2) == 1
59. 
60.     # Test the empty product: m = k and n = k and therefore m = n:
61.     m = k
62.     n = k
63. 
64.     a = m
65.     b = n - 1
66.     Sz = Product(i**2, (i, a, b)).doit()
67. 
68.     assert Sz == 1
69. 
70.     # Another example this time with an unspecified factor and
71.     # numeric limits. (We can not do both tests in the same example.)
72.     f = Function("f")
73. 
74.     # The normal product with m < n:
75.     m = 2
76.     n = 11
77. 
78.     a = m
79.     b = n - 1
80.     S1 = Product(f(i), (i, a, b)).doit()
81. 
82.     # The reversed product with m > n:
83.     m = 11
84.     n = 2
85. 
86.     a = m
87.     b = n - 1
88.     S2 = Product(f(i), (i, a, b)).doit()
89. 
90.     assert simplify(S1 * S2) == 1
91. 
92.     # Test the empty product with m = n:
93.     m = 5
94.     n = 5
95. 
96.     a = m
97.     b = n - 1
98.     Sz = Product(f(i), (i, a, b)).doit()
99. 
100.     assert Sz == 1
101. 
102. 
103. def test_karr_proposition_2a():
104.     # Test Karr, page 309, proposition 2, part a
105.     i = Symbol("i", integer=True)
106.     u = Symbol("u", integer=True)
107.     v = Symbol("v", integer=True)
108. 
109.     def test_the_product(m, n):
110.         # g
111.         g = i**3 + 2*i**2 - 3*i
112.         # f = Delta g
113.         f = simplify(g.subs(i, i+1) / g)
114.         # The product
115.         a = m
116.         b = n - 1
117.         P = Product(f, (i, a, b)).doit()
118.         # Test if Product_{m <= i < n} f(i) = g(n) / g(m)
119.         assert simplify(P / (g.subs(i, n) / g.subs(i, m))) == 1
120. 
121.     # m < n
122.     test_the_product(u, u+v)
123.     # m = n
124.     test_the_product(u, u)
125.     # m > n
126.     test_the_product(u+v, u)
127. 
128. 
129. def test_karr_proposition_2b():
130.     # Test Karr, page 309, proposition 2, part b
131.     i = Symbol("i", integer=True)
132.     u = Symbol("u", integer=True)
133.     v = Symbol("v", integer=True)
134.     w = Symbol("w", integer=True)
135. 
136.     def test_the_product(l, n, m):
137.         # Productmand
138.         s = i**3
139.         # First product
140.         a = l
141.         b = n - 1
142.         S1 = Product(s, (i, a, b)).doit()
143.         # Second product
144.         a = l
145.         b = m - 1
146.         S2 = Product(s, (i, a, b)).doit()
147.         # Third product
148.         a = m
149.         b = n - 1
150.         S3 = Product(s, (i, a, b)).doit()
151.         # Test if S1 = S2 * S3 as required
152.         assert simplify(S1 / (S2 * S3)) == 1
153. 
154.     # l < m < n
155.     test_the_product(u, u+v, u+v+w)
156.     # l < m = n
157.     test_the_product(u, u+v, u+v)
158.     # l < m > n
159.     test_the_product(u, u+v+w, v)
160.     # l = m < n
161.     test_the_product(u, u, u+v)
162.     # l = m = n
163.     test_the_product(u, u, u)
164.     # l = m > n
165.     test_the_product(u+v, u+v, u)
166.     # l > m < n
167.     test_the_product(u+v, u, u+w)
168.     # l > m = n
169.     test_the_product(u+v, u, u)
170.     # l > m > n
171.     test_the_product(u+v+w, u+v, u)
172. 
173. 
174. def test_simple_products():
175.     assert product(2, (k, a, n)) == 2**(n - a + 1)
176.     assert product(k, (k, 1, n)) == factorial(n)
177.     assert product(k**3, (k, 1, n)) == factorial(n)**3
178. 
179.     assert product(k + 1, (k, 0, n - 1)) == factorial(n)
180.     assert product(k + 1, (k, a, n - 1)) == rf(1 + a, n - a)
181. 
182.     assert product(cos(k), (k, 0, 5)) == cos(1)*cos(2)*cos(3)*cos(4)*cos(5)
183.     assert product(cos(k), (k, 3, 5)) == cos(3)*cos(4)*cos(5)
184.     assert product(cos(k), (k, 1, Rational(5, 2))) != cos(1)*cos(2)
185. 
186.     assert isinstance(product(k**k, (k, 1, n)), Product)
187. 
188.     assert Product(x**k, (k, 1, n)).variables == [k]
189. 
190.     raises(ValueError, lambda: Product(n))
191.     raises(ValueError, lambda: Product(n, k))
192.     raises(ValueError, lambda: Product(n, k, 1))
193.     raises(ValueError, lambda: Product(n, k, 1, 10))
194.     raises(ValueError, lambda: Product(n, (k, 1)))
195. 
196.     assert product(1, (n, 1, oo)) == 1  # issue 8301
197.     assert product(2, (n, 1, oo)) == oo
198.     assert product(-1, (n, 1, oo)).func is Product
199. 
200. 
201. def test_multiple_products():
202.     assert product(x, (n, 1, k), (k, 1, m)) == x**(m**2/2 + m/2)
203.     assert product(f(n), (
204.         n, 1, m), (m, 1, k)) == Product(f(n), (n, 1, m), (m, 1, k)).doit()
205.     assert Product(f(n), (m, 1, k), (n, 1, k)).doit() == \
206.         Product(Product(f(n), (m, 1, k)), (n, 1, k)).doit() == \
207.         product(f(n), (m, 1, k), (n, 1, k)) == \
208.         product(product(f(n), (m, 1, k)), (n, 1, k)) == \
209.         Product(f(n)**k, (n, 1, k))
210.     assert Product(
211.         x, (x, 1, k), (k, 1, n)).doit() == Product(factorial(k), (k, 1, n))
212. 
213.     assert Product(x**k, (n, 1, k), (k, 1, m)).variables == [n, k]
214. 
215. 
216. def test_rational_products():
217.     assert product(1 + 1/k, (k, 1, n)) == rf(2, n)/factorial(n)
218. 
219. 
220. def test_special_products():
221.     # Wallis product
222.     assert product((4*k)**2 / (4*k**2 - 1), (k, 1, n)) == \
223.         4**n*factorial(n)**2/rf(Rational(1, 2), n)/rf(Rational(3, 2), n)
224. 
225.     # Euler's product formula for sin
226.     assert product(1 + a/k**2, (k, 1, n)) == \
227.         rf(1 - sqrt(-a), n)*rf(1 + sqrt(-a), n)/factorial(n)**2
228. 
229. 
230. def test__eval_product():
231.     from sympy.abc import i, n
232.     # issue 4809
233.     a = Function('a')
234.     assert product(2*a(i), (i, 1, n)) == 2**n * Product(a(i), (i, 1, n))
235.     # issue 4810
236.     assert product(2**i, (i, 1, n)) == 2**(n/2 + n**2/2)
237. 
238. 
239. def test_product_pow():
240.     # issue 4817
241.     assert product(2**f(k), (k, 1, n)) == 2**Sum(f(k), (k, 1, n))
242.     assert product(2**(2*f(k)), (k, 1, n)) == 2**Sum(2*f(k), (k, 1, n))
243. 
244. 
245. def test_infinite_product():
246.     # issue 5737
247.     assert isinstance(Product(2**(1/factorial(n)), (n, 0, oo)), Product)
248. 
249. 
250. def test_conjugate_transpose():
251.     p = Product(x**k, (k, 1, 3))
252.     assert p.adjoint().doit() == p.doit().adjoint()
253.     assert p.conjugate().doit() == p.doit().conjugate()
254.     assert p.transpose().doit() == p.doit().transpose()
255. 
256.     A, B = symbols("A B", commutative=False)
257.     p = Product(A*B**k, (k, 1, 3))
258.     assert p.adjoint().doit() == p.doit().adjoint()
259.     assert p.conjugate().doit() == p.doit().conjugate()
260.     assert p.transpose().doit() == p.doit().transpose()
261. 
262. 
263. def test_simplify():
264.     y, t, b, c = symbols('y, t, b, c', integer = True)
265. 
266.     assert simplify(Product(x*y, (x, n, m), (y, a, k)) * \
267.         Product(y, (x, n, m), (y, a, k))) == \
268.             Product(x*y**2, (x, n, m), (y, a, k))
269.     assert simplify(3 * y* Product(x, (x, n, m)) * Product(x, (x, m + 1, a))) \
270.         == 3 * y * Product(x, (x, n, a))
271.     assert simplify(Product(x, (x, k + 1, a)) * Product(x, (x, n, k))) == \
272.         Product(x, (x, n, a))
273.     assert simplify(Product(x, (x, k + 1, a)) * Product(x + 1, (x, n, k))) == \
274.         Product(x, (x, k + 1, a)) * Product(x + 1, (x, n, k))
275.     assert simplify(Product(x, (t, a, b)) * Product(y, (t, a, b)) * \
276.         Product(x, (t, b+1, c))) == Product(x*y, (t, a, b)) * \
277.             Product(x, (t, b+1, c))
278.     assert simplify(Product(x, (t, a, b)) * Product(x, (t, b+1, c)) * \
279.         Product(y, (t, a, b))) == Product(x*y, (t, a, b)) * \
280.             Product(x, (t, b+1, c))
281. 
282. 
283. def test_change_index():
284.     b, y, c, d, z = symbols('b, y, c, d, z', integer = True)
285. 
286.     assert Product(x, (x, a, b)).change_index(x, x + 1, y) == \
287.         Product(y - 1, (y, a + 1, b + 1))
288.     assert Product(x**2, (x, a, b)).change_index(x, x - 1) == \
289.         Product((x + 1)**2, (x, a - 1, b - 1))
290.     assert Product(x**2, (x, a, b)).change_index(x, -x, y) == \
291.         Product((-y)**2, (y, -b, -a))
292.     assert Product(x, (x, a, b)).change_index(x, -x - 1) == \
293.         Product(-x - 1, (x, - b - 1, -a - 1))
294.     assert Product(x*y, (x, a, b), (y, c, d)).change_index(x, x - 1, z) == \
295.         Product((z + 1)*y, (z, a - 1, b - 1), (y, c, d))
296. 
297. 
298. def test_reorder():
299.     b, y, c, d, z = symbols('b, y, c, d, z', integer = True)
300. 
301.     assert Product(x*y, (x, a, b), (y, c, d)).reorder((0, 1)) == \
302.         Product(x*y, (y, c, d), (x, a, b))
303.     assert Product(x, (x, a, b), (x, c, d)).reorder((0, 1)) == \
304.         Product(x, (x, c, d), (x, a, b))
305.     assert Product(x*y + z, (x, a, b), (z, m, n), (y, c, d)).reorder(\
306.         (2, 0), (0, 1)) == Product(x*y + z, (z, m, n), (y, c, d), (x, a, b))
307.     assert Product(x*y*z, (x, a, b), (y, c, d), (z, m, n)).reorder(\
308.         (0, 1), (1, 2), (0, 2)) == \
309.         Product(x*y*z, (x, a, b), (z, m, n), (y, c, d))
310.     assert Product(x*y*z, (x, a, b), (y, c, d), (z, m, n)).reorder(\
311.         (x, y), (y, z), (x, z)) == \
312.         Product(x*y*z, (x, a, b), (z, m, n), (y, c, d))
313.     assert Product(x*y, (x, a, b), (y, c, d)).reorder((x, 1)) == \
314.         Product(x*y, (y, c, d), (x, a, b))
315.     assert Product(x*y, (x, a, b), (y, c, d)).reorder((y, x)) == \
316.         Product(x*y, (y, c, d), (x, a, b))
317. 
318. 
319. def test_Product_is_convergent():
320.     assert Product(1/n**2, (n, 1, oo)).is_convergent() is S.false
321.     assert Product(exp(1/n**2), (n, 1, oo)).is_convergent() is S.true
322.     assert Product(1/n, (n, 1, oo)).is_convergent() is S.false
323.     assert Product(1 + 1/n, (n, 1, oo)).is_convergent() is S.false
324.     assert Product(1 + 1/n**2, (n, 1, oo)).is_convergent() is S.true
325. 
326. 
327. def test_reverse_order():
328.     x, y, a, b, c, d= symbols('x, y, a, b, c, d', integer = True)
329. 
330.     assert Product(x, (x, 0, 3)).reverse_order(0) == Product(1/x, (x, 4, -1))
331.     assert Product(x*y, (x, 1, 5), (y, 0, 6)).reverse_order(0, 1) == \
332.            Product(x*y, (x, 6, 0), (y, 7, -1))
333.     assert Product(x, (x, 1, 2)).reverse_order(0) == Product(1/x, (x, 3, 0))
334.     assert Product(x, (x, 1, 3)).reverse_order(0) == Product(1/x, (x, 4, 0))
335.     assert Product(x, (x, 1, a)).reverse_order(0) == Product(1/x, (x, a + 1, 0))
336.     assert Product(x, (x, a, 5)).reverse_order(0) == Product(1/x, (x, 6, a - 1))
337.     assert Product(x, (x, a + 1, a + 5)).reverse_order(0) == \
338.            Product(1/x, (x, a + 6, a))
339.     assert Product(x, (x, a + 1, a + 2)).reverse_order(0) == \
340.            Product(1/x, (x, a + 3, a))
341.     assert Product(x, (x, a + 1, a + 1)).reverse_order(0) == \
342.            Product(1/x, (x, a + 2, a))
343.     assert Product(x, (x, a, b)).reverse_order(0) == Product(1/x, (x, b + 1, a - 1))
344.     assert Product(x, (x, a, b)).reverse_order(x) == Product(1/x, (x, b + 1, a - 1))
345.     assert Product(x*y, (x, a, b), (y, 2, 5)).reverse_order(x, 1) == \
346.            Product(x*y, (x, b + 1, a - 1), (y, 6, 1))
347.     assert Product(x*y, (x, a, b), (y, 2, 5)).reverse_order(y, x) == \
348.            Product(x*y, (x, b + 1, a - 1), (y, 6, 1))
349. 
350. 
351. def test_issue_9983():
352.     n = Symbol('n', integer=True, positive=True)
353.     p = Product(1 + 1/n**(S(2)/3), (n, 1, oo))
354.     assert p.is_convergent() is S.false
355.     assert product(1 + 1/n**(S(2)/3), (n, 1, oo)) == p.doit()
356. 
357. 
358. def test_rewrite_Sum():
359.     assert Product(1 - S.Half**2/k**2, (k, 1, oo)).rewrite(Sum) == \
360.         exp(Sum(log(1 - 1/(4*k**2)), (k, 1, oo)))

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 18:25:56,374 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asks for the full content of the file `sympy/concrete/tests/test_products.py`.\n   - The provided context contains the entire content of this file.\n\n2. Extended relevance:\n   - The user's purpose is to inspect tests for the `Product` class. This file is the test suite for `Product`, so the entire file is relevant to their goal.\n   - The fallback requirement is to provide all test functions involving `Product`. Since the entire file is about testing `Product`, and the file is of a manageable size, providing the full content is the most direct and complete answer.", relative_path='sympy/concrete/tests/test_products.py', start_line=1, end_line=360)]
2025-12-21 18:25:56,375 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `sympy/concrete/tests/test_products.py`.
2025-12-21 18:25:56,375 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 18:25:56,375 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 18:25:56,376 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 18:25:56,376 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 18:25:56,376 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.rst
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_import.py
|   ├── test_setup.py
|   └── test_travis.sh
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── gotchas.rst
|       ├── guide.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── handlers
|       |   |   ├── index.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   └── sparse.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── hyperexpand.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   └── tensor.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   ├── runtests.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       └── intro.rst
|       ├── outreach.rst
|       ├── pics
|       ├── python-comparisons.rst
|       ├── special_topics
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── fabfile.py
|   ├── pull_and_run_rever.sh
|   └── release.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_assumptions_2.py
    |       ├── test_context.py
    |       ├── test_matrices.py
    |       ├── test_query.py
    |       ├── test_refine.py
    |       ├── test_satask.py
    |       └── test_sathandlers.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── ffunctions.py
    |   ├── rewriting.py
    |   └── tests
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_ffunctions.py
    |       └── test_rewriting.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── evaluate.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_eval_power.py
    |   |   ├── test_evalf.py
    |   |   ├── test_evaluate.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── deprecated
    |   ├── __init__.py
    |   ├── class_registry.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_class_registry.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── external
    |   ├── __init__.py
    |   ├── importtools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── linearsolver.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_1_2.py
    |   |   |   ├── test_1_3.py
    |   |   |   ├── test_1_4.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   └── dpll2.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── blockmatrix.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── slice.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── immutable.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_commonmatrix.py
    |       ├── test_densearith.py
    |       ├── test_densesolve.py
    |       ├── test_densetools.py
    |       ├── test_immutable.py
    |       ├── test_interactions.py
    |       ├── test_matrices.py
    |       ├── test_normalforms.py
    |       ├── test_sparse.py
    |       └── test_sparsetools.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── egyptian_fraction.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sympy_parser.py
    |   ├── sympy_tokenize.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── unitsystems.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_plot.py
    |   |   └── test_plot_implicit.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_ccode.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cxxcode.py
    |   |   ├── test_dot.py
    |   |   ├── test_fcode.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   └── test_theanocode.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine.py
    |   ├── inequalities.py
    |   ├── ode.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_diophantine.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_ode.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_mix.py
    |       ├── test_rv.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       └── test_mutable_ndim_array.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_index_methods.py
    |       ├── test_indexed.py
    |       └── test_tensor.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_misc.py
    |   |   ├── test_module_imports.py
    |   |   ├── test_pickling.py
    |   |   ├── test_pytest.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   └── timeutils.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── operators.py
        ├── orienters.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_operators.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Product(n + 1 / 2**k, [k, 0, n-1]) is incorrect

Description:     >>> from sympy import *
    >>> from sympy.abc import n,k
    >>> p = Product(n + 1 / 2**k, [k, 0, n-1]).doit()
    >>> print(simplify(p))
    2**(n*(-n + 1)/2) + n**n
    >>> print(p.subs(n,2))
    9/2

This is incorrect- for example, the product for `n=2` is `(2 + 2^0) * (2 + 2^(-1)) = 15/2`. The correct expression involves the [q-Pochhammer symbol](https://www.wolframalpha.com/input/?i=product+of+n+%2B+1%2F2%5Ek+from+k%3D0+to+n-1).

Patch information:
diff --git a/sympy/concrete/products.py b/sympy/concrete/products.py
index 66aafde2d6..e9179532e3 100644
--- a/sympy/concrete/products.py
+++ b/sympy/concrete/products.py
@@ -275,18 +275,39 @@ def _eval_product(self, term, limits):
             return poly.LC()**(n - a + 1) * A * B
 
         elif term.is_Add:
+            # Handle special form: A + B*C**(alpha*k + beta) with A, B, C independent of k
+            A0, Rsum = term.as_independent(k)
+            if (not A0.has(k)) and (A0.is_zero is not True) and (Rsum.is_zero is not True):
+                B0, R = Rsum.as_independent(k, as_Add=False)
+                if R.is_Pow and not R.base.has(k):
+                    E = R.exp
+                    Ep = E.as_poly(k)
+                    if Ep is not None and Ep.degree() == 1:
+                        alpha, beta = Ep.all_coeffs()
+                        if alpha.is_zero is True:
+                            return None
+                        qbase = R.base**alpha
+                        Bprime = B0 * (R.base**beta)
+                        m = n - a + 1
+                        q_poch = None
+                        try:
+                            from sympy.functions.special.q_functions import q_pochhammer as q_poch
+                        except ImportError:
+                            try:
+                                from sympy import q_pochhammer as q_poch
+                            except ImportError:
+                                q_poch = None
+                        if q_poch is not None:
+                            return A0**m * q_poch(-(Bprime/A0)*qbase**a, qbase, m)
+            # Conservative handling for generic Add: avoid distributing product over addition
             p, q = term.as_numer_denom()
-            q = self._eval_product(q, (k, a, n))
-            if q.is_Number:
-
-                # There is expression, which couldn't change by
-                # as_numer_denom(). E.g. n**(2/3) + 1 --> (n**(2/3) + 1, 1).
-                # We have to catch this case.
-
-                p = sum([self._eval_product(i, (k, a, n)) for i in p.as_coeff_Add()])
-            else:
-                p = self._eval_product(p, (k, a, n))
-            return p / q
+            q_eval = self._eval_product(q, (k, a, n))
+            p_eval = self._eval_product(p, (k, a, n))
+            if p_eval is not None and q_eval is not None:
+                return p_eval / q_eval
+            if q_eval is not None:
+                return self.func(p, (k, a, n)) / q_eval
+            return None
 
         elif term.is_Mul:
             exclude, include = [], []
diff --git a/sympy/functions/__init__.py b/sympy/functions/__init__.py
index 0c8fda287d..3b7daa507c 100644
--- a/sympy/functions/__init__.py
+++ b/sympy/functions/__init__.py
@@ -46,4 +46,5 @@
 from sympy.functions.special.beta_functions import beta
 from sympy.functions.special.mathieu_functions import (mathieus, mathieuc,
         mathieusprime, mathieucprime)
+from sympy.functions.special.q_functions import q_pochhammer
 ln = log
diff --git a/sympy/functions/special/__init__.py b/sympy/functions/special/__init__.py
index f227799549..13b67d53a4 100644
--- a/sympy/functions/special/__init__.py
+++ b/sympy/functions/special/__init__.py
@@ -9,3 +9,4 @@
 from . import singularity_functions
 
 from . import polynomials
+from . import q_functions
diff --git a/sympy/functions/special/q_functions.py b/sympy/functions/special/q_functions.py
new file mode 100644
index 0000000000..d3c6f0c5f3
--- /dev/null
+++ b/sympy/functions/special/q_functions.py
@@ -0,0 +1,37 @@
+from __future__ import print_function, division
+
+from sympy.core import S, sympify
+from sympy.core.function import Function, ArgumentIndexError
+from sympy.core.mul import Mul
+from sympy.core.compatibility import range
+
+class q_pochhammer(Function):
+    """
+    The q-Pochhammer symbol (a; q)_m defined as:
+        (a; q)_m = Product_{i=0}^{m-1} (1 - a*q**i)
+    This minimal implementation evaluates for nonnegative integer m.
+    """
+    @classmethod
+    def eval(cls, a, q, m):
+        a = sympify(a)
+        q = sympify(q)
+        m = sympify(m)
+        if m.is_Number:
+            if m is S.NaN:
+                return S.NaN
+            if m.is_Integer:
+                if m.is_negative:
+                    # Leave unevaluated for negative m in this minimal implementation
+                    return
+                mm = int(m)
+                if mm == 0:
+                    return S.One
+                # finite product
+                res = S.One
+                for i in range(mm):
+                    res *= (S.One - a*q**i)
+                return res
+
+    def fdiff(self, argindex=3):
+        # Derivatives not implemented in this minimal version
+        raise ArgumentIndexError(self, argindex)


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `sympy/concrete/tests/test_products.py`.
Extra Requirements: If the file is too large, please at least provide all test functions that involve `Product`.
Purpose: I need to inspect the tests for the `Product` class to find existing test cases that are similar to the failing case described in the bug report, which involves a product of a sum.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/concrete/tests/test_products.py
Line number range: 1 - 360
Content:
1. from sympy import (symbols, Symbol, product, factorial, rf, sqrt, cos,
2.                    Function, Product, Rational, Sum, oo, exp, log, S)
3. from sympy.utilities.pytest import raises
4. from sympy import simplify
5. 
6. a, k, n, m, x = symbols('a,k,n,m,x', integer=True)
7. f = Function('f')
8. 
9. 
10. def test_karr_convention():
11.     # Test the Karr product convention that we want to hold.
12.     # See his paper "Summation in Finite Terms" for a detailed
13.     # reasoning why we really want exactly this definition.
14.     # The convention is described for sums on page 309 and
15.     # essentially in section 1.4, definition 3. For products
16.     # we can find in analogy:
17.     #
18.     # \prod_{m <= i < n} f(i) 'has the obvious meaning'      for m < n
19.     # \prod_{m <= i < n} f(i) = 0                            for m = n
20.     # \prod_{m <= i < n} f(i) = 1 / \prod_{n <= i < m} f(i)  for m > n
21.     #
22.     # It is important to note that he defines all products with
23.     # the upper limit being *exclusive*.
24.     # In contrast, sympy and the usual mathematical notation has:
25.     #
26.     # prod_{i = a}^b f(i) = f(a) * f(a+1) * ... * f(b-1) * f(b)
27.     #
28.     # with the upper limit *inclusive*. So translating between
29.     # the two we find that:
30.     #
31.     # \prod_{m <= i < n} f(i) = \prod_{i = m}^{n-1} f(i)
32.     #
33.     # where we intentionally used two different ways to typeset the
34.     # products and its limits.
35. 
36.     i = Symbol("i", integer=True)
37.     k = Symbol("k", integer=True)
38.     j = Symbol("j", integer=True)
39. 
40.     # A simple example with a concrete factors and symbolic limits.
41. 
42.     # The normal product: m = k and n = k + j and therefore m < n:
43.     m = k
44.     n = k + j
45. 
46.     a = m
47.     b = n - 1
48.     S1 = Product(i**2, (i, a, b)).doit()
49. 
50.     # The reversed product: m = k + j and n = k and therefore m > n:
51.     m = k + j
52.     n = k
53. 
54.     a = m
55.     b = n - 1
56.     S2 = Product(i**2, (i, a, b)).doit()
57. 
58.     assert simplify(S1 * S2) == 1
59. 
60.     # Test the empty product: m = k and n = k and therefore m = n:
61.     m = k
62.     n = k
63. 
64.     a = m
65.     b = n - 1
66.     Sz = Product(i**2, (i, a, b)).doit()
67. 
68.     assert Sz == 1
69. 
70.     # Another example this time with an unspecified factor and
71.     # numeric limits. (We can not do both tests in the same example.)
72.     f = Function("f")
73. 
74.     # The normal product with m < n:
75.     m = 2
76.     n = 11
77. 
78.     a = m
79.     b = n - 1
80.     S1 = Product(f(i), (i, a, b)).doit()
81. 
82.     # The reversed product with m > n:
83.     m = 11
84.     n = 2
85. 
86.     a = m
87.     b = n - 1
88.     S2 = Product(f(i), (i, a, b)).doit()
89. 
90.     assert simplify(S1 * S2) == 1
91. 
92.     # Test the empty product with m = n:
93.     m = 5
94.     n = 5
95. 
96.     a = m
97.     b = n - 1
98.     Sz = Product(f(i), (i, a, b)).doit()
99. 
100.     assert Sz == 1
101. 
102. 
103. def test_karr_proposition_2a():
104.     # Test Karr, page 309, proposition 2, part a
105.     i = Symbol("i", integer=True)
106.     u = Symbol("u", integer=True)
107.     v = Symbol("v", integer=True)
108. 
109.     def test_the_product(m, n):
110.         # g
111.         g = i**3 + 2*i**2 - 3*i
112.         # f = Delta g
113.         f = simplify(g.subs(i, i+1) / g)
114.         # The product
115.         a = m
116.         b = n - 1
117.         P = Product(f, (i, a, b)).doit()
118.         # Test if Product_{m <= i < n} f(i) = g(n) / g(m)
119.         assert simplify(P / (g.subs(i, n) / g.subs(i, m))) == 1
120. 
121.     # m < n
122.     test_the_product(u, u+v)
123.     # m = n
124.     test_the_product(u, u)
125.     # m > n
126.     test_the_product(u+v, u)
127. 
128. 
129. def test_karr_proposition_2b():
130.     # Test Karr, page 309, proposition 2, part b
131.     i = Symbol("i", integer=True)
132.     u = Symbol("u", integer=True)
133.     v = Symbol("v", integer=True)
134.     w = Symbol("w", integer=True)
135. 
136.     def test_the_product(l, n, m):
137.         # Productmand
138.         s = i**3
139.         # First product
140.         a = l
141.         b = n - 1
142.         S1 = Product(s, (i, a, b)).doit()
143.         # Second product
144.         a = l
145.         b = m - 1
146.         S2 = Product(s, (i, a, b)).doit()
147.         # Third product
148.         a = m
149.         b = n - 1
150.         S3 = Product(s, (i, a, b)).doit()
151.         # Test if S1 = S2 * S3 as required
152.         assert simplify(S1 / (S2 * S3)) == 1
153. 
154.     # l < m < n
155.     test_the_product(u, u+v, u+v+w)
156.     # l < m = n
157.     test_the_product(u, u+v, u+v)
158.     # l < m > n
159.     test_the_product(u, u+v+w, v)
160.     # l = m < n
161.     test_the_product(u, u, u+v)
162.     # l = m = n
163.     test_the_product(u, u, u)
164.     # l = m > n
165.     test_the_product(u+v, u+v, u)
166.     # l > m < n
167.     test_the_product(u+v, u, u+w)
168.     # l > m = n
169.     test_the_product(u+v, u, u)
170.     # l > m > n
171.     test_the_product(u+v+w, u+v, u)
172. 
173. 
174. def test_simple_products():
175.     assert product(2, (k, a, n)) == 2**(n - a + 1)
176.     assert product(k, (k, 1, n)) == factorial(n)
177.     assert product(k**3, (k, 1, n)) == factorial(n)**3
178. 
179.     assert product(k + 1, (k, 0, n - 1)) == factorial(n)
180.     assert product(k + 1, (k, a, n - 1)) == rf(1 + a, n - a)
181. 
182.     assert product(cos(k), (k, 0, 5)) == cos(1)*cos(2)*cos(3)*cos(4)*cos(5)
183.     assert product(cos(k), (k, 3, 5)) == cos(3)*cos(4)*cos(5)
184.     assert product(cos(k), (k, 1, Rational(5, 2))) != cos(1)*cos(2)
185. 
186.     assert isinstance(product(k**k, (k, 1, n)), Product)
187. 
188.     assert Product(x**k, (k, 1, n)).variables == [k]
189. 
190.     raises(ValueError, lambda: Product(n))
191.     raises(ValueError, lambda: Product(n, k))
192.     raises(ValueError, lambda: Product(n, k, 1))
193.     raises(ValueError, lambda: Product(n, k, 1, 10))
194.     raises(ValueError, lambda: Product(n, (k, 1)))
195. 
196.     assert product(1, (n, 1, oo)) == 1  # issue 8301
197.     assert product(2, (n, 1, oo)) == oo
198.     assert product(-1, (n, 1, oo)).func is Product
199. 
200. 
201. def test_multiple_products():
202.     assert product(x, (n, 1, k), (k, 1, m)) == x**(m**2/2 + m/2)
203.     assert product(f(n), (
204.         n, 1, m), (m, 1, k)) == Product(f(n), (n, 1, m), (m, 1, k)).doit()
205.     assert Product(f(n), (m, 1, k), (n, 1, k)).doit() == \
206.         Product(Product(f(n), (m, 1, k)), (n, 1, k)).doit() == \
207.         product(f(n), (m, 1, k), (n, 1, k)) == \
208.         product(product(f(n), (m, 1, k)), (n, 1, k)) == \
209.         Product(f(n)**k, (n, 1, k))
210.     assert Product(
211.         x, (x, 1, k), (k, 1, n)).doit() == Product(factorial(k), (k, 1, n))
212. 
213.     assert Product(x**k, (n, 1, k), (k, 1, m)).variables == [n, k]
214. 
215. 
216. def test_rational_products():
217.     assert product(1 + 1/k, (k, 1, n)) == rf(2, n)/factorial(n)
218. 
219. 
220. def test_special_products():
221.     # Wallis product
222.     assert product((4*k)**2 / (4*k**2 - 1), (k, 1, n)) == \
223.         4**n*factorial(n)**2/rf(Rational(1, 2), n)/rf(Rational(3, 2), n)
224. 
225.     # Euler's product formula for sin
226.     assert product(1 + a/k**2, (k, 1, n)) == \
227.         rf(1 - sqrt(-a), n)*rf(1 + sqrt(-a), n)/factorial(n)**2
228. 
229. 
230. def test__eval_product():
231.     from sympy.abc import i, n
232.     # issue 4809
233.     a = Function('a')
234.     assert product(2*a(i), (i, 1, n)) == 2**n * Product(a(i), (i, 1, n))
235.     # issue 4810
236.     assert product(2**i, (i, 1, n)) == 2**(n/2 + n**2/2)
237. 
238. 
239. def test_product_pow():
240.     # issue 4817
241.     assert product(2**f(k), (k, 1, n)) == 2**Sum(f(k), (k, 1, n))
242.     assert product(2**(2*f(k)), (k, 1, n)) == 2**Sum(2*f(k), (k, 1, n))
243. 
244. 
245. def test_infinite_product():
246.     # issue 5737
247.     assert isinstance(Product(2**(1/factorial(n)), (n, 0, oo)), Product)
248. 
249. 
250. def test_conjugate_transpose():
251.     p = Product(x**k, (k, 1, 3))
252.     assert p.adjoint().doit() == p.doit().adjoint()
253.     assert p.conjugate().doit() == p.doit().conjugate()
254.     assert p.transpose().doit() == p.doit().transpose()
255. 
256.     A, B = symbols("A B", commutative=False)
257.     p = Product(A*B**k, (k, 1, 3))
258.     assert p.adjoint().doit() == p.doit().adjoint()
259.     assert p.conjugate().doit() == p.doit().conjugate()
260.     assert p.transpose().doit() == p.doit().transpose()
261. 
262. 
263. def test_simplify():
264.     y, t, b, c = symbols('y, t, b, c', integer = True)
265. 
266.     assert simplify(Product(x*y, (x, n, m), (y, a, k)) * \
267.         Product(y, (x, n, m), (y, a, k))) == \
268.             Product(x*y**2, (x, n, m), (y, a, k))
269.     assert simplify(3 * y* Product(x, (x, n, m)) * Product(x, (x, m + 1, a))) \
270.         == 3 * y * Product(x, (x, n, a))
271.     assert simplify(Product(x, (x, k + 1, a)) * Product(x, (x, n, k))) == \
272.         Product(x, (x, n, a))
273.     assert simplify(Product(x, (x, k + 1, a)) * Product(x + 1, (x, n, k))) == \
274.         Product(x, (x, k + 1, a)) * Product(x + 1, (x, n, k))
275.     assert simplify(Product(x, (t, a, b)) * Product(y, (t, a, b)) * \
276.         Product(x, (t, b+1, c))) == Product(x*y, (t, a, b)) * \
277.             Product(x, (t, b+1, c))
278.     assert simplify(Product(x, (t, a, b)) * Product(x, (t, b+1, c)) * \
279.         Product(y, (t, a, b))) == Product(x*y, (t, a, b)) * \
280.             Product(x, (t, b+1, c))
281. 
282. 
283. def test_change_index():
284.     b, y, c, d, z = symbols('b, y, c, d, z', integer = True)
285. 
286.     assert Product(x, (x, a, b)).change_index(x, x + 1, y) == \
287.         Product(y - 1, (y, a + 1, b + 1))
288.     assert Product(x**2, (x, a, b)).change_index(x, x - 1) == \
289.         Product((x + 1)**2, (x, a - 1, b - 1))
290.     assert Product(x**2, (x, a, b)).change_index(x, -x, y) == \
291.         Product((-y)**2, (y, -b, -a))
292.     assert Product(x, (x, a, b)).change_index(x, -x - 1) == \
293.         Product(-x - 1, (x, - b - 1, -a - 1))
294.     assert Product(x*y, (x, a, b), (y, c, d)).change_index(x, x - 1, z) == \
295.         Product((z + 1)*y, (z, a - 1, b - 1), (y, c, d))
296. 
297. 
298. def test_reorder():
299.     b, y, c, d, z = symbols('b, y, c, d, z', integer = True)
300. 
301.     assert Product(x*y, (x, a, b), (y, c, d)).reorder((0, 1)) == \
302.         Product(x*y, (y, c, d), (x, a, b))
303.     assert Product(x, (x, a, b), (x, c, d)).reorder((0, 1)) == \
304.         Product(x, (x, c, d), (x, a, b))
305.     assert Product(x*y + z, (x, a, b), (z, m, n), (y, c, d)).reorder(\
306.         (2, 0), (0, 1)) == Product(x*y + z, (z, m, n), (y, c, d), (x, a, b))
307.     assert Product(x*y*z, (x, a, b), (y, c, d), (z, m, n)).reorder(\
308.         (0, 1), (1, 2), (0, 2)) == \
309.         Product(x*y*z, (x, a, b), (z, m, n), (y, c, d))
310.     assert Product(x*y*z, (x, a, b), (y, c, d), (z, m, n)).reorder(\
311.         (x, y), (y, z), (x, z)) == \
312.         Product(x*y*z, (x, a, b), (z, m, n), (y, c, d))
313.     assert Product(x*y, (x, a, b), (y, c, d)).reorder((x, 1)) == \
314.         Product(x*y, (y, c, d), (x, a, b))
315.     assert Product(x*y, (x, a, b), (y, c, d)).reorder((y, x)) == \
316.         Product(x*y, (y, c, d), (x, a, b))
317. 
318. 
319. def test_Product_is_convergent():
320.     assert Product(1/n**2, (n, 1, oo)).is_convergent() is S.false
321.     assert Product(exp(1/n**2), (n, 1, oo)).is_convergent() is S.true
322.     assert Product(1/n, (n, 1, oo)).is_convergent() is S.false
323.     assert Product(1 + 1/n, (n, 1, oo)).is_convergent() is S.false
324.     assert Product(1 + 1/n**2, (n, 1, oo)).is_convergent() is S.true
325. 
326. 
327. def test_reverse_order():
328.     x, y, a, b, c, d= symbols('x, y, a, b, c, d', integer = True)
329. 
330.     assert Product(x, (x, 0, 3)).reverse_order(0) == Product(1/x, (x, 4, -1))
331.     assert Product(x*y, (x, 1, 5), (y, 0, 6)).reverse_order(0, 1) == \
332.            Product(x*y, (x, 6, 0), (y, 7, -1))
333.     assert Product(x, (x, 1, 2)).reverse_order(0) == Product(1/x, (x, 3, 0))
334.     assert Product(x, (x, 1, 3)).reverse_order(0) == Product(1/x, (x, 4, 0))
335.     assert Product(x, (x, 1, a)).reverse_order(0) == Product(1/x, (x, a + 1, 0))
336.     assert Product(x, (x, a, 5)).reverse_order(0) == Product(1/x, (x, 6, a - 1))
337.     assert Product(x, (x, a + 1, a + 5)).reverse_order(0) == \
338.            Product(1/x, (x, a + 6, a))
339.     assert Product(x, (x, a + 1, a + 2)).reverse_order(0) == \
340.            Product(1/x, (x, a + 3, a))
341.     assert Product(x, (x, a + 1, a + 1)).reverse_order(0) == \
342.            Product(1/x, (x, a + 2, a))
343.     assert Product(x, (x, a, b)).reverse_order(0) == Product(1/x, (x, b + 1, a - 1))
344.     assert Product(x, (x, a, b)).reverse_order(x) == Product(1/x, (x, b + 1, a - 1))
345.     assert Product(x*y, (x, a, b), (y, 2, 5)).reverse_order(x, 1) == \
346.            Product(x*y, (x, b + 1, a - 1), (y, 6, 1))
347.     assert Product(x*y, (x, a, b), (y, 2, 5)).reverse_order(y, x) == \
348.            Product(x*y, (x, b + 1, a - 1), (y, 6, 1))
349. 
350. 
351. def test_issue_9983():
352.     n = Symbol('n', integer=True, positive=True)
353.     p = Product(1 + 1/n**(S(2)/3), (n, 1, oo))
354.     assert p.is_convergent() is S.false
355.     assert product(1 + 1/n**(S(2)/3), (n, 1, oo)) == p.doit()
356. 
357. 
358. def test_rewrite_Sum():
359.     assert Product(1 - S.Half**2/k**2, (k, 1, oo)).rewrite(Sum) == \
360.         exp(Sum(log(1 - 1/(4*k**2)), (k, 1, oo)))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 18:27:09,814 - thread-127567216510656.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find 3 existing test cases for `Product` of a sum. The provided context is `sympy/concrete/tests/test_products.py`, which is the test file for the `Product` function. This file contains several tests for products of sums (e.g., `test_rational_products`, `test_special_products`). While these tests do not use exponential terms as seen in the bug report, they test the same `is_Add` branch in the `Product._eval_product` method where the bug was located. Therefore, they are the most relevant existing test cases demonstrating similar functionality, and the provided context is sufficient to extract them.' query='' extra_requirements='' purpose=''
2025-12-21 18:27:09,815 - thread-127567216510656.prometheus_context_collector - INFO - Successfully retrieved 1 context snippets
