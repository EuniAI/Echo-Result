2025-12-21 06:12:02,189 - thread-126586521126592.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: [Bug]: Unable to pickle figure with aligned labels

Description: ### Bug summary

 Unable to pickle figure after calling `align_labels()`

### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax1 = fig.add_subplot(211)
ax2 = fig.add_subplot(212)
time=[0,1,2,3,4]
speed=[40000,4300,4500,4700,4800]
acc=[10,11,12,13,14]
ax1.plot(time,speed)
ax1.set_ylabel('speed')
ax2.plot(time,acc)
ax2.set_ylabel('acc')

fig.align_labels() ##pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome
```
align.py", line 16
pickle.dumps(fig)
TypeError: cannot pickle 'weakref.ReferenceType' object
```
### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

None

Patch information:
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index b4c38368bf..6a57554d0c 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -3174,12 +3174,25 @@ None}, default: None
         from matplotlib import _pylab_helpers
         if self.canvas.manager in _pylab_helpers.Gcf.figs.values():
             state['_restore_to_pylab'] = True
+
+        # Serialize align label groups to avoid pickling weakrefs from Grouper
+        try:
+            state["_align_label_groups"] = {
+                name: [group for group in self._align_label_groups[name]]
+                for name in ("x", "y")
+            }
+        except Exception:
+            # Fallback to empty alignment info if serialization fails
+            state["_align_label_groups"] = {"x": [], "y": []}
         return state
 
     def __setstate__(self, state):
         version = state.pop('__mpl_version__')
         restore_to_pylab = state.pop('_restore_to_pylab', False)
 
+        # Extract serialized align label groups if present
+        serialized_align = state.pop("_align_label_groups", None)
+
         if version != mpl.__version__:
             _api.warn_external(
                 f"This figure was saved with matplotlib version {version} and "
@@ -3187,6 +3200,17 @@ None}, default: None
 
         self.__dict__ = state
 
+        # Rebuild align label groupers
+        self._align_label_groups = {"x": cbook.Grouper(), "y": cbook.Grouper()}
+        if serialized_align is not None:
+            for name in ("x", "y"):
+                groups = serialized_align.get(name, [])
+                for group in groups:
+                    # group is a list of Axes (or None if dead); filter Nones
+                    members = [m for m in group if m is not None]
+                    if len(members) > 1:
+                        self._align_label_groups[name].join(*members)
+
         # re-initialise some of the unstored state information
         FigureCanvasBase(self)  # Set self.canvas.
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 06:12:02,259 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       ├── stale.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   ├── 25112-GG.rst
|   |   |   |   ├── 25192-DS.rst
|   |   |   |   └── 25255-RR.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   ├── 24990-OG.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   └── 25282-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 24923-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.6.0.rst
|   |   |   ├── api_changes_3.6.1.rst
|   |   |   ├── api_changes_3.7.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.7.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── README.rst
|       |   ├── pie_hatch.rst
|       |   ├── savefig_bbox_layout.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── github_stats_3.6.0.rst
|       |   ├── github_stats_3.6.1.rst
|       |   ├── github_stats_3.6.2.rst
|       |   ├── github_stats_3.6.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   ├── whats_new_3.6.0.rst
|       |   └── whats_new_3.7.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── galleries
|   ├── examples
|   |   ├── README.txt
|   |   ├── animation
|   |   |   ├── README.txt
|   |   |   ├── animate_decay.py
|   |   |   ├── animated_histogram.py
|   |   |   ├── animation_demo.py
|   |   |   ├── bayes_update.py
|   |   |   ├── double_pendulum.py
|   |   |   ├── dynamic_image.py
|   |   |   ├── frame_grabbing_sgskip.py
|   |   |   ├── multiple_axes.py
|   |   |   ├── pause_resume.py
|   |   |   ├── rain.py
|   |   |   ├── random_walk.py
|   |   |   ├── simple_anim.py
|   |   |   ├── simple_scatter.py
|   |   |   ├── strip_chart.py
|   |   |   └── unchained.py
|   |   ├── axes_grid1
|   |   |   ├── README.txt
|   |   |   ├── demo_anchored_direction_arrows.py
|   |   |   ├── demo_axes_divider.py
|   |   |   ├── demo_axes_grid.py
|   |   |   ├── demo_axes_grid2.py
|   |   |   ├── demo_axes_hbox_divider.py
|   |   |   ├── demo_axes_rgb.py
|   |   |   ├── demo_colorbar_of_inset_axes.py
|   |   |   ├── demo_colorbar_with_axes_divider.py
|   |   |   ├── demo_colorbar_with_inset_locator.py
|   |   |   ├── demo_edge_colorbar.py
|   |   |   ├── demo_fixed_size_axes.py
|   |   |   ├── demo_imagegrid_aspect.py
|   |   |   ├── inset_locator_demo.py
|   |   |   ├── inset_locator_demo2.py
|   |   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   |   ├── parasite_simple.py
|   |   |   ├── parasite_simple2.py
|   |   |   ├── scatter_hist_locatable_axes.py
|   |   |   ├── simple_anchored_artists.py
|   |   |   ├── simple_axes_divider1.py
|   |   |   ├── simple_axes_divider3.py
|   |   |   ├── simple_axesgrid.py
|   |   |   ├── simple_axesgrid2.py
|   |   |   ├── simple_axisline4.py
|   |   |   └── simple_colorbar.py
|   |   ├── axisartist
|   |   |   ├── README.txt
|   |   |   ├── axis_direction.py
|   |   |   ├── demo_axis_direction.py
|   |   |   ├── demo_axisline_style.py
|   |   |   ├── demo_curvelinear_grid.py
|   |   |   ├── demo_curvelinear_grid2.py
|   |   |   ├── demo_floating_axes.py
|   |   |   ├── demo_floating_axis.py
|   |   |   ├── demo_parasite_axes.py
|   |   |   ├── demo_parasite_axes2.py
|   |   |   ├── demo_ticklabel_alignment.py
|   |   |   ├── demo_ticklabel_direction.py
|   |   |   ├── simple_axis_direction01.py
|   |   |   ├── simple_axis_direction03.py
|   |   |   ├── simple_axis_pad.py
|   |   |   ├── simple_axisartist1.py
|   |   |   ├── simple_axisline.py
|   |   |   └── simple_axisline3.py
|   |   ├── color
|   |   |   ├── README.txt
|   |   |   ├── color_by_yvalue.py
|   |   |   ├── color_cycle_default.py
|   |   |   ├── color_demo.py
|   |   |   ├── colorbar_basics.py
|   |   |   ├── colormap_reference.py
|   |   |   ├── custom_cmap.py
|   |   |   └── named_colors.py
|   |   ├── event_handling
|   |   |   ├── README.txt
|   |   |   ├── close_event.py
|   |   |   ├── coords_demo.py
|   |   |   ├── cursor_demo.py
|   |   |   ├── data_browser.py
|   |   |   ├── figure_axes_enter_leave.py
|   |   |   ├── ginput_manual_clabel_sgskip.py
|   |   |   ├── image_slices_viewer.py
|   |   |   ├── keypress_demo.py
|   |   |   ├── lasso_demo.py
|   |   |   ├── legend_picking.py
|   |   |   ├── looking_glass.py
|   |   |   ├── path_editor.py
|   |   |   ├── pick_event_demo.py
|   |   |   ├── pick_event_demo2.py
|   |   |   ├── poly_editor.py
|   |   |   ├── pong_sgskip.py
|   |   |   ├── resample.py
|   |   |   ├── timers.py
|   |   |   ├── trifinder_event_demo.py
|   |   |   ├── viewlims.py
|   |   |   └── zoom_window.py
|   |   ├── images_contours_and_fields
|   |   |   ├── README.txt
|   |   |   ├── affine_image.py
|   |   |   ├── barb_demo.py
|   |   |   ├── barcode_demo.py
|   |   |   ├── colormap_interactive_adjustment.py
|   |   |   ├── colormap_normalizations.py
|   |   |   ├── colormap_normalizations_symlognorm.py
|   |   |   ├── contour_corner_mask.py
|   |   |   ├── contour_demo.py
|   |   |   ├── contour_image.py
|   |   |   ├── contour_label_demo.py
|   |   |   ├── contourf_demo.py
|   |   |   ├── contourf_hatching.py
|   |   |   ├── contourf_log.py
|   |   |   ├── contours_in_optimization_demo.py
|   |   |   ├── demo_bboximage.py
|   |   |   ├── figimage_demo.py
|   |   |   ├── image_annotated_heatmap.py
|   |   |   ├── image_antialiasing.py
|   |   |   ├── image_clip_path.py
|   |   |   ├── image_demo.py
|   |   |   ├── image_masked.py
|   |   |   ├── image_nonuniform.py
|   |   |   ├── image_transparency_blend.py
|   |   |   ├── image_zcoord.py
|   |   |   ├── interpolation_methods.py
|   |   |   ├── irregulardatagrid.py
|   |   |   ├── layer_images.py
|   |   |   ├── matshow.py
|   |   |   ├── multi_image.py
|   |   |   ├── pcolor_demo.py
|   |   |   ├── pcolormesh_grids.py
|   |   |   ├── pcolormesh_levels.py
|   |   |   ├── plot_streamplot.py
|   |   |   ├── quadmesh_demo.py
|   |   |   ├── quiver_demo.py
|   |   |   ├── quiver_simple_demo.py
|   |   |   ├── shading_example.py
|   |   |   ├── specgram_demo.py
|   |   |   ├── spy_demos.py
|   |   |   ├── tricontour_demo.py
|   |   |   ├── tricontour_smooth_delaunay.py
|   |   |   ├── tricontour_smooth_user.py
|   |   |   ├── trigradient_demo.py
|   |   |   ├── triinterp_demo.py
|   |   |   ├── tripcolor_demo.py
|   |   |   ├── triplot_demo.py
|   |   |   └── watermark_image.py
|   |   ├── lines_bars_and_markers
|   |   |   ├── README.txt
|   |   |   ├── bar_colors.py
|   |   |   ├── bar_label_demo.py
|   |   |   ├── bar_stacked.py
|   |   |   ├── barchart.py
|   |   |   ├── barh.py
|   |   |   ├── broken_barh.py
|   |   |   ├── capstyle.py
|   |   |   ├── categorical_variables.py
|   |   |   ├── cohere.py
|   |   |   ├── csd_demo.py
|   |   |   ├── curve_error_band.py
|   |   |   ├── errorbar_limits_simple.py
|   |   |   ├── errorbar_subsample.py
|   |   |   ├── eventcollection_demo.py
|   |   |   ├── eventplot_demo.py
|   |   |   ├── fill.py
|   |   |   ├── fill_between_alpha.py
|   |   |   ├── fill_between_demo.py
|   |   |   ├── fill_betweenx_demo.py
|   |   |   ├── filled_step.py
|   |   |   ├── gradient_bar.py
|   |   |   ├── hat_graph.py
|   |   |   ├── horizontal_barchart_distribution.py
|   |   |   ├── joinstyle.py
|   |   |   ├── line_demo_dash_control.py
|   |   |   ├── lines_with_ticks_demo.py
|   |   |   ├── linestyles.py
|   |   |   ├── marker_reference.py
|   |   |   ├── markevery_demo.py
|   |   |   ├── masked_demo.py
|   |   |   ├── multicolored_line.py
|   |   |   ├── multivariate_marker_plot.py
|   |   |   ├── psd_demo.py
|   |   |   ├── scatter_custom_symbol.py
|   |   |   ├── scatter_demo2.py
|   |   |   ├── scatter_hist.py
|   |   |   ├── scatter_masked.py
|   |   |   ├── scatter_star_poly.py
|   |   |   ├── scatter_with_legend.py
|   |   |   ├── simple_plot.py
|   |   |   ├── span_regions.py
|   |   |   ├── spectrum_demo.py
|   |   |   ├── stackplot_demo.py
|   |   |   ├── stairs_demo.py
|   |   |   ├── stem_plot.py
|   |   |   ├── step_demo.py
|   |   |   ├── timeline.py
|   |   |   ├── vline_hline_demo.py
|   |   |   └── xcorr_acorr_demo.py
|   |   ├── misc
|   |   |   ├── README.txt
|   |   |   ├── anchored_artists.py
|   |   |   ├── bbox_intersect.py
|   |   |   ├── contour_manual.py
|   |   |   ├── coords_report.py
|   |   |   ├── custom_projection.py
|   |   |   ├── customize_rc.py
|   |   |   ├── demo_agg_filter.py
|   |   |   ├── demo_ribbon_box.py
|   |   |   ├── fig_x.py
|   |   |   ├── fill_spiral.py
|   |   |   ├── findobj_demo.py
|   |   |   ├── font_indexing.py
|   |   |   ├── ftface_props.py
|   |   |   ├── histogram_path.py
|   |   |   ├── hyperlinks_sgskip.py
|   |   |   ├── image_thumbnail_sgskip.py
|   |   |   ├── keyword_plotting.py
|   |   |   ├── logos2.py
|   |   |   ├── multipage_pdf.py
|   |   |   ├── multiprocess_sgskip.py
|   |   |   ├── packed_bubbles.py
|   |   |   ├── patheffect_demo.py
|   |   |   ├── print_stdout_sgskip.py
|   |   |   ├── rasterization_demo.py
|   |   |   ├── set_and_get.py
|   |   |   ├── svg_filter_line.py
|   |   |   ├── svg_filter_pie.py
|   |   |   ├── table_demo.py
|   |   |   ├── tickedstroke_demo.py
|   |   |   ├── transoffset.py
|   |   |   └── zorder_demo.py
|   |   ├── mplot3d
|   |   |   ├── 2dcollections3d.py
|   |   |   ├── 3d_bars.py
|   |   |   ├── README.txt
|   |   |   ├── bars3d.py
|   |   |   ├── box3d.py
|   |   |   ├── contour3d.py
|   |   |   ├── contour3d_2.py
|   |   |   ├── contour3d_3.py
|   |   |   ├── contourf3d.py
|   |   |   ├── contourf3d_2.py
|   |   |   ├── custom_shaded_3d_surface.py
|   |   |   ├── errorbar3d.py
|   |   |   ├── hist3d.py
|   |   |   ├── lines3d.py
|   |   |   ├── lorenz_attractor.py
|   |   |   ├── mixed_subplots.py
|   |   |   ├── offset.py
|   |   |   ├── pathpatch3d.py
|   |   |   ├── polys3d.py
|   |   |   ├── projections.py
|   |   |   ├── quiver3d.py
|   |   |   ├── rotate_axes3d_sgskip.py
|   |   |   ├── scatter3d.py
|   |   |   ├── stem3d_demo.py
|   |   |   ├── subplot3d.py
|   |   |   ├── surface3d.py
|   |   |   ├── surface3d_2.py
|   |   |   ├── surface3d_3.py
|   |   |   ├── surface3d_radial.py
|   |   |   ├── text3d.py
|   |   |   ├── tricontour3d.py
|   |   |   ├── tricontourf3d.py
|   |   |   ├── trisurf3d.py
|   |   |   ├── trisurf3d_2.py
|   |   |   ├── view_planes_3d.py
|   |   |   ├── voxels.py
|   |   |   ├── voxels_numpy_logo.py
|   |   |   ├── voxels_rgb.py
|   |   |   ├── voxels_torus.py
|   |   |   ├── wire3d.py
|   |   |   ├── wire3d_animation_sgskip.py
|   |   |   └── wire3d_zero_stride.py
|   |   ├── pie_and_polar_charts
|   |   |   ├── README.txt
|   |   |   ├── bar_of_pie.py
|   |   |   ├── nested_pie.py
|   |   |   ├── pie_and_donut_labels.py
|   |   |   ├── pie_demo2.py
|   |   |   ├── pie_features.py
|   |   |   ├── polar_bar.py
|   |   |   ├── polar_demo.py
|   |   |   ├── polar_error_caps.py
|   |   |   ├── polar_legend.py
|   |   |   └── polar_scatter.py
|   |   ├── pyplots
|   |   |   ├── README.txt
|   |   |   ├── axline.py
|   |   |   ├── pyplot_simple.py
|   |   |   ├── pyplot_text.py
|   |   |   ├── pyplot_three.py
|   |   |   └── pyplot_two_subplots.py
|   |   ├── scales
|   |   |   ├── README.txt
|   |   |   ├── asinh_demo.py
|   |   |   ├── aspect_loglog.py
|   |   |   ├── custom_scale.py
|   |   |   ├── log_bar.py
|   |   |   ├── log_demo.py
|   |   |   ├── logit_demo.py
|   |   |   ├── power_norm.py
|   |   |   ├── scales.py
|   |   |   ├── semilogx_demo.py
|   |   |   └── symlog_demo.py
|   |   ├── shapes_and_collections
|   |   |   ├── README.txt
|   |   |   ├── arrow_guide.py
|   |   |   ├── artist_reference.py
|   |   |   ├── collections.py
|   |   |   ├── compound_path.py
|   |   |   ├── dolphin.py
|   |   |   ├── donut.py
|   |   |   ├── ellipse_collection.py
|   |   |   ├── ellipse_demo.py
|   |   |   ├── fancybox_demo.py
|   |   |   ├── hatch_demo.py
|   |   |   ├── hatch_style_reference.py
|   |   |   ├── line_collection.py
|   |   |   ├── patch_collection.py
|   |   |   ├── path_patch.py
|   |   |   ├── quad_bezier.py
|   |   |   └── scatter.py
|   |   ├── showcase
|   |   |   ├── README.txt
|   |   |   ├── anatomy.py
|   |   |   ├── firefox.py
|   |   |   ├── integral.py
|   |   |   ├── mandelbrot.py
|   |   |   ├── stock_prices.py
|   |   |   └── xkcd.py
|   |   ├── specialty_plots
|   |   |   ├── README.txt
|   |   |   ├── advanced_hillshading.py
|   |   |   ├── anscombe.py
|   |   |   ├── hinton_demo.py
|   |   |   ├── leftventricle_bullseye.py
|   |   |   ├── mri_demo.py
|   |   |   ├── mri_with_eeg.py
|   |   |   ├── radar_chart.py
|   |   |   ├── sankey_basics.py
|   |   |   ├── sankey_links.py
|   |   |   ├── sankey_rankine.py
|   |   |   ├── skewt.py
|   |   |   └── topographic_hillshading.py
|   |   ├── spines
|   |   |   ├── README.txt
|   |   |   ├── centered_spines_with_arrows.py
|   |   |   ├── multiple_yaxis_with_spines.py
|   |   |   ├── spine_placement_demo.py
|   |   |   ├── spines.py
|   |   |   └── spines_dropped.py
|   |   ├── statistics
|   |   |   ├── README.txt
|   |   |   ├── barchart_demo.py
|   |   |   ├── boxplot.py
|   |   |   ├── boxplot_color.py
|   |   |   ├── boxplot_demo.py
|   |   |   ├── boxplot_vs_violin.py
|   |   |   ├── bxp.py
|   |   |   ├── confidence_ellipse.py
|   |   |   ├── customized_violin.py
|   |   |   ├── errorbar.py
|   |   |   ├── errorbar_features.py
|   |   |   ├── errorbar_limits.py
|   |   |   ├── errorbars_and_boxes.py
|   |   |   ├── hexbin_demo.py
|   |   |   ├── hist.py
|   |   |   ├── histogram_cumulative.py
|   |   |   ├── histogram_features.py
|   |   |   ├── histogram_histtypes.py
|   |   |   ├── histogram_multihist.py
|   |   |   ├── multiple_histograms_side_by_side.py
|   |   |   ├── time_series_histogram.py
|   |   |   └── violinplot.py
|   |   ├── style_sheets
|   |   |   ├── README.txt
|   |   |   ├── bmh.py
|   |   |   ├── dark_background.py
|   |   |   ├── fivethirtyeight.py
|   |   |   ├── ggplot.py
|   |   |   ├── grayscale.py
|   |   |   ├── plot_solarizedlight2.py
|   |   |   └── style_sheets_reference.py
|   |   ├── subplots_axes_and_figures
|   |   |   ├── README.txt
|   |   |   ├── align_labels_demo.py
|   |   |   ├── auto_subplots_adjust.py
|   |   |   ├── axes_box_aspect.py
|   |   |   ├── axes_demo.py
|   |   |   ├── axes_margins.py
|   |   |   ├── axes_props.py
|   |   |   ├── axes_zoom_effect.py
|   |   |   ├── axhspan_demo.py
|   |   |   ├── axis_equal_demo.py
|   |   |   ├── axis_labels_demo.py
|   |   |   ├── broken_axis.py
|   |   |   ├── colorbar_placement.py
|   |   |   ├── custom_figure_class.py
|   |   |   ├── demo_constrained_layout.py
|   |   |   ├── demo_tight_layout.py
|   |   |   ├── fahrenheit_celsius_scales.py
|   |   |   ├── figure_size_units.py
|   |   |   ├── figure_title.py
|   |   |   ├── ganged_plots.py
|   |   |   ├── geo_demo.py
|   |   |   ├── gridspec_and_subplots.py
|   |   |   ├── gridspec_multicolumn.py
|   |   |   ├── gridspec_nested.py
|   |   |   ├── invert_axes.py
|   |   |   ├── mosaic.py
|   |   |   ├── multiple_figs_demo.py
|   |   |   ├── secondary_axis.py
|   |   |   ├── share_axis_lims_views.py
|   |   |   ├── shared_axis_demo.py
|   |   |   ├── subfigures.py
|   |   |   ├── subplot.py
|   |   |   ├── subplots_adjust.py
|   |   |   ├── subplots_demo.py
|   |   |   ├── two_scales.py
|   |   |   └── zoom_inset_axes.py
|   |   ├── text_labels_and_annotations
|   |   |   ├── README.txt
|   |   |   ├── accented_text.py
|   |   |   ├── align_ylabels.py
|   |   |   ├── angle_annotation.py
|   |   |   ├── angles_on_bracket_arrows.py
|   |   |   ├── annotate_transform.py
|   |   |   ├── annotation_basic.py
|   |   |   ├── annotation_demo.py
|   |   |   ├── annotation_polar.py
|   |   |   ├── arrow_demo.py
|   |   |   ├── autowrap.py
|   |   |   ├── custom_legends.py
|   |   |   ├── date.py
|   |   |   ├── demo_annotation_box.py
|   |   |   ├── demo_text_path.py
|   |   |   ├── demo_text_rotation_mode.py
|   |   |   ├── dfrac_demo.py
|   |   |   ├── engineering_formatter.py
|   |   |   ├── fancyarrow_demo.py
|   |   |   ├── fancytextbox_demo.py
|   |   |   ├── figlegend_demo.py
|   |   |   ├── font_family_rc.py
|   |   |   ├── font_file.py
|   |   |   ├── font_table.py
|   |   |   ├── fonts_demo.py
|   |   |   ├── fonts_demo_kw.py
|   |   |   ├── label_subplots.py
|   |   |   ├── legend.py
|   |   |   ├── legend_demo.py
|   |   |   ├── line_with_text.py
|   |   |   ├── mathtext_asarray.py
|   |   |   ├── mathtext_demo.py
|   |   |   ├── mathtext_examples.py
|   |   |   ├── mathtext_fontfamily_example.py
|   |   |   ├── multiline.py
|   |   |   ├── placing_text_boxes.py
|   |   |   ├── rainbow_text.py
|   |   |   ├── stix_fonts_demo.py
|   |   |   ├── tex_demo.py
|   |   |   ├── text_alignment.py
|   |   |   ├── text_commands.py
|   |   |   ├── text_fontdict.py
|   |   |   ├── text_rotation_relative_to_line.py
|   |   |   ├── titles_demo.py
|   |   |   ├── unicode_minus.py
|   |   |   ├── usetex_baseline_test.py
|   |   |   ├── usetex_fonteffects.py
|   |   |   └── watermark_text.py
|   |   ├── ticks
|   |   |   ├── README.txt
|   |   |   ├── auto_ticks.py
|   |   |   ├── centered_ticklabels.py
|   |   |   ├── colorbar_tick_labelling_demo.py
|   |   |   ├── custom_ticker1.py
|   |   |   ├── date_concise_formatter.py
|   |   |   ├── date_demo_convert.py
|   |   |   ├── date_demo_rrule.py
|   |   |   ├── date_formatters_locators.py
|   |   |   ├── date_index_formatter.py
|   |   |   ├── date_precision_and_epochs.py
|   |   |   ├── dollar_ticks.py
|   |   |   ├── fig_axes_customize_simple.py
|   |   |   ├── major_minor_demo.py
|   |   |   ├── scalarformatter.py
|   |   |   ├── tick-formatters.py
|   |   |   ├── tick-locators.py
|   |   |   ├── tick_label_right.py
|   |   |   ├── tick_labels_from_values.py
|   |   |   ├── tick_xlabel_top.py
|   |   |   ├── ticklabels_rotation.py
|   |   |   └── ticks_too_many.py
|   |   ├── units
|   |   |   ├── README.txt
|   |   |   ├── annotate_with_units.py
|   |   |   ├── artist_tests.py
|   |   |   ├── bar_demo2.py
|   |   |   ├── bar_unit_demo.py
|   |   |   ├── basic_units.py
|   |   |   ├── ellipse_with_units.py
|   |   |   ├── evans_test.py
|   |   |   ├── radian_demo.py
|   |   |   ├── units_sample.py
|   |   |   └── units_scatter.py
|   |   ├── user_interfaces
|   |   |   ├── README.txt
|   |   |   ├── canvasagg.py
|   |   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk3_sgskip.py
|   |   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk4_sgskip.py
|   |   |   ├── embedding_in_qt_sgskip.py
|   |   |   ├── embedding_in_tk_sgskip.py
|   |   |   ├── embedding_in_wx2_sgskip.py
|   |   |   ├── embedding_in_wx3_sgskip.py
|   |   |   ├── embedding_in_wx4_sgskip.py
|   |   |   ├── embedding_in_wx5_sgskip.py
|   |   |   ├── embedding_webagg_sgskip.py
|   |   |   ├── fourier_demo_wx_sgskip.py
|   |   |   ├── gtk3_spreadsheet_sgskip.py
|   |   |   ├── gtk4_spreadsheet_sgskip.py
|   |   |   ├── images
|   |   |   ├── mathtext_wx_sgskip.py
|   |   |   ├── mpl_with_glade3_sgskip.py
|   |   |   ├── mplcvd.py
|   |   |   ├── pylab_with_gtk3_sgskip.py
|   |   |   ├── pylab_with_gtk4_sgskip.py
|   |   |   ├── svg_histogram_sgskip.py
|   |   |   ├── svg_tooltip_sgskip.py
|   |   |   ├── toolmanager_sgskip.py
|   |   |   ├── web_application_server_sgskip.py
|   |   |   └── wxcursor_demo_sgskip.py
|   |   ├── userdemo
|   |   |   ├── README.txt
|   |   |   ├── annotate_explain.py
|   |   |   ├── annotate_simple_coord02.py
|   |   |   ├── annotate_text_arrow.py
|   |   |   ├── connect_simple01.py
|   |   |   ├── connectionstyle_demo.py
|   |   |   ├── custom_boxstyle01.py
|   |   |   ├── demo_gridspec01.py
|   |   |   ├── demo_gridspec03.py
|   |   |   ├── demo_gridspec06.py
|   |   |   ├── pgf_fonts.py
|   |   |   ├── pgf_preamble_sgskip.py
|   |   |   ├── pgf_texsystem.py
|   |   |   ├── simple_annotate01.py
|   |   |   ├── simple_legend01.py
|   |   |   └── simple_legend02.py
|   |   └── widgets
|   |       ├── README.txt
|   |       ├── annotated_cursor.py
|   |       ├── buttons.py
|   |       ├── check_buttons.py
|   |       ├── cursor.py
|   |       ├── lasso_selector_demo_sgskip.py
|   |       ├── menu.py
|   |       ├── mouse_cursor.py
|   |       ├── multicursor.py
|   |       ├── polygon_selector_demo.py
|   |       ├── polygon_selector_simple.py
|   |       ├── radio_buttons.py
|   |       ├── range_slider.py
|   |       ├── rectangle_selector.py
|   |       ├── slider_demo.py
|   |       ├── slider_snap_demo.py
|   |       ├── span_selector.py
|   |       └── textbox.py
|   ├── plot_types
|   |   ├── 3D
|   |   |   ├── README.rst
|   |   |   ├── scatter3d_simple.py
|   |   |   ├── surface3d_simple.py
|   |   |   ├── trisurf3d_simple.py
|   |   |   ├── voxels_simple.py
|   |   |   └── wire3d_simple.py
|   |   ├── README.rst
|   |   ├── arrays
|   |   |   ├── README.rst
|   |   |   ├── barbs.py
|   |   |   ├── contour.py
|   |   |   ├── contourf.py
|   |   |   ├── imshow.py
|   |   |   ├── pcolormesh.py
|   |   |   ├── quiver.py
|   |   |   └── streamplot.py
|   |   ├── basic
|   |   |   ├── README.rst
|   |   |   ├── bar.py
|   |   |   ├── fill_between.py
|   |   |   ├── plot.py
|   |   |   ├── scatter_plot.py
|   |   |   ├── stackplot.py
|   |   |   ├── stem.py
|   |   |   └── step.py
|   |   ├── stats
|   |   |   ├── README.rst
|   |   |   ├── boxplot_plot.py
|   |   |   ├── errorbar_plot.py
|   |   |   ├── eventplot.py
|   |   |   ├── hexbin.py
|   |   |   ├── hist2d.py
|   |   |   ├── hist_plot.py
|   |   |   ├── pie.py
|   |   |   └── violin.py
|   |   └── unstructured
|   |       ├── README.rst
|   |       ├── tricontour.py
|   |       ├── tricontourf.py
|   |       ├── tripcolor.py
|   |       └── triplot.py
|   └── tutorials
|       ├── README.txt
|       ├── advanced
|       |   ├── README.txt
|       |   ├── blitting.py
|       |   ├── path_tutorial.py
|       |   ├── patheffects_guide.py
|       |   └── transforms_tutorial.py
|       ├── colors
|       |   ├── README.txt
|       |   ├── colorbar_only.py
|       |   ├── colormap-manipulation.py
|       |   ├── colormapnorms.py
|       |   ├── colormaps.py
|       |   └── colors.py
|       ├── intermediate
|       |   ├── README.txt
|       |   ├── arranging_axes.py
|       |   ├── artists.py
|       |   ├── autoscale.py
|       |   ├── color_cycle.py
|       |   ├── constrainedlayout_guide.py
|       |   ├── imshow_extent.py
|       |   ├── legend_guide.py
|       |   └── tight_layout_guide.py
|       ├── introductory
|       |   ├── README.txt
|       |   ├── animation_tutorial.py
|       |   ├── customizing.py
|       |   ├── images.py
|       |   ├── lifecycle.py
|       |   ├── pyplot.py
|       |   └── quick_start.py
|       ├── provisional
|       |   └── README.txt
|       ├── text
|       |   ├── README.txt
|       |   ├── annotations.py
|       |   ├── mathtext.py
|       |   ├── pgf.py
|       |   ├── text_intro.py
|       |   ├── text_props.py
|       |   └── usetex.py
|       └── toolkits
|           ├── README.txt
|           ├── axes_grid.py
|           ├── axisartist.py
|           └── mplot3d.py
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
└── tools
    ├── README.txt
    ├── boilerplate.py
    ├── cache_zenodo_svg.py
    ├── create_DejaVuDisplay.sh
    ├── embed_js.py
    ├── gh_api.py
    ├── github_stats.py
    ├── make_icons.py
    ├── memleak.py
    ├── run_examples.py
    ├── subset.py
    ├── triage_tests.py
    └── visualize_tests.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Unable to pickle figure with aligned labels

Description: ### Bug summary

 Unable to pickle figure after calling `align_labels()`

### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax1 = fig.add_subplot(211)
ax2 = fig.add_subplot(212)
time=[0,1,2,3,4]
speed=[40000,4300,4500,4700,4800]
acc=[10,11,12,13,14]
ax1.plot(time,speed)
ax1.set_ylabel('speed')
ax2.plot(time,acc)
ax2.set_ylabel('acc')

fig.align_labels() ##pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome
```
align.py", line 16
pickle.dumps(fig)
TypeError: cannot pickle 'weakref.ReferenceType' object
```
### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

None

Patch information:
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index b4c38368bf..6a57554d0c 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -3174,12 +3174,25 @@ None}, default: None
         from matplotlib import _pylab_helpers
         if self.canvas.manager in _pylab_helpers.Gcf.figs.values():
             state['_restore_to_pylab'] = True
+
+        # Serialize align label groups to avoid pickling weakrefs from Grouper
+        try:
+            state["_align_label_groups"] = {
+                name: [group for group in self._align_label_groups[name]]
+                for name in ("x", "y")
+            }
+        except Exception:
+            # Fallback to empty alignment info if serialization fails
+            state["_align_label_groups"] = {"x": [], "y": []}
         return state
 
     def __setstate__(self, state):
         version = state.pop('__mpl_version__')
         restore_to_pylab = state.pop('_restore_to_pylab', False)
 
+        # Extract serialized align label groups if present
+        serialized_align = state.pop("_align_label_groups", None)
+
         if version != mpl.__version__:
             _api.warn_external(
                 f"This figure was saved with matplotlib version {version} and "
@@ -3187,6 +3200,17 @@ None}, default: None
 
         self.__dict__ = state
 
+        # Rebuild align label groupers
+        self._align_label_groups = {"x": cbook.Grouper(), "y": cbook.Grouper()}
+        if serialized_align is not None:
+            for name in ("x", "y"):
+                groups = serialized_align.get(name, [])
+                for group in groups:
+                    # group is a list of Axes (or None if dead); filter Nones
+                    members = [m for m in group if m is not None]
+                    if len(members) > 1:
+                        self._align_label_groups[name].join(*members)
+
         # re-initialise some of the unstored state information
         FigureCanvasBase(self)  # Set self.canvas.
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 06:12:14,382 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to a pickling error with `fig.align_labels()`. The bug report and patch point to the `Figure` class methods. The most relevant test file is `lib/matplotlib/tests/test_figure.py`, which should contain tests for the `Figure` class functionality. I need the content of this file to identify suitable test cases.' query='Please provide the full content of lib/matplotlib/tests/test_figure.py' extra_requirements='' purpose="I need to find existing test cases for pickling figures and for the `align_labels` method to satisfy the user's request."
2025-12-21 06:12:14,383 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of lib/matplotlib/tests/test_figure.py
2025-12-21 06:12:14,383 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 06:12:14,384 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 06:12:14,385 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 06:12:14,385 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of lib/matplotlib/tests/test_figure.py
Purpose: I need to find existing test cases for pickling figures and for the `align_labels` method to satisfy the user's request.
2025-12-21 06:12:16,575 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the file `lib/matplotlib/tests/test_figure.py` to help you find test cases for pickling figures and the `align_labels` method.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_figure.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2138, 'candidates_token_count': 66, 'total_token_count': 2285, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2138}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 66}], 'thoughts_token_count': 81, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1132029475587787, 'model_name': 'gemini-2.5-pro'} id='run--15751749-574c-4181-b8c5-90a3d54f1ec7-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_figure.py'}, 'id': '83293e89-aee7-4c34-a27f-3629fb160c72', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2138, 'output_tokens': 66, 'total_tokens': 2285, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 81}}
2025-12-21 06:12:22,487 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the content of `lib/matplotlib/tests/test_figure.py` to locate the test cases you requested. The test cases for the `align_labels` method are `test_align_labels` and `test_align_labels_stray_axes`. To find the test cases for pickling, I am now searching for occurrences of the word "pickle" within the file. This will allow me to identify the specific tests related to pickling figures.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_figure.py", "text": "pickle"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10137, 'candidates_token_count': 134, 'total_token_count': 10654, 'cached_content_token_count': 1852, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10137}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1852}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 134}], 'thoughts_token_count': 383}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3460931350935751, 'model_name': 'gemini-2.5-pro'} id='run--c46dfae1-2538-44d5-bfcb-7b452189a6d8-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_figure.py', 'text': 'pickle'}, 'id': '86579f6b-8d2e-4d80-b233-3f533ae38af7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10137, 'output_tokens': 134, 'total_tokens': 10654, 'input_token_details': {'cache_read': 1852}, 'output_token_details': {'reasoning': 383}}
2025-12-21 06:12:26,253 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have located the relevant test cases within `lib/matplotlib/tests/test_figure.py` as you requested. The tests for `align_labels` are `test_align_labels` and `test_align_labels_stray_axes`, and I found a test for unpickling called `test_unpickle_with_device_pixel_ratio`. I will now retrieve the full code for these specific tests to give you the complete context.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_figure.py", "end_line": 1542.0, "start_line": 1537.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10575, 'candidates_token_count': 158, 'total_token_count': 10807, 'cached_content_token_count': 9244, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10575}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9244}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 158}], 'thoughts_token_count': 74}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1255183159550534, 'model_name': 'gemini-2.5-pro'} id='run--c29af411-5f86-4949-b533-5c938d6525f0-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_figure.py', 'end_line': 102.0, 'start_line': 28.0}, 'id': '7074cb49-9260-4308-84d9-1cdd76311a10', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'relative_path': 'lib/matplotlib/tests/test_figure.py', 'end_line': 1542.0, 'start_line': 1537.0}, 'id': 'd73cced7-f3d7-48e1-8caa-a676a27a4ed2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10575, 'output_tokens': 158, 'total_tokens': 10807, 'input_token_details': {'cache_read': 9244}, 'output_token_details': {'reasoning': 74}}
2025-12-21 06:12:36,370 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully located the test cases for pickling figures and the `align_labels` method within the `lib/matplotlib/tests/test_figure.py` file. I first read the entire file to get an overview, then specifically searched for "pickle" to find the pickling-related tests. The relevant tests are `test_align_labels`, `test_align_labels_stray_axes` for the `align_labels` method, and `test_unpickle_with_device_pixel_ratio` for pickling. I have retrieved the full source code for these functions to provide you with the complete context.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12234, 'candidates_token_count': 132, 'total_token_count': 13247, 'cached_content_token_count': 9278, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12234}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9278}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 132}], 'thoughts_token_count': 881}, 'finish_reason': 'STOP', 'avg_logprobs': -0.688674579967152, 'model_name': 'gemini-2.5-pro'} id='run--3baeb9ff-67d7-428e-9049-314ab0bb8d6b-0' usage_metadata={'input_tokens': 12234, 'output_tokens': 132, 'total_tokens': 13247, 'input_token_details': {'cache_read': 9278}, 'output_token_details': {'reasoning': 881}}
2025-12-21 06:12:36,372 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of lib/matplotlib/tests/test_figure.py
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find existing test cases for pickling figures and for the `align_labels` method to satisfy the user's request.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_figure.py
Line number range: 1 - 500
Content:
1. import copy
2. from datetime import datetime
3. import io
4. from pathlib import Path
5. import pickle
6. import platform
7. from threading import Timer
8. from types import SimpleNamespace
9. import warnings
10. 
11. import numpy as np
12. import pytest
13. from PIL import Image
14. 
15. import matplotlib as mpl
16. from matplotlib import gridspec
17. from matplotlib.testing.decorators import image_comparison, check_figures_equal
18. from matplotlib.axes import Axes
19. from matplotlib.figure import Figure, FigureBase
20. from matplotlib.layout_engine import (ConstrainedLayoutEngine,
21.                                       TightLayoutEngine,
22.                                       PlaceHolderLayoutEngine)
23. from matplotlib.ticker import AutoMinorLocator, FixedFormatter, ScalarFormatter
24. import matplotlib.pyplot as plt
25. import matplotlib.dates as mdates
26. 
27. 
28. @image_comparison(['figure_align_labels'], extensions=['png', 'svg'],
29.                   tol=0 if platform.machine() == 'x86_64' else 0.01)
30. def test_align_labels():
31.     fig = plt.figure(layout='tight')
32.     gs = gridspec.GridSpec(3, 3)
33. 
34.     ax = fig.add_subplot(gs[0, :2])
35.     ax.plot(np.arange(0, 1e6, 1000))
36.     ax.set_ylabel('Ylabel0 0')
37.     ax = fig.add_subplot(gs[0, -1])
38.     ax.plot(np.arange(0, 1e4, 100))
39. 
40.     for i in range(3):
41.         ax = fig.add_subplot(gs[1, i])
42.         ax.set_ylabel('YLabel1 %d' % i)
43.         ax.set_xlabel('XLabel1 %d' % i)
44.         if i in [0, 2]:
45.             ax.xaxis.set_label_position("top")
46.             ax.xaxis.tick_top()
47.         if i == 0:
48.             for tick in ax.get_xticklabels():
49.                 tick.set_rotation(90)
50.         if i == 2:
51.             ax.yaxis.set_label_position("right")
52.             ax.yaxis.tick_right()
53. 
54.     for i in range(3):
55.         ax = fig.add_subplot(gs[2, i])
56.         ax.set_xlabel(f'XLabel2 {i}')
57.         ax.set_ylabel(f'YLabel2 {i}')
58. 
59.         if i == 2:
60.             ax.plot(np.arange(0, 1e4, 10))
61.             ax.yaxis.set_label_position("right")
62.             ax.yaxis.tick_right()
63.             for tick in ax.get_xticklabels():
64.                 tick.set_rotation(90)
65. 
66.     fig.align_labels()
67. 
68. 
69. def test_align_labels_stray_axes():
70.     fig, axs = plt.subplots(2, 2)
71.     for nn, ax in enumerate(axs.flat):
72.         ax.set_xlabel('Boo')
73.         ax.set_xlabel('Who')
74.         ax.plot(np.arange(4)**nn, np.arange(4)**nn)
75.     fig.align_ylabels()
76.     fig.align_xlabels()
77.     fig.draw_without_rendering()
78.     xn = np.zeros(4)
79.     yn = np.zeros(4)
80.     for nn, ax in enumerate(axs.flat):
81.         yn[nn] = ax.xaxis.label.get_position()[1]
82.         xn[nn] = ax.yaxis.label.get_position()[0]
83.     np.testing.assert_allclose(xn[:2], xn[2:])
84.     np.testing.assert_allclose(yn[::2], yn[1::2])
85. 
86.     fig, axs = plt.subplots(2, 2, constrained_layout=True)
87.     for nn, ax in enumerate(axs.flat):
88.         ax.set_xlabel('Boo')
89.         ax.set_xlabel('Who')
90.         pc = ax.pcolormesh(np.random.randn(10, 10))
91.     fig.colorbar(pc, ax=ax)
92.     fig.align_ylabels()
93.     fig.align_xlabels()
94.     fig.draw_without_rendering()
95.     xn = np.zeros(4)
96.     yn = np.zeros(4)
97.     for nn, ax in enumerate(axs.flat):
98.         yn[nn] = ax.xaxis.label.get_position()[1]
99.         xn[nn] = ax.yaxis.label.get_position()[0]
100.     np.testing.assert_allclose(xn[:2], xn[2:])
101.     np.testing.assert_allclose(yn[::2], yn[1::2])
102. 
103. 
104. def test_figure_label():
105.     # pyplot figure creation, selection, and closing with label/number/instance
106.     plt.close('all')
107.     fig_today = plt.figure('today')
108.     plt.figure(3)
109.     plt.figure('tomorrow')
110.     plt.figure()
111.     plt.figure(0)
112.     plt.figure(1)
113.     plt.figure(3)
114.     assert plt.get_fignums() == [0, 1, 3, 4, 5]
115.     assert plt.get_figlabels() == ['', 'today', '', 'tomorrow', '']
116.     plt.close(10)
117.     plt.close()
118.     plt.close(5)
119.     plt.close('tomorrow')
120.     assert plt.get_fignums() == [0, 1]
121.     assert plt.get_figlabels() == ['', 'today']
122.     plt.figure(fig_today)
123.     assert plt.gcf() == fig_today
124.     with pytest.raises(ValueError):
125.         plt.figure(Figure())
126. 
127. 
128. def test_fignum_exists():
129.     # pyplot figure creation, selection and closing with fignum_exists
130.     plt.figure('one')
131.     plt.figure(2)
132.     plt.figure('three')
133.     plt.figure()
134.     assert plt.fignum_exists('one')
135.     assert plt.fignum_exists(2)
136.     assert plt.fignum_exists('three')
137.     assert plt.fignum_exists(4)
138.     plt.close('one')
139.     plt.close(4)
140.     assert not plt.fignum_exists('one')
141.     assert not plt.fignum_exists(4)
142. 
143. 
144. def test_clf_keyword():
145.     # test if existing figure is cleared with figure() and subplots()
146.     text1 = 'A fancy plot'
147.     text2 = 'Really fancy!'
148. 
149.     fig0 = plt.figure(num=1)
150.     fig0.suptitle(text1)
151.     assert [t.get_text() for t in fig0.texts] == [text1]
152. 
153.     fig1 = plt.figure(num=1, clear=False)
154.     fig1.text(0.5, 0.5, text2)
155.     assert fig0 is fig1
156.     assert [t.get_text() for t in fig1.texts] == [text1, text2]
157. 
158.     fig2, ax2 = plt.subplots(2, 1, num=1, clear=True)
159.     assert fig0 is fig2
160.     assert [t.get_text() for t in fig2.texts] == []
161. 
162. 
163. @image_comparison(['figure_today'])
164. def test_figure():
165.     # named figure support
166.     fig = plt.figure('today')
167.     ax = fig.add_subplot()
168.     ax.set_title(fig.get_label())
169.     ax.plot(np.arange(5))
170.     # plot red line in a different figure.
171.     plt.figure('tomorrow')
172.     plt.plot([0, 1], [1, 0], 'r')
173.     # Return to the original; make sure the red line is not there.
174.     plt.figure('today')
175.     plt.close('tomorrow')
176. 
177. 
178. @image_comparison(['figure_legend'])
179. def test_figure_legend():
180.     fig, axs = plt.subplots(2)
181.     axs[0].plot([0, 1], [1, 0], label='x', color='g')
182.     axs[0].plot([0, 1], [0, 1], label='y', color='r')
183.     axs[0].plot([0, 1], [0.5, 0.5], label='y', color='k')
184. 
185.     axs[1].plot([0, 1], [1, 0], label='_y', color='r')
186.     axs[1].plot([0, 1], [0, 1], label='z', color='b')
187.     fig.legend()
188. 
189. 
190. def test_gca():
191.     fig = plt.figure()
192. 
193.     # test that gca() picks up Axes created via add_axes()
194.     ax0 = fig.add_axes([0, 0, 1, 1])
195.     assert fig.gca() is ax0
196. 
197.     # test that gca() picks up Axes created via add_subplot()
198.     ax1 = fig.add_subplot(111)
199.     assert fig.gca() is ax1
200. 
201.     # add_axes on an existing Axes should not change stored order, but will
202.     # make it current.
203.     fig.add_axes(ax0)
204.     assert fig.axes == [ax0, ax1]
205.     assert fig.gca() is ax0
206. 
207.     # sca() should not change stored order of Axes, which is order added.
208.     fig.sca(ax0)
209.     assert fig.axes == [ax0, ax1]
210. 
211.     # add_subplot on an existing Axes should not change stored order, but will
212.     # make it current.
213.     fig.add_subplot(ax1)
214.     assert fig.axes == [ax0, ax1]
215.     assert fig.gca() is ax1
216. 
217. 
218. def test_add_subplot_subclass():
219.     fig = plt.figure()
220.     fig.add_subplot(axes_class=Axes)
221.     with pytest.raises(ValueError):
222.         fig.add_subplot(axes_class=Axes, projection="3d")
223.     with pytest.raises(ValueError):
224.         fig.add_subplot(axes_class=Axes, polar=True)
225.     with pytest.raises(ValueError):
226.         fig.add_subplot(projection="3d", polar=True)
227.     with pytest.raises(TypeError):
228.         fig.add_subplot(projection=42)
229. 
230. 
231. def test_add_subplot_invalid():
232.     fig = plt.figure()
233.     with pytest.raises(ValueError,
234.                        match='Number of columns must be a positive integer'):
235.         fig.add_subplot(2, 0, 1)
236.     with pytest.raises(ValueError,
237.                        match='Number of rows must be a positive integer'):
238.         fig.add_subplot(0, 2, 1)
239.     with pytest.raises(ValueError, match='num must be an integer with '
240.                                          '1 <= num <= 4'):
241.         fig.add_subplot(2, 2, 0)
242.     with pytest.raises(ValueError, match='num must be an integer with '
243.                                          '1 <= num <= 4'):
244.         fig.add_subplot(2, 2, 5)
245.     with pytest.raises(ValueError, match='num must be an integer with '
246.                                          '1 <= num <= 4'):
247.         fig.add_subplot(2, 2, 0.5)
248. 
249.     with pytest.raises(ValueError, match='must be a three-digit integer'):
250.         fig.add_subplot(42)
251.     with pytest.raises(ValueError, match='must be a three-digit integer'):
252.         fig.add_subplot(1000)
253. 
254.     with pytest.raises(TypeError, match='takes 1 or 3 positional arguments '
255.                                         'but 2 were given'):
256.         fig.add_subplot(2, 2)
257.     with pytest.raises(TypeError, match='takes 1 or 3 positional arguments '
258.                                         'but 4 were given'):
259.         fig.add_subplot(1, 2, 3, 4)
260.     with pytest.raises(ValueError,
261.                        match="Number of rows must be a positive integer, "
262.                              "not '2'"):
263.         fig.add_subplot('2', 2, 1)
264.     with pytest.raises(ValueError,
265.                        match='Number of columns must be a positive integer, '
266.                              'not 2.0'):
267.         fig.add_subplot(2, 2.0, 1)
268.     _, ax = plt.subplots()
269.     with pytest.raises(ValueError,
270.                        match='The Axes must have been created in the '
271.                              'present figure'):
272.         fig.add_subplot(ax)
273. 
274. 
275. @image_comparison(['figure_suptitle'])
276. def test_suptitle():
277.     fig, _ = plt.subplots()
278.     fig.suptitle('hello', color='r')
279.     fig.suptitle('title', color='g', rotation=30)
280. 
281. 
282. def test_suptitle_fontproperties():
283.     fig, ax = plt.subplots()
284.     fps = mpl.font_manager.FontProperties(size='large', weight='bold')
285.     txt = fig.suptitle('fontprops title', fontproperties=fps)
286.     assert txt.get_fontsize() == fps.get_size_in_points()
287.     assert txt.get_weight() == fps.get_weight()
288. 
289. 
290. def test_suptitle_subfigures():
291.     fig = plt.figure(figsize=(4, 3))
292.     sf1, sf2 = fig.subfigures(1, 2)
293.     sf2.set_facecolor('white')
294.     sf1.subplots()
295.     sf2.subplots()
296.     fig.suptitle("This is a visible suptitle.")
297. 
298.     # verify the first subfigure facecolor is the default transparent
299.     assert sf1.get_facecolor() == (0.0, 0.0, 0.0, 0.0)
300.     # verify the second subfigure facecolor is white
301.     assert sf2.get_facecolor() == (1.0, 1.0, 1.0, 1.0)
302. 
303. 
304. @image_comparison(['alpha_background'],
305.                   # only test png and svg. The PDF output appears correct,
306.                   # but Ghostscript does not preserve the background color.
307.                   extensions=['png', 'svg'],
308.                   savefig_kwarg={'facecolor': (0, 1, 0.4),
309.                                  'edgecolor': 'none'})
310. def test_alpha():
311.     # We want an image which has a background color and an alpha of 0.4.
312.     fig = plt.figure(figsize=[2, 1])
313.     fig.set_facecolor((0, 1, 0.4))
314.     fig.patch.set_alpha(0.4)
315.     fig.patches.append(mpl.patches.CirclePolygon(
316.         [20, 20], radius=15, alpha=0.6, facecolor='red'))
317. 
318. 
319. def test_too_many_figures():
320.     with pytest.warns(RuntimeWarning):
321.         for i in range(mpl.rcParams['figure.max_open_warning'] + 1):
322.             plt.figure()
323. 
324. 
325. def test_iterability_axes_argument():
326. 
327.     # This is a regression test for matplotlib/matplotlib#3196. If one of the
328.     # arguments returned by _as_mpl_axes defines __getitem__ but is not
329.     # iterable, this would raise an exception. This is because we check
330.     # whether the arguments are iterable, and if so we try and convert them
331.     # to a tuple. However, the ``iterable`` function returns True if
332.     # __getitem__ is present, but some classes can define __getitem__ without
333.     # being iterable. The tuple conversion is now done in a try...except in
334.     # case it fails.
335. 
336.     class MyAxes(Axes):
337.         def __init__(self, *args, myclass=None, **kwargs):
338.             Axes.__init__(self, *args, **kwargs)
339. 
340.     class MyClass:
341. 
342.         def __getitem__(self, item):
343.             if item != 'a':
344.                 raise ValueError("item should be a")
345. 
346.         def _as_mpl_axes(self):
347.             return MyAxes, {'myclass': self}
348. 
349.     fig = plt.figure()
350.     fig.add_subplot(1, 1, 1, projection=MyClass())
351.     plt.close(fig)
352. 
353. 
354. def test_set_fig_size():
355.     fig = plt.figure()
356. 
357.     # check figwidth
358.     fig.set_figwidth(5)
359.     assert fig.get_figwidth() == 5
360. 
361.     # check figheight
362.     fig.set_figheight(1)
363.     assert fig.get_figheight() == 1
364. 
365.     # check using set_size_inches
366.     fig.set_size_inches(2, 4)
367.     assert fig.get_figwidth() == 2
368.     assert fig.get_figheight() == 4
369. 
370.     # check using tuple to first argument
371.     fig.set_size_inches((1, 3))
372.     assert fig.get_figwidth() == 1
373.     assert fig.get_figheight() == 3
374. 
375. 
376. def test_axes_remove():
377.     fig, axs = plt.subplots(2, 2)
378.     axs[-1, -1].remove()
379.     for ax in axs.ravel()[:-1]:
380.         assert ax in fig.axes
381.     assert axs[-1, -1] not in fig.axes
382.     assert len(fig.axes) == 3
383. 
384. 
385. def test_figaspect():
386.     w, h = plt.figaspect(np.float64(2) / np.float64(1))
387.     assert h / w == 2
388.     w, h = plt.figaspect(2)
389.     assert h / w == 2
390.     w, h = plt.figaspect(np.zeros((1, 2)))
391.     assert h / w == 0.5
392.     w, h = plt.figaspect(np.zeros((2, 2)))
393.     assert h / w == 1
394. 
395. 
396. @pytest.mark.parametrize('which', ['both', 'major', 'minor'])
397. def test_autofmt_xdate(which):
398.     date = ['3 Jan 2013', '4 Jan 2013', '5 Jan 2013', '6 Jan 2013',
399.             '7 Jan 2013', '8 Jan 2013', '9 Jan 2013', '10 Jan 2013',
400.             '11 Jan 2013', '12 Jan 2013', '13 Jan 2013', '14 Jan 2013']
401. 
402.     time = ['16:44:00', '16:45:00', '16:46:00', '16:47:00', '16:48:00',
403.             '16:49:00', '16:51:00', '16:52:00', '16:53:00', '16:55:00',
404.             '16:56:00', '16:57:00']
405. 
406.     angle = 60
407.     minors = [1, 2, 3, 4, 5, 6, 7]
408. 
409.     x = mdates.datestr2num(date)
410.     y = mdates.datestr2num(time)
411. 
412.     fig, ax = plt.subplots()
413. 
414.     ax.plot(x, y)
415.     ax.yaxis_date()
416.     ax.xaxis_date()
417. 
418.     ax.xaxis.set_minor_locator(AutoMinorLocator(2))
419.     with warnings.catch_warnings():
420.         warnings.filterwarnings(
421.             'ignore',
422.             'FixedFormatter should only be used together with FixedLocator')
423.         ax.xaxis.set_minor_formatter(FixedFormatter(minors))
424. 
425.     fig.autofmt_xdate(0.2, angle, 'right', which)
426. 
427.     if which in ('both', 'major'):
428.         for label in fig.axes[0].get_xticklabels(False, 'major'):
429.             assert int(label.get_rotation()) == angle
430. 
431.     if which in ('both', 'minor'):
432.         for label in fig.axes[0].get_xticklabels(True, 'minor'):
433.             assert int(label.get_rotation()) == angle
434. 
435. 
436. @mpl.style.context('default')
437. def test_change_dpi():
438.     fig = plt.figure(figsize=(4, 4))
439.     fig.draw_without_rendering()
440.     assert fig.canvas.renderer.height == 400
441.     assert fig.canvas.renderer.width == 400
442.     fig.dpi = 50
443.     fig.draw_without_rendering()
444.     assert fig.canvas.renderer.height == 200
445.     assert fig.canvas.renderer.width == 200
446. 
447. 
448. @pytest.mark.parametrize('width, height', [
449.     (1, np.nan),
450.     (-1, 1),
451.     (np.inf, 1)
452. ])
453. def test_invalid_figure_size(width, height):
454.     with pytest.raises(ValueError):
455.         plt.figure(figsize=(width, height))
456. 
457.     fig = plt.figure()
458.     with pytest.raises(ValueError):
459.         fig.set_size_inches(width, height)
460. 
461. 
462. def test_invalid_figure_add_axes():
463.     fig = plt.figure()
464.     with pytest.raises(TypeError,
465.                        match="missing 1 required positional argument: 'rect'"):
466.         fig.add_axes()
467. 
468.     with pytest.raises(ValueError):
469.         fig.add_axes((.1, .1, .5, np.nan))
470. 
471.     with pytest.raises(TypeError, match="multiple values for argument 'rect'"):
472.         fig.add_axes([0, 0, 1, 1], rect=[0, 0, 1, 1])
473. 
474.     _, ax = plt.subplots()
475.     with pytest.raises(ValueError,
476.                        match="The Axes must have been created in the present "
477.                              "figure"):
478.         fig.add_axes(ax)
479. 
480. 
481. def test_subplots_shareax_loglabels():
482.     fig, axs = plt.subplots(2, 2, sharex=True, sharey=True, squeeze=False)
483.     for ax in axs.flat:
484.         ax.plot([10, 20, 30], [10, 20, 30])
485. 
486.     ax.set_yscale("log")
487.     ax.set_xscale("log")
488. 
489.     for ax in axs[0, :]:
490.         assert 0 == len(ax.xaxis.get_ticklabels(which='both'))
491. 
492.     for ax in axs[1, :]:
493.         assert 0 < len(ax.xaxis.get_ticklabels(which='both'))
494. 
495.     for ax in axs[:, 1]:
496.         assert 0 == len(ax.yaxis.get_ticklabels(which='both'))
497. 
498.     for ax in axs[:, 0]:
499.         assert 0 < len(ax.yaxis.get_ticklabels(which='both'))
500.


File: lib/matplotlib/tests/test_figure.py
Line number range: 1537 - 1542
Content:
def test_unpickle_with_device_pixel_ratio():
    fig = Figure(dpi=42)
    fig.canvas._set_device_pixel_ratio(7)
    assert fig.dpi == 42*7
    fig2 = pickle.loads(pickle.dumps(fig))
    assert fig2.dpi == 42

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 06:12:50,474 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of the file 'lib/matplotlib/tests/test_figure.py'.\n2. Extended relevance:\n   - This context contains the first 500 lines of the requested file, which is directly relevant to the user's query.", relative_path='lib/matplotlib/tests/test_figure.py', start_line=1, end_line=500), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requested the full content of the file 'lib/matplotlib/tests/test_figure.py'.\n2. Extended relevance:\n   - This context contains lines 1537-1542 of the requested file. This part of the file includes a test case for unpickling a Figure object, which is relevant to the user's interest in pickling tests.", relative_path='lib/matplotlib/tests/test_figure.py', start_line=1537, end_line=1542)]
2025-12-21 06:12:50,476 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of lib/matplotlib/tests/test_figure.py
2025-12-21 06:12:50,476 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 06:12:50,476 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 06:12:50,476 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 0 existing contexts
2025-12-21 06:12:50,477 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 06:12:50,477 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       ├── stale.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   ├── 25112-GG.rst
|   |   |   |   ├── 25192-DS.rst
|   |   |   |   └── 25255-RR.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   ├── 24990-OG.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   └── 25282-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 24923-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.6.0.rst
|   |   |   ├── api_changes_3.6.1.rst
|   |   |   ├── api_changes_3.7.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.7.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── README.rst
|       |   ├── pie_hatch.rst
|       |   ├── savefig_bbox_layout.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── github_stats_3.6.0.rst
|       |   ├── github_stats_3.6.1.rst
|       |   ├── github_stats_3.6.2.rst
|       |   ├── github_stats_3.6.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   ├── whats_new_3.6.0.rst
|       |   └── whats_new_3.7.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── galleries
|   ├── examples
|   |   ├── README.txt
|   |   ├── animation
|   |   |   ├── README.txt
|   |   |   ├── animate_decay.py
|   |   |   ├── animated_histogram.py
|   |   |   ├── animation_demo.py
|   |   |   ├── bayes_update.py
|   |   |   ├── double_pendulum.py
|   |   |   ├── dynamic_image.py
|   |   |   ├── frame_grabbing_sgskip.py
|   |   |   ├── multiple_axes.py
|   |   |   ├── pause_resume.py
|   |   |   ├── rain.py
|   |   |   ├── random_walk.py
|   |   |   ├── simple_anim.py
|   |   |   ├── simple_scatter.py
|   |   |   ├── strip_chart.py
|   |   |   └── unchained.py
|   |   ├── axes_grid1
|   |   |   ├── README.txt
|   |   |   ├── demo_anchored_direction_arrows.py
|   |   |   ├── demo_axes_divider.py
|   |   |   ├── demo_axes_grid.py
|   |   |   ├── demo_axes_grid2.py
|   |   |   ├── demo_axes_hbox_divider.py
|   |   |   ├── demo_axes_rgb.py
|   |   |   ├── demo_colorbar_of_inset_axes.py
|   |   |   ├── demo_colorbar_with_axes_divider.py
|   |   |   ├── demo_colorbar_with_inset_locator.py
|   |   |   ├── demo_edge_colorbar.py
|   |   |   ├── demo_fixed_size_axes.py
|   |   |   ├── demo_imagegrid_aspect.py
|   |   |   ├── inset_locator_demo.py
|   |   |   ├── inset_locator_demo2.py
|   |   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   |   ├── parasite_simple.py
|   |   |   ├── parasite_simple2.py
|   |   |   ├── scatter_hist_locatable_axes.py
|   |   |   ├── simple_anchored_artists.py
|   |   |   ├── simple_axes_divider1.py
|   |   |   ├── simple_axes_divider3.py
|   |   |   ├── simple_axesgrid.py
|   |   |   ├── simple_axesgrid2.py
|   |   |   ├── simple_axisline4.py
|   |   |   └── simple_colorbar.py
|   |   ├── axisartist
|   |   |   ├── README.txt
|   |   |   ├── axis_direction.py
|   |   |   ├── demo_axis_direction.py
|   |   |   ├── demo_axisline_style.py
|   |   |   ├── demo_curvelinear_grid.py
|   |   |   ├── demo_curvelinear_grid2.py
|   |   |   ├── demo_floating_axes.py
|   |   |   ├── demo_floating_axis.py
|   |   |   ├── demo_parasite_axes.py
|   |   |   ├── demo_parasite_axes2.py
|   |   |   ├── demo_ticklabel_alignment.py
|   |   |   ├── demo_ticklabel_direction.py
|   |   |   ├── simple_axis_direction01.py
|   |   |   ├── simple_axis_direction03.py
|   |   |   ├── simple_axis_pad.py
|   |   |   ├── simple_axisartist1.py
|   |   |   ├── simple_axisline.py
|   |   |   └── simple_axisline3.py
|   |   ├── color
|   |   |   ├── README.txt
|   |   |   ├── color_by_yvalue.py
|   |   |   ├── color_cycle_default.py
|   |   |   ├── color_demo.py
|   |   |   ├── colorbar_basics.py
|   |   |   ├── colormap_reference.py
|   |   |   ├── custom_cmap.py
|   |   |   └── named_colors.py
|   |   ├── event_handling
|   |   |   ├── README.txt
|   |   |   ├── close_event.py
|   |   |   ├── coords_demo.py
|   |   |   ├── cursor_demo.py
|   |   |   ├── data_browser.py
|   |   |   ├── figure_axes_enter_leave.py
|   |   |   ├── ginput_manual_clabel_sgskip.py
|   |   |   ├── image_slices_viewer.py
|   |   |   ├── keypress_demo.py
|   |   |   ├── lasso_demo.py
|   |   |   ├── legend_picking.py
|   |   |   ├── looking_glass.py
|   |   |   ├── path_editor.py
|   |   |   ├── pick_event_demo.py
|   |   |   ├── pick_event_demo2.py
|   |   |   ├── poly_editor.py
|   |   |   ├── pong_sgskip.py
|   |   |   ├── resample.py
|   |   |   ├── timers.py
|   |   |   ├── trifinder_event_demo.py
|   |   |   ├── viewlims.py
|   |   |   └── zoom_window.py
|   |   ├── images_contours_and_fields
|   |   |   ├── README.txt
|   |   |   ├── affine_image.py
|   |   |   ├── barb_demo.py
|   |   |   ├── barcode_demo.py
|   |   |   ├── colormap_interactive_adjustment.py
|   |   |   ├── colormap_normalizations.py
|   |   |   ├── colormap_normalizations_symlognorm.py
|   |   |   ├── contour_corner_mask.py
|   |   |   ├── contour_demo.py
|   |   |   ├── contour_image.py
|   |   |   ├── contour_label_demo.py
|   |   |   ├── contourf_demo.py
|   |   |   ├── contourf_hatching.py
|   |   |   ├── contourf_log.py
|   |   |   ├── contours_in_optimization_demo.py
|   |   |   ├── demo_bboximage.py
|   |   |   ├── figimage_demo.py
|   |   |   ├── image_annotated_heatmap.py
|   |   |   ├── image_antialiasing.py
|   |   |   ├── image_clip_path.py
|   |   |   ├── image_demo.py
|   |   |   ├── image_masked.py
|   |   |   ├── image_nonuniform.py
|   |   |   ├── image_transparency_blend.py
|   |   |   ├── image_zcoord.py
|   |   |   ├── interpolation_methods.py
|   |   |   ├── irregulardatagrid.py
|   |   |   ├── layer_images.py
|   |   |   ├── matshow.py
|   |   |   ├── multi_image.py
|   |   |   ├── pcolor_demo.py
|   |   |   ├── pcolormesh_grids.py
|   |   |   ├── pcolormesh_levels.py
|   |   |   ├── plot_streamplot.py
|   |   |   ├── quadmesh_demo.py
|   |   |   ├── quiver_demo.py
|   |   |   ├── quiver_simple_demo.py
|   |   |   ├── shading_example.py
|   |   |   ├── specgram_demo.py
|   |   |   ├── spy_demos.py
|   |   |   ├── tricontour_demo.py
|   |   |   ├── tricontour_smooth_delaunay.py
|   |   |   ├── tricontour_smooth_user.py
|   |   |   ├── trigradient_demo.py
|   |   |   ├── triinterp_demo.py
|   |   |   ├── tripcolor_demo.py
|   |   |   ├── triplot_demo.py
|   |   |   └── watermark_image.py
|   |   ├── lines_bars_and_markers
|   |   |   ├── README.txt
|   |   |   ├── bar_colors.py
|   |   |   ├── bar_label_demo.py
|   |   |   ├── bar_stacked.py
|   |   |   ├── barchart.py
|   |   |   ├── barh.py
|   |   |   ├── broken_barh.py
|   |   |   ├── capstyle.py
|   |   |   ├── categorical_variables.py
|   |   |   ├── cohere.py
|   |   |   ├── csd_demo.py
|   |   |   ├── curve_error_band.py
|   |   |   ├── errorbar_limits_simple.py
|   |   |   ├── errorbar_subsample.py
|   |   |   ├── eventcollection_demo.py
|   |   |   ├── eventplot_demo.py
|   |   |   ├── fill.py
|   |   |   ├── fill_between_alpha.py
|   |   |   ├── fill_between_demo.py
|   |   |   ├── fill_betweenx_demo.py
|   |   |   ├── filled_step.py
|   |   |   ├── gradient_bar.py
|   |   |   ├── hat_graph.py
|   |   |   ├── horizontal_barchart_distribution.py
|   |   |   ├── joinstyle.py
|   |   |   ├── line_demo_dash_control.py
|   |   |   ├── lines_with_ticks_demo.py
|   |   |   ├── linestyles.py
|   |   |   ├── marker_reference.py
|   |   |   ├── markevery_demo.py
|   |   |   ├── masked_demo.py
|   |   |   ├── multicolored_line.py
|   |   |   ├── multivariate_marker_plot.py
|   |   |   ├── psd_demo.py
|   |   |   ├── scatter_custom_symbol.py
|   |   |   ├── scatter_demo2.py
|   |   |   ├── scatter_hist.py
|   |   |   ├── scatter_masked.py
|   |   |   ├── scatter_star_poly.py
|   |   |   ├── scatter_with_legend.py
|   |   |   ├── simple_plot.py
|   |   |   ├── span_regions.py
|   |   |   ├── spectrum_demo.py
|   |   |   ├── stackplot_demo.py
|   |   |   ├── stairs_demo.py
|   |   |   ├── stem_plot.py
|   |   |   ├── step_demo.py
|   |   |   ├── timeline.py
|   |   |   ├── vline_hline_demo.py
|   |   |   └── xcorr_acorr_demo.py
|   |   ├── misc
|   |   |   ├── README.txt
|   |   |   ├── anchored_artists.py
|   |   |   ├── bbox_intersect.py
|   |   |   ├── contour_manual.py
|   |   |   ├── coords_report.py
|   |   |   ├── custom_projection.py
|   |   |   ├── customize_rc.py
|   |   |   ├── demo_agg_filter.py
|   |   |   ├── demo_ribbon_box.py
|   |   |   ├── fig_x.py
|   |   |   ├── fill_spiral.py
|   |   |   ├── findobj_demo.py
|   |   |   ├── font_indexing.py
|   |   |   ├── ftface_props.py
|   |   |   ├── histogram_path.py
|   |   |   ├── hyperlinks_sgskip.py
|   |   |   ├── image_thumbnail_sgskip.py
|   |   |   ├── keyword_plotting.py
|   |   |   ├── logos2.py
|   |   |   ├── multipage_pdf.py
|   |   |   ├── multiprocess_sgskip.py
|   |   |   ├── packed_bubbles.py
|   |   |   ├── patheffect_demo.py
|   |   |   ├── print_stdout_sgskip.py
|   |   |   ├── rasterization_demo.py
|   |   |   ├── set_and_get.py
|   |   |   ├── svg_filter_line.py
|   |   |   ├── svg_filter_pie.py
|   |   |   ├── table_demo.py
|   |   |   ├── tickedstroke_demo.py
|   |   |   ├── transoffset.py
|   |   |   └── zorder_demo.py
|   |   ├── mplot3d
|   |   |   ├── 2dcollections3d.py
|   |   |   ├── 3d_bars.py
|   |   |   ├── README.txt
|   |   |   ├── bars3d.py
|   |   |   ├── box3d.py
|   |   |   ├── contour3d.py
|   |   |   ├── contour3d_2.py
|   |   |   ├── contour3d_3.py
|   |   |   ├── contourf3d.py
|   |   |   ├── contourf3d_2.py
|   |   |   ├── custom_shaded_3d_surface.py
|   |   |   ├── errorbar3d.py
|   |   |   ├── hist3d.py
|   |   |   ├── lines3d.py
|   |   |   ├── lorenz_attractor.py
|   |   |   ├── mixed_subplots.py
|   |   |   ├── offset.py
|   |   |   ├── pathpatch3d.py
|   |   |   ├── polys3d.py
|   |   |   ├── projections.py
|   |   |   ├── quiver3d.py
|   |   |   ├── rotate_axes3d_sgskip.py
|   |   |   ├── scatter3d.py
|   |   |   ├── stem3d_demo.py
|   |   |   ├── subplot3d.py
|   |   |   ├── surface3d.py
|   |   |   ├── surface3d_2.py
|   |   |   ├── surface3d_3.py
|   |   |   ├── surface3d_radial.py
|   |   |   ├── text3d.py
|   |   |   ├── tricontour3d.py
|   |   |   ├── tricontourf3d.py
|   |   |   ├── trisurf3d.py
|   |   |   ├── trisurf3d_2.py
|   |   |   ├── view_planes_3d.py
|   |   |   ├── voxels.py
|   |   |   ├── voxels_numpy_logo.py
|   |   |   ├── voxels_rgb.py
|   |   |   ├── voxels_torus.py
|   |   |   ├── wire3d.py
|   |   |   ├── wire3d_animation_sgskip.py
|   |   |   └── wire3d_zero_stride.py
|   |   ├── pie_and_polar_charts
|   |   |   ├── README.txt
|   |   |   ├── bar_of_pie.py
|   |   |   ├── nested_pie.py
|   |   |   ├── pie_and_donut_labels.py
|   |   |   ├── pie_demo2.py
|   |   |   ├── pie_features.py
|   |   |   ├── polar_bar.py
|   |   |   ├── polar_demo.py
|   |   |   ├── polar_error_caps.py
|   |   |   ├── polar_legend.py
|   |   |   └── polar_scatter.py
|   |   ├── pyplots
|   |   |   ├── README.txt
|   |   |   ├── axline.py
|   |   |   ├── pyplot_simple.py
|   |   |   ├── pyplot_text.py
|   |   |   ├── pyplot_three.py
|   |   |   └── pyplot_two_subplots.py
|   |   ├── scales
|   |   |   ├── README.txt
|   |   |   ├── asinh_demo.py
|   |   |   ├── aspect_loglog.py
|   |   |   ├── custom_scale.py
|   |   |   ├── log_bar.py
|   |   |   ├── log_demo.py
|   |   |   ├── logit_demo.py
|   |   |   ├── power_norm.py
|   |   |   ├── scales.py
|   |   |   ├── semilogx_demo.py
|   |   |   └── symlog_demo.py
|   |   ├── shapes_and_collections
|   |   |   ├── README.txt
|   |   |   ├── arrow_guide.py
|   |   |   ├── artist_reference.py
|   |   |   ├── collections.py
|   |   |   ├── compound_path.py
|   |   |   ├── dolphin.py
|   |   |   ├── donut.py
|   |   |   ├── ellipse_collection.py
|   |   |   ├── ellipse_demo.py
|   |   |   ├── fancybox_demo.py
|   |   |   ├── hatch_demo.py
|   |   |   ├── hatch_style_reference.py
|   |   |   ├── line_collection.py
|   |   |   ├── patch_collection.py
|   |   |   ├── path_patch.py
|   |   |   ├── quad_bezier.py
|   |   |   └── scatter.py
|   |   ├── showcase
|   |   |   ├── README.txt
|   |   |   ├── anatomy.py
|   |   |   ├── firefox.py
|   |   |   ├── integral.py
|   |   |   ├── mandelbrot.py
|   |   |   ├── stock_prices.py
|   |   |   └── xkcd.py
|   |   ├── specialty_plots
|   |   |   ├── README.txt
|   |   |   ├── advanced_hillshading.py
|   |   |   ├── anscombe.py
|   |   |   ├── hinton_demo.py
|   |   |   ├── leftventricle_bullseye.py
|   |   |   ├── mri_demo.py
|   |   |   ├── mri_with_eeg.py
|   |   |   ├── radar_chart.py
|   |   |   ├── sankey_basics.py
|   |   |   ├── sankey_links.py
|   |   |   ├── sankey_rankine.py
|   |   |   ├── skewt.py
|   |   |   └── topographic_hillshading.py
|   |   ├── spines
|   |   |   ├── README.txt
|   |   |   ├── centered_spines_with_arrows.py
|   |   |   ├── multiple_yaxis_with_spines.py
|   |   |   ├── spine_placement_demo.py
|   |   |   ├── spines.py
|   |   |   └── spines_dropped.py
|   |   ├── statistics
|   |   |   ├── README.txt
|   |   |   ├── barchart_demo.py
|   |   |   ├── boxplot.py
|   |   |   ├── boxplot_color.py
|   |   |   ├── boxplot_demo.py
|   |   |   ├── boxplot_vs_violin.py
|   |   |   ├── bxp.py
|   |   |   ├── confidence_ellipse.py
|   |   |   ├── customized_violin.py
|   |   |   ├── errorbar.py
|   |   |   ├── errorbar_features.py
|   |   |   ├── errorbar_limits.py
|   |   |   ├── errorbars_and_boxes.py
|   |   |   ├── hexbin_demo.py
|   |   |   ├── hist.py
|   |   |   ├── histogram_cumulative.py
|   |   |   ├── histogram_features.py
|   |   |   ├── histogram_histtypes.py
|   |   |   ├── histogram_multihist.py
|   |   |   ├── multiple_histograms_side_by_side.py
|   |   |   ├── time_series_histogram.py
|   |   |   └── violinplot.py
|   |   ├── style_sheets
|   |   |   ├── README.txt
|   |   |   ├── bmh.py
|   |   |   ├── dark_background.py
|   |   |   ├── fivethirtyeight.py
|   |   |   ├── ggplot.py
|   |   |   ├── grayscale.py
|   |   |   ├── plot_solarizedlight2.py
|   |   |   └── style_sheets_reference.py
|   |   ├── subplots_axes_and_figures
|   |   |   ├── README.txt
|   |   |   ├── align_labels_demo.py
|   |   |   ├── auto_subplots_adjust.py
|   |   |   ├── axes_box_aspect.py
|   |   |   ├── axes_demo.py
|   |   |   ├── axes_margins.py
|   |   |   ├── axes_props.py
|   |   |   ├── axes_zoom_effect.py
|   |   |   ├── axhspan_demo.py
|   |   |   ├── axis_equal_demo.py
|   |   |   ├── axis_labels_demo.py
|   |   |   ├── broken_axis.py
|   |   |   ├── colorbar_placement.py
|   |   |   ├── custom_figure_class.py
|   |   |   ├── demo_constrained_layout.py
|   |   |   ├── demo_tight_layout.py
|   |   |   ├── fahrenheit_celsius_scales.py
|   |   |   ├── figure_size_units.py
|   |   |   ├── figure_title.py
|   |   |   ├── ganged_plots.py
|   |   |   ├── geo_demo.py
|   |   |   ├── gridspec_and_subplots.py
|   |   |   ├── gridspec_multicolumn.py
|   |   |   ├── gridspec_nested.py
|   |   |   ├── invert_axes.py
|   |   |   ├── mosaic.py
|   |   |   ├── multiple_figs_demo.py
|   |   |   ├── secondary_axis.py
|   |   |   ├── share_axis_lims_views.py
|   |   |   ├── shared_axis_demo.py
|   |   |   ├── subfigures.py
|   |   |   ├── subplot.py
|   |   |   ├── subplots_adjust.py
|   |   |   ├── subplots_demo.py
|   |   |   ├── two_scales.py
|   |   |   └── zoom_inset_axes.py
|   |   ├── text_labels_and_annotations
|   |   |   ├── README.txt
|   |   |   ├── accented_text.py
|   |   |   ├── align_ylabels.py
|   |   |   ├── angle_annotation.py
|   |   |   ├── angles_on_bracket_arrows.py
|   |   |   ├── annotate_transform.py
|   |   |   ├── annotation_basic.py
|   |   |   ├── annotation_demo.py
|   |   |   ├── annotation_polar.py
|   |   |   ├── arrow_demo.py
|   |   |   ├── autowrap.py
|   |   |   ├── custom_legends.py
|   |   |   ├── date.py
|   |   |   ├── demo_annotation_box.py
|   |   |   ├── demo_text_path.py
|   |   |   ├── demo_text_rotation_mode.py
|   |   |   ├── dfrac_demo.py
|   |   |   ├── engineering_formatter.py
|   |   |   ├── fancyarrow_demo.py
|   |   |   ├── fancytextbox_demo.py
|   |   |   ├── figlegend_demo.py
|   |   |   ├── font_family_rc.py
|   |   |   ├── font_file.py
|   |   |   ├── font_table.py
|   |   |   ├── fonts_demo.py
|   |   |   ├── fonts_demo_kw.py
|   |   |   ├── label_subplots.py
|   |   |   ├── legend.py
|   |   |   ├── legend_demo.py
|   |   |   ├── line_with_text.py
|   |   |   ├── mathtext_asarray.py
|   |   |   ├── mathtext_demo.py
|   |   |   ├── mathtext_examples.py
|   |   |   ├── mathtext_fontfamily_example.py
|   |   |   ├── multiline.py
|   |   |   ├── placing_text_boxes.py
|   |   |   ├── rainbow_text.py
|   |   |   ├── stix_fonts_demo.py
|   |   |   ├── tex_demo.py
|   |   |   ├── text_alignment.py
|   |   |   ├── text_commands.py
|   |   |   ├── text_fontdict.py
|   |   |   ├── text_rotation_relative_to_line.py
|   |   |   ├── titles_demo.py
|   |   |   ├── unicode_minus.py
|   |   |   ├── usetex_baseline_test.py
|   |   |   ├── usetex_fonteffects.py
|   |   |   └── watermark_text.py
|   |   ├── ticks
|   |   |   ├── README.txt
|   |   |   ├── auto_ticks.py
|   |   |   ├── centered_ticklabels.py
|   |   |   ├── colorbar_tick_labelling_demo.py
|   |   |   ├── custom_ticker1.py
|   |   |   ├── date_concise_formatter.py
|   |   |   ├── date_demo_convert.py
|   |   |   ├── date_demo_rrule.py
|   |   |   ├── date_formatters_locators.py
|   |   |   ├── date_index_formatter.py
|   |   |   ├── date_precision_and_epochs.py
|   |   |   ├── dollar_ticks.py
|   |   |   ├── fig_axes_customize_simple.py
|   |   |   ├── major_minor_demo.py
|   |   |   ├── scalarformatter.py
|   |   |   ├── tick-formatters.py
|   |   |   ├── tick-locators.py
|   |   |   ├── tick_label_right.py
|   |   |   ├── tick_labels_from_values.py
|   |   |   ├── tick_xlabel_top.py
|   |   |   ├── ticklabels_rotation.py
|   |   |   └── ticks_too_many.py
|   |   ├── units
|   |   |   ├── README.txt
|   |   |   ├── annotate_with_units.py
|   |   |   ├── artist_tests.py
|   |   |   ├── bar_demo2.py
|   |   |   ├── bar_unit_demo.py
|   |   |   ├── basic_units.py
|   |   |   ├── ellipse_with_units.py
|   |   |   ├── evans_test.py
|   |   |   ├── radian_demo.py
|   |   |   ├── units_sample.py
|   |   |   └── units_scatter.py
|   |   ├── user_interfaces
|   |   |   ├── README.txt
|   |   |   ├── canvasagg.py
|   |   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk3_sgskip.py
|   |   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk4_sgskip.py
|   |   |   ├── embedding_in_qt_sgskip.py
|   |   |   ├── embedding_in_tk_sgskip.py
|   |   |   ├── embedding_in_wx2_sgskip.py
|   |   |   ├── embedding_in_wx3_sgskip.py
|   |   |   ├── embedding_in_wx4_sgskip.py
|   |   |   ├── embedding_in_wx5_sgskip.py
|   |   |   ├── embedding_webagg_sgskip.py
|   |   |   ├── fourier_demo_wx_sgskip.py
|   |   |   ├── gtk3_spreadsheet_sgskip.py
|   |   |   ├── gtk4_spreadsheet_sgskip.py
|   |   |   ├── images
|   |   |   ├── mathtext_wx_sgskip.py
|   |   |   ├── mpl_with_glade3_sgskip.py
|   |   |   ├── mplcvd.py
|   |   |   ├── pylab_with_gtk3_sgskip.py
|   |   |   ├── pylab_with_gtk4_sgskip.py
|   |   |   ├── svg_histogram_sgskip.py
|   |   |   ├── svg_tooltip_sgskip.py
|   |   |   ├── toolmanager_sgskip.py
|   |   |   ├── web_application_server_sgskip.py
|   |   |   └── wxcursor_demo_sgskip.py
|   |   ├── userdemo
|   |   |   ├── README.txt
|   |   |   ├── annotate_explain.py
|   |   |   ├── annotate_simple_coord02.py
|   |   |   ├── annotate_text_arrow.py
|   |   |   ├── connect_simple01.py
|   |   |   ├── connectionstyle_demo.py
|   |   |   ├── custom_boxstyle01.py
|   |   |   ├── demo_gridspec01.py
|   |   |   ├── demo_gridspec03.py
|   |   |   ├── demo_gridspec06.py
|   |   |   ├── pgf_fonts.py
|   |   |   ├── pgf_preamble_sgskip.py
|   |   |   ├── pgf_texsystem.py
|   |   |   ├── simple_annotate01.py
|   |   |   ├── simple_legend01.py
|   |   |   └── simple_legend02.py
|   |   └── widgets
|   |       ├── README.txt
|   |       ├── annotated_cursor.py
|   |       ├── buttons.py
|   |       ├── check_buttons.py
|   |       ├── cursor.py
|   |       ├── lasso_selector_demo_sgskip.py
|   |       ├── menu.py
|   |       ├── mouse_cursor.py
|   |       ├── multicursor.py
|   |       ├── polygon_selector_demo.py
|   |       ├── polygon_selector_simple.py
|   |       ├── radio_buttons.py
|   |       ├── range_slider.py
|   |       ├── rectangle_selector.py
|   |       ├── slider_demo.py
|   |       ├── slider_snap_demo.py
|   |       ├── span_selector.py
|   |       └── textbox.py
|   ├── plot_types
|   |   ├── 3D
|   |   |   ├── README.rst
|   |   |   ├── scatter3d_simple.py
|   |   |   ├── surface3d_simple.py
|   |   |   ├── trisurf3d_simple.py
|   |   |   ├── voxels_simple.py
|   |   |   └── wire3d_simple.py
|   |   ├── README.rst
|   |   ├── arrays
|   |   |   ├── README.rst
|   |   |   ├── barbs.py
|   |   |   ├── contour.py
|   |   |   ├── contourf.py
|   |   |   ├── imshow.py
|   |   |   ├── pcolormesh.py
|   |   |   ├── quiver.py
|   |   |   └── streamplot.py
|   |   ├── basic
|   |   |   ├── README.rst
|   |   |   ├── bar.py
|   |   |   ├── fill_between.py
|   |   |   ├── plot.py
|   |   |   ├── scatter_plot.py
|   |   |   ├── stackplot.py
|   |   |   ├── stem.py
|   |   |   └── step.py
|   |   ├── stats
|   |   |   ├── README.rst
|   |   |   ├── boxplot_plot.py
|   |   |   ├── errorbar_plot.py
|   |   |   ├── eventplot.py
|   |   |   ├── hexbin.py
|   |   |   ├── hist2d.py
|   |   |   ├── hist_plot.py
|   |   |   ├── pie.py
|   |   |   └── violin.py
|   |   └── unstructured
|   |       ├── README.rst
|   |       ├── tricontour.py
|   |       ├── tricontourf.py
|   |       ├── tripcolor.py
|   |       └── triplot.py
|   └── tutorials
|       ├── README.txt
|       ├── advanced
|       |   ├── README.txt
|       |   ├── blitting.py
|       |   ├── path_tutorial.py
|       |   ├── patheffects_guide.py
|       |   └── transforms_tutorial.py
|       ├── colors
|       |   ├── README.txt
|       |   ├── colorbar_only.py
|       |   ├── colormap-manipulation.py
|       |   ├── colormapnorms.py
|       |   ├── colormaps.py
|       |   └── colors.py
|       ├── intermediate
|       |   ├── README.txt
|       |   ├── arranging_axes.py
|       |   ├── artists.py
|       |   ├── autoscale.py
|       |   ├── color_cycle.py
|       |   ├── constrainedlayout_guide.py
|       |   ├── imshow_extent.py
|       |   ├── legend_guide.py
|       |   └── tight_layout_guide.py
|       ├── introductory
|       |   ├── README.txt
|       |   ├── animation_tutorial.py
|       |   ├── customizing.py
|       |   ├── images.py
|       |   ├── lifecycle.py
|       |   ├── pyplot.py
|       |   └── quick_start.py
|       ├── provisional
|       |   └── README.txt
|       ├── text
|       |   ├── README.txt
|       |   ├── annotations.py
|       |   ├── mathtext.py
|       |   ├── pgf.py
|       |   ├── text_intro.py
|       |   ├── text_props.py
|       |   └── usetex.py
|       └── toolkits
|           ├── README.txt
|           ├── axes_grid.py
|           ├── axisartist.py
|           └── mplot3d.py
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
└── tools
    ├── README.txt
    ├── boilerplate.py
    ├── cache_zenodo_svg.py
    ├── create_DejaVuDisplay.sh
    ├── embed_js.py
    ├── gh_api.py
    ├── github_stats.py
    ├── make_icons.py
    ├── memleak.py
    ├── run_examples.py
    ├── subset.py
    ├── triage_tests.py
    └── visualize_tests.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Unable to pickle figure with aligned labels

Description: ### Bug summary

 Unable to pickle figure after calling `align_labels()`

### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax1 = fig.add_subplot(211)
ax2 = fig.add_subplot(212)
time=[0,1,2,3,4]
speed=[40000,4300,4500,4700,4800]
acc=[10,11,12,13,14]
ax1.plot(time,speed)
ax1.set_ylabel('speed')
ax2.plot(time,acc)
ax2.set_ylabel('acc')

fig.align_labels() ##pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome
```
align.py", line 16
pickle.dumps(fig)
TypeError: cannot pickle 'weakref.ReferenceType' object
```
### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

None

Patch information:
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index b4c38368bf..6a57554d0c 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -3174,12 +3174,25 @@ None}, default: None
         from matplotlib import _pylab_helpers
         if self.canvas.manager in _pylab_helpers.Gcf.figs.values():
             state['_restore_to_pylab'] = True
+
+        # Serialize align label groups to avoid pickling weakrefs from Grouper
+        try:
+            state["_align_label_groups"] = {
+                name: [group for group in self._align_label_groups[name]]
+                for name in ("x", "y")
+            }
+        except Exception:
+            # Fallback to empty alignment info if serialization fails
+            state["_align_label_groups"] = {"x": [], "y": []}
         return state
 
     def __setstate__(self, state):
         version = state.pop('__mpl_version__')
         restore_to_pylab = state.pop('_restore_to_pylab', False)
 
+        # Extract serialized align label groups if present
+        serialized_align = state.pop("_align_label_groups", None)
+
         if version != mpl.__version__:
             _api.warn_external(
                 f"This figure was saved with matplotlib version {version} and "
@@ -3187,6 +3200,17 @@ None}, default: None
 
         self.__dict__ = state
 
+        # Rebuild align label groupers
+        self._align_label_groups = {"x": cbook.Grouper(), "y": cbook.Grouper()}
+        if serialized_align is not None:
+            for name in ("x", "y"):
+                groups = serialized_align.get(name, [])
+                for group in groups:
+                    # group is a list of Axes (or None if dead); filter Nones
+                    members = [m for m in group if m is not None]
+                    if len(members) > 1:
+                        self._align_label_groups[name].join(*members)
+
         # re-initialise some of the unstored state information
         FigureCanvasBase(self)  # Set self.canvas.
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of lib/matplotlib/tests/test_figure.py
Extra Requirements: 
Purpose: I need to find existing test cases for pickling figures and for the `align_labels` method to satisfy the user's request.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_figure.py
Line number range: 1 - 500
Content:
1. import copy
2. from datetime import datetime
3. import io
4. from pathlib import Path
5. import pickle
6. import platform
7. from threading import Timer
8. from types import SimpleNamespace
9. import warnings
10. 
11. import numpy as np
12. import pytest
13. from PIL import Image
14. 
15. import matplotlib as mpl
16. from matplotlib import gridspec
17. from matplotlib.testing.decorators import image_comparison, check_figures_equal
18. from matplotlib.axes import Axes
19. from matplotlib.figure import Figure, FigureBase
20. from matplotlib.layout_engine import (ConstrainedLayoutEngine,
21.                                       TightLayoutEngine,
22.                                       PlaceHolderLayoutEngine)
23. from matplotlib.ticker import AutoMinorLocator, FixedFormatter, ScalarFormatter
24. import matplotlib.pyplot as plt
25. import matplotlib.dates as mdates
26. 
27. 
28. @image_comparison(['figure_align_labels'], extensions=['png', 'svg'],
29.                   tol=0 if platform.machine() == 'x86_64' else 0.01)
30. def test_align_labels():
31.     fig = plt.figure(layout='tight')
32.     gs = gridspec.GridSpec(3, 3)
33. 
34.     ax = fig.add_subplot(gs[0, :2])
35.     ax.plot(np.arange(0, 1e6, 1000))
36.     ax.set_ylabel('Ylabel0 0')
37.     ax = fig.add_subplot(gs[0, -1])
38.     ax.plot(np.arange(0, 1e4, 100))
39. 
40.     for i in range(3):
41.         ax = fig.add_subplot(gs[1, i])
42.         ax.set_ylabel('YLabel1 %d' % i)
43.         ax.set_xlabel('XLabel1 %d' % i)
44.         if i in [0, 2]:
45.             ax.xaxis.set_label_position("top")
46.             ax.xaxis.tick_top()
47.         if i == 0:
48.             for tick in ax.get_xticklabels():
49.                 tick.set_rotation(90)
50.         if i == 2:
51.             ax.yaxis.set_label_position("right")
52.             ax.yaxis.tick_right()
53. 
54.     for i in range(3):
55.         ax = fig.add_subplot(gs[2, i])
56.         ax.set_xlabel(f'XLabel2 {i}')
57.         ax.set_ylabel(f'YLabel2 {i}')
58. 
59.         if i == 2:
60.             ax.plot(np.arange(0, 1e4, 10))
61.             ax.yaxis.set_label_position("right")
62.             ax.yaxis.tick_right()
63.             for tick in ax.get_xticklabels():
64.                 tick.set_rotation(90)
65. 
66.     fig.align_labels()
67. 
68. 
69. def test_align_labels_stray_axes():
70.     fig, axs = plt.subplots(2, 2)
71.     for nn, ax in enumerate(axs.flat):
72.         ax.set_xlabel('Boo')
73.         ax.set_xlabel('Who')
74.         ax.plot(np.arange(4)**nn, np.arange(4)**nn)
75.     fig.align_ylabels()
76.     fig.align_xlabels()
77.     fig.draw_without_rendering()
78.     xn = np.zeros(4)
79.     yn = np.zeros(4)
80.     for nn, ax in enumerate(axs.flat):
81.         yn[nn] = ax.xaxis.label.get_position()[1]
82.         xn[nn] = ax.yaxis.label.get_position()[0]
83.     np.testing.assert_allclose(xn[:2], xn[2:])
84.     np.testing.assert_allclose(yn[::2], yn[1::2])
85. 
86.     fig, axs = plt.subplots(2, 2, constrained_layout=True)
87.     for nn, ax in enumerate(axs.flat):
88.         ax.set_xlabel('Boo')
89.         ax.set_xlabel('Who')
90.         pc = ax.pcolormesh(np.random.randn(10, 10))
91.     fig.colorbar(pc, ax=ax)
92.     fig.align_ylabels()
93.     fig.align_xlabels()
94.     fig.draw_without_rendering()
95.     xn = np.zeros(4)
96.     yn = np.zeros(4)
97.     for nn, ax in enumerate(axs.flat):
98.         yn[nn] = ax.xaxis.label.get_position()[1]
99.         xn[nn] = ax.yaxis.label.get_position()[0]
100.     np.testing.assert_allclose(xn[:2], xn[2:])
101.     np.testing.assert_allclose(yn[::2], yn[1::2])
102. 
103. 
104. def test_figure_label():
105.     # pyplot figure creation, selection, and closing with label/number/instance
106.     plt.close('all')
107.     fig_today = plt.figure('today')
108.     plt.figure(3)
109.     plt.figure('tomorrow')
110.     plt.figure()
111.     plt.figure(0)
112.     plt.figure(1)
113.     plt.figure(3)
114.     assert plt.get_fignums() == [0, 1, 3, 4, 5]
115.     assert plt.get_figlabels() == ['', 'today', '', 'tomorrow', '']
116.     plt.close(10)
117.     plt.close()
118.     plt.close(5)
119.     plt.close('tomorrow')
120.     assert plt.get_fignums() == [0, 1]
121.     assert plt.get_figlabels() == ['', 'today']
122.     plt.figure(fig_today)
123.     assert plt.gcf() == fig_today
124.     with pytest.raises(ValueError):
125.         plt.figure(Figure())
126. 
127. 
128. def test_fignum_exists():
129.     # pyplot figure creation, selection and closing with fignum_exists
130.     plt.figure('one')
131.     plt.figure(2)
132.     plt.figure('three')
133.     plt.figure()
134.     assert plt.fignum_exists('one')
135.     assert plt.fignum_exists(2)
136.     assert plt.fignum_exists('three')
137.     assert plt.fignum_exists(4)
138.     plt.close('one')
139.     plt.close(4)
140.     assert not plt.fignum_exists('one')
141.     assert not plt.fignum_exists(4)
142. 
143. 
144. def test_clf_keyword():
145.     # test if existing figure is cleared with figure() and subplots()
146.     text1 = 'A fancy plot'
147.     text2 = 'Really fancy!'
148. 
149.     fig0 = plt.figure(num=1)
150.     fig0.suptitle(text1)
151.     assert [t.get_text() for t in fig0.texts] == [text1]
152. 
153.     fig1 = plt.figure(num=1, clear=False)
154.     fig1.text(0.5, 0.5, text2)
155.     assert fig0 is fig1
156.     assert [t.get_text() for t in fig1.texts] == [text1, text2]
157. 
158.     fig2, ax2 = plt.subplots(2, 1, num=1, clear=True)
159.     assert fig0 is fig2
160.     assert [t.get_text() for t in fig2.texts] == []
161. 
162. 
163. @image_comparison(['figure_today'])
164. def test_figure():
165.     # named figure support
166.     fig = plt.figure('today')
167.     ax = fig.add_subplot()
168.     ax.set_title(fig.get_label())
169.     ax.plot(np.arange(5))
170.     # plot red line in a different figure.
171.     plt.figure('tomorrow')
172.     plt.plot([0, 1], [1, 0], 'r')
173.     # Return to the original; make sure the red line is not there.
174.     plt.figure('today')
175.     plt.close('tomorrow')
176. 
177. 
178. @image_comparison(['figure_legend'])
179. def test_figure_legend():
180.     fig, axs = plt.subplots(2)
181.     axs[0].plot([0, 1], [1, 0], label='x', color='g')
182.     axs[0].plot([0, 1], [0, 1], label='y', color='r')
183.     axs[0].plot([0, 1], [0.5, 0.5], label='y', color='k')
184. 
185.     axs[1].plot([0, 1], [1, 0], label='_y', color='r')
186.     axs[1].plot([0, 1], [0, 1], label='z', color='b')
187.     fig.legend()
188. 
189. 
190. def test_gca():
191.     fig = plt.figure()
192. 
193.     # test that gca() picks up Axes created via add_axes()
194.     ax0 = fig.add_axes([0, 0, 1, 1])
195.     assert fig.gca() is ax0
196. 
197.     # test that gca() picks up Axes created via add_subplot()
198.     ax1 = fig.add_subplot(111)
199.     assert fig.gca() is ax1
200. 
201.     # add_axes on an existing Axes should not change stored order, but will
202.     # make it current.
203.     fig.add_axes(ax0)
204.     assert fig.axes == [ax0, ax1]
205.     assert fig.gca() is ax0
206. 
207.     # sca() should not change stored order of Axes, which is order added.
208.     fig.sca(ax0)
209.     assert fig.axes == [ax0, ax1]
210. 
211.     # add_subplot on an existing Axes should not change stored order, but will
212.     # make it current.
213.     fig.add_subplot(ax1)
214.     assert fig.axes == [ax0, ax1]
215.     assert fig.gca() is ax1
216. 
217. 
218. def test_add_subplot_subclass():
219.     fig = plt.figure()
220.     fig.add_subplot(axes_class=Axes)
221.     with pytest.raises(ValueError):
222.         fig.add_subplot(axes_class=Axes, projection="3d")
223.     with pytest.raises(ValueError):
224.         fig.add_subplot(axes_class=Axes, polar=True)
225.     with pytest.raises(ValueError):
226.         fig.add_subplot(projection="3d", polar=True)
227.     with pytest.raises(TypeError):
228.         fig.add_subplot(projection=42)
229. 
230. 
231. def test_add_subplot_invalid():
232.     fig = plt.figure()
233.     with pytest.raises(ValueError,
234.                        match='Number of columns must be a positive integer'):
235.         fig.add_subplot(2, 0, 1)
236.     with pytest.raises(ValueError,
237.                        match='Number of rows must be a positive integer'):
238.         fig.add_subplot(0, 2, 1)
239.     with pytest.raises(ValueError, match='num must be an integer with '
240.                                          '1 <= num <= 4'):
241.         fig.add_subplot(2, 2, 0)
242.     with pytest.raises(ValueError, match='num must be an integer with '
243.                                          '1 <= num <= 4'):
244.         fig.add_subplot(2, 2, 5)
245.     with pytest.raises(ValueError, match='num must be an integer with '
246.                                          '1 <= num <= 4'):
247.         fig.add_subplot(2, 2, 0.5)
248. 
249.     with pytest.raises(ValueError, match='must be a three-digit integer'):
250.         fig.add_subplot(42)
251.     with pytest.raises(ValueError, match='must be a three-digit integer'):
252.         fig.add_subplot(1000)
253. 
254.     with pytest.raises(TypeError, match='takes 1 or 3 positional arguments '
255.                                         'but 2 were given'):
256.         fig.add_subplot(2, 2)
257.     with pytest.raises(TypeError, match='takes 1 or 3 positional arguments '
258.                                         'but 4 were given'):
259.         fig.add_subplot(1, 2, 3, 4)
260.     with pytest.raises(ValueError,
261.                        match="Number of rows must be a positive integer, "
262.                              "not '2'"):
263.         fig.add_subplot('2', 2, 1)
264.     with pytest.raises(ValueError,
265.                        match='Number of columns must be a positive integer, '
266.                              'not 2.0'):
267.         fig.add_subplot(2, 2.0, 1)
268.     _, ax = plt.subplots()
269.     with pytest.raises(ValueError,
270.                        match='The Axes must have been created in the '
271.                              'present figure'):
272.         fig.add_subplot(ax)
273. 
274. 
275. @image_comparison(['figure_suptitle'])
276. def test_suptitle():
277.     fig, _ = plt.subplots()
278.     fig.suptitle('hello', color='r')
279.     fig.suptitle('title', color='g', rotation=30)
280. 
281. 
282. def test_suptitle_fontproperties():
283.     fig, ax = plt.subplots()
284.     fps = mpl.font_manager.FontProperties(size='large', weight='bold')
285.     txt = fig.suptitle('fontprops title', fontproperties=fps)
286.     assert txt.get_fontsize() == fps.get_size_in_points()
287.     assert txt.get_weight() == fps.get_weight()
288. 
289. 
290. def test_suptitle_subfigures():
291.     fig = plt.figure(figsize=(4, 3))
292.     sf1, sf2 = fig.subfigures(1, 2)
293.     sf2.set_facecolor('white')
294.     sf1.subplots()
295.     sf2.subplots()
296.     fig.suptitle("This is a visible suptitle.")
297. 
298.     # verify the first subfigure facecolor is the default transparent
299.     assert sf1.get_facecolor() == (0.0, 0.0, 0.0, 0.0)
300.     # verify the second subfigure facecolor is white
301.     assert sf2.get_facecolor() == (1.0, 1.0, 1.0, 1.0)
302. 
303. 
304. @image_comparison(['alpha_background'],
305.                   # only test png and svg. The PDF output appears correct,
306.                   # but Ghostscript does not preserve the background color.
307.                   extensions=['png', 'svg'],
308.                   savefig_kwarg={'facecolor': (0, 1, 0.4),
309.                                  'edgecolor': 'none'})
310. def test_alpha():
311.     # We want an image which has a background color and an alpha of 0.4.
312.     fig = plt.figure(figsize=[2, 1])
313.     fig.set_facecolor((0, 1, 0.4))
314.     fig.patch.set_alpha(0.4)
315.     fig.patches.append(mpl.patches.CirclePolygon(
316.         [20, 20], radius=15, alpha=0.6, facecolor='red'))
317. 
318. 
319. def test_too_many_figures():
320.     with pytest.warns(RuntimeWarning):
321.         for i in range(mpl.rcParams['figure.max_open_warning'] + 1):
322.             plt.figure()
323. 
324. 
325. def test_iterability_axes_argument():
326. 
327.     # This is a regression test for matplotlib/matplotlib#3196. If one of the
328.     # arguments returned by _as_mpl_axes defines __getitem__ but is not
329.     # iterable, this would raise an exception. This is because we check
330.     # whether the arguments are iterable, and if so we try and convert them
331.     # to a tuple. However, the ``iterable`` function returns True if
332.     # __getitem__ is present, but some classes can define __getitem__ without
333.     # being iterable. The tuple conversion is now done in a try...except in
334.     # case it fails.
335. 
336.     class MyAxes(Axes):
337.         def __init__(self, *args, myclass=None, **kwargs):
338.             Axes.__init__(self, *args, **kwargs)
339. 
340.     class MyClass:
341. 
342.         def __getitem__(self, item):
343.             if item != 'a':
344.                 raise ValueError("item should be a")
345. 
346.         def _as_mpl_axes(self):
347.             return MyAxes, {'myclass': self}
348. 
349.     fig = plt.figure()
350.     fig.add_subplot(1, 1, 1, projection=MyClass())
351.     plt.close(fig)
352. 
353. 
354. def test_set_fig_size():
355.     fig = plt.figure()
356. 
357.     # check figwidth
358.     fig.set_figwidth(5)
359.     assert fig.get_figwidth() == 5
360. 
361.     # check figheight
362.     fig.set_figheight(1)
363.     assert fig.get_figheight() == 1
364. 
365.     # check using set_size_inches
366.     fig.set_size_inches(2, 4)
367.     assert fig.get_figwidth() == 2
368.     assert fig.get_figheight() == 4
369. 
370.     # check using tuple to first argument
371.     fig.set_size_inches((1, 3))
372.     assert fig.get_figwidth() == 1
373.     assert fig.get_figheight() == 3
374. 
375. 
376. def test_axes_remove():
377.     fig, axs = plt.subplots(2, 2)
378.     axs[-1, -1].remove()
379.     for ax in axs.ravel()[:-1]:
380.         assert ax in fig.axes
381.     assert axs[-1, -1] not in fig.axes
382.     assert len(fig.axes) == 3
383. 
384. 
385. def test_figaspect():
386.     w, h = plt.figaspect(np.float64(2) / np.float64(1))
387.     assert h / w == 2
388.     w, h = plt.figaspect(2)
389.     assert h / w == 2
390.     w, h = plt.figaspect(np.zeros((1, 2)))
391.     assert h / w == 0.5
392.     w, h = plt.figaspect(np.zeros((2, 2)))
393.     assert h / w == 1
394. 
395. 
396. @pytest.mark.parametrize('which', ['both', 'major', 'minor'])
397. def test_autofmt_xdate(which):
398.     date = ['3 Jan 2013', '4 Jan 2013', '5 Jan 2013', '6 Jan 2013',
399.             '7 Jan 2013', '8 Jan 2013', '9 Jan 2013', '10 Jan 2013',
400.             '11 Jan 2013', '12 Jan 2013', '13 Jan 2013', '14 Jan 2013']
401. 
402.     time = ['16:44:00', '16:45:00', '16:46:00', '16:47:00', '16:48:00',
403.             '16:49:00', '16:51:00', '16:52:00', '16:53:00', '16:55:00',
404.             '16:56:00', '16:57:00']
405. 
406.     angle = 60
407.     minors = [1, 2, 3, 4, 5, 6, 7]
408. 
409.     x = mdates.datestr2num(date)
410.     y = mdates.datestr2num(time)
411. 
412.     fig, ax = plt.subplots()
413. 
414.     ax.plot(x, y)
415.     ax.yaxis_date()
416.     ax.xaxis_date()
417. 
418.     ax.xaxis.set_minor_locator(AutoMinorLocator(2))
419.     with warnings.catch_warnings():
420.         warnings.filterwarnings(
421.             'ignore',
422.             'FixedFormatter should only be used together with FixedLocator')
423.         ax.xaxis.set_minor_formatter(FixedFormatter(minors))
424. 
425.     fig.autofmt_xdate(0.2, angle, 'right', which)
426. 
427.     if which in ('both', 'major'):
428.         for label in fig.axes[0].get_xticklabels(False, 'major'):
429.             assert int(label.get_rotation()) == angle
430. 
431.     if which in ('both', 'minor'):
432.         for label in fig.axes[0].get_xticklabels(True, 'minor'):
433.             assert int(label.get_rotation()) == angle
434. 
435. 
436. @mpl.style.context('default')
437. def test_change_dpi():
438.     fig = plt.figure(figsize=(4, 4))
439.     fig.draw_without_rendering()
440.     assert fig.canvas.renderer.height == 400
441.     assert fig.canvas.renderer.width == 400
442.     fig.dpi = 50
443.     fig.draw_without_rendering()
444.     assert fig.canvas.renderer.height == 200
445.     assert fig.canvas.renderer.width == 200
446. 
447. 
448. @pytest.mark.parametrize('width, height', [
449.     (1, np.nan),
450.     (-1, 1),
451.     (np.inf, 1)
452. ])
453. def test_invalid_figure_size(width, height):
454.     with pytest.raises(ValueError):
455.         plt.figure(figsize=(width, height))
456. 
457.     fig = plt.figure()
458.     with pytest.raises(ValueError):
459.         fig.set_size_inches(width, height)
460. 
461. 
462. def test_invalid_figure_add_axes():
463.     fig = plt.figure()
464.     with pytest.raises(TypeError,
465.                        match="missing 1 required positional argument: 'rect'"):
466.         fig.add_axes()
467. 
468.     with pytest.raises(ValueError):
469.         fig.add_axes((.1, .1, .5, np.nan))
470. 
471.     with pytest.raises(TypeError, match="multiple values for argument 'rect'"):
472.         fig.add_axes([0, 0, 1, 1], rect=[0, 0, 1, 1])
473. 
474.     _, ax = plt.subplots()
475.     with pytest.raises(ValueError,
476.                        match="The Axes must have been created in the present "
477.                              "figure"):
478.         fig.add_axes(ax)
479. 
480. 
481. def test_subplots_shareax_loglabels():
482.     fig, axs = plt.subplots(2, 2, sharex=True, sharey=True, squeeze=False)
483.     for ax in axs.flat:
484.         ax.plot([10, 20, 30], [10, 20, 30])
485. 
486.     ax.set_yscale("log")
487.     ax.set_xscale("log")
488. 
489.     for ax in axs[0, :]:
490.         assert 0 == len(ax.xaxis.get_ticklabels(which='both'))
491. 
492.     for ax in axs[1, :]:
493.         assert 0 < len(ax.xaxis.get_ticklabels(which='both'))
494. 
495.     for ax in axs[:, 1]:
496.         assert 0 == len(ax.yaxis.get_ticklabels(which='both'))
497. 
498.     for ax in axs[:, 0]:
499.         assert 0 < len(ax.yaxis.get_ticklabels(which='both'))
500. 


File: lib/matplotlib/tests/test_figure.py
Line number range: 1537 - 1542
Content:
1537. def test_unpickle_with_device_pixel_ratio():
1538.     fig = Figure(dpi=42)
1539.     fig.canvas._set_device_pixel_ratio(7)
1540.     assert fig.dpi == 42*7
1541.     fig2 = pickle.loads(pickle.dumps(fig))
1542.     assert fig2.dpi == 42

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 06:13:08,096 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants test cases related to pickling a matplotlib figure. The provided context from `test_figure.py` contains one pickling test and tests for `align_labels`, but does not contain a test that combines both, which is the scenario of the bug. The file `lib/matplotlib/tests/test_pickle.py` is likely to contain more extensive tests for pickling various matplotlib objects, including Figures, which would be highly relevant for finding analogous test cases.' query='Please provide the full content of lib/matplotlib/tests/test_pickle.py' extra_requirements='' purpose="I need to find more examples of how matplotlib figures are tested for pickling to find the most relevant examples for the user's bug report."
2025-12-21 06:13:08,097 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of lib/matplotlib/tests/test_pickle.py
2025-12-21 06:13:08,097 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 06:13:08,098 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 06:13:08,099 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 06:13:08,099 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of lib/matplotlib/tests/test_pickle.py
Purpose: I need to find more examples of how matplotlib figures are tested for pickling to find the most relevant examples for the user's bug report.
2025-12-21 06:13:10,293 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the full content of `lib/matplotlib/tests/test_pickle.py`. This will allow me to examine how matplotlib figures are tested for pickling and find the most relevant examples for the user's bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "lib/matplotlib/tests/test_pickle.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2139, 'candidates_token_count': 73, 'total_token_count': 2306, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2139}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 73}], 'thoughts_token_count': 94, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.12095711329211928, 'model_name': 'gemini-2.5-pro'} id='run--50bdb1d1-e61a-4e24-aa03-307bdfc70604-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'lib/matplotlib/tests/test_pickle.py'}, 'id': '0a45599f-085e-4083-b742-dec9da8137f8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2139, 'output_tokens': 73, 'total_tokens': 2306, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 94}}
2025-12-21 06:13:20,205 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `lib/matplotlib/tests/test_pickle.py` to find examples of how matplotlib figures are tested for pickling. I will now analyze the file to identify the most relevant examples for your bug report. I will then provide a summary of my findings.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 6188, 'candidates_token_count': 60, 'total_token_count': 7171, 'prompt_tokens_details': [{'modality': 1, 'token_count': 6188}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 60}], 'thoughts_token_count': 923, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.2129858652750651, 'model_name': 'gemini-2.5-pro'} id='run--6986fbae-114e-4e38-ac80-d77b048dd289-0' usage_metadata={'input_tokens': 6188, 'output_tokens': 60, 'total_tokens': 7171, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 923}}
2025-12-21 06:13:20,207 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of lib/matplotlib/tests/test_pickle.py
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find more examples of how matplotlib figures are tested for pickling to find the most relevant examples for the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: lib/matplotlib/tests/test_pickle.py
Line number range: 1 - 284
Content:
1. from io import BytesIO
2. import ast
3. import pickle
4. 
5. import numpy as np
6. import pytest
7. 
8. import matplotlib as mpl
9. from matplotlib import cm
10. from matplotlib.testing import subprocess_run_helper
11. from matplotlib.testing.decorators import check_figures_equal
12. from matplotlib.dates import rrulewrapper
13. from matplotlib.lines import VertexSelector
14. import matplotlib.pyplot as plt
15. import matplotlib.transforms as mtransforms
16. import matplotlib.figure as mfigure
17. from mpl_toolkits.axes_grid1 import parasite_axes
18. 
19. 
20. def test_simple():
21.     fig = plt.figure()
22.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
23. 
24.     ax = plt.subplot(121)
25.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
26. 
27.     ax = plt.axes(projection='polar')
28.     plt.plot(np.arange(10), label='foobar')
29.     plt.legend()
30. 
31.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
32. 
33. #    ax = plt.subplot(121, projection='hammer')
34. #    pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
35. 
36.     plt.figure()
37.     plt.bar(x=np.arange(10), height=np.arange(10))
38.     pickle.dump(plt.gca(), BytesIO(), pickle.HIGHEST_PROTOCOL)
39. 
40.     fig = plt.figure()
41.     ax = plt.axes()
42.     plt.plot(np.arange(10))
43.     ax.set_yscale('log')
44.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
45. 
46. 
47. def _generate_complete_test_figure(fig_ref):
48.     fig_ref.set_size_inches((10, 6))
49.     plt.figure(fig_ref)
50. 
51.     plt.suptitle('Can you fit any more in a figure?')
52. 
53.     # make some arbitrary data
54.     x, y = np.arange(8), np.arange(10)
55.     data = u = v = np.linspace(0, 10, 80).reshape(10, 8)
56.     v = np.sin(v * -0.6)
57. 
58.     # Ensure lists also pickle correctly.
59.     plt.subplot(3, 3, 1)
60.     plt.plot(list(range(10)))
61. 
62.     plt.subplot(3, 3, 2)
63.     plt.contourf(data, hatches=['//', 'ooo'])
64.     plt.colorbar()
65. 
66.     plt.subplot(3, 3, 3)
67.     plt.pcolormesh(data)
68. 
69.     plt.subplot(3, 3, 4)
70.     plt.imshow(data)
71. 
72.     plt.subplot(3, 3, 5)
73.     plt.pcolor(data)
74. 
75.     ax = plt.subplot(3, 3, 6)
76.     ax.set_xlim(0, 7)
77.     ax.set_ylim(0, 9)
78.     plt.streamplot(x, y, u, v)
79. 
80.     ax = plt.subplot(3, 3, 7)
81.     ax.set_xlim(0, 7)
82.     ax.set_ylim(0, 9)
83.     plt.quiver(x, y, u, v)
84. 
85.     plt.subplot(3, 3, 8)
86.     plt.scatter(x, x ** 2, label='$x^2$')
87.     plt.legend(loc='upper left')
88. 
89.     plt.subplot(3, 3, 9)
90.     plt.errorbar(x, x * -0.5, xerr=0.2, yerr=0.4)
91. 
92. 
93. @mpl.style.context("default")
94. @check_figures_equal(extensions=["png"])
95. def test_complete(fig_test, fig_ref):
96.     _generate_complete_test_figure(fig_ref)
97.     # plotting is done, now test its pickle-ability
98.     pkl = BytesIO()
99.     pickle.dump(fig_ref, pkl, pickle.HIGHEST_PROTOCOL)
100.     loaded = pickle.loads(pkl.getbuffer())
101.     loaded.canvas.draw()
102. 
103.     fig_test.set_size_inches(loaded.get_size_inches())
104.     fig_test.figimage(loaded.canvas.renderer.buffer_rgba())
105. 
106.     plt.close(loaded)
107. 
108. 
109. def _pickle_load_subprocess():
110.     import os
111.     import pickle
112. 
113.     path = os.environ['PICKLE_FILE_PATH']
114. 
115.     with open(path, 'rb') as blob:
116.         fig = pickle.load(blob)
117. 
118.     print(str(pickle.dumps(fig)))
119. 
120. 
121. @mpl.style.context("default")
122. @check_figures_equal(extensions=['png'])
123. def test_pickle_load_from_subprocess(fig_test, fig_ref, tmp_path):
124.     _generate_complete_test_figure(fig_ref)
125. 
126.     fp = tmp_path / 'sinus.pickle'
127.     assert not fp.exists()
128. 
129.     with fp.open('wb') as file:
130.         pickle.dump(fig_ref, file, pickle.HIGHEST_PROTOCOL)
131.     assert fp.exists()
132. 
133.     proc = subprocess_run_helper(
134.         _pickle_load_subprocess,
135.         timeout=60,
136.         extra_env={'PICKLE_FILE_PATH': str(fp)}
137.     )
138. 
139.     loaded_fig = pickle.loads(ast.literal_eval(proc.stdout))
140. 
141.     loaded_fig.canvas.draw()
142. 
143.     fig_test.set_size_inches(loaded_fig.get_size_inches())
144.     fig_test.figimage(loaded_fig.canvas.renderer.buffer_rgba())
145. 
146.     plt.close(loaded_fig)
147. 
148. 
149. def test_gcf():
150.     fig = plt.figure("a label")
151.     buf = BytesIO()
152.     pickle.dump(fig, buf, pickle.HIGHEST_PROTOCOL)
153.     plt.close("all")
154.     assert plt._pylab_helpers.Gcf.figs == {}  # No figures must be left.
155.     fig = pickle.loads(buf.getbuffer())
156.     assert plt._pylab_helpers.Gcf.figs != {}  # A manager is there again.
157.     assert fig.get_label() == "a label"
158. 
159. 
160. def test_no_pyplot():
161.     # tests pickle-ability of a figure not created with pyplot
162.     from matplotlib.backends.backend_pdf import FigureCanvasPdf
163.     fig = mfigure.Figure()
164.     _ = FigureCanvasPdf(fig)
165.     ax = fig.add_subplot(1, 1, 1)
166.     ax.plot([1, 2, 3], [1, 2, 3])
167.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
168. 
169. 
170. def test_renderer():
171.     from matplotlib.backends.backend_agg import RendererAgg
172.     renderer = RendererAgg(10, 20, 30)
173.     pickle.dump(renderer, BytesIO())
174. 
175. 
176. def test_image():
177.     # Prior to v1.4.0 the Image would cache data which was not picklable
178.     # once it had been drawn.
179.     from matplotlib.backends.backend_agg import new_figure_manager
180.     manager = new_figure_manager(1000)
181.     fig = manager.canvas.figure
182.     ax = fig.add_subplot(1, 1, 1)
183.     ax.imshow(np.arange(12).reshape(3, 4))
184.     manager.canvas.draw()
185.     pickle.dump(fig, BytesIO())
186. 
187. 
188. def test_polar():
189.     plt.subplot(polar=True)
190.     fig = plt.gcf()
191.     pf = pickle.dumps(fig)
192.     pickle.loads(pf)
193.     plt.draw()
194. 
195. 
196. class TransformBlob:
197.     def __init__(self):
198.         self.identity = mtransforms.IdentityTransform()
199.         self.identity2 = mtransforms.IdentityTransform()
200.         # Force use of the more complex composition.
201.         self.composite = mtransforms.CompositeGenericTransform(
202.             self.identity,
203.             self.identity2)
204.         # Check parent -> child links of TransformWrapper.
205.         self.wrapper = mtransforms.TransformWrapper(self.composite)
206.         # Check child -> parent links of TransformWrapper.
207.         self.composite2 = mtransforms.CompositeGenericTransform(
208.             self.wrapper,
209.             self.identity)
210. 
211. 
212. def test_transform():
213.     obj = TransformBlob()
214.     pf = pickle.dumps(obj)
215.     del obj
216. 
217.     obj = pickle.loads(pf)
218.     # Check parent -> child links of TransformWrapper.
219.     assert obj.wrapper._child == obj.composite
220.     # Check child -> parent links of TransformWrapper.
221.     assert [v() for v in obj.wrapper._parents.values()] == [obj.composite2]
222.     # Check input and output dimensions are set as expected.
223.     assert obj.wrapper.input_dims == obj.composite.input_dims
224.     assert obj.wrapper.output_dims == obj.composite.output_dims
225. 
226. 
227. def test_rrulewrapper():
228.     r = rrulewrapper(2)
229.     try:
230.         pickle.loads(pickle.dumps(r))
231.     except RecursionError:
232.         print('rrulewrapper pickling test failed')
233.         raise
234. 
235. 
236. def test_shared():
237.     fig, axs = plt.subplots(2, sharex=True)
238.     fig = pickle.loads(pickle.dumps(fig))
239.     fig.axes[0].set_xlim(10, 20)
240.     assert fig.axes[1].get_xlim() == (10, 20)
241. 
242. 
243. def test_inset_and_secondary():
244.     fig, ax = plt.subplots()
245.     ax.inset_axes([.1, .1, .3, .3])
246.     ax.secondary_xaxis("top", functions=(np.square, np.sqrt))
247.     pickle.loads(pickle.dumps(fig))
248. 
249. 
250. @pytest.mark.parametrize("cmap", cm._colormaps.values())
251. def test_cmap(cmap):
252.     pickle.dumps(cmap)
253. 
254. 
255. def test_unpickle_canvas():
256.     fig = mfigure.Figure()
257.     assert fig.canvas is not None
258.     out = BytesIO()
259.     pickle.dump(fig, out)
260.     out.seek(0)
261.     fig2 = pickle.load(out)
262.     assert fig2.canvas is not None
263. 
264. 
265. def test_mpl_toolkits():
266.     ax = parasite_axes.host_axes([0, 0, 1, 1])
267.     assert type(pickle.loads(pickle.dumps(ax))) == parasite_axes.HostAxes
268. 
269. 
270. def test_standard_norm():
271.     assert type(pickle.loads(pickle.dumps(mpl.colors.LogNorm()))) \
272.         == mpl.colors.LogNorm
273. 
274. 
275. def test_dynamic_norm():
276.     logit_norm_instance = mpl.colors.make_norm_from_scale(
277.         mpl.scale.LogitScale, mpl.colors.Normalize)()
278.     assert type(pickle.loads(pickle.dumps(logit_norm_instance))) \
279.         == type(logit_norm_instance)
280. 
281. 
282. def test_vertexselector():
283.     line, = plt.plot([0, 1], picker=True)
284.     pickle.loads(pickle.dumps(VertexSelector(line)))

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 06:13:26,718 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query specifically asks for the full content of the file `lib/matplotlib/tests/test_pickle.py`.\n\n2. Extended relevance:\n   - The provided context contains the entire content of the requested file, from line 1 to 284. Therefore, the entire file is relevant to fulfill the user's request.", relative_path='lib/matplotlib/tests/test_pickle.py', start_line=1, end_line=284)]
2025-12-21 06:13:26,719 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of lib/matplotlib/tests/test_pickle.py
2025-12-21 06:13:26,719 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 06:13:26,719 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 06:13:26,720 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 2 existing contexts
2025-12-21 06:13:26,720 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-21 06:13:26,721 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
matplotlib
├── .appveyor.yml
├── .circleci
|   ├── config.yml
|   ├── deploy-docs.sh
|   └── fetch_doc_logs.py
├── .git_archival.txt
├── .github
|   ├── CONTRIBUTING.md
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report.yml
|   |   ├── config.yml
|   |   ├── documentation.yml
|   |   ├── feature_request.yml
|   |   └── maintenance.yml
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── codecov.yml
|   ├── dependabot.yml
|   └── workflows
|       ├── cibuildsdist.yml
|       ├── cibuildwheel.yml
|       ├── circleci.yml
|       ├── clean_pr.yml
|       ├── codeql-analysis.yml
|       ├── conflictcheck.yml
|       ├── cygwin.yml
|       ├── nightlies.yml
|       ├── pr_welcome.yml
|       ├── reviewdog.yml
|       ├── stale.yml
|       └── tests.yml
├── .lgtm.yml
├── .meeseeksdev.yml
├── .pre-commit-config.yaml
├── CODE_OF_CONDUCT.md
├── INSTALL.rst
├── LICENSE
├── README.md
├── SECURITY.md
├── azure-pipelines.yml
├── ci
|   ├── check_version_number.py
|   ├── check_wheel_licenses.py
|   └── codespell-ignore-words.txt
├── doc
|   ├── README.txt
|   ├── _static
|   |   ├── fa
|   |   ├── markers
|   |   ├── mpl.css
|   |   └── zenodo_cache
|   ├── _templates
|   |   ├── autofunctions.rst
|   |   ├── automodule.rst
|   |   ├── autosummary.rst
|   |   ├── autosummary_class_only.rst
|   |   ├── cheatsheet_sidebar.html
|   |   ├── donate_sidebar.html
|   |   ├── function.rst
|   |   ├── pagesource.html
|   |   ├── search.html
|   |   ├── sidebar_announcement.html
|   |   └── sidebar_versions.html
|   ├── api
|   |   ├── _api_api.rst
|   |   ├── _enums_api.rst
|   |   ├── afm_api.rst
|   |   ├── animation_api.rst
|   |   ├── artist_api.rst
|   |   ├── axes_api.rst
|   |   ├── axis_api.rst
|   |   ├── backend_agg_api.rst
|   |   ├── backend_bases_api.rst
|   |   ├── backend_cairo_api.rst
|   |   ├── backend_gtk3_api.rst
|   |   ├── backend_gtk4_api.rst
|   |   ├── backend_managers_api.rst
|   |   ├── backend_mixed_api.rst
|   |   ├── backend_nbagg_api.rst
|   |   ├── backend_pdf_api.rst
|   |   ├── backend_pgf_api.rst
|   |   ├── backend_ps_api.rst
|   |   ├── backend_qt_api.rst
|   |   ├── backend_svg_api.rst
|   |   ├── backend_template_api.rst
|   |   ├── backend_tk_api.rst
|   |   ├── backend_tools_api.rst
|   |   ├── backend_webagg_api.rst
|   |   ├── backend_wx_api.rst
|   |   ├── bezier_api.rst
|   |   ├── category_api.rst
|   |   ├── cbook_api.rst
|   |   ├── cm_api.rst
|   |   ├── collections_api.rst
|   |   ├── colorbar_api.rst
|   |   ├── colors_api.rst
|   |   ├── container_api.rst
|   |   ├── contour_api.rst
|   |   ├── dates_api.rst
|   |   ├── docstring_api.rst
|   |   ├── dviread.rst
|   |   ├── figure_api.rst
|   |   ├── font_manager_api.rst
|   |   ├── ft2font.rst
|   |   ├── gridspec_api.rst
|   |   ├── hatch_api.rst
|   |   ├── image_api.rst
|   |   ├── index.rst
|   |   ├── index_backend_api.rst
|   |   ├── layout_engine_api.rst
|   |   ├── legend_api.rst
|   |   ├── legend_handler_api.rst
|   |   ├── lines_api.rst
|   |   ├── markers_api.rst
|   |   ├── mathtext_api.rst
|   |   ├── matplotlib_configuration_api.rst
|   |   ├── mlab_api.rst
|   |   ├── next_api_changes
|   |   |   ├── README.rst
|   |   |   ├── behavior
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 25061-DS.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   ├── 25112-GG.rst
|   |   |   |   ├── 25192-DS.rst
|   |   |   |   └── 25255-RR.rst
|   |   |   ├── deprecations
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   ├── 24913-AL.rst
|   |   |   |   ├── 24985-OG.rst
|   |   |   |   ├── 24990-OG.rst
|   |   |   |   ├── 25101-AL.rst
|   |   |   |   └── 25282-AL.rst
|   |   |   ├── development
|   |   |   |   ├── 00001-ABC.rst
|   |   |   |   └── 24919-KS.rst
|   |   |   └── removals
|   |   |       ├── 00001-ABC.rst
|   |   |       ├── 24923-ES.rst
|   |   |       └── 24XXX-OG.rst
|   |   ├── next_api_changes.rst
|   |   ├── offsetbox_api.rst
|   |   ├── patches_api.rst
|   |   ├── path_api.rst
|   |   ├── patheffects_api.rst
|   |   ├── prev_api_changes
|   |   |   ├── api_changes_0.40.rst
|   |   |   ├── api_changes_0.42.rst
|   |   |   ├── api_changes_0.50.rst
|   |   |   ├── api_changes_0.54.3.rst
|   |   |   ├── api_changes_0.54.rst
|   |   |   ├── api_changes_0.60.rst
|   |   |   ├── api_changes_0.61.rst
|   |   |   ├── api_changes_0.63.rst
|   |   |   ├── api_changes_0.65.1.rst
|   |   |   ├── api_changes_0.65.rst
|   |   |   ├── api_changes_0.70.rst
|   |   |   ├── api_changes_0.71.rst
|   |   |   ├── api_changes_0.72.rst
|   |   |   ├── api_changes_0.73.rst
|   |   |   ├── api_changes_0.80.rst
|   |   |   ├── api_changes_0.81.rst
|   |   |   ├── api_changes_0.82.rst
|   |   |   ├── api_changes_0.83.rst
|   |   |   ├── api_changes_0.84.rst
|   |   |   ├── api_changes_0.85.rst
|   |   |   ├── api_changes_0.86.rst
|   |   |   ├── api_changes_0.87.7.rst
|   |   |   ├── api_changes_0.90.0.rst
|   |   |   ├── api_changes_0.90.1.rst
|   |   |   ├── api_changes_0.91.0.rst
|   |   |   ├── api_changes_0.91.2.rst
|   |   |   ├── api_changes_0.98.0.rst
|   |   |   ├── api_changes_0.98.1.rst
|   |   |   ├── api_changes_0.98.x.rst
|   |   |   ├── api_changes_0.99.rst
|   |   |   ├── api_changes_0.99.x.rst
|   |   |   ├── api_changes_1.1.x.rst
|   |   |   ├── api_changes_1.2.x.rst
|   |   |   ├── api_changes_1.3.x.rst
|   |   |   ├── api_changes_1.4.x.rst
|   |   |   ├── api_changes_1.5.0.rst
|   |   |   ├── api_changes_1.5.2.rst
|   |   |   ├── api_changes_1.5.3.rst
|   |   |   ├── api_changes_2.0.0.rst
|   |   |   ├── api_changes_2.0.1.rst
|   |   |   ├── api_changes_2.1.0.rst
|   |   |   ├── api_changes_2.1.1.rst
|   |   |   ├── api_changes_2.1.2.rst
|   |   |   ├── api_changes_2.2.0.rst
|   |   |   ├── api_changes_3.0.0.rst
|   |   |   ├── api_changes_3.0.1.rst
|   |   |   ├── api_changes_3.1.0.rst
|   |   |   ├── api_changes_3.1.1.rst
|   |   |   ├── api_changes_3.2.0
|   |   |   |   ├── behavior.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.2.0.rst
|   |   |   ├── api_changes_3.3.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.3.0.rst
|   |   |   ├── api_changes_3.3.1.rst
|   |   |   ├── api_changes_3.4.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.4.0.rst
|   |   |   ├── api_changes_3.4.2.rst
|   |   |   ├── api_changes_3.5.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.5.0.rst
|   |   |   ├── api_changes_3.5.2.rst
|   |   |   ├── api_changes_3.5.3.rst
|   |   |   ├── api_changes_3.6.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   ├── api_changes_3.6.0.rst
|   |   |   ├── api_changes_3.6.1.rst
|   |   |   ├── api_changes_3.7.0
|   |   |   |   ├── behaviour.rst
|   |   |   |   ├── deprecations.rst
|   |   |   |   ├── development.rst
|   |   |   |   └── removals.rst
|   |   |   └── api_changes_3.7.0.rst
|   |   ├── projections
|   |   |   ├── geo.rst
|   |   |   └── polar.rst
|   |   ├── projections_api.rst
|   |   ├── pyplot_summary.rst
|   |   ├── quiver_api.rst
|   |   ├── rcsetup_api.rst
|   |   ├── sankey_api.rst
|   |   ├── scale_api.rst
|   |   ├── sphinxext_mathmpl_api.rst
|   |   ├── sphinxext_plot_directive_api.rst
|   |   ├── spines_api.rst
|   |   ├── style_api.rst
|   |   ├── table_api.rst
|   |   ├── testing_api.rst
|   |   ├── texmanager_api.rst
|   |   ├── text_api.rst
|   |   ├── ticker_api.rst
|   |   ├── tight_bbox_api.rst
|   |   ├── tight_layout_api.rst
|   |   ├── toolkits
|   |   |   ├── axes_grid1.rst
|   |   |   ├── axisartist.rst
|   |   |   ├── mplot3d
|   |   |   |   ├── axes3d.rst
|   |   |   |   ├── faq.rst
|   |   |   |   └── view_angles.rst
|   |   |   └── mplot3d.rst
|   |   ├── transformations.rst
|   |   ├── tri_api.rst
|   |   ├── type1font.rst
|   |   ├── units_api.rst
|   |   └── widgets_api.rst
|   ├── conf.py
|   ├── devel
|   |   ├── MEP
|   |   |   ├── MEP08.rst
|   |   |   ├── MEP09.rst
|   |   |   ├── MEP10.rst
|   |   |   ├── MEP11.rst
|   |   |   ├── MEP12.rst
|   |   |   ├── MEP13.rst
|   |   |   ├── MEP14.rst
|   |   |   ├── MEP15.rst
|   |   |   ├── MEP19.rst
|   |   |   ├── MEP21.rst
|   |   |   ├── MEP22.rst
|   |   |   ├── MEP23.rst
|   |   |   ├── MEP24.rst
|   |   |   ├── MEP25.rst
|   |   |   ├── MEP26.rst
|   |   |   ├── MEP27.rst
|   |   |   ├── MEP28.rst
|   |   |   ├── MEP29.rst
|   |   |   ├── README.rst
|   |   |   ├── index.rst
|   |   |   └── template.rst
|   |   ├── README.txt
|   |   ├── coding_guide.rst
|   |   ├── color_changes.rst
|   |   ├── contributing.rst
|   |   ├── dependencies.rst
|   |   ├── development_setup.rst
|   |   ├── development_workflow.rst
|   |   ├── documenting_mpl.rst
|   |   ├── index.rst
|   |   ├── license.rst
|   |   ├── maintainer_workflow.rst
|   |   ├── min_dep_policy.rst
|   |   ├── release_guide.rst
|   |   ├── style_guide.rst
|   |   ├── testing.rst
|   |   └── triage.rst
|   ├── index.rst
|   ├── sphinxext
|   |   ├── __init__.py
|   |   ├── custom_roles.py
|   |   ├── gallery_order.py
|   |   ├── github.py
|   |   ├── math_symbol_table.py
|   |   ├── missing_references.py
|   |   ├── mock_gui_toolkits.py
|   |   ├── redirect_from.py
|   |   └── skip_deprecated.py
|   ├── thirdpartypackages
|   |   └── index.rst
|   └── users
|       ├── explain
|       |   ├── api_interfaces.rst
|       |   ├── backends.rst
|       |   ├── event_handling.rst
|       |   ├── figures.rst
|       |   ├── fonts.rst
|       |   ├── index.rst
|       |   ├── interactive.rst
|       |   ├── interactive_guide.rst
|       |   ├── performance.rst
|       |   └── writing_a_backend_pyplot_interface.rst
|       ├── faq
|       |   ├── environment_variables_faq.rst
|       |   ├── howto_faq.rst
|       |   ├── index.rst
|       |   └── troubleshooting_faq.rst
|       ├── generate_credits.py
|       ├── getting_started
|       |   └── index.rst
|       ├── github_stats.rst
|       ├── index.rst
|       ├── installing
|       |   └── index.rst
|       ├── next_whats_new
|       |   ├── README.rst
|       |   ├── pie_hatch.rst
|       |   ├── savefig_bbox_layout.rst
|       |   └── widget_button_styling.rst
|       ├── next_whats_new.rst
|       ├── prev_whats_new
|       |   ├── changelog.rst
|       |   ├── dflt_style_changes.rst
|       |   ├── github_stats_3.0.0.rst
|       |   ├── github_stats_3.0.1.rst
|       |   ├── github_stats_3.0.2.rst
|       |   ├── github_stats_3.0.3.rst
|       |   ├── github_stats_3.1.0.rst
|       |   ├── github_stats_3.1.1.rst
|       |   ├── github_stats_3.1.2.rst
|       |   ├── github_stats_3.1.3.rst
|       |   ├── github_stats_3.2.0.rst
|       |   ├── github_stats_3.2.1.rst
|       |   ├── github_stats_3.2.2.rst
|       |   ├── github_stats_3.3.0.rst
|       |   ├── github_stats_3.3.1.rst
|       |   ├── github_stats_3.3.2.rst
|       |   ├── github_stats_3.3.3.rst
|       |   ├── github_stats_3.3.4.rst
|       |   ├── github_stats_3.4.0.rst
|       |   ├── github_stats_3.4.1.rst
|       |   ├── github_stats_3.4.2.rst
|       |   ├── github_stats_3.4.3.rst
|       |   ├── github_stats_3.5.0.rst
|       |   ├── github_stats_3.5.1.rst
|       |   ├── github_stats_3.5.2.rst
|       |   ├── github_stats_3.5.3.rst
|       |   ├── github_stats_3.6.0.rst
|       |   ├── github_stats_3.6.1.rst
|       |   ├── github_stats_3.6.2.rst
|       |   ├── github_stats_3.6.3.rst
|       |   ├── whats_new_0.98.4.rst
|       |   ├── whats_new_0.99.rst
|       |   ├── whats_new_1.0.rst
|       |   ├── whats_new_1.1.rst
|       |   ├── whats_new_1.2.2.rst
|       |   ├── whats_new_1.2.rst
|       |   ├── whats_new_1.3.rst
|       |   ├── whats_new_1.4.rst
|       |   ├── whats_new_1.5.rst
|       |   ├── whats_new_2.0.0.rst
|       |   ├── whats_new_2.1.0.rst
|       |   ├── whats_new_2.2.rst
|       |   ├── whats_new_3.0.rst
|       |   ├── whats_new_3.1.0.rst
|       |   ├── whats_new_3.2.0.rst
|       |   ├── whats_new_3.3.0.rst
|       |   ├── whats_new_3.4.0.rst
|       |   ├── whats_new_3.5.0.rst
|       |   ├── whats_new_3.5.2.rst
|       |   ├── whats_new_3.6.0.rst
|       |   └── whats_new_3.7.0.rst
|       ├── project
|       |   ├── citing.rst
|       |   ├── credits.rst
|       |   ├── history.rst
|       |   ├── index.rst
|       |   ├── license.rst
|       |   └── mission.rst
|       ├── release_notes.rst
|       ├── release_notes_next.rst
|       └── resources
|           └── index.rst
├── environment.yml
├── extern
|   ├── agg24-svn
|   |   ├── include
|   |   |   ├── ctrl
|   |   |   ├── platform
|   |   |   |   ├── mac
|   |   |   |   └── win32
|   |   |   └── util
|   |   └── src
|   |       ├── agg_arc.cpp
|   |       ├── agg_arrowhead.cpp
|   |       ├── agg_bezier_arc.cpp
|   |       ├── agg_bspline.cpp
|   |       ├── agg_color_rgba.cpp
|   |       ├── agg_curves.cpp
|   |       ├── agg_embedded_raster_fonts.cpp
|   |       ├── agg_gsv_text.cpp
|   |       ├── agg_image_filters.cpp
|   |       ├── agg_line_aa_basics.cpp
|   |       ├── agg_line_profile_aa.cpp
|   |       ├── agg_rounded_rect.cpp
|   |       ├── agg_sqrt_tables.cpp
|   |       ├── agg_trans_affine.cpp
|   |       ├── agg_trans_double_path.cpp
|   |       ├── agg_trans_single_path.cpp
|   |       ├── agg_trans_warp_magnifier.cpp
|   |       ├── agg_vcgen_bspline.cpp
|   |       ├── agg_vcgen_contour.cpp
|   |       ├── agg_vcgen_dash.cpp
|   |       ├── agg_vcgen_markers_term.cpp
|   |       ├── agg_vcgen_smooth_poly1.cpp
|   |       ├── agg_vcgen_stroke.cpp
|   |       ├── agg_vpgen_clip_polygon.cpp
|   |       ├── agg_vpgen_clip_polyline.cpp
|   |       ├── agg_vpgen_segmentator.cpp
|   |       ├── ctrl
|   |       |   ├── agg_bezier_ctrl.cpp
|   |       |   ├── agg_cbox_ctrl.cpp
|   |       |   ├── agg_gamma_ctrl.cpp
|   |       |   ├── agg_gamma_spline.cpp
|   |       |   ├── agg_polygon_ctrl.cpp
|   |       |   ├── agg_rbox_ctrl.cpp
|   |       |   ├── agg_scale_ctrl.cpp
|   |       |   ├── agg_slider_ctrl.cpp
|   |       |   └── agg_spline_ctrl.cpp
|   |       └── platform
|   |           ├── AmigaOS
|   |           ├── BeOS
|   |           ├── X11
|   |           ├── mac
|   |           ├── sdl
|   |           └── win32
|   └── ttconv
|       ├── pprdrv_tt.cpp
|       ├── pprdrv_tt2.cpp
|       └── ttutil.cpp
├── galleries
|   ├── examples
|   |   ├── README.txt
|   |   ├── animation
|   |   |   ├── README.txt
|   |   |   ├── animate_decay.py
|   |   |   ├── animated_histogram.py
|   |   |   ├── animation_demo.py
|   |   |   ├── bayes_update.py
|   |   |   ├── double_pendulum.py
|   |   |   ├── dynamic_image.py
|   |   |   ├── frame_grabbing_sgskip.py
|   |   |   ├── multiple_axes.py
|   |   |   ├── pause_resume.py
|   |   |   ├── rain.py
|   |   |   ├── random_walk.py
|   |   |   ├── simple_anim.py
|   |   |   ├── simple_scatter.py
|   |   |   ├── strip_chart.py
|   |   |   └── unchained.py
|   |   ├── axes_grid1
|   |   |   ├── README.txt
|   |   |   ├── demo_anchored_direction_arrows.py
|   |   |   ├── demo_axes_divider.py
|   |   |   ├── demo_axes_grid.py
|   |   |   ├── demo_axes_grid2.py
|   |   |   ├── demo_axes_hbox_divider.py
|   |   |   ├── demo_axes_rgb.py
|   |   |   ├── demo_colorbar_of_inset_axes.py
|   |   |   ├── demo_colorbar_with_axes_divider.py
|   |   |   ├── demo_colorbar_with_inset_locator.py
|   |   |   ├── demo_edge_colorbar.py
|   |   |   ├── demo_fixed_size_axes.py
|   |   |   ├── demo_imagegrid_aspect.py
|   |   |   ├── inset_locator_demo.py
|   |   |   ├── inset_locator_demo2.py
|   |   |   ├── make_room_for_ylabel_using_axesgrid.py
|   |   |   ├── parasite_simple.py
|   |   |   ├── parasite_simple2.py
|   |   |   ├── scatter_hist_locatable_axes.py
|   |   |   ├── simple_anchored_artists.py
|   |   |   ├── simple_axes_divider1.py
|   |   |   ├── simple_axes_divider3.py
|   |   |   ├── simple_axesgrid.py
|   |   |   ├── simple_axesgrid2.py
|   |   |   ├── simple_axisline4.py
|   |   |   └── simple_colorbar.py
|   |   ├── axisartist
|   |   |   ├── README.txt
|   |   |   ├── axis_direction.py
|   |   |   ├── demo_axis_direction.py
|   |   |   ├── demo_axisline_style.py
|   |   |   ├── demo_curvelinear_grid.py
|   |   |   ├── demo_curvelinear_grid2.py
|   |   |   ├── demo_floating_axes.py
|   |   |   ├── demo_floating_axis.py
|   |   |   ├── demo_parasite_axes.py
|   |   |   ├── demo_parasite_axes2.py
|   |   |   ├── demo_ticklabel_alignment.py
|   |   |   ├── demo_ticklabel_direction.py
|   |   |   ├── simple_axis_direction01.py
|   |   |   ├── simple_axis_direction03.py
|   |   |   ├── simple_axis_pad.py
|   |   |   ├── simple_axisartist1.py
|   |   |   ├── simple_axisline.py
|   |   |   └── simple_axisline3.py
|   |   ├── color
|   |   |   ├── README.txt
|   |   |   ├── color_by_yvalue.py
|   |   |   ├── color_cycle_default.py
|   |   |   ├── color_demo.py
|   |   |   ├── colorbar_basics.py
|   |   |   ├── colormap_reference.py
|   |   |   ├── custom_cmap.py
|   |   |   └── named_colors.py
|   |   ├── event_handling
|   |   |   ├── README.txt
|   |   |   ├── close_event.py
|   |   |   ├── coords_demo.py
|   |   |   ├── cursor_demo.py
|   |   |   ├── data_browser.py
|   |   |   ├── figure_axes_enter_leave.py
|   |   |   ├── ginput_manual_clabel_sgskip.py
|   |   |   ├── image_slices_viewer.py
|   |   |   ├── keypress_demo.py
|   |   |   ├── lasso_demo.py
|   |   |   ├── legend_picking.py
|   |   |   ├── looking_glass.py
|   |   |   ├── path_editor.py
|   |   |   ├── pick_event_demo.py
|   |   |   ├── pick_event_demo2.py
|   |   |   ├── poly_editor.py
|   |   |   ├── pong_sgskip.py
|   |   |   ├── resample.py
|   |   |   ├── timers.py
|   |   |   ├── trifinder_event_demo.py
|   |   |   ├── viewlims.py
|   |   |   └── zoom_window.py
|   |   ├── images_contours_and_fields
|   |   |   ├── README.txt
|   |   |   ├── affine_image.py
|   |   |   ├── barb_demo.py
|   |   |   ├── barcode_demo.py
|   |   |   ├── colormap_interactive_adjustment.py
|   |   |   ├── colormap_normalizations.py
|   |   |   ├── colormap_normalizations_symlognorm.py
|   |   |   ├── contour_corner_mask.py
|   |   |   ├── contour_demo.py
|   |   |   ├── contour_image.py
|   |   |   ├── contour_label_demo.py
|   |   |   ├── contourf_demo.py
|   |   |   ├── contourf_hatching.py
|   |   |   ├── contourf_log.py
|   |   |   ├── contours_in_optimization_demo.py
|   |   |   ├── demo_bboximage.py
|   |   |   ├── figimage_demo.py
|   |   |   ├── image_annotated_heatmap.py
|   |   |   ├── image_antialiasing.py
|   |   |   ├── image_clip_path.py
|   |   |   ├── image_demo.py
|   |   |   ├── image_masked.py
|   |   |   ├── image_nonuniform.py
|   |   |   ├── image_transparency_blend.py
|   |   |   ├── image_zcoord.py
|   |   |   ├── interpolation_methods.py
|   |   |   ├── irregulardatagrid.py
|   |   |   ├── layer_images.py
|   |   |   ├── matshow.py
|   |   |   ├── multi_image.py
|   |   |   ├── pcolor_demo.py
|   |   |   ├── pcolormesh_grids.py
|   |   |   ├── pcolormesh_levels.py
|   |   |   ├── plot_streamplot.py
|   |   |   ├── quadmesh_demo.py
|   |   |   ├── quiver_demo.py
|   |   |   ├── quiver_simple_demo.py
|   |   |   ├── shading_example.py
|   |   |   ├── specgram_demo.py
|   |   |   ├── spy_demos.py
|   |   |   ├── tricontour_demo.py
|   |   |   ├── tricontour_smooth_delaunay.py
|   |   |   ├── tricontour_smooth_user.py
|   |   |   ├── trigradient_demo.py
|   |   |   ├── triinterp_demo.py
|   |   |   ├── tripcolor_demo.py
|   |   |   ├── triplot_demo.py
|   |   |   └── watermark_image.py
|   |   ├── lines_bars_and_markers
|   |   |   ├── README.txt
|   |   |   ├── bar_colors.py
|   |   |   ├── bar_label_demo.py
|   |   |   ├── bar_stacked.py
|   |   |   ├── barchart.py
|   |   |   ├── barh.py
|   |   |   ├── broken_barh.py
|   |   |   ├── capstyle.py
|   |   |   ├── categorical_variables.py
|   |   |   ├── cohere.py
|   |   |   ├── csd_demo.py
|   |   |   ├── curve_error_band.py
|   |   |   ├── errorbar_limits_simple.py
|   |   |   ├── errorbar_subsample.py
|   |   |   ├── eventcollection_demo.py
|   |   |   ├── eventplot_demo.py
|   |   |   ├── fill.py
|   |   |   ├── fill_between_alpha.py
|   |   |   ├── fill_between_demo.py
|   |   |   ├── fill_betweenx_demo.py
|   |   |   ├── filled_step.py
|   |   |   ├── gradient_bar.py
|   |   |   ├── hat_graph.py
|   |   |   ├── horizontal_barchart_distribution.py
|   |   |   ├── joinstyle.py
|   |   |   ├── line_demo_dash_control.py
|   |   |   ├── lines_with_ticks_demo.py
|   |   |   ├── linestyles.py
|   |   |   ├── marker_reference.py
|   |   |   ├── markevery_demo.py
|   |   |   ├── masked_demo.py
|   |   |   ├── multicolored_line.py
|   |   |   ├── multivariate_marker_plot.py
|   |   |   ├── psd_demo.py
|   |   |   ├── scatter_custom_symbol.py
|   |   |   ├── scatter_demo2.py
|   |   |   ├── scatter_hist.py
|   |   |   ├── scatter_masked.py
|   |   |   ├── scatter_star_poly.py
|   |   |   ├── scatter_with_legend.py
|   |   |   ├── simple_plot.py
|   |   |   ├── span_regions.py
|   |   |   ├── spectrum_demo.py
|   |   |   ├── stackplot_demo.py
|   |   |   ├── stairs_demo.py
|   |   |   ├── stem_plot.py
|   |   |   ├── step_demo.py
|   |   |   ├── timeline.py
|   |   |   ├── vline_hline_demo.py
|   |   |   └── xcorr_acorr_demo.py
|   |   ├── misc
|   |   |   ├── README.txt
|   |   |   ├── anchored_artists.py
|   |   |   ├── bbox_intersect.py
|   |   |   ├── contour_manual.py
|   |   |   ├── coords_report.py
|   |   |   ├── custom_projection.py
|   |   |   ├── customize_rc.py
|   |   |   ├── demo_agg_filter.py
|   |   |   ├── demo_ribbon_box.py
|   |   |   ├── fig_x.py
|   |   |   ├── fill_spiral.py
|   |   |   ├── findobj_demo.py
|   |   |   ├── font_indexing.py
|   |   |   ├── ftface_props.py
|   |   |   ├── histogram_path.py
|   |   |   ├── hyperlinks_sgskip.py
|   |   |   ├── image_thumbnail_sgskip.py
|   |   |   ├── keyword_plotting.py
|   |   |   ├── logos2.py
|   |   |   ├── multipage_pdf.py
|   |   |   ├── multiprocess_sgskip.py
|   |   |   ├── packed_bubbles.py
|   |   |   ├── patheffect_demo.py
|   |   |   ├── print_stdout_sgskip.py
|   |   |   ├── rasterization_demo.py
|   |   |   ├── set_and_get.py
|   |   |   ├── svg_filter_line.py
|   |   |   ├── svg_filter_pie.py
|   |   |   ├── table_demo.py
|   |   |   ├── tickedstroke_demo.py
|   |   |   ├── transoffset.py
|   |   |   └── zorder_demo.py
|   |   ├── mplot3d
|   |   |   ├── 2dcollections3d.py
|   |   |   ├── 3d_bars.py
|   |   |   ├── README.txt
|   |   |   ├── bars3d.py
|   |   |   ├── box3d.py
|   |   |   ├── contour3d.py
|   |   |   ├── contour3d_2.py
|   |   |   ├── contour3d_3.py
|   |   |   ├── contourf3d.py
|   |   |   ├── contourf3d_2.py
|   |   |   ├── custom_shaded_3d_surface.py
|   |   |   ├── errorbar3d.py
|   |   |   ├── hist3d.py
|   |   |   ├── lines3d.py
|   |   |   ├── lorenz_attractor.py
|   |   |   ├── mixed_subplots.py
|   |   |   ├── offset.py
|   |   |   ├── pathpatch3d.py
|   |   |   ├── polys3d.py
|   |   |   ├── projections.py
|   |   |   ├── quiver3d.py
|   |   |   ├── rotate_axes3d_sgskip.py
|   |   |   ├── scatter3d.py
|   |   |   ├── stem3d_demo.py
|   |   |   ├── subplot3d.py
|   |   |   ├── surface3d.py
|   |   |   ├── surface3d_2.py
|   |   |   ├── surface3d_3.py
|   |   |   ├── surface3d_radial.py
|   |   |   ├── text3d.py
|   |   |   ├── tricontour3d.py
|   |   |   ├── tricontourf3d.py
|   |   |   ├── trisurf3d.py
|   |   |   ├── trisurf3d_2.py
|   |   |   ├── view_planes_3d.py
|   |   |   ├── voxels.py
|   |   |   ├── voxels_numpy_logo.py
|   |   |   ├── voxels_rgb.py
|   |   |   ├── voxels_torus.py
|   |   |   ├── wire3d.py
|   |   |   ├── wire3d_animation_sgskip.py
|   |   |   └── wire3d_zero_stride.py
|   |   ├── pie_and_polar_charts
|   |   |   ├── README.txt
|   |   |   ├── bar_of_pie.py
|   |   |   ├── nested_pie.py
|   |   |   ├── pie_and_donut_labels.py
|   |   |   ├── pie_demo2.py
|   |   |   ├── pie_features.py
|   |   |   ├── polar_bar.py
|   |   |   ├── polar_demo.py
|   |   |   ├── polar_error_caps.py
|   |   |   ├── polar_legend.py
|   |   |   └── polar_scatter.py
|   |   ├── pyplots
|   |   |   ├── README.txt
|   |   |   ├── axline.py
|   |   |   ├── pyplot_simple.py
|   |   |   ├── pyplot_text.py
|   |   |   ├── pyplot_three.py
|   |   |   └── pyplot_two_subplots.py
|   |   ├── scales
|   |   |   ├── README.txt
|   |   |   ├── asinh_demo.py
|   |   |   ├── aspect_loglog.py
|   |   |   ├── custom_scale.py
|   |   |   ├── log_bar.py
|   |   |   ├── log_demo.py
|   |   |   ├── logit_demo.py
|   |   |   ├── power_norm.py
|   |   |   ├── scales.py
|   |   |   ├── semilogx_demo.py
|   |   |   └── symlog_demo.py
|   |   ├── shapes_and_collections
|   |   |   ├── README.txt
|   |   |   ├── arrow_guide.py
|   |   |   ├── artist_reference.py
|   |   |   ├── collections.py
|   |   |   ├── compound_path.py
|   |   |   ├── dolphin.py
|   |   |   ├── donut.py
|   |   |   ├── ellipse_collection.py
|   |   |   ├── ellipse_demo.py
|   |   |   ├── fancybox_demo.py
|   |   |   ├── hatch_demo.py
|   |   |   ├── hatch_style_reference.py
|   |   |   ├── line_collection.py
|   |   |   ├── patch_collection.py
|   |   |   ├── path_patch.py
|   |   |   ├── quad_bezier.py
|   |   |   └── scatter.py
|   |   ├── showcase
|   |   |   ├── README.txt
|   |   |   ├── anatomy.py
|   |   |   ├── firefox.py
|   |   |   ├── integral.py
|   |   |   ├── mandelbrot.py
|   |   |   ├── stock_prices.py
|   |   |   └── xkcd.py
|   |   ├── specialty_plots
|   |   |   ├── README.txt
|   |   |   ├── advanced_hillshading.py
|   |   |   ├── anscombe.py
|   |   |   ├── hinton_demo.py
|   |   |   ├── leftventricle_bullseye.py
|   |   |   ├── mri_demo.py
|   |   |   ├── mri_with_eeg.py
|   |   |   ├── radar_chart.py
|   |   |   ├── sankey_basics.py
|   |   |   ├── sankey_links.py
|   |   |   ├── sankey_rankine.py
|   |   |   ├── skewt.py
|   |   |   └── topographic_hillshading.py
|   |   ├── spines
|   |   |   ├── README.txt
|   |   |   ├── centered_spines_with_arrows.py
|   |   |   ├── multiple_yaxis_with_spines.py
|   |   |   ├── spine_placement_demo.py
|   |   |   ├── spines.py
|   |   |   └── spines_dropped.py
|   |   ├── statistics
|   |   |   ├── README.txt
|   |   |   ├── barchart_demo.py
|   |   |   ├── boxplot.py
|   |   |   ├── boxplot_color.py
|   |   |   ├── boxplot_demo.py
|   |   |   ├── boxplot_vs_violin.py
|   |   |   ├── bxp.py
|   |   |   ├── confidence_ellipse.py
|   |   |   ├── customized_violin.py
|   |   |   ├── errorbar.py
|   |   |   ├── errorbar_features.py
|   |   |   ├── errorbar_limits.py
|   |   |   ├── errorbars_and_boxes.py
|   |   |   ├── hexbin_demo.py
|   |   |   ├── hist.py
|   |   |   ├── histogram_cumulative.py
|   |   |   ├── histogram_features.py
|   |   |   ├── histogram_histtypes.py
|   |   |   ├── histogram_multihist.py
|   |   |   ├── multiple_histograms_side_by_side.py
|   |   |   ├── time_series_histogram.py
|   |   |   └── violinplot.py
|   |   ├── style_sheets
|   |   |   ├── README.txt
|   |   |   ├── bmh.py
|   |   |   ├── dark_background.py
|   |   |   ├── fivethirtyeight.py
|   |   |   ├── ggplot.py
|   |   |   ├── grayscale.py
|   |   |   ├── plot_solarizedlight2.py
|   |   |   └── style_sheets_reference.py
|   |   ├── subplots_axes_and_figures
|   |   |   ├── README.txt
|   |   |   ├── align_labels_demo.py
|   |   |   ├── auto_subplots_adjust.py
|   |   |   ├── axes_box_aspect.py
|   |   |   ├── axes_demo.py
|   |   |   ├── axes_margins.py
|   |   |   ├── axes_props.py
|   |   |   ├── axes_zoom_effect.py
|   |   |   ├── axhspan_demo.py
|   |   |   ├── axis_equal_demo.py
|   |   |   ├── axis_labels_demo.py
|   |   |   ├── broken_axis.py
|   |   |   ├── colorbar_placement.py
|   |   |   ├── custom_figure_class.py
|   |   |   ├── demo_constrained_layout.py
|   |   |   ├── demo_tight_layout.py
|   |   |   ├── fahrenheit_celsius_scales.py
|   |   |   ├── figure_size_units.py
|   |   |   ├── figure_title.py
|   |   |   ├── ganged_plots.py
|   |   |   ├── geo_demo.py
|   |   |   ├── gridspec_and_subplots.py
|   |   |   ├── gridspec_multicolumn.py
|   |   |   ├── gridspec_nested.py
|   |   |   ├── invert_axes.py
|   |   |   ├── mosaic.py
|   |   |   ├── multiple_figs_demo.py
|   |   |   ├── secondary_axis.py
|   |   |   ├── share_axis_lims_views.py
|   |   |   ├── shared_axis_demo.py
|   |   |   ├── subfigures.py
|   |   |   ├── subplot.py
|   |   |   ├── subplots_adjust.py
|   |   |   ├── subplots_demo.py
|   |   |   ├── two_scales.py
|   |   |   └── zoom_inset_axes.py
|   |   ├── text_labels_and_annotations
|   |   |   ├── README.txt
|   |   |   ├── accented_text.py
|   |   |   ├── align_ylabels.py
|   |   |   ├── angle_annotation.py
|   |   |   ├── angles_on_bracket_arrows.py
|   |   |   ├── annotate_transform.py
|   |   |   ├── annotation_basic.py
|   |   |   ├── annotation_demo.py
|   |   |   ├── annotation_polar.py
|   |   |   ├── arrow_demo.py
|   |   |   ├── autowrap.py
|   |   |   ├── custom_legends.py
|   |   |   ├── date.py
|   |   |   ├── demo_annotation_box.py
|   |   |   ├── demo_text_path.py
|   |   |   ├── demo_text_rotation_mode.py
|   |   |   ├── dfrac_demo.py
|   |   |   ├── engineering_formatter.py
|   |   |   ├── fancyarrow_demo.py
|   |   |   ├── fancytextbox_demo.py
|   |   |   ├── figlegend_demo.py
|   |   |   ├── font_family_rc.py
|   |   |   ├── font_file.py
|   |   |   ├── font_table.py
|   |   |   ├── fonts_demo.py
|   |   |   ├── fonts_demo_kw.py
|   |   |   ├── label_subplots.py
|   |   |   ├── legend.py
|   |   |   ├── legend_demo.py
|   |   |   ├── line_with_text.py
|   |   |   ├── mathtext_asarray.py
|   |   |   ├── mathtext_demo.py
|   |   |   ├── mathtext_examples.py
|   |   |   ├── mathtext_fontfamily_example.py
|   |   |   ├── multiline.py
|   |   |   ├── placing_text_boxes.py
|   |   |   ├── rainbow_text.py
|   |   |   ├── stix_fonts_demo.py
|   |   |   ├── tex_demo.py
|   |   |   ├── text_alignment.py
|   |   |   ├── text_commands.py
|   |   |   ├── text_fontdict.py
|   |   |   ├── text_rotation_relative_to_line.py
|   |   |   ├── titles_demo.py
|   |   |   ├── unicode_minus.py
|   |   |   ├── usetex_baseline_test.py
|   |   |   ├── usetex_fonteffects.py
|   |   |   └── watermark_text.py
|   |   ├── ticks
|   |   |   ├── README.txt
|   |   |   ├── auto_ticks.py
|   |   |   ├── centered_ticklabels.py
|   |   |   ├── colorbar_tick_labelling_demo.py
|   |   |   ├── custom_ticker1.py
|   |   |   ├── date_concise_formatter.py
|   |   |   ├── date_demo_convert.py
|   |   |   ├── date_demo_rrule.py
|   |   |   ├── date_formatters_locators.py
|   |   |   ├── date_index_formatter.py
|   |   |   ├── date_precision_and_epochs.py
|   |   |   ├── dollar_ticks.py
|   |   |   ├── fig_axes_customize_simple.py
|   |   |   ├── major_minor_demo.py
|   |   |   ├── scalarformatter.py
|   |   |   ├── tick-formatters.py
|   |   |   ├── tick-locators.py
|   |   |   ├── tick_label_right.py
|   |   |   ├── tick_labels_from_values.py
|   |   |   ├── tick_xlabel_top.py
|   |   |   ├── ticklabels_rotation.py
|   |   |   └── ticks_too_many.py
|   |   ├── units
|   |   |   ├── README.txt
|   |   |   ├── annotate_with_units.py
|   |   |   ├── artist_tests.py
|   |   |   ├── bar_demo2.py
|   |   |   ├── bar_unit_demo.py
|   |   |   ├── basic_units.py
|   |   |   ├── ellipse_with_units.py
|   |   |   ├── evans_test.py
|   |   |   ├── radian_demo.py
|   |   |   ├── units_sample.py
|   |   |   └── units_scatter.py
|   |   ├── user_interfaces
|   |   |   ├── README.txt
|   |   |   ├── canvasagg.py
|   |   |   ├── embedding_in_gtk3_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk3_sgskip.py
|   |   |   ├── embedding_in_gtk4_panzoom_sgskip.py
|   |   |   ├── embedding_in_gtk4_sgskip.py
|   |   |   ├── embedding_in_qt_sgskip.py
|   |   |   ├── embedding_in_tk_sgskip.py
|   |   |   ├── embedding_in_wx2_sgskip.py
|   |   |   ├── embedding_in_wx3_sgskip.py
|   |   |   ├── embedding_in_wx4_sgskip.py
|   |   |   ├── embedding_in_wx5_sgskip.py
|   |   |   ├── embedding_webagg_sgskip.py
|   |   |   ├── fourier_demo_wx_sgskip.py
|   |   |   ├── gtk3_spreadsheet_sgskip.py
|   |   |   ├── gtk4_spreadsheet_sgskip.py
|   |   |   ├── images
|   |   |   ├── mathtext_wx_sgskip.py
|   |   |   ├── mpl_with_glade3_sgskip.py
|   |   |   ├── mplcvd.py
|   |   |   ├── pylab_with_gtk3_sgskip.py
|   |   |   ├── pylab_with_gtk4_sgskip.py
|   |   |   ├── svg_histogram_sgskip.py
|   |   |   ├── svg_tooltip_sgskip.py
|   |   |   ├── toolmanager_sgskip.py
|   |   |   ├── web_application_server_sgskip.py
|   |   |   └── wxcursor_demo_sgskip.py
|   |   ├── userdemo
|   |   |   ├── README.txt
|   |   |   ├── annotate_explain.py
|   |   |   ├── annotate_simple_coord02.py
|   |   |   ├── annotate_text_arrow.py
|   |   |   ├── connect_simple01.py
|   |   |   ├── connectionstyle_demo.py
|   |   |   ├── custom_boxstyle01.py
|   |   |   ├── demo_gridspec01.py
|   |   |   ├── demo_gridspec03.py
|   |   |   ├── demo_gridspec06.py
|   |   |   ├── pgf_fonts.py
|   |   |   ├── pgf_preamble_sgskip.py
|   |   |   ├── pgf_texsystem.py
|   |   |   ├── simple_annotate01.py
|   |   |   ├── simple_legend01.py
|   |   |   └── simple_legend02.py
|   |   └── widgets
|   |       ├── README.txt
|   |       ├── annotated_cursor.py
|   |       ├── buttons.py
|   |       ├── check_buttons.py
|   |       ├── cursor.py
|   |       ├── lasso_selector_demo_sgskip.py
|   |       ├── menu.py
|   |       ├── mouse_cursor.py
|   |       ├── multicursor.py
|   |       ├── polygon_selector_demo.py
|   |       ├── polygon_selector_simple.py
|   |       ├── radio_buttons.py
|   |       ├── range_slider.py
|   |       ├── rectangle_selector.py
|   |       ├── slider_demo.py
|   |       ├── slider_snap_demo.py
|   |       ├── span_selector.py
|   |       └── textbox.py
|   ├── plot_types
|   |   ├── 3D
|   |   |   ├── README.rst
|   |   |   ├── scatter3d_simple.py
|   |   |   ├── surface3d_simple.py
|   |   |   ├── trisurf3d_simple.py
|   |   |   ├── voxels_simple.py
|   |   |   └── wire3d_simple.py
|   |   ├── README.rst
|   |   ├── arrays
|   |   |   ├── README.rst
|   |   |   ├── barbs.py
|   |   |   ├── contour.py
|   |   |   ├── contourf.py
|   |   |   ├── imshow.py
|   |   |   ├── pcolormesh.py
|   |   |   ├── quiver.py
|   |   |   └── streamplot.py
|   |   ├── basic
|   |   |   ├── README.rst
|   |   |   ├── bar.py
|   |   |   ├── fill_between.py
|   |   |   ├── plot.py
|   |   |   ├── scatter_plot.py
|   |   |   ├── stackplot.py
|   |   |   ├── stem.py
|   |   |   └── step.py
|   |   ├── stats
|   |   |   ├── README.rst
|   |   |   ├── boxplot_plot.py
|   |   |   ├── errorbar_plot.py
|   |   |   ├── eventplot.py
|   |   |   ├── hexbin.py
|   |   |   ├── hist2d.py
|   |   |   ├── hist_plot.py
|   |   |   ├── pie.py
|   |   |   └── violin.py
|   |   └── unstructured
|   |       ├── README.rst
|   |       ├── tricontour.py
|   |       ├── tricontourf.py
|   |       ├── tripcolor.py
|   |       └── triplot.py
|   └── tutorials
|       ├── README.txt
|       ├── advanced
|       |   ├── README.txt
|       |   ├── blitting.py
|       |   ├── path_tutorial.py
|       |   ├── patheffects_guide.py
|       |   └── transforms_tutorial.py
|       ├── colors
|       |   ├── README.txt
|       |   ├── colorbar_only.py
|       |   ├── colormap-manipulation.py
|       |   ├── colormapnorms.py
|       |   ├── colormaps.py
|       |   └── colors.py
|       ├── intermediate
|       |   ├── README.txt
|       |   ├── arranging_axes.py
|       |   ├── artists.py
|       |   ├── autoscale.py
|       |   ├── color_cycle.py
|       |   ├── constrainedlayout_guide.py
|       |   ├── imshow_extent.py
|       |   ├── legend_guide.py
|       |   └── tight_layout_guide.py
|       ├── introductory
|       |   ├── README.txt
|       |   ├── animation_tutorial.py
|       |   ├── customizing.py
|       |   ├── images.py
|       |   ├── lifecycle.py
|       |   ├── pyplot.py
|       |   └── quick_start.py
|       ├── provisional
|       |   └── README.txt
|       ├── text
|       |   ├── README.txt
|       |   ├── annotations.py
|       |   ├── mathtext.py
|       |   ├── pgf.py
|       |   ├── text_intro.py
|       |   ├── text_props.py
|       |   └── usetex.py
|       └── toolkits
|           ├── README.txt
|           ├── axes_grid.py
|           ├── axisartist.py
|           └── mplot3d.py
├── lib
|   ├── matplotlib
|   |   ├── __init__.py
|   |   ├── _afm.py
|   |   ├── _animation_data.py
|   |   ├── _api
|   |   |   ├── __init__.py
|   |   |   └── deprecation.py
|   |   ├── _blocking_input.py
|   |   ├── _cm.py
|   |   ├── _cm_listed.py
|   |   ├── _color_data.py
|   |   ├── _constrained_layout.py
|   |   ├── _docstring.py
|   |   ├── _enums.py
|   |   ├── _fontconfig_pattern.py
|   |   ├── _internal_utils.py
|   |   ├── _layoutgrid.py
|   |   ├── _mathtext.py
|   |   ├── _mathtext_data.py
|   |   ├── _pylab_helpers.py
|   |   ├── _text_helpers.py
|   |   ├── _tight_bbox.py
|   |   ├── _tight_layout.py
|   |   ├── _type1font.py
|   |   ├── animation.py
|   |   ├── artist.py
|   |   ├── axes
|   |   |   ├── __init__.py
|   |   |   ├── _axes.py
|   |   |   ├── _base.py
|   |   |   └── _secondary_axes.py
|   |   ├── axis.py
|   |   ├── backend_bases.py
|   |   ├── backend_managers.py
|   |   ├── backend_tools.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── _backend_gtk.py
|   |   |   ├── _backend_pdf_ps.py
|   |   |   ├── _backend_tk.py
|   |   |   ├── backend_agg.py
|   |   |   ├── backend_cairo.py
|   |   |   ├── backend_gtk3.py
|   |   |   ├── backend_gtk3agg.py
|   |   |   ├── backend_gtk3cairo.py
|   |   |   ├── backend_gtk4.py
|   |   |   ├── backend_gtk4agg.py
|   |   |   ├── backend_gtk4cairo.py
|   |   |   ├── backend_macosx.py
|   |   |   ├── backend_mixed.py
|   |   |   ├── backend_nbagg.py
|   |   |   ├── backend_pdf.py
|   |   |   ├── backend_pgf.py
|   |   |   ├── backend_ps.py
|   |   |   ├── backend_qt.py
|   |   |   ├── backend_qt5.py
|   |   |   ├── backend_qt5agg.py
|   |   |   ├── backend_qt5cairo.py
|   |   |   ├── backend_qtagg.py
|   |   |   ├── backend_qtcairo.py
|   |   |   ├── backend_svg.py
|   |   |   ├── backend_template.py
|   |   |   ├── backend_tkagg.py
|   |   |   ├── backend_tkcairo.py
|   |   |   ├── backend_webagg.py
|   |   |   ├── backend_webagg_core.py
|   |   |   ├── backend_wx.py
|   |   |   ├── backend_wxagg.py
|   |   |   ├── backend_wxcairo.py
|   |   |   ├── qt_compat.py
|   |   |   ├── qt_editor
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _formlayout.py
|   |   |   |   └── figureoptions.py
|   |   |   └── web_backend
|   |   |       ├── .eslintrc.js
|   |   |       ├── all_figures.html
|   |   |       ├── css
|   |   |       ├── ipython_inline_figure.html
|   |   |       ├── js
|   |   |       └── single_figure.html
|   |   ├── bezier.py
|   |   ├── category.py
|   |   ├── cbook.py
|   |   ├── cm.py
|   |   ├── collections.py
|   |   ├── colorbar.py
|   |   ├── colors.py
|   |   ├── container.py
|   |   ├── contour.py
|   |   ├── dates.py
|   |   ├── dviread.py
|   |   ├── figure.py
|   |   ├── font_manager.py
|   |   ├── gridspec.py
|   |   ├── hatch.py
|   |   ├── image.py
|   |   ├── layout_engine.py
|   |   ├── legend.py
|   |   ├── legend_handler.py
|   |   ├── lines.py
|   |   ├── markers.py
|   |   ├── mathtext.py
|   |   ├── mlab.py
|   |   ├── mpl-data
|   |   |   ├── fonts
|   |   |   |   ├── afm
|   |   |   |   ├── pdfcorefonts
|   |   |   |   └── ttf
|   |   |   ├── images
|   |   |   ├── plot_directive
|   |   |   |   └── plot_directive.css
|   |   |   ├── sample_data
|   |   |   |   ├── README.txt
|   |   |   |   └── axes_grid
|   |   |   └── stylelib
|   |   ├── offsetbox.py
|   |   ├── patches.py
|   |   ├── path.py
|   |   ├── patheffects.py
|   |   ├── projections
|   |   |   ├── __init__.py
|   |   |   ├── geo.py
|   |   |   └── polar.py
|   |   ├── pylab.py
|   |   ├── pyplot.py
|   |   ├── quiver.py
|   |   ├── rcsetup.py
|   |   ├── sankey.py
|   |   ├── scale.py
|   |   ├── sphinxext
|   |   |   ├── __init__.py
|   |   |   ├── mathmpl.py
|   |   |   └── plot_directive.py
|   |   ├── spines.py
|   |   ├── stackplot.py
|   |   ├── streamplot.py
|   |   ├── style
|   |   |   ├── __init__.py
|   |   |   └── core.py
|   |   ├── table.py
|   |   ├── testing
|   |   |   ├── __init__.py
|   |   |   ├── _markers.py
|   |   |   ├── compare.py
|   |   |   ├── conftest.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── jpl_units
|   |   |   |   ├── Duration.py
|   |   |   |   ├── Epoch.py
|   |   |   |   ├── EpochConverter.py
|   |   |   |   ├── StrConverter.py
|   |   |   |   ├── UnitDbl.py
|   |   |   |   ├── UnitDblConverter.py
|   |   |   |   ├── UnitDblFormatter.py
|   |   |   |   └── __init__.py
|   |   |   └── widgets.py
|   |   ├── tests
|   |   |   ├── __init__.py
|   |   |   ├── baseline_images
|   |   |   |   ├── dviread
|   |   |   |   ├── pngsuite
|   |   |   |   ├── test_agg
|   |   |   |   ├── test_agg_filter
|   |   |   |   ├── test_arrow_patches
|   |   |   |   ├── test_artist
|   |   |   |   ├── test_axes
|   |   |   |   ├── test_backend_pdf
|   |   |   |   ├── test_backend_pgf
|   |   |   |   ├── test_backend_ps
|   |   |   |   ├── test_backend_svg
|   |   |   |   ├── test_bbox_tight
|   |   |   |   ├── test_collections
|   |   |   |   ├── test_colorbar
|   |   |   |   ├── test_colors
|   |   |   |   ├── test_compare_images
|   |   |   |   ├── test_constrainedlayout
|   |   |   |   ├── test_contour
|   |   |   |   ├── test_dates
|   |   |   |   ├── test_figure
|   |   |   |   ├── test_image
|   |   |   |   ├── test_legend
|   |   |   |   ├── test_lines
|   |   |   |   ├── test_mathtext
|   |   |   |   ├── test_offsetbox
|   |   |   |   ├── test_patches
|   |   |   |   ├── test_path
|   |   |   |   ├── test_patheffects
|   |   |   |   ├── test_png
|   |   |   |   ├── test_polar
|   |   |   |   ├── test_quiver
|   |   |   |   ├── test_scale
|   |   |   |   ├── test_simplification
|   |   |   |   ├── test_skew
|   |   |   |   ├── test_spines
|   |   |   |   ├── test_streamplot
|   |   |   |   ├── test_subplots
|   |   |   |   ├── test_table
|   |   |   |   ├── test_text
|   |   |   |   ├── test_tightlayout
|   |   |   |   ├── test_transforms
|   |   |   |   ├── test_triangulation
|   |   |   |   ├── test_ttconv
|   |   |   |   ├── test_units
|   |   |   |   ├── test_usetex
|   |   |   |   └── test_widgets
|   |   |   ├── conftest.py
|   |   |   ├── test_afm.py
|   |   |   ├── test_agg.py
|   |   |   ├── test_agg_filter.py
|   |   |   ├── test_animation.py
|   |   |   ├── test_api.py
|   |   |   ├── test_arrow_patches.py
|   |   |   ├── test_artist.py
|   |   |   ├── test_axes.py
|   |   |   ├── test_backend_bases.py
|   |   |   ├── test_backend_cairo.py
|   |   |   ├── test_backend_gtk3.py
|   |   |   ├── test_backend_macosx.py
|   |   |   ├── test_backend_nbagg.py
|   |   |   ├── test_backend_pdf.py
|   |   |   ├── test_backend_pgf.py
|   |   |   ├── test_backend_ps.py
|   |   |   ├── test_backend_qt.py
|   |   |   ├── test_backend_svg.py
|   |   |   ├── test_backend_template.py
|   |   |   ├── test_backend_tk.py
|   |   |   ├── test_backend_tools.py
|   |   |   ├── test_backend_webagg.py
|   |   |   ├── test_backends_interactive.py
|   |   |   ├── test_basic.py
|   |   |   ├── test_bbox_tight.py
|   |   |   ├── test_category.py
|   |   |   ├── test_cbook.py
|   |   |   ├── test_collections.py
|   |   |   ├── test_colorbar.py
|   |   |   ├── test_colors.py
|   |   |   ├── test_compare_images.py
|   |   |   ├── test_constrainedlayout.py
|   |   |   ├── test_container.py
|   |   |   ├── test_contour.py
|   |   |   ├── test_cycles.py
|   |   |   ├── test_dates.py
|   |   |   ├── test_determinism.py
|   |   |   ├── test_doc.py
|   |   |   ├── test_dviread.py
|   |   |   ├── test_figure.py
|   |   |   ├── test_font_manager.py
|   |   |   ├── test_fontconfig_pattern.py
|   |   |   ├── test_ft2font.py
|   |   |   ├── test_getattr.py
|   |   |   ├── test_gridspec.py
|   |   |   ├── test_image.py
|   |   |   ├── test_legend.py
|   |   |   ├── test_lines.py
|   |   |   ├── test_marker.py
|   |   |   ├── test_mathtext.py
|   |   |   ├── test_matplotlib.py
|   |   |   ├── test_mlab.py
|   |   |   ├── test_offsetbox.py
|   |   |   ├── test_patches.py
|   |   |   ├── test_path.py
|   |   |   ├── test_patheffects.py
|   |   |   ├── test_pickle.py
|   |   |   ├── test_png.py
|   |   |   ├── test_polar.py
|   |   |   ├── test_preprocess_data.py
|   |   |   ├── test_pyplot.py
|   |   |   ├── test_quiver.py
|   |   |   ├── test_rcparams.py
|   |   |   ├── test_sankey.py
|   |   |   ├── test_scale.py
|   |   |   ├── test_simplification.py
|   |   |   ├── test_skew.py
|   |   |   ├── test_sphinxext.py
|   |   |   ├── test_spines.py
|   |   |   ├── test_streamplot.py
|   |   |   ├── test_style.py
|   |   |   ├── test_subplots.py
|   |   |   ├── test_table.py
|   |   |   ├── test_testing.py
|   |   |   ├── test_texmanager.py
|   |   |   ├── test_text.py
|   |   |   ├── test_textpath.py
|   |   |   ├── test_ticker.py
|   |   |   ├── test_tightlayout.py
|   |   |   ├── test_transforms.py
|   |   |   ├── test_triangulation.py
|   |   |   ├── test_ttconv.py
|   |   |   ├── test_type1font.py
|   |   |   ├── test_units.py
|   |   |   ├── test_usetex.py
|   |   |   ├── test_widgets.py
|   |   |   └── tinypages
|   |   |       ├── README.md
|   |   |       ├── _static
|   |   |       ├── conf.py
|   |   |       ├── included_plot_21.rst
|   |   |       ├── index.rst
|   |   |       ├── range4.py
|   |   |       ├── range6.py
|   |   |       └── some_plots.rst
|   |   ├── texmanager.py
|   |   ├── text.py
|   |   ├── textpath.py
|   |   ├── ticker.py
|   |   ├── transforms.py
|   |   ├── tri
|   |   |   ├── __init__.py
|   |   |   ├── _triangulation.py
|   |   |   ├── _tricontour.py
|   |   |   ├── _trifinder.py
|   |   |   ├── _triinterpolate.py
|   |   |   ├── _tripcolor.py
|   |   |   ├── _triplot.py
|   |   |   ├── _trirefine.py
|   |   |   ├── _tritools.py
|   |   |   ├── triangulation.py
|   |   |   ├── tricontour.py
|   |   |   ├── trifinder.py
|   |   |   ├── triinterpolate.py
|   |   |   ├── tripcolor.py
|   |   |   ├── triplot.py
|   |   |   ├── trirefine.py
|   |   |   └── tritools.py
|   |   ├── units.py
|   |   └── widgets.py
|   ├── mpl_toolkits
|   |   ├── __init__.py
|   |   ├── axes_grid1
|   |   |   ├── __init__.py
|   |   |   ├── anchored_artists.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axes_size.py
|   |   |   ├── inset_locator.py
|   |   |   ├── mpl_axes.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       └── test_axes_grid1.py
|   |   ├── axisartist
|   |   |   ├── __init__.py
|   |   |   ├── angle_helper.py
|   |   |   ├── axes_divider.py
|   |   |   ├── axes_grid.py
|   |   |   ├── axes_rgb.py
|   |   |   ├── axis_artist.py
|   |   |   ├── axisline_style.py
|   |   |   ├── axislines.py
|   |   |   ├── floating_axes.py
|   |   |   ├── grid_finder.py
|   |   |   ├── grid_helper_curvelinear.py
|   |   |   ├── parasite_axes.py
|   |   |   └── tests
|   |   |       ├── __init__.py
|   |   |       ├── baseline_images
|   |   |       ├── conftest.py
|   |   |       ├── test_angle_helper.py
|   |   |       ├── test_axis_artist.py
|   |   |       ├── test_axislines.py
|   |   |       ├── test_floating_axes.py
|   |   |       ├── test_grid_finder.py
|   |   |       └── test_grid_helper_curvelinear.py
|   |   └── mplot3d
|   |       ├── __init__.py
|   |       ├── art3d.py
|   |       ├── axes3d.py
|   |       ├── axis3d.py
|   |       ├── proj3d.py
|   |       └── tests
|   |           ├── __init__.py
|   |           ├── baseline_images
|   |           ├── conftest.py
|   |           ├── test_art3d.py
|   |           ├── test_axes3d.py
|   |           └── test_legend3d.py
|   └── pylab.py
├── requirements
|   ├── dev
|   |   └── dev-requirements.txt
|   ├── doc
|   |   └── doc-requirements.txt
|   └── testing
|       ├── all.txt
|       ├── extra.txt
|       ├── flake8.txt
|       └── minver.txt
├── setup.py
├── setupext.py
├── src
|   ├── _backend_agg.cpp
|   ├── _backend_agg_wrapper.cpp
|   ├── _c_internal_utils.c
|   ├── _image_wrapper.cpp
|   ├── _path_wrapper.cpp
|   ├── _qhull_wrapper.cpp
|   ├── _tkagg.cpp
|   ├── _ttconv.cpp
|   ├── checkdep_freetype2.c
|   ├── doc
|   ├── ft2font.cpp
|   ├── ft2font_wrapper.cpp
|   ├── py_converters.cpp
|   └── tri
|       ├── _tri.cpp
|       └── _tri_wrapper.cpp
└── tools
    ├── README.txt
    ├── boilerplate.py
    ├── cache_zenodo_svg.py
    ├── create_DejaVuDisplay.sh
    ├── embed_js.py
    ├── gh_api.py
    ├── github_stats.py
    ├── make_icons.py
    ├── memleak.py
    ├── run_examples.py
    ├── subset.py
    ├── triage_tests.py
    └── visualize_tests.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: [Bug]: Unable to pickle figure with aligned labels

Description: ### Bug summary

 Unable to pickle figure after calling `align_labels()`

### Code for reproduction

```python
import matplotlib.pyplot as plt
import pickle

fig = plt.figure()
ax1 = fig.add_subplot(211)
ax2 = fig.add_subplot(212)
time=[0,1,2,3,4]
speed=[40000,4300,4500,4700,4800]
acc=[10,11,12,13,14]
ax1.plot(time,speed)
ax1.set_ylabel('speed')
ax2.plot(time,acc)
ax2.set_ylabel('acc')

fig.align_labels() ##pickling works after removing this line 

pickle.dumps(fig)
plt.show()
```


### Actual outcome
```
align.py", line 16
pickle.dumps(fig)
TypeError: cannot pickle 'weakref.ReferenceType' object
```
### Expected outcome

Pickling successful

### Additional information

_No response_

### Operating system

Windows

### Matplotlib Version

3.7.0

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

None

Patch information:
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index b4c38368bf..6a57554d0c 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -3174,12 +3174,25 @@ None}, default: None
         from matplotlib import _pylab_helpers
         if self.canvas.manager in _pylab_helpers.Gcf.figs.values():
             state['_restore_to_pylab'] = True
+
+        # Serialize align label groups to avoid pickling weakrefs from Grouper
+        try:
+            state["_align_label_groups"] = {
+                name: [group for group in self._align_label_groups[name]]
+                for name in ("x", "y")
+            }
+        except Exception:
+            # Fallback to empty alignment info if serialization fails
+            state["_align_label_groups"] = {"x": [], "y": []}
         return state
 
     def __setstate__(self, state):
         version = state.pop('__mpl_version__')
         restore_to_pylab = state.pop('_restore_to_pylab', False)
 
+        # Extract serialized align label groups if present
+        serialized_align = state.pop("_align_label_groups", None)
+
         if version != mpl.__version__:
             _api.warn_external(
                 f"This figure was saved with matplotlib version {version} and "
@@ -3187,6 +3200,17 @@ None}, default: None
 
         self.__dict__ = state
 
+        # Rebuild align label groupers
+        self._align_label_groups = {"x": cbook.Grouper(), "y": cbook.Grouper()}
+        if serialized_align is not None:
+            for name in ("x", "y"):
+                groups = serialized_align.get(name, [])
+                for group in groups:
+                    # group is a list of Axes (or None if dead); filter Nones
+                    members = [m for m in group if m is not None]
+                    if len(members) > 1:
+                        self._align_label_groups[name].join(*members)
+
         # re-initialise some of the unstored state information
         FigureCanvasBase(self)  # Set self.canvas.
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of lib/matplotlib/tests/test_figure.py
Extra Requirements: 
Purpose: I need to find existing test cases for pickling figures and for the `align_labels` method to satisfy the user's request.

Previous refined query 2:
Essential Query: Please provide the full content of lib/matplotlib/tests/test_pickle.py
Extra Requirements: 
Purpose: I need to find more examples of how matplotlib figures are tested for pickling to find the most relevant examples for the user's bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: lib/matplotlib/tests/test_figure.py
Line number range: 1 - 500
Content:
1. import copy
2. from datetime import datetime
3. import io
4. from pathlib import Path
5. import pickle
6. import platform
7. from threading import Timer
8. from types import SimpleNamespace
9. import warnings
10. 
11. import numpy as np
12. import pytest
13. from PIL import Image
14. 
15. import matplotlib as mpl
16. from matplotlib import gridspec
17. from matplotlib.testing.decorators import image_comparison, check_figures_equal
18. from matplotlib.axes import Axes
19. from matplotlib.figure import Figure, FigureBase
20. from matplotlib.layout_engine import (ConstrainedLayoutEngine,
21.                                       TightLayoutEngine,
22.                                       PlaceHolderLayoutEngine)
23. from matplotlib.ticker import AutoMinorLocator, FixedFormatter, ScalarFormatter
24. import matplotlib.pyplot as plt
25. import matplotlib.dates as mdates
26. 
27. 
28. @image_comparison(['figure_align_labels'], extensions=['png', 'svg'],
29.                   tol=0 if platform.machine() == 'x86_64' else 0.01)
30. def test_align_labels():
31.     fig = plt.figure(layout='tight')
32.     gs = gridspec.GridSpec(3, 3)
33. 
34.     ax = fig.add_subplot(gs[0, :2])
35.     ax.plot(np.arange(0, 1e6, 1000))
36.     ax.set_ylabel('Ylabel0 0')
37.     ax = fig.add_subplot(gs[0, -1])
38.     ax.plot(np.arange(0, 1e4, 100))
39. 
40.     for i in range(3):
41.         ax = fig.add_subplot(gs[1, i])
42.         ax.set_ylabel('YLabel1 %d' % i)
43.         ax.set_xlabel('XLabel1 %d' % i)
44.         if i in [0, 2]:
45.             ax.xaxis.set_label_position("top")
46.             ax.xaxis.tick_top()
47.         if i == 0:
48.             for tick in ax.get_xticklabels():
49.                 tick.set_rotation(90)
50.         if i == 2:
51.             ax.yaxis.set_label_position("right")
52.             ax.yaxis.tick_right()
53. 
54.     for i in range(3):
55.         ax = fig.add_subplot(gs[2, i])
56.         ax.set_xlabel(f'XLabel2 {i}')
57.         ax.set_ylabel(f'YLabel2 {i}')
58. 
59.         if i == 2:
60.             ax.plot(np.arange(0, 1e4, 10))
61.             ax.yaxis.set_label_position("right")
62.             ax.yaxis.tick_right()
63.             for tick in ax.get_xticklabels():
64.                 tick.set_rotation(90)
65. 
66.     fig.align_labels()
67. 
68. 
69. def test_align_labels_stray_axes():
70.     fig, axs = plt.subplots(2, 2)
71.     for nn, ax in enumerate(axs.flat):
72.         ax.set_xlabel('Boo')
73.         ax.set_xlabel('Who')
74.         ax.plot(np.arange(4)**nn, np.arange(4)**nn)
75.     fig.align_ylabels()
76.     fig.align_xlabels()
77.     fig.draw_without_rendering()
78.     xn = np.zeros(4)
79.     yn = np.zeros(4)
80.     for nn, ax in enumerate(axs.flat):
81.         yn[nn] = ax.xaxis.label.get_position()[1]
82.         xn[nn] = ax.yaxis.label.get_position()[0]
83.     np.testing.assert_allclose(xn[:2], xn[2:])
84.     np.testing.assert_allclose(yn[::2], yn[1::2])
85. 
86.     fig, axs = plt.subplots(2, 2, constrained_layout=True)
87.     for nn, ax in enumerate(axs.flat):
88.         ax.set_xlabel('Boo')
89.         ax.set_xlabel('Who')
90.         pc = ax.pcolormesh(np.random.randn(10, 10))
91.     fig.colorbar(pc, ax=ax)
92.     fig.align_ylabels()
93.     fig.align_xlabels()
94.     fig.draw_without_rendering()
95.     xn = np.zeros(4)
96.     yn = np.zeros(4)
97.     for nn, ax in enumerate(axs.flat):
98.         yn[nn] = ax.xaxis.label.get_position()[1]
99.         xn[nn] = ax.yaxis.label.get_position()[0]
100.     np.testing.assert_allclose(xn[:2], xn[2:])
101.     np.testing.assert_allclose(yn[::2], yn[1::2])
102. 
103. 
104. def test_figure_label():
105.     # pyplot figure creation, selection, and closing with label/number/instance
106.     plt.close('all')
107.     fig_today = plt.figure('today')
108.     plt.figure(3)
109.     plt.figure('tomorrow')
110.     plt.figure()
111.     plt.figure(0)
112.     plt.figure(1)
113.     plt.figure(3)
114.     assert plt.get_fignums() == [0, 1, 3, 4, 5]
115.     assert plt.get_figlabels() == ['', 'today', '', 'tomorrow', '']
116.     plt.close(10)
117.     plt.close()
118.     plt.close(5)
119.     plt.close('tomorrow')
120.     assert plt.get_fignums() == [0, 1]
121.     assert plt.get_figlabels() == ['', 'today']
122.     plt.figure(fig_today)
123.     assert plt.gcf() == fig_today
124.     with pytest.raises(ValueError):
125.         plt.figure(Figure())
126. 
127. 
128. def test_fignum_exists():
129.     # pyplot figure creation, selection and closing with fignum_exists
130.     plt.figure('one')
131.     plt.figure(2)
132.     plt.figure('three')
133.     plt.figure()
134.     assert plt.fignum_exists('one')
135.     assert plt.fignum_exists(2)
136.     assert plt.fignum_exists('three')
137.     assert plt.fignum_exists(4)
138.     plt.close('one')
139.     plt.close(4)
140.     assert not plt.fignum_exists('one')
141.     assert not plt.fignum_exists(4)
142. 
143. 
144. def test_clf_keyword():
145.     # test if existing figure is cleared with figure() and subplots()
146.     text1 = 'A fancy plot'
147.     text2 = 'Really fancy!'
148. 
149.     fig0 = plt.figure(num=1)
150.     fig0.suptitle(text1)
151.     assert [t.get_text() for t in fig0.texts] == [text1]
152. 
153.     fig1 = plt.figure(num=1, clear=False)
154.     fig1.text(0.5, 0.5, text2)
155.     assert fig0 is fig1
156.     assert [t.get_text() for t in fig1.texts] == [text1, text2]
157. 
158.     fig2, ax2 = plt.subplots(2, 1, num=1, clear=True)
159.     assert fig0 is fig2
160.     assert [t.get_text() for t in fig2.texts] == []
161. 
162. 
163. @image_comparison(['figure_today'])
164. def test_figure():
165.     # named figure support
166.     fig = plt.figure('today')
167.     ax = fig.add_subplot()
168.     ax.set_title(fig.get_label())
169.     ax.plot(np.arange(5))
170.     # plot red line in a different figure.
171.     plt.figure('tomorrow')
172.     plt.plot([0, 1], [1, 0], 'r')
173.     # Return to the original; make sure the red line is not there.
174.     plt.figure('today')
175.     plt.close('tomorrow')
176. 
177. 
178. @image_comparison(['figure_legend'])
179. def test_figure_legend():
180.     fig, axs = plt.subplots(2)
181.     axs[0].plot([0, 1], [1, 0], label='x', color='g')
182.     axs[0].plot([0, 1], [0, 1], label='y', color='r')
183.     axs[0].plot([0, 1], [0.5, 0.5], label='y', color='k')
184. 
185.     axs[1].plot([0, 1], [1, 0], label='_y', color='r')
186.     axs[1].plot([0, 1], [0, 1], label='z', color='b')
187.     fig.legend()
188. 
189. 
190. def test_gca():
191.     fig = plt.figure()
192. 
193.     # test that gca() picks up Axes created via add_axes()
194.     ax0 = fig.add_axes([0, 0, 1, 1])
195.     assert fig.gca() is ax0
196. 
197.     # test that gca() picks up Axes created via add_subplot()
198.     ax1 = fig.add_subplot(111)
199.     assert fig.gca() is ax1
200. 
201.     # add_axes on an existing Axes should not change stored order, but will
202.     # make it current.
203.     fig.add_axes(ax0)
204.     assert fig.axes == [ax0, ax1]
205.     assert fig.gca() is ax0
206. 
207.     # sca() should not change stored order of Axes, which is order added.
208.     fig.sca(ax0)
209.     assert fig.axes == [ax0, ax1]
210. 
211.     # add_subplot on an existing Axes should not change stored order, but will
212.     # make it current.
213.     fig.add_subplot(ax1)
214.     assert fig.axes == [ax0, ax1]
215.     assert fig.gca() is ax1
216. 
217. 
218. def test_add_subplot_subclass():
219.     fig = plt.figure()
220.     fig.add_subplot(axes_class=Axes)
221.     with pytest.raises(ValueError):
222.         fig.add_subplot(axes_class=Axes, projection="3d")
223.     with pytest.raises(ValueError):
224.         fig.add_subplot(axes_class=Axes, polar=True)
225.     with pytest.raises(ValueError):
226.         fig.add_subplot(projection="3d", polar=True)
227.     with pytest.raises(TypeError):
228.         fig.add_subplot(projection=42)
229. 
230. 
231. def test_add_subplot_invalid():
232.     fig = plt.figure()
233.     with pytest.raises(ValueError,
234.                        match='Number of columns must be a positive integer'):
235.         fig.add_subplot(2, 0, 1)
236.     with pytest.raises(ValueError,
237.                        match='Number of rows must be a positive integer'):
238.         fig.add_subplot(0, 2, 1)
239.     with pytest.raises(ValueError, match='num must be an integer with '
240.                                          '1 <= num <= 4'):
241.         fig.add_subplot(2, 2, 0)
242.     with pytest.raises(ValueError, match='num must be an integer with '
243.                                          '1 <= num <= 4'):
244.         fig.add_subplot(2, 2, 5)
245.     with pytest.raises(ValueError, match='num must be an integer with '
246.                                          '1 <= num <= 4'):
247.         fig.add_subplot(2, 2, 0.5)
248. 
249.     with pytest.raises(ValueError, match='must be a three-digit integer'):
250.         fig.add_subplot(42)
251.     with pytest.raises(ValueError, match='must be a three-digit integer'):
252.         fig.add_subplot(1000)
253. 
254.     with pytest.raises(TypeError, match='takes 1 or 3 positional arguments '
255.                                         'but 2 were given'):
256.         fig.add_subplot(2, 2)
257.     with pytest.raises(TypeError, match='takes 1 or 3 positional arguments '
258.                                         'but 4 were given'):
259.         fig.add_subplot(1, 2, 3, 4)
260.     with pytest.raises(ValueError,
261.                        match="Number of rows must be a positive integer, "
262.                              "not '2'"):
263.         fig.add_subplot('2', 2, 1)
264.     with pytest.raises(ValueError,
265.                        match='Number of columns must be a positive integer, '
266.                              'not 2.0'):
267.         fig.add_subplot(2, 2.0, 1)
268.     _, ax = plt.subplots()
269.     with pytest.raises(ValueError,
270.                        match='The Axes must have been created in the '
271.                              'present figure'):
272.         fig.add_subplot(ax)
273. 
274. 
275. @image_comparison(['figure_suptitle'])
276. def test_suptitle():
277.     fig, _ = plt.subplots()
278.     fig.suptitle('hello', color='r')
279.     fig.suptitle('title', color='g', rotation=30)
280. 
281. 
282. def test_suptitle_fontproperties():
283.     fig, ax = plt.subplots()
284.     fps = mpl.font_manager.FontProperties(size='large', weight='bold')
285.     txt = fig.suptitle('fontprops title', fontproperties=fps)
286.     assert txt.get_fontsize() == fps.get_size_in_points()
287.     assert txt.get_weight() == fps.get_weight()
288. 
289. 
290. def test_suptitle_subfigures():
291.     fig = plt.figure(figsize=(4, 3))
292.     sf1, sf2 = fig.subfigures(1, 2)
293.     sf2.set_facecolor('white')
294.     sf1.subplots()
295.     sf2.subplots()
296.     fig.suptitle("This is a visible suptitle.")
297. 
298.     # verify the first subfigure facecolor is the default transparent
299.     assert sf1.get_facecolor() == (0.0, 0.0, 0.0, 0.0)
300.     # verify the second subfigure facecolor is white
301.     assert sf2.get_facecolor() == (1.0, 1.0, 1.0, 1.0)
302. 
303. 
304. @image_comparison(['alpha_background'],
305.                   # only test png and svg. The PDF output appears correct,
306.                   # but Ghostscript does not preserve the background color.
307.                   extensions=['png', 'svg'],
308.                   savefig_kwarg={'facecolor': (0, 1, 0.4),
309.                                  'edgecolor': 'none'})
310. def test_alpha():
311.     # We want an image which has a background color and an alpha of 0.4.
312.     fig = plt.figure(figsize=[2, 1])
313.     fig.set_facecolor((0, 1, 0.4))
314.     fig.patch.set_alpha(0.4)
315.     fig.patches.append(mpl.patches.CirclePolygon(
316.         [20, 20], radius=15, alpha=0.6, facecolor='red'))
317. 
318. 
319. def test_too_many_figures():
320.     with pytest.warns(RuntimeWarning):
321.         for i in range(mpl.rcParams['figure.max_open_warning'] + 1):
322.             plt.figure()
323. 
324. 
325. def test_iterability_axes_argument():
326. 
327.     # This is a regression test for matplotlib/matplotlib#3196. If one of the
328.     # arguments returned by _as_mpl_axes defines __getitem__ but is not
329.     # iterable, this would raise an exception. This is because we check
330.     # whether the arguments are iterable, and if so we try and convert them
331.     # to a tuple. However, the ``iterable`` function returns True if
332.     # __getitem__ is present, but some classes can define __getitem__ without
333.     # being iterable. The tuple conversion is now done in a try...except in
334.     # case it fails.
335. 
336.     class MyAxes(Axes):
337.         def __init__(self, *args, myclass=None, **kwargs):
338.             Axes.__init__(self, *args, **kwargs)
339. 
340.     class MyClass:
341. 
342.         def __getitem__(self, item):
343.             if item != 'a':
344.                 raise ValueError("item should be a")
345. 
346.         def _as_mpl_axes(self):
347.             return MyAxes, {'myclass': self}
348. 
349.     fig = plt.figure()
350.     fig.add_subplot(1, 1, 1, projection=MyClass())
351.     plt.close(fig)
352. 
353. 
354. def test_set_fig_size():
355.     fig = plt.figure()
356. 
357.     # check figwidth
358.     fig.set_figwidth(5)
359.     assert fig.get_figwidth() == 5
360. 
361.     # check figheight
362.     fig.set_figheight(1)
363.     assert fig.get_figheight() == 1
364. 
365.     # check using set_size_inches
366.     fig.set_size_inches(2, 4)
367.     assert fig.get_figwidth() == 2
368.     assert fig.get_figheight() == 4
369. 
370.     # check using tuple to first argument
371.     fig.set_size_inches((1, 3))
372.     assert fig.get_figwidth() == 1
373.     assert fig.get_figheight() == 3
374. 
375. 
376. def test_axes_remove():
377.     fig, axs = plt.subplots(2, 2)
378.     axs[-1, -1].remove()
379.     for ax in axs.ravel()[:-1]:
380.         assert ax in fig.axes
381.     assert axs[-1, -1] not in fig.axes
382.     assert len(fig.axes) == 3
383. 
384. 
385. def test_figaspect():
386.     w, h = plt.figaspect(np.float64(2) / np.float64(1))
387.     assert h / w == 2
388.     w, h = plt.figaspect(2)
389.     assert h / w == 2
390.     w, h = plt.figaspect(np.zeros((1, 2)))
391.     assert h / w == 0.5
392.     w, h = plt.figaspect(np.zeros((2, 2)))
393.     assert h / w == 1
394. 
395. 
396. @pytest.mark.parametrize('which', ['both', 'major', 'minor'])
397. def test_autofmt_xdate(which):
398.     date = ['3 Jan 2013', '4 Jan 2013', '5 Jan 2013', '6 Jan 2013',
399.             '7 Jan 2013', '8 Jan 2013', '9 Jan 2013', '10 Jan 2013',
400.             '11 Jan 2013', '12 Jan 2013', '13 Jan 2013', '14 Jan 2013']
401. 
402.     time = ['16:44:00', '16:45:00', '16:46:00', '16:47:00', '16:48:00',
403.             '16:49:00', '16:51:00', '16:52:00', '16:53:00', '16:55:00',
404.             '16:56:00', '16:57:00']
405. 
406.     angle = 60
407.     minors = [1, 2, 3, 4, 5, 6, 7]
408. 
409.     x = mdates.datestr2num(date)
410.     y = mdates.datestr2num(time)
411. 
412.     fig, ax = plt.subplots()
413. 
414.     ax.plot(x, y)
415.     ax.yaxis_date()
416.     ax.xaxis_date()
417. 
418.     ax.xaxis.set_minor_locator(AutoMinorLocator(2))
419.     with warnings.catch_warnings():
420.         warnings.filterwarnings(
421.             'ignore',
422.             'FixedFormatter should only be used together with FixedLocator')
423.         ax.xaxis.set_minor_formatter(FixedFormatter(minors))
424. 
425.     fig.autofmt_xdate(0.2, angle, 'right', which)
426. 
427.     if which in ('both', 'major'):
428.         for label in fig.axes[0].get_xticklabels(False, 'major'):
429.             assert int(label.get_rotation()) == angle
430. 
431.     if which in ('both', 'minor'):
432.         for label in fig.axes[0].get_xticklabels(True, 'minor'):
433.             assert int(label.get_rotation()) == angle
434. 
435. 
436. @mpl.style.context('default')
437. def test_change_dpi():
438.     fig = plt.figure(figsize=(4, 4))
439.     fig.draw_without_rendering()
440.     assert fig.canvas.renderer.height == 400
441.     assert fig.canvas.renderer.width == 400
442.     fig.dpi = 50
443.     fig.draw_without_rendering()
444.     assert fig.canvas.renderer.height == 200
445.     assert fig.canvas.renderer.width == 200
446. 
447. 
448. @pytest.mark.parametrize('width, height', [
449.     (1, np.nan),
450.     (-1, 1),
451.     (np.inf, 1)
452. ])
453. def test_invalid_figure_size(width, height):
454.     with pytest.raises(ValueError):
455.         plt.figure(figsize=(width, height))
456. 
457.     fig = plt.figure()
458.     with pytest.raises(ValueError):
459.         fig.set_size_inches(width, height)
460. 
461. 
462. def test_invalid_figure_add_axes():
463.     fig = plt.figure()
464.     with pytest.raises(TypeError,
465.                        match="missing 1 required positional argument: 'rect'"):
466.         fig.add_axes()
467. 
468.     with pytest.raises(ValueError):
469.         fig.add_axes((.1, .1, .5, np.nan))
470. 
471.     with pytest.raises(TypeError, match="multiple values for argument 'rect'"):
472.         fig.add_axes([0, 0, 1, 1], rect=[0, 0, 1, 1])
473. 
474.     _, ax = plt.subplots()
475.     with pytest.raises(ValueError,
476.                        match="The Axes must have been created in the present "
477.                              "figure"):
478.         fig.add_axes(ax)
479. 
480. 
481. def test_subplots_shareax_loglabels():
482.     fig, axs = plt.subplots(2, 2, sharex=True, sharey=True, squeeze=False)
483.     for ax in axs.flat:
484.         ax.plot([10, 20, 30], [10, 20, 30])
485. 
486.     ax.set_yscale("log")
487.     ax.set_xscale("log")
488. 
489.     for ax in axs[0, :]:
490.         assert 0 == len(ax.xaxis.get_ticklabels(which='both'))
491. 
492.     for ax in axs[1, :]:
493.         assert 0 < len(ax.xaxis.get_ticklabels(which='both'))
494. 
495.     for ax in axs[:, 1]:
496.         assert 0 == len(ax.yaxis.get_ticklabels(which='both'))
497. 
498.     for ax in axs[:, 0]:
499.         assert 0 < len(ax.yaxis.get_ticklabels(which='both'))
500. 


File: lib/matplotlib/tests/test_figure.py
Line number range: 1537 - 1542
Content:
1537. def test_unpickle_with_device_pixel_ratio():
1538.     fig = Figure(dpi=42)
1539.     fig.canvas._set_device_pixel_ratio(7)
1540.     assert fig.dpi == 42*7
1541.     fig2 = pickle.loads(pickle.dumps(fig))
1542.     assert fig2.dpi == 42


File: lib/matplotlib/tests/test_pickle.py
Line number range: 1 - 284
Content:
1. from io import BytesIO
2. import ast
3. import pickle
4. 
5. import numpy as np
6. import pytest
7. 
8. import matplotlib as mpl
9. from matplotlib import cm
10. from matplotlib.testing import subprocess_run_helper
11. from matplotlib.testing.decorators import check_figures_equal
12. from matplotlib.dates import rrulewrapper
13. from matplotlib.lines import VertexSelector
14. import matplotlib.pyplot as plt
15. import matplotlib.transforms as mtransforms
16. import matplotlib.figure as mfigure
17. from mpl_toolkits.axes_grid1 import parasite_axes
18. 
19. 
20. def test_simple():
21.     fig = plt.figure()
22.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
23. 
24.     ax = plt.subplot(121)
25.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
26. 
27.     ax = plt.axes(projection='polar')
28.     plt.plot(np.arange(10), label='foobar')
29.     plt.legend()
30. 
31.     pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
32. 
33. #    ax = plt.subplot(121, projection='hammer')
34. #    pickle.dump(ax, BytesIO(), pickle.HIGHEST_PROTOCOL)
35. 
36.     plt.figure()
37.     plt.bar(x=np.arange(10), height=np.arange(10))
38.     pickle.dump(plt.gca(), BytesIO(), pickle.HIGHEST_PROTOCOL)
39. 
40.     fig = plt.figure()
41.     ax = plt.axes()
42.     plt.plot(np.arange(10))
43.     ax.set_yscale('log')
44.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
45. 
46. 
47. def _generate_complete_test_figure(fig_ref):
48.     fig_ref.set_size_inches((10, 6))
49.     plt.figure(fig_ref)
50. 
51.     plt.suptitle('Can you fit any more in a figure?')
52. 
53.     # make some arbitrary data
54.     x, y = np.arange(8), np.arange(10)
55.     data = u = v = np.linspace(0, 10, 80).reshape(10, 8)
56.     v = np.sin(v * -0.6)
57. 
58.     # Ensure lists also pickle correctly.
59.     plt.subplot(3, 3, 1)
60.     plt.plot(list(range(10)))
61. 
62.     plt.subplot(3, 3, 2)
63.     plt.contourf(data, hatches=['//', 'ooo'])
64.     plt.colorbar()
65. 
66.     plt.subplot(3, 3, 3)
67.     plt.pcolormesh(data)
68. 
69.     plt.subplot(3, 3, 4)
70.     plt.imshow(data)
71. 
72.     plt.subplot(3, 3, 5)
73.     plt.pcolor(data)
74. 
75.     ax = plt.subplot(3, 3, 6)
76.     ax.set_xlim(0, 7)
77.     ax.set_ylim(0, 9)
78.     plt.streamplot(x, y, u, v)
79. 
80.     ax = plt.subplot(3, 3, 7)
81.     ax.set_xlim(0, 7)
82.     ax.set_ylim(0, 9)
83.     plt.quiver(x, y, u, v)
84. 
85.     plt.subplot(3, 3, 8)
86.     plt.scatter(x, x ** 2, label='$x^2$')
87.     plt.legend(loc='upper left')
88. 
89.     plt.subplot(3, 3, 9)
90.     plt.errorbar(x, x * -0.5, xerr=0.2, yerr=0.4)
91. 
92. 
93. @mpl.style.context("default")
94. @check_figures_equal(extensions=["png"])
95. def test_complete(fig_test, fig_ref):
96.     _generate_complete_test_figure(fig_ref)
97.     # plotting is done, now test its pickle-ability
98.     pkl = BytesIO()
99.     pickle.dump(fig_ref, pkl, pickle.HIGHEST_PROTOCOL)
100.     loaded = pickle.loads(pkl.getbuffer())
101.     loaded.canvas.draw()
102. 
103.     fig_test.set_size_inches(loaded.get_size_inches())
104.     fig_test.figimage(loaded.canvas.renderer.buffer_rgba())
105. 
106.     plt.close(loaded)
107. 
108. 
109. def _pickle_load_subprocess():
110.     import os
111.     import pickle
112. 
113.     path = os.environ['PICKLE_FILE_PATH']
114. 
115.     with open(path, 'rb') as blob:
116.         fig = pickle.load(blob)
117. 
118.     print(str(pickle.dumps(fig)))
119. 
120. 
121. @mpl.style.context("default")
122. @check_figures_equal(extensions=['png'])
123. def test_pickle_load_from_subprocess(fig_test, fig_ref, tmp_path):
124.     _generate_complete_test_figure(fig_ref)
125. 
126.     fp = tmp_path / 'sinus.pickle'
127.     assert not fp.exists()
128. 
129.     with fp.open('wb') as file:
130.         pickle.dump(fig_ref, file, pickle.HIGHEST_PROTOCOL)
131.     assert fp.exists()
132. 
133.     proc = subprocess_run_helper(
134.         _pickle_load_subprocess,
135.         timeout=60,
136.         extra_env={'PICKLE_FILE_PATH': str(fp)}
137.     )
138. 
139.     loaded_fig = pickle.loads(ast.literal_eval(proc.stdout))
140. 
141.     loaded_fig.canvas.draw()
142. 
143.     fig_test.set_size_inches(loaded_fig.get_size_inches())
144.     fig_test.figimage(loaded_fig.canvas.renderer.buffer_rgba())
145. 
146.     plt.close(loaded_fig)
147. 
148. 
149. def test_gcf():
150.     fig = plt.figure("a label")
151.     buf = BytesIO()
152.     pickle.dump(fig, buf, pickle.HIGHEST_PROTOCOL)
153.     plt.close("all")
154.     assert plt._pylab_helpers.Gcf.figs == {}  # No figures must be left.
155.     fig = pickle.loads(buf.getbuffer())
156.     assert plt._pylab_helpers.Gcf.figs != {}  # A manager is there again.
157.     assert fig.get_label() == "a label"
158. 
159. 
160. def test_no_pyplot():
161.     # tests pickle-ability of a figure not created with pyplot
162.     from matplotlib.backends.backend_pdf import FigureCanvasPdf
163.     fig = mfigure.Figure()
164.     _ = FigureCanvasPdf(fig)
165.     ax = fig.add_subplot(1, 1, 1)
166.     ax.plot([1, 2, 3], [1, 2, 3])
167.     pickle.dump(fig, BytesIO(), pickle.HIGHEST_PROTOCOL)
168. 
169. 
170. def test_renderer():
171.     from matplotlib.backends.backend_agg import RendererAgg
172.     renderer = RendererAgg(10, 20, 30)
173.     pickle.dump(renderer, BytesIO())
174. 
175. 
176. def test_image():
177.     # Prior to v1.4.0 the Image would cache data which was not picklable
178.     # once it had been drawn.
179.     from matplotlib.backends.backend_agg import new_figure_manager
180.     manager = new_figure_manager(1000)
181.     fig = manager.canvas.figure
182.     ax = fig.add_subplot(1, 1, 1)
183.     ax.imshow(np.arange(12).reshape(3, 4))
184.     manager.canvas.draw()
185.     pickle.dump(fig, BytesIO())
186. 
187. 
188. def test_polar():
189.     plt.subplot(polar=True)
190.     fig = plt.gcf()
191.     pf = pickle.dumps(fig)
192.     pickle.loads(pf)
193.     plt.draw()
194. 
195. 
196. class TransformBlob:
197.     def __init__(self):
198.         self.identity = mtransforms.IdentityTransform()
199.         self.identity2 = mtransforms.IdentityTransform()
200.         # Force use of the more complex composition.
201.         self.composite = mtransforms.CompositeGenericTransform(
202.             self.identity,
203.             self.identity2)
204.         # Check parent -> child links of TransformWrapper.
205.         self.wrapper = mtransforms.TransformWrapper(self.composite)
206.         # Check child -> parent links of TransformWrapper.
207.         self.composite2 = mtransforms.CompositeGenericTransform(
208.             self.wrapper,
209.             self.identity)
210. 
211. 
212. def test_transform():
213.     obj = TransformBlob()
214.     pf = pickle.dumps(obj)
215.     del obj
216. 
217.     obj = pickle.loads(pf)
218.     # Check parent -> child links of TransformWrapper.
219.     assert obj.wrapper._child == obj.composite
220.     # Check child -> parent links of TransformWrapper.
221.     assert [v() for v in obj.wrapper._parents.values()] == [obj.composite2]
222.     # Check input and output dimensions are set as expected.
223.     assert obj.wrapper.input_dims == obj.composite.input_dims
224.     assert obj.wrapper.output_dims == obj.composite.output_dims
225. 
226. 
227. def test_rrulewrapper():
228.     r = rrulewrapper(2)
229.     try:
230.         pickle.loads(pickle.dumps(r))
231.     except RecursionError:
232.         print('rrulewrapper pickling test failed')
233.         raise
234. 
235. 
236. def test_shared():
237.     fig, axs = plt.subplots(2, sharex=True)
238.     fig = pickle.loads(pickle.dumps(fig))
239.     fig.axes[0].set_xlim(10, 20)
240.     assert fig.axes[1].get_xlim() == (10, 20)
241. 
242. 
243. def test_inset_and_secondary():
244.     fig, ax = plt.subplots()
245.     ax.inset_axes([.1, .1, .3, .3])
246.     ax.secondary_xaxis("top", functions=(np.square, np.sqrt))
247.     pickle.loads(pickle.dumps(fig))
248. 
249. 
250. @pytest.mark.parametrize("cmap", cm._colormaps.values())
251. def test_cmap(cmap):
252.     pickle.dumps(cmap)
253. 
254. 
255. def test_unpickle_canvas():
256.     fig = mfigure.Figure()
257.     assert fig.canvas is not None
258.     out = BytesIO()
259.     pickle.dump(fig, out)
260.     out.seek(0)
261.     fig2 = pickle.load(out)
262.     assert fig2.canvas is not None
263. 
264. 
265. def test_mpl_toolkits():
266.     ax = parasite_axes.host_axes([0, 0, 1, 1])
267.     assert type(pickle.loads(pickle.dumps(ax))) == parasite_axes.HostAxes
268. 
269. 
270. def test_standard_norm():
271.     assert type(pickle.loads(pickle.dumps(mpl.colors.LogNorm()))) \
272.         == mpl.colors.LogNorm
273. 
274. 
275. def test_dynamic_norm():
276.     logit_norm_instance = mpl.colors.make_norm_from_scale(
277.         mpl.scale.LogitScale, mpl.colors.Normalize)()
278.     assert type(pickle.loads(pickle.dumps(logit_norm_instance))) \
279.         == type(logit_norm_instance)
280. 
281. 
282. def test_vertexselector():
283.     line, = plt.plot([0, 1], picker=True)
284.     pickle.loads(pickle.dumps(VertexSelector(line)))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 06:13:58,979 - thread-126586521126592.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="1. The user wants to find 3 relevant existing test cases for a bug involving pickling a `Figure` after calling `align_labels()`. \n2. I have reviewed the content of `lib/matplotlib/tests/test_figure.py` and `lib/matplotlib/tests/test_pickle.py`, which are the most relevant files for this task. \n3. These files contain several tests for figure pickling and for the `align_labels` functionality, although no single test combines both. \n4. I have identified three suitable, existing test cases that demonstrate how to test figure pickling in different scenarios (complex figure, figure with shared axes, and a simple property check). \n5. The provided context is sufficient to extract these test cases and fulfill the user's request. I do not need to request additional files or documentation." query='' extra_requirements='' purpose=''
2025-12-21 06:13:58,980 - thread-126586521126592.prometheus_context_collector - INFO - Successfully retrieved 3 context snippets
