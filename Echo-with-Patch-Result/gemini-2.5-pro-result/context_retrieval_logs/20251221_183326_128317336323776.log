2025-12-21 18:33:26,134 - thread-128317336323776.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Migration crashes deleting an index_together if there is a unique_together on the same fields

Description: Description
	
Happens with Django 1.11.10
Steps to reproduce:
1) Create models with 2 fields, add 2 same fields to unique_together and to index_together
2) Delete index_together -> Fail
It will fail at django/db/backends/base/schema.py, line 378, in _delete_composed_index(), ValueError: Found wrong number (2) of constraints for as this one will find two constraints, the _uniq and the _idx one. No way to get out of this...
The worst in my case is that happened as I wanted to refactor my code to use the "new" (Dj 1.11) Options.indexes feature. I am actually not deleting the index, just the way it is declared in my code.
I think there are 2 different points here:
1) The deletion of index_together should be possible alone or made coherent (migrations side?) with unique_together
2) Moving the declaration of an index should not result in an index re-creation

Patch information:
diff --git a/django/db/backends/base/schema.py b/django/db/backends/base/schema.py
index 61f88401ab..1f521cfc5c 100644
--- a/django/db/backends/base/schema.py
+++ b/django/db/backends/base/schema.py
@@ -393,7 +393,7 @@ class BaseDatabaseSchemaEditor:
         news = {tuple(fields) for fields in new_index_together}
         # Deleted indexes
         for fields in olds.difference(news):
-            self._delete_composed_index(model, fields, {'index': True}, self.sql_delete_index)
+            self._delete_composed_index(model, fields, {'index': True, 'unique': False}, self.sql_delete_index)
         # Created indexes
         for field_names in news.difference(olds):
             fields = [model._meta.get_field(field) for field in field_names]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 18:33:26,740 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   └── FUNDING.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── test_django_admin_py.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── asgi
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_password_reset_timeout_days.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   |   └── fixture2.xml
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_db_returning.py
    |   ├── test_deprecation.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   ├── test_is_ajax_deprecations.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_same_name_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── mutually_exclusive_required.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       ├── subparser_dest.py
    |   |       ├── subparser_required.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   ├── strip_tags1.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Migration crashes deleting an index_together if there is a unique_together on the same fields

Description: Description
	
Happens with Django 1.11.10
Steps to reproduce:
1) Create models with 2 fields, add 2 same fields to unique_together and to index_together
2) Delete index_together -> Fail
It will fail at django/db/backends/base/schema.py, line 378, in _delete_composed_index(), ValueError: Found wrong number (2) of constraints for as this one will find two constraints, the _uniq and the _idx one. No way to get out of this...
The worst in my case is that happened as I wanted to refactor my code to use the "new" (Dj 1.11) Options.indexes feature. I am actually not deleting the index, just the way it is declared in my code.
I think there are 2 different points here:
1) The deletion of index_together should be possible alone or made coherent (migrations side?) with unique_together
2) Moving the declaration of an index should not result in an index re-creation

Patch information:
diff --git a/django/db/backends/base/schema.py b/django/db/backends/base/schema.py
index 61f88401ab..1f521cfc5c 100644
--- a/django/db/backends/base/schema.py
+++ b/django/db/backends/base/schema.py
@@ -393,7 +393,7 @@ class BaseDatabaseSchemaEditor:
         news = {tuple(fields) for fields in new_index_together}
         # Deleted indexes
         for fields in olds.difference(news):
-            self._delete_composed_index(model, fields, {'index': True}, self.sql_delete_index)
+            self._delete_composed_index(model, fields, {'index': True, 'unique': False}, self.sql_delete_index)
         # Created indexes
         for field_names in news.difference(olds):
             fields = [model._meta.get_field(field) for field in field_names]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 18:34:09,653 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug report points to an issue in `django/db/backends/base/schema.py` when handling migrations involving `index_together` and `unique_together`. The most relevant tests are likely those that test the `SchemaEditor`. The file `tests/schema/tests.py` seems to be the main test file for the schema editor. I need its content to find tests related to index and constraint manipulation, especially for composed indexes. This is my first step in locating relevant test cases. I have no context to start with." query='Please provide the full content of `tests/schema/tests.py`.' extra_requirements='' purpose="I need to find test cases that cover the creation and deletion of composite indexes and unique constraints to identify tests relevant to the user's bug."
2025-12-21 18:34:09,655 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/schema/tests.py`.
2025-12-21 18:34:09,655 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 18:34:09,656 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 18:34:09,656 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 18:34:09,656 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/schema/tests.py`.
Purpose: I need to find test cases that cover the creation and deletion of composite indexes and unique constraints to identify tests relevant to the user's bug.
2025-12-21 18:34:12,149 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of `tests/schema/tests.py` to help you locate the specific test cases related to composite indexes and unique constraints. This will allow you to examine the existing tests and identify any relevant to the bug you are addressing.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/schema/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2100, 'candidates_token_count': 73, 'total_token_count': 2286, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2100}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 73}], 'thoughts_token_count': 113, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.11783697833753612, 'model_name': 'gemini-2.5-pro'} id='run--092970e8-f735-43a8-87ff-8a95b3446d8c-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/schema/tests.py'}, 'id': 'f94f4eba-968a-43db-a550-8d5715d88c7e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2100, 'output_tokens': 73, 'total_tokens': 2286, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 113}}
2025-12-21 18:34:15,429 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have provided the full content of `tests/schema/tests.py`. You can now search this file for test cases related to the creation and deletion of composite indexes and unique constraints to identify tests relevant to the user's bug." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/schema/tests.py", "start_line": 501.0, "end_line": 2000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10195, 'candidates_token_count': 75, 'total_token_count': 10458, 'cached_content_token_count': 1850, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10195}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1850}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 75}], 'thoughts_token_count': 188}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3563750203450521, 'model_name': 'gemini-2.5-pro'} id='run--a8c7c0a4-81b1-4e3f-b19a-8f974e3965ef-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/schema/tests.py', 'start_line': 501.0, 'end_line': 2000.0}, 'id': '75a456f2-1762-4d2d-869d-544ac655bce5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10195, 'output_tokens': 75, 'total_tokens': 10458, 'input_token_details': {'cache_read': 1850}, 'output_token_details': {'reasoning': 188}}
2025-12-21 18:34:17,446 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have provided the full content of `tests/schema/tests.py`. You can now search this file for test cases related to the creation and deletion of composite indexes and unique constraints to identify tests relevant to the user's bug." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"relative_path": "tests/schema/tests.py", "end_line": 4000.0, "start_line": 2001.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 36818, 'candidates_token_count': 75, 'total_token_count': 36893, 'cached_content_token_count': 9772, 'prompt_tokens_details': [{'modality': 1, 'token_count': 36818}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9772}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 75}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.030409863789876302, 'model_name': 'gemini-2.5-pro'} id='run--a2df954d-171a-4a31-889b-6914e27f9226-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'tests/schema/tests.py', 'end_line': 4000.0, 'start_line': 2001.0}, 'id': 'd59efec0-5a95-480a-a106-68591052b238', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36818, 'output_tokens': 75, 'total_tokens': 36893, 'input_token_details': {'cache_read': 9772}}
2025-12-21 18:34:26,348 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of `tests/schema/tests.py` to help you locate the specific test cases related to composite indexes and unique constraints. I found several relevant tests, including `test_unique_together`, `test_index_together`, and `test_add_remove_index`, which cover the creation, alteration, and deletion of unique and index constraints. This will allow you to examine the existing tests and identify any relevant to the bug you are addressing.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 58160, 'candidates_token_count': 98, 'total_token_count': 58962, 'cached_content_token_count': 17736, 'prompt_tokens_details': [{'modality': 1, 'token_count': 58160}], 'cache_tokens_details': [{'modality': 1, 'token_count': 17736}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 98}], 'thoughts_token_count': 704}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4764519905557438, 'model_name': 'gemini-2.5-pro'} id='run--f6e698bc-37cc-4bb5-b8f2-4e290c862636-0' usage_metadata={'input_tokens': 58160, 'output_tokens': 98, 'total_tokens': 58962, 'input_token_details': {'cache_read': 17736}, 'output_token_details': {'reasoning': 704}}
2025-12-21 18:34:26,352 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/schema/tests.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find test cases that cover the creation and deletion of composite indexes and unique constraints to identify tests relevant to the user's bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/schema/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import itertools
3. import unittest
4. from copy import copy
5. from unittest import mock
6. 
7. from django.core.management.color import no_style
8. from django.db import (
9.     DatabaseError, DataError, IntegrityError, OperationalError, connection,
10. )
11. from django.db.models import (
12.     CASCADE, PROTECT, AutoField, BigAutoField, BigIntegerField, BinaryField,
13.     BooleanField, CharField, CheckConstraint, DateField, DateTimeField,
14.     ForeignKey, ForeignObject, Index, IntegerField, ManyToManyField, Model,
15.     OneToOneField, PositiveIntegerField, Q, SlugField, SmallAutoField,
16.     SmallIntegerField, TextField, TimeField, UniqueConstraint, UUIDField,
17. )
18. from django.db.transaction import TransactionManagementError, atomic
19. from django.test import (
20.     TransactionTestCase, skipIfDBFeature, skipUnlessDBFeature,
21. )
22. from django.test.utils import CaptureQueriesContext, isolate_apps
23. from django.utils import timezone
24. 
25. from .fields import (
26.     CustomManyToManyField, InheritedManyToManyField, MediumBlobField,
27. )
28. from .models import (
29.     Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
30.     AuthorWithDefaultHeight, AuthorWithEvenLongerName, AuthorWithIndexedName,
31.     AuthorWithIndexedNameAndBirthday, AuthorWithUniqueName,
32.     AuthorWithUniqueNameAndBirthday, Book, BookForeignObj, BookWeak,
33.     BookWithLongName, BookWithO2O, BookWithoutAuthor, BookWithSlug, IntegerPK,
34.     Node, Note, NoteRename, Tag, TagIndexed, TagM2MTest, TagUniqueRename,
35.     Thing, UniqueTest, new_apps,
36. )
37. 
38. 
39. class SchemaTests(TransactionTestCase):
40.     """
41.     Tests for the schema-alteration code.
42. 
43.     Be aware that these tests are more liable than most to false results,
44.     as sometimes the code to check if a test has worked is almost as complex
45.     as the code it is testing.
46.     """
47. 
48.     available_apps = []
49. 
50.     models = [
51.         Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
52.         AuthorWithDefaultHeight, AuthorWithEvenLongerName, Book, BookWeak,
53.         BookWithLongName, BookWithO2O, BookWithSlug, IntegerPK, Node, Note,
54.         Tag, TagIndexed, TagM2MTest, TagUniqueRename, Thing, UniqueTest,
55.     ]
56. 
57.     # Utility functions
58. 
59.     def setUp(self):
60.         # local_models should contain test dependent model classes that will be
61.         # automatically removed from the app cache on test tear down.
62.         self.local_models = []
63.         # isolated_local_models contains models that are in test methods
64.         # decorated with @isolate_apps.
65.         self.isolated_local_models = []
66. 
67.     def tearDown(self):
68.         # Delete any tables made for our models
69.         self.delete_tables()
70.         new_apps.clear_cache()
71.         for model in new_apps.get_models():
72.             model._meta._expire_cache()
73.         if 'schema' in new_apps.all_models:
74.             for model in self.local_models:
75.                 for many_to_many in model._meta.many_to_many:
76.                     through = many_to_many.remote_field.through
77.                     if through and through._meta.auto_created:
78.                         del new_apps.all_models['schema'][through._meta.model_name]
79.                 del new_apps.all_models['schema'][model._meta.model_name]
80.         if self.isolated_local_models:
81.             with connection.schema_editor() as editor:
82.                 for model in self.isolated_local_models:
83.                     editor.delete_model(model)
84. 
85.     def delete_tables(self):
86.         "Deletes all model tables for our models for a clean test environment"
87.         converter = connection.introspection.identifier_converter
88.         with connection.schema_editor() as editor:
89.             connection.disable_constraint_checking()
90.             table_names = connection.introspection.table_names()
91.             for model in itertools.chain(SchemaTests.models, self.local_models):
92.                 tbl = converter(model._meta.db_table)
93.                 if tbl in table_names:
94.                     editor.delete_model(model)
95.                     table_names.remove(tbl)
96.             connection.enable_constraint_checking()
97. 
98.     def column_classes(self, model):
99.         with connection.cursor() as cursor:
100.             columns = {
101.                 d[0]: (connection.introspection.get_field_type(d[1], d), d)
102.                 for d in connection.introspection.get_table_description(
103.                     cursor,
104.                     model._meta.db_table,
105.                 )
106.             }
107.         # SQLite has a different format for field_type
108.         for name, (type, desc) in columns.items():
109.             if isinstance(type, tuple):
110.                 columns[name] = (type[0], desc)
111.         # SQLite also doesn't error properly
112.         if not columns:
113.             raise DatabaseError("Table does not exist (empty pragma)")
114.         return columns
115. 
116.     def get_primary_key(self, table):
117.         with connection.cursor() as cursor:
118.             return connection.introspection.get_primary_key_column(cursor, table)
119. 
120.     def get_indexes(self, table):
121.         """
122.         Get the indexes on the table using a new cursor.
123.         """
124.         with connection.cursor() as cursor:
125.             return [
126.                 c['columns'][0]
127.                 for c in connection.introspection.get_constraints(cursor, table).values()
128.                 if c['index'] and len(c['columns']) == 1
129.             ]
130. 
131.     def get_uniques(self, table):
132.         with connection.cursor() as cursor:
133.             return [
134.                 c['columns'][0]
135.                 for c in connection.introspection.get_constraints(cursor, table).values()
136.                 if c['unique'] and len(c['columns']) == 1
137.             ]
138. 
139.     def get_constraints(self, table):
140.         """
141.         Get the constraints on a table using a new cursor.
142.         """
143.         with connection.cursor() as cursor:
144.             return connection.introspection.get_constraints(cursor, table)
145. 
146.     def get_constraints_for_column(self, model, column_name):
147.         constraints = self.get_constraints(model._meta.db_table)
148.         constraints_for_column = []
149.         for name, details in constraints.items():
150.             if details['columns'] == [column_name]:
151.                 constraints_for_column.append(name)
152.         return sorted(constraints_for_column)
153. 
154.     def check_added_field_default(self, schema_editor, model, field, field_name, expected_default,
155.                                   cast_function=None):
156.         with connection.cursor() as cursor:
157.             schema_editor.add_field(model, field)
158.             cursor.execute("SELECT {} FROM {};".format(field_name, model._meta.db_table))
159.             database_default = cursor.fetchall()[0][0]
160.             if cast_function and not type(database_default) == type(expected_default):
161.                 database_default = cast_function(database_default)
162.             self.assertEqual(database_default, expected_default)
163. 
164.     def get_constraints_count(self, table, column, fk_to):
165.         """
166.         Return a dict with keys 'fks', 'uniques, and 'indexes' indicating the
167.         number of foreign keys, unique constraints, and indexes on
168.         `table`.`column`. The `fk_to` argument is a 2-tuple specifying the
169.         expected foreign key relationship's (table, column).
170.         """
171.         with connection.cursor() as cursor:
172.             constraints = connection.introspection.get_constraints(cursor, table)
173.         counts = {'fks': 0, 'uniques': 0, 'indexes': 0}
174.         for c in constraints.values():
175.             if c['columns'] == [column]:
176.                 if c['foreign_key'] == fk_to:
177.                     counts['fks'] += 1
178.                 if c['unique']:
179.                     counts['uniques'] += 1
180.                 elif c['index']:
181.                     counts['indexes'] += 1
182.         return counts
183. 
184.     def assertIndexOrder(self, table, index, order):
185.         constraints = self.get_constraints(table)
186.         self.assertIn(index, constraints)
187.         index_orders = constraints[index]['orders']
188.         self.assertTrue(all(val == expected for val, expected in zip(index_orders, order)))
189. 
190.     def assertForeignKeyExists(self, model, column, expected_fk_table, field='id'):
191.         """
192.         Fail if the FK constraint on `model.Meta.db_table`.`column` to
193.         `expected_fk_table`.id doesn't exist.
194.         """
195.         constraints = self.get_constraints(model._meta.db_table)
196.         constraint_fk = None
197.         for details in constraints.values():
198.             if details['columns'] == [column] and details['foreign_key']:
199.                 constraint_fk = details['foreign_key']
200.                 break
201.         self.assertEqual(constraint_fk, (expected_fk_table, field))
202. 
203.     def assertForeignKeyNotExists(self, model, column, expected_fk_table):
204.         with self.assertRaises(AssertionError):
205.             self.assertForeignKeyExists(model, column, expected_fk_table)
206. 
207.     # Tests
208.     def test_creation_deletion(self):
209.         """
210.         Tries creating a model's table, and then deleting it.
211.         """
212.         with connection.schema_editor() as editor:
213.             # Create the table
214.             editor.create_model(Author)
215.             # The table is there
216.             list(Author.objects.all())
217.             # Clean up that table
218.             editor.delete_model(Author)
219.             # No deferred SQL should be left over.
220.             self.assertEqual(editor.deferred_sql, [])
221.         # The table is gone
222.         with self.assertRaises(DatabaseError):
223.             list(Author.objects.all())
224. 
225.     @skipUnlessDBFeature('supports_foreign_keys')
226.     def test_fk(self):
227.         "Creating tables out of FK order, then repointing, works"
228.         # Create the table
229.         with connection.schema_editor() as editor:
230.             editor.create_model(Book)
231.             editor.create_model(Author)
232.             editor.create_model(Tag)
233.         # Initial tables are there
234.         list(Author.objects.all())
235.         list(Book.objects.all())
236.         # Make sure the FK constraint is present
237.         with self.assertRaises(IntegrityError):
238.             Book.objects.create(
239.                 author_id=1,
240.                 title="Much Ado About Foreign Keys",
241.                 pub_date=datetime.datetime.now(),
242.             )
243.         # Repoint the FK constraint
244.         old_field = Book._meta.get_field("author")
245.         new_field = ForeignKey(Tag, CASCADE)
246.         new_field.set_attributes_from_name("author")
247.         with connection.schema_editor() as editor:
248.             editor.alter_field(Book, old_field, new_field, strict=True)
249.         self.assertForeignKeyExists(Book, 'author_id', 'schema_tag')
250. 
251.     @skipUnlessDBFeature('can_create_inline_fk')
252.     def test_inline_fk(self):
253.         # Create some tables.
254.         with connection.schema_editor() as editor:
255.             editor.create_model(Author)
256.             editor.create_model(Book)
257.             editor.create_model(Note)
258.         self.assertForeignKeyNotExists(Note, 'book_id', 'schema_book')
259.         # Add a foreign key from one to the other.
260.         with connection.schema_editor() as editor:
261.             new_field = ForeignKey(Book, CASCADE)
262.             new_field.set_attributes_from_name('book')
263.             editor.add_field(Note, new_field)
264.         self.assertForeignKeyExists(Note, 'book_id', 'schema_book')
265.         # Creating a FK field with a constraint uses a single statement without
266.         # a deferred ALTER TABLE.
267.         self.assertFalse([
268.             sql for sql in (str(statement) for statement in editor.deferred_sql)
269.             if sql.startswith('ALTER TABLE') and 'ADD CONSTRAINT' in sql
270.         ])
271. 
272.     @skipUnlessDBFeature('can_create_inline_fk')
273.     def test_add_inline_fk_update_data(self):
274.         with connection.schema_editor() as editor:
275.             editor.create_model(Node)
276.         # Add an inline foreign key and update data in the same transaction.
277.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
278.         new_field.set_attributes_from_name('new_parent_fk')
279.         parent = Node.objects.create()
280.         with connection.schema_editor() as editor:
281.             editor.add_field(Node, new_field)
282.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
283.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
284. 
285.     @skipUnlessDBFeature(
286.         'can_create_inline_fk',
287.         'allows_multiple_constraints_on_same_fields',
288.     )
289.     @isolate_apps('schema')
290.     def test_add_inline_fk_index_update_data(self):
291.         class Node(Model):
292.             class Meta:
293.                 app_label = 'schema'
294. 
295.         with connection.schema_editor() as editor:
296.             editor.create_model(Node)
297.         # Add an inline foreign key, update data, and an index in the same
298.         # transaction.
299.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
300.         new_field.set_attributes_from_name('new_parent_fk')
301.         parent = Node.objects.create()
302.         with connection.schema_editor() as editor:
303.             editor.add_field(Node, new_field)
304.             Node._meta.add_field(new_field)
305.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
306.             editor.add_index(Node, Index(fields=['new_parent_fk'], name='new_parent_inline_fk_idx'))
307.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
308. 
309.     @skipUnlessDBFeature('supports_foreign_keys')
310.     def test_char_field_with_db_index_to_fk(self):
311.         # Create the table
312.         with connection.schema_editor() as editor:
313.             editor.create_model(Author)
314.             editor.create_model(AuthorCharFieldWithIndex)
315.         # Change CharField to FK
316.         old_field = AuthorCharFieldWithIndex._meta.get_field('char_field')
317.         new_field = ForeignKey(Author, CASCADE, blank=True)
318.         new_field.set_attributes_from_name('char_field')
319.         with connection.schema_editor() as editor:
320.             editor.alter_field(AuthorCharFieldWithIndex, old_field, new_field, strict=True)
321.         self.assertForeignKeyExists(AuthorCharFieldWithIndex, 'char_field_id', 'schema_author')
322. 
323.     @skipUnlessDBFeature('supports_foreign_keys')
324.     @skipUnlessDBFeature('supports_index_on_text_field')
325.     def test_text_field_with_db_index_to_fk(self):
326.         # Create the table
327.         with connection.schema_editor() as editor:
328.             editor.create_model(Author)
329.             editor.create_model(AuthorTextFieldWithIndex)
330.         # Change TextField to FK
331.         old_field = AuthorTextFieldWithIndex._meta.get_field('text_field')
332.         new_field = ForeignKey(Author, CASCADE, blank=True)
333.         new_field.set_attributes_from_name('text_field')
334.         with connection.schema_editor() as editor:
335.             editor.alter_field(AuthorTextFieldWithIndex, old_field, new_field, strict=True)
336.         self.assertForeignKeyExists(AuthorTextFieldWithIndex, 'text_field_id', 'schema_author')
337. 
338.     @isolate_apps('schema')
339.     def test_char_field_pk_to_auto_field(self):
340.         class Foo(Model):
341.             id = CharField(max_length=255, primary_key=True)
342. 
343.             class Meta:
344.                 app_label = 'schema'
345. 
346.         with connection.schema_editor() as editor:
347.             editor.create_model(Foo)
348.         self.isolated_local_models = [Foo]
349.         old_field = Foo._meta.get_field('id')
350.         new_field = AutoField(primary_key=True)
351.         new_field.set_attributes_from_name('id')
352.         new_field.model = Foo
353.         with connection.schema_editor() as editor:
354.             editor.alter_field(Foo, old_field, new_field, strict=True)
355. 
356.     @skipUnlessDBFeature('supports_foreign_keys')
357.     def test_fk_to_proxy(self):
358.         "Creating a FK to a proxy model creates database constraints."
359.         class AuthorProxy(Author):
360.             class Meta:
361.                 app_label = 'schema'
362.                 apps = new_apps
363.                 proxy = True
364. 
365.         class AuthorRef(Model):
366.             author = ForeignKey(AuthorProxy, on_delete=CASCADE)
367. 
368.             class Meta:
369.                 app_label = 'schema'
370.                 apps = new_apps
371. 
372.         self.local_models = [AuthorProxy, AuthorRef]
373. 
374.         # Create the table
375.         with connection.schema_editor() as editor:
376.             editor.create_model(Author)
377.             editor.create_model(AuthorRef)
378.         self.assertForeignKeyExists(AuthorRef, 'author_id', 'schema_author')
379. 
380.     @skipUnlessDBFeature('supports_foreign_keys')
381.     def test_fk_db_constraint(self):
382.         "The db_constraint parameter is respected"
383.         # Create the table
384.         with connection.schema_editor() as editor:
385.             editor.create_model(Tag)
386.             editor.create_model(Author)
387.             editor.create_model(BookWeak)
388.         # Initial tables are there
389.         list(Author.objects.all())
390.         list(Tag.objects.all())
391.         list(BookWeak.objects.all())
392.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
393.         # Make a db_constraint=False FK
394.         new_field = ForeignKey(Tag, CASCADE, db_constraint=False)
395.         new_field.set_attributes_from_name("tag")
396.         with connection.schema_editor() as editor:
397.             editor.add_field(Author, new_field)
398.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
399.         # Alter to one with a constraint
400.         new_field2 = ForeignKey(Tag, CASCADE)
401.         new_field2.set_attributes_from_name("tag")
402.         with connection.schema_editor() as editor:
403.             editor.alter_field(Author, new_field, new_field2, strict=True)
404.         self.assertForeignKeyExists(Author, 'tag_id', 'schema_tag')
405.         # Alter to one without a constraint again
406.         new_field2 = ForeignKey(Tag, CASCADE)
407.         new_field2.set_attributes_from_name("tag")
408.         with connection.schema_editor() as editor:
409.             editor.alter_field(Author, new_field2, new_field, strict=True)
410.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
411. 
412.     @isolate_apps('schema')
413.     def test_no_db_constraint_added_during_primary_key_change(self):
414.         """
415.         When a primary key that's pointed to by a ForeignKey with
416.         db_constraint=False is altered, a foreign key constraint isn't added.
417.         """
418.         class Author(Model):
419.             class Meta:
420.                 app_label = 'schema'
421. 
422.         class BookWeak(Model):
423.             author = ForeignKey(Author, CASCADE, db_constraint=False)
424. 
425.             class Meta:
426.                 app_label = 'schema'
427. 
428.         with connection.schema_editor() as editor:
429.             editor.create_model(Author)
430.             editor.create_model(BookWeak)
431.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
432.         old_field = Author._meta.get_field('id')
433.         new_field = BigAutoField(primary_key=True)
434.         new_field.model = Author
435.         new_field.set_attributes_from_name('id')
436.         # @isolate_apps() and inner models are needed to have the model
437.         # relations populated, otherwise this doesn't act as a regression test.
438.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
439.         with connection.schema_editor() as editor:
440.             editor.alter_field(Author, old_field, new_field, strict=True)
441.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
442. 
443.     def _test_m2m_db_constraint(self, M2MFieldClass):
444.         class LocalAuthorWithM2M(Model):
445.             name = CharField(max_length=255)
446. 
447.             class Meta:
448.                 app_label = 'schema'
449.                 apps = new_apps
450. 
451.         self.local_models = [LocalAuthorWithM2M]
452. 
453.         # Create the table
454.         with connection.schema_editor() as editor:
455.             editor.create_model(Tag)
456.             editor.create_model(LocalAuthorWithM2M)
457.         # Initial tables are there
458.         list(LocalAuthorWithM2M.objects.all())
459.         list(Tag.objects.all())
460.         # Make a db_constraint=False FK
461.         new_field = M2MFieldClass(Tag, related_name="authors", db_constraint=False)
462.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
463.         # Add the field
464.         with connection.schema_editor() as editor:
465.             editor.add_field(LocalAuthorWithM2M, new_field)
466.         self.assertForeignKeyNotExists(new_field.remote_field.through, 'tag_id', 'schema_tag')
467. 
468.     @skipUnlessDBFeature('supports_foreign_keys')
469.     def test_m2m_db_constraint(self):
470.         self._test_m2m_db_constraint(ManyToManyField)
471. 
472.     @skipUnlessDBFeature('supports_foreign_keys')
473.     def test_m2m_db_constraint_custom(self):
474.         self._test_m2m_db_constraint(CustomManyToManyField)
475. 
476.     @skipUnlessDBFeature('supports_foreign_keys')
477.     def test_m2m_db_constraint_inherited(self):
478.         self._test_m2m_db_constraint(InheritedManyToManyField)
479. 
480.     def test_add_field(self):
481.         """
482.         Tests adding fields to models
483.         """
484.         # Create the table
485.         with connection.schema_editor() as editor:
486.             editor.create_model(Author)
487.         # Ensure there's no age field
488.         columns = self.column_classes(Author)
489.         self.assertNotIn("age", columns)
490.         # Add the new field
491.         new_field = IntegerField(null=True)
492.         new_field.set_attributes_from_name("age")
493.         with CaptureQueriesContext(connection) as ctx, connection.schema_editor() as editor:
494.             editor.add_field(Author, new_field)
495.         drop_default_sql = editor.sql_alter_column_no_default % {
496.             'column': editor.quote_name(new_field.name),
497.         }
498.         self.assertFalse(any(drop_default_sql in query['sql'] for query in ctx.captured_queries))
499.         # Ensure the field is right afterwards
500.         columns = self.column_classes(Author)


File: tests/schema/tests.py
Line number range: 501 - 2000
Content:
501.         self.assertEqual(columns['age'][0], "IntegerField")
502.         self.assertTrue(columns['age'][1][6])
503. 
504.     def test_add_field_remove_field(self):
505.         """
506.         Adding a field and removing it removes all deferred sql referring to it.
507.         """
508.         with connection.schema_editor() as editor:
509.             # Create a table with a unique constraint on the slug field.
510.             editor.create_model(Tag)
511.             # Remove the slug column.
512.             editor.remove_field(Tag, Tag._meta.get_field('slug'))
513.         self.assertEqual(editor.deferred_sql, [])
514. 
515.     def test_add_field_temp_default(self):
516.         """
517.         Tests adding fields to models with a temporary default
518.         """
519.         # Create the table
520.         with connection.schema_editor() as editor:
521.             editor.create_model(Author)
522.         # Ensure there's no age field
523.         columns = self.column_classes(Author)
524.         self.assertNotIn("age", columns)
525.         # Add some rows of data
526.         Author.objects.create(name="Andrew", height=30)
527.         Author.objects.create(name="Andrea")
528.         # Add a not-null field
529.         new_field = CharField(max_length=30, default="Godwin")
530.         new_field.set_attributes_from_name("surname")
531.         with connection.schema_editor() as editor:
532.             editor.add_field(Author, new_field)
533.         # Ensure the field is right afterwards
534.         columns = self.column_classes(Author)
535.         self.assertEqual(columns['surname'][0], "CharField")
536.         self.assertEqual(columns['surname'][1][6],
537.                          connection.features.interprets_empty_strings_as_nulls)
538. 
539.     def test_add_field_temp_default_boolean(self):
540.         """
541.         Tests adding fields to models with a temporary default where
542.         the default is False. (#21783)
543.         """
544.         # Create the table
545.         with connection.schema_editor() as editor:
546.             editor.create_model(Author)
547.         # Ensure there's no age field
548.         columns = self.column_classes(Author)
549.         self.assertNotIn("age", columns)
550.         # Add some rows of data
551.         Author.objects.create(name="Andrew", height=30)
552.         Author.objects.create(name="Andrea")
553.         # Add a not-null field
554.         new_field = BooleanField(default=False)
555.         new_field.set_attributes_from_name("awesome")
556.         with connection.schema_editor() as editor:
557.             editor.add_field(Author, new_field)
558.         # Ensure the field is right afterwards
559.         columns = self.column_classes(Author)
560.         # BooleanField are stored as TINYINT(1) on MySQL.
561.         field_type = columns['awesome'][0]
562.         self.assertEqual(field_type, connection.features.introspected_boolean_field_type)
563. 
564.     def test_add_field_default_transform(self):
565.         """
566.         Tests adding fields to models with a default that is not directly
567.         valid in the database (#22581)
568.         """
569. 
570.         class TestTransformField(IntegerField):
571. 
572.             # Weird field that saves the count of items in its value
573.             def get_default(self):
574.                 return self.default
575. 
576.             def get_prep_value(self, value):
577.                 if value is None:
578.                     return 0
579.                 return len(value)
580. 
581.         # Create the table
582.         with connection.schema_editor() as editor:
583.             editor.create_model(Author)
584.         # Add some rows of data
585.         Author.objects.create(name="Andrew", height=30)
586.         Author.objects.create(name="Andrea")
587.         # Add the field with a default it needs to cast (to string in this case)
588.         new_field = TestTransformField(default={1: 2})
589.         new_field.set_attributes_from_name("thing")
590.         with connection.schema_editor() as editor:
591.             editor.add_field(Author, new_field)
592.         # Ensure the field is there
593.         columns = self.column_classes(Author)
594.         field_type, field_info = columns['thing']
595.         self.assertEqual(field_type, 'IntegerField')
596.         # Make sure the values were transformed correctly
597.         self.assertEqual(Author.objects.extra(where=["thing = 1"]).count(), 2)
598. 
599.     def test_add_field_binary(self):
600.         """
601.         Tests binary fields get a sane default (#22851)
602.         """
603.         # Create the table
604.         with connection.schema_editor() as editor:
605.             editor.create_model(Author)
606.         # Add the new field
607.         new_field = BinaryField(blank=True)
608.         new_field.set_attributes_from_name("bits")
609.         with connection.schema_editor() as editor:
610.             editor.add_field(Author, new_field)
611.         # Ensure the field is right afterwards
612.         columns = self.column_classes(Author)
613.         # MySQL annoyingly uses the same backend, so it'll come back as one of
614.         # these two types.
615.         self.assertIn(columns['bits'][0], ("BinaryField", "TextField"))
616. 
617.     @unittest.skipUnless(connection.vendor == 'mysql', "MySQL specific")
618.     def test_add_binaryfield_mediumblob(self):
619.         """
620.         Test adding a custom-sized binary field on MySQL (#24846).
621.         """
622.         # Create the table
623.         with connection.schema_editor() as editor:
624.             editor.create_model(Author)
625.         # Add the new field with default
626.         new_field = MediumBlobField(blank=True, default=b'123')
627.         new_field.set_attributes_from_name('bits')
628.         with connection.schema_editor() as editor:
629.             editor.add_field(Author, new_field)
630.         columns = self.column_classes(Author)
631.         # Introspection treats BLOBs as TextFields
632.         self.assertEqual(columns['bits'][0], "TextField")
633. 
634.     def test_alter(self):
635.         """
636.         Tests simple altering of fields
637.         """
638.         # Create the table
639.         with connection.schema_editor() as editor:
640.             editor.create_model(Author)
641.         # Ensure the field is right to begin with
642.         columns = self.column_classes(Author)
643.         self.assertEqual(columns['name'][0], "CharField")
644.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
645.         # Alter the name field to a TextField
646.         old_field = Author._meta.get_field("name")
647.         new_field = TextField(null=True)
648.         new_field.set_attributes_from_name("name")
649.         with connection.schema_editor() as editor:
650.             editor.alter_field(Author, old_field, new_field, strict=True)
651.         # Ensure the field is right afterwards
652.         columns = self.column_classes(Author)
653.         self.assertEqual(columns['name'][0], "TextField")
654.         self.assertTrue(columns['name'][1][6])
655.         # Change nullability again
656.         new_field2 = TextField(null=False)
657.         new_field2.set_attributes_from_name("name")
658.         with connection.schema_editor() as editor:
659.             editor.alter_field(Author, new_field, new_field2, strict=True)
660.         # Ensure the field is right afterwards
661.         columns = self.column_classes(Author)
662.         self.assertEqual(columns['name'][0], "TextField")
663.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
664. 
665.     def test_alter_auto_field_to_integer_field(self):
666.         # Create the table
667.         with connection.schema_editor() as editor:
668.             editor.create_model(Author)
669.         # Change AutoField to IntegerField
670.         old_field = Author._meta.get_field('id')
671.         new_field = IntegerField(primary_key=True)
672.         new_field.set_attributes_from_name('id')
673.         new_field.model = Author
674.         with connection.schema_editor() as editor:
675.             editor.alter_field(Author, old_field, new_field, strict=True)
676. 
677.     def test_alter_auto_field_to_char_field(self):
678.         # Create the table
679.         with connection.schema_editor() as editor:
680.             editor.create_model(Author)
681.         # Change AutoField to CharField
682.         old_field = Author._meta.get_field('id')
683.         new_field = CharField(primary_key=True, max_length=50)
684.         new_field.set_attributes_from_name('id')
685.         new_field.model = Author
686.         with connection.schema_editor() as editor:
687.             editor.alter_field(Author, old_field, new_field, strict=True)
688. 
689.     @isolate_apps('schema')
690.     def test_alter_auto_field_quoted_db_column(self):
691.         class Foo(Model):
692.             id = AutoField(primary_key=True, db_column='"quoted_id"')
693. 
694.             class Meta:
695.                 app_label = 'schema'
696. 
697.         with connection.schema_editor() as editor:
698.             editor.create_model(Foo)
699.         self.isolated_local_models = [Foo]
700.         old_field = Foo._meta.get_field('id')
701.         new_field = BigAutoField(primary_key=True)
702.         new_field.model = Foo
703.         new_field.db_column = '"quoted_id"'
704.         new_field.set_attributes_from_name('id')
705.         with connection.schema_editor() as editor:
706.             editor.alter_field(Foo, old_field, new_field, strict=True)
707.         Foo.objects.create()
708. 
709.     def test_alter_not_unique_field_to_primary_key(self):
710.         # Create the table.
711.         with connection.schema_editor() as editor:
712.             editor.create_model(Author)
713.         # Change UUIDField to primary key.
714.         old_field = Author._meta.get_field('uuid')
715.         new_field = UUIDField(primary_key=True)
716.         new_field.set_attributes_from_name('uuid')
717.         new_field.model = Author
718.         with connection.schema_editor() as editor:
719.             editor.remove_field(Author, Author._meta.get_field('id'))
720.             editor.alter_field(Author, old_field, new_field, strict=True)
721. 
722.     @isolate_apps('schema')
723.     def test_alter_primary_key_quoted_db_table(self):
724.         class Foo(Model):
725.             class Meta:
726.                 app_label = 'schema'
727.                 db_table = '"foo"'
728. 
729.         with connection.schema_editor() as editor:
730.             editor.create_model(Foo)
731.         self.isolated_local_models = [Foo]
732.         old_field = Foo._meta.get_field('id')
733.         new_field = BigAutoField(primary_key=True)
734.         new_field.model = Foo
735.         new_field.set_attributes_from_name('id')
736.         with connection.schema_editor() as editor:
737.             editor.alter_field(Foo, old_field, new_field, strict=True)
738.         Foo.objects.create()
739. 
740.     def test_alter_text_field(self):
741.         # Regression for "BLOB/TEXT column 'info' can't have a default value")
742.         # on MySQL.
743.         # Create the table
744.         with connection.schema_editor() as editor:
745.             editor.create_model(Note)
746.         old_field = Note._meta.get_field("info")
747.         new_field = TextField(blank=True)
748.         new_field.set_attributes_from_name("info")
749.         with connection.schema_editor() as editor:
750.             editor.alter_field(Note, old_field, new_field, strict=True)
751. 
752.     @skipUnlessDBFeature('can_defer_constraint_checks', 'can_rollback_ddl')
753.     def test_alter_fk_checks_deferred_constraints(self):
754.         """
755.         #25492 - Altering a foreign key's structure and data in the same
756.         transaction.
757.         """
758.         with connection.schema_editor() as editor:
759.             editor.create_model(Node)
760.         old_field = Node._meta.get_field('parent')
761.         new_field = ForeignKey(Node, CASCADE)
762.         new_field.set_attributes_from_name('parent')
763.         parent = Node.objects.create()
764.         with connection.schema_editor() as editor:
765.             # Update the parent FK to create a deferred constraint check.
766.             Node.objects.update(parent=parent)
767.             editor.alter_field(Node, old_field, new_field, strict=True)
768. 
769.     def test_alter_text_field_to_date_field(self):
770.         """
771.         #25002 - Test conversion of text field to date field.
772.         """
773.         with connection.schema_editor() as editor:
774.             editor.create_model(Note)
775.         Note.objects.create(info='1988-05-05')
776.         old_field = Note._meta.get_field('info')
777.         new_field = DateField(blank=True)
778.         new_field.set_attributes_from_name('info')
779.         with connection.schema_editor() as editor:
780.             editor.alter_field(Note, old_field, new_field, strict=True)
781.         # Make sure the field isn't nullable
782.         columns = self.column_classes(Note)
783.         self.assertFalse(columns['info'][1][6])
784. 
785.     def test_alter_text_field_to_datetime_field(self):
786.         """
787.         #25002 - Test conversion of text field to datetime field.
788.         """
789.         with connection.schema_editor() as editor:
790.             editor.create_model(Note)
791.         Note.objects.create(info='1988-05-05 3:16:17.4567')
792.         old_field = Note._meta.get_field('info')
793.         new_field = DateTimeField(blank=True)
794.         new_field.set_attributes_from_name('info')
795.         with connection.schema_editor() as editor:
796.             editor.alter_field(Note, old_field, new_field, strict=True)
797.         # Make sure the field isn't nullable
798.         columns = self.column_classes(Note)
799.         self.assertFalse(columns['info'][1][6])
800. 
801.     def test_alter_text_field_to_time_field(self):
802.         """
803.         #25002 - Test conversion of text field to time field.
804.         """
805.         with connection.schema_editor() as editor:
806.             editor.create_model(Note)
807.         Note.objects.create(info='3:16:17.4567')
808.         old_field = Note._meta.get_field('info')
809.         new_field = TimeField(blank=True)
810.         new_field.set_attributes_from_name('info')
811.         with connection.schema_editor() as editor:
812.             editor.alter_field(Note, old_field, new_field, strict=True)
813.         # Make sure the field isn't nullable
814.         columns = self.column_classes(Note)
815.         self.assertFalse(columns['info'][1][6])
816. 
817.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
818.     def test_alter_textual_field_keep_null_status(self):
819.         """
820.         Changing a field type shouldn't affect the not null status.
821.         """
822.         with connection.schema_editor() as editor:
823.             editor.create_model(Note)
824.         with self.assertRaises(IntegrityError):
825.             Note.objects.create(info=None)
826.         old_field = Note._meta.get_field("info")
827.         new_field = CharField(max_length=50)
828.         new_field.set_attributes_from_name("info")
829.         with connection.schema_editor() as editor:
830.             editor.alter_field(Note, old_field, new_field, strict=True)
831.         with self.assertRaises(IntegrityError):
832.             Note.objects.create(info=None)
833. 
834.     def test_alter_numeric_field_keep_null_status(self):
835.         """
836.         Changing a field type shouldn't affect the not null status.
837.         """
838.         with connection.schema_editor() as editor:
839.             editor.create_model(UniqueTest)
840.         with self.assertRaises(IntegrityError):
841.             UniqueTest.objects.create(year=None, slug='aaa')
842.         old_field = UniqueTest._meta.get_field("year")
843.         new_field = BigIntegerField()
844.         new_field.set_attributes_from_name("year")
845.         with connection.schema_editor() as editor:
846.             editor.alter_field(UniqueTest, old_field, new_field, strict=True)
847.         with self.assertRaises(IntegrityError):
848.             UniqueTest.objects.create(year=None, slug='bbb')
849. 
850.     def test_alter_null_to_not_null(self):
851.         """
852.         #23609 - Tests handling of default values when altering from NULL to NOT NULL.
853.         """
854.         # Create the table
855.         with connection.schema_editor() as editor:
856.             editor.create_model(Author)
857.         # Ensure the field is right to begin with
858.         columns = self.column_classes(Author)
859.         self.assertTrue(columns['height'][1][6])
860.         # Create some test data
861.         Author.objects.create(name='Not null author', height=12)
862.         Author.objects.create(name='Null author')
863.         # Verify null value
864.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
865.         self.assertIsNone(Author.objects.get(name='Null author').height)
866.         # Alter the height field to NOT NULL with default
867.         old_field = Author._meta.get_field("height")
868.         new_field = PositiveIntegerField(default=42)
869.         new_field.set_attributes_from_name("height")
870.         with connection.schema_editor() as editor:
871.             editor.alter_field(Author, old_field, new_field, strict=True)
872.         # Ensure the field is right afterwards
873.         columns = self.column_classes(Author)
874.         self.assertFalse(columns['height'][1][6])
875.         # Verify default value
876.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
877.         self.assertEqual(Author.objects.get(name='Null author').height, 42)
878. 
879.     def test_alter_charfield_to_null(self):
880.         """
881.         #24307 - Should skip an alter statement on databases with
882.         interprets_empty_strings_as_null when changing a CharField to null.
883.         """
884.         # Create the table
885.         with connection.schema_editor() as editor:
886.             editor.create_model(Author)
887.         # Change the CharField to null
888.         old_field = Author._meta.get_field('name')
889.         new_field = copy(old_field)
890.         new_field.null = True
891.         with connection.schema_editor() as editor:
892.             editor.alter_field(Author, old_field, new_field, strict=True)
893. 
894.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
895.     def test_alter_char_field_decrease_length(self):
896.         # Create the table.
897.         with connection.schema_editor() as editor:
898.             editor.create_model(Author)
899.         Author.objects.create(name='x' * 255)
900.         # Change max_length of CharField.
901.         old_field = Author._meta.get_field('name')
902.         new_field = CharField(max_length=254)
903.         new_field.set_attributes_from_name('name')
904.         with connection.schema_editor() as editor:
905.             msg = 'value too long for type character varying(254)'
906.             with self.assertRaisesMessage(DataError, msg):
907.                 editor.alter_field(Author, old_field, new_field, strict=True)
908. 
909.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
910.     def test_alter_field_with_custom_db_type(self):
911.         from django.contrib.postgres.fields import ArrayField
912. 
913.         class Foo(Model):
914.             field = ArrayField(CharField(max_length=255))
915. 
916.             class Meta:
917.                 app_label = 'schema'
918. 
919.         with connection.schema_editor() as editor:
920.             editor.create_model(Foo)
921.         self.isolated_local_models = [Foo]
922.         old_field = Foo._meta.get_field('field')
923.         new_field = ArrayField(CharField(max_length=16))
924.         new_field.set_attributes_from_name('field')
925.         new_field.model = Foo
926.         with connection.schema_editor() as editor:
927.             editor.alter_field(Foo, old_field, new_field, strict=True)
928. 
929.     @isolate_apps('schema')
930.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
931.     def test_alter_array_field_decrease_base_field_length(self):
932.         from django.contrib.postgres.fields import ArrayField
933. 
934.         class ArrayModel(Model):
935.             field = ArrayField(CharField(max_length=16))
936. 
937.             class Meta:
938.                 app_label = 'schema'
939. 
940.         with connection.schema_editor() as editor:
941.             editor.create_model(ArrayModel)
942.         self.isolated_local_models = [ArrayModel]
943.         ArrayModel.objects.create(field=['x' * 16])
944.         old_field = ArrayModel._meta.get_field('field')
945.         new_field = ArrayField(CharField(max_length=15))
946.         new_field.set_attributes_from_name('field')
947.         new_field.model = ArrayModel
948.         with connection.schema_editor() as editor:
949.             msg = 'value too long for type character varying(15)'
950.             with self.assertRaisesMessage(DataError, msg):
951.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
952. 
953.     @isolate_apps('schema')
954.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
955.     def test_alter_array_field_decrease_nested_base_field_length(self):
956.         from django.contrib.postgres.fields import ArrayField
957. 
958.         class ArrayModel(Model):
959.             field = ArrayField(ArrayField(CharField(max_length=16)))
960. 
961.             class Meta:
962.                 app_label = 'schema'
963. 
964.         with connection.schema_editor() as editor:
965.             editor.create_model(ArrayModel)
966.         self.isolated_local_models = [ArrayModel]
967.         ArrayModel.objects.create(field=[['x' * 16]])
968.         old_field = ArrayModel._meta.get_field('field')
969.         new_field = ArrayField(ArrayField(CharField(max_length=15)))
970.         new_field.set_attributes_from_name('field')
971.         new_field.model = ArrayModel
972.         with connection.schema_editor() as editor:
973.             msg = 'value too long for type character varying(15)'
974.             with self.assertRaisesMessage(DataError, msg):
975.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
976. 
977.     def test_alter_textfield_to_null(self):
978.         """
979.         #24307 - Should skip an alter statement on databases with
980.         interprets_empty_strings_as_null when changing a TextField to null.
981.         """
982.         # Create the table
983.         with connection.schema_editor() as editor:
984.             editor.create_model(Note)
985.         # Change the TextField to null
986.         old_field = Note._meta.get_field('info')
987.         new_field = copy(old_field)
988.         new_field.null = True
989.         with connection.schema_editor() as editor:
990.             editor.alter_field(Note, old_field, new_field, strict=True)
991. 
992.     @skipUnlessDBFeature('supports_combined_alters')
993.     def test_alter_null_to_not_null_keeping_default(self):
994.         """
995.         #23738 - Can change a nullable field with default to non-nullable
996.         with the same default.
997.         """
998.         # Create the table
999.         with connection.schema_editor() as editor:
1000.             editor.create_model(AuthorWithDefaultHeight)
1001.         # Ensure the field is right to begin with
1002.         columns = self.column_classes(AuthorWithDefaultHeight)
1003.         self.assertTrue(columns['height'][1][6])
1004.         # Alter the height field to NOT NULL keeping the previous default
1005.         old_field = AuthorWithDefaultHeight._meta.get_field("height")
1006.         new_field = PositiveIntegerField(default=42)
1007.         new_field.set_attributes_from_name("height")
1008.         with connection.schema_editor() as editor:
1009.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
1010.         # Ensure the field is right afterwards
1011.         columns = self.column_classes(AuthorWithDefaultHeight)
1012.         self.assertFalse(columns['height'][1][6])
1013. 
1014.     @skipUnlessDBFeature('supports_foreign_keys')
1015.     def test_alter_fk(self):
1016.         """
1017.         Tests altering of FKs
1018.         """
1019.         # Create the table
1020.         with connection.schema_editor() as editor:
1021.             editor.create_model(Author)
1022.             editor.create_model(Book)
1023.         # Ensure the field is right to begin with
1024.         columns = self.column_classes(Book)
1025.         self.assertEqual(columns['author_id'][0], "IntegerField")
1026.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1027.         # Alter the FK
1028.         old_field = Book._meta.get_field("author")
1029.         new_field = ForeignKey(Author, CASCADE, editable=False)
1030.         new_field.set_attributes_from_name("author")
1031.         with connection.schema_editor() as editor:
1032.             editor.alter_field(Book, old_field, new_field, strict=True)
1033.         # Ensure the field is right afterwards
1034.         columns = self.column_classes(Book)
1035.         self.assertEqual(columns['author_id'][0], "IntegerField")
1036.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1037. 
1038.     @skipUnlessDBFeature('supports_foreign_keys')
1039.     def test_alter_to_fk(self):
1040.         """
1041.         #24447 - Tests adding a FK constraint for an existing column
1042.         """
1043.         class LocalBook(Model):
1044.             author = IntegerField()
1045.             title = CharField(max_length=100, db_index=True)
1046.             pub_date = DateTimeField()
1047. 
1048.             class Meta:
1049.                 app_label = 'schema'
1050.                 apps = new_apps
1051. 
1052.         self.local_models = [LocalBook]
1053. 
1054.         # Create the tables
1055.         with connection.schema_editor() as editor:
1056.             editor.create_model(Author)
1057.             editor.create_model(LocalBook)
1058.         # Ensure no FK constraint exists
1059.         constraints = self.get_constraints(LocalBook._meta.db_table)
1060.         for details in constraints.values():
1061.             if details['foreign_key']:
1062.                 self.fail('Found an unexpected FK constraint to %s' % details['columns'])
1063.         old_field = LocalBook._meta.get_field("author")
1064.         new_field = ForeignKey(Author, CASCADE)
1065.         new_field.set_attributes_from_name("author")
1066.         with connection.schema_editor() as editor:
1067.             editor.alter_field(LocalBook, old_field, new_field, strict=True)
1068.         self.assertForeignKeyExists(LocalBook, 'author_id', 'schema_author')
1069. 
1070.     @skipUnlessDBFeature('supports_foreign_keys')
1071.     def test_alter_o2o_to_fk(self):
1072.         """
1073.         #24163 - Tests altering of OneToOneField to ForeignKey
1074.         """
1075.         # Create the table
1076.         with connection.schema_editor() as editor:
1077.             editor.create_model(Author)
1078.             editor.create_model(BookWithO2O)
1079.         # Ensure the field is right to begin with
1080.         columns = self.column_classes(BookWithO2O)
1081.         self.assertEqual(columns['author_id'][0], "IntegerField")
1082.         # Ensure the field is unique
1083.         author = Author.objects.create(name="Joe")
1084.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1085.         with self.assertRaises(IntegrityError):
1086.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1087.         BookWithO2O.objects.all().delete()
1088.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1089.         # Alter the OneToOneField to ForeignKey
1090.         old_field = BookWithO2O._meta.get_field("author")
1091.         new_field = ForeignKey(Author, CASCADE)
1092.         new_field.set_attributes_from_name("author")
1093.         with connection.schema_editor() as editor:
1094.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1095.         # Ensure the field is right afterwards
1096.         columns = self.column_classes(Book)
1097.         self.assertEqual(columns['author_id'][0], "IntegerField")
1098.         # Ensure the field is not unique anymore
1099.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1100.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1101.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1102. 
1103.     @skipUnlessDBFeature('supports_foreign_keys')
1104.     def test_alter_fk_to_o2o(self):
1105.         """
1106.         #24163 - Tests altering of ForeignKey to OneToOneField
1107.         """
1108.         # Create the table
1109.         with connection.schema_editor() as editor:
1110.             editor.create_model(Author)
1111.             editor.create_model(Book)
1112.         # Ensure the field is right to begin with
1113.         columns = self.column_classes(Book)
1114.         self.assertEqual(columns['author_id'][0], "IntegerField")
1115.         # Ensure the field is not unique
1116.         author = Author.objects.create(name="Joe")
1117.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1118.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1119.         Book.objects.all().delete()
1120.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1121.         # Alter the ForeignKey to OneToOneField
1122.         old_field = Book._meta.get_field("author")
1123.         new_field = OneToOneField(Author, CASCADE)
1124.         new_field.set_attributes_from_name("author")
1125.         with connection.schema_editor() as editor:
1126.             editor.alter_field(Book, old_field, new_field, strict=True)
1127.         # Ensure the field is right afterwards
1128.         columns = self.column_classes(BookWithO2O)
1129.         self.assertEqual(columns['author_id'][0], "IntegerField")
1130.         # Ensure the field is unique now
1131.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1132.         with self.assertRaises(IntegrityError):
1133.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1134.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1135. 
1136.     def test_alter_field_fk_to_o2o(self):
1137.         with connection.schema_editor() as editor:
1138.             editor.create_model(Author)
1139.             editor.create_model(Book)
1140.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1141. 
1142.         # Check the index is right to begin with.
1143.         counts = self.get_constraints_count(
1144.             Book._meta.db_table,
1145.             Book._meta.get_field('author').column,
1146.             (Author._meta.db_table, Author._meta.pk.column),
1147.         )
1148.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1149. 
1150.         old_field = Book._meta.get_field('author')
1151.         new_field = OneToOneField(Author, CASCADE)
1152.         new_field.set_attributes_from_name('author')
1153.         with connection.schema_editor() as editor:
1154.             editor.alter_field(Book, old_field, new_field, strict=True)
1155. 
1156.         counts = self.get_constraints_count(
1157.             Book._meta.db_table,
1158.             Book._meta.get_field('author').column,
1159.             (Author._meta.db_table, Author._meta.pk.column),
1160.         )
1161.         # The index on ForeignKey is replaced with a unique constraint for OneToOneField.
1162.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1163. 
1164.     def test_alter_field_fk_keeps_index(self):
1165.         with connection.schema_editor() as editor:
1166.             editor.create_model(Author)
1167.             editor.create_model(Book)
1168.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1169. 
1170.         # Check the index is right to begin with.
1171.         counts = self.get_constraints_count(
1172.             Book._meta.db_table,
1173.             Book._meta.get_field('author').column,
1174.             (Author._meta.db_table, Author._meta.pk.column),
1175.         )
1176.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1177. 
1178.         old_field = Book._meta.get_field('author')
1179.         # on_delete changed from CASCADE.
1180.         new_field = ForeignKey(Author, PROTECT)
1181.         new_field.set_attributes_from_name('author')
1182.         with connection.schema_editor() as editor:
1183.             editor.alter_field(Book, old_field, new_field, strict=True)
1184. 
1185.         counts = self.get_constraints_count(
1186.             Book._meta.db_table,
1187.             Book._meta.get_field('author').column,
1188.             (Author._meta.db_table, Author._meta.pk.column),
1189.         )
1190.         # The index remains.
1191.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1192. 
1193.     def test_alter_field_o2o_to_fk(self):
1194.         with connection.schema_editor() as editor:
1195.             editor.create_model(Author)
1196.             editor.create_model(BookWithO2O)
1197.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1198. 
1199.         # Check the unique constraint is right to begin with.
1200.         counts = self.get_constraints_count(
1201.             BookWithO2O._meta.db_table,
1202.             BookWithO2O._meta.get_field('author').column,
1203.             (Author._meta.db_table, Author._meta.pk.column),
1204.         )
1205.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1206. 
1207.         old_field = BookWithO2O._meta.get_field('author')
1208.         new_field = ForeignKey(Author, CASCADE)
1209.         new_field.set_attributes_from_name('author')
1210.         with connection.schema_editor() as editor:
1211.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1212. 
1213.         counts = self.get_constraints_count(
1214.             BookWithO2O._meta.db_table,
1215.             BookWithO2O._meta.get_field('author').column,
1216.             (Author._meta.db_table, Author._meta.pk.column),
1217.         )
1218.         # The unique constraint on OneToOneField is replaced with an index for ForeignKey.
1219.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1220. 
1221.     def test_alter_field_o2o_keeps_unique(self):
1222.         with connection.schema_editor() as editor:
1223.             editor.create_model(Author)
1224.             editor.create_model(BookWithO2O)
1225.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1226. 
1227.         # Check the unique constraint is right to begin with.
1228.         counts = self.get_constraints_count(
1229.             BookWithO2O._meta.db_table,
1230.             BookWithO2O._meta.get_field('author').column,
1231.             (Author._meta.db_table, Author._meta.pk.column),
1232.         )
1233.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1234. 
1235.         old_field = BookWithO2O._meta.get_field('author')
1236.         # on_delete changed from CASCADE.
1237.         new_field = OneToOneField(Author, PROTECT)
1238.         new_field.set_attributes_from_name('author')
1239.         with connection.schema_editor() as editor:
1240.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1241. 
1242.         counts = self.get_constraints_count(
1243.             BookWithO2O._meta.db_table,
1244.             BookWithO2O._meta.get_field('author').column,
1245.             (Author._meta.db_table, Author._meta.pk.column),
1246.         )
1247.         # The unique constraint remains.
1248.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1249. 
1250.     @skipUnlessDBFeature('ignores_table_name_case')
1251.     def test_alter_db_table_case(self):
1252.         # Create the table
1253.         with connection.schema_editor() as editor:
1254.             editor.create_model(Author)
1255.         # Alter the case of the table
1256.         old_table_name = Author._meta.db_table
1257.         with connection.schema_editor() as editor:
1258.             editor.alter_db_table(Author, old_table_name, old_table_name.upper())
1259. 
1260.     def test_alter_implicit_id_to_explicit(self):
1261.         """
1262.         Should be able to convert an implicit "id" field to an explicit "id"
1263.         primary key field.
1264.         """
1265.         with connection.schema_editor() as editor:
1266.             editor.create_model(Author)
1267. 
1268.         old_field = Author._meta.get_field("id")
1269.         new_field = AutoField(primary_key=True)
1270.         new_field.set_attributes_from_name("id")
1271.         new_field.model = Author
1272.         with connection.schema_editor() as editor:
1273.             editor.alter_field(Author, old_field, new_field, strict=True)
1274.         # This will fail if DROP DEFAULT is inadvertently executed on this
1275.         # field which drops the id sequence, at least on PostgreSQL.
1276.         Author.objects.create(name='Foo')
1277.         Author.objects.create(name='Bar')
1278. 
1279.     def test_alter_autofield_pk_to_bigautofield_pk_sequence_owner(self):
1280.         """
1281.         Converting an implicit PK to BigAutoField(primary_key=True) should keep
1282.         a sequence owner on PostgreSQL.
1283.         """
1284.         with connection.schema_editor() as editor:
1285.             editor.create_model(Author)
1286.         old_field = Author._meta.get_field('id')
1287.         new_field = BigAutoField(primary_key=True)
1288.         new_field.set_attributes_from_name('id')
1289.         new_field.model = Author
1290.         with connection.schema_editor() as editor:
1291.             editor.alter_field(Author, old_field, new_field, strict=True)
1292. 
1293.         Author.objects.create(name='Foo', pk=1)
1294.         with connection.cursor() as cursor:
1295.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1296.             if sequence_reset_sqls:
1297.                 cursor.execute(sequence_reset_sqls[0])
1298.         # Fail on PostgreSQL if sequence is missing an owner.
1299.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1300. 
1301.     def test_alter_autofield_pk_to_smallautofield_pk_sequence_owner(self):
1302.         """
1303.         Converting an implicit PK to SmallAutoField(primary_key=True) should
1304.         keep a sequence owner on PostgreSQL.
1305.         """
1306.         with connection.schema_editor() as editor:
1307.             editor.create_model(Author)
1308.         old_field = Author._meta.get_field('id')
1309.         new_field = SmallAutoField(primary_key=True)
1310.         new_field.set_attributes_from_name('id')
1311.         new_field.model = Author
1312.         with connection.schema_editor() as editor:
1313.             editor.alter_field(Author, old_field, new_field, strict=True)
1314. 
1315.         Author.objects.create(name='Foo', pk=1)
1316.         with connection.cursor() as cursor:
1317.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1318.             if sequence_reset_sqls:
1319.                 cursor.execute(sequence_reset_sqls[0])
1320.         # Fail on PostgreSQL if sequence is missing an owner.
1321.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1322. 
1323.     def test_alter_int_pk_to_autofield_pk(self):
1324.         """
1325.         Should be able to rename an IntegerField(primary_key=True) to
1326.         AutoField(primary_key=True).
1327.         """
1328.         with connection.schema_editor() as editor:
1329.             editor.create_model(IntegerPK)
1330. 
1331.         old_field = IntegerPK._meta.get_field('i')
1332.         new_field = AutoField(primary_key=True)
1333.         new_field.model = IntegerPK
1334.         new_field.set_attributes_from_name('i')
1335. 
1336.         with connection.schema_editor() as editor:
1337.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1338. 
1339.     def test_alter_int_pk_to_bigautofield_pk(self):
1340.         """
1341.         Should be able to rename an IntegerField(primary_key=True) to
1342.         BigAutoField(primary_key=True).
1343.         """
1344.         with connection.schema_editor() as editor:
1345.             editor.create_model(IntegerPK)
1346. 
1347.         old_field = IntegerPK._meta.get_field('i')
1348.         new_field = BigAutoField(primary_key=True)
1349.         new_field.model = IntegerPK
1350.         new_field.set_attributes_from_name('i')
1351. 
1352.         with connection.schema_editor() as editor:
1353.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1354. 
1355.     @isolate_apps('schema')
1356.     def test_alter_smallint_pk_to_smallautofield_pk(self):
1357.         """
1358.         Should be able to rename an SmallIntegerField(primary_key=True) to
1359.         SmallAutoField(primary_key=True).
1360.         """
1361.         class SmallIntegerPK(Model):
1362.             i = SmallIntegerField(primary_key=True)
1363. 
1364.             class Meta:
1365.                 app_label = 'schema'
1366. 
1367.         with connection.schema_editor() as editor:
1368.             editor.create_model(SmallIntegerPK)
1369.         self.isolated_local_models = [SmallIntegerPK]
1370.         old_field = SmallIntegerPK._meta.get_field('i')
1371.         new_field = SmallAutoField(primary_key=True)
1372.         new_field.model = SmallIntegerPK
1373.         new_field.set_attributes_from_name('i')
1374.         with connection.schema_editor() as editor:
1375.             editor.alter_field(SmallIntegerPK, old_field, new_field, strict=True)
1376. 
1377.     def test_alter_int_pk_to_int_unique(self):
1378.         """
1379.         Should be able to rename an IntegerField(primary_key=True) to
1380.         IntegerField(unique=True).
1381.         """
1382.         with connection.schema_editor() as editor:
1383.             editor.create_model(IntegerPK)
1384.         # Delete the old PK
1385.         old_field = IntegerPK._meta.get_field('i')
1386.         new_field = IntegerField(unique=True)
1387.         new_field.model = IntegerPK
1388.         new_field.set_attributes_from_name('i')
1389.         with connection.schema_editor() as editor:
1390.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1391.         # The primary key constraint is gone. Result depends on database:
1392.         # 'id' for SQLite, None for others (must not be 'i').
1393.         self.assertIn(self.get_primary_key(IntegerPK._meta.db_table), ('id', None))
1394. 
1395.         # Set up a model class as it currently stands. The original IntegerPK
1396.         # class is now out of date and some backends make use of the whole
1397.         # model class when modifying a field (such as sqlite3 when remaking a
1398.         # table) so an outdated model class leads to incorrect results.
1399.         class Transitional(Model):
1400.             i = IntegerField(unique=True)
1401.             j = IntegerField(unique=True)
1402. 
1403.             class Meta:
1404.                 app_label = 'schema'
1405.                 apps = new_apps
1406.                 db_table = 'INTEGERPK'
1407. 
1408.         # model requires a new PK
1409.         old_field = Transitional._meta.get_field('j')
1410.         new_field = IntegerField(primary_key=True)
1411.         new_field.model = Transitional
1412.         new_field.set_attributes_from_name('j')
1413. 
1414.         with connection.schema_editor() as editor:
1415.             editor.alter_field(Transitional, old_field, new_field, strict=True)
1416. 
1417.         # Create a model class representing the updated model.
1418.         class IntegerUnique(Model):
1419.             i = IntegerField(unique=True)
1420.             j = IntegerField(primary_key=True)
1421. 
1422.             class Meta:
1423.                 app_label = 'schema'
1424.                 apps = new_apps
1425.                 db_table = 'INTEGERPK'
1426. 
1427.         # Ensure unique constraint works.
1428.         IntegerUnique.objects.create(i=1, j=1)
1429.         with self.assertRaises(IntegrityError):
1430.             IntegerUnique.objects.create(i=1, j=2)
1431. 
1432.     def test_rename(self):
1433.         """
1434.         Tests simple altering of fields
1435.         """
1436.         # Create the table
1437.         with connection.schema_editor() as editor:
1438.             editor.create_model(Author)
1439.         # Ensure the field is right to begin with
1440.         columns = self.column_classes(Author)
1441.         self.assertEqual(columns['name'][0], "CharField")
1442.         self.assertNotIn("display_name", columns)
1443.         # Alter the name field's name
1444.         old_field = Author._meta.get_field("name")
1445.         new_field = CharField(max_length=254)
1446.         new_field.set_attributes_from_name("display_name")
1447.         with connection.schema_editor() as editor:
1448.             editor.alter_field(Author, old_field, new_field, strict=True)
1449.         # Ensure the field is right afterwards
1450.         columns = self.column_classes(Author)
1451.         self.assertEqual(columns['display_name'][0], "CharField")
1452.         self.assertNotIn("name", columns)
1453. 
1454.     @isolate_apps('schema')
1455.     def test_rename_referenced_field(self):
1456.         class Author(Model):
1457.             name = CharField(max_length=255, unique=True)
1458. 
1459.             class Meta:
1460.                 app_label = 'schema'
1461. 
1462.         class Book(Model):
1463.             author = ForeignKey(Author, CASCADE, to_field='name')
1464. 
1465.             class Meta:
1466.                 app_label = 'schema'
1467. 
1468.         with connection.schema_editor() as editor:
1469.             editor.create_model(Author)
1470.             editor.create_model(Book)
1471.         new_field = CharField(max_length=255, unique=True)
1472.         new_field.set_attributes_from_name('renamed')
1473.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
1474.             editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1475.         # Ensure the foreign key reference was updated.
1476.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author', 'renamed')
1477. 
1478.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
1479.     def test_rename_keep_null_status(self):
1480.         """
1481.         Renaming a field shouldn't affect the not null status.
1482.         """
1483.         with connection.schema_editor() as editor:
1484.             editor.create_model(Note)
1485.         with self.assertRaises(IntegrityError):
1486.             Note.objects.create(info=None)
1487.         old_field = Note._meta.get_field("info")
1488.         new_field = TextField()
1489.         new_field.set_attributes_from_name("detail_info")
1490.         with connection.schema_editor() as editor:
1491.             editor.alter_field(Note, old_field, new_field, strict=True)
1492.         columns = self.column_classes(Note)
1493.         self.assertEqual(columns['detail_info'][0], "TextField")
1494.         self.assertNotIn("info", columns)
1495.         with self.assertRaises(IntegrityError):
1496.             NoteRename.objects.create(detail_info=None)
1497. 
1498.     def _test_m2m_create(self, M2MFieldClass):
1499.         """
1500.         Tests M2M fields on models during creation
1501.         """
1502.         class LocalBookWithM2M(Model):
1503.             author = ForeignKey(Author, CASCADE)
1504.             title = CharField(max_length=100, db_index=True)
1505.             pub_date = DateTimeField()
1506.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1507. 
1508.             class Meta:
1509.                 app_label = 'schema'
1510.                 apps = new_apps
1511.         self.local_models = [LocalBookWithM2M]
1512.         # Create the tables
1513.         with connection.schema_editor() as editor:
1514.             editor.create_model(Author)
1515.             editor.create_model(TagM2MTest)
1516.             editor.create_model(LocalBookWithM2M)
1517.         # Ensure there is now an m2m table there
1518.         columns = self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1519.         self.assertEqual(columns['tagm2mtest_id'][0], "IntegerField")
1520. 
1521.     def test_m2m_create(self):
1522.         self._test_m2m_create(ManyToManyField)
1523. 
1524.     def test_m2m_create_custom(self):
1525.         self._test_m2m_create(CustomManyToManyField)
1526. 
1527.     def test_m2m_create_inherited(self):
1528.         self._test_m2m_create(InheritedManyToManyField)
1529. 
1530.     def _test_m2m_create_through(self, M2MFieldClass):
1531.         """
1532.         Tests M2M fields on models during creation with through models
1533.         """
1534.         class LocalTagThrough(Model):
1535.             book = ForeignKey("schema.LocalBookWithM2MThrough", CASCADE)
1536.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1537. 
1538.             class Meta:
1539.                 app_label = 'schema'
1540.                 apps = new_apps
1541. 
1542.         class LocalBookWithM2MThrough(Model):
1543.             tags = M2MFieldClass("TagM2MTest", related_name="books", through=LocalTagThrough)
1544. 
1545.             class Meta:
1546.                 app_label = 'schema'
1547.                 apps = new_apps
1548. 
1549.         self.local_models = [LocalTagThrough, LocalBookWithM2MThrough]
1550. 
1551.         # Create the tables
1552.         with connection.schema_editor() as editor:
1553.             editor.create_model(LocalTagThrough)
1554.             editor.create_model(TagM2MTest)
1555.             editor.create_model(LocalBookWithM2MThrough)
1556.         # Ensure there is now an m2m table there
1557.         columns = self.column_classes(LocalTagThrough)
1558.         self.assertEqual(columns['book_id'][0], "IntegerField")
1559.         self.assertEqual(columns['tag_id'][0], "IntegerField")
1560. 
1561.     def test_m2m_create_through(self):
1562.         self._test_m2m_create_through(ManyToManyField)
1563. 
1564.     def test_m2m_create_through_custom(self):
1565.         self._test_m2m_create_through(CustomManyToManyField)
1566. 
1567.     def test_m2m_create_through_inherited(self):
1568.         self._test_m2m_create_through(InheritedManyToManyField)
1569. 
1570.     def _test_m2m(self, M2MFieldClass):
1571.         """
1572.         Tests adding/removing M2M fields on models
1573.         """
1574.         class LocalAuthorWithM2M(Model):
1575.             name = CharField(max_length=255)
1576. 
1577.             class Meta:
1578.                 app_label = 'schema'
1579.                 apps = new_apps
1580. 
1581.         self.local_models = [LocalAuthorWithM2M]
1582. 
1583.         # Create the tables
1584.         with connection.schema_editor() as editor:
1585.             editor.create_model(LocalAuthorWithM2M)
1586.             editor.create_model(TagM2MTest)
1587.         # Create an M2M field
1588.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors")
1589.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
1590.         # Ensure there's no m2m table there
1591.         with self.assertRaises(DatabaseError):
1592.             self.column_classes(new_field.remote_field.through)
1593.         # Add the field
1594.         with connection.schema_editor() as editor:
1595.             editor.add_field(LocalAuthorWithM2M, new_field)
1596.         # Ensure there is now an m2m table there
1597.         columns = self.column_classes(new_field.remote_field.through)
1598.         self.assertEqual(columns['tagm2mtest_id'][0], "IntegerField")
1599. 
1600.         # "Alter" the field. This should not rename the DB table to itself.
1601.         with connection.schema_editor() as editor:
1602.             editor.alter_field(LocalAuthorWithM2M, new_field, new_field, strict=True)
1603. 
1604.         # Remove the M2M table again
1605.         with connection.schema_editor() as editor:
1606.             editor.remove_field(LocalAuthorWithM2M, new_field)
1607.         # Ensure there's no m2m table there
1608.         with self.assertRaises(DatabaseError):
1609.             self.column_classes(new_field.remote_field.through)
1610. 
1611.         # Make sure the model state is coherent with the table one now that
1612.         # we've removed the tags field.
1613.         opts = LocalAuthorWithM2M._meta
1614.         opts.local_many_to_many.remove(new_field)
1615.         del new_apps.all_models['schema'][new_field.remote_field.through._meta.model_name]
1616.         opts._expire_cache()
1617. 
1618.     def test_m2m(self):
1619.         self._test_m2m(ManyToManyField)
1620. 
1621.     def test_m2m_custom(self):
1622.         self._test_m2m(CustomManyToManyField)
1623. 
1624.     def test_m2m_inherited(self):
1625.         self._test_m2m(InheritedManyToManyField)
1626. 
1627.     def _test_m2m_through_alter(self, M2MFieldClass):
1628.         """
1629.         Tests altering M2Ms with explicit through models (should no-op)
1630.         """
1631.         class LocalAuthorTag(Model):
1632.             author = ForeignKey("schema.LocalAuthorWithM2MThrough", CASCADE)
1633.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1634. 
1635.             class Meta:
1636.                 app_label = 'schema'
1637.                 apps = new_apps
1638. 
1639.         class LocalAuthorWithM2MThrough(Model):
1640.             name = CharField(max_length=255)
1641.             tags = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1642. 
1643.             class Meta:
1644.                 app_label = 'schema'
1645.                 apps = new_apps
1646. 
1647.         self.local_models = [LocalAuthorTag, LocalAuthorWithM2MThrough]
1648. 
1649.         # Create the tables
1650.         with connection.schema_editor() as editor:
1651.             editor.create_model(LocalAuthorTag)
1652.             editor.create_model(LocalAuthorWithM2MThrough)
1653.             editor.create_model(TagM2MTest)
1654.         # Ensure the m2m table is there
1655.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1656.         # "Alter" the field's blankness. This should not actually do anything.
1657.         old_field = LocalAuthorWithM2MThrough._meta.get_field("tags")
1658.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1659.         new_field.contribute_to_class(LocalAuthorWithM2MThrough, "tags")
1660.         with connection.schema_editor() as editor:
1661.             editor.alter_field(LocalAuthorWithM2MThrough, old_field, new_field, strict=True)
1662.         # Ensure the m2m table is still there
1663.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1664. 
1665.     def test_m2m_through_alter(self):
1666.         self._test_m2m_through_alter(ManyToManyField)
1667. 
1668.     def test_m2m_through_alter_custom(self):
1669.         self._test_m2m_through_alter(CustomManyToManyField)
1670. 
1671.     def test_m2m_through_alter_inherited(self):
1672.         self._test_m2m_through_alter(InheritedManyToManyField)
1673. 
1674.     def _test_m2m_repoint(self, M2MFieldClass):
1675.         """
1676.         Tests repointing M2M fields
1677.         """
1678.         class LocalBookWithM2M(Model):
1679.             author = ForeignKey(Author, CASCADE)
1680.             title = CharField(max_length=100, db_index=True)
1681.             pub_date = DateTimeField()
1682.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1683. 
1684.             class Meta:
1685.                 app_label = 'schema'
1686.                 apps = new_apps
1687.         self.local_models = [LocalBookWithM2M]
1688.         # Create the tables
1689.         with connection.schema_editor() as editor:
1690.             editor.create_model(Author)
1691.             editor.create_model(LocalBookWithM2M)
1692.             editor.create_model(TagM2MTest)
1693.             editor.create_model(UniqueTest)
1694.         # Ensure the M2M exists and points to TagM2MTest
1695.         if connection.features.supports_foreign_keys:
1696.             self.assertForeignKeyExists(
1697.                 LocalBookWithM2M._meta.get_field("tags").remote_field.through,
1698.                 'tagm2mtest_id',
1699.                 'schema_tagm2mtest',
1700.             )
1701.         # Repoint the M2M
1702.         old_field = LocalBookWithM2M._meta.get_field("tags")
1703.         new_field = M2MFieldClass(UniqueTest)
1704.         new_field.contribute_to_class(LocalBookWithM2M, "uniques")
1705.         with connection.schema_editor() as editor:
1706.             editor.alter_field(LocalBookWithM2M, old_field, new_field, strict=True)
1707.         # Ensure old M2M is gone
1708.         with self.assertRaises(DatabaseError):
1709.             self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1710. 
1711.         # This model looks like the new model and is used for teardown.
1712.         opts = LocalBookWithM2M._meta
1713.         opts.local_many_to_many.remove(old_field)
1714.         # Ensure the new M2M exists and points to UniqueTest
1715.         if connection.features.supports_foreign_keys:
1716.             self.assertForeignKeyExists(new_field.remote_field.through, 'uniquetest_id', 'schema_uniquetest')
1717. 
1718.     def test_m2m_repoint(self):
1719.         self._test_m2m_repoint(ManyToManyField)
1720. 
1721.     def test_m2m_repoint_custom(self):
1722.         self._test_m2m_repoint(CustomManyToManyField)
1723. 
1724.     def test_m2m_repoint_inherited(self):
1725.         self._test_m2m_repoint(InheritedManyToManyField)
1726. 
1727.     @isolate_apps('schema')
1728.     def test_m2m_rename_field_in_target_model(self):
1729.         class LocalTagM2MTest(Model):
1730.             title = CharField(max_length=255)
1731. 
1732.             class Meta:
1733.                 app_label = 'schema'
1734. 
1735.         class LocalM2M(Model):
1736.             tags = ManyToManyField(LocalTagM2MTest)
1737. 
1738.             class Meta:
1739.                 app_label = 'schema'
1740. 
1741.         # Create the tables.
1742.         with connection.schema_editor() as editor:
1743.             editor.create_model(LocalM2M)
1744.             editor.create_model(LocalTagM2MTest)
1745.         self.isolated_local_models = [LocalM2M, LocalTagM2MTest]
1746.         # Ensure the m2m table is there.
1747.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1748.         # Alter a field in LocalTagM2MTest.
1749.         old_field = LocalTagM2MTest._meta.get_field('title')
1750.         new_field = CharField(max_length=254)
1751.         new_field.contribute_to_class(LocalTagM2MTest, 'title1')
1752.         # @isolate_apps() and inner models are needed to have the model
1753.         # relations populated, otherwise this doesn't act as a regression test.
1754.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
1755.         with connection.schema_editor() as editor:
1756.             editor.alter_field(LocalTagM2MTest, old_field, new_field, strict=True)
1757.         # Ensure the m2m table is still there.
1758.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1759. 
1760.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1761.     def test_check_constraints(self):
1762.         """
1763.         Tests creating/deleting CHECK constraints
1764.         """
1765.         # Create the tables
1766.         with connection.schema_editor() as editor:
1767.             editor.create_model(Author)
1768.         # Ensure the constraint exists
1769.         constraints = self.get_constraints(Author._meta.db_table)
1770.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1771.             self.fail("No check constraint for height found")
1772.         # Alter the column to remove it
1773.         old_field = Author._meta.get_field("height")
1774.         new_field = IntegerField(null=True, blank=True)
1775.         new_field.set_attributes_from_name("height")
1776.         with connection.schema_editor() as editor:
1777.             editor.alter_field(Author, old_field, new_field, strict=True)
1778.         constraints = self.get_constraints(Author._meta.db_table)
1779.         for details in constraints.values():
1780.             if details['columns'] == ["height"] and details['check']:
1781.                 self.fail("Check constraint for height found")
1782.         # Alter the column to re-add it
1783.         new_field2 = Author._meta.get_field("height")
1784.         with connection.schema_editor() as editor:
1785.             editor.alter_field(Author, new_field, new_field2, strict=True)
1786.         constraints = self.get_constraints(Author._meta.db_table)
1787.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1788.             self.fail("No check constraint for height found")
1789. 
1790.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1791.     def test_remove_field_check_does_not_remove_meta_constraints(self):
1792.         with connection.schema_editor() as editor:
1793.             editor.create_model(Author)
1794.         # Add the custom check constraint
1795.         constraint = CheckConstraint(check=Q(height__gte=0), name='author_height_gte_0_check')
1796.         custom_constraint_name = constraint.name
1797.         Author._meta.constraints = [constraint]
1798.         with connection.schema_editor() as editor:
1799.             editor.add_constraint(Author, constraint)
1800.         # Ensure the constraints exist
1801.         constraints = self.get_constraints(Author._meta.db_table)
1802.         self.assertIn(custom_constraint_name, constraints)
1803.         other_constraints = [
1804.             name for name, details in constraints.items()
1805.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1806.         ]
1807.         self.assertEqual(len(other_constraints), 1)
1808.         # Alter the column to remove field check
1809.         old_field = Author._meta.get_field('height')
1810.         new_field = IntegerField(null=True, blank=True)
1811.         new_field.set_attributes_from_name('height')
1812.         with connection.schema_editor() as editor:
1813.             editor.alter_field(Author, old_field, new_field, strict=True)
1814.         constraints = self.get_constraints(Author._meta.db_table)
1815.         self.assertIn(custom_constraint_name, constraints)
1816.         other_constraints = [
1817.             name for name, details in constraints.items()
1818.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1819.         ]
1820.         self.assertEqual(len(other_constraints), 0)
1821.         # Alter the column to re-add field check
1822.         new_field2 = Author._meta.get_field('height')
1823.         with connection.schema_editor() as editor:
1824.             editor.alter_field(Author, new_field, new_field2, strict=True)
1825.         constraints = self.get_constraints(Author._meta.db_table)
1826.         self.assertIn(custom_constraint_name, constraints)
1827.         other_constraints = [
1828.             name for name, details in constraints.items()
1829.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1830.         ]
1831.         self.assertEqual(len(other_constraints), 1)
1832.         # Drop the check constraint
1833.         with connection.schema_editor() as editor:
1834.             Author._meta.constraints = []
1835.             editor.remove_constraint(Author, constraint)
1836. 
1837.     def test_unique(self):
1838.         """
1839.         Tests removing and adding unique constraints to a single column.
1840.         """
1841.         # Create the table
1842.         with connection.schema_editor() as editor:
1843.             editor.create_model(Tag)
1844.         # Ensure the field is unique to begin with
1845.         Tag.objects.create(title="foo", slug="foo")
1846.         with self.assertRaises(IntegrityError):
1847.             Tag.objects.create(title="bar", slug="foo")
1848.         Tag.objects.all().delete()
1849.         # Alter the slug field to be non-unique
1850.         old_field = Tag._meta.get_field("slug")
1851.         new_field = SlugField(unique=False)
1852.         new_field.set_attributes_from_name("slug")
1853.         with connection.schema_editor() as editor:
1854.             editor.alter_field(Tag, old_field, new_field, strict=True)
1855.         # Ensure the field is no longer unique
1856.         Tag.objects.create(title="foo", slug="foo")
1857.         Tag.objects.create(title="bar", slug="foo")
1858.         Tag.objects.all().delete()
1859.         # Alter the slug field to be unique
1860.         new_field2 = SlugField(unique=True)
1861.         new_field2.set_attributes_from_name("slug")
1862.         with connection.schema_editor() as editor:
1863.             editor.alter_field(Tag, new_field, new_field2, strict=True)
1864.         # Ensure the field is unique again
1865.         Tag.objects.create(title="foo", slug="foo")
1866.         with self.assertRaises(IntegrityError):
1867.             Tag.objects.create(title="bar", slug="foo")
1868.         Tag.objects.all().delete()
1869.         # Rename the field
1870.         new_field3 = SlugField(unique=True)
1871.         new_field3.set_attributes_from_name("slug2")
1872.         with connection.schema_editor() as editor:
1873.             editor.alter_field(Tag, new_field2, new_field3, strict=True)
1874.         # Ensure the field is still unique
1875.         TagUniqueRename.objects.create(title="foo", slug2="foo")
1876.         with self.assertRaises(IntegrityError):
1877.             TagUniqueRename.objects.create(title="bar", slug2="foo")
1878.         Tag.objects.all().delete()
1879. 
1880.     def test_unique_name_quoting(self):
1881.         old_table_name = TagUniqueRename._meta.db_table
1882.         try:
1883.             with connection.schema_editor() as editor:
1884.                 editor.create_model(TagUniqueRename)
1885.                 editor.alter_db_table(TagUniqueRename, old_table_name, 'unique-table')
1886.                 TagUniqueRename._meta.db_table = 'unique-table'
1887.                 # This fails if the unique index name isn't quoted.
1888.                 editor.alter_unique_together(TagUniqueRename, [], (('title', 'slug2'),))
1889.         finally:
1890.             TagUniqueRename._meta.db_table = old_table_name
1891. 
1892.     @isolate_apps('schema')
1893.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
1894.     @skipUnlessDBFeature('supports_foreign_keys')
1895.     def test_unique_no_unnecessary_fk_drops(self):
1896.         """
1897.         If AlterField isn't selective about dropping foreign key constraints
1898.         when modifying a field with a unique constraint, the AlterField
1899.         incorrectly drops and recreates the Book.author foreign key even though
1900.         it doesn't restrict the field being changed (#29193).
1901.         """
1902.         class Author(Model):
1903.             name = CharField(max_length=254, unique=True)
1904. 
1905.             class Meta:
1906.                 app_label = 'schema'
1907. 
1908.         class Book(Model):
1909.             author = ForeignKey(Author, CASCADE)
1910. 
1911.             class Meta:
1912.                 app_label = 'schema'
1913. 
1914.         with connection.schema_editor() as editor:
1915.             editor.create_model(Author)
1916.             editor.create_model(Book)
1917.         new_field = CharField(max_length=255, unique=True)
1918.         new_field.model = Author
1919.         new_field.set_attributes_from_name('name')
1920.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1921.             with connection.schema_editor() as editor:
1922.                 editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1923.         # One SQL statement is executed to alter the field.
1924.         self.assertEqual(len(cm.records), 1)
1925. 
1926.     @isolate_apps('schema')
1927.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite remakes the table on field alteration.')
1928.     def test_unique_and_reverse_m2m(self):
1929.         """
1930.         AlterField can modify a unique field when there's a reverse M2M
1931.         relation on the model.
1932.         """
1933.         class Tag(Model):
1934.             title = CharField(max_length=255)
1935.             slug = SlugField(unique=True)
1936. 
1937.             class Meta:
1938.                 app_label = 'schema'
1939. 
1940.         class Book(Model):
1941.             tags = ManyToManyField(Tag, related_name='books')
1942. 
1943.             class Meta:
1944.                 app_label = 'schema'
1945. 
1946.         self.isolated_local_models = [Book._meta.get_field('tags').remote_field.through]
1947.         with connection.schema_editor() as editor:
1948.             editor.create_model(Tag)
1949.             editor.create_model(Book)
1950.         new_field = SlugField(max_length=75, unique=True)
1951.         new_field.model = Tag
1952.         new_field.set_attributes_from_name('slug')
1953.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1954.             with connection.schema_editor() as editor:
1955.                 editor.alter_field(Tag, Tag._meta.get_field('slug'), new_field)
1956.         # One SQL statement is executed to alter the field.
1957.         self.assertEqual(len(cm.records), 1)
1958.         # Ensure that the field is still unique.
1959.         Tag.objects.create(title='foo', slug='foo')
1960.         with self.assertRaises(IntegrityError):
1961.             Tag.objects.create(title='bar', slug='foo')
1962. 
1963.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
1964.     def test_remove_field_unique_does_not_remove_meta_constraints(self):
1965.         with connection.schema_editor() as editor:
1966.             editor.create_model(AuthorWithUniqueName)
1967.         # Add the custom unique constraint
1968.         constraint = UniqueConstraint(fields=['name'], name='author_name_uniq')
1969.         custom_constraint_name = constraint.name
1970.         AuthorWithUniqueName._meta.constraints = [constraint]
1971.         with connection.schema_editor() as editor:
1972.             editor.add_constraint(AuthorWithUniqueName, constraint)
1973.         # Ensure the constraints exist
1974.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1975.         self.assertIn(custom_constraint_name, constraints)
1976.         other_constraints = [
1977.             name for name, details in constraints.items()
1978.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
1979.         ]
1980.         self.assertEqual(len(other_constraints), 1)
1981.         # Alter the column to remove field uniqueness
1982.         old_field = AuthorWithUniqueName._meta.get_field('name')
1983.         new_field = CharField(max_length=255)
1984.         new_field.set_attributes_from_name('name')
1985.         with connection.schema_editor() as editor:
1986.             editor.alter_field(AuthorWithUniqueName, old_field, new_field, strict=True)
1987.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1988.         self.assertIn(custom_constraint_name, constraints)
1989.         other_constraints = [
1990.             name for name, details in constraints.items()
1991.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
1992.         ]
1993.         self.assertEqual(len(other_constraints), 0)
1994.         # Alter the column to re-add field uniqueness
1995.         new_field2 = AuthorWithUniqueName._meta.get_field('name')
1996.         with connection.schema_editor() as editor:
1997.             editor.alter_field(AuthorWithUniqueName, new_field, new_field2, strict=True)
1998.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1999.         self.assertIn(custom_constraint_name, constraints)
2000.         other_constraints = [


File: tests/schema/tests.py
Line number range: 2001 - 4000
Content:
2001.             name for name, details in constraints.items()
2002.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2003.         ]
2004.         self.assertEqual(len(other_constraints), 1)
2005.         # Drop the unique constraint
2006.         with connection.schema_editor() as editor:
2007.             AuthorWithUniqueName._meta.constraints = []
2008.             editor.remove_constraint(AuthorWithUniqueName, constraint)
2009. 
2010.     def test_unique_together(self):
2011.         """
2012.         Tests removing and adding unique_together constraints on a model.
2013.         """
2014.         # Create the table
2015.         with connection.schema_editor() as editor:
2016.             editor.create_model(UniqueTest)
2017.         # Ensure the fields are unique to begin with
2018.         UniqueTest.objects.create(year=2012, slug="foo")
2019.         UniqueTest.objects.create(year=2011, slug="foo")
2020.         UniqueTest.objects.create(year=2011, slug="bar")
2021.         with self.assertRaises(IntegrityError):
2022.             UniqueTest.objects.create(year=2012, slug="foo")
2023.         UniqueTest.objects.all().delete()
2024.         # Alter the model to its non-unique-together companion
2025.         with connection.schema_editor() as editor:
2026.             editor.alter_unique_together(UniqueTest, UniqueTest._meta.unique_together, [])
2027.         # Ensure the fields are no longer unique
2028.         UniqueTest.objects.create(year=2012, slug="foo")
2029.         UniqueTest.objects.create(year=2012, slug="foo")
2030.         UniqueTest.objects.all().delete()
2031.         # Alter it back
2032.         new_field2 = SlugField(unique=True)
2033.         new_field2.set_attributes_from_name("slug")
2034.         with connection.schema_editor() as editor:
2035.             editor.alter_unique_together(UniqueTest, [], UniqueTest._meta.unique_together)
2036.         # Ensure the fields are unique again
2037.         UniqueTest.objects.create(year=2012, slug="foo")
2038.         with self.assertRaises(IntegrityError):
2039.             UniqueTest.objects.create(year=2012, slug="foo")
2040.         UniqueTest.objects.all().delete()
2041. 
2042.     def test_unique_together_with_fk(self):
2043.         """
2044.         Tests removing and adding unique_together constraints that include
2045.         a foreign key.
2046.         """
2047.         # Create the table
2048.         with connection.schema_editor() as editor:
2049.             editor.create_model(Author)
2050.             editor.create_model(Book)
2051.         # Ensure the fields are unique to begin with
2052.         self.assertEqual(Book._meta.unique_together, ())
2053.         # Add the unique_together constraint
2054.         with connection.schema_editor() as editor:
2055.             editor.alter_unique_together(Book, [], [['author', 'title']])
2056.         # Alter it back
2057.         with connection.schema_editor() as editor:
2058.             editor.alter_unique_together(Book, [['author', 'title']], [])
2059. 
2060.     def test_unique_together_with_fk_with_existing_index(self):
2061.         """
2062.         Tests removing and adding unique_together constraints that include
2063.         a foreign key, where the foreign key is added after the model is
2064.         created.
2065.         """
2066.         # Create the tables
2067.         with connection.schema_editor() as editor:
2068.             editor.create_model(Author)
2069.             editor.create_model(BookWithoutAuthor)
2070.             new_field = ForeignKey(Author, CASCADE)
2071.             new_field.set_attributes_from_name('author')
2072.             editor.add_field(BookWithoutAuthor, new_field)
2073.         # Ensure the fields aren't unique to begin with
2074.         self.assertEqual(Book._meta.unique_together, ())
2075.         # Add the unique_together constraint
2076.         with connection.schema_editor() as editor:
2077.             editor.alter_unique_together(Book, [], [['author', 'title']])
2078.         # Alter it back
2079.         with connection.schema_editor() as editor:
2080.             editor.alter_unique_together(Book, [['author', 'title']], [])
2081. 
2082.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2083.     def test_remove_unique_together_does_not_remove_meta_constraints(self):
2084.         with connection.schema_editor() as editor:
2085.             editor.create_model(AuthorWithUniqueNameAndBirthday)
2086.         # Add the custom unique constraint
2087.         constraint = UniqueConstraint(fields=['name', 'birthday'], name='author_name_birthday_uniq')
2088.         custom_constraint_name = constraint.name
2089.         AuthorWithUniqueNameAndBirthday._meta.constraints = [constraint]
2090.         with connection.schema_editor() as editor:
2091.             editor.add_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2092.         # Ensure the constraints exist
2093.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2094.         self.assertIn(custom_constraint_name, constraints)
2095.         other_constraints = [
2096.             name for name, details in constraints.items()
2097.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2098.         ]
2099.         self.assertEqual(len(other_constraints), 1)
2100.         # Remove unique together
2101.         unique_together = AuthorWithUniqueNameAndBirthday._meta.unique_together
2102.         with connection.schema_editor() as editor:
2103.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, unique_together, [])
2104.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2105.         self.assertIn(custom_constraint_name, constraints)
2106.         other_constraints = [
2107.             name for name, details in constraints.items()
2108.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2109.         ]
2110.         self.assertEqual(len(other_constraints), 0)
2111.         # Re-add unique together
2112.         with connection.schema_editor() as editor:
2113.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, [], unique_together)
2114.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2115.         self.assertIn(custom_constraint_name, constraints)
2116.         other_constraints = [
2117.             name for name, details in constraints.items()
2118.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2119.         ]
2120.         self.assertEqual(len(other_constraints), 1)
2121.         # Drop the unique constraint
2122.         with connection.schema_editor() as editor:
2123.             AuthorWithUniqueNameAndBirthday._meta.constraints = []
2124.             editor.remove_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2125. 
2126.     def test_index_together(self):
2127.         """
2128.         Tests removing and adding index_together constraints on a model.
2129.         """
2130.         # Create the table
2131.         with connection.schema_editor() as editor:
2132.             editor.create_model(Tag)
2133.         # Ensure there's no index on the year/slug columns first
2134.         self.assertIs(
2135.             any(
2136.                 c["index"]
2137.                 for c in self.get_constraints("schema_tag").values()
2138.                 if c['columns'] == ["slug", "title"]
2139.             ),
2140.             False,
2141.         )
2142.         # Alter the model to add an index
2143.         with connection.schema_editor() as editor:
2144.             editor.alter_index_together(Tag, [], [("slug", "title")])
2145.         # Ensure there is now an index
2146.         self.assertIs(
2147.             any(
2148.                 c["index"]
2149.                 for c in self.get_constraints("schema_tag").values()
2150.                 if c['columns'] == ["slug", "title"]
2151.             ),
2152.             True,
2153.         )
2154.         # Alter it back
2155.         new_field2 = SlugField(unique=True)
2156.         new_field2.set_attributes_from_name("slug")
2157.         with connection.schema_editor() as editor:
2158.             editor.alter_index_together(Tag, [("slug", "title")], [])
2159.         # Ensure there's no index
2160.         self.assertIs(
2161.             any(
2162.                 c["index"]
2163.                 for c in self.get_constraints("schema_tag").values()
2164.                 if c['columns'] == ["slug", "title"]
2165.             ),
2166.             False,
2167.         )
2168. 
2169.     def test_index_together_with_fk(self):
2170.         """
2171.         Tests removing and adding index_together constraints that include
2172.         a foreign key.
2173.         """
2174.         # Create the table
2175.         with connection.schema_editor() as editor:
2176.             editor.create_model(Author)
2177.             editor.create_model(Book)
2178.         # Ensure the fields are unique to begin with
2179.         self.assertEqual(Book._meta.index_together, ())
2180.         # Add the unique_together constraint
2181.         with connection.schema_editor() as editor:
2182.             editor.alter_index_together(Book, [], [['author', 'title']])
2183.         # Alter it back
2184.         with connection.schema_editor() as editor:
2185.             editor.alter_index_together(Book, [['author', 'title']], [])
2186. 
2187.     def test_create_index_together(self):
2188.         """
2189.         Tests creating models with index_together already defined
2190.         """
2191.         # Create the table
2192.         with connection.schema_editor() as editor:
2193.             editor.create_model(TagIndexed)
2194.         # Ensure there is an index
2195.         self.assertIs(
2196.             any(
2197.                 c["index"]
2198.                 for c in self.get_constraints("schema_tagindexed").values()
2199.                 if c['columns'] == ["slug", "title"]
2200.             ),
2201.             True,
2202.         )
2203. 
2204.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2205.     def test_remove_index_together_does_not_remove_meta_indexes(self):
2206.         with connection.schema_editor() as editor:
2207.             editor.create_model(AuthorWithIndexedNameAndBirthday)
2208.         # Add the custom index
2209.         index = Index(fields=['name', 'birthday'], name='author_name_birthday_idx')
2210.         custom_index_name = index.name
2211.         AuthorWithIndexedNameAndBirthday._meta.indexes = [index]
2212.         with connection.schema_editor() as editor:
2213.             editor.add_index(AuthorWithIndexedNameAndBirthday, index)
2214.         # Ensure the indexes exist
2215.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2216.         self.assertIn(custom_index_name, constraints)
2217.         other_constraints = [
2218.             name for name, details in constraints.items()
2219.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2220.         ]
2221.         self.assertEqual(len(other_constraints), 1)
2222.         # Remove index together
2223.         index_together = AuthorWithIndexedNameAndBirthday._meta.index_together
2224.         with connection.schema_editor() as editor:
2225.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, index_together, [])
2226.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2227.         self.assertIn(custom_index_name, constraints)
2228.         other_constraints = [
2229.             name for name, details in constraints.items()
2230.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2231.         ]
2232.         self.assertEqual(len(other_constraints), 0)
2233.         # Re-add index together
2234.         with connection.schema_editor() as editor:
2235.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, [], index_together)
2236.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2237.         self.assertIn(custom_index_name, constraints)
2238.         other_constraints = [
2239.             name for name, details in constraints.items()
2240.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2241.         ]
2242.         self.assertEqual(len(other_constraints), 1)
2243.         # Drop the index
2244.         with connection.schema_editor() as editor:
2245.             AuthorWithIndexedNameAndBirthday._meta.indexes = []
2246.             editor.remove_index(AuthorWithIndexedNameAndBirthday, index)
2247. 
2248.     @isolate_apps('schema')
2249.     def test_db_table(self):
2250.         """
2251.         Tests renaming of the table
2252.         """
2253.         class Author(Model):
2254.             name = CharField(max_length=255)
2255. 
2256.             class Meta:
2257.                 app_label = 'schema'
2258. 
2259.         class Book(Model):
2260.             author = ForeignKey(Author, CASCADE)
2261. 
2262.             class Meta:
2263.                 app_label = 'schema'
2264. 
2265.         # Create the table and one referring it.
2266.         with connection.schema_editor() as editor:
2267.             editor.create_model(Author)
2268.             editor.create_model(Book)
2269.         # Ensure the table is there to begin with
2270.         columns = self.column_classes(Author)
2271.         self.assertEqual(columns['name'][0], "CharField")
2272.         # Alter the table
2273.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2274.             editor.alter_db_table(Author, "schema_author", "schema_otherauthor")
2275.         # Ensure the table is there afterwards
2276.         Author._meta.db_table = "schema_otherauthor"
2277.         columns = self.column_classes(Author)
2278.         self.assertEqual(columns['name'][0], "CharField")
2279.         # Ensure the foreign key reference was updated
2280.         self.assertForeignKeyExists(Book, "author_id", "schema_otherauthor")
2281.         # Alter the table again
2282.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2283.             editor.alter_db_table(Author, "schema_otherauthor", "schema_author")
2284.         # Ensure the table is still there
2285.         Author._meta.db_table = "schema_author"
2286.         columns = self.column_classes(Author)
2287.         self.assertEqual(columns['name'][0], "CharField")
2288. 
2289.     def test_add_remove_index(self):
2290.         """
2291.         Tests index addition and removal
2292.         """
2293.         # Create the table
2294.         with connection.schema_editor() as editor:
2295.             editor.create_model(Author)
2296.         # Ensure the table is there and has no index
2297.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2298.         # Add the index
2299.         index = Index(fields=['name'], name='author_title_idx')
2300.         with connection.schema_editor() as editor:
2301.             editor.add_index(Author, index)
2302.         self.assertIn('name', self.get_indexes(Author._meta.db_table))
2303.         # Drop the index
2304.         with connection.schema_editor() as editor:
2305.             editor.remove_index(Author, index)
2306.         self.assertNotIn('name', self.get_indexes(Author._meta.db_table))
2307. 
2308.     def test_remove_db_index_doesnt_remove_custom_indexes(self):
2309.         """
2310.         Changing db_index to False doesn't remove indexes from Meta.indexes.
2311.         """
2312.         with connection.schema_editor() as editor:
2313.             editor.create_model(AuthorWithIndexedName)
2314.         # Ensure the table has its index
2315.         self.assertIn('name', self.get_indexes(AuthorWithIndexedName._meta.db_table))
2316. 
2317.         # Add the custom index
2318.         index = Index(fields=['-name'], name='author_name_idx')
2319.         author_index_name = index.name
2320.         with connection.schema_editor() as editor:
2321.             db_index_name = editor._create_index_name(
2322.                 table_name=AuthorWithIndexedName._meta.db_table,
2323.                 column_names=('name',),
2324.             )
2325.         try:
2326.             AuthorWithIndexedName._meta.indexes = [index]
2327.             with connection.schema_editor() as editor:
2328.                 editor.add_index(AuthorWithIndexedName, index)
2329.             old_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2330.             self.assertIn(author_index_name, old_constraints)
2331.             self.assertIn(db_index_name, old_constraints)
2332.             # Change name field to db_index=False
2333.             old_field = AuthorWithIndexedName._meta.get_field('name')
2334.             new_field = CharField(max_length=255)
2335.             new_field.set_attributes_from_name('name')
2336.             with connection.schema_editor() as editor:
2337.                 editor.alter_field(AuthorWithIndexedName, old_field, new_field, strict=True)
2338.             new_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2339.             self.assertNotIn(db_index_name, new_constraints)
2340.             # The index from Meta.indexes is still in the database.
2341.             self.assertIn(author_index_name, new_constraints)
2342.             # Drop the index
2343.             with connection.schema_editor() as editor:
2344.                 editor.remove_index(AuthorWithIndexedName, index)
2345.         finally:
2346.             AuthorWithIndexedName._meta.indexes = []
2347. 
2348.     def test_order_index(self):
2349.         """
2350.         Indexes defined with ordering (ASC/DESC) defined on column
2351.         """
2352.         with connection.schema_editor() as editor:
2353.             editor.create_model(Author)
2354.         # The table doesn't have an index
2355.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2356.         index_name = 'author_name_idx'
2357.         # Add the index
2358.         index = Index(fields=['name', '-weight'], name=index_name)
2359.         with connection.schema_editor() as editor:
2360.             editor.add_index(Author, index)
2361.         if connection.features.supports_index_column_ordering:
2362.             self.assertIndexOrder(Author._meta.db_table, index_name, ['ASC', 'DESC'])
2363.         # Drop the index
2364.         with connection.schema_editor() as editor:
2365.             editor.remove_index(Author, index)
2366. 
2367.     def test_indexes(self):
2368.         """
2369.         Tests creation/altering of indexes
2370.         """
2371.         # Create the table
2372.         with connection.schema_editor() as editor:
2373.             editor.create_model(Author)
2374.             editor.create_model(Book)
2375.         # Ensure the table is there and has the right index
2376.         self.assertIn(
2377.             "title",
2378.             self.get_indexes(Book._meta.db_table),
2379.         )
2380.         # Alter to remove the index
2381.         old_field = Book._meta.get_field("title")
2382.         new_field = CharField(max_length=100, db_index=False)
2383.         new_field.set_attributes_from_name("title")
2384.         with connection.schema_editor() as editor:
2385.             editor.alter_field(Book, old_field, new_field, strict=True)
2386.         # Ensure the table is there and has no index
2387.         self.assertNotIn(
2388.             "title",
2389.             self.get_indexes(Book._meta.db_table),
2390.         )
2391.         # Alter to re-add the index
2392.         new_field2 = Book._meta.get_field("title")
2393.         with connection.schema_editor() as editor:
2394.             editor.alter_field(Book, new_field, new_field2, strict=True)
2395.         # Ensure the table is there and has the index again
2396.         self.assertIn(
2397.             "title",
2398.             self.get_indexes(Book._meta.db_table),
2399.         )
2400.         # Add a unique column, verify that creates an implicit index
2401.         new_field3 = BookWithSlug._meta.get_field("slug")
2402.         with connection.schema_editor() as editor:
2403.             editor.add_field(Book, new_field3)
2404.         self.assertIn(
2405.             "slug",
2406.             self.get_uniques(Book._meta.db_table),
2407.         )
2408.         # Remove the unique, check the index goes with it
2409.         new_field4 = CharField(max_length=20, unique=False)
2410.         new_field4.set_attributes_from_name("slug")
2411.         with connection.schema_editor() as editor:
2412.             editor.alter_field(BookWithSlug, new_field3, new_field4, strict=True)
2413.         self.assertNotIn(
2414.             "slug",
2415.             self.get_uniques(Book._meta.db_table),
2416.         )
2417. 
2418.     def test_text_field_with_db_index(self):
2419.         with connection.schema_editor() as editor:
2420.             editor.create_model(AuthorTextFieldWithIndex)
2421.         # The text_field index is present if the database supports it.
2422.         assertion = self.assertIn if connection.features.supports_index_on_text_field else self.assertNotIn
2423.         assertion('text_field', self.get_indexes(AuthorTextFieldWithIndex._meta.db_table))
2424. 
2425.     def test_primary_key(self):
2426.         """
2427.         Tests altering of the primary key
2428.         """
2429.         # Create the table
2430.         with connection.schema_editor() as editor:
2431.             editor.create_model(Tag)
2432.         # Ensure the table is there and has the right PK
2433.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'id')
2434.         # Alter to change the PK
2435.         id_field = Tag._meta.get_field("id")
2436.         old_field = Tag._meta.get_field("slug")
2437.         new_field = SlugField(primary_key=True)
2438.         new_field.set_attributes_from_name("slug")
2439.         new_field.model = Tag
2440.         with connection.schema_editor() as editor:
2441.             editor.remove_field(Tag, id_field)
2442.             editor.alter_field(Tag, old_field, new_field)
2443.         # Ensure the PK changed
2444.         self.assertNotIn(
2445.             'id',
2446.             self.get_indexes(Tag._meta.db_table),
2447.         )
2448.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'slug')
2449. 
2450.     def test_context_manager_exit(self):
2451.         """
2452.         Ensures transaction is correctly closed when an error occurs
2453.         inside a SchemaEditor context.
2454.         """
2455.         class SomeError(Exception):
2456.             pass
2457.         try:
2458.             with connection.schema_editor():
2459.                 raise SomeError
2460.         except SomeError:
2461.             self.assertFalse(connection.in_atomic_block)
2462. 
2463.     @skipIfDBFeature('can_rollback_ddl')
2464.     def test_unsupported_transactional_ddl_disallowed(self):
2465.         message = (
2466.             "Executing DDL statements while in a transaction on databases "
2467.             "that can't perform a rollback is prohibited."
2468.         )
2469.         with atomic(), connection.schema_editor() as editor:
2470.             with self.assertRaisesMessage(TransactionManagementError, message):
2471.                 editor.execute(editor.sql_create_table % {'table': 'foo', 'definition': ''})
2472. 
2473.     @skipUnlessDBFeature('supports_foreign_keys')
2474.     def test_foreign_key_index_long_names_regression(self):
2475.         """
2476.         Regression test for #21497.
2477.         Only affects databases that supports foreign keys.
2478.         """
2479.         # Create the table
2480.         with connection.schema_editor() as editor:
2481.             editor.create_model(AuthorWithEvenLongerName)
2482.             editor.create_model(BookWithLongName)
2483.         # Find the properly shortened column name
2484.         column_name = connection.ops.quote_name("author_foreign_key_with_really_long_field_name_id")
2485.         column_name = column_name[1:-1].lower()  # unquote, and, for Oracle, un-upcase
2486.         # Ensure the table is there and has an index on the column
2487.         self.assertIn(
2488.             column_name,
2489.             self.get_indexes(BookWithLongName._meta.db_table),
2490.         )
2491. 
2492.     @skipUnlessDBFeature('supports_foreign_keys')
2493.     def test_add_foreign_key_long_names(self):
2494.         """
2495.         Regression test for #23009.
2496.         Only affects databases that supports foreign keys.
2497.         """
2498.         # Create the initial tables
2499.         with connection.schema_editor() as editor:
2500.             editor.create_model(AuthorWithEvenLongerName)
2501.             editor.create_model(BookWithLongName)
2502.         # Add a second FK, this would fail due to long ref name before the fix
2503.         new_field = ForeignKey(AuthorWithEvenLongerName, CASCADE, related_name="something")
2504.         new_field.set_attributes_from_name("author_other_really_long_named_i_mean_so_long_fk")
2505.         with connection.schema_editor() as editor:
2506.             editor.add_field(BookWithLongName, new_field)
2507. 
2508.     @isolate_apps('schema')
2509.     @skipUnlessDBFeature('supports_foreign_keys')
2510.     def test_add_foreign_key_quoted_db_table(self):
2511.         class Author(Model):
2512.             class Meta:
2513.                 db_table = '"table_author_double_quoted"'
2514.                 app_label = 'schema'
2515. 
2516.         class Book(Model):
2517.             author = ForeignKey(Author, CASCADE)
2518. 
2519.             class Meta:
2520.                 app_label = 'schema'
2521. 
2522.         with connection.schema_editor() as editor:
2523.             editor.create_model(Author)
2524.             editor.create_model(Book)
2525.         if connection.vendor == 'mysql':
2526.             self.assertForeignKeyExists(Book, 'author_id', '"table_author_double_quoted"')
2527.         else:
2528.             self.assertForeignKeyExists(Book, 'author_id', 'table_author_double_quoted')
2529. 
2530.     def test_add_foreign_object(self):
2531.         with connection.schema_editor() as editor:
2532.             editor.create_model(BookForeignObj)
2533. 
2534.         new_field = ForeignObject(Author, on_delete=CASCADE, from_fields=['author_id'], to_fields=['id'])
2535.         new_field.set_attributes_from_name('author')
2536.         with connection.schema_editor() as editor:
2537.             editor.add_field(BookForeignObj, new_field)
2538. 
2539.     def test_creation_deletion_reserved_names(self):
2540.         """
2541.         Tries creating a model's table, and then deleting it when it has a
2542.         SQL reserved name.
2543.         """
2544.         # Create the table
2545.         with connection.schema_editor() as editor:
2546.             try:
2547.                 editor.create_model(Thing)
2548.             except OperationalError as e:
2549.                 self.fail("Errors when applying initial migration for a model "
2550.                           "with a table named after an SQL reserved word: %s" % e)
2551.         # The table is there
2552.         list(Thing.objects.all())
2553.         # Clean up that table
2554.         with connection.schema_editor() as editor:
2555.             editor.delete_model(Thing)
2556.         # The table is gone
2557.         with self.assertRaises(DatabaseError):
2558.             list(Thing.objects.all())
2559. 
2560.     def test_remove_constraints_capital_letters(self):
2561.         """
2562.         #23065 - Constraint names must be quoted if they contain capital letters.
2563.         """
2564.         def get_field(*args, field_class=IntegerField, **kwargs):
2565.             kwargs['db_column'] = "CamelCase"
2566.             field = field_class(*args, **kwargs)
2567.             field.set_attributes_from_name("CamelCase")
2568.             return field
2569. 
2570.         model = Author
2571.         field = get_field()
2572.         table = model._meta.db_table
2573.         column = field.column
2574.         identifier_converter = connection.introspection.identifier_converter
2575. 
2576.         with connection.schema_editor() as editor:
2577.             editor.create_model(model)
2578.             editor.add_field(model, field)
2579. 
2580.             constraint_name = 'CamelCaseIndex'
2581.             expected_constraint_name = identifier_converter(constraint_name)
2582.             editor.execute(
2583.                 editor.sql_create_index % {
2584.                     "table": editor.quote_name(table),
2585.                     "name": editor.quote_name(constraint_name),
2586.                     "using": "",
2587.                     "columns": editor.quote_name(column),
2588.                     "extra": "",
2589.                     "condition": "",
2590.                 }
2591.             )
2592.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2593.             editor.alter_field(model, get_field(db_index=True), field, strict=True)
2594.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2595. 
2596.             constraint_name = 'CamelCaseUniqConstraint'
2597.             expected_constraint_name = identifier_converter(constraint_name)
2598.             editor.execute(editor._create_unique_sql(model, [field.column], constraint_name))
2599.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2600.             editor.alter_field(model, get_field(unique=True), field, strict=True)
2601.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2602. 
2603.             if editor.sql_create_fk:
2604.                 constraint_name = 'CamelCaseFKConstraint'
2605.                 expected_constraint_name = identifier_converter(constraint_name)
2606.                 editor.execute(
2607.                     editor.sql_create_fk % {
2608.                         "table": editor.quote_name(table),
2609.                         "name": editor.quote_name(constraint_name),
2610.                         "column": editor.quote_name(column),
2611.                         "to_table": editor.quote_name(table),
2612.                         "to_column": editor.quote_name(model._meta.auto_field.column),
2613.                         "deferrable": connection.ops.deferrable_sql(),
2614.                     }
2615.                 )
2616.                 self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2617.                 editor.alter_field(model, get_field(Author, CASCADE, field_class=ForeignKey), field, strict=True)
2618.                 self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2619. 
2620.     def test_add_field_use_effective_default(self):
2621.         """
2622.         #23987 - effective_default() should be used as the field default when
2623.         adding a new field.
2624.         """
2625.         # Create the table
2626.         with connection.schema_editor() as editor:
2627.             editor.create_model(Author)
2628.         # Ensure there's no surname field
2629.         columns = self.column_classes(Author)
2630.         self.assertNotIn("surname", columns)
2631.         # Create a row
2632.         Author.objects.create(name='Anonymous1')
2633.         # Add new CharField to ensure default will be used from effective_default
2634.         new_field = CharField(max_length=15, blank=True)
2635.         new_field.set_attributes_from_name("surname")
2636.         with connection.schema_editor() as editor:
2637.             editor.add_field(Author, new_field)
2638.         # Ensure field was added with the right default
2639.         with connection.cursor() as cursor:
2640.             cursor.execute("SELECT surname FROM schema_author;")
2641.             item = cursor.fetchall()[0]
2642.             self.assertEqual(item[0], None if connection.features.interprets_empty_strings_as_nulls else '')
2643. 
2644.     def test_add_field_default_dropped(self):
2645.         # Create the table
2646.         with connection.schema_editor() as editor:
2647.             editor.create_model(Author)
2648.         # Ensure there's no surname field
2649.         columns = self.column_classes(Author)
2650.         self.assertNotIn("surname", columns)
2651.         # Create a row
2652.         Author.objects.create(name='Anonymous1')
2653.         # Add new CharField with a default
2654.         new_field = CharField(max_length=15, blank=True, default='surname default')
2655.         new_field.set_attributes_from_name("surname")
2656.         with connection.schema_editor() as editor:
2657.             editor.add_field(Author, new_field)
2658.         # Ensure field was added with the right default
2659.         with connection.cursor() as cursor:
2660.             cursor.execute("SELECT surname FROM schema_author;")
2661.             item = cursor.fetchall()[0]
2662.             self.assertEqual(item[0], 'surname default')
2663.             # And that the default is no longer set in the database.
2664.             field = next(
2665.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
2666.                 if f.name == "surname"
2667.             )
2668.             if connection.features.can_introspect_default:
2669.                 self.assertIsNone(field.default)
2670. 
2671.     def test_alter_field_default_dropped(self):
2672.         # Create the table
2673.         with connection.schema_editor() as editor:
2674.             editor.create_model(Author)
2675.         # Create a row
2676.         Author.objects.create(name='Anonymous1')
2677.         self.assertIsNone(Author.objects.get().height)
2678.         old_field = Author._meta.get_field('height')
2679.         # The default from the new field is used in updating existing rows.
2680.         new_field = IntegerField(blank=True, default=42)
2681.         new_field.set_attributes_from_name('height')
2682.         with connection.schema_editor() as editor:
2683.             editor.alter_field(Author, old_field, new_field, strict=True)
2684.         self.assertEqual(Author.objects.get().height, 42)
2685.         # The database default should be removed.
2686.         with connection.cursor() as cursor:
2687.             field = next(
2688.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
2689.                 if f.name == "height"
2690.             )
2691.             if connection.features.can_introspect_default:
2692.                 self.assertIsNone(field.default)
2693. 
2694.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
2695.     def test_alter_field_default_doesnt_perform_queries(self):
2696.         """
2697.         No queries are performed if a field default changes and the field's
2698.         not changing from null to non-null.
2699.         """
2700.         with connection.schema_editor() as editor:
2701.             editor.create_model(AuthorWithDefaultHeight)
2702.         old_field = AuthorWithDefaultHeight._meta.get_field('height')
2703.         new_default = old_field.default * 2
2704.         new_field = PositiveIntegerField(null=True, blank=True, default=new_default)
2705.         new_field.set_attributes_from_name('height')
2706.         with connection.schema_editor() as editor, self.assertNumQueries(0):
2707.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
2708. 
2709.     def test_add_textfield_unhashable_default(self):
2710.         # Create the table
2711.         with connection.schema_editor() as editor:
2712.             editor.create_model(Author)
2713.         # Create a row
2714.         Author.objects.create(name='Anonymous1')
2715.         # Create a field that has an unhashable default
2716.         new_field = TextField(default={})
2717.         new_field.set_attributes_from_name("info")
2718.         with connection.schema_editor() as editor:
2719.             editor.add_field(Author, new_field)
2720. 
2721.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2722.     def test_add_indexed_charfield(self):
2723.         field = CharField(max_length=255, db_index=True)
2724.         field.set_attributes_from_name('nom_de_plume')
2725.         with connection.schema_editor() as editor:
2726.             editor.create_model(Author)
2727.             editor.add_field(Author, field)
2728.         # Should create two indexes; one for like operator.
2729.         self.assertEqual(
2730.             self.get_constraints_for_column(Author, 'nom_de_plume'),
2731.             ['schema_author_nom_de_plume_7570a851', 'schema_author_nom_de_plume_7570a851_like'],
2732.         )
2733. 
2734.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2735.     def test_add_unique_charfield(self):
2736.         field = CharField(max_length=255, unique=True)
2737.         field.set_attributes_from_name('nom_de_plume')
2738.         with connection.schema_editor() as editor:
2739.             editor.create_model(Author)
2740.             editor.add_field(Author, field)
2741.         # Should create two indexes; one for like operator.
2742.         self.assertEqual(
2743.             self.get_constraints_for_column(Author, 'nom_de_plume'),
2744.             ['schema_author_nom_de_plume_7570a851_like', 'schema_author_nom_de_plume_key']
2745.         )
2746. 
2747.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2748.     def test_alter_field_add_index_to_charfield(self):
2749.         # Create the table and verify no initial indexes.
2750.         with connection.schema_editor() as editor:
2751.             editor.create_model(Author)
2752.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2753.         # Alter to add db_index=True and create 2 indexes.
2754.         old_field = Author._meta.get_field('name')
2755.         new_field = CharField(max_length=255, db_index=True)
2756.         new_field.set_attributes_from_name('name')
2757.         with connection.schema_editor() as editor:
2758.             editor.alter_field(Author, old_field, new_field, strict=True)
2759.         self.assertEqual(
2760.             self.get_constraints_for_column(Author, 'name'),
2761.             ['schema_author_name_1fbc5617', 'schema_author_name_1fbc5617_like']
2762.         )
2763.         # Remove db_index=True to drop both indexes.
2764.         with connection.schema_editor() as editor:
2765.             editor.alter_field(Author, new_field, old_field, strict=True)
2766.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2767. 
2768.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2769.     def test_alter_field_add_unique_to_charfield(self):
2770.         # Create the table and verify no initial indexes.
2771.         with connection.schema_editor() as editor:
2772.             editor.create_model(Author)
2773.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2774.         # Alter to add unique=True and create 2 indexes.
2775.         old_field = Author._meta.get_field('name')
2776.         new_field = CharField(max_length=255, unique=True)
2777.         new_field.set_attributes_from_name('name')
2778.         with connection.schema_editor() as editor:
2779.             editor.alter_field(Author, old_field, new_field, strict=True)
2780.         self.assertEqual(
2781.             self.get_constraints_for_column(Author, 'name'),
2782.             ['schema_author_name_1fbc5617_like', 'schema_author_name_1fbc5617_uniq']
2783.         )
2784.         # Remove unique=True to drop both indexes.
2785.         with connection.schema_editor() as editor:
2786.             editor.alter_field(Author, new_field, old_field, strict=True)
2787.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2788. 
2789.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2790.     def test_alter_field_add_index_to_textfield(self):
2791.         # Create the table and verify no initial indexes.
2792.         with connection.schema_editor() as editor:
2793.             editor.create_model(Note)
2794.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
2795.         # Alter to add db_index=True and create 2 indexes.
2796.         old_field = Note._meta.get_field('info')
2797.         new_field = TextField(db_index=True)
2798.         new_field.set_attributes_from_name('info')
2799.         with connection.schema_editor() as editor:
2800.             editor.alter_field(Note, old_field, new_field, strict=True)
2801.         self.assertEqual(
2802.             self.get_constraints_for_column(Note, 'info'),
2803.             ['schema_note_info_4b0ea695', 'schema_note_info_4b0ea695_like']
2804.         )
2805.         # Remove db_index=True to drop both indexes.
2806.         with connection.schema_editor() as editor:
2807.             editor.alter_field(Note, new_field, old_field, strict=True)
2808.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
2809. 
2810.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2811.     def test_alter_field_add_unique_to_charfield_with_db_index(self):
2812.         # Create the table and verify initial indexes.
2813.         with connection.schema_editor() as editor:
2814.             editor.create_model(BookWithoutAuthor)
2815.         self.assertEqual(
2816.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2817.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2818.         )
2819.         # Alter to add unique=True (should replace the index)
2820.         old_field = BookWithoutAuthor._meta.get_field('title')
2821.         new_field = CharField(max_length=100, db_index=True, unique=True)
2822.         new_field.set_attributes_from_name('title')
2823.         with connection.schema_editor() as editor:
2824.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2825.         self.assertEqual(
2826.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2827.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2828.         )
2829.         # Alter to remove unique=True (should drop unique index)
2830.         new_field2 = CharField(max_length=100, db_index=True)
2831.         new_field2.set_attributes_from_name('title')
2832.         with connection.schema_editor() as editor:
2833.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2834.         self.assertEqual(
2835.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2836.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2837.         )
2838. 
2839.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2840.     def test_alter_field_remove_unique_and_db_index_from_charfield(self):
2841.         # Create the table and verify initial indexes.
2842.         with connection.schema_editor() as editor:
2843.             editor.create_model(BookWithoutAuthor)
2844.         self.assertEqual(
2845.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2846.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2847.         )
2848.         # Alter to add unique=True (should replace the index)
2849.         old_field = BookWithoutAuthor._meta.get_field('title')
2850.         new_field = CharField(max_length=100, db_index=True, unique=True)
2851.         new_field.set_attributes_from_name('title')
2852.         with connection.schema_editor() as editor:
2853.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2854.         self.assertEqual(
2855.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2856.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2857.         )
2858.         # Alter to remove both unique=True and db_index=True (should drop all indexes)
2859.         new_field2 = CharField(max_length=100)
2860.         new_field2.set_attributes_from_name('title')
2861.         with connection.schema_editor() as editor:
2862.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2863.         self.assertEqual(self.get_constraints_for_column(BookWithoutAuthor, 'title'), [])
2864. 
2865.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2866.     def test_alter_field_swap_unique_and_db_index_with_charfield(self):
2867.         # Create the table and verify initial indexes.
2868.         with connection.schema_editor() as editor:
2869.             editor.create_model(BookWithoutAuthor)
2870.         self.assertEqual(
2871.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2872.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2873.         )
2874.         # Alter to set unique=True and remove db_index=True (should replace the index)
2875.         old_field = BookWithoutAuthor._meta.get_field('title')
2876.         new_field = CharField(max_length=100, unique=True)
2877.         new_field.set_attributes_from_name('title')
2878.         with connection.schema_editor() as editor:
2879.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2880.         self.assertEqual(
2881.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2882.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2883.         )
2884.         # Alter to set db_index=True and remove unique=True (should restore index)
2885.         new_field2 = CharField(max_length=100, db_index=True)
2886.         new_field2.set_attributes_from_name('title')
2887.         with connection.schema_editor() as editor:
2888.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2889.         self.assertEqual(
2890.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2891.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2892.         )
2893. 
2894.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2895.     def test_alter_field_add_db_index_to_charfield_with_unique(self):
2896.         # Create the table and verify initial indexes.
2897.         with connection.schema_editor() as editor:
2898.             editor.create_model(Tag)
2899.         self.assertEqual(
2900.             self.get_constraints_for_column(Tag, 'slug'),
2901.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2902.         )
2903.         # Alter to add db_index=True
2904.         old_field = Tag._meta.get_field('slug')
2905.         new_field = SlugField(db_index=True, unique=True)
2906.         new_field.set_attributes_from_name('slug')
2907.         with connection.schema_editor() as editor:
2908.             editor.alter_field(Tag, old_field, new_field, strict=True)
2909.         self.assertEqual(
2910.             self.get_constraints_for_column(Tag, 'slug'),
2911.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2912.         )
2913.         # Alter to remove db_index=True
2914.         new_field2 = SlugField(unique=True)
2915.         new_field2.set_attributes_from_name('slug')
2916.         with connection.schema_editor() as editor:
2917.             editor.alter_field(Tag, new_field, new_field2, strict=True)
2918.         self.assertEqual(
2919.             self.get_constraints_for_column(Tag, 'slug'),
2920.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2921.         )
2922. 
2923.     def test_alter_field_add_index_to_integerfield(self):
2924.         # Create the table and verify no initial indexes.
2925.         with connection.schema_editor() as editor:
2926.             editor.create_model(Author)
2927.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
2928. 
2929.         # Alter to add db_index=True and create index.
2930.         old_field = Author._meta.get_field('weight')
2931.         new_field = IntegerField(null=True, db_index=True)
2932.         new_field.set_attributes_from_name('weight')
2933.         with connection.schema_editor() as editor:
2934.             editor.alter_field(Author, old_field, new_field, strict=True)
2935.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), ['schema_author_weight_587740f9'])
2936. 
2937.         # Remove db_index=True to drop index.
2938.         with connection.schema_editor() as editor:
2939.             editor.alter_field(Author, new_field, old_field, strict=True)
2940.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
2941. 
2942.     def test_alter_pk_with_self_referential_field(self):
2943.         """
2944.         Changing the primary key field name of a model with a self-referential
2945.         foreign key (#26384).
2946.         """
2947.         with connection.schema_editor() as editor:
2948.             editor.create_model(Node)
2949.         old_field = Node._meta.get_field('node_id')
2950.         new_field = AutoField(primary_key=True)
2951.         new_field.set_attributes_from_name('id')
2952.         with connection.schema_editor() as editor:
2953.             editor.alter_field(Node, old_field, new_field, strict=True)
2954.         self.assertForeignKeyExists(Node, 'parent_id', Node._meta.db_table)
2955. 
2956.     @mock.patch('django.db.backends.base.schema.datetime')
2957.     @mock.patch('django.db.backends.base.schema.timezone')
2958.     def test_add_datefield_and_datetimefield_use_effective_default(self, mocked_datetime, mocked_tz):
2959.         """
2960.         effective_default() should be used for DateField, DateTimeField, and
2961.         TimeField if auto_now or auto_now_add is set (#25005).
2962.         """
2963.         now = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1)
2964.         now_tz = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1, tzinfo=timezone.utc)
2965.         mocked_datetime.now = mock.MagicMock(return_value=now)
2966.         mocked_tz.now = mock.MagicMock(return_value=now_tz)
2967.         # Create the table
2968.         with connection.schema_editor() as editor:
2969.             editor.create_model(Author)
2970.         # Check auto_now/auto_now_add attributes are not defined
2971.         columns = self.column_classes(Author)
2972.         self.assertNotIn("dob_auto_now", columns)
2973.         self.assertNotIn("dob_auto_now_add", columns)
2974.         self.assertNotIn("dtob_auto_now", columns)
2975.         self.assertNotIn("dtob_auto_now_add", columns)
2976.         self.assertNotIn("tob_auto_now", columns)
2977.         self.assertNotIn("tob_auto_now_add", columns)
2978.         # Create a row
2979.         Author.objects.create(name='Anonymous1')
2980.         # Ensure fields were added with the correct defaults
2981.         dob_auto_now = DateField(auto_now=True)
2982.         dob_auto_now.set_attributes_from_name('dob_auto_now')
2983.         self.check_added_field_default(
2984.             editor, Author, dob_auto_now, 'dob_auto_now', now.date(),
2985.             cast_function=lambda x: x.date(),
2986.         )
2987.         dob_auto_now_add = DateField(auto_now_add=True)
2988.         dob_auto_now_add.set_attributes_from_name('dob_auto_now_add')
2989.         self.check_added_field_default(
2990.             editor, Author, dob_auto_now_add, 'dob_auto_now_add', now.date(),
2991.             cast_function=lambda x: x.date(),
2992.         )
2993.         dtob_auto_now = DateTimeField(auto_now=True)
2994.         dtob_auto_now.set_attributes_from_name('dtob_auto_now')
2995.         self.check_added_field_default(
2996.             editor, Author, dtob_auto_now, 'dtob_auto_now', now,
2997.         )
2998.         dt_tm_of_birth_auto_now_add = DateTimeField(auto_now_add=True)
2999.         dt_tm_of_birth_auto_now_add.set_attributes_from_name('dtob_auto_now_add')
3000.         self.check_added_field_default(
3001.             editor, Author, dt_tm_of_birth_auto_now_add, 'dtob_auto_now_add', now,
3002.         )
3003.         tob_auto_now = TimeField(auto_now=True)
3004.         tob_auto_now.set_attributes_from_name('tob_auto_now')
3005.         self.check_added_field_default(
3006.             editor, Author, tob_auto_now, 'tob_auto_now', now.time(),
3007.             cast_function=lambda x: x.time(),
3008.         )
3009.         tob_auto_now_add = TimeField(auto_now_add=True)
3010.         tob_auto_now_add.set_attributes_from_name('tob_auto_now_add')
3011.         self.check_added_field_default(
3012.             editor, Author, tob_auto_now_add, 'tob_auto_now_add', now.time(),
3013.             cast_function=lambda x: x.time(),
3014.         )
3015. 
3016.     def test_namespaced_db_table_create_index_name(self):
3017.         """
3018.         Table names are stripped of their namespace/schema before being used to
3019.         generate index names.
3020.         """
3021.         with connection.schema_editor() as editor:
3022.             max_name_length = connection.ops.max_name_length() or 200
3023.             namespace = 'n' * max_name_length
3024.             table_name = 't' * max_name_length
3025.             namespaced_table_name = '"%s"."%s"' % (namespace, table_name)
3026.             self.assertEqual(
3027.                 editor._create_index_name(table_name, []),
3028.                 editor._create_index_name(namespaced_table_name, []),
3029.             )
3030. 
3031.     @unittest.skipUnless(connection.vendor == 'oracle', 'Oracle specific db_table syntax')
3032.     def test_creation_with_db_table_double_quotes(self):
3033.         oracle_user = connection.creation._test_database_user()
3034. 
3035.         class Student(Model):
3036.             name = CharField(max_length=30)
3037. 
3038.             class Meta:
3039.                 app_label = 'schema'
3040.                 apps = new_apps
3041.                 db_table = '"%s"."DJANGO_STUDENT_TABLE"' % oracle_user
3042. 
3043.         class Document(Model):
3044.             name = CharField(max_length=30)
3045.             students = ManyToManyField(Student)
3046. 
3047.             class Meta:
3048.                 app_label = 'schema'
3049.                 apps = new_apps
3050.                 db_table = '"%s"."DJANGO_DOCUMENT_TABLE"' % oracle_user
3051. 
3052.         self.local_models = [Student, Document]
3053. 
3054.         with connection.schema_editor() as editor:
3055.             editor.create_model(Student)
3056.             editor.create_model(Document)
3057. 
3058.         doc = Document.objects.create(name='Test Name')
3059.         student = Student.objects.create(name='Some man')
3060.         doc.students.add(student)
3061. 
3062.     def test_rename_table_renames_deferred_sql_references(self):
3063.         atomic_rename = connection.features.supports_atomic_references_rename
3064.         with connection.schema_editor(atomic=atomic_rename) as editor:
3065.             editor.create_model(Author)
3066.             editor.create_model(Book)
3067.             editor.alter_db_table(Author, 'schema_author', 'schema_renamed_author')
3068.             editor.alter_db_table(Author, 'schema_book', 'schema_renamed_book')
3069.             self.assertGreater(len(editor.deferred_sql), 0)
3070.             for statement in editor.deferred_sql:
3071.                 self.assertIs(statement.references_table('schema_author'), False)
3072.                 self.assertIs(statement.references_table('schema_book'), False)
3073. 
3074.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
3075.     def test_rename_column_renames_deferred_sql_references(self):
3076.         with connection.schema_editor() as editor:
3077.             editor.create_model(Author)
3078.             editor.create_model(Book)
3079.             old_title = Book._meta.get_field('title')
3080.             new_title = CharField(max_length=100, db_index=True)
3081.             new_title.set_attributes_from_name('renamed_title')
3082.             editor.alter_field(Book, old_title, new_title)
3083.             old_author = Book._meta.get_field('author')
3084.             new_author = ForeignKey(Author, CASCADE)
3085.             new_author.set_attributes_from_name('renamed_author')
3086.             editor.alter_field(Book, old_author, new_author)
3087.             self.assertGreater(len(editor.deferred_sql), 0)
3088.             for statement in editor.deferred_sql:
3089.                 self.assertIs(statement.references_column('book', 'title'), False)
3090.                 self.assertIs(statement.references_column('book', 'author_id'), False)
3091. 
3092.     @isolate_apps('schema')
3093.     def test_referenced_field_without_constraint_rename_inside_atomic_block(self):
3094.         """
3095.         Foreign keys without database level constraint don't prevent the field
3096.         they reference from being renamed in an atomic block.
3097.         """
3098.         class Foo(Model):
3099.             field = CharField(max_length=255, unique=True)
3100. 
3101.             class Meta:
3102.                 app_label = 'schema'
3103. 
3104.         class Bar(Model):
3105.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3106. 
3107.             class Meta:
3108.                 app_label = 'schema'
3109. 
3110.         self.isolated_local_models = [Foo, Bar]
3111.         with connection.schema_editor() as editor:
3112.             editor.create_model(Foo)
3113.             editor.create_model(Bar)
3114. 
3115.         new_field = CharField(max_length=255, unique=True)
3116.         new_field.set_attributes_from_name('renamed')
3117.         with connection.schema_editor(atomic=True) as editor:
3118.             editor.alter_field(Foo, Foo._meta.get_field('field'), new_field)
3119. 
3120.     @isolate_apps('schema')
3121.     def test_referenced_table_without_constraint_rename_inside_atomic_block(self):
3122.         """
3123.         Foreign keys without database level constraint don't prevent the table
3124.         they reference from being renamed in an atomic block.
3125.         """
3126.         class Foo(Model):
3127.             field = CharField(max_length=255, unique=True)
3128. 
3129.             class Meta:
3130.                 app_label = 'schema'
3131. 
3132.         class Bar(Model):
3133.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3134. 
3135.             class Meta:
3136.                 app_label = 'schema'
3137. 
3138.         self.isolated_local_models = [Foo, Bar]
3139.         with connection.schema_editor() as editor:
3140.             editor.create_model(Foo)
3141.             editor.create_model(Bar)
3142. 
3143.         new_field = CharField(max_length=255, unique=True)
3144.         new_field.set_attributes_from_name('renamed')
3145.         with connection.schema_editor(atomic=True) as editor:
3146.             editor.alter_db_table(Foo, Foo._meta.db_table, 'renamed_table')
3147.         Foo._meta.db_table = 'renamed_table'

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 18:34:34,528 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of `tests/schema/tests.py`. The provided context contains the file content from line 1 to 3147, which represents the entire file.', relative_path='tests/schema/tests.py', start_line=1, end_line=3147)]
2025-12-21 18:34:34,532 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/schema/tests.py`.
2025-12-21 18:34:34,532 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 18:34:34,532 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 18:34:34,533 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 18:34:34,533 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 18:34:34,534 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   └── FUNDING.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── test_django_admin_py.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── asgi
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_password_reset_timeout_days.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   |   └── fixture2.xml
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_db_returning.py
    |   ├── test_deprecation.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   ├── test_is_ajax_deprecations.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_same_name_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── mutually_exclusive_required.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       ├── subparser_dest.py
    |   |       ├── subparser_required.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   ├── strip_tags1.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Migration crashes deleting an index_together if there is a unique_together on the same fields

Description: Description
	
Happens with Django 1.11.10
Steps to reproduce:
1) Create models with 2 fields, add 2 same fields to unique_together and to index_together
2) Delete index_together -> Fail
It will fail at django/db/backends/base/schema.py, line 378, in _delete_composed_index(), ValueError: Found wrong number (2) of constraints for as this one will find two constraints, the _uniq and the _idx one. No way to get out of this...
The worst in my case is that happened as I wanted to refactor my code to use the "new" (Dj 1.11) Options.indexes feature. I am actually not deleting the index, just the way it is declared in my code.
I think there are 2 different points here:
1) The deletion of index_together should be possible alone or made coherent (migrations side?) with unique_together
2) Moving the declaration of an index should not result in an index re-creation

Patch information:
diff --git a/django/db/backends/base/schema.py b/django/db/backends/base/schema.py
index 61f88401ab..1f521cfc5c 100644
--- a/django/db/backends/base/schema.py
+++ b/django/db/backends/base/schema.py
@@ -393,7 +393,7 @@ class BaseDatabaseSchemaEditor:
         news = {tuple(fields) for fields in new_index_together}
         # Deleted indexes
         for fields in olds.difference(news):
-            self._delete_composed_index(model, fields, {'index': True}, self.sql_delete_index)
+            self._delete_composed_index(model, fields, {'index': True, 'unique': False}, self.sql_delete_index)
         # Created indexes
         for field_names in news.difference(olds):
             fields = [model._meta.get_field(field) for field in field_names]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/schema/tests.py`.
Extra Requirements: 
Purpose: I need to find test cases that cover the creation and deletion of composite indexes and unique constraints to identify tests relevant to the user's bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/schema/tests.py
Line number range: 1 - 3147
Content:
1. import datetime
2. import itertools
3. import unittest
4. from copy import copy
5. from unittest import mock
6. 
7. from django.core.management.color import no_style
8. from django.db import (
9.     DatabaseError, DataError, IntegrityError, OperationalError, connection,
10. )
11. from django.db.models import (
12.     CASCADE, PROTECT, AutoField, BigAutoField, BigIntegerField, BinaryField,
13.     BooleanField, CharField, CheckConstraint, DateField, DateTimeField,
14.     ForeignKey, ForeignObject, Index, IntegerField, ManyToManyField, Model,
15.     OneToOneField, PositiveIntegerField, Q, SlugField, SmallAutoField,
16.     SmallIntegerField, TextField, TimeField, UniqueConstraint, UUIDField,
17. )
18. from django.db.transaction import TransactionManagementError, atomic
19. from django.test import (
20.     TransactionTestCase, skipIfDBFeature, skipUnlessDBFeature,
21. )
22. from django.test.utils import CaptureQueriesContext, isolate_apps
23. from django.utils import timezone
24. 
25. from .fields import (
26.     CustomManyToManyField, InheritedManyToManyField, MediumBlobField,
27. )
28. from .models import (
29.     Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
30.     AuthorWithDefaultHeight, AuthorWithEvenLongerName, AuthorWithIndexedName,
31.     AuthorWithIndexedNameAndBirthday, AuthorWithUniqueName,
32.     AuthorWithUniqueNameAndBirthday, Book, BookForeignObj, BookWeak,
33.     BookWithLongName, BookWithO2O, BookWithoutAuthor, BookWithSlug, IntegerPK,
34.     Node, Note, NoteRename, Tag, TagIndexed, TagM2MTest, TagUniqueRename,
35.     Thing, UniqueTest, new_apps,
36. )
37. 
38. 
39. class SchemaTests(TransactionTestCase):
40.     """
41.     Tests for the schema-alteration code.
42. 
43.     Be aware that these tests are more liable than most to false results,
44.     as sometimes the code to check if a test has worked is almost as complex
45.     as the code it is testing.
46.     """
47. 
48.     available_apps = []
49. 
50.     models = [
51.         Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
52.         AuthorWithDefaultHeight, AuthorWithEvenLongerName, Book, BookWeak,
53.         BookWithLongName, BookWithO2O, BookWithSlug, IntegerPK, Node, Note,
54.         Tag, TagIndexed, TagM2MTest, TagUniqueRename, Thing, UniqueTest,
55.     ]
56. 
57.     # Utility functions
58. 
59.     def setUp(self):
60.         # local_models should contain test dependent model classes that will be
61.         # automatically removed from the app cache on test tear down.
62.         self.local_models = []
63.         # isolated_local_models contains models that are in test methods
64.         # decorated with @isolate_apps.
65.         self.isolated_local_models = []
66. 
67.     def tearDown(self):
68.         # Delete any tables made for our models
69.         self.delete_tables()
70.         new_apps.clear_cache()
71.         for model in new_apps.get_models():
72.             model._meta._expire_cache()
73.         if 'schema' in new_apps.all_models:
74.             for model in self.local_models:
75.                 for many_to_many in model._meta.many_to_many:
76.                     through = many_to_many.remote_field.through
77.                     if through and through._meta.auto_created:
78.                         del new_apps.all_models['schema'][through._meta.model_name]
79.                 del new_apps.all_models['schema'][model._meta.model_name]
80.         if self.isolated_local_models:
81.             with connection.schema_editor() as editor:
82.                 for model in self.isolated_local_models:
83.                     editor.delete_model(model)
84. 
85.     def delete_tables(self):
86.         "Deletes all model tables for our models for a clean test environment"
87.         converter = connection.introspection.identifier_converter
88.         with connection.schema_editor() as editor:
89.             connection.disable_constraint_checking()
90.             table_names = connection.introspection.table_names()
91.             for model in itertools.chain(SchemaTests.models, self.local_models):
92.                 tbl = converter(model._meta.db_table)
93.                 if tbl in table_names:
94.                     editor.delete_model(model)
95.                     table_names.remove(tbl)
96.             connection.enable_constraint_checking()
97. 
98.     def column_classes(self, model):
99.         with connection.cursor() as cursor:
100.             columns = {
101.                 d[0]: (connection.introspection.get_field_type(d[1], d), d)
102.                 for d in connection.introspection.get_table_description(
103.                     cursor,
104.                     model._meta.db_table,
105.                 )
106.             }
107.         # SQLite has a different format for field_type
108.         for name, (type, desc) in columns.items():
109.             if isinstance(type, tuple):
110.                 columns[name] = (type[0], desc)
111.         # SQLite also doesn't error properly
112.         if not columns:
113.             raise DatabaseError("Table does not exist (empty pragma)")
114.         return columns
115. 
116.     def get_primary_key(self, table):
117.         with connection.cursor() as cursor:
118.             return connection.introspection.get_primary_key_column(cursor, table)
119. 
120.     def get_indexes(self, table):
121.         """
122.         Get the indexes on the table using a new cursor.
123.         """
124.         with connection.cursor() as cursor:
125.             return [
126.                 c['columns'][0]
127.                 for c in connection.introspection.get_constraints(cursor, table).values()
128.                 if c['index'] and len(c['columns']) == 1
129.             ]
130. 
131.     def get_uniques(self, table):
132.         with connection.cursor() as cursor:
133.             return [
134.                 c['columns'][0]
135.                 for c in connection.introspection.get_constraints(cursor, table).values()
136.                 if c['unique'] and len(c['columns']) == 1
137.             ]
138. 
139.     def get_constraints(self, table):
140.         """
141.         Get the constraints on a table using a new cursor.
142.         """
143.         with connection.cursor() as cursor:
144.             return connection.introspection.get_constraints(cursor, table)
145. 
146.     def get_constraints_for_column(self, model, column_name):
147.         constraints = self.get_constraints(model._meta.db_table)
148.         constraints_for_column = []
149.         for name, details in constraints.items():
150.             if details['columns'] == [column_name]:
151.                 constraints_for_column.append(name)
152.         return sorted(constraints_for_column)
153. 
154.     def check_added_field_default(self, schema_editor, model, field, field_name, expected_default,
155.                                   cast_function=None):
156.         with connection.cursor() as cursor:
157.             schema_editor.add_field(model, field)
158.             cursor.execute("SELECT {} FROM {};".format(field_name, model._meta.db_table))
159.             database_default = cursor.fetchall()[0][0]
160.             if cast_function and not type(database_default) == type(expected_default):
161.                 database_default = cast_function(database_default)
162.             self.assertEqual(database_default, expected_default)
163. 
164.     def get_constraints_count(self, table, column, fk_to):
165.         """
166.         Return a dict with keys 'fks', 'uniques, and 'indexes' indicating the
167.         number of foreign keys, unique constraints, and indexes on
168.         `table`.`column`. The `fk_to` argument is a 2-tuple specifying the
169.         expected foreign key relationship's (table, column).
170.         """
171.         with connection.cursor() as cursor:
172.             constraints = connection.introspection.get_constraints(cursor, table)
173.         counts = {'fks': 0, 'uniques': 0, 'indexes': 0}
174.         for c in constraints.values():
175.             if c['columns'] == [column]:
176.                 if c['foreign_key'] == fk_to:
177.                     counts['fks'] += 1
178.                 if c['unique']:
179.                     counts['uniques'] += 1
180.                 elif c['index']:
181.                     counts['indexes'] += 1
182.         return counts
183. 
184.     def assertIndexOrder(self, table, index, order):
185.         constraints = self.get_constraints(table)
186.         self.assertIn(index, constraints)
187.         index_orders = constraints[index]['orders']
188.         self.assertTrue(all(val == expected for val, expected in zip(index_orders, order)))
189. 
190.     def assertForeignKeyExists(self, model, column, expected_fk_table, field='id'):
191.         """
192.         Fail if the FK constraint on `model.Meta.db_table`.`column` to
193.         `expected_fk_table`.id doesn't exist.
194.         """
195.         constraints = self.get_constraints(model._meta.db_table)
196.         constraint_fk = None
197.         for details in constraints.values():
198.             if details['columns'] == [column] and details['foreign_key']:
199.                 constraint_fk = details['foreign_key']
200.                 break
201.         self.assertEqual(constraint_fk, (expected_fk_table, field))
202. 
203.     def assertForeignKeyNotExists(self, model, column, expected_fk_table):
204.         with self.assertRaises(AssertionError):
205.             self.assertForeignKeyExists(model, column, expected_fk_table)
206. 
207.     # Tests
208.     def test_creation_deletion(self):
209.         """
210.         Tries creating a model's table, and then deleting it.
211.         """
212.         with connection.schema_editor() as editor:
213.             # Create the table
214.             editor.create_model(Author)
215.             # The table is there
216.             list(Author.objects.all())
217.             # Clean up that table
218.             editor.delete_model(Author)
219.             # No deferred SQL should be left over.
220.             self.assertEqual(editor.deferred_sql, [])
221.         # The table is gone
222.         with self.assertRaises(DatabaseError):
223.             list(Author.objects.all())
224. 
225.     @skipUnlessDBFeature('supports_foreign_keys')
226.     def test_fk(self):
227.         "Creating tables out of FK order, then repointing, works"
228.         # Create the table
229.         with connection.schema_editor() as editor:
230.             editor.create_model(Book)
231.             editor.create_model(Author)
232.             editor.create_model(Tag)
233.         # Initial tables are there
234.         list(Author.objects.all())
235.         list(Book.objects.all())
236.         # Make sure the FK constraint is present
237.         with self.assertRaises(IntegrityError):
238.             Book.objects.create(
239.                 author_id=1,
240.                 title="Much Ado About Foreign Keys",
241.                 pub_date=datetime.datetime.now(),
242.             )
243.         # Repoint the FK constraint
244.         old_field = Book._meta.get_field("author")
245.         new_field = ForeignKey(Tag, CASCADE)
246.         new_field.set_attributes_from_name("author")
247.         with connection.schema_editor() as editor:
248.             editor.alter_field(Book, old_field, new_field, strict=True)
249.         self.assertForeignKeyExists(Book, 'author_id', 'schema_tag')
250. 
251.     @skipUnlessDBFeature('can_create_inline_fk')
252.     def test_inline_fk(self):
253.         # Create some tables.
254.         with connection.schema_editor() as editor:
255.             editor.create_model(Author)
256.             editor.create_model(Book)
257.             editor.create_model(Note)
258.         self.assertForeignKeyNotExists(Note, 'book_id', 'schema_book')
259.         # Add a foreign key from one to the other.
260.         with connection.schema_editor() as editor:
261.             new_field = ForeignKey(Book, CASCADE)
262.             new_field.set_attributes_from_name('book')
263.             editor.add_field(Note, new_field)
264.         self.assertForeignKeyExists(Note, 'book_id', 'schema_book')
265.         # Creating a FK field with a constraint uses a single statement without
266.         # a deferred ALTER TABLE.
267.         self.assertFalse([
268.             sql for sql in (str(statement) for statement in editor.deferred_sql)
269.             if sql.startswith('ALTER TABLE') and 'ADD CONSTRAINT' in sql
270.         ])
271. 
272.     @skipUnlessDBFeature('can_create_inline_fk')
273.     def test_add_inline_fk_update_data(self):
274.         with connection.schema_editor() as editor:
275.             editor.create_model(Node)
276.         # Add an inline foreign key and update data in the same transaction.
277.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
278.         new_field.set_attributes_from_name('new_parent_fk')
279.         parent = Node.objects.create()
280.         with connection.schema_editor() as editor:
281.             editor.add_field(Node, new_field)
282.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
283.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
284. 
285.     @skipUnlessDBFeature(
286.         'can_create_inline_fk',
287.         'allows_multiple_constraints_on_same_fields',
288.     )
289.     @isolate_apps('schema')
290.     def test_add_inline_fk_index_update_data(self):
291.         class Node(Model):
292.             class Meta:
293.                 app_label = 'schema'
294. 
295.         with connection.schema_editor() as editor:
296.             editor.create_model(Node)
297.         # Add an inline foreign key, update data, and an index in the same
298.         # transaction.
299.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
300.         new_field.set_attributes_from_name('new_parent_fk')
301.         parent = Node.objects.create()
302.         with connection.schema_editor() as editor:
303.             editor.add_field(Node, new_field)
304.             Node._meta.add_field(new_field)
305.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
306.             editor.add_index(Node, Index(fields=['new_parent_fk'], name='new_parent_inline_fk_idx'))
307.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
308. 
309.     @skipUnlessDBFeature('supports_foreign_keys')
310.     def test_char_field_with_db_index_to_fk(self):
311.         # Create the table
312.         with connection.schema_editor() as editor:
313.             editor.create_model(Author)
314.             editor.create_model(AuthorCharFieldWithIndex)
315.         # Change CharField to FK
316.         old_field = AuthorCharFieldWithIndex._meta.get_field('char_field')
317.         new_field = ForeignKey(Author, CASCADE, blank=True)
318.         new_field.set_attributes_from_name('char_field')
319.         with connection.schema_editor() as editor:
320.             editor.alter_field(AuthorCharFieldWithIndex, old_field, new_field, strict=True)
321.         self.assertForeignKeyExists(AuthorCharFieldWithIndex, 'char_field_id', 'schema_author')
322. 
323.     @skipUnlessDBFeature('supports_foreign_keys')
324.     @skipUnlessDBFeature('supports_index_on_text_field')
325.     def test_text_field_with_db_index_to_fk(self):
326.         # Create the table
327.         with connection.schema_editor() as editor:
328.             editor.create_model(Author)
329.             editor.create_model(AuthorTextFieldWithIndex)
330.         # Change TextField to FK
331.         old_field = AuthorTextFieldWithIndex._meta.get_field('text_field')
332.         new_field = ForeignKey(Author, CASCADE, blank=True)
333.         new_field.set_attributes_from_name('text_field')
334.         with connection.schema_editor() as editor:
335.             editor.alter_field(AuthorTextFieldWithIndex, old_field, new_field, strict=True)
336.         self.assertForeignKeyExists(AuthorTextFieldWithIndex, 'text_field_id', 'schema_author')
337. 
338.     @isolate_apps('schema')
339.     def test_char_field_pk_to_auto_field(self):
340.         class Foo(Model):
341.             id = CharField(max_length=255, primary_key=True)
342. 
343.             class Meta:
344.                 app_label = 'schema'
345. 
346.         with connection.schema_editor() as editor:
347.             editor.create_model(Foo)
348.         self.isolated_local_models = [Foo]
349.         old_field = Foo._meta.get_field('id')
350.         new_field = AutoField(primary_key=True)
351.         new_field.set_attributes_from_name('id')
352.         new_field.model = Foo
353.         with connection.schema_editor() as editor:
354.             editor.alter_field(Foo, old_field, new_field, strict=True)
355. 
356.     @skipUnlessDBFeature('supports_foreign_keys')
357.     def test_fk_to_proxy(self):
358.         "Creating a FK to a proxy model creates database constraints."
359.         class AuthorProxy(Author):
360.             class Meta:
361.                 app_label = 'schema'
362.                 apps = new_apps
363.                 proxy = True
364. 
365.         class AuthorRef(Model):
366.             author = ForeignKey(AuthorProxy, on_delete=CASCADE)
367. 
368.             class Meta:
369.                 app_label = 'schema'
370.                 apps = new_apps
371. 
372.         self.local_models = [AuthorProxy, AuthorRef]
373. 
374.         # Create the table
375.         with connection.schema_editor() as editor:
376.             editor.create_model(Author)
377.             editor.create_model(AuthorRef)
378.         self.assertForeignKeyExists(AuthorRef, 'author_id', 'schema_author')
379. 
380.     @skipUnlessDBFeature('supports_foreign_keys')
381.     def test_fk_db_constraint(self):
382.         "The db_constraint parameter is respected"
383.         # Create the table
384.         with connection.schema_editor() as editor:
385.             editor.create_model(Tag)
386.             editor.create_model(Author)
387.             editor.create_model(BookWeak)
388.         # Initial tables are there
389.         list(Author.objects.all())
390.         list(Tag.objects.all())
391.         list(BookWeak.objects.all())
392.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
393.         # Make a db_constraint=False FK
394.         new_field = ForeignKey(Tag, CASCADE, db_constraint=False)
395.         new_field.set_attributes_from_name("tag")
396.         with connection.schema_editor() as editor:
397.             editor.add_field(Author, new_field)
398.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
399.         # Alter to one with a constraint
400.         new_field2 = ForeignKey(Tag, CASCADE)
401.         new_field2.set_attributes_from_name("tag")
402.         with connection.schema_editor() as editor:
403.             editor.alter_field(Author, new_field, new_field2, strict=True)
404.         self.assertForeignKeyExists(Author, 'tag_id', 'schema_tag')
405.         # Alter to one without a constraint again
406.         new_field2 = ForeignKey(Tag, CASCADE)
407.         new_field2.set_attributes_from_name("tag")
408.         with connection.schema_editor() as editor:
409.             editor.alter_field(Author, new_field2, new_field, strict=True)
410.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
411. 
412.     @isolate_apps('schema')
413.     def test_no_db_constraint_added_during_primary_key_change(self):
414.         """
415.         When a primary key that's pointed to by a ForeignKey with
416.         db_constraint=False is altered, a foreign key constraint isn't added.
417.         """
418.         class Author(Model):
419.             class Meta:
420.                 app_label = 'schema'
421. 
422.         class BookWeak(Model):
423.             author = ForeignKey(Author, CASCADE, db_constraint=False)
424. 
425.             class Meta:
426.                 app_label = 'schema'
427. 
428.         with connection.schema_editor() as editor:
429.             editor.create_model(Author)
430.             editor.create_model(BookWeak)
431.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
432.         old_field = Author._meta.get_field('id')
433.         new_field = BigAutoField(primary_key=True)
434.         new_field.model = Author
435.         new_field.set_attributes_from_name('id')
436.         # @isolate_apps() and inner models are needed to have the model
437.         # relations populated, otherwise this doesn't act as a regression test.
438.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
439.         with connection.schema_editor() as editor:
440.             editor.alter_field(Author, old_field, new_field, strict=True)
441.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
442. 
443.     def _test_m2m_db_constraint(self, M2MFieldClass):
444.         class LocalAuthorWithM2M(Model):
445.             name = CharField(max_length=255)
446. 
447.             class Meta:
448.                 app_label = 'schema'
449.                 apps = new_apps
450. 
451.         self.local_models = [LocalAuthorWithM2M]
452. 
453.         # Create the table
454.         with connection.schema_editor() as editor:
455.             editor.create_model(Tag)
456.             editor.create_model(LocalAuthorWithM2M)
457.         # Initial tables are there
458.         list(LocalAuthorWithM2M.objects.all())
459.         list(Tag.objects.all())
460.         # Make a db_constraint=False FK
461.         new_field = M2MFieldClass(Tag, related_name="authors", db_constraint=False)
462.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
463.         # Add the field
464.         with connection.schema_editor() as editor:
465.             editor.add_field(LocalAuthorWithM2M, new_field)
466.         self.assertForeignKeyNotExists(new_field.remote_field.through, 'tag_id', 'schema_tag')
467. 
468.     @skipUnlessDBFeature('supports_foreign_keys')
469.     def test_m2m_db_constraint(self):
470.         self._test_m2m_db_constraint(ManyToManyField)
471. 
472.     @skipUnlessDBFeature('supports_foreign_keys')
473.     def test_m2m_db_constraint_custom(self):
474.         self._test_m2m_db_constraint(CustomManyToManyField)
475. 
476.     @skipUnlessDBFeature('supports_foreign_keys')
477.     def test_m2m_db_constraint_inherited(self):
478.         self._test_m2m_db_constraint(InheritedManyToManyField)
479. 
480.     def test_add_field(self):
481.         """
482.         Tests adding fields to models
483.         """
484.         # Create the table
485.         with connection.schema_editor() as editor:
486.             editor.create_model(Author)
487.         # Ensure there's no age field
488.         columns = self.column_classes(Author)
489.         self.assertNotIn("age", columns)
490.         # Add the new field
491.         new_field = IntegerField(null=True)
492.         new_field.set_attributes_from_name("age")
493.         with CaptureQueriesContext(connection) as ctx, connection.schema_editor() as editor:
494.             editor.add_field(Author, new_field)
495.         drop_default_sql = editor.sql_alter_column_no_default % {
496.             'column': editor.quote_name(new_field.name),
497.         }
498.         self.assertFalse(any(drop_default_sql in query['sql'] for query in ctx.captured_queries))
499.         # Ensure the field is right afterwards
500.         columns = self.column_classes(Author)
501.         self.assertEqual(columns['age'][0], "IntegerField")
502.         self.assertTrue(columns['age'][1][6])
503. 
504.     def test_add_field_remove_field(self):
505.         """
506.         Adding a field and removing it removes all deferred sql referring to it.
507.         """
508.         with connection.schema_editor() as editor:
509.             # Create a table with a unique constraint on the slug field.
510.             editor.create_model(Tag)
511.             # Remove the slug column.
512.             editor.remove_field(Tag, Tag._meta.get_field('slug'))
513.         self.assertEqual(editor.deferred_sql, [])
514. 
515.     def test_add_field_temp_default(self):
516.         """
517.         Tests adding fields to models with a temporary default
518.         """
519.         # Create the table
520.         with connection.schema_editor() as editor:
521.             editor.create_model(Author)
522.         # Ensure there's no age field
523.         columns = self.column_classes(Author)
524.         self.assertNotIn("age", columns)
525.         # Add some rows of data
526.         Author.objects.create(name="Andrew", height=30)
527.         Author.objects.create(name="Andrea")
528.         # Add a not-null field
529.         new_field = CharField(max_length=30, default="Godwin")
530.         new_field.set_attributes_from_name("surname")
531.         with connection.schema_editor() as editor:
532.             editor.add_field(Author, new_field)
533.         # Ensure the field is right afterwards
534.         columns = self.column_classes(Author)
535.         self.assertEqual(columns['surname'][0], "CharField")
536.         self.assertEqual(columns['surname'][1][6],
537.                          connection.features.interprets_empty_strings_as_nulls)
538. 
539.     def test_add_field_temp_default_boolean(self):
540.         """
541.         Tests adding fields to models with a temporary default where
542.         the default is False. (#21783)
543.         """
544.         # Create the table
545.         with connection.schema_editor() as editor:
546.             editor.create_model(Author)
547.         # Ensure there's no age field
548.         columns = self.column_classes(Author)
549.         self.assertNotIn("age", columns)
550.         # Add some rows of data
551.         Author.objects.create(name="Andrew", height=30)
552.         Author.objects.create(name="Andrea")
553.         # Add a not-null field
554.         new_field = BooleanField(default=False)
555.         new_field.set_attributes_from_name("awesome")
556.         with connection.schema_editor() as editor:
557.             editor.add_field(Author, new_field)
558.         # Ensure the field is right afterwards
559.         columns = self.column_classes(Author)
560.         # BooleanField are stored as TINYINT(1) on MySQL.
561.         field_type = columns['awesome'][0]
562.         self.assertEqual(field_type, connection.features.introspected_boolean_field_type)
563. 
564.     def test_add_field_default_transform(self):
565.         """
566.         Tests adding fields to models with a default that is not directly
567.         valid in the database (#22581)
568.         """
569. 
570.         class TestTransformField(IntegerField):
571. 
572.             # Weird field that saves the count of items in its value
573.             def get_default(self):
574.                 return self.default
575. 
576.             def get_prep_value(self, value):
577.                 if value is None:
578.                     return 0
579.                 return len(value)
580. 
581.         # Create the table
582.         with connection.schema_editor() as editor:
583.             editor.create_model(Author)
584.         # Add some rows of data
585.         Author.objects.create(name="Andrew", height=30)
586.         Author.objects.create(name="Andrea")
587.         # Add the field with a default it needs to cast (to string in this case)
588.         new_field = TestTransformField(default={1: 2})
589.         new_field.set_attributes_from_name("thing")
590.         with connection.schema_editor() as editor:
591.             editor.add_field(Author, new_field)
592.         # Ensure the field is there
593.         columns = self.column_classes(Author)
594.         field_type, field_info = columns['thing']
595.         self.assertEqual(field_type, 'IntegerField')
596.         # Make sure the values were transformed correctly
597.         self.assertEqual(Author.objects.extra(where=["thing = 1"]).count(), 2)
598. 
599.     def test_add_field_binary(self):
600.         """
601.         Tests binary fields get a sane default (#22851)
602.         """
603.         # Create the table
604.         with connection.schema_editor() as editor:
605.             editor.create_model(Author)
606.         # Add the new field
607.         new_field = BinaryField(blank=True)
608.         new_field.set_attributes_from_name("bits")
609.         with connection.schema_editor() as editor:
610.             editor.add_field(Author, new_field)
611.         # Ensure the field is right afterwards
612.         columns = self.column_classes(Author)
613.         # MySQL annoyingly uses the same backend, so it'll come back as one of
614.         # these two types.
615.         self.assertIn(columns['bits'][0], ("BinaryField", "TextField"))
616. 
617.     @unittest.skipUnless(connection.vendor == 'mysql', "MySQL specific")
618.     def test_add_binaryfield_mediumblob(self):
619.         """
620.         Test adding a custom-sized binary field on MySQL (#24846).
621.         """
622.         # Create the table
623.         with connection.schema_editor() as editor:
624.             editor.create_model(Author)
625.         # Add the new field with default
626.         new_field = MediumBlobField(blank=True, default=b'123')
627.         new_field.set_attributes_from_name('bits')
628.         with connection.schema_editor() as editor:
629.             editor.add_field(Author, new_field)
630.         columns = self.column_classes(Author)
631.         # Introspection treats BLOBs as TextFields
632.         self.assertEqual(columns['bits'][0], "TextField")
633. 
634.     def test_alter(self):
635.         """
636.         Tests simple altering of fields
637.         """
638.         # Create the table
639.         with connection.schema_editor() as editor:
640.             editor.create_model(Author)
641.         # Ensure the field is right to begin with
642.         columns = self.column_classes(Author)
643.         self.assertEqual(columns['name'][0], "CharField")
644.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
645.         # Alter the name field to a TextField
646.         old_field = Author._meta.get_field("name")
647.         new_field = TextField(null=True)
648.         new_field.set_attributes_from_name("name")
649.         with connection.schema_editor() as editor:
650.             editor.alter_field(Author, old_field, new_field, strict=True)
651.         # Ensure the field is right afterwards
652.         columns = self.column_classes(Author)
653.         self.assertEqual(columns['name'][0], "TextField")
654.         self.assertTrue(columns['name'][1][6])
655.         # Change nullability again
656.         new_field2 = TextField(null=False)
657.         new_field2.set_attributes_from_name("name")
658.         with connection.schema_editor() as editor:
659.             editor.alter_field(Author, new_field, new_field2, strict=True)
660.         # Ensure the field is right afterwards
661.         columns = self.column_classes(Author)
662.         self.assertEqual(columns['name'][0], "TextField")
663.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
664. 
665.     def test_alter_auto_field_to_integer_field(self):
666.         # Create the table
667.         with connection.schema_editor() as editor:
668.             editor.create_model(Author)
669.         # Change AutoField to IntegerField
670.         old_field = Author._meta.get_field('id')
671.         new_field = IntegerField(primary_key=True)
672.         new_field.set_attributes_from_name('id')
673.         new_field.model = Author
674.         with connection.schema_editor() as editor:
675.             editor.alter_field(Author, old_field, new_field, strict=True)
676. 
677.     def test_alter_auto_field_to_char_field(self):
678.         # Create the table
679.         with connection.schema_editor() as editor:
680.             editor.create_model(Author)
681.         # Change AutoField to CharField
682.         old_field = Author._meta.get_field('id')
683.         new_field = CharField(primary_key=True, max_length=50)
684.         new_field.set_attributes_from_name('id')
685.         new_field.model = Author
686.         with connection.schema_editor() as editor:
687.             editor.alter_field(Author, old_field, new_field, strict=True)
688. 
689.     @isolate_apps('schema')
690.     def test_alter_auto_field_quoted_db_column(self):
691.         class Foo(Model):
692.             id = AutoField(primary_key=True, db_column='"quoted_id"')
693. 
694.             class Meta:
695.                 app_label = 'schema'
696. 
697.         with connection.schema_editor() as editor:
698.             editor.create_model(Foo)
699.         self.isolated_local_models = [Foo]
700.         old_field = Foo._meta.get_field('id')
701.         new_field = BigAutoField(primary_key=True)
702.         new_field.model = Foo
703.         new_field.db_column = '"quoted_id"'
704.         new_field.set_attributes_from_name('id')
705.         with connection.schema_editor() as editor:
706.             editor.alter_field(Foo, old_field, new_field, strict=True)
707.         Foo.objects.create()
708. 
709.     def test_alter_not_unique_field_to_primary_key(self):
710.         # Create the table.
711.         with connection.schema_editor() as editor:
712.             editor.create_model(Author)
713.         # Change UUIDField to primary key.
714.         old_field = Author._meta.get_field('uuid')
715.         new_field = UUIDField(primary_key=True)
716.         new_field.set_attributes_from_name('uuid')
717.         new_field.model = Author
718.         with connection.schema_editor() as editor:
719.             editor.remove_field(Author, Author._meta.get_field('id'))
720.             editor.alter_field(Author, old_field, new_field, strict=True)
721. 
722.     @isolate_apps('schema')
723.     def test_alter_primary_key_quoted_db_table(self):
724.         class Foo(Model):
725.             class Meta:
726.                 app_label = 'schema'
727.                 db_table = '"foo"'
728. 
729.         with connection.schema_editor() as editor:
730.             editor.create_model(Foo)
731.         self.isolated_local_models = [Foo]
732.         old_field = Foo._meta.get_field('id')
733.         new_field = BigAutoField(primary_key=True)
734.         new_field.model = Foo
735.         new_field.set_attributes_from_name('id')
736.         with connection.schema_editor() as editor:
737.             editor.alter_field(Foo, old_field, new_field, strict=True)
738.         Foo.objects.create()
739. 
740.     def test_alter_text_field(self):
741.         # Regression for "BLOB/TEXT column 'info' can't have a default value")
742.         # on MySQL.
743.         # Create the table
744.         with connection.schema_editor() as editor:
745.             editor.create_model(Note)
746.         old_field = Note._meta.get_field("info")
747.         new_field = TextField(blank=True)
748.         new_field.set_attributes_from_name("info")
749.         with connection.schema_editor() as editor:
750.             editor.alter_field(Note, old_field, new_field, strict=True)
751. 
752.     @skipUnlessDBFeature('can_defer_constraint_checks', 'can_rollback_ddl')
753.     def test_alter_fk_checks_deferred_constraints(self):
754.         """
755.         #25492 - Altering a foreign key's structure and data in the same
756.         transaction.
757.         """
758.         with connection.schema_editor() as editor:
759.             editor.create_model(Node)
760.         old_field = Node._meta.get_field('parent')
761.         new_field = ForeignKey(Node, CASCADE)
762.         new_field.set_attributes_from_name('parent')
763.         parent = Node.objects.create()
764.         with connection.schema_editor() as editor:
765.             # Update the parent FK to create a deferred constraint check.
766.             Node.objects.update(parent=parent)
767.             editor.alter_field(Node, old_field, new_field, strict=True)
768. 
769.     def test_alter_text_field_to_date_field(self):
770.         """
771.         #25002 - Test conversion of text field to date field.
772.         """
773.         with connection.schema_editor() as editor:
774.             editor.create_model(Note)
775.         Note.objects.create(info='1988-05-05')
776.         old_field = Note._meta.get_field('info')
777.         new_field = DateField(blank=True)
778.         new_field.set_attributes_from_name('info')
779.         with connection.schema_editor() as editor:
780.             editor.alter_field(Note, old_field, new_field, strict=True)
781.         # Make sure the field isn't nullable
782.         columns = self.column_classes(Note)
783.         self.assertFalse(columns['info'][1][6])
784. 
785.     def test_alter_text_field_to_datetime_field(self):
786.         """
787.         #25002 - Test conversion of text field to datetime field.
788.         """
789.         with connection.schema_editor() as editor:
790.             editor.create_model(Note)
791.         Note.objects.create(info='1988-05-05 3:16:17.4567')
792.         old_field = Note._meta.get_field('info')
793.         new_field = DateTimeField(blank=True)
794.         new_field.set_attributes_from_name('info')
795.         with connection.schema_editor() as editor:
796.             editor.alter_field(Note, old_field, new_field, strict=True)
797.         # Make sure the field isn't nullable
798.         columns = self.column_classes(Note)
799.         self.assertFalse(columns['info'][1][6])
800. 
801.     def test_alter_text_field_to_time_field(self):
802.         """
803.         #25002 - Test conversion of text field to time field.
804.         """
805.         with connection.schema_editor() as editor:
806.             editor.create_model(Note)
807.         Note.objects.create(info='3:16:17.4567')
808.         old_field = Note._meta.get_field('info')
809.         new_field = TimeField(blank=True)
810.         new_field.set_attributes_from_name('info')
811.         with connection.schema_editor() as editor:
812.             editor.alter_field(Note, old_field, new_field, strict=True)
813.         # Make sure the field isn't nullable
814.         columns = self.column_classes(Note)
815.         self.assertFalse(columns['info'][1][6])
816. 
817.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
818.     def test_alter_textual_field_keep_null_status(self):
819.         """
820.         Changing a field type shouldn't affect the not null status.
821.         """
822.         with connection.schema_editor() as editor:
823.             editor.create_model(Note)
824.         with self.assertRaises(IntegrityError):
825.             Note.objects.create(info=None)
826.         old_field = Note._meta.get_field("info")
827.         new_field = CharField(max_length=50)
828.         new_field.set_attributes_from_name("info")
829.         with connection.schema_editor() as editor:
830.             editor.alter_field(Note, old_field, new_field, strict=True)
831.         with self.assertRaises(IntegrityError):
832.             Note.objects.create(info=None)
833. 
834.     def test_alter_numeric_field_keep_null_status(self):
835.         """
836.         Changing a field type shouldn't affect the not null status.
837.         """
838.         with connection.schema_editor() as editor:
839.             editor.create_model(UniqueTest)
840.         with self.assertRaises(IntegrityError):
841.             UniqueTest.objects.create(year=None, slug='aaa')
842.         old_field = UniqueTest._meta.get_field("year")
843.         new_field = BigIntegerField()
844.         new_field.set_attributes_from_name("year")
845.         with connection.schema_editor() as editor:
846.             editor.alter_field(UniqueTest, old_field, new_field, strict=True)
847.         with self.assertRaises(IntegrityError):
848.             UniqueTest.objects.create(year=None, slug='bbb')
849. 
850.     def test_alter_null_to_not_null(self):
851.         """
852.         #23609 - Tests handling of default values when altering from NULL to NOT NULL.
853.         """
854.         # Create the table
855.         with connection.schema_editor() as editor:
856.             editor.create_model(Author)
857.         # Ensure the field is right to begin with
858.         columns = self.column_classes(Author)
859.         self.assertTrue(columns['height'][1][6])
860.         # Create some test data
861.         Author.objects.create(name='Not null author', height=12)
862.         Author.objects.create(name='Null author')
863.         # Verify null value
864.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
865.         self.assertIsNone(Author.objects.get(name='Null author').height)
866.         # Alter the height field to NOT NULL with default
867.         old_field = Author._meta.get_field("height")
868.         new_field = PositiveIntegerField(default=42)
869.         new_field.set_attributes_from_name("height")
870.         with connection.schema_editor() as editor:
871.             editor.alter_field(Author, old_field, new_field, strict=True)
872.         # Ensure the field is right afterwards
873.         columns = self.column_classes(Author)
874.         self.assertFalse(columns['height'][1][6])
875.         # Verify default value
876.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
877.         self.assertEqual(Author.objects.get(name='Null author').height, 42)
878. 
879.     def test_alter_charfield_to_null(self):
880.         """
881.         #24307 - Should skip an alter statement on databases with
882.         interprets_empty_strings_as_null when changing a CharField to null.
883.         """
884.         # Create the table
885.         with connection.schema_editor() as editor:
886.             editor.create_model(Author)
887.         # Change the CharField to null
888.         old_field = Author._meta.get_field('name')
889.         new_field = copy(old_field)
890.         new_field.null = True
891.         with connection.schema_editor() as editor:
892.             editor.alter_field(Author, old_field, new_field, strict=True)
893. 
894.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
895.     def test_alter_char_field_decrease_length(self):
896.         # Create the table.
897.         with connection.schema_editor() as editor:
898.             editor.create_model(Author)
899.         Author.objects.create(name='x' * 255)
900.         # Change max_length of CharField.
901.         old_field = Author._meta.get_field('name')
902.         new_field = CharField(max_length=254)
903.         new_field.set_attributes_from_name('name')
904.         with connection.schema_editor() as editor:
905.             msg = 'value too long for type character varying(254)'
906.             with self.assertRaisesMessage(DataError, msg):
907.                 editor.alter_field(Author, old_field, new_field, strict=True)
908. 
909.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
910.     def test_alter_field_with_custom_db_type(self):
911.         from django.contrib.postgres.fields import ArrayField
912. 
913.         class Foo(Model):
914.             field = ArrayField(CharField(max_length=255))
915. 
916.             class Meta:
917.                 app_label = 'schema'
918. 
919.         with connection.schema_editor() as editor:
920.             editor.create_model(Foo)
921.         self.isolated_local_models = [Foo]
922.         old_field = Foo._meta.get_field('field')
923.         new_field = ArrayField(CharField(max_length=16))
924.         new_field.set_attributes_from_name('field')
925.         new_field.model = Foo
926.         with connection.schema_editor() as editor:
927.             editor.alter_field(Foo, old_field, new_field, strict=True)
928. 
929.     @isolate_apps('schema')
930.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
931.     def test_alter_array_field_decrease_base_field_length(self):
932.         from django.contrib.postgres.fields import ArrayField
933. 
934.         class ArrayModel(Model):
935.             field = ArrayField(CharField(max_length=16))
936. 
937.             class Meta:
938.                 app_label = 'schema'
939. 
940.         with connection.schema_editor() as editor:
941.             editor.create_model(ArrayModel)
942.         self.isolated_local_models = [ArrayModel]
943.         ArrayModel.objects.create(field=['x' * 16])
944.         old_field = ArrayModel._meta.get_field('field')
945.         new_field = ArrayField(CharField(max_length=15))
946.         new_field.set_attributes_from_name('field')
947.         new_field.model = ArrayModel
948.         with connection.schema_editor() as editor:
949.             msg = 'value too long for type character varying(15)'
950.             with self.assertRaisesMessage(DataError, msg):
951.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
952. 
953.     @isolate_apps('schema')
954.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
955.     def test_alter_array_field_decrease_nested_base_field_length(self):
956.         from django.contrib.postgres.fields import ArrayField
957. 
958.         class ArrayModel(Model):
959.             field = ArrayField(ArrayField(CharField(max_length=16)))
960. 
961.             class Meta:
962.                 app_label = 'schema'
963. 
964.         with connection.schema_editor() as editor:
965.             editor.create_model(ArrayModel)
966.         self.isolated_local_models = [ArrayModel]
967.         ArrayModel.objects.create(field=[['x' * 16]])
968.         old_field = ArrayModel._meta.get_field('field')
969.         new_field = ArrayField(ArrayField(CharField(max_length=15)))
970.         new_field.set_attributes_from_name('field')
971.         new_field.model = ArrayModel
972.         with connection.schema_editor() as editor:
973.             msg = 'value too long for type character varying(15)'
974.             with self.assertRaisesMessage(DataError, msg):
975.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
976. 
977.     def test_alter_textfield_to_null(self):
978.         """
979.         #24307 - Should skip an alter statement on databases with
980.         interprets_empty_strings_as_null when changing a TextField to null.
981.         """
982.         # Create the table
983.         with connection.schema_editor() as editor:
984.             editor.create_model(Note)
985.         # Change the TextField to null
986.         old_field = Note._meta.get_field('info')
987.         new_field = copy(old_field)
988.         new_field.null = True
989.         with connection.schema_editor() as editor:
990.             editor.alter_field(Note, old_field, new_field, strict=True)
991. 
992.     @skipUnlessDBFeature('supports_combined_alters')
993.     def test_alter_null_to_not_null_keeping_default(self):
994.         """
995.         #23738 - Can change a nullable field with default to non-nullable
996.         with the same default.
997.         """
998.         # Create the table
999.         with connection.schema_editor() as editor:
1000.             editor.create_model(AuthorWithDefaultHeight)
1001.         # Ensure the field is right to begin with
1002.         columns = self.column_classes(AuthorWithDefaultHeight)
1003.         self.assertTrue(columns['height'][1][6])
1004.         # Alter the height field to NOT NULL keeping the previous default
1005.         old_field = AuthorWithDefaultHeight._meta.get_field("height")
1006.         new_field = PositiveIntegerField(default=42)
1007.         new_field.set_attributes_from_name("height")
1008.         with connection.schema_editor() as editor:
1009.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
1010.         # Ensure the field is right afterwards
1011.         columns = self.column_classes(AuthorWithDefaultHeight)
1012.         self.assertFalse(columns['height'][1][6])
1013. 
1014.     @skipUnlessDBFeature('supports_foreign_keys')
1015.     def test_alter_fk(self):
1016.         """
1017.         Tests altering of FKs
1018.         """
1019.         # Create the table
1020.         with connection.schema_editor() as editor:
1021.             editor.create_model(Author)
1022.             editor.create_model(Book)
1023.         # Ensure the field is right to begin with
1024.         columns = self.column_classes(Book)
1025.         self.assertEqual(columns['author_id'][0], "IntegerField")
1026.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1027.         # Alter the FK
1028.         old_field = Book._meta.get_field("author")
1029.         new_field = ForeignKey(Author, CASCADE, editable=False)
1030.         new_field.set_attributes_from_name("author")
1031.         with connection.schema_editor() as editor:
1032.             editor.alter_field(Book, old_field, new_field, strict=True)
1033.         # Ensure the field is right afterwards
1034.         columns = self.column_classes(Book)
1035.         self.assertEqual(columns['author_id'][0], "IntegerField")
1036.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1037. 
1038.     @skipUnlessDBFeature('supports_foreign_keys')
1039.     def test_alter_to_fk(self):
1040.         """
1041.         #24447 - Tests adding a FK constraint for an existing column
1042.         """
1043.         class LocalBook(Model):
1044.             author = IntegerField()
1045.             title = CharField(max_length=100, db_index=True)
1046.             pub_date = DateTimeField()
1047. 
1048.             class Meta:
1049.                 app_label = 'schema'
1050.                 apps = new_apps
1051. 
1052.         self.local_models = [LocalBook]
1053. 
1054.         # Create the tables
1055.         with connection.schema_editor() as editor:
1056.             editor.create_model(Author)
1057.             editor.create_model(LocalBook)
1058.         # Ensure no FK constraint exists
1059.         constraints = self.get_constraints(LocalBook._meta.db_table)
1060.         for details in constraints.values():
1061.             if details['foreign_key']:
1062.                 self.fail('Found an unexpected FK constraint to %s' % details['columns'])
1063.         old_field = LocalBook._meta.get_field("author")
1064.         new_field = ForeignKey(Author, CASCADE)
1065.         new_field.set_attributes_from_name("author")
1066.         with connection.schema_editor() as editor:
1067.             editor.alter_field(LocalBook, old_field, new_field, strict=True)
1068.         self.assertForeignKeyExists(LocalBook, 'author_id', 'schema_author')
1069. 
1070.     @skipUnlessDBFeature('supports_foreign_keys')
1071.     def test_alter_o2o_to_fk(self):
1072.         """
1073.         #24163 - Tests altering of OneToOneField to ForeignKey
1074.         """
1075.         # Create the table
1076.         with connection.schema_editor() as editor:
1077.             editor.create_model(Author)
1078.             editor.create_model(BookWithO2O)
1079.         # Ensure the field is right to begin with
1080.         columns = self.column_classes(BookWithO2O)
1081.         self.assertEqual(columns['author_id'][0], "IntegerField")
1082.         # Ensure the field is unique
1083.         author = Author.objects.create(name="Joe")
1084.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1085.         with self.assertRaises(IntegrityError):
1086.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1087.         BookWithO2O.objects.all().delete()
1088.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1089.         # Alter the OneToOneField to ForeignKey
1090.         old_field = BookWithO2O._meta.get_field("author")
1091.         new_field = ForeignKey(Author, CASCADE)
1092.         new_field.set_attributes_from_name("author")
1093.         with connection.schema_editor() as editor:
1094.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1095.         # Ensure the field is right afterwards
1096.         columns = self.column_classes(Book)
1097.         self.assertEqual(columns['author_id'][0], "IntegerField")
1098.         # Ensure the field is not unique anymore
1099.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1100.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1101.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1102. 
1103.     @skipUnlessDBFeature('supports_foreign_keys')
1104.     def test_alter_fk_to_o2o(self):
1105.         """
1106.         #24163 - Tests altering of ForeignKey to OneToOneField
1107.         """
1108.         # Create the table
1109.         with connection.schema_editor() as editor:
1110.             editor.create_model(Author)
1111.             editor.create_model(Book)
1112.         # Ensure the field is right to begin with
1113.         columns = self.column_classes(Book)
1114.         self.assertEqual(columns['author_id'][0], "IntegerField")
1115.         # Ensure the field is not unique
1116.         author = Author.objects.create(name="Joe")
1117.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1118.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1119.         Book.objects.all().delete()
1120.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1121.         # Alter the ForeignKey to OneToOneField
1122.         old_field = Book._meta.get_field("author")
1123.         new_field = OneToOneField(Author, CASCADE)
1124.         new_field.set_attributes_from_name("author")
1125.         with connection.schema_editor() as editor:
1126.             editor.alter_field(Book, old_field, new_field, strict=True)
1127.         # Ensure the field is right afterwards
1128.         columns = self.column_classes(BookWithO2O)
1129.         self.assertEqual(columns['author_id'][0], "IntegerField")
1130.         # Ensure the field is unique now
1131.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1132.         with self.assertRaises(IntegrityError):
1133.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1134.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1135. 
1136.     def test_alter_field_fk_to_o2o(self):
1137.         with connection.schema_editor() as editor:
1138.             editor.create_model(Author)
1139.             editor.create_model(Book)
1140.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1141. 
1142.         # Check the index is right to begin with.
1143.         counts = self.get_constraints_count(
1144.             Book._meta.db_table,
1145.             Book._meta.get_field('author').column,
1146.             (Author._meta.db_table, Author._meta.pk.column),
1147.         )
1148.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1149. 
1150.         old_field = Book._meta.get_field('author')
1151.         new_field = OneToOneField(Author, CASCADE)
1152.         new_field.set_attributes_from_name('author')
1153.         with connection.schema_editor() as editor:
1154.             editor.alter_field(Book, old_field, new_field, strict=True)
1155. 
1156.         counts = self.get_constraints_count(
1157.             Book._meta.db_table,
1158.             Book._meta.get_field('author').column,
1159.             (Author._meta.db_table, Author._meta.pk.column),
1160.         )
1161.         # The index on ForeignKey is replaced with a unique constraint for OneToOneField.
1162.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1163. 
1164.     def test_alter_field_fk_keeps_index(self):
1165.         with connection.schema_editor() as editor:
1166.             editor.create_model(Author)
1167.             editor.create_model(Book)
1168.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1169. 
1170.         # Check the index is right to begin with.
1171.         counts = self.get_constraints_count(
1172.             Book._meta.db_table,
1173.             Book._meta.get_field('author').column,
1174.             (Author._meta.db_table, Author._meta.pk.column),
1175.         )
1176.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1177. 
1178.         old_field = Book._meta.get_field('author')
1179.         # on_delete changed from CASCADE.
1180.         new_field = ForeignKey(Author, PROTECT)
1181.         new_field.set_attributes_from_name('author')
1182.         with connection.schema_editor() as editor:
1183.             editor.alter_field(Book, old_field, new_field, strict=True)
1184. 
1185.         counts = self.get_constraints_count(
1186.             Book._meta.db_table,
1187.             Book._meta.get_field('author').column,
1188.             (Author._meta.db_table, Author._meta.pk.column),
1189.         )
1190.         # The index remains.
1191.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1192. 
1193.     def test_alter_field_o2o_to_fk(self):
1194.         with connection.schema_editor() as editor:
1195.             editor.create_model(Author)
1196.             editor.create_model(BookWithO2O)
1197.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1198. 
1199.         # Check the unique constraint is right to begin with.
1200.         counts = self.get_constraints_count(
1201.             BookWithO2O._meta.db_table,
1202.             BookWithO2O._meta.get_field('author').column,
1203.             (Author._meta.db_table, Author._meta.pk.column),
1204.         )
1205.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1206. 
1207.         old_field = BookWithO2O._meta.get_field('author')
1208.         new_field = ForeignKey(Author, CASCADE)
1209.         new_field.set_attributes_from_name('author')
1210.         with connection.schema_editor() as editor:
1211.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1212. 
1213.         counts = self.get_constraints_count(
1214.             BookWithO2O._meta.db_table,
1215.             BookWithO2O._meta.get_field('author').column,
1216.             (Author._meta.db_table, Author._meta.pk.column),
1217.         )
1218.         # The unique constraint on OneToOneField is replaced with an index for ForeignKey.
1219.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1220. 
1221.     def test_alter_field_o2o_keeps_unique(self):
1222.         with connection.schema_editor() as editor:
1223.             editor.create_model(Author)
1224.             editor.create_model(BookWithO2O)
1225.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1226. 
1227.         # Check the unique constraint is right to begin with.
1228.         counts = self.get_constraints_count(
1229.             BookWithO2O._meta.db_table,
1230.             BookWithO2O._meta.get_field('author').column,
1231.             (Author._meta.db_table, Author._meta.pk.column),
1232.         )
1233.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1234. 
1235.         old_field = BookWithO2O._meta.get_field('author')
1236.         # on_delete changed from CASCADE.
1237.         new_field = OneToOneField(Author, PROTECT)
1238.         new_field.set_attributes_from_name('author')
1239.         with connection.schema_editor() as editor:
1240.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1241. 
1242.         counts = self.get_constraints_count(
1243.             BookWithO2O._meta.db_table,
1244.             BookWithO2O._meta.get_field('author').column,
1245.             (Author._meta.db_table, Author._meta.pk.column),
1246.         )
1247.         # The unique constraint remains.
1248.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1249. 
1250.     @skipUnlessDBFeature('ignores_table_name_case')
1251.     def test_alter_db_table_case(self):
1252.         # Create the table
1253.         with connection.schema_editor() as editor:
1254.             editor.create_model(Author)
1255.         # Alter the case of the table
1256.         old_table_name = Author._meta.db_table
1257.         with connection.schema_editor() as editor:
1258.             editor.alter_db_table(Author, old_table_name, old_table_name.upper())
1259. 
1260.     def test_alter_implicit_id_to_explicit(self):
1261.         """
1262.         Should be able to convert an implicit "id" field to an explicit "id"
1263.         primary key field.
1264.         """
1265.         with connection.schema_editor() as editor:
1266.             editor.create_model(Author)
1267. 
1268.         old_field = Author._meta.get_field("id")
1269.         new_field = AutoField(primary_key=True)
1270.         new_field.set_attributes_from_name("id")
1271.         new_field.model = Author
1272.         with connection.schema_editor() as editor:
1273.             editor.alter_field(Author, old_field, new_field, strict=True)
1274.         # This will fail if DROP DEFAULT is inadvertently executed on this
1275.         # field which drops the id sequence, at least on PostgreSQL.
1276.         Author.objects.create(name='Foo')
1277.         Author.objects.create(name='Bar')
1278. 
1279.     def test_alter_autofield_pk_to_bigautofield_pk_sequence_owner(self):
1280.         """
1281.         Converting an implicit PK to BigAutoField(primary_key=True) should keep
1282.         a sequence owner on PostgreSQL.
1283.         """
1284.         with connection.schema_editor() as editor:
1285.             editor.create_model(Author)
1286.         old_field = Author._meta.get_field('id')
1287.         new_field = BigAutoField(primary_key=True)
1288.         new_field.set_attributes_from_name('id')
1289.         new_field.model = Author
1290.         with connection.schema_editor() as editor:
1291.             editor.alter_field(Author, old_field, new_field, strict=True)
1292. 
1293.         Author.objects.create(name='Foo', pk=1)
1294.         with connection.cursor() as cursor:
1295.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1296.             if sequence_reset_sqls:
1297.                 cursor.execute(sequence_reset_sqls[0])
1298.         # Fail on PostgreSQL if sequence is missing an owner.
1299.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1300. 
1301.     def test_alter_autofield_pk_to_smallautofield_pk_sequence_owner(self):
1302.         """
1303.         Converting an implicit PK to SmallAutoField(primary_key=True) should
1304.         keep a sequence owner on PostgreSQL.
1305.         """
1306.         with connection.schema_editor() as editor:
1307.             editor.create_model(Author)
1308.         old_field = Author._meta.get_field('id')
1309.         new_field = SmallAutoField(primary_key=True)
1310.         new_field.set_attributes_from_name('id')
1311.         new_field.model = Author
1312.         with connection.schema_editor() as editor:
1313.             editor.alter_field(Author, old_field, new_field, strict=True)
1314. 
1315.         Author.objects.create(name='Foo', pk=1)
1316.         with connection.cursor() as cursor:
1317.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1318.             if sequence_reset_sqls:
1319.                 cursor.execute(sequence_reset_sqls[0])
1320.         # Fail on PostgreSQL if sequence is missing an owner.
1321.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1322. 
1323.     def test_alter_int_pk_to_autofield_pk(self):
1324.         """
1325.         Should be able to rename an IntegerField(primary_key=True) to
1326.         AutoField(primary_key=True).
1327.         """
1328.         with connection.schema_editor() as editor:
1329.             editor.create_model(IntegerPK)
1330. 
1331.         old_field = IntegerPK._meta.get_field('i')
1332.         new_field = AutoField(primary_key=True)
1333.         new_field.model = IntegerPK
1334.         new_field.set_attributes_from_name('i')
1335. 
1336.         with connection.schema_editor() as editor:
1337.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1338. 
1339.     def test_alter_int_pk_to_bigautofield_pk(self):
1340.         """
1341.         Should be able to rename an IntegerField(primary_key=True) to
1342.         BigAutoField(primary_key=True).
1343.         """
1344.         with connection.schema_editor() as editor:
1345.             editor.create_model(IntegerPK)
1346. 
1347.         old_field = IntegerPK._meta.get_field('i')
1348.         new_field = BigAutoField(primary_key=True)
1349.         new_field.model = IntegerPK
1350.         new_field.set_attributes_from_name('i')
1351. 
1352.         with connection.schema_editor() as editor:
1353.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1354. 
1355.     @isolate_apps('schema')
1356.     def test_alter_smallint_pk_to_smallautofield_pk(self):
1357.         """
1358.         Should be able to rename an SmallIntegerField(primary_key=True) to
1359.         SmallAutoField(primary_key=True).
1360.         """
1361.         class SmallIntegerPK(Model):
1362.             i = SmallIntegerField(primary_key=True)
1363. 
1364.             class Meta:
1365.                 app_label = 'schema'
1366. 
1367.         with connection.schema_editor() as editor:
1368.             editor.create_model(SmallIntegerPK)
1369.         self.isolated_local_models = [SmallIntegerPK]
1370.         old_field = SmallIntegerPK._meta.get_field('i')
1371.         new_field = SmallAutoField(primary_key=True)
1372.         new_field.model = SmallIntegerPK
1373.         new_field.set_attributes_from_name('i')
1374.         with connection.schema_editor() as editor:
1375.             editor.alter_field(SmallIntegerPK, old_field, new_field, strict=True)
1376. 
1377.     def test_alter_int_pk_to_int_unique(self):
1378.         """
1379.         Should be able to rename an IntegerField(primary_key=True) to
1380.         IntegerField(unique=True).
1381.         """
1382.         with connection.schema_editor() as editor:
1383.             editor.create_model(IntegerPK)
1384.         # Delete the old PK
1385.         old_field = IntegerPK._meta.get_field('i')
1386.         new_field = IntegerField(unique=True)
1387.         new_field.model = IntegerPK
1388.         new_field.set_attributes_from_name('i')
1389.         with connection.schema_editor() as editor:
1390.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1391.         # The primary key constraint is gone. Result depends on database:
1392.         # 'id' for SQLite, None for others (must not be 'i').
1393.         self.assertIn(self.get_primary_key(IntegerPK._meta.db_table), ('id', None))
1394. 
1395.         # Set up a model class as it currently stands. The original IntegerPK
1396.         # class is now out of date and some backends make use of the whole
1397.         # model class when modifying a field (such as sqlite3 when remaking a
1398.         # table) so an outdated model class leads to incorrect results.
1399.         class Transitional(Model):
1400.             i = IntegerField(unique=True)
1401.             j = IntegerField(unique=True)
1402. 
1403.             class Meta:
1404.                 app_label = 'schema'
1405.                 apps = new_apps
1406.                 db_table = 'INTEGERPK'
1407. 
1408.         # model requires a new PK
1409.         old_field = Transitional._meta.get_field('j')
1410.         new_field = IntegerField(primary_key=True)
1411.         new_field.model = Transitional
1412.         new_field.set_attributes_from_name('j')
1413. 
1414.         with connection.schema_editor() as editor:
1415.             editor.alter_field(Transitional, old_field, new_field, strict=True)
1416. 
1417.         # Create a model class representing the updated model.
1418.         class IntegerUnique(Model):
1419.             i = IntegerField(unique=True)
1420.             j = IntegerField(primary_key=True)
1421. 
1422.             class Meta:
1423.                 app_label = 'schema'
1424.                 apps = new_apps
1425.                 db_table = 'INTEGERPK'
1426. 
1427.         # Ensure unique constraint works.
1428.         IntegerUnique.objects.create(i=1, j=1)
1429.         with self.assertRaises(IntegrityError):
1430.             IntegerUnique.objects.create(i=1, j=2)
1431. 
1432.     def test_rename(self):
1433.         """
1434.         Tests simple altering of fields
1435.         """
1436.         # Create the table
1437.         with connection.schema_editor() as editor:
1438.             editor.create_model(Author)
1439.         # Ensure the field is right to begin with
1440.         columns = self.column_classes(Author)
1441.         self.assertEqual(columns['name'][0], "CharField")
1442.         self.assertNotIn("display_name", columns)
1443.         # Alter the name field's name
1444.         old_field = Author._meta.get_field("name")
1445.         new_field = CharField(max_length=254)
1446.         new_field.set_attributes_from_name("display_name")
1447.         with connection.schema_editor() as editor:
1448.             editor.alter_field(Author, old_field, new_field, strict=True)
1449.         # Ensure the field is right afterwards
1450.         columns = self.column_classes(Author)
1451.         self.assertEqual(columns['display_name'][0], "CharField")
1452.         self.assertNotIn("name", columns)
1453. 
1454.     @isolate_apps('schema')
1455.     def test_rename_referenced_field(self):
1456.         class Author(Model):
1457.             name = CharField(max_length=255, unique=True)
1458. 
1459.             class Meta:
1460.                 app_label = 'schema'
1461. 
1462.         class Book(Model):
1463.             author = ForeignKey(Author, CASCADE, to_field='name')
1464. 
1465.             class Meta:
1466.                 app_label = 'schema'
1467. 
1468.         with connection.schema_editor() as editor:
1469.             editor.create_model(Author)
1470.             editor.create_model(Book)
1471.         new_field = CharField(max_length=255, unique=True)
1472.         new_field.set_attributes_from_name('renamed')
1473.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
1474.             editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1475.         # Ensure the foreign key reference was updated.
1476.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author', 'renamed')
1477. 
1478.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
1479.     def test_rename_keep_null_status(self):
1480.         """
1481.         Renaming a field shouldn't affect the not null status.
1482.         """
1483.         with connection.schema_editor() as editor:
1484.             editor.create_model(Note)
1485.         with self.assertRaises(IntegrityError):
1486.             Note.objects.create(info=None)
1487.         old_field = Note._meta.get_field("info")
1488.         new_field = TextField()
1489.         new_field.set_attributes_from_name("detail_info")
1490.         with connection.schema_editor() as editor:
1491.             editor.alter_field(Note, old_field, new_field, strict=True)
1492.         columns = self.column_classes(Note)
1493.         self.assertEqual(columns['detail_info'][0], "TextField")
1494.         self.assertNotIn("info", columns)
1495.         with self.assertRaises(IntegrityError):
1496.             NoteRename.objects.create(detail_info=None)
1497. 
1498.     def _test_m2m_create(self, M2MFieldClass):
1499.         """
1500.         Tests M2M fields on models during creation
1501.         """
1502.         class LocalBookWithM2M(Model):
1503.             author = ForeignKey(Author, CASCADE)
1504.             title = CharField(max_length=100, db_index=True)
1505.             pub_date = DateTimeField()
1506.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1507. 
1508.             class Meta:
1509.                 app_label = 'schema'
1510.                 apps = new_apps
1511.         self.local_models = [LocalBookWithM2M]
1512.         # Create the tables
1513.         with connection.schema_editor() as editor:
1514.             editor.create_model(Author)
1515.             editor.create_model(TagM2MTest)
1516.             editor.create_model(LocalBookWithM2M)
1517.         # Ensure there is now an m2m table there
1518.         columns = self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1519.         self.assertEqual(columns['tagm2mtest_id'][0], "IntegerField")
1520. 
1521.     def test_m2m_create(self):
1522.         self._test_m2m_create(ManyToManyField)
1523. 
1524.     def test_m2m_create_custom(self):
1525.         self._test_m2m_create(CustomManyToManyField)
1526. 
1527.     def test_m2m_create_inherited(self):
1528.         self._test_m2m_create(InheritedManyToManyField)
1529. 
1530.     def _test_m2m_create_through(self, M2MFieldClass):
1531.         """
1532.         Tests M2M fields on models during creation with through models
1533.         """
1534.         class LocalTagThrough(Model):
1535.             book = ForeignKey("schema.LocalBookWithM2MThrough", CASCADE)
1536.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1537. 
1538.             class Meta:
1539.                 app_label = 'schema'
1540.                 apps = new_apps
1541. 
1542.         class LocalBookWithM2MThrough(Model):
1543.             tags = M2MFieldClass("TagM2MTest", related_name="books", through=LocalTagThrough)
1544. 
1545.             class Meta:
1546.                 app_label = 'schema'
1547.                 apps = new_apps
1548. 
1549.         self.local_models = [LocalTagThrough, LocalBookWithM2MThrough]
1550. 
1551.         # Create the tables
1552.         with connection.schema_editor() as editor:
1553.             editor.create_model(LocalTagThrough)
1554.             editor.create_model(TagM2MTest)
1555.             editor.create_model(LocalBookWithM2MThrough)
1556.         # Ensure there is now an m2m table there
1557.         columns = self.column_classes(LocalTagThrough)
1558.         self.assertEqual(columns['book_id'][0], "IntegerField")
1559.         self.assertEqual(columns['tag_id'][0], "IntegerField")
1560. 
1561.     def test_m2m_create_through(self):
1562.         self._test_m2m_create_through(ManyToManyField)
1563. 
1564.     def test_m2m_create_through_custom(self):
1565.         self._test_m2m_create_through(CustomManyToManyField)
1566. 
1567.     def test_m2m_create_through_inherited(self):
1568.         self._test_m2m_create_through(InheritedManyToManyField)
1569. 
1570.     def _test_m2m(self, M2MFieldClass):
1571.         """
1572.         Tests adding/removing M2M fields on models
1573.         """
1574.         class LocalAuthorWithM2M(Model):
1575.             name = CharField(max_length=255)
1576. 
1577.             class Meta:
1578.                 app_label = 'schema'
1579.                 apps = new_apps
1580. 
1581.         self.local_models = [LocalAuthorWithM2M]
1582. 
1583.         # Create the tables
1584.         with connection.schema_editor() as editor:
1585.             editor.create_model(LocalAuthorWithM2M)
1586.             editor.create_model(TagM2MTest)
1587.         # Create an M2M field
1588.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors")
1589.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
1590.         # Ensure there's no m2m table there
1591.         with self.assertRaises(DatabaseError):
1592.             self.column_classes(new_field.remote_field.through)
1593.         # Add the field
1594.         with connection.schema_editor() as editor:
1595.             editor.add_field(LocalAuthorWithM2M, new_field)
1596.         # Ensure there is now an m2m table there
1597.         columns = self.column_classes(new_field.remote_field.through)
1598.         self.assertEqual(columns['tagm2mtest_id'][0], "IntegerField")
1599. 
1600.         # "Alter" the field. This should not rename the DB table to itself.
1601.         with connection.schema_editor() as editor:
1602.             editor.alter_field(LocalAuthorWithM2M, new_field, new_field, strict=True)
1603. 
1604.         # Remove the M2M table again
1605.         with connection.schema_editor() as editor:
1606.             editor.remove_field(LocalAuthorWithM2M, new_field)
1607.         # Ensure there's no m2m table there
1608.         with self.assertRaises(DatabaseError):
1609.             self.column_classes(new_field.remote_field.through)
1610. 
1611.         # Make sure the model state is coherent with the table one now that
1612.         # we've removed the tags field.
1613.         opts = LocalAuthorWithM2M._meta
1614.         opts.local_many_to_many.remove(new_field)
1615.         del new_apps.all_models['schema'][new_field.remote_field.through._meta.model_name]
1616.         opts._expire_cache()
1617. 
1618.     def test_m2m(self):
1619.         self._test_m2m(ManyToManyField)
1620. 
1621.     def test_m2m_custom(self):
1622.         self._test_m2m(CustomManyToManyField)
1623. 
1624.     def test_m2m_inherited(self):
1625.         self._test_m2m(InheritedManyToManyField)
1626. 
1627.     def _test_m2m_through_alter(self, M2MFieldClass):
1628.         """
1629.         Tests altering M2Ms with explicit through models (should no-op)
1630.         """
1631.         class LocalAuthorTag(Model):
1632.             author = ForeignKey("schema.LocalAuthorWithM2MThrough", CASCADE)
1633.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1634. 
1635.             class Meta:
1636.                 app_label = 'schema'
1637.                 apps = new_apps
1638. 
1639.         class LocalAuthorWithM2MThrough(Model):
1640.             name = CharField(max_length=255)
1641.             tags = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1642. 
1643.             class Meta:
1644.                 app_label = 'schema'
1645.                 apps = new_apps
1646. 
1647.         self.local_models = [LocalAuthorTag, LocalAuthorWithM2MThrough]
1648. 
1649.         # Create the tables
1650.         with connection.schema_editor() as editor:
1651.             editor.create_model(LocalAuthorTag)
1652.             editor.create_model(LocalAuthorWithM2MThrough)
1653.             editor.create_model(TagM2MTest)
1654.         # Ensure the m2m table is there
1655.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1656.         # "Alter" the field's blankness. This should not actually do anything.
1657.         old_field = LocalAuthorWithM2MThrough._meta.get_field("tags")
1658.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1659.         new_field.contribute_to_class(LocalAuthorWithM2MThrough, "tags")
1660.         with connection.schema_editor() as editor:
1661.             editor.alter_field(LocalAuthorWithM2MThrough, old_field, new_field, strict=True)
1662.         # Ensure the m2m table is still there
1663.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1664. 
1665.     def test_m2m_through_alter(self):
1666.         self._test_m2m_through_alter(ManyToManyField)
1667. 
1668.     def test_m2m_through_alter_custom(self):
1669.         self._test_m2m_through_alter(CustomManyToManyField)
1670. 
1671.     def test_m2m_through_alter_inherited(self):
1672.         self._test_m2m_through_alter(InheritedManyToManyField)
1673. 
1674.     def _test_m2m_repoint(self, M2MFieldClass):
1675.         """
1676.         Tests repointing M2M fields
1677.         """
1678.         class LocalBookWithM2M(Model):
1679.             author = ForeignKey(Author, CASCADE)
1680.             title = CharField(max_length=100, db_index=True)
1681.             pub_date = DateTimeField()
1682.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1683. 
1684.             class Meta:
1685.                 app_label = 'schema'
1686.                 apps = new_apps
1687.         self.local_models = [LocalBookWithM2M]
1688.         # Create the tables
1689.         with connection.schema_editor() as editor:
1690.             editor.create_model(Author)
1691.             editor.create_model(LocalBookWithM2M)
1692.             editor.create_model(TagM2MTest)
1693.             editor.create_model(UniqueTest)
1694.         # Ensure the M2M exists and points to TagM2MTest
1695.         if connection.features.supports_foreign_keys:
1696.             self.assertForeignKeyExists(
1697.                 LocalBookWithM2M._meta.get_field("tags").remote_field.through,
1698.                 'tagm2mtest_id',
1699.                 'schema_tagm2mtest',
1700.             )
1701.         # Repoint the M2M
1702.         old_field = LocalBookWithM2M._meta.get_field("tags")
1703.         new_field = M2MFieldClass(UniqueTest)
1704.         new_field.contribute_to_class(LocalBookWithM2M, "uniques")
1705.         with connection.schema_editor() as editor:
1706.             editor.alter_field(LocalBookWithM2M, old_field, new_field, strict=True)
1707.         # Ensure old M2M is gone
1708.         with self.assertRaises(DatabaseError):
1709.             self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1710. 
1711.         # This model looks like the new model and is used for teardown.
1712.         opts = LocalBookWithM2M._meta
1713.         opts.local_many_to_many.remove(old_field)
1714.         # Ensure the new M2M exists and points to UniqueTest
1715.         if connection.features.supports_foreign_keys:
1716.             self.assertForeignKeyExists(new_field.remote_field.through, 'uniquetest_id', 'schema_uniquetest')
1717. 
1718.     def test_m2m_repoint(self):
1719.         self._test_m2m_repoint(ManyToManyField)
1720. 
1721.     def test_m2m_repoint_custom(self):
1722.         self._test_m2m_repoint(CustomManyToManyField)
1723. 
1724.     def test_m2m_repoint_inherited(self):
1725.         self._test_m2m_repoint(InheritedManyToManyField)
1726. 
1727.     @isolate_apps('schema')
1728.     def test_m2m_rename_field_in_target_model(self):
1729.         class LocalTagM2MTest(Model):
1730.             title = CharField(max_length=255)
1731. 
1732.             class Meta:
1733.                 app_label = 'schema'
1734. 
1735.         class LocalM2M(Model):
1736.             tags = ManyToManyField(LocalTagM2MTest)
1737. 
1738.             class Meta:
1739.                 app_label = 'schema'
1740. 
1741.         # Create the tables.
1742.         with connection.schema_editor() as editor:
1743.             editor.create_model(LocalM2M)
1744.             editor.create_model(LocalTagM2MTest)
1745.         self.isolated_local_models = [LocalM2M, LocalTagM2MTest]
1746.         # Ensure the m2m table is there.
1747.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1748.         # Alter a field in LocalTagM2MTest.
1749.         old_field = LocalTagM2MTest._meta.get_field('title')
1750.         new_field = CharField(max_length=254)
1751.         new_field.contribute_to_class(LocalTagM2MTest, 'title1')
1752.         # @isolate_apps() and inner models are needed to have the model
1753.         # relations populated, otherwise this doesn't act as a regression test.
1754.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
1755.         with connection.schema_editor() as editor:
1756.             editor.alter_field(LocalTagM2MTest, old_field, new_field, strict=True)
1757.         # Ensure the m2m table is still there.
1758.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1759. 
1760.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1761.     def test_check_constraints(self):
1762.         """
1763.         Tests creating/deleting CHECK constraints
1764.         """
1765.         # Create the tables
1766.         with connection.schema_editor() as editor:
1767.             editor.create_model(Author)
1768.         # Ensure the constraint exists
1769.         constraints = self.get_constraints(Author._meta.db_table)
1770.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1771.             self.fail("No check constraint for height found")
1772.         # Alter the column to remove it
1773.         old_field = Author._meta.get_field("height")
1774.         new_field = IntegerField(null=True, blank=True)
1775.         new_field.set_attributes_from_name("height")
1776.         with connection.schema_editor() as editor:
1777.             editor.alter_field(Author, old_field, new_field, strict=True)
1778.         constraints = self.get_constraints(Author._meta.db_table)
1779.         for details in constraints.values():
1780.             if details['columns'] == ["height"] and details['check']:
1781.                 self.fail("Check constraint for height found")
1782.         # Alter the column to re-add it
1783.         new_field2 = Author._meta.get_field("height")
1784.         with connection.schema_editor() as editor:
1785.             editor.alter_field(Author, new_field, new_field2, strict=True)
1786.         constraints = self.get_constraints(Author._meta.db_table)
1787.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1788.             self.fail("No check constraint for height found")
1789. 
1790.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1791.     def test_remove_field_check_does_not_remove_meta_constraints(self):
1792.         with connection.schema_editor() as editor:
1793.             editor.create_model(Author)
1794.         # Add the custom check constraint
1795.         constraint = CheckConstraint(check=Q(height__gte=0), name='author_height_gte_0_check')
1796.         custom_constraint_name = constraint.name
1797.         Author._meta.constraints = [constraint]
1798.         with connection.schema_editor() as editor:
1799.             editor.add_constraint(Author, constraint)
1800.         # Ensure the constraints exist
1801.         constraints = self.get_constraints(Author._meta.db_table)
1802.         self.assertIn(custom_constraint_name, constraints)
1803.         other_constraints = [
1804.             name for name, details in constraints.items()
1805.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1806.         ]
1807.         self.assertEqual(len(other_constraints), 1)
1808.         # Alter the column to remove field check
1809.         old_field = Author._meta.get_field('height')
1810.         new_field = IntegerField(null=True, blank=True)
1811.         new_field.set_attributes_from_name('height')
1812.         with connection.schema_editor() as editor:
1813.             editor.alter_field(Author, old_field, new_field, strict=True)
1814.         constraints = self.get_constraints(Author._meta.db_table)
1815.         self.assertIn(custom_constraint_name, constraints)
1816.         other_constraints = [
1817.             name for name, details in constraints.items()
1818.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1819.         ]
1820.         self.assertEqual(len(other_constraints), 0)
1821.         # Alter the column to re-add field check
1822.         new_field2 = Author._meta.get_field('height')
1823.         with connection.schema_editor() as editor:
1824.             editor.alter_field(Author, new_field, new_field2, strict=True)
1825.         constraints = self.get_constraints(Author._meta.db_table)
1826.         self.assertIn(custom_constraint_name, constraints)
1827.         other_constraints = [
1828.             name for name, details in constraints.items()
1829.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1830.         ]
1831.         self.assertEqual(len(other_constraints), 1)
1832.         # Drop the check constraint
1833.         with connection.schema_editor() as editor:
1834.             Author._meta.constraints = []
1835.             editor.remove_constraint(Author, constraint)
1836. 
1837.     def test_unique(self):
1838.         """
1839.         Tests removing and adding unique constraints to a single column.
1840.         """
1841.         # Create the table
1842.         with connection.schema_editor() as editor:
1843.             editor.create_model(Tag)
1844.         # Ensure the field is unique to begin with
1845.         Tag.objects.create(title="foo", slug="foo")
1846.         with self.assertRaises(IntegrityError):
1847.             Tag.objects.create(title="bar", slug="foo")
1848.         Tag.objects.all().delete()
1849.         # Alter the slug field to be non-unique
1850.         old_field = Tag._meta.get_field("slug")
1851.         new_field = SlugField(unique=False)
1852.         new_field.set_attributes_from_name("slug")
1853.         with connection.schema_editor() as editor:
1854.             editor.alter_field(Tag, old_field, new_field, strict=True)
1855.         # Ensure the field is no longer unique
1856.         Tag.objects.create(title="foo", slug="foo")
1857.         Tag.objects.create(title="bar", slug="foo")
1858.         Tag.objects.all().delete()
1859.         # Alter the slug field to be unique
1860.         new_field2 = SlugField(unique=True)
1861.         new_field2.set_attributes_from_name("slug")
1862.         with connection.schema_editor() as editor:
1863.             editor.alter_field(Tag, new_field, new_field2, strict=True)
1864.         # Ensure the field is unique again
1865.         Tag.objects.create(title="foo", slug="foo")
1866.         with self.assertRaises(IntegrityError):
1867.             Tag.objects.create(title="bar", slug="foo")
1868.         Tag.objects.all().delete()
1869.         # Rename the field
1870.         new_field3 = SlugField(unique=True)
1871.         new_field3.set_attributes_from_name("slug2")
1872.         with connection.schema_editor() as editor:
1873.             editor.alter_field(Tag, new_field2, new_field3, strict=True)
1874.         # Ensure the field is still unique
1875.         TagUniqueRename.objects.create(title="foo", slug2="foo")
1876.         with self.assertRaises(IntegrityError):
1877.             TagUniqueRename.objects.create(title="bar", slug2="foo")
1878.         Tag.objects.all().delete()
1879. 
1880.     def test_unique_name_quoting(self):
1881.         old_table_name = TagUniqueRename._meta.db_table
1882.         try:
1883.             with connection.schema_editor() as editor:
1884.                 editor.create_model(TagUniqueRename)
1885.                 editor.alter_db_table(TagUniqueRename, old_table_name, 'unique-table')
1886.                 TagUniqueRename._meta.db_table = 'unique-table'
1887.                 # This fails if the unique index name isn't quoted.
1888.                 editor.alter_unique_together(TagUniqueRename, [], (('title', 'slug2'),))
1889.         finally:
1890.             TagUniqueRename._meta.db_table = old_table_name
1891. 
1892.     @isolate_apps('schema')
1893.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
1894.     @skipUnlessDBFeature('supports_foreign_keys')
1895.     def test_unique_no_unnecessary_fk_drops(self):
1896.         """
1897.         If AlterField isn't selective about dropping foreign key constraints
1898.         when modifying a field with a unique constraint, the AlterField
1899.         incorrectly drops and recreates the Book.author foreign key even though
1900.         it doesn't restrict the field being changed (#29193).
1901.         """
1902.         class Author(Model):
1903.             name = CharField(max_length=254, unique=True)
1904. 
1905.             class Meta:
1906.                 app_label = 'schema'
1907. 
1908.         class Book(Model):
1909.             author = ForeignKey(Author, CASCADE)
1910. 
1911.             class Meta:
1912.                 app_label = 'schema'
1913. 
1914.         with connection.schema_editor() as editor:
1915.             editor.create_model(Author)
1916.             editor.create_model(Book)
1917.         new_field = CharField(max_length=255, unique=True)
1918.         new_field.model = Author
1919.         new_field.set_attributes_from_name('name')
1920.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1921.             with connection.schema_editor() as editor:
1922.                 editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1923.         # One SQL statement is executed to alter the field.
1924.         self.assertEqual(len(cm.records), 1)
1925. 
1926.     @isolate_apps('schema')
1927.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite remakes the table on field alteration.')
1928.     def test_unique_and_reverse_m2m(self):
1929.         """
1930.         AlterField can modify a unique field when there's a reverse M2M
1931.         relation on the model.
1932.         """
1933.         class Tag(Model):
1934.             title = CharField(max_length=255)
1935.             slug = SlugField(unique=True)
1936. 
1937.             class Meta:
1938.                 app_label = 'schema'
1939. 
1940.         class Book(Model):
1941.             tags = ManyToManyField(Tag, related_name='books')
1942. 
1943.             class Meta:
1944.                 app_label = 'schema'
1945. 
1946.         self.isolated_local_models = [Book._meta.get_field('tags').remote_field.through]
1947.         with connection.schema_editor() as editor:
1948.             editor.create_model(Tag)
1949.             editor.create_model(Book)
1950.         new_field = SlugField(max_length=75, unique=True)
1951.         new_field.model = Tag
1952.         new_field.set_attributes_from_name('slug')
1953.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1954.             with connection.schema_editor() as editor:
1955.                 editor.alter_field(Tag, Tag._meta.get_field('slug'), new_field)
1956.         # One SQL statement is executed to alter the field.
1957.         self.assertEqual(len(cm.records), 1)
1958.         # Ensure that the field is still unique.
1959.         Tag.objects.create(title='foo', slug='foo')
1960.         with self.assertRaises(IntegrityError):
1961.             Tag.objects.create(title='bar', slug='foo')
1962. 
1963.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
1964.     def test_remove_field_unique_does_not_remove_meta_constraints(self):
1965.         with connection.schema_editor() as editor:
1966.             editor.create_model(AuthorWithUniqueName)
1967.         # Add the custom unique constraint
1968.         constraint = UniqueConstraint(fields=['name'], name='author_name_uniq')
1969.         custom_constraint_name = constraint.name
1970.         AuthorWithUniqueName._meta.constraints = [constraint]
1971.         with connection.schema_editor() as editor:
1972.             editor.add_constraint(AuthorWithUniqueName, constraint)
1973.         # Ensure the constraints exist
1974.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1975.         self.assertIn(custom_constraint_name, constraints)
1976.         other_constraints = [
1977.             name for name, details in constraints.items()
1978.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
1979.         ]
1980.         self.assertEqual(len(other_constraints), 1)
1981.         # Alter the column to remove field uniqueness
1982.         old_field = AuthorWithUniqueName._meta.get_field('name')
1983.         new_field = CharField(max_length=255)
1984.         new_field.set_attributes_from_name('name')
1985.         with connection.schema_editor() as editor:
1986.             editor.alter_field(AuthorWithUniqueName, old_field, new_field, strict=True)
1987.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1988.         self.assertIn(custom_constraint_name, constraints)
1989.         other_constraints = [
1990.             name for name, details in constraints.items()
1991.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
1992.         ]
1993.         self.assertEqual(len(other_constraints), 0)
1994.         # Alter the column to re-add field uniqueness
1995.         new_field2 = AuthorWithUniqueName._meta.get_field('name')
1996.         with connection.schema_editor() as editor:
1997.             editor.alter_field(AuthorWithUniqueName, new_field, new_field2, strict=True)
1998.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1999.         self.assertIn(custom_constraint_name, constraints)
2000.         other_constraints = [
2001.             name for name, details in constraints.items()
2002.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2003.         ]
2004.         self.assertEqual(len(other_constraints), 1)
2005.         # Drop the unique constraint
2006.         with connection.schema_editor() as editor:
2007.             AuthorWithUniqueName._meta.constraints = []
2008.             editor.remove_constraint(AuthorWithUniqueName, constraint)
2009. 
2010.     def test_unique_together(self):
2011.         """
2012.         Tests removing and adding unique_together constraints on a model.
2013.         """
2014.         # Create the table
2015.         with connection.schema_editor() as editor:
2016.             editor.create_model(UniqueTest)
2017.         # Ensure the fields are unique to begin with
2018.         UniqueTest.objects.create(year=2012, slug="foo")
2019.         UniqueTest.objects.create(year=2011, slug="foo")
2020.         UniqueTest.objects.create(year=2011, slug="bar")
2021.         with self.assertRaises(IntegrityError):
2022.             UniqueTest.objects.create(year=2012, slug="foo")
2023.         UniqueTest.objects.all().delete()
2024.         # Alter the model to its non-unique-together companion
2025.         with connection.schema_editor() as editor:
2026.             editor.alter_unique_together(UniqueTest, UniqueTest._meta.unique_together, [])
2027.         # Ensure the fields are no longer unique
2028.         UniqueTest.objects.create(year=2012, slug="foo")
2029.         UniqueTest.objects.create(year=2012, slug="foo")
2030.         UniqueTest.objects.all().delete()
2031.         # Alter it back
2032.         new_field2 = SlugField(unique=True)
2033.         new_field2.set_attributes_from_name("slug")
2034.         with connection.schema_editor() as editor:
2035.             editor.alter_unique_together(UniqueTest, [], UniqueTest._meta.unique_together)
2036.         # Ensure the fields are unique again
2037.         UniqueTest.objects.create(year=2012, slug="foo")
2038.         with self.assertRaises(IntegrityError):
2039.             UniqueTest.objects.create(year=2012, slug="foo")
2040.         UniqueTest.objects.all().delete()
2041. 
2042.     def test_unique_together_with_fk(self):
2043.         """
2044.         Tests removing and adding unique_together constraints that include
2045.         a foreign key.
2046.         """
2047.         # Create the table
2048.         with connection.schema_editor() as editor:
2049.             editor.create_model(Author)
2050.             editor.create_model(Book)
2051.         # Ensure the fields are unique to begin with
2052.         self.assertEqual(Book._meta.unique_together, ())
2053.         # Add the unique_together constraint
2054.         with connection.schema_editor() as editor:
2055.             editor.alter_unique_together(Book, [], [['author', 'title']])
2056.         # Alter it back
2057.         with connection.schema_editor() as editor:
2058.             editor.alter_unique_together(Book, [['author', 'title']], [])
2059. 
2060.     def test_unique_together_with_fk_with_existing_index(self):
2061.         """
2062.         Tests removing and adding unique_together constraints that include
2063.         a foreign key, where the foreign key is added after the model is
2064.         created.
2065.         """
2066.         # Create the tables
2067.         with connection.schema_editor() as editor:
2068.             editor.create_model(Author)
2069.             editor.create_model(BookWithoutAuthor)
2070.             new_field = ForeignKey(Author, CASCADE)
2071.             new_field.set_attributes_from_name('author')
2072.             editor.add_field(BookWithoutAuthor, new_field)
2073.         # Ensure the fields aren't unique to begin with
2074.         self.assertEqual(Book._meta.unique_together, ())
2075.         # Add the unique_together constraint
2076.         with connection.schema_editor() as editor:
2077.             editor.alter_unique_together(Book, [], [['author', 'title']])
2078.         # Alter it back
2079.         with connection.schema_editor() as editor:
2080.             editor.alter_unique_together(Book, [['author', 'title']], [])
2081. 
2082.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2083.     def test_remove_unique_together_does_not_remove_meta_constraints(self):
2084.         with connection.schema_editor() as editor:
2085.             editor.create_model(AuthorWithUniqueNameAndBirthday)
2086.         # Add the custom unique constraint
2087.         constraint = UniqueConstraint(fields=['name', 'birthday'], name='author_name_birthday_uniq')
2088.         custom_constraint_name = constraint.name
2089.         AuthorWithUniqueNameAndBirthday._meta.constraints = [constraint]
2090.         with connection.schema_editor() as editor:
2091.             editor.add_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2092.         # Ensure the constraints exist
2093.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2094.         self.assertIn(custom_constraint_name, constraints)
2095.         other_constraints = [
2096.             name for name, details in constraints.items()
2097.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2098.         ]
2099.         self.assertEqual(len(other_constraints), 1)
2100.         # Remove unique together
2101.         unique_together = AuthorWithUniqueNameAndBirthday._meta.unique_together
2102.         with connection.schema_editor() as editor:
2103.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, unique_together, [])
2104.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2105.         self.assertIn(custom_constraint_name, constraints)
2106.         other_constraints = [
2107.             name for name, details in constraints.items()
2108.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2109.         ]
2110.         self.assertEqual(len(other_constraints), 0)
2111.         # Re-add unique together
2112.         with connection.schema_editor() as editor:
2113.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, [], unique_together)
2114.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2115.         self.assertIn(custom_constraint_name, constraints)
2116.         other_constraints = [
2117.             name for name, details in constraints.items()
2118.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2119.         ]
2120.         self.assertEqual(len(other_constraints), 1)
2121.         # Drop the unique constraint
2122.         with connection.schema_editor() as editor:
2123.             AuthorWithUniqueNameAndBirthday._meta.constraints = []
2124.             editor.remove_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2125. 
2126.     def test_index_together(self):
2127.         """
2128.         Tests removing and adding index_together constraints on a model.
2129.         """
2130.         # Create the table
2131.         with connection.schema_editor() as editor:
2132.             editor.create_model(Tag)
2133.         # Ensure there's no index on the year/slug columns first
2134.         self.assertIs(
2135.             any(
2136.                 c["index"]
2137.                 for c in self.get_constraints("schema_tag").values()
2138.                 if c['columns'] == ["slug", "title"]
2139.             ),
2140.             False,
2141.         )
2142.         # Alter the model to add an index
2143.         with connection.schema_editor() as editor:
2144.             editor.alter_index_together(Tag, [], [("slug", "title")])
2145.         # Ensure there is now an index
2146.         self.assertIs(
2147.             any(
2148.                 c["index"]
2149.                 for c in self.get_constraints("schema_tag").values()
2150.                 if c['columns'] == ["slug", "title"]
2151.             ),
2152.             True,
2153.         )
2154.         # Alter it back
2155.         new_field2 = SlugField(unique=True)
2156.         new_field2.set_attributes_from_name("slug")
2157.         with connection.schema_editor() as editor:
2158.             editor.alter_index_together(Tag, [("slug", "title")], [])
2159.         # Ensure there's no index
2160.         self.assertIs(
2161.             any(
2162.                 c["index"]
2163.                 for c in self.get_constraints("schema_tag").values()
2164.                 if c['columns'] == ["slug", "title"]
2165.             ),
2166.             False,
2167.         )
2168. 
2169.     def test_index_together_with_fk(self):
2170.         """
2171.         Tests removing and adding index_together constraints that include
2172.         a foreign key.
2173.         """
2174.         # Create the table
2175.         with connection.schema_editor() as editor:
2176.             editor.create_model(Author)
2177.             editor.create_model(Book)
2178.         # Ensure the fields are unique to begin with
2179.         self.assertEqual(Book._meta.index_together, ())
2180.         # Add the unique_together constraint
2181.         with connection.schema_editor() as editor:
2182.             editor.alter_index_together(Book, [], [['author', 'title']])
2183.         # Alter it back
2184.         with connection.schema_editor() as editor:
2185.             editor.alter_index_together(Book, [['author', 'title']], [])
2186. 
2187.     def test_create_index_together(self):
2188.         """
2189.         Tests creating models with index_together already defined
2190.         """
2191.         # Create the table
2192.         with connection.schema_editor() as editor:
2193.             editor.create_model(TagIndexed)
2194.         # Ensure there is an index
2195.         self.assertIs(
2196.             any(
2197.                 c["index"]
2198.                 for c in self.get_constraints("schema_tagindexed").values()
2199.                 if c['columns'] == ["slug", "title"]
2200.             ),
2201.             True,
2202.         )
2203. 
2204.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2205.     def test_remove_index_together_does_not_remove_meta_indexes(self):
2206.         with connection.schema_editor() as editor:
2207.             editor.create_model(AuthorWithIndexedNameAndBirthday)
2208.         # Add the custom index
2209.         index = Index(fields=['name', 'birthday'], name='author_name_birthday_idx')
2210.         custom_index_name = index.name
2211.         AuthorWithIndexedNameAndBirthday._meta.indexes = [index]
2212.         with connection.schema_editor() as editor:
2213.             editor.add_index(AuthorWithIndexedNameAndBirthday, index)
2214.         # Ensure the indexes exist
2215.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2216.         self.assertIn(custom_index_name, constraints)
2217.         other_constraints = [
2218.             name for name, details in constraints.items()
2219.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2220.         ]
2221.         self.assertEqual(len(other_constraints), 1)
2222.         # Remove index together
2223.         index_together = AuthorWithIndexedNameAndBirthday._meta.index_together
2224.         with connection.schema_editor() as editor:
2225.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, index_together, [])
2226.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2227.         self.assertIn(custom_index_name, constraints)
2228.         other_constraints = [
2229.             name for name, details in constraints.items()
2230.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2231.         ]
2232.         self.assertEqual(len(other_constraints), 0)
2233.         # Re-add index together
2234.         with connection.schema_editor() as editor:
2235.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, [], index_together)
2236.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2237.         self.assertIn(custom_index_name, constraints)
2238.         other_constraints = [
2239.             name for name, details in constraints.items()
2240.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2241.         ]
2242.         self.assertEqual(len(other_constraints), 1)
2243.         # Drop the index
2244.         with connection.schema_editor() as editor:
2245.             AuthorWithIndexedNameAndBirthday._meta.indexes = []
2246.             editor.remove_index(AuthorWithIndexedNameAndBirthday, index)
2247. 
2248.     @isolate_apps('schema')
2249.     def test_db_table(self):
2250.         """
2251.         Tests renaming of the table
2252.         """
2253.         class Author(Model):
2254.             name = CharField(max_length=255)
2255. 
2256.             class Meta:
2257.                 app_label = 'schema'
2258. 
2259.         class Book(Model):
2260.             author = ForeignKey(Author, CASCADE)
2261. 
2262.             class Meta:
2263.                 app_label = 'schema'
2264. 
2265.         # Create the table and one referring it.
2266.         with connection.schema_editor() as editor:
2267.             editor.create_model(Author)
2268.             editor.create_model(Book)
2269.         # Ensure the table is there to begin with
2270.         columns = self.column_classes(Author)
2271.         self.assertEqual(columns['name'][0], "CharField")
2272.         # Alter the table
2273.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2274.             editor.alter_db_table(Author, "schema_author", "schema_otherauthor")
2275.         # Ensure the table is there afterwards
2276.         Author._meta.db_table = "schema_otherauthor"
2277.         columns = self.column_classes(Author)
2278.         self.assertEqual(columns['name'][0], "CharField")
2279.         # Ensure the foreign key reference was updated
2280.         self.assertForeignKeyExists(Book, "author_id", "schema_otherauthor")
2281.         # Alter the table again
2282.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2283.             editor.alter_db_table(Author, "schema_otherauthor", "schema_author")
2284.         # Ensure the table is still there
2285.         Author._meta.db_table = "schema_author"
2286.         columns = self.column_classes(Author)
2287.         self.assertEqual(columns['name'][0], "CharField")
2288. 
2289.     def test_add_remove_index(self):
2290.         """
2291.         Tests index addition and removal
2292.         """
2293.         # Create the table
2294.         with connection.schema_editor() as editor:
2295.             editor.create_model(Author)
2296.         # Ensure the table is there and has no index
2297.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2298.         # Add the index
2299.         index = Index(fields=['name'], name='author_title_idx')
2300.         with connection.schema_editor() as editor:
2301.             editor.add_index(Author, index)
2302.         self.assertIn('name', self.get_indexes(Author._meta.db_table))
2303.         # Drop the index
2304.         with connection.schema_editor() as editor:
2305.             editor.remove_index(Author, index)
2306.         self.assertNotIn('name', self.get_indexes(Author._meta.db_table))
2307. 
2308.     def test_remove_db_index_doesnt_remove_custom_indexes(self):
2309.         """
2310.         Changing db_index to False doesn't remove indexes from Meta.indexes.
2311.         """
2312.         with connection.schema_editor() as editor:
2313.             editor.create_model(AuthorWithIndexedName)
2314.         # Ensure the table has its index
2315.         self.assertIn('name', self.get_indexes(AuthorWithIndexedName._meta.db_table))
2316. 
2317.         # Add the custom index
2318.         index = Index(fields=['-name'], name='author_name_idx')
2319.         author_index_name = index.name
2320.         with connection.schema_editor() as editor:
2321.             db_index_name = editor._create_index_name(
2322.                 table_name=AuthorWithIndexedName._meta.db_table,
2323.                 column_names=('name',),
2324.             )
2325.         try:
2326.             AuthorWithIndexedName._meta.indexes = [index]
2327.             with connection.schema_editor() as editor:
2328.                 editor.add_index(AuthorWithIndexedName, index)
2329.             old_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2330.             self.assertIn(author_index_name, old_constraints)
2331.             self.assertIn(db_index_name, old_constraints)
2332.             # Change name field to db_index=False
2333.             old_field = AuthorWithIndexedName._meta.get_field('name')
2334.             new_field = CharField(max_length=255)
2335.             new_field.set_attributes_from_name('name')
2336.             with connection.schema_editor() as editor:
2337.                 editor.alter_field(AuthorWithIndexedName, old_field, new_field, strict=True)
2338.             new_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2339.             self.assertNotIn(db_index_name, new_constraints)
2340.             # The index from Meta.indexes is still in the database.
2341.             self.assertIn(author_index_name, new_constraints)
2342.             # Drop the index
2343.             with connection.schema_editor() as editor:
2344.                 editor.remove_index(AuthorWithIndexedName, index)
2345.         finally:
2346.             AuthorWithIndexedName._meta.indexes = []
2347. 
2348.     def test_order_index(self):
2349.         """
2350.         Indexes defined with ordering (ASC/DESC) defined on column
2351.         """
2352.         with connection.schema_editor() as editor:
2353.             editor.create_model(Author)
2354.         # The table doesn't have an index
2355.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2356.         index_name = 'author_name_idx'
2357.         # Add the index
2358.         index = Index(fields=['name', '-weight'], name=index_name)
2359.         with connection.schema_editor() as editor:
2360.             editor.add_index(Author, index)
2361.         if connection.features.supports_index_column_ordering:
2362.             self.assertIndexOrder(Author._meta.db_table, index_name, ['ASC', 'DESC'])
2363.         # Drop the index
2364.         with connection.schema_editor() as editor:
2365.             editor.remove_index(Author, index)
2366. 
2367.     def test_indexes(self):
2368.         """
2369.         Tests creation/altering of indexes
2370.         """
2371.         # Create the table
2372.         with connection.schema_editor() as editor:
2373.             editor.create_model(Author)
2374.             editor.create_model(Book)
2375.         # Ensure the table is there and has the right index
2376.         self.assertIn(
2377.             "title",
2378.             self.get_indexes(Book._meta.db_table),
2379.         )
2380.         # Alter to remove the index
2381.         old_field = Book._meta.get_field("title")
2382.         new_field = CharField(max_length=100, db_index=False)
2383.         new_field.set_attributes_from_name("title")
2384.         with connection.schema_editor() as editor:
2385.             editor.alter_field(Book, old_field, new_field, strict=True)
2386.         # Ensure the table is there and has no index
2387.         self.assertNotIn(
2388.             "title",
2389.             self.get_indexes(Book._meta.db_table),
2390.         )
2391.         # Alter to re-add the index
2392.         new_field2 = Book._meta.get_field("title")
2393.         with connection.schema_editor() as editor:
2394.             editor.alter_field(Book, new_field, new_field2, strict=True)
2395.         # Ensure the table is there and has the index again
2396.         self.assertIn(
2397.             "title",
2398.             self.get_indexes(Book._meta.db_table),
2399.         )
2400.         # Add a unique column, verify that creates an implicit index
2401.         new_field3 = BookWithSlug._meta.get_field("slug")
2402.         with connection.schema_editor() as editor:
2403.             editor.add_field(Book, new_field3)
2404.         self.assertIn(
2405.             "slug",
2406.             self.get_uniques(Book._meta.db_table),
2407.         )
2408.         # Remove the unique, check the index goes with it
2409.         new_field4 = CharField(max_length=20, unique=False)
2410.         new_field4.set_attributes_from_name("slug")
2411.         with connection.schema_editor() as editor:
2412.             editor.alter_field(BookWithSlug, new_field3, new_field4, strict=True)
2413.         self.assertNotIn(
2414.             "slug",
2415.             self.get_uniques(Book._meta.db_table),
2416.         )
2417. 
2418.     def test_text_field_with_db_index(self):
2419.         with connection.schema_editor() as editor:
2420.             editor.create_model(AuthorTextFieldWithIndex)
2421.         # The text_field index is present if the database supports it.
2422.         assertion = self.assertIn if connection.features.supports_index_on_text_field else self.assertNotIn
2423.         assertion('text_field', self.get_indexes(AuthorTextFieldWithIndex._meta.db_table))
2424. 
2425.     def test_primary_key(self):
2426.         """
2427.         Tests altering of the primary key
2428.         """
2429.         # Create the table
2430.         with connection.schema_editor() as editor:
2431.             editor.create_model(Tag)
2432.         # Ensure the table is there and has the right PK
2433.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'id')
2434.         # Alter to change the PK
2435.         id_field = Tag._meta.get_field("id")
2436.         old_field = Tag._meta.get_field("slug")
2437.         new_field = SlugField(primary_key=True)
2438.         new_field.set_attributes_from_name("slug")
2439.         new_field.model = Tag
2440.         with connection.schema_editor() as editor:
2441.             editor.remove_field(Tag, id_field)
2442.             editor.alter_field(Tag, old_field, new_field)
2443.         # Ensure the PK changed
2444.         self.assertNotIn(
2445.             'id',
2446.             self.get_indexes(Tag._meta.db_table),
2447.         )
2448.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'slug')
2449. 
2450.     def test_context_manager_exit(self):
2451.         """
2452.         Ensures transaction is correctly closed when an error occurs
2453.         inside a SchemaEditor context.
2454.         """
2455.         class SomeError(Exception):
2456.             pass
2457.         try:
2458.             with connection.schema_editor():
2459.                 raise SomeError
2460.         except SomeError:
2461.             self.assertFalse(connection.in_atomic_block)
2462. 
2463.     @skipIfDBFeature('can_rollback_ddl')
2464.     def test_unsupported_transactional_ddl_disallowed(self):
2465.         message = (
2466.             "Executing DDL statements while in a transaction on databases "
2467.             "that can't perform a rollback is prohibited."
2468.         )
2469.         with atomic(), connection.schema_editor() as editor:
2470.             with self.assertRaisesMessage(TransactionManagementError, message):
2471.                 editor.execute(editor.sql_create_table % {'table': 'foo', 'definition': ''})
2472. 
2473.     @skipUnlessDBFeature('supports_foreign_keys')
2474.     def test_foreign_key_index_long_names_regression(self):
2475.         """
2476.         Regression test for #21497.
2477.         Only affects databases that supports foreign keys.
2478.         """
2479.         # Create the table
2480.         with connection.schema_editor() as editor:
2481.             editor.create_model(AuthorWithEvenLongerName)
2482.             editor.create_model(BookWithLongName)
2483.         # Find the properly shortened column name
2484.         column_name = connection.ops.quote_name("author_foreign_key_with_really_long_field_name_id")
2485.         column_name = column_name[1:-1].lower()  # unquote, and, for Oracle, un-upcase
2486.         # Ensure the table is there and has an index on the column
2487.         self.assertIn(
2488.             column_name,
2489.             self.get_indexes(BookWithLongName._meta.db_table),
2490.         )
2491. 
2492.     @skipUnlessDBFeature('supports_foreign_keys')
2493.     def test_add_foreign_key_long_names(self):
2494.         """
2495.         Regression test for #23009.
2496.         Only affects databases that supports foreign keys.
2497.         """
2498.         # Create the initial tables
2499.         with connection.schema_editor() as editor:
2500.             editor.create_model(AuthorWithEvenLongerName)
2501.             editor.create_model(BookWithLongName)
2502.         # Add a second FK, this would fail due to long ref name before the fix
2503.         new_field = ForeignKey(AuthorWithEvenLongerName, CASCADE, related_name="something")
2504.         new_field.set_attributes_from_name("author_other_really_long_named_i_mean_so_long_fk")
2505.         with connection.schema_editor() as editor:
2506.             editor.add_field(BookWithLongName, new_field)
2507. 
2508.     @isolate_apps('schema')
2509.     @skipUnlessDBFeature('supports_foreign_keys')
2510.     def test_add_foreign_key_quoted_db_table(self):
2511.         class Author(Model):
2512.             class Meta:
2513.                 db_table = '"table_author_double_quoted"'
2514.                 app_label = 'schema'
2515. 
2516.         class Book(Model):
2517.             author = ForeignKey(Author, CASCADE)
2518. 
2519.             class Meta:
2520.                 app_label = 'schema'
2521. 
2522.         with connection.schema_editor() as editor:
2523.             editor.create_model(Author)
2524.             editor.create_model(Book)
2525.         if connection.vendor == 'mysql':
2526.             self.assertForeignKeyExists(Book, 'author_id', '"table_author_double_quoted"')
2527.         else:
2528.             self.assertForeignKeyExists(Book, 'author_id', 'table_author_double_quoted')
2529. 
2530.     def test_add_foreign_object(self):
2531.         with connection.schema_editor() as editor:
2532.             editor.create_model(BookForeignObj)
2533. 
2534.         new_field = ForeignObject(Author, on_delete=CASCADE, from_fields=['author_id'], to_fields=['id'])
2535.         new_field.set_attributes_from_name('author')
2536.         with connection.schema_editor() as editor:
2537.             editor.add_field(BookForeignObj, new_field)
2538. 
2539.     def test_creation_deletion_reserved_names(self):
2540.         """
2541.         Tries creating a model's table, and then deleting it when it has a
2542.         SQL reserved name.
2543.         """
2544.         # Create the table
2545.         with connection.schema_editor() as editor:
2546.             try:
2547.                 editor.create_model(Thing)
2548.             except OperationalError as e:
2549.                 self.fail("Errors when applying initial migration for a model "
2550.                           "with a table named after an SQL reserved word: %s" % e)
2551.         # The table is there
2552.         list(Thing.objects.all())
2553.         # Clean up that table
2554.         with connection.schema_editor() as editor:
2555.             editor.delete_model(Thing)
2556.         # The table is gone
2557.         with self.assertRaises(DatabaseError):
2558.             list(Thing.objects.all())
2559. 
2560.     def test_remove_constraints_capital_letters(self):
2561.         """
2562.         #23065 - Constraint names must be quoted if they contain capital letters.
2563.         """
2564.         def get_field(*args, field_class=IntegerField, **kwargs):
2565.             kwargs['db_column'] = "CamelCase"
2566.             field = field_class(*args, **kwargs)
2567.             field.set_attributes_from_name("CamelCase")
2568.             return field
2569. 
2570.         model = Author
2571.         field = get_field()
2572.         table = model._meta.db_table
2573.         column = field.column
2574.         identifier_converter = connection.introspection.identifier_converter
2575. 
2576.         with connection.schema_editor() as editor:
2577.             editor.create_model(model)
2578.             editor.add_field(model, field)
2579. 
2580.             constraint_name = 'CamelCaseIndex'
2581.             expected_constraint_name = identifier_converter(constraint_name)
2582.             editor.execute(
2583.                 editor.sql_create_index % {
2584.                     "table": editor.quote_name(table),
2585.                     "name": editor.quote_name(constraint_name),
2586.                     "using": "",
2587.                     "columns": editor.quote_name(column),
2588.                     "extra": "",
2589.                     "condition": "",
2590.                 }
2591.             )
2592.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2593.             editor.alter_field(model, get_field(db_index=True), field, strict=True)
2594.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2595. 
2596.             constraint_name = 'CamelCaseUniqConstraint'
2597.             expected_constraint_name = identifier_converter(constraint_name)
2598.             editor.execute(editor._create_unique_sql(model, [field.column], constraint_name))
2599.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2600.             editor.alter_field(model, get_field(unique=True), field, strict=True)
2601.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2602. 
2603.             if editor.sql_create_fk:
2604.                 constraint_name = 'CamelCaseFKConstraint'
2605.                 expected_constraint_name = identifier_converter(constraint_name)
2606.                 editor.execute(
2607.                     editor.sql_create_fk % {
2608.                         "table": editor.quote_name(table),
2609.                         "name": editor.quote_name(constraint_name),
2610.                         "column": editor.quote_name(column),
2611.                         "to_table": editor.quote_name(table),
2612.                         "to_column": editor.quote_name(model._meta.auto_field.column),
2613.                         "deferrable": connection.ops.deferrable_sql(),
2614.                     }
2615.                 )
2616.                 self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2617.                 editor.alter_field(model, get_field(Author, CASCADE, field_class=ForeignKey), field, strict=True)
2618.                 self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2619. 
2620.     def test_add_field_use_effective_default(self):
2621.         """
2622.         #23987 - effective_default() should be used as the field default when
2623.         adding a new field.
2624.         """
2625.         # Create the table
2626.         with connection.schema_editor() as editor:
2627.             editor.create_model(Author)
2628.         # Ensure there's no surname field
2629.         columns = self.column_classes(Author)
2630.         self.assertNotIn("surname", columns)
2631.         # Create a row
2632.         Author.objects.create(name='Anonymous1')
2633.         # Add new CharField to ensure default will be used from effective_default
2634.         new_field = CharField(max_length=15, blank=True)
2635.         new_field.set_attributes_from_name("surname")
2636.         with connection.schema_editor() as editor:
2637.             editor.add_field(Author, new_field)
2638.         # Ensure field was added with the right default
2639.         with connection.cursor() as cursor:
2640.             cursor.execute("SELECT surname FROM schema_author;")
2641.             item = cursor.fetchall()[0]
2642.             self.assertEqual(item[0], None if connection.features.interprets_empty_strings_as_nulls else '')
2643. 
2644.     def test_add_field_default_dropped(self):
2645.         # Create the table
2646.         with connection.schema_editor() as editor:
2647.             editor.create_model(Author)
2648.         # Ensure there's no surname field
2649.         columns = self.column_classes(Author)
2650.         self.assertNotIn("surname", columns)
2651.         # Create a row
2652.         Author.objects.create(name='Anonymous1')
2653.         # Add new CharField with a default
2654.         new_field = CharField(max_length=15, blank=True, default='surname default')
2655.         new_field.set_attributes_from_name("surname")
2656.         with connection.schema_editor() as editor:
2657.             editor.add_field(Author, new_field)
2658.         # Ensure field was added with the right default
2659.         with connection.cursor() as cursor:
2660.             cursor.execute("SELECT surname FROM schema_author;")
2661.             item = cursor.fetchall()[0]
2662.             self.assertEqual(item[0], 'surname default')
2663.             # And that the default is no longer set in the database.
2664.             field = next(
2665.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
2666.                 if f.name == "surname"
2667.             )
2668.             if connection.features.can_introspect_default:
2669.                 self.assertIsNone(field.default)
2670. 
2671.     def test_alter_field_default_dropped(self):
2672.         # Create the table
2673.         with connection.schema_editor() as editor:
2674.             editor.create_model(Author)
2675.         # Create a row
2676.         Author.objects.create(name='Anonymous1')
2677.         self.assertIsNone(Author.objects.get().height)
2678.         old_field = Author._meta.get_field('height')
2679.         # The default from the new field is used in updating existing rows.
2680.         new_field = IntegerField(blank=True, default=42)
2681.         new_field.set_attributes_from_name('height')
2682.         with connection.schema_editor() as editor:
2683.             editor.alter_field(Author, old_field, new_field, strict=True)
2684.         self.assertEqual(Author.objects.get().height, 42)
2685.         # The database default should be removed.
2686.         with connection.cursor() as cursor:
2687.             field = next(
2688.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
2689.                 if f.name == "height"
2690.             )
2691.             if connection.features.can_introspect_default:
2692.                 self.assertIsNone(field.default)
2693. 
2694.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
2695.     def test_alter_field_default_doesnt_perform_queries(self):
2696.         """
2697.         No queries are performed if a field default changes and the field's
2698.         not changing from null to non-null.
2699.         """
2700.         with connection.schema_editor() as editor:
2701.             editor.create_model(AuthorWithDefaultHeight)
2702.         old_field = AuthorWithDefaultHeight._meta.get_field('height')
2703.         new_default = old_field.default * 2
2704.         new_field = PositiveIntegerField(null=True, blank=True, default=new_default)
2705.         new_field.set_attributes_from_name('height')
2706.         with connection.schema_editor() as editor, self.assertNumQueries(0):
2707.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
2708. 
2709.     def test_add_textfield_unhashable_default(self):
2710.         # Create the table
2711.         with connection.schema_editor() as editor:
2712.             editor.create_model(Author)
2713.         # Create a row
2714.         Author.objects.create(name='Anonymous1')
2715.         # Create a field that has an unhashable default
2716.         new_field = TextField(default={})
2717.         new_field.set_attributes_from_name("info")
2718.         with connection.schema_editor() as editor:
2719.             editor.add_field(Author, new_field)
2720. 
2721.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2722.     def test_add_indexed_charfield(self):
2723.         field = CharField(max_length=255, db_index=True)
2724.         field.set_attributes_from_name('nom_de_plume')
2725.         with connection.schema_editor() as editor:
2726.             editor.create_model(Author)
2727.             editor.add_field(Author, field)
2728.         # Should create two indexes; one for like operator.
2729.         self.assertEqual(
2730.             self.get_constraints_for_column(Author, 'nom_de_plume'),
2731.             ['schema_author_nom_de_plume_7570a851', 'schema_author_nom_de_plume_7570a851_like'],
2732.         )
2733. 
2734.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2735.     def test_add_unique_charfield(self):
2736.         field = CharField(max_length=255, unique=True)
2737.         field.set_attributes_from_name('nom_de_plume')
2738.         with connection.schema_editor() as editor:
2739.             editor.create_model(Author)
2740.             editor.add_field(Author, field)
2741.         # Should create two indexes; one for like operator.
2742.         self.assertEqual(
2743.             self.get_constraints_for_column(Author, 'nom_de_plume'),
2744.             ['schema_author_nom_de_plume_7570a851_like', 'schema_author_nom_de_plume_key']
2745.         )
2746. 
2747.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2748.     def test_alter_field_add_index_to_charfield(self):
2749.         # Create the table and verify no initial indexes.
2750.         with connection.schema_editor() as editor:
2751.             editor.create_model(Author)
2752.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2753.         # Alter to add db_index=True and create 2 indexes.
2754.         old_field = Author._meta.get_field('name')
2755.         new_field = CharField(max_length=255, db_index=True)
2756.         new_field.set_attributes_from_name('name')
2757.         with connection.schema_editor() as editor:
2758.             editor.alter_field(Author, old_field, new_field, strict=True)
2759.         self.assertEqual(
2760.             self.get_constraints_for_column(Author, 'name'),
2761.             ['schema_author_name_1fbc5617', 'schema_author_name_1fbc5617_like']
2762.         )
2763.         # Remove db_index=True to drop both indexes.
2764.         with connection.schema_editor() as editor:
2765.             editor.alter_field(Author, new_field, old_field, strict=True)
2766.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2767. 
2768.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2769.     def test_alter_field_add_unique_to_charfield(self):
2770.         # Create the table and verify no initial indexes.
2771.         with connection.schema_editor() as editor:
2772.             editor.create_model(Author)
2773.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2774.         # Alter to add unique=True and create 2 indexes.
2775.         old_field = Author._meta.get_field('name')
2776.         new_field = CharField(max_length=255, unique=True)
2777.         new_field.set_attributes_from_name('name')
2778.         with connection.schema_editor() as editor:
2779.             editor.alter_field(Author, old_field, new_field, strict=True)
2780.         self.assertEqual(
2781.             self.get_constraints_for_column(Author, 'name'),
2782.             ['schema_author_name_1fbc5617_like', 'schema_author_name_1fbc5617_uniq']
2783.         )
2784.         # Remove unique=True to drop both indexes.
2785.         with connection.schema_editor() as editor:
2786.             editor.alter_field(Author, new_field, old_field, strict=True)
2787.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2788. 
2789.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2790.     def test_alter_field_add_index_to_textfield(self):
2791.         # Create the table and verify no initial indexes.
2792.         with connection.schema_editor() as editor:
2793.             editor.create_model(Note)
2794.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
2795.         # Alter to add db_index=True and create 2 indexes.
2796.         old_field = Note._meta.get_field('info')
2797.         new_field = TextField(db_index=True)
2798.         new_field.set_attributes_from_name('info')
2799.         with connection.schema_editor() as editor:
2800.             editor.alter_field(Note, old_field, new_field, strict=True)
2801.         self.assertEqual(
2802.             self.get_constraints_for_column(Note, 'info'),
2803.             ['schema_note_info_4b0ea695', 'schema_note_info_4b0ea695_like']
2804.         )
2805.         # Remove db_index=True to drop both indexes.
2806.         with connection.schema_editor() as editor:
2807.             editor.alter_field(Note, new_field, old_field, strict=True)
2808.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
2809. 
2810.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2811.     def test_alter_field_add_unique_to_charfield_with_db_index(self):
2812.         # Create the table and verify initial indexes.
2813.         with connection.schema_editor() as editor:
2814.             editor.create_model(BookWithoutAuthor)
2815.         self.assertEqual(
2816.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2817.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2818.         )
2819.         # Alter to add unique=True (should replace the index)
2820.         old_field = BookWithoutAuthor._meta.get_field('title')
2821.         new_field = CharField(max_length=100, db_index=True, unique=True)
2822.         new_field.set_attributes_from_name('title')
2823.         with connection.schema_editor() as editor:
2824.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2825.         self.assertEqual(
2826.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2827.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2828.         )
2829.         # Alter to remove unique=True (should drop unique index)
2830.         new_field2 = CharField(max_length=100, db_index=True)
2831.         new_field2.set_attributes_from_name('title')
2832.         with connection.schema_editor() as editor:
2833.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2834.         self.assertEqual(
2835.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2836.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2837.         )
2838. 
2839.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2840.     def test_alter_field_remove_unique_and_db_index_from_charfield(self):
2841.         # Create the table and verify initial indexes.
2842.         with connection.schema_editor() as editor:
2843.             editor.create_model(BookWithoutAuthor)
2844.         self.assertEqual(
2845.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2846.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2847.         )
2848.         # Alter to add unique=True (should replace the index)
2849.         old_field = BookWithoutAuthor._meta.get_field('title')
2850.         new_field = CharField(max_length=100, db_index=True, unique=True)
2851.         new_field.set_attributes_from_name('title')
2852.         with connection.schema_editor() as editor:
2853.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2854.         self.assertEqual(
2855.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2856.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2857.         )
2858.         # Alter to remove both unique=True and db_index=True (should drop all indexes)
2859.         new_field2 = CharField(max_length=100)
2860.         new_field2.set_attributes_from_name('title')
2861.         with connection.schema_editor() as editor:
2862.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2863.         self.assertEqual(self.get_constraints_for_column(BookWithoutAuthor, 'title'), [])
2864. 
2865.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2866.     def test_alter_field_swap_unique_and_db_index_with_charfield(self):
2867.         # Create the table and verify initial indexes.
2868.         with connection.schema_editor() as editor:
2869.             editor.create_model(BookWithoutAuthor)
2870.         self.assertEqual(
2871.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2872.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2873.         )
2874.         # Alter to set unique=True and remove db_index=True (should replace the index)
2875.         old_field = BookWithoutAuthor._meta.get_field('title')
2876.         new_field = CharField(max_length=100, unique=True)
2877.         new_field.set_attributes_from_name('title')
2878.         with connection.schema_editor() as editor:
2879.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2880.         self.assertEqual(
2881.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2882.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2883.         )
2884.         # Alter to set db_index=True and remove unique=True (should restore index)
2885.         new_field2 = CharField(max_length=100, db_index=True)
2886.         new_field2.set_attributes_from_name('title')
2887.         with connection.schema_editor() as editor:
2888.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2889.         self.assertEqual(
2890.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2891.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2892.         )
2893. 
2894.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2895.     def test_alter_field_add_db_index_to_charfield_with_unique(self):
2896.         # Create the table and verify initial indexes.
2897.         with connection.schema_editor() as editor:
2898.             editor.create_model(Tag)
2899.         self.assertEqual(
2900.             self.get_constraints_for_column(Tag, 'slug'),
2901.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2902.         )
2903.         # Alter to add db_index=True
2904.         old_field = Tag._meta.get_field('slug')
2905.         new_field = SlugField(db_index=True, unique=True)
2906.         new_field.set_attributes_from_name('slug')
2907.         with connection.schema_editor() as editor:
2908.             editor.alter_field(Tag, old_field, new_field, strict=True)
2909.         self.assertEqual(
2910.             self.get_constraints_for_column(Tag, 'slug'),
2911.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2912.         )
2913.         # Alter to remove db_index=True
2914.         new_field2 = SlugField(unique=True)
2915.         new_field2.set_attributes_from_name('slug')
2916.         with connection.schema_editor() as editor:
2917.             editor.alter_field(Tag, new_field, new_field2, strict=True)
2918.         self.assertEqual(
2919.             self.get_constraints_for_column(Tag, 'slug'),
2920.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2921.         )
2922. 
2923.     def test_alter_field_add_index_to_integerfield(self):
2924.         # Create the table and verify no initial indexes.
2925.         with connection.schema_editor() as editor:
2926.             editor.create_model(Author)
2927.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
2928. 
2929.         # Alter to add db_index=True and create index.
2930.         old_field = Author._meta.get_field('weight')
2931.         new_field = IntegerField(null=True, db_index=True)
2932.         new_field.set_attributes_from_name('weight')
2933.         with connection.schema_editor() as editor:
2934.             editor.alter_field(Author, old_field, new_field, strict=True)
2935.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), ['schema_author_weight_587740f9'])
2936. 
2937.         # Remove db_index=True to drop index.
2938.         with connection.schema_editor() as editor:
2939.             editor.alter_field(Author, new_field, old_field, strict=True)
2940.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
2941. 
2942.     def test_alter_pk_with_self_referential_field(self):
2943.         """
2944.         Changing the primary key field name of a model with a self-referential
2945.         foreign key (#26384).
2946.         """
2947.         with connection.schema_editor() as editor:
2948.             editor.create_model(Node)
2949.         old_field = Node._meta.get_field('node_id')
2950.         new_field = AutoField(primary_key=True)
2951.         new_field.set_attributes_from_name('id')
2952.         with connection.schema_editor() as editor:
2953.             editor.alter_field(Node, old_field, new_field, strict=True)
2954.         self.assertForeignKeyExists(Node, 'parent_id', Node._meta.db_table)
2955. 
2956.     @mock.patch('django.db.backends.base.schema.datetime')
2957.     @mock.patch('django.db.backends.base.schema.timezone')
2958.     def test_add_datefield_and_datetimefield_use_effective_default(self, mocked_datetime, mocked_tz):
2959.         """
2960.         effective_default() should be used for DateField, DateTimeField, and
2961.         TimeField if auto_now or auto_now_add is set (#25005).
2962.         """
2963.         now = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1)
2964.         now_tz = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1, tzinfo=timezone.utc)
2965.         mocked_datetime.now = mock.MagicMock(return_value=now)
2966.         mocked_tz.now = mock.MagicMock(return_value=now_tz)
2967.         # Create the table
2968.         with connection.schema_editor() as editor:
2969.             editor.create_model(Author)
2970.         # Check auto_now/auto_now_add attributes are not defined
2971.         columns = self.column_classes(Author)
2972.         self.assertNotIn("dob_auto_now", columns)
2973.         self.assertNotIn("dob_auto_now_add", columns)
2974.         self.assertNotIn("dtob_auto_now", columns)
2975.         self.assertNotIn("dtob_auto_now_add", columns)
2976.         self.assertNotIn("tob_auto_now", columns)
2977.         self.assertNotIn("tob_auto_now_add", columns)
2978.         # Create a row
2979.         Author.objects.create(name='Anonymous1')
2980.         # Ensure fields were added with the correct defaults
2981.         dob_auto_now = DateField(auto_now=True)
2982.         dob_auto_now.set_attributes_from_name('dob_auto_now')
2983.         self.check_added_field_default(
2984.             editor, Author, dob_auto_now, 'dob_auto_now', now.date(),
2985.             cast_function=lambda x: x.date(),
2986.         )
2987.         dob_auto_now_add = DateField(auto_now_add=True)
2988.         dob_auto_now_add.set_attributes_from_name('dob_auto_now_add')
2989.         self.check_added_field_default(
2990.             editor, Author, dob_auto_now_add, 'dob_auto_now_add', now.date(),
2991.             cast_function=lambda x: x.date(),
2992.         )
2993.         dtob_auto_now = DateTimeField(auto_now=True)
2994.         dtob_auto_now.set_attributes_from_name('dtob_auto_now')
2995.         self.check_added_field_default(
2996.             editor, Author, dtob_auto_now, 'dtob_auto_now', now,
2997.         )
2998.         dt_tm_of_birth_auto_now_add = DateTimeField(auto_now_add=True)
2999.         dt_tm_of_birth_auto_now_add.set_attributes_from_name('dtob_auto_now_add')
3000.         self.check_added_field_default(
3001.             editor, Author, dt_tm_of_birth_auto_now_add, 'dtob_auto_now_add', now,
3002.         )
3003.         tob_auto_now = TimeField(auto_now=True)
3004.         tob_auto_now.set_attributes_from_name('tob_auto_now')
3005.         self.check_added_field_default(
3006.             editor, Author, tob_auto_now, 'tob_auto_now', now.time(),
3007.             cast_function=lambda x: x.time(),
3008.         )
3009.         tob_auto_now_add = TimeField(auto_now_add=True)
3010.         tob_auto_now_add.set_attributes_from_name('tob_auto_now_add')
3011.         self.check_added_field_default(
3012.             editor, Author, tob_auto_now_add, 'tob_auto_now_add', now.time(),
3013.             cast_function=lambda x: x.time(),
3014.         )
3015. 
3016.     def test_namespaced_db_table_create_index_name(self):
3017.         """
3018.         Table names are stripped of their namespace/schema before being used to
3019.         generate index names.
3020.         """
3021.         with connection.schema_editor() as editor:
3022.             max_name_length = connection.ops.max_name_length() or 200
3023.             namespace = 'n' * max_name_length
3024.             table_name = 't' * max_name_length
3025.             namespaced_table_name = '"%s"."%s"' % (namespace, table_name)
3026.             self.assertEqual(
3027.                 editor._create_index_name(table_name, []),
3028.                 editor._create_index_name(namespaced_table_name, []),
3029.             )
3030. 
3031.     @unittest.skipUnless(connection.vendor == 'oracle', 'Oracle specific db_table syntax')
3032.     def test_creation_with_db_table_double_quotes(self):
3033.         oracle_user = connection.creation._test_database_user()
3034. 
3035.         class Student(Model):
3036.             name = CharField(max_length=30)
3037. 
3038.             class Meta:
3039.                 app_label = 'schema'
3040.                 apps = new_apps
3041.                 db_table = '"%s"."DJANGO_STUDENT_TABLE"' % oracle_user
3042. 
3043.         class Document(Model):
3044.             name = CharField(max_length=30)
3045.             students = ManyToManyField(Student)
3046. 
3047.             class Meta:
3048.                 app_label = 'schema'
3049.                 apps = new_apps
3050.                 db_table = '"%s"."DJANGO_DOCUMENT_TABLE"' % oracle_user
3051. 
3052.         self.local_models = [Student, Document]
3053. 
3054.         with connection.schema_editor() as editor:
3055.             editor.create_model(Student)
3056.             editor.create_model(Document)
3057. 
3058.         doc = Document.objects.create(name='Test Name')
3059.         student = Student.objects.create(name='Some man')
3060.         doc.students.add(student)
3061. 
3062.     def test_rename_table_renames_deferred_sql_references(self):
3063.         atomic_rename = connection.features.supports_atomic_references_rename
3064.         with connection.schema_editor(atomic=atomic_rename) as editor:
3065.             editor.create_model(Author)
3066.             editor.create_model(Book)
3067.             editor.alter_db_table(Author, 'schema_author', 'schema_renamed_author')
3068.             editor.alter_db_table(Author, 'schema_book', 'schema_renamed_book')
3069.             self.assertGreater(len(editor.deferred_sql), 0)
3070.             for statement in editor.deferred_sql:
3071.                 self.assertIs(statement.references_table('schema_author'), False)
3072.                 self.assertIs(statement.references_table('schema_book'), False)
3073. 
3074.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
3075.     def test_rename_column_renames_deferred_sql_references(self):
3076.         with connection.schema_editor() as editor:
3077.             editor.create_model(Author)
3078.             editor.create_model(Book)
3079.             old_title = Book._meta.get_field('title')
3080.             new_title = CharField(max_length=100, db_index=True)
3081.             new_title.set_attributes_from_name('renamed_title')
3082.             editor.alter_field(Book, old_title, new_title)
3083.             old_author = Book._meta.get_field('author')
3084.             new_author = ForeignKey(Author, CASCADE)
3085.             new_author.set_attributes_from_name('renamed_author')
3086.             editor.alter_field(Book, old_author, new_author)
3087.             self.assertGreater(len(editor.deferred_sql), 0)
3088.             for statement in editor.deferred_sql:
3089.                 self.assertIs(statement.references_column('book', 'title'), False)
3090.                 self.assertIs(statement.references_column('book', 'author_id'), False)
3091. 
3092.     @isolate_apps('schema')
3093.     def test_referenced_field_without_constraint_rename_inside_atomic_block(self):
3094.         """
3095.         Foreign keys without database level constraint don't prevent the field
3096.         they reference from being renamed in an atomic block.
3097.         """
3098.         class Foo(Model):
3099.             field = CharField(max_length=255, unique=True)
3100. 
3101.             class Meta:
3102.                 app_label = 'schema'
3103. 
3104.         class Bar(Model):
3105.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3106. 
3107.             class Meta:
3108.                 app_label = 'schema'
3109. 
3110.         self.isolated_local_models = [Foo, Bar]
3111.         with connection.schema_editor() as editor:
3112.             editor.create_model(Foo)
3113.             editor.create_model(Bar)
3114. 
3115.         new_field = CharField(max_length=255, unique=True)
3116.         new_field.set_attributes_from_name('renamed')
3117.         with connection.schema_editor(atomic=True) as editor:
3118.             editor.alter_field(Foo, Foo._meta.get_field('field'), new_field)
3119. 
3120.     @isolate_apps('schema')
3121.     def test_referenced_table_without_constraint_rename_inside_atomic_block(self):
3122.         """
3123.         Foreign keys without database level constraint don't prevent the table
3124.         they reference from being renamed in an atomic block.
3125.         """
3126.         class Foo(Model):
3127.             field = CharField(max_length=255, unique=True)
3128. 
3129.             class Meta:
3130.                 app_label = 'schema'
3131. 
3132.         class Bar(Model):
3133.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3134. 
3135.             class Meta:
3136.                 app_label = 'schema'
3137. 
3138.         self.isolated_local_models = [Foo, Bar]
3139.         with connection.schema_editor() as editor:
3140.             editor.create_model(Foo)
3141.             editor.create_model(Bar)
3142. 
3143.         new_field = CharField(max_length=255, unique=True)
3144.         new_field.set_attributes_from_name('renamed')
3145.         with connection.schema_editor(atomic=True) as editor:
3146.             editor.alter_db_table(Foo, Foo._meta.db_table, 'renamed_table')
3147.         Foo._meta.db_table = 'renamed_table'

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 18:35:50,041 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The current context contains the test procedures in `tests/schema/tests.py`, but not the definitions of the Django models that these tests operate on. The model definitions, which are located in `tests/schema/models.py`, are essential for understanding the test setup, especially the `unique_together` and `index_together` configurations that are central to the user's bug report. Without the model definitions, I cannot provide complete and self-contained test cases as requested." query='Please provide the full content of tests/schema/models.py' extra_requirements='' purpose="I need the model definitions from this file to understand the test setups and provide complete, runnable test case examples that are relevant to the user's issue."
2025-12-21 18:35:50,042 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/schema/models.py
2025-12-21 18:35:50,042 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 18:35:50,043 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 18:35:50,044 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 18:35:50,044 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/schema/models.py
Purpose: I need the model definitions from this file to understand the test setups and provide complete, runnable test case examples that are relevant to the user's issue.
2025-12-21 18:35:52,077 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/schema/models.py` to understand the model definitions for the test setups. This will allow me to create relevant and runnable test case examples.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/schema/models.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2100, 'candidates_token_count': 60, 'total_token_count': 2245, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2100}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 60}], 'thoughts_token_count': 85, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.07560935020446777, 'model_name': 'gemini-2.5-pro'} id='run--b4c5e577-6b82-4810-b273-e043064b9009-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/schema/models.py'}, 'id': '6ff83e57-8f87-48e2-bee5-a35ca77a10f4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2100, 'output_tokens': 60, 'total_tokens': 2245, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 85}}
2025-12-21 18:35:54,515 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/schema/models.py` to understand the model definitions for the test setups. This will allow me to create relevant and runnable test case examples.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 4906, 'candidates_token_count': 39, 'total_token_count': 5091, 'cached_content_token_count': 1720, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4906}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1720}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 39}], 'thoughts_token_count': 146}, 'finish_reason': 'STOP', 'avg_logprobs': -0.32168065584622896, 'model_name': 'gemini-2.5-pro'} id='run--62089046-4ee9-411a-a23c-60391d022b90-0' usage_metadata={'input_tokens': 4906, 'output_tokens': 39, 'total_tokens': 5091, 'input_token_details': {'cache_read': 1720}, 'output_token_details': {'reasoning': 146}}
2025-12-21 18:35:54,516 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/schema/models.py
--- END QUERY ---



--- BEGIN PURPOSE ---
I need the model definitions from this file to understand the test setups and provide complete, runnable test case examples that are relevant to the user's issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/schema/models.py
Line number range: 1 - 234
Content:
1. from django.apps.registry import Apps
2. from django.db import models
3. 
4. # Because we want to test creation and deletion of these as separate things,
5. # these models are all inserted into a separate Apps so the main test
6. # runner doesn't migrate them.
7. 
8. new_apps = Apps()
9. 
10. 
11. class Author(models.Model):
12.     name = models.CharField(max_length=255)
13.     height = models.PositiveIntegerField(null=True, blank=True)
14.     weight = models.IntegerField(null=True, blank=True)
15.     uuid = models.UUIDField(null=True)
16. 
17.     class Meta:
18.         apps = new_apps
19. 
20. 
21. class AuthorCharFieldWithIndex(models.Model):
22.     char_field = models.CharField(max_length=31, db_index=True)
23. 
24.     class Meta:
25.         apps = new_apps
26. 
27. 
28. class AuthorTextFieldWithIndex(models.Model):
29.     text_field = models.TextField(db_index=True)
30. 
31.     class Meta:
32.         apps = new_apps
33. 
34. 
35. class AuthorWithDefaultHeight(models.Model):
36.     name = models.CharField(max_length=255)
37.     height = models.PositiveIntegerField(null=True, blank=True, default=42)
38. 
39.     class Meta:
40.         apps = new_apps
41. 
42. 
43. class AuthorWithEvenLongerName(models.Model):
44.     name = models.CharField(max_length=255)
45.     height = models.PositiveIntegerField(null=True, blank=True)
46. 
47.     class Meta:
48.         apps = new_apps
49. 
50. 
51. class AuthorWithIndexedName(models.Model):
52.     name = models.CharField(max_length=255, db_index=True)
53. 
54.     class Meta:
55.         apps = new_apps
56. 
57. 
58. class AuthorWithUniqueName(models.Model):
59.     name = models.CharField(max_length=255, unique=True)
60. 
61.     class Meta:
62.         apps = new_apps
63. 
64. 
65. class AuthorWithIndexedNameAndBirthday(models.Model):
66.     name = models.CharField(max_length=255)
67.     birthday = models.DateField()
68. 
69.     class Meta:
70.         apps = new_apps
71.         index_together = [['name', 'birthday']]
72. 
73. 
74. class AuthorWithUniqueNameAndBirthday(models.Model):
75.     name = models.CharField(max_length=255)
76.     birthday = models.DateField()
77. 
78.     class Meta:
79.         apps = new_apps
80.         unique_together = [['name', 'birthday']]
81. 
82. 
83. class Book(models.Model):
84.     author = models.ForeignKey(Author, models.CASCADE)
85.     title = models.CharField(max_length=100, db_index=True)
86.     pub_date = models.DateTimeField()
87.     # tags = models.ManyToManyField("Tag", related_name="books")
88. 
89.     class Meta:
90.         apps = new_apps
91. 
92. 
93. class BookWeak(models.Model):
94.     author = models.ForeignKey(Author, models.CASCADE, db_constraint=False)
95.     title = models.CharField(max_length=100, db_index=True)
96.     pub_date = models.DateTimeField()
97. 
98.     class Meta:
99.         apps = new_apps
100. 
101. 
102. class BookWithLongName(models.Model):
103.     author_foreign_key_with_really_long_field_name = models.ForeignKey(
104.         AuthorWithEvenLongerName,
105.         models.CASCADE,
106.     )
107. 
108.     class Meta:
109.         apps = new_apps
110. 
111. 
112. class BookWithO2O(models.Model):
113.     author = models.OneToOneField(Author, models.CASCADE)
114.     title = models.CharField(max_length=100, db_index=True)
115.     pub_date = models.DateTimeField()
116. 
117.     class Meta:
118.         apps = new_apps
119.         db_table = "schema_book"
120. 
121. 
122. class BookWithSlug(models.Model):
123.     author = models.ForeignKey(Author, models.CASCADE)
124.     title = models.CharField(max_length=100, db_index=True)
125.     pub_date = models.DateTimeField()
126.     slug = models.CharField(max_length=20, unique=True)
127. 
128.     class Meta:
129.         apps = new_apps
130.         db_table = "schema_book"
131. 
132. 
133. class BookWithoutAuthor(models.Model):
134.     title = models.CharField(max_length=100, db_index=True)
135.     pub_date = models.DateTimeField()
136. 
137.     class Meta:
138.         apps = new_apps
139.         db_table = "schema_book"
140. 
141. 
142. class BookForeignObj(models.Model):
143.     title = models.CharField(max_length=100, db_index=True)
144.     author_id = models.IntegerField()
145. 
146.     class Meta:
147.         apps = new_apps
148. 
149. 
150. class IntegerPK(models.Model):
151.     i = models.IntegerField(primary_key=True)
152.     j = models.IntegerField(unique=True)
153. 
154.     class Meta:
155.         apps = new_apps
156.         db_table = "INTEGERPK"  # uppercase to ensure proper quoting
157. 
158. 
159. class Note(models.Model):
160.     info = models.TextField()
161. 
162.     class Meta:
163.         apps = new_apps
164. 
165. 
166. class NoteRename(models.Model):
167.     detail_info = models.TextField()
168. 
169.     class Meta:
170.         apps = new_apps
171.         db_table = "schema_note"
172. 
173. 
174. class Tag(models.Model):
175.     title = models.CharField(max_length=255)
176.     slug = models.SlugField(unique=True)
177. 
178.     class Meta:
179.         apps = new_apps
180. 
181. 
182. class TagIndexed(models.Model):
183.     title = models.CharField(max_length=255)
184.     slug = models.SlugField(unique=True)
185. 
186.     class Meta:
187.         apps = new_apps
188.         index_together = [["slug", "title"]]
189. 
190. 
191. class TagM2MTest(models.Model):
192.     title = models.CharField(max_length=255)
193.     slug = models.SlugField(unique=True)
194. 
195.     class Meta:
196.         apps = new_apps
197. 
198. 
199. class TagUniqueRename(models.Model):
200.     title = models.CharField(max_length=255)
201.     slug2 = models.SlugField(unique=True)
202. 
203.     class Meta:
204.         apps = new_apps
205.         db_table = "schema_tag"
206. 
207. 
208. # Based on tests/reserved_names/models.py
209. class Thing(models.Model):
210.     when = models.CharField(max_length=1, primary_key=True)
211. 
212.     class Meta:
213.         apps = new_apps
214.         db_table = 'drop'
215. 
216.     def __str__(self):
217.         return self.when
218. 
219. 
220. class UniqueTest(models.Model):
221.     year = models.IntegerField()
222.     slug = models.SlugField(unique=False)
223. 
224.     class Meta:
225.         apps = new_apps
226.         unique_together = ["year", "slug"]
227. 
228. 
229. class Node(models.Model):
230.     node_id = models.AutoField(primary_key=True)
231.     parent = models.ForeignKey('self', models.CASCADE, null=True, blank=True)
232. 
233.     class Meta:
234.         apps = new_apps

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 18:35:59,081 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asks for the 'full content of tests/schema/models.py'.\n2. Extended relevance:\n   - The provided context contains the entire content of the requested file, from line 1 to 234. Therefore, the whole file is relevant and necessary to fulfill the user's request.", relative_path='tests/schema/models.py', start_line=1, end_line=234)]
2025-12-21 18:35:59,082 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of tests/schema/models.py
2025-12-21 18:35:59,082 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 18:35:59,082 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 18:35:59,083 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-21 18:35:59,083 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-21 18:35:59,083 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   └── FUNDING.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── bin
|   |   └── django-admin.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── bin
|   |   |   |   └── compress.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── mn
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── memcached.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   └── __init__.py
|   |   |   ├── database.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   ├── special.py
|   |   |   |   └── utils.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   └── topics
|       ├── _images
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   └── jsi18n-mocks.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   └── commands
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       └── noargs_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── test_django_admin_py.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── default_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   └── tests.py
    ├── asgi
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_password_reset_timeout_days.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── test_base.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   └── commands
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   └── tests.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── beginning_with_slash.py
    |       ├── contains_tuple.py
    |       ├── good_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_greatest.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   |   └── fixture2.xml
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       └── custom_widget.html
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── maps
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_json.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_db_returning.py
    |   ├── test_deprecation.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   ├── test_is_ajax_deprecations.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_deprecation.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       └── index_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_if_equal.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
    |   |   ├── included_base.html
    |   |   ├── included_content.html
    |   |   ├── inclusion.html
    |   |   ├── inclusion_base.html
    |   |   ├── inclusion_extends1.html
    |   |   ├── inclusion_extends2.html
    |   |   ├── index.html
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   ├── recursive_include.html
    |   |   ├── response.html
    |   |   ├── second
    |   |   |   └── test.html
    |   |   ├── ssi include with spaces.html
    |   |   ├── ssi_include.html
    |   |   ├── template_tests
    |   |   |   └── using.html
    |   |   ├── test_context.html
    |   |   ├── test_context_stack.html
    |   |   ├── test_extends_error.html
    |   |   ├── test_incl_tag_use_l10n.html
    |   |   └── test_include_error.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   ├── bad_tag.py
    |   |   ├── custom.py
    |   |   ├── inclusion.py
    |   |   ├── subpackage
    |   |   |   ├── __init__.py
    |   |   |   └── echo.py
    |   |   ├── tag_27584.py
    |   |   └── testtags.py
    |   ├── test_base.py
    |   ├── test_callables.py
    |   ├── test_context.py
    |   ├── test_custom.py
    |   ├── test_engine.py
    |   ├── test_extends.py
    |   ├── test_extends_relative.py
    |   ├── test_library.py
    |   ├── test_loaders.py
    |   ├── test_logging.py
    |   ├── test_nodelist.py
    |   ├── test_origin.py
    |   ├── test_parser.py
    |   ├── test_response.py
    |   ├── test_smartif.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── utils.py
    |   └── views.py
    ├── templates
    |   ├── base.html
    |   ├── comments
    |   |   └── comment_notification_email.txt
    |   ├── custom_admin
    |   |   ├── add_form.html
    |   |   ├── app_index.html
    |   |   ├── change_form.html
    |   |   ├── change_list.html
    |   |   ├── delete_confirmation.html
    |   |   ├── delete_selected_confirmation.html
    |   |   ├── index.html
    |   |   ├── login.html
    |   |   ├── logout.html
    |   |   ├── object_history.html
    |   |   ├── password_change_done.html
    |   |   ├── password_change_form.html
    |   |   └── popup_response.html
    |   ├── extended.html
    |   ├── form_view.html
    |   ├── login.html
    |   └── views
    |       ├── article_archive_day.html
    |       ├── article_archive_month.html
    |       ├── article_confirm_delete.html
    |       ├── article_detail.html
    |       ├── article_form.html
    |       ├── article_list.html
    |       ├── datearticle_archive_month.html
    |       ├── urlarticle_detail.html
    |       └── urlarticle_form.html
    ├── test_client
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── test_conditional_content_removal.py
    |   ├── test_fakepayload.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_client_regress
    |   ├── __init__.py
    |   ├── auth_backends.py
    |   ├── bad_templates
    |   |   └── 404.html
    |   ├── context_processors.py
    |   ├── models.py
    |   ├── session.py
    |   ├── templates
    |   |   ├── request_context.html
    |   |   └── unicode.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── test_exceptions
    |   ├── __init__.py
    |   └── test_validation_error.py
    ├── test_runner
    |   ├── __init__.py
    |   ├── models.py
    |   ├── runner.py
    |   ├── test_debug_sql.py
    |   ├── test_discover_runner.py
    |   ├── test_parallel.py
    |   └── tests.py
    ├── test_runner_apps
    |   ├── __init__.py
    |   ├── buffer
    |   |   └── tests_buffer.py
    |   ├── databases
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   ├── sample
    |   |   ├── __init__.py
    |   |   ├── doctests.py
    |   |   ├── empty.py
    |   |   ├── pattern_tests.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests.py
    |   |   └── tests_sample.py
    |   ├── simple
    |   |   ├── __init__.py
    |   |   └── tests.py
    |   └── tagged
    |       ├── __init__.py
    |       ├── tests.py
    |       └── tests_inheritance.py
    ├── test_sqlite.py
    ├── test_utils
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── templates
    |   |   └── template_used
    |   |       ├── alternative.html
    |   |       ├── base.html
    |   |       ├── extends.html
    |   |       └── include.html
    |   ├── test_simpletestcase.py
    |   ├── test_testcase.py
    |   ├── test_transactiontestcase.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── timezones
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── transaction_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── transactions
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── unmanaged_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── update_only_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── urlpatterns
    |   ├── __init__.py
    |   ├── converter_urls.py
    |   ├── converters.py
    |   ├── included_urls.py
    |   ├── more_urls.py
    |   ├── path_base64_urls.py
    |   ├── path_dynamic_urls.py
    |   ├── path_same_name_urls.py
    |   ├── path_urls.py
    |   ├── test_resolvers.py
    |   ├── tests.py
    |   └── views.py
    ├── urlpatterns_reverse
    |   ├── __init__.py
    |   ├── erroneous_urls.py
    |   ├── extra_urls.py
    |   ├── included_app_urls.py
    |   ├── included_named_urls.py
    |   ├── included_named_urls2.py
    |   ├── included_namespace_urls.py
    |   ├── included_no_kwargs_urls.py
    |   ├── included_urls.py
    |   ├── included_urls2.py
    |   ├── method_view_urls.py
    |   ├── middleware.py
    |   ├── named_urls.py
    |   ├── named_urls_conflict.py
    |   ├── namespace_urls.py
    |   ├── nested_urls.py
    |   ├── no_urls.py
    |   ├── nonimported_module.py
    |   ├── reverse_lazy_urls.py
    |   ├── test_localeregexdescriptor.py
    |   ├── tests.py
    |   ├── translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── urlconf_inner.py
    |   ├── urlconf_outer.py
    |   ├── urls.py
    |   ├── urls_error_handlers.py
    |   ├── urls_error_handlers_callables.py
    |   ├── urls_without_handlers.py
    |   ├── utils.py
    |   ├── views.py
    |   └── views_broken.py
    ├── urls.py
    ├── user_commands
    |   ├── __init__.py
    |   ├── eggs
    |   ├── management
    |   |   └── commands
    |   |       ├── common_args.py
    |   |       ├── dance.py
    |   |       ├── hal.py
    |   |       ├── mutually_exclusive_required.py
    |   |       ├── no_translations.py
    |   |       ├── required_option.py
    |   |       ├── reverse_url.py
    |   |       ├── set_option.py
    |   |       ├── subparser.py
    |   |       ├── subparser_dest.py
    |   |       ├── subparser_required.py
    |   |       └── transaction.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── utils_tests
    |   ├── __init__.py
    |   ├── archives
    |   ├── eggs
    |   ├── files
    |   |   ├── strip_tags1.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Migration crashes deleting an index_together if there is a unique_together on the same fields

Description: Description
	
Happens with Django 1.11.10
Steps to reproduce:
1) Create models with 2 fields, add 2 same fields to unique_together and to index_together
2) Delete index_together -> Fail
It will fail at django/db/backends/base/schema.py, line 378, in _delete_composed_index(), ValueError: Found wrong number (2) of constraints for as this one will find two constraints, the _uniq and the _idx one. No way to get out of this...
The worst in my case is that happened as I wanted to refactor my code to use the "new" (Dj 1.11) Options.indexes feature. I am actually not deleting the index, just the way it is declared in my code.
I think there are 2 different points here:
1) The deletion of index_together should be possible alone or made coherent (migrations side?) with unique_together
2) Moving the declaration of an index should not result in an index re-creation

Patch information:
diff --git a/django/db/backends/base/schema.py b/django/db/backends/base/schema.py
index 61f88401ab..1f521cfc5c 100644
--- a/django/db/backends/base/schema.py
+++ b/django/db/backends/base/schema.py
@@ -393,7 +393,7 @@ class BaseDatabaseSchemaEditor:
         news = {tuple(fields) for fields in new_index_together}
         # Deleted indexes
         for fields in olds.difference(news):
-            self._delete_composed_index(model, fields, {'index': True}, self.sql_delete_index)
+            self._delete_composed_index(model, fields, {'index': True, 'unique': False}, self.sql_delete_index)
         # Created indexes
         for field_names in news.difference(olds):
             fields = [model._meta.get_field(field) for field in field_names]


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/schema/tests.py`.
Extra Requirements: 
Purpose: I need to find test cases that cover the creation and deletion of composite indexes and unique constraints to identify tests relevant to the user's bug.

Previous refined query 2:
Essential Query: Please provide the full content of tests/schema/models.py
Extra Requirements: 
Purpose: I need the model definitions from this file to understand the test setups and provide complete, runnable test case examples that are relevant to the user's issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/schema/models.py
Line number range: 1 - 234
Content:
1. from django.apps.registry import Apps
2. from django.db import models
3. 
4. # Because we want to test creation and deletion of these as separate things,
5. # these models are all inserted into a separate Apps so the main test
6. # runner doesn't migrate them.
7. 
8. new_apps = Apps()
9. 
10. 
11. class Author(models.Model):
12.     name = models.CharField(max_length=255)
13.     height = models.PositiveIntegerField(null=True, blank=True)
14.     weight = models.IntegerField(null=True, blank=True)
15.     uuid = models.UUIDField(null=True)
16. 
17.     class Meta:
18.         apps = new_apps
19. 
20. 
21. class AuthorCharFieldWithIndex(models.Model):
22.     char_field = models.CharField(max_length=31, db_index=True)
23. 
24.     class Meta:
25.         apps = new_apps
26. 
27. 
28. class AuthorTextFieldWithIndex(models.Model):
29.     text_field = models.TextField(db_index=True)
30. 
31.     class Meta:
32.         apps = new_apps
33. 
34. 
35. class AuthorWithDefaultHeight(models.Model):
36.     name = models.CharField(max_length=255)
37.     height = models.PositiveIntegerField(null=True, blank=True, default=42)
38. 
39.     class Meta:
40.         apps = new_apps
41. 
42. 
43. class AuthorWithEvenLongerName(models.Model):
44.     name = models.CharField(max_length=255)
45.     height = models.PositiveIntegerField(null=True, blank=True)
46. 
47.     class Meta:
48.         apps = new_apps
49. 
50. 
51. class AuthorWithIndexedName(models.Model):
52.     name = models.CharField(max_length=255, db_index=True)
53. 
54.     class Meta:
55.         apps = new_apps
56. 
57. 
58. class AuthorWithUniqueName(models.Model):
59.     name = models.CharField(max_length=255, unique=True)
60. 
61.     class Meta:
62.         apps = new_apps
63. 
64. 
65. class AuthorWithIndexedNameAndBirthday(models.Model):
66.     name = models.CharField(max_length=255)
67.     birthday = models.DateField()
68. 
69.     class Meta:
70.         apps = new_apps
71.         index_together = [['name', 'birthday']]
72. 
73. 
74. class AuthorWithUniqueNameAndBirthday(models.Model):
75.     name = models.CharField(max_length=255)
76.     birthday = models.DateField()
77. 
78.     class Meta:
79.         apps = new_apps
80.         unique_together = [['name', 'birthday']]
81. 
82. 
83. class Book(models.Model):
84.     author = models.ForeignKey(Author, models.CASCADE)
85.     title = models.CharField(max_length=100, db_index=True)
86.     pub_date = models.DateTimeField()
87.     # tags = models.ManyToManyField("Tag", related_name="books")
88. 
89.     class Meta:
90.         apps = new_apps
91. 
92. 
93. class BookWeak(models.Model):
94.     author = models.ForeignKey(Author, models.CASCADE, db_constraint=False)
95.     title = models.CharField(max_length=100, db_index=True)
96.     pub_date = models.DateTimeField()
97. 
98.     class Meta:
99.         apps = new_apps
100. 
101. 
102. class BookWithLongName(models.Model):
103.     author_foreign_key_with_really_long_field_name = models.ForeignKey(
104.         AuthorWithEvenLongerName,
105.         models.CASCADE,
106.     )
107. 
108.     class Meta:
109.         apps = new_apps
110. 
111. 
112. class BookWithO2O(models.Model):
113.     author = models.OneToOneField(Author, models.CASCADE)
114.     title = models.CharField(max_length=100, db_index=True)
115.     pub_date = models.DateTimeField()
116. 
117.     class Meta:
118.         apps = new_apps
119.         db_table = "schema_book"
120. 
121. 
122. class BookWithSlug(models.Model):
123.     author = models.ForeignKey(Author, models.CASCADE)
124.     title = models.CharField(max_length=100, db_index=True)
125.     pub_date = models.DateTimeField()
126.     slug = models.CharField(max_length=20, unique=True)
127. 
128.     class Meta:
129.         apps = new_apps
130.         db_table = "schema_book"
131. 
132. 
133. class BookWithoutAuthor(models.Model):
134.     title = models.CharField(max_length=100, db_index=True)
135.     pub_date = models.DateTimeField()
136. 
137.     class Meta:
138.         apps = new_apps
139.         db_table = "schema_book"
140. 
141. 
142. class BookForeignObj(models.Model):
143.     title = models.CharField(max_length=100, db_index=True)
144.     author_id = models.IntegerField()
145. 
146.     class Meta:
147.         apps = new_apps
148. 
149. 
150. class IntegerPK(models.Model):
151.     i = models.IntegerField(primary_key=True)
152.     j = models.IntegerField(unique=True)
153. 
154.     class Meta:
155.         apps = new_apps
156.         db_table = "INTEGERPK"  # uppercase to ensure proper quoting
157. 
158. 
159. class Note(models.Model):
160.     info = models.TextField()
161. 
162.     class Meta:
163.         apps = new_apps
164. 
165. 
166. class NoteRename(models.Model):
167.     detail_info = models.TextField()
168. 
169.     class Meta:
170.         apps = new_apps
171.         db_table = "schema_note"
172. 
173. 
174. class Tag(models.Model):
175.     title = models.CharField(max_length=255)
176.     slug = models.SlugField(unique=True)
177. 
178.     class Meta:
179.         apps = new_apps
180. 
181. 
182. class TagIndexed(models.Model):
183.     title = models.CharField(max_length=255)
184.     slug = models.SlugField(unique=True)
185. 
186.     class Meta:
187.         apps = new_apps
188.         index_together = [["slug", "title"]]
189. 
190. 
191. class TagM2MTest(models.Model):
192.     title = models.CharField(max_length=255)
193.     slug = models.SlugField(unique=True)
194. 
195.     class Meta:
196.         apps = new_apps
197. 
198. 
199. class TagUniqueRename(models.Model):
200.     title = models.CharField(max_length=255)
201.     slug2 = models.SlugField(unique=True)
202. 
203.     class Meta:
204.         apps = new_apps
205.         db_table = "schema_tag"
206. 
207. 
208. # Based on tests/reserved_names/models.py
209. class Thing(models.Model):
210.     when = models.CharField(max_length=1, primary_key=True)
211. 
212.     class Meta:
213.         apps = new_apps
214.         db_table = 'drop'
215. 
216.     def __str__(self):
217.         return self.when
218. 
219. 
220. class UniqueTest(models.Model):
221.     year = models.IntegerField()
222.     slug = models.SlugField(unique=False)
223. 
224.     class Meta:
225.         apps = new_apps
226.         unique_together = ["year", "slug"]
227. 
228. 
229. class Node(models.Model):
230.     node_id = models.AutoField(primary_key=True)
231.     parent = models.ForeignKey('self', models.CASCADE, null=True, blank=True)
232. 
233.     class Meta:
234.         apps = new_apps


File: tests/schema/tests.py
Line number range: 1 - 3147
Content:
1. import datetime
2. import itertools
3. import unittest
4. from copy import copy
5. from unittest import mock
6. 
7. from django.core.management.color import no_style
8. from django.db import (
9.     DatabaseError, DataError, IntegrityError, OperationalError, connection,
10. )
11. from django.db.models import (
12.     CASCADE, PROTECT, AutoField, BigAutoField, BigIntegerField, BinaryField,
13.     BooleanField, CharField, CheckConstraint, DateField, DateTimeField,
14.     ForeignKey, ForeignObject, Index, IntegerField, ManyToManyField, Model,
15.     OneToOneField, PositiveIntegerField, Q, SlugField, SmallAutoField,
16.     SmallIntegerField, TextField, TimeField, UniqueConstraint, UUIDField,
17. )
18. from django.db.transaction import TransactionManagementError, atomic
19. from django.test import (
20.     TransactionTestCase, skipIfDBFeature, skipUnlessDBFeature,
21. )
22. from django.test.utils import CaptureQueriesContext, isolate_apps
23. from django.utils import timezone
24. 
25. from .fields import (
26.     CustomManyToManyField, InheritedManyToManyField, MediumBlobField,
27. )
28. from .models import (
29.     Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
30.     AuthorWithDefaultHeight, AuthorWithEvenLongerName, AuthorWithIndexedName,
31.     AuthorWithIndexedNameAndBirthday, AuthorWithUniqueName,
32.     AuthorWithUniqueNameAndBirthday, Book, BookForeignObj, BookWeak,
33.     BookWithLongName, BookWithO2O, BookWithoutAuthor, BookWithSlug, IntegerPK,
34.     Node, Note, NoteRename, Tag, TagIndexed, TagM2MTest, TagUniqueRename,
35.     Thing, UniqueTest, new_apps,
36. )
37. 
38. 
39. class SchemaTests(TransactionTestCase):
40.     """
41.     Tests for the schema-alteration code.
42. 
43.     Be aware that these tests are more liable than most to false results,
44.     as sometimes the code to check if a test has worked is almost as complex
45.     as the code it is testing.
46.     """
47. 
48.     available_apps = []
49. 
50.     models = [
51.         Author, AuthorCharFieldWithIndex, AuthorTextFieldWithIndex,
52.         AuthorWithDefaultHeight, AuthorWithEvenLongerName, Book, BookWeak,
53.         BookWithLongName, BookWithO2O, BookWithSlug, IntegerPK, Node, Note,
54.         Tag, TagIndexed, TagM2MTest, TagUniqueRename, Thing, UniqueTest,
55.     ]
56. 
57.     # Utility functions
58. 
59.     def setUp(self):
60.         # local_models should contain test dependent model classes that will be
61.         # automatically removed from the app cache on test tear down.
62.         self.local_models = []
63.         # isolated_local_models contains models that are in test methods
64.         # decorated with @isolate_apps.
65.         self.isolated_local_models = []
66. 
67.     def tearDown(self):
68.         # Delete any tables made for our models
69.         self.delete_tables()
70.         new_apps.clear_cache()
71.         for model in new_apps.get_models():
72.             model._meta._expire_cache()
73.         if 'schema' in new_apps.all_models:
74.             for model in self.local_models:
75.                 for many_to_many in model._meta.many_to_many:
76.                     through = many_to_many.remote_field.through
77.                     if through and through._meta.auto_created:
78.                         del new_apps.all_models['schema'][through._meta.model_name]
79.                 del new_apps.all_models['schema'][model._meta.model_name]
80.         if self.isolated_local_models:
81.             with connection.schema_editor() as editor:
82.                 for model in self.isolated_local_models:
83.                     editor.delete_model(model)
84. 
85.     def delete_tables(self):
86.         "Deletes all model tables for our models for a clean test environment"
87.         converter = connection.introspection.identifier_converter
88.         with connection.schema_editor() as editor:
89.             connection.disable_constraint_checking()
90.             table_names = connection.introspection.table_names()
91.             for model in itertools.chain(SchemaTests.models, self.local_models):
92.                 tbl = converter(model._meta.db_table)
93.                 if tbl in table_names:
94.                     editor.delete_model(model)
95.                     table_names.remove(tbl)
96.             connection.enable_constraint_checking()
97. 
98.     def column_classes(self, model):
99.         with connection.cursor() as cursor:
100.             columns = {
101.                 d[0]: (connection.introspection.get_field_type(d[1], d), d)
102.                 for d in connection.introspection.get_table_description(
103.                     cursor,
104.                     model._meta.db_table,
105.                 )
106.             }
107.         # SQLite has a different format for field_type
108.         for name, (type, desc) in columns.items():
109.             if isinstance(type, tuple):
110.                 columns[name] = (type[0], desc)
111.         # SQLite also doesn't error properly
112.         if not columns:
113.             raise DatabaseError("Table does not exist (empty pragma)")
114.         return columns
115. 
116.     def get_primary_key(self, table):
117.         with connection.cursor() as cursor:
118.             return connection.introspection.get_primary_key_column(cursor, table)
119. 
120.     def get_indexes(self, table):
121.         """
122.         Get the indexes on the table using a new cursor.
123.         """
124.         with connection.cursor() as cursor:
125.             return [
126.                 c['columns'][0]
127.                 for c in connection.introspection.get_constraints(cursor, table).values()
128.                 if c['index'] and len(c['columns']) == 1
129.             ]
130. 
131.     def get_uniques(self, table):
132.         with connection.cursor() as cursor:
133.             return [
134.                 c['columns'][0]
135.                 for c in connection.introspection.get_constraints(cursor, table).values()
136.                 if c['unique'] and len(c['columns']) == 1
137.             ]
138. 
139.     def get_constraints(self, table):
140.         """
141.         Get the constraints on a table using a new cursor.
142.         """
143.         with connection.cursor() as cursor:
144.             return connection.introspection.get_constraints(cursor, table)
145. 
146.     def get_constraints_for_column(self, model, column_name):
147.         constraints = self.get_constraints(model._meta.db_table)
148.         constraints_for_column = []
149.         for name, details in constraints.items():
150.             if details['columns'] == [column_name]:
151.                 constraints_for_column.append(name)
152.         return sorted(constraints_for_column)
153. 
154.     def check_added_field_default(self, schema_editor, model, field, field_name, expected_default,
155.                                   cast_function=None):
156.         with connection.cursor() as cursor:
157.             schema_editor.add_field(model, field)
158.             cursor.execute("SELECT {} FROM {};".format(field_name, model._meta.db_table))
159.             database_default = cursor.fetchall()[0][0]
160.             if cast_function and not type(database_default) == type(expected_default):
161.                 database_default = cast_function(database_default)
162.             self.assertEqual(database_default, expected_default)
163. 
164.     def get_constraints_count(self, table, column, fk_to):
165.         """
166.         Return a dict with keys 'fks', 'uniques, and 'indexes' indicating the
167.         number of foreign keys, unique constraints, and indexes on
168.         `table`.`column`. The `fk_to` argument is a 2-tuple specifying the
169.         expected foreign key relationship's (table, column).
170.         """
171.         with connection.cursor() as cursor:
172.             constraints = connection.introspection.get_constraints(cursor, table)
173.         counts = {'fks': 0, 'uniques': 0, 'indexes': 0}
174.         for c in constraints.values():
175.             if c['columns'] == [column]:
176.                 if c['foreign_key'] == fk_to:
177.                     counts['fks'] += 1
178.                 if c['unique']:
179.                     counts['uniques'] += 1
180.                 elif c['index']:
181.                     counts['indexes'] += 1
182.         return counts
183. 
184.     def assertIndexOrder(self, table, index, order):
185.         constraints = self.get_constraints(table)
186.         self.assertIn(index, constraints)
187.         index_orders = constraints[index]['orders']
188.         self.assertTrue(all(val == expected for val, expected in zip(index_orders, order)))
189. 
190.     def assertForeignKeyExists(self, model, column, expected_fk_table, field='id'):
191.         """
192.         Fail if the FK constraint on `model.Meta.db_table`.`column` to
193.         `expected_fk_table`.id doesn't exist.
194.         """
195.         constraints = self.get_constraints(model._meta.db_table)
196.         constraint_fk = None
197.         for details in constraints.values():
198.             if details['columns'] == [column] and details['foreign_key']:
199.                 constraint_fk = details['foreign_key']
200.                 break
201.         self.assertEqual(constraint_fk, (expected_fk_table, field))
202. 
203.     def assertForeignKeyNotExists(self, model, column, expected_fk_table):
204.         with self.assertRaises(AssertionError):
205.             self.assertForeignKeyExists(model, column, expected_fk_table)
206. 
207.     # Tests
208.     def test_creation_deletion(self):
209.         """
210.         Tries creating a model's table, and then deleting it.
211.         """
212.         with connection.schema_editor() as editor:
213.             # Create the table
214.             editor.create_model(Author)
215.             # The table is there
216.             list(Author.objects.all())
217.             # Clean up that table
218.             editor.delete_model(Author)
219.             # No deferred SQL should be left over.
220.             self.assertEqual(editor.deferred_sql, [])
221.         # The table is gone
222.         with self.assertRaises(DatabaseError):
223.             list(Author.objects.all())
224. 
225.     @skipUnlessDBFeature('supports_foreign_keys')
226.     def test_fk(self):
227.         "Creating tables out of FK order, then repointing, works"
228.         # Create the table
229.         with connection.schema_editor() as editor:
230.             editor.create_model(Book)
231.             editor.create_model(Author)
232.             editor.create_model(Tag)
233.         # Initial tables are there
234.         list(Author.objects.all())
235.         list(Book.objects.all())
236.         # Make sure the FK constraint is present
237.         with self.assertRaises(IntegrityError):
238.             Book.objects.create(
239.                 author_id=1,
240.                 title="Much Ado About Foreign Keys",
241.                 pub_date=datetime.datetime.now(),
242.             )
243.         # Repoint the FK constraint
244.         old_field = Book._meta.get_field("author")
245.         new_field = ForeignKey(Tag, CASCADE)
246.         new_field.set_attributes_from_name("author")
247.         with connection.schema_editor() as editor:
248.             editor.alter_field(Book, old_field, new_field, strict=True)
249.         self.assertForeignKeyExists(Book, 'author_id', 'schema_tag')
250. 
251.     @skipUnlessDBFeature('can_create_inline_fk')
252.     def test_inline_fk(self):
253.         # Create some tables.
254.         with connection.schema_editor() as editor:
255.             editor.create_model(Author)
256.             editor.create_model(Book)
257.             editor.create_model(Note)
258.         self.assertForeignKeyNotExists(Note, 'book_id', 'schema_book')
259.         # Add a foreign key from one to the other.
260.         with connection.schema_editor() as editor:
261.             new_field = ForeignKey(Book, CASCADE)
262.             new_field.set_attributes_from_name('book')
263.             editor.add_field(Note, new_field)
264.         self.assertForeignKeyExists(Note, 'book_id', 'schema_book')
265.         # Creating a FK field with a constraint uses a single statement without
266.         # a deferred ALTER TABLE.
267.         self.assertFalse([
268.             sql for sql in (str(statement) for statement in editor.deferred_sql)
269.             if sql.startswith('ALTER TABLE') and 'ADD CONSTRAINT' in sql
270.         ])
271. 
272.     @skipUnlessDBFeature('can_create_inline_fk')
273.     def test_add_inline_fk_update_data(self):
274.         with connection.schema_editor() as editor:
275.             editor.create_model(Node)
276.         # Add an inline foreign key and update data in the same transaction.
277.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
278.         new_field.set_attributes_from_name('new_parent_fk')
279.         parent = Node.objects.create()
280.         with connection.schema_editor() as editor:
281.             editor.add_field(Node, new_field)
282.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
283.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
284. 
285.     @skipUnlessDBFeature(
286.         'can_create_inline_fk',
287.         'allows_multiple_constraints_on_same_fields',
288.     )
289.     @isolate_apps('schema')
290.     def test_add_inline_fk_index_update_data(self):
291.         class Node(Model):
292.             class Meta:
293.                 app_label = 'schema'
294. 
295.         with connection.schema_editor() as editor:
296.             editor.create_model(Node)
297.         # Add an inline foreign key, update data, and an index in the same
298.         # transaction.
299.         new_field = ForeignKey(Node, CASCADE, related_name='new_fk', null=True)
300.         new_field.set_attributes_from_name('new_parent_fk')
301.         parent = Node.objects.create()
302.         with connection.schema_editor() as editor:
303.             editor.add_field(Node, new_field)
304.             Node._meta.add_field(new_field)
305.             editor.execute('UPDATE schema_node SET new_parent_fk_id = %s;', [parent.pk])
306.             editor.add_index(Node, Index(fields=['new_parent_fk'], name='new_parent_inline_fk_idx'))
307.         self.assertIn('new_parent_fk_id', self.get_indexes(Node._meta.db_table))
308. 
309.     @skipUnlessDBFeature('supports_foreign_keys')
310.     def test_char_field_with_db_index_to_fk(self):
311.         # Create the table
312.         with connection.schema_editor() as editor:
313.             editor.create_model(Author)
314.             editor.create_model(AuthorCharFieldWithIndex)
315.         # Change CharField to FK
316.         old_field = AuthorCharFieldWithIndex._meta.get_field('char_field')
317.         new_field = ForeignKey(Author, CASCADE, blank=True)
318.         new_field.set_attributes_from_name('char_field')
319.         with connection.schema_editor() as editor:
320.             editor.alter_field(AuthorCharFieldWithIndex, old_field, new_field, strict=True)
321.         self.assertForeignKeyExists(AuthorCharFieldWithIndex, 'char_field_id', 'schema_author')
322. 
323.     @skipUnlessDBFeature('supports_foreign_keys')
324.     @skipUnlessDBFeature('supports_index_on_text_field')
325.     def test_text_field_with_db_index_to_fk(self):
326.         # Create the table
327.         with connection.schema_editor() as editor:
328.             editor.create_model(Author)
329.             editor.create_model(AuthorTextFieldWithIndex)
330.         # Change TextField to FK
331.         old_field = AuthorTextFieldWithIndex._meta.get_field('text_field')
332.         new_field = ForeignKey(Author, CASCADE, blank=True)
333.         new_field.set_attributes_from_name('text_field')
334.         with connection.schema_editor() as editor:
335.             editor.alter_field(AuthorTextFieldWithIndex, old_field, new_field, strict=True)
336.         self.assertForeignKeyExists(AuthorTextFieldWithIndex, 'text_field_id', 'schema_author')
337. 
338.     @isolate_apps('schema')
339.     def test_char_field_pk_to_auto_field(self):
340.         class Foo(Model):
341.             id = CharField(max_length=255, primary_key=True)
342. 
343.             class Meta:
344.                 app_label = 'schema'
345. 
346.         with connection.schema_editor() as editor:
347.             editor.create_model(Foo)
348.         self.isolated_local_models = [Foo]
349.         old_field = Foo._meta.get_field('id')
350.         new_field = AutoField(primary_key=True)
351.         new_field.set_attributes_from_name('id')
352.         new_field.model = Foo
353.         with connection.schema_editor() as editor:
354.             editor.alter_field(Foo, old_field, new_field, strict=True)
355. 
356.     @skipUnlessDBFeature('supports_foreign_keys')
357.     def test_fk_to_proxy(self):
358.         "Creating a FK to a proxy model creates database constraints."
359.         class AuthorProxy(Author):
360.             class Meta:
361.                 app_label = 'schema'
362.                 apps = new_apps
363.                 proxy = True
364. 
365.         class AuthorRef(Model):
366.             author = ForeignKey(AuthorProxy, on_delete=CASCADE)
367. 
368.             class Meta:
369.                 app_label = 'schema'
370.                 apps = new_apps
371. 
372.         self.local_models = [AuthorProxy, AuthorRef]
373. 
374.         # Create the table
375.         with connection.schema_editor() as editor:
376.             editor.create_model(Author)
377.             editor.create_model(AuthorRef)
378.         self.assertForeignKeyExists(AuthorRef, 'author_id', 'schema_author')
379. 
380.     @skipUnlessDBFeature('supports_foreign_keys')
381.     def test_fk_db_constraint(self):
382.         "The db_constraint parameter is respected"
383.         # Create the table
384.         with connection.schema_editor() as editor:
385.             editor.create_model(Tag)
386.             editor.create_model(Author)
387.             editor.create_model(BookWeak)
388.         # Initial tables are there
389.         list(Author.objects.all())
390.         list(Tag.objects.all())
391.         list(BookWeak.objects.all())
392.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
393.         # Make a db_constraint=False FK
394.         new_field = ForeignKey(Tag, CASCADE, db_constraint=False)
395.         new_field.set_attributes_from_name("tag")
396.         with connection.schema_editor() as editor:
397.             editor.add_field(Author, new_field)
398.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
399.         # Alter to one with a constraint
400.         new_field2 = ForeignKey(Tag, CASCADE)
401.         new_field2.set_attributes_from_name("tag")
402.         with connection.schema_editor() as editor:
403.             editor.alter_field(Author, new_field, new_field2, strict=True)
404.         self.assertForeignKeyExists(Author, 'tag_id', 'schema_tag')
405.         # Alter to one without a constraint again
406.         new_field2 = ForeignKey(Tag, CASCADE)
407.         new_field2.set_attributes_from_name("tag")
408.         with connection.schema_editor() as editor:
409.             editor.alter_field(Author, new_field2, new_field, strict=True)
410.         self.assertForeignKeyNotExists(Author, 'tag_id', 'schema_tag')
411. 
412.     @isolate_apps('schema')
413.     def test_no_db_constraint_added_during_primary_key_change(self):
414.         """
415.         When a primary key that's pointed to by a ForeignKey with
416.         db_constraint=False is altered, a foreign key constraint isn't added.
417.         """
418.         class Author(Model):
419.             class Meta:
420.                 app_label = 'schema'
421. 
422.         class BookWeak(Model):
423.             author = ForeignKey(Author, CASCADE, db_constraint=False)
424. 
425.             class Meta:
426.                 app_label = 'schema'
427. 
428.         with connection.schema_editor() as editor:
429.             editor.create_model(Author)
430.             editor.create_model(BookWeak)
431.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
432.         old_field = Author._meta.get_field('id')
433.         new_field = BigAutoField(primary_key=True)
434.         new_field.model = Author
435.         new_field.set_attributes_from_name('id')
436.         # @isolate_apps() and inner models are needed to have the model
437.         # relations populated, otherwise this doesn't act as a regression test.
438.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
439.         with connection.schema_editor() as editor:
440.             editor.alter_field(Author, old_field, new_field, strict=True)
441.         self.assertForeignKeyNotExists(BookWeak, 'author_id', 'schema_author')
442. 
443.     def _test_m2m_db_constraint(self, M2MFieldClass):
444.         class LocalAuthorWithM2M(Model):
445.             name = CharField(max_length=255)
446. 
447.             class Meta:
448.                 app_label = 'schema'
449.                 apps = new_apps
450. 
451.         self.local_models = [LocalAuthorWithM2M]
452. 
453.         # Create the table
454.         with connection.schema_editor() as editor:
455.             editor.create_model(Tag)
456.             editor.create_model(LocalAuthorWithM2M)
457.         # Initial tables are there
458.         list(LocalAuthorWithM2M.objects.all())
459.         list(Tag.objects.all())
460.         # Make a db_constraint=False FK
461.         new_field = M2MFieldClass(Tag, related_name="authors", db_constraint=False)
462.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
463.         # Add the field
464.         with connection.schema_editor() as editor:
465.             editor.add_field(LocalAuthorWithM2M, new_field)
466.         self.assertForeignKeyNotExists(new_field.remote_field.through, 'tag_id', 'schema_tag')
467. 
468.     @skipUnlessDBFeature('supports_foreign_keys')
469.     def test_m2m_db_constraint(self):
470.         self._test_m2m_db_constraint(ManyToManyField)
471. 
472.     @skipUnlessDBFeature('supports_foreign_keys')
473.     def test_m2m_db_constraint_custom(self):
474.         self._test_m2m_db_constraint(CustomManyToManyField)
475. 
476.     @skipUnlessDBFeature('supports_foreign_keys')
477.     def test_m2m_db_constraint_inherited(self):
478.         self._test_m2m_db_constraint(InheritedManyToManyField)
479. 
480.     def test_add_field(self):
481.         """
482.         Tests adding fields to models
483.         """
484.         # Create the table
485.         with connection.schema_editor() as editor:
486.             editor.create_model(Author)
487.         # Ensure there's no age field
488.         columns = self.column_classes(Author)
489.         self.assertNotIn("age", columns)
490.         # Add the new field
491.         new_field = IntegerField(null=True)
492.         new_field.set_attributes_from_name("age")
493.         with CaptureQueriesContext(connection) as ctx, connection.schema_editor() as editor:
494.             editor.add_field(Author, new_field)
495.         drop_default_sql = editor.sql_alter_column_no_default % {
496.             'column': editor.quote_name(new_field.name),
497.         }
498.         self.assertFalse(any(drop_default_sql in query['sql'] for query in ctx.captured_queries))
499.         # Ensure the field is right afterwards
500.         columns = self.column_classes(Author)
501.         self.assertEqual(columns['age'][0], "IntegerField")
502.         self.assertTrue(columns['age'][1][6])
503. 
504.     def test_add_field_remove_field(self):
505.         """
506.         Adding a field and removing it removes all deferred sql referring to it.
507.         """
508.         with connection.schema_editor() as editor:
509.             # Create a table with a unique constraint on the slug field.
510.             editor.create_model(Tag)
511.             # Remove the slug column.
512.             editor.remove_field(Tag, Tag._meta.get_field('slug'))
513.         self.assertEqual(editor.deferred_sql, [])
514. 
515.     def test_add_field_temp_default(self):
516.         """
517.         Tests adding fields to models with a temporary default
518.         """
519.         # Create the table
520.         with connection.schema_editor() as editor:
521.             editor.create_model(Author)
522.         # Ensure there's no age field
523.         columns = self.column_classes(Author)
524.         self.assertNotIn("age", columns)
525.         # Add some rows of data
526.         Author.objects.create(name="Andrew", height=30)
527.         Author.objects.create(name="Andrea")
528.         # Add a not-null field
529.         new_field = CharField(max_length=30, default="Godwin")
530.         new_field.set_attributes_from_name("surname")
531.         with connection.schema_editor() as editor:
532.             editor.add_field(Author, new_field)
533.         # Ensure the field is right afterwards
534.         columns = self.column_classes(Author)
535.         self.assertEqual(columns['surname'][0], "CharField")
536.         self.assertEqual(columns['surname'][1][6],
537.                          connection.features.interprets_empty_strings_as_nulls)
538. 
539.     def test_add_field_temp_default_boolean(self):
540.         """
541.         Tests adding fields to models with a temporary default where
542.         the default is False. (#21783)
543.         """
544.         # Create the table
545.         with connection.schema_editor() as editor:
546.             editor.create_model(Author)
547.         # Ensure there's no age field
548.         columns = self.column_classes(Author)
549.         self.assertNotIn("age", columns)
550.         # Add some rows of data
551.         Author.objects.create(name="Andrew", height=30)
552.         Author.objects.create(name="Andrea")
553.         # Add a not-null field
554.         new_field = BooleanField(default=False)
555.         new_field.set_attributes_from_name("awesome")
556.         with connection.schema_editor() as editor:
557.             editor.add_field(Author, new_field)
558.         # Ensure the field is right afterwards
559.         columns = self.column_classes(Author)
560.         # BooleanField are stored as TINYINT(1) on MySQL.
561.         field_type = columns['awesome'][0]
562.         self.assertEqual(field_type, connection.features.introspected_boolean_field_type)
563. 
564.     def test_add_field_default_transform(self):
565.         """
566.         Tests adding fields to models with a default that is not directly
567.         valid in the database (#22581)
568.         """
569. 
570.         class TestTransformField(IntegerField):
571. 
572.             # Weird field that saves the count of items in its value
573.             def get_default(self):
574.                 return self.default
575. 
576.             def get_prep_value(self, value):
577.                 if value is None:
578.                     return 0
579.                 return len(value)
580. 
581.         # Create the table
582.         with connection.schema_editor() as editor:
583.             editor.create_model(Author)
584.         # Add some rows of data
585.         Author.objects.create(name="Andrew", height=30)
586.         Author.objects.create(name="Andrea")
587.         # Add the field with a default it needs to cast (to string in this case)
588.         new_field = TestTransformField(default={1: 2})
589.         new_field.set_attributes_from_name("thing")
590.         with connection.schema_editor() as editor:
591.             editor.add_field(Author, new_field)
592.         # Ensure the field is there
593.         columns = self.column_classes(Author)
594.         field_type, field_info = columns['thing']
595.         self.assertEqual(field_type, 'IntegerField')
596.         # Make sure the values were transformed correctly
597.         self.assertEqual(Author.objects.extra(where=["thing = 1"]).count(), 2)
598. 
599.     def test_add_field_binary(self):
600.         """
601.         Tests binary fields get a sane default (#22851)
602.         """
603.         # Create the table
604.         with connection.schema_editor() as editor:
605.             editor.create_model(Author)
606.         # Add the new field
607.         new_field = BinaryField(blank=True)
608.         new_field.set_attributes_from_name("bits")
609.         with connection.schema_editor() as editor:
610.             editor.add_field(Author, new_field)
611.         # Ensure the field is right afterwards
612.         columns = self.column_classes(Author)
613.         # MySQL annoyingly uses the same backend, so it'll come back as one of
614.         # these two types.
615.         self.assertIn(columns['bits'][0], ("BinaryField", "TextField"))
616. 
617.     @unittest.skipUnless(connection.vendor == 'mysql', "MySQL specific")
618.     def test_add_binaryfield_mediumblob(self):
619.         """
620.         Test adding a custom-sized binary field on MySQL (#24846).
621.         """
622.         # Create the table
623.         with connection.schema_editor() as editor:
624.             editor.create_model(Author)
625.         # Add the new field with default
626.         new_field = MediumBlobField(blank=True, default=b'123')
627.         new_field.set_attributes_from_name('bits')
628.         with connection.schema_editor() as editor:
629.             editor.add_field(Author, new_field)
630.         columns = self.column_classes(Author)
631.         # Introspection treats BLOBs as TextFields
632.         self.assertEqual(columns['bits'][0], "TextField")
633. 
634.     def test_alter(self):
635.         """
636.         Tests simple altering of fields
637.         """
638.         # Create the table
639.         with connection.schema_editor() as editor:
640.             editor.create_model(Author)
641.         # Ensure the field is right to begin with
642.         columns = self.column_classes(Author)
643.         self.assertEqual(columns['name'][0], "CharField")
644.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
645.         # Alter the name field to a TextField
646.         old_field = Author._meta.get_field("name")
647.         new_field = TextField(null=True)
648.         new_field.set_attributes_from_name("name")
649.         with connection.schema_editor() as editor:
650.             editor.alter_field(Author, old_field, new_field, strict=True)
651.         # Ensure the field is right afterwards
652.         columns = self.column_classes(Author)
653.         self.assertEqual(columns['name'][0], "TextField")
654.         self.assertTrue(columns['name'][1][6])
655.         # Change nullability again
656.         new_field2 = TextField(null=False)
657.         new_field2.set_attributes_from_name("name")
658.         with connection.schema_editor() as editor:
659.             editor.alter_field(Author, new_field, new_field2, strict=True)
660.         # Ensure the field is right afterwards
661.         columns = self.column_classes(Author)
662.         self.assertEqual(columns['name'][0], "TextField")
663.         self.assertEqual(bool(columns['name'][1][6]), bool(connection.features.interprets_empty_strings_as_nulls))
664. 
665.     def test_alter_auto_field_to_integer_field(self):
666.         # Create the table
667.         with connection.schema_editor() as editor:
668.             editor.create_model(Author)
669.         # Change AutoField to IntegerField
670.         old_field = Author._meta.get_field('id')
671.         new_field = IntegerField(primary_key=True)
672.         new_field.set_attributes_from_name('id')
673.         new_field.model = Author
674.         with connection.schema_editor() as editor:
675.             editor.alter_field(Author, old_field, new_field, strict=True)
676. 
677.     def test_alter_auto_field_to_char_field(self):
678.         # Create the table
679.         with connection.schema_editor() as editor:
680.             editor.create_model(Author)
681.         # Change AutoField to CharField
682.         old_field = Author._meta.get_field('id')
683.         new_field = CharField(primary_key=True, max_length=50)
684.         new_field.set_attributes_from_name('id')
685.         new_field.model = Author
686.         with connection.schema_editor() as editor:
687.             editor.alter_field(Author, old_field, new_field, strict=True)
688. 
689.     @isolate_apps('schema')
690.     def test_alter_auto_field_quoted_db_column(self):
691.         class Foo(Model):
692.             id = AutoField(primary_key=True, db_column='"quoted_id"')
693. 
694.             class Meta:
695.                 app_label = 'schema'
696. 
697.         with connection.schema_editor() as editor:
698.             editor.create_model(Foo)
699.         self.isolated_local_models = [Foo]
700.         old_field = Foo._meta.get_field('id')
701.         new_field = BigAutoField(primary_key=True)
702.         new_field.model = Foo
703.         new_field.db_column = '"quoted_id"'
704.         new_field.set_attributes_from_name('id')
705.         with connection.schema_editor() as editor:
706.             editor.alter_field(Foo, old_field, new_field, strict=True)
707.         Foo.objects.create()
708. 
709.     def test_alter_not_unique_field_to_primary_key(self):
710.         # Create the table.
711.         with connection.schema_editor() as editor:
712.             editor.create_model(Author)
713.         # Change UUIDField to primary key.
714.         old_field = Author._meta.get_field('uuid')
715.         new_field = UUIDField(primary_key=True)
716.         new_field.set_attributes_from_name('uuid')
717.         new_field.model = Author
718.         with connection.schema_editor() as editor:
719.             editor.remove_field(Author, Author._meta.get_field('id'))
720.             editor.alter_field(Author, old_field, new_field, strict=True)
721. 
722.     @isolate_apps('schema')
723.     def test_alter_primary_key_quoted_db_table(self):
724.         class Foo(Model):
725.             class Meta:
726.                 app_label = 'schema'
727.                 db_table = '"foo"'
728. 
729.         with connection.schema_editor() as editor:
730.             editor.create_model(Foo)
731.         self.isolated_local_models = [Foo]
732.         old_field = Foo._meta.get_field('id')
733.         new_field = BigAutoField(primary_key=True)
734.         new_field.model = Foo
735.         new_field.set_attributes_from_name('id')
736.         with connection.schema_editor() as editor:
737.             editor.alter_field(Foo, old_field, new_field, strict=True)
738.         Foo.objects.create()
739. 
740.     def test_alter_text_field(self):
741.         # Regression for "BLOB/TEXT column 'info' can't have a default value")
742.         # on MySQL.
743.         # Create the table
744.         with connection.schema_editor() as editor:
745.             editor.create_model(Note)
746.         old_field = Note._meta.get_field("info")
747.         new_field = TextField(blank=True)
748.         new_field.set_attributes_from_name("info")
749.         with connection.schema_editor() as editor:
750.             editor.alter_field(Note, old_field, new_field, strict=True)
751. 
752.     @skipUnlessDBFeature('can_defer_constraint_checks', 'can_rollback_ddl')
753.     def test_alter_fk_checks_deferred_constraints(self):
754.         """
755.         #25492 - Altering a foreign key's structure and data in the same
756.         transaction.
757.         """
758.         with connection.schema_editor() as editor:
759.             editor.create_model(Node)
760.         old_field = Node._meta.get_field('parent')
761.         new_field = ForeignKey(Node, CASCADE)
762.         new_field.set_attributes_from_name('parent')
763.         parent = Node.objects.create()
764.         with connection.schema_editor() as editor:
765.             # Update the parent FK to create a deferred constraint check.
766.             Node.objects.update(parent=parent)
767.             editor.alter_field(Node, old_field, new_field, strict=True)
768. 
769.     def test_alter_text_field_to_date_field(self):
770.         """
771.         #25002 - Test conversion of text field to date field.
772.         """
773.         with connection.schema_editor() as editor:
774.             editor.create_model(Note)
775.         Note.objects.create(info='1988-05-05')
776.         old_field = Note._meta.get_field('info')
777.         new_field = DateField(blank=True)
778.         new_field.set_attributes_from_name('info')
779.         with connection.schema_editor() as editor:
780.             editor.alter_field(Note, old_field, new_field, strict=True)
781.         # Make sure the field isn't nullable
782.         columns = self.column_classes(Note)
783.         self.assertFalse(columns['info'][1][6])
784. 
785.     def test_alter_text_field_to_datetime_field(self):
786.         """
787.         #25002 - Test conversion of text field to datetime field.
788.         """
789.         with connection.schema_editor() as editor:
790.             editor.create_model(Note)
791.         Note.objects.create(info='1988-05-05 3:16:17.4567')
792.         old_field = Note._meta.get_field('info')
793.         new_field = DateTimeField(blank=True)
794.         new_field.set_attributes_from_name('info')
795.         with connection.schema_editor() as editor:
796.             editor.alter_field(Note, old_field, new_field, strict=True)
797.         # Make sure the field isn't nullable
798.         columns = self.column_classes(Note)
799.         self.assertFalse(columns['info'][1][6])
800. 
801.     def test_alter_text_field_to_time_field(self):
802.         """
803.         #25002 - Test conversion of text field to time field.
804.         """
805.         with connection.schema_editor() as editor:
806.             editor.create_model(Note)
807.         Note.objects.create(info='3:16:17.4567')
808.         old_field = Note._meta.get_field('info')
809.         new_field = TimeField(blank=True)
810.         new_field.set_attributes_from_name('info')
811.         with connection.schema_editor() as editor:
812.             editor.alter_field(Note, old_field, new_field, strict=True)
813.         # Make sure the field isn't nullable
814.         columns = self.column_classes(Note)
815.         self.assertFalse(columns['info'][1][6])
816. 
817.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
818.     def test_alter_textual_field_keep_null_status(self):
819.         """
820.         Changing a field type shouldn't affect the not null status.
821.         """
822.         with connection.schema_editor() as editor:
823.             editor.create_model(Note)
824.         with self.assertRaises(IntegrityError):
825.             Note.objects.create(info=None)
826.         old_field = Note._meta.get_field("info")
827.         new_field = CharField(max_length=50)
828.         new_field.set_attributes_from_name("info")
829.         with connection.schema_editor() as editor:
830.             editor.alter_field(Note, old_field, new_field, strict=True)
831.         with self.assertRaises(IntegrityError):
832.             Note.objects.create(info=None)
833. 
834.     def test_alter_numeric_field_keep_null_status(self):
835.         """
836.         Changing a field type shouldn't affect the not null status.
837.         """
838.         with connection.schema_editor() as editor:
839.             editor.create_model(UniqueTest)
840.         with self.assertRaises(IntegrityError):
841.             UniqueTest.objects.create(year=None, slug='aaa')
842.         old_field = UniqueTest._meta.get_field("year")
843.         new_field = BigIntegerField()
844.         new_field.set_attributes_from_name("year")
845.         with connection.schema_editor() as editor:
846.             editor.alter_field(UniqueTest, old_field, new_field, strict=True)
847.         with self.assertRaises(IntegrityError):
848.             UniqueTest.objects.create(year=None, slug='bbb')
849. 
850.     def test_alter_null_to_not_null(self):
851.         """
852.         #23609 - Tests handling of default values when altering from NULL to NOT NULL.
853.         """
854.         # Create the table
855.         with connection.schema_editor() as editor:
856.             editor.create_model(Author)
857.         # Ensure the field is right to begin with
858.         columns = self.column_classes(Author)
859.         self.assertTrue(columns['height'][1][6])
860.         # Create some test data
861.         Author.objects.create(name='Not null author', height=12)
862.         Author.objects.create(name='Null author')
863.         # Verify null value
864.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
865.         self.assertIsNone(Author.objects.get(name='Null author').height)
866.         # Alter the height field to NOT NULL with default
867.         old_field = Author._meta.get_field("height")
868.         new_field = PositiveIntegerField(default=42)
869.         new_field.set_attributes_from_name("height")
870.         with connection.schema_editor() as editor:
871.             editor.alter_field(Author, old_field, new_field, strict=True)
872.         # Ensure the field is right afterwards
873.         columns = self.column_classes(Author)
874.         self.assertFalse(columns['height'][1][6])
875.         # Verify default value
876.         self.assertEqual(Author.objects.get(name='Not null author').height, 12)
877.         self.assertEqual(Author.objects.get(name='Null author').height, 42)
878. 
879.     def test_alter_charfield_to_null(self):
880.         """
881.         #24307 - Should skip an alter statement on databases with
882.         interprets_empty_strings_as_null when changing a CharField to null.
883.         """
884.         # Create the table
885.         with connection.schema_editor() as editor:
886.             editor.create_model(Author)
887.         # Change the CharField to null
888.         old_field = Author._meta.get_field('name')
889.         new_field = copy(old_field)
890.         new_field.null = True
891.         with connection.schema_editor() as editor:
892.             editor.alter_field(Author, old_field, new_field, strict=True)
893. 
894.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
895.     def test_alter_char_field_decrease_length(self):
896.         # Create the table.
897.         with connection.schema_editor() as editor:
898.             editor.create_model(Author)
899.         Author.objects.create(name='x' * 255)
900.         # Change max_length of CharField.
901.         old_field = Author._meta.get_field('name')
902.         new_field = CharField(max_length=254)
903.         new_field.set_attributes_from_name('name')
904.         with connection.schema_editor() as editor:
905.             msg = 'value too long for type character varying(254)'
906.             with self.assertRaisesMessage(DataError, msg):
907.                 editor.alter_field(Author, old_field, new_field, strict=True)
908. 
909.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
910.     def test_alter_field_with_custom_db_type(self):
911.         from django.contrib.postgres.fields import ArrayField
912. 
913.         class Foo(Model):
914.             field = ArrayField(CharField(max_length=255))
915. 
916.             class Meta:
917.                 app_label = 'schema'
918. 
919.         with connection.schema_editor() as editor:
920.             editor.create_model(Foo)
921.         self.isolated_local_models = [Foo]
922.         old_field = Foo._meta.get_field('field')
923.         new_field = ArrayField(CharField(max_length=16))
924.         new_field.set_attributes_from_name('field')
925.         new_field.model = Foo
926.         with connection.schema_editor() as editor:
927.             editor.alter_field(Foo, old_field, new_field, strict=True)
928. 
929.     @isolate_apps('schema')
930.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
931.     def test_alter_array_field_decrease_base_field_length(self):
932.         from django.contrib.postgres.fields import ArrayField
933. 
934.         class ArrayModel(Model):
935.             field = ArrayField(CharField(max_length=16))
936. 
937.             class Meta:
938.                 app_label = 'schema'
939. 
940.         with connection.schema_editor() as editor:
941.             editor.create_model(ArrayModel)
942.         self.isolated_local_models = [ArrayModel]
943.         ArrayModel.objects.create(field=['x' * 16])
944.         old_field = ArrayModel._meta.get_field('field')
945.         new_field = ArrayField(CharField(max_length=15))
946.         new_field.set_attributes_from_name('field')
947.         new_field.model = ArrayModel
948.         with connection.schema_editor() as editor:
949.             msg = 'value too long for type character varying(15)'
950.             with self.assertRaisesMessage(DataError, msg):
951.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
952. 
953.     @isolate_apps('schema')
954.     @unittest.skipUnless(connection.vendor == 'postgresql', 'PostgreSQL specific')
955.     def test_alter_array_field_decrease_nested_base_field_length(self):
956.         from django.contrib.postgres.fields import ArrayField
957. 
958.         class ArrayModel(Model):
959.             field = ArrayField(ArrayField(CharField(max_length=16)))
960. 
961.             class Meta:
962.                 app_label = 'schema'
963. 
964.         with connection.schema_editor() as editor:
965.             editor.create_model(ArrayModel)
966.         self.isolated_local_models = [ArrayModel]
967.         ArrayModel.objects.create(field=[['x' * 16]])
968.         old_field = ArrayModel._meta.get_field('field')
969.         new_field = ArrayField(ArrayField(CharField(max_length=15)))
970.         new_field.set_attributes_from_name('field')
971.         new_field.model = ArrayModel
972.         with connection.schema_editor() as editor:
973.             msg = 'value too long for type character varying(15)'
974.             with self.assertRaisesMessage(DataError, msg):
975.                 editor.alter_field(ArrayModel, old_field, new_field, strict=True)
976. 
977.     def test_alter_textfield_to_null(self):
978.         """
979.         #24307 - Should skip an alter statement on databases with
980.         interprets_empty_strings_as_null when changing a TextField to null.
981.         """
982.         # Create the table
983.         with connection.schema_editor() as editor:
984.             editor.create_model(Note)
985.         # Change the TextField to null
986.         old_field = Note._meta.get_field('info')
987.         new_field = copy(old_field)
988.         new_field.null = True
989.         with connection.schema_editor() as editor:
990.             editor.alter_field(Note, old_field, new_field, strict=True)
991. 
992.     @skipUnlessDBFeature('supports_combined_alters')
993.     def test_alter_null_to_not_null_keeping_default(self):
994.         """
995.         #23738 - Can change a nullable field with default to non-nullable
996.         with the same default.
997.         """
998.         # Create the table
999.         with connection.schema_editor() as editor:
1000.             editor.create_model(AuthorWithDefaultHeight)
1001.         # Ensure the field is right to begin with
1002.         columns = self.column_classes(AuthorWithDefaultHeight)
1003.         self.assertTrue(columns['height'][1][6])
1004.         # Alter the height field to NOT NULL keeping the previous default
1005.         old_field = AuthorWithDefaultHeight._meta.get_field("height")
1006.         new_field = PositiveIntegerField(default=42)
1007.         new_field.set_attributes_from_name("height")
1008.         with connection.schema_editor() as editor:
1009.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
1010.         # Ensure the field is right afterwards
1011.         columns = self.column_classes(AuthorWithDefaultHeight)
1012.         self.assertFalse(columns['height'][1][6])
1013. 
1014.     @skipUnlessDBFeature('supports_foreign_keys')
1015.     def test_alter_fk(self):
1016.         """
1017.         Tests altering of FKs
1018.         """
1019.         # Create the table
1020.         with connection.schema_editor() as editor:
1021.             editor.create_model(Author)
1022.             editor.create_model(Book)
1023.         # Ensure the field is right to begin with
1024.         columns = self.column_classes(Book)
1025.         self.assertEqual(columns['author_id'][0], "IntegerField")
1026.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1027.         # Alter the FK
1028.         old_field = Book._meta.get_field("author")
1029.         new_field = ForeignKey(Author, CASCADE, editable=False)
1030.         new_field.set_attributes_from_name("author")
1031.         with connection.schema_editor() as editor:
1032.             editor.alter_field(Book, old_field, new_field, strict=True)
1033.         # Ensure the field is right afterwards
1034.         columns = self.column_classes(Book)
1035.         self.assertEqual(columns['author_id'][0], "IntegerField")
1036.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1037. 
1038.     @skipUnlessDBFeature('supports_foreign_keys')
1039.     def test_alter_to_fk(self):
1040.         """
1041.         #24447 - Tests adding a FK constraint for an existing column
1042.         """
1043.         class LocalBook(Model):
1044.             author = IntegerField()
1045.             title = CharField(max_length=100, db_index=True)
1046.             pub_date = DateTimeField()
1047. 
1048.             class Meta:
1049.                 app_label = 'schema'
1050.                 apps = new_apps
1051. 
1052.         self.local_models = [LocalBook]
1053. 
1054.         # Create the tables
1055.         with connection.schema_editor() as editor:
1056.             editor.create_model(Author)
1057.             editor.create_model(LocalBook)
1058.         # Ensure no FK constraint exists
1059.         constraints = self.get_constraints(LocalBook._meta.db_table)
1060.         for details in constraints.values():
1061.             if details['foreign_key']:
1062.                 self.fail('Found an unexpected FK constraint to %s' % details['columns'])
1063.         old_field = LocalBook._meta.get_field("author")
1064.         new_field = ForeignKey(Author, CASCADE)
1065.         new_field.set_attributes_from_name("author")
1066.         with connection.schema_editor() as editor:
1067.             editor.alter_field(LocalBook, old_field, new_field, strict=True)
1068.         self.assertForeignKeyExists(LocalBook, 'author_id', 'schema_author')
1069. 
1070.     @skipUnlessDBFeature('supports_foreign_keys')
1071.     def test_alter_o2o_to_fk(self):
1072.         """
1073.         #24163 - Tests altering of OneToOneField to ForeignKey
1074.         """
1075.         # Create the table
1076.         with connection.schema_editor() as editor:
1077.             editor.create_model(Author)
1078.             editor.create_model(BookWithO2O)
1079.         # Ensure the field is right to begin with
1080.         columns = self.column_classes(BookWithO2O)
1081.         self.assertEqual(columns['author_id'][0], "IntegerField")
1082.         # Ensure the field is unique
1083.         author = Author.objects.create(name="Joe")
1084.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1085.         with self.assertRaises(IntegrityError):
1086.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1087.         BookWithO2O.objects.all().delete()
1088.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1089.         # Alter the OneToOneField to ForeignKey
1090.         old_field = BookWithO2O._meta.get_field("author")
1091.         new_field = ForeignKey(Author, CASCADE)
1092.         new_field.set_attributes_from_name("author")
1093.         with connection.schema_editor() as editor:
1094.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1095.         # Ensure the field is right afterwards
1096.         columns = self.column_classes(Book)
1097.         self.assertEqual(columns['author_id'][0], "IntegerField")
1098.         # Ensure the field is not unique anymore
1099.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1100.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1101.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1102. 
1103.     @skipUnlessDBFeature('supports_foreign_keys')
1104.     def test_alter_fk_to_o2o(self):
1105.         """
1106.         #24163 - Tests altering of ForeignKey to OneToOneField
1107.         """
1108.         # Create the table
1109.         with connection.schema_editor() as editor:
1110.             editor.create_model(Author)
1111.             editor.create_model(Book)
1112.         # Ensure the field is right to begin with
1113.         columns = self.column_classes(Book)
1114.         self.assertEqual(columns['author_id'][0], "IntegerField")
1115.         # Ensure the field is not unique
1116.         author = Author.objects.create(name="Joe")
1117.         Book.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1118.         Book.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1119.         Book.objects.all().delete()
1120.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author')
1121.         # Alter the ForeignKey to OneToOneField
1122.         old_field = Book._meta.get_field("author")
1123.         new_field = OneToOneField(Author, CASCADE)
1124.         new_field.set_attributes_from_name("author")
1125.         with connection.schema_editor() as editor:
1126.             editor.alter_field(Book, old_field, new_field, strict=True)
1127.         # Ensure the field is right afterwards
1128.         columns = self.column_classes(BookWithO2O)
1129.         self.assertEqual(columns['author_id'][0], "IntegerField")
1130.         # Ensure the field is unique now
1131.         BookWithO2O.objects.create(author=author, title="Django 1", pub_date=datetime.datetime.now())
1132.         with self.assertRaises(IntegrityError):
1133.             BookWithO2O.objects.create(author=author, title="Django 2", pub_date=datetime.datetime.now())
1134.         self.assertForeignKeyExists(BookWithO2O, 'author_id', 'schema_author')
1135. 
1136.     def test_alter_field_fk_to_o2o(self):
1137.         with connection.schema_editor() as editor:
1138.             editor.create_model(Author)
1139.             editor.create_model(Book)
1140.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1141. 
1142.         # Check the index is right to begin with.
1143.         counts = self.get_constraints_count(
1144.             Book._meta.db_table,
1145.             Book._meta.get_field('author').column,
1146.             (Author._meta.db_table, Author._meta.pk.column),
1147.         )
1148.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1149. 
1150.         old_field = Book._meta.get_field('author')
1151.         new_field = OneToOneField(Author, CASCADE)
1152.         new_field.set_attributes_from_name('author')
1153.         with connection.schema_editor() as editor:
1154.             editor.alter_field(Book, old_field, new_field, strict=True)
1155. 
1156.         counts = self.get_constraints_count(
1157.             Book._meta.db_table,
1158.             Book._meta.get_field('author').column,
1159.             (Author._meta.db_table, Author._meta.pk.column),
1160.         )
1161.         # The index on ForeignKey is replaced with a unique constraint for OneToOneField.
1162.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1163. 
1164.     def test_alter_field_fk_keeps_index(self):
1165.         with connection.schema_editor() as editor:
1166.             editor.create_model(Author)
1167.             editor.create_model(Book)
1168.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1169. 
1170.         # Check the index is right to begin with.
1171.         counts = self.get_constraints_count(
1172.             Book._meta.db_table,
1173.             Book._meta.get_field('author').column,
1174.             (Author._meta.db_table, Author._meta.pk.column),
1175.         )
1176.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1177. 
1178.         old_field = Book._meta.get_field('author')
1179.         # on_delete changed from CASCADE.
1180.         new_field = ForeignKey(Author, PROTECT)
1181.         new_field.set_attributes_from_name('author')
1182.         with connection.schema_editor() as editor:
1183.             editor.alter_field(Book, old_field, new_field, strict=True)
1184. 
1185.         counts = self.get_constraints_count(
1186.             Book._meta.db_table,
1187.             Book._meta.get_field('author').column,
1188.             (Author._meta.db_table, Author._meta.pk.column),
1189.         )
1190.         # The index remains.
1191.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1192. 
1193.     def test_alter_field_o2o_to_fk(self):
1194.         with connection.schema_editor() as editor:
1195.             editor.create_model(Author)
1196.             editor.create_model(BookWithO2O)
1197.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1198. 
1199.         # Check the unique constraint is right to begin with.
1200.         counts = self.get_constraints_count(
1201.             BookWithO2O._meta.db_table,
1202.             BookWithO2O._meta.get_field('author').column,
1203.             (Author._meta.db_table, Author._meta.pk.column),
1204.         )
1205.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1206. 
1207.         old_field = BookWithO2O._meta.get_field('author')
1208.         new_field = ForeignKey(Author, CASCADE)
1209.         new_field.set_attributes_from_name('author')
1210.         with connection.schema_editor() as editor:
1211.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1212. 
1213.         counts = self.get_constraints_count(
1214.             BookWithO2O._meta.db_table,
1215.             BookWithO2O._meta.get_field('author').column,
1216.             (Author._meta.db_table, Author._meta.pk.column),
1217.         )
1218.         # The unique constraint on OneToOneField is replaced with an index for ForeignKey.
1219.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 0, 'indexes': 1})
1220. 
1221.     def test_alter_field_o2o_keeps_unique(self):
1222.         with connection.schema_editor() as editor:
1223.             editor.create_model(Author)
1224.             editor.create_model(BookWithO2O)
1225.         expected_fks = 1 if connection.features.supports_foreign_keys else 0
1226. 
1227.         # Check the unique constraint is right to begin with.
1228.         counts = self.get_constraints_count(
1229.             BookWithO2O._meta.db_table,
1230.             BookWithO2O._meta.get_field('author').column,
1231.             (Author._meta.db_table, Author._meta.pk.column),
1232.         )
1233.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1234. 
1235.         old_field = BookWithO2O._meta.get_field('author')
1236.         # on_delete changed from CASCADE.
1237.         new_field = OneToOneField(Author, PROTECT)
1238.         new_field.set_attributes_from_name('author')
1239.         with connection.schema_editor() as editor:
1240.             editor.alter_field(BookWithO2O, old_field, new_field, strict=True)
1241. 
1242.         counts = self.get_constraints_count(
1243.             BookWithO2O._meta.db_table,
1244.             BookWithO2O._meta.get_field('author').column,
1245.             (Author._meta.db_table, Author._meta.pk.column),
1246.         )
1247.         # The unique constraint remains.
1248.         self.assertEqual(counts, {'fks': expected_fks, 'uniques': 1, 'indexes': 0})
1249. 
1250.     @skipUnlessDBFeature('ignores_table_name_case')
1251.     def test_alter_db_table_case(self):
1252.         # Create the table
1253.         with connection.schema_editor() as editor:
1254.             editor.create_model(Author)
1255.         # Alter the case of the table
1256.         old_table_name = Author._meta.db_table
1257.         with connection.schema_editor() as editor:
1258.             editor.alter_db_table(Author, old_table_name, old_table_name.upper())
1259. 
1260.     def test_alter_implicit_id_to_explicit(self):
1261.         """
1262.         Should be able to convert an implicit "id" field to an explicit "id"
1263.         primary key field.
1264.         """
1265.         with connection.schema_editor() as editor:
1266.             editor.create_model(Author)
1267. 
1268.         old_field = Author._meta.get_field("id")
1269.         new_field = AutoField(primary_key=True)
1270.         new_field.set_attributes_from_name("id")
1271.         new_field.model = Author
1272.         with connection.schema_editor() as editor:
1273.             editor.alter_field(Author, old_field, new_field, strict=True)
1274.         # This will fail if DROP DEFAULT is inadvertently executed on this
1275.         # field which drops the id sequence, at least on PostgreSQL.
1276.         Author.objects.create(name='Foo')
1277.         Author.objects.create(name='Bar')
1278. 
1279.     def test_alter_autofield_pk_to_bigautofield_pk_sequence_owner(self):
1280.         """
1281.         Converting an implicit PK to BigAutoField(primary_key=True) should keep
1282.         a sequence owner on PostgreSQL.
1283.         """
1284.         with connection.schema_editor() as editor:
1285.             editor.create_model(Author)
1286.         old_field = Author._meta.get_field('id')
1287.         new_field = BigAutoField(primary_key=True)
1288.         new_field.set_attributes_from_name('id')
1289.         new_field.model = Author
1290.         with connection.schema_editor() as editor:
1291.             editor.alter_field(Author, old_field, new_field, strict=True)
1292. 
1293.         Author.objects.create(name='Foo', pk=1)
1294.         with connection.cursor() as cursor:
1295.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1296.             if sequence_reset_sqls:
1297.                 cursor.execute(sequence_reset_sqls[0])
1298.         # Fail on PostgreSQL if sequence is missing an owner.
1299.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1300. 
1301.     def test_alter_autofield_pk_to_smallautofield_pk_sequence_owner(self):
1302.         """
1303.         Converting an implicit PK to SmallAutoField(primary_key=True) should
1304.         keep a sequence owner on PostgreSQL.
1305.         """
1306.         with connection.schema_editor() as editor:
1307.             editor.create_model(Author)
1308.         old_field = Author._meta.get_field('id')
1309.         new_field = SmallAutoField(primary_key=True)
1310.         new_field.set_attributes_from_name('id')
1311.         new_field.model = Author
1312.         with connection.schema_editor() as editor:
1313.             editor.alter_field(Author, old_field, new_field, strict=True)
1314. 
1315.         Author.objects.create(name='Foo', pk=1)
1316.         with connection.cursor() as cursor:
1317.             sequence_reset_sqls = connection.ops.sequence_reset_sql(no_style(), [Author])
1318.             if sequence_reset_sqls:
1319.                 cursor.execute(sequence_reset_sqls[0])
1320.         # Fail on PostgreSQL if sequence is missing an owner.
1321.         self.assertIsNotNone(Author.objects.create(name='Bar'))
1322. 
1323.     def test_alter_int_pk_to_autofield_pk(self):
1324.         """
1325.         Should be able to rename an IntegerField(primary_key=True) to
1326.         AutoField(primary_key=True).
1327.         """
1328.         with connection.schema_editor() as editor:
1329.             editor.create_model(IntegerPK)
1330. 
1331.         old_field = IntegerPK._meta.get_field('i')
1332.         new_field = AutoField(primary_key=True)
1333.         new_field.model = IntegerPK
1334.         new_field.set_attributes_from_name('i')
1335. 
1336.         with connection.schema_editor() as editor:
1337.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1338. 
1339.     def test_alter_int_pk_to_bigautofield_pk(self):
1340.         """
1341.         Should be able to rename an IntegerField(primary_key=True) to
1342.         BigAutoField(primary_key=True).
1343.         """
1344.         with connection.schema_editor() as editor:
1345.             editor.create_model(IntegerPK)
1346. 
1347.         old_field = IntegerPK._meta.get_field('i')
1348.         new_field = BigAutoField(primary_key=True)
1349.         new_field.model = IntegerPK
1350.         new_field.set_attributes_from_name('i')
1351. 
1352.         with connection.schema_editor() as editor:
1353.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1354. 
1355.     @isolate_apps('schema')
1356.     def test_alter_smallint_pk_to_smallautofield_pk(self):
1357.         """
1358.         Should be able to rename an SmallIntegerField(primary_key=True) to
1359.         SmallAutoField(primary_key=True).
1360.         """
1361.         class SmallIntegerPK(Model):
1362.             i = SmallIntegerField(primary_key=True)
1363. 
1364.             class Meta:
1365.                 app_label = 'schema'
1366. 
1367.         with connection.schema_editor() as editor:
1368.             editor.create_model(SmallIntegerPK)
1369.         self.isolated_local_models = [SmallIntegerPK]
1370.         old_field = SmallIntegerPK._meta.get_field('i')
1371.         new_field = SmallAutoField(primary_key=True)
1372.         new_field.model = SmallIntegerPK
1373.         new_field.set_attributes_from_name('i')
1374.         with connection.schema_editor() as editor:
1375.             editor.alter_field(SmallIntegerPK, old_field, new_field, strict=True)
1376. 
1377.     def test_alter_int_pk_to_int_unique(self):
1378.         """
1379.         Should be able to rename an IntegerField(primary_key=True) to
1380.         IntegerField(unique=True).
1381.         """
1382.         with connection.schema_editor() as editor:
1383.             editor.create_model(IntegerPK)
1384.         # Delete the old PK
1385.         old_field = IntegerPK._meta.get_field('i')
1386.         new_field = IntegerField(unique=True)
1387.         new_field.model = IntegerPK
1388.         new_field.set_attributes_from_name('i')
1389.         with connection.schema_editor() as editor:
1390.             editor.alter_field(IntegerPK, old_field, new_field, strict=True)
1391.         # The primary key constraint is gone. Result depends on database:
1392.         # 'id' for SQLite, None for others (must not be 'i').
1393.         self.assertIn(self.get_primary_key(IntegerPK._meta.db_table), ('id', None))
1394. 
1395.         # Set up a model class as it currently stands. The original IntegerPK
1396.         # class is now out of date and some backends make use of the whole
1397.         # model class when modifying a field (such as sqlite3 when remaking a
1398.         # table) so an outdated model class leads to incorrect results.
1399.         class Transitional(Model):
1400.             i = IntegerField(unique=True)
1401.             j = IntegerField(unique=True)
1402. 
1403.             class Meta:
1404.                 app_label = 'schema'
1405.                 apps = new_apps
1406.                 db_table = 'INTEGERPK'
1407. 
1408.         # model requires a new PK
1409.         old_field = Transitional._meta.get_field('j')
1410.         new_field = IntegerField(primary_key=True)
1411.         new_field.model = Transitional
1412.         new_field.set_attributes_from_name('j')
1413. 
1414.         with connection.schema_editor() as editor:
1415.             editor.alter_field(Transitional, old_field, new_field, strict=True)
1416. 
1417.         # Create a model class representing the updated model.
1418.         class IntegerUnique(Model):
1419.             i = IntegerField(unique=True)
1420.             j = IntegerField(primary_key=True)
1421. 
1422.             class Meta:
1423.                 app_label = 'schema'
1424.                 apps = new_apps
1425.                 db_table = 'INTEGERPK'
1426. 
1427.         # Ensure unique constraint works.
1428.         IntegerUnique.objects.create(i=1, j=1)
1429.         with self.assertRaises(IntegrityError):
1430.             IntegerUnique.objects.create(i=1, j=2)
1431. 
1432.     def test_rename(self):
1433.         """
1434.         Tests simple altering of fields
1435.         """
1436.         # Create the table
1437.         with connection.schema_editor() as editor:
1438.             editor.create_model(Author)
1439.         # Ensure the field is right to begin with
1440.         columns = self.column_classes(Author)
1441.         self.assertEqual(columns['name'][0], "CharField")
1442.         self.assertNotIn("display_name", columns)
1443.         # Alter the name field's name
1444.         old_field = Author._meta.get_field("name")
1445.         new_field = CharField(max_length=254)
1446.         new_field.set_attributes_from_name("display_name")
1447.         with connection.schema_editor() as editor:
1448.             editor.alter_field(Author, old_field, new_field, strict=True)
1449.         # Ensure the field is right afterwards
1450.         columns = self.column_classes(Author)
1451.         self.assertEqual(columns['display_name'][0], "CharField")
1452.         self.assertNotIn("name", columns)
1453. 
1454.     @isolate_apps('schema')
1455.     def test_rename_referenced_field(self):
1456.         class Author(Model):
1457.             name = CharField(max_length=255, unique=True)
1458. 
1459.             class Meta:
1460.                 app_label = 'schema'
1461. 
1462.         class Book(Model):
1463.             author = ForeignKey(Author, CASCADE, to_field='name')
1464. 
1465.             class Meta:
1466.                 app_label = 'schema'
1467. 
1468.         with connection.schema_editor() as editor:
1469.             editor.create_model(Author)
1470.             editor.create_model(Book)
1471.         new_field = CharField(max_length=255, unique=True)
1472.         new_field.set_attributes_from_name('renamed')
1473.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
1474.             editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1475.         # Ensure the foreign key reference was updated.
1476.         self.assertForeignKeyExists(Book, 'author_id', 'schema_author', 'renamed')
1477. 
1478.     @skipIfDBFeature('interprets_empty_strings_as_nulls')
1479.     def test_rename_keep_null_status(self):
1480.         """
1481.         Renaming a field shouldn't affect the not null status.
1482.         """
1483.         with connection.schema_editor() as editor:
1484.             editor.create_model(Note)
1485.         with self.assertRaises(IntegrityError):
1486.             Note.objects.create(info=None)
1487.         old_field = Note._meta.get_field("info")
1488.         new_field = TextField()
1489.         new_field.set_attributes_from_name("detail_info")
1490.         with connection.schema_editor() as editor:
1491.             editor.alter_field(Note, old_field, new_field, strict=True)
1492.         columns = self.column_classes(Note)
1493.         self.assertEqual(columns['detail_info'][0], "TextField")
1494.         self.assertNotIn("info", columns)
1495.         with self.assertRaises(IntegrityError):
1496.             NoteRename.objects.create(detail_info=None)
1497. 
1498.     def _test_m2m_create(self, M2MFieldClass):
1499.         """
1500.         Tests M2M fields on models during creation
1501.         """
1502.         class LocalBookWithM2M(Model):
1503.             author = ForeignKey(Author, CASCADE)
1504.             title = CharField(max_length=100, db_index=True)
1505.             pub_date = DateTimeField()
1506.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1507. 
1508.             class Meta:
1509.                 app_label = 'schema'
1510.                 apps = new_apps
1511.         self.local_models = [LocalBookWithM2M]
1512.         # Create the tables
1513.         with connection.schema_editor() as editor:
1514.             editor.create_model(Author)
1515.             editor.create_model(TagM2MTest)
1516.             editor.create_model(LocalBookWithM2M)
1517.         # Ensure there is now an m2m table there
1518.         columns = self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1519.         self.assertEqual(columns['tagm2mtest_id'][0], "IntegerField")
1520. 
1521.     def test_m2m_create(self):
1522.         self._test_m2m_create(ManyToManyField)
1523. 
1524.     def test_m2m_create_custom(self):
1525.         self._test_m2m_create(CustomManyToManyField)
1526. 
1527.     def test_m2m_create_inherited(self):
1528.         self._test_m2m_create(InheritedManyToManyField)
1529. 
1530.     def _test_m2m_create_through(self, M2MFieldClass):
1531.         """
1532.         Tests M2M fields on models during creation with through models
1533.         """
1534.         class LocalTagThrough(Model):
1535.             book = ForeignKey("schema.LocalBookWithM2MThrough", CASCADE)
1536.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1537. 
1538.             class Meta:
1539.                 app_label = 'schema'
1540.                 apps = new_apps
1541. 
1542.         class LocalBookWithM2MThrough(Model):
1543.             tags = M2MFieldClass("TagM2MTest", related_name="books", through=LocalTagThrough)
1544. 
1545.             class Meta:
1546.                 app_label = 'schema'
1547.                 apps = new_apps
1548. 
1549.         self.local_models = [LocalTagThrough, LocalBookWithM2MThrough]
1550. 
1551.         # Create the tables
1552.         with connection.schema_editor() as editor:
1553.             editor.create_model(LocalTagThrough)
1554.             editor.create_model(TagM2MTest)
1555.             editor.create_model(LocalBookWithM2MThrough)
1556.         # Ensure there is now an m2m table there
1557.         columns = self.column_classes(LocalTagThrough)
1558.         self.assertEqual(columns['book_id'][0], "IntegerField")
1559.         self.assertEqual(columns['tag_id'][0], "IntegerField")
1560. 
1561.     def test_m2m_create_through(self):
1562.         self._test_m2m_create_through(ManyToManyField)
1563. 
1564.     def test_m2m_create_through_custom(self):
1565.         self._test_m2m_create_through(CustomManyToManyField)
1566. 
1567.     def test_m2m_create_through_inherited(self):
1568.         self._test_m2m_create_through(InheritedManyToManyField)
1569. 
1570.     def _test_m2m(self, M2MFieldClass):
1571.         """
1572.         Tests adding/removing M2M fields on models
1573.         """
1574.         class LocalAuthorWithM2M(Model):
1575.             name = CharField(max_length=255)
1576. 
1577.             class Meta:
1578.                 app_label = 'schema'
1579.                 apps = new_apps
1580. 
1581.         self.local_models = [LocalAuthorWithM2M]
1582. 
1583.         # Create the tables
1584.         with connection.schema_editor() as editor:
1585.             editor.create_model(LocalAuthorWithM2M)
1586.             editor.create_model(TagM2MTest)
1587.         # Create an M2M field
1588.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors")
1589.         new_field.contribute_to_class(LocalAuthorWithM2M, "tags")
1590.         # Ensure there's no m2m table there
1591.         with self.assertRaises(DatabaseError):
1592.             self.column_classes(new_field.remote_field.through)
1593.         # Add the field
1594.         with connection.schema_editor() as editor:
1595.             editor.add_field(LocalAuthorWithM2M, new_field)
1596.         # Ensure there is now an m2m table there
1597.         columns = self.column_classes(new_field.remote_field.through)
1598.         self.assertEqual(columns['tagm2mtest_id'][0], "IntegerField")
1599. 
1600.         # "Alter" the field. This should not rename the DB table to itself.
1601.         with connection.schema_editor() as editor:
1602.             editor.alter_field(LocalAuthorWithM2M, new_field, new_field, strict=True)
1603. 
1604.         # Remove the M2M table again
1605.         with connection.schema_editor() as editor:
1606.             editor.remove_field(LocalAuthorWithM2M, new_field)
1607.         # Ensure there's no m2m table there
1608.         with self.assertRaises(DatabaseError):
1609.             self.column_classes(new_field.remote_field.through)
1610. 
1611.         # Make sure the model state is coherent with the table one now that
1612.         # we've removed the tags field.
1613.         opts = LocalAuthorWithM2M._meta
1614.         opts.local_many_to_many.remove(new_field)
1615.         del new_apps.all_models['schema'][new_field.remote_field.through._meta.model_name]
1616.         opts._expire_cache()
1617. 
1618.     def test_m2m(self):
1619.         self._test_m2m(ManyToManyField)
1620. 
1621.     def test_m2m_custom(self):
1622.         self._test_m2m(CustomManyToManyField)
1623. 
1624.     def test_m2m_inherited(self):
1625.         self._test_m2m(InheritedManyToManyField)
1626. 
1627.     def _test_m2m_through_alter(self, M2MFieldClass):
1628.         """
1629.         Tests altering M2Ms with explicit through models (should no-op)
1630.         """
1631.         class LocalAuthorTag(Model):
1632.             author = ForeignKey("schema.LocalAuthorWithM2MThrough", CASCADE)
1633.             tag = ForeignKey("schema.TagM2MTest", CASCADE)
1634. 
1635.             class Meta:
1636.                 app_label = 'schema'
1637.                 apps = new_apps
1638. 
1639.         class LocalAuthorWithM2MThrough(Model):
1640.             name = CharField(max_length=255)
1641.             tags = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1642. 
1643.             class Meta:
1644.                 app_label = 'schema'
1645.                 apps = new_apps
1646. 
1647.         self.local_models = [LocalAuthorTag, LocalAuthorWithM2MThrough]
1648. 
1649.         # Create the tables
1650.         with connection.schema_editor() as editor:
1651.             editor.create_model(LocalAuthorTag)
1652.             editor.create_model(LocalAuthorWithM2MThrough)
1653.             editor.create_model(TagM2MTest)
1654.         # Ensure the m2m table is there
1655.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1656.         # "Alter" the field's blankness. This should not actually do anything.
1657.         old_field = LocalAuthorWithM2MThrough._meta.get_field("tags")
1658.         new_field = M2MFieldClass("schema.TagM2MTest", related_name="authors", through=LocalAuthorTag)
1659.         new_field.contribute_to_class(LocalAuthorWithM2MThrough, "tags")
1660.         with connection.schema_editor() as editor:
1661.             editor.alter_field(LocalAuthorWithM2MThrough, old_field, new_field, strict=True)
1662.         # Ensure the m2m table is still there
1663.         self.assertEqual(len(self.column_classes(LocalAuthorTag)), 3)
1664. 
1665.     def test_m2m_through_alter(self):
1666.         self._test_m2m_through_alter(ManyToManyField)
1667. 
1668.     def test_m2m_through_alter_custom(self):
1669.         self._test_m2m_through_alter(CustomManyToManyField)
1670. 
1671.     def test_m2m_through_alter_inherited(self):
1672.         self._test_m2m_through_alter(InheritedManyToManyField)
1673. 
1674.     def _test_m2m_repoint(self, M2MFieldClass):
1675.         """
1676.         Tests repointing M2M fields
1677.         """
1678.         class LocalBookWithM2M(Model):
1679.             author = ForeignKey(Author, CASCADE)
1680.             title = CharField(max_length=100, db_index=True)
1681.             pub_date = DateTimeField()
1682.             tags = M2MFieldClass("TagM2MTest", related_name="books")
1683. 
1684.             class Meta:
1685.                 app_label = 'schema'
1686.                 apps = new_apps
1687.         self.local_models = [LocalBookWithM2M]
1688.         # Create the tables
1689.         with connection.schema_editor() as editor:
1690.             editor.create_model(Author)
1691.             editor.create_model(LocalBookWithM2M)
1692.             editor.create_model(TagM2MTest)
1693.             editor.create_model(UniqueTest)
1694.         # Ensure the M2M exists and points to TagM2MTest
1695.         if connection.features.supports_foreign_keys:
1696.             self.assertForeignKeyExists(
1697.                 LocalBookWithM2M._meta.get_field("tags").remote_field.through,
1698.                 'tagm2mtest_id',
1699.                 'schema_tagm2mtest',
1700.             )
1701.         # Repoint the M2M
1702.         old_field = LocalBookWithM2M._meta.get_field("tags")
1703.         new_field = M2MFieldClass(UniqueTest)
1704.         new_field.contribute_to_class(LocalBookWithM2M, "uniques")
1705.         with connection.schema_editor() as editor:
1706.             editor.alter_field(LocalBookWithM2M, old_field, new_field, strict=True)
1707.         # Ensure old M2M is gone
1708.         with self.assertRaises(DatabaseError):
1709.             self.column_classes(LocalBookWithM2M._meta.get_field("tags").remote_field.through)
1710. 
1711.         # This model looks like the new model and is used for teardown.
1712.         opts = LocalBookWithM2M._meta
1713.         opts.local_many_to_many.remove(old_field)
1714.         # Ensure the new M2M exists and points to UniqueTest
1715.         if connection.features.supports_foreign_keys:
1716.             self.assertForeignKeyExists(new_field.remote_field.through, 'uniquetest_id', 'schema_uniquetest')
1717. 
1718.     def test_m2m_repoint(self):
1719.         self._test_m2m_repoint(ManyToManyField)
1720. 
1721.     def test_m2m_repoint_custom(self):
1722.         self._test_m2m_repoint(CustomManyToManyField)
1723. 
1724.     def test_m2m_repoint_inherited(self):
1725.         self._test_m2m_repoint(InheritedManyToManyField)
1726. 
1727.     @isolate_apps('schema')
1728.     def test_m2m_rename_field_in_target_model(self):
1729.         class LocalTagM2MTest(Model):
1730.             title = CharField(max_length=255)
1731. 
1732.             class Meta:
1733.                 app_label = 'schema'
1734. 
1735.         class LocalM2M(Model):
1736.             tags = ManyToManyField(LocalTagM2MTest)
1737. 
1738.             class Meta:
1739.                 app_label = 'schema'
1740. 
1741.         # Create the tables.
1742.         with connection.schema_editor() as editor:
1743.             editor.create_model(LocalM2M)
1744.             editor.create_model(LocalTagM2MTest)
1745.         self.isolated_local_models = [LocalM2M, LocalTagM2MTest]
1746.         # Ensure the m2m table is there.
1747.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1748.         # Alter a field in LocalTagM2MTest.
1749.         old_field = LocalTagM2MTest._meta.get_field('title')
1750.         new_field = CharField(max_length=254)
1751.         new_field.contribute_to_class(LocalTagM2MTest, 'title1')
1752.         # @isolate_apps() and inner models are needed to have the model
1753.         # relations populated, otherwise this doesn't act as a regression test.
1754.         self.assertEqual(len(new_field.model._meta.related_objects), 1)
1755.         with connection.schema_editor() as editor:
1756.             editor.alter_field(LocalTagM2MTest, old_field, new_field, strict=True)
1757.         # Ensure the m2m table is still there.
1758.         self.assertEqual(len(self.column_classes(LocalM2M)), 1)
1759. 
1760.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1761.     def test_check_constraints(self):
1762.         """
1763.         Tests creating/deleting CHECK constraints
1764.         """
1765.         # Create the tables
1766.         with connection.schema_editor() as editor:
1767.             editor.create_model(Author)
1768.         # Ensure the constraint exists
1769.         constraints = self.get_constraints(Author._meta.db_table)
1770.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1771.             self.fail("No check constraint for height found")
1772.         # Alter the column to remove it
1773.         old_field = Author._meta.get_field("height")
1774.         new_field = IntegerField(null=True, blank=True)
1775.         new_field.set_attributes_from_name("height")
1776.         with connection.schema_editor() as editor:
1777.             editor.alter_field(Author, old_field, new_field, strict=True)
1778.         constraints = self.get_constraints(Author._meta.db_table)
1779.         for details in constraints.values():
1780.             if details['columns'] == ["height"] and details['check']:
1781.                 self.fail("Check constraint for height found")
1782.         # Alter the column to re-add it
1783.         new_field2 = Author._meta.get_field("height")
1784.         with connection.schema_editor() as editor:
1785.             editor.alter_field(Author, new_field, new_field2, strict=True)
1786.         constraints = self.get_constraints(Author._meta.db_table)
1787.         if not any(details['columns'] == ['height'] and details['check'] for details in constraints.values()):
1788.             self.fail("No check constraint for height found")
1789. 
1790.     @skipUnlessDBFeature('supports_column_check_constraints', 'can_introspect_check_constraints')
1791.     def test_remove_field_check_does_not_remove_meta_constraints(self):
1792.         with connection.schema_editor() as editor:
1793.             editor.create_model(Author)
1794.         # Add the custom check constraint
1795.         constraint = CheckConstraint(check=Q(height__gte=0), name='author_height_gte_0_check')
1796.         custom_constraint_name = constraint.name
1797.         Author._meta.constraints = [constraint]
1798.         with connection.schema_editor() as editor:
1799.             editor.add_constraint(Author, constraint)
1800.         # Ensure the constraints exist
1801.         constraints = self.get_constraints(Author._meta.db_table)
1802.         self.assertIn(custom_constraint_name, constraints)
1803.         other_constraints = [
1804.             name for name, details in constraints.items()
1805.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1806.         ]
1807.         self.assertEqual(len(other_constraints), 1)
1808.         # Alter the column to remove field check
1809.         old_field = Author._meta.get_field('height')
1810.         new_field = IntegerField(null=True, blank=True)
1811.         new_field.set_attributes_from_name('height')
1812.         with connection.schema_editor() as editor:
1813.             editor.alter_field(Author, old_field, new_field, strict=True)
1814.         constraints = self.get_constraints(Author._meta.db_table)
1815.         self.assertIn(custom_constraint_name, constraints)
1816.         other_constraints = [
1817.             name for name, details in constraints.items()
1818.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1819.         ]
1820.         self.assertEqual(len(other_constraints), 0)
1821.         # Alter the column to re-add field check
1822.         new_field2 = Author._meta.get_field('height')
1823.         with connection.schema_editor() as editor:
1824.             editor.alter_field(Author, new_field, new_field2, strict=True)
1825.         constraints = self.get_constraints(Author._meta.db_table)
1826.         self.assertIn(custom_constraint_name, constraints)
1827.         other_constraints = [
1828.             name for name, details in constraints.items()
1829.             if details['columns'] == ['height'] and details['check'] and name != custom_constraint_name
1830.         ]
1831.         self.assertEqual(len(other_constraints), 1)
1832.         # Drop the check constraint
1833.         with connection.schema_editor() as editor:
1834.             Author._meta.constraints = []
1835.             editor.remove_constraint(Author, constraint)
1836. 
1837.     def test_unique(self):
1838.         """
1839.         Tests removing and adding unique constraints to a single column.
1840.         """
1841.         # Create the table
1842.         with connection.schema_editor() as editor:
1843.             editor.create_model(Tag)
1844.         # Ensure the field is unique to begin with
1845.         Tag.objects.create(title="foo", slug="foo")
1846.         with self.assertRaises(IntegrityError):
1847.             Tag.objects.create(title="bar", slug="foo")
1848.         Tag.objects.all().delete()
1849.         # Alter the slug field to be non-unique
1850.         old_field = Tag._meta.get_field("slug")
1851.         new_field = SlugField(unique=False)
1852.         new_field.set_attributes_from_name("slug")
1853.         with connection.schema_editor() as editor:
1854.             editor.alter_field(Tag, old_field, new_field, strict=True)
1855.         # Ensure the field is no longer unique
1856.         Tag.objects.create(title="foo", slug="foo")
1857.         Tag.objects.create(title="bar", slug="foo")
1858.         Tag.objects.all().delete()
1859.         # Alter the slug field to be unique
1860.         new_field2 = SlugField(unique=True)
1861.         new_field2.set_attributes_from_name("slug")
1862.         with connection.schema_editor() as editor:
1863.             editor.alter_field(Tag, new_field, new_field2, strict=True)
1864.         # Ensure the field is unique again
1865.         Tag.objects.create(title="foo", slug="foo")
1866.         with self.assertRaises(IntegrityError):
1867.             Tag.objects.create(title="bar", slug="foo")
1868.         Tag.objects.all().delete()
1869.         # Rename the field
1870.         new_field3 = SlugField(unique=True)
1871.         new_field3.set_attributes_from_name("slug2")
1872.         with connection.schema_editor() as editor:
1873.             editor.alter_field(Tag, new_field2, new_field3, strict=True)
1874.         # Ensure the field is still unique
1875.         TagUniqueRename.objects.create(title="foo", slug2="foo")
1876.         with self.assertRaises(IntegrityError):
1877.             TagUniqueRename.objects.create(title="bar", slug2="foo")
1878.         Tag.objects.all().delete()
1879. 
1880.     def test_unique_name_quoting(self):
1881.         old_table_name = TagUniqueRename._meta.db_table
1882.         try:
1883.             with connection.schema_editor() as editor:
1884.                 editor.create_model(TagUniqueRename)
1885.                 editor.alter_db_table(TagUniqueRename, old_table_name, 'unique-table')
1886.                 TagUniqueRename._meta.db_table = 'unique-table'
1887.                 # This fails if the unique index name isn't quoted.
1888.                 editor.alter_unique_together(TagUniqueRename, [], (('title', 'slug2'),))
1889.         finally:
1890.             TagUniqueRename._meta.db_table = old_table_name
1891. 
1892.     @isolate_apps('schema')
1893.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
1894.     @skipUnlessDBFeature('supports_foreign_keys')
1895.     def test_unique_no_unnecessary_fk_drops(self):
1896.         """
1897.         If AlterField isn't selective about dropping foreign key constraints
1898.         when modifying a field with a unique constraint, the AlterField
1899.         incorrectly drops and recreates the Book.author foreign key even though
1900.         it doesn't restrict the field being changed (#29193).
1901.         """
1902.         class Author(Model):
1903.             name = CharField(max_length=254, unique=True)
1904. 
1905.             class Meta:
1906.                 app_label = 'schema'
1907. 
1908.         class Book(Model):
1909.             author = ForeignKey(Author, CASCADE)
1910. 
1911.             class Meta:
1912.                 app_label = 'schema'
1913. 
1914.         with connection.schema_editor() as editor:
1915.             editor.create_model(Author)
1916.             editor.create_model(Book)
1917.         new_field = CharField(max_length=255, unique=True)
1918.         new_field.model = Author
1919.         new_field.set_attributes_from_name('name')
1920.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1921.             with connection.schema_editor() as editor:
1922.                 editor.alter_field(Author, Author._meta.get_field('name'), new_field)
1923.         # One SQL statement is executed to alter the field.
1924.         self.assertEqual(len(cm.records), 1)
1925. 
1926.     @isolate_apps('schema')
1927.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite remakes the table on field alteration.')
1928.     def test_unique_and_reverse_m2m(self):
1929.         """
1930.         AlterField can modify a unique field when there's a reverse M2M
1931.         relation on the model.
1932.         """
1933.         class Tag(Model):
1934.             title = CharField(max_length=255)
1935.             slug = SlugField(unique=True)
1936. 
1937.             class Meta:
1938.                 app_label = 'schema'
1939. 
1940.         class Book(Model):
1941.             tags = ManyToManyField(Tag, related_name='books')
1942. 
1943.             class Meta:
1944.                 app_label = 'schema'
1945. 
1946.         self.isolated_local_models = [Book._meta.get_field('tags').remote_field.through]
1947.         with connection.schema_editor() as editor:
1948.             editor.create_model(Tag)
1949.             editor.create_model(Book)
1950.         new_field = SlugField(max_length=75, unique=True)
1951.         new_field.model = Tag
1952.         new_field.set_attributes_from_name('slug')
1953.         with self.assertLogs('django.db.backends.schema', 'DEBUG') as cm:
1954.             with connection.schema_editor() as editor:
1955.                 editor.alter_field(Tag, Tag._meta.get_field('slug'), new_field)
1956.         # One SQL statement is executed to alter the field.
1957.         self.assertEqual(len(cm.records), 1)
1958.         # Ensure that the field is still unique.
1959.         Tag.objects.create(title='foo', slug='foo')
1960.         with self.assertRaises(IntegrityError):
1961.             Tag.objects.create(title='bar', slug='foo')
1962. 
1963.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
1964.     def test_remove_field_unique_does_not_remove_meta_constraints(self):
1965.         with connection.schema_editor() as editor:
1966.             editor.create_model(AuthorWithUniqueName)
1967.         # Add the custom unique constraint
1968.         constraint = UniqueConstraint(fields=['name'], name='author_name_uniq')
1969.         custom_constraint_name = constraint.name
1970.         AuthorWithUniqueName._meta.constraints = [constraint]
1971.         with connection.schema_editor() as editor:
1972.             editor.add_constraint(AuthorWithUniqueName, constraint)
1973.         # Ensure the constraints exist
1974.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1975.         self.assertIn(custom_constraint_name, constraints)
1976.         other_constraints = [
1977.             name for name, details in constraints.items()
1978.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
1979.         ]
1980.         self.assertEqual(len(other_constraints), 1)
1981.         # Alter the column to remove field uniqueness
1982.         old_field = AuthorWithUniqueName._meta.get_field('name')
1983.         new_field = CharField(max_length=255)
1984.         new_field.set_attributes_from_name('name')
1985.         with connection.schema_editor() as editor:
1986.             editor.alter_field(AuthorWithUniqueName, old_field, new_field, strict=True)
1987.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1988.         self.assertIn(custom_constraint_name, constraints)
1989.         other_constraints = [
1990.             name for name, details in constraints.items()
1991.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
1992.         ]
1993.         self.assertEqual(len(other_constraints), 0)
1994.         # Alter the column to re-add field uniqueness
1995.         new_field2 = AuthorWithUniqueName._meta.get_field('name')
1996.         with connection.schema_editor() as editor:
1997.             editor.alter_field(AuthorWithUniqueName, new_field, new_field2, strict=True)
1998.         constraints = self.get_constraints(AuthorWithUniqueName._meta.db_table)
1999.         self.assertIn(custom_constraint_name, constraints)
2000.         other_constraints = [
2001.             name for name, details in constraints.items()
2002.             if details['columns'] == ['name'] and details['unique'] and name != custom_constraint_name
2003.         ]
2004.         self.assertEqual(len(other_constraints), 1)
2005.         # Drop the unique constraint
2006.         with connection.schema_editor() as editor:
2007.             AuthorWithUniqueName._meta.constraints = []
2008.             editor.remove_constraint(AuthorWithUniqueName, constraint)
2009. 
2010.     def test_unique_together(self):
2011.         """
2012.         Tests removing and adding unique_together constraints on a model.
2013.         """
2014.         # Create the table
2015.         with connection.schema_editor() as editor:
2016.             editor.create_model(UniqueTest)
2017.         # Ensure the fields are unique to begin with
2018.         UniqueTest.objects.create(year=2012, slug="foo")
2019.         UniqueTest.objects.create(year=2011, slug="foo")
2020.         UniqueTest.objects.create(year=2011, slug="bar")
2021.         with self.assertRaises(IntegrityError):
2022.             UniqueTest.objects.create(year=2012, slug="foo")
2023.         UniqueTest.objects.all().delete()
2024.         # Alter the model to its non-unique-together companion
2025.         with connection.schema_editor() as editor:
2026.             editor.alter_unique_together(UniqueTest, UniqueTest._meta.unique_together, [])
2027.         # Ensure the fields are no longer unique
2028.         UniqueTest.objects.create(year=2012, slug="foo")
2029.         UniqueTest.objects.create(year=2012, slug="foo")
2030.         UniqueTest.objects.all().delete()
2031.         # Alter it back
2032.         new_field2 = SlugField(unique=True)
2033.         new_field2.set_attributes_from_name("slug")
2034.         with connection.schema_editor() as editor:
2035.             editor.alter_unique_together(UniqueTest, [], UniqueTest._meta.unique_together)
2036.         # Ensure the fields are unique again
2037.         UniqueTest.objects.create(year=2012, slug="foo")
2038.         with self.assertRaises(IntegrityError):
2039.             UniqueTest.objects.create(year=2012, slug="foo")
2040.         UniqueTest.objects.all().delete()
2041. 
2042.     def test_unique_together_with_fk(self):
2043.         """
2044.         Tests removing and adding unique_together constraints that include
2045.         a foreign key.
2046.         """
2047.         # Create the table
2048.         with connection.schema_editor() as editor:
2049.             editor.create_model(Author)
2050.             editor.create_model(Book)
2051.         # Ensure the fields are unique to begin with
2052.         self.assertEqual(Book._meta.unique_together, ())
2053.         # Add the unique_together constraint
2054.         with connection.schema_editor() as editor:
2055.             editor.alter_unique_together(Book, [], [['author', 'title']])
2056.         # Alter it back
2057.         with connection.schema_editor() as editor:
2058.             editor.alter_unique_together(Book, [['author', 'title']], [])
2059. 
2060.     def test_unique_together_with_fk_with_existing_index(self):
2061.         """
2062.         Tests removing and adding unique_together constraints that include
2063.         a foreign key, where the foreign key is added after the model is
2064.         created.
2065.         """
2066.         # Create the tables
2067.         with connection.schema_editor() as editor:
2068.             editor.create_model(Author)
2069.             editor.create_model(BookWithoutAuthor)
2070.             new_field = ForeignKey(Author, CASCADE)
2071.             new_field.set_attributes_from_name('author')
2072.             editor.add_field(BookWithoutAuthor, new_field)
2073.         # Ensure the fields aren't unique to begin with
2074.         self.assertEqual(Book._meta.unique_together, ())
2075.         # Add the unique_together constraint
2076.         with connection.schema_editor() as editor:
2077.             editor.alter_unique_together(Book, [], [['author', 'title']])
2078.         # Alter it back
2079.         with connection.schema_editor() as editor:
2080.             editor.alter_unique_together(Book, [['author', 'title']], [])
2081. 
2082.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2083.     def test_remove_unique_together_does_not_remove_meta_constraints(self):
2084.         with connection.schema_editor() as editor:
2085.             editor.create_model(AuthorWithUniqueNameAndBirthday)
2086.         # Add the custom unique constraint
2087.         constraint = UniqueConstraint(fields=['name', 'birthday'], name='author_name_birthday_uniq')
2088.         custom_constraint_name = constraint.name
2089.         AuthorWithUniqueNameAndBirthday._meta.constraints = [constraint]
2090.         with connection.schema_editor() as editor:
2091.             editor.add_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2092.         # Ensure the constraints exist
2093.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2094.         self.assertIn(custom_constraint_name, constraints)
2095.         other_constraints = [
2096.             name for name, details in constraints.items()
2097.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2098.         ]
2099.         self.assertEqual(len(other_constraints), 1)
2100.         # Remove unique together
2101.         unique_together = AuthorWithUniqueNameAndBirthday._meta.unique_together
2102.         with connection.schema_editor() as editor:
2103.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, unique_together, [])
2104.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2105.         self.assertIn(custom_constraint_name, constraints)
2106.         other_constraints = [
2107.             name for name, details in constraints.items()
2108.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2109.         ]
2110.         self.assertEqual(len(other_constraints), 0)
2111.         # Re-add unique together
2112.         with connection.schema_editor() as editor:
2113.             editor.alter_unique_together(AuthorWithUniqueNameAndBirthday, [], unique_together)
2114.         constraints = self.get_constraints(AuthorWithUniqueNameAndBirthday._meta.db_table)
2115.         self.assertIn(custom_constraint_name, constraints)
2116.         other_constraints = [
2117.             name for name, details in constraints.items()
2118.             if details['columns'] == ['name', 'birthday'] and details['unique'] and name != custom_constraint_name
2119.         ]
2120.         self.assertEqual(len(other_constraints), 1)
2121.         # Drop the unique constraint
2122.         with connection.schema_editor() as editor:
2123.             AuthorWithUniqueNameAndBirthday._meta.constraints = []
2124.             editor.remove_constraint(AuthorWithUniqueNameAndBirthday, constraint)
2125. 
2126.     def test_index_together(self):
2127.         """
2128.         Tests removing and adding index_together constraints on a model.
2129.         """
2130.         # Create the table
2131.         with connection.schema_editor() as editor:
2132.             editor.create_model(Tag)
2133.         # Ensure there's no index on the year/slug columns first
2134.         self.assertIs(
2135.             any(
2136.                 c["index"]
2137.                 for c in self.get_constraints("schema_tag").values()
2138.                 if c['columns'] == ["slug", "title"]
2139.             ),
2140.             False,
2141.         )
2142.         # Alter the model to add an index
2143.         with connection.schema_editor() as editor:
2144.             editor.alter_index_together(Tag, [], [("slug", "title")])
2145.         # Ensure there is now an index
2146.         self.assertIs(
2147.             any(
2148.                 c["index"]
2149.                 for c in self.get_constraints("schema_tag").values()
2150.                 if c['columns'] == ["slug", "title"]
2151.             ),
2152.             True,
2153.         )
2154.         # Alter it back
2155.         new_field2 = SlugField(unique=True)
2156.         new_field2.set_attributes_from_name("slug")
2157.         with connection.schema_editor() as editor:
2158.             editor.alter_index_together(Tag, [("slug", "title")], [])
2159.         # Ensure there's no index
2160.         self.assertIs(
2161.             any(
2162.                 c["index"]
2163.                 for c in self.get_constraints("schema_tag").values()
2164.                 if c['columns'] == ["slug", "title"]
2165.             ),
2166.             False,
2167.         )
2168. 
2169.     def test_index_together_with_fk(self):
2170.         """
2171.         Tests removing and adding index_together constraints that include
2172.         a foreign key.
2173.         """
2174.         # Create the table
2175.         with connection.schema_editor() as editor:
2176.             editor.create_model(Author)
2177.             editor.create_model(Book)
2178.         # Ensure the fields are unique to begin with
2179.         self.assertEqual(Book._meta.index_together, ())
2180.         # Add the unique_together constraint
2181.         with connection.schema_editor() as editor:
2182.             editor.alter_index_together(Book, [], [['author', 'title']])
2183.         # Alter it back
2184.         with connection.schema_editor() as editor:
2185.             editor.alter_index_together(Book, [['author', 'title']], [])
2186. 
2187.     def test_create_index_together(self):
2188.         """
2189.         Tests creating models with index_together already defined
2190.         """
2191.         # Create the table
2192.         with connection.schema_editor() as editor:
2193.             editor.create_model(TagIndexed)
2194.         # Ensure there is an index
2195.         self.assertIs(
2196.             any(
2197.                 c["index"]
2198.                 for c in self.get_constraints("schema_tagindexed").values()
2199.                 if c['columns'] == ["slug", "title"]
2200.             ),
2201.             True,
2202.         )
2203. 
2204.     @skipUnlessDBFeature('allows_multiple_constraints_on_same_fields')
2205.     def test_remove_index_together_does_not_remove_meta_indexes(self):
2206.         with connection.schema_editor() as editor:
2207.             editor.create_model(AuthorWithIndexedNameAndBirthday)
2208.         # Add the custom index
2209.         index = Index(fields=['name', 'birthday'], name='author_name_birthday_idx')
2210.         custom_index_name = index.name
2211.         AuthorWithIndexedNameAndBirthday._meta.indexes = [index]
2212.         with connection.schema_editor() as editor:
2213.             editor.add_index(AuthorWithIndexedNameAndBirthday, index)
2214.         # Ensure the indexes exist
2215.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2216.         self.assertIn(custom_index_name, constraints)
2217.         other_constraints = [
2218.             name for name, details in constraints.items()
2219.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2220.         ]
2221.         self.assertEqual(len(other_constraints), 1)
2222.         # Remove index together
2223.         index_together = AuthorWithIndexedNameAndBirthday._meta.index_together
2224.         with connection.schema_editor() as editor:
2225.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, index_together, [])
2226.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2227.         self.assertIn(custom_index_name, constraints)
2228.         other_constraints = [
2229.             name for name, details in constraints.items()
2230.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2231.         ]
2232.         self.assertEqual(len(other_constraints), 0)
2233.         # Re-add index together
2234.         with connection.schema_editor() as editor:
2235.             editor.alter_index_together(AuthorWithIndexedNameAndBirthday, [], index_together)
2236.         constraints = self.get_constraints(AuthorWithIndexedNameAndBirthday._meta.db_table)
2237.         self.assertIn(custom_index_name, constraints)
2238.         other_constraints = [
2239.             name for name, details in constraints.items()
2240.             if details['columns'] == ['name', 'birthday'] and details['index'] and name != custom_index_name
2241.         ]
2242.         self.assertEqual(len(other_constraints), 1)
2243.         # Drop the index
2244.         with connection.schema_editor() as editor:
2245.             AuthorWithIndexedNameAndBirthday._meta.indexes = []
2246.             editor.remove_index(AuthorWithIndexedNameAndBirthday, index)
2247. 
2248.     @isolate_apps('schema')
2249.     def test_db_table(self):
2250.         """
2251.         Tests renaming of the table
2252.         """
2253.         class Author(Model):
2254.             name = CharField(max_length=255)
2255. 
2256.             class Meta:
2257.                 app_label = 'schema'
2258. 
2259.         class Book(Model):
2260.             author = ForeignKey(Author, CASCADE)
2261. 
2262.             class Meta:
2263.                 app_label = 'schema'
2264. 
2265.         # Create the table and one referring it.
2266.         with connection.schema_editor() as editor:
2267.             editor.create_model(Author)
2268.             editor.create_model(Book)
2269.         # Ensure the table is there to begin with
2270.         columns = self.column_classes(Author)
2271.         self.assertEqual(columns['name'][0], "CharField")
2272.         # Alter the table
2273.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2274.             editor.alter_db_table(Author, "schema_author", "schema_otherauthor")
2275.         # Ensure the table is there afterwards
2276.         Author._meta.db_table = "schema_otherauthor"
2277.         columns = self.column_classes(Author)
2278.         self.assertEqual(columns['name'][0], "CharField")
2279.         # Ensure the foreign key reference was updated
2280.         self.assertForeignKeyExists(Book, "author_id", "schema_otherauthor")
2281.         # Alter the table again
2282.         with connection.schema_editor(atomic=connection.features.supports_atomic_references_rename) as editor:
2283.             editor.alter_db_table(Author, "schema_otherauthor", "schema_author")
2284.         # Ensure the table is still there
2285.         Author._meta.db_table = "schema_author"
2286.         columns = self.column_classes(Author)
2287.         self.assertEqual(columns['name'][0], "CharField")
2288. 
2289.     def test_add_remove_index(self):
2290.         """
2291.         Tests index addition and removal
2292.         """
2293.         # Create the table
2294.         with connection.schema_editor() as editor:
2295.             editor.create_model(Author)
2296.         # Ensure the table is there and has no index
2297.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2298.         # Add the index
2299.         index = Index(fields=['name'], name='author_title_idx')
2300.         with connection.schema_editor() as editor:
2301.             editor.add_index(Author, index)
2302.         self.assertIn('name', self.get_indexes(Author._meta.db_table))
2303.         # Drop the index
2304.         with connection.schema_editor() as editor:
2305.             editor.remove_index(Author, index)
2306.         self.assertNotIn('name', self.get_indexes(Author._meta.db_table))
2307. 
2308.     def test_remove_db_index_doesnt_remove_custom_indexes(self):
2309.         """
2310.         Changing db_index to False doesn't remove indexes from Meta.indexes.
2311.         """
2312.         with connection.schema_editor() as editor:
2313.             editor.create_model(AuthorWithIndexedName)
2314.         # Ensure the table has its index
2315.         self.assertIn('name', self.get_indexes(AuthorWithIndexedName._meta.db_table))
2316. 
2317.         # Add the custom index
2318.         index = Index(fields=['-name'], name='author_name_idx')
2319.         author_index_name = index.name
2320.         with connection.schema_editor() as editor:
2321.             db_index_name = editor._create_index_name(
2322.                 table_name=AuthorWithIndexedName._meta.db_table,
2323.                 column_names=('name',),
2324.             )
2325.         try:
2326.             AuthorWithIndexedName._meta.indexes = [index]
2327.             with connection.schema_editor() as editor:
2328.                 editor.add_index(AuthorWithIndexedName, index)
2329.             old_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2330.             self.assertIn(author_index_name, old_constraints)
2331.             self.assertIn(db_index_name, old_constraints)
2332.             # Change name field to db_index=False
2333.             old_field = AuthorWithIndexedName._meta.get_field('name')
2334.             new_field = CharField(max_length=255)
2335.             new_field.set_attributes_from_name('name')
2336.             with connection.schema_editor() as editor:
2337.                 editor.alter_field(AuthorWithIndexedName, old_field, new_field, strict=True)
2338.             new_constraints = self.get_constraints(AuthorWithIndexedName._meta.db_table)
2339.             self.assertNotIn(db_index_name, new_constraints)
2340.             # The index from Meta.indexes is still in the database.
2341.             self.assertIn(author_index_name, new_constraints)
2342.             # Drop the index
2343.             with connection.schema_editor() as editor:
2344.                 editor.remove_index(AuthorWithIndexedName, index)
2345.         finally:
2346.             AuthorWithIndexedName._meta.indexes = []
2347. 
2348.     def test_order_index(self):
2349.         """
2350.         Indexes defined with ordering (ASC/DESC) defined on column
2351.         """
2352.         with connection.schema_editor() as editor:
2353.             editor.create_model(Author)
2354.         # The table doesn't have an index
2355.         self.assertNotIn('title', self.get_indexes(Author._meta.db_table))
2356.         index_name = 'author_name_idx'
2357.         # Add the index
2358.         index = Index(fields=['name', '-weight'], name=index_name)
2359.         with connection.schema_editor() as editor:
2360.             editor.add_index(Author, index)
2361.         if connection.features.supports_index_column_ordering:
2362.             self.assertIndexOrder(Author._meta.db_table, index_name, ['ASC', 'DESC'])
2363.         # Drop the index
2364.         with connection.schema_editor() as editor:
2365.             editor.remove_index(Author, index)
2366. 
2367.     def test_indexes(self):
2368.         """
2369.         Tests creation/altering of indexes
2370.         """
2371.         # Create the table
2372.         with connection.schema_editor() as editor:
2373.             editor.create_model(Author)
2374.             editor.create_model(Book)
2375.         # Ensure the table is there and has the right index
2376.         self.assertIn(
2377.             "title",
2378.             self.get_indexes(Book._meta.db_table),
2379.         )
2380.         # Alter to remove the index
2381.         old_field = Book._meta.get_field("title")
2382.         new_field = CharField(max_length=100, db_index=False)
2383.         new_field.set_attributes_from_name("title")
2384.         with connection.schema_editor() as editor:
2385.             editor.alter_field(Book, old_field, new_field, strict=True)
2386.         # Ensure the table is there and has no index
2387.         self.assertNotIn(
2388.             "title",
2389.             self.get_indexes(Book._meta.db_table),
2390.         )
2391.         # Alter to re-add the index
2392.         new_field2 = Book._meta.get_field("title")
2393.         with connection.schema_editor() as editor:
2394.             editor.alter_field(Book, new_field, new_field2, strict=True)
2395.         # Ensure the table is there and has the index again
2396.         self.assertIn(
2397.             "title",
2398.             self.get_indexes(Book._meta.db_table),
2399.         )
2400.         # Add a unique column, verify that creates an implicit index
2401.         new_field3 = BookWithSlug._meta.get_field("slug")
2402.         with connection.schema_editor() as editor:
2403.             editor.add_field(Book, new_field3)
2404.         self.assertIn(
2405.             "slug",
2406.             self.get_uniques(Book._meta.db_table),
2407.         )
2408.         # Remove the unique, check the index goes with it
2409.         new_field4 = CharField(max_length=20, unique=False)
2410.         new_field4.set_attributes_from_name("slug")
2411.         with connection.schema_editor() as editor:
2412.             editor.alter_field(BookWithSlug, new_field3, new_field4, strict=True)
2413.         self.assertNotIn(
2414.             "slug",
2415.             self.get_uniques(Book._meta.db_table),
2416.         )
2417. 
2418.     def test_text_field_with_db_index(self):
2419.         with connection.schema_editor() as editor:
2420.             editor.create_model(AuthorTextFieldWithIndex)
2421.         # The text_field index is present if the database supports it.
2422.         assertion = self.assertIn if connection.features.supports_index_on_text_field else self.assertNotIn
2423.         assertion('text_field', self.get_indexes(AuthorTextFieldWithIndex._meta.db_table))
2424. 
2425.     def test_primary_key(self):
2426.         """
2427.         Tests altering of the primary key
2428.         """
2429.         # Create the table
2430.         with connection.schema_editor() as editor:
2431.             editor.create_model(Tag)
2432.         # Ensure the table is there and has the right PK
2433.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'id')
2434.         # Alter to change the PK
2435.         id_field = Tag._meta.get_field("id")
2436.         old_field = Tag._meta.get_field("slug")
2437.         new_field = SlugField(primary_key=True)
2438.         new_field.set_attributes_from_name("slug")
2439.         new_field.model = Tag
2440.         with connection.schema_editor() as editor:
2441.             editor.remove_field(Tag, id_field)
2442.             editor.alter_field(Tag, old_field, new_field)
2443.         # Ensure the PK changed
2444.         self.assertNotIn(
2445.             'id',
2446.             self.get_indexes(Tag._meta.db_table),
2447.         )
2448.         self.assertEqual(self.get_primary_key(Tag._meta.db_table), 'slug')
2449. 
2450.     def test_context_manager_exit(self):
2451.         """
2452.         Ensures transaction is correctly closed when an error occurs
2453.         inside a SchemaEditor context.
2454.         """
2455.         class SomeError(Exception):
2456.             pass
2457.         try:
2458.             with connection.schema_editor():
2459.                 raise SomeError
2460.         except SomeError:
2461.             self.assertFalse(connection.in_atomic_block)
2462. 
2463.     @skipIfDBFeature('can_rollback_ddl')
2464.     def test_unsupported_transactional_ddl_disallowed(self):
2465.         message = (
2466.             "Executing DDL statements while in a transaction on databases "
2467.             "that can't perform a rollback is prohibited."
2468.         )
2469.         with atomic(), connection.schema_editor() as editor:
2470.             with self.assertRaisesMessage(TransactionManagementError, message):
2471.                 editor.execute(editor.sql_create_table % {'table': 'foo', 'definition': ''})
2472. 
2473.     @skipUnlessDBFeature('supports_foreign_keys')
2474.     def test_foreign_key_index_long_names_regression(self):
2475.         """
2476.         Regression test for #21497.
2477.         Only affects databases that supports foreign keys.
2478.         """
2479.         # Create the table
2480.         with connection.schema_editor() as editor:
2481.             editor.create_model(AuthorWithEvenLongerName)
2482.             editor.create_model(BookWithLongName)
2483.         # Find the properly shortened column name
2484.         column_name = connection.ops.quote_name("author_foreign_key_with_really_long_field_name_id")
2485.         column_name = column_name[1:-1].lower()  # unquote, and, for Oracle, un-upcase
2486.         # Ensure the table is there and has an index on the column
2487.         self.assertIn(
2488.             column_name,
2489.             self.get_indexes(BookWithLongName._meta.db_table),
2490.         )
2491. 
2492.     @skipUnlessDBFeature('supports_foreign_keys')
2493.     def test_add_foreign_key_long_names(self):
2494.         """
2495.         Regression test for #23009.
2496.         Only affects databases that supports foreign keys.
2497.         """
2498.         # Create the initial tables
2499.         with connection.schema_editor() as editor:
2500.             editor.create_model(AuthorWithEvenLongerName)
2501.             editor.create_model(BookWithLongName)
2502.         # Add a second FK, this would fail due to long ref name before the fix
2503.         new_field = ForeignKey(AuthorWithEvenLongerName, CASCADE, related_name="something")
2504.         new_field.set_attributes_from_name("author_other_really_long_named_i_mean_so_long_fk")
2505.         with connection.schema_editor() as editor:
2506.             editor.add_field(BookWithLongName, new_field)
2507. 
2508.     @isolate_apps('schema')
2509.     @skipUnlessDBFeature('supports_foreign_keys')
2510.     def test_add_foreign_key_quoted_db_table(self):
2511.         class Author(Model):
2512.             class Meta:
2513.                 db_table = '"table_author_double_quoted"'
2514.                 app_label = 'schema'
2515. 
2516.         class Book(Model):
2517.             author = ForeignKey(Author, CASCADE)
2518. 
2519.             class Meta:
2520.                 app_label = 'schema'
2521. 
2522.         with connection.schema_editor() as editor:
2523.             editor.create_model(Author)
2524.             editor.create_model(Book)
2525.         if connection.vendor == 'mysql':
2526.             self.assertForeignKeyExists(Book, 'author_id', '"table_author_double_quoted"')
2527.         else:
2528.             self.assertForeignKeyExists(Book, 'author_id', 'table_author_double_quoted')
2529. 
2530.     def test_add_foreign_object(self):
2531.         with connection.schema_editor() as editor:
2532.             editor.create_model(BookForeignObj)
2533. 
2534.         new_field = ForeignObject(Author, on_delete=CASCADE, from_fields=['author_id'], to_fields=['id'])
2535.         new_field.set_attributes_from_name('author')
2536.         with connection.schema_editor() as editor:
2537.             editor.add_field(BookForeignObj, new_field)
2538. 
2539.     def test_creation_deletion_reserved_names(self):
2540.         """
2541.         Tries creating a model's table, and then deleting it when it has a
2542.         SQL reserved name.
2543.         """
2544.         # Create the table
2545.         with connection.schema_editor() as editor:
2546.             try:
2547.                 editor.create_model(Thing)
2548.             except OperationalError as e:
2549.                 self.fail("Errors when applying initial migration for a model "
2550.                           "with a table named after an SQL reserved word: %s" % e)
2551.         # The table is there
2552.         list(Thing.objects.all())
2553.         # Clean up that table
2554.         with connection.schema_editor() as editor:
2555.             editor.delete_model(Thing)
2556.         # The table is gone
2557.         with self.assertRaises(DatabaseError):
2558.             list(Thing.objects.all())
2559. 
2560.     def test_remove_constraints_capital_letters(self):
2561.         """
2562.         #23065 - Constraint names must be quoted if they contain capital letters.
2563.         """
2564.         def get_field(*args, field_class=IntegerField, **kwargs):
2565.             kwargs['db_column'] = "CamelCase"
2566.             field = field_class(*args, **kwargs)
2567.             field.set_attributes_from_name("CamelCase")
2568.             return field
2569. 
2570.         model = Author
2571.         field = get_field()
2572.         table = model._meta.db_table
2573.         column = field.column
2574.         identifier_converter = connection.introspection.identifier_converter
2575. 
2576.         with connection.schema_editor() as editor:
2577.             editor.create_model(model)
2578.             editor.add_field(model, field)
2579. 
2580.             constraint_name = 'CamelCaseIndex'
2581.             expected_constraint_name = identifier_converter(constraint_name)
2582.             editor.execute(
2583.                 editor.sql_create_index % {
2584.                     "table": editor.quote_name(table),
2585.                     "name": editor.quote_name(constraint_name),
2586.                     "using": "",
2587.                     "columns": editor.quote_name(column),
2588.                     "extra": "",
2589.                     "condition": "",
2590.                 }
2591.             )
2592.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2593.             editor.alter_field(model, get_field(db_index=True), field, strict=True)
2594.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2595. 
2596.             constraint_name = 'CamelCaseUniqConstraint'
2597.             expected_constraint_name = identifier_converter(constraint_name)
2598.             editor.execute(editor._create_unique_sql(model, [field.column], constraint_name))
2599.             self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2600.             editor.alter_field(model, get_field(unique=True), field, strict=True)
2601.             self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2602. 
2603.             if editor.sql_create_fk:
2604.                 constraint_name = 'CamelCaseFKConstraint'
2605.                 expected_constraint_name = identifier_converter(constraint_name)
2606.                 editor.execute(
2607.                     editor.sql_create_fk % {
2608.                         "table": editor.quote_name(table),
2609.                         "name": editor.quote_name(constraint_name),
2610.                         "column": editor.quote_name(column),
2611.                         "to_table": editor.quote_name(table),
2612.                         "to_column": editor.quote_name(model._meta.auto_field.column),
2613.                         "deferrable": connection.ops.deferrable_sql(),
2614.                     }
2615.                 )
2616.                 self.assertIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2617.                 editor.alter_field(model, get_field(Author, CASCADE, field_class=ForeignKey), field, strict=True)
2618.                 self.assertNotIn(expected_constraint_name, self.get_constraints(model._meta.db_table))
2619. 
2620.     def test_add_field_use_effective_default(self):
2621.         """
2622.         #23987 - effective_default() should be used as the field default when
2623.         adding a new field.
2624.         """
2625.         # Create the table
2626.         with connection.schema_editor() as editor:
2627.             editor.create_model(Author)
2628.         # Ensure there's no surname field
2629.         columns = self.column_classes(Author)
2630.         self.assertNotIn("surname", columns)
2631.         # Create a row
2632.         Author.objects.create(name='Anonymous1')
2633.         # Add new CharField to ensure default will be used from effective_default
2634.         new_field = CharField(max_length=15, blank=True)
2635.         new_field.set_attributes_from_name("surname")
2636.         with connection.schema_editor() as editor:
2637.             editor.add_field(Author, new_field)
2638.         # Ensure field was added with the right default
2639.         with connection.cursor() as cursor:
2640.             cursor.execute("SELECT surname FROM schema_author;")
2641.             item = cursor.fetchall()[0]
2642.             self.assertEqual(item[0], None if connection.features.interprets_empty_strings_as_nulls else '')
2643. 
2644.     def test_add_field_default_dropped(self):
2645.         # Create the table
2646.         with connection.schema_editor() as editor:
2647.             editor.create_model(Author)
2648.         # Ensure there's no surname field
2649.         columns = self.column_classes(Author)
2650.         self.assertNotIn("surname", columns)
2651.         # Create a row
2652.         Author.objects.create(name='Anonymous1')
2653.         # Add new CharField with a default
2654.         new_field = CharField(max_length=15, blank=True, default='surname default')
2655.         new_field.set_attributes_from_name("surname")
2656.         with connection.schema_editor() as editor:
2657.             editor.add_field(Author, new_field)
2658.         # Ensure field was added with the right default
2659.         with connection.cursor() as cursor:
2660.             cursor.execute("SELECT surname FROM schema_author;")
2661.             item = cursor.fetchall()[0]
2662.             self.assertEqual(item[0], 'surname default')
2663.             # And that the default is no longer set in the database.
2664.             field = next(
2665.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
2666.                 if f.name == "surname"
2667.             )
2668.             if connection.features.can_introspect_default:
2669.                 self.assertIsNone(field.default)
2670. 
2671.     def test_alter_field_default_dropped(self):
2672.         # Create the table
2673.         with connection.schema_editor() as editor:
2674.             editor.create_model(Author)
2675.         # Create a row
2676.         Author.objects.create(name='Anonymous1')
2677.         self.assertIsNone(Author.objects.get().height)
2678.         old_field = Author._meta.get_field('height')
2679.         # The default from the new field is used in updating existing rows.
2680.         new_field = IntegerField(blank=True, default=42)
2681.         new_field.set_attributes_from_name('height')
2682.         with connection.schema_editor() as editor:
2683.             editor.alter_field(Author, old_field, new_field, strict=True)
2684.         self.assertEqual(Author.objects.get().height, 42)
2685.         # The database default should be removed.
2686.         with connection.cursor() as cursor:
2687.             field = next(
2688.                 f for f in connection.introspection.get_table_description(cursor, "schema_author")
2689.                 if f.name == "height"
2690.             )
2691.             if connection.features.can_introspect_default:
2692.                 self.assertIsNone(field.default)
2693. 
2694.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
2695.     def test_alter_field_default_doesnt_perform_queries(self):
2696.         """
2697.         No queries are performed if a field default changes and the field's
2698.         not changing from null to non-null.
2699.         """
2700.         with connection.schema_editor() as editor:
2701.             editor.create_model(AuthorWithDefaultHeight)
2702.         old_field = AuthorWithDefaultHeight._meta.get_field('height')
2703.         new_default = old_field.default * 2
2704.         new_field = PositiveIntegerField(null=True, blank=True, default=new_default)
2705.         new_field.set_attributes_from_name('height')
2706.         with connection.schema_editor() as editor, self.assertNumQueries(0):
2707.             editor.alter_field(AuthorWithDefaultHeight, old_field, new_field, strict=True)
2708. 
2709.     def test_add_textfield_unhashable_default(self):
2710.         # Create the table
2711.         with connection.schema_editor() as editor:
2712.             editor.create_model(Author)
2713.         # Create a row
2714.         Author.objects.create(name='Anonymous1')
2715.         # Create a field that has an unhashable default
2716.         new_field = TextField(default={})
2717.         new_field.set_attributes_from_name("info")
2718.         with connection.schema_editor() as editor:
2719.             editor.add_field(Author, new_field)
2720. 
2721.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2722.     def test_add_indexed_charfield(self):
2723.         field = CharField(max_length=255, db_index=True)
2724.         field.set_attributes_from_name('nom_de_plume')
2725.         with connection.schema_editor() as editor:
2726.             editor.create_model(Author)
2727.             editor.add_field(Author, field)
2728.         # Should create two indexes; one for like operator.
2729.         self.assertEqual(
2730.             self.get_constraints_for_column(Author, 'nom_de_plume'),
2731.             ['schema_author_nom_de_plume_7570a851', 'schema_author_nom_de_plume_7570a851_like'],
2732.         )
2733. 
2734.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2735.     def test_add_unique_charfield(self):
2736.         field = CharField(max_length=255, unique=True)
2737.         field.set_attributes_from_name('nom_de_plume')
2738.         with connection.schema_editor() as editor:
2739.             editor.create_model(Author)
2740.             editor.add_field(Author, field)
2741.         # Should create two indexes; one for like operator.
2742.         self.assertEqual(
2743.             self.get_constraints_for_column(Author, 'nom_de_plume'),
2744.             ['schema_author_nom_de_plume_7570a851_like', 'schema_author_nom_de_plume_key']
2745.         )
2746. 
2747.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2748.     def test_alter_field_add_index_to_charfield(self):
2749.         # Create the table and verify no initial indexes.
2750.         with connection.schema_editor() as editor:
2751.             editor.create_model(Author)
2752.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2753.         # Alter to add db_index=True and create 2 indexes.
2754.         old_field = Author._meta.get_field('name')
2755.         new_field = CharField(max_length=255, db_index=True)
2756.         new_field.set_attributes_from_name('name')
2757.         with connection.schema_editor() as editor:
2758.             editor.alter_field(Author, old_field, new_field, strict=True)
2759.         self.assertEqual(
2760.             self.get_constraints_for_column(Author, 'name'),
2761.             ['schema_author_name_1fbc5617', 'schema_author_name_1fbc5617_like']
2762.         )
2763.         # Remove db_index=True to drop both indexes.
2764.         with connection.schema_editor() as editor:
2765.             editor.alter_field(Author, new_field, old_field, strict=True)
2766.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2767. 
2768.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2769.     def test_alter_field_add_unique_to_charfield(self):
2770.         # Create the table and verify no initial indexes.
2771.         with connection.schema_editor() as editor:
2772.             editor.create_model(Author)
2773.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2774.         # Alter to add unique=True and create 2 indexes.
2775.         old_field = Author._meta.get_field('name')
2776.         new_field = CharField(max_length=255, unique=True)
2777.         new_field.set_attributes_from_name('name')
2778.         with connection.schema_editor() as editor:
2779.             editor.alter_field(Author, old_field, new_field, strict=True)
2780.         self.assertEqual(
2781.             self.get_constraints_for_column(Author, 'name'),
2782.             ['schema_author_name_1fbc5617_like', 'schema_author_name_1fbc5617_uniq']
2783.         )
2784.         # Remove unique=True to drop both indexes.
2785.         with connection.schema_editor() as editor:
2786.             editor.alter_field(Author, new_field, old_field, strict=True)
2787.         self.assertEqual(self.get_constraints_for_column(Author, 'name'), [])
2788. 
2789.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2790.     def test_alter_field_add_index_to_textfield(self):
2791.         # Create the table and verify no initial indexes.
2792.         with connection.schema_editor() as editor:
2793.             editor.create_model(Note)
2794.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
2795.         # Alter to add db_index=True and create 2 indexes.
2796.         old_field = Note._meta.get_field('info')
2797.         new_field = TextField(db_index=True)
2798.         new_field.set_attributes_from_name('info')
2799.         with connection.schema_editor() as editor:
2800.             editor.alter_field(Note, old_field, new_field, strict=True)
2801.         self.assertEqual(
2802.             self.get_constraints_for_column(Note, 'info'),
2803.             ['schema_note_info_4b0ea695', 'schema_note_info_4b0ea695_like']
2804.         )
2805.         # Remove db_index=True to drop both indexes.
2806.         with connection.schema_editor() as editor:
2807.             editor.alter_field(Note, new_field, old_field, strict=True)
2808.         self.assertEqual(self.get_constraints_for_column(Note, 'info'), [])
2809. 
2810.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2811.     def test_alter_field_add_unique_to_charfield_with_db_index(self):
2812.         # Create the table and verify initial indexes.
2813.         with connection.schema_editor() as editor:
2814.             editor.create_model(BookWithoutAuthor)
2815.         self.assertEqual(
2816.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2817.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2818.         )
2819.         # Alter to add unique=True (should replace the index)
2820.         old_field = BookWithoutAuthor._meta.get_field('title')
2821.         new_field = CharField(max_length=100, db_index=True, unique=True)
2822.         new_field.set_attributes_from_name('title')
2823.         with connection.schema_editor() as editor:
2824.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2825.         self.assertEqual(
2826.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2827.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2828.         )
2829.         # Alter to remove unique=True (should drop unique index)
2830.         new_field2 = CharField(max_length=100, db_index=True)
2831.         new_field2.set_attributes_from_name('title')
2832.         with connection.schema_editor() as editor:
2833.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2834.         self.assertEqual(
2835.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2836.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2837.         )
2838. 
2839.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2840.     def test_alter_field_remove_unique_and_db_index_from_charfield(self):
2841.         # Create the table and verify initial indexes.
2842.         with connection.schema_editor() as editor:
2843.             editor.create_model(BookWithoutAuthor)
2844.         self.assertEqual(
2845.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2846.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2847.         )
2848.         # Alter to add unique=True (should replace the index)
2849.         old_field = BookWithoutAuthor._meta.get_field('title')
2850.         new_field = CharField(max_length=100, db_index=True, unique=True)
2851.         new_field.set_attributes_from_name('title')
2852.         with connection.schema_editor() as editor:
2853.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2854.         self.assertEqual(
2855.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2856.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2857.         )
2858.         # Alter to remove both unique=True and db_index=True (should drop all indexes)
2859.         new_field2 = CharField(max_length=100)
2860.         new_field2.set_attributes_from_name('title')
2861.         with connection.schema_editor() as editor:
2862.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2863.         self.assertEqual(self.get_constraints_for_column(BookWithoutAuthor, 'title'), [])
2864. 
2865.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2866.     def test_alter_field_swap_unique_and_db_index_with_charfield(self):
2867.         # Create the table and verify initial indexes.
2868.         with connection.schema_editor() as editor:
2869.             editor.create_model(BookWithoutAuthor)
2870.         self.assertEqual(
2871.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2872.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2873.         )
2874.         # Alter to set unique=True and remove db_index=True (should replace the index)
2875.         old_field = BookWithoutAuthor._meta.get_field('title')
2876.         new_field = CharField(max_length=100, unique=True)
2877.         new_field.set_attributes_from_name('title')
2878.         with connection.schema_editor() as editor:
2879.             editor.alter_field(BookWithoutAuthor, old_field, new_field, strict=True)
2880.         self.assertEqual(
2881.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2882.             ['schema_book_title_2dfb2dff_like', 'schema_book_title_2dfb2dff_uniq']
2883.         )
2884.         # Alter to set db_index=True and remove unique=True (should restore index)
2885.         new_field2 = CharField(max_length=100, db_index=True)
2886.         new_field2.set_attributes_from_name('title')
2887.         with connection.schema_editor() as editor:
2888.             editor.alter_field(BookWithoutAuthor, new_field, new_field2, strict=True)
2889.         self.assertEqual(
2890.             self.get_constraints_for_column(BookWithoutAuthor, 'title'),
2891.             ['schema_book_title_2dfb2dff', 'schema_book_title_2dfb2dff_like']
2892.         )
2893. 
2894.     @unittest.skipUnless(connection.vendor == 'postgresql', "PostgreSQL specific")
2895.     def test_alter_field_add_db_index_to_charfield_with_unique(self):
2896.         # Create the table and verify initial indexes.
2897.         with connection.schema_editor() as editor:
2898.             editor.create_model(Tag)
2899.         self.assertEqual(
2900.             self.get_constraints_for_column(Tag, 'slug'),
2901.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2902.         )
2903.         # Alter to add db_index=True
2904.         old_field = Tag._meta.get_field('slug')
2905.         new_field = SlugField(db_index=True, unique=True)
2906.         new_field.set_attributes_from_name('slug')
2907.         with connection.schema_editor() as editor:
2908.             editor.alter_field(Tag, old_field, new_field, strict=True)
2909.         self.assertEqual(
2910.             self.get_constraints_for_column(Tag, 'slug'),
2911.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2912.         )
2913.         # Alter to remove db_index=True
2914.         new_field2 = SlugField(unique=True)
2915.         new_field2.set_attributes_from_name('slug')
2916.         with connection.schema_editor() as editor:
2917.             editor.alter_field(Tag, new_field, new_field2, strict=True)
2918.         self.assertEqual(
2919.             self.get_constraints_for_column(Tag, 'slug'),
2920.             ['schema_tag_slug_2c418ba3_like', 'schema_tag_slug_key']
2921.         )
2922. 
2923.     def test_alter_field_add_index_to_integerfield(self):
2924.         # Create the table and verify no initial indexes.
2925.         with connection.schema_editor() as editor:
2926.             editor.create_model(Author)
2927.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
2928. 
2929.         # Alter to add db_index=True and create index.
2930.         old_field = Author._meta.get_field('weight')
2931.         new_field = IntegerField(null=True, db_index=True)
2932.         new_field.set_attributes_from_name('weight')
2933.         with connection.schema_editor() as editor:
2934.             editor.alter_field(Author, old_field, new_field, strict=True)
2935.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), ['schema_author_weight_587740f9'])
2936. 
2937.         # Remove db_index=True to drop index.
2938.         with connection.schema_editor() as editor:
2939.             editor.alter_field(Author, new_field, old_field, strict=True)
2940.         self.assertEqual(self.get_constraints_for_column(Author, 'weight'), [])
2941. 
2942.     def test_alter_pk_with_self_referential_field(self):
2943.         """
2944.         Changing the primary key field name of a model with a self-referential
2945.         foreign key (#26384).
2946.         """
2947.         with connection.schema_editor() as editor:
2948.             editor.create_model(Node)
2949.         old_field = Node._meta.get_field('node_id')
2950.         new_field = AutoField(primary_key=True)
2951.         new_field.set_attributes_from_name('id')
2952.         with connection.schema_editor() as editor:
2953.             editor.alter_field(Node, old_field, new_field, strict=True)
2954.         self.assertForeignKeyExists(Node, 'parent_id', Node._meta.db_table)
2955. 
2956.     @mock.patch('django.db.backends.base.schema.datetime')
2957.     @mock.patch('django.db.backends.base.schema.timezone')
2958.     def test_add_datefield_and_datetimefield_use_effective_default(self, mocked_datetime, mocked_tz):
2959.         """
2960.         effective_default() should be used for DateField, DateTimeField, and
2961.         TimeField if auto_now or auto_now_add is set (#25005).
2962.         """
2963.         now = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1)
2964.         now_tz = datetime.datetime(month=1, day=1, year=2000, hour=1, minute=1, tzinfo=timezone.utc)
2965.         mocked_datetime.now = mock.MagicMock(return_value=now)
2966.         mocked_tz.now = mock.MagicMock(return_value=now_tz)
2967.         # Create the table
2968.         with connection.schema_editor() as editor:
2969.             editor.create_model(Author)
2970.         # Check auto_now/auto_now_add attributes are not defined
2971.         columns = self.column_classes(Author)
2972.         self.assertNotIn("dob_auto_now", columns)
2973.         self.assertNotIn("dob_auto_now_add", columns)
2974.         self.assertNotIn("dtob_auto_now", columns)
2975.         self.assertNotIn("dtob_auto_now_add", columns)
2976.         self.assertNotIn("tob_auto_now", columns)
2977.         self.assertNotIn("tob_auto_now_add", columns)
2978.         # Create a row
2979.         Author.objects.create(name='Anonymous1')
2980.         # Ensure fields were added with the correct defaults
2981.         dob_auto_now = DateField(auto_now=True)
2982.         dob_auto_now.set_attributes_from_name('dob_auto_now')
2983.         self.check_added_field_default(
2984.             editor, Author, dob_auto_now, 'dob_auto_now', now.date(),
2985.             cast_function=lambda x: x.date(),
2986.         )
2987.         dob_auto_now_add = DateField(auto_now_add=True)
2988.         dob_auto_now_add.set_attributes_from_name('dob_auto_now_add')
2989.         self.check_added_field_default(
2990.             editor, Author, dob_auto_now_add, 'dob_auto_now_add', now.date(),
2991.             cast_function=lambda x: x.date(),
2992.         )
2993.         dtob_auto_now = DateTimeField(auto_now=True)
2994.         dtob_auto_now.set_attributes_from_name('dtob_auto_now')
2995.         self.check_added_field_default(
2996.             editor, Author, dtob_auto_now, 'dtob_auto_now', now,
2997.         )
2998.         dt_tm_of_birth_auto_now_add = DateTimeField(auto_now_add=True)
2999.         dt_tm_of_birth_auto_now_add.set_attributes_from_name('dtob_auto_now_add')
3000.         self.check_added_field_default(
3001.             editor, Author, dt_tm_of_birth_auto_now_add, 'dtob_auto_now_add', now,
3002.         )
3003.         tob_auto_now = TimeField(auto_now=True)
3004.         tob_auto_now.set_attributes_from_name('tob_auto_now')
3005.         self.check_added_field_default(
3006.             editor, Author, tob_auto_now, 'tob_auto_now', now.time(),
3007.             cast_function=lambda x: x.time(),
3008.         )
3009.         tob_auto_now_add = TimeField(auto_now_add=True)
3010.         tob_auto_now_add.set_attributes_from_name('tob_auto_now_add')
3011.         self.check_added_field_default(
3012.             editor, Author, tob_auto_now_add, 'tob_auto_now_add', now.time(),
3013.             cast_function=lambda x: x.time(),
3014.         )
3015. 
3016.     def test_namespaced_db_table_create_index_name(self):
3017.         """
3018.         Table names are stripped of their namespace/schema before being used to
3019.         generate index names.
3020.         """
3021.         with connection.schema_editor() as editor:
3022.             max_name_length = connection.ops.max_name_length() or 200
3023.             namespace = 'n' * max_name_length
3024.             table_name = 't' * max_name_length
3025.             namespaced_table_name = '"%s"."%s"' % (namespace, table_name)
3026.             self.assertEqual(
3027.                 editor._create_index_name(table_name, []),
3028.                 editor._create_index_name(namespaced_table_name, []),
3029.             )
3030. 
3031.     @unittest.skipUnless(connection.vendor == 'oracle', 'Oracle specific db_table syntax')
3032.     def test_creation_with_db_table_double_quotes(self):
3033.         oracle_user = connection.creation._test_database_user()
3034. 
3035.         class Student(Model):
3036.             name = CharField(max_length=30)
3037. 
3038.             class Meta:
3039.                 app_label = 'schema'
3040.                 apps = new_apps
3041.                 db_table = '"%s"."DJANGO_STUDENT_TABLE"' % oracle_user
3042. 
3043.         class Document(Model):
3044.             name = CharField(max_length=30)
3045.             students = ManyToManyField(Student)
3046. 
3047.             class Meta:
3048.                 app_label = 'schema'
3049.                 apps = new_apps
3050.                 db_table = '"%s"."DJANGO_DOCUMENT_TABLE"' % oracle_user
3051. 
3052.         self.local_models = [Student, Document]
3053. 
3054.         with connection.schema_editor() as editor:
3055.             editor.create_model(Student)
3056.             editor.create_model(Document)
3057. 
3058.         doc = Document.objects.create(name='Test Name')
3059.         student = Student.objects.create(name='Some man')
3060.         doc.students.add(student)
3061. 
3062.     def test_rename_table_renames_deferred_sql_references(self):
3063.         atomic_rename = connection.features.supports_atomic_references_rename
3064.         with connection.schema_editor(atomic=atomic_rename) as editor:
3065.             editor.create_model(Author)
3066.             editor.create_model(Book)
3067.             editor.alter_db_table(Author, 'schema_author', 'schema_renamed_author')
3068.             editor.alter_db_table(Author, 'schema_book', 'schema_renamed_book')
3069.             self.assertGreater(len(editor.deferred_sql), 0)
3070.             for statement in editor.deferred_sql:
3071.                 self.assertIs(statement.references_table('schema_author'), False)
3072.                 self.assertIs(statement.references_table('schema_book'), False)
3073. 
3074.     @unittest.skipIf(connection.vendor == 'sqlite', 'SQLite naively remakes the table on field alteration.')
3075.     def test_rename_column_renames_deferred_sql_references(self):
3076.         with connection.schema_editor() as editor:
3077.             editor.create_model(Author)
3078.             editor.create_model(Book)
3079.             old_title = Book._meta.get_field('title')
3080.             new_title = CharField(max_length=100, db_index=True)
3081.             new_title.set_attributes_from_name('renamed_title')
3082.             editor.alter_field(Book, old_title, new_title)
3083.             old_author = Book._meta.get_field('author')
3084.             new_author = ForeignKey(Author, CASCADE)
3085.             new_author.set_attributes_from_name('renamed_author')
3086.             editor.alter_field(Book, old_author, new_author)
3087.             self.assertGreater(len(editor.deferred_sql), 0)
3088.             for statement in editor.deferred_sql:
3089.                 self.assertIs(statement.references_column('book', 'title'), False)
3090.                 self.assertIs(statement.references_column('book', 'author_id'), False)
3091. 
3092.     @isolate_apps('schema')
3093.     def test_referenced_field_without_constraint_rename_inside_atomic_block(self):
3094.         """
3095.         Foreign keys without database level constraint don't prevent the field
3096.         they reference from being renamed in an atomic block.
3097.         """
3098.         class Foo(Model):
3099.             field = CharField(max_length=255, unique=True)
3100. 
3101.             class Meta:
3102.                 app_label = 'schema'
3103. 
3104.         class Bar(Model):
3105.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3106. 
3107.             class Meta:
3108.                 app_label = 'schema'
3109. 
3110.         self.isolated_local_models = [Foo, Bar]
3111.         with connection.schema_editor() as editor:
3112.             editor.create_model(Foo)
3113.             editor.create_model(Bar)
3114. 
3115.         new_field = CharField(max_length=255, unique=True)
3116.         new_field.set_attributes_from_name('renamed')
3117.         with connection.schema_editor(atomic=True) as editor:
3118.             editor.alter_field(Foo, Foo._meta.get_field('field'), new_field)
3119. 
3120.     @isolate_apps('schema')
3121.     def test_referenced_table_without_constraint_rename_inside_atomic_block(self):
3122.         """
3123.         Foreign keys without database level constraint don't prevent the table
3124.         they reference from being renamed in an atomic block.
3125.         """
3126.         class Foo(Model):
3127.             field = CharField(max_length=255, unique=True)
3128. 
3129.             class Meta:
3130.                 app_label = 'schema'
3131. 
3132.         class Bar(Model):
3133.             foo = ForeignKey(Foo, CASCADE, to_field='field', db_constraint=False)
3134. 
3135.             class Meta:
3136.                 app_label = 'schema'
3137. 
3138.         self.isolated_local_models = [Foo, Bar]
3139.         with connection.schema_editor() as editor:
3140.             editor.create_model(Foo)
3141.             editor.create_model(Bar)
3142. 
3143.         new_field = CharField(max_length=255, unique=True)
3144.         new_field.set_attributes_from_name('renamed')
3145.         with connection.schema_editor(atomic=True) as editor:
3146.             editor.alter_db_table(Foo, Foo._meta.db_table, 'renamed_table')
3147.         Foo._meta.db_table = 'renamed_table'

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 18:36:54,798 - thread-128317336323776.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have analyzed the user's request and the provided context. The context includes the main test file `tests/schema/tests.py` and the corresponding models file `tests/schema/models.py`. These files contain tests for `index_together` and `unique_together`, which are the features involved in the bug. Specifically, I've found tests for `alter_index_together` and `alter_unique_together`, and even a test for interaction between `index_together` and `Meta.indexes`, which is conceptually similar to the reported bug. Therefore, I have sufficient information to select the three most relevant test cases and do not need additional context." query='' extra_requirements='' purpose=''
2025-12-21 18:36:54,799 - thread-128317336323776.prometheus_context_collector - INFO - Successfully retrieved 2 context snippets
