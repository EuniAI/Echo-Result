2025-12-23 11:26:39,052 - thread-139573954868928.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: LaTeX: new Inline code highlighting from #10251 adds whitespace at start and end in pdf output

Description: ### Describe the bug

The #10251 enhancement activates syntax highlighting for the Docutiles `code` role. For LaTeX output, a space character is inserted at start and end of the inline code.

Example
```
Inline \sphinxcode{\sphinxupquote{ <--- this produces a space in output
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass} <-- here also
}} code block

```

a priori, mark-up should be:
```
Inline \sphinxcode{\sphinxupquote{%
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass}%
}} code block
```

But I have no no strong opinion if good or bad. See screenshots.

### How to Reproduce

```
.. role:: python(code)
   :language: python
   :class: highlight

Inline :python:`def foo(1 + 2 + None + "abc"): pass` code block

.. code-block:: python

   def foo(1 + 2 + None + "abc"): pass
```

in `index.rst` and `make latexpdf`.

### Expected behavior

_No response_

### Your project

extracted from test_build_latex.py

### Screenshots

with current:

![Capture d’écran 2022-05-08 à 11 11 08](https://user-images.githubusercontent.com/2589111/167289522-fca10320-7df4-439a-9da9-2dbff5a64496.png)

if space characters removed from `.tex` file produced by LaTeX writer:

![Capture d’écran 2022-05-08 à 11 10 32](https://user-images.githubusercontent.com/2589111/167289536-5643529b-4be5-4848-bcde-b1404fe37e5d.png)

For comparison prior to #10251 merge:
![Capture d’écran 2022-05-08 à 11 21 08](https://user-images.githubusercontent.com/2589111/167289864-0773fcef-4a80-42e8-94f9-4da02bc90c68.png)

### OS

Mac

### Python version

3.9

### Sphinx version

5.x

### Sphinx extensions

_No response_

### Extra tools

_No response_

### Additional context

Relates #10251

Patch information:
diff --git a/sphinx/writers/latex.py b/sphinx/writers/latex.py
index e0c7d56f8..a8630b2dd 100644
--- a/sphinx/writers/latex.py
+++ b/sphinx/writers/latex.py
@@ -1711,8 +1711,17 @@ class LaTeXTranslator(SphinxTranslator):
         # https://github.com/pygments/pygments/pull/1343
         hlcode = hlcode.replace(r'\begin{Verbatim}[commandchars=\\\{\}]',
                                 r'\sphinxcode{\sphinxupquote{')
+        # remove the newline immediately after the replaced begin to avoid leading space
+        prefix = r'\sphinxcode{\sphinxupquote{'
+        if hlcode.startswith(prefix):
+            pos = len(prefix)
+            if len(hlcode) > pos and hlcode[pos] in ('\n', '\r'):
+                hlcode = hlcode[:pos] + hlcode[pos + 1:]
         # get consistent trailer
         hlcode = hlcode.rstrip()[:-14]  # strip \end{Verbatim}
+        # remove a single trailing newline before closing braces to avoid trailing space
+        if hlcode.endswith('\n'):
+            hlcode = hlcode[:-1]
         self.body.append(hlcode)
         self.body.append('}}')
         raise nodes.SkipNode


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 11:26:39,111 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── create-release.yml
|       ├── docutils-latest.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── automatic-doc-generation.rst
|   |   ├── deploying.rst
|   |   ├── describing-code.rst
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── _sphinx_javascript_frameworks_compat.js
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-duplicates
|   |   |   └── fish_licence
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── dedent.rst
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_class_module.py
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-extlinks-hardcoded-urls
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-extlinks-hardcoded-urls-multiple-replacements
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-intersphinx-role
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── noqa.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-documents_exclude
|   |   |   ├── br0ken_link.rst
|   |   |   ├── broken_link.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-reST-code-role
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_extlinks.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_extension.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── babel_runner.py
    ├── bump_docker.sh
    ├── bump_version.py
    └── doclinter.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: LaTeX: new Inline code highlighting from #10251 adds whitespace at start and end in pdf output

Description: ### Describe the bug

The #10251 enhancement activates syntax highlighting for the Docutiles `code` role. For LaTeX output, a space character is inserted at start and end of the inline code.

Example
```
Inline \sphinxcode{\sphinxupquote{ <--- this produces a space in output
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass} <-- here also
}} code block

```

a priori, mark-up should be:
```
Inline \sphinxcode{\sphinxupquote{%
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass}%
}} code block
```

But I have no no strong opinion if good or bad. See screenshots.

### How to Reproduce

```
.. role:: python(code)
   :language: python
   :class: highlight

Inline :python:`def foo(1 + 2 + None + "abc"): pass` code block

.. code-block:: python

   def foo(1 + 2 + None + "abc"): pass
```

in `index.rst` and `make latexpdf`.

### Expected behavior

_No response_

### Your project

extracted from test_build_latex.py

### Screenshots

with current:

![Capture d’écran 2022-05-08 à 11 11 08](https://user-images.githubusercontent.com/2589111/167289522-fca10320-7df4-439a-9da9-2dbff5a64496.png)

if space characters removed from `.tex` file produced by LaTeX writer:

![Capture d’écran 2022-05-08 à 11 10 32](https://user-images.githubusercontent.com/2589111/167289536-5643529b-4be5-4848-bcde-b1404fe37e5d.png)

For comparison prior to #10251 merge:
![Capture d’écran 2022-05-08 à 11 21 08](https://user-images.githubusercontent.com/2589111/167289864-0773fcef-4a80-42e8-94f9-4da02bc90c68.png)

### OS

Mac

### Python version

3.9

### Sphinx version

5.x

### Sphinx extensions

_No response_

### Extra tools

_No response_

### Additional context

Relates #10251

Patch information:
diff --git a/sphinx/writers/latex.py b/sphinx/writers/latex.py
index e0c7d56f8..a8630b2dd 100644
--- a/sphinx/writers/latex.py
+++ b/sphinx/writers/latex.py
@@ -1711,8 +1711,17 @@ class LaTeXTranslator(SphinxTranslator):
         # https://github.com/pygments/pygments/pull/1343
         hlcode = hlcode.replace(r'\begin{Verbatim}[commandchars=\\\{\}]',
                                 r'\sphinxcode{\sphinxupquote{')
+        # remove the newline immediately after the replaced begin to avoid leading space
+        prefix = r'\sphinxcode{\sphinxupquote{'
+        if hlcode.startswith(prefix):
+            pos = len(prefix)
+            if len(hlcode) > pos and hlcode[pos] in ('\n', '\r'):
+                hlcode = hlcode[:pos] + hlcode[pos + 1:]
         # get consistent trailer
         hlcode = hlcode.rstrip()[:-14]  # strip \end{Verbatim}
+        # remove a single trailing newline before closing braces to avoid trailing space
+        if hlcode.endswith('\n'):
+            hlcode = hlcode[:-1]
         self.body.append(hlcode)
         self.body.append('}}')
         raise nodes.SkipNode


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 11:26:57,840 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to a LaTeX output bug. To identify the most relevant tests, I need the content of the main test file for the LaTeX builder, `tests/test_build_latex.py`. I also need the content of `sphinx/writers/latex.py` to understand the code that is being tested and patched, specifically how it handles inline code and literal blocks.' query='Please provide the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`.' extra_requirements='' purpose='This information is essential to find 3 relevant test cases that demonstrate the reported bug or similar functionality, as requested by the user.'
2025-12-23 11:26:57,841 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`.
2025-12-23 11:26:57,841 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 11:26:57,842 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 11:26:57,843 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 11:26:57,843 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`.
Purpose: This information is essential to find 3 relevant test cases that demonstrate the reported bug or similar functionality, as requested by the user.
2025-12-23 11:27:01,227 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the contents of `tests/test_build_latex.py` and `sphinx/writers/latex.py`. This will allow me to analyze the test cases and the writer's implementation to identify relevant examples for the user's query. The full file contents are now available for inspection." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sphinx/writers/latex.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2093, 'candidates_token_count': 107, 'total_token_count': 2393, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2093}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 107}], 'thoughts_token_count': 193, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.16020790884427935, 'model_name': 'gemini-2.5-pro'} id='run--145f43f6-d9a7-46fc-b4ea-1a77c9af530d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_build_latex.py'}, 'id': '458f5b41-b21c-47ac-bc3d-7a126c7de297', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sphinx/writers/latex.py'}, 'id': '80b00dd8-0dad-4819-a019-cda0ed246f93', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2093, 'output_tokens': 107, 'total_tokens': 2393, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 193}}
2025-12-23 11:27:08,107 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`. After analyzing the test file, I have identified three relevant test cases that can help in understanding and debugging the reported issue. These tests cover various aspects of LaTeX output, including the handling of figures, tables, and numbering, which are likely to be related to the user's problem." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19771, 'candidates_token_count': 85, 'total_token_count': 20306, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19771}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 85}], 'thoughts_token_count': 450, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.6568832846248851, 'model_name': 'gemini-2.5-pro'} id='run--5e9afbda-e41d-4392-9793-c26317ee362b-0' usage_metadata={'input_tokens': 19771, 'output_tokens': 85, 'total_tokens': 20306, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 450}}
2025-12-23 11:27:08,109 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
This information is essential to find 3 relevant test cases that demonstrate the reported bug or similar functionality, as requested by the user.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sphinx/writers/latex.py
Line number range: 1 - 500
Content:
1. """Custom docutils writer for LaTeX.
2. 
3. Much of this code is adapted from Dave Kuhlman's "docpy" writer from his
4. docutils sandbox.
5. """
6. 
7. import re
8. import warnings
9. from collections import defaultdict
10. from os import path
11. from typing import TYPE_CHECKING, Any, Dict, Iterable, List, Set, Tuple, cast
12. 
13. from docutils import nodes, writers
14. from docutils.nodes import Element, Node, Text
15. 
16. from sphinx import addnodes, highlighting
17. from sphinx.deprecation import RemovedInSphinx70Warning
18. from sphinx.domains import IndexEntry
19. from sphinx.domains.std import StandardDomain
20. from sphinx.errors import SphinxError
21. from sphinx.locale import _, __, admonitionlabels
22. from sphinx.util import logging, split_into, texescape
23. from sphinx.util.docutils import SphinxTranslator
24. from sphinx.util.nodes import clean_astext, get_prev_node
25. from sphinx.util.template import LaTeXRenderer
26. from sphinx.util.texescape import tex_replace_map
27. 
28. try:
29.     from docutils.utils.roman import toRoman
30. except ImportError:
31.     # In Debian/Ubuntu, roman package is provided as roman, not as docutils.utils.roman
32.     from roman import toRoman  # type: ignore
33. 
34. if TYPE_CHECKING:
35.     from sphinx.builders.latex import LaTeXBuilder
36.     from sphinx.builders.latex.theming import Theme
37. 
38. 
39. logger = logging.getLogger(__name__)
40. 
41. MAX_CITATION_LABEL_LENGTH = 8
42. LATEXSECTIONNAMES = ["part", "chapter", "section", "subsection",
43.                      "subsubsection", "paragraph", "subparagraph"]
44. ENUMERATE_LIST_STYLE = defaultdict(lambda: r'\arabic',
45.                                    {
46.                                        'arabic': r'\arabic',
47.                                        'loweralpha': r'\alph',
48.                                        'upperalpha': r'\Alph',
49.                                        'lowerroman': r'\roman',
50.                                        'upperroman': r'\Roman',
51.                                    })
52. 
53. CR = '\n'
54. BLANKLINE = '\n\n'
55. EXTRA_RE = re.compile(r'^(.*\S)\s+\(([^()]*)\)\s*$')
56. 
57. 
58. class collected_footnote(nodes.footnote):
59.     """Footnotes that are collected are assigned this class."""
60. 
61. 
62. class UnsupportedError(SphinxError):
63.     category = 'Markup is unsupported in LaTeX'
64. 
65. 
66. class LaTeXWriter(writers.Writer):
67. 
68.     supported = ('sphinxlatex',)
69. 
70.     settings_spec = ('LaTeX writer options', '', (
71.         ('Document name', ['--docname'], {'default': ''}),
72.         ('Document class', ['--docclass'], {'default': 'manual'}),
73.         ('Author', ['--author'], {'default': ''}),
74.     ))
75.     settings_defaults: Dict = {}
76. 
77.     output = None
78. 
79.     def __init__(self, builder: "LaTeXBuilder") -> None:
80.         super().__init__()
81.         self.builder = builder
82.         self.theme: Theme = None
83. 
84.     def translate(self) -> None:
85.         visitor = self.builder.create_translator(self.document, self.builder, self.theme)
86.         self.document.walkabout(visitor)
87.         self.output = cast(LaTeXTranslator, visitor).astext()
88. 
89. 
90. # Helper classes
91. 
92. class Table:
93.     """A table data"""
94. 
95.     def __init__(self, node: Element) -> None:
96.         self.header: List[str] = []
97.         self.body: List[str] = []
98.         self.align = node.get('align', 'default')
99.         self.classes: List[str] = node.get('classes', [])
100.         self.colcount = 0
101.         self.colspec: str = None
102.         self.colwidths: List[int] = []
103.         self.has_problematic = False
104.         self.has_oldproblematic = False
105.         self.has_verbatim = False
106.         self.caption: List[str] = None
107.         self.stubs: List[int] = []
108. 
109.         # current position
110.         self.col = 0
111.         self.row = 0
112. 
113.         # A dict mapping a table location to a cell_id (cell = rectangular area)
114.         self.cells: Dict[Tuple[int, int], int] = defaultdict(int)
115.         self.cell_id = 0  # last assigned cell_id
116. 
117.     def is_longtable(self) -> bool:
118.         """True if and only if table uses longtable environment."""
119.         return self.row > 30 or 'longtable' in self.classes
120. 
121.     def get_table_type(self) -> str:
122.         """Returns the LaTeX environment name for the table.
123. 
124.         The class currently supports:
125. 
126.         * longtable
127.         * tabular
128.         * tabulary
129.         """
130.         if self.is_longtable():
131.             return 'longtable'
132.         elif self.has_verbatim:
133.             return 'tabular'
134.         elif self.colspec:
135.             return 'tabulary'
136.         elif self.has_problematic or (self.colwidths and 'colwidths-given' in self.classes):
137.             return 'tabular'
138.         else:
139.             return 'tabulary'
140. 
141.     def get_colspec(self) -> str:
142.         """Returns a column spec of table.
143. 
144.         This is what LaTeX calls the 'preamble argument' of the used table environment.
145. 
146.         .. note:: the ``\\X`` and ``T`` column type specifiers are defined in ``sphinx.sty``.
147.         """
148.         if self.colspec:
149.             return self.colspec
150.         elif self.colwidths and 'colwidths-given' in self.classes:
151.             total = sum(self.colwidths)
152.             colspecs = [r'\X{%d}{%d}' % (width, total) for width in self.colwidths]
153.             return '{|%s|}' % '|'.join(colspecs) + CR
154.         elif self.has_problematic:
155.             return r'{|*{%d}{\X{1}{%d}|}}' % (self.colcount, self.colcount) + CR
156.         elif self.get_table_type() == 'tabulary':
157.             # sphinx.sty sets T to be J by default.
158.             return '{|' + ('T|' * self.colcount) + '}' + CR
159.         elif self.has_oldproblematic:
160.             return r'{|*{%d}{\X{1}{%d}|}}' % (self.colcount, self.colcount) + CR
161.         else:
162.             return '{|' + ('l|' * self.colcount) + '}' + CR
163. 
164.     def add_cell(self, height: int, width: int) -> None:
165.         """Adds a new cell to a table.
166. 
167.         It will be located at current position: (``self.row``, ``self.col``).
168.         """
169.         self.cell_id += 1
170.         for col in range(width):
171.             for row in range(height):
172.                 assert self.cells[(self.row + row, self.col + col)] == 0
173.                 self.cells[(self.row + row, self.col + col)] = self.cell_id
174. 
175.     def cell(self, row: int = None, col: int = None) -> "TableCell":
176.         """Returns a cell object (i.e. rectangular area) containing given position.
177. 
178.         If no option arguments: ``row`` or ``col`` are given, the current position;
179.         ``self.row`` and ``self.col`` are used to get a cell object by default.
180.         """
181.         try:
182.             if row is None:
183.                 row = self.row
184.             if col is None:
185.                 col = self.col
186.             return TableCell(self, row, col)
187.         except IndexError:
188.             return None
189. 
190. 
191. class TableCell:
192.     """Data of a cell in a table."""
193. 
194.     def __init__(self, table: Table, row: int, col: int) -> None:
195.         if table.cells[(row, col)] == 0:
196.             raise IndexError
197. 
198.         self.table = table
199.         self.cell_id = table.cells[(row, col)]
200.         self.row = row
201.         self.col = col
202. 
203.         # adjust position for multirow/multicol cell
204.         while table.cells[(self.row - 1, self.col)] == self.cell_id:
205.             self.row -= 1
206.         while table.cells[(self.row, self.col - 1)] == self.cell_id:
207.             self.col -= 1
208. 
209.     @property
210.     def width(self) -> int:
211.         """Returns the cell width."""
212.         width = 0
213.         while self.table.cells[(self.row, self.col + width)] == self.cell_id:
214.             width += 1
215.         return width
216. 
217.     @property
218.     def height(self) -> int:
219.         """Returns the cell height."""
220.         height = 0
221.         while self.table.cells[(self.row + height, self.col)] == self.cell_id:
222.             height += 1
223.         return height
224. 
225. 
226. def escape_abbr(text: str) -> str:
227.     """Adjust spacing after abbreviations."""
228.     return re.sub(r'\.(?=\s|$)', r'.\@', text)
229. 
230. 
231. def rstdim_to_latexdim(width_str: str, scale: int = 100) -> str:
232.     """Convert `width_str` with rst length to LaTeX length."""
233.     match = re.match(r'^(\d*\.?\d*)\s*(\S*)$', width_str)
234.     if not match:
235.         raise ValueError
236.     res = width_str
237.     amount, unit = match.groups()[:2]
238.     if scale == 100:
239.         float(amount)  # validate amount is float
240.         if unit in ('', "px"):
241.             res = r"%s\sphinxpxdimen" % amount
242.         elif unit == 'pt':
243.             res = '%sbp' % amount  # convert to 'bp'
244.         elif unit == "%":
245.             res = r"%.3f\linewidth" % (float(amount) / 100.0)
246.     else:
247.         amount_float = float(amount) * scale / 100.0
248.         if unit in ('', "px"):
249.             res = r"%.5f\sphinxpxdimen" % amount_float
250.         elif unit == 'pt':
251.             res = '%.5fbp' % amount_float
252.         elif unit == "%":
253.             res = r"%.5f\linewidth" % (amount_float / 100.0)
254.         else:
255.             res = "%.5f%s" % (amount_float, unit)
256.     return res
257. 
258. 
259. class LaTeXTranslator(SphinxTranslator):
260.     builder: "LaTeXBuilder" = None
261. 
262.     secnumdepth = 2  # legacy sphinxhowto.cls uses this, whereas article.cls
263.     # default is originally 3. For book/report, 2 is already LaTeX default.
264.     ignore_missing_images = False
265. 
266.     def __init__(self, document: nodes.document, builder: "LaTeXBuilder",
267.                  theme: "Theme") -> None:
268.         super().__init__(document, builder)
269.         self.body: List[str] = []
270.         self.theme = theme
271. 
272.         # flags
273.         self.in_title = 0
274.         self.in_production_list = 0
275.         self.in_footnote = 0
276.         self.in_caption = 0
277.         self.in_term = 0
278.         self.needs_linetrimming = 0
279.         self.in_minipage = 0
280.         self.no_latex_floats = 0
281.         self.first_document = 1
282.         self.this_is_the_title = 1
283.         self.literal_whitespace = 0
284.         self.in_parsed_literal = 0
285.         self.compact_list = 0
286.         self.first_param = 0
287.         self.in_desc_signature = False
288. 
289.         sphinxpkgoptions = []
290. 
291.         # sort out some elements
292.         self.elements = self.builder.context.copy()
293. 
294.         # initial section names
295.         self.sectionnames = LATEXSECTIONNAMES[:]
296.         if self.theme.toplevel_sectioning == 'section':
297.             self.sectionnames.remove('chapter')
298. 
299.         # determine top section level
300.         self.top_sectionlevel = 1
301.         if self.config.latex_toplevel_sectioning:
302.             try:
303.                 self.top_sectionlevel = \
304.                     self.sectionnames.index(self.config.latex_toplevel_sectioning)
305.             except ValueError:
306.                 logger.warning(__('unknown %r toplevel_sectioning for class %r') %
307.                                (self.config.latex_toplevel_sectioning, self.theme.docclass))
308. 
309.         if self.config.numfig:
310.             self.numfig_secnum_depth = self.config.numfig_secnum_depth
311.             if self.numfig_secnum_depth > 0:  # default is 1
312.                 # numfig_secnum_depth as passed to sphinx.sty indices same names as in
313.                 # LATEXSECTIONNAMES but with -1 for part, 0 for chapter, 1 for section...
314.                 if len(self.sectionnames) < len(LATEXSECTIONNAMES) and \
315.                    self.top_sectionlevel > 0:
316.                     self.numfig_secnum_depth += self.top_sectionlevel
317.                 else:
318.                     self.numfig_secnum_depth += self.top_sectionlevel - 1
319.                 # this (minus one) will serve as minimum to LaTeX's secnumdepth
320.                 self.numfig_secnum_depth = min(self.numfig_secnum_depth,
321.                                                len(LATEXSECTIONNAMES) - 1)
322.                 # if passed key value is < 1 LaTeX will act as if 0; see sphinx.sty
323.                 sphinxpkgoptions.append('numfigreset=%s' % self.numfig_secnum_depth)
324.             else:
325.                 sphinxpkgoptions.append('nonumfigreset')
326. 
327.         if self.config.numfig and self.config.math_numfig:
328.             sphinxpkgoptions.append('mathnumfig')
329. 
330.         if (self.config.language not in {'en', 'ja'} and
331.                 'fncychap' not in self.config.latex_elements):
332.             # use Sonny style if any language specified (except English)
333.             self.elements['fncychap'] = (r'\usepackage[Sonny]{fncychap}' + CR +
334.                                          r'\ChNameVar{\Large\normalfont\sffamily}' + CR +
335.                                          r'\ChTitleVar{\Large\normalfont\sffamily}')
336. 
337.         self.babel = self.builder.babel
338.         if not self.babel.is_supported_language():
339.             # emit warning if specified language is invalid
340.             # (only emitting, nothing changed to processing)
341.             logger.warning(__('no Babel option known for language %r'),
342.                            self.config.language)
343. 
344.         minsecnumdepth = self.secnumdepth  # 2 from legacy sphinx manual/howto
345.         if self.document.get('tocdepth'):
346.             # reduce tocdepth if `part` or `chapter` is used for top_sectionlevel
347.             #   tocdepth = -1: show only parts
348.             #   tocdepth =  0: show parts and chapters
349.             #   tocdepth =  1: show parts, chapters and sections
350.             #   tocdepth =  2: show parts, chapters, sections and subsections
351.             #   ...
352.             tocdepth = self.document.get('tocdepth', 999) + self.top_sectionlevel - 2
353.             if len(self.sectionnames) < len(LATEXSECTIONNAMES) and \
354.                self.top_sectionlevel > 0:
355.                 tocdepth += 1  # because top_sectionlevel is shifted by -1
356.             if tocdepth > len(LATEXSECTIONNAMES) - 2:  # default is 5 <-> subparagraph
357.                 logger.warning(__('too large :maxdepth:, ignored.'))
358.                 tocdepth = len(LATEXSECTIONNAMES) - 2
359. 
360.             self.elements['tocdepth'] = r'\setcounter{tocdepth}{%d}' % tocdepth
361.             minsecnumdepth = max(minsecnumdepth, tocdepth)
362. 
363.         if self.config.numfig and (self.config.numfig_secnum_depth > 0):
364.             minsecnumdepth = max(minsecnumdepth, self.numfig_secnum_depth - 1)
365. 
366.         if minsecnumdepth > self.secnumdepth:
367.             self.elements['secnumdepth'] = r'\setcounter{secnumdepth}{%d}' %\
368.                                            minsecnumdepth
369. 
370.         contentsname = document.get('contentsname')
371.         if contentsname:
372.             self.elements['contentsname'] = self.babel_renewcommand(r'\contentsname',
373.                                                                     contentsname)
374. 
375.         if self.elements['maxlistdepth']:
376.             sphinxpkgoptions.append('maxlistdepth=%s' % self.elements['maxlistdepth'])
377.         if sphinxpkgoptions:
378.             self.elements['sphinxpkgoptions'] = '[,%s]' % ','.join(sphinxpkgoptions)
379.         if self.elements['sphinxsetup']:
380.             self.elements['sphinxsetup'] = (r'\sphinxsetup{%s}' % self.elements['sphinxsetup'])
381.         if self.elements['extraclassoptions']:
382.             self.elements['classoptions'] += ',' + \
383.                                              self.elements['extraclassoptions']
384. 
385.         self.highlighter = highlighting.PygmentsBridge('latex', self.config.pygments_style,
386.                                                        latex_engine=self.config.latex_engine)
387.         self.context: List[Any] = []
388.         self.descstack: List[str] = []
389.         self.tables: List[Table] = []
390.         self.next_table_colspec: str = None
391.         self.bodystack: List[List[str]] = []
392.         self.footnote_restricted: Element = None
393.         self.pending_footnotes: List[nodes.footnote_reference] = []
394.         self.curfilestack: List[str] = []
395.         self.handled_abbrs: Set[str] = set()
396. 
397.     def pushbody(self, newbody: List[str]) -> None:
398.         self.bodystack.append(self.body)
399.         self.body = newbody
400. 
401.     def popbody(self) -> List[str]:
402.         body = self.body
403.         self.body = self.bodystack.pop()
404.         return body
405. 
406.     def astext(self) -> str:
407.         self.elements.update({
408.             'body': ''.join(self.body),
409.             'indices': self.generate_indices()
410.         })
411.         return self.render('latex.tex_t', self.elements)
412. 
413.     def hypertarget(self, id: str, withdoc: bool = True, anchor: bool = True) -> str:
414.         if withdoc:
415.             id = self.curfilestack[-1] + ':' + id
416.         return (r'\phantomsection' if anchor else '') + r'\label{%s}' % self.idescape(id)
417. 
418.     def hypertarget_to(self, node: Element, anchor: bool = False) -> str:
419.         labels = ''.join(self.hypertarget(node_id, anchor=False) for node_id in node['ids'])
420.         if anchor:
421.             return r'\phantomsection' + labels
422.         else:
423.             return labels
424. 
425.     def hyperlink(self, id: str) -> str:
426.         return r'{\hyperref[%s]{' % self.idescape(id)
427. 
428.     def hyperpageref(self, id: str) -> str:
429.         return r'\autopageref*{%s}' % self.idescape(id)
430. 
431.     def escape(self, s: str) -> str:
432.         return texescape.escape(s, self.config.latex_engine)
433. 
434.     def idescape(self, id: str) -> str:
435.         return r'\detokenize{%s}' % str(id).translate(tex_replace_map).\
436.             encode('ascii', 'backslashreplace').decode('ascii').\
437.             replace('\\', '_')
438. 
439.     def babel_renewcommand(self, command: str, definition: str) -> str:
440.         if self.elements['multilingual']:
441.             prefix = r'\addto\captions%s{' % self.babel.get_language()
442.             suffix = '}'
443.         else:  # babel is disabled (mainly for Japanese environment)
444.             prefix = ''
445.             suffix = ''
446. 
447.         return r'%s\renewcommand{%s}{%s}%s' % (prefix, command, definition, suffix) + CR
448. 
449.     def generate_indices(self) -> str:
450.         def generate(content: List[Tuple[str, List[IndexEntry]]], collapsed: bool) -> None:
451.             ret.append(r'\begin{sphinxtheindex}' + CR)
452.             ret.append(r'\let\bigletter\sphinxstyleindexlettergroup' + CR)
453.             for i, (letter, entries) in enumerate(content):
454.                 if i > 0:
455.                     ret.append(r'\indexspace' + CR)
456.                 ret.append(r'\bigletter{%s}' % self.escape(letter) + CR)
457.                 for entry in entries:
458.                     if not entry[3]:
459.                         continue
460.                     ret.append(r'\item\relax\sphinxstyleindexentry{%s}' %
461.                                self.encode(entry[0]))
462.                     if entry[4]:
463.                         # add "extra" info
464.                         ret.append(r'\sphinxstyleindexextra{%s}' % self.encode(entry[4]))
465.                     ret.append(r'\sphinxstyleindexpageref{%s:%s}' %
466.                                (entry[2], self.idescape(entry[3])) + CR)
467.             ret.append(r'\end{sphinxtheindex}' + CR)
468. 
469.         ret = []
470.         # latex_domain_indices can be False/True or a list of index names
471.         indices_config = self.config.latex_domain_indices
472.         if indices_config:
473.             for domain in self.builder.env.domains.values():
474.                 for indexcls in domain.indices:
475.                     indexname = '%s-%s' % (domain.name, indexcls.name)
476.                     if isinstance(indices_config, list):
477.                         if indexname not in indices_config:
478.                             continue
479.                     content, collapsed = indexcls(domain).generate(
480.                         self.builder.docnames)
481.                     if not content:
482.                         continue
483.                     ret.append(r'\renewcommand{\indexname}{%s}' % indexcls.localname + CR)
484.                     generate(content, collapsed)
485. 
486.         return ''.join(ret)
487. 
488.     def render(self, template_name: str, variables: Dict) -> str:
489.         renderer = LaTeXRenderer(latex_engine=self.config.latex_engine)
490.         for template_dir in self.config.templates_path:
491.             template = path.join(self.builder.confdir, template_dir,
492.                                  template_name)
493.             if path.exists(template):
494.                 return renderer.render(template, variables)
495. 
496.         return renderer.render(template_name, variables)
497. 
498.     @property
499.     def table(self) -> Table:
500.         """Get current table."""


File: tests/test_build_latex.py
Line number range: 1 - 500
Content:
1. """Test the build process with LaTeX builder with the test root."""
2. 
3. import os
4. import re
5. import subprocess
6. from itertools import product
7. from shutil import copyfile
8. from subprocess import PIPE, CalledProcessError
9. 
10. import pytest
11. 
12. from sphinx.builders.latex import default_latex_documents
13. from sphinx.config import Config
14. from sphinx.errors import SphinxError
15. from sphinx.testing.util import strip_escseq
16. from sphinx.util.osutil import cd, ensuredir
17. from sphinx.writers.latex import LaTeXTranslator
18. 
19. from .test_build_html import ENV_WARNINGS
20. 
21. LATEX_ENGINES = ['pdflatex', 'lualatex', 'xelatex']
22. DOCCLASSES = ['howto', 'manual']
23. STYLEFILES = ['article.cls', 'fancyhdr.sty', 'titlesec.sty', 'amsmath.sty',
24.               'framed.sty', 'color.sty', 'fancyvrb.sty',
25.               'fncychap.sty', 'geometry.sty', 'kvoptions.sty', 'hyperref.sty']
26. 
27. LATEX_WARNINGS = ENV_WARNINGS + """\
28. %(root)s/index.rst:\\d+: WARNING: unknown option: &option
29. %(root)s/index.rst:\\d+: WARNING: citation not found: missing
30. %(root)s/index.rst:\\d+: WARNING: a suitable image for latex builder not found: foo.\\*
31. %(root)s/index.rst:\\d+: WARNING: Could not lex literal_block as "c". Highlighting skipped.
32. """
33. 
34. 
35. # only run latex if all needed packages are there
36. def kpsetest(*filenames):
37.     try:
38.         subprocess.run(['kpsewhich'] + list(filenames), stdout=PIPE, stderr=PIPE, check=True)
39.         return True
40.     except (OSError, CalledProcessError):
41.         return False  # command not found or exit with non-zero
42. 
43. 
44. # compile latex document with app.config.latex_engine
45. def compile_latex_document(app, filename='python.tex'):
46.     # now, try to run latex over it
47.     try:
48.         with cd(app.outdir):
49.             ensuredir(app.config.latex_engine)
50.             # keep a copy of latex file for this engine in case test fails
51.             copyfile(filename, app.config.latex_engine + '/' + filename)
52.             args = [app.config.latex_engine,
53.                     '--halt-on-error',
54.                     '--interaction=nonstopmode',
55.                     '-output-directory=%s' % app.config.latex_engine,
56.                     filename]
57.             subprocess.run(args, stdout=PIPE, stderr=PIPE, check=True)
58.     except OSError as exc:  # most likely the latex executable was not found
59.         raise pytest.skip.Exception from exc
60.     except CalledProcessError as exc:
61.         print(exc.stdout)
62.         print(exc.stderr)
63.         assert False, '%s exited with return code %s' % (app.config.latex_engine,
64.                                                          exc.returncode)
65. 
66. 
67. def skip_if_requested(testfunc):
68.     if 'SKIP_LATEX_BUILD' in os.environ:
69.         msg = 'Skip LaTeX builds because SKIP_LATEX_BUILD is set'
70.         return pytest.mark.skipif(True, reason=msg)(testfunc)
71.     else:
72.         return testfunc
73. 
74. 
75. def skip_if_stylefiles_notfound(testfunc):
76.     if kpsetest(*STYLEFILES) is False:
77.         msg = 'not running latex, the required styles do not seem to be installed'
78.         return pytest.mark.skipif(True, reason=msg)(testfunc)
79.     else:
80.         return testfunc
81. 
82. 
83. @skip_if_requested
84. @skip_if_stylefiles_notfound
85. @pytest.mark.parametrize(
86.     "engine,docclass",
87.     product(LATEX_ENGINES, DOCCLASSES),
88. )
89. @pytest.mark.sphinx('latex')
90. def test_build_latex_doc(app, status, warning, engine, docclass):
91.     app.config.latex_engine = engine
92.     app.config.latex_documents = [app.config.latex_documents[0][:4] + (docclass,)]
93.     app.builder.init()
94. 
95.     LaTeXTranslator.ignore_missing_images = True
96.     app.builder.build_all()
97. 
98.     # file from latex_additional_files
99.     assert (app.outdir / 'svgimg.svg').isfile()
100. 
101.     compile_latex_document(app, 'sphinxtests.tex')
102. 
103. 
104. @pytest.mark.sphinx('latex')
105. def test_writer(app, status, warning):
106.     app.builder.build_all()
107.     result = (app.outdir / 'sphinxtests.tex').read_text(encoding='utf8')
108. 
109.     assert ('\\begin{sphinxfigure-in-table}\n\\centering\n\\capstart\n'
110.             '\\noindent\\sphinxincludegraphics{{img}.png}\n'
111.             '\\sphinxfigcaption{figure in table}\\label{\\detokenize{markup:id8}}'
112.             '\\end{sphinxfigure-in-table}\\relax' in result)
113. 
114.     assert ('\\begin{wrapfigure}{r}{0pt}\n\\centering\n'
115.             '\\noindent\\sphinxincludegraphics{{rimg}.png}\n'
116.             '\\caption{figure with align option}\\label{\\detokenize{markup:id9}}'
117.             '\\end{wrapfigure}' in result)
118. 
119.     assert ('\\begin{wrapfigure}{r}{0.500\\linewidth}\n\\centering\n'
120.             '\\noindent\\sphinxincludegraphics{{rimg}.png}\n'
121.             '\\caption{figure with align \\& figwidth option}'
122.             '\\label{\\detokenize{markup:id10}}'
123.             '\\end{wrapfigure}' in result)
124. 
125.     assert ('\\begin{wrapfigure}{r}{3cm}\n\\centering\n'
126.             '\\noindent\\sphinxincludegraphics[width=3cm]{{rimg}.png}\n'
127.             '\\caption{figure with align \\& width option}'
128.             '\\label{\\detokenize{markup:id11}}'
129.             '\\end{wrapfigure}' in result)
130. 
131.     assert 'Footnotes' not in result
132. 
133. 
134. @pytest.mark.sphinx('latex', testroot='warnings', freshenv=True)
135. def test_latex_warnings(app, status, warning):
136.     app.builder.build_all()
137. 
138.     warnings = strip_escseq(re.sub(re.escape(os.sep) + '{1,2}', '/', warning.getvalue()))
139.     warnings_exp = LATEX_WARNINGS % {
140.         'root': re.escape(app.srcdir.replace(os.sep, '/'))}
141.     assert re.match(warnings_exp + '$', warnings), \
142.         'Warnings don\'t match:\n' + \
143.         '--- Expected (regex):\n' + warnings_exp + \
144.         '--- Got:\n' + warnings
145. 
146. 
147. @pytest.mark.sphinx('latex', testroot='basic')
148. def test_latex_basic(app, status, warning):
149.     app.builder.build_all()
150.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
151.     print(result)
152.     print(status.getvalue())
153.     print(warning.getvalue())
154.     assert r'\title{The basic Sphinx documentation for testing}' in result
155.     assert r'\release{}' in result
156.     assert r'\renewcommand{\releasename}{}' in result
157. 
158. 
159. @pytest.mark.sphinx('latex', testroot='basic',
160.                     confoverrides={
161.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'manual')]
162.                     })
163. def test_latex_basic_manual(app, status, warning):
164.     app.builder.build_all()
165.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
166.     print(result)
167.     assert r'\def\sphinxdocclass{report}' in result
168.     assert r'\documentclass[letterpaper,10pt,english]{sphinxmanual}' in result
169. 
170. 
171. @pytest.mark.sphinx('latex', testroot='basic',
172.                     confoverrides={
173.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'howto')]
174.                     })
175. def test_latex_basic_howto(app, status, warning):
176.     app.builder.build_all()
177.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
178.     print(result)
179.     assert r'\def\sphinxdocclass{article}' in result
180.     assert r'\documentclass[letterpaper,10pt,english]{sphinxhowto}' in result
181. 
182. 
183. @pytest.mark.sphinx('latex', testroot='basic',
184.                     confoverrides={
185.                         'language': 'ja',
186.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'manual')]
187.                     })
188. def test_latex_basic_manual_ja(app, status, warning):
189.     app.builder.build_all()
190.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
191.     print(result)
192.     assert r'\def\sphinxdocclass{ujbook}' in result
193.     assert r'\documentclass[letterpaper,10pt,dvipdfmx]{sphinxmanual}' in result
194. 
195. 
196. @pytest.mark.sphinx('latex', testroot='basic',
197.                     confoverrides={
198.                         'language': 'ja',
199.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'howto')]
200.                     })
201. def test_latex_basic_howto_ja(app, status, warning):
202.     app.builder.build_all()
203.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
204.     print(result)
205.     assert r'\def\sphinxdocclass{ujreport}' in result
206.     assert r'\documentclass[letterpaper,10pt,dvipdfmx]{sphinxhowto}' in result
207. 
208. 
209. @pytest.mark.sphinx('latex', testroot='latex-theme')
210. def test_latex_theme(app, status, warning):
211.     app.builder.build_all()
212.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
213.     print(result)
214.     assert r'\def\sphinxdocclass{book}' in result
215.     assert r'\documentclass[a4paper,12pt,english]{sphinxbook}' in result
216. 
217. 
218. @pytest.mark.sphinx('latex', testroot='latex-theme',
219.                     confoverrides={'latex_elements': {'papersize': 'b5paper',
220.                                                       'pointsize': '9pt'}})
221. def test_latex_theme_papersize(app, status, warning):
222.     app.builder.build_all()
223.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
224.     print(result)
225.     assert r'\def\sphinxdocclass{book}' in result
226.     assert r'\documentclass[b5paper,9pt,english]{sphinxbook}' in result
227. 
228. 
229. @pytest.mark.sphinx('latex', testroot='latex-theme',
230.                     confoverrides={'latex_theme_options': {'papersize': 'b5paper',
231.                                                            'pointsize': '9pt'}})
232. def test_latex_theme_options(app, status, warning):
233.     app.builder.build_all()
234.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
235.     print(result)
236.     assert r'\def\sphinxdocclass{book}' in result
237.     assert r'\documentclass[b5paper,9pt,english]{sphinxbook}' in result
238. 
239. 
240. @pytest.mark.sphinx('latex', testroot='basic', confoverrides={'language': 'zh'})
241. def test_latex_additional_settings_for_language_code(app, status, warning):
242.     app.builder.build_all()
243.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
244.     print(result)
245.     print(status.getvalue())
246.     print(warning.getvalue())
247.     assert r'\usepackage{xeCJK}' in result
248. 
249. 
250. @pytest.mark.sphinx('latex', testroot='basic', confoverrides={'language': 'el'})
251. def test_latex_additional_settings_for_greek(app, status, warning):
252.     app.builder.build_all()
253.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
254.     print(result)
255.     print(status.getvalue())
256.     print(warning.getvalue())
257.     assert '\\usepackage{polyglossia}\n\\setmainlanguage{greek}' in result
258.     assert '\\newfontfamily\\greekfonttt{FreeMono}' in result
259. 
260. 
261. @pytest.mark.sphinx('latex', testroot='latex-title')
262. def test_latex_title_after_admonitions(app, status, warning):
263.     app.builder.build_all()
264.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
265.     print(result)
266.     print(status.getvalue())
267.     print(warning.getvalue())
268.     assert '\\title{test\\sphinxhyphen{}latex\\sphinxhyphen{}title}' in result
269. 
270. 
271. @pytest.mark.sphinx('latex', testroot='basic',
272.                     confoverrides={'release': '1.0_0'})
273. def test_latex_release(app, status, warning):
274.     app.builder.build_all()
275.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
276.     print(result)
277.     print(status.getvalue())
278.     print(warning.getvalue())
279.     assert r'\release{1.0\_0}' in result
280.     assert r'\renewcommand{\releasename}{Release}' in result
281. 
282. 
283. @pytest.mark.sphinx('latex', testroot='numfig',
284.                     confoverrides={'numfig': True})
285. def test_numref(app, status, warning):
286.     app.builder.build_all()
287.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
288.     print(result)
289.     print(status.getvalue())
290.     print(warning.getvalue())
291.     assert ('\\hyperref[\\detokenize{index:fig1}]'
292.             '{Fig.\\@ \\ref{\\detokenize{index:fig1}}}') in result
293.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
294.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
295.     assert ('\\hyperref[\\detokenize{index:table-1}]'
296.             '{Table \\ref{\\detokenize{index:table-1}}}') in result
297.     assert ('\\hyperref[\\detokenize{baz:table22}]'
298.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
299.     assert ('\\hyperref[\\detokenize{index:code-1}]'
300.             '{Listing \\ref{\\detokenize{index:code-1}}}') in result
301.     assert ('\\hyperref[\\detokenize{baz:code22}]'
302.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
303.     assert ('\\hyperref[\\detokenize{foo:foo}]'
304.             '{Section \\ref{\\detokenize{foo:foo}}}') in result
305.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
306.             '{Section \\ref{\\detokenize{bar:bar-a}}}') in result
307.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
308.             '\\nameref{\\detokenize{index:fig1}}}') in result
309.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
310.             '\\nameref{\\detokenize{foo:foo}}}') in result
311. 
312.     # sphinxmessages.sty
313.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
314.     print(result)
315.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Fig.\@{} }}' in result
316.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Table }}' in result
317.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}' in result
318. 
319. 
320. @pytest.mark.sphinx(
321.     'latex', testroot='numfig',
322.     confoverrides={'numfig': True,
323.                    'numfig_format': {'figure': 'Figure:%s',
324.                                      'table': 'Tab_%s',
325.                                      'code-block': 'Code-%s',
326.                                      'section': 'SECTION-%s'}})
327. def test_numref_with_prefix1(app, status, warning):
328.     app.builder.build_all()
329.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
330.     print(result)
331.     print(status.getvalue())
332.     print(warning.getvalue())
333.     assert '\\ref{\\detokenize{index:fig1}}' in result
334.     assert '\\ref{\\detokenize{baz:fig22}}' in result
335.     assert '\\ref{\\detokenize{index:table-1}}' in result
336.     assert '\\ref{\\detokenize{baz:table22}}' in result
337.     assert '\\ref{\\detokenize{index:code-1}}' in result
338.     assert '\\ref{\\detokenize{baz:code22}}' in result
339.     assert ('\\hyperref[\\detokenize{index:fig1}]'
340.             '{Figure:\\ref{\\detokenize{index:fig1}}}') in result
341.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
342.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
343.     assert ('\\hyperref[\\detokenize{index:table-1}]'
344.             '{Tab\\_\\ref{\\detokenize{index:table-1}}}') in result
345.     assert ('\\hyperref[\\detokenize{baz:table22}]'
346.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
347.     assert ('\\hyperref[\\detokenize{index:code-1}]'
348.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{index:code-1}}}') in result
349.     assert ('\\hyperref[\\detokenize{baz:code22}]'
350.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
351.     assert ('\\hyperref[\\detokenize{foo:foo}]'
352.             '{SECTION\\sphinxhyphen{}\\ref{\\detokenize{foo:foo}}}') in result
353.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
354.             '{SECTION\\sphinxhyphen{}\\ref{\\detokenize{bar:bar-a}}}') in result
355.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
356.             '\\nameref{\\detokenize{index:fig1}}}') in result
357.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
358.             '\\nameref{\\detokenize{foo:foo}}}') in result
359. 
360.     # sphinxmessages.sty
361.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
362.     print(result)
363.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Figure:}}' in result
364.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Tab\_}}' in result
365.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Code-}}' in result
366. 
367. 
368. @pytest.mark.sphinx(
369.     'latex', testroot='numfig',
370.     confoverrides={'numfig': True,
371.                    'numfig_format': {'figure': 'Figure:%s.',
372.                                      'table': 'Tab_%s:',
373.                                      'code-block': 'Code-%s | ',
374.                                      'section': 'SECTION_%s_'}})
375. def test_numref_with_prefix2(app, status, warning):
376.     app.builder.build_all()
377.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
378.     print(result)
379.     print(status.getvalue())
380.     print(warning.getvalue())
381.     assert ('\\hyperref[\\detokenize{index:fig1}]'
382.             '{Figure:\\ref{\\detokenize{index:fig1}}.\\@}') in result
383.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
384.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
385.     assert ('\\hyperref[\\detokenize{index:table-1}]'
386.             '{Tab\\_\\ref{\\detokenize{index:table-1}}:}') in result
387.     assert ('\\hyperref[\\detokenize{baz:table22}]'
388.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
389.     assert ('\\hyperref[\\detokenize{index:code-1}]{Code\\sphinxhyphen{}\\ref{\\detokenize{index:code-1}} '
390.             '| }') in result
391.     assert ('\\hyperref[\\detokenize{baz:code22}]'
392.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
393.     assert ('\\hyperref[\\detokenize{foo:foo}]'
394.             '{SECTION\\_\\ref{\\detokenize{foo:foo}}\\_}') in result
395.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
396.             '{SECTION\\_\\ref{\\detokenize{bar:bar-a}}\\_}') in result
397.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
398.             '\\nameref{\\detokenize{index:fig1}}}') in result
399.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
400.             '\\nameref{\\detokenize{foo:foo}}}') in result
401. 
402.     # sphinxmessages.sty
403.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
404.     print(result)
405.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Figure:}}' in result
406.     assert r'\def\fnum@figure{\figurename\thefigure{}.}' in result
407.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Tab\_}}' in result
408.     assert r'\def\fnum@table{\tablename\thetable{}:}' in result
409.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Code-}}' in result
410. 
411. 
412. @pytest.mark.sphinx(
413.     'latex', testroot='numfig',
414.     confoverrides={'numfig': True, 'language': 'ja'})
415. def test_numref_with_language_ja(app, status, warning):
416.     app.builder.build_all()
417.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
418.     print(result)
419.     print(status.getvalue())
420.     print(warning.getvalue())
421.     assert ('\\hyperref[\\detokenize{index:fig1}]'
422.             '{\u56f3 \\ref{\\detokenize{index:fig1}}}') in result
423.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
424.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
425.     assert ('\\hyperref[\\detokenize{index:table-1}]'
426.             '{\u8868 \\ref{\\detokenize{index:table-1}}}') in result
427.     assert ('\\hyperref[\\detokenize{baz:table22}]'
428.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
429.     assert ('\\hyperref[\\detokenize{index:code-1}]'
430.             '{\u30ea\u30b9\u30c8 \\ref{\\detokenize{index:code-1}}}') in result
431.     assert ('\\hyperref[\\detokenize{baz:code22}]'
432.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
433.     assert ('\\hyperref[\\detokenize{foo:foo}]'
434.             '{\\ref{\\detokenize{foo:foo}} \u7ae0}') in result
435.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
436.             '{\\ref{\\detokenize{bar:bar-a}} \u7ae0}') in result
437.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
438.             '\\nameref{\\detokenize{index:fig1}}}') in result
439.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
440.             '\\nameref{\\detokenize{foo:foo}}}') in result
441. 
442.     # sphinxmessages.sty
443.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
444.     print(result)
445.     assert '\\@iden{\\renewcommand{\\figurename}{図 }}' in result
446.     assert '\\@iden{\\renewcommand{\\tablename}{表 }}' in result
447.     assert '\\@iden{\\renewcommand{\\literalblockname}{リスト}}' in result
448. 
449. 
450. @pytest.mark.sphinx('latex', testroot='latex-numfig')
451. def test_latex_obey_numfig_is_false(app, status, warning):
452.     app.builder.build_all()
453. 
454.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
455.     assert '\\usepackage{sphinx}' in result
456. 
457.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
458.     assert '\\usepackage{sphinx}' in result
459. 
460. 
461. @pytest.mark.sphinx(
462.     'latex', testroot='latex-numfig',
463.     confoverrides={'numfig': True, 'numfig_secnum_depth': 0})
464. def test_latex_obey_numfig_secnum_depth_is_zero(app, status, warning):
465.     app.builder.build_all()
466. 
467.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
468.     assert '\\usepackage[,nonumfigreset,mathnumfig]{sphinx}' in result
469. 
470.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
471.     assert '\\usepackage[,nonumfigreset,mathnumfig]{sphinx}' in result
472. 
473. 
474. @pytest.mark.sphinx(
475.     'latex', testroot='latex-numfig',
476.     confoverrides={'numfig': True, 'numfig_secnum_depth': 2})
477. def test_latex_obey_numfig_secnum_depth_is_two(app, status, warning):
478.     app.builder.build_all()
479. 
480.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
481.     assert '\\usepackage[,numfigreset=2,mathnumfig]{sphinx}' in result
482. 
483.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
484.     assert '\\usepackage[,numfigreset=3,mathnumfig]{sphinx}' in result
485. 
486. 
487. @pytest.mark.sphinx(
488.     'latex', testroot='latex-numfig',
489.     confoverrides={'numfig': True, 'math_numfig': False})
490. def test_latex_obey_numfig_but_math_numfig_false(app, status, warning):
491.     app.builder.build_all()
492. 
493.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
494.     assert '\\usepackage[,numfigreset=1]{sphinx}' in result
495. 
496.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
497.     assert '\\usepackage[,numfigreset=2]{sphinx}' in result
498. 
499. 
500. @pytest.mark.sphinx('latex', testroot='basic')

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 11:27:14,476 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of this file.', relative_path='sphinx/writers/latex.py', start_line=1, end_line=500), ContextOutput(reasoning='The user requested the full content of this file.', relative_path='tests/test_build_latex.py', start_line=1, end_line=500)]
2025-12-23 11:27:14,479 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`.
2025-12-23 11:27:14,479 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 11:27:14,479 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 11:27:14,480 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 0 existing contexts
2025-12-23 11:27:14,480 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-23 11:27:14,481 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── create-release.yml
|       ├── docutils-latest.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── automatic-doc-generation.rst
|   |   ├── deploying.rst
|   |   ├── describing-code.rst
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── _sphinx_javascript_frameworks_compat.js
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-duplicates
|   |   |   └── fish_licence
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── dedent.rst
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_class_module.py
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-extlinks-hardcoded-urls
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-extlinks-hardcoded-urls-multiple-replacements
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-intersphinx-role
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── noqa.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-documents_exclude
|   |   |   ├── br0ken_link.rst
|   |   |   ├── broken_link.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-reST-code-role
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_extlinks.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_extension.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── babel_runner.py
    ├── bump_docker.sh
    ├── bump_version.py
    └── doclinter.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: LaTeX: new Inline code highlighting from #10251 adds whitespace at start and end in pdf output

Description: ### Describe the bug

The #10251 enhancement activates syntax highlighting for the Docutiles `code` role. For LaTeX output, a space character is inserted at start and end of the inline code.

Example
```
Inline \sphinxcode{\sphinxupquote{ <--- this produces a space in output
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass} <-- here also
}} code block

```

a priori, mark-up should be:
```
Inline \sphinxcode{\sphinxupquote{%
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass}%
}} code block
```

But I have no no strong opinion if good or bad. See screenshots.

### How to Reproduce

```
.. role:: python(code)
   :language: python
   :class: highlight

Inline :python:`def foo(1 + 2 + None + "abc"): pass` code block

.. code-block:: python

   def foo(1 + 2 + None + "abc"): pass
```

in `index.rst` and `make latexpdf`.

### Expected behavior

_No response_

### Your project

extracted from test_build_latex.py

### Screenshots

with current:

![Capture d’écran 2022-05-08 à 11 11 08](https://user-images.githubusercontent.com/2589111/167289522-fca10320-7df4-439a-9da9-2dbff5a64496.png)

if space characters removed from `.tex` file produced by LaTeX writer:

![Capture d’écran 2022-05-08 à 11 10 32](https://user-images.githubusercontent.com/2589111/167289536-5643529b-4be5-4848-bcde-b1404fe37e5d.png)

For comparison prior to #10251 merge:
![Capture d’écran 2022-05-08 à 11 21 08](https://user-images.githubusercontent.com/2589111/167289864-0773fcef-4a80-42e8-94f9-4da02bc90c68.png)

### OS

Mac

### Python version

3.9

### Sphinx version

5.x

### Sphinx extensions

_No response_

### Extra tools

_No response_

### Additional context

Relates #10251

Patch information:
diff --git a/sphinx/writers/latex.py b/sphinx/writers/latex.py
index e0c7d56f8..a8630b2dd 100644
--- a/sphinx/writers/latex.py
+++ b/sphinx/writers/latex.py
@@ -1711,8 +1711,17 @@ class LaTeXTranslator(SphinxTranslator):
         # https://github.com/pygments/pygments/pull/1343
         hlcode = hlcode.replace(r'\begin{Verbatim}[commandchars=\\\{\}]',
                                 r'\sphinxcode{\sphinxupquote{')
+        # remove the newline immediately after the replaced begin to avoid leading space
+        prefix = r'\sphinxcode{\sphinxupquote{'
+        if hlcode.startswith(prefix):
+            pos = len(prefix)
+            if len(hlcode) > pos and hlcode[pos] in ('\n', '\r'):
+                hlcode = hlcode[:pos] + hlcode[pos + 1:]
         # get consistent trailer
         hlcode = hlcode.rstrip()[:-14]  # strip \end{Verbatim}
+        # remove a single trailing newline before closing braces to avoid trailing space
+        if hlcode.endswith('\n'):
+            hlcode = hlcode[:-1]
         self.body.append(hlcode)
         self.body.append('}}')
         raise nodes.SkipNode


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`.
Extra Requirements: 
Purpose: This information is essential to find 3 relevant test cases that demonstrate the reported bug or similar functionality, as requested by the user.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sphinx/writers/latex.py
Line number range: 1 - 500
Content:
1. """Custom docutils writer for LaTeX.
2. 
3. Much of this code is adapted from Dave Kuhlman's "docpy" writer from his
4. docutils sandbox.
5. """
6. 
7. import re
8. import warnings
9. from collections import defaultdict
10. from os import path
11. from typing import TYPE_CHECKING, Any, Dict, Iterable, List, Set, Tuple, cast
12. 
13. from docutils import nodes, writers
14. from docutils.nodes import Element, Node, Text
15. 
16. from sphinx import addnodes, highlighting
17. from sphinx.deprecation import RemovedInSphinx70Warning
18. from sphinx.domains import IndexEntry
19. from sphinx.domains.std import StandardDomain
20. from sphinx.errors import SphinxError
21. from sphinx.locale import _, __, admonitionlabels
22. from sphinx.util import logging, split_into, texescape
23. from sphinx.util.docutils import SphinxTranslator
24. from sphinx.util.nodes import clean_astext, get_prev_node
25. from sphinx.util.template import LaTeXRenderer
26. from sphinx.util.texescape import tex_replace_map
27. 
28. try:
29.     from docutils.utils.roman import toRoman
30. except ImportError:
31.     # In Debian/Ubuntu, roman package is provided as roman, not as docutils.utils.roman
32.     from roman import toRoman  # type: ignore
33. 
34. if TYPE_CHECKING:
35.     from sphinx.builders.latex import LaTeXBuilder
36.     from sphinx.builders.latex.theming import Theme
37. 
38. 
39. logger = logging.getLogger(__name__)
40. 
41. MAX_CITATION_LABEL_LENGTH = 8
42. LATEXSECTIONNAMES = ["part", "chapter", "section", "subsection",
43.                      "subsubsection", "paragraph", "subparagraph"]
44. ENUMERATE_LIST_STYLE = defaultdict(lambda: r'\arabic',
45.                                    {
46.                                        'arabic': r'\arabic',
47.                                        'loweralpha': r'\alph',
48.                                        'upperalpha': r'\Alph',
49.                                        'lowerroman': r'\roman',
50.                                        'upperroman': r'\Roman',
51.                                    })
52. 
53. CR = '\n'
54. BLANKLINE = '\n\n'
55. EXTRA_RE = re.compile(r'^(.*\S)\s+\(([^()]*)\)\s*$')
56. 
57. 
58. class collected_footnote(nodes.footnote):
59.     """Footnotes that are collected are assigned this class."""
60. 
61. 
62. class UnsupportedError(SphinxError):
63.     category = 'Markup is unsupported in LaTeX'
64. 
65. 
66. class LaTeXWriter(writers.Writer):
67. 
68.     supported = ('sphinxlatex',)
69. 
70.     settings_spec = ('LaTeX writer options', '', (
71.         ('Document name', ['--docname'], {'default': ''}),
72.         ('Document class', ['--docclass'], {'default': 'manual'}),
73.         ('Author', ['--author'], {'default': ''}),
74.     ))
75.     settings_defaults: Dict = {}
76. 
77.     output = None
78. 
79.     def __init__(self, builder: "LaTeXBuilder") -> None:
80.         super().__init__()
81.         self.builder = builder
82.         self.theme: Theme = None
83. 
84.     def translate(self) -> None:
85.         visitor = self.builder.create_translator(self.document, self.builder, self.theme)
86.         self.document.walkabout(visitor)
87.         self.output = cast(LaTeXTranslator, visitor).astext()
88. 
89. 
90. # Helper classes
91. 
92. class Table:
93.     """A table data"""
94. 
95.     def __init__(self, node: Element) -> None:
96.         self.header: List[str] = []
97.         self.body: List[str] = []
98.         self.align = node.get('align', 'default')
99.         self.classes: List[str] = node.get('classes', [])
100.         self.colcount = 0
101.         self.colspec: str = None
102.         self.colwidths: List[int] = []
103.         self.has_problematic = False
104.         self.has_oldproblematic = False
105.         self.has_verbatim = False
106.         self.caption: List[str] = None
107.         self.stubs: List[int] = []
108. 
109.         # current position
110.         self.col = 0
111.         self.row = 0
112. 
113.         # A dict mapping a table location to a cell_id (cell = rectangular area)
114.         self.cells: Dict[Tuple[int, int], int] = defaultdict(int)
115.         self.cell_id = 0  # last assigned cell_id
116. 
117.     def is_longtable(self) -> bool:
118.         """True if and only if table uses longtable environment."""
119.         return self.row > 30 or 'longtable' in self.classes
120. 
121.     def get_table_type(self) -> str:
122.         """Returns the LaTeX environment name for the table.
123. 
124.         The class currently supports:
125. 
126.         * longtable
127.         * tabular
128.         * tabulary
129.         """
130.         if self.is_longtable():
131.             return 'longtable'
132.         elif self.has_verbatim:
133.             return 'tabular'
134.         elif self.colspec:
135.             return 'tabulary'
136.         elif self.has_problematic or (self.colwidths and 'colwidths-given' in self.classes):
137.             return 'tabular'
138.         else:
139.             return 'tabulary'
140. 
141.     def get_colspec(self) -> str:
142.         """Returns a column spec of table.
143. 
144.         This is what LaTeX calls the 'preamble argument' of the used table environment.
145. 
146.         .. note:: the ``\\X`` and ``T`` column type specifiers are defined in ``sphinx.sty``.
147.         """
148.         if self.colspec:
149.             return self.colspec
150.         elif self.colwidths and 'colwidths-given' in self.classes:
151.             total = sum(self.colwidths)
152.             colspecs = [r'\X{%d}{%d}' % (width, total) for width in self.colwidths]
153.             return '{|%s|}' % '|'.join(colspecs) + CR
154.         elif self.has_problematic:
155.             return r'{|*{%d}{\X{1}{%d}|}}' % (self.colcount, self.colcount) + CR
156.         elif self.get_table_type() == 'tabulary':
157.             # sphinx.sty sets T to be J by default.
158.             return '{|' + ('T|' * self.colcount) + '}' + CR
159.         elif self.has_oldproblematic:
160.             return r'{|*{%d}{\X{1}{%d}|}}' % (self.colcount, self.colcount) + CR
161.         else:
162.             return '{|' + ('l|' * self.colcount) + '}' + CR
163. 
164.     def add_cell(self, height: int, width: int) -> None:
165.         """Adds a new cell to a table.
166. 
167.         It will be located at current position: (``self.row``, ``self.col``).
168.         """
169.         self.cell_id += 1
170.         for col in range(width):
171.             for row in range(height):
172.                 assert self.cells[(self.row + row, self.col + col)] == 0
173.                 self.cells[(self.row + row, self.col + col)] = self.cell_id
174. 
175.     def cell(self, row: int = None, col: int = None) -> "TableCell":
176.         """Returns a cell object (i.e. rectangular area) containing given position.
177. 
178.         If no option arguments: ``row`` or ``col`` are given, the current position;
179.         ``self.row`` and ``self.col`` are used to get a cell object by default.
180.         """
181.         try:
182.             if row is None:
183.                 row = self.row
184.             if col is None:
185.                 col = self.col
186.             return TableCell(self, row, col)
187.         except IndexError:
188.             return None
189. 
190. 
191. class TableCell:
192.     """Data of a cell in a table."""
193. 
194.     def __init__(self, table: Table, row: int, col: int) -> None:
195.         if table.cells[(row, col)] == 0:
196.             raise IndexError
197. 
198.         self.table = table
199.         self.cell_id = table.cells[(row, col)]
200.         self.row = row
201.         self.col = col
202. 
203.         # adjust position for multirow/multicol cell
204.         while table.cells[(self.row - 1, self.col)] == self.cell_id:
205.             self.row -= 1
206.         while table.cells[(self.row, self.col - 1)] == self.cell_id:
207.             self.col -= 1
208. 
209.     @property
210.     def width(self) -> int:
211.         """Returns the cell width."""
212.         width = 0
213.         while self.table.cells[(self.row, self.col + width)] == self.cell_id:
214.             width += 1
215.         return width
216. 
217.     @property
218.     def height(self) -> int:
219.         """Returns the cell height."""
220.         height = 0
221.         while self.table.cells[(self.row + height, self.col)] == self.cell_id:
222.             height += 1
223.         return height
224. 
225. 
226. def escape_abbr(text: str) -> str:
227.     """Adjust spacing after abbreviations."""
228.     return re.sub(r'\.(?=\s|$)', r'.\@', text)
229. 
230. 
231. def rstdim_to_latexdim(width_str: str, scale: int = 100) -> str:
232.     """Convert `width_str` with rst length to LaTeX length."""
233.     match = re.match(r'^(\d*\.?\d*)\s*(\S*)$', width_str)
234.     if not match:
235.         raise ValueError
236.     res = width_str
237.     amount, unit = match.groups()[:2]
238.     if scale == 100:
239.         float(amount)  # validate amount is float
240.         if unit in ('', "px"):
241.             res = r"%s\sphinxpxdimen" % amount
242.         elif unit == 'pt':
243.             res = '%sbp' % amount  # convert to 'bp'
244.         elif unit == "%":
245.             res = r"%.3f\linewidth" % (float(amount) / 100.0)
246.     else:
247.         amount_float = float(amount) * scale / 100.0
248.         if unit in ('', "px"):
249.             res = r"%.5f\sphinxpxdimen" % amount_float
250.         elif unit == 'pt':
251.             res = '%.5fbp' % amount_float
252.         elif unit == "%":
253.             res = r"%.5f\linewidth" % (amount_float / 100.0)
254.         else:
255.             res = "%.5f%s" % (amount_float, unit)
256.     return res
257. 
258. 
259. class LaTeXTranslator(SphinxTranslator):
260.     builder: "LaTeXBuilder" = None
261. 
262.     secnumdepth = 2  # legacy sphinxhowto.cls uses this, whereas article.cls
263.     # default is originally 3. For book/report, 2 is already LaTeX default.
264.     ignore_missing_images = False
265. 
266.     def __init__(self, document: nodes.document, builder: "LaTeXBuilder",
267.                  theme: "Theme") -> None:
268.         super().__init__(document, builder)
269.         self.body: List[str] = []
270.         self.theme = theme
271. 
272.         # flags
273.         self.in_title = 0
274.         self.in_production_list = 0
275.         self.in_footnote = 0
276.         self.in_caption = 0
277.         self.in_term = 0
278.         self.needs_linetrimming = 0
279.         self.in_minipage = 0
280.         self.no_latex_floats = 0
281.         self.first_document = 1
282.         self.this_is_the_title = 1
283.         self.literal_whitespace = 0
284.         self.in_parsed_literal = 0
285.         self.compact_list = 0
286.         self.first_param = 0
287.         self.in_desc_signature = False
288. 
289.         sphinxpkgoptions = []
290. 
291.         # sort out some elements
292.         self.elements = self.builder.context.copy()
293. 
294.         # initial section names
295.         self.sectionnames = LATEXSECTIONNAMES[:]
296.         if self.theme.toplevel_sectioning == 'section':
297.             self.sectionnames.remove('chapter')
298. 
299.         # determine top section level
300.         self.top_sectionlevel = 1
301.         if self.config.latex_toplevel_sectioning:
302.             try:
303.                 self.top_sectionlevel = \
304.                     self.sectionnames.index(self.config.latex_toplevel_sectioning)
305.             except ValueError:
306.                 logger.warning(__('unknown %r toplevel_sectioning for class %r') %
307.                                (self.config.latex_toplevel_sectioning, self.theme.docclass))
308. 
309.         if self.config.numfig:
310.             self.numfig_secnum_depth = self.config.numfig_secnum_depth
311.             if self.numfig_secnum_depth > 0:  # default is 1
312.                 # numfig_secnum_depth as passed to sphinx.sty indices same names as in
313.                 # LATEXSECTIONNAMES but with -1 for part, 0 for chapter, 1 for section...
314.                 if len(self.sectionnames) < len(LATEXSECTIONNAMES) and \
315.                    self.top_sectionlevel > 0:
316.                     self.numfig_secnum_depth += self.top_sectionlevel
317.                 else:
318.                     self.numfig_secnum_depth += self.top_sectionlevel - 1
319.                 # this (minus one) will serve as minimum to LaTeX's secnumdepth
320.                 self.numfig_secnum_depth = min(self.numfig_secnum_depth,
321.                                                len(LATEXSECTIONNAMES) - 1)
322.                 # if passed key value is < 1 LaTeX will act as if 0; see sphinx.sty
323.                 sphinxpkgoptions.append('numfigreset=%s' % self.numfig_secnum_depth)
324.             else:
325.                 sphinxpkgoptions.append('nonumfigreset')
326. 
327.         if self.config.numfig and self.config.math_numfig:
328.             sphinxpkgoptions.append('mathnumfig')
329. 
330.         if (self.config.language not in {'en', 'ja'} and
331.                 'fncychap' not in self.config.latex_elements):
332.             # use Sonny style if any language specified (except English)
333.             self.elements['fncychap'] = (r'\usepackage[Sonny]{fncychap}' + CR +
334.                                          r'\ChNameVar{\Large\normalfont\sffamily}' + CR +
335.                                          r'\ChTitleVar{\Large\normalfont\sffamily}')
336. 
337.         self.babel = self.builder.babel
338.         if not self.babel.is_supported_language():
339.             # emit warning if specified language is invalid
340.             # (only emitting, nothing changed to processing)
341.             logger.warning(__('no Babel option known for language %r'),
342.                            self.config.language)
343. 
344.         minsecnumdepth = self.secnumdepth  # 2 from legacy sphinx manual/howto
345.         if self.document.get('tocdepth'):
346.             # reduce tocdepth if `part` or `chapter` is used for top_sectionlevel
347.             #   tocdepth = -1: show only parts
348.             #   tocdepth =  0: show parts and chapters
349.             #   tocdepth =  1: show parts, chapters and sections
350.             #   tocdepth =  2: show parts, chapters, sections and subsections
351.             #   ...
352.             tocdepth = self.document.get('tocdepth', 999) + self.top_sectionlevel - 2
353.             if len(self.sectionnames) < len(LATEXSECTIONNAMES) and \
354.                self.top_sectionlevel > 0:
355.                 tocdepth += 1  # because top_sectionlevel is shifted by -1
356.             if tocdepth > len(LATEXSECTIONNAMES) - 2:  # default is 5 <-> subparagraph
357.                 logger.warning(__('too large :maxdepth:, ignored.'))
358.                 tocdepth = len(LATEXSECTIONNAMES) - 2
359. 
360.             self.elements['tocdepth'] = r'\setcounter{tocdepth}{%d}' % tocdepth
361.             minsecnumdepth = max(minsecnumdepth, tocdepth)
362. 
363.         if self.config.numfig and (self.config.numfig_secnum_depth > 0):
364.             minsecnumdepth = max(minsecnumdepth, self.numfig_secnum_depth - 1)
365. 
366.         if minsecnumdepth > self.secnumdepth:
367.             self.elements['secnumdepth'] = r'\setcounter{secnumdepth}{%d}' %\
368.                                            minsecnumdepth
369. 
370.         contentsname = document.get('contentsname')
371.         if contentsname:
372.             self.elements['contentsname'] = self.babel_renewcommand(r'\contentsname',
373.                                                                     contentsname)
374. 
375.         if self.elements['maxlistdepth']:
376.             sphinxpkgoptions.append('maxlistdepth=%s' % self.elements['maxlistdepth'])
377.         if sphinxpkgoptions:
378.             self.elements['sphinxpkgoptions'] = '[,%s]' % ','.join(sphinxpkgoptions)
379.         if self.elements['sphinxsetup']:
380.             self.elements['sphinxsetup'] = (r'\sphinxsetup{%s}' % self.elements['sphinxsetup'])
381.         if self.elements['extraclassoptions']:
382.             self.elements['classoptions'] += ',' + \
383.                                              self.elements['extraclassoptions']
384. 
385.         self.highlighter = highlighting.PygmentsBridge('latex', self.config.pygments_style,
386.                                                        latex_engine=self.config.latex_engine)
387.         self.context: List[Any] = []
388.         self.descstack: List[str] = []
389.         self.tables: List[Table] = []
390.         self.next_table_colspec: str = None
391.         self.bodystack: List[List[str]] = []
392.         self.footnote_restricted: Element = None
393.         self.pending_footnotes: List[nodes.footnote_reference] = []
394.         self.curfilestack: List[str] = []
395.         self.handled_abbrs: Set[str] = set()
396. 
397.     def pushbody(self, newbody: List[str]) -> None:
398.         self.bodystack.append(self.body)
399.         self.body = newbody
400. 
401.     def popbody(self) -> List[str]:
402.         body = self.body
403.         self.body = self.bodystack.pop()
404.         return body
405. 
406.     def astext(self) -> str:
407.         self.elements.update({
408.             'body': ''.join(self.body),
409.             'indices': self.generate_indices()
410.         })
411.         return self.render('latex.tex_t', self.elements)
412. 
413.     def hypertarget(self, id: str, withdoc: bool = True, anchor: bool = True) -> str:
414.         if withdoc:
415.             id = self.curfilestack[-1] + ':' + id
416.         return (r'\phantomsection' if anchor else '') + r'\label{%s}' % self.idescape(id)
417. 
418.     def hypertarget_to(self, node: Element, anchor: bool = False) -> str:
419.         labels = ''.join(self.hypertarget(node_id, anchor=False) for node_id in node['ids'])
420.         if anchor:
421.             return r'\phantomsection' + labels
422.         else:
423.             return labels
424. 
425.     def hyperlink(self, id: str) -> str:
426.         return r'{\hyperref[%s]{' % self.idescape(id)
427. 
428.     def hyperpageref(self, id: str) -> str:
429.         return r'\autopageref*{%s}' % self.idescape(id)
430. 
431.     def escape(self, s: str) -> str:
432.         return texescape.escape(s, self.config.latex_engine)
433. 
434.     def idescape(self, id: str) -> str:
435.         return r'\detokenize{%s}' % str(id).translate(tex_replace_map).\
436.             encode('ascii', 'backslashreplace').decode('ascii').\
437.             replace('\\', '_')
438. 
439.     def babel_renewcommand(self, command: str, definition: str) -> str:
440.         if self.elements['multilingual']:
441.             prefix = r'\addto\captions%s{' % self.babel.get_language()
442.             suffix = '}'
443.         else:  # babel is disabled (mainly for Japanese environment)
444.             prefix = ''
445.             suffix = ''
446. 
447.         return r'%s\renewcommand{%s}{%s}%s' % (prefix, command, definition, suffix) + CR
448. 
449.     def generate_indices(self) -> str:
450.         def generate(content: List[Tuple[str, List[IndexEntry]]], collapsed: bool) -> None:
451.             ret.append(r'\begin{sphinxtheindex}' + CR)
452.             ret.append(r'\let\bigletter\sphinxstyleindexlettergroup' + CR)
453.             for i, (letter, entries) in enumerate(content):
454.                 if i > 0:
455.                     ret.append(r'\indexspace' + CR)
456.                 ret.append(r'\bigletter{%s}' % self.escape(letter) + CR)
457.                 for entry in entries:
458.                     if not entry[3]:
459.                         continue
460.                     ret.append(r'\item\relax\sphinxstyleindexentry{%s}' %
461.                                self.encode(entry[0]))
462.                     if entry[4]:
463.                         # add "extra" info
464.                         ret.append(r'\sphinxstyleindexextra{%s}' % self.encode(entry[4]))
465.                     ret.append(r'\sphinxstyleindexpageref{%s:%s}' %
466.                                (entry[2], self.idescape(entry[3])) + CR)
467.             ret.append(r'\end{sphinxtheindex}' + CR)
468. 
469.         ret = []
470.         # latex_domain_indices can be False/True or a list of index names
471.         indices_config = self.config.latex_domain_indices
472.         if indices_config:
473.             for domain in self.builder.env.domains.values():
474.                 for indexcls in domain.indices:
475.                     indexname = '%s-%s' % (domain.name, indexcls.name)
476.                     if isinstance(indices_config, list):
477.                         if indexname not in indices_config:
478.                             continue
479.                     content, collapsed = indexcls(domain).generate(
480.                         self.builder.docnames)
481.                     if not content:
482.                         continue
483.                     ret.append(r'\renewcommand{\indexname}{%s}' % indexcls.localname + CR)
484.                     generate(content, collapsed)
485. 
486.         return ''.join(ret)
487. 
488.     def render(self, template_name: str, variables: Dict) -> str:
489.         renderer = LaTeXRenderer(latex_engine=self.config.latex_engine)
490.         for template_dir in self.config.templates_path:
491.             template = path.join(self.builder.confdir, template_dir,
492.                                  template_name)
493.             if path.exists(template):
494.                 return renderer.render(template, variables)
495. 
496.         return renderer.render(template_name, variables)
497. 
498.     @property
499.     def table(self) -> Table:
500.         """Get current table."""


File: tests/test_build_latex.py
Line number range: 1 - 500
Content:
1. """Test the build process with LaTeX builder with the test root."""
2. 
3. import os
4. import re
5. import subprocess
6. from itertools import product
7. from shutil import copyfile
8. from subprocess import PIPE, CalledProcessError
9. 
10. import pytest
11. 
12. from sphinx.builders.latex import default_latex_documents
13. from sphinx.config import Config
14. from sphinx.errors import SphinxError
15. from sphinx.testing.util import strip_escseq
16. from sphinx.util.osutil import cd, ensuredir
17. from sphinx.writers.latex import LaTeXTranslator
18. 
19. from .test_build_html import ENV_WARNINGS
20. 
21. LATEX_ENGINES = ['pdflatex', 'lualatex', 'xelatex']
22. DOCCLASSES = ['howto', 'manual']
23. STYLEFILES = ['article.cls', 'fancyhdr.sty', 'titlesec.sty', 'amsmath.sty',
24.               'framed.sty', 'color.sty', 'fancyvrb.sty',
25.               'fncychap.sty', 'geometry.sty', 'kvoptions.sty', 'hyperref.sty']
26. 
27. LATEX_WARNINGS = ENV_WARNINGS + """\
28. %(root)s/index.rst:\\d+: WARNING: unknown option: &option
29. %(root)s/index.rst:\\d+: WARNING: citation not found: missing
30. %(root)s/index.rst:\\d+: WARNING: a suitable image for latex builder not found: foo.\\*
31. %(root)s/index.rst:\\d+: WARNING: Could not lex literal_block as "c". Highlighting skipped.
32. """
33. 
34. 
35. # only run latex if all needed packages are there
36. def kpsetest(*filenames):
37.     try:
38.         subprocess.run(['kpsewhich'] + list(filenames), stdout=PIPE, stderr=PIPE, check=True)
39.         return True
40.     except (OSError, CalledProcessError):
41.         return False  # command not found or exit with non-zero
42. 
43. 
44. # compile latex document with app.config.latex_engine
45. def compile_latex_document(app, filename='python.tex'):
46.     # now, try to run latex over it
47.     try:
48.         with cd(app.outdir):
49.             ensuredir(app.config.latex_engine)
50.             # keep a copy of latex file for this engine in case test fails
51.             copyfile(filename, app.config.latex_engine + '/' + filename)
52.             args = [app.config.latex_engine,
53.                     '--halt-on-error',
54.                     '--interaction=nonstopmode',
55.                     '-output-directory=%s' % app.config.latex_engine,
56.                     filename]
57.             subprocess.run(args, stdout=PIPE, stderr=PIPE, check=True)
58.     except OSError as exc:  # most likely the latex executable was not found
59.         raise pytest.skip.Exception from exc
60.     except CalledProcessError as exc:
61.         print(exc.stdout)
62.         print(exc.stderr)
63.         assert False, '%s exited with return code %s' % (app.config.latex_engine,
64.                                                          exc.returncode)
65. 
66. 
67. def skip_if_requested(testfunc):
68.     if 'SKIP_LATEX_BUILD' in os.environ:
69.         msg = 'Skip LaTeX builds because SKIP_LATEX_BUILD is set'
70.         return pytest.mark.skipif(True, reason=msg)(testfunc)
71.     else:
72.         return testfunc
73. 
74. 
75. def skip_if_stylefiles_notfound(testfunc):
76.     if kpsetest(*STYLEFILES) is False:
77.         msg = 'not running latex, the required styles do not seem to be installed'
78.         return pytest.mark.skipif(True, reason=msg)(testfunc)
79.     else:
80.         return testfunc
81. 
82. 
83. @skip_if_requested
84. @skip_if_stylefiles_notfound
85. @pytest.mark.parametrize(
86.     "engine,docclass",
87.     product(LATEX_ENGINES, DOCCLASSES),
88. )
89. @pytest.mark.sphinx('latex')
90. def test_build_latex_doc(app, status, warning, engine, docclass):
91.     app.config.latex_engine = engine
92.     app.config.latex_documents = [app.config.latex_documents[0][:4] + (docclass,)]
93.     app.builder.init()
94. 
95.     LaTeXTranslator.ignore_missing_images = True
96.     app.builder.build_all()
97. 
98.     # file from latex_additional_files
99.     assert (app.outdir / 'svgimg.svg').isfile()
100. 
101.     compile_latex_document(app, 'sphinxtests.tex')
102. 
103. 
104. @pytest.mark.sphinx('latex')
105. def test_writer(app, status, warning):
106.     app.builder.build_all()
107.     result = (app.outdir / 'sphinxtests.tex').read_text(encoding='utf8')
108. 
109.     assert ('\\begin{sphinxfigure-in-table}\n\\centering\n\\capstart\n'
110.             '\\noindent\\sphinxincludegraphics{{img}.png}\n'
111.             '\\sphinxfigcaption{figure in table}\\label{\\detokenize{markup:id8}}'
112.             '\\end{sphinxfigure-in-table}\\relax' in result)
113. 
114.     assert ('\\begin{wrapfigure}{r}{0pt}\n\\centering\n'
115.             '\\noindent\\sphinxincludegraphics{{rimg}.png}\n'
116.             '\\caption{figure with align option}\\label{\\detokenize{markup:id9}}'
117.             '\\end{wrapfigure}' in result)
118. 
119.     assert ('\\begin{wrapfigure}{r}{0.500\\linewidth}\n\\centering\n'
120.             '\\noindent\\sphinxincludegraphics{{rimg}.png}\n'
121.             '\\caption{figure with align \\& figwidth option}'
122.             '\\label{\\detokenize{markup:id10}}'
123.             '\\end{wrapfigure}' in result)
124. 
125.     assert ('\\begin{wrapfigure}{r}{3cm}\n\\centering\n'
126.             '\\noindent\\sphinxincludegraphics[width=3cm]{{rimg}.png}\n'
127.             '\\caption{figure with align \\& width option}'
128.             '\\label{\\detokenize{markup:id11}}'
129.             '\\end{wrapfigure}' in result)
130. 
131.     assert 'Footnotes' not in result
132. 
133. 
134. @pytest.mark.sphinx('latex', testroot='warnings', freshenv=True)
135. def test_latex_warnings(app, status, warning):
136.     app.builder.build_all()
137. 
138.     warnings = strip_escseq(re.sub(re.escape(os.sep) + '{1,2}', '/', warning.getvalue()))
139.     warnings_exp = LATEX_WARNINGS % {
140.         'root': re.escape(app.srcdir.replace(os.sep, '/'))}
141.     assert re.match(warnings_exp + '$', warnings), \
142.         'Warnings don\'t match:\n' + \
143.         '--- Expected (regex):\n' + warnings_exp + \
144.         '--- Got:\n' + warnings
145. 
146. 
147. @pytest.mark.sphinx('latex', testroot='basic')
148. def test_latex_basic(app, status, warning):
149.     app.builder.build_all()
150.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
151.     print(result)
152.     print(status.getvalue())
153.     print(warning.getvalue())
154.     assert r'\title{The basic Sphinx documentation for testing}' in result
155.     assert r'\release{}' in result
156.     assert r'\renewcommand{\releasename}{}' in result
157. 
158. 
159. @pytest.mark.sphinx('latex', testroot='basic',
160.                     confoverrides={
161.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'manual')]
162.                     })
163. def test_latex_basic_manual(app, status, warning):
164.     app.builder.build_all()
165.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
166.     print(result)
167.     assert r'\def\sphinxdocclass{report}' in result
168.     assert r'\documentclass[letterpaper,10pt,english]{sphinxmanual}' in result
169. 
170. 
171. @pytest.mark.sphinx('latex', testroot='basic',
172.                     confoverrides={
173.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'howto')]
174.                     })
175. def test_latex_basic_howto(app, status, warning):
176.     app.builder.build_all()
177.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
178.     print(result)
179.     assert r'\def\sphinxdocclass{article}' in result
180.     assert r'\documentclass[letterpaper,10pt,english]{sphinxhowto}' in result
181. 
182. 
183. @pytest.mark.sphinx('latex', testroot='basic',
184.                     confoverrides={
185.                         'language': 'ja',
186.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'manual')]
187.                     })
188. def test_latex_basic_manual_ja(app, status, warning):
189.     app.builder.build_all()
190.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
191.     print(result)
192.     assert r'\def\sphinxdocclass{ujbook}' in result
193.     assert r'\documentclass[letterpaper,10pt,dvipdfmx]{sphinxmanual}' in result
194. 
195. 
196. @pytest.mark.sphinx('latex', testroot='basic',
197.                     confoverrides={
198.                         'language': 'ja',
199.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'howto')]
200.                     })
201. def test_latex_basic_howto_ja(app, status, warning):
202.     app.builder.build_all()
203.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
204.     print(result)
205.     assert r'\def\sphinxdocclass{ujreport}' in result
206.     assert r'\documentclass[letterpaper,10pt,dvipdfmx]{sphinxhowto}' in result
207. 
208. 
209. @pytest.mark.sphinx('latex', testroot='latex-theme')
210. def test_latex_theme(app, status, warning):
211.     app.builder.build_all()
212.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
213.     print(result)
214.     assert r'\def\sphinxdocclass{book}' in result
215.     assert r'\documentclass[a4paper,12pt,english]{sphinxbook}' in result
216. 
217. 
218. @pytest.mark.sphinx('latex', testroot='latex-theme',
219.                     confoverrides={'latex_elements': {'papersize': 'b5paper',
220.                                                       'pointsize': '9pt'}})
221. def test_latex_theme_papersize(app, status, warning):
222.     app.builder.build_all()
223.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
224.     print(result)
225.     assert r'\def\sphinxdocclass{book}' in result
226.     assert r'\documentclass[b5paper,9pt,english]{sphinxbook}' in result
227. 
228. 
229. @pytest.mark.sphinx('latex', testroot='latex-theme',
230.                     confoverrides={'latex_theme_options': {'papersize': 'b5paper',
231.                                                            'pointsize': '9pt'}})
232. def test_latex_theme_options(app, status, warning):
233.     app.builder.build_all()
234.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
235.     print(result)
236.     assert r'\def\sphinxdocclass{book}' in result
237.     assert r'\documentclass[b5paper,9pt,english]{sphinxbook}' in result
238. 
239. 
240. @pytest.mark.sphinx('latex', testroot='basic', confoverrides={'language': 'zh'})
241. def test_latex_additional_settings_for_language_code(app, status, warning):
242.     app.builder.build_all()
243.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
244.     print(result)
245.     print(status.getvalue())
246.     print(warning.getvalue())
247.     assert r'\usepackage{xeCJK}' in result
248. 
249. 
250. @pytest.mark.sphinx('latex', testroot='basic', confoverrides={'language': 'el'})
251. def test_latex_additional_settings_for_greek(app, status, warning):
252.     app.builder.build_all()
253.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
254.     print(result)
255.     print(status.getvalue())
256.     print(warning.getvalue())
257.     assert '\\usepackage{polyglossia}\n\\setmainlanguage{greek}' in result
258.     assert '\\newfontfamily\\greekfonttt{FreeMono}' in result
259. 
260. 
261. @pytest.mark.sphinx('latex', testroot='latex-title')
262. def test_latex_title_after_admonitions(app, status, warning):
263.     app.builder.build_all()
264.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
265.     print(result)
266.     print(status.getvalue())
267.     print(warning.getvalue())
268.     assert '\\title{test\\sphinxhyphen{}latex\\sphinxhyphen{}title}' in result
269. 
270. 
271. @pytest.mark.sphinx('latex', testroot='basic',
272.                     confoverrides={'release': '1.0_0'})
273. def test_latex_release(app, status, warning):
274.     app.builder.build_all()
275.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
276.     print(result)
277.     print(status.getvalue())
278.     print(warning.getvalue())
279.     assert r'\release{1.0\_0}' in result
280.     assert r'\renewcommand{\releasename}{Release}' in result
281. 
282. 
283. @pytest.mark.sphinx('latex', testroot='numfig',
284.                     confoverrides={'numfig': True})
285. def test_numref(app, status, warning):
286.     app.builder.build_all()
287.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
288.     print(result)
289.     print(status.getvalue())
290.     print(warning.getvalue())
291.     assert ('\\hyperref[\\detokenize{index:fig1}]'
292.             '{Fig.\\@ \\ref{\\detokenize{index:fig1}}}') in result
293.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
294.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
295.     assert ('\\hyperref[\\detokenize{index:table-1}]'
296.             '{Table \\ref{\\detokenize{index:table-1}}}') in result
297.     assert ('\\hyperref[\\detokenize{baz:table22}]'
298.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
299.     assert ('\\hyperref[\\detokenize{index:code-1}]'
300.             '{Listing \\ref{\\detokenize{index:code-1}}}') in result
301.     assert ('\\hyperref[\\detokenize{baz:code22}]'
302.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
303.     assert ('\\hyperref[\\detokenize{foo:foo}]'
304.             '{Section \\ref{\\detokenize{foo:foo}}}') in result
305.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
306.             '{Section \\ref{\\detokenize{bar:bar-a}}}') in result
307.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
308.             '\\nameref{\\detokenize{index:fig1}}}') in result
309.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
310.             '\\nameref{\\detokenize{foo:foo}}}') in result
311. 
312.     # sphinxmessages.sty
313.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
314.     print(result)
315.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Fig.\@{} }}' in result
316.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Table }}' in result
317.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}' in result
318. 
319. 
320. @pytest.mark.sphinx(
321.     'latex', testroot='numfig',
322.     confoverrides={'numfig': True,
323.                    'numfig_format': {'figure': 'Figure:%s',
324.                                      'table': 'Tab_%s',
325.                                      'code-block': 'Code-%s',
326.                                      'section': 'SECTION-%s'}})
327. def test_numref_with_prefix1(app, status, warning):
328.     app.builder.build_all()
329.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
330.     print(result)
331.     print(status.getvalue())
332.     print(warning.getvalue())
333.     assert '\\ref{\\detokenize{index:fig1}}' in result
334.     assert '\\ref{\\detokenize{baz:fig22}}' in result
335.     assert '\\ref{\\detokenize{index:table-1}}' in result
336.     assert '\\ref{\\detokenize{baz:table22}}' in result
337.     assert '\\ref{\\detokenize{index:code-1}}' in result
338.     assert '\\ref{\\detokenize{baz:code22}}' in result
339.     assert ('\\hyperref[\\detokenize{index:fig1}]'
340.             '{Figure:\\ref{\\detokenize{index:fig1}}}') in result
341.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
342.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
343.     assert ('\\hyperref[\\detokenize{index:table-1}]'
344.             '{Tab\\_\\ref{\\detokenize{index:table-1}}}') in result
345.     assert ('\\hyperref[\\detokenize{baz:table22}]'
346.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
347.     assert ('\\hyperref[\\detokenize{index:code-1}]'
348.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{index:code-1}}}') in result
349.     assert ('\\hyperref[\\detokenize{baz:code22}]'
350.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
351.     assert ('\\hyperref[\\detokenize{foo:foo}]'
352.             '{SECTION\\sphinxhyphen{}\\ref{\\detokenize{foo:foo}}}') in result
353.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
354.             '{SECTION\\sphinxhyphen{}\\ref{\\detokenize{bar:bar-a}}}') in result
355.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
356.             '\\nameref{\\detokenize{index:fig1}}}') in result
357.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
358.             '\\nameref{\\detokenize{foo:foo}}}') in result
359. 
360.     # sphinxmessages.sty
361.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
362.     print(result)
363.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Figure:}}' in result
364.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Tab\_}}' in result
365.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Code-}}' in result
366. 
367. 
368. @pytest.mark.sphinx(
369.     'latex', testroot='numfig',
370.     confoverrides={'numfig': True,
371.                    'numfig_format': {'figure': 'Figure:%s.',
372.                                      'table': 'Tab_%s:',
373.                                      'code-block': 'Code-%s | ',
374.                                      'section': 'SECTION_%s_'}})
375. def test_numref_with_prefix2(app, status, warning):
376.     app.builder.build_all()
377.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
378.     print(result)
379.     print(status.getvalue())
380.     print(warning.getvalue())
381.     assert ('\\hyperref[\\detokenize{index:fig1}]'
382.             '{Figure:\\ref{\\detokenize{index:fig1}}.\\@}') in result
383.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
384.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
385.     assert ('\\hyperref[\\detokenize{index:table-1}]'
386.             '{Tab\\_\\ref{\\detokenize{index:table-1}}:}') in result
387.     assert ('\\hyperref[\\detokenize{baz:table22}]'
388.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
389.     assert ('\\hyperref[\\detokenize{index:code-1}]{Code\\sphinxhyphen{}\\ref{\\detokenize{index:code-1}} '
390.             '| }') in result
391.     assert ('\\hyperref[\\detokenize{baz:code22}]'
392.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
393.     assert ('\\hyperref[\\detokenize{foo:foo}]'
394.             '{SECTION\\_\\ref{\\detokenize{foo:foo}}\\_}') in result
395.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
396.             '{SECTION\\_\\ref{\\detokenize{bar:bar-a}}\\_}') in result
397.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
398.             '\\nameref{\\detokenize{index:fig1}}}') in result
399.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
400.             '\\nameref{\\detokenize{foo:foo}}}') in result
401. 
402.     # sphinxmessages.sty
403.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
404.     print(result)
405.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Figure:}}' in result
406.     assert r'\def\fnum@figure{\figurename\thefigure{}.}' in result
407.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Tab\_}}' in result
408.     assert r'\def\fnum@table{\tablename\thetable{}:}' in result
409.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Code-}}' in result
410. 
411. 
412. @pytest.mark.sphinx(
413.     'latex', testroot='numfig',
414.     confoverrides={'numfig': True, 'language': 'ja'})
415. def test_numref_with_language_ja(app, status, warning):
416.     app.builder.build_all()
417.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
418.     print(result)
419.     print(status.getvalue())
420.     print(warning.getvalue())
421.     assert ('\\hyperref[\\detokenize{index:fig1}]'
422.             '{\u56f3 \\ref{\\detokenize{index:fig1}}}') in result
423.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
424.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
425.     assert ('\\hyperref[\\detokenize{index:table-1}]'
426.             '{\u8868 \\ref{\\detokenize{index:table-1}}}') in result
427.     assert ('\\hyperref[\\detokenize{baz:table22}]'
428.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
429.     assert ('\\hyperref[\\detokenize{index:code-1}]'
430.             '{\u30ea\u30b9\u30c8 \\ref{\\detokenize{index:code-1}}}') in result
431.     assert ('\\hyperref[\\detokenize{baz:code22}]'
432.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
433.     assert ('\\hyperref[\\detokenize{foo:foo}]'
434.             '{\\ref{\\detokenize{foo:foo}} \u7ae0}') in result
435.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
436.             '{\\ref{\\detokenize{bar:bar-a}} \u7ae0}') in result
437.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
438.             '\\nameref{\\detokenize{index:fig1}}}') in result
439.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
440.             '\\nameref{\\detokenize{foo:foo}}}') in result
441. 
442.     # sphinxmessages.sty
443.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
444.     print(result)
445.     assert '\\@iden{\\renewcommand{\\figurename}{図 }}' in result
446.     assert '\\@iden{\\renewcommand{\\tablename}{表 }}' in result
447.     assert '\\@iden{\\renewcommand{\\literalblockname}{リスト}}' in result
448. 
449. 
450. @pytest.mark.sphinx('latex', testroot='latex-numfig')
451. def test_latex_obey_numfig_is_false(app, status, warning):
452.     app.builder.build_all()
453. 
454.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
455.     assert '\\usepackage{sphinx}' in result
456. 
457.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
458.     assert '\\usepackage{sphinx}' in result
459. 
460. 
461. @pytest.mark.sphinx(
462.     'latex', testroot='latex-numfig',
463.     confoverrides={'numfig': True, 'numfig_secnum_depth': 0})
464. def test_latex_obey_numfig_secnum_depth_is_zero(app, status, warning):
465.     app.builder.build_all()
466. 
467.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
468.     assert '\\usepackage[,nonumfigreset,mathnumfig]{sphinx}' in result
469. 
470.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
471.     assert '\\usepackage[,nonumfigreset,mathnumfig]{sphinx}' in result
472. 
473. 
474. @pytest.mark.sphinx(
475.     'latex', testroot='latex-numfig',
476.     confoverrides={'numfig': True, 'numfig_secnum_depth': 2})
477. def test_latex_obey_numfig_secnum_depth_is_two(app, status, warning):
478.     app.builder.build_all()
479. 
480.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
481.     assert '\\usepackage[,numfigreset=2,mathnumfig]{sphinx}' in result
482. 
483.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
484.     assert '\\usepackage[,numfigreset=3,mathnumfig]{sphinx}' in result
485. 
486. 
487. @pytest.mark.sphinx(
488.     'latex', testroot='latex-numfig',
489.     confoverrides={'numfig': True, 'math_numfig': False})
490. def test_latex_obey_numfig_but_math_numfig_false(app, status, warning):
491.     app.builder.build_all()
492. 
493.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
494.     assert '\\usepackage[,numfigreset=1]{sphinx}' in result
495. 
496.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
497.     assert '\\usepackage[,numfigreset=2]{sphinx}' in result
498. 
499. 
500. @pytest.mark.sphinx('latex', testroot='basic')

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 11:28:08,755 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to a bug in LaTeX output for inline code highlighting. The provided context for `tests/test_build_latex.py` contains high-level tests and is not sufficient. The file `tests/test_directive_code.py` and its corresponding test root files are more likely to contain specific tests for code highlighting that can help identify the relevant test cases. I need to examine these files to find tests that use the `code` role with highlighting and check the LaTeX output.' query='Please provide the full content of `tests/test_directive_code.py` and the associated test files `tests/roots/test-directive-code/index.rst` and `tests/roots/test-directive-code/python.rst`.' extra_requirements='' purpose='These files are needed to find specific test cases that cover inline code highlighting in LaTeX, which is the area where the bug is reported.'
2025-12-23 11:28:08,756 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_directive_code.py` and the associated test files `tests/roots/test-directive-code/index.rst` and `tests/roots/test-directive-code/python.rst`.
2025-12-23 11:28:08,756 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 11:28:08,757 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 11:28:08,758 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 11:28:08,758 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_directive_code.py` and the associated test files `tests/roots/test-directive-code/index.rst` and `tests/roots/test-directive-code/python.rst`.
Purpose: These files are needed to find specific test cases that cover inline code highlighting in LaTeX, which is the area where the bug is reported.
2025-12-23 11:28:12,518 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of the three requested files: `tests/test_directive_code.py`, `tests/roots/test-directive-code/index.rst`, and `tests/roots/test-directive-code/python.rst`. These files contain the test cases and reStructuredText source for testing code directives, which will be useful for investigating the inline code highlighting bug in LaTeX.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/roots/test-directive-code/python.rst"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2120, 'candidates_token_count': 160, 'total_token_count': 2455, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2120}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 160}], 'thoughts_token_count': 175, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.04037977755069733, 'model_name': 'gemini-2.5-pro'} id='run--a57af068-63cb-4559-ad37-f6da7579e2ac-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_directive_code.py'}, 'id': 'e0bb6f36-c7f0-437f-be91-b974c6edbc1e', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-directive-code/index.rst'}, 'id': 'b394bc9e-1f85-4011-8cf1-a8a4553f04d5', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-directive-code/python.rst'}, 'id': 'a8bdf96b-a766-40ae-b65e-55795002afc7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2120, 'output_tokens': 160, 'total_tokens': 2455, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 175}}
2025-12-23 11:28:16,488 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of the three requested files: `tests/test_directive_code.py`, `tests/roots/test-directive-code/index.rst`, and `tests/roots/test-directive-code/python.rst`. These files contain the test cases and reStructuredText source for testing code directives, which will be useful for investigating the inline code highlighting bug in LaTeX.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/roots/test-directive-code/python.rst"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11409, 'candidates_token_count': 160, 'total_token_count': 11779, 'cached_content_token_count': 1815, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11409}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1815}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 160}], 'thoughts_token_count': 210}, 'finish_reason': 'STOP', 'avg_logprobs': -0.03675771355628967, 'model_name': 'gemini-2.5-pro'} id='run--1330c738-99c7-45a5-a8da-a85fa0ff0745-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_directive_code.py'}, 'id': '750c68de-622b-4e6b-a366-88a2cede9299', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-directive-code/index.rst'}, 'id': 'b5e3e91b-bd80-40eb-bddf-9bd6de432860', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-directive-code/python.rst'}, 'id': 'e7464011-f54e-4e3d-a3f1-4ea4a9ee5918', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11409, 'output_tokens': 160, 'total_tokens': 11779, 'input_token_details': {'cache_read': 1815}, 'output_token_details': {'reasoning': 210}}
2025-12-23 11:28:21,217 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of the three requested files: `tests/test_directive_code.py`, `tests/roots/test-directive-code/index.rst`, and `tests/roots/test-directive-code/python.rst`. These files contain the test cases and reStructuredText source for testing code directives, which will be useful for investigating the inline code highlighting bug in LaTeX.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 20698, 'candidates_token_count': 83, 'total_token_count': 21142, 'cached_content_token_count': 11164, 'prompt_tokens_details': [{'modality': 1, 'token_count': 20698}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11164}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 83}], 'thoughts_token_count': 361}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2911755895040121, 'model_name': 'gemini-2.5-pro'} id='run--5d9e3cc1-4c35-4fbc-aa1e-c3721dad7e99-0' usage_metadata={'input_tokens': 20698, 'output_tokens': 83, 'total_tokens': 21142, 'input_token_details': {'cache_read': 11164}, 'output_token_details': {'reasoning': 361}}
2025-12-23 11:28:21,219 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_directive_code.py` and the associated test files `tests/roots/test-directive-code/index.rst` and `tests/roots/test-directive-code/python.rst`.
--- END QUERY ---



--- BEGIN PURPOSE ---
These files are needed to find specific test cases that cover inline code highlighting in LaTeX, which is the area where the bug is reported.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/roots/test-directive-code/index.rst
Line number range: 1 - 25
Content:
1. test-directive-code
2. ===================
3. 
4. .. toctree::
5.    :glob:
6. 
7.    *
8. 
9. 
10. Code blocks
11. -----------
12. 
13. .. code-block:: ruby
14.    :linenos:
15. 
16.        def ruby?
17.            false
18.        end
19. 
20. 
21. Literal Includes
22. ----------------
23. 
24. .. literalinclude:: literal.inc
25.    :language: python


File: tests/roots/test-directive-code/python.rst
Line number range: 1 - 13
Content:
1. ===========================
2. Literal Includes for python
3. ===========================
4. 
5. block start with blank or comment
6. =================================
7. 
8. .. literalinclude:: target.py
9.    :pyobject: block_start_with_comment
10. 
11. .. literalinclude:: target.py
12.    :pyobject: block_start_with_blank
13.


File: tests/test_directive_code.py
Line number range: 1 - 500
Content:
1. """Test the code-block directive."""
2. 
3. import os
4. 
5. import pytest
6. from docutils import nodes
7. 
8. from sphinx.config import Config
9. from sphinx.directives.code import LiteralIncludeReader
10. from sphinx.testing.util import etree_parse
11. 
12. DUMMY_CONFIG = Config({}, {})
13. 
14. 
15. @pytest.fixture(scope='module')
16. def testroot(rootdir):
17.     testroot_path = rootdir / 'test-directive-code'
18.     return testroot_path
19. 
20. 
21. @pytest.fixture(scope='module')
22. def literal_inc_path(testroot):
23.     return testroot / 'literal.inc'
24. 
25. 
26. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
27. def test_LiteralIncludeReader(literal_inc_path):
28.     options = {'lineno-match': True}
29.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
30.     content, lines = reader.read()
31.     assert content == literal_inc_path.read_text(encoding='utf8')
32.     assert lines == 13
33.     assert reader.lineno_start == 1
34. 
35. 
36. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
37. def test_LiteralIncludeReader_lineno_start(literal_inc_path):
38.     options = {'lineno-start': 4}
39.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
40.     content, lines = reader.read()
41.     assert content == literal_inc_path.read_text(encoding='utf8')
42.     assert lines == 13
43.     assert reader.lineno_start == 4
44. 
45. 
46. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
47. def test_LiteralIncludeReader_pyobject1(literal_inc_path):
48.     options = {'lineno-match': True, 'pyobject': 'Foo'}
49.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
50.     content, lines = reader.read()
51.     assert content == ("class Foo:\n"
52.                        "    pass\n")
53.     assert reader.lineno_start == 5
54. 
55. 
56. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
57. def test_LiteralIncludeReader_pyobject2(literal_inc_path):
58.     options = {'pyobject': 'Bar'}
59.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
60.     content, lines = reader.read()
61.     assert content == ("class Bar:\n"
62.                        "    def baz():\n"
63.                        "        pass\n")
64.     assert reader.lineno_start == 1  # no lineno-match
65. 
66. 
67. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
68. def test_LiteralIncludeReader_pyobject3(literal_inc_path):
69.     options = {'pyobject': 'Bar.baz'}
70.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
71.     content, lines = reader.read()
72.     assert content == ("    def baz():\n"
73.                        "        pass\n")
74. 
75. 
76. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
77. def test_LiteralIncludeReader_pyobject_and_lines(literal_inc_path):
78.     options = {'pyobject': 'Bar', 'lines': '2-'}
79.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
80.     content, lines = reader.read()
81.     assert content == ("    def baz():\n"
82.                        "        pass\n")
83. 
84. 
85. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
86. def test_LiteralIncludeReader_lines1(literal_inc_path):
87.     options = {'lines': '1-3'}
88.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
89.     content, lines = reader.read()
90.     assert content == ("# Literally included file using Python highlighting\n"
91.                        "\n"
92.                        "foo = \"Including Unicode characters: üöä\"\n")
93. 
94. 
95. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
96. def test_LiteralIncludeReader_lines2(literal_inc_path):
97.     options = {'lines': '1,3,5'}
98.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
99.     content, lines = reader.read()
100.     assert content == ("# Literally included file using Python highlighting\n"
101.                        "foo = \"Including Unicode characters: üöä\"\n"
102.                        "class Foo:\n")
103. 
104. 
105. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
106. def test_LiteralIncludeReader_lines_and_lineno_match1(literal_inc_path):
107.     options = {'lines': '3-5', 'lineno-match': True}
108.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
109.     content, lines = reader.read()
110.     assert content == ("foo = \"Including Unicode characters: üöä\"\n"
111.                        "\n"
112.                        "class Foo:\n")
113.     assert reader.lineno_start == 3
114. 
115. 
116. @pytest.mark.sphinx()  # init locale for errors
117. def test_LiteralIncludeReader_lines_and_lineno_match2(literal_inc_path, app, status, warning):
118.     options = {'lines': '0,3,5', 'lineno-match': True}
119.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
120.     with pytest.raises(ValueError):
121.         content, lines = reader.read()
122. 
123. 
124. @pytest.mark.sphinx()  # init locale for errors
125. def test_LiteralIncludeReader_lines_and_lineno_match3(literal_inc_path, app, status, warning):
126.     options = {'lines': '100-', 'lineno-match': True}
127.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
128.     with pytest.raises(ValueError):
129.         content, lines = reader.read()
130. 
131. 
132. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
133. def test_LiteralIncludeReader_start_at(literal_inc_path):
134.     options = {'lineno-match': True, 'start-at': 'Foo', 'end-at': 'Bar'}
135.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
136.     content, lines = reader.read()
137.     assert content == ("class Foo:\n"
138.                        "    pass\n"
139.                        "\n"
140.                        "class Bar:\n")
141.     assert reader.lineno_start == 5
142. 
143. 
144. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
145. def test_LiteralIncludeReader_start_after(literal_inc_path):
146.     options = {'lineno-match': True, 'start-after': 'Foo', 'end-before': 'Bar'}
147.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
148.     content, lines = reader.read()
149.     assert content == ("    pass\n"
150.                        "\n")
151.     assert reader.lineno_start == 6
152. 
153. 
154. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
155. def test_LiteralIncludeReader_start_after_and_lines(literal_inc_path):
156.     options = {'lineno-match': True, 'lines': '6-',
157.                'start-after': 'Literally', 'end-before': 'comment'}
158.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
159.     content, lines = reader.read()
160.     assert content == ("\n"
161.                        "class Bar:\n"
162.                        "    def baz():\n"
163.                        "        pass\n"
164.                        "\n")
165.     assert reader.lineno_start == 7
166. 
167. 
168. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
169. def test_LiteralIncludeReader_start_at_and_lines(literal_inc_path):
170.     options = {'lines': '2, 3, 5', 'start-at': 'foo', 'end-before': '#'}
171.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
172.     content, lines = reader.read()
173.     assert content == ("\n"
174.                        "class Foo:\n"
175.                        "\n")
176.     assert reader.lineno_start == 1
177. 
178. 
179. def test_LiteralIncludeReader_missing_start_and_end(literal_inc_path):
180.     options = {'start-at': 'NOTHING'}
181.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
182.     with pytest.raises(ValueError):
183.         content, lines = reader.read()
184. 
185.     options = {'end-at': 'NOTHING'}
186.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
187.     with pytest.raises(ValueError):
188.         content, lines = reader.read()
189. 
190.     options = {'start-after': 'NOTHING'}
191.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
192.     with pytest.raises(ValueError):
193.         content, lines = reader.read()
194. 
195.     options = {'end-before': 'NOTHING'}
196.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
197.     with pytest.raises(ValueError):
198.         content, lines = reader.read()
199. 
200. 
201. def test_LiteralIncludeReader_end_before(literal_inc_path):
202.     options = {'end-before': 'nclud'}  # *nclud* matches first and third lines.
203.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
204.     content, lines = reader.read()
205.     assert content == ("# Literally included file using Python highlighting\n"
206.                        "\n")
207. 
208. 
209. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
210. def test_LiteralIncludeReader_prepend(literal_inc_path):
211.     options = {'lines': '1', 'prepend': 'Hello', 'append': 'Sphinx'}
212.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
213.     content, lines = reader.read()
214.     assert content == ("Hello\n"
215.                        "# Literally included file using Python highlighting\n"
216.                        "Sphinx\n")
217. 
218. 
219. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
220. def test_LiteralIncludeReader_dedent(literal_inc_path):
221.     # dedent: 2
222.     options = {'lines': '9-11', 'dedent': 2}
223.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
224.     content, lines = reader.read()
225.     assert content == ("  def baz():\n"
226.                        "      pass\n"
227.                        "\n")
228. 
229.     # dedent: 4
230.     options = {'lines': '9-11', 'dedent': 4}
231.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
232.     content, lines = reader.read()
233.     assert content == ("def baz():\n"
234.                        "    pass\n"
235.                        "\n")
236. 
237.     # dedent: 6
238.     options = {'lines': '9-11', 'dedent': 6}
239.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
240.     content, lines = reader.read()
241.     assert content == ("f baz():\n"
242.                        "  pass\n"
243.                        "\n")
244. 
245.     # dedent: None
246.     options = {'lines': '9-11', 'dedent': None}
247.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
248.     content, lines = reader.read()
249.     assert content == ("def baz():\n"
250.                        "    pass\n"
251.                        "\n")
252. 
253. 
254. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
255. def test_LiteralIncludeReader_dedent_and_append_and_prepend(literal_inc_path):
256.     # dedent: 2
257.     options = {'lines': '9-11', 'dedent': 2, 'prepend': 'class Foo:', 'append': '# comment'}
258.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
259.     content, lines = reader.read()
260.     assert content == ("class Foo:\n"
261.                        "  def baz():\n"
262.                        "      pass\n"
263.                        "\n"
264.                        "# comment\n")
265. 
266. 
267. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
268. def test_LiteralIncludeReader_tabwidth(testroot):
269.     # tab-width: 4
270.     options = {'tab-width': 4, 'pyobject': 'Qux'}
271.     reader = LiteralIncludeReader(testroot / 'target.py', options, DUMMY_CONFIG)
272.     content, lines = reader.read()
273.     assert content == ("class Qux:\n"
274.                        "    def quux(self):\n"
275.                        "        pass\n")
276. 
277.     # tab-width: 8
278.     options = {'tab-width': 8, 'pyobject': 'Qux'}
279.     reader = LiteralIncludeReader(testroot / 'target.py', options, DUMMY_CONFIG)
280.     content, lines = reader.read()
281.     assert content == ("class Qux:\n"
282.                        "        def quux(self):\n"
283.                        "                pass\n")
284. 
285. 
286. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
287. def test_LiteralIncludeReader_tabwidth_dedent(testroot):
288.     options = {'tab-width': 4, 'dedent': 4, 'pyobject': 'Qux.quux'}
289.     reader = LiteralIncludeReader(testroot / 'target.py', options, DUMMY_CONFIG)
290.     content, lines = reader.read()
291.     assert content == ("def quux(self):\n"
292.                        "    pass\n")
293. 
294. 
295. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
296. def test_LiteralIncludeReader_diff(testroot, literal_inc_path):
297.     options = {'diff': testroot / 'literal-diff.inc'}
298.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
299.     content, lines = reader.read()
300.     assert content == ("--- " + testroot + "/literal-diff.inc\n"
301.                        "+++ " + testroot + "/literal.inc\n"
302.                        "@@ -6,8 +6,8 @@\n"
303.                        "     pass\n"
304.                        " \n"
305.                        " class Bar:\n"
306.                        "-    def baz(self):\n"
307.                        "+    def baz():\n"
308.                        "         pass\n"
309.                        " \n"
310.                        "-# comment after Bar class\n"
311.                        "+# comment after Bar class definition\n"
312.                        " def bar(): pass\n")
313. 
314. 
315. @pytest.mark.sphinx('xml', testroot='directive-code')
316. def test_code_block(app, status, warning):
317.     app.builder.build('index')
318.     et = etree_parse(app.outdir / 'index.xml')
319.     secs = et.findall('./section/section')
320.     code_block = secs[0].findall('literal_block')
321.     assert len(code_block) > 0
322.     actual = code_block[0].text
323.     expect = (
324.         "    def ruby?\n" +
325.         "        false\n" +
326.         "    end"
327.     )
328.     assert actual == expect
329. 
330. 
331. @pytest.mark.sphinx('html', testroot='directive-code')
332. def test_force_option(app, status, warning):
333.     app.builder.build(['force'])
334.     assert 'force.rst' not in warning.getvalue()
335. 
336. 
337. @pytest.mark.sphinx('html', testroot='directive-code')
338. def test_code_block_caption_html(app, status, warning):
339.     app.builder.build(['caption'])
340.     html = (app.outdir / 'caption.html').read_text(encoding='utf8')
341.     caption = ('<div class="code-block-caption">'
342.                '<span class="caption-number">Listing 1 </span>'
343.                '<span class="caption-text">caption <em>test</em> rb'
344.                '</span><a class="headerlink" href="#id1" '
345.                'title="Permalink to this code">\xb6</a></div>')
346.     assert caption in html
347. 
348. 
349. @pytest.mark.sphinx('latex', testroot='directive-code')
350. def test_code_block_caption_latex(app, status, warning):
351.     app.builder.build_all()
352.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
353.     caption = '\\sphinxSetupCaptionForVerbatim{caption \\sphinxstyleemphasis{test} rb}'
354.     label = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:id1}}}'
355.     link = '\\hyperref[\\detokenize{caption:name-test-rb}]' \
356.            '{Listing \\ref{\\detokenize{caption:name-test-rb}}}'
357.     assert caption in latex
358.     assert label in latex
359.     assert link in latex
360. 
361. 
362. @pytest.mark.sphinx('latex', testroot='directive-code')
363. def test_code_block_namedlink_latex(app, status, warning):
364.     app.builder.build_all()
365.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
366.     label1 = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:name-test-rb}}}'
367.     link1 = '\\hyperref[\\detokenize{caption:name-test-rb}]'\
368.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{Ruby}}'
369.     label2 = ('\\def\\sphinxLiteralBlockLabel'
370.               '{\\label{\\detokenize{namedblocks:some-ruby-code}}}')
371.     link2 = '\\hyperref[\\detokenize{namedblocks:some-ruby-code}]'\
372.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{the ruby code}}}'
373.     assert label1 in latex
374.     assert link1 in latex
375.     assert label2 in latex
376.     assert link2 in latex
377. 
378. 
379. @pytest.mark.sphinx('latex', testroot='directive-code')
380. def test_code_block_emphasize_latex(app, status, warning):
381.     app.builder.build(['emphasize'])
382.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8').replace('\r\n', '\n')
383.     includes = '\\fvset{hllines={, 5, 6, 13, 14, 15, 24, 25, 26,}}%\n'
384.     assert includes in latex
385.     includes = '\\end{sphinxVerbatim}\n\\sphinxresetverbatimhllines\n'
386.     assert includes in latex
387. 
388. 
389. @pytest.mark.sphinx('xml', testroot='directive-code')
390. def test_literal_include(app, status, warning):
391.     app.builder.build(['index'])
392.     et = etree_parse(app.outdir / 'index.xml')
393.     secs = et.findall('./section/section')
394.     literal_include = secs[1].findall('literal_block')
395.     literal_src = (app.srcdir / 'literal.inc').read_text(encoding='utf8')
396.     assert len(literal_include) > 0
397.     actual = literal_include[0].text
398.     assert actual == literal_src
399. 
400. 
401. @pytest.mark.sphinx('xml', testroot='directive-code')
402. def test_literal_include_block_start_with_comment_or_brank(app, status, warning):
403.     app.builder.build(['python'])
404.     et = etree_parse(app.outdir / 'python.xml')
405.     secs = et.findall('./section/section')
406.     literal_include = secs[0].findall('literal_block')
407.     assert len(literal_include) > 0
408.     actual = literal_include[0].text
409.     expect = (
410.         'def block_start_with_comment():\n'
411.         '    # Comment\n'
412.         '    return 1\n'
413.     )
414.     assert actual == expect
415. 
416.     actual = literal_include[1].text
417.     expect = (
418.         'def block_start_with_blank():\n'
419.         '\n'
420.         '    return 1\n'
421.     )
422.     assert actual == expect
423. 
424. 
425. @pytest.mark.sphinx('html', testroot='directive-code')
426. def test_literal_include_linenos(app, status, warning):
427.     app.builder.build(['linenos'])
428.     html = (app.outdir / 'linenos.html').read_text(encoding='utf8')
429. 
430.     # :linenos:
431.     assert ('<span class="linenos"> 1</span><span class="c1">'
432.             '# Literally included file using Python highlighting</span>' in html)
433. 
434.     # :lineno-start:
435.     assert ('<span class="linenos">200</span><span class="c1">'
436.             '# Literally included file using Python highlighting</span>' in html)
437. 
438.     # :lines: 5-9
439.     assert ('<span class="linenos">5</span><span class="k">class</span> '
440.             '<span class="nc">Foo</span><span class="p">:</span>' in html)
441. 
442. 
443. @pytest.mark.sphinx('latex', testroot='directive-code')
444. def test_literalinclude_file_whole_of_emptyline(app, status, warning):
445.     app.builder.build_all()
446.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8').replace('\r\n', '\n')
447.     includes = (
448.         '\\begin{sphinxVerbatim}'
449.         '[commandchars=\\\\\\{\\},numbers=left,firstnumber=1,stepnumber=1]\n'
450.         '\n'
451.         '\n'
452.         '\n'
453.         '\\end{sphinxVerbatim}\n')
454.     assert includes in latex
455. 
456. 
457. @pytest.mark.sphinx('html', testroot='directive-code')
458. def test_literalinclude_caption_html(app, status, warning):
459.     app.builder.build('index')
460.     html = (app.outdir / 'caption.html').read_text(encoding='utf8')
461.     caption = ('<div class="code-block-caption">'
462.                '<span class="caption-number">Listing 2 </span>'
463.                '<span class="caption-text">caption <strong>test</strong> py'
464.                '</span><a class="headerlink" href="#id2" '
465.                'title="Permalink to this code">\xb6</a></div>')
466.     assert caption in html
467. 
468. 
469. @pytest.mark.sphinx('latex', testroot='directive-code')
470. def test_literalinclude_caption_latex(app, status, warning):
471.     app.builder.build('index')
472.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
473.     caption = '\\sphinxSetupCaptionForVerbatim{caption \\sphinxstylestrong{test} py}'
474.     label = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:id2}}}'
475.     link = '\\hyperref[\\detokenize{caption:name-test-py}]' \
476.            '{Listing \\ref{\\detokenize{caption:name-test-py}}}'
477.     assert caption in latex
478.     assert label in latex
479.     assert link in latex
480. 
481. 
482. @pytest.mark.sphinx('latex', testroot='directive-code')
483. def test_literalinclude_namedlink_latex(app, status, warning):
484.     app.builder.build('index')
485.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
486.     label1 = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:name-test-py}}}'
487.     link1 = '\\hyperref[\\detokenize{caption:name-test-py}]'\
488.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{Python}}'
489.     label2 = ('\\def\\sphinxLiteralBlockLabel'
490.               '{\\label{\\detokenize{namedblocks:some-python-code}}}')
491.     link2 = '\\hyperref[\\detokenize{namedblocks:some-python-code}]'\
492.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{the python code}}}'
493.     assert label1 in latex
494.     assert link1 in latex
495.     assert label2 in latex
496.     assert link2 in latex
497. 
498. 
499. @pytest.mark.sphinx('xml', testroot='directive-code')
500. def test_literalinclude_classes(app, status, warning):

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 11:28:28,398 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user explicitly requested the full content of `tests/test_directive_code.py`. This file contains test cases related to code directives, which is relevant to the user's purpose of investigating a bug in inline code highlighting.", relative_path='tests/test_directive_code.py', start_line=1, end_line=500), ContextOutput(reasoning='The user explicitly requested the full content of `tests/roots/test-directive-code/index.rst`. This is a test file used by `tests/test_directive_code.py` and is necessary to understand the tests.', relative_path='tests/roots/test-directive-code/index.rst', start_line=1, end_line=25), ContextOutput(reasoning='The user explicitly requested the full content of `tests/roots/test-directive-code/python.rst`. This is another test file used by `tests/test_directive_code.py` and is necessary to understand the tests.', relative_path='tests/roots/test-directive-code/python.rst', start_line=1, end_line=13)]
2025-12-23 11:28:28,400 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `tests/test_directive_code.py` and the associated test files `tests/roots/test-directive-code/index.rst` and `tests/roots/test-directive-code/python.rst`.
2025-12-23 11:28:28,400 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 11:28:28,400 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 11:28:28,400 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 2 existing contexts
2025-12-23 11:28:28,401 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 5 total contexts (removed 0 duplicates)
2025-12-23 11:28:28,401 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── create-release.yml
|       ├── docutils-latest.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── automatic-doc-generation.rst
|   |   ├── deploying.rst
|   |   ├── describing-code.rst
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── _sphinx_javascript_frameworks_compat.js
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-duplicates
|   |   |   └── fish_licence
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── dedent.rst
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_class_module.py
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-extlinks-hardcoded-urls
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-extlinks-hardcoded-urls-multiple-replacements
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-intersphinx-role
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── noqa.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-documents_exclude
|   |   |   ├── br0ken_link.rst
|   |   |   ├── broken_link.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-reST-code-role
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_extlinks.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_extension.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── babel_runner.py
    ├── bump_docker.sh
    ├── bump_version.py
    └── doclinter.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: LaTeX: new Inline code highlighting from #10251 adds whitespace at start and end in pdf output

Description: ### Describe the bug

The #10251 enhancement activates syntax highlighting for the Docutiles `code` role. For LaTeX output, a space character is inserted at start and end of the inline code.

Example
```
Inline \sphinxcode{\sphinxupquote{ <--- this produces a space in output
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass} <-- here also
}} code block

```

a priori, mark-up should be:
```
Inline \sphinxcode{\sphinxupquote{%
\PYG{k}{def} \PYG{n+nf}{foo}\PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{+} \PYG{l+m+mi}{2} \PYG{o}{+} \PYG{k+kc}{None} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{abc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass}%
}} code block
```

But I have no no strong opinion if good or bad. See screenshots.

### How to Reproduce

```
.. role:: python(code)
   :language: python
   :class: highlight

Inline :python:`def foo(1 + 2 + None + "abc"): pass` code block

.. code-block:: python

   def foo(1 + 2 + None + "abc"): pass
```

in `index.rst` and `make latexpdf`.

### Expected behavior

_No response_

### Your project

extracted from test_build_latex.py

### Screenshots

with current:

![Capture d’écran 2022-05-08 à 11 11 08](https://user-images.githubusercontent.com/2589111/167289522-fca10320-7df4-439a-9da9-2dbff5a64496.png)

if space characters removed from `.tex` file produced by LaTeX writer:

![Capture d’écran 2022-05-08 à 11 10 32](https://user-images.githubusercontent.com/2589111/167289536-5643529b-4be5-4848-bcde-b1404fe37e5d.png)

For comparison prior to #10251 merge:
![Capture d’écran 2022-05-08 à 11 21 08](https://user-images.githubusercontent.com/2589111/167289864-0773fcef-4a80-42e8-94f9-4da02bc90c68.png)

### OS

Mac

### Python version

3.9

### Sphinx version

5.x

### Sphinx extensions

_No response_

### Extra tools

_No response_

### Additional context

Relates #10251

Patch information:
diff --git a/sphinx/writers/latex.py b/sphinx/writers/latex.py
index e0c7d56f8..a8630b2dd 100644
--- a/sphinx/writers/latex.py
+++ b/sphinx/writers/latex.py
@@ -1711,8 +1711,17 @@ class LaTeXTranslator(SphinxTranslator):
         # https://github.com/pygments/pygments/pull/1343
         hlcode = hlcode.replace(r'\begin{Verbatim}[commandchars=\\\{\}]',
                                 r'\sphinxcode{\sphinxupquote{')
+        # remove the newline immediately after the replaced begin to avoid leading space
+        prefix = r'\sphinxcode{\sphinxupquote{'
+        if hlcode.startswith(prefix):
+            pos = len(prefix)
+            if len(hlcode) > pos and hlcode[pos] in ('\n', '\r'):
+                hlcode = hlcode[:pos] + hlcode[pos + 1:]
         # get consistent trailer
         hlcode = hlcode.rstrip()[:-14]  # strip \end{Verbatim}
+        # remove a single trailing newline before closing braces to avoid trailing space
+        if hlcode.endswith('\n'):
+            hlcode = hlcode[:-1]
         self.body.append(hlcode)
         self.body.append('}}')
         raise nodes.SkipNode


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_build_latex.py` and `sphinx/writers/latex.py`.
Extra Requirements: 
Purpose: This information is essential to find 3 relevant test cases that demonstrate the reported bug or similar functionality, as requested by the user.

Previous refined query 2:
Essential Query: Please provide the full content of `tests/test_directive_code.py` and the associated test files `tests/roots/test-directive-code/index.rst` and `tests/roots/test-directive-code/python.rst`.
Extra Requirements: 
Purpose: These files are needed to find specific test cases that cover inline code highlighting in LaTeX, which is the area where the bug is reported.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sphinx/writers/latex.py
Line number range: 1 - 500
Content:
1. """Custom docutils writer for LaTeX.
2. 
3. Much of this code is adapted from Dave Kuhlman's "docpy" writer from his
4. docutils sandbox.
5. """
6. 
7. import re
8. import warnings
9. from collections import defaultdict
10. from os import path
11. from typing import TYPE_CHECKING, Any, Dict, Iterable, List, Set, Tuple, cast
12. 
13. from docutils import nodes, writers
14. from docutils.nodes import Element, Node, Text
15. 
16. from sphinx import addnodes, highlighting
17. from sphinx.deprecation import RemovedInSphinx70Warning
18. from sphinx.domains import IndexEntry
19. from sphinx.domains.std import StandardDomain
20. from sphinx.errors import SphinxError
21. from sphinx.locale import _, __, admonitionlabels
22. from sphinx.util import logging, split_into, texescape
23. from sphinx.util.docutils import SphinxTranslator
24. from sphinx.util.nodes import clean_astext, get_prev_node
25. from sphinx.util.template import LaTeXRenderer
26. from sphinx.util.texescape import tex_replace_map
27. 
28. try:
29.     from docutils.utils.roman import toRoman
30. except ImportError:
31.     # In Debian/Ubuntu, roman package is provided as roman, not as docutils.utils.roman
32.     from roman import toRoman  # type: ignore
33. 
34. if TYPE_CHECKING:
35.     from sphinx.builders.latex import LaTeXBuilder
36.     from sphinx.builders.latex.theming import Theme
37. 
38. 
39. logger = logging.getLogger(__name__)
40. 
41. MAX_CITATION_LABEL_LENGTH = 8
42. LATEXSECTIONNAMES = ["part", "chapter", "section", "subsection",
43.                      "subsubsection", "paragraph", "subparagraph"]
44. ENUMERATE_LIST_STYLE = defaultdict(lambda: r'\arabic',
45.                                    {
46.                                        'arabic': r'\arabic',
47.                                        'loweralpha': r'\alph',
48.                                        'upperalpha': r'\Alph',
49.                                        'lowerroman': r'\roman',
50.                                        'upperroman': r'\Roman',
51.                                    })
52. 
53. CR = '\n'
54. BLANKLINE = '\n\n'
55. EXTRA_RE = re.compile(r'^(.*\S)\s+\(([^()]*)\)\s*$')
56. 
57. 
58. class collected_footnote(nodes.footnote):
59.     """Footnotes that are collected are assigned this class."""
60. 
61. 
62. class UnsupportedError(SphinxError):
63.     category = 'Markup is unsupported in LaTeX'
64. 
65. 
66. class LaTeXWriter(writers.Writer):
67. 
68.     supported = ('sphinxlatex',)
69. 
70.     settings_spec = ('LaTeX writer options', '', (
71.         ('Document name', ['--docname'], {'default': ''}),
72.         ('Document class', ['--docclass'], {'default': 'manual'}),
73.         ('Author', ['--author'], {'default': ''}),
74.     ))
75.     settings_defaults: Dict = {}
76. 
77.     output = None
78. 
79.     def __init__(self, builder: "LaTeXBuilder") -> None:
80.         super().__init__()
81.         self.builder = builder
82.         self.theme: Theme = None
83. 
84.     def translate(self) -> None:
85.         visitor = self.builder.create_translator(self.document, self.builder, self.theme)
86.         self.document.walkabout(visitor)
87.         self.output = cast(LaTeXTranslator, visitor).astext()
88. 
89. 
90. # Helper classes
91. 
92. class Table:
93.     """A table data"""
94. 
95.     def __init__(self, node: Element) -> None:
96.         self.header: List[str] = []
97.         self.body: List[str] = []
98.         self.align = node.get('align', 'default')
99.         self.classes: List[str] = node.get('classes', [])
100.         self.colcount = 0
101.         self.colspec: str = None
102.         self.colwidths: List[int] = []
103.         self.has_problematic = False
104.         self.has_oldproblematic = False
105.         self.has_verbatim = False
106.         self.caption: List[str] = None
107.         self.stubs: List[int] = []
108. 
109.         # current position
110.         self.col = 0
111.         self.row = 0
112. 
113.         # A dict mapping a table location to a cell_id (cell = rectangular area)
114.         self.cells: Dict[Tuple[int, int], int] = defaultdict(int)
115.         self.cell_id = 0  # last assigned cell_id
116. 
117.     def is_longtable(self) -> bool:
118.         """True if and only if table uses longtable environment."""
119.         return self.row > 30 or 'longtable' in self.classes
120. 
121.     def get_table_type(self) -> str:
122.         """Returns the LaTeX environment name for the table.
123. 
124.         The class currently supports:
125. 
126.         * longtable
127.         * tabular
128.         * tabulary
129.         """
130.         if self.is_longtable():
131.             return 'longtable'
132.         elif self.has_verbatim:
133.             return 'tabular'
134.         elif self.colspec:
135.             return 'tabulary'
136.         elif self.has_problematic or (self.colwidths and 'colwidths-given' in self.classes):
137.             return 'tabular'
138.         else:
139.             return 'tabulary'
140. 
141.     def get_colspec(self) -> str:
142.         """Returns a column spec of table.
143. 
144.         This is what LaTeX calls the 'preamble argument' of the used table environment.
145. 
146.         .. note:: the ``\\X`` and ``T`` column type specifiers are defined in ``sphinx.sty``.
147.         """
148.         if self.colspec:
149.             return self.colspec
150.         elif self.colwidths and 'colwidths-given' in self.classes:
151.             total = sum(self.colwidths)
152.             colspecs = [r'\X{%d}{%d}' % (width, total) for width in self.colwidths]
153.             return '{|%s|}' % '|'.join(colspecs) + CR
154.         elif self.has_problematic:
155.             return r'{|*{%d}{\X{1}{%d}|}}' % (self.colcount, self.colcount) + CR
156.         elif self.get_table_type() == 'tabulary':
157.             # sphinx.sty sets T to be J by default.
158.             return '{|' + ('T|' * self.colcount) + '}' + CR
159.         elif self.has_oldproblematic:
160.             return r'{|*{%d}{\X{1}{%d}|}}' % (self.colcount, self.colcount) + CR
161.         else:
162.             return '{|' + ('l|' * self.colcount) + '}' + CR
163. 
164.     def add_cell(self, height: int, width: int) -> None:
165.         """Adds a new cell to a table.
166. 
167.         It will be located at current position: (``self.row``, ``self.col``).
168.         """
169.         self.cell_id += 1
170.         for col in range(width):
171.             for row in range(height):
172.                 assert self.cells[(self.row + row, self.col + col)] == 0
173.                 self.cells[(self.row + row, self.col + col)] = self.cell_id
174. 
175.     def cell(self, row: int = None, col: int = None) -> "TableCell":
176.         """Returns a cell object (i.e. rectangular area) containing given position.
177. 
178.         If no option arguments: ``row`` or ``col`` are given, the current position;
179.         ``self.row`` and ``self.col`` are used to get a cell object by default.
180.         """
181.         try:
182.             if row is None:
183.                 row = self.row
184.             if col is None:
185.                 col = self.col
186.             return TableCell(self, row, col)
187.         except IndexError:
188.             return None
189. 
190. 
191. class TableCell:
192.     """Data of a cell in a table."""
193. 
194.     def __init__(self, table: Table, row: int, col: int) -> None:
195.         if table.cells[(row, col)] == 0:
196.             raise IndexError
197. 
198.         self.table = table
199.         self.cell_id = table.cells[(row, col)]
200.         self.row = row
201.         self.col = col
202. 
203.         # adjust position for multirow/multicol cell
204.         while table.cells[(self.row - 1, self.col)] == self.cell_id:
205.             self.row -= 1
206.         while table.cells[(self.row, self.col - 1)] == self.cell_id:
207.             self.col -= 1
208. 
209.     @property
210.     def width(self) -> int:
211.         """Returns the cell width."""
212.         width = 0
213.         while self.table.cells[(self.row, self.col + width)] == self.cell_id:
214.             width += 1
215.         return width
216. 
217.     @property
218.     def height(self) -> int:
219.         """Returns the cell height."""
220.         height = 0
221.         while self.table.cells[(self.row + height, self.col)] == self.cell_id:
222.             height += 1
223.         return height
224. 
225. 
226. def escape_abbr(text: str) -> str:
227.     """Adjust spacing after abbreviations."""
228.     return re.sub(r'\.(?=\s|$)', r'.\@', text)
229. 
230. 
231. def rstdim_to_latexdim(width_str: str, scale: int = 100) -> str:
232.     """Convert `width_str` with rst length to LaTeX length."""
233.     match = re.match(r'^(\d*\.?\d*)\s*(\S*)$', width_str)
234.     if not match:
235.         raise ValueError
236.     res = width_str
237.     amount, unit = match.groups()[:2]
238.     if scale == 100:
239.         float(amount)  # validate amount is float
240.         if unit in ('', "px"):
241.             res = r"%s\sphinxpxdimen" % amount
242.         elif unit == 'pt':
243.             res = '%sbp' % amount  # convert to 'bp'
244.         elif unit == "%":
245.             res = r"%.3f\linewidth" % (float(amount) / 100.0)
246.     else:
247.         amount_float = float(amount) * scale / 100.0
248.         if unit in ('', "px"):
249.             res = r"%.5f\sphinxpxdimen" % amount_float
250.         elif unit == 'pt':
251.             res = '%.5fbp' % amount_float
252.         elif unit == "%":
253.             res = r"%.5f\linewidth" % (amount_float / 100.0)
254.         else:
255.             res = "%.5f%s" % (amount_float, unit)
256.     return res
257. 
258. 
259. class LaTeXTranslator(SphinxTranslator):
260.     builder: "LaTeXBuilder" = None
261. 
262.     secnumdepth = 2  # legacy sphinxhowto.cls uses this, whereas article.cls
263.     # default is originally 3. For book/report, 2 is already LaTeX default.
264.     ignore_missing_images = False
265. 
266.     def __init__(self, document: nodes.document, builder: "LaTeXBuilder",
267.                  theme: "Theme") -> None:
268.         super().__init__(document, builder)
269.         self.body: List[str] = []
270.         self.theme = theme
271. 
272.         # flags
273.         self.in_title = 0
274.         self.in_production_list = 0
275.         self.in_footnote = 0
276.         self.in_caption = 0
277.         self.in_term = 0
278.         self.needs_linetrimming = 0
279.         self.in_minipage = 0
280.         self.no_latex_floats = 0
281.         self.first_document = 1
282.         self.this_is_the_title = 1
283.         self.literal_whitespace = 0
284.         self.in_parsed_literal = 0
285.         self.compact_list = 0
286.         self.first_param = 0
287.         self.in_desc_signature = False
288. 
289.         sphinxpkgoptions = []
290. 
291.         # sort out some elements
292.         self.elements = self.builder.context.copy()
293. 
294.         # initial section names
295.         self.sectionnames = LATEXSECTIONNAMES[:]
296.         if self.theme.toplevel_sectioning == 'section':
297.             self.sectionnames.remove('chapter')
298. 
299.         # determine top section level
300.         self.top_sectionlevel = 1
301.         if self.config.latex_toplevel_sectioning:
302.             try:
303.                 self.top_sectionlevel = \
304.                     self.sectionnames.index(self.config.latex_toplevel_sectioning)
305.             except ValueError:
306.                 logger.warning(__('unknown %r toplevel_sectioning for class %r') %
307.                                (self.config.latex_toplevel_sectioning, self.theme.docclass))
308. 
309.         if self.config.numfig:
310.             self.numfig_secnum_depth = self.config.numfig_secnum_depth
311.             if self.numfig_secnum_depth > 0:  # default is 1
312.                 # numfig_secnum_depth as passed to sphinx.sty indices same names as in
313.                 # LATEXSECTIONNAMES but with -1 for part, 0 for chapter, 1 for section...
314.                 if len(self.sectionnames) < len(LATEXSECTIONNAMES) and \
315.                    self.top_sectionlevel > 0:
316.                     self.numfig_secnum_depth += self.top_sectionlevel
317.                 else:
318.                     self.numfig_secnum_depth += self.top_sectionlevel - 1
319.                 # this (minus one) will serve as minimum to LaTeX's secnumdepth
320.                 self.numfig_secnum_depth = min(self.numfig_secnum_depth,
321.                                                len(LATEXSECTIONNAMES) - 1)
322.                 # if passed key value is < 1 LaTeX will act as if 0; see sphinx.sty
323.                 sphinxpkgoptions.append('numfigreset=%s' % self.numfig_secnum_depth)
324.             else:
325.                 sphinxpkgoptions.append('nonumfigreset')
326. 
327.         if self.config.numfig and self.config.math_numfig:
328.             sphinxpkgoptions.append('mathnumfig')
329. 
330.         if (self.config.language not in {'en', 'ja'} and
331.                 'fncychap' not in self.config.latex_elements):
332.             # use Sonny style if any language specified (except English)
333.             self.elements['fncychap'] = (r'\usepackage[Sonny]{fncychap}' + CR +
334.                                          r'\ChNameVar{\Large\normalfont\sffamily}' + CR +
335.                                          r'\ChTitleVar{\Large\normalfont\sffamily}')
336. 
337.         self.babel = self.builder.babel
338.         if not self.babel.is_supported_language():
339.             # emit warning if specified language is invalid
340.             # (only emitting, nothing changed to processing)
341.             logger.warning(__('no Babel option known for language %r'),
342.                            self.config.language)
343. 
344.         minsecnumdepth = self.secnumdepth  # 2 from legacy sphinx manual/howto
345.         if self.document.get('tocdepth'):
346.             # reduce tocdepth if `part` or `chapter` is used for top_sectionlevel
347.             #   tocdepth = -1: show only parts
348.             #   tocdepth =  0: show parts and chapters
349.             #   tocdepth =  1: show parts, chapters and sections
350.             #   tocdepth =  2: show parts, chapters, sections and subsections
351.             #   ...
352.             tocdepth = self.document.get('tocdepth', 999) + self.top_sectionlevel - 2
353.             if len(self.sectionnames) < len(LATEXSECTIONNAMES) and \
354.                self.top_sectionlevel > 0:
355.                 tocdepth += 1  # because top_sectionlevel is shifted by -1
356.             if tocdepth > len(LATEXSECTIONNAMES) - 2:  # default is 5 <-> subparagraph
357.                 logger.warning(__('too large :maxdepth:, ignored.'))
358.                 tocdepth = len(LATEXSECTIONNAMES) - 2
359. 
360.             self.elements['tocdepth'] = r'\setcounter{tocdepth}{%d}' % tocdepth
361.             minsecnumdepth = max(minsecnumdepth, tocdepth)
362. 
363.         if self.config.numfig and (self.config.numfig_secnum_depth > 0):
364.             minsecnumdepth = max(minsecnumdepth, self.numfig_secnum_depth - 1)
365. 
366.         if minsecnumdepth > self.secnumdepth:
367.             self.elements['secnumdepth'] = r'\setcounter{secnumdepth}{%d}' %\
368.                                            minsecnumdepth
369. 
370.         contentsname = document.get('contentsname')
371.         if contentsname:
372.             self.elements['contentsname'] = self.babel_renewcommand(r'\contentsname',
373.                                                                     contentsname)
374. 
375.         if self.elements['maxlistdepth']:
376.             sphinxpkgoptions.append('maxlistdepth=%s' % self.elements['maxlistdepth'])
377.         if sphinxpkgoptions:
378.             self.elements['sphinxpkgoptions'] = '[,%s]' % ','.join(sphinxpkgoptions)
379.         if self.elements['sphinxsetup']:
380.             self.elements['sphinxsetup'] = (r'\sphinxsetup{%s}' % self.elements['sphinxsetup'])
381.         if self.elements['extraclassoptions']:
382.             self.elements['classoptions'] += ',' + \
383.                                              self.elements['extraclassoptions']
384. 
385.         self.highlighter = highlighting.PygmentsBridge('latex', self.config.pygments_style,
386.                                                        latex_engine=self.config.latex_engine)
387.         self.context: List[Any] = []
388.         self.descstack: List[str] = []
389.         self.tables: List[Table] = []
390.         self.next_table_colspec: str = None
391.         self.bodystack: List[List[str]] = []
392.         self.footnote_restricted: Element = None
393.         self.pending_footnotes: List[nodes.footnote_reference] = []
394.         self.curfilestack: List[str] = []
395.         self.handled_abbrs: Set[str] = set()
396. 
397.     def pushbody(self, newbody: List[str]) -> None:
398.         self.bodystack.append(self.body)
399.         self.body = newbody
400. 
401.     def popbody(self) -> List[str]:
402.         body = self.body
403.         self.body = self.bodystack.pop()
404.         return body
405. 
406.     def astext(self) -> str:
407.         self.elements.update({
408.             'body': ''.join(self.body),
409.             'indices': self.generate_indices()
410.         })
411.         return self.render('latex.tex_t', self.elements)
412. 
413.     def hypertarget(self, id: str, withdoc: bool = True, anchor: bool = True) -> str:
414.         if withdoc:
415.             id = self.curfilestack[-1] + ':' + id
416.         return (r'\phantomsection' if anchor else '') + r'\label{%s}' % self.idescape(id)
417. 
418.     def hypertarget_to(self, node: Element, anchor: bool = False) -> str:
419.         labels = ''.join(self.hypertarget(node_id, anchor=False) for node_id in node['ids'])
420.         if anchor:
421.             return r'\phantomsection' + labels
422.         else:
423.             return labels
424. 
425.     def hyperlink(self, id: str) -> str:
426.         return r'{\hyperref[%s]{' % self.idescape(id)
427. 
428.     def hyperpageref(self, id: str) -> str:
429.         return r'\autopageref*{%s}' % self.idescape(id)
430. 
431.     def escape(self, s: str) -> str:
432.         return texescape.escape(s, self.config.latex_engine)
433. 
434.     def idescape(self, id: str) -> str:
435.         return r'\detokenize{%s}' % str(id).translate(tex_replace_map).\
436.             encode('ascii', 'backslashreplace').decode('ascii').\
437.             replace('\\', '_')
438. 
439.     def babel_renewcommand(self, command: str, definition: str) -> str:
440.         if self.elements['multilingual']:
441.             prefix = r'\addto\captions%s{' % self.babel.get_language()
442.             suffix = '}'
443.         else:  # babel is disabled (mainly for Japanese environment)
444.             prefix = ''
445.             suffix = ''
446. 
447.         return r'%s\renewcommand{%s}{%s}%s' % (prefix, command, definition, suffix) + CR
448. 
449.     def generate_indices(self) -> str:
450.         def generate(content: List[Tuple[str, List[IndexEntry]]], collapsed: bool) -> None:
451.             ret.append(r'\begin{sphinxtheindex}' + CR)
452.             ret.append(r'\let\bigletter\sphinxstyleindexlettergroup' + CR)
453.             for i, (letter, entries) in enumerate(content):
454.                 if i > 0:
455.                     ret.append(r'\indexspace' + CR)
456.                 ret.append(r'\bigletter{%s}' % self.escape(letter) + CR)
457.                 for entry in entries:
458.                     if not entry[3]:
459.                         continue
460.                     ret.append(r'\item\relax\sphinxstyleindexentry{%s}' %
461.                                self.encode(entry[0]))
462.                     if entry[4]:
463.                         # add "extra" info
464.                         ret.append(r'\sphinxstyleindexextra{%s}' % self.encode(entry[4]))
465.                     ret.append(r'\sphinxstyleindexpageref{%s:%s}' %
466.                                (entry[2], self.idescape(entry[3])) + CR)
467.             ret.append(r'\end{sphinxtheindex}' + CR)
468. 
469.         ret = []
470.         # latex_domain_indices can be False/True or a list of index names
471.         indices_config = self.config.latex_domain_indices
472.         if indices_config:
473.             for domain in self.builder.env.domains.values():
474.                 for indexcls in domain.indices:
475.                     indexname = '%s-%s' % (domain.name, indexcls.name)
476.                     if isinstance(indices_config, list):
477.                         if indexname not in indices_config:
478.                             continue
479.                     content, collapsed = indexcls(domain).generate(
480.                         self.builder.docnames)
481.                     if not content:
482.                         continue
483.                     ret.append(r'\renewcommand{\indexname}{%s}' % indexcls.localname + CR)
484.                     generate(content, collapsed)
485. 
486.         return ''.join(ret)
487. 
488.     def render(self, template_name: str, variables: Dict) -> str:
489.         renderer = LaTeXRenderer(latex_engine=self.config.latex_engine)
490.         for template_dir in self.config.templates_path:
491.             template = path.join(self.builder.confdir, template_dir,
492.                                  template_name)
493.             if path.exists(template):
494.                 return renderer.render(template, variables)
495. 
496.         return renderer.render(template_name, variables)
497. 
498.     @property
499.     def table(self) -> Table:
500.         """Get current table."""


File: tests/roots/test-directive-code/index.rst
Line number range: 1 - 25
Content:
1. test-directive-code
2. ===================
3. 
4. .. toctree::
5.    :glob:
6. 
7.    *
8. 
9. 
10. Code blocks
11. -----------
12. 
13. .. code-block:: ruby
14.    :linenos:
15. 
16.        def ruby?
17.            false
18.        end
19. 
20. 
21. Literal Includes
22. ----------------
23. 
24. .. literalinclude:: literal.inc
25.    :language: python


File: tests/roots/test-directive-code/python.rst
Line number range: 1 - 13
Content:
1. ===========================
2. Literal Includes for python
3. ===========================
4. 
5. block start with blank or comment
6. =================================
7. 
8. .. literalinclude:: target.py
9.    :pyobject: block_start_with_comment
10. 
11. .. literalinclude:: target.py
12.    :pyobject: block_start_with_blank
13. 


File: tests/test_build_latex.py
Line number range: 1 - 500
Content:
1. """Test the build process with LaTeX builder with the test root."""
2. 
3. import os
4. import re
5. import subprocess
6. from itertools import product
7. from shutil import copyfile
8. from subprocess import PIPE, CalledProcessError
9. 
10. import pytest
11. 
12. from sphinx.builders.latex import default_latex_documents
13. from sphinx.config import Config
14. from sphinx.errors import SphinxError
15. from sphinx.testing.util import strip_escseq
16. from sphinx.util.osutil import cd, ensuredir
17. from sphinx.writers.latex import LaTeXTranslator
18. 
19. from .test_build_html import ENV_WARNINGS
20. 
21. LATEX_ENGINES = ['pdflatex', 'lualatex', 'xelatex']
22. DOCCLASSES = ['howto', 'manual']
23. STYLEFILES = ['article.cls', 'fancyhdr.sty', 'titlesec.sty', 'amsmath.sty',
24.               'framed.sty', 'color.sty', 'fancyvrb.sty',
25.               'fncychap.sty', 'geometry.sty', 'kvoptions.sty', 'hyperref.sty']
26. 
27. LATEX_WARNINGS = ENV_WARNINGS + """\
28. %(root)s/index.rst:\\d+: WARNING: unknown option: &option
29. %(root)s/index.rst:\\d+: WARNING: citation not found: missing
30. %(root)s/index.rst:\\d+: WARNING: a suitable image for latex builder not found: foo.\\*
31. %(root)s/index.rst:\\d+: WARNING: Could not lex literal_block as "c". Highlighting skipped.
32. """
33. 
34. 
35. # only run latex if all needed packages are there
36. def kpsetest(*filenames):
37.     try:
38.         subprocess.run(['kpsewhich'] + list(filenames), stdout=PIPE, stderr=PIPE, check=True)
39.         return True
40.     except (OSError, CalledProcessError):
41.         return False  # command not found or exit with non-zero
42. 
43. 
44. # compile latex document with app.config.latex_engine
45. def compile_latex_document(app, filename='python.tex'):
46.     # now, try to run latex over it
47.     try:
48.         with cd(app.outdir):
49.             ensuredir(app.config.latex_engine)
50.             # keep a copy of latex file for this engine in case test fails
51.             copyfile(filename, app.config.latex_engine + '/' + filename)
52.             args = [app.config.latex_engine,
53.                     '--halt-on-error',
54.                     '--interaction=nonstopmode',
55.                     '-output-directory=%s' % app.config.latex_engine,
56.                     filename]
57.             subprocess.run(args, stdout=PIPE, stderr=PIPE, check=True)
58.     except OSError as exc:  # most likely the latex executable was not found
59.         raise pytest.skip.Exception from exc
60.     except CalledProcessError as exc:
61.         print(exc.stdout)
62.         print(exc.stderr)
63.         assert False, '%s exited with return code %s' % (app.config.latex_engine,
64.                                                          exc.returncode)
65. 
66. 
67. def skip_if_requested(testfunc):
68.     if 'SKIP_LATEX_BUILD' in os.environ:
69.         msg = 'Skip LaTeX builds because SKIP_LATEX_BUILD is set'
70.         return pytest.mark.skipif(True, reason=msg)(testfunc)
71.     else:
72.         return testfunc
73. 
74. 
75. def skip_if_stylefiles_notfound(testfunc):
76.     if kpsetest(*STYLEFILES) is False:
77.         msg = 'not running latex, the required styles do not seem to be installed'
78.         return pytest.mark.skipif(True, reason=msg)(testfunc)
79.     else:
80.         return testfunc
81. 
82. 
83. @skip_if_requested
84. @skip_if_stylefiles_notfound
85. @pytest.mark.parametrize(
86.     "engine,docclass",
87.     product(LATEX_ENGINES, DOCCLASSES),
88. )
89. @pytest.mark.sphinx('latex')
90. def test_build_latex_doc(app, status, warning, engine, docclass):
91.     app.config.latex_engine = engine
92.     app.config.latex_documents = [app.config.latex_documents[0][:4] + (docclass,)]
93.     app.builder.init()
94. 
95.     LaTeXTranslator.ignore_missing_images = True
96.     app.builder.build_all()
97. 
98.     # file from latex_additional_files
99.     assert (app.outdir / 'svgimg.svg').isfile()
100. 
101.     compile_latex_document(app, 'sphinxtests.tex')
102. 
103. 
104. @pytest.mark.sphinx('latex')
105. def test_writer(app, status, warning):
106.     app.builder.build_all()
107.     result = (app.outdir / 'sphinxtests.tex').read_text(encoding='utf8')
108. 
109.     assert ('\\begin{sphinxfigure-in-table}\n\\centering\n\\capstart\n'
110.             '\\noindent\\sphinxincludegraphics{{img}.png}\n'
111.             '\\sphinxfigcaption{figure in table}\\label{\\detokenize{markup:id8}}'
112.             '\\end{sphinxfigure-in-table}\\relax' in result)
113. 
114.     assert ('\\begin{wrapfigure}{r}{0pt}\n\\centering\n'
115.             '\\noindent\\sphinxincludegraphics{{rimg}.png}\n'
116.             '\\caption{figure with align option}\\label{\\detokenize{markup:id9}}'
117.             '\\end{wrapfigure}' in result)
118. 
119.     assert ('\\begin{wrapfigure}{r}{0.500\\linewidth}\n\\centering\n'
120.             '\\noindent\\sphinxincludegraphics{{rimg}.png}\n'
121.             '\\caption{figure with align \\& figwidth option}'
122.             '\\label{\\detokenize{markup:id10}}'
123.             '\\end{wrapfigure}' in result)
124. 
125.     assert ('\\begin{wrapfigure}{r}{3cm}\n\\centering\n'
126.             '\\noindent\\sphinxincludegraphics[width=3cm]{{rimg}.png}\n'
127.             '\\caption{figure with align \\& width option}'
128.             '\\label{\\detokenize{markup:id11}}'
129.             '\\end{wrapfigure}' in result)
130. 
131.     assert 'Footnotes' not in result
132. 
133. 
134. @pytest.mark.sphinx('latex', testroot='warnings', freshenv=True)
135. def test_latex_warnings(app, status, warning):
136.     app.builder.build_all()
137. 
138.     warnings = strip_escseq(re.sub(re.escape(os.sep) + '{1,2}', '/', warning.getvalue()))
139.     warnings_exp = LATEX_WARNINGS % {
140.         'root': re.escape(app.srcdir.replace(os.sep, '/'))}
141.     assert re.match(warnings_exp + '$', warnings), \
142.         'Warnings don\'t match:\n' + \
143.         '--- Expected (regex):\n' + warnings_exp + \
144.         '--- Got:\n' + warnings
145. 
146. 
147. @pytest.mark.sphinx('latex', testroot='basic')
148. def test_latex_basic(app, status, warning):
149.     app.builder.build_all()
150.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
151.     print(result)
152.     print(status.getvalue())
153.     print(warning.getvalue())
154.     assert r'\title{The basic Sphinx documentation for testing}' in result
155.     assert r'\release{}' in result
156.     assert r'\renewcommand{\releasename}{}' in result
157. 
158. 
159. @pytest.mark.sphinx('latex', testroot='basic',
160.                     confoverrides={
161.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'manual')]
162.                     })
163. def test_latex_basic_manual(app, status, warning):
164.     app.builder.build_all()
165.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
166.     print(result)
167.     assert r'\def\sphinxdocclass{report}' in result
168.     assert r'\documentclass[letterpaper,10pt,english]{sphinxmanual}' in result
169. 
170. 
171. @pytest.mark.sphinx('latex', testroot='basic',
172.                     confoverrides={
173.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'howto')]
174.                     })
175. def test_latex_basic_howto(app, status, warning):
176.     app.builder.build_all()
177.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
178.     print(result)
179.     assert r'\def\sphinxdocclass{article}' in result
180.     assert r'\documentclass[letterpaper,10pt,english]{sphinxhowto}' in result
181. 
182. 
183. @pytest.mark.sphinx('latex', testroot='basic',
184.                     confoverrides={
185.                         'language': 'ja',
186.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'manual')]
187.                     })
188. def test_latex_basic_manual_ja(app, status, warning):
189.     app.builder.build_all()
190.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
191.     print(result)
192.     assert r'\def\sphinxdocclass{ujbook}' in result
193.     assert r'\documentclass[letterpaper,10pt,dvipdfmx]{sphinxmanual}' in result
194. 
195. 
196. @pytest.mark.sphinx('latex', testroot='basic',
197.                     confoverrides={
198.                         'language': 'ja',
199.                         'latex_documents': [('index', 'test.tex', 'title', 'author', 'howto')]
200.                     })
201. def test_latex_basic_howto_ja(app, status, warning):
202.     app.builder.build_all()
203.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
204.     print(result)
205.     assert r'\def\sphinxdocclass{ujreport}' in result
206.     assert r'\documentclass[letterpaper,10pt,dvipdfmx]{sphinxhowto}' in result
207. 
208. 
209. @pytest.mark.sphinx('latex', testroot='latex-theme')
210. def test_latex_theme(app, status, warning):
211.     app.builder.build_all()
212.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
213.     print(result)
214.     assert r'\def\sphinxdocclass{book}' in result
215.     assert r'\documentclass[a4paper,12pt,english]{sphinxbook}' in result
216. 
217. 
218. @pytest.mark.sphinx('latex', testroot='latex-theme',
219.                     confoverrides={'latex_elements': {'papersize': 'b5paper',
220.                                                       'pointsize': '9pt'}})
221. def test_latex_theme_papersize(app, status, warning):
222.     app.builder.build_all()
223.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
224.     print(result)
225.     assert r'\def\sphinxdocclass{book}' in result
226.     assert r'\documentclass[b5paper,9pt,english]{sphinxbook}' in result
227. 
228. 
229. @pytest.mark.sphinx('latex', testroot='latex-theme',
230.                     confoverrides={'latex_theme_options': {'papersize': 'b5paper',
231.                                                            'pointsize': '9pt'}})
232. def test_latex_theme_options(app, status, warning):
233.     app.builder.build_all()
234.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
235.     print(result)
236.     assert r'\def\sphinxdocclass{book}' in result
237.     assert r'\documentclass[b5paper,9pt,english]{sphinxbook}' in result
238. 
239. 
240. @pytest.mark.sphinx('latex', testroot='basic', confoverrides={'language': 'zh'})
241. def test_latex_additional_settings_for_language_code(app, status, warning):
242.     app.builder.build_all()
243.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
244.     print(result)
245.     print(status.getvalue())
246.     print(warning.getvalue())
247.     assert r'\usepackage{xeCJK}' in result
248. 
249. 
250. @pytest.mark.sphinx('latex', testroot='basic', confoverrides={'language': 'el'})
251. def test_latex_additional_settings_for_greek(app, status, warning):
252.     app.builder.build_all()
253.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
254.     print(result)
255.     print(status.getvalue())
256.     print(warning.getvalue())
257.     assert '\\usepackage{polyglossia}\n\\setmainlanguage{greek}' in result
258.     assert '\\newfontfamily\\greekfonttt{FreeMono}' in result
259. 
260. 
261. @pytest.mark.sphinx('latex', testroot='latex-title')
262. def test_latex_title_after_admonitions(app, status, warning):
263.     app.builder.build_all()
264.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
265.     print(result)
266.     print(status.getvalue())
267.     print(warning.getvalue())
268.     assert '\\title{test\\sphinxhyphen{}latex\\sphinxhyphen{}title}' in result
269. 
270. 
271. @pytest.mark.sphinx('latex', testroot='basic',
272.                     confoverrides={'release': '1.0_0'})
273. def test_latex_release(app, status, warning):
274.     app.builder.build_all()
275.     result = (app.outdir / 'test.tex').read_text(encoding='utf8')
276.     print(result)
277.     print(status.getvalue())
278.     print(warning.getvalue())
279.     assert r'\release{1.0\_0}' in result
280.     assert r'\renewcommand{\releasename}{Release}' in result
281. 
282. 
283. @pytest.mark.sphinx('latex', testroot='numfig',
284.                     confoverrides={'numfig': True})
285. def test_numref(app, status, warning):
286.     app.builder.build_all()
287.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
288.     print(result)
289.     print(status.getvalue())
290.     print(warning.getvalue())
291.     assert ('\\hyperref[\\detokenize{index:fig1}]'
292.             '{Fig.\\@ \\ref{\\detokenize{index:fig1}}}') in result
293.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
294.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
295.     assert ('\\hyperref[\\detokenize{index:table-1}]'
296.             '{Table \\ref{\\detokenize{index:table-1}}}') in result
297.     assert ('\\hyperref[\\detokenize{baz:table22}]'
298.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
299.     assert ('\\hyperref[\\detokenize{index:code-1}]'
300.             '{Listing \\ref{\\detokenize{index:code-1}}}') in result
301.     assert ('\\hyperref[\\detokenize{baz:code22}]'
302.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
303.     assert ('\\hyperref[\\detokenize{foo:foo}]'
304.             '{Section \\ref{\\detokenize{foo:foo}}}') in result
305.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
306.             '{Section \\ref{\\detokenize{bar:bar-a}}}') in result
307.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
308.             '\\nameref{\\detokenize{index:fig1}}}') in result
309.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
310.             '\\nameref{\\detokenize{foo:foo}}}') in result
311. 
312.     # sphinxmessages.sty
313.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
314.     print(result)
315.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Fig.\@{} }}' in result
316.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Table }}' in result
317.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}' in result
318. 
319. 
320. @pytest.mark.sphinx(
321.     'latex', testroot='numfig',
322.     confoverrides={'numfig': True,
323.                    'numfig_format': {'figure': 'Figure:%s',
324.                                      'table': 'Tab_%s',
325.                                      'code-block': 'Code-%s',
326.                                      'section': 'SECTION-%s'}})
327. def test_numref_with_prefix1(app, status, warning):
328.     app.builder.build_all()
329.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
330.     print(result)
331.     print(status.getvalue())
332.     print(warning.getvalue())
333.     assert '\\ref{\\detokenize{index:fig1}}' in result
334.     assert '\\ref{\\detokenize{baz:fig22}}' in result
335.     assert '\\ref{\\detokenize{index:table-1}}' in result
336.     assert '\\ref{\\detokenize{baz:table22}}' in result
337.     assert '\\ref{\\detokenize{index:code-1}}' in result
338.     assert '\\ref{\\detokenize{baz:code22}}' in result
339.     assert ('\\hyperref[\\detokenize{index:fig1}]'
340.             '{Figure:\\ref{\\detokenize{index:fig1}}}') in result
341.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
342.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
343.     assert ('\\hyperref[\\detokenize{index:table-1}]'
344.             '{Tab\\_\\ref{\\detokenize{index:table-1}}}') in result
345.     assert ('\\hyperref[\\detokenize{baz:table22}]'
346.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
347.     assert ('\\hyperref[\\detokenize{index:code-1}]'
348.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{index:code-1}}}') in result
349.     assert ('\\hyperref[\\detokenize{baz:code22}]'
350.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
351.     assert ('\\hyperref[\\detokenize{foo:foo}]'
352.             '{SECTION\\sphinxhyphen{}\\ref{\\detokenize{foo:foo}}}') in result
353.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
354.             '{SECTION\\sphinxhyphen{}\\ref{\\detokenize{bar:bar-a}}}') in result
355.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
356.             '\\nameref{\\detokenize{index:fig1}}}') in result
357.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
358.             '\\nameref{\\detokenize{foo:foo}}}') in result
359. 
360.     # sphinxmessages.sty
361.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
362.     print(result)
363.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Figure:}}' in result
364.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Tab\_}}' in result
365.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Code-}}' in result
366. 
367. 
368. @pytest.mark.sphinx(
369.     'latex', testroot='numfig',
370.     confoverrides={'numfig': True,
371.                    'numfig_format': {'figure': 'Figure:%s.',
372.                                      'table': 'Tab_%s:',
373.                                      'code-block': 'Code-%s | ',
374.                                      'section': 'SECTION_%s_'}})
375. def test_numref_with_prefix2(app, status, warning):
376.     app.builder.build_all()
377.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
378.     print(result)
379.     print(status.getvalue())
380.     print(warning.getvalue())
381.     assert ('\\hyperref[\\detokenize{index:fig1}]'
382.             '{Figure:\\ref{\\detokenize{index:fig1}}.\\@}') in result
383.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
384.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
385.     assert ('\\hyperref[\\detokenize{index:table-1}]'
386.             '{Tab\\_\\ref{\\detokenize{index:table-1}}:}') in result
387.     assert ('\\hyperref[\\detokenize{baz:table22}]'
388.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
389.     assert ('\\hyperref[\\detokenize{index:code-1}]{Code\\sphinxhyphen{}\\ref{\\detokenize{index:code-1}} '
390.             '| }') in result
391.     assert ('\\hyperref[\\detokenize{baz:code22}]'
392.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
393.     assert ('\\hyperref[\\detokenize{foo:foo}]'
394.             '{SECTION\\_\\ref{\\detokenize{foo:foo}}\\_}') in result
395.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
396.             '{SECTION\\_\\ref{\\detokenize{bar:bar-a}}\\_}') in result
397.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
398.             '\\nameref{\\detokenize{index:fig1}}}') in result
399.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
400.             '\\nameref{\\detokenize{foo:foo}}}') in result
401. 
402.     # sphinxmessages.sty
403.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
404.     print(result)
405.     assert r'\addto\captionsenglish{\renewcommand{\figurename}{Figure:}}' in result
406.     assert r'\def\fnum@figure{\figurename\thefigure{}.}' in result
407.     assert r'\addto\captionsenglish{\renewcommand{\tablename}{Tab\_}}' in result
408.     assert r'\def\fnum@table{\tablename\thetable{}:}' in result
409.     assert r'\addto\captionsenglish{\renewcommand{\literalblockname}{Code-}}' in result
410. 
411. 
412. @pytest.mark.sphinx(
413.     'latex', testroot='numfig',
414.     confoverrides={'numfig': True, 'language': 'ja'})
415. def test_numref_with_language_ja(app, status, warning):
416.     app.builder.build_all()
417.     result = (app.outdir / 'python.tex').read_text(encoding='utf8')
418.     print(result)
419.     print(status.getvalue())
420.     print(warning.getvalue())
421.     assert ('\\hyperref[\\detokenize{index:fig1}]'
422.             '{\u56f3 \\ref{\\detokenize{index:fig1}}}') in result
423.     assert ('\\hyperref[\\detokenize{baz:fig22}]'
424.             '{Figure\\ref{\\detokenize{baz:fig22}}}') in result
425.     assert ('\\hyperref[\\detokenize{index:table-1}]'
426.             '{\u8868 \\ref{\\detokenize{index:table-1}}}') in result
427.     assert ('\\hyperref[\\detokenize{baz:table22}]'
428.             '{Table:\\ref{\\detokenize{baz:table22}}}') in result
429.     assert ('\\hyperref[\\detokenize{index:code-1}]'
430.             '{\u30ea\u30b9\u30c8 \\ref{\\detokenize{index:code-1}}}') in result
431.     assert ('\\hyperref[\\detokenize{baz:code22}]'
432.             '{Code\\sphinxhyphen{}\\ref{\\detokenize{baz:code22}}}') in result
433.     assert ('\\hyperref[\\detokenize{foo:foo}]'
434.             '{\\ref{\\detokenize{foo:foo}} \u7ae0}') in result
435.     assert ('\\hyperref[\\detokenize{bar:bar-a}]'
436.             '{\\ref{\\detokenize{bar:bar-a}} \u7ae0}') in result
437.     assert ('\\hyperref[\\detokenize{index:fig1}]{Fig.\\ref{\\detokenize{index:fig1}} '
438.             '\\nameref{\\detokenize{index:fig1}}}') in result
439.     assert ('\\hyperref[\\detokenize{foo:foo}]{Sect.\\ref{\\detokenize{foo:foo}} '
440.             '\\nameref{\\detokenize{foo:foo}}}') in result
441. 
442.     # sphinxmessages.sty
443.     result = (app.outdir / 'sphinxmessages.sty').read_text(encoding='utf8')
444.     print(result)
445.     assert '\\@iden{\\renewcommand{\\figurename}{図 }}' in result
446.     assert '\\@iden{\\renewcommand{\\tablename}{表 }}' in result
447.     assert '\\@iden{\\renewcommand{\\literalblockname}{リスト}}' in result
448. 
449. 
450. @pytest.mark.sphinx('latex', testroot='latex-numfig')
451. def test_latex_obey_numfig_is_false(app, status, warning):
452.     app.builder.build_all()
453. 
454.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
455.     assert '\\usepackage{sphinx}' in result
456. 
457.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
458.     assert '\\usepackage{sphinx}' in result
459. 
460. 
461. @pytest.mark.sphinx(
462.     'latex', testroot='latex-numfig',
463.     confoverrides={'numfig': True, 'numfig_secnum_depth': 0})
464. def test_latex_obey_numfig_secnum_depth_is_zero(app, status, warning):
465.     app.builder.build_all()
466. 
467.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
468.     assert '\\usepackage[,nonumfigreset,mathnumfig]{sphinx}' in result
469. 
470.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
471.     assert '\\usepackage[,nonumfigreset,mathnumfig]{sphinx}' in result
472. 
473. 
474. @pytest.mark.sphinx(
475.     'latex', testroot='latex-numfig',
476.     confoverrides={'numfig': True, 'numfig_secnum_depth': 2})
477. def test_latex_obey_numfig_secnum_depth_is_two(app, status, warning):
478.     app.builder.build_all()
479. 
480.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
481.     assert '\\usepackage[,numfigreset=2,mathnumfig]{sphinx}' in result
482. 
483.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
484.     assert '\\usepackage[,numfigreset=3,mathnumfig]{sphinx}' in result
485. 
486. 
487. @pytest.mark.sphinx(
488.     'latex', testroot='latex-numfig',
489.     confoverrides={'numfig': True, 'math_numfig': False})
490. def test_latex_obey_numfig_but_math_numfig_false(app, status, warning):
491.     app.builder.build_all()
492. 
493.     result = (app.outdir / 'SphinxManual.tex').read_text(encoding='utf8')
494.     assert '\\usepackage[,numfigreset=1]{sphinx}' in result
495. 
496.     result = (app.outdir / 'SphinxHowTo.tex').read_text(encoding='utf8')
497.     assert '\\usepackage[,numfigreset=2]{sphinx}' in result
498. 
499. 
500. @pytest.mark.sphinx('latex', testroot='basic')


File: tests/test_directive_code.py
Line number range: 1 - 500
Content:
1. """Test the code-block directive."""
2. 
3. import os
4. 
5. import pytest
6. from docutils import nodes
7. 
8. from sphinx.config import Config
9. from sphinx.directives.code import LiteralIncludeReader
10. from sphinx.testing.util import etree_parse
11. 
12. DUMMY_CONFIG = Config({}, {})
13. 
14. 
15. @pytest.fixture(scope='module')
16. def testroot(rootdir):
17.     testroot_path = rootdir / 'test-directive-code'
18.     return testroot_path
19. 
20. 
21. @pytest.fixture(scope='module')
22. def literal_inc_path(testroot):
23.     return testroot / 'literal.inc'
24. 
25. 
26. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
27. def test_LiteralIncludeReader(literal_inc_path):
28.     options = {'lineno-match': True}
29.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
30.     content, lines = reader.read()
31.     assert content == literal_inc_path.read_text(encoding='utf8')
32.     assert lines == 13
33.     assert reader.lineno_start == 1
34. 
35. 
36. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
37. def test_LiteralIncludeReader_lineno_start(literal_inc_path):
38.     options = {'lineno-start': 4}
39.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
40.     content, lines = reader.read()
41.     assert content == literal_inc_path.read_text(encoding='utf8')
42.     assert lines == 13
43.     assert reader.lineno_start == 4
44. 
45. 
46. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
47. def test_LiteralIncludeReader_pyobject1(literal_inc_path):
48.     options = {'lineno-match': True, 'pyobject': 'Foo'}
49.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
50.     content, lines = reader.read()
51.     assert content == ("class Foo:\n"
52.                        "    pass\n")
53.     assert reader.lineno_start == 5
54. 
55. 
56. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
57. def test_LiteralIncludeReader_pyobject2(literal_inc_path):
58.     options = {'pyobject': 'Bar'}
59.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
60.     content, lines = reader.read()
61.     assert content == ("class Bar:\n"
62.                        "    def baz():\n"
63.                        "        pass\n")
64.     assert reader.lineno_start == 1  # no lineno-match
65. 
66. 
67. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
68. def test_LiteralIncludeReader_pyobject3(literal_inc_path):
69.     options = {'pyobject': 'Bar.baz'}
70.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
71.     content, lines = reader.read()
72.     assert content == ("    def baz():\n"
73.                        "        pass\n")
74. 
75. 
76. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
77. def test_LiteralIncludeReader_pyobject_and_lines(literal_inc_path):
78.     options = {'pyobject': 'Bar', 'lines': '2-'}
79.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
80.     content, lines = reader.read()
81.     assert content == ("    def baz():\n"
82.                        "        pass\n")
83. 
84. 
85. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
86. def test_LiteralIncludeReader_lines1(literal_inc_path):
87.     options = {'lines': '1-3'}
88.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
89.     content, lines = reader.read()
90.     assert content == ("# Literally included file using Python highlighting\n"
91.                        "\n"
92.                        "foo = \"Including Unicode characters: üöä\"\n")
93. 
94. 
95. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
96. def test_LiteralIncludeReader_lines2(literal_inc_path):
97.     options = {'lines': '1,3,5'}
98.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
99.     content, lines = reader.read()
100.     assert content == ("# Literally included file using Python highlighting\n"
101.                        "foo = \"Including Unicode characters: üöä\"\n"
102.                        "class Foo:\n")
103. 
104. 
105. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
106. def test_LiteralIncludeReader_lines_and_lineno_match1(literal_inc_path):
107.     options = {'lines': '3-5', 'lineno-match': True}
108.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
109.     content, lines = reader.read()
110.     assert content == ("foo = \"Including Unicode characters: üöä\"\n"
111.                        "\n"
112.                        "class Foo:\n")
113.     assert reader.lineno_start == 3
114. 
115. 
116. @pytest.mark.sphinx()  # init locale for errors
117. def test_LiteralIncludeReader_lines_and_lineno_match2(literal_inc_path, app, status, warning):
118.     options = {'lines': '0,3,5', 'lineno-match': True}
119.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
120.     with pytest.raises(ValueError):
121.         content, lines = reader.read()
122. 
123. 
124. @pytest.mark.sphinx()  # init locale for errors
125. def test_LiteralIncludeReader_lines_and_lineno_match3(literal_inc_path, app, status, warning):
126.     options = {'lines': '100-', 'lineno-match': True}
127.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
128.     with pytest.raises(ValueError):
129.         content, lines = reader.read()
130. 
131. 
132. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
133. def test_LiteralIncludeReader_start_at(literal_inc_path):
134.     options = {'lineno-match': True, 'start-at': 'Foo', 'end-at': 'Bar'}
135.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
136.     content, lines = reader.read()
137.     assert content == ("class Foo:\n"
138.                        "    pass\n"
139.                        "\n"
140.                        "class Bar:\n")
141.     assert reader.lineno_start == 5
142. 
143. 
144. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
145. def test_LiteralIncludeReader_start_after(literal_inc_path):
146.     options = {'lineno-match': True, 'start-after': 'Foo', 'end-before': 'Bar'}
147.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
148.     content, lines = reader.read()
149.     assert content == ("    pass\n"
150.                        "\n")
151.     assert reader.lineno_start == 6
152. 
153. 
154. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
155. def test_LiteralIncludeReader_start_after_and_lines(literal_inc_path):
156.     options = {'lineno-match': True, 'lines': '6-',
157.                'start-after': 'Literally', 'end-before': 'comment'}
158.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
159.     content, lines = reader.read()
160.     assert content == ("\n"
161.                        "class Bar:\n"
162.                        "    def baz():\n"
163.                        "        pass\n"
164.                        "\n")
165.     assert reader.lineno_start == 7
166. 
167. 
168. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
169. def test_LiteralIncludeReader_start_at_and_lines(literal_inc_path):
170.     options = {'lines': '2, 3, 5', 'start-at': 'foo', 'end-before': '#'}
171.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
172.     content, lines = reader.read()
173.     assert content == ("\n"
174.                        "class Foo:\n"
175.                        "\n")
176.     assert reader.lineno_start == 1
177. 
178. 
179. def test_LiteralIncludeReader_missing_start_and_end(literal_inc_path):
180.     options = {'start-at': 'NOTHING'}
181.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
182.     with pytest.raises(ValueError):
183.         content, lines = reader.read()
184. 
185.     options = {'end-at': 'NOTHING'}
186.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
187.     with pytest.raises(ValueError):
188.         content, lines = reader.read()
189. 
190.     options = {'start-after': 'NOTHING'}
191.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
192.     with pytest.raises(ValueError):
193.         content, lines = reader.read()
194. 
195.     options = {'end-before': 'NOTHING'}
196.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
197.     with pytest.raises(ValueError):
198.         content, lines = reader.read()
199. 
200. 
201. def test_LiteralIncludeReader_end_before(literal_inc_path):
202.     options = {'end-before': 'nclud'}  # *nclud* matches first and third lines.
203.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
204.     content, lines = reader.read()
205.     assert content == ("# Literally included file using Python highlighting\n"
206.                        "\n")
207. 
208. 
209. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
210. def test_LiteralIncludeReader_prepend(literal_inc_path):
211.     options = {'lines': '1', 'prepend': 'Hello', 'append': 'Sphinx'}
212.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
213.     content, lines = reader.read()
214.     assert content == ("Hello\n"
215.                        "# Literally included file using Python highlighting\n"
216.                        "Sphinx\n")
217. 
218. 
219. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
220. def test_LiteralIncludeReader_dedent(literal_inc_path):
221.     # dedent: 2
222.     options = {'lines': '9-11', 'dedent': 2}
223.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
224.     content, lines = reader.read()
225.     assert content == ("  def baz():\n"
226.                        "      pass\n"
227.                        "\n")
228. 
229.     # dedent: 4
230.     options = {'lines': '9-11', 'dedent': 4}
231.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
232.     content, lines = reader.read()
233.     assert content == ("def baz():\n"
234.                        "    pass\n"
235.                        "\n")
236. 
237.     # dedent: 6
238.     options = {'lines': '9-11', 'dedent': 6}
239.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
240.     content, lines = reader.read()
241.     assert content == ("f baz():\n"
242.                        "  pass\n"
243.                        "\n")
244. 
245.     # dedent: None
246.     options = {'lines': '9-11', 'dedent': None}
247.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
248.     content, lines = reader.read()
249.     assert content == ("def baz():\n"
250.                        "    pass\n"
251.                        "\n")
252. 
253. 
254. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
255. def test_LiteralIncludeReader_dedent_and_append_and_prepend(literal_inc_path):
256.     # dedent: 2
257.     options = {'lines': '9-11', 'dedent': 2, 'prepend': 'class Foo:', 'append': '# comment'}
258.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
259.     content, lines = reader.read()
260.     assert content == ("class Foo:\n"
261.                        "  def baz():\n"
262.                        "      pass\n"
263.                        "\n"
264.                        "# comment\n")
265. 
266. 
267. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
268. def test_LiteralIncludeReader_tabwidth(testroot):
269.     # tab-width: 4
270.     options = {'tab-width': 4, 'pyobject': 'Qux'}
271.     reader = LiteralIncludeReader(testroot / 'target.py', options, DUMMY_CONFIG)
272.     content, lines = reader.read()
273.     assert content == ("class Qux:\n"
274.                        "    def quux(self):\n"
275.                        "        pass\n")
276. 
277.     # tab-width: 8
278.     options = {'tab-width': 8, 'pyobject': 'Qux'}
279.     reader = LiteralIncludeReader(testroot / 'target.py', options, DUMMY_CONFIG)
280.     content, lines = reader.read()
281.     assert content == ("class Qux:\n"
282.                        "        def quux(self):\n"
283.                        "                pass\n")
284. 
285. 
286. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
287. def test_LiteralIncludeReader_tabwidth_dedent(testroot):
288.     options = {'tab-width': 4, 'dedent': 4, 'pyobject': 'Qux.quux'}
289.     reader = LiteralIncludeReader(testroot / 'target.py', options, DUMMY_CONFIG)
290.     content, lines = reader.read()
291.     assert content == ("def quux(self):\n"
292.                        "    pass\n")
293. 
294. 
295. @pytest.mark.xfail(os.name != 'posix', reason="Not working on windows")
296. def test_LiteralIncludeReader_diff(testroot, literal_inc_path):
297.     options = {'diff': testroot / 'literal-diff.inc'}
298.     reader = LiteralIncludeReader(literal_inc_path, options, DUMMY_CONFIG)
299.     content, lines = reader.read()
300.     assert content == ("--- " + testroot + "/literal-diff.inc\n"
301.                        "+++ " + testroot + "/literal.inc\n"
302.                        "@@ -6,8 +6,8 @@\n"
303.                        "     pass\n"
304.                        " \n"
305.                        " class Bar:\n"
306.                        "-    def baz(self):\n"
307.                        "+    def baz():\n"
308.                        "         pass\n"
309.                        " \n"
310.                        "-# comment after Bar class\n"
311.                        "+# comment after Bar class definition\n"
312.                        " def bar(): pass\n")
313. 
314. 
315. @pytest.mark.sphinx('xml', testroot='directive-code')
316. def test_code_block(app, status, warning):
317.     app.builder.build('index')
318.     et = etree_parse(app.outdir / 'index.xml')
319.     secs = et.findall('./section/section')
320.     code_block = secs[0].findall('literal_block')
321.     assert len(code_block) > 0
322.     actual = code_block[0].text
323.     expect = (
324.         "    def ruby?\n" +
325.         "        false\n" +
326.         "    end"
327.     )
328.     assert actual == expect
329. 
330. 
331. @pytest.mark.sphinx('html', testroot='directive-code')
332. def test_force_option(app, status, warning):
333.     app.builder.build(['force'])
334.     assert 'force.rst' not in warning.getvalue()
335. 
336. 
337. @pytest.mark.sphinx('html', testroot='directive-code')
338. def test_code_block_caption_html(app, status, warning):
339.     app.builder.build(['caption'])
340.     html = (app.outdir / 'caption.html').read_text(encoding='utf8')
341.     caption = ('<div class="code-block-caption">'
342.                '<span class="caption-number">Listing 1 </span>'
343.                '<span class="caption-text">caption <em>test</em> rb'
344.                '</span><a class="headerlink" href="#id1" '
345.                'title="Permalink to this code">\xb6</a></div>')
346.     assert caption in html
347. 
348. 
349. @pytest.mark.sphinx('latex', testroot='directive-code')
350. def test_code_block_caption_latex(app, status, warning):
351.     app.builder.build_all()
352.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
353.     caption = '\\sphinxSetupCaptionForVerbatim{caption \\sphinxstyleemphasis{test} rb}'
354.     label = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:id1}}}'
355.     link = '\\hyperref[\\detokenize{caption:name-test-rb}]' \
356.            '{Listing \\ref{\\detokenize{caption:name-test-rb}}}'
357.     assert caption in latex
358.     assert label in latex
359.     assert link in latex
360. 
361. 
362. @pytest.mark.sphinx('latex', testroot='directive-code')
363. def test_code_block_namedlink_latex(app, status, warning):
364.     app.builder.build_all()
365.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
366.     label1 = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:name-test-rb}}}'
367.     link1 = '\\hyperref[\\detokenize{caption:name-test-rb}]'\
368.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{Ruby}}'
369.     label2 = ('\\def\\sphinxLiteralBlockLabel'
370.               '{\\label{\\detokenize{namedblocks:some-ruby-code}}}')
371.     link2 = '\\hyperref[\\detokenize{namedblocks:some-ruby-code}]'\
372.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{the ruby code}}}'
373.     assert label1 in latex
374.     assert link1 in latex
375.     assert label2 in latex
376.     assert link2 in latex
377. 
378. 
379. @pytest.mark.sphinx('latex', testroot='directive-code')
380. def test_code_block_emphasize_latex(app, status, warning):
381.     app.builder.build(['emphasize'])
382.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8').replace('\r\n', '\n')
383.     includes = '\\fvset{hllines={, 5, 6, 13, 14, 15, 24, 25, 26,}}%\n'
384.     assert includes in latex
385.     includes = '\\end{sphinxVerbatim}\n\\sphinxresetverbatimhllines\n'
386.     assert includes in latex
387. 
388. 
389. @pytest.mark.sphinx('xml', testroot='directive-code')
390. def test_literal_include(app, status, warning):
391.     app.builder.build(['index'])
392.     et = etree_parse(app.outdir / 'index.xml')
393.     secs = et.findall('./section/section')
394.     literal_include = secs[1].findall('literal_block')
395.     literal_src = (app.srcdir / 'literal.inc').read_text(encoding='utf8')
396.     assert len(literal_include) > 0
397.     actual = literal_include[0].text
398.     assert actual == literal_src
399. 
400. 
401. @pytest.mark.sphinx('xml', testroot='directive-code')
402. def test_literal_include_block_start_with_comment_or_brank(app, status, warning):
403.     app.builder.build(['python'])
404.     et = etree_parse(app.outdir / 'python.xml')
405.     secs = et.findall('./section/section')
406.     literal_include = secs[0].findall('literal_block')
407.     assert len(literal_include) > 0
408.     actual = literal_include[0].text
409.     expect = (
410.         'def block_start_with_comment():\n'
411.         '    # Comment\n'
412.         '    return 1\n'
413.     )
414.     assert actual == expect
415. 
416.     actual = literal_include[1].text
417.     expect = (
418.         'def block_start_with_blank():\n'
419.         '\n'
420.         '    return 1\n'
421.     )
422.     assert actual == expect
423. 
424. 
425. @pytest.mark.sphinx('html', testroot='directive-code')
426. def test_literal_include_linenos(app, status, warning):
427.     app.builder.build(['linenos'])
428.     html = (app.outdir / 'linenos.html').read_text(encoding='utf8')
429. 
430.     # :linenos:
431.     assert ('<span class="linenos"> 1</span><span class="c1">'
432.             '# Literally included file using Python highlighting</span>' in html)
433. 
434.     # :lineno-start:
435.     assert ('<span class="linenos">200</span><span class="c1">'
436.             '# Literally included file using Python highlighting</span>' in html)
437. 
438.     # :lines: 5-9
439.     assert ('<span class="linenos">5</span><span class="k">class</span> '
440.             '<span class="nc">Foo</span><span class="p">:</span>' in html)
441. 
442. 
443. @pytest.mark.sphinx('latex', testroot='directive-code')
444. def test_literalinclude_file_whole_of_emptyline(app, status, warning):
445.     app.builder.build_all()
446.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8').replace('\r\n', '\n')
447.     includes = (
448.         '\\begin{sphinxVerbatim}'
449.         '[commandchars=\\\\\\{\\},numbers=left,firstnumber=1,stepnumber=1]\n'
450.         '\n'
451.         '\n'
452.         '\n'
453.         '\\end{sphinxVerbatim}\n')
454.     assert includes in latex
455. 
456. 
457. @pytest.mark.sphinx('html', testroot='directive-code')
458. def test_literalinclude_caption_html(app, status, warning):
459.     app.builder.build('index')
460.     html = (app.outdir / 'caption.html').read_text(encoding='utf8')
461.     caption = ('<div class="code-block-caption">'
462.                '<span class="caption-number">Listing 2 </span>'
463.                '<span class="caption-text">caption <strong>test</strong> py'
464.                '</span><a class="headerlink" href="#id2" '
465.                'title="Permalink to this code">\xb6</a></div>')
466.     assert caption in html
467. 
468. 
469. @pytest.mark.sphinx('latex', testroot='directive-code')
470. def test_literalinclude_caption_latex(app, status, warning):
471.     app.builder.build('index')
472.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
473.     caption = '\\sphinxSetupCaptionForVerbatim{caption \\sphinxstylestrong{test} py}'
474.     label = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:id2}}}'
475.     link = '\\hyperref[\\detokenize{caption:name-test-py}]' \
476.            '{Listing \\ref{\\detokenize{caption:name-test-py}}}'
477.     assert caption in latex
478.     assert label in latex
479.     assert link in latex
480. 
481. 
482. @pytest.mark.sphinx('latex', testroot='directive-code')
483. def test_literalinclude_namedlink_latex(app, status, warning):
484.     app.builder.build('index')
485.     latex = (app.outdir / 'python.tex').read_text(encoding='utf8')
486.     label1 = '\\def\\sphinxLiteralBlockLabel{\\label{\\detokenize{caption:name-test-py}}}'
487.     link1 = '\\hyperref[\\detokenize{caption:name-test-py}]'\
488.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{Python}}'
489.     label2 = ('\\def\\sphinxLiteralBlockLabel'
490.               '{\\label{\\detokenize{namedblocks:some-python-code}}}')
491.     link2 = '\\hyperref[\\detokenize{namedblocks:some-python-code}]'\
492.             '{\\sphinxcrossref{\\DUrole{std,std-ref}{the python code}}}'
493.     assert label1 in latex
494.     assert link1 in latex
495.     assert label2 in latex
496.     assert link2 in latex
497. 
498. 
499. @pytest.mark.sphinx('xml', testroot='directive-code')
500. def test_literalinclude_classes(app, status, warning):

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 11:28:55,842 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's bug report concerns the LaTeX output of the inline `code` role. The provided context contains tests for the `code-block` directive (`test_directive_code.py`) and general LaTeX build tests (`test_build_latex.py`), but lacks specific tests for the inline `code` role's rendering. To find relevant test cases, I need to examine tests that specifically handle reStructuredText markup parsing and rendering, and `tests/test_markup.py` is the most likely file to contain such targeted tests." query='Please provide the full content of `tests/test_markup.py`.' extra_requirements='' purpose="This file is needed to find test cases that specifically exercise the inline `code` role and its output in the LaTeX builder, which is directly related to the user's bug report."
2025-12-23 11:28:55,843 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_markup.py`.
2025-12-23 11:28:55,843 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 11:28:55,844 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 11:28:55,844 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 11:28:55,844 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_markup.py`.
Purpose: This file is needed to find test cases that specifically exercise the inline `code` role and its output in the LaTeX builder, which is directly related to the user's bug report.
2025-12-23 11:28:57,746 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_markup.py"}'}, '__gemini_function_call_thought_signatures__': {'5b70f07f-e8b9-446e-88df-2c1bfb0e7372': 'CsADAY89a1/8ectB50Awr/U+T3i+kTrYV6bcuCZEBa8EGo5cNUOfT0mPIMPGvb9ipZg3B/PtMy7Qwoyog7tktymENbq3aVG/fvuhNey8NiyFfrtqwPKqiozJ4xaSmI95pQjtu31v0VSmgDz6mUXLdmBkGZoa0DHixK4mTT5UiM2EQaeIz/FqbW/IAZMo3mBjoOMI/9TMYvfV9Hr44odRWKHQUX6xXMcW4mY2Q8bLudrxvp6OEchOVTqPS/hZFmzvVILpb6+QZWGdN54UuTWUqEF7VE1jF2fG4lIkQhZwtlb89qbOBGvhHiF30cZjb6dL528kIYbh/ktHkSGQxAF95eneG/Y/lm46Ip3I3xTD828nXSELZSk1rp6zaJm6F58S95eTX+Rit6XnKnXWCsIAz6t2Jc5l9JiVIvo6DFAqziM8yIIqNInpSE0zop14HzJtxLVvIkHRA3mX9ItRRPrSyga0e5zv4IrmmysmTPzP/g7edvEMCZIyD9Z8fM/E9KpHKLSl7zbtgvGRxb36OGa+bfM3bQ4DP7XKN0w8fqHMvksj5hZVYeXuowBop8GQqqwYQZU0i6K4/v+fjMW+VQhGFIrhgA=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2092, 'candidates_token_count': 21, 'total_token_count': 2229, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2092}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 21}], 'thoughts_token_count': 116, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.15906119346618652, 'model_name': 'gemini-2.5-pro'} id='run--13a4a648-b92a-42dd-a8c4-c2eb1084180a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_markup.py'}, 'id': '5b70f07f-e8b9-446e-88df-2c1bfb0e7372', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2092, 'output_tokens': 21, 'total_tokens': 2229, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 116}}
2025-12-23 11:29:00,571 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/test_markup.py`. This file contains a comprehensive suite of tests for various Sphinx-specific markup extensions, which is essential for understanding how different roles and directives are processed. I can now proceed to analyze the test cases to identify those that specifically target the inline `code` role and its behavior within the LaTeX builder.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10146, 'candidates_token_count': 74, 'total_token_count': 10326, 'cached_content_token_count': 1794, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10262}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1794}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 74}], 'thoughts_token_count': 106}, 'finish_reason': 'STOP', 'avg_logprobs': -0.32311532304093643, 'model_name': 'gemini-2.5-pro'} id='run--1a5c656b-413b-4f61-8118-546076cdf546-0' usage_metadata={'input_tokens': 10146, 'output_tokens': 74, 'total_tokens': 10326, 'input_token_details': {'cache_read': 1794}, 'output_token_details': {'reasoning': 106}}
2025-12-23 11:29:00,573 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_markup.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is needed to find test cases that specifically exercise the inline `code` role and its output in the LaTeX builder, which is directly related to the user's bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_markup.py
Line number range: 1 - 500
Content:
1. """Test various Sphinx-specific markup extensions."""
2. 
3. import re
4. import warnings
5. 
6. import docutils
7. import pytest
8. from docutils import frontend, nodes, utils
9. from docutils.parsers.rst import Parser as RstParser
10. 
11. from sphinx import addnodes
12. from sphinx.builders.html.transforms import KeyboardTransform
13. from sphinx.builders.latex import LaTeXBuilder
14. from sphinx.environment import default_settings
15. from sphinx.roles import XRefRole
16. from sphinx.testing.util import Struct, assert_node
17. from sphinx.transforms import SphinxSmartQuotes
18. from sphinx.util import texescape
19. from sphinx.util.docutils import sphinx_domains
20. from sphinx.writers.html import HTMLTranslator, HTMLWriter
21. from sphinx.writers.latex import LaTeXTranslator, LaTeXWriter
22. 
23. 
24. @pytest.fixture
25. def settings(app):
26.     texescape.init()  # otherwise done by the latex builder
27.     with warnings.catch_warnings():
28.         warnings.filterwarnings('ignore', category=DeprecationWarning)
29.         # DeprecationWarning: The frontend.OptionParser class will be replaced
30.         # by a subclass of argparse.ArgumentParser in Docutils 0.21 or later.
31.         optparser = frontend.OptionParser(
32.             components=(RstParser, HTMLWriter, LaTeXWriter),
33.             defaults=default_settings)
34.     settings = optparser.get_default_values()
35.     settings.smart_quotes = True
36.     settings.env = app.builder.env
37.     settings.env.temp_data['docname'] = 'dummy'
38.     settings.contentsname = 'dummy'
39.     domain_context = sphinx_domains(settings.env)
40.     domain_context.enable()
41.     yield settings
42.     domain_context.disable()
43. 
44. 
45. @pytest.fixture
46. def new_document(settings):
47.     def create():
48.         document = utils.new_document('test data', settings)
49.         document['file'] = 'dummy'
50.         return document
51. 
52.     return create
53. 
54. 
55. @pytest.fixture
56. def inliner(new_document):
57.     document = new_document()
58.     document.reporter.get_source_and_line = lambda line=1: ('dummy.rst', line)
59.     return Struct(document=document, reporter=document.reporter)
60. 
61. 
62. @pytest.fixture
63. def parse(new_document):
64.     def parse_(rst):
65.         document = new_document()
66.         parser = RstParser()
67.         parser.parse(rst, document)
68.         SphinxSmartQuotes(document, startnode=None).apply()
69.         for msg in list(document.findall(nodes.system_message)):
70.             if msg['level'] == 1:
71.                 msg.replace_self([])
72.         return document
73.     return parse_
74. 
75. 
76. # since we're not resolving the markup afterwards, these nodes may remain
77. class ForgivingTranslator:
78.     def visit_pending_xref(self, node):
79.         pass
80. 
81.     def depart_pending_xref(self, node):
82.         pass
83. 
84. 
85. class ForgivingHTMLTranslator(HTMLTranslator, ForgivingTranslator):
86.     pass
87. 
88. 
89. class ForgivingLaTeXTranslator(LaTeXTranslator, ForgivingTranslator):
90.     pass
91. 
92. 
93. @pytest.fixture
94. def verify_re_html(app, parse):
95.     def verify(rst, html_expected):
96.         document = parse(rst)
97.         KeyboardTransform(document).apply()
98.         html_translator = ForgivingHTMLTranslator(document, app.builder)
99.         document.walkabout(html_translator)
100.         html_translated = ''.join(html_translator.fragment).strip()
101.         assert re.match(html_expected, html_translated), 'from ' + rst
102.     return verify
103. 
104. 
105. @pytest.fixture
106. def verify_re_latex(app, parse):
107.     def verify(rst, latex_expected):
108.         document = parse(rst)
109.         app.builder = LaTeXBuilder(app)
110.         app.builder.set_environment(app.env)
111.         app.builder.init()
112.         theme = app.builder.themes.get('manual')
113.         latex_translator = ForgivingLaTeXTranslator(document, app.builder, theme)
114.         latex_translator.first_document = -1  # don't write \begin{document}
115.         document.walkabout(latex_translator)
116.         latex_translated = ''.join(latex_translator.body).strip()
117.         assert re.match(latex_expected, latex_translated), 'from ' + repr(rst)
118.     return verify
119. 
120. 
121. @pytest.fixture
122. def verify_re(verify_re_html, verify_re_latex):
123.     def verify_re_(rst, html_expected, latex_expected):
124.         if html_expected:
125.             verify_re_html(rst, html_expected)
126.         if latex_expected:
127.             verify_re_latex(rst, latex_expected)
128.     return verify_re_
129. 
130. 
131. @pytest.fixture
132. def verify(verify_re_html, verify_re_latex):
133.     def verify_(rst, html_expected, latex_expected):
134.         if html_expected:
135.             verify_re_html(rst, re.escape(html_expected) + '$')
136.         if latex_expected:
137.             verify_re_latex(rst, re.escape(latex_expected) + '$')
138.     return verify_
139. 
140. 
141. @pytest.fixture
142. def get_verifier(verify, verify_re):
143.     v = {
144.         'verify': verify,
145.         'verify_re': verify_re,
146.     }
147. 
148.     def get(name):
149.         return v[name]
150.     return get
151. 
152. 
153. @pytest.mark.parametrize('type,rst,html_expected,latex_expected', [
154.     (
155.         # pep role
156.         'verify',
157.         ':pep:`8`',
158.         ('<p><span class="target" id="index-0"></span><a class="pep reference external" '
159.          'href="https://peps.python.org/pep-0008/"><strong>PEP 8</strong></a></p>'),
160.         ('\\sphinxAtStartPar\n'
161.          '\\index{Python Enhancement Proposals@\\spxentry{Python Enhancement Proposals}'
162.          '!PEP 8@\\spxentry{PEP 8}}\\sphinxhref{https://peps.python.org/pep-0008/}'
163.          '{\\sphinxstylestrong{PEP 8}}')
164.     ),
165.     (
166.         # pep role with anchor
167.         'verify',
168.         ':pep:`8#id1`',
169.         ('<p><span class="target" id="index-0"></span><a class="pep reference external" '
170.          'href="https://peps.python.org/pep-0008/#id1">'
171.          '<strong>PEP 8#id1</strong></a></p>'),
172.         ('\\sphinxAtStartPar\n'
173.          '\\index{Python Enhancement Proposals@\\spxentry{Python Enhancement Proposals}'
174.          '!PEP 8\\#id1@\\spxentry{PEP 8\\#id1}}\\sphinxhref'
175.          '{https://peps.python.org/pep-0008/\\#id1}'
176.          '{\\sphinxstylestrong{PEP 8\\#id1}}')
177.     ),
178.     (
179.         # rfc role
180.         'verify',
181.         ':rfc:`2324`',
182.         ('<p><span class="target" id="index-0"></span><a class="rfc reference external" '
183.          'href="https://datatracker.ietf.org/doc/html/rfc2324.html"><strong>RFC 2324</strong></a></p>'),
184.         ('\\sphinxAtStartPar\n'
185.          '\\index{RFC@\\spxentry{RFC}!RFC 2324@\\spxentry{RFC 2324}}'
186.          '\\sphinxhref{https://datatracker.ietf.org/doc/html/rfc2324.html}'
187.          '{\\sphinxstylestrong{RFC 2324}}')
188.     ),
189.     (
190.         # rfc role with anchor
191.         'verify',
192.         ':rfc:`2324#id1`',
193.         ('<p><span class="target" id="index-0"></span><a class="rfc reference external" '
194.          'href="https://datatracker.ietf.org/doc/html/rfc2324.html#id1">'
195.          '<strong>RFC 2324#id1</strong></a></p>'),
196.         ('\\sphinxAtStartPar\n'
197.          '\\index{RFC@\\spxentry{RFC}!RFC 2324\\#id1@\\spxentry{RFC 2324\\#id1}}'
198.          '\\sphinxhref{https://datatracker.ietf.org/doc/html/rfc2324.html\\#id1}'
199.          '{\\sphinxstylestrong{RFC 2324\\#id1}}')
200.     ),
201.     (
202.         # correct interpretation of code with whitespace
203.         'verify_re',
204.         '``code   sample``',
205.         ('<p><code class="(samp )?docutils literal notranslate"><span class="pre">'
206.          'code</span>&#160;&#160; <span class="pre">sample</span></code></p>'),
207.         r'\\sphinxAtStartPar\n\\sphinxcode{\\sphinxupquote{code   sample}}',
208.     ),
209.     (
210.         # interpolation of arrows in menuselection
211.         'verify',
212.         ':menuselection:`a --> b`',
213.         ('<p><span class="menuselection">a \N{TRIANGULAR BULLET} b</span></p>'),
214.         '\\sphinxAtStartPar\n\\sphinxmenuselection{a \\(\\rightarrow\\) b}',
215.     ),
216.     (
217.         # interpolation of ampersands in menuselection
218.         'verify',
219.         ':menuselection:`&Foo -&&- &Bar`',
220.         ('<p><span class="menuselection"><span class="accelerator">F</span>oo '
221.          '-&amp;- <span class="accelerator">B</span>ar</span></p>'),
222.         ('\\sphinxAtStartPar\n'
223.          r'\sphinxmenuselection{\sphinxaccelerator{F}oo \sphinxhyphen{}'
224.          r'\&\sphinxhyphen{} \sphinxaccelerator{B}ar}'),
225.     ),
226.     (
227.         # interpolation of ampersands in guilabel
228.         'verify',
229.         ':guilabel:`&Foo -&&- &Bar`',
230.         ('<p><span class="guilabel"><span class="accelerator">F</span>oo '
231.          '-&amp;- <span class="accelerator">B</span>ar</span></p>'),
232.         ('\\sphinxAtStartPar\n'
233.          r'\sphinxguilabel{\sphinxaccelerator{F}oo \sphinxhyphen{}\&\sphinxhyphen{} \sphinxaccelerator{B}ar}'),
234.     ),
235.     (
236.         # no ampersands in guilabel
237.         'verify',
238.         ':guilabel:`Foo`',
239.         '<p><span class="guilabel">Foo</span></p>',
240.         '\\sphinxAtStartPar\n\\sphinxguilabel{Foo}',
241.     ),
242.     (
243.         # kbd role
244.         'verify',
245.         ':kbd:`space`',
246.         '<p><kbd class="kbd docutils literal notranslate">space</kbd></p>',
247.         '\\sphinxAtStartPar\n\\sphinxkeyboard{\\sphinxupquote{space}}',
248.     ),
249.     (
250.         # kbd role
251.         'verify',
252.         ':kbd:`Control+X`',
253.         ('<p><kbd class="kbd compound docutils literal notranslate">'
254.          '<kbd class="kbd docutils literal notranslate">Control</kbd>'
255.          '+'
256.          '<kbd class="kbd docutils literal notranslate">X</kbd>'
257.          '</kbd></p>'),
258.         '\\sphinxAtStartPar\n\\sphinxkeyboard{\\sphinxupquote{Control+X}}',
259.     ),
260.     (
261.         # kbd role
262.         'verify',
263.         ':kbd:`Alt+^`',
264.         ('<p><kbd class="kbd compound docutils literal notranslate">'
265.          '<kbd class="kbd docutils literal notranslate">Alt</kbd>'
266.          '+'
267.          '<kbd class="kbd docutils literal notranslate">^</kbd>'
268.          '</kbd></p>'),
269.         ('\\sphinxAtStartPar\n'
270.          '\\sphinxkeyboard{\\sphinxupquote{Alt+\\textasciicircum{}}}'),
271.     ),
272.     (
273.         # kbd role
274.         'verify',
275.         ':kbd:`M-x  M-s`',
276.         ('<p><kbd class="kbd compound docutils literal notranslate">'
277.          '<kbd class="kbd docutils literal notranslate">M</kbd>'
278.          '-'
279.          '<kbd class="kbd docutils literal notranslate">x</kbd>'
280.          '  '
281.          '<kbd class="kbd docutils literal notranslate">M</kbd>'
282.          '-'
283.          '<kbd class="kbd docutils literal notranslate">s</kbd>'
284.          '</kbd></p>'),
285.         ('\\sphinxAtStartPar\n'
286.          '\\sphinxkeyboard{\\sphinxupquote{M\\sphinxhyphen{}x  M\\sphinxhyphen{}s}}'),
287.     ),
288.     (
289.         # kbd role
290.         'verify',
291.         ':kbd:`-`',
292.         '<p><kbd class="kbd docutils literal notranslate">-</kbd></p>',
293.         ('\\sphinxAtStartPar\n'
294.          '\\sphinxkeyboard{\\sphinxupquote{\\sphinxhyphen{}}}'),
295.     ),
296.     (
297.         # kbd role
298.         'verify',
299.         ':kbd:`Caps Lock`',
300.         '<p><kbd class="kbd docutils literal notranslate">Caps Lock</kbd></p>',
301.         ('\\sphinxAtStartPar\n'
302.          '\\sphinxkeyboard{\\sphinxupquote{Caps Lock}}'),
303.     ),
304.     (
305.         # non-interpolation of dashes in option role
306.         'verify_re',
307.         ':option:`--with-option`',
308.         ('<p><code( class="xref std std-option docutils literal notranslate")?>'
309.          '<span class="pre">--with-option</span></code></p>$'),
310.         (r'\\sphinxAtStartPar\n'
311.          r'\\sphinxcode{\\sphinxupquote{\\sphinxhyphen{}\\sphinxhyphen{}with\\sphinxhyphen{}option}}$'),
312.     ),
313.     (
314.         # verify smarty-pants quotes
315.         'verify',
316.         '"John"',
317.         '<p>“John”</p>',
318.         "\\sphinxAtStartPar\n“John”",
319.     ),
320.     (
321.         # ... but not in literal text
322.         'verify',
323.         '``"John"``',
324.         ('<p><code class="docutils literal notranslate"><span class="pre">'
325.          '&quot;John&quot;</span></code></p>'),
326.         '\\sphinxAtStartPar\n\\sphinxcode{\\sphinxupquote{"John"}}',
327.     ),
328.     (
329.         # verify classes for inline roles
330.         'verify',
331.         ':manpage:`mp(1)`',
332.         '<p><em class="manpage">mp(1)</em></p>',
333.         '\\sphinxAtStartPar\n\\sphinxstyleliteralemphasis{\\sphinxupquote{mp(1)}}',
334.     ),
335.     (
336.         # correct escaping in normal mode
337.         'verify',
338.         'Γ\\\\∞$',
339.         None,
340.         '\\sphinxAtStartPar\nΓ\\textbackslash{}\\(\\infty\\)\\$',
341.     ),
342.     (
343.         # in verbatim code fragments
344.         'verify',
345.         '::\n\n @Γ\\∞${}',
346.         None,
347.         ('\\begin{sphinxVerbatim}[commandchars=\\\\\\{\\}]\n'
348.          '@Γ\\PYGZbs{}\\(\\infty\\)\\PYGZdl{}\\PYGZob{}\\PYGZcb{}\n'
349.          '\\end{sphinxVerbatim}'),
350.     ),
351.     (
352.         # in URIs
353.         'verify_re',
354.         '`test <https://www.google.com/~me/>`_',
355.         None,
356.         r'\\sphinxAtStartPar\n\\sphinxhref{https://www.google.com/~me/}{test}.*',
357.     ),
358.     (
359.         # description list: simple
360.         'verify',
361.         'term\n    description',
362.         '<dl class="docutils">\n<dt>term</dt><dd>description</dd>\n</dl>',
363.         None,
364.     ),
365.     (
366.         # description list: with classifiers
367.         'verify',
368.         'term : class1 : class2\n    description',
369.         ('<dl class="docutils">\n<dt>term<span class="classifier">class1</span>'
370.          '<span class="classifier">class2</span></dt><dd>description</dd>\n</dl>'),
371.         None,
372.     ),
373.     (
374.         # glossary (description list): multiple terms
375.         'verify',
376.         '.. glossary::\n\n   term1\n   term2\n       description',
377.         ('<dl class="glossary docutils">\n'
378.          '<dt id="term-term1">term1<a class="headerlink" href="#term-term1"'
379.          ' title="Permalink to this term">¶</a></dt>'
380.          '<dt id="term-term2">term2<a class="headerlink" href="#term-term2"'
381.          ' title="Permalink to this term">¶</a></dt>'
382.          '<dd>description</dd>\n</dl>'),
383.         None,
384.     ),
385. ])
386. def test_inline(get_verifier, type, rst, html_expected, latex_expected):
387.     verifier = get_verifier(type)
388.     verifier(rst, html_expected, latex_expected)
389. 
390. 
391. @pytest.mark.parametrize('type,rst,html_expected,latex_expected', [
392.     (
393.         'verify',
394.         r'4 backslashes \\\\',
395.         r'<p>4 backslashes \\</p>',
396.         None,
397.     ),
398. ])
399. @pytest.mark.skipif(docutils.__version_info__ < (0, 16),
400.                     reason='docutils-0.16 or above is required')
401. def test_inline_docutils16(get_verifier, type, rst, html_expected, latex_expected):
402.     verifier = get_verifier(type)
403.     verifier(rst, html_expected, latex_expected)
404. 
405. 
406. @pytest.mark.sphinx(confoverrides={'latex_engine': 'xelatex'})
407. @pytest.mark.parametrize('type,rst,html_expected,latex_expected', [
408.     (
409.         # in verbatim code fragments
410.         'verify',
411.         '::\n\n @Γ\\∞${}',
412.         None,
413.         ('\\begin{sphinxVerbatim}[commandchars=\\\\\\{\\}]\n'
414.          '@Γ\\PYGZbs{}∞\\PYGZdl{}\\PYGZob{}\\PYGZcb{}\n'
415.          '\\end{sphinxVerbatim}'),
416.     ),
417. ])
418. def test_inline_for_unicode_latex_engine(get_verifier, type, rst,
419.                                          html_expected, latex_expected):
420.     verifier = get_verifier(type)
421.     verifier(rst, html_expected, latex_expected)
422. 
423. 
424. def test_samp_role(parse):
425.     # no braces
426.     text = ':samp:`a{b}c`'
427.     doctree = parse(text)
428.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, ("a",
429.                                                               [nodes.emphasis, "b"],
430.                                                               "c")])
431.     # nested braces
432.     text = ':samp:`a{{b}}c`'
433.     doctree = parse(text)
434.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, ("a",
435.                                                               [nodes.emphasis, "{b"],
436.                                                               "}c")])
437. 
438.     # half-opened braces
439.     text = ':samp:`a{bc`'
440.     doctree = parse(text)
441.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, "a{bc"])
442. 
443.     # escaped braces
444.     text = ':samp:`a\\\\{b}c`'
445.     doctree = parse(text)
446.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, "a{b}c"])
447. 
448.     # no braces (whitespaces are keeped as is)
449.     text = ':samp:`code   sample`'
450.     doctree = parse(text)
451.     assert_node(doctree[0], [nodes.paragraph, nodes.literal, "code   sample"])
452. 
453. 
454. def test_download_role(parse):
455.     # implicit
456.     text = ':download:`sphinx.rst`'
457.     doctree = parse(text)
458.     assert_node(doctree[0], [nodes.paragraph, addnodes.download_reference,
459.                              nodes.literal, "sphinx.rst"])
460.     assert_node(doctree[0][0], refdoc='dummy', refdomain='', reftype='download',
461.                 refexplicit=False, reftarget='sphinx.rst', refwarn=False)
462.     assert_node(doctree[0][0][0], classes=['xref', 'download'])
463. 
464.     # explicit
465.     text = ':download:`reftitle <sphinx.rst>`'
466.     doctree = parse(text)
467.     assert_node(doctree[0], [nodes.paragraph, addnodes.download_reference,
468.                              nodes.literal, "reftitle"])
469.     assert_node(doctree[0][0], refdoc='dummy', refdomain='', reftype='download',
470.                 refexplicit=True, reftarget='sphinx.rst', refwarn=False)
471.     assert_node(doctree[0][0][0], classes=['xref', 'download'])
472. 
473. 
474. def test_XRefRole(inliner):
475.     role = XRefRole()
476. 
477.     # implicit
478.     doctrees, errors = role('ref', 'rawtext', 'text', 5, inliner, {}, [])
479.     assert len(doctrees) == 1
480.     assert_node(doctrees[0], [addnodes.pending_xref, nodes.literal, 'text'])
481.     assert_node(doctrees[0], refdoc='dummy', refdomain='', reftype='ref', reftarget='text',
482.                 refexplicit=False, refwarn=False)
483.     assert errors == []
484. 
485.     # explicit
486.     doctrees, errors = role('ref', 'rawtext', 'title <target>', 5, inliner, {}, [])
487.     assert_node(doctrees[0], [addnodes.pending_xref, nodes.literal, 'title'])
488.     assert_node(doctrees[0], refdoc='dummy', refdomain='', reftype='ref', reftarget='target',
489.                 refexplicit=True, refwarn=False)
490. 
491.     # bang
492.     doctrees, errors = role('ref', 'rawtext', '!title <target>', 5, inliner, {}, [])
493.     assert_node(doctrees[0], [nodes.literal, 'title <target>'])
494. 
495.     # refdomain
496.     doctrees, errors = role('test:doc', 'rawtext', 'text', 5, inliner, {}, [])
497.     assert_node(doctrees[0], [addnodes.pending_xref, nodes.literal, 'text'])
498.     assert_node(doctrees[0], refdoc='dummy', refdomain='test', reftype='doc', reftarget='text',
499.                 refexplicit=False, refwarn=False)
500.

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 11:29:04,148 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user requested the full content of the file `tests/test_markup.py`. The provided context contains the entire file, so I am returning the whole content as requested.', relative_path='tests/test_markup.py', start_line=1, end_line=500)]
2025-12-23 11:29:04,150 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/test_markup.py`.
2025-12-23 11:29:04,150 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 11:29:04,150 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 11:29:04,150 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 5 existing contexts
2025-12-23 11:29:04,150 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 6 total contexts (removed 0 duplicates)
2025-12-23 11:29:04,151 - thread-139573954868928.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-23 11:29:04,152 - thread-139573954868928.prometheus_context_collector - INFO - Successfully retrieved 6 context snippets
