2025-12-21 01:19:58,792 - thread-126477792184000.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: bug in is_subset(Reals)

Description: Solving issue #19513 has given rise to another bug.
Now:
```
In [8]: S1 = imageset(Lambda(n, n + (n - 1)*(n + 1)*I), S.Integers)

In [9]: S1
Out[9]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [10]: 2 in S1
Out[10]: False

In [11]: 2 in S1.intersect(Reals)
Out[11]: True
```
This output is incorrect.

Correct output is:
```
In [4]: S1
Out[4]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [5]: 2 in S1
Out[5]: False

In [6]: 2 in S1.intersect(Reals)
Out[6]: False

In [7]: S2 = Reals

In [8]: S1.intersect(S2)
Out[8]: {-1, 1}
```

Patch information:
diff --git a/sympy/sets/handlers/intersection.py b/sympy/sets/handlers/intersection.py
index c54dc8f72a..d013b03983 100644
--- a/sympy/sets/handlers/intersection.py
+++ b/sympy/sets/handlers/intersection.py
@@ -303,22 +303,28 @@ def intersection_sets(self, other): # noqa:F811
         elif ifree != {n}:
             return None
         else:
-            # univarite imaginary part in same variable
-            x, xis = zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols])
-            if x and all(i == n for i in x):
-                base_set -= FiniteSet(xis)
+            # univariate imaginary part in same variable
+            x_xis = [solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]
+            if x_xis:
+                x, xis = zip(*x_xis)
+                if x and all(i == n for i in x):
+                    base_set = base_set.intersect(FiniteSet(*xis))
+                else:
+                    base_set = ConditionSet(n, Eq(im, 0), base_set)
             else:
-                base_set -= ConditionSet(n, Eq(im, 0), S.Integers)
+                base_set = ConditionSet(n, Eq(im, 0), base_set)
         # exclude values that make denominators 0
-        for i in denoms(f):
-            if i.has(n):
-                sol = list(zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]))
-                if sol != []:
-                    x, xis = sol
+        for d in denoms(f):
+            if d.has(n):
+                sol_pairs = [solve_linear(j, 0) for j in Mul.make_args(d) if n in j.free_symbols]
+                if sol_pairs:
+                    x, xis = zip(*sol_pairs)
                     if x and all(i == n for i in x):
-                        base_set -= FiniteSet(xis)
+                        base_set = base_set - FiniteSet(*xis)
+                    else:
+                        base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
                 else:
-                    base_set -= ConditionSet(n, Eq(i, 0), S.Integers)
+                    base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
         return imageset(lam, base_set)
 
     elif isinstance(other, Interval):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-21 01:19:58,868 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .github
|   └── workflows
|       └── runtests.yml
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.md
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_optional_dependencies.py
|   ├── test_py2_import.py
|   ├── test_setup.py
|   ├── test_sphinx.sh
|   ├── test_submodule_imports.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── guides
|       |   ├── assumptions.rst
|       |   ├── booleans.rst
|       |   └── index.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── index.rst
|       |   |   ├── predicates.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── sparse.rst
|       |   |   └── sparsetools.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── control
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── domainmatrix.rst
|       |   |   ├── domainsintro.rst
|       |   |   ├── domainsref.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   ├── solvers.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── fu.rst
|       |   |   ├── hyperexpand.rst
|       |   |   ├── index.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── testing
|       |   |   ├── index.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   └── runtests.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       ├── intro.rst
|       |       └── vector_integration.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── classification.rst
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── aptinstall.sh
|   ├── authors.py
|   ├── build_docs.py
|   ├── compare_tar_against_git.py
|   ├── fabfile.py
|   ├── github_release.py
|   ├── helpers.py
|   ├── pull_and_run_rever.sh
|   ├── release.sh
|   ├── releasecheck.py
|   ├── requirements.txt
|   ├── sha256.py
|   ├── test_install.py
|   ├── update_docs.py
|   └── update_requirements.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── facts.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── predicates
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── relation
    |   |   ├── __init__.py
    |   |   ├── binrel.py
    |   |   └── equality.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_assumptions_2.py
    |   |   ├── test_context.py
    |   |   ├── test_matrices.py
    |   |   ├── test_query.py
    |   |   ├── test_refine.py
    |   |   ├── test_satask.py
    |   |   ├── test_sathandlers.py
    |   |   └── test_wrapper.py
    |   └── wrapper.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── numpy_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   ├── scipy_nodes.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_numpy_nodes.py
    |       ├── test_pyutils.py
    |       ├── test_rewriting.py
    |       └── test_scipy_nodes.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── schur_number.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_schur_number.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── _print_helpers.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── kind.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_kind.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── gmpy.py
    |   ├── importtools.py
    |   ├── pythonmpq.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_pythonmpq.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   ├── minisat22_wrapper.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── decompositions.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── determinant.py
    |   ├── eigen.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── companion.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── sets.py
    |   |   ├── slice.py
    |   |   ├── special.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_companion.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_sets.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_special.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── graph.py
    |   ├── immutable.py
    |   ├── inverse.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── reductions.py
    |   ├── solvers.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   ├── subspaces.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_commonmatrix.py
    |   |   ├── test_decompositions.py
    |   |   ├── test_densearith.py
    |   |   ├── test_densesolve.py
    |   |   ├── test_densetools.py
    |   |   ├── test_determinant.py
    |   |   ├── test_eigen.py
    |   |   ├── test_graph.py
    |   |   ├── test_immutable.py
    |   |   ├── test_interactions.py
    |   |   ├── test_matrices.py
    |   |   ├── test_normalforms.py
    |   |   ├── test_reductions.py
    |   |   ├── test_solvers.py
    |   |   ├── test_sparse.py
    |   |   ├── test_sparsetools.py
    |   |   └── test_subspaces.py
    |   └── utilities.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── digits.py
    |   ├── ecm.py
    |   ├── egyptian_fraction.py
    |   ├── elliptic_curve.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── qs.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_digits.py
    |       ├── test_ecm.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_elliptic_curve.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       ├── test_qs.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── README.txt
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── control
    |   |   ├── __init__.py
    |   |   ├── lti.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_lti.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domainmatrix.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gaussiandomains.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── matrices
    |   |   ├── __init__.py
    |   |   ├── ddm.py
    |   |   ├── dense.py
    |   |   ├── domainmatrix.py
    |   |   ├── domainscalar.py
    |   |   ├── eigen.py
    |   |   ├── exceptions.py
    |   |   ├── linsolve.py
    |   |   ├── normalforms.py
    |   |   ├── sdm.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_ddm.py
    |   |       ├── test_dense.py
    |   |       ├── test_domainmatrix.py
    |   |       ├── test_domainscalar.py
    |   |       ├── test_eigen.py
    |   |       ├── test_linsolve.py
    |   |       ├── test_normalforms.py
    |   |       └── test_sdm.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── aesaracode.py
    |   ├── c.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxx.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── fortran.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── numpy.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_aesaracode.py
    |   |   ├── test_c.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cupy.py
    |   |   ├── test_cxx.py
    |   |   ├── test_dot.py
    |   |   ├── test_fortran.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── comparison.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine
    |   |   ├── __init__.py
    |   |   ├── diophantine.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_diophantine.py
    |   ├── inequalities.py
    |   ├── ode
    |   |   ├── __init__.py
    |   |   ├── ode.py
    |   |   ├── single.py
    |   |   ├── subscheck.py
    |   |   ├── systems.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_lie_group.py
    |   |       ├── test_ode.py
    |   |       ├── test_single.py
    |   |       ├── test_subscheck.py
    |   |       └── test_systems.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── compound_rv.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── matrix_distributions.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── sampling
    |   |   ├── __init__.py
    |   |   ├── sample_numpy.py
    |   |   ├── sample_pymc3.py
    |   |   ├── sample_scipy.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_sample_continuous_rv.py
    |   |       ├── test_sample_discrete_rv.py
    |   |       └── test_sample_finite_rv.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_multivariate_probability.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_compound_rv.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_matrix_distributions.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       ├── test_symbolic_multivariate.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── array_derivatives.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── expressions
    |   |   |   ├── __init__.py
    |   |   |   ├── array_expressions.py
    |   |   |   ├── arrayexpr_derivatives.py
    |   |   |   ├── conv_array_to_matrix.py
    |   |   |   ├── conv_indexed_to_array.py
    |   |   |   ├── conv_matrix_to_array.py
    |   |   |   ├── tests
    |   |   |   └── utils.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_array_derivatives.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── testing
    |   ├── __init__.py
    |   ├── benchmarking.py
    |   ├── matrices.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_module_imports.py
    |   |   └── test_pytest.py
    |   └── tmpfiles.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_matchpy_connector.py
    |   |   ├── test_misc.py
    |   |   ├── test_pickling.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── implicitregion.py
        ├── integrals.py
        ├── operators.py
        ├── orienters.py
        ├── parametricregion.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_implicitregion.py
        |   ├── test_integrals.py
        |   ├── test_operators.py
        |   ├── test_parametricregion.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: bug in is_subset(Reals)

Description: Solving issue #19513 has given rise to another bug.
Now:
```
In [8]: S1 = imageset(Lambda(n, n + (n - 1)*(n + 1)*I), S.Integers)

In [9]: S1
Out[9]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [10]: 2 in S1
Out[10]: False

In [11]: 2 in S1.intersect(Reals)
Out[11]: True
```
This output is incorrect.

Correct output is:
```
In [4]: S1
Out[4]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [5]: 2 in S1
Out[5]: False

In [6]: 2 in S1.intersect(Reals)
Out[6]: False

In [7]: S2 = Reals

In [8]: S1.intersect(S2)
Out[8]: {-1, 1}
```

Patch information:
diff --git a/sympy/sets/handlers/intersection.py b/sympy/sets/handlers/intersection.py
index c54dc8f72a..d013b03983 100644
--- a/sympy/sets/handlers/intersection.py
+++ b/sympy/sets/handlers/intersection.py
@@ -303,22 +303,28 @@ def intersection_sets(self, other): # noqa:F811
         elif ifree != {n}:
             return None
         else:
-            # univarite imaginary part in same variable
-            x, xis = zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols])
-            if x and all(i == n for i in x):
-                base_set -= FiniteSet(xis)
+            # univariate imaginary part in same variable
+            x_xis = [solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]
+            if x_xis:
+                x, xis = zip(*x_xis)
+                if x and all(i == n for i in x):
+                    base_set = base_set.intersect(FiniteSet(*xis))
+                else:
+                    base_set = ConditionSet(n, Eq(im, 0), base_set)
             else:
-                base_set -= ConditionSet(n, Eq(im, 0), S.Integers)
+                base_set = ConditionSet(n, Eq(im, 0), base_set)
         # exclude values that make denominators 0
-        for i in denoms(f):
-            if i.has(n):
-                sol = list(zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]))
-                if sol != []:
-                    x, xis = sol
+        for d in denoms(f):
+            if d.has(n):
+                sol_pairs = [solve_linear(j, 0) for j in Mul.make_args(d) if n in j.free_symbols]
+                if sol_pairs:
+                    x, xis = zip(*sol_pairs)
                     if x and all(i == n for i in x):
-                        base_set -= FiniteSet(xis)
+                        base_set = base_set - FiniteSet(*xis)
+                    else:
+                        base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
                 else:
-                    base_set -= ConditionSet(n, Eq(i, 0), S.Integers)
+                    base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
         return imageset(lam, base_set)
 
     elif isinstance(other, Interval):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 01:20:17,816 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find 3 relevant test cases for a bug in the intersection of an `ImageSet` and `Reals`. The patch is in `sympy/sets/handlers/intersection.py`. To find relevant test cases, I need to examine the tests for set operations. The most likely place to find these tests is in `sympy/sets/tests/test_sets.py`, which should contain tests for `Intersection`. I need the full file content to identify suitable tests and ensure all necessary imports and setup are included.' query='Please provide the full content of `sympy/sets/tests/test_sets.py`.' extra_requirements='' purpose='I need to find 3 relevant test cases that demonstrate the functionality related to the bug in `ImageSet` intersection.'
2025-12-21 01:20:17,818 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `sympy/sets/tests/test_sets.py`.
2025-12-21 01:20:17,818 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 01:20:17,818 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 01:20:17,819 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 01:20:17,819 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `sympy/sets/tests/test_sets.py`.
Purpose: I need to find 3 relevant test cases that demonstrate the functionality related to the bug in `ImageSet` intersection.
2025-12-21 01:20:20,873 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of the file `sympy/sets/tests/test_sets.py` as you requested. This will allow me to examine the test cases and identify those that are relevant to the `ImageSet` intersection functionality you are investigating.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2111, 'candidates_token_count': 78, 'total_token_count': 2378, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2111}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 78}], 'thoughts_token_count': 189, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.18178450755583933, 'model_name': 'gemini-2.5-pro'} id='run--47537c9e-6e48-4a81-8f27-41f2ffb2c97b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': 'a34319ab-2074-4f17-b938-c510ac638669', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2111, 'output_tokens': 78, 'total_tokens': 2378, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 189}}
2025-12-21 01:20:54,751 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the content of `sympy/sets/tests/test_sets.py` to find test cases relevant to `ImageSet` intersection. While there are no direct tests for `ImageSet` intersection in this file, I have identified three test cases that deal with complex intersection scenarios. These examples, involving unions, symbolic parameters, and multiple set types, might provide insight into the functionality related to the bug you are investigating.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 461.0, "start_line": 459.0, "relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12123, 'candidates_token_count': 181, 'total_token_count': 16044, 'cached_content_token_count': 1894, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12123}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1894}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 181}], 'thoughts_token_count': 3740}, 'finish_reason': 'STOP', 'avg_logprobs': -3.176909220152797, 'model_name': 'gemini-2.5-pro'} id='run--d5e6234e-87ad-416b-9251-8dc4f13039da-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 232.0, 'start_line': 227.0, 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': 'c39aca12-bc73-4483-bd59-4e119a25d853', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'end_line': 497.0, 'start_line': 491.0, 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': 'a5afbe33-2b1d-4bad-861e-1c7b88d5cf14', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'end_line': 461.0, 'start_line': 459.0, 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': '741821de-2faf-4abf-8652-bb991a3bcedf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12123, 'output_tokens': 181, 'total_tokens': 16044, 'input_token_details': {'cache_read': 1894}, 'output_token_details': {'reasoning': 3740}}
2025-12-21 01:21:08,294 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `sympy/sets/tests/test_sets.py` for you. After a thorough review of the file, I did not find any test cases that directly address the intersection of `ImageSet` objects. However, I have identified three test cases that are highly relevant to your purpose as they demonstrate complex intersection scenarios involving unions, symbolic parameters, and multiple set types, which might shed light on the `ImageSet` intersection bug.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12870, 'candidates_token_count': 95, 'total_token_count': 14432, 'cached_content_token_count': 11302, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12870}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11302}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 95}], 'thoughts_token_count': 1467}, 'finish_reason': 'STOP', 'avg_logprobs': -1.8277830425061679, 'model_name': 'gemini-2.5-pro'} id='run--51b076b4-b109-4de0-a72c-41605509118e-0' usage_metadata={'input_tokens': 12870, 'output_tokens': 95, 'total_tokens': 14432, 'input_token_details': {'cache_read': 11302}, 'output_token_details': {'reasoning': 1467}}
2025-12-21 01:21:08,296 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `sympy/sets/tests/test_sets.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need to find 3 relevant test cases that demonstrate the functionality related to the bug in `ImageSet` intersection.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/sets/tests/test_sets.py
Line number range: 1 - 500
Content:
1. from sympy import (Symbol, Set, Union, Interval, oo, S, sympify, nan,
2.     Max, Min, Float, DisjointUnion,
3.     FiniteSet, Intersection, imageset, I, true, false, ProductSet,
4.     sqrt, Complement, EmptySet, sin, cos, Lambda, ImageSet, pi,
5.     Pow, Contains, Sum, rootof, SymmetricDifference, Piecewise,
6.     Matrix, Range, Add, symbols, zoo, Rational)
7. from mpmath import mpi
8. 
9. from sympy.core.expr import unchanged
10. from sympy.core.relational import Eq, Ne, Le, Lt, LessThan
11. from sympy.logic import And, Or, Xor
12. from sympy.testing.pytest import raises, XFAIL, warns_deprecated_sympy
13. 
14. from sympy.abc import x, y, z, m, n
15. 
16. 
17. def test_imageset():
18.     ints = S.Integers
19.     assert imageset(x, x - 1, S.Naturals) is S.Naturals0
20.     assert imageset(x, x + 1, S.Naturals0) is S.Naturals
21.     assert imageset(x, abs(x), S.Naturals0) is S.Naturals0
22.     assert imageset(x, abs(x), S.Naturals) is S.Naturals
23.     assert imageset(x, abs(x), S.Integers) is S.Naturals0
24.     # issue 16878a
25.     r = symbols('r', real=True)
26.     assert imageset(x, (x, x), S.Reals)._contains((1, r)) == None
27.     assert imageset(x, (x, x), S.Reals)._contains((1, 2)) == False
28.     assert (r, r) in imageset(x, (x, x), S.Reals)
29.     assert 1 + I in imageset(x, x + I, S.Reals)
30.     assert {1} not in imageset(x, (x,), S.Reals)
31.     assert (1, 1) not in imageset(x, (x,) , S.Reals)
32.     raises(TypeError, lambda: imageset(x, ints))
33.     raises(ValueError, lambda: imageset(x, y, z, ints))
34.     raises(ValueError, lambda: imageset(Lambda(x, cos(x)), y))
35.     assert (1, 2) in imageset(Lambda((x, y), (x, y)), ints, ints)
36.     raises(ValueError, lambda: imageset(Lambda(x, x), ints, ints))
37.     assert imageset(cos, ints) == ImageSet(Lambda(x, cos(x)), ints)
38.     def f(x):
39.         return cos(x)
40.     assert imageset(f, ints) == imageset(x, cos(x), ints)
41.     f = lambda x: cos(x)
42.     assert imageset(f, ints) == ImageSet(Lambda(x, cos(x)), ints)
43.     assert imageset(x, 1, ints) == FiniteSet(1)
44.     assert imageset(x, y, ints) == {y}
45.     assert imageset((x, y), (1, z), ints, S.Reals) == {(1, z)}
46.     clash = Symbol('x', integer=true)
47.     assert (str(imageset(lambda x: x + clash, Interval(-2, 1)).lamda.expr)
48.         in ('x0 + x', 'x + x0'))
49.     x1, x2 = symbols("x1, x2")
50.     assert imageset(lambda x, y:
51.         Add(x, y), Interval(1, 2), Interval(2, 3)).dummy_eq(
52.         ImageSet(Lambda((x1, x2), x1 + x2),
53.         Interval(1, 2), Interval(2, 3)))
54. 
55. 
56. def test_is_empty():
57.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
58.             S.UniversalSet]:
59.         assert s.is_empty is False
60. 
61.     assert S.EmptySet.is_empty is True
62. 
63. 
64. def test_is_finiteset():
65.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
66.             S.UniversalSet]:
67.         assert s.is_finite_set is False
68. 
69.     assert S.EmptySet.is_finite_set is True
70. 
71.     assert FiniteSet(1, 2).is_finite_set is True
72.     assert Interval(1, 2).is_finite_set is False
73.     assert Interval(x, y).is_finite_set is None
74.     assert ProductSet(FiniteSet(1), FiniteSet(2)).is_finite_set is True
75.     assert ProductSet(FiniteSet(1), Interval(1, 2)).is_finite_set is False
76.     assert ProductSet(FiniteSet(1), Interval(x, y)).is_finite_set is None
77.     assert Union(Interval(0, 1), Interval(2, 3)).is_finite_set is False
78.     assert Union(FiniteSet(1), Interval(2, 3)).is_finite_set is False
79.     assert Union(FiniteSet(1), FiniteSet(2)).is_finite_set is True
80.     assert Union(FiniteSet(1), Interval(x, y)).is_finite_set is None
81.     assert Intersection(Interval(x, y), FiniteSet(1)).is_finite_set is True
82.     assert Intersection(Interval(x, y), Interval(1, 2)).is_finite_set is None
83.     assert Intersection(FiniteSet(x), FiniteSet(y)).is_finite_set is True
84.     assert Complement(FiniteSet(1), Interval(x, y)).is_finite_set is True
85.     assert Complement(Interval(x, y), FiniteSet(1)).is_finite_set is None
86.     assert Complement(Interval(1, 2), FiniteSet(x)).is_finite_set is False
87.     assert DisjointUnion(Interval(-5, 3), FiniteSet(x, y)).is_finite_set is False
88.     assert DisjointUnion(S.EmptySet, FiniteSet(x, y), S.EmptySet).is_finite_set is True
89. 
90. 
91. def test_deprecated_is_EmptySet():
92.     with warns_deprecated_sympy():
93.         S.EmptySet.is_EmptySet
94. 
95. 
96. def test_interval_arguments():
97.     assert Interval(0, oo) == Interval(0, oo, False, True)
98.     assert Interval(0, oo).right_open is true
99.     assert Interval(-oo, 0) == Interval(-oo, 0, True, False)
100.     assert Interval(-oo, 0).left_open is true
101.     assert Interval(oo, -oo) == S.EmptySet
102.     assert Interval(oo, oo) == S.EmptySet
103.     assert Interval(-oo, -oo) == S.EmptySet
104.     assert Interval(oo, x) == S.EmptySet
105.     assert Interval(oo, oo) == S.EmptySet
106.     assert Interval(x, -oo) == S.EmptySet
107.     assert Interval(x, x) == {x}
108. 
109.     assert isinstance(Interval(1, 1), FiniteSet)
110.     e = Sum(x, (x, 1, 3))
111.     assert isinstance(Interval(e, e), FiniteSet)
112. 
113.     assert Interval(1, 0) == S.EmptySet
114.     assert Interval(1, 1).measure == 0
115. 
116.     assert Interval(1, 1, False, True) == S.EmptySet
117.     assert Interval(1, 1, True, False) == S.EmptySet
118.     assert Interval(1, 1, True, True) == S.EmptySet
119. 
120. 
121.     assert isinstance(Interval(0, Symbol('a')), Interval)
122.     assert Interval(Symbol('a', real=True, positive=True), 0) == S.EmptySet
123.     raises(ValueError, lambda: Interval(0, S.ImaginaryUnit))
124.     raises(ValueError, lambda: Interval(0, Symbol('z', extended_real=False)))
125.     raises(ValueError, lambda: Interval(x, x + S.ImaginaryUnit))
126. 
127.     raises(NotImplementedError, lambda: Interval(0, 1, And(x, y)))
128.     raises(NotImplementedError, lambda: Interval(0, 1, False, And(x, y)))
129.     raises(NotImplementedError, lambda: Interval(0, 1, z, And(x, y)))
130. 
131. 
132. def test_interval_symbolic_end_points():
133.     a = Symbol('a', real=True)
134. 
135.     assert Union(Interval(0, a), Interval(0, 3)).sup == Max(a, 3)
136.     assert Union(Interval(a, 0), Interval(-3, 0)).inf == Min(-3, a)
137. 
138.     assert Interval(0, a).contains(1) == LessThan(1, a)
139. 
140. 
141. def test_interval_is_empty():
142.     x, y = symbols('x, y')
143.     r = Symbol('r', real=True)
144.     p = Symbol('p', positive=True)
145.     n = Symbol('n', negative=True)
146.     nn = Symbol('nn', nonnegative=True)
147.     assert Interval(1, 2).is_empty == False
148.     assert Interval(3, 3).is_empty == False  # FiniteSet
149.     assert Interval(r, r).is_empty == False  # FiniteSet
150.     assert Interval(r, r + nn).is_empty == False
151.     assert Interval(x, x).is_empty == False
152.     assert Interval(1, oo).is_empty == False
153.     assert Interval(-oo, oo).is_empty == False
154.     assert Interval(-oo, 1).is_empty == False
155.     assert Interval(x, y).is_empty == None
156.     assert Interval(r, oo).is_empty == False  # real implies finite
157.     assert Interval(n, 0).is_empty == False
158.     assert Interval(n, 0, left_open=True).is_empty == False
159.     assert Interval(p, 0).is_empty == True  # EmptySet
160.     assert Interval(nn, 0).is_empty == None
161.     assert Interval(n, p).is_empty == False
162.     assert Interval(0, p, left_open=True).is_empty == False
163.     assert Interval(0, p, right_open=True).is_empty == False
164.     assert Interval(0, nn, left_open=True).is_empty == None
165.     assert Interval(0, nn, right_open=True).is_empty == None
166. 
167. 
168. def test_union():
169.     assert Union(Interval(1, 2), Interval(2, 3)) == Interval(1, 3)
170.     assert Union(Interval(1, 2), Interval(2, 3, True)) == Interval(1, 3)
171.     assert Union(Interval(1, 3), Interval(2, 4)) == Interval(1, 4)
172.     assert Union(Interval(1, 2), Interval(1, 3)) == Interval(1, 3)
173.     assert Union(Interval(1, 3), Interval(1, 2)) == Interval(1, 3)
174.     assert Union(Interval(1, 3, False, True), Interval(1, 2)) == \
175.         Interval(1, 3, False, True)
176.     assert Union(Interval(1, 3), Interval(1, 2, False, True)) == Interval(1, 3)
177.     assert Union(Interval(1, 2, True), Interval(1, 3)) == Interval(1, 3)
178.     assert Union(Interval(1, 2, True), Interval(1, 3, True)) == \
179.         Interval(1, 3, True)
180.     assert Union(Interval(1, 2, True), Interval(1, 3, True, True)) == \
181.         Interval(1, 3, True, True)
182.     assert Union(Interval(1, 2, True, True), Interval(1, 3, True)) == \
183.         Interval(1, 3, True)
184.     assert Union(Interval(1, 3), Interval(2, 3)) == Interval(1, 3)
185.     assert Union(Interval(1, 3, False, True), Interval(2, 3)) == \
186.         Interval(1, 3)
187.     assert Union(Interval(1, 2, False, True), Interval(2, 3, True)) != \
188.         Interval(1, 3)
189.     assert Union(Interval(1, 2), S.EmptySet) == Interval(1, 2)
190.     assert Union(S.EmptySet) == S.EmptySet
191. 
192.     assert Union(Interval(0, 1), *[FiniteSet(1.0/n) for n in range(1, 10)]) == \
193.         Interval(0, 1)
194.     # issue #18241:
195.     x = Symbol('x')
196.     assert Union(Interval(0, 1), FiniteSet(1, x)) == Union(
197.         Interval(0, 1), FiniteSet(x))
198.     assert unchanged(Union, Interval(0, 1), FiniteSet(2, x))
199. 
200.     assert Interval(1, 2).union(Interval(2, 3)) == \
201.         Interval(1, 2) + Interval(2, 3)
202. 
203.     assert Interval(1, 2).union(Interval(2, 3)) == Interval(1, 3)
204. 
205.     assert Union(Set()) == Set()
206. 
207.     assert FiniteSet(1) + FiniteSet(2) + FiniteSet(3) == FiniteSet(1, 2, 3)
208.     assert FiniteSet('ham') + FiniteSet('eggs') == FiniteSet('ham', 'eggs')
209.     assert FiniteSet(1, 2, 3) + S.EmptySet == FiniteSet(1, 2, 3)
210. 
211.     assert FiniteSet(1, 2, 3) & FiniteSet(2, 3, 4) == FiniteSet(2, 3)
212.     assert FiniteSet(1, 2, 3) | FiniteSet(2, 3, 4) == FiniteSet(1, 2, 3, 4)
213. 
214.     assert FiniteSet(1, 2, 3) & S.EmptySet == S.EmptySet
215.     assert FiniteSet(1, 2, 3) | S.EmptySet == FiniteSet(1, 2, 3)
216. 
217.     x = Symbol("x")
218.     y = Symbol("y")
219.     z = Symbol("z")
220.     assert S.EmptySet | FiniteSet(x, FiniteSet(y, z)) == \
221.         FiniteSet(x, FiniteSet(y, z))
222. 
223.     # Test that Intervals and FiniteSets play nicely
224.     assert Interval(1, 3) + FiniteSet(2) == Interval(1, 3)
225.     assert Interval(1, 3, True, True) + FiniteSet(3) == \
226.         Interval(1, 3, True, False)
227.     X = Interval(1, 3) + FiniteSet(5)
228.     Y = Interval(1, 2) + FiniteSet(3)
229.     XandY = X.intersect(Y)
230.     assert 2 in X and 3 in X and 3 in XandY
231.     assert XandY.is_subset(X) and XandY.is_subset(Y)
232. 
233.     raises(TypeError, lambda: Union(1, 2, 3))
234. 
235.     assert X.is_iterable is False
236. 
237.     # issue 7843
238.     assert Union(S.EmptySet, FiniteSet(-sqrt(-I), sqrt(-I))) == \
239.         FiniteSet(-sqrt(-I), sqrt(-I))
240. 
241.     assert Union(S.Reals, S.Integers) == S.Reals
242. 
243. 
244. def test_union_iter():
245.     # Use Range because it is ordered
246.     u = Union(Range(3), Range(5), Range(4), evaluate=False)
247. 
248.     # Round robin
249.     assert list(u) == [0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 4]
250. 
251. 
252. def test_union_is_empty():
253.     assert (Interval(x, y) + FiniteSet(1)).is_empty == False
254.     assert (Interval(x, y) + Interval(-x, y)).is_empty == None
255. 
256. 
257. def test_difference():
258.     assert Interval(1, 3) - Interval(1, 2) == Interval(2, 3, True)
259.     assert Interval(1, 3) - Interval(2, 3) == Interval(1, 2, False, True)
260.     assert Interval(1, 3, True) - Interval(2, 3) == Interval(1, 2, True, True)
261.     assert Interval(1, 3, True) - Interval(2, 3, True) == \
262.         Interval(1, 2, True, False)
263.     assert Interval(0, 2) - FiniteSet(1) == \
264.         Union(Interval(0, 1, False, True), Interval(1, 2, True, False))
265. 
266.     # issue #18119
267.     assert S.Reals - FiniteSet(I) == S.Reals
268.     assert S.Reals - FiniteSet(-I, I) == S.Reals
269.     assert Interval(0, 10) - FiniteSet(-I, I) == Interval(0, 10)
270.     assert Interval(0, 10) - FiniteSet(1, I) == Union(
271.         Interval.Ropen(0, 1), Interval.Lopen(1, 10))
272.     assert S.Reals - FiniteSet(1, 2 + I, x, y**2) == Complement(
273.         Union(Interval.open(-oo, 1), Interval.open(1, oo)), FiniteSet(x, y**2),
274.         evaluate=False)
275. 
276.     assert FiniteSet(1, 2, 3) - FiniteSet(2) == FiniteSet(1, 3)
277.     assert FiniteSet('ham', 'eggs') - FiniteSet('eggs') == FiniteSet('ham')
278.     assert FiniteSet(1, 2, 3, 4) - Interval(2, 10, True, False) == \
279.         FiniteSet(1, 2)
280.     assert FiniteSet(1, 2, 3, 4) - S.EmptySet == FiniteSet(1, 2, 3, 4)
281.     assert Union(Interval(0, 2), FiniteSet(2, 3, 4)) - Interval(1, 3) == \
282.         Union(Interval(0, 1, False, True), FiniteSet(4))
283. 
284.     assert -1 in S.Reals - S.Naturals
285. 
286. 
287. def test_Complement():
288.     A = FiniteSet(1, 3, 4)
289.     B = FiniteSet(3, 4)
290.     C = Interval(1, 3)
291.     D = Interval(1, 2)
292. 
293.     assert Complement(A, B, evaluate=False).is_iterable is True
294.     assert Complement(A, C, evaluate=False).is_iterable is True
295.     assert Complement(C, D, evaluate=False).is_iterable is None
296. 
297.     assert FiniteSet(*Complement(A, B, evaluate=False)) == FiniteSet(1)
298.     assert FiniteSet(*Complement(A, C, evaluate=False)) == FiniteSet(4)
299.     raises(TypeError, lambda: FiniteSet(*Complement(C, A, evaluate=False)))
300. 
301.     assert Complement(Interval(1, 3), Interval(1, 2)) == Interval(2, 3, True)
302.     assert Complement(FiniteSet(1, 3, 4), FiniteSet(3, 4)) == FiniteSet(1)
303.     assert Complement(Union(Interval(0, 2), FiniteSet(2, 3, 4)),
304.                       Interval(1, 3)) == \
305.         Union(Interval(0, 1, False, True), FiniteSet(4))
306. 
307.     assert not 3 in Complement(Interval(0, 5), Interval(1, 4), evaluate=False)
308.     assert -1 in Complement(S.Reals, S.Naturals, evaluate=False)
309.     assert not 1 in Complement(S.Reals, S.Naturals, evaluate=False)
310. 
311.     assert Complement(S.Integers, S.UniversalSet) == EmptySet
312.     assert S.UniversalSet.complement(S.Integers) == EmptySet
313. 
314.     assert (not 0 in S.Reals.intersect(S.Integers - FiniteSet(0)))
315. 
316.     assert S.EmptySet - S.Integers == S.EmptySet
317. 
318.     assert (S.Integers - FiniteSet(0)) - FiniteSet(1) == S.Integers - FiniteSet(0, 1)
319. 
320.     assert S.Reals - Union(S.Naturals, FiniteSet(pi)) == \
321.             Intersection(S.Reals - S.Naturals, S.Reals - FiniteSet(pi))
322.     # issue 12712
323.     assert Complement(FiniteSet(x, y, 2), Interval(-10, 10)) == \
324.             Complement(FiniteSet(x, y), Interval(-10, 10))
325. 
326.     A = FiniteSet(*symbols('a:c'))
327.     B = FiniteSet(*symbols('d:f'))
328.     assert unchanged(Complement, ProductSet(A, A), B)
329. 
330.     A2 = ProductSet(A, A)
331.     B3 = ProductSet(B, B, B)
332.     assert A2 - B3 == A2
333.     assert B3 - A2 == B3
334. 
335. 
336. def test_set_operations_nonsets():
337.     '''Tests that e.g. FiniteSet(1) * 2 raises TypeError'''
338.     ops = [
339.         lambda a, b: a + b,
340.         lambda a, b: a - b,
341.         lambda a, b: a * b,
342.         lambda a, b: a / b,
343.         lambda a, b: a // b,
344.         lambda a, b: a | b,
345.         lambda a, b: a & b,
346.         lambda a, b: a ^ b,
347.         # FiniteSet(1) ** 2 gives a ProductSet
348.         #lambda a, b: a ** b,
349.     ]
350.     Sx = FiniteSet(x)
351.     Sy = FiniteSet(y)
352.     sets = [
353.         {1},
354.         FiniteSet(1),
355.         Interval(1, 2),
356.         Union(Sx, Interval(1, 2)),
357.         Intersection(Sx, Sy),
358.         Complement(Sx, Sy),
359.         ProductSet(Sx, Sy),
360.         S.EmptySet,
361.     ]
362.     nums = [0, 1, 2, S(0), S(1), S(2)]
363. 
364.     for si in sets:
365.         for ni in nums:
366.             for op in ops:
367.                 raises(TypeError, lambda : op(si, ni))
368.                 raises(TypeError, lambda : op(ni, si))
369.         raises(TypeError, lambda: si ** object())
370.         raises(TypeError, lambda: si ** {1})
371. 
372. 
373. def test_complement():
374.     assert Interval(0, 1).complement(S.Reals) == \
375.         Union(Interval(-oo, 0, True, True), Interval(1, oo, True, True))
376.     assert Interval(0, 1, True, False).complement(S.Reals) == \
377.         Union(Interval(-oo, 0, True, False), Interval(1, oo, True, True))
378.     assert Interval(0, 1, False, True).complement(S.Reals) == \
379.         Union(Interval(-oo, 0, True, True), Interval(1, oo, False, True))
380.     assert Interval(0, 1, True, True).complement(S.Reals) == \
381.         Union(Interval(-oo, 0, True, False), Interval(1, oo, False, True))
382. 
383.     assert S.UniversalSet.complement(S.EmptySet) == S.EmptySet
384.     assert S.UniversalSet.complement(S.Reals) == S.EmptySet
385.     assert S.UniversalSet.complement(S.UniversalSet) == S.EmptySet
386. 
387.     assert S.EmptySet.complement(S.Reals) == S.Reals
388. 
389.     assert Union(Interval(0, 1), Interval(2, 3)).complement(S.Reals) == \
390.         Union(Interval(-oo, 0, True, True), Interval(1, 2, True, True),
391.               Interval(3, oo, True, True))
392. 
393.     assert FiniteSet(0).complement(S.Reals) ==  \
394.         Union(Interval(-oo, 0, True, True), Interval(0, oo, True, True))
395. 
396.     assert (FiniteSet(5) + Interval(S.NegativeInfinity,
397.                                     0)).complement(S.Reals) == \
398.         Interval(0, 5, True, True) + Interval(5, S.Infinity, True, True)
399. 
400.     assert FiniteSet(1, 2, 3).complement(S.Reals) == \
401.         Interval(S.NegativeInfinity, 1, True, True) + \
402.         Interval(1, 2, True, True) + Interval(2, 3, True, True) +\
403.         Interval(3, S.Infinity, True, True)
404. 
405.     assert FiniteSet(x).complement(S.Reals) == Complement(S.Reals, FiniteSet(x))
406. 
407.     assert FiniteSet(0, x).complement(S.Reals) == Complement(Interval(-oo, 0, True, True) +
408.                                                              Interval(0, oo, True, True)
409.                                                              , FiniteSet(x), evaluate=False)
410. 
411.     square = Interval(0, 1) * Interval(0, 1)
412.     notsquare = square.complement(S.Reals*S.Reals)
413. 
414.     assert all(pt in square for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
415.     assert not any(
416.         pt in notsquare for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
417.     assert not any(pt in square for pt in [(-1, 0), (1.5, .5), (10, 10)])
418.     assert all(pt in notsquare for pt in [(-1, 0), (1.5, .5), (10, 10)])
419. 
420. 
421. def test_intersect1():
422.     assert all(S.Integers.intersection(i) is i for i in
423.         (S.Naturals, S.Naturals0))
424.     assert all(i.intersection(S.Integers) is i for i in
425.         (S.Naturals, S.Naturals0))
426.     s =  S.Naturals0
427.     assert S.Naturals.intersection(s) is S.Naturals
428.     assert s.intersection(S.Naturals) is S.Naturals
429.     x = Symbol('x')
430.     assert Interval(0, 2).intersect(Interval(1, 2)) == Interval(1, 2)
431.     assert Interval(0, 2).intersect(Interval(1, 2, True)) == \
432.         Interval(1, 2, True)
433.     assert Interval(0, 2, True).intersect(Interval(1, 2)) == \
434.         Interval(1, 2, False, False)
435.     assert Interval(0, 2, True, True).intersect(Interval(1, 2)) == \
436.         Interval(1, 2, False, True)
437.     assert Interval(0, 2).intersect(Union(Interval(0, 1), Interval(2, 3))) == \
438.         Union(Interval(0, 1), Interval(2, 2))
439. 
440.     assert FiniteSet(1, 2).intersect(FiniteSet(1, 2, 3)) == FiniteSet(1, 2)
441.     assert FiniteSet(1, 2, x).intersect(FiniteSet(x)) == FiniteSet(x)
442.     assert FiniteSet('ham', 'eggs').intersect(FiniteSet('ham')) == \
443.         FiniteSet('ham')
444.     assert FiniteSet(1, 2, 3, 4, 5).intersect(S.EmptySet) == S.EmptySet
445. 
446.     assert Interval(0, 5).intersect(FiniteSet(1, 3)) == FiniteSet(1, 3)
447.     assert Interval(0, 1, True, True).intersect(FiniteSet(1)) == S.EmptySet
448. 
449.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2)) == \
450.         Union(Interval(1, 1), Interval(2, 2))
451.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(0, 2)) == \
452.         Union(Interval(0, 1), Interval(2, 2))
453.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2, True, True)) == \
454.         S.EmptySet
455.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(S.EmptySet) == \
456.         S.EmptySet
457.     assert Union(Interval(0, 5), FiniteSet('ham')).intersect(FiniteSet(2, 3, 4, 5, 6)) == \
458.         Intersection(FiniteSet(2, 3, 4, 5, 6), Union(FiniteSet('ham'), Interval(0, 5)))
459.     assert Intersection(FiniteSet(1, 2, 3), Interval(2, x), Interval(3, y)) == \
460.         Intersection(FiniteSet(3), Interval(2, x), Interval(3, y), evaluate=False)
461.     assert Intersection(FiniteSet(1, 2), Interval(0, 3), Interval(x, y)) == \
462.         Intersection({1, 2}, Interval(x, y), evaluate=False)
463.     assert Intersection(FiniteSet(1, 2, 4), Interval(0, 3), Interval(x, y)) == \
464.         Intersection({1, 2}, Interval(x, y), evaluate=False)
465.     # XXX: Is the real=True necessary here?
466.     # https://github.com/sympy/sympy/issues/17532
467.     m, n = symbols('m, n', real=True)
468.     assert Intersection(FiniteSet(m), FiniteSet(m, n), Interval(m, m+1)) == \
469.         FiniteSet(m)
470. 
471.     # issue 8217
472.     assert Intersection(FiniteSet(x), FiniteSet(y)) == \
473.         Intersection(FiniteSet(x), FiniteSet(y), evaluate=False)
474.     assert FiniteSet(x).intersect(S.Reals) == \
475.         Intersection(S.Reals, FiniteSet(x), evaluate=False)
476. 
477.     # tests for the intersection alias
478.     assert Interval(0, 5).intersection(FiniteSet(1, 3)) == FiniteSet(1, 3)
479.     assert Interval(0, 1, True, True).intersection(FiniteSet(1)) == S.EmptySet
480. 
481.     assert Union(Interval(0, 1), Interval(2, 3)).intersection(Interval(1, 2)) == \
482.         Union(Interval(1, 1), Interval(2, 2))
483. 
484. 
485. def test_intersection():
486.     # iterable
487.     i = Intersection(FiniteSet(1, 2, 3), Interval(2, 5), evaluate=False)
488.     assert i.is_iterable
489.     assert set(i) == {S(2), S(3)}
490. 
491.     # challenging intervals
492.     x = Symbol('x', real=True)
493.     i = Intersection(Interval(0, 3), Interval(x, 6))
494.     assert (5 in i) is False
495.     raises(TypeError, lambda: 2 in i)
496. 
497.     # Singleton special cases
498.     assert Intersection(Interval(0, 1), S.EmptySet) == S.EmptySet
499.     assert Intersection(Interval(-oo, oo), Interval(-oo, x)) == Interval(-oo, x)
500.

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 01:21:29,031 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query is to provide the full content of `sympy/sets/tests/test_sets.py`.\n   - The provided context is the first 500 lines of this file.\n2. Extended relevance:\n   - The user's purpose is to find test cases related to an `ImageSet` intersection bug.\n   - This file contains `test_imageset` which is directly related to `ImageSet` functionality.\n   - It also contains generic intersection tests like `test_intersect1` and `test_intersection` which, while not directly testing `ImageSet`, are relevant to the concept of intersection in the library.", relative_path='sympy/sets/tests/test_sets.py', start_line=1, end_line=500)]
2025-12-21 01:21:29,033 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `sympy/sets/tests/test_sets.py`.
2025-12-21 01:21:29,033 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 01:21:29,033 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 01:21:29,033 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-21 01:21:29,033 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-21 01:21:29,034 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .github
|   └── workflows
|       └── runtests.yml
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.md
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_optional_dependencies.py
|   ├── test_py2_import.py
|   ├── test_setup.py
|   ├── test_sphinx.sh
|   ├── test_submodule_imports.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── guides
|       |   ├── assumptions.rst
|       |   ├── booleans.rst
|       |   └── index.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── index.rst
|       |   |   ├── predicates.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── sparse.rst
|       |   |   └── sparsetools.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── control
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── domainmatrix.rst
|       |   |   ├── domainsintro.rst
|       |   |   ├── domainsref.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   ├── solvers.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── fu.rst
|       |   |   ├── hyperexpand.rst
|       |   |   ├── index.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── testing
|       |   |   ├── index.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   └── runtests.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       ├── intro.rst
|       |       └── vector_integration.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── classification.rst
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── aptinstall.sh
|   ├── authors.py
|   ├── build_docs.py
|   ├── compare_tar_against_git.py
|   ├── fabfile.py
|   ├── github_release.py
|   ├── helpers.py
|   ├── pull_and_run_rever.sh
|   ├── release.sh
|   ├── releasecheck.py
|   ├── requirements.txt
|   ├── sha256.py
|   ├── test_install.py
|   ├── update_docs.py
|   └── update_requirements.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── facts.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── predicates
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── relation
    |   |   ├── __init__.py
    |   |   ├── binrel.py
    |   |   └── equality.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_assumptions_2.py
    |   |   ├── test_context.py
    |   |   ├── test_matrices.py
    |   |   ├── test_query.py
    |   |   ├── test_refine.py
    |   |   ├── test_satask.py
    |   |   ├── test_sathandlers.py
    |   |   └── test_wrapper.py
    |   └── wrapper.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── numpy_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   ├── scipy_nodes.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_numpy_nodes.py
    |       ├── test_pyutils.py
    |       ├── test_rewriting.py
    |       └── test_scipy_nodes.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── schur_number.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_schur_number.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── _print_helpers.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── kind.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_kind.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── gmpy.py
    |   ├── importtools.py
    |   ├── pythonmpq.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_pythonmpq.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   ├── minisat22_wrapper.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── decompositions.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── determinant.py
    |   ├── eigen.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── companion.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── sets.py
    |   |   ├── slice.py
    |   |   ├── special.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_companion.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_sets.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_special.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── graph.py
    |   ├── immutable.py
    |   ├── inverse.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── reductions.py
    |   ├── solvers.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   ├── subspaces.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_commonmatrix.py
    |   |   ├── test_decompositions.py
    |   |   ├── test_densearith.py
    |   |   ├── test_densesolve.py
    |   |   ├── test_densetools.py
    |   |   ├── test_determinant.py
    |   |   ├── test_eigen.py
    |   |   ├── test_graph.py
    |   |   ├── test_immutable.py
    |   |   ├── test_interactions.py
    |   |   ├── test_matrices.py
    |   |   ├── test_normalforms.py
    |   |   ├── test_reductions.py
    |   |   ├── test_solvers.py
    |   |   ├── test_sparse.py
    |   |   ├── test_sparsetools.py
    |   |   └── test_subspaces.py
    |   └── utilities.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── digits.py
    |   ├── ecm.py
    |   ├── egyptian_fraction.py
    |   ├── elliptic_curve.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── qs.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_digits.py
    |       ├── test_ecm.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_elliptic_curve.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       ├── test_qs.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── README.txt
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── control
    |   |   ├── __init__.py
    |   |   ├── lti.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_lti.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domainmatrix.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gaussiandomains.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── matrices
    |   |   ├── __init__.py
    |   |   ├── ddm.py
    |   |   ├── dense.py
    |   |   ├── domainmatrix.py
    |   |   ├── domainscalar.py
    |   |   ├── eigen.py
    |   |   ├── exceptions.py
    |   |   ├── linsolve.py
    |   |   ├── normalforms.py
    |   |   ├── sdm.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_ddm.py
    |   |       ├── test_dense.py
    |   |       ├── test_domainmatrix.py
    |   |       ├── test_domainscalar.py
    |   |       ├── test_eigen.py
    |   |       ├── test_linsolve.py
    |   |       ├── test_normalforms.py
    |   |       └── test_sdm.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── aesaracode.py
    |   ├── c.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxx.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── fortran.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── numpy.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_aesaracode.py
    |   |   ├── test_c.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cupy.py
    |   |   ├── test_cxx.py
    |   |   ├── test_dot.py
    |   |   ├── test_fortran.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── comparison.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine
    |   |   ├── __init__.py
    |   |   ├── diophantine.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_diophantine.py
    |   ├── inequalities.py
    |   ├── ode
    |   |   ├── __init__.py
    |   |   ├── ode.py
    |   |   ├── single.py
    |   |   ├── subscheck.py
    |   |   ├── systems.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_lie_group.py
    |   |       ├── test_ode.py
    |   |       ├── test_single.py
    |   |       ├── test_subscheck.py
    |   |       └── test_systems.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── compound_rv.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── matrix_distributions.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── sampling
    |   |   ├── __init__.py
    |   |   ├── sample_numpy.py
    |   |   ├── sample_pymc3.py
    |   |   ├── sample_scipy.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_sample_continuous_rv.py
    |   |       ├── test_sample_discrete_rv.py
    |   |       └── test_sample_finite_rv.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_multivariate_probability.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_compound_rv.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_matrix_distributions.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       ├── test_symbolic_multivariate.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── array_derivatives.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── expressions
    |   |   |   ├── __init__.py
    |   |   |   ├── array_expressions.py
    |   |   |   ├── arrayexpr_derivatives.py
    |   |   |   ├── conv_array_to_matrix.py
    |   |   |   ├── conv_indexed_to_array.py
    |   |   |   ├── conv_matrix_to_array.py
    |   |   |   ├── tests
    |   |   |   └── utils.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_array_derivatives.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── testing
    |   ├── __init__.py
    |   ├── benchmarking.py
    |   ├── matrices.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_module_imports.py
    |   |   └── test_pytest.py
    |   └── tmpfiles.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_matchpy_connector.py
    |   |   ├── test_misc.py
    |   |   ├── test_pickling.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── implicitregion.py
        ├── integrals.py
        ├── operators.py
        ├── orienters.py
        ├── parametricregion.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_implicitregion.py
        |   ├── test_integrals.py
        |   ├── test_operators.py
        |   ├── test_parametricregion.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: bug in is_subset(Reals)

Description: Solving issue #19513 has given rise to another bug.
Now:
```
In [8]: S1 = imageset(Lambda(n, n + (n - 1)*(n + 1)*I), S.Integers)

In [9]: S1
Out[9]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [10]: 2 in S1
Out[10]: False

In [11]: 2 in S1.intersect(Reals)
Out[11]: True
```
This output is incorrect.

Correct output is:
```
In [4]: S1
Out[4]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [5]: 2 in S1
Out[5]: False

In [6]: 2 in S1.intersect(Reals)
Out[6]: False

In [7]: S2 = Reals

In [8]: S1.intersect(S2)
Out[8]: {-1, 1}
```

Patch information:
diff --git a/sympy/sets/handlers/intersection.py b/sympy/sets/handlers/intersection.py
index c54dc8f72a..d013b03983 100644
--- a/sympy/sets/handlers/intersection.py
+++ b/sympy/sets/handlers/intersection.py
@@ -303,22 +303,28 @@ def intersection_sets(self, other): # noqa:F811
         elif ifree != {n}:
             return None
         else:
-            # univarite imaginary part in same variable
-            x, xis = zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols])
-            if x and all(i == n for i in x):
-                base_set -= FiniteSet(xis)
+            # univariate imaginary part in same variable
+            x_xis = [solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]
+            if x_xis:
+                x, xis = zip(*x_xis)
+                if x and all(i == n for i in x):
+                    base_set = base_set.intersect(FiniteSet(*xis))
+                else:
+                    base_set = ConditionSet(n, Eq(im, 0), base_set)
             else:
-                base_set -= ConditionSet(n, Eq(im, 0), S.Integers)
+                base_set = ConditionSet(n, Eq(im, 0), base_set)
         # exclude values that make denominators 0
-        for i in denoms(f):
-            if i.has(n):
-                sol = list(zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]))
-                if sol != []:
-                    x, xis = sol
+        for d in denoms(f):
+            if d.has(n):
+                sol_pairs = [solve_linear(j, 0) for j in Mul.make_args(d) if n in j.free_symbols]
+                if sol_pairs:
+                    x, xis = zip(*sol_pairs)
                     if x and all(i == n for i in x):
-                        base_set -= FiniteSet(xis)
+                        base_set = base_set - FiniteSet(*xis)
+                    else:
+                        base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
                 else:
-                    base_set -= ConditionSet(n, Eq(i, 0), S.Integers)
+                    base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
         return imageset(lam, base_set)
 
     elif isinstance(other, Interval):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `sympy/sets/tests/test_sets.py`.
Extra Requirements: 
Purpose: I need to find 3 relevant test cases that demonstrate the functionality related to the bug in `ImageSet` intersection.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/sets/tests/test_sets.py
Line number range: 1 - 500
Content:
1. from sympy import (Symbol, Set, Union, Interval, oo, S, sympify, nan,
2.     Max, Min, Float, DisjointUnion,
3.     FiniteSet, Intersection, imageset, I, true, false, ProductSet,
4.     sqrt, Complement, EmptySet, sin, cos, Lambda, ImageSet, pi,
5.     Pow, Contains, Sum, rootof, SymmetricDifference, Piecewise,
6.     Matrix, Range, Add, symbols, zoo, Rational)
7. from mpmath import mpi
8. 
9. from sympy.core.expr import unchanged
10. from sympy.core.relational import Eq, Ne, Le, Lt, LessThan
11. from sympy.logic import And, Or, Xor
12. from sympy.testing.pytest import raises, XFAIL, warns_deprecated_sympy
13. 
14. from sympy.abc import x, y, z, m, n
15. 
16. 
17. def test_imageset():
18.     ints = S.Integers
19.     assert imageset(x, x - 1, S.Naturals) is S.Naturals0
20.     assert imageset(x, x + 1, S.Naturals0) is S.Naturals
21.     assert imageset(x, abs(x), S.Naturals0) is S.Naturals0
22.     assert imageset(x, abs(x), S.Naturals) is S.Naturals
23.     assert imageset(x, abs(x), S.Integers) is S.Naturals0
24.     # issue 16878a
25.     r = symbols('r', real=True)
26.     assert imageset(x, (x, x), S.Reals)._contains((1, r)) == None
27.     assert imageset(x, (x, x), S.Reals)._contains((1, 2)) == False
28.     assert (r, r) in imageset(x, (x, x), S.Reals)
29.     assert 1 + I in imageset(x, x + I, S.Reals)
30.     assert {1} not in imageset(x, (x,), S.Reals)
31.     assert (1, 1) not in imageset(x, (x,) , S.Reals)
32.     raises(TypeError, lambda: imageset(x, ints))
33.     raises(ValueError, lambda: imageset(x, y, z, ints))
34.     raises(ValueError, lambda: imageset(Lambda(x, cos(x)), y))
35.     assert (1, 2) in imageset(Lambda((x, y), (x, y)), ints, ints)
36.     raises(ValueError, lambda: imageset(Lambda(x, x), ints, ints))
37.     assert imageset(cos, ints) == ImageSet(Lambda(x, cos(x)), ints)
38.     def f(x):
39.         return cos(x)
40.     assert imageset(f, ints) == imageset(x, cos(x), ints)
41.     f = lambda x: cos(x)
42.     assert imageset(f, ints) == ImageSet(Lambda(x, cos(x)), ints)
43.     assert imageset(x, 1, ints) == FiniteSet(1)
44.     assert imageset(x, y, ints) == {y}
45.     assert imageset((x, y), (1, z), ints, S.Reals) == {(1, z)}
46.     clash = Symbol('x', integer=true)
47.     assert (str(imageset(lambda x: x + clash, Interval(-2, 1)).lamda.expr)
48.         in ('x0 + x', 'x + x0'))
49.     x1, x2 = symbols("x1, x2")
50.     assert imageset(lambda x, y:
51.         Add(x, y), Interval(1, 2), Interval(2, 3)).dummy_eq(
52.         ImageSet(Lambda((x1, x2), x1 + x2),
53.         Interval(1, 2), Interval(2, 3)))
54. 
55. 
56. def test_is_empty():
57.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
58.             S.UniversalSet]:
59.         assert s.is_empty is False
60. 
61.     assert S.EmptySet.is_empty is True
62. 
63. 
64. def test_is_finiteset():
65.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
66.             S.UniversalSet]:
67.         assert s.is_finite_set is False
68. 
69.     assert S.EmptySet.is_finite_set is True
70. 
71.     assert FiniteSet(1, 2).is_finite_set is True
72.     assert Interval(1, 2).is_finite_set is False
73.     assert Interval(x, y).is_finite_set is None
74.     assert ProductSet(FiniteSet(1), FiniteSet(2)).is_finite_set is True
75.     assert ProductSet(FiniteSet(1), Interval(1, 2)).is_finite_set is False
76.     assert ProductSet(FiniteSet(1), Interval(x, y)).is_finite_set is None
77.     assert Union(Interval(0, 1), Interval(2, 3)).is_finite_set is False
78.     assert Union(FiniteSet(1), Interval(2, 3)).is_finite_set is False
79.     assert Union(FiniteSet(1), FiniteSet(2)).is_finite_set is True
80.     assert Union(FiniteSet(1), Interval(x, y)).is_finite_set is None
81.     assert Intersection(Interval(x, y), FiniteSet(1)).is_finite_set is True
82.     assert Intersection(Interval(x, y), Interval(1, 2)).is_finite_set is None
83.     assert Intersection(FiniteSet(x), FiniteSet(y)).is_finite_set is True
84.     assert Complement(FiniteSet(1), Interval(x, y)).is_finite_set is True
85.     assert Complement(Interval(x, y), FiniteSet(1)).is_finite_set is None
86.     assert Complement(Interval(1, 2), FiniteSet(x)).is_finite_set is False
87.     assert DisjointUnion(Interval(-5, 3), FiniteSet(x, y)).is_finite_set is False
88.     assert DisjointUnion(S.EmptySet, FiniteSet(x, y), S.EmptySet).is_finite_set is True
89. 
90. 
91. def test_deprecated_is_EmptySet():
92.     with warns_deprecated_sympy():
93.         S.EmptySet.is_EmptySet
94. 
95. 
96. def test_interval_arguments():
97.     assert Interval(0, oo) == Interval(0, oo, False, True)
98.     assert Interval(0, oo).right_open is true
99.     assert Interval(-oo, 0) == Interval(-oo, 0, True, False)
100.     assert Interval(-oo, 0).left_open is true
101.     assert Interval(oo, -oo) == S.EmptySet
102.     assert Interval(oo, oo) == S.EmptySet
103.     assert Interval(-oo, -oo) == S.EmptySet
104.     assert Interval(oo, x) == S.EmptySet
105.     assert Interval(oo, oo) == S.EmptySet
106.     assert Interval(x, -oo) == S.EmptySet
107.     assert Interval(x, x) == {x}
108. 
109.     assert isinstance(Interval(1, 1), FiniteSet)
110.     e = Sum(x, (x, 1, 3))
111.     assert isinstance(Interval(e, e), FiniteSet)
112. 
113.     assert Interval(1, 0) == S.EmptySet
114.     assert Interval(1, 1).measure == 0
115. 
116.     assert Interval(1, 1, False, True) == S.EmptySet
117.     assert Interval(1, 1, True, False) == S.EmptySet
118.     assert Interval(1, 1, True, True) == S.EmptySet
119. 
120. 
121.     assert isinstance(Interval(0, Symbol('a')), Interval)
122.     assert Interval(Symbol('a', real=True, positive=True), 0) == S.EmptySet
123.     raises(ValueError, lambda: Interval(0, S.ImaginaryUnit))
124.     raises(ValueError, lambda: Interval(0, Symbol('z', extended_real=False)))
125.     raises(ValueError, lambda: Interval(x, x + S.ImaginaryUnit))
126. 
127.     raises(NotImplementedError, lambda: Interval(0, 1, And(x, y)))
128.     raises(NotImplementedError, lambda: Interval(0, 1, False, And(x, y)))
129.     raises(NotImplementedError, lambda: Interval(0, 1, z, And(x, y)))
130. 
131. 
132. def test_interval_symbolic_end_points():
133.     a = Symbol('a', real=True)
134. 
135.     assert Union(Interval(0, a), Interval(0, 3)).sup == Max(a, 3)
136.     assert Union(Interval(a, 0), Interval(-3, 0)).inf == Min(-3, a)
137. 
138.     assert Interval(0, a).contains(1) == LessThan(1, a)
139. 
140. 
141. def test_interval_is_empty():
142.     x, y = symbols('x, y')
143.     r = Symbol('r', real=True)
144.     p = Symbol('p', positive=True)
145.     n = Symbol('n', negative=True)
146.     nn = Symbol('nn', nonnegative=True)
147.     assert Interval(1, 2).is_empty == False
148.     assert Interval(3, 3).is_empty == False  # FiniteSet
149.     assert Interval(r, r).is_empty == False  # FiniteSet
150.     assert Interval(r, r + nn).is_empty == False
151.     assert Interval(x, x).is_empty == False
152.     assert Interval(1, oo).is_empty == False
153.     assert Interval(-oo, oo).is_empty == False
154.     assert Interval(-oo, 1).is_empty == False
155.     assert Interval(x, y).is_empty == None
156.     assert Interval(r, oo).is_empty == False  # real implies finite
157.     assert Interval(n, 0).is_empty == False
158.     assert Interval(n, 0, left_open=True).is_empty == False
159.     assert Interval(p, 0).is_empty == True  # EmptySet
160.     assert Interval(nn, 0).is_empty == None
161.     assert Interval(n, p).is_empty == False
162.     assert Interval(0, p, left_open=True).is_empty == False
163.     assert Interval(0, p, right_open=True).is_empty == False
164.     assert Interval(0, nn, left_open=True).is_empty == None
165.     assert Interval(0, nn, right_open=True).is_empty == None
166. 
167. 
168. def test_union():
169.     assert Union(Interval(1, 2), Interval(2, 3)) == Interval(1, 3)
170.     assert Union(Interval(1, 2), Interval(2, 3, True)) == Interval(1, 3)
171.     assert Union(Interval(1, 3), Interval(2, 4)) == Interval(1, 4)
172.     assert Union(Interval(1, 2), Interval(1, 3)) == Interval(1, 3)
173.     assert Union(Interval(1, 3), Interval(1, 2)) == Interval(1, 3)
174.     assert Union(Interval(1, 3, False, True), Interval(1, 2)) == \
175.         Interval(1, 3, False, True)
176.     assert Union(Interval(1, 3), Interval(1, 2, False, True)) == Interval(1, 3)
177.     assert Union(Interval(1, 2, True), Interval(1, 3)) == Interval(1, 3)
178.     assert Union(Interval(1, 2, True), Interval(1, 3, True)) == \
179.         Interval(1, 3, True)
180.     assert Union(Interval(1, 2, True), Interval(1, 3, True, True)) == \
181.         Interval(1, 3, True, True)
182.     assert Union(Interval(1, 2, True, True), Interval(1, 3, True)) == \
183.         Interval(1, 3, True)
184.     assert Union(Interval(1, 3), Interval(2, 3)) == Interval(1, 3)
185.     assert Union(Interval(1, 3, False, True), Interval(2, 3)) == \
186.         Interval(1, 3)
187.     assert Union(Interval(1, 2, False, True), Interval(2, 3, True)) != \
188.         Interval(1, 3)
189.     assert Union(Interval(1, 2), S.EmptySet) == Interval(1, 2)
190.     assert Union(S.EmptySet) == S.EmptySet
191. 
192.     assert Union(Interval(0, 1), *[FiniteSet(1.0/n) for n in range(1, 10)]) == \
193.         Interval(0, 1)
194.     # issue #18241:
195.     x = Symbol('x')
196.     assert Union(Interval(0, 1), FiniteSet(1, x)) == Union(
197.         Interval(0, 1), FiniteSet(x))
198.     assert unchanged(Union, Interval(0, 1), FiniteSet(2, x))
199. 
200.     assert Interval(1, 2).union(Interval(2, 3)) == \
201.         Interval(1, 2) + Interval(2, 3)
202. 
203.     assert Interval(1, 2).union(Interval(2, 3)) == Interval(1, 3)
204. 
205.     assert Union(Set()) == Set()
206. 
207.     assert FiniteSet(1) + FiniteSet(2) + FiniteSet(3) == FiniteSet(1, 2, 3)
208.     assert FiniteSet('ham') + FiniteSet('eggs') == FiniteSet('ham', 'eggs')
209.     assert FiniteSet(1, 2, 3) + S.EmptySet == FiniteSet(1, 2, 3)
210. 
211.     assert FiniteSet(1, 2, 3) & FiniteSet(2, 3, 4) == FiniteSet(2, 3)
212.     assert FiniteSet(1, 2, 3) | FiniteSet(2, 3, 4) == FiniteSet(1, 2, 3, 4)
213. 
214.     assert FiniteSet(1, 2, 3) & S.EmptySet == S.EmptySet
215.     assert FiniteSet(1, 2, 3) | S.EmptySet == FiniteSet(1, 2, 3)
216. 
217.     x = Symbol("x")
218.     y = Symbol("y")
219.     z = Symbol("z")
220.     assert S.EmptySet | FiniteSet(x, FiniteSet(y, z)) == \
221.         FiniteSet(x, FiniteSet(y, z))
222. 
223.     # Test that Intervals and FiniteSets play nicely
224.     assert Interval(1, 3) + FiniteSet(2) == Interval(1, 3)
225.     assert Interval(1, 3, True, True) + FiniteSet(3) == \
226.         Interval(1, 3, True, False)
227.     X = Interval(1, 3) + FiniteSet(5)
228.     Y = Interval(1, 2) + FiniteSet(3)
229.     XandY = X.intersect(Y)
230.     assert 2 in X and 3 in X and 3 in XandY
231.     assert XandY.is_subset(X) and XandY.is_subset(Y)
232. 
233.     raises(TypeError, lambda: Union(1, 2, 3))
234. 
235.     assert X.is_iterable is False
236. 
237.     # issue 7843
238.     assert Union(S.EmptySet, FiniteSet(-sqrt(-I), sqrt(-I))) == \
239.         FiniteSet(-sqrt(-I), sqrt(-I))
240. 
241.     assert Union(S.Reals, S.Integers) == S.Reals
242. 
243. 
244. def test_union_iter():
245.     # Use Range because it is ordered
246.     u = Union(Range(3), Range(5), Range(4), evaluate=False)
247. 
248.     # Round robin
249.     assert list(u) == [0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 4]
250. 
251. 
252. def test_union_is_empty():
253.     assert (Interval(x, y) + FiniteSet(1)).is_empty == False
254.     assert (Interval(x, y) + Interval(-x, y)).is_empty == None
255. 
256. 
257. def test_difference():
258.     assert Interval(1, 3) - Interval(1, 2) == Interval(2, 3, True)
259.     assert Interval(1, 3) - Interval(2, 3) == Interval(1, 2, False, True)
260.     assert Interval(1, 3, True) - Interval(2, 3) == Interval(1, 2, True, True)
261.     assert Interval(1, 3, True) - Interval(2, 3, True) == \
262.         Interval(1, 2, True, False)
263.     assert Interval(0, 2) - FiniteSet(1) == \
264.         Union(Interval(0, 1, False, True), Interval(1, 2, True, False))
265. 
266.     # issue #18119
267.     assert S.Reals - FiniteSet(I) == S.Reals
268.     assert S.Reals - FiniteSet(-I, I) == S.Reals
269.     assert Interval(0, 10) - FiniteSet(-I, I) == Interval(0, 10)
270.     assert Interval(0, 10) - FiniteSet(1, I) == Union(
271.         Interval.Ropen(0, 1), Interval.Lopen(1, 10))
272.     assert S.Reals - FiniteSet(1, 2 + I, x, y**2) == Complement(
273.         Union(Interval.open(-oo, 1), Interval.open(1, oo)), FiniteSet(x, y**2),
274.         evaluate=False)
275. 
276.     assert FiniteSet(1, 2, 3) - FiniteSet(2) == FiniteSet(1, 3)
277.     assert FiniteSet('ham', 'eggs') - FiniteSet('eggs') == FiniteSet('ham')
278.     assert FiniteSet(1, 2, 3, 4) - Interval(2, 10, True, False) == \
279.         FiniteSet(1, 2)
280.     assert FiniteSet(1, 2, 3, 4) - S.EmptySet == FiniteSet(1, 2, 3, 4)
281.     assert Union(Interval(0, 2), FiniteSet(2, 3, 4)) - Interval(1, 3) == \
282.         Union(Interval(0, 1, False, True), FiniteSet(4))
283. 
284.     assert -1 in S.Reals - S.Naturals
285. 
286. 
287. def test_Complement():
288.     A = FiniteSet(1, 3, 4)
289.     B = FiniteSet(3, 4)
290.     C = Interval(1, 3)
291.     D = Interval(1, 2)
292. 
293.     assert Complement(A, B, evaluate=False).is_iterable is True
294.     assert Complement(A, C, evaluate=False).is_iterable is True
295.     assert Complement(C, D, evaluate=False).is_iterable is None
296. 
297.     assert FiniteSet(*Complement(A, B, evaluate=False)) == FiniteSet(1)
298.     assert FiniteSet(*Complement(A, C, evaluate=False)) == FiniteSet(4)
299.     raises(TypeError, lambda: FiniteSet(*Complement(C, A, evaluate=False)))
300. 
301.     assert Complement(Interval(1, 3), Interval(1, 2)) == Interval(2, 3, True)
302.     assert Complement(FiniteSet(1, 3, 4), FiniteSet(3, 4)) == FiniteSet(1)
303.     assert Complement(Union(Interval(0, 2), FiniteSet(2, 3, 4)),
304.                       Interval(1, 3)) == \
305.         Union(Interval(0, 1, False, True), FiniteSet(4))
306. 
307.     assert not 3 in Complement(Interval(0, 5), Interval(1, 4), evaluate=False)
308.     assert -1 in Complement(S.Reals, S.Naturals, evaluate=False)
309.     assert not 1 in Complement(S.Reals, S.Naturals, evaluate=False)
310. 
311.     assert Complement(S.Integers, S.UniversalSet) == EmptySet
312.     assert S.UniversalSet.complement(S.Integers) == EmptySet
313. 
314.     assert (not 0 in S.Reals.intersect(S.Integers - FiniteSet(0)))
315. 
316.     assert S.EmptySet - S.Integers == S.EmptySet
317. 
318.     assert (S.Integers - FiniteSet(0)) - FiniteSet(1) == S.Integers - FiniteSet(0, 1)
319. 
320.     assert S.Reals - Union(S.Naturals, FiniteSet(pi)) == \
321.             Intersection(S.Reals - S.Naturals, S.Reals - FiniteSet(pi))
322.     # issue 12712
323.     assert Complement(FiniteSet(x, y, 2), Interval(-10, 10)) == \
324.             Complement(FiniteSet(x, y), Interval(-10, 10))
325. 
326.     A = FiniteSet(*symbols('a:c'))
327.     B = FiniteSet(*symbols('d:f'))
328.     assert unchanged(Complement, ProductSet(A, A), B)
329. 
330.     A2 = ProductSet(A, A)
331.     B3 = ProductSet(B, B, B)
332.     assert A2 - B3 == A2
333.     assert B3 - A2 == B3
334. 
335. 
336. def test_set_operations_nonsets():
337.     '''Tests that e.g. FiniteSet(1) * 2 raises TypeError'''
338.     ops = [
339.         lambda a, b: a + b,
340.         lambda a, b: a - b,
341.         lambda a, b: a * b,
342.         lambda a, b: a / b,
343.         lambda a, b: a // b,
344.         lambda a, b: a | b,
345.         lambda a, b: a & b,
346.         lambda a, b: a ^ b,
347.         # FiniteSet(1) ** 2 gives a ProductSet
348.         #lambda a, b: a ** b,
349.     ]
350.     Sx = FiniteSet(x)
351.     Sy = FiniteSet(y)
352.     sets = [
353.         {1},
354.         FiniteSet(1),
355.         Interval(1, 2),
356.         Union(Sx, Interval(1, 2)),
357.         Intersection(Sx, Sy),
358.         Complement(Sx, Sy),
359.         ProductSet(Sx, Sy),
360.         S.EmptySet,
361.     ]
362.     nums = [0, 1, 2, S(0), S(1), S(2)]
363. 
364.     for si in sets:
365.         for ni in nums:
366.             for op in ops:
367.                 raises(TypeError, lambda : op(si, ni))
368.                 raises(TypeError, lambda : op(ni, si))
369.         raises(TypeError, lambda: si ** object())
370.         raises(TypeError, lambda: si ** {1})
371. 
372. 
373. def test_complement():
374.     assert Interval(0, 1).complement(S.Reals) == \
375.         Union(Interval(-oo, 0, True, True), Interval(1, oo, True, True))
376.     assert Interval(0, 1, True, False).complement(S.Reals) == \
377.         Union(Interval(-oo, 0, True, False), Interval(1, oo, True, True))
378.     assert Interval(0, 1, False, True).complement(S.Reals) == \
379.         Union(Interval(-oo, 0, True, True), Interval(1, oo, False, True))
380.     assert Interval(0, 1, True, True).complement(S.Reals) == \
381.         Union(Interval(-oo, 0, True, False), Interval(1, oo, False, True))
382. 
383.     assert S.UniversalSet.complement(S.EmptySet) == S.EmptySet
384.     assert S.UniversalSet.complement(S.Reals) == S.EmptySet
385.     assert S.UniversalSet.complement(S.UniversalSet) == S.EmptySet
386. 
387.     assert S.EmptySet.complement(S.Reals) == S.Reals
388. 
389.     assert Union(Interval(0, 1), Interval(2, 3)).complement(S.Reals) == \
390.         Union(Interval(-oo, 0, True, True), Interval(1, 2, True, True),
391.               Interval(3, oo, True, True))
392. 
393.     assert FiniteSet(0).complement(S.Reals) ==  \
394.         Union(Interval(-oo, 0, True, True), Interval(0, oo, True, True))
395. 
396.     assert (FiniteSet(5) + Interval(S.NegativeInfinity,
397.                                     0)).complement(S.Reals) == \
398.         Interval(0, 5, True, True) + Interval(5, S.Infinity, True, True)
399. 
400.     assert FiniteSet(1, 2, 3).complement(S.Reals) == \
401.         Interval(S.NegativeInfinity, 1, True, True) + \
402.         Interval(1, 2, True, True) + Interval(2, 3, True, True) +\
403.         Interval(3, S.Infinity, True, True)
404. 
405.     assert FiniteSet(x).complement(S.Reals) == Complement(S.Reals, FiniteSet(x))
406. 
407.     assert FiniteSet(0, x).complement(S.Reals) == Complement(Interval(-oo, 0, True, True) +
408.                                                              Interval(0, oo, True, True)
409.                                                              , FiniteSet(x), evaluate=False)
410. 
411.     square = Interval(0, 1) * Interval(0, 1)
412.     notsquare = square.complement(S.Reals*S.Reals)
413. 
414.     assert all(pt in square for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
415.     assert not any(
416.         pt in notsquare for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
417.     assert not any(pt in square for pt in [(-1, 0), (1.5, .5), (10, 10)])
418.     assert all(pt in notsquare for pt in [(-1, 0), (1.5, .5), (10, 10)])
419. 
420. 
421. def test_intersect1():
422.     assert all(S.Integers.intersection(i) is i for i in
423.         (S.Naturals, S.Naturals0))
424.     assert all(i.intersection(S.Integers) is i for i in
425.         (S.Naturals, S.Naturals0))
426.     s =  S.Naturals0
427.     assert S.Naturals.intersection(s) is S.Naturals
428.     assert s.intersection(S.Naturals) is S.Naturals
429.     x = Symbol('x')
430.     assert Interval(0, 2).intersect(Interval(1, 2)) == Interval(1, 2)
431.     assert Interval(0, 2).intersect(Interval(1, 2, True)) == \
432.         Interval(1, 2, True)
433.     assert Interval(0, 2, True).intersect(Interval(1, 2)) == \
434.         Interval(1, 2, False, False)
435.     assert Interval(0, 2, True, True).intersect(Interval(1, 2)) == \
436.         Interval(1, 2, False, True)
437.     assert Interval(0, 2).intersect(Union(Interval(0, 1), Interval(2, 3))) == \
438.         Union(Interval(0, 1), Interval(2, 2))
439. 
440.     assert FiniteSet(1, 2).intersect(FiniteSet(1, 2, 3)) == FiniteSet(1, 2)
441.     assert FiniteSet(1, 2, x).intersect(FiniteSet(x)) == FiniteSet(x)
442.     assert FiniteSet('ham', 'eggs').intersect(FiniteSet('ham')) == \
443.         FiniteSet('ham')
444.     assert FiniteSet(1, 2, 3, 4, 5).intersect(S.EmptySet) == S.EmptySet
445. 
446.     assert Interval(0, 5).intersect(FiniteSet(1, 3)) == FiniteSet(1, 3)
447.     assert Interval(0, 1, True, True).intersect(FiniteSet(1)) == S.EmptySet
448. 
449.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2)) == \
450.         Union(Interval(1, 1), Interval(2, 2))
451.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(0, 2)) == \
452.         Union(Interval(0, 1), Interval(2, 2))
453.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2, True, True)) == \
454.         S.EmptySet
455.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(S.EmptySet) == \
456.         S.EmptySet
457.     assert Union(Interval(0, 5), FiniteSet('ham')).intersect(FiniteSet(2, 3, 4, 5, 6)) == \
458.         Intersection(FiniteSet(2, 3, 4, 5, 6), Union(FiniteSet('ham'), Interval(0, 5)))
459.     assert Intersection(FiniteSet(1, 2, 3), Interval(2, x), Interval(3, y)) == \
460.         Intersection(FiniteSet(3), Interval(2, x), Interval(3, y), evaluate=False)
461.     assert Intersection(FiniteSet(1, 2), Interval(0, 3), Interval(x, y)) == \
462.         Intersection({1, 2}, Interval(x, y), evaluate=False)
463.     assert Intersection(FiniteSet(1, 2, 4), Interval(0, 3), Interval(x, y)) == \
464.         Intersection({1, 2}, Interval(x, y), evaluate=False)
465.     # XXX: Is the real=True necessary here?
466.     # https://github.com/sympy/sympy/issues/17532
467.     m, n = symbols('m, n', real=True)
468.     assert Intersection(FiniteSet(m), FiniteSet(m, n), Interval(m, m+1)) == \
469.         FiniteSet(m)
470. 
471.     # issue 8217
472.     assert Intersection(FiniteSet(x), FiniteSet(y)) == \
473.         Intersection(FiniteSet(x), FiniteSet(y), evaluate=False)
474.     assert FiniteSet(x).intersect(S.Reals) == \
475.         Intersection(S.Reals, FiniteSet(x), evaluate=False)
476. 
477.     # tests for the intersection alias
478.     assert Interval(0, 5).intersection(FiniteSet(1, 3)) == FiniteSet(1, 3)
479.     assert Interval(0, 1, True, True).intersection(FiniteSet(1)) == S.EmptySet
480. 
481.     assert Union(Interval(0, 1), Interval(2, 3)).intersection(Interval(1, 2)) == \
482.         Union(Interval(1, 1), Interval(2, 2))
483. 
484. 
485. def test_intersection():
486.     # iterable
487.     i = Intersection(FiniteSet(1, 2, 3), Interval(2, 5), evaluate=False)
488.     assert i.is_iterable
489.     assert set(i) == {S(2), S(3)}
490. 
491.     # challenging intervals
492.     x = Symbol('x', real=True)
493.     i = Intersection(Interval(0, 3), Interval(x, 6))
494.     assert (5 in i) is False
495.     raises(TypeError, lambda: 2 in i)
496. 
497.     # Singleton special cases
498.     assert Intersection(Interval(0, 1), S.EmptySet) == S.EmptySet
499.     assert Intersection(Interval(-oo, oo), Interval(-oo, x)) == Interval(-oo, x)
500. 

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 01:21:55,141 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='I have analyzed the initial 500 lines of `sympy/sets/tests/test_sets.py` and found no tests for `ImageSet` intersections. The bug is specifically about this functionality. It is highly probable that such tests exist further down in the same file, especially since the `test_intersection` function seems to be cut off.' query='Please provide the rest of the content of the file `sympy/sets/tests/test_sets.py` from line 501 to the end.' extra_requirements='If the file is too large, please prioritize providing any test functions that contain both "ImageSet" or "imageset" and "intersect" or "Intersection".' purpose="This additional context is necessary to find existing test cases that cover the intersection of `ImageSet` with other sets, which is the core of the user's issue."
2025-12-21 01:21:55,142 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the rest of the content of the file `sympy/sets/tests/test_sets.py` from line 501 to the end.
2025-12-21 01:21:55,142 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 01:21:55,143 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 01:21:55,143 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 01:21:55,143 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the rest of the content of the file `sympy/sets/tests/test_sets.py` from line 501 to the end.
Extra requirements: If the file is too large, please prioritize providing any test functions that contain both "ImageSet" or "imageset" and "intersect" or "Intersection".
Purpose: This additional context is necessary to find existing test cases that cover the intersection of `ImageSet` with other sets, which is the core of the user's issue.
2025-12-21 01:22:00,488 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 9999.0, "start_line": 501.0, "relative_path": "sympy/sets/tests/test_sets.py"}'}, '__gemini_function_call_thought_signatures__': {'68f71c48-b8a3-41f6-91b9-167bb08c4d94': 'Cp0OAY89a1/GdmEANUB46HYkLGJa1pJzlG7iB4cHqS3yCuOkaVbn1xZcQFcSHqO8XXf0Rn4ec3mUAQeGPp0F4PgWr2lSeQeD+9uDv2+JbdwyRn+MUaaSZ8LVQ2uNwMHeOqldwu0hsS/DXV2HmkDWImtovV6IoRZbx81n2NefhTa5aZ2a9s37XDZvdT3y7PNUsuNl+g2veaza5ccfvSnMdvk0K/hjsgppMYKgNOSSpl7rfcrVQzGpBiz5hBvTzfUoXC0hjlDRpFFJlLXxPH7OTQnwN+vSnRtoB/jKFS6AzhVcEQ77SBwl6g4tzvqpwTkM1yvbvlQDuB6WJloYzn4DGZ6V9h0M8bcDFCbCjF16kXUuc4uTbKOiDHbOFkSdPj/+yO7aJWhee4eVwYMUYNlhj1EwoafljZgsvzHsRcMkqvn1hlxcJ2Hlj+cemEhBw/nCv5b2ky+BadM5L1HfjI7Y07HotVa0yFDF3/G6e3YsBhpsktUi9ehz8dV9Q3sw/dH6J8r4+1552zUC/O4iQ0iLXLxzhogJ99hlLYxZVx3/rbEfNIDOzY/PYPh+KsGQ+cN23JE6USoEUAtgiZO/EOCVhYYKfoZptPF9GuGDc4WI6BFFUS293VDgZsofDc0c2lflxVEsXlLo/lyOLy4+qDFlqz3aadXcdMPw+VrhudcLKmBKxkDdOtZvyF63fseVE7S7qohA8Y93UhmQ6U6Lhk4v5gYDoEoHXe/jXaGj1C9zLowgLS0/Eo0tCDHtwfEYrFhUb9lwo1gcXZcY5s9e9DZpHnCDxM9LiYy5DogYDH99aLu0PzAfy+CmLilAKrOtytg2L/xf2pCnBFlm7t15LaGj25w2ehRS1LD5PssvlbSnyHLKmETYYX6JmESX5eZgp5ozzOEdXAxi6o1Xl8aNhUQRUbxvuv6UhiM0yWcjd6czni4bESBaJLms9+CHIc8PS1o0b234Yjet5KqVDvQxMlNADr18ByVd5V2/pV4JNSAlLiDRTvd6JgeZzMaSZxNX2PXSpEvmgHfJRWN0NQC8LhlJp/WMRQU85qdC4l2qD7kcpo7a27ozTxDH22+l8NmMxIhcX5VwFb23jDs15Qo5rkVk108uuNw0JlkPJzIQ2apbV2yUb+M7rZLveIJV/UMw/B2vRFc9S2LFoGlH76epwz/Hc222uFob0DbjDRZrHyyccRBYEoyw4MruEXqfXE1O56ePNHKBsc5gR1OJJgWh/kzMRFumSpjDWl0q0Qz/NNLDl9Zmq+Lb34byJzMgBooCI/4CjGoFVru3fnUxmuYtMWGZH8iE+Vl6VzA+4pCDPSWraVXSk/s19mOKXjTJ22u3kj5IC8ZRq/yFeNf/Cgh02zanQ3ED9YFTy5yS538eFCaHIBfjDLJ3qZD6C5LMUZgn2Wrafxwot3QFTfzQIuSp2rXeDFw/0z1LCIi8malKbEw1m/piyLWZxttQYMww8Gxq6CVJgGaEuzW56VUNQUHO/H9xFcVnQTfMseDUDwfU3QoRu9w72swHekBMXeLIP7l20qjd+OBJHqdMFhodJP9RVM5i61Nax9vJWCHTMKgydSanIQb9en/OgHbRJLi9iQguhnjIlSVMVKTppLjFq216WCoE5V9YvuTVtumWIhY/61vzb2N/nnoWbxQDEwP2MEVFqUhZP78+fyI/DhIRS9CzYQRx1BFlpMUqFpD6Dxqw2ZRTK0cHOg3HusjkfMwkzRhvoxVbCAG2yDcfZY0txeumTKP4xKp7aEuulLt0jIu0YTRFLCOZSmDPKCBPIkAFplgU/snyCYxdaCFpK9+n3To6IxCoR7cMMbdaTy07RxWCXgsM0Gc9Qi+rqULjeBZNZoBtXou3k/GPJImAvj5EHOhwerw5vk7VkqveJzv+6Eu4yxEYlhWNrawubO9qcdJAuqL2ZxbOMYn3ZfKex0gYTJ9ts0KYOktZ2xZugmyp3dDtCOI+dJT6l2jgaZyNDj9X7UL9H/2mdIyJPhqTw3wPHENG11e/EiRC+WT5KfzZNy8V4Oue5R2/E4VO1SS6Cjys3xPFhpKWbFD7z9pWxOe6h9vg0hbukJ0eYZrCT/AvysLCGqif+QXJPmgaLySNAQSvvpXFctAovRVxJIVcDLujzATCeY4pxuDRS5Wu16qJS7IA0/EEEkAV2sU33hyfW9E1X/8Pg1nEunsAxI2v4WklxkHWnmunl2OzZWTozyQ/deZsgPaN0z76Fsmk3aazVM1nEW/6GlaI2ExnpBCWkOQec4gF8y8RXVB3PSEo9Tp3PoHPsexYQhqQArfuRcZ1ojNFbRA4dXH7fc3PywuM57mjHVerzubmglmelAK3da2FYxLOXMoWNZLlVd3j9im9ZzHHVxOkMZT2jbgRF5Mqfomw8qiivLK3ZC8Kqtu2NHtLzIuqbSscne2+eU9cNpoheF1APwBZpAWg'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2172, 'candidates_token_count': 31, 'total_token_count': 2735, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2172}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 31}], 'thoughts_token_count': 532, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.4495845917732484, 'model_name': 'gemini-2.5-pro'} id='run--0b2fe7c2-1480-4529-88e8-1dbe4f8864ed-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 9999.0, 'start_line': 501.0, 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': '68f71c48-b8a3-41f6-91b9-167bb08c4d94', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2172, 'output_tokens': 31, 'total_tokens': 2735, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 532}}
2025-12-21 01:22:05,584 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the rest of the content of the file `sympy/sets/tests/test_sets.py` from line 501 to the end, as you requested. I have also examined the content for test functions that involve both "ImageSet" or "imageset" and "intersect" or "Intersection". I found a relevant test function named `test_image_Intersection` which you might find useful.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 24761, 'candidates_token_count': 87, 'total_token_count': 25205, 'cached_content_token_count': 1964, 'prompt_tokens_details': [{'modality': 1, 'token_count': 25293}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1964}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 87}], 'thoughts_token_count': 357}, 'finish_reason': 'STOP', 'avg_logprobs': -0.49085542525368175, 'model_name': 'gemini-2.5-pro'} id='run--e174c3a7-a0dd-450d-988c-bd0378f6ea7d-0' usage_metadata={'input_tokens': 24761, 'output_tokens': 87, 'total_tokens': 25205, 'input_token_details': {'cache_read': 1964}, 'output_token_details': {'reasoning': 357}}
2025-12-21 01:22:05,586 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the rest of the content of the file `sympy/sets/tests/test_sets.py` from line 501 to the end.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If the file is too large, please prioritize providing any test functions that contain both "ImageSet" or "imageset" and "intersect" or "Intersection".
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
This additional context is necessary to find existing test cases that cover the intersection of `ImageSet` with other sets, which is the core of the user's issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/sets/tests/test_sets.py
Line number range: 501 - 9999
Content:
501.     # Products
502.     line = Interval(0, 5)
503.     i = Intersection(line**2, line**3, evaluate=False)
504.     assert (2, 2) not in i
505.     assert (2, 2, 2) not in i
506.     raises(TypeError, lambda: list(i))
507. 
508.     a = Intersection(Intersection(S.Integers, S.Naturals, evaluate=False), S.Reals, evaluate=False)
509.     assert a._argset == frozenset([Intersection(S.Naturals, S.Integers, evaluate=False), S.Reals])
510. 
511.     assert Intersection(S.Complexes, FiniteSet(S.ComplexInfinity)) == S.EmptySet
512. 
513.     # issue 12178
514.     assert Intersection() == S.UniversalSet
515. 
516.     # issue 16987
517.     assert Intersection({1}, {1}, {x}) == Intersection({1}, {x})
518. 
519. 
520. def test_issue_9623():
521.     n = Symbol('n')
522. 
523.     a = S.Reals
524.     b = Interval(0, oo)
525.     c = FiniteSet(n)
526. 
527.     assert Intersection(a, b, c) == Intersection(b, c)
528.     assert Intersection(Interval(1, 2), Interval(3, 4), FiniteSet(n)) == EmptySet
529. 
530. 
531. def test_is_disjoint():
532.     assert Interval(0, 2).is_disjoint(Interval(1, 2)) == False
533.     assert Interval(0, 2).is_disjoint(Interval(3, 4)) == True
534. 
535. 
536. def test_ProductSet__len__():
537.     A = FiniteSet(1, 2)
538.     B = FiniteSet(1, 2, 3)
539.     assert ProductSet(A).__len__() == 2
540.     assert ProductSet(A).__len__() is not S(2)
541.     assert ProductSet(A, B).__len__() == 6
542.     assert ProductSet(A, B).__len__() is not S(6)
543. 
544. 
545. def test_ProductSet():
546.     # ProductSet is always a set of Tuples
547.     assert ProductSet(S.Reals) == S.Reals ** 1
548.     assert ProductSet(S.Reals, S.Reals) == S.Reals ** 2
549.     assert ProductSet(S.Reals, S.Reals, S.Reals) == S.Reals ** 3
550. 
551.     assert ProductSet(S.Reals) != S.Reals
552.     assert ProductSet(S.Reals, S.Reals) == S.Reals * S.Reals
553.     assert ProductSet(S.Reals, S.Reals, S.Reals) != S.Reals * S.Reals * S.Reals
554.     assert ProductSet(S.Reals, S.Reals, S.Reals) == (S.Reals * S.Reals * S.Reals).flatten()
555. 
556.     assert 1 not in ProductSet(S.Reals)
557.     assert (1,) in ProductSet(S.Reals)
558. 
559.     assert 1 not in ProductSet(S.Reals, S.Reals)
560.     assert (1, 2) in ProductSet(S.Reals, S.Reals)
561.     assert (1, I) not in ProductSet(S.Reals, S.Reals)
562. 
563.     assert (1, 2, 3) in ProductSet(S.Reals, S.Reals, S.Reals)
564.     assert (1, 2, 3) in S.Reals ** 3
565.     assert (1, 2, 3) not in S.Reals * S.Reals * S.Reals
566.     assert ((1, 2), 3) in S.Reals * S.Reals * S.Reals
567.     assert (1, (2, 3)) not in S.Reals * S.Reals * S.Reals
568.     assert (1, (2, 3)) in S.Reals * (S.Reals * S.Reals)
569. 
570.     assert ProductSet() == FiniteSet(())
571.     assert ProductSet(S.Reals, S.EmptySet) == S.EmptySet
572. 
573.     # See GH-17458
574. 
575.     for ni in range(5):
576.         Rn = ProductSet(*(S.Reals,) * ni)
577.         assert (1,) * ni in Rn
578.         assert 1 not in Rn
579. 
580.     assert (S.Reals * S.Reals) * S.Reals != S.Reals * (S.Reals * S.Reals)
581. 
582.     S1 = S.Reals
583.     S2 = S.Integers
584.     x1 = pi
585.     x2 = 3
586.     assert x1 in S1
587.     assert x2 in S2
588.     assert (x1, x2) in S1 * S2
589.     S3 = S1 * S2
590.     x3 = (x1, x2)
591.     assert x3 in S3
592.     assert (x3, x3) in S3 * S3
593.     assert x3 + x3 not in S3 * S3
594. 
595.     raises(ValueError, lambda: S.Reals**-1)
596.     with warns_deprecated_sympy():
597.         ProductSet(FiniteSet(s) for s in range(2))
598.     raises(TypeError, lambda: ProductSet(None))
599. 
600.     S1 = FiniteSet(1, 2)
601.     S2 = FiniteSet(3, 4)
602.     S3 = ProductSet(S1, S2)
603.     assert (S3.as_relational(x, y)
604.             == And(S1.as_relational(x), S2.as_relational(y))
605.             == And(Or(Eq(x, 1), Eq(x, 2)), Or(Eq(y, 3), Eq(y, 4))))
606.     raises(ValueError, lambda: S3.as_relational(x))
607.     raises(ValueError, lambda: S3.as_relational(x, 1))
608.     raises(ValueError, lambda: ProductSet(Interval(0, 1)).as_relational(x, y))
609. 
610.     Z2 = ProductSet(S.Integers, S.Integers)
611.     assert Z2.contains((1, 2)) is S.true
612.     assert Z2.contains((1,)) is S.false
613.     assert Z2.contains(x) == Contains(x, Z2, evaluate=False)
614.     assert Z2.contains(x).subs(x, 1) is S.false
615.     assert Z2.contains((x, 1)).subs(x, 2) is S.true
616.     assert Z2.contains((x, y)) == Contains((x, y), Z2, evaluate=False)
617.     assert unchanged(Contains, (x, y), Z2)
618.     assert Contains((1, 2), Z2) is S.true
619. 
620. 
621. def test_ProductSet_of_single_arg_is_not_arg():
622.     assert unchanged(ProductSet, Interval(0, 1))
623.     assert unchanged(ProductSet, ProductSet(Interval(0, 1)))
624. 
625. 
626. def test_ProductSet_is_empty():
627.     assert ProductSet(S.Integers, S.Reals).is_empty == False
628.     assert ProductSet(Interval(x, 1), S.Reals).is_empty == None
629. 
630. 
631. def test_interval_subs():
632.     a = Symbol('a', real=True)
633. 
634.     assert Interval(0, a).subs(a, 2) == Interval(0, 2)
635.     assert Interval(a, 0).subs(a, 2) == S.EmptySet
636. 
637. 
638. def test_interval_to_mpi():
639.     assert Interval(0, 1).to_mpi() == mpi(0, 1)
640.     assert Interval(0, 1, True, False).to_mpi() == mpi(0, 1)
641.     assert type(Interval(0, 1).to_mpi()) == type(mpi(0, 1))
642. 
643. 
644. def test_set_evalf():
645.     assert Interval(S(11)/64, S.Half).evalf() == Interval(
646.         Float('0.171875'), Float('0.5'))
647.     assert Interval(x, S.Half, right_open=True).evalf() == Interval(
648.         x, Float('0.5'), right_open=True)
649.     assert Interval(-oo, S.Half).evalf() == Interval(-oo, Float('0.5'))
650.     assert FiniteSet(2, x).evalf() == FiniteSet(Float('2.0'), x)
651. 
652. 
653. def test_measure():
654.     a = Symbol('a', real=True)
655. 
656.     assert Interval(1, 3).measure == 2
657.     assert Interval(0, a).measure == a
658.     assert Interval(1, a).measure == a - 1
659. 
660.     assert Union(Interval(1, 2), Interval(3, 4)).measure == 2
661.     assert Union(Interval(1, 2), Interval(3, 4), FiniteSet(5, 6, 7)).measure \
662.         == 2
663. 
664.     assert FiniteSet(1, 2, oo, a, -oo, -5).measure == 0
665. 
666.     assert S.EmptySet.measure == 0
667. 
668.     square = Interval(0, 10) * Interval(0, 10)
669.     offsetsquare = Interval(5, 15) * Interval(5, 15)
670.     band = Interval(-oo, oo) * Interval(2, 4)
671. 
672.     assert square.measure == offsetsquare.measure == 100
673.     assert (square + offsetsquare).measure == 175  # there is some overlap
674.     assert (square - offsetsquare).measure == 75
675.     assert (square * FiniteSet(1, 2, 3)).measure == 0
676.     assert (square.intersect(band)).measure == 20
677.     assert (square + band).measure is oo
678.     assert (band * FiniteSet(1, 2, 3)).measure is nan
679. 
680. 
681. def test_is_subset():
682.     assert Interval(0, 1).is_subset(Interval(0, 2)) is True
683.     assert Interval(0, 3).is_subset(Interval(0, 2)) is False
684.     assert Interval(0, 1).is_subset(FiniteSet(0, 1)) is False
685. 
686.     assert FiniteSet(1, 2).is_subset(FiniteSet(1, 2, 3, 4))
687.     assert FiniteSet(4, 5).is_subset(FiniteSet(1, 2, 3, 4)) is False
688.     assert FiniteSet(1).is_subset(Interval(0, 2))
689.     assert FiniteSet(1, 2).is_subset(Interval(0, 2, True, True)) is False
690.     assert (Interval(1, 2) + FiniteSet(3)).is_subset(
691.         Interval(0, 2, False, True) + FiniteSet(2, 3))
692. 
693.     assert Interval(3, 4).is_subset(Union(Interval(0, 1), Interval(2, 5))) is True
694.     assert Interval(3, 6).is_subset(Union(Interval(0, 1), Interval(2, 5))) is False
695. 
696.     assert FiniteSet(1, 2, 3, 4).is_subset(Interval(0, 5)) is True
697.     assert S.EmptySet.is_subset(FiniteSet(1, 2, 3)) is True
698. 
699.     assert Interval(0, 1).is_subset(S.EmptySet) is False
700.     assert S.EmptySet.is_subset(S.EmptySet) is True
701. 
702.     raises(ValueError, lambda: S.EmptySet.is_subset(1))
703. 
704.     # tests for the issubset alias
705.     assert FiniteSet(1, 2, 3, 4).issubset(Interval(0, 5)) is True
706.     assert S.EmptySet.issubset(FiniteSet(1, 2, 3)) is True
707. 
708.     assert S.Naturals.is_subset(S.Integers)
709.     assert S.Naturals0.is_subset(S.Integers)
710. 
711.     assert FiniteSet(x).is_subset(FiniteSet(y)) is None
712.     assert FiniteSet(x).is_subset(FiniteSet(y).subs(y, x)) is True
713.     assert FiniteSet(x).is_subset(FiniteSet(y).subs(y, x+1)) is False
714. 
715.     assert Interval(0, 1).is_subset(Interval(0, 1, left_open=True)) is False
716.     assert Interval(-2, 3).is_subset(Union(Interval(-oo, -2), Interval(3, oo))) is False
717. 
718.     n = Symbol('n', integer=True)
719.     assert Range(-3, 4, 1).is_subset(FiniteSet(-10, 10)) is False
720.     assert Range(S(10)**100).is_subset(FiniteSet(0, 1, 2)) is False
721.     assert Range(6, 0, -2).is_subset(FiniteSet(2, 4, 6)) is True
722.     assert Range(1, oo).is_subset(FiniteSet(1, 2)) is False
723.     assert Range(-oo, 1).is_subset(FiniteSet(1)) is False
724.     assert Range(3).is_subset(FiniteSet(0, 1, n)) is None
725.     assert Range(n, n + 2).is_subset(FiniteSet(n, n + 1)) is True
726.     assert Range(5).is_subset(Interval(0, 4, right_open=True)) is False
727.     #issue 19513
728.     assert imageset(Lambda(n, 1/n), S.Integers).is_subset(S.Reals) is None
729. 
730. def test_is_proper_subset():
731.     assert Interval(0, 1).is_proper_subset(Interval(0, 2)) is True
732.     assert Interval(0, 3).is_proper_subset(Interval(0, 2)) is False
733.     assert S.EmptySet.is_proper_subset(FiniteSet(1, 2, 3)) is True
734. 
735.     raises(ValueError, lambda: Interval(0, 1).is_proper_subset(0))
736. 
737. 
738. def test_is_superset():
739.     assert Interval(0, 1).is_superset(Interval(0, 2)) == False
740.     assert Interval(0, 3).is_superset(Interval(0, 2))
741. 
742.     assert FiniteSet(1, 2).is_superset(FiniteSet(1, 2, 3, 4)) == False
743.     assert FiniteSet(4, 5).is_superset(FiniteSet(1, 2, 3, 4)) == False
744.     assert FiniteSet(1).is_superset(Interval(0, 2)) == False
745.     assert FiniteSet(1, 2).is_superset(Interval(0, 2, True, True)) == False
746.     assert (Interval(1, 2) + FiniteSet(3)).is_superset(
747.         Interval(0, 2, False, True) + FiniteSet(2, 3)) == False
748. 
749.     assert Interval(3, 4).is_superset(Union(Interval(0, 1), Interval(2, 5))) == False
750. 
751.     assert FiniteSet(1, 2, 3, 4).is_superset(Interval(0, 5)) == False
752.     assert S.EmptySet.is_superset(FiniteSet(1, 2, 3)) == False
753. 
754.     assert Interval(0, 1).is_superset(S.EmptySet) == True
755.     assert S.EmptySet.is_superset(S.EmptySet) == True
756. 
757.     raises(ValueError, lambda: S.EmptySet.is_superset(1))
758. 
759.     # tests for the issuperset alias
760.     assert Interval(0, 1).issuperset(S.EmptySet) == True
761.     assert S.EmptySet.issuperset(S.EmptySet) == True
762. 
763. 
764. def test_is_proper_superset():
765.     assert Interval(0, 1).is_proper_superset(Interval(0, 2)) is False
766.     assert Interval(0, 3).is_proper_superset(Interval(0, 2)) is True
767.     assert FiniteSet(1, 2, 3).is_proper_superset(S.EmptySet) is True
768. 
769.     raises(ValueError, lambda: Interval(0, 1).is_proper_superset(0))
770. 
771. 
772. def test_contains():
773.     assert Interval(0, 2).contains(1) is S.true
774.     assert Interval(0, 2).contains(3) is S.false
775.     assert Interval(0, 2, True, False).contains(0) is S.false
776.     assert Interval(0, 2, True, False).contains(2) is S.true
777.     assert Interval(0, 2, False, True).contains(0) is S.true
778.     assert Interval(0, 2, False, True).contains(2) is S.false
779.     assert Interval(0, 2, True, True).contains(0) is S.false
780.     assert Interval(0, 2, True, True).contains(2) is S.false
781. 
782.     assert (Interval(0, 2) in Interval(0, 2)) is False
783. 
784.     assert FiniteSet(1, 2, 3).contains(2) is S.true
785.     assert FiniteSet(1, 2, Symbol('x')).contains(Symbol('x')) is S.true
786. 
787.     assert FiniteSet(y)._contains(x) is None
788.     raises(TypeError, lambda: x in FiniteSet(y))
789.     assert FiniteSet({x, y})._contains({x}) is None
790.     assert FiniteSet({x, y}).subs(y, x)._contains({x}) is True
791.     assert FiniteSet({x, y}).subs(y, x+1)._contains({x}) is False
792. 
793.     # issue 8197
794.     from sympy.abc import a, b
795.     assert isinstance(FiniteSet(b).contains(-a), Contains)
796.     assert isinstance(FiniteSet(b).contains(a), Contains)
797.     assert isinstance(FiniteSet(a).contains(1), Contains)
798.     raises(TypeError, lambda: 1 in FiniteSet(a))
799. 
800.     # issue 8209
801.     rad1 = Pow(Pow(2, Rational(1, 3)) - 1, Rational(1, 3))
802.     rad2 = Pow(Rational(1, 9), Rational(1, 3)) - Pow(Rational(2, 9), Rational(1, 3)) + Pow(Rational(4, 9), Rational(1, 3))
803.     s1 = FiniteSet(rad1)
804.     s2 = FiniteSet(rad2)
805.     assert s1 - s2 == S.EmptySet
806. 
807.     items = [1, 2, S.Infinity, S('ham'), -1.1]
808.     fset = FiniteSet(*items)
809.     assert all(item in fset for item in items)
810.     assert all(fset.contains(item) is S.true for item in items)
811. 
812.     assert Union(Interval(0, 1), Interval(2, 5)).contains(3) is S.true
813.     assert Union(Interval(0, 1), Interval(2, 5)).contains(6) is S.false
814.     assert Union(Interval(0, 1), FiniteSet(2, 5)).contains(3) is S.false
815. 
816.     assert S.EmptySet.contains(1) is S.false
817.     assert FiniteSet(rootof(x**3 + x - 1, 0)).contains(S.Infinity) is S.false
818. 
819.     assert rootof(x**5 + x**3 + 1, 0) in S.Reals
820.     assert not rootof(x**5 + x**3 + 1, 1) in S.Reals
821. 
822.     # non-bool results
823.     assert Union(Interval(1, 2), Interval(3, 4)).contains(x) == \
824.         Or(And(S.One <= x, x <= 2), And(S(3) <= x, x <= 4))
825.     assert Intersection(Interval(1, x), Interval(2, 3)).contains(y) == \
826.         And(y <= 3, y <= x, S.One <= y, S(2) <= y)
827. 
828.     assert (S.Complexes).contains(S.ComplexInfinity) == S.false
829. 
830. 
831. def test_interval_symbolic():
832.     x = Symbol('x')
833.     e = Interval(0, 1)
834.     assert e.contains(x) == And(S.Zero <= x, x <= 1)
835.     raises(TypeError, lambda: x in e)
836.     e = Interval(0, 1, True, True)
837.     assert e.contains(x) == And(S.Zero < x, x < 1)
838.     c = Symbol('c', real=False)
839.     assert Interval(x, x + 1).contains(c) == False
840.     e = Symbol('e', extended_real=True)
841.     assert Interval(-oo, oo).contains(e) == And(
842.         S.NegativeInfinity < e, e < S.Infinity)
843. 
844. 
845. def test_union_contains():
846.     x = Symbol('x')
847.     i1 = Interval(0, 1)
848.     i2 = Interval(2, 3)
849.     i3 = Union(i1, i2)
850.     assert i3.as_relational(x) == Or(And(S.Zero <= x, x <= 1), And(S(2) <= x, x <= 3))
851.     raises(TypeError, lambda: x in i3)
852.     e = i3.contains(x)
853.     assert e == i3.as_relational(x)
854.     assert e.subs(x, -0.5) is false
855.     assert e.subs(x, 0.5) is true
856.     assert e.subs(x, 1.5) is false
857.     assert e.subs(x, 2.5) is true
858.     assert e.subs(x, 3.5) is false
859. 
860.     U = Interval(0, 2, True, True) + Interval(10, oo) + FiniteSet(-1, 2, 5, 6)
861.     assert all(el not in U for el in [0, 4, -oo])
862.     assert all(el in U for el in [2, 5, 10])
863. 
864. 
865. def test_is_number():
866.     assert Interval(0, 1).is_number is False
867.     assert Set().is_number is False
868. 
869. 
870. def test_Interval_is_left_unbounded():
871.     assert Interval(3, 4).is_left_unbounded is False
872.     assert Interval(-oo, 3).is_left_unbounded is True
873.     assert Interval(Float("-inf"), 3).is_left_unbounded is True
874. 
875. 
876. def test_Interval_is_right_unbounded():
877.     assert Interval(3, 4).is_right_unbounded is False
878.     assert Interval(3, oo).is_right_unbounded is True
879.     assert Interval(3, Float("+inf")).is_right_unbounded is True
880. 
881. 
882. def test_Interval_as_relational():
883.     x = Symbol('x')
884. 
885.     assert Interval(-1, 2, False, False).as_relational(x) == \
886.         And(Le(-1, x), Le(x, 2))
887.     assert Interval(-1, 2, True, False).as_relational(x) == \
888.         And(Lt(-1, x), Le(x, 2))
889.     assert Interval(-1, 2, False, True).as_relational(x) == \
890.         And(Le(-1, x), Lt(x, 2))
891.     assert Interval(-1, 2, True, True).as_relational(x) == \
892.         And(Lt(-1, x), Lt(x, 2))
893. 
894.     assert Interval(-oo, 2, right_open=False).as_relational(x) == And(Lt(-oo, x), Le(x, 2))
895.     assert Interval(-oo, 2, right_open=True).as_relational(x) == And(Lt(-oo, x), Lt(x, 2))
896. 
897.     assert Interval(-2, oo, left_open=False).as_relational(x) == And(Le(-2, x), Lt(x, oo))
898.     assert Interval(-2, oo, left_open=True).as_relational(x) == And(Lt(-2, x), Lt(x, oo))
899. 
900.     assert Interval(-oo, oo).as_relational(x) == And(Lt(-oo, x), Lt(x, oo))
901.     x = Symbol('x', real=True)
902.     y = Symbol('y', real=True)
903.     assert Interval(x, y).as_relational(x) == (x <= y)
904.     assert Interval(y, x).as_relational(x) == (y <= x)
905. 
906. 
907. def test_Finite_as_relational():
908.     x = Symbol('x')
909.     y = Symbol('y')
910. 
911.     assert FiniteSet(1, 2).as_relational(x) == Or(Eq(x, 1), Eq(x, 2))
912.     assert FiniteSet(y, -5).as_relational(x) == Or(Eq(x, y), Eq(x, -5))
913. 
914. 
915. def test_Union_as_relational():
916.     x = Symbol('x')
917.     assert (Interval(0, 1) + FiniteSet(2)).as_relational(x) == \
918.         Or(And(Le(0, x), Le(x, 1)), Eq(x, 2))
919.     assert (Interval(0, 1, True, True) + FiniteSet(1)).as_relational(x) == \
920.         And(Lt(0, x), Le(x, 1))
921.     assert Or(x < 0, x > 0).as_set().as_relational(x) == \
922.         And((x > -oo), (x < oo), Ne(x, 0))
923.     assert (Interval.Ropen(1, 3) + Interval.Lopen(3, 5)
924.         ).as_relational(x) == And((x > 1), (x < 5), Ne(x, 3))
925. 
926. 
927. def test_Intersection_as_relational():
928.     x = Symbol('x')
929.     assert (Intersection(Interval(0, 1), FiniteSet(2),
930.             evaluate=False).as_relational(x)
931.             == And(And(Le(0, x), Le(x, 1)), Eq(x, 2)))
932. 
933. 
934. def test_Complement_as_relational():
935.     x = Symbol('x')
936.     expr = Complement(Interval(0, 1), FiniteSet(2), evaluate=False)
937.     assert expr.as_relational(x) == \
938.         And(Le(0, x), Le(x, 1), Ne(x, 2))
939. 
940. 
941. @XFAIL
942. def test_Complement_as_relational_fail():
943.     x = Symbol('x')
944.     expr = Complement(Interval(0, 1), FiniteSet(2), evaluate=False)
945.     # XXX This example fails because 0 <= x changes to x >= 0
946.     # during the evaluation.
947.     assert expr.as_relational(x) == \
948.             (0 <= x) & (x <= 1) & Ne(x, 2)
949. 
950. 
951. def test_SymmetricDifference_as_relational():
952.     x = Symbol('x')
953.     expr = SymmetricDifference(Interval(0, 1), FiniteSet(2), evaluate=False)
954.     assert expr.as_relational(x) == Xor(Eq(x, 2), Le(0, x) & Le(x, 1))
955. 
956. 
957. def test_EmptySet():
958.     assert S.EmptySet.as_relational(Symbol('x')) is S.false
959.     assert S.EmptySet.intersect(S.UniversalSet) == S.EmptySet
960.     assert S.EmptySet.boundary == S.EmptySet
961. 
962. 
963. def test_finite_basic():
964.     x = Symbol('x')
965.     A = FiniteSet(1, 2, 3)
966.     B = FiniteSet(3, 4, 5)
967.     AorB = Union(A, B)
968.     AandB = A.intersect(B)
969.     assert A.is_subset(AorB) and B.is_subset(AorB)
970.     assert AandB.is_subset(A)
971.     assert AandB == FiniteSet(3)
972. 
973.     assert A.inf == 1 and A.sup == 3
974.     assert AorB.inf == 1 and AorB.sup == 5
975.     assert FiniteSet(x, 1, 5).sup == Max(x, 5)
976.     assert FiniteSet(x, 1, 5).inf == Min(x, 1)
977. 
978.     # issue 7335
979.     assert FiniteSet(S.EmptySet) != S.EmptySet
980.     assert FiniteSet(FiniteSet(1, 2, 3)) != FiniteSet(1, 2, 3)
981.     assert FiniteSet((1, 2, 3)) != FiniteSet(1, 2, 3)
982. 
983.     # Ensure a variety of types can exist in a FiniteSet
984.     assert FiniteSet((1, 2), Float, A, -5, x, 'eggs', x**2, Interval)
985. 
986.     assert (A > B) is False
987.     assert (A >= B) is False
988.     assert (A < B) is False
989.     assert (A <= B) is False
990.     assert AorB > A and AorB > B
991.     assert AorB >= A and AorB >= B
992.     assert A >= A and A <= A
993.     assert A >= AandB and B >= AandB
994.     assert A > AandB and B > AandB
995. 
996.     assert FiniteSet(1.0) == FiniteSet(1)
997. 
998. 
999. def test_product_basic():
1000.     H, T = 'H', 'T'
1001.     unit_line = Interval(0, 1)
1002.     d6 = FiniteSet(1, 2, 3, 4, 5, 6)
1003.     d4 = FiniteSet(1, 2, 3, 4)
1004.     coin = FiniteSet(H, T)
1005. 
1006.     square = unit_line * unit_line
1007. 
1008.     assert (0, 0) in square
1009.     assert 0 not in square
1010.     assert (H, T) in coin ** 2
1011.     assert (.5, .5, .5) in (square * unit_line).flatten()
1012.     assert ((.5, .5), .5) in square * unit_line
1013.     assert (H, 3, 3) in (coin * d6 * d6).flatten()
1014.     assert ((H, 3), 3) in coin * d6 * d6
1015.     HH, TT = sympify(H), sympify(T)
1016.     assert set(coin**2) == {(HH, HH), (HH, TT), (TT, HH), (TT, TT)}
1017. 
1018.     assert (d4*d4).is_subset(d6*d6)
1019. 
1020.     assert square.complement(Interval(-oo, oo)*Interval(-oo, oo)) == Union(
1021.         (Interval(-oo, 0, True, True) +
1022.          Interval(1, oo, True, True))*Interval(-oo, oo),
1023.          Interval(-oo, oo)*(Interval(-oo, 0, True, True) +
1024.                   Interval(1, oo, True, True)))
1025. 
1026.     assert (Interval(-5, 5)**3).is_subset(Interval(-10, 10)**3)
1027.     assert not (Interval(-10, 10)**3).is_subset(Interval(-5, 5)**3)
1028.     assert not (Interval(-5, 5)**2).is_subset(Interval(-10, 10)**3)
1029. 
1030.     assert (Interval(.2, .5)*FiniteSet(.5)).is_subset(square)  # segment in square
1031. 
1032.     assert len(coin*coin*coin) == 8
1033.     assert len(S.EmptySet*S.EmptySet) == 0
1034.     assert len(S.EmptySet*coin) == 0
1035.     raises(TypeError, lambda: len(coin*Interval(0, 2)))
1036. 
1037. 
1038. def test_real():
1039.     x = Symbol('x', real=True, finite=True)
1040. 
1041.     I = Interval(0, 5)
1042.     J = Interval(10, 20)
1043.     A = FiniteSet(1, 2, 30, x, S.Pi)
1044.     B = FiniteSet(-4, 0)
1045.     C = FiniteSet(100)
1046.     D = FiniteSet('Ham', 'Eggs')
1047. 
1048.     assert all(s.is_subset(S.Reals) for s in [I, J, A, B, C])
1049.     assert not D.is_subset(S.Reals)
1050.     assert all((a + b).is_subset(S.Reals) for a in [I, J, A, B, C] for b in [I, J, A, B, C])
1051.     assert not any((a + D).is_subset(S.Reals) for a in [I, J, A, B, C, D])
1052. 
1053.     assert not (I + A + D).is_subset(S.Reals)
1054. 
1055. 
1056. def test_supinf():
1057.     x = Symbol('x', real=True)
1058.     y = Symbol('y', real=True)
1059. 
1060.     assert (Interval(0, 1) + FiniteSet(2)).sup == 2
1061.     assert (Interval(0, 1) + FiniteSet(2)).inf == 0
1062.     assert (Interval(0, 1) + FiniteSet(x)).sup == Max(1, x)
1063.     assert (Interval(0, 1) + FiniteSet(x)).inf == Min(0, x)
1064.     assert FiniteSet(5, 1, x).sup == Max(5, x)
1065.     assert FiniteSet(5, 1, x).inf == Min(1, x)
1066.     assert FiniteSet(5, 1, x, y).sup == Max(5, x, y)
1067.     assert FiniteSet(5, 1, x, y).inf == Min(1, x, y)
1068.     assert FiniteSet(5, 1, x, y, S.Infinity, S.NegativeInfinity).sup == \
1069.         S.Infinity
1070.     assert FiniteSet(5, 1, x, y, S.Infinity, S.NegativeInfinity).inf == \
1071.         S.NegativeInfinity
1072.     assert FiniteSet('Ham', 'Eggs').sup == Max('Ham', 'Eggs')
1073. 
1074. 
1075. def test_universalset():
1076.     U = S.UniversalSet
1077.     x = Symbol('x')
1078.     assert U.as_relational(x) is S.true
1079.     assert U.union(Interval(2, 4)) == U
1080. 
1081.     assert U.intersect(Interval(2, 4)) == Interval(2, 4)
1082.     assert U.measure is S.Infinity
1083.     assert U.boundary == S.EmptySet
1084.     assert U.contains(0) is S.true
1085. 
1086. 
1087. def test_Union_of_ProductSets_shares():
1088.     line = Interval(0, 2)
1089.     points = FiniteSet(0, 1, 2)
1090.     assert Union(line * line, line * points) == line * line
1091. 
1092. 
1093. def test_Interval_free_symbols():
1094.     # issue 6211
1095.     assert Interval(0, 1).free_symbols == set()
1096.     x = Symbol('x', real=True)
1097.     assert Interval(0, x).free_symbols == {x}
1098. 
1099. 
1100. def test_image_interval():
1101.     from sympy.core.numbers import Rational
1102.     x = Symbol('x', real=True)
1103.     a = Symbol('a', real=True)
1104.     assert imageset(x, 2*x, Interval(-2, 1)) == Interval(-4, 2)
1105.     assert imageset(x, 2*x, Interval(-2, 1, True, False)) == \
1106.         Interval(-4, 2, True, False)
1107.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1108.         Interval(0, 4, False, True)
1109.     assert imageset(x, x**2, Interval(-2, 1)) == Interval(0, 4)
1110.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1111.         Interval(0, 4, False, True)
1112.     assert imageset(x, x**2, Interval(-2, 1, True, True)) == \
1113.         Interval(0, 4, False, True)
1114.     assert imageset(x, (x - 2)**2, Interval(1, 3)) == Interval(0, 1)
1115.     assert imageset(x, 3*x**4 - 26*x**3 + 78*x**2 - 90*x, Interval(0, 4)) == \
1116.         Interval(-35, 0)  # Multiple Maxima
1117.     assert imageset(x, x + 1/x, Interval(-oo, oo)) == Interval(-oo, -2) \
1118.         + Interval(2, oo)  # Single Infinite discontinuity
1119.     assert imageset(x, 1/x + 1/(x-1)**2, Interval(0, 2, True, False)) == \
1120.         Interval(Rational(3, 2), oo, False)  # Multiple Infinite discontinuities
1121. 
1122.     # Test for Python lambda
1123.     assert imageset(lambda x: 2*x, Interval(-2, 1)) == Interval(-4, 2)
1124. 
1125.     assert imageset(Lambda(x, a*x), Interval(0, 1)) == \
1126.             ImageSet(Lambda(x, a*x), Interval(0, 1))
1127. 
1128.     assert imageset(Lambda(x, sin(cos(x))), Interval(0, 1)) == \
1129.             ImageSet(Lambda(x, sin(cos(x))), Interval(0, 1))
1130. 
1131. 
1132. def test_image_piecewise():
1133.     f = Piecewise((x, x <= -1), (1/x**2, x <= 5), (x**3, True))
1134.     f1 = Piecewise((0, x <= 1), (1, x <= 2), (2, True))
1135.     assert imageset(x, f, Interval(-5, 5)) == Union(Interval(-5, -1), Interval(Rational(1, 25), oo))
1136.     assert imageset(x, f1, Interval(1, 2)) == FiniteSet(0, 1)
1137. 
1138. 
1139. @XFAIL  # See: https://github.com/sympy/sympy/pull/2723#discussion_r8659826
1140. def test_image_Intersection():
1141.     x = Symbol('x', real=True)
1142.     y = Symbol('y', real=True)
1143.     assert imageset(x, x**2, Interval(-2, 0).intersect(Interval(x, y))) == \
1144.            Interval(0, 4).intersect(Interval(Min(x**2, y**2), Max(x**2, y**2)))
1145. 
1146. 
1147. def test_image_FiniteSet():
1148.     x = Symbol('x', real=True)
1149.     assert imageset(x, 2*x, FiniteSet(1, 2, 3)) == FiniteSet(2, 4, 6)
1150. 
1151. 
1152. def test_image_Union():
1153.     x = Symbol('x', real=True)
1154.     assert imageset(x, x**2, Interval(-2, 0) + FiniteSet(1, 2, 3)) == \
1155.             (Interval(0, 4) + FiniteSet(9))
1156. 
1157. 
1158. def test_image_EmptySet():
1159.     x = Symbol('x', real=True)
1160.     assert imageset(x, 2*x, S.EmptySet) == S.EmptySet
1161. 
1162. 
1163. def test_issue_5724_7680():
1164.     assert I not in S.Reals  # issue 7680
1165.     assert Interval(-oo, oo).contains(I) is S.false
1166. 
1167. 
1168. def test_boundary():
1169.     assert FiniteSet(1).boundary == FiniteSet(1)
1170.     assert all(Interval(0, 1, left_open, right_open).boundary == FiniteSet(0, 1)
1171.             for left_open in (true, false) for right_open in (true, false))
1172. 
1173. 
1174. def test_boundary_Union():
1175.     assert (Interval(0, 1) + Interval(2, 3)).boundary == FiniteSet(0, 1, 2, 3)
1176.     assert ((Interval(0, 1, False, True)
1177.            + Interval(1, 2, True, False)).boundary == FiniteSet(0, 1, 2))
1178. 
1179.     assert (Interval(0, 1) + FiniteSet(2)).boundary == FiniteSet(0, 1, 2)
1180.     assert Union(Interval(0, 10), Interval(5, 15), evaluate=False).boundary \
1181.             == FiniteSet(0, 15)
1182. 
1183.     assert Union(Interval(0, 10), Interval(0, 1), evaluate=False).boundary \
1184.             == FiniteSet(0, 10)
1185.     assert Union(Interval(0, 10, True, True),
1186.                  Interval(10, 15, True, True), evaluate=False).boundary \
1187.             == FiniteSet(0, 10, 15)
1188. 
1189. 
1190. @XFAIL
1191. def test_union_boundary_of_joining_sets():
1192.     """ Testing the boundary of unions is a hard problem """
1193.     assert Union(Interval(0, 10), Interval(10, 15), evaluate=False).boundary \
1194.             == FiniteSet(0, 15)
1195. 
1196. 
1197. def test_boundary_ProductSet():
1198.     open_square = Interval(0, 1, True, True) ** 2
1199.     assert open_square.boundary == (FiniteSet(0, 1) * Interval(0, 1)
1200.                                   + Interval(0, 1) * FiniteSet(0, 1))
1201. 
1202.     second_square = Interval(1, 2, True, True) * Interval(0, 1, True, True)
1203.     assert (open_square + second_square).boundary == (
1204.                 FiniteSet(0, 1) * Interval(0, 1)
1205.               + FiniteSet(1, 2) * Interval(0, 1)
1206.               + Interval(0, 1) * FiniteSet(0, 1)
1207.               + Interval(1, 2) * FiniteSet(0, 1))
1208. 
1209. 
1210. def test_boundary_ProductSet_line():
1211.     line_in_r2 = Interval(0, 1) * FiniteSet(0)
1212.     assert line_in_r2.boundary == line_in_r2
1213. 
1214. 
1215. def test_is_open():
1216.     assert Interval(0, 1, False, False).is_open is False
1217.     assert Interval(0, 1, True, False).is_open is False
1218.     assert Interval(0, 1, True, True).is_open is True
1219.     assert FiniteSet(1, 2, 3).is_open is False
1220. 
1221. 
1222. def test_is_closed():
1223.     assert Interval(0, 1, False, False).is_closed is True
1224.     assert Interval(0, 1, True, False).is_closed is False
1225.     assert FiniteSet(1, 2, 3).is_closed is True
1226. 
1227. 
1228. def test_closure():
1229.     assert Interval(0, 1, False, True).closure == Interval(0, 1, False, False)
1230. 
1231. 
1232. def test_interior():
1233.     assert Interval(0, 1, False, True).interior == Interval(0, 1, True, True)
1234. 
1235. 
1236. def test_issue_7841():
1237.     raises(TypeError, lambda: x in S.Reals)
1238. 
1239. 
1240. def test_Eq():
1241.     assert Eq(Interval(0, 1), Interval(0, 1))
1242.     assert Eq(Interval(0, 1), Interval(0, 2)) == False
1243. 
1244.     s1 = FiniteSet(0, 1)
1245.     s2 = FiniteSet(1, 2)
1246. 
1247.     assert Eq(s1, s1)
1248.     assert Eq(s1, s2) == False
1249. 
1250.     assert Eq(s1*s2, s1*s2)
1251.     assert Eq(s1*s2, s2*s1) == False
1252. 
1253.     assert unchanged(Eq, FiniteSet({x, y}), FiniteSet({x}))
1254.     assert Eq(FiniteSet({x, y}).subs(y, x), FiniteSet({x})) is S.true
1255.     assert Eq(FiniteSet({x, y}), FiniteSet({x})).subs(y, x) is S.true
1256.     assert Eq(FiniteSet({x, y}).subs(y, x+1), FiniteSet({x})) is S.false
1257.     assert Eq(FiniteSet({x, y}), FiniteSet({x})).subs(y, x+1) is S.false
1258. 
1259.     assert Eq(ProductSet({1}, {2}), Interval(1, 2)) is S.false
1260.     assert Eq(ProductSet({1}), ProductSet({1}, {2})) is S.false
1261. 
1262.     assert Eq(FiniteSet(()), FiniteSet(1)) is S.false
1263.     assert Eq(ProductSet(), FiniteSet(1)) is S.false
1264. 
1265.     i1 = Interval(0, 1)
1266.     i2 = Interval(x, y)
1267.     assert unchanged(Eq, ProductSet(i1, i1), ProductSet(i2, i2))
1268. 
1269. 
1270. def test_SymmetricDifference():
1271.     A = FiniteSet(0, 1, 2, 3, 4, 5)
1272.     B = FiniteSet(2, 4, 6, 8, 10)
1273.     C = Interval(8, 10)
1274. 
1275.     assert SymmetricDifference(A, B, evaluate=False).is_iterable is True
1276.     assert SymmetricDifference(A, C, evaluate=False).is_iterable is None
1277.     assert FiniteSet(*SymmetricDifference(A, B, evaluate=False)) == \
1278.         FiniteSet(0, 1, 3, 5, 6, 8, 10)
1279.     raises(TypeError,
1280.         lambda: FiniteSet(*SymmetricDifference(A, C, evaluate=False)))
1281. 
1282.     assert SymmetricDifference(FiniteSet(0, 1, 2, 3, 4, 5), \
1283.             FiniteSet(2, 4, 6, 8, 10)) == FiniteSet(0, 1, 3, 5, 6, 8, 10)
1284.     assert SymmetricDifference(FiniteSet(2, 3, 4), FiniteSet(2, 3 , 4 , 5)) \
1285.             == FiniteSet(5)
1286.     assert FiniteSet(1, 2, 3, 4, 5) ^ FiniteSet(1, 2, 5, 6) == \
1287.             FiniteSet(3, 4, 6)
1288.     assert Set(S(1), S(2) , S(3)) ^ Set(S(2), S(3), S(4)) == Union(Set(S(1), S(2), S(3)) - Set(S(2), S(3), S(4)), \
1289.             Set(S(2), S(3), S(4)) - Set(S(1), S(2), S(3)))
1290.     assert Interval(0, 4) ^ Interval(2, 5) == Union(Interval(0, 4) - \
1291.             Interval(2, 5), Interval(2, 5) - Interval(0, 4))
1292. 
1293. 
1294. def test_issue_9536():
1295.     from sympy.functions.elementary.exponential import log
1296.     a = Symbol('a', real=True)
1297.     assert FiniteSet(log(a)).intersect(S.Reals) == Intersection(S.Reals, FiniteSet(log(a)))
1298. 
1299. 
1300. def test_issue_9637():
1301.     n = Symbol('n')
1302.     a = FiniteSet(n)
1303.     b = FiniteSet(2, n)
1304.     assert Complement(S.Reals, a) == Complement(S.Reals, a, evaluate=False)
1305.     assert Complement(Interval(1, 3), a) == Complement(Interval(1, 3), a, evaluate=False)
1306.     assert Complement(Interval(1, 3), b) == \
1307.         Complement(Union(Interval(1, 2, False, True), Interval(2, 3, True, False)), a)
1308.     assert Complement(a, S.Reals) == Complement(a, S.Reals, evaluate=False)
1309.     assert Complement(a, Interval(1, 3)) == Complement(a, Interval(1, 3), evaluate=False)
1310. 
1311. 
1312. def test_issue_9808():
1313.     # See https://github.com/sympy/sympy/issues/16342
1314.     assert Complement(FiniteSet(y), FiniteSet(1)) == Complement(FiniteSet(y), FiniteSet(1), evaluate=False)
1315.     assert Complement(FiniteSet(1, 2, x), FiniteSet(x, y, 2, 3)) == \
1316.         Complement(FiniteSet(1), FiniteSet(y), evaluate=False)
1317. 
1318. 
1319. def test_issue_9956():
1320.     assert Union(Interval(-oo, oo), FiniteSet(1)) == Interval(-oo, oo)
1321.     assert Interval(-oo, oo).contains(1) is S.true
1322. 
1323. 
1324. def test_issue_Symbol_inter():
1325.     i = Interval(0, oo)
1326.     r = S.Reals
1327.     mat = Matrix([0, 0, 0])
1328.     assert Intersection(r, i, FiniteSet(m), FiniteSet(m, n)) == \
1329.         Intersection(i, FiniteSet(m))
1330.     assert Intersection(FiniteSet(1, m, n), FiniteSet(m, n, 2), i) == \
1331.         Intersection(i, FiniteSet(m, n))
1332.     assert Intersection(FiniteSet(m, n, x), FiniteSet(m, z), r) == \
1333.         Intersection(Intersection({m, z}, {m, n, x}), r)
1334.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, x), r) == \
1335.         Intersection(FiniteSet(3, m, n), FiniteSet(m, n, x), r, evaluate=False)
1336.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, 2, 3), r) == \
1337.         Intersection(FiniteSet(3, m, n), r)
1338.     assert Intersection(r, FiniteSet(mat, 2, n), FiniteSet(0, mat, n)) == \
1339.         Intersection(r, FiniteSet(n))
1340.     assert Intersection(FiniteSet(sin(x), cos(x)), FiniteSet(sin(x), cos(x), 1), r) == \
1341.         Intersection(r, FiniteSet(sin(x), cos(x)))
1342.     assert Intersection(FiniteSet(x**2, 1, sin(x)), FiniteSet(x**2, 2, sin(x)), r) == \
1343.         Intersection(r, FiniteSet(x**2, sin(x)))
1344. 
1345. 
1346. def test_issue_11827():
1347.     assert S.Naturals0**4
1348. 
1349. 
1350. def test_issue_10113():
1351.     f = x**2/(x**2 - 4)
1352.     assert imageset(x, f, S.Reals) == Union(Interval(-oo, 0), Interval(1, oo, True, True))
1353.     assert imageset(x, f, Interval(-2, 2)) == Interval(-oo, 0)
1354.     assert imageset(x, f, Interval(-2, 3)) == Union(Interval(-oo, 0), Interval(Rational(9, 5), oo))
1355. 
1356. 
1357. def test_issue_10248():
1358.     raises(
1359.         TypeError, lambda: list(Intersection(S.Reals, FiniteSet(x)))
1360.     )
1361.     A = Symbol('A', real=True)
1362.     assert list(Intersection(S.Reals, FiniteSet(A))) == [A]
1363. 
1364. 
1365. def test_issue_9447():
1366.     a = Interval(0, 1) + Interval(2, 3)
1367.     assert Complement(S.UniversalSet, a) == Complement(
1368.             S.UniversalSet, Union(Interval(0, 1), Interval(2, 3)), evaluate=False)
1369.     assert Complement(S.Naturals, a) == Complement(
1370.             S.Naturals, Union(Interval(0, 1), Interval(2, 3)), evaluate=False)
1371. 
1372. 
1373. def test_issue_10337():
1374.     assert (FiniteSet(2) == 3) is False
1375.     assert (FiniteSet(2) != 3) is True
1376.     raises(TypeError, lambda: FiniteSet(2) < 3)
1377.     raises(TypeError, lambda: FiniteSet(2) <= 3)
1378.     raises(TypeError, lambda: FiniteSet(2) > 3)
1379.     raises(TypeError, lambda: FiniteSet(2) >= 3)
1380. 
1381. 
1382. def test_issue_10326():
1383.     bad = [
1384.         EmptySet,
1385.         FiniteSet(1),
1386.         Interval(1, 2),
1387.         S.ComplexInfinity,
1388.         S.ImaginaryUnit,
1389.         S.Infinity,
1390.         S.NaN,
1391.         S.NegativeInfinity,
1392.         ]
1393.     interval = Interval(0, 5)
1394.     for i in bad:
1395.         assert i not in interval
1396. 
1397.     x = Symbol('x', real=True)
1398.     nr = Symbol('nr', extended_real=False)
1399.     assert x + 1 in Interval(x, x + 4)
1400.     assert nr not in Interval(x, x + 4)
1401.     assert Interval(1, 2) in FiniteSet(Interval(0, 5), Interval(1, 2))
1402.     assert Interval(-oo, oo).contains(oo) is S.false
1403.     assert Interval(-oo, oo).contains(-oo) is S.false
1404. 
1405. 
1406. def test_issue_2799():
1407.     U = S.UniversalSet
1408.     a = Symbol('a', real=True)
1409.     inf_interval = Interval(a, oo)
1410.     R = S.Reals
1411. 
1412.     assert U + inf_interval == inf_interval + U
1413.     assert U + R == R + U
1414.     assert R + inf_interval == inf_interval + R
1415. 
1416. 
1417. def test_issue_9706():
1418.     assert Interval(-oo, 0).closure == Interval(-oo, 0, True, False)
1419.     assert Interval(0, oo).closure == Interval(0, oo, False, True)
1420.     assert Interval(-oo, oo).closure == Interval(-oo, oo)
1421. 
1422. 
1423. def test_issue_8257():
1424.     reals_plus_infinity = Union(Interval(-oo, oo), FiniteSet(oo))
1425.     reals_plus_negativeinfinity = Union(Interval(-oo, oo), FiniteSet(-oo))
1426.     assert Interval(-oo, oo) + FiniteSet(oo) == reals_plus_infinity
1427.     assert FiniteSet(oo) + Interval(-oo, oo) == reals_plus_infinity
1428.     assert Interval(-oo, oo) + FiniteSet(-oo) == reals_plus_negativeinfinity
1429.     assert FiniteSet(-oo) + Interval(-oo, oo) == reals_plus_negativeinfinity
1430. 
1431. 
1432. def test_issue_10931():
1433.     assert S.Integers - S.Integers == EmptySet
1434.     assert S.Integers - S.Reals == EmptySet
1435. 
1436. 
1437. def test_issue_11174():
1438.     soln = Intersection(Interval(-oo, oo), FiniteSet(-x), evaluate=False)
1439.     assert Intersection(FiniteSet(-x), S.Reals) == soln
1440. 
1441.     soln = Intersection(S.Reals, FiniteSet(x), evaluate=False)
1442.     assert Intersection(FiniteSet(x), S.Reals) == soln
1443. 
1444. 
1445. def test_issue_18505():
1446.     assert ImageSet(Lambda(n, sqrt(pi*n/2 - 1 + pi/2)), S.Integers).contains(0) == \
1447.             Contains(0, ImageSet(Lambda(n, sqrt(pi*n/2 - 1 + pi/2)), S.Integers))
1448. 
1449. 
1450. def test_finite_set_intersection():
1451.     # The following should not produce recursion errors
1452.     # Note: some of these are not completely correct. See
1453.     # https://github.com/sympy/sympy/issues/16342.
1454.     assert Intersection(FiniteSet(-oo, x), FiniteSet(x)) == FiniteSet(x)
1455.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(0, x)]) == FiniteSet(x)
1456. 
1457.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(x)]) == FiniteSet(x)
1458.     assert Intersection._handle_finite_sets([FiniteSet(2, 3, x, y), FiniteSet(1, 2, x)]) == \
1459.         Intersection._handle_finite_sets([FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)]) == \
1460.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)) == \
1461.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, x, y))
1462. 
1463.     assert FiniteSet(1+x-y) & FiniteSet(1) == \
1464.         FiniteSet(1) & FiniteSet(1+x-y) == \
1465.         Intersection(FiniteSet(1+x-y), FiniteSet(1), evaluate=False)
1466. 
1467.     assert FiniteSet(1) & FiniteSet(x) == FiniteSet(x) & FiniteSet(1) == \
1468.         Intersection(FiniteSet(1), FiniteSet(x), evaluate=False)
1469. 
1470.     assert FiniteSet({x}) & FiniteSet({x, y}) == \
1471.         Intersection(FiniteSet({x}), FiniteSet({x, y}), evaluate=False)
1472. 
1473. 
1474. def test_union_intersection_constructor():
1475.     # The actual exception does not matter here, so long as these fail
1476.     sets = [FiniteSet(1), FiniteSet(2)]
1477.     raises(Exception, lambda: Union(sets))
1478.     raises(Exception, lambda: Intersection(sets))
1479.     raises(Exception, lambda: Union(tuple(sets)))
1480.     raises(Exception, lambda: Intersection(tuple(sets)))
1481.     raises(Exception, lambda: Union(i for i in sets))
1482.     raises(Exception, lambda: Intersection(i for i in sets))
1483. 
1484.     # Python sets are treated the same as FiniteSet
1485.     # The union of a single set (of sets) is the set (of sets) itself
1486.     assert Union(set(sets)) == FiniteSet(*sets)
1487.     assert Intersection(set(sets)) == FiniteSet(*sets)
1488. 
1489.     assert Union({1}, {2}) == FiniteSet(1, 2)
1490.     assert Intersection({1, 2}, {2, 3}) == FiniteSet(2)
1491. 
1492. 
1493. def test_Union_contains():
1494.     assert zoo not in Union(
1495.         Interval.open(-oo, 0), Interval.open(0, oo))
1496. 
1497. 
1498. @XFAIL
1499. def test_issue_16878b():
1500.     # in intersection_sets for (ImageSet, Set) there is no code
1501.     # that handles the base_set of S.Reals like there is
1502.     # for Integers
1503.     assert imageset(x, (x, x), S.Reals).is_subset(S.Reals**2) is True
1504. 
1505. def test_DisjointUnion():
1506.     assert DisjointUnion(FiniteSet(1, 2, 3), FiniteSet(1, 2, 3), FiniteSet(1, 2, 3)).rewrite(Union) == (FiniteSet(1, 2, 3) * FiniteSet(0, 1, 2))
1507.     assert DisjointUnion(Interval(1, 3), Interval(2, 4)).rewrite(Union) == Union(Interval(1, 3) * FiniteSet(0), Interval(2, 4) * FiniteSet(1))
1508.     assert DisjointUnion(Interval(0, 5), Interval(0, 5)).rewrite(Union) == Union(Interval(0, 5) * FiniteSet(0), Interval(0, 5) * FiniteSet(1))
1509.     assert DisjointUnion(Interval(-1, 2), S.EmptySet, S.EmptySet).rewrite(Union) == Interval(-1, 2) * FiniteSet(0)
1510.     assert DisjointUnion(Interval(-1, 2)).rewrite(Union) == Interval(-1, 2) * FiniteSet(0)
1511.     assert DisjointUnion(S.EmptySet, Interval(-1, 2), S.EmptySet).rewrite(Union) == Interval(-1, 2) * FiniteSet(1)
1512.     assert DisjointUnion(Interval(-oo, oo)).rewrite(Union) == Interval(-oo, oo) * FiniteSet(0)
1513.     assert DisjointUnion(S.EmptySet).rewrite(Union) == S.EmptySet
1514.     assert DisjointUnion().rewrite(Union) == S.EmptySet
1515.     raises(TypeError, lambda: DisjointUnion(Symbol('n')))
1516. 
1517.     x = Symbol("x")
1518.     y = Symbol("y")
1519.     z = Symbol("z")
1520.     assert DisjointUnion(FiniteSet(x), FiniteSet(y, z)).rewrite(Union) == (FiniteSet(x) * FiniteSet(0)) + (FiniteSet(y, z) * FiniteSet(1))
1521. 
1522. def test_DisjointUnion_is_empty():
1523.     assert DisjointUnion(S.EmptySet).is_empty is True
1524.     assert DisjointUnion(S.EmptySet, S.EmptySet).is_empty is True
1525.     assert DisjointUnion(S.EmptySet, FiniteSet(1, 2, 3)).is_empty is False
1526. 
1527. def test_DisjointUnion_is_iterable():
1528.     assert DisjointUnion(S.Integers, S.Naturals, S.Rationals).is_iterable is True
1529.     assert DisjointUnion(S.EmptySet, S.Reals).is_iterable is False
1530.     assert DisjointUnion(FiniteSet(1, 2, 3), S.EmptySet, FiniteSet(x, y)).is_iterable is True
1531.     assert DisjointUnion(S.EmptySet, S.EmptySet).is_iterable is False
1532. 
1533. def test_DisjointUnion_contains():
1534.     assert (0, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1535.     assert (0, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1536.     assert (0, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1537.     assert (1, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1538.     assert (1, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1539.     assert (1, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1540.     assert (2, 0) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1541.     assert (2, 1) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1542.     assert (2, 2) in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1543.     assert (0, 1, 2) not in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1544.     assert (0, 0.5) not in DisjointUnion(FiniteSet(0.5))
1545.     assert (0, 5) not in DisjointUnion(FiniteSet(0, 1, 2), FiniteSet(0, 1, 2), FiniteSet(0, 1, 2))
1546.     assert (x, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1547.     assert (y, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1548.     assert (z, 0) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1549.     assert (y, 2) in DisjointUnion(FiniteSet(x, y, z), S.EmptySet, FiniteSet(y))
1550.     assert (0.5, 0) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1551.     assert (0.5, 1) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1552.     assert (1.5, 0) not in DisjointUnion(Interval(0, 1), Interval(0, 2))
1553.     assert (1.5, 1) in DisjointUnion(Interval(0, 1), Interval(0, 2))
1554. 
1555. def test_DisjointUnion_iter():
1556.     D = DisjointUnion(FiniteSet(3, 5, 7, 9), FiniteSet(x, y, z))
1557.     it = iter(D)
1558.     L1 = [(x, 1), (y, 1), (z, 1)]
1559.     L2 = [(3, 0), (5, 0), (7, 0), (9, 0)]
1560.     nxt = next(it)
1561.     assert nxt in L2
1562.     L2.remove(nxt)
1563.     nxt = next(it)
1564.     assert nxt in L1
1565.     L1.remove(nxt)
1566.     nxt = next(it)
1567.     assert nxt in L2
1568.     L2.remove(nxt)
1569.     nxt = next(it)
1570.     assert nxt in L1
1571.     L1.remove(nxt)
1572.     nxt = next(it)
1573.     assert nxt in L2
1574.     L2.remove(nxt)
1575.     nxt = next(it)
1576.     assert nxt in L1
1577.     L1.remove(nxt)
1578.     nxt = next(it)
1579.     assert nxt in L2
1580.     L2.remove(nxt)
1581.     raises(StopIteration, lambda: next(it))
1582. 
1583.     raises(ValueError, lambda: iter(DisjointUnion(Interval(0, 1), S.EmptySet)))
1584. 
1585. def test_DisjointUnion_len():
1586.     assert len(DisjointUnion(FiniteSet(3, 5, 7, 9), FiniteSet(x, y, z))) == 7
1587.     assert len(DisjointUnion(S.EmptySet, S.EmptySet, FiniteSet(x, y, z), S.EmptySet)) == 3
1588.     raises(ValueError, lambda: len(DisjointUnion(Interval(0, 1), S.EmptySet)))
1589. 
1590. def test_issue_20089():
1591.     B = FiniteSet(FiniteSet(1, 2), FiniteSet(1))
1592.     assert not 1 in B
1593.     assert not 1.0 in B
1594.     assert not Eq(1, FiniteSet(1, 2))
1595.     assert FiniteSet(1) in B
1596.     A = FiniteSet(1, 2)
1597.     assert A in B
1598.     assert B.issubset(B)
1599.     assert not A.issubset(B)
1600.     assert 1 in A
1601.     C = FiniteSet(FiniteSet(1, 2), FiniteSet(1), 1, 2)
1602.     assert A.issubset(C)
1603.     assert B.issubset(C)
1604. 
1605. def test_issue_19378():
1606.     a = FiniteSet(1, 2)
1607.     b = ProductSet(a, a)
1608.     c = FiniteSet((1, 1), (1, 2), (2, 1), (2, 2))
1609.     assert b.is_subset(c) is True
1610.     d = FiniteSet(1)
1611.     assert b.is_subset(d) is False
1612.     assert Eq(c, b).simplify() is S.true
1613.     assert Eq(a, c).simplify() is S.false
1614.     assert Eq({1}, {x}).simplify() == Eq({1}, {x})
1615. 
1616. def test_issue_20379():
1617.     #https://github.com/sympy/sympy/issues/20379
1618.     x = pi - 3.14159265358979
1619.     assert FiniteSet(x).evalf(2) == FiniteSet(Float('3.23108914886517e-15', 2))
1620. 
1621. def test_finiteset_simplify():
1622.     S = FiniteSet(1, cos(1)**2 + sin(1)**2)
1623.     assert S.simplify() == {1}

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 01:23:36,119 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's query asks for the content of `sympy/sets/tests/test_sets.py`.\n   - The extra requirements specify prioritizing test functions with 'ImageSet' or 'imageset' and 'intersect' or 'Intersection'.\n   - This function `test_image_Intersection` perfectly matches the prioritized criteria.\n2. Extended relevance:\n   - This test is marked as `XFAIL`, which indicates a known, failing test case for the intersection of an `ImageSet`. This is highly relevant to the user's purpose of finding existing test cases that cover the intersection of `ImageSet`.", relative_path='sympy/sets/tests/test_sets.py', start_line=1139, end_line=1145), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user is looking for tests related to `ImageSet` intersection.\n2. Extended relevance:\n   - The comment in this test function is critically important. It explicitly mentions that for `(ImageSet, Set)` intersections, there is missing code, which directly points to the likely source of the user's issue.", relative_path='sympy/sets/tests/test_sets.py', start_line=1498, end_line=1504), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requested the file content starting from line 501.\n   - This context provides the initial block of code from the requested starting point.\n2. Extended relevance:\n   - This code block contains tests for `Intersection` with various sets like `Interval`, `FiniteSet`, `ProductSet`, and `S.Complexes`. This provides essential context on the general behavior of intersections in the library.', relative_path='sympy/sets/tests/test_sets.py', start_line=501, end_line=518), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user is interested in `ImageSet` and `Intersection` tests.\n2. Extended relevance:\n   - This function tests how `imageset` works with `Interval` objects, a fundamental concept for `ImageSet` creation. Understanding how `ImageSet` is constructed is crucial before analyzing its intersection behavior.', relative_path='sympy/sets/tests/test_sets.py', start_line=1100, end_line=1130), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user is interested in `ImageSet` and `Intersection` tests.\n2. Extended relevance:\n   - This function tests how `imageset` works with `FiniteSet` objects, providing another example of `ImageSet` creation and behavior.', relative_path='sympy/sets/tests/test_sets.py', start_line=1147, end_line=1150), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user is interested in `ImageSet` and `Intersection` tests.\n2. Extended relevance:\n   - This function tests how `imageset` works with `Union` objects, demonstrating how `ImageSet` interacts with other set operations, which is relevant to its interaction with `Intersection`.', relative_path='sympy/sets/tests/test_sets.py', start_line=1152, end_line=1156), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user is interested in `Intersection` tests.\n2. Extended relevance:\n   - This function provides test cases for intersections involving symbolic variables within `FiniteSet`s, which demonstrates more complex scenarios of how `Intersection` is handled in the library.', relative_path='sympy/sets/tests/test_sets.py', start_line=1324, end_line=1344), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user is interested in `Intersection` tests.\n2. Extended relevance:\n   - This function specifically tests `Intersection` between `FiniteSet` objects, including symbolic ones. The comment also points to a relevant issue tracker, providing deeper context on known problems with set intersections.', relative_path='sympy/sets/tests/test_sets.py', start_line=1450, end_line=1472)]
2025-12-21 01:23:36,122 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 8 contexts to memory for query: Please provide the rest of the content of the file `sympy/sets/tests/test_sets.py` from line 501 to the end.
2025-12-21 01:23:36,122 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 01:23:36,122 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 01:23:36,123 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 8 new contexts to 1 existing contexts
2025-12-21 01:23:36,123 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 9 total contexts (removed 0 duplicates)
2025-12-21 01:23:36,124 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sympy
├── .ci
|   ├── README.rst
|   ├── generate_durations_log.sh
|   └── parse_durations_log.py
├── .github
|   └── workflows
|       └── runtests.yml
├── .travis.yml
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── PULL_REQUEST_TEMPLATE.md
├── README.md
├── bin
|   ├── ask_update.py
|   ├── authors_update.py
|   ├── coverage_doctest.py
|   ├── coverage_report.py
|   ├── generate_module_list.py
|   ├── generate_test_list.py
|   ├── get_sympy.py
|   ├── mailmap_update.py
|   ├── sympy_time.py
|   ├── sympy_time_cache.py
|   ├── test_executable.py
|   ├── test_external_imports.py
|   ├── test_import.py
|   ├── test_optional_dependencies.py
|   ├── test_py2_import.py
|   ├── test_setup.py
|   ├── test_sphinx.sh
|   ├── test_submodule_imports.py
|   └── test_travis.sh
├── codecov.yml
├── conftest.py
├── data
|   └── TeXmacs
|       ├── bin
|       └── progs
├── doc
|   ├── README.rst
|   ├── api
|   |   ├── conf.py
|   |   └── index.rst
|   ├── cheatsheet
|   ├── ext
|   |   ├── docscrape.py
|   |   ├── docscrape_sphinx.py
|   |   ├── numpydoc.py
|   |   └── sympylive.py
|   ├── generate_logos.py
|   ├── man
|   |   └── isympy.xml
|   └── src
|       ├── _static
|       ├── _templates
|       |   └── layout.html
|       ├── aboutus.rst
|       ├── citing.rst
|       ├── conf.py
|       ├── documentation-style-guide.rst
|       ├── gotchas.rst
|       ├── guides
|       |   ├── assumptions.rst
|       |   ├── booleans.rst
|       |   └── index.rst
|       ├── index.rst
|       ├── install.rst
|       ├── logo
|       |   └── info.txt
|       ├── modules
|       |   ├── abc.rst
|       |   ├── algebras.rst
|       |   ├── assumptions
|       |   |   ├── ask.rst
|       |   |   ├── assume.rst
|       |   |   ├── index.rst
|       |   |   ├── predicates.rst
|       |   |   └── refine.rst
|       |   ├── calculus
|       |   |   └── index.rst
|       |   ├── categories.rst
|       |   ├── codegen.rst
|       |   ├── combinatorics
|       |   |   ├── fp_groups.rst
|       |   |   ├── graycode.rst
|       |   |   ├── group_constructs.rst
|       |   |   ├── index.rst
|       |   |   ├── named_groups.rst
|       |   |   ├── partitions.rst
|       |   |   ├── pc_groups.rst
|       |   |   ├── perm_groups.rst
|       |   |   ├── permutations.rst
|       |   |   ├── polyhedron.rst
|       |   |   ├── prufer.rst
|       |   |   ├── subsets.rst
|       |   |   ├── tensor_can.rst
|       |   |   ├── testutil.rst
|       |   |   └── util.rst
|       |   ├── concrete.rst
|       |   ├── core.rst
|       |   ├── crypto.rst
|       |   ├── diffgeom.rst
|       |   ├── discrete.rst
|       |   ├── evalf.rst
|       |   ├── functions
|       |   |   ├── combinatorial.rst
|       |   |   ├── elementary.rst
|       |   |   ├── index.rst
|       |   |   └── special.rst
|       |   ├── geometry
|       |   |   ├── curves.rst
|       |   |   ├── ellipses.rst
|       |   |   ├── entities.rst
|       |   |   ├── index.rst
|       |   |   ├── lines.rst
|       |   |   ├── plane.rst
|       |   |   ├── points.rst
|       |   |   ├── polygons.rst
|       |   |   └── utils.rst
|       |   ├── holonomic
|       |   |   ├── about.rst
|       |   |   ├── convert.rst
|       |   |   ├── index.rst
|       |   |   ├── internal.rst
|       |   |   ├── operations.rst
|       |   |   ├── represent.rst
|       |   |   └── uses.rst
|       |   ├── index.rst
|       |   ├── integrals
|       |   |   ├── g-functions.rst
|       |   |   └── integrals.rst
|       |   ├── interactive.rst
|       |   ├── liealgebras
|       |   |   └── index.rst
|       |   ├── logic.rst
|       |   ├── matrices
|       |   |   ├── common.rst
|       |   |   ├── dense.rst
|       |   |   ├── expressions.rst
|       |   |   ├── immutablematrices.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── sparse.rst
|       |   |   └── sparsetools.rst
|       |   ├── ntheory.rst
|       |   ├── numeric-computation.rst
|       |   ├── parsing.rst
|       |   ├── physics
|       |   |   ├── continuum_mechanics
|       |   |   ├── control
|       |   |   ├── hep
|       |   |   ├── hydrogen.rst
|       |   |   ├── index.rst
|       |   |   ├── matrices.rst
|       |   |   ├── mechanics
|       |   |   ├── optics
|       |   |   ├── paulialgebra.rst
|       |   |   ├── qho_1d.rst
|       |   |   ├── quantum
|       |   |   ├── secondquant.rst
|       |   |   ├── sho.rst
|       |   |   ├── units
|       |   |   ├── vector
|       |   |   └── wigner.rst
|       |   ├── plotting.rst
|       |   ├── polys
|       |   |   ├── agca.rst
|       |   |   ├── basics.rst
|       |   |   ├── domainmatrix.rst
|       |   |   ├── domainsintro.rst
|       |   |   ├── domainsref.rst
|       |   |   ├── index.rst
|       |   |   ├── internals.rst
|       |   |   ├── literature.rst
|       |   |   ├── reference.rst
|       |   |   ├── ringseries.rst
|       |   |   ├── solvers.rst
|       |   |   └── wester.rst
|       |   ├── printing.rst
|       |   ├── rewriting.rst
|       |   ├── series
|       |   |   ├── formal.rst
|       |   |   ├── fourier.rst
|       |   |   ├── index.rst
|       |   |   ├── limitseq.rst
|       |   |   ├── sequences.rst
|       |   |   └── series.rst
|       |   ├── sets.rst
|       |   ├── simplify
|       |   |   ├── fu.rst
|       |   |   ├── hyperexpand.rst
|       |   |   ├── index.rst
|       |   |   └── simplify.rst
|       |   ├── solvers
|       |   |   ├── diophantine.rst
|       |   |   ├── inequalities.rst
|       |   |   ├── ode.rst
|       |   |   ├── pde.rst
|       |   |   ├── solvers.rst
|       |   |   └── solveset.rst
|       |   ├── stats.rst
|       |   ├── tensor
|       |   |   ├── array.rst
|       |   |   ├── index.rst
|       |   |   ├── index_methods.rst
|       |   |   ├── indexed.rst
|       |   |   ├── tensor.rst
|       |   |   └── toperators.rst
|       |   ├── testing
|       |   |   ├── index.rst
|       |   |   ├── pytest.rst
|       |   |   ├── randtest.rst
|       |   |   └── runtests.rst
|       |   ├── utilities
|       |   |   ├── autowrap.rst
|       |   |   ├── codegen.rst
|       |   |   ├── decorator.rst
|       |   |   ├── enumerative.rst
|       |   |   ├── index.rst
|       |   |   ├── iterables.rst
|       |   |   ├── lambdify.rst
|       |   |   ├── memoization.rst
|       |   |   ├── misc.rst
|       |   |   ├── pkgdata.rst
|       |   |   ├── source.rst
|       |   |   └── timeutils.rst
|       |   └── vector
|       |       ├── api
|       |       ├── basics.rst
|       |       ├── coordsys.rst
|       |       ├── examples.rst
|       |       ├── fields.rst
|       |       ├── index.rst
|       |       ├── intro.rst
|       |       └── vector_integration.rst
|       ├── outreach.rst
|       ├── pics
|       ├── special_topics
|       |   ├── classification.rst
|       |   ├── finite_diff_derivatives.rst
|       |   ├── index.rst
|       |   └── intro.rst
|       ├── tutorial
|       |   ├── basic_operations.rst
|       |   ├── calculus.rst
|       |   ├── gotchas.rst
|       |   ├── index.rst
|       |   ├── intro.rst
|       |   ├── manipulation.rst
|       |   ├── matrices.rst
|       |   ├── preliminaries.rst
|       |   ├── printing.rst
|       |   ├── simplification.rst
|       |   └── solvers.rst
|       └── wiki.rst
├── examples
|   ├── advanced
|   |   ├── autowrap_integrators.py
|   |   ├── autowrap_ufuncify.py
|   |   ├── curvilinear_coordinates.py
|   |   ├── dense_coding_example.py
|   |   ├── fem.py
|   |   ├── gibbs_phenomenon.py
|   |   ├── grover_example.py
|   |   ├── hydrogen.py
|   |   ├── pidigits.py
|   |   ├── pyglet_plotting.py
|   |   ├── qft.py
|   |   └── relativity.py
|   ├── all.py
|   ├── beginner
|   |   ├── basic.py
|   |   ├── differentiation.py
|   |   ├── expansion.py
|   |   ├── functions.py
|   |   ├── limits_examples.py
|   |   ├── plot_examples.py
|   |   ├── plotting_nice_plot.py
|   |   ├── precision.py
|   |   ├── print_pretty.py
|   |   ├── series.py
|   |   └── substitution.py
|   ├── intermediate
|   |   ├── coupled_cluster.py
|   |   ├── differential_equations.py
|   |   ├── infinite_1d_box.py
|   |   ├── mplot2d.py
|   |   ├── mplot3d.py
|   |   ├── partial_differential_eqs.py
|   |   ├── print_gtk.py
|   |   ├── sample.py
|   |   ├── trees.py
|   |   └── vandermonde.py
|   └── notebooks
|       └── README.txt
├── isympy.py
├── release
|   ├── Dockerfile
|   ├── README.md
|   ├── aptinstall.sh
|   ├── authors.py
|   ├── build_docs.py
|   ├── compare_tar_against_git.py
|   ├── fabfile.py
|   ├── github_release.py
|   ├── helpers.py
|   ├── pull_and_run_rever.sh
|   ├── release.sh
|   ├── releasecheck.py
|   ├── requirements.txt
|   ├── sha256.py
|   ├── test_install.py
|   ├── update_docs.py
|   └── update_requirements.sh
├── setup.py
├── setupegg.py
└── sympy
    ├── __init__.py
    ├── abc.py
    ├── algebras
    |   ├── __init__.py
    |   ├── quaternion.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_quaternion.py
    ├── assumptions
    |   ├── __init__.py
    |   ├── ask.py
    |   ├── ask_generated.py
    |   ├── assume.py
    |   ├── cnf.py
    |   ├── facts.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── predicates
    |   |   ├── __init__.py
    |   |   ├── calculus.py
    |   |   ├── common.py
    |   |   ├── matrices.py
    |   |   ├── ntheory.py
    |   |   ├── order.py
    |   |   └── sets.py
    |   ├── refine.py
    |   ├── relation
    |   |   ├── __init__.py
    |   |   ├── binrel.py
    |   |   └── equality.py
    |   ├── satask.py
    |   ├── sathandlers.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_assumptions_2.py
    |   |   ├── test_context.py
    |   |   ├── test_matrices.py
    |   |   ├── test_query.py
    |   |   ├── test_refine.py
    |   |   ├── test_satask.py
    |   |   ├── test_sathandlers.py
    |   |   └── test_wrapper.py
    |   └── wrapper.py
    ├── benchmarks
    |   ├── __init__.py
    |   ├── bench_discrete_log.py
    |   ├── bench_meijerint.py
    |   └── bench_symbench.py
    ├── calculus
    |   ├── __init__.py
    |   ├── euler.py
    |   ├── finite_diff.py
    |   ├── singularities.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_euler.py
    |   |   ├── test_finite_diff.py
    |   |   ├── test_singularities.py
    |   |   └── test_util.py
    |   └── util.py
    ├── categories
    |   ├── __init__.py
    |   ├── baseclasses.py
    |   ├── diagram_drawing.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_baseclasses.py
    |       └── test_drawing.py
    ├── codegen
    |   ├── __init__.py
    |   ├── algorithms.py
    |   ├── approximations.py
    |   ├── array_utils.py
    |   ├── ast.py
    |   ├── cfunctions.py
    |   ├── cnodes.py
    |   ├── cutils.py
    |   ├── cxxnodes.py
    |   ├── fnodes.py
    |   ├── futils.py
    |   ├── matrix_nodes.py
    |   ├── numpy_nodes.py
    |   ├── pyutils.py
    |   ├── rewriting.py
    |   ├── scipy_nodes.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_algorithms.py
    |       ├── test_applications.py
    |       ├── test_approximations.py
    |       ├── test_ast.py
    |       ├── test_cfunctions.py
    |       ├── test_cnodes.py
    |       ├── test_cxxnodes.py
    |       ├── test_fnodes.py
    |       ├── test_numpy_nodes.py
    |       ├── test_pyutils.py
    |       ├── test_rewriting.py
    |       └── test_scipy_nodes.py
    ├── combinatorics
    |   ├── __init__.py
    |   ├── coset_table.py
    |   ├── fp_groups.py
    |   ├── free_groups.py
    |   ├── generators.py
    |   ├── graycode.py
    |   ├── group_constructs.py
    |   ├── homomorphisms.py
    |   ├── named_groups.py
    |   ├── partitions.py
    |   ├── pc_groups.py
    |   ├── perm_groups.py
    |   ├── permutations.py
    |   ├── polyhedron.py
    |   ├── prufer.py
    |   ├── rewritingsystem.py
    |   ├── rewritingsystem_fsm.py
    |   ├── schur_number.py
    |   ├── subsets.py
    |   ├── tensor_can.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_coset_table.py
    |   |   ├── test_fp_groups.py
    |   |   ├── test_free_groups.py
    |   |   ├── test_generators.py
    |   |   ├── test_graycode.py
    |   |   ├── test_group_constructs.py
    |   |   ├── test_homomorphisms.py
    |   |   ├── test_named_groups.py
    |   |   ├── test_partitions.py
    |   |   ├── test_pc_groups.py
    |   |   ├── test_perm_groups.py
    |   |   ├── test_permutations.py
    |   |   ├── test_polyhedron.py
    |   |   ├── test_prufer.py
    |   |   ├── test_rewriting.py
    |   |   ├── test_schur_number.py
    |   |   ├── test_subsets.py
    |   |   ├── test_tensor_can.py
    |   |   ├── test_testutil.py
    |   |   └── test_util.py
    |   ├── testutil.py
    |   └── util.py
    ├── concrete
    |   ├── __init__.py
    |   ├── delta.py
    |   ├── expr_with_intlimits.py
    |   ├── expr_with_limits.py
    |   ├── gosper.py
    |   ├── guess.py
    |   ├── products.py
    |   ├── summations.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_delta.py
    |       ├── test_gosper.py
    |       ├── test_guess.py
    |       ├── test_products.py
    |       └── test_sums_products.py
    ├── conftest.py
    ├── core
    |   ├── __init__.py
    |   ├── _print_helpers.py
    |   ├── add.py
    |   ├── alphabets.py
    |   ├── assumptions.py
    |   ├── backend.py
    |   ├── basic.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_arit.py
    |   |   ├── bench_assumptions.py
    |   |   ├── bench_basic.py
    |   |   ├── bench_expand.py
    |   |   ├── bench_numbers.py
    |   |   └── bench_sympify.py
    |   ├── cache.py
    |   ├── compatibility.py
    |   ├── containers.py
    |   ├── core.py
    |   ├── coreerrors.py
    |   ├── decorators.py
    |   ├── evalf.py
    |   ├── expr.py
    |   ├── exprtools.py
    |   ├── facts.py
    |   ├── function.py
    |   ├── kind.py
    |   ├── logic.py
    |   ├── mod.py
    |   ├── mul.py
    |   ├── multidimensional.py
    |   ├── numbers.py
    |   ├── operations.py
    |   ├── parameters.py
    |   ├── power.py
    |   ├── relational.py
    |   ├── rules.py
    |   ├── singleton.py
    |   ├── symbol.py
    |   ├── sympify.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_args.py
    |   |   ├── test_arit.py
    |   |   ├── test_assumptions.py
    |   |   ├── test_basic.py
    |   |   ├── test_cache.py
    |   |   ├── test_compatibility.py
    |   |   ├── test_complex.py
    |   |   ├── test_constructor_postprocessor.py
    |   |   ├── test_containers.py
    |   |   ├── test_count_ops.py
    |   |   ├── test_diff.py
    |   |   ├── test_equal.py
    |   |   ├── test_eval.py
    |   |   ├── test_evalf.py
    |   |   ├── test_expand.py
    |   |   ├── test_expr.py
    |   |   ├── test_exprtools.py
    |   |   ├── test_facts.py
    |   |   ├── test_function.py
    |   |   ├── test_kind.py
    |   |   ├── test_logic.py
    |   |   ├── test_match.py
    |   |   ├── test_multidimensional.py
    |   |   ├── test_noncommutative.py
    |   |   ├── test_numbers.py
    |   |   ├── test_operations.py
    |   |   ├── test_parameters.py
    |   |   ├── test_power.py
    |   |   ├── test_priority.py
    |   |   ├── test_relational.py
    |   |   ├── test_rules.py
    |   |   ├── test_singleton.py
    |   |   ├── test_subs.py
    |   |   ├── test_symbol.py
    |   |   ├── test_sympify.py
    |   |   ├── test_trace.py
    |   |   ├── test_truediv.py
    |   |   └── test_var.py
    |   └── trace.py
    ├── crypto
    |   ├── __init__.py
    |   ├── crypto.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_crypto.py
    ├── diffgeom
    |   ├── __init__.py
    |   ├── diffgeom.py
    |   ├── rn.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_class_structure.py
    |       ├── test_diffgeom.py
    |       ├── test_function_diffgeom_book.py
    |       └── test_hyperbolic_space.py
    ├── discrete
    |   ├── __init__.py
    |   ├── convolutions.py
    |   ├── recurrences.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_convolutions.py
    |   |   ├── test_recurrences.py
    |   |   └── test_transforms.py
    |   └── transforms.py
    ├── external
    |   ├── __init__.py
    |   ├── gmpy.py
    |   ├── importtools.py
    |   ├── pythonmpq.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_autowrap.py
    |       ├── test_codegen.py
    |       ├── test_importtools.py
    |       ├── test_numpy.py
    |       ├── test_pythonmpq.py
    |       ├── test_sage.py
    |       └── test_scipy.py
    ├── functions
    |   ├── __init__.py
    |   ├── combinatorial
    |   |   ├── __init__.py
    |   |   ├── factorials.py
    |   |   ├── numbers.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_comb_factorials.py
    |   |       └── test_comb_numbers.py
    |   ├── elementary
    |   |   ├── __init__.py
    |   |   ├── benchmarks
    |   |   |   ├── __init__.py
    |   |   |   └── bench_exp.py
    |   |   ├── complexes.py
    |   |   ├── exponential.py
    |   |   ├── hyperbolic.py
    |   |   ├── integers.py
    |   |   ├── miscellaneous.py
    |   |   ├── piecewise.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_complexes.py
    |   |   |   ├── test_exponential.py
    |   |   |   ├── test_hyperbolic.py
    |   |   |   ├── test_integers.py
    |   |   |   ├── test_interface.py
    |   |   |   ├── test_miscellaneous.py
    |   |   |   ├── test_piecewise.py
    |   |   |   └── test_trigonometric.py
    |   |   └── trigonometric.py
    |   └── special
    |       ├── __init__.py
    |       ├── benchmarks
    |       |   ├── __init__.py
    |       |   └── bench_special.py
    |       ├── bessel.py
    |       ├── beta_functions.py
    |       ├── bsplines.py
    |       ├── delta_functions.py
    |       ├── elliptic_integrals.py
    |       ├── error_functions.py
    |       ├── gamma_functions.py
    |       ├── hyper.py
    |       ├── mathieu_functions.py
    |       ├── polynomials.py
    |       ├── singularity_functions.py
    |       ├── spherical_harmonics.py
    |       ├── tensor_functions.py
    |       ├── tests
    |       |   ├── __init__.py
    |       |   ├── test_bessel.py
    |       |   ├── test_beta_functions.py
    |       |   ├── test_bsplines.py
    |       |   ├── test_delta_functions.py
    |       |   ├── test_elliptic_integrals.py
    |       |   ├── test_error_functions.py
    |       |   ├── test_gamma_functions.py
    |       |   ├── test_hyper.py
    |       |   ├── test_mathieu.py
    |       |   ├── test_singularity_functions.py
    |       |   ├── test_spec_polynomials.py
    |       |   ├── test_spherical_harmonics.py
    |       |   ├── test_tensor_functions.py
    |       |   └── test_zeta_functions.py
    |       └── zeta_functions.py
    ├── galgebra.py
    ├── geometry
    |   ├── __init__.py
    |   ├── curve.py
    |   ├── ellipse.py
    |   ├── entity.py
    |   ├── exceptions.py
    |   ├── line.py
    |   ├── parabola.py
    |   ├── plane.py
    |   ├── point.py
    |   ├── polygon.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_curve.py
    |   |   ├── test_ellipse.py
    |   |   ├── test_entity.py
    |   |   ├── test_geometrysets.py
    |   |   ├── test_line.py
    |   |   ├── test_parabola.py
    |   |   ├── test_plane.py
    |   |   ├── test_point.py
    |   |   ├── test_polygon.py
    |   |   └── test_util.py
    |   └── util.py
    ├── holonomic
    |   ├── __init__.py
    |   ├── holonomic.py
    |   ├── holonomicerrors.py
    |   ├── numerical.py
    |   ├── recurrence.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_holonomic.py
    |       └── test_recurrence.py
    ├── integrals
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_integrate.py
    |   |   └── bench_trigintegrate.py
    |   ├── deltafunctions.py
    |   ├── heurisch.py
    |   ├── integrals.py
    |   ├── intpoly.py
    |   ├── manualintegrate.py
    |   ├── meijerint.py
    |   ├── meijerint_doc.py
    |   ├── prde.py
    |   ├── quadrature.py
    |   ├── rationaltools.py
    |   ├── rde.py
    |   ├── risch.py
    |   ├── rubi
    |   |   ├── __init__.py
    |   |   ├── constraints.py
    |   |   ├── parsetools
    |   |   |   ├── __init__.py
    |   |   |   ├── generate_rules.py
    |   |   |   ├── generate_tests.py
    |   |   |   ├── header.py.txt
    |   |   |   ├── parse.py
    |   |   |   └── tests
    |   |   ├── rubi_tests
    |   |   |   ├── __init__.py
    |   |   |   └── tests
    |   |   ├── rubimain.py
    |   |   ├── rules
    |   |   |   ├── __init__.py
    |   |   |   ├── binomial_products.py
    |   |   |   ├── exponential.py
    |   |   |   ├── hyperbolic.py
    |   |   |   ├── integrand_simplification.py
    |   |   |   ├── inverse_hyperbolic.py
    |   |   |   ├── inverse_trig.py
    |   |   |   ├── linear_products.py
    |   |   |   ├── logarithms.py
    |   |   |   ├── miscellaneous_algebraic.py
    |   |   |   ├── miscellaneous_integration.py
    |   |   |   ├── miscellaneous_trig.py
    |   |   |   ├── piecewise_linear.py
    |   |   |   ├── quadratic_products.py
    |   |   |   ├── secant.py
    |   |   |   ├── sine.py
    |   |   |   ├── special_functions.py
    |   |   |   ├── tangent.py
    |   |   |   └── trinomial_products.py
    |   |   ├── symbol.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_rubi_integrate.py
    |   |   |   └── test_utility_function.py
    |   |   └── utility_function.py
    |   ├── singularityfunctions.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_deltafunctions.py
    |   |   ├── test_failing_integrals.py
    |   |   ├── test_heurisch.py
    |   |   ├── test_integrals.py
    |   |   ├── test_intpoly.py
    |   |   ├── test_lineintegrals.py
    |   |   ├── test_manual.py
    |   |   ├── test_meijerint.py
    |   |   ├── test_prde.py
    |   |   ├── test_quadrature.py
    |   |   ├── test_rationaltools.py
    |   |   ├── test_rde.py
    |   |   ├── test_risch.py
    |   |   ├── test_singularityfunctions.py
    |   |   ├── test_transforms.py
    |   |   └── test_trigonometry.py
    |   ├── transforms.py
    |   └── trigonometry.py
    ├── interactive
    |   ├── __init__.py
    |   ├── ipythonprinting.py
    |   ├── printing.py
    |   ├── session.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_interactive.py
    |       ├── test_ipython.py
    |       └── test_ipythonprinting.py
    ├── liealgebras
    |   ├── __init__.py
    |   ├── cartan_matrix.py
    |   ├── cartan_type.py
    |   ├── dynkin_diagram.py
    |   ├── root_system.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_cartan_matrix.py
    |   |   ├── test_cartan_type.py
    |   |   ├── test_dynkin_diagram.py
    |   |   ├── test_root_system.py
    |   |   ├── test_type_A.py
    |   |   ├── test_type_B.py
    |   |   ├── test_type_C.py
    |   |   ├── test_type_D.py
    |   |   ├── test_type_E.py
    |   |   ├── test_type_F.py
    |   |   ├── test_type_G.py
    |   |   └── test_weyl_group.py
    |   ├── type_a.py
    |   ├── type_b.py
    |   ├── type_c.py
    |   ├── type_d.py
    |   ├── type_e.py
    |   ├── type_f.py
    |   ├── type_g.py
    |   └── weyl_group.py
    ├── logic
    |   ├── __init__.py
    |   ├── algorithms
    |   |   ├── __init__.py
    |   |   ├── dpll.py
    |   |   ├── dpll2.py
    |   |   ├── minisat22_wrapper.py
    |   |   └── pycosat_wrapper.py
    |   ├── boolalg.py
    |   ├── inference.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_boolalg.py
    |   |   ├── test_dimacs.py
    |   |   └── test_inference.py
    |   └── utilities
    |       ├── __init__.py
    |       └── dimacs.py
    ├── matrices
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_matrix.py
    |   ├── common.py
    |   ├── decompositions.py
    |   ├── dense.py
    |   ├── densearith.py
    |   ├── densesolve.py
    |   ├── densetools.py
    |   ├── determinant.py
    |   ├── eigen.py
    |   ├── expressions
    |   |   ├── __init__.py
    |   |   ├── adjoint.py
    |   |   ├── applyfunc.py
    |   |   ├── blockmatrix.py
    |   |   ├── companion.py
    |   |   ├── determinant.py
    |   |   ├── diagonal.py
    |   |   ├── dotproduct.py
    |   |   ├── factorizations.py
    |   |   ├── fourier.py
    |   |   ├── funcmatrix.py
    |   |   ├── hadamard.py
    |   |   ├── inverse.py
    |   |   ├── kronecker.py
    |   |   ├── matadd.py
    |   |   ├── matexpr.py
    |   |   ├── matmul.py
    |   |   ├── matpow.py
    |   |   ├── permutation.py
    |   |   ├── sets.py
    |   |   ├── slice.py
    |   |   ├── special.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_adjoint.py
    |   |   |   ├── test_applyfunc.py
    |   |   |   ├── test_blockmatrix.py
    |   |   |   ├── test_companion.py
    |   |   |   ├── test_derivatives.py
    |   |   |   ├── test_determinant.py
    |   |   |   ├── test_diagonal.py
    |   |   |   ├── test_dotproduct.py
    |   |   |   ├── test_factorizations.py
    |   |   |   ├── test_fourier.py
    |   |   |   ├── test_funcmatrix.py
    |   |   |   ├── test_hadamard.py
    |   |   |   ├── test_indexing.py
    |   |   |   ├── test_inverse.py
    |   |   |   ├── test_kronecker.py
    |   |   |   ├── test_matadd.py
    |   |   |   ├── test_matexpr.py
    |   |   |   ├── test_matmul.py
    |   |   |   ├── test_matpow.py
    |   |   |   ├── test_permutation.py
    |   |   |   ├── test_sets.py
    |   |   |   ├── test_slice.py
    |   |   |   ├── test_special.py
    |   |   |   ├── test_trace.py
    |   |   |   └── test_transpose.py
    |   |   ├── trace.py
    |   |   └── transpose.py
    |   ├── graph.py
    |   ├── immutable.py
    |   ├── inverse.py
    |   ├── matrices.py
    |   ├── normalforms.py
    |   ├── reductions.py
    |   ├── solvers.py
    |   ├── sparse.py
    |   ├── sparsetools.py
    |   ├── subspaces.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_commonmatrix.py
    |   |   ├── test_decompositions.py
    |   |   ├── test_densearith.py
    |   |   ├── test_densesolve.py
    |   |   ├── test_densetools.py
    |   |   ├── test_determinant.py
    |   |   ├── test_eigen.py
    |   |   ├── test_graph.py
    |   |   ├── test_immutable.py
    |   |   ├── test_interactions.py
    |   |   ├── test_matrices.py
    |   |   ├── test_normalforms.py
    |   |   ├── test_reductions.py
    |   |   ├── test_solvers.py
    |   |   ├── test_sparse.py
    |   |   ├── test_sparsetools.py
    |   |   └── test_subspaces.py
    |   └── utilities.py
    ├── multipledispatch
    |   ├── __init__.py
    |   ├── conflict.py
    |   ├── core.py
    |   ├── dispatcher.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_conflict.py
    |   |   ├── test_core.py
    |   |   └── test_dispatcher.py
    |   └── utils.py
    ├── ntheory
    |   ├── __init__.py
    |   ├── bbp_pi.py
    |   ├── continued_fraction.py
    |   ├── digits.py
    |   ├── ecm.py
    |   ├── egyptian_fraction.py
    |   ├── elliptic_curve.py
    |   ├── factor_.py
    |   ├── generate.py
    |   ├── modular.py
    |   ├── multinomial.py
    |   ├── partitions_.py
    |   ├── primetest.py
    |   ├── qs.py
    |   ├── residue_ntheory.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_bbp_pi.py
    |       ├── test_continued_fraction.py
    |       ├── test_digits.py
    |       ├── test_ecm.py
    |       ├── test_egyptian_fraction.py
    |       ├── test_elliptic_curve.py
    |       ├── test_factor_.py
    |       ├── test_generate.py
    |       ├── test_modular.py
    |       ├── test_multinomial.py
    |       ├── test_partitions.py
    |       ├── test_primetest.py
    |       ├── test_qs.py
    |       └── test_residue.py
    ├── parsing
    |   ├── __init__.py
    |   ├── ast_parser.py
    |   ├── autolev
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── autolevlexer.py
    |   |   |   ├── autolevlistener.py
    |   |   |   └── autolevparser.py
    |   |   ├── _listener_autolev_antlr.py
    |   |   ├── _parse_autolev_antlr.py
    |   |   └── test-examples
    |   |       ├── README.txt
    |   |       ├── pydy-example-repo
    |   |       ├── ruletest1.py
    |   |       ├── ruletest10.py
    |   |       ├── ruletest11.py
    |   |       ├── ruletest12.py
    |   |       ├── ruletest2.py
    |   |       ├── ruletest3.py
    |   |       ├── ruletest4.py
    |   |       ├── ruletest5.py
    |   |       ├── ruletest6.py
    |   |       ├── ruletest7.py
    |   |       ├── ruletest8.py
    |   |       └── ruletest9.py
    |   ├── c
    |   |   ├── __init__.py
    |   |   └── c_parser.py
    |   ├── fortran
    |   |   ├── __init__.py
    |   |   └── fortran_parser.py
    |   ├── latex
    |   |   ├── LICENSE.txt
    |   |   ├── __init__.py
    |   |   ├── _antlr
    |   |   |   ├── __init__.py
    |   |   |   ├── latexlexer.py
    |   |   |   └── latexparser.py
    |   |   ├── _build_latex_antlr.py
    |   |   ├── _parse_latex_antlr.py
    |   |   └── errors.py
    |   ├── mathematica.py
    |   ├── maxima.py
    |   ├── sym_expr.py
    |   ├── sympy_parser.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_ast_parser.py
    |       ├── test_autolev.py
    |       ├── test_c_parser.py
    |       ├── test_fortran_parser.py
    |       ├── test_implicit_multiplication_application.py
    |       ├── test_latex.py
    |       ├── test_latex_deps.py
    |       ├── test_mathematica.py
    |       ├── test_maxima.py
    |       ├── test_sym_expr.py
    |       └── test_sympy_parser.py
    ├── physics
    |   ├── __init__.py
    |   ├── continuum_mechanics
    |   |   ├── __init__.py
    |   |   ├── beam.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_beam.py
    |   ├── control
    |   |   ├── __init__.py
    |   |   ├── lti.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_lti.py
    |   ├── gaussopt.py
    |   ├── hep
    |   |   ├── __init__.py
    |   |   ├── gamma_matrices.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_gamma_matrices.py
    |   ├── hydrogen.py
    |   ├── matrices.py
    |   ├── mechanics
    |   |   ├── __init__.py
    |   |   ├── body.py
    |   |   ├── functions.py
    |   |   ├── kane.py
    |   |   ├── lagrange.py
    |   |   ├── linearize.py
    |   |   ├── models.py
    |   |   ├── particle.py
    |   |   ├── rigidbody.py
    |   |   ├── system.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_body.py
    |   |       ├── test_functions.py
    |   |       ├── test_kane.py
    |   |       ├── test_kane2.py
    |   |       ├── test_kane3.py
    |   |       ├── test_kane4.py
    |   |       ├── test_lagrange.py
    |   |       ├── test_lagrange2.py
    |   |       ├── test_linearize.py
    |   |       ├── test_models.py
    |   |       ├── test_particle.py
    |   |       ├── test_rigidbody.py
    |   |       └── test_system.py
    |   ├── optics
    |   |   ├── __init__.py
    |   |   ├── gaussopt.py
    |   |   ├── medium.py
    |   |   ├── polarization.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_gaussopt.py
    |   |   |   ├── test_medium.py
    |   |   |   ├── test_polarization.py
    |   |   |   ├── test_utils.py
    |   |   |   └── test_waves.py
    |   |   ├── utils.py
    |   |   └── waves.py
    |   ├── paulialgebra.py
    |   ├── pring.py
    |   ├── qho_1d.py
    |   ├── quantum
    |   |   ├── __init__.py
    |   |   ├── anticommutator.py
    |   |   ├── boson.py
    |   |   ├── cartesian.py
    |   |   ├── cg.py
    |   |   ├── circuitplot.py
    |   |   ├── circuitutils.py
    |   |   ├── commutator.py
    |   |   ├── constants.py
    |   |   ├── dagger.py
    |   |   ├── density.py
    |   |   ├── fermion.py
    |   |   ├── gate.py
    |   |   ├── grover.py
    |   |   ├── hilbert.py
    |   |   ├── identitysearch.py
    |   |   ├── innerproduct.py
    |   |   ├── matrixcache.py
    |   |   ├── matrixutils.py
    |   |   ├── operator.py
    |   |   ├── operatorordering.py
    |   |   ├── operatorset.py
    |   |   ├── pauli.py
    |   |   ├── piab.py
    |   |   ├── qapply.py
    |   |   ├── qasm.py
    |   |   ├── qexpr.py
    |   |   ├── qft.py
    |   |   ├── qubit.py
    |   |   ├── represent.py
    |   |   ├── sho1d.py
    |   |   ├── shor.py
    |   |   ├── spin.py
    |   |   ├── state.py
    |   |   ├── tensorproduct.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_anticommutator.py
    |   |       ├── test_boson.py
    |   |       ├── test_cartesian.py
    |   |       ├── test_cg.py
    |   |       ├── test_circuitplot.py
    |   |       ├── test_circuitutils.py
    |   |       ├── test_commutator.py
    |   |       ├── test_constants.py
    |   |       ├── test_dagger.py
    |   |       ├── test_density.py
    |   |       ├── test_fermion.py
    |   |       ├── test_gate.py
    |   |       ├── test_grover.py
    |   |       ├── test_hilbert.py
    |   |       ├── test_identitysearch.py
    |   |       ├── test_innerproduct.py
    |   |       ├── test_matrixutils.py
    |   |       ├── test_operator.py
    |   |       ├── test_operatorordering.py
    |   |       ├── test_operatorset.py
    |   |       ├── test_pauli.py
    |   |       ├── test_piab.py
    |   |       ├── test_printing.py
    |   |       ├── test_qapply.py
    |   |       ├── test_qasm.py
    |   |       ├── test_qexpr.py
    |   |       ├── test_qft.py
    |   |       ├── test_qubit.py
    |   |       ├── test_represent.py
    |   |       ├── test_sho1d.py
    |   |       ├── test_shor.py
    |   |       ├── test_spin.py
    |   |       ├── test_state.py
    |   |       └── test_tensorproduct.py
    |   ├── secondquant.py
    |   ├── sho.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_clebsch_gordan.py
    |   |   ├── test_hydrogen.py
    |   |   ├── test_paulialgebra.py
    |   |   ├── test_physics_matrices.py
    |   |   ├── test_pring.py
    |   |   ├── test_qho_1d.py
    |   |   ├── test_secondquant.py
    |   |   └── test_sho.py
    |   ├── units
    |   |   ├── __init__.py
    |   |   ├── definitions
    |   |   |   ├── __init__.py
    |   |   |   ├── dimension_definitions.py
    |   |   |   └── unit_definitions.py
    |   |   ├── dimensions.py
    |   |   ├── prefixes.py
    |   |   ├── quantities.py
    |   |   ├── systems
    |   |   |   ├── __init__.py
    |   |   |   ├── cgs.py
    |   |   |   ├── length_weight_time.py
    |   |   |   ├── mks.py
    |   |   |   ├── mksa.py
    |   |   |   ├── natural.py
    |   |   |   └── si.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dimensions.py
    |   |   |   ├── test_dimensionsystem.py
    |   |   |   ├── test_prefixes.py
    |   |   |   ├── test_quantities.py
    |   |   |   ├── test_unit_system_cgs_gauss.py
    |   |   |   ├── test_unitsystem.py
    |   |   |   └── test_util.py
    |   |   ├── unitsystem.py
    |   |   └── util.py
    |   ├── vector
    |   |   ├── __init__.py
    |   |   ├── dyadic.py
    |   |   ├── fieldfunctions.py
    |   |   ├── frame.py
    |   |   ├── functions.py
    |   |   ├── point.py
    |   |   ├── printing.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_dyadic.py
    |   |   |   ├── test_fieldfunctions.py
    |   |   |   ├── test_frame.py
    |   |   |   ├── test_functions.py
    |   |   |   ├── test_output.py
    |   |   |   ├── test_point.py
    |   |   |   ├── test_printing.py
    |   |   |   └── test_vector.py
    |   |   └── vector.py
    |   └── wigner.py
    ├── plotting
    |   ├── __init__.py
    |   ├── experimental_lambdify.py
    |   ├── intervalmath
    |   |   ├── __init__.py
    |   |   ├── interval_arithmetic.py
    |   |   ├── interval_membership.py
    |   |   ├── lib_interval.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_interval_functions.py
    |   |       ├── test_interval_membership.py
    |   |       └── test_intervalmath.py
    |   ├── plot.py
    |   ├── plot_implicit.py
    |   ├── pygletplot
    |   |   ├── __init__.py
    |   |   ├── color_scheme.py
    |   |   ├── managed_window.py
    |   |   ├── plot.py
    |   |   ├── plot_axes.py
    |   |   ├── plot_camera.py
    |   |   ├── plot_controller.py
    |   |   ├── plot_curve.py
    |   |   ├── plot_interval.py
    |   |   ├── plot_mode.py
    |   |   ├── plot_mode_base.py
    |   |   ├── plot_modes.py
    |   |   ├── plot_object.py
    |   |   ├── plot_rotation.py
    |   |   ├── plot_surface.py
    |   |   ├── plot_window.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_plotting.py
    |   |   └── util.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_experimental_lambdify.py
    |   |   ├── test_plot.py
    |   |   ├── test_plot_implicit.py
    |   |   └── test_textplot.py
    |   └── textplot.py
    ├── polys
    |   ├── __init__.py
    |   ├── agca
    |   |   ├── __init__.py
    |   |   ├── extensions.py
    |   |   ├── homomorphisms.py
    |   |   ├── ideals.py
    |   |   ├── modules.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_extensions.py
    |   |       ├── test_homomorphisms.py
    |   |       ├── test_ideals.py
    |   |       └── test_modules.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_galoispolys.py
    |   |   ├── bench_groebnertools.py
    |   |   └── bench_solvers.py
    |   ├── compatibility.py
    |   ├── constructor.py
    |   ├── densearith.py
    |   ├── densebasic.py
    |   ├── densetools.py
    |   ├── dispersion.py
    |   ├── distributedmodules.py
    |   ├── domainmatrix.py
    |   ├── domains
    |   |   ├── __init__.py
    |   |   ├── algebraicfield.py
    |   |   ├── characteristiczero.py
    |   |   ├── complexfield.py
    |   |   ├── compositedomain.py
    |   |   ├── domain.py
    |   |   ├── domainelement.py
    |   |   ├── expressiondomain.py
    |   |   ├── field.py
    |   |   ├── finitefield.py
    |   |   ├── fractionfield.py
    |   |   ├── gaussiandomains.py
    |   |   ├── gmpyfinitefield.py
    |   |   ├── gmpyintegerring.py
    |   |   ├── gmpyrationalfield.py
    |   |   ├── groundtypes.py
    |   |   ├── integerring.py
    |   |   ├── modularinteger.py
    |   |   ├── mpelements.py
    |   |   ├── old_fractionfield.py
    |   |   ├── old_polynomialring.py
    |   |   ├── polynomialring.py
    |   |   ├── pythonfinitefield.py
    |   |   ├── pythonintegerring.py
    |   |   ├── pythonrational.py
    |   |   ├── pythonrationalfield.py
    |   |   ├── quotientring.py
    |   |   ├── rationalfield.py
    |   |   ├── realfield.py
    |   |   ├── ring.py
    |   |   ├── simpledomain.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_domains.py
    |   |       ├── test_polynomialring.py
    |   |       └── test_quotientring.py
    |   ├── euclidtools.py
    |   ├── factortools.py
    |   ├── fglmtools.py
    |   ├── fields.py
    |   ├── galoistools.py
    |   ├── groebnertools.py
    |   ├── heuristicgcd.py
    |   ├── matrices
    |   |   ├── __init__.py
    |   |   ├── ddm.py
    |   |   ├── dense.py
    |   |   ├── domainmatrix.py
    |   |   ├── domainscalar.py
    |   |   ├── eigen.py
    |   |   ├── exceptions.py
    |   |   ├── linsolve.py
    |   |   ├── normalforms.py
    |   |   ├── sdm.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_ddm.py
    |   |       ├── test_dense.py
    |   |       ├── test_domainmatrix.py
    |   |       ├── test_domainscalar.py
    |   |       ├── test_eigen.py
    |   |       ├── test_linsolve.py
    |   |       ├── test_normalforms.py
    |   |       └── test_sdm.py
    |   ├── modulargcd.py
    |   ├── monomials.py
    |   ├── multivariate_resultants.py
    |   ├── numberfields.py
    |   ├── orderings.py
    |   ├── orthopolys.py
    |   ├── partfrac.py
    |   ├── polyclasses.py
    |   ├── polyconfig.py
    |   ├── polyerrors.py
    |   ├── polyfuncs.py
    |   ├── polymatrix.py
    |   ├── polyoptions.py
    |   ├── polyquinticconst.py
    |   ├── polyroots.py
    |   ├── polytools.py
    |   ├── polyutils.py
    |   ├── rationaltools.py
    |   ├── ring_series.py
    |   ├── rings.py
    |   ├── rootisolation.py
    |   ├── rootoftools.py
    |   ├── solvers.py
    |   ├── specialpolys.py
    |   ├── sqfreetools.py
    |   ├── subresultants_qq_zz.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constructor.py
    |       ├── test_densearith.py
    |       ├── test_densebasic.py
    |       ├── test_densetools.py
    |       ├── test_dispersion.py
    |       ├── test_distributedmodules.py
    |       ├── test_euclidtools.py
    |       ├── test_factortools.py
    |       ├── test_fields.py
    |       ├── test_galoistools.py
    |       ├── test_groebnertools.py
    |       ├── test_heuristicgcd.py
    |       ├── test_injections.py
    |       ├── test_modulargcd.py
    |       ├── test_monomials.py
    |       ├── test_multivariate_resultants.py
    |       ├── test_numberfields.py
    |       ├── test_orderings.py
    |       ├── test_orthopolys.py
    |       ├── test_partfrac.py
    |       ├── test_polyclasses.py
    |       ├── test_polyfuncs.py
    |       ├── test_polymatrix.py
    |       ├── test_polyoptions.py
    |       ├── test_polyroots.py
    |       ├── test_polytools.py
    |       ├── test_polyutils.py
    |       ├── test_pythonrational.py
    |       ├── test_rationaltools.py
    |       ├── test_ring_series.py
    |       ├── test_rings.py
    |       ├── test_rootisolation.py
    |       ├── test_rootoftools.py
    |       ├── test_solvers.py
    |       ├── test_specialpolys.py
    |       ├── test_sqfreetools.py
    |       └── test_subresultants_qq_zz.py
    ├── printing
    |   ├── __init__.py
    |   ├── aesaracode.py
    |   ├── c.py
    |   ├── ccode.py
    |   ├── codeprinter.py
    |   ├── conventions.py
    |   ├── cxx.py
    |   ├── cxxcode.py
    |   ├── defaults.py
    |   ├── dot.py
    |   ├── fcode.py
    |   ├── fortran.py
    |   ├── glsl.py
    |   ├── gtk.py
    |   ├── jscode.py
    |   ├── julia.py
    |   ├── lambdarepr.py
    |   ├── latex.py
    |   ├── llvmjitcode.py
    |   ├── maple.py
    |   ├── mathematica.py
    |   ├── mathml.py
    |   ├── numpy.py
    |   ├── octave.py
    |   ├── precedence.py
    |   ├── pretty
    |   |   ├── __init__.py
    |   |   ├── pretty.py
    |   |   ├── pretty_symbology.py
    |   |   ├── stringpict.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_pretty.py
    |   ├── preview.py
    |   ├── printer.py
    |   ├── pycode.py
    |   ├── python.py
    |   ├── rcode.py
    |   ├── repr.py
    |   ├── rust.py
    |   ├── str.py
    |   ├── tableform.py
    |   ├── tensorflow.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_aesaracode.py
    |   |   ├── test_c.py
    |   |   ├── test_codeprinter.py
    |   |   ├── test_conventions.py
    |   |   ├── test_cupy.py
    |   |   ├── test_cxx.py
    |   |   ├── test_dot.py
    |   |   ├── test_fortran.py
    |   |   ├── test_glsl.py
    |   |   ├── test_gtk.py
    |   |   ├── test_jscode.py
    |   |   ├── test_julia.py
    |   |   ├── test_lambdarepr.py
    |   |   ├── test_latex.py
    |   |   ├── test_llvmjit.py
    |   |   ├── test_maple.py
    |   |   ├── test_mathematica.py
    |   |   ├── test_mathml.py
    |   |   ├── test_numpy.py
    |   |   ├── test_octave.py
    |   |   ├── test_precedence.py
    |   |   ├── test_preview.py
    |   |   ├── test_pycode.py
    |   |   ├── test_python.py
    |   |   ├── test_rcode.py
    |   |   ├── test_repr.py
    |   |   ├── test_rust.py
    |   |   ├── test_str.py
    |   |   ├── test_tableform.py
    |   |   ├── test_tensorflow.py
    |   |   ├── test_theanocode.py
    |   |   └── test_tree.py
    |   ├── theanocode.py
    |   └── tree.py
    ├── release.py
    ├── sandbox
    |   ├── __init__.py
    |   ├── indexed_integrals.py
    |   └── tests
    |       ├── __init__.py
    |       └── test_indexed_integrals.py
    ├── series
    |   ├── __init__.py
    |   ├── acceleration.py
    |   ├── approximants.py
    |   ├── aseries.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   ├── bench_limit.py
    |   |   └── bench_order.py
    |   ├── formal.py
    |   ├── fourier.py
    |   ├── gruntz.py
    |   ├── kauers.py
    |   ├── limits.py
    |   ├── limitseq.py
    |   ├── order.py
    |   ├── residues.py
    |   ├── sequences.py
    |   ├── series.py
    |   ├── series_class.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_approximants.py
    |       ├── test_aseries.py
    |       ├── test_demidovich.py
    |       ├── test_formal.py
    |       ├── test_fourier.py
    |       ├── test_gruntz.py
    |       ├── test_kauers.py
    |       ├── test_limits.py
    |       ├── test_limitseq.py
    |       ├── test_lseries.py
    |       ├── test_nseries.py
    |       ├── test_order.py
    |       ├── test_residues.py
    |       ├── test_sequences.py
    |       └── test_series.py
    ├── sets
    |   ├── __init__.py
    |   ├── conditionset.py
    |   ├── contains.py
    |   ├── fancysets.py
    |   ├── handlers
    |   |   ├── __init__.py
    |   |   ├── add.py
    |   |   ├── comparison.py
    |   |   ├── functions.py
    |   |   ├── intersection.py
    |   |   ├── issubset.py
    |   |   ├── mul.py
    |   |   ├── power.py
    |   |   └── union.py
    |   ├── ordinals.py
    |   ├── powerset.py
    |   ├── setexpr.py
    |   ├── sets.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_conditionset.py
    |       ├── test_contains.py
    |       ├── test_fancysets.py
    |       ├── test_ordinals.py
    |       ├── test_powerset.py
    |       ├── test_setexpr.py
    |       └── test_sets.py
    ├── simplify
    |   ├── __init__.py
    |   ├── combsimp.py
    |   ├── cse_main.py
    |   ├── cse_opts.py
    |   ├── epathtools.py
    |   ├── fu.py
    |   ├── gammasimp.py
    |   ├── hyperexpand.py
    |   ├── hyperexpand_doc.py
    |   ├── powsimp.py
    |   ├── radsimp.py
    |   ├── ratsimp.py
    |   ├── simplify.py
    |   ├── sqrtdenest.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_combsimp.py
    |   |   ├── test_cse.py
    |   |   ├── test_epathtools.py
    |   |   ├── test_fu.py
    |   |   ├── test_function.py
    |   |   ├── test_gammasimp.py
    |   |   ├── test_hyperexpand.py
    |   |   ├── test_powsimp.py
    |   |   ├── test_radsimp.py
    |   |   ├── test_ratsimp.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_simplify.py
    |   |   ├── test_sqrtdenest.py
    |   |   ├── test_traversaltools.py
    |   |   └── test_trigsimp.py
    |   ├── traversaltools.py
    |   └── trigsimp.py
    ├── solvers
    |   ├── __init__.py
    |   ├── benchmarks
    |   |   ├── __init__.py
    |   |   └── bench_solvers.py
    |   ├── bivariate.py
    |   ├── decompogen.py
    |   ├── deutils.py
    |   ├── diophantine
    |   |   ├── __init__.py
    |   |   ├── diophantine.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       └── test_diophantine.py
    |   ├── inequalities.py
    |   ├── ode
    |   |   ├── __init__.py
    |   |   ├── ode.py
    |   |   ├── single.py
    |   |   ├── subscheck.py
    |   |   ├── systems.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_lie_group.py
    |   |       ├── test_ode.py
    |   |       ├── test_single.py
    |   |       ├── test_subscheck.py
    |   |       └── test_systems.py
    |   ├── pde.py
    |   ├── polysys.py
    |   ├── recurr.py
    |   ├── solvers.py
    |   ├── solveset.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_constantsimp.py
    |       ├── test_decompogen.py
    |       ├── test_inequalities.py
    |       ├── test_numeric.py
    |       ├── test_pde.py
    |       ├── test_polysys.py
    |       ├── test_recurr.py
    |       ├── test_solvers.py
    |       └── test_solveset.py
    ├── stats
    |   ├── __init__.py
    |   ├── compound_rv.py
    |   ├── crv.py
    |   ├── crv_types.py
    |   ├── drv.py
    |   ├── drv_types.py
    |   ├── error_prop.py
    |   ├── frv.py
    |   ├── frv_types.py
    |   ├── joint_rv.py
    |   ├── joint_rv_types.py
    |   ├── matrix_distributions.py
    |   ├── random_matrix.py
    |   ├── random_matrix_models.py
    |   ├── rv.py
    |   ├── rv_interface.py
    |   ├── sampling
    |   |   ├── __init__.py
    |   |   ├── sample_numpy.py
    |   |   ├── sample_pymc3.py
    |   |   ├── sample_scipy.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_sample_continuous_rv.py
    |   |       ├── test_sample_discrete_rv.py
    |   |       └── test_sample_finite_rv.py
    |   ├── stochastic_process.py
    |   ├── stochastic_process_types.py
    |   ├── symbolic_multivariate_probability.py
    |   ├── symbolic_probability.py
    |   └── tests
    |       ├── __init__.py
    |       ├── test_compound_rv.py
    |       ├── test_continuous_rv.py
    |       ├── test_discrete_rv.py
    |       ├── test_error_prop.py
    |       ├── test_finite_rv.py
    |       ├── test_joint_rv.py
    |       ├── test_matrix_distributions.py
    |       ├── test_mix.py
    |       ├── test_random_matrix.py
    |       ├── test_rv.py
    |       ├── test_stochastic_process.py
    |       ├── test_symbolic_multivariate.py
    |       └── test_symbolic_probability.py
    ├── strategies
    |   ├── __init__.py
    |   ├── branch
    |   |   ├── __init__.py
    |   |   ├── core.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   ├── test_core.py
    |   |   |   ├── test_tools.py
    |   |   |   └── test_traverse.py
    |   |   ├── tools.py
    |   |   └── traverse.py
    |   ├── core.py
    |   ├── rl.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_core.py
    |   |   ├── test_rl.py
    |   |   ├── test_strat.py
    |   |   ├── test_tools.py
    |   |   ├── test_traverse.py
    |   |   └── test_tree.py
    |   ├── tools.py
    |   ├── traverse.py
    |   ├── tree.py
    |   └── util.py
    ├── tensor
    |   ├── __init__.py
    |   ├── array
    |   |   ├── __init__.py
    |   |   ├── array_comprehension.py
    |   |   ├── array_derivatives.py
    |   |   ├── arrayop.py
    |   |   ├── dense_ndim_array.py
    |   |   ├── expressions
    |   |   |   ├── __init__.py
    |   |   |   ├── array_expressions.py
    |   |   |   ├── arrayexpr_derivatives.py
    |   |   |   ├── conv_array_to_matrix.py
    |   |   |   ├── conv_indexed_to_array.py
    |   |   |   ├── conv_matrix_to_array.py
    |   |   |   ├── tests
    |   |   |   └── utils.py
    |   |   ├── mutable_ndim_array.py
    |   |   ├── ndim_array.py
    |   |   ├── sparse_ndim_array.py
    |   |   └── tests
    |   |       ├── __init__.py
    |   |       ├── test_array_comprehension.py
    |   |       ├── test_array_derivatives.py
    |   |       ├── test_arrayop.py
    |   |       ├── test_immutable_ndim_array.py
    |   |       ├── test_mutable_ndim_array.py
    |   |       ├── test_ndim_array.py
    |   |       └── test_ndim_array_conversions.py
    |   ├── functions.py
    |   ├── index_methods.py
    |   ├── indexed.py
    |   ├── tensor.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_functions.py
    |   |   ├── test_index_methods.py
    |   |   ├── test_indexed.py
    |   |   ├── test_tensor.py
    |   |   ├── test_tensor_element.py
    |   |   └── test_tensor_operators.py
    |   └── toperators.py
    ├── testing
    |   ├── __init__.py
    |   ├── benchmarking.py
    |   ├── matrices.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── diagnose_imports.py
    |   |   ├── test_code_quality.py
    |   |   ├── test_module_imports.py
    |   |   └── test_pytest.py
    |   └── tmpfiles.py
    ├── this.py
    ├── unify
    |   ├── __init__.py
    |   ├── core.py
    |   ├── rewrite.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_rewrite.py
    |   |   ├── test_sympy.py
    |   |   └── test_unify.py
    |   └── usympy.py
    ├── utilities
    |   ├── __init__.py
    |   ├── _compilation
    |   |   ├── __init__.py
    |   |   ├── availability.py
    |   |   ├── compilation.py
    |   |   ├── runners.py
    |   |   ├── tests
    |   |   |   ├── __init__.py
    |   |   |   └── test_compilation.py
    |   |   └── util.py
    |   ├── autowrap.py
    |   ├── benchmarking.py
    |   ├── codegen.py
    |   ├── decorator.py
    |   ├── enumerative.py
    |   ├── exceptions.py
    |   ├── iterables.py
    |   ├── lambdify.py
    |   ├── magic.py
    |   ├── matchpy_connector.py
    |   ├── mathml
    |   |   ├── __init__.py
    |   |   └── data
    |   ├── memoization.py
    |   ├── misc.py
    |   ├── pkgdata.py
    |   ├── pytest.py
    |   ├── quality_unicode.py
    |   ├── randtest.py
    |   ├── runtests.py
    |   ├── source.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── test_autowrap.py
    |   |   ├── test_codegen.py
    |   |   ├── test_codegen_julia.py
    |   |   ├── test_codegen_octave.py
    |   |   ├── test_codegen_rust.py
    |   |   ├── test_decorator.py
    |   |   ├── test_deprecated.py
    |   |   ├── test_enumerative.py
    |   |   ├── test_iterables.py
    |   |   ├── test_lambdify.py
    |   |   ├── test_matchpy_connector.py
    |   |   ├── test_misc.py
    |   |   ├── test_pickling.py
    |   |   ├── test_source.py
    |   |   ├── test_timeutils.py
    |   |   └── test_wester.py
    |   ├── timeutils.py
    |   └── tmpfiles.py
    └── vector
        ├── __init__.py
        ├── basisdependent.py
        ├── coordsysrect.py
        ├── deloperator.py
        ├── dyadic.py
        ├── functions.py
        ├── implicitregion.py
        ├── integrals.py
        ├── operators.py
        ├── orienters.py
        ├── parametricregion.py
        ├── point.py
        ├── scalar.py
        ├── tests
        |   ├── __init__.py
        |   ├── test_coordsysrect.py
        |   ├── test_dyadic.py
        |   ├── test_field_functions.py
        |   ├── test_functions.py
        |   ├── test_implicitregion.py
        |   ├── test_integrals.py
        |   ├── test_operators.py
        |   ├── test_parametricregion.py
        |   ├── test_printing.py
        |   └── test_vector.py
        └── vector.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: bug in is_subset(Reals)

Description: Solving issue #19513 has given rise to another bug.
Now:
```
In [8]: S1 = imageset(Lambda(n, n + (n - 1)*(n + 1)*I), S.Integers)

In [9]: S1
Out[9]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [10]: 2 in S1
Out[10]: False

In [11]: 2 in S1.intersect(Reals)
Out[11]: True
```
This output is incorrect.

Correct output is:
```
In [4]: S1
Out[4]: {n + ⅈ⋅(n - 1)⋅(n + 1) │ n ∊ ℤ}

In [5]: 2 in S1
Out[5]: False

In [6]: 2 in S1.intersect(Reals)
Out[6]: False

In [7]: S2 = Reals

In [8]: S1.intersect(S2)
Out[8]: {-1, 1}
```

Patch information:
diff --git a/sympy/sets/handlers/intersection.py b/sympy/sets/handlers/intersection.py
index c54dc8f72a..d013b03983 100644
--- a/sympy/sets/handlers/intersection.py
+++ b/sympy/sets/handlers/intersection.py
@@ -303,22 +303,28 @@ def intersection_sets(self, other): # noqa:F811
         elif ifree != {n}:
             return None
         else:
-            # univarite imaginary part in same variable
-            x, xis = zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols])
-            if x and all(i == n for i in x):
-                base_set -= FiniteSet(xis)
+            # univariate imaginary part in same variable
+            x_xis = [solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]
+            if x_xis:
+                x, xis = zip(*x_xis)
+                if x and all(i == n for i in x):
+                    base_set = base_set.intersect(FiniteSet(*xis))
+                else:
+                    base_set = ConditionSet(n, Eq(im, 0), base_set)
             else:
-                base_set -= ConditionSet(n, Eq(im, 0), S.Integers)
+                base_set = ConditionSet(n, Eq(im, 0), base_set)
         # exclude values that make denominators 0
-        for i in denoms(f):
-            if i.has(n):
-                sol = list(zip(*[solve_linear(i, 0) for i in Mul.make_args(im) if n in i.free_symbols]))
-                if sol != []:
-                    x, xis = sol
+        for d in denoms(f):
+            if d.has(n):
+                sol_pairs = [solve_linear(j, 0) for j in Mul.make_args(d) if n in j.free_symbols]
+                if sol_pairs:
+                    x, xis = zip(*sol_pairs)
                     if x and all(i == n for i in x):
-                        base_set -= FiniteSet(xis)
+                        base_set = base_set - FiniteSet(*xis)
+                    else:
+                        base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
                 else:
-                    base_set -= ConditionSet(n, Eq(i, 0), S.Integers)
+                    base_set = base_set - ConditionSet(n, Eq(d, 0), S.Integers)
         return imageset(lam, base_set)
 
     elif isinstance(other, Interval):


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `sympy/sets/tests/test_sets.py`.
Extra Requirements: 
Purpose: I need to find 3 relevant test cases that demonstrate the functionality related to the bug in `ImageSet` intersection.

Previous refined query 2:
Essential Query: Please provide the rest of the content of the file `sympy/sets/tests/test_sets.py` from line 501 to the end.
Extra Requirements: If the file is too large, please prioritize providing any test functions that contain both "ImageSet" or "imageset" and "intersect" or "Intersection".
Purpose: This additional context is necessary to find existing test cases that cover the intersection of `ImageSet` with other sets, which is the core of the user's issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sympy/sets/tests/test_sets.py
Line number range: 1 - 500
Content:
1. from sympy import (Symbol, Set, Union, Interval, oo, S, sympify, nan,
2.     Max, Min, Float, DisjointUnion,
3.     FiniteSet, Intersection, imageset, I, true, false, ProductSet,
4.     sqrt, Complement, EmptySet, sin, cos, Lambda, ImageSet, pi,
5.     Pow, Contains, Sum, rootof, SymmetricDifference, Piecewise,
6.     Matrix, Range, Add, symbols, zoo, Rational)
7. from mpmath import mpi
8. 
9. from sympy.core.expr import unchanged
10. from sympy.core.relational import Eq, Ne, Le, Lt, LessThan
11. from sympy.logic import And, Or, Xor
12. from sympy.testing.pytest import raises, XFAIL, warns_deprecated_sympy
13. 
14. from sympy.abc import x, y, z, m, n
15. 
16. 
17. def test_imageset():
18.     ints = S.Integers
19.     assert imageset(x, x - 1, S.Naturals) is S.Naturals0
20.     assert imageset(x, x + 1, S.Naturals0) is S.Naturals
21.     assert imageset(x, abs(x), S.Naturals0) is S.Naturals0
22.     assert imageset(x, abs(x), S.Naturals) is S.Naturals
23.     assert imageset(x, abs(x), S.Integers) is S.Naturals0
24.     # issue 16878a
25.     r = symbols('r', real=True)
26.     assert imageset(x, (x, x), S.Reals)._contains((1, r)) == None
27.     assert imageset(x, (x, x), S.Reals)._contains((1, 2)) == False
28.     assert (r, r) in imageset(x, (x, x), S.Reals)
29.     assert 1 + I in imageset(x, x + I, S.Reals)
30.     assert {1} not in imageset(x, (x,), S.Reals)
31.     assert (1, 1) not in imageset(x, (x,) , S.Reals)
32.     raises(TypeError, lambda: imageset(x, ints))
33.     raises(ValueError, lambda: imageset(x, y, z, ints))
34.     raises(ValueError, lambda: imageset(Lambda(x, cos(x)), y))
35.     assert (1, 2) in imageset(Lambda((x, y), (x, y)), ints, ints)
36.     raises(ValueError, lambda: imageset(Lambda(x, x), ints, ints))
37.     assert imageset(cos, ints) == ImageSet(Lambda(x, cos(x)), ints)
38.     def f(x):
39.         return cos(x)
40.     assert imageset(f, ints) == imageset(x, cos(x), ints)
41.     f = lambda x: cos(x)
42.     assert imageset(f, ints) == ImageSet(Lambda(x, cos(x)), ints)
43.     assert imageset(x, 1, ints) == FiniteSet(1)
44.     assert imageset(x, y, ints) == {y}
45.     assert imageset((x, y), (1, z), ints, S.Reals) == {(1, z)}
46.     clash = Symbol('x', integer=true)
47.     assert (str(imageset(lambda x: x + clash, Interval(-2, 1)).lamda.expr)
48.         in ('x0 + x', 'x + x0'))
49.     x1, x2 = symbols("x1, x2")
50.     assert imageset(lambda x, y:
51.         Add(x, y), Interval(1, 2), Interval(2, 3)).dummy_eq(
52.         ImageSet(Lambda((x1, x2), x1 + x2),
53.         Interval(1, 2), Interval(2, 3)))
54. 
55. 
56. def test_is_empty():
57.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
58.             S.UniversalSet]:
59.         assert s.is_empty is False
60. 
61.     assert S.EmptySet.is_empty is True
62. 
63. 
64. def test_is_finiteset():
65.     for s in [S.Naturals, S.Naturals0, S.Integers, S.Rationals, S.Reals,
66.             S.UniversalSet]:
67.         assert s.is_finite_set is False
68. 
69.     assert S.EmptySet.is_finite_set is True
70. 
71.     assert FiniteSet(1, 2).is_finite_set is True
72.     assert Interval(1, 2).is_finite_set is False
73.     assert Interval(x, y).is_finite_set is None
74.     assert ProductSet(FiniteSet(1), FiniteSet(2)).is_finite_set is True
75.     assert ProductSet(FiniteSet(1), Interval(1, 2)).is_finite_set is False
76.     assert ProductSet(FiniteSet(1), Interval(x, y)).is_finite_set is None
77.     assert Union(Interval(0, 1), Interval(2, 3)).is_finite_set is False
78.     assert Union(FiniteSet(1), Interval(2, 3)).is_finite_set is False
79.     assert Union(FiniteSet(1), FiniteSet(2)).is_finite_set is True
80.     assert Union(FiniteSet(1), Interval(x, y)).is_finite_set is None
81.     assert Intersection(Interval(x, y), FiniteSet(1)).is_finite_set is True
82.     assert Intersection(Interval(x, y), Interval(1, 2)).is_finite_set is None
83.     assert Intersection(FiniteSet(x), FiniteSet(y)).is_finite_set is True
84.     assert Complement(FiniteSet(1), Interval(x, y)).is_finite_set is True
85.     assert Complement(Interval(x, y), FiniteSet(1)).is_finite_set is None
86.     assert Complement(Interval(1, 2), FiniteSet(x)).is_finite_set is False
87.     assert DisjointUnion(Interval(-5, 3), FiniteSet(x, y)).is_finite_set is False
88.     assert DisjointUnion(S.EmptySet, FiniteSet(x, y), S.EmptySet).is_finite_set is True
89. 
90. 
91. def test_deprecated_is_EmptySet():
92.     with warns_deprecated_sympy():
93.         S.EmptySet.is_EmptySet
94. 
95. 
96. def test_interval_arguments():
97.     assert Interval(0, oo) == Interval(0, oo, False, True)
98.     assert Interval(0, oo).right_open is true
99.     assert Interval(-oo, 0) == Interval(-oo, 0, True, False)
100.     assert Interval(-oo, 0).left_open is true
101.     assert Interval(oo, -oo) == S.EmptySet
102.     assert Interval(oo, oo) == S.EmptySet
103.     assert Interval(-oo, -oo) == S.EmptySet
104.     assert Interval(oo, x) == S.EmptySet
105.     assert Interval(oo, oo) == S.EmptySet
106.     assert Interval(x, -oo) == S.EmptySet
107.     assert Interval(x, x) == {x}
108. 
109.     assert isinstance(Interval(1, 1), FiniteSet)
110.     e = Sum(x, (x, 1, 3))
111.     assert isinstance(Interval(e, e), FiniteSet)
112. 
113.     assert Interval(1, 0) == S.EmptySet
114.     assert Interval(1, 1).measure == 0
115. 
116.     assert Interval(1, 1, False, True) == S.EmptySet
117.     assert Interval(1, 1, True, False) == S.EmptySet
118.     assert Interval(1, 1, True, True) == S.EmptySet
119. 
120. 
121.     assert isinstance(Interval(0, Symbol('a')), Interval)
122.     assert Interval(Symbol('a', real=True, positive=True), 0) == S.EmptySet
123.     raises(ValueError, lambda: Interval(0, S.ImaginaryUnit))
124.     raises(ValueError, lambda: Interval(0, Symbol('z', extended_real=False)))
125.     raises(ValueError, lambda: Interval(x, x + S.ImaginaryUnit))
126. 
127.     raises(NotImplementedError, lambda: Interval(0, 1, And(x, y)))
128.     raises(NotImplementedError, lambda: Interval(0, 1, False, And(x, y)))
129.     raises(NotImplementedError, lambda: Interval(0, 1, z, And(x, y)))
130. 
131. 
132. def test_interval_symbolic_end_points():
133.     a = Symbol('a', real=True)
134. 
135.     assert Union(Interval(0, a), Interval(0, 3)).sup == Max(a, 3)
136.     assert Union(Interval(a, 0), Interval(-3, 0)).inf == Min(-3, a)
137. 
138.     assert Interval(0, a).contains(1) == LessThan(1, a)
139. 
140. 
141. def test_interval_is_empty():
142.     x, y = symbols('x, y')
143.     r = Symbol('r', real=True)
144.     p = Symbol('p', positive=True)
145.     n = Symbol('n', negative=True)
146.     nn = Symbol('nn', nonnegative=True)
147.     assert Interval(1, 2).is_empty == False
148.     assert Interval(3, 3).is_empty == False  # FiniteSet
149.     assert Interval(r, r).is_empty == False  # FiniteSet
150.     assert Interval(r, r + nn).is_empty == False
151.     assert Interval(x, x).is_empty == False
152.     assert Interval(1, oo).is_empty == False
153.     assert Interval(-oo, oo).is_empty == False
154.     assert Interval(-oo, 1).is_empty == False
155.     assert Interval(x, y).is_empty == None
156.     assert Interval(r, oo).is_empty == False  # real implies finite
157.     assert Interval(n, 0).is_empty == False
158.     assert Interval(n, 0, left_open=True).is_empty == False
159.     assert Interval(p, 0).is_empty == True  # EmptySet
160.     assert Interval(nn, 0).is_empty == None
161.     assert Interval(n, p).is_empty == False
162.     assert Interval(0, p, left_open=True).is_empty == False
163.     assert Interval(0, p, right_open=True).is_empty == False
164.     assert Interval(0, nn, left_open=True).is_empty == None
165.     assert Interval(0, nn, right_open=True).is_empty == None
166. 
167. 
168. def test_union():
169.     assert Union(Interval(1, 2), Interval(2, 3)) == Interval(1, 3)
170.     assert Union(Interval(1, 2), Interval(2, 3, True)) == Interval(1, 3)
171.     assert Union(Interval(1, 3), Interval(2, 4)) == Interval(1, 4)
172.     assert Union(Interval(1, 2), Interval(1, 3)) == Interval(1, 3)
173.     assert Union(Interval(1, 3), Interval(1, 2)) == Interval(1, 3)
174.     assert Union(Interval(1, 3, False, True), Interval(1, 2)) == \
175.         Interval(1, 3, False, True)
176.     assert Union(Interval(1, 3), Interval(1, 2, False, True)) == Interval(1, 3)
177.     assert Union(Interval(1, 2, True), Interval(1, 3)) == Interval(1, 3)
178.     assert Union(Interval(1, 2, True), Interval(1, 3, True)) == \
179.         Interval(1, 3, True)
180.     assert Union(Interval(1, 2, True), Interval(1, 3, True, True)) == \
181.         Interval(1, 3, True, True)
182.     assert Union(Interval(1, 2, True, True), Interval(1, 3, True)) == \
183.         Interval(1, 3, True)
184.     assert Union(Interval(1, 3), Interval(2, 3)) == Interval(1, 3)
185.     assert Union(Interval(1, 3, False, True), Interval(2, 3)) == \
186.         Interval(1, 3)
187.     assert Union(Interval(1, 2, False, True), Interval(2, 3, True)) != \
188.         Interval(1, 3)
189.     assert Union(Interval(1, 2), S.EmptySet) == Interval(1, 2)
190.     assert Union(S.EmptySet) == S.EmptySet
191. 
192.     assert Union(Interval(0, 1), *[FiniteSet(1.0/n) for n in range(1, 10)]) == \
193.         Interval(0, 1)
194.     # issue #18241:
195.     x = Symbol('x')
196.     assert Union(Interval(0, 1), FiniteSet(1, x)) == Union(
197.         Interval(0, 1), FiniteSet(x))
198.     assert unchanged(Union, Interval(0, 1), FiniteSet(2, x))
199. 
200.     assert Interval(1, 2).union(Interval(2, 3)) == \
201.         Interval(1, 2) + Interval(2, 3)
202. 
203.     assert Interval(1, 2).union(Interval(2, 3)) == Interval(1, 3)
204. 
205.     assert Union(Set()) == Set()
206. 
207.     assert FiniteSet(1) + FiniteSet(2) + FiniteSet(3) == FiniteSet(1, 2, 3)
208.     assert FiniteSet('ham') + FiniteSet('eggs') == FiniteSet('ham', 'eggs')
209.     assert FiniteSet(1, 2, 3) + S.EmptySet == FiniteSet(1, 2, 3)
210. 
211.     assert FiniteSet(1, 2, 3) & FiniteSet(2, 3, 4) == FiniteSet(2, 3)
212.     assert FiniteSet(1, 2, 3) | FiniteSet(2, 3, 4) == FiniteSet(1, 2, 3, 4)
213. 
214.     assert FiniteSet(1, 2, 3) & S.EmptySet == S.EmptySet
215.     assert FiniteSet(1, 2, 3) | S.EmptySet == FiniteSet(1, 2, 3)
216. 
217.     x = Symbol("x")
218.     y = Symbol("y")
219.     z = Symbol("z")
220.     assert S.EmptySet | FiniteSet(x, FiniteSet(y, z)) == \
221.         FiniteSet(x, FiniteSet(y, z))
222. 
223.     # Test that Intervals and FiniteSets play nicely
224.     assert Interval(1, 3) + FiniteSet(2) == Interval(1, 3)
225.     assert Interval(1, 3, True, True) + FiniteSet(3) == \
226.         Interval(1, 3, True, False)
227.     X = Interval(1, 3) + FiniteSet(5)
228.     Y = Interval(1, 2) + FiniteSet(3)
229.     XandY = X.intersect(Y)
230.     assert 2 in X and 3 in X and 3 in XandY
231.     assert XandY.is_subset(X) and XandY.is_subset(Y)
232. 
233.     raises(TypeError, lambda: Union(1, 2, 3))
234. 
235.     assert X.is_iterable is False
236. 
237.     # issue 7843
238.     assert Union(S.EmptySet, FiniteSet(-sqrt(-I), sqrt(-I))) == \
239.         FiniteSet(-sqrt(-I), sqrt(-I))
240. 
241.     assert Union(S.Reals, S.Integers) == S.Reals
242. 
243. 
244. def test_union_iter():
245.     # Use Range because it is ordered
246.     u = Union(Range(3), Range(5), Range(4), evaluate=False)
247. 
248.     # Round robin
249.     assert list(u) == [0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 4]
250. 
251. 
252. def test_union_is_empty():
253.     assert (Interval(x, y) + FiniteSet(1)).is_empty == False
254.     assert (Interval(x, y) + Interval(-x, y)).is_empty == None
255. 
256. 
257. def test_difference():
258.     assert Interval(1, 3) - Interval(1, 2) == Interval(2, 3, True)
259.     assert Interval(1, 3) - Interval(2, 3) == Interval(1, 2, False, True)
260.     assert Interval(1, 3, True) - Interval(2, 3) == Interval(1, 2, True, True)
261.     assert Interval(1, 3, True) - Interval(2, 3, True) == \
262.         Interval(1, 2, True, False)
263.     assert Interval(0, 2) - FiniteSet(1) == \
264.         Union(Interval(0, 1, False, True), Interval(1, 2, True, False))
265. 
266.     # issue #18119
267.     assert S.Reals - FiniteSet(I) == S.Reals
268.     assert S.Reals - FiniteSet(-I, I) == S.Reals
269.     assert Interval(0, 10) - FiniteSet(-I, I) == Interval(0, 10)
270.     assert Interval(0, 10) - FiniteSet(1, I) == Union(
271.         Interval.Ropen(0, 1), Interval.Lopen(1, 10))
272.     assert S.Reals - FiniteSet(1, 2 + I, x, y**2) == Complement(
273.         Union(Interval.open(-oo, 1), Interval.open(1, oo)), FiniteSet(x, y**2),
274.         evaluate=False)
275. 
276.     assert FiniteSet(1, 2, 3) - FiniteSet(2) == FiniteSet(1, 3)
277.     assert FiniteSet('ham', 'eggs') - FiniteSet('eggs') == FiniteSet('ham')
278.     assert FiniteSet(1, 2, 3, 4) - Interval(2, 10, True, False) == \
279.         FiniteSet(1, 2)
280.     assert FiniteSet(1, 2, 3, 4) - S.EmptySet == FiniteSet(1, 2, 3, 4)
281.     assert Union(Interval(0, 2), FiniteSet(2, 3, 4)) - Interval(1, 3) == \
282.         Union(Interval(0, 1, False, True), FiniteSet(4))
283. 
284.     assert -1 in S.Reals - S.Naturals
285. 
286. 
287. def test_Complement():
288.     A = FiniteSet(1, 3, 4)
289.     B = FiniteSet(3, 4)
290.     C = Interval(1, 3)
291.     D = Interval(1, 2)
292. 
293.     assert Complement(A, B, evaluate=False).is_iterable is True
294.     assert Complement(A, C, evaluate=False).is_iterable is True
295.     assert Complement(C, D, evaluate=False).is_iterable is None
296. 
297.     assert FiniteSet(*Complement(A, B, evaluate=False)) == FiniteSet(1)
298.     assert FiniteSet(*Complement(A, C, evaluate=False)) == FiniteSet(4)
299.     raises(TypeError, lambda: FiniteSet(*Complement(C, A, evaluate=False)))
300. 
301.     assert Complement(Interval(1, 3), Interval(1, 2)) == Interval(2, 3, True)
302.     assert Complement(FiniteSet(1, 3, 4), FiniteSet(3, 4)) == FiniteSet(1)
303.     assert Complement(Union(Interval(0, 2), FiniteSet(2, 3, 4)),
304.                       Interval(1, 3)) == \
305.         Union(Interval(0, 1, False, True), FiniteSet(4))
306. 
307.     assert not 3 in Complement(Interval(0, 5), Interval(1, 4), evaluate=False)
308.     assert -1 in Complement(S.Reals, S.Naturals, evaluate=False)
309.     assert not 1 in Complement(S.Reals, S.Naturals, evaluate=False)
310. 
311.     assert Complement(S.Integers, S.UniversalSet) == EmptySet
312.     assert S.UniversalSet.complement(S.Integers) == EmptySet
313. 
314.     assert (not 0 in S.Reals.intersect(S.Integers - FiniteSet(0)))
315. 
316.     assert S.EmptySet - S.Integers == S.EmptySet
317. 
318.     assert (S.Integers - FiniteSet(0)) - FiniteSet(1) == S.Integers - FiniteSet(0, 1)
319. 
320.     assert S.Reals - Union(S.Naturals, FiniteSet(pi)) == \
321.             Intersection(S.Reals - S.Naturals, S.Reals - FiniteSet(pi))
322.     # issue 12712
323.     assert Complement(FiniteSet(x, y, 2), Interval(-10, 10)) == \
324.             Complement(FiniteSet(x, y), Interval(-10, 10))
325. 
326.     A = FiniteSet(*symbols('a:c'))
327.     B = FiniteSet(*symbols('d:f'))
328.     assert unchanged(Complement, ProductSet(A, A), B)
329. 
330.     A2 = ProductSet(A, A)
331.     B3 = ProductSet(B, B, B)
332.     assert A2 - B3 == A2
333.     assert B3 - A2 == B3
334. 
335. 
336. def test_set_operations_nonsets():
337.     '''Tests that e.g. FiniteSet(1) * 2 raises TypeError'''
338.     ops = [
339.         lambda a, b: a + b,
340.         lambda a, b: a - b,
341.         lambda a, b: a * b,
342.         lambda a, b: a / b,
343.         lambda a, b: a // b,
344.         lambda a, b: a | b,
345.         lambda a, b: a & b,
346.         lambda a, b: a ^ b,
347.         # FiniteSet(1) ** 2 gives a ProductSet
348.         #lambda a, b: a ** b,
349.     ]
350.     Sx = FiniteSet(x)
351.     Sy = FiniteSet(y)
352.     sets = [
353.         {1},
354.         FiniteSet(1),
355.         Interval(1, 2),
356.         Union(Sx, Interval(1, 2)),
357.         Intersection(Sx, Sy),
358.         Complement(Sx, Sy),
359.         ProductSet(Sx, Sy),
360.         S.EmptySet,
361.     ]
362.     nums = [0, 1, 2, S(0), S(1), S(2)]
363. 
364.     for si in sets:
365.         for ni in nums:
366.             for op in ops:
367.                 raises(TypeError, lambda : op(si, ni))
368.                 raises(TypeError, lambda : op(ni, si))
369.         raises(TypeError, lambda: si ** object())
370.         raises(TypeError, lambda: si ** {1})
371. 
372. 
373. def test_complement():
374.     assert Interval(0, 1).complement(S.Reals) == \
375.         Union(Interval(-oo, 0, True, True), Interval(1, oo, True, True))
376.     assert Interval(0, 1, True, False).complement(S.Reals) == \
377.         Union(Interval(-oo, 0, True, False), Interval(1, oo, True, True))
378.     assert Interval(0, 1, False, True).complement(S.Reals) == \
379.         Union(Interval(-oo, 0, True, True), Interval(1, oo, False, True))
380.     assert Interval(0, 1, True, True).complement(S.Reals) == \
381.         Union(Interval(-oo, 0, True, False), Interval(1, oo, False, True))
382. 
383.     assert S.UniversalSet.complement(S.EmptySet) == S.EmptySet
384.     assert S.UniversalSet.complement(S.Reals) == S.EmptySet
385.     assert S.UniversalSet.complement(S.UniversalSet) == S.EmptySet
386. 
387.     assert S.EmptySet.complement(S.Reals) == S.Reals
388. 
389.     assert Union(Interval(0, 1), Interval(2, 3)).complement(S.Reals) == \
390.         Union(Interval(-oo, 0, True, True), Interval(1, 2, True, True),
391.               Interval(3, oo, True, True))
392. 
393.     assert FiniteSet(0).complement(S.Reals) ==  \
394.         Union(Interval(-oo, 0, True, True), Interval(0, oo, True, True))
395. 
396.     assert (FiniteSet(5) + Interval(S.NegativeInfinity,
397.                                     0)).complement(S.Reals) == \
398.         Interval(0, 5, True, True) + Interval(5, S.Infinity, True, True)
399. 
400.     assert FiniteSet(1, 2, 3).complement(S.Reals) == \
401.         Interval(S.NegativeInfinity, 1, True, True) + \
402.         Interval(1, 2, True, True) + Interval(2, 3, True, True) +\
403.         Interval(3, S.Infinity, True, True)
404. 
405.     assert FiniteSet(x).complement(S.Reals) == Complement(S.Reals, FiniteSet(x))
406. 
407.     assert FiniteSet(0, x).complement(S.Reals) == Complement(Interval(-oo, 0, True, True) +
408.                                                              Interval(0, oo, True, True)
409.                                                              , FiniteSet(x), evaluate=False)
410. 
411.     square = Interval(0, 1) * Interval(0, 1)
412.     notsquare = square.complement(S.Reals*S.Reals)
413. 
414.     assert all(pt in square for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
415.     assert not any(
416.         pt in notsquare for pt in [(0, 0), (.5, .5), (1, 0), (1, 1)])
417.     assert not any(pt in square for pt in [(-1, 0), (1.5, .5), (10, 10)])
418.     assert all(pt in notsquare for pt in [(-1, 0), (1.5, .5), (10, 10)])
419. 
420. 
421. def test_intersect1():
422.     assert all(S.Integers.intersection(i) is i for i in
423.         (S.Naturals, S.Naturals0))
424.     assert all(i.intersection(S.Integers) is i for i in
425.         (S.Naturals, S.Naturals0))
426.     s =  S.Naturals0
427.     assert S.Naturals.intersection(s) is S.Naturals
428.     assert s.intersection(S.Naturals) is S.Naturals
429.     x = Symbol('x')
430.     assert Interval(0, 2).intersect(Interval(1, 2)) == Interval(1, 2)
431.     assert Interval(0, 2).intersect(Interval(1, 2, True)) == \
432.         Interval(1, 2, True)
433.     assert Interval(0, 2, True).intersect(Interval(1, 2)) == \
434.         Interval(1, 2, False, False)
435.     assert Interval(0, 2, True, True).intersect(Interval(1, 2)) == \
436.         Interval(1, 2, False, True)
437.     assert Interval(0, 2).intersect(Union(Interval(0, 1), Interval(2, 3))) == \
438.         Union(Interval(0, 1), Interval(2, 2))
439. 
440.     assert FiniteSet(1, 2).intersect(FiniteSet(1, 2, 3)) == FiniteSet(1, 2)
441.     assert FiniteSet(1, 2, x).intersect(FiniteSet(x)) == FiniteSet(x)
442.     assert FiniteSet('ham', 'eggs').intersect(FiniteSet('ham')) == \
443.         FiniteSet('ham')
444.     assert FiniteSet(1, 2, 3, 4, 5).intersect(S.EmptySet) == S.EmptySet
445. 
446.     assert Interval(0, 5).intersect(FiniteSet(1, 3)) == FiniteSet(1, 3)
447.     assert Interval(0, 1, True, True).intersect(FiniteSet(1)) == S.EmptySet
448. 
449.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2)) == \
450.         Union(Interval(1, 1), Interval(2, 2))
451.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(0, 2)) == \
452.         Union(Interval(0, 1), Interval(2, 2))
453.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(Interval(1, 2, True, True)) == \
454.         S.EmptySet
455.     assert Union(Interval(0, 1), Interval(2, 3)).intersect(S.EmptySet) == \
456.         S.EmptySet
457.     assert Union(Interval(0, 5), FiniteSet('ham')).intersect(FiniteSet(2, 3, 4, 5, 6)) == \
458.         Intersection(FiniteSet(2, 3, 4, 5, 6), Union(FiniteSet('ham'), Interval(0, 5)))
459.     assert Intersection(FiniteSet(1, 2, 3), Interval(2, x), Interval(3, y)) == \
460.         Intersection(FiniteSet(3), Interval(2, x), Interval(3, y), evaluate=False)
461.     assert Intersection(FiniteSet(1, 2), Interval(0, 3), Interval(x, y)) == \
462.         Intersection({1, 2}, Interval(x, y), evaluate=False)
463.     assert Intersection(FiniteSet(1, 2, 4), Interval(0, 3), Interval(x, y)) == \
464.         Intersection({1, 2}, Interval(x, y), evaluate=False)
465.     # XXX: Is the real=True necessary here?
466.     # https://github.com/sympy/sympy/issues/17532
467.     m, n = symbols('m, n', real=True)
468.     assert Intersection(FiniteSet(m), FiniteSet(m, n), Interval(m, m+1)) == \
469.         FiniteSet(m)
470. 
471.     # issue 8217
472.     assert Intersection(FiniteSet(x), FiniteSet(y)) == \
473.         Intersection(FiniteSet(x), FiniteSet(y), evaluate=False)
474.     assert FiniteSet(x).intersect(S.Reals) == \
475.         Intersection(S.Reals, FiniteSet(x), evaluate=False)
476. 
477.     # tests for the intersection alias
478.     assert Interval(0, 5).intersection(FiniteSet(1, 3)) == FiniteSet(1, 3)
479.     assert Interval(0, 1, True, True).intersection(FiniteSet(1)) == S.EmptySet
480. 
481.     assert Union(Interval(0, 1), Interval(2, 3)).intersection(Interval(1, 2)) == \
482.         Union(Interval(1, 1), Interval(2, 2))
483. 
484. 
485. def test_intersection():
486.     # iterable
487.     i = Intersection(FiniteSet(1, 2, 3), Interval(2, 5), evaluate=False)
488.     assert i.is_iterable
489.     assert set(i) == {S(2), S(3)}
490. 
491.     # challenging intervals
492.     x = Symbol('x', real=True)
493.     i = Intersection(Interval(0, 3), Interval(x, 6))
494.     assert (5 in i) is False
495.     raises(TypeError, lambda: 2 in i)
496. 
497.     # Singleton special cases
498.     assert Intersection(Interval(0, 1), S.EmptySet) == S.EmptySet
499.     assert Intersection(Interval(-oo, oo), Interval(-oo, x)) == Interval(-oo, x)
500. 


File: sympy/sets/tests/test_sets.py
Line number range: 501 - 518
Content:
501.     # Products
502.     line = Interval(0, 5)
503.     i = Intersection(line**2, line**3, evaluate=False)
504.     assert (2, 2) not in i
505.     assert (2, 2, 2) not in i
506.     raises(TypeError, lambda: list(i))
507. 
508.     a = Intersection(Intersection(S.Integers, S.Naturals, evaluate=False), S.Reals, evaluate=False)
509.     assert a._argset == frozenset([Intersection(S.Naturals, S.Integers, evaluate=False), S.Reals])
510. 
511.     assert Intersection(S.Complexes, FiniteSet(S.ComplexInfinity)) == S.EmptySet
512. 
513.     # issue 12178
514.     assert Intersection() == S.UniversalSet
515. 
516.     # issue 16987
517.     assert Intersection({1}, {1}, {x}) == Intersection({1}, {x})
518. 


File: sympy/sets/tests/test_sets.py
Line number range: 1100 - 1130
Content:
1100. def test_image_interval():
1101.     from sympy.core.numbers import Rational
1102.     x = Symbol('x', real=True)
1103.     a = Symbol('a', real=True)
1104.     assert imageset(x, 2*x, Interval(-2, 1)) == Interval(-4, 2)
1105.     assert imageset(x, 2*x, Interval(-2, 1, True, False)) == \
1106.         Interval(-4, 2, True, False)
1107.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1108.         Interval(0, 4, False, True)
1109.     assert imageset(x, x**2, Interval(-2, 1)) == Interval(0, 4)
1110.     assert imageset(x, x**2, Interval(-2, 1, True, False)) == \
1111.         Interval(0, 4, False, True)
1112.     assert imageset(x, x**2, Interval(-2, 1, True, True)) == \
1113.         Interval(0, 4, False, True)
1114.     assert imageset(x, (x - 2)**2, Interval(1, 3)) == Interval(0, 1)
1115.     assert imageset(x, 3*x**4 - 26*x**3 + 78*x**2 - 90*x, Interval(0, 4)) == \
1116.         Interval(-35, 0)  # Multiple Maxima
1117.     assert imageset(x, x + 1/x, Interval(-oo, oo)) == Interval(-oo, -2) \
1118.         + Interval(2, oo)  # Single Infinite discontinuity
1119.     assert imageset(x, 1/x + 1/(x-1)**2, Interval(0, 2, True, False)) == \
1120.         Interval(Rational(3, 2), oo, False)  # Multiple Infinite discontinuities
1121. 
1122.     # Test for Python lambda
1123.     assert imageset(lambda x: 2*x, Interval(-2, 1)) == Interval(-4, 2)
1124. 
1125.     assert imageset(Lambda(x, a*x), Interval(0, 1)) == \
1126.             ImageSet(Lambda(x, a*x), Interval(0, 1))
1127. 
1128.     assert imageset(Lambda(x, sin(cos(x))), Interval(0, 1)) == \
1129.             ImageSet(Lambda(x, sin(cos(x))), Interval(0, 1))
1130. 


File: sympy/sets/tests/test_sets.py
Line number range: 1139 - 1145
Content:
1139. @XFAIL  # See: https://github.com/sympy/sympy/pull/2723#discussion_r8659826
1140. def test_image_Intersection():
1141.     x = Symbol('x', real=True)
1142.     y = Symbol('y', real=True)
1143.     assert imageset(x, x**2, Interval(-2, 0).intersect(Interval(x, y))) == \
1144.            Interval(0, 4).intersect(Interval(Min(x**2, y**2), Max(x**2, y**2)))
1145. 


File: sympy/sets/tests/test_sets.py
Line number range: 1147 - 1150
Content:
1147. def test_image_FiniteSet():
1148.     x = Symbol('x', real=True)
1149.     assert imageset(x, 2*x, FiniteSet(1, 2, 3)) == FiniteSet(2, 4, 6)
1150. 


File: sympy/sets/tests/test_sets.py
Line number range: 1152 - 1156
Content:
1152. def test_image_Union():
1153.     x = Symbol('x', real=True)
1154.     assert imageset(x, x**2, Interval(-2, 0) + FiniteSet(1, 2, 3)) == \
1155.             (Interval(0, 4) + FiniteSet(9))
1156. 


File: sympy/sets/tests/test_sets.py
Line number range: 1324 - 1344
Content:
1324. def test_issue_Symbol_inter():
1325.     i = Interval(0, oo)
1326.     r = S.Reals
1327.     mat = Matrix([0, 0, 0])
1328.     assert Intersection(r, i, FiniteSet(m), FiniteSet(m, n)) == \
1329.         Intersection(i, FiniteSet(m))
1330.     assert Intersection(FiniteSet(1, m, n), FiniteSet(m, n, 2), i) == \
1331.         Intersection(i, FiniteSet(m, n))
1332.     assert Intersection(FiniteSet(m, n, x), FiniteSet(m, z), r) == \
1333.         Intersection(Intersection({m, z}, {m, n, x}), r)
1334.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, x), r) == \
1335.         Intersection(FiniteSet(3, m, n), FiniteSet(m, n, x), r, evaluate=False)
1336.     assert Intersection(FiniteSet(m, n, 3), FiniteSet(m, n, 2, 3), r) == \
1337.         Intersection(FiniteSet(3, m, n), r)
1338.     assert Intersection(r, FiniteSet(mat, 2, n), FiniteSet(0, mat, n)) == \
1339.         Intersection(r, FiniteSet(n))
1340.     assert Intersection(FiniteSet(sin(x), cos(x)), FiniteSet(sin(x), cos(x), 1), r) == \
1341.         Intersection(r, FiniteSet(sin(x), cos(x)))
1342.     assert Intersection(FiniteSet(x**2, 1, sin(x)), FiniteSet(x**2, 2, sin(x)), r) == \
1343.         Intersection(r, FiniteSet(x**2, sin(x)))
1344. 


File: sympy/sets/tests/test_sets.py
Line number range: 1450 - 1472
Content:
1450. def test_finite_set_intersection():
1451.     # The following should not produce recursion errors
1452.     # Note: some of these are not completely correct. See
1453.     # https://github.com/sympy/sympy/issues/16342.
1454.     assert Intersection(FiniteSet(-oo, x), FiniteSet(x)) == FiniteSet(x)
1455.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(0, x)]) == FiniteSet(x)
1456. 
1457.     assert Intersection._handle_finite_sets([FiniteSet(-oo, x), FiniteSet(x)]) == FiniteSet(x)
1458.     assert Intersection._handle_finite_sets([FiniteSet(2, 3, x, y), FiniteSet(1, 2, x)]) == \
1459.         Intersection._handle_finite_sets([FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)]) == \
1460.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, 3, x, y)) == \
1461.         Intersection(FiniteSet(1, 2, x), FiniteSet(2, x, y))
1462. 
1463.     assert FiniteSet(1+x-y) & FiniteSet(1) == \
1464.         FiniteSet(1) & FiniteSet(1+x-y) == \
1465.         Intersection(FiniteSet(1+x-y), FiniteSet(1), evaluate=False)
1466. 
1467.     assert FiniteSet(1) & FiniteSet(x) == FiniteSet(x) & FiniteSet(1) == \
1468.         Intersection(FiniteSet(1), FiniteSet(x), evaluate=False)
1469. 
1470.     assert FiniteSet({x}) & FiniteSet({x, y}) == \
1471.         Intersection(FiniteSet({x}), FiniteSet({x, y}), evaluate=False)
1472. 


File: sympy/sets/tests/test_sets.py
Line number range: 1498 - 1504
Content:
1498. @XFAIL
1499. def test_issue_16878b():
1500.     # in intersection_sets for (ImageSet, Set) there is no code
1501.     # that handles the base_set of S.Reals like there is
1502.     # for Integers
1503.     assert imageset(x, (x, x), S.Reals).is_subset(S.Reals**2) is True
1504. 

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-21 01:24:21,713 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find three relevant test cases for a bug concerning the intersection of an `ImageSet` with `Reals`. The provided context from `sympy/sets/tests/test_sets.py` is incomplete and does not contain test cases that specifically cover the scenario of intersecting a complex-valued `ImageSet` over `S.Integers` with `S.Reals`. To find appropriate examples that would fail under the old logic and pass with the patch, I need to search the test file for functions that test the interaction between `imageset` and `intersect` or `is_subset`.' query="Please provide the content of any test function in `sympy/sets/tests/test_sets.py` whose body contains 'imageset' and either 'intersect' or 'is_subset'." extra_requirements='' purpose="This will help locate test cases that exercise the intersection or subset logic for ImageSet, which is directly related to the user's bug report and the provided patch."
2025-12-21 01:24:21,714 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the content of any test function in `sympy/sets/tests/test_sets.py` whose body contains 'imageset' and either 'intersect' or 'is_subset'.
2025-12-21 01:24:21,715 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-21 01:24:21,715 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-21 01:24:21,716 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-21 01:24:21,716 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the content of any test function in `sympy/sets/tests/test_sets.py` whose body contains 'imageset' and either 'intersect' or 'is_subset'.
Purpose: This will help locate test cases that exercise the intersection or subset logic for ImageSet, which is directly related to the user's bug report and the provided patch.
2025-12-21 01:24:44,298 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='To address your query, I will locate test functions in `sympy/sets/tests/test_sets.py` that involve `imageset` and either `intersect` or `is_subset`. I will start by finding all functions within that file that contain the term `imageset`. Subsequently, I will examine the content of each of these functions to identify those that also include either `intersect` or `is_subset`, and then provide their full content.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "sympy/sets/tests/test_sets.py", "text": "imageset"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2141, 'candidates_token_count': 130, 'total_token_count': 4696, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2141}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 130}], 'thoughts_token_count': 2425, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -2.8511699969951922, 'model_name': 'gemini-2.5-pro'} id='run--949ba5a2-cd60-492e-8e4b-645725524e1f-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'sympy/sets/tests/test_sets.py', 'text': 'imageset'}, 'id': '6f6002ac-9128-4d10-8975-01ae75b49039', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2141, 'output_tokens': 130, 'total_tokens': 4696, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 2425}}
2025-12-21 01:24:51,166 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have identified a test function, `test_issue_16878b`, located in the file `sympy/sets/tests/test_sets.py`, which aligns with your specified criteria. This function utilizes `imageset` in conjunction with `is_subset`, and I have retrieved its contents for your review. My search confirms that this is the only function in the file that meets all of your requirements.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "sympy/sets/tests/test_sets.py", "text": "intersect"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 3196, 'candidates_token_count': 122, 'total_token_count': 3883, 'cached_content_token_count': 1571, 'prompt_tokens_details': [{'modality': 1, 'token_count': 3196}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1571}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 122}], 'thoughts_token_count': 565}, 'finish_reason': 'STOP', 'avg_logprobs': -0.39176224880531185, 'model_name': 'gemini-2.5-pro'} id='run--80210294-b1ac-45b7-97ba-38df63ea39bf-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'sympy/sets/tests/test_sets.py', 'text': 'intersect'}, 'id': 'ae15b34d-64ba-402d-a0a5-68b1b4dd39a3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3196, 'output_tokens': 122, 'total_tokens': 3883, 'input_token_details': {'cache_read': 1571}, 'output_token_details': {'reasoning': 565}}
2025-12-21 01:24:53,662 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have located two test functions in `sympy/sets/tests/test_sets.py` that match your criteria. The first, `test_issue_16878b`, uses `imageset` and `is_subset`. The second, `test_image_Intersection`, uses `imageset` and `intersect`. I will now provide the full content of both functions.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1145.0, "start_line": 1139.0, "relative_path": "sympy/sets/tests/test_sets.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 4325, 'candidates_token_count': 143, 'total_token_count': 4547, 'cached_content_token_count': 3262, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4325}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3262}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 143}], 'thoughts_token_count': 79}, 'finish_reason': 'STOP', 'avg_logprobs': -0.0833834801520501, 'model_name': 'gemini-2.5-pro'} id='run--04821f70-7abb-468e-87ea-47587b3bb80f-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1504.0, 'start_line': 1498.0, 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': '4045c0a6-4f29-4975-adbb-69d637b9aee8', 'type': 'tool_call'}, {'name': 'read_code_with_relative_path', 'args': {'end_line': 1145.0, 'start_line': 1139.0, 'relative_path': 'sympy/sets/tests/test_sets.py'}, 'id': 'b754f988-bd92-4baa-8981-d1a24a22081c', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4325, 'output_tokens': 143, 'total_tokens': 4547, 'input_token_details': {'cache_read': 3262}, 'output_token_details': {'reasoning': 79}}
2025-12-21 01:24:56,606 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully located two test functions in `sympy/sets/tests/test_sets.py` that meet your criteria. I found `test_issue_16878b`, which uses `imageset` and `is_subset`, and `test_image_Intersection`, which uses `imageset` and `intersect`. I then retrieved the full content of both of these functions for your review.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 4933, 'candidates_token_count': 85, 'total_token_count': 5220, 'cached_content_token_count': 3290, 'prompt_tokens_details': [{'modality': 1, 'token_count': 4933}], 'cache_tokens_details': [{'modality': 1, 'token_count': 3290}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 85}], 'thoughts_token_count': 202}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2268347796271829, 'model_name': 'gemini-2.5-pro'} id='run--b42fbf58-b153-4a65-96e0-31cb61398376-0' usage_metadata={'input_tokens': 4933, 'output_tokens': 85, 'total_tokens': 5220, 'input_token_details': {'cache_read': 3290}, 'output_token_details': {'reasoning': 202}}
2025-12-21 01:24:56,608 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the content of any test function in `sympy/sets/tests/test_sets.py` whose body contains 'imageset' and either 'intersect' or 'is_subset'.
--- END QUERY ---



--- BEGIN PURPOSE ---
This will help locate test cases that exercise the intersection or subset logic for ImageSet, which is directly related to the user's bug report and the provided patch.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sympy/sets/tests/test_sets.py
Line number range: 957 - 960
Content:
def test_EmptySet():
    assert S.EmptySet.as_relational(Symbol('x')) is S.false
    assert S.EmptySet.intersect(S.UniversalSet) == S.EmptySet
    assert S.EmptySet.boundary == S.EmptySet


File: sympy/sets/tests/test_sets.py
Line number range: 1075 - 1084
Content:
def test_universalset():
    U = S.UniversalSet
    x = Symbol('x')
    assert U.as_relational(x) is S.true
    assert U.union(Interval(2, 4)) == U

    assert U.intersect(Interval(2, 4)) == Interval(2, 4)
    assert U.measure is S.Infinity
    assert U.boundary == S.EmptySet
    assert U.contains(0) is S.true


File: sympy/sets/tests/test_sets.py
Line number range: 1139 - 1145
Content:
1139. @XFAIL  # See: https://github.com/sympy/sympy/pull/2723#discussion_r8659826
1140. def test_image_Intersection():
1141.     x = Symbol('x', real=True)
1142.     y = Symbol('y', real=True)
1143.     assert imageset(x, x**2, Interval(-2, 0).intersect(Interval(x, y))) == \
1144.            Interval(0, 4).intersect(Interval(Min(x**2, y**2), Max(x**2, y**2)))


File: sympy/sets/tests/test_sets.py
Line number range: 1147 - 1149
Content:
def test_image_FiniteSet():
    x = Symbol('x', real=True)
    assert imageset(x, 2*x, FiniteSet(1, 2, 3)) == FiniteSet(2, 4, 6)


File: sympy/sets/tests/test_sets.py
Line number range: 1152 - 1155
Content:
def test_image_Union():
    x = Symbol('x', real=True)
    assert imageset(x, x**2, Interval(-2, 0) + FiniteSet(1, 2, 3)) == \
            (Interval(0, 4) + FiniteSet(9))


File: sympy/sets/tests/test_sets.py
Line number range: 1158 - 1160
Content:
def test_image_EmptySet():
    x = Symbol('x', real=True)
    assert imageset(x, 2*x, S.EmptySet) == S.EmptySet


File: sympy/sets/tests/test_sets.py
Line number range: 1294 - 1297
Content:
def test_issue_9536():
    from sympy.functions.elementary.exponential import log
    a = Symbol('a', real=True)
    assert FiniteSet(log(a)).intersect(S.Reals) == Intersection(S.Reals, FiniteSet(log(a)))


File: sympy/sets/tests/test_sets.py
Line number range: 1350 - 1354
Content:
def test_issue_10113():
    f = x**2/(x**2 - 4)
    assert imageset(x, f, S.Reals) == Union(Interval(-oo, 0), Interval(1, oo, True, True))
    assert imageset(x, f, Interval(-2, 2)) == Interval(-oo, 0)
    assert imageset(x, f, Interval(-2, 3)) == Union(Interval(-oo, 0), Interval(Rational(9, 5), oo))


File: sympy/sets/tests/test_sets.py
Line number range: 1498 - 1504
Content:
1498. @XFAIL
1499. def test_issue_16878b():
1500.     # in intersection_sets for (ImageSet, Set) there is no code
1501.     # that handles the base_set of S.Reals like there is
1502.     # for Integers
1503.     assert imageset(x, (x, x), S.Reals).is_subset(S.Reals**2) is True

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-21 01:25:06,756 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The query asks for a test function in `sympy/sets/tests/test_sets.py`.\n   - The function body must contain 'imageset' and 'intersect'.\n   - The function `test_image_Intersection` meets all these requirements.\n2. Extended relevance:\n   - This function is a direct test of the intersection of an `imageset`, which is a key requirement of the query.", relative_path='sympy/sets/tests/test_sets.py', start_line=1139, end_line=1144), ContextOutput(reasoning="1. Query requirement analysis:\n   - The query asks for a test function in `sympy/sets/tests/test_sets.py`.\n   - The function body must contain 'imageset' and 'is_subset'.\n   - The function `test_issue_16878b` meets all these requirements.\n2. Extended relevance:\n   - This function tests the `is_subset` property of an `imageset`, which is a key requirement of the query.\n   - The comments provide additional context about the state of the implementation for intersections involving `ImageSet`.", relative_path='sympy/sets/tests/test_sets.py', start_line=1498, end_line=1503)]
2025-12-21 01:25:06,757 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the content of any test function in `sympy/sets/tests/test_sets.py` whose body contains 'imageset' and either 'intersect' or 'is_subset'.
2025-12-21 01:25:06,757 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-21 01:25:06,757 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-21 01:25:06,758 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 9 existing contexts
2025-12-21 01:25:06,758 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 9 total contexts (removed 2 duplicates)
2025-12-21 01:25:06,759 - thread-126477792184000.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-21 01:25:06,759 - thread-126477792184000.prometheus_context_collector - INFO - Successfully retrieved 9 context snippets
