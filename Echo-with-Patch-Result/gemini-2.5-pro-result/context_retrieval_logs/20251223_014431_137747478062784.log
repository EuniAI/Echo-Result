2025-12-23 01:44:31,093 - thread-137747478062784.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Cannot use aggregate over window functions since 4.2

Description: Description
	 
		(last modified by younes-chaoui)
	 
After upgrading to Django 4.2, I encountered an exception when executing ORM queries that involve aggregates over Window functions. The specific error was psycopg2.errors.GroupingError: aggregate function calls cannot contain window function calls
Dependencies :
psycopg2 version: 2.9.3
django version: 4.2.3
PostgreSQL version: 13.4
Example Code:
queryset = queryset.annotate(
	cumul_DJR=Coalesce(Window(Sum("DJR"), order_by=F("date").asc()), 0.0)
)
aggregate = queryset.aggregate(
	DJR_total=Sum("DJR"),
	cumul_DJR_total=Sum("cumul_DJR")
)

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 13a6809dd8..514a6b36ce 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -454,6 +454,9 @@ class Query(BaseExpression):
             or qualify
             or self.distinct
             or self.combinator
+            or any(
+                aggregate.contains_over_clause for aggregate in aggregates.values()
+            )
         ):
             from django.db.models.sql.subqueries import AggregateQuery
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-23 01:44:31,193 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── data
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       ├── selenium.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_IE
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── csrf_403.html
|           ├── default_urlconf.html
|           ├── directory_index.html
|           ├── i18n_catalog.js
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── delete-app.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   ├── tutorial08.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.18.txt
|   |   ├── 3.2.19.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.20.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.10.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.10.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.8.txt
|   |   ├── 4.1.9.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.1.txt
|   |   ├── 4.2.2.txt
|   |   ├── 4.2.3.txt
|   |   ├── 4.2.4.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_related_object_lookups.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_auth.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   ├── ending_with_dollar.py
    |       |   ├── matched_angle_brackets.py
    |       |   └── unmatched_angle_brackets.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   ├── test_cache.py
    |   ├── test_clickjacking.py
    |   ├── test_common.py
    |   ├── test_csrf.py
    |   ├── test_http.py
    |   ├── test_vary.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_field.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── obsolete_translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   └── urls
    |       ├── __init__.py
    |       ├── http.py
    |       └── https.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── nonutf8
    |   |   |   └── nonutf8.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_escapeseq.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Cannot use aggregate over window functions since 4.2

Description: Description
	 
		(last modified by younes-chaoui)
	 
After upgrading to Django 4.2, I encountered an exception when executing ORM queries that involve aggregates over Window functions. The specific error was psycopg2.errors.GroupingError: aggregate function calls cannot contain window function calls
Dependencies :
psycopg2 version: 2.9.3
django version: 4.2.3
PostgreSQL version: 13.4
Example Code:
queryset = queryset.annotate(
	cumul_DJR=Coalesce(Window(Sum("DJR"), order_by=F("date").asc()), 0.0)
)
aggregate = queryset.aggregate(
	DJR_total=Sum("DJR"),
	cumul_DJR_total=Sum("cumul_DJR")
)

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 13a6809dd8..514a6b36ce 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -454,6 +454,9 @@ class Query(BaseExpression):
             or qualify
             or self.distinct
             or self.combinator
+            or any(
+                aggregate.contains_over_clause for aggregate in aggregates.values()
+            )
         ):
             from django.db.models.sql.subqueries import AggregateQuery
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 01:44:53,878 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='I need to find test cases that demonstrate the bug involving aggregate functions over window functions. The most relevant file to start with is the one that specifically tests window expressions. The current context is empty, so I need to retrieve this file to analyze its contents for relevant test cases.' query='Please provide the full content of tests/expressions_window/tests.py.' extra_requirements='' purpose='This file is expected to contain test cases for window functions, which are at the core of the reported bug. I will analyze it to find tests that aggregate over window function annotations.'
2025-12-23 01:44:53,879 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/expressions_window/tests.py.
2025-12-23 01:44:53,879 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 01:44:53,880 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 01:44:53,880 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 01:44:53,880 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/expressions_window/tests.py.
Purpose: This file is expected to contain test cases for window functions, which are at the core of the reported bug. I will analyze it to find tests that aggregate over window function annotations.
2025-12-23 01:44:55,912 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/expressions_window/tests.py"}'}, '__gemini_function_call_thought_signatures__': {'a8cdae5b-5071-49b2-b217-8157d3590d5a': 'Cu0DAY89a1/GGac8Grv7zl8QmnJoFx6FWh1BEslSgLmzMLO51u4cHxlC7eLE1Cs7TNp9SXDbuIpPcGHd+X1sp7/8Yo0N+5JEIqF60sZR9snUzSc6Vaj3fTQ1tAkodxccokVNvMKc1lz6CiQiAedkxv5QcUkr2VNWLIGVStDaCroLUTp6q58w7wLg49mGnhlwwuuIIo2jykUH1IstMClBbQYPc/qDzYV7tVHdFwl9CIEJFBE8v0jZT29Cns8GJ0oKvRhIeqMiI/raRo9AuR7C3qHhFbi4CtZtCQuovqrAbOQVS97X71r+p7QfoPoW+RhobcWASURDrPnbueqJzBNTh6hanMGlhCCfBnCkrftuVhvwGWz/mJpJRxKaIzuz1tFLVuzi+Cru6a1smBTQKe7cgFAvEmw9AEg4NXQwvWyypGIvJ5MWoUzfwuZFMUfhX38VGO+2T4Fj5AhL/c5hTo/Fd3/V5E8o14ckkgM9oE/pHTOsbGomDmqdLhH0AazB73TRWe+cg/PQyjV3nOlsIGuvx6AOemNZJwpReosP9vsJ7CuOdnRr5KIiU6g+WlcTESeKyTBBI2Y5JeiGgp6YFmD0FhAPP/3zgaf3luWFkGN+8Sq6OxpUhW+H1fZ3nkQcrOy7SgXUILO92kew4KKOYcxlow=='}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2112, 'candidates_token_count': 23, 'total_token_count': 2258, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2112}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 23}], 'thoughts_token_count': 123, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.18122034487516983, 'model_name': 'gemini-2.5-pro'} id='run--e0b232e7-e285-4d7f-9946-f6f56602093f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/expressions_window/tests.py'}, 'id': 'a8cdae5b-5071-49b2-b217-8157d3590d5a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2112, 'output_tokens': 23, 'total_tokens': 2258, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 123}}
2025-12-23 01:44:58,329 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the first 500 lines of the requested file. I will now read the remaining content of the file to provide the full content as requested.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "end_line": 1000.0, "relative_path": "tests/expressions_window/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9965, 'candidates_token_count': 62, 'total_token_count': 10118, 'cached_content_token_count': 1838, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10088}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1838}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 62}], 'thoughts_token_count': 91}, 'finish_reason': 'STOP', 'avg_logprobs': -0.19375758017263106, 'model_name': 'gemini-2.5-pro'} id='run--6f475775-5a63-4c35-908e-b55f986057ca-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'end_line': 1000.0, 'relative_path': 'tests/expressions_window/tests.py'}, 'id': 'a140a23e-4987-40e6-b603-1e191e30d2d0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9965, 'output_tokens': 62, 'total_tokens': 10118, 'input_token_details': {'cache_read': 1838}, 'output_token_details': {'reasoning': 91}}
2025-12-23 01:45:01,163 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have now retrieved the entire content of `tests/expressions_window/tests.py`. I started by reading the first 500 lines of the file, and then followed up by reading the remaining lines to ensure the full content was captured. This file contains various test cases for window functions in a Django environment. The tests cover a wide range of window functions, including `DenseRank`, `Rank`, `RowNumber`, `Avg`, `Sum`, `Lag`, `Lead`, `FirstValue`, `LastValue`, `Min`, `Max`, `CumeDist`, `NthValue`, `Ntile`, and `PercentRank`, and also include tests for filtering on window function results.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"end_line": 1500.0, "start_line": 1001.0, "relative_path": "tests/expressions_window/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 19263, 'candidates_token_count': 172, 'total_token_count': 19435, 'cached_content_token_count': 9484, 'prompt_tokens_details': [{'modality': 1, 'token_count': 19386}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9484}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 172}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.12053336653598519, 'model_name': 'gemini-2.5-pro'} id='run--3946f112-faf9-4ca3-8979-ca164c8fe235-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'end_line': 1500.0, 'start_line': 1001.0, 'relative_path': 'tests/expressions_window/tests.py'}, 'id': '40ce918a-4003-4878-8b42-dd3bb9d02792', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19263, 'output_tokens': 172, 'total_tokens': 19435, 'input_token_details': {'cache_read': 9484}}
2025-12-23 01:45:03,718 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have now retrieved the full content of `tests/expressions_window/tests.py`. The file contains a comprehensive suite of tests for Django's window functions. I first read the initial 500 lines, then the next 500, and finally the remainder of the file to ensure I had all the code. The tests cover a wide variety of window functions and their filtering capabilities, which will be very helpful for understanding the issue." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1501.0, "end_line": 2000.0, "relative_path": "tests/expressions_window/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 28044, 'candidates_token_count': 121, 'total_token_count': 28165, 'cached_content_token_count': 19175, 'prompt_tokens_details': [{'modality': 1, 'token_count': 28167}], 'cache_tokens_details': [{'modality': 1, 'token_count': 19175}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 121}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.14785479711106986, 'model_name': 'gemini-2.5-pro'} id='run--4cd66eea-2f6b-4ef7-8163-6a0d87c8d962-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1501.0, 'end_line': 2000.0, 'relative_path': 'tests/expressions_window/tests.py'}, 'id': 'f584a5f4-8100-46f8-b43a-b1bfdb568bfc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28044, 'output_tokens': 121, 'total_tokens': 28165, 'input_token_details': {'cache_read': 19175}}
2025-12-23 01:45:05,537 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have now retrieved the entire content of `tests/expressions_window/tests.py`, which contains a comprehensive set of tests for Django's window functions. I read the file in chunks to ensure the full content was captured, starting with the first 500 lines, then the next 500, and so on, until the end of the file. The tests cover a wide variety of window functions and their filtering capabilities, providing valuable context for the issue at hand." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 30690, 'candidates_token_count': 99, 'total_token_count': 30789, 'cached_content_token_count': 26863, 'prompt_tokens_details': [{'modality': 1, 'token_count': 30813}], 'cache_tokens_details': [{'modality': 1, 'token_count': 26863}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 99}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.17802955165053858, 'model_name': 'gemini-2.5-pro'} id='run--9836b296-4687-4ece-a3fb-8adc8d19d739-0' usage_metadata={'input_tokens': 30690, 'output_tokens': 99, 'total_tokens': 30789, 'input_token_details': {'cache_read': 26863}}
2025-12-23 01:45:05,539 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/expressions_window/tests.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is expected to contain test cases for window functions, which are at the core of the reported bug. I will analyze it to find tests that aggregate over window function annotations.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/expressions_window/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. from decimal import Decimal
3. from unittest import mock
4. 
5. from django.core.exceptions import FieldError
6. from django.db import NotSupportedError, connection
7. from django.db.models import (
8.     Avg,
9.     Case,
10.     Count,
11.     F,
12.     IntegerField,
13.     Max,
14.     Min,
15.     OuterRef,
16.     Q,
17.     RowRange,
18.     Subquery,
19.     Sum,
20.     Value,
21.     ValueRange,
22.     When,
23.     Window,
24.     WindowFrame,
25. )
26. from django.db.models.fields.json import KeyTextTransform, KeyTransform
27. from django.db.models.functions import (
28.     Cast,
29.     CumeDist,
30.     DenseRank,
31.     ExtractYear,
32.     FirstValue,
33.     Lag,
34.     LastValue,
35.     Lead,
36.     NthValue,
37.     Ntile,
38.     PercentRank,
39.     Rank,
40.     RowNumber,
41.     Upper,
42. )
43. from django.db.models.lookups import Exact
44. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
45. from django.test.utils import CaptureQueriesContext
46. 
47. from .models import Classification, Detail, Employee, PastEmployeeDepartment
48. 
49. 
50. @skipUnlessDBFeature("supports_over_clause")
51. class WindowFunctionTests(TestCase):
52.     @classmethod
53.     def setUpTestData(cls):
54.         classification = Classification.objects.create()
55.         Employee.objects.bulk_create(
56.             [
57.                 Employee(
58.                     name=e[0],
59.                     salary=e[1],
60.                     department=e[2],
61.                     hire_date=e[3],
62.                     age=e[4],
63.                     bonus=Decimal(e[1]) / 400,
64.                     classification=classification,
65.                 )
66.                 for e in [
67.                     ("Jones", 45000, "Accounting", datetime.datetime(2005, 11, 1), 20),
68.                     (
69.                         "Williams",
70.                         37000,
71.                         "Accounting",
72.                         datetime.datetime(2009, 6, 1),
73.                         20,
74.                     ),
75.                     ("Jenson", 45000, "Accounting", datetime.datetime(2008, 4, 1), 20),
76.                     ("Adams", 50000, "Accounting", datetime.datetime(2013, 7, 1), 50),
77.                     ("Smith", 55000, "Sales", datetime.datetime(2007, 6, 1), 30),
78.                     ("Brown", 53000, "Sales", datetime.datetime(2009, 9, 1), 30),
79.                     ("Johnson", 40000, "Marketing", datetime.datetime(2012, 3, 1), 30),
80.                     ("Smith", 38000, "Marketing", datetime.datetime(2009, 10, 1), 20),
81.                     ("Wilkinson", 60000, "IT", datetime.datetime(2011, 3, 1), 40),
82.                     ("Moore", 34000, "IT", datetime.datetime(2013, 8, 1), 40),
83.                     ("Miller", 100000, "Management", datetime.datetime(2005, 6, 1), 40),
84.                     ("Johnson", 80000, "Management", datetime.datetime(2005, 7, 1), 50),
85.                 ]
86.             ]
87.         )
88.         employees = list(Employee.objects.order_by("pk"))
89.         PastEmployeeDepartment.objects.bulk_create(
90.             [
91.                 PastEmployeeDepartment(employee=employees[6], department="Sales"),
92.                 PastEmployeeDepartment(employee=employees[10], department="IT"),
93.             ]
94.         )
95. 
96.     def test_dense_rank(self):
97.         tests = [
98.             ExtractYear(F("hire_date")).asc(),
99.             F("hire_date__year").asc(),
100.             "hire_date__year",
101.         ]
102.         for order_by in tests:
103.             with self.subTest(order_by=order_by):
104.                 qs = Employee.objects.annotate(
105.                     rank=Window(expression=DenseRank(), order_by=order_by),
106.                 )
107.                 self.assertQuerySetEqual(
108.                     qs,
109.                     [
110.                         ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 1),
111.                         ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 1),
112.                         ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 1),
113.                         ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 2),
114.                         ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 3),
115.                         ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 4),
116.                         ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 4),
117.                         ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 4),
118.                         ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 5),
119.                         ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 6),
120.                         ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 7),
121.                         ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 7),
122.                     ],
123.                     lambda entry: (
124.                         entry.name,
125.                         entry.salary,
126.                         entry.department,
127.                         entry.hire_date,
128.                         entry.rank,
129.                     ),
130.                     ordered=False,
131.                 )
132. 
133.     def test_department_salary(self):
134.         qs = Employee.objects.annotate(
135.             department_sum=Window(
136.                 expression=Sum("salary"),
137.                 partition_by=F("department"),
138.                 order_by=[F("hire_date").asc()],
139.             )
140.         ).order_by("department", "department_sum")
141.         self.assertQuerySetEqual(
142.             qs,
143.             [
144.                 ("Jones", "Accounting", 45000, 45000),
145.                 ("Jenson", "Accounting", 45000, 90000),
146.                 ("Williams", "Accounting", 37000, 127000),
147.                 ("Adams", "Accounting", 50000, 177000),
148.                 ("Wilkinson", "IT", 60000, 60000),
149.                 ("Moore", "IT", 34000, 94000),
150.                 ("Miller", "Management", 100000, 100000),
151.                 ("Johnson", "Management", 80000, 180000),
152.                 ("Smith", "Marketing", 38000, 38000),
153.                 ("Johnson", "Marketing", 40000, 78000),
154.                 ("Smith", "Sales", 55000, 55000),
155.                 ("Brown", "Sales", 53000, 108000),
156.             ],
157.             lambda entry: (
158.                 entry.name,
159.                 entry.department,
160.                 entry.salary,
161.                 entry.department_sum,
162.             ),
163.         )
164. 
165.     def test_rank(self):
166.         """
167.         Rank the employees based on the year they're were hired. Since there
168.         are multiple employees hired in different years, this will contain
169.         gaps.
170.         """
171.         qs = Employee.objects.annotate(
172.             rank=Window(
173.                 expression=Rank(),
174.                 order_by=F("hire_date__year").asc(),
175.             )
176.         )
177.         self.assertQuerySetEqual(
178.             qs,
179.             [
180.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 1),
181.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 1),
182.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 1),
183.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 4),
184.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 5),
185.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 6),
186.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 6),
187.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 6),
188.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 9),
189.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 10),
190.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 11),
191.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 11),
192.             ],
193.             lambda entry: (
194.                 entry.name,
195.                 entry.salary,
196.                 entry.department,
197.                 entry.hire_date,
198.                 entry.rank,
199.             ),
200.             ordered=False,
201.         )
202. 
203.     def test_row_number(self):
204.         """
205.         The row number window function computes the number based on the order
206.         in which the tuples were inserted. Depending on the backend,
207. 
208.         Oracle requires an ordering-clause in the Window expression.
209.         """
210.         qs = Employee.objects.annotate(
211.             row_number=Window(
212.                 expression=RowNumber(),
213.                 order_by=F("pk").asc(),
214.             )
215.         ).order_by("pk")
216.         self.assertQuerySetEqual(
217.             qs,
218.             [
219.                 ("Jones", "Accounting", 1),
220.                 ("Williams", "Accounting", 2),
221.                 ("Jenson", "Accounting", 3),
222.                 ("Adams", "Accounting", 4),
223.                 ("Smith", "Sales", 5),
224.                 ("Brown", "Sales", 6),
225.                 ("Johnson", "Marketing", 7),
226.                 ("Smith", "Marketing", 8),
227.                 ("Wilkinson", "IT", 9),
228.                 ("Moore", "IT", 10),
229.                 ("Miller", "Management", 11),
230.                 ("Johnson", "Management", 12),
231.             ],
232.             lambda entry: (entry.name, entry.department, entry.row_number),
233.         )
234. 
235.     def test_row_number_no_ordering(self):
236.         """
237.         The row number window function computes the number based on the order
238.         in which the tuples were inserted.
239.         """
240.         # Add a default ordering for consistent results across databases.
241.         qs = Employee.objects.annotate(
242.             row_number=Window(
243.                 expression=RowNumber(),
244.             )
245.         ).order_by("pk")
246.         self.assertQuerySetEqual(
247.             qs,
248.             [
249.                 ("Jones", "Accounting", 1),
250.                 ("Williams", "Accounting", 2),
251.                 ("Jenson", "Accounting", 3),
252.                 ("Adams", "Accounting", 4),
253.                 ("Smith", "Sales", 5),
254.                 ("Brown", "Sales", 6),
255.                 ("Johnson", "Marketing", 7),
256.                 ("Smith", "Marketing", 8),
257.                 ("Wilkinson", "IT", 9),
258.                 ("Moore", "IT", 10),
259.                 ("Miller", "Management", 11),
260.                 ("Johnson", "Management", 12),
261.             ],
262.             lambda entry: (entry.name, entry.department, entry.row_number),
263.         )
264. 
265.     def test_avg_salary_department(self):
266.         qs = Employee.objects.annotate(
267.             avg_salary=Window(
268.                 expression=Avg("salary"),
269.                 order_by=F("department").asc(),
270.                 partition_by="department",
271.             )
272.         ).order_by("department", "-salary", "name")
273.         self.assertQuerySetEqual(
274.             qs,
275.             [
276.                 ("Adams", 50000, "Accounting", 44250.00),
277.                 ("Jenson", 45000, "Accounting", 44250.00),
278.                 ("Jones", 45000, "Accounting", 44250.00),
279.                 ("Williams", 37000, "Accounting", 44250.00),
280.                 ("Wilkinson", 60000, "IT", 47000.00),
281.                 ("Moore", 34000, "IT", 47000.00),
282.                 ("Miller", 100000, "Management", 90000.00),
283.                 ("Johnson", 80000, "Management", 90000.00),
284.                 ("Johnson", 40000, "Marketing", 39000.00),
285.                 ("Smith", 38000, "Marketing", 39000.00),
286.                 ("Smith", 55000, "Sales", 54000.00),
287.                 ("Brown", 53000, "Sales", 54000.00),
288.             ],
289.             transform=lambda row: (
290.                 row.name,
291.                 row.salary,
292.                 row.department,
293.                 row.avg_salary,
294.             ),
295.         )
296. 
297.     def test_lag(self):
298.         """
299.         Compute the difference between an employee's salary and the next
300.         highest salary in the employee's department. Return None if the
301.         employee has the lowest salary.
302.         """
303.         qs = Employee.objects.annotate(
304.             lag=Window(
305.                 expression=Lag(expression="salary", offset=1),
306.                 partition_by=F("department"),
307.                 order_by=[F("salary").asc(), F("name").asc()],
308.             )
309.         ).order_by("department", F("salary").asc(), F("name").asc())
310.         self.assertQuerySetEqual(
311.             qs,
312.             [
313.                 ("Williams", 37000, "Accounting", None),
314.                 ("Jenson", 45000, "Accounting", 37000),
315.                 ("Jones", 45000, "Accounting", 45000),
316.                 ("Adams", 50000, "Accounting", 45000),
317.                 ("Moore", 34000, "IT", None),
318.                 ("Wilkinson", 60000, "IT", 34000),
319.                 ("Johnson", 80000, "Management", None),
320.                 ("Miller", 100000, "Management", 80000),
321.                 ("Smith", 38000, "Marketing", None),
322.                 ("Johnson", 40000, "Marketing", 38000),
323.                 ("Brown", 53000, "Sales", None),
324.                 ("Smith", 55000, "Sales", 53000),
325.             ],
326.             transform=lambda row: (row.name, row.salary, row.department, row.lag),
327.         )
328. 
329.     def test_lag_decimalfield(self):
330.         qs = Employee.objects.annotate(
331.             lag=Window(
332.                 expression=Lag(expression="bonus", offset=1),
333.                 partition_by=F("department"),
334.                 order_by=[F("bonus").asc(), F("name").asc()],
335.             )
336.         ).order_by("department", F("bonus").asc(), F("name").asc())
337.         self.assertQuerySetEqual(
338.             qs,
339.             [
340.                 ("Williams", 92.5, "Accounting", None),
341.                 ("Jenson", 112.5, "Accounting", 92.5),
342.                 ("Jones", 112.5, "Accounting", 112.5),
343.                 ("Adams", 125, "Accounting", 112.5),
344.                 ("Moore", 85, "IT", None),
345.                 ("Wilkinson", 150, "IT", 85),
346.                 ("Johnson", 200, "Management", None),
347.                 ("Miller", 250, "Management", 200),
348.                 ("Smith", 95, "Marketing", None),
349.                 ("Johnson", 100, "Marketing", 95),
350.                 ("Brown", 132.5, "Sales", None),
351.                 ("Smith", 137.5, "Sales", 132.5),
352.             ],
353.             transform=lambda row: (row.name, row.bonus, row.department, row.lag),
354.         )
355. 
356.     def test_first_value(self):
357.         qs = Employee.objects.annotate(
358.             first_value=Window(
359.                 expression=FirstValue("salary"),
360.                 partition_by=F("department"),
361.                 order_by=F("hire_date").asc(),
362.             )
363.         ).order_by("department", "hire_date")
364.         self.assertQuerySetEqual(
365.             qs,
366.             [
367.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
368.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 45000),
369.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 45000),
370.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 45000),
371.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
372.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 60000),
373.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
374.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 100000),
375.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
376.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 38000),
377.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
378.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 55000),
379.             ],
380.             lambda row: (
381.                 row.name,
382.                 row.salary,
383.                 row.department,
384.                 row.hire_date,
385.                 row.first_value,
386.             ),
387.         )
388. 
389.     def test_last_value(self):
390.         qs = Employee.objects.annotate(
391.             last_value=Window(
392.                 expression=LastValue("hire_date"),
393.                 partition_by=F("department"),
394.                 order_by=F("hire_date").asc(),
395.             )
396.         )
397.         self.assertQuerySetEqual(
398.             qs,
399.             [
400.                 (
401.                     "Adams",
402.                     "Accounting",
403.                     datetime.date(2013, 7, 1),
404.                     50000,
405.                     datetime.date(2013, 7, 1),
406.                 ),
407.                 (
408.                     "Jenson",
409.                     "Accounting",
410.                     datetime.date(2008, 4, 1),
411.                     45000,
412.                     datetime.date(2008, 4, 1),
413.                 ),
414.                 (
415.                     "Jones",
416.                     "Accounting",
417.                     datetime.date(2005, 11, 1),
418.                     45000,
419.                     datetime.date(2005, 11, 1),
420.                 ),
421.                 (
422.                     "Williams",
423.                     "Accounting",
424.                     datetime.date(2009, 6, 1),
425.                     37000,
426.                     datetime.date(2009, 6, 1),
427.                 ),
428.                 (
429.                     "Moore",
430.                     "IT",
431.                     datetime.date(2013, 8, 1),
432.                     34000,
433.                     datetime.date(2013, 8, 1),
434.                 ),
435.                 (
436.                     "Wilkinson",
437.                     "IT",
438.                     datetime.date(2011, 3, 1),
439.                     60000,
440.                     datetime.date(2011, 3, 1),
441.                 ),
442.                 (
443.                     "Miller",
444.                     "Management",
445.                     datetime.date(2005, 6, 1),
446.                     100000,
447.                     datetime.date(2005, 6, 1),
448.                 ),
449.                 (
450.                     "Johnson",
451.                     "Management",
452.                     datetime.date(2005, 7, 1),
453.                     80000,
454.                     datetime.date(2005, 7, 1),
455.                 ),
456.                 (
457.                     "Johnson",
458.                     "Marketing",
459.                     datetime.date(2012, 3, 1),
460.                     40000,
461.                     datetime.date(2012, 3, 1),
462.                 ),
463.                 (
464.                     "Smith",
465.                     "Marketing",
466.                     datetime.date(2009, 10, 1),
467.                     38000,
468.                     datetime.date(2009, 10, 1),
469.                 ),
470.                 (
471.                     "Brown",
472.                     "Sales",
473.                     datetime.date(2009, 9, 1),
474.                     53000,
475.                     datetime.date(2009, 9, 1),
476.                 ),
477.                 (
478.                     "Smith",
479.                     "Sales",
480.                     datetime.date(2007, 6, 1),
481.                     55000,
482.                     datetime.date(2007, 6, 1),
483.                 ),
484.             ],
485.             transform=lambda row: (
486.                 row.name,
487.                 row.department,
488.                 row.hire_date,
489.                 row.salary,
490.                 row.last_value,
491.             ),
492.             ordered=False,
493.         )
494. 
495.     def test_function_list_of_values(self):
496.         qs = (
497.             Employee.objects.annotate(
498.                 lead=Window(
499.                     expression=Lead(expression="salary"),
500.                     order_by=[F("hire_date").asc(), F("name").desc()],


File: tests/expressions_window/tests.py
Line number range: 501 - 1000
Content:
501.                     partition_by="department",
502.                 )
503.             )
504.             .values_list("name", "salary", "department", "hire_date", "lead")
505.             .order_by("department", F("hire_date").asc(), F("name").desc())
506.         )
507.         self.assertNotIn("GROUP BY", str(qs.query))
508.         self.assertSequenceEqual(
509.             qs,
510.             [
511.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
512.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 37000),
513.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 50000),
514.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
515.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 34000),
516.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
517.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 80000),
518.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
519.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 40000),
520.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
521.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 53000),
522.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
523.             ],
524.         )
525. 
526.     def test_min_department(self):
527.         """An alternative way to specify a query for FirstValue."""
528.         qs = Employee.objects.annotate(
529.             min_salary=Window(
530.                 expression=Min("salary"),
531.                 partition_by=F("department"),
532.                 order_by=[F("salary").asc(), F("name").asc()],
533.             )
534.         ).order_by("department", "salary", "name")
535.         self.assertQuerySetEqual(
536.             qs,
537.             [
538.                 ("Williams", "Accounting", 37000, 37000),
539.                 ("Jenson", "Accounting", 45000, 37000),
540.                 ("Jones", "Accounting", 45000, 37000),
541.                 ("Adams", "Accounting", 50000, 37000),
542.                 ("Moore", "IT", 34000, 34000),
543.                 ("Wilkinson", "IT", 60000, 34000),
544.                 ("Johnson", "Management", 80000, 80000),
545.                 ("Miller", "Management", 100000, 80000),
546.                 ("Smith", "Marketing", 38000, 38000),
547.                 ("Johnson", "Marketing", 40000, 38000),
548.                 ("Brown", "Sales", 53000, 53000),
549.                 ("Smith", "Sales", 55000, 53000),
550.             ],
551.             lambda row: (row.name, row.department, row.salary, row.min_salary),
552.         )
553. 
554.     def test_max_per_year(self):
555.         """
556.         Find the maximum salary awarded in the same year as the
557.         employee was hired, regardless of the department.
558.         """
559.         qs = Employee.objects.annotate(
560.             max_salary_year=Window(
561.                 expression=Max("salary"),
562.                 order_by=ExtractYear("hire_date").asc(),
563.                 partition_by=ExtractYear("hire_date"),
564.             )
565.         ).order_by(ExtractYear("hire_date"), "salary")
566.         self.assertQuerySetEqual(
567.             qs,
568.             [
569.                 ("Jones", "Accounting", 45000, 2005, 100000),
570.                 ("Johnson", "Management", 80000, 2005, 100000),
571.                 ("Miller", "Management", 100000, 2005, 100000),
572.                 ("Smith", "Sales", 55000, 2007, 55000),
573.                 ("Jenson", "Accounting", 45000, 2008, 45000),
574.                 ("Williams", "Accounting", 37000, 2009, 53000),
575.                 ("Smith", "Marketing", 38000, 2009, 53000),
576.                 ("Brown", "Sales", 53000, 2009, 53000),
577.                 ("Wilkinson", "IT", 60000, 2011, 60000),
578.                 ("Johnson", "Marketing", 40000, 2012, 40000),
579.                 ("Moore", "IT", 34000, 2013, 50000),
580.                 ("Adams", "Accounting", 50000, 2013, 50000),
581.             ],
582.             lambda row: (
583.                 row.name,
584.                 row.department,
585.                 row.salary,
586.                 row.hire_date.year,
587.                 row.max_salary_year,
588.             ),
589.         )
590. 
591.     def test_cume_dist(self):
592.         """
593.         Compute the cumulative distribution for the employees based on the
594.         salary in increasing order. Equal to rank/total number of rows (12).
595.         """
596.         qs = Employee.objects.annotate(
597.             cume_dist=Window(
598.                 expression=CumeDist(),
599.                 order_by=F("salary").asc(),
600.             )
601.         ).order_by("salary", "name")
602.         # Round result of cume_dist because Oracle uses greater precision.
603.         self.assertQuerySetEqual(
604.             qs,
605.             [
606.                 ("Moore", "IT", 34000, 0.0833333333),
607.                 ("Williams", "Accounting", 37000, 0.1666666667),
608.                 ("Smith", "Marketing", 38000, 0.25),
609.                 ("Johnson", "Marketing", 40000, 0.3333333333),
610.                 ("Jenson", "Accounting", 45000, 0.5),
611.                 ("Jones", "Accounting", 45000, 0.5),
612.                 ("Adams", "Accounting", 50000, 0.5833333333),
613.                 ("Brown", "Sales", 53000, 0.6666666667),
614.                 ("Smith", "Sales", 55000, 0.75),
615.                 ("Wilkinson", "IT", 60000, 0.8333333333),
616.                 ("Johnson", "Management", 80000, 0.9166666667),
617.                 ("Miller", "Management", 100000, 1),
618.             ],
619.             lambda row: (
620.                 row.name,
621.                 row.department,
622.                 row.salary,
623.                 round(row.cume_dist, 10),
624.             ),
625.         )
626. 
627.     def test_nthvalue(self):
628.         qs = Employee.objects.annotate(
629.             nth_value=Window(
630.                 expression=NthValue(expression="salary", nth=2),
631.                 order_by=[F("hire_date").asc(), F("name").desc()],
632.                 partition_by=F("department"),
633.             )
634.         ).order_by("department", "hire_date", "name")
635.         self.assertQuerySetEqual(
636.             qs,
637.             [
638.                 ("Jones", "Accounting", datetime.date(2005, 11, 1), 45000, None),
639.                 ("Jenson", "Accounting", datetime.date(2008, 4, 1), 45000, 45000),
640.                 ("Williams", "Accounting", datetime.date(2009, 6, 1), 37000, 45000),
641.                 ("Adams", "Accounting", datetime.date(2013, 7, 1), 50000, 45000),
642.                 ("Wilkinson", "IT", datetime.date(2011, 3, 1), 60000, None),
643.                 ("Moore", "IT", datetime.date(2013, 8, 1), 34000, 34000),
644.                 ("Miller", "Management", datetime.date(2005, 6, 1), 100000, None),
645.                 ("Johnson", "Management", datetime.date(2005, 7, 1), 80000, 80000),
646.                 ("Smith", "Marketing", datetime.date(2009, 10, 1), 38000, None),
647.                 ("Johnson", "Marketing", datetime.date(2012, 3, 1), 40000, 40000),
648.                 ("Smith", "Sales", datetime.date(2007, 6, 1), 55000, None),
649.                 ("Brown", "Sales", datetime.date(2009, 9, 1), 53000, 53000),
650.             ],
651.             lambda row: (
652.                 row.name,
653.                 row.department,
654.                 row.hire_date,
655.                 row.salary,
656.                 row.nth_value,
657.             ),
658.         )
659. 
660.     def test_lead(self):
661.         """
662.         Determine what the next person hired in the same department makes.
663.         Because the dataset is ambiguous, the name is also part of the
664.         ordering clause. No default is provided, so None/NULL should be
665.         returned.
666.         """
667.         qs = Employee.objects.annotate(
668.             lead=Window(
669.                 expression=Lead(expression="salary"),
670.                 order_by=[F("hire_date").asc(), F("name").desc()],
671.                 partition_by="department",
672.             )
673.         ).order_by("department", F("hire_date").asc(), F("name").desc())
674.         self.assertQuerySetEqual(
675.             qs,
676.             [
677.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
678.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 37000),
679.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 50000),
680.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
681.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 34000),
682.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
683.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 80000),
684.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
685.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 40000),
686.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
687.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 53000),
688.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
689.             ],
690.             transform=lambda row: (
691.                 row.name,
692.                 row.salary,
693.                 row.department,
694.                 row.hire_date,
695.                 row.lead,
696.             ),
697.         )
698. 
699.     def test_lead_offset(self):
700.         """
701.         Determine what the person hired after someone makes. Due to
702.         ambiguity, the name is also included in the ordering.
703.         """
704.         qs = Employee.objects.annotate(
705.             lead=Window(
706.                 expression=Lead("salary", offset=2),
707.                 partition_by="department",
708.                 order_by=F("hire_date").asc(),
709.             )
710.         )
711.         self.assertQuerySetEqual(
712.             qs,
713.             [
714.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 37000),
715.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 50000),
716.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), None),
717.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
718.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), None),
719.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
720.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
721.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), None),
722.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), None),
723.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
724.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), None),
725.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
726.             ],
727.             transform=lambda row: (
728.                 row.name,
729.                 row.salary,
730.                 row.department,
731.                 row.hire_date,
732.                 row.lead,
733.             ),
734.             ordered=False,
735.         )
736. 
737.     @skipUnlessDBFeature("supports_default_in_lead_lag")
738.     def test_lead_default(self):
739.         qs = Employee.objects.annotate(
740.             lead_default=Window(
741.                 expression=Lead(expression="salary", offset=5, default=60000),
742.                 partition_by=F("department"),
743.                 order_by=F("department").asc(),
744.             )
745.         )
746.         self.assertEqual(
747.             list(qs.values_list("lead_default", flat=True).distinct()), [60000]
748.         )
749. 
750.     def test_ntile(self):
751.         """
752.         Compute the group for each of the employees across the entire company,
753.         based on how high the salary is for them. There are twelve employees
754.         so it divides evenly into four groups.
755.         """
756.         qs = Employee.objects.annotate(
757.             ntile=Window(
758.                 expression=Ntile(num_buckets=4),
759.                 order_by="-salary",
760.             )
761.         ).order_by("ntile", "-salary", "name")
762.         self.assertQuerySetEqual(
763.             qs,
764.             [
765.                 ("Miller", "Management", 100000, 1),
766.                 ("Johnson", "Management", 80000, 1),
767.                 ("Wilkinson", "IT", 60000, 1),
768.                 ("Smith", "Sales", 55000, 2),
769.                 ("Brown", "Sales", 53000, 2),
770.                 ("Adams", "Accounting", 50000, 2),
771.                 ("Jenson", "Accounting", 45000, 3),
772.                 ("Jones", "Accounting", 45000, 3),
773.                 ("Johnson", "Marketing", 40000, 3),
774.                 ("Smith", "Marketing", 38000, 4),
775.                 ("Williams", "Accounting", 37000, 4),
776.                 ("Moore", "IT", 34000, 4),
777.             ],
778.             lambda x: (x.name, x.department, x.salary, x.ntile),
779.         )
780. 
781.     def test_percent_rank(self):
782.         """
783.         Calculate the percentage rank of the employees across the entire
784.         company based on salary and name (in case of ambiguity).
785.         """
786.         qs = Employee.objects.annotate(
787.             percent_rank=Window(
788.                 expression=PercentRank(),
789.                 order_by=[F("salary").asc(), F("name").asc()],
790.             )
791.         ).order_by("percent_rank")
792.         # Round to account for precision differences among databases.
793.         self.assertQuerySetEqual(
794.             qs,
795.             [
796.                 ("Moore", "IT", 34000, 0.0),
797.                 ("Williams", "Accounting", 37000, 0.0909090909),
798.                 ("Smith", "Marketing", 38000, 0.1818181818),
799.                 ("Johnson", "Marketing", 40000, 0.2727272727),
800.                 ("Jenson", "Accounting", 45000, 0.3636363636),
801.                 ("Jones", "Accounting", 45000, 0.4545454545),
802.                 ("Adams", "Accounting", 50000, 0.5454545455),
803.                 ("Brown", "Sales", 53000, 0.6363636364),
804.                 ("Smith", "Sales", 55000, 0.7272727273),
805.                 ("Wilkinson", "IT", 60000, 0.8181818182),
806.                 ("Johnson", "Management", 80000, 0.9090909091),
807.                 ("Miller", "Management", 100000, 1.0),
808.             ],
809.             transform=lambda row: (
810.                 row.name,
811.                 row.department,
812.                 row.salary,
813.                 round(row.percent_rank, 10),
814.             ),
815.         )
816. 
817.     def test_nth_returns_null(self):
818.         """
819.         Find the nth row of the data set. None is returned since there are
820.         fewer than 20 rows in the test data.
821.         """
822.         qs = Employee.objects.annotate(
823.             nth_value=Window(
824.                 expression=NthValue("salary", nth=20), order_by=F("salary").asc()
825.             )
826.         )
827.         self.assertEqual(
828.             list(qs.values_list("nth_value", flat=True).distinct()), [None]
829.         )
830. 
831.     def test_multiple_partitioning(self):
832.         """
833.         Find the maximum salary for each department for people hired in the
834.         same year.
835.         """
836.         qs = Employee.objects.annotate(
837.             max=Window(
838.                 expression=Max("salary"),
839.                 partition_by=[F("department"), F("hire_date__year")],
840.             )
841.         ).order_by("department", "hire_date", "name")
842.         self.assertQuerySetEqual(
843.             qs,
844.             [
845.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
846.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 45000),
847.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 37000),
848.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 50000),
849.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
850.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 34000),
851.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
852.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 100000),
853.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
854.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 40000),
855.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
856.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 53000),
857.             ],
858.             transform=lambda row: (
859.                 row.name,
860.                 row.salary,
861.                 row.department,
862.                 row.hire_date,
863.                 row.max,
864.             ),
865.         )
866. 
867.     def test_multiple_ordering(self):
868.         """
869.         Accumulate the salaries over the departments based on hire_date.
870.         If two people were hired on the same date in the same department, the
871.         ordering clause will render a different result for those people.
872.         """
873.         qs = Employee.objects.annotate(
874.             sum=Window(
875.                 expression=Sum("salary"),
876.                 partition_by="department",
877.                 order_by=[F("hire_date").asc(), F("name").asc()],
878.             )
879.         ).order_by("department", "sum")
880.         self.assertQuerySetEqual(
881.             qs,
882.             [
883.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
884.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 90000),
885.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 127000),
886.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 177000),
887.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
888.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 94000),
889.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
890.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 180000),
891.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
892.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 78000),
893.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
894.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 108000),
895.             ],
896.             transform=lambda row: (
897.                 row.name,
898.                 row.salary,
899.                 row.department,
900.                 row.hire_date,
901.                 row.sum,
902.             ),
903.         )
904. 
905.     def test_related_ordering_with_count(self):
906.         qs = Employee.objects.annotate(
907.             department_sum=Window(
908.                 expression=Sum("salary"),
909.                 partition_by=F("department"),
910.                 order_by=["classification__code"],
911.             )
912.         )
913.         self.assertEqual(qs.count(), 12)
914. 
915.     def test_filter(self):
916.         qs = Employee.objects.annotate(
917.             department_salary_rank=Window(
918.                 Rank(), partition_by="department", order_by="-salary"
919.             ),
920.             department_avg_age_diff=(
921.                 Window(Avg("age"), partition_by="department") - F("age")
922.             ),
923.         ).order_by("department", "name")
924.         # Direct window reference.
925.         self.assertQuerySetEqual(
926.             qs.filter(department_salary_rank=1),
927.             ["Adams", "Wilkinson", "Miller", "Johnson", "Smith"],
928.             lambda employee: employee.name,
929.         )
930.         # Through a combined expression containing a window.
931.         self.assertQuerySetEqual(
932.             qs.filter(department_avg_age_diff__gt=0),
933.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
934.             lambda employee: employee.name,
935.         )
936.         # Intersection of multiple windows.
937.         self.assertQuerySetEqual(
938.             qs.filter(department_salary_rank=1, department_avg_age_diff__gt=0),
939.             ["Miller"],
940.             lambda employee: employee.name,
941.         )
942.         # Union of multiple windows.
943.         self.assertQuerySetEqual(
944.             qs.filter(Q(department_salary_rank=1) | Q(department_avg_age_diff__gt=0)),
945.             [
946.                 "Adams",
947.                 "Jenson",
948.                 "Jones",
949.                 "Williams",
950.                 "Wilkinson",
951.                 "Miller",
952.                 "Johnson",
953.                 "Smith",
954.                 "Smith",
955.             ],
956.             lambda employee: employee.name,
957.         )
958. 
959.     def test_filter_conditional_annotation(self):
960.         qs = (
961.             Employee.objects.annotate(
962.                 rank=Window(Rank(), partition_by="department", order_by="-salary"),
963.                 case_first_rank=Case(
964.                     When(rank=1, then=True),
965.                     default=False,
966.                 ),
967.                 q_first_rank=Q(rank=1),
968.             )
969.             .order_by("name")
970.             .values_list("name", flat=True)
971.         )
972.         for annotation in ["case_first_rank", "q_first_rank"]:
973.             with self.subTest(annotation=annotation):
974.                 self.assertSequenceEqual(
975.                     qs.filter(**{annotation: True}),
976.                     ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"],
977.                 )
978. 
979.     def test_filter_conditional_expression(self):
980.         qs = (
981.             Employee.objects.filter(
982.                 Exact(Window(Rank(), partition_by="department", order_by="-salary"), 1)
983.             )
984.             .order_by("name")
985.             .values_list("name", flat=True)
986.         )
987.         self.assertSequenceEqual(
988.             qs, ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"]
989.         )
990. 
991.     def test_filter_column_ref_rhs(self):
992.         qs = (
993.             Employee.objects.annotate(
994.                 max_dept_salary=Window(Max("salary"), partition_by="department")
995.             )
996.             .filter(max_dept_salary=F("salary"))
997.             .order_by("name")
998.             .values_list("name", flat=True)
999.         )
1000.         self.assertSequenceEqual(


File: tests/expressions_window/tests.py
Line number range: 1001 - 1500
Content:
1001.             qs, ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"]
1002.         )
1003. 
1004.     def test_filter_values(self):
1005.         qs = (
1006.             Employee.objects.annotate(
1007.                 department_salary_rank=Window(
1008.                     Rank(), partition_by="department", order_by="-salary"
1009.                 ),
1010.             )
1011.             .order_by("department", "name")
1012.             .values_list(Upper("name"), flat=True)
1013.         )
1014.         self.assertSequenceEqual(
1015.             qs.filter(department_salary_rank=1),
1016.             ["ADAMS", "WILKINSON", "MILLER", "JOHNSON", "SMITH"],
1017.         )
1018. 
1019.     def test_filter_alias(self):
1020.         qs = Employee.objects.alias(
1021.             department_avg_age_diff=(
1022.                 Window(Avg("age"), partition_by="department") - F("age")
1023.             ),
1024.         ).order_by("department", "name")
1025.         self.assertQuerySetEqual(
1026.             qs.filter(department_avg_age_diff__gt=0),
1027.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1028.             lambda employee: employee.name,
1029.         )
1030. 
1031.     def test_filter_select_related(self):
1032.         qs = (
1033.             Employee.objects.alias(
1034.                 department_avg_age_diff=(
1035.                     Window(Avg("age"), partition_by="department") - F("age")
1036.                 ),
1037.             )
1038.             .select_related("classification")
1039.             .filter(department_avg_age_diff__gt=0)
1040.             .order_by("department", "name")
1041.         )
1042.         self.assertQuerySetEqual(
1043.             qs,
1044.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1045.             lambda employee: employee.name,
1046.         )
1047.         with self.assertNumQueries(0):
1048.             qs[0].classification
1049. 
1050.     def test_exclude(self):
1051.         qs = Employee.objects.annotate(
1052.             department_salary_rank=Window(
1053.                 Rank(), partition_by="department", order_by="-salary"
1054.             ),
1055.             department_avg_age_diff=(
1056.                 Window(Avg("age"), partition_by="department") - F("age")
1057.             ),
1058.         ).order_by("department", "name")
1059.         # Direct window reference.
1060.         self.assertQuerySetEqual(
1061.             qs.exclude(department_salary_rank__gt=1),
1062.             ["Adams", "Wilkinson", "Miller", "Johnson", "Smith"],
1063.             lambda employee: employee.name,
1064.         )
1065.         # Through a combined expression containing a window.
1066.         self.assertQuerySetEqual(
1067.             qs.exclude(department_avg_age_diff__lte=0),
1068.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1069.             lambda employee: employee.name,
1070.         )
1071.         # Union of multiple windows.
1072.         self.assertQuerySetEqual(
1073.             qs.exclude(
1074.                 Q(department_salary_rank__gt=1) | Q(department_avg_age_diff__lte=0)
1075.             ),
1076.             ["Miller"],
1077.             lambda employee: employee.name,
1078.         )
1079.         # Intersection of multiple windows.
1080.         self.assertQuerySetEqual(
1081.             qs.exclude(department_salary_rank__gt=1, department_avg_age_diff__lte=0),
1082.             [
1083.                 "Adams",
1084.                 "Jenson",
1085.                 "Jones",
1086.                 "Williams",
1087.                 "Wilkinson",
1088.                 "Miller",
1089.                 "Johnson",
1090.                 "Smith",
1091.                 "Smith",
1092.             ],
1093.             lambda employee: employee.name,
1094.         )
1095. 
1096.     def test_heterogeneous_filter(self):
1097.         qs = (
1098.             Employee.objects.annotate(
1099.                 department_salary_rank=Window(
1100.                     Rank(), partition_by="department", order_by="-salary"
1101.                 ),
1102.             )
1103.             .order_by("name")
1104.             .values_list("name", flat=True)
1105.         )
1106.         # Heterogeneous filter between window function and aggregates pushes
1107.         # the WHERE clause to the QUALIFY outer query.
1108.         self.assertSequenceEqual(
1109.             qs.filter(
1110.                 department_salary_rank=1, department__in=["Accounting", "Management"]
1111.             ),
1112.             ["Adams", "Miller"],
1113.         )
1114.         self.assertSequenceEqual(
1115.             qs.filter(
1116.                 Q(department_salary_rank=1)
1117.                 | Q(department__in=["Accounting", "Management"])
1118.             ),
1119.             [
1120.                 "Adams",
1121.                 "Jenson",
1122.                 "Johnson",
1123.                 "Johnson",
1124.                 "Jones",
1125.                 "Miller",
1126.                 "Smith",
1127.                 "Wilkinson",
1128.                 "Williams",
1129.             ],
1130.         )
1131.         # Heterogeneous filter between window function and aggregates pushes
1132.         # the HAVING clause to the QUALIFY outer query.
1133.         qs = qs.annotate(past_department_count=Count("past_departments"))
1134.         self.assertSequenceEqual(
1135.             qs.filter(department_salary_rank=1, past_department_count__gte=1),
1136.             ["Johnson", "Miller"],
1137.         )
1138.         self.assertSequenceEqual(
1139.             qs.filter(Q(department_salary_rank=1) | Q(past_department_count__gte=1)),
1140.             ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"],
1141.         )
1142. 
1143.     def test_limited_filter(self):
1144.         """
1145.         A query filtering against a window function have its limit applied
1146.         after window filtering takes place.
1147.         """
1148.         self.assertQuerySetEqual(
1149.             Employee.objects.annotate(
1150.                 department_salary_rank=Window(
1151.                     Rank(), partition_by="department", order_by="-salary"
1152.                 )
1153.             )
1154.             .filter(department_salary_rank=1)
1155.             .order_by("department")[0:3],
1156.             ["Adams", "Wilkinson", "Miller"],
1157.             lambda employee: employee.name,
1158.         )
1159. 
1160.     def test_filter_count(self):
1161.         with CaptureQueriesContext(connection) as ctx:
1162.             self.assertEqual(
1163.                 Employee.objects.annotate(
1164.                     department_salary_rank=Window(
1165.                         Rank(), partition_by="department", order_by="-salary"
1166.                     )
1167.                 )
1168.                 .filter(department_salary_rank=1)
1169.                 .count(),
1170.                 5,
1171.             )
1172.         self.assertEqual(len(ctx.captured_queries), 1)
1173.         sql = ctx.captured_queries[0]["sql"].lower()
1174.         self.assertEqual(sql.count("select"), 3)
1175.         self.assertNotIn("group by", sql)
1176. 
1177.     @skipUnlessDBFeature("supports_frame_range_fixed_distance")
1178.     def test_range_n_preceding_and_following(self):
1179.         qs = Employee.objects.annotate(
1180.             sum=Window(
1181.                 expression=Sum("salary"),
1182.                 order_by=F("salary").asc(),
1183.                 partition_by="department",
1184.                 frame=ValueRange(start=-2, end=2),
1185.             )
1186.         )
1187.         self.assertIn("RANGE BETWEEN 2 PRECEDING AND 2 FOLLOWING", str(qs.query))
1188.         self.assertQuerySetEqual(
1189.             qs,
1190.             [
1191.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 37000),
1192.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 90000),
1193.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 90000),
1194.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 50000),
1195.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 53000),
1196.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
1197.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 40000),
1198.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
1199.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
1200.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 34000),
1201.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
1202.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 80000),
1203.             ],
1204.             transform=lambda row: (
1205.                 row.name,
1206.                 row.salary,
1207.                 row.department,
1208.                 row.hire_date,
1209.                 row.sum,
1210.             ),
1211.             ordered=False,
1212.         )
1213. 
1214.     def test_range_unbound(self):
1215.         """A query with RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING."""
1216.         qs = Employee.objects.annotate(
1217.             sum=Window(
1218.                 expression=Sum("salary"),
1219.                 partition_by="age",
1220.                 order_by=[F("age").asc()],
1221.                 frame=ValueRange(start=None, end=None),
1222.             )
1223.         ).order_by("department", "hire_date", "name")
1224.         self.assertIn(
1225.             "RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING", str(qs.query)
1226.         )
1227.         self.assertQuerySetEqual(
1228.             qs,
1229.             [
1230.                 ("Jones", "Accounting", 45000, datetime.date(2005, 11, 1), 165000),
1231.                 ("Jenson", "Accounting", 45000, datetime.date(2008, 4, 1), 165000),
1232.                 ("Williams", "Accounting", 37000, datetime.date(2009, 6, 1), 165000),
1233.                 ("Adams", "Accounting", 50000, datetime.date(2013, 7, 1), 130000),
1234.                 ("Wilkinson", "IT", 60000, datetime.date(2011, 3, 1), 194000),
1235.                 ("Moore", "IT", 34000, datetime.date(2013, 8, 1), 194000),
1236.                 ("Miller", "Management", 100000, datetime.date(2005, 6, 1), 194000),
1237.                 ("Johnson", "Management", 80000, datetime.date(2005, 7, 1), 130000),
1238.                 ("Smith", "Marketing", 38000, datetime.date(2009, 10, 1), 165000),
1239.                 ("Johnson", "Marketing", 40000, datetime.date(2012, 3, 1), 148000),
1240.                 ("Smith", "Sales", 55000, datetime.date(2007, 6, 1), 148000),
1241.                 ("Brown", "Sales", 53000, datetime.date(2009, 9, 1), 148000),
1242.             ],
1243.             transform=lambda row: (
1244.                 row.name,
1245.                 row.department,
1246.                 row.salary,
1247.                 row.hire_date,
1248.                 row.sum,
1249.             ),
1250.         )
1251. 
1252.     def test_subquery_row_range_rank(self):
1253.         qs = Employee.objects.annotate(
1254.             highest_avg_salary_date=Subquery(
1255.                 Employee.objects.filter(
1256.                     department=OuterRef("department"),
1257.                 )
1258.                 .annotate(
1259.                     avg_salary=Window(
1260.                         expression=Avg("salary"),
1261.                         order_by=[F("hire_date").asc()],
1262.                         frame=RowRange(start=-1, end=1),
1263.                     ),
1264.                 )
1265.                 .order_by("-avg_salary", "hire_date")
1266.                 .values("hire_date")[:1],
1267.             ),
1268.         ).order_by("department", "name")
1269.         self.assertQuerySetEqual(
1270.             qs,
1271.             [
1272.                 ("Adams", "Accounting", datetime.date(2005, 11, 1)),
1273.                 ("Jenson", "Accounting", datetime.date(2005, 11, 1)),
1274.                 ("Jones", "Accounting", datetime.date(2005, 11, 1)),
1275.                 ("Williams", "Accounting", datetime.date(2005, 11, 1)),
1276.                 ("Moore", "IT", datetime.date(2011, 3, 1)),
1277.                 ("Wilkinson", "IT", datetime.date(2011, 3, 1)),
1278.                 ("Johnson", "Management", datetime.date(2005, 6, 1)),
1279.                 ("Miller", "Management", datetime.date(2005, 6, 1)),
1280.                 ("Johnson", "Marketing", datetime.date(2009, 10, 1)),
1281.                 ("Smith", "Marketing", datetime.date(2009, 10, 1)),
1282.                 ("Brown", "Sales", datetime.date(2007, 6, 1)),
1283.                 ("Smith", "Sales", datetime.date(2007, 6, 1)),
1284.             ],
1285.             transform=lambda row: (
1286.                 row.name,
1287.                 row.department,
1288.                 row.highest_avg_salary_date,
1289.             ),
1290.         )
1291. 
1292.     def test_row_range_rank(self):
1293.         """
1294.         A query with ROWS BETWEEN UNBOUNDED PRECEDING AND 3 FOLLOWING.
1295.         The resulting sum is the sum of the three next (if they exist) and all
1296.         previous rows according to the ordering clause.
1297.         """
1298.         qs = Employee.objects.annotate(
1299.             sum=Window(
1300.                 expression=Sum("salary"),
1301.                 order_by=[F("hire_date").asc(), F("name").desc()],
1302.                 frame=RowRange(start=None, end=3),
1303.             )
1304.         ).order_by("sum", "hire_date")
1305.         self.assertIn("ROWS BETWEEN UNBOUNDED PRECEDING AND 3 FOLLOWING", str(qs.query))
1306.         self.assertQuerySetEqual(
1307.             qs,
1308.             [
1309.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 280000),
1310.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 325000),
1311.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 362000),
1312.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 415000),
1313.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 453000),
1314.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 513000),
1315.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 553000),
1316.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 603000),
1317.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 637000),
1318.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 637000),
1319.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 637000),
1320.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 637000),
1321.             ],
1322.             transform=lambda row: (
1323.                 row.name,
1324.                 row.salary,
1325.                 row.department,
1326.                 row.hire_date,
1327.                 row.sum,
1328.             ),
1329.         )
1330. 
1331.     @skipUnlessDBFeature("can_distinct_on_fields")
1332.     def test_distinct_window_function(self):
1333.         """
1334.         Window functions are not aggregates, and hence a query to filter out
1335.         duplicates may be useful.
1336.         """
1337.         qs = (
1338.             Employee.objects.annotate(
1339.                 sum=Window(
1340.                     expression=Sum("salary"),
1341.                     partition_by=ExtractYear("hire_date"),
1342.                     order_by=ExtractYear("hire_date"),
1343.                 ),
1344.                 year=ExtractYear("hire_date"),
1345.             )
1346.             .filter(sum__gte=45000)
1347.             .values("year", "sum")
1348.             .distinct("year")
1349.             .order_by("year")
1350.         )
1351.         results = [
1352.             {"year": 2005, "sum": 225000},
1353.             {"year": 2007, "sum": 55000},
1354.             {"year": 2008, "sum": 45000},
1355.             {"year": 2009, "sum": 128000},
1356.             {"year": 2011, "sum": 60000},
1357.             {"year": 2013, "sum": 84000},
1358.         ]
1359.         for idx, val in zip(range(len(results)), results):
1360.             with self.subTest(result=val):
1361.                 self.assertEqual(qs[idx], val)
1362. 
1363.     def test_fail_update(self):
1364.         """Window expressions can't be used in an UPDATE statement."""
1365.         msg = (
1366.             "Window expressions are not allowed in this query (salary=<Window: "
1367.             "Max(Col(expressions_window_employee, expressions_window.Employee.salary)) "
1368.             "OVER (PARTITION BY Col(expressions_window_employee, "
1369.             "expressions_window.Employee.department))>)."
1370.         )
1371.         with self.assertRaisesMessage(FieldError, msg):
1372.             Employee.objects.filter(department="Management").update(
1373.                 salary=Window(expression=Max("salary"), partition_by="department"),
1374.             )
1375. 
1376.     def test_fail_insert(self):
1377.         """Window expressions can't be used in an INSERT statement."""
1378.         msg = (
1379.             "Window expressions are not allowed in this query (salary=<Window: "
1380.             "Sum(Value(10000), order_by=OrderBy(F(pk), descending=False)) OVER ()"
1381.         )
1382.         with self.assertRaisesMessage(FieldError, msg):
1383.             Employee.objects.create(
1384.                 name="Jameson",
1385.                 department="Management",
1386.                 hire_date=datetime.date(2007, 7, 1),
1387.                 salary=Window(expression=Sum(Value(10000), order_by=F("pk").asc())),
1388.             )
1389. 
1390.     def test_window_expression_within_subquery(self):
1391.         subquery_qs = Employee.objects.annotate(
1392.             highest=Window(
1393.                 FirstValue("id"),
1394.                 partition_by=F("department"),
1395.                 order_by=F("salary").desc(),
1396.             )
1397.         ).values("highest")
1398.         highest_salary = Employee.objects.filter(pk__in=subquery_qs)
1399.         self.assertCountEqual(
1400.             highest_salary.values("department", "salary"),
1401.             [
1402.                 {"department": "Accounting", "salary": 50000},
1403.                 {"department": "Sales", "salary": 55000},
1404.                 {"department": "Marketing", "salary": 40000},
1405.                 {"department": "IT", "salary": 60000},
1406.                 {"department": "Management", "salary": 100000},
1407.             ],
1408.         )
1409. 
1410.     @skipUnlessDBFeature("supports_json_field")
1411.     def test_key_transform(self):
1412.         Detail.objects.bulk_create(
1413.             [
1414.                 Detail(value={"department": "IT", "name": "Smith", "salary": 37000}),
1415.                 Detail(value={"department": "IT", "name": "Nowak", "salary": 32000}),
1416.                 Detail(value={"department": "HR", "name": "Brown", "salary": 50000}),
1417.                 Detail(value={"department": "HR", "name": "Smith", "salary": 55000}),
1418.                 Detail(value={"department": "PR", "name": "Moore", "salary": 90000}),
1419.             ]
1420.         )
1421.         tests = [
1422.             (KeyTransform("department", "value"), KeyTransform("name", "value")),
1423.             (F("value__department"), F("value__name")),
1424.         ]
1425.         for partition_by, order_by in tests:
1426.             with self.subTest(partition_by=partition_by, order_by=order_by):
1427.                 qs = Detail.objects.annotate(
1428.                     department_sum=Window(
1429.                         expression=Sum(
1430.                             Cast(
1431.                                 KeyTextTransform("salary", "value"),
1432.                                 output_field=IntegerField(),
1433.                             )
1434.                         ),
1435.                         partition_by=[partition_by],
1436.                         order_by=[order_by],
1437.                     )
1438.                 ).order_by("value__department", "department_sum")
1439.                 self.assertQuerySetEqual(
1440.                     qs,
1441.                     [
1442.                         ("Brown", "HR", 50000, 50000),
1443.                         ("Smith", "HR", 55000, 105000),
1444.                         ("Nowak", "IT", 32000, 32000),
1445.                         ("Smith", "IT", 37000, 69000),
1446.                         ("Moore", "PR", 90000, 90000),
1447.                     ],
1448.                     lambda entry: (
1449.                         entry.value["name"],
1450.                         entry.value["department"],
1451.                         entry.value["salary"],
1452.                         entry.department_sum,
1453.                     ),
1454.                 )
1455. 
1456.     def test_invalid_start_value_range(self):
1457.         msg = "start argument must be a negative integer, zero, or None, but got '3'."
1458.         with self.assertRaisesMessage(ValueError, msg):
1459.             list(
1460.                 Employee.objects.annotate(
1461.                     test=Window(
1462.                         expression=Sum("salary"),
1463.                         order_by=F("hire_date").asc(),
1464.                         frame=ValueRange(start=3),
1465.                     )
1466.                 )
1467.             )
1468. 
1469.     def test_invalid_end_value_range(self):
1470.         msg = "end argument must be a positive integer, zero, or None, but got '-3'."
1471.         with self.assertRaisesMessage(ValueError, msg):
1472.             list(
1473.                 Employee.objects.annotate(
1474.                     test=Window(
1475.                         expression=Sum("salary"),
1476.                         order_by=F("hire_date").asc(),
1477.                         frame=ValueRange(end=-3),
1478.                     )
1479.                 )
1480.             )
1481. 
1482.     def test_invalid_type_end_value_range(self):
1483.         msg = "end argument must be a positive integer, zero, or None, but got 'a'."
1484.         with self.assertRaisesMessage(ValueError, msg):
1485.             list(
1486.                 Employee.objects.annotate(
1487.                     test=Window(
1488.                         expression=Sum("salary"),
1489.                         order_by=F("hire_date").asc(),
1490.                         frame=ValueRange(end="a"),
1491.                     )
1492.                 )
1493.             )
1494. 
1495.     def test_invalid_type_start_value_range(self):
1496.         msg = "start argument must be a negative integer, zero, or None, but got 'a'."
1497.         with self.assertRaisesMessage(ValueError, msg):
1498.             list(
1499.                 Employee.objects.annotate(
1500.                     test=Window(


File: tests/expressions_window/tests.py
Line number range: 1501 - 2000
Content:
1501.                         expression=Sum("salary"),
1502.                         frame=ValueRange(start="a"),
1503.                     )
1504.                 )
1505.             )
1506. 
1507.     def test_invalid_type_end_row_range(self):
1508.         msg = "end argument must be a positive integer, zero, or None, but got 'a'."
1509.         with self.assertRaisesMessage(ValueError, msg):
1510.             list(
1511.                 Employee.objects.annotate(
1512.                     test=Window(
1513.                         expression=Sum("salary"),
1514.                         frame=RowRange(end="a"),
1515.                     )
1516.                 )
1517.             )
1518. 
1519.     @skipUnlessDBFeature("only_supports_unbounded_with_preceding_and_following")
1520.     def test_unsupported_range_frame_start(self):
1521.         msg = (
1522.             "%s only supports UNBOUNDED together with PRECEDING and FOLLOWING."
1523.             % connection.display_name
1524.         )
1525.         with self.assertRaisesMessage(NotSupportedError, msg):
1526.             list(
1527.                 Employee.objects.annotate(
1528.                     test=Window(
1529.                         expression=Sum("salary"),
1530.                         order_by=F("hire_date").asc(),
1531.                         frame=ValueRange(start=-1),
1532.                     )
1533.                 )
1534.             )
1535. 
1536.     @skipUnlessDBFeature("only_supports_unbounded_with_preceding_and_following")
1537.     def test_unsupported_range_frame_end(self):
1538.         msg = (
1539.             "%s only supports UNBOUNDED together with PRECEDING and FOLLOWING."
1540.             % connection.display_name
1541.         )
1542.         with self.assertRaisesMessage(NotSupportedError, msg):
1543.             list(
1544.                 Employee.objects.annotate(
1545.                     test=Window(
1546.                         expression=Sum("salary"),
1547.                         order_by=F("hire_date").asc(),
1548.                         frame=ValueRange(end=1),
1549.                     )
1550.                 )
1551.             )
1552. 
1553.     def test_invalid_type_start_row_range(self):
1554.         msg = "start argument must be a negative integer, zero, or None, but got 'a'."
1555.         with self.assertRaisesMessage(ValueError, msg):
1556.             list(
1557.                 Employee.objects.annotate(
1558.                     test=Window(
1559.                         expression=Sum("salary"),
1560.                         order_by=F("hire_date").asc(),
1561.                         frame=RowRange(start="a"),
1562.                     )
1563.                 )
1564.             )
1565. 
1566.     def test_invalid_filter(self):
1567.         msg = (
1568.             "Heterogeneous disjunctive predicates against window functions are not "
1569.             "implemented when performing conditional aggregation."
1570.         )
1571.         qs = Employee.objects.annotate(
1572.             window=Window(Rank()),
1573.             past_dept_cnt=Count("past_departments"),
1574.         )
1575.         with self.assertRaisesMessage(NotImplementedError, msg):
1576.             list(qs.filter(Q(window=1) | Q(department="Accounting")))
1577.         with self.assertRaisesMessage(NotImplementedError, msg):
1578.             list(qs.exclude(window=1, department="Accounting"))
1579. 
1580. 
1581. class WindowUnsupportedTests(TestCase):
1582.     def test_unsupported_backend(self):
1583.         msg = "This backend does not support window expressions."
1584.         with mock.patch.object(connection.features, "supports_over_clause", False):
1585.             with self.assertRaisesMessage(NotSupportedError, msg):
1586.                 Employee.objects.annotate(
1587.                     dense_rank=Window(expression=DenseRank())
1588.                 ).get()
1589. 
1590.     def test_filter_subquery(self):
1591.         qs = Employee.objects.annotate(
1592.             department_salary_rank=Window(
1593.                 Rank(), partition_by="department", order_by="-salary"
1594.             )
1595.         )
1596.         msg = (
1597.             "Referencing outer query window expression is not supported: "
1598.             "department_salary_rank."
1599.         )
1600.         with self.assertRaisesMessage(NotSupportedError, msg):
1601.             qs.annotate(
1602.                 employee_name=Subquery(
1603.                     Employee.objects.filter(
1604.                         age=OuterRef("department_salary_rank")
1605.                     ).values("name")[:1]
1606.                 )
1607.             )
1608. 
1609. 
1610. class NonQueryWindowTests(SimpleTestCase):
1611.     def test_window_repr(self):
1612.         self.assertEqual(
1613.             repr(Window(expression=Sum("salary"), partition_by="department")),
1614.             "<Window: Sum(F(salary)) OVER (PARTITION BY F(department))>",
1615.         )
1616.         self.assertEqual(
1617.             repr(Window(expression=Avg("salary"), order_by=F("department").asc())),
1618.             "<Window: Avg(F(salary)) OVER (OrderByList(OrderBy(F(department), "
1619.             "descending=False)))>",
1620.         )
1621. 
1622.     def test_window_frame_repr(self):
1623.         self.assertEqual(
1624.             repr(RowRange(start=-1)),
1625.             "<RowRange: ROWS BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING>",
1626.         )
1627.         self.assertEqual(
1628.             repr(ValueRange(start=None, end=1)),
1629.             "<ValueRange: RANGE BETWEEN UNBOUNDED PRECEDING AND 1 FOLLOWING>",
1630.         )
1631.         self.assertEqual(
1632.             repr(ValueRange(start=0, end=0)),
1633.             "<ValueRange: RANGE BETWEEN CURRENT ROW AND CURRENT ROW>",
1634.         )
1635.         self.assertEqual(
1636.             repr(RowRange(start=0, end=0)),
1637.             "<RowRange: ROWS BETWEEN CURRENT ROW AND CURRENT ROW>",
1638.         )
1639. 
1640.     def test_empty_group_by_cols(self):
1641.         window = Window(expression=Sum("pk"))
1642.         self.assertEqual(window.get_group_by_cols(), [])
1643.         self.assertFalse(window.contains_aggregate)
1644. 
1645.     def test_frame_empty_group_by_cols(self):
1646.         frame = WindowFrame()
1647.         self.assertEqual(frame.get_group_by_cols(), [])
1648. 
1649.     def test_frame_window_frame_notimplemented(self):
1650.         frame = WindowFrame()
1651.         msg = "Subclasses must implement window_frame_start_end()."
1652.         with self.assertRaisesMessage(NotImplementedError, msg):
1653.             frame.window_frame_start_end(None, None, None)
1654. 
1655.     def test_invalid_order_by(self):
1656.         msg = (
1657.             "Window.order_by must be either a string reference to a field, an "
1658.             "expression, or a list or tuple of them."
1659.         )
1660.         with self.assertRaisesMessage(ValueError, msg):
1661.             Window(expression=Sum("power"), order_by={"-horse"})
1662. 
1663.     def test_invalid_source_expression(self):
1664.         msg = "Expression 'Upper' isn't compatible with OVER clauses."
1665.         with self.assertRaisesMessage(ValueError, msg):
1666.             Window(expression=Upper("name"))

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 01:45:11,384 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions_window/tests.py'. This context block encompasses the entire file, from line 1 to line 1666, as provided in the context chunks.", relative_path='tests/expressions_window/tests.py', start_line=1, end_line=1666)]
2025-12-23 01:45:11,387 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of tests/expressions_window/tests.py.
2025-12-23 01:45:11,387 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 01:45:11,388 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 01:45:11,388 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-23 01:45:11,388 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-23 01:45:11,389 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── data
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       ├── selenium.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_IE
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── csrf_403.html
|           ├── default_urlconf.html
|           ├── directory_index.html
|           ├── i18n_catalog.js
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── delete-app.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   ├── tutorial08.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.18.txt
|   |   ├── 3.2.19.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.20.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.10.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.10.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.8.txt
|   |   ├── 4.1.9.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.1.txt
|   |   ├── 4.2.2.txt
|   |   ├── 4.2.3.txt
|   |   ├── 4.2.4.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_related_object_lookups.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_auth.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   ├── ending_with_dollar.py
    |       |   ├── matched_angle_brackets.py
    |       |   └── unmatched_angle_brackets.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   ├── test_cache.py
    |   ├── test_clickjacking.py
    |   ├── test_common.py
    |   ├── test_csrf.py
    |   ├── test_http.py
    |   ├── test_vary.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_field.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── obsolete_translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   └── urls
    |       ├── __init__.py
    |       ├── http.py
    |       └── https.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── nonutf8
    |   |   |   └── nonutf8.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_escapeseq.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Cannot use aggregate over window functions since 4.2

Description: Description
	 
		(last modified by younes-chaoui)
	 
After upgrading to Django 4.2, I encountered an exception when executing ORM queries that involve aggregates over Window functions. The specific error was psycopg2.errors.GroupingError: aggregate function calls cannot contain window function calls
Dependencies :
psycopg2 version: 2.9.3
django version: 4.2.3
PostgreSQL version: 13.4
Example Code:
queryset = queryset.annotate(
	cumul_DJR=Coalesce(Window(Sum("DJR"), order_by=F("date").asc()), 0.0)
)
aggregate = queryset.aggregate(
	DJR_total=Sum("DJR"),
	cumul_DJR_total=Sum("cumul_DJR")
)

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 13a6809dd8..514a6b36ce 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -454,6 +454,9 @@ class Query(BaseExpression):
             or qualify
             or self.distinct
             or self.combinator
+            or any(
+                aggregate.contains_over_clause for aggregate in aggregates.values()
+            )
         ):
             from django.db.models.sql.subqueries import AggregateQuery
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of tests/expressions_window/tests.py.
Extra Requirements: 
Purpose: This file is expected to contain test cases for window functions, which are at the core of the reported bug. I will analyze it to find tests that aggregate over window function annotations.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/expressions_window/tests.py
Line number range: 1 - 1666
Content:
1. import datetime
2. from decimal import Decimal
3. from unittest import mock
4. 
5. from django.core.exceptions import FieldError
6. from django.db import NotSupportedError, connection
7. from django.db.models import (
8.     Avg,
9.     Case,
10.     Count,
11.     F,
12.     IntegerField,
13.     Max,
14.     Min,
15.     OuterRef,
16.     Q,
17.     RowRange,
18.     Subquery,
19.     Sum,
20.     Value,
21.     ValueRange,
22.     When,
23.     Window,
24.     WindowFrame,
25. )
26. from django.db.models.fields.json import KeyTextTransform, KeyTransform
27. from django.db.models.functions import (
28.     Cast,
29.     CumeDist,
30.     DenseRank,
31.     ExtractYear,
32.     FirstValue,
33.     Lag,
34.     LastValue,
35.     Lead,
36.     NthValue,
37.     Ntile,
38.     PercentRank,
39.     Rank,
40.     RowNumber,
41.     Upper,
42. )
43. from django.db.models.lookups import Exact
44. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
45. from django.test.utils import CaptureQueriesContext
46. 
47. from .models import Classification, Detail, Employee, PastEmployeeDepartment
48. 
49. 
50. @skipUnlessDBFeature("supports_over_clause")
51. class WindowFunctionTests(TestCase):
52.     @classmethod
53.     def setUpTestData(cls):
54.         classification = Classification.objects.create()
55.         Employee.objects.bulk_create(
56.             [
57.                 Employee(
58.                     name=e[0],
59.                     salary=e[1],
60.                     department=e[2],
61.                     hire_date=e[3],
62.                     age=e[4],
63.                     bonus=Decimal(e[1]) / 400,
64.                     classification=classification,
65.                 )
66.                 for e in [
67.                     ("Jones", 45000, "Accounting", datetime.datetime(2005, 11, 1), 20),
68.                     (
69.                         "Williams",
70.                         37000,
71.                         "Accounting",
72.                         datetime.datetime(2009, 6, 1),
73.                         20,
74.                     ),
75.                     ("Jenson", 45000, "Accounting", datetime.datetime(2008, 4, 1), 20),
76.                     ("Adams", 50000, "Accounting", datetime.datetime(2013, 7, 1), 50),
77.                     ("Smith", 55000, "Sales", datetime.datetime(2007, 6, 1), 30),
78.                     ("Brown", 53000, "Sales", datetime.datetime(2009, 9, 1), 30),
79.                     ("Johnson", 40000, "Marketing", datetime.datetime(2012, 3, 1), 30),
80.                     ("Smith", 38000, "Marketing", datetime.datetime(2009, 10, 1), 20),
81.                     ("Wilkinson", 60000, "IT", datetime.datetime(2011, 3, 1), 40),
82.                     ("Moore", 34000, "IT", datetime.datetime(2013, 8, 1), 40),
83.                     ("Miller", 100000, "Management", datetime.datetime(2005, 6, 1), 40),
84.                     ("Johnson", 80000, "Management", datetime.datetime(2005, 7, 1), 50),
85.                 ]
86.             ]
87.         )
88.         employees = list(Employee.objects.order_by("pk"))
89.         PastEmployeeDepartment.objects.bulk_create(
90.             [
91.                 PastEmployeeDepartment(employee=employees[6], department="Sales"),
92.                 PastEmployeeDepartment(employee=employees[10], department="IT"),
93.             ]
94.         )
95. 
96.     def test_dense_rank(self):
97.         tests = [
98.             ExtractYear(F("hire_date")).asc(),
99.             F("hire_date__year").asc(),
100.             "hire_date__year",
101.         ]
102.         for order_by in tests:
103.             with self.subTest(order_by=order_by):
104.                 qs = Employee.objects.annotate(
105.                     rank=Window(expression=DenseRank(), order_by=order_by),
106.                 )
107.                 self.assertQuerySetEqual(
108.                     qs,
109.                     [
110.                         ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 1),
111.                         ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 1),
112.                         ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 1),
113.                         ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 2),
114.                         ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 3),
115.                         ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 4),
116.                         ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 4),
117.                         ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 4),
118.                         ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 5),
119.                         ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 6),
120.                         ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 7),
121.                         ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 7),
122.                     ],
123.                     lambda entry: (
124.                         entry.name,
125.                         entry.salary,
126.                         entry.department,
127.                         entry.hire_date,
128.                         entry.rank,
129.                     ),
130.                     ordered=False,
131.                 )
132. 
133.     def test_department_salary(self):
134.         qs = Employee.objects.annotate(
135.             department_sum=Window(
136.                 expression=Sum("salary"),
137.                 partition_by=F("department"),
138.                 order_by=[F("hire_date").asc()],
139.             )
140.         ).order_by("department", "department_sum")
141.         self.assertQuerySetEqual(
142.             qs,
143.             [
144.                 ("Jones", "Accounting", 45000, 45000),
145.                 ("Jenson", "Accounting", 45000, 90000),
146.                 ("Williams", "Accounting", 37000, 127000),
147.                 ("Adams", "Accounting", 50000, 177000),
148.                 ("Wilkinson", "IT", 60000, 60000),
149.                 ("Moore", "IT", 34000, 94000),
150.                 ("Miller", "Management", 100000, 100000),
151.                 ("Johnson", "Management", 80000, 180000),
152.                 ("Smith", "Marketing", 38000, 38000),
153.                 ("Johnson", "Marketing", 40000, 78000),
154.                 ("Smith", "Sales", 55000, 55000),
155.                 ("Brown", "Sales", 53000, 108000),
156.             ],
157.             lambda entry: (
158.                 entry.name,
159.                 entry.department,
160.                 entry.salary,
161.                 entry.department_sum,
162.             ),
163.         )
164. 
165.     def test_rank(self):
166.         """
167.         Rank the employees based on the year they're were hired. Since there
168.         are multiple employees hired in different years, this will contain
169.         gaps.
170.         """
171.         qs = Employee.objects.annotate(
172.             rank=Window(
173.                 expression=Rank(),
174.                 order_by=F("hire_date__year").asc(),
175.             )
176.         )
177.         self.assertQuerySetEqual(
178.             qs,
179.             [
180.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 1),
181.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 1),
182.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 1),
183.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 4),
184.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 5),
185.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 6),
186.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 6),
187.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 6),
188.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 9),
189.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 10),
190.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 11),
191.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 11),
192.             ],
193.             lambda entry: (
194.                 entry.name,
195.                 entry.salary,
196.                 entry.department,
197.                 entry.hire_date,
198.                 entry.rank,
199.             ),
200.             ordered=False,
201.         )
202. 
203.     def test_row_number(self):
204.         """
205.         The row number window function computes the number based on the order
206.         in which the tuples were inserted. Depending on the backend,
207. 
208.         Oracle requires an ordering-clause in the Window expression.
209.         """
210.         qs = Employee.objects.annotate(
211.             row_number=Window(
212.                 expression=RowNumber(),
213.                 order_by=F("pk").asc(),
214.             )
215.         ).order_by("pk")
216.         self.assertQuerySetEqual(
217.             qs,
218.             [
219.                 ("Jones", "Accounting", 1),
220.                 ("Williams", "Accounting", 2),
221.                 ("Jenson", "Accounting", 3),
222.                 ("Adams", "Accounting", 4),
223.                 ("Smith", "Sales", 5),
224.                 ("Brown", "Sales", 6),
225.                 ("Johnson", "Marketing", 7),
226.                 ("Smith", "Marketing", 8),
227.                 ("Wilkinson", "IT", 9),
228.                 ("Moore", "IT", 10),
229.                 ("Miller", "Management", 11),
230.                 ("Johnson", "Management", 12),
231.             ],
232.             lambda entry: (entry.name, entry.department, entry.row_number),
233.         )
234. 
235.     def test_row_number_no_ordering(self):
236.         """
237.         The row number window function computes the number based on the order
238.         in which the tuples were inserted.
239.         """
240.         # Add a default ordering for consistent results across databases.
241.         qs = Employee.objects.annotate(
242.             row_number=Window(
243.                 expression=RowNumber(),
244.             )
245.         ).order_by("pk")
246.         self.assertQuerySetEqual(
247.             qs,
248.             [
249.                 ("Jones", "Accounting", 1),
250.                 ("Williams", "Accounting", 2),
251.                 ("Jenson", "Accounting", 3),
252.                 ("Adams", "Accounting", 4),
253.                 ("Smith", "Sales", 5),
254.                 ("Brown", "Sales", 6),
255.                 ("Johnson", "Marketing", 7),
256.                 ("Smith", "Marketing", 8),
257.                 ("Wilkinson", "IT", 9),
258.                 ("Moore", "IT", 10),
259.                 ("Miller", "Management", 11),
260.                 ("Johnson", "Management", 12),
261.             ],
262.             lambda entry: (entry.name, entry.department, entry.row_number),
263.         )
264. 
265.     def test_avg_salary_department(self):
266.         qs = Employee.objects.annotate(
267.             avg_salary=Window(
268.                 expression=Avg("salary"),
269.                 order_by=F("department").asc(),
270.                 partition_by="department",
271.             )
272.         ).order_by("department", "-salary", "name")
273.         self.assertQuerySetEqual(
274.             qs,
275.             [
276.                 ("Adams", 50000, "Accounting", 44250.00),
277.                 ("Jenson", 45000, "Accounting", 44250.00),
278.                 ("Jones", 45000, "Accounting", 44250.00),
279.                 ("Williams", 37000, "Accounting", 44250.00),
280.                 ("Wilkinson", 60000, "IT", 47000.00),
281.                 ("Moore", 34000, "IT", 47000.00),
282.                 ("Miller", 100000, "Management", 90000.00),
283.                 ("Johnson", 80000, "Management", 90000.00),
284.                 ("Johnson", 40000, "Marketing", 39000.00),
285.                 ("Smith", 38000, "Marketing", 39000.00),
286.                 ("Smith", 55000, "Sales", 54000.00),
287.                 ("Brown", 53000, "Sales", 54000.00),
288.             ],
289.             transform=lambda row: (
290.                 row.name,
291.                 row.salary,
292.                 row.department,
293.                 row.avg_salary,
294.             ),
295.         )
296. 
297.     def test_lag(self):
298.         """
299.         Compute the difference between an employee's salary and the next
300.         highest salary in the employee's department. Return None if the
301.         employee has the lowest salary.
302.         """
303.         qs = Employee.objects.annotate(
304.             lag=Window(
305.                 expression=Lag(expression="salary", offset=1),
306.                 partition_by=F("department"),
307.                 order_by=[F("salary").asc(), F("name").asc()],
308.             )
309.         ).order_by("department", F("salary").asc(), F("name").asc())
310.         self.assertQuerySetEqual(
311.             qs,
312.             [
313.                 ("Williams", 37000, "Accounting", None),
314.                 ("Jenson", 45000, "Accounting", 37000),
315.                 ("Jones", 45000, "Accounting", 45000),
316.                 ("Adams", 50000, "Accounting", 45000),
317.                 ("Moore", 34000, "IT", None),
318.                 ("Wilkinson", 60000, "IT", 34000),
319.                 ("Johnson", 80000, "Management", None),
320.                 ("Miller", 100000, "Management", 80000),
321.                 ("Smith", 38000, "Marketing", None),
322.                 ("Johnson", 40000, "Marketing", 38000),
323.                 ("Brown", 53000, "Sales", None),
324.                 ("Smith", 55000, "Sales", 53000),
325.             ],
326.             transform=lambda row: (row.name, row.salary, row.department, row.lag),
327.         )
328. 
329.     def test_lag_decimalfield(self):
330.         qs = Employee.objects.annotate(
331.             lag=Window(
332.                 expression=Lag(expression="bonus", offset=1),
333.                 partition_by=F("department"),
334.                 order_by=[F("bonus").asc(), F("name").asc()],
335.             )
336.         ).order_by("department", F("bonus").asc(), F("name").asc())
337.         self.assertQuerySetEqual(
338.             qs,
339.             [
340.                 ("Williams", 92.5, "Accounting", None),
341.                 ("Jenson", 112.5, "Accounting", 92.5),
342.                 ("Jones", 112.5, "Accounting", 112.5),
343.                 ("Adams", 125, "Accounting", 112.5),
344.                 ("Moore", 85, "IT", None),
345.                 ("Wilkinson", 150, "IT", 85),
346.                 ("Johnson", 200, "Management", None),
347.                 ("Miller", 250, "Management", 200),
348.                 ("Smith", 95, "Marketing", None),
349.                 ("Johnson", 100, "Marketing", 95),
350.                 ("Brown", 132.5, "Sales", None),
351.                 ("Smith", 137.5, "Sales", 132.5),
352.             ],
353.             transform=lambda row: (row.name, row.bonus, row.department, row.lag),
354.         )
355. 
356.     def test_first_value(self):
357.         qs = Employee.objects.annotate(
358.             first_value=Window(
359.                 expression=FirstValue("salary"),
360.                 partition_by=F("department"),
361.                 order_by=F("hire_date").asc(),
362.             )
363.         ).order_by("department", "hire_date")
364.         self.assertQuerySetEqual(
365.             qs,
366.             [
367.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
368.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 45000),
369.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 45000),
370.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 45000),
371.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
372.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 60000),
373.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
374.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 100000),
375.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
376.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 38000),
377.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
378.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 55000),
379.             ],
380.             lambda row: (
381.                 row.name,
382.                 row.salary,
383.                 row.department,
384.                 row.hire_date,
385.                 row.first_value,
386.             ),
387.         )
388. 
389.     def test_last_value(self):
390.         qs = Employee.objects.annotate(
391.             last_value=Window(
392.                 expression=LastValue("hire_date"),
393.                 partition_by=F("department"),
394.                 order_by=F("hire_date").asc(),
395.             )
396.         )
397.         self.assertQuerySetEqual(
398.             qs,
399.             [
400.                 (
401.                     "Adams",
402.                     "Accounting",
403.                     datetime.date(2013, 7, 1),
404.                     50000,
405.                     datetime.date(2013, 7, 1),
406.                 ),
407.                 (
408.                     "Jenson",
409.                     "Accounting",
410.                     datetime.date(2008, 4, 1),
411.                     45000,
412.                     datetime.date(2008, 4, 1),
413.                 ),
414.                 (
415.                     "Jones",
416.                     "Accounting",
417.                     datetime.date(2005, 11, 1),
418.                     45000,
419.                     datetime.date(2005, 11, 1),
420.                 ),
421.                 (
422.                     "Williams",
423.                     "Accounting",
424.                     datetime.date(2009, 6, 1),
425.                     37000,
426.                     datetime.date(2009, 6, 1),
427.                 ),
428.                 (
429.                     "Moore",
430.                     "IT",
431.                     datetime.date(2013, 8, 1),
432.                     34000,
433.                     datetime.date(2013, 8, 1),
434.                 ),
435.                 (
436.                     "Wilkinson",
437.                     "IT",
438.                     datetime.date(2011, 3, 1),
439.                     60000,
440.                     datetime.date(2011, 3, 1),
441.                 ),
442.                 (
443.                     "Miller",
444.                     "Management",
445.                     datetime.date(2005, 6, 1),
446.                     100000,
447.                     datetime.date(2005, 6, 1),
448.                 ),
449.                 (
450.                     "Johnson",
451.                     "Management",
452.                     datetime.date(2005, 7, 1),
453.                     80000,
454.                     datetime.date(2005, 7, 1),
455.                 ),
456.                 (
457.                     "Johnson",
458.                     "Marketing",
459.                     datetime.date(2012, 3, 1),
460.                     40000,
461.                     datetime.date(2012, 3, 1),
462.                 ),
463.                 (
464.                     "Smith",
465.                     "Marketing",
466.                     datetime.date(2009, 10, 1),
467.                     38000,
468.                     datetime.date(2009, 10, 1),
469.                 ),
470.                 (
471.                     "Brown",
472.                     "Sales",
473.                     datetime.date(2009, 9, 1),
474.                     53000,
475.                     datetime.date(2009, 9, 1),
476.                 ),
477.                 (
478.                     "Smith",
479.                     "Sales",
480.                     datetime.date(2007, 6, 1),
481.                     55000,
482.                     datetime.date(2007, 6, 1),
483.                 ),
484.             ],
485.             transform=lambda row: (
486.                 row.name,
487.                 row.department,
488.                 row.hire_date,
489.                 row.salary,
490.                 row.last_value,
491.             ),
492.             ordered=False,
493.         )
494. 
495.     def test_function_list_of_values(self):
496.         qs = (
497.             Employee.objects.annotate(
498.                 lead=Window(
499.                     expression=Lead(expression="salary"),
500.                     order_by=[F("hire_date").asc(), F("name").desc()],
501.                     partition_by="department",
502.                 )
503.             )
504.             .values_list("name", "salary", "department", "hire_date", "lead")
505.             .order_by("department", F("hire_date").asc(), F("name").desc())
506.         )
507.         self.assertNotIn("GROUP BY", str(qs.query))
508.         self.assertSequenceEqual(
509.             qs,
510.             [
511.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
512.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 37000),
513.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 50000),
514.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
515.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 34000),
516.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
517.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 80000),
518.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
519.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 40000),
520.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
521.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 53000),
522.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
523.             ],
524.         )
525. 
526.     def test_min_department(self):
527.         """An alternative way to specify a query for FirstValue."""
528.         qs = Employee.objects.annotate(
529.             min_salary=Window(
530.                 expression=Min("salary"),
531.                 partition_by=F("department"),
532.                 order_by=[F("salary").asc(), F("name").asc()],
533.             )
534.         ).order_by("department", "salary", "name")
535.         self.assertQuerySetEqual(
536.             qs,
537.             [
538.                 ("Williams", "Accounting", 37000, 37000),
539.                 ("Jenson", "Accounting", 45000, 37000),
540.                 ("Jones", "Accounting", 45000, 37000),
541.                 ("Adams", "Accounting", 50000, 37000),
542.                 ("Moore", "IT", 34000, 34000),
543.                 ("Wilkinson", "IT", 60000, 34000),
544.                 ("Johnson", "Management", 80000, 80000),
545.                 ("Miller", "Management", 100000, 80000),
546.                 ("Smith", "Marketing", 38000, 38000),
547.                 ("Johnson", "Marketing", 40000, 38000),
548.                 ("Brown", "Sales", 53000, 53000),
549.                 ("Smith", "Sales", 55000, 53000),
550.             ],
551.             lambda row: (row.name, row.department, row.salary, row.min_salary),
552.         )
553. 
554.     def test_max_per_year(self):
555.         """
556.         Find the maximum salary awarded in the same year as the
557.         employee was hired, regardless of the department.
558.         """
559.         qs = Employee.objects.annotate(
560.             max_salary_year=Window(
561.                 expression=Max("salary"),
562.                 order_by=ExtractYear("hire_date").asc(),
563.                 partition_by=ExtractYear("hire_date"),
564.             )
565.         ).order_by(ExtractYear("hire_date"), "salary")
566.         self.assertQuerySetEqual(
567.             qs,
568.             [
569.                 ("Jones", "Accounting", 45000, 2005, 100000),
570.                 ("Johnson", "Management", 80000, 2005, 100000),
571.                 ("Miller", "Management", 100000, 2005, 100000),
572.                 ("Smith", "Sales", 55000, 2007, 55000),
573.                 ("Jenson", "Accounting", 45000, 2008, 45000),
574.                 ("Williams", "Accounting", 37000, 2009, 53000),
575.                 ("Smith", "Marketing", 38000, 2009, 53000),
576.                 ("Brown", "Sales", 53000, 2009, 53000),
577.                 ("Wilkinson", "IT", 60000, 2011, 60000),
578.                 ("Johnson", "Marketing", 40000, 2012, 40000),
579.                 ("Moore", "IT", 34000, 2013, 50000),
580.                 ("Adams", "Accounting", 50000, 2013, 50000),
581.             ],
582.             lambda row: (
583.                 row.name,
584.                 row.department,
585.                 row.salary,
586.                 row.hire_date.year,
587.                 row.max_salary_year,
588.             ),
589.         )
590. 
591.     def test_cume_dist(self):
592.         """
593.         Compute the cumulative distribution for the employees based on the
594.         salary in increasing order. Equal to rank/total number of rows (12).
595.         """
596.         qs = Employee.objects.annotate(
597.             cume_dist=Window(
598.                 expression=CumeDist(),
599.                 order_by=F("salary").asc(),
600.             )
601.         ).order_by("salary", "name")
602.         # Round result of cume_dist because Oracle uses greater precision.
603.         self.assertQuerySetEqual(
604.             qs,
605.             [
606.                 ("Moore", "IT", 34000, 0.0833333333),
607.                 ("Williams", "Accounting", 37000, 0.1666666667),
608.                 ("Smith", "Marketing", 38000, 0.25),
609.                 ("Johnson", "Marketing", 40000, 0.3333333333),
610.                 ("Jenson", "Accounting", 45000, 0.5),
611.                 ("Jones", "Accounting", 45000, 0.5),
612.                 ("Adams", "Accounting", 50000, 0.5833333333),
613.                 ("Brown", "Sales", 53000, 0.6666666667),
614.                 ("Smith", "Sales", 55000, 0.75),
615.                 ("Wilkinson", "IT", 60000, 0.8333333333),
616.                 ("Johnson", "Management", 80000, 0.9166666667),
617.                 ("Miller", "Management", 100000, 1),
618.             ],
619.             lambda row: (
620.                 row.name,
621.                 row.department,
622.                 row.salary,
623.                 round(row.cume_dist, 10),
624.             ),
625.         )
626. 
627.     def test_nthvalue(self):
628.         qs = Employee.objects.annotate(
629.             nth_value=Window(
630.                 expression=NthValue(expression="salary", nth=2),
631.                 order_by=[F("hire_date").asc(), F("name").desc()],
632.                 partition_by=F("department"),
633.             )
634.         ).order_by("department", "hire_date", "name")
635.         self.assertQuerySetEqual(
636.             qs,
637.             [
638.                 ("Jones", "Accounting", datetime.date(2005, 11, 1), 45000, None),
639.                 ("Jenson", "Accounting", datetime.date(2008, 4, 1), 45000, 45000),
640.                 ("Williams", "Accounting", datetime.date(2009, 6, 1), 37000, 45000),
641.                 ("Adams", "Accounting", datetime.date(2013, 7, 1), 50000, 45000),
642.                 ("Wilkinson", "IT", datetime.date(2011, 3, 1), 60000, None),
643.                 ("Moore", "IT", datetime.date(2013, 8, 1), 34000, 34000),
644.                 ("Miller", "Management", datetime.date(2005, 6, 1), 100000, None),
645.                 ("Johnson", "Management", datetime.date(2005, 7, 1), 80000, 80000),
646.                 ("Smith", "Marketing", datetime.date(2009, 10, 1), 38000, None),
647.                 ("Johnson", "Marketing", datetime.date(2012, 3, 1), 40000, 40000),
648.                 ("Smith", "Sales", datetime.date(2007, 6, 1), 55000, None),
649.                 ("Brown", "Sales", datetime.date(2009, 9, 1), 53000, 53000),
650.             ],
651.             lambda row: (
652.                 row.name,
653.                 row.department,
654.                 row.hire_date,
655.                 row.salary,
656.                 row.nth_value,
657.             ),
658.         )
659. 
660.     def test_lead(self):
661.         """
662.         Determine what the next person hired in the same department makes.
663.         Because the dataset is ambiguous, the name is also part of the
664.         ordering clause. No default is provided, so None/NULL should be
665.         returned.
666.         """
667.         qs = Employee.objects.annotate(
668.             lead=Window(
669.                 expression=Lead(expression="salary"),
670.                 order_by=[F("hire_date").asc(), F("name").desc()],
671.                 partition_by="department",
672.             )
673.         ).order_by("department", F("hire_date").asc(), F("name").desc())
674.         self.assertQuerySetEqual(
675.             qs,
676.             [
677.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
678.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 37000),
679.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 50000),
680.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
681.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 34000),
682.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
683.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 80000),
684.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
685.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 40000),
686.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
687.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 53000),
688.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
689.             ],
690.             transform=lambda row: (
691.                 row.name,
692.                 row.salary,
693.                 row.department,
694.                 row.hire_date,
695.                 row.lead,
696.             ),
697.         )
698. 
699.     def test_lead_offset(self):
700.         """
701.         Determine what the person hired after someone makes. Due to
702.         ambiguity, the name is also included in the ordering.
703.         """
704.         qs = Employee.objects.annotate(
705.             lead=Window(
706.                 expression=Lead("salary", offset=2),
707.                 partition_by="department",
708.                 order_by=F("hire_date").asc(),
709.             )
710.         )
711.         self.assertQuerySetEqual(
712.             qs,
713.             [
714.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 37000),
715.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 50000),
716.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), None),
717.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
718.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), None),
719.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
720.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
721.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), None),
722.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), None),
723.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
724.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), None),
725.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
726.             ],
727.             transform=lambda row: (
728.                 row.name,
729.                 row.salary,
730.                 row.department,
731.                 row.hire_date,
732.                 row.lead,
733.             ),
734.             ordered=False,
735.         )
736. 
737.     @skipUnlessDBFeature("supports_default_in_lead_lag")
738.     def test_lead_default(self):
739.         qs = Employee.objects.annotate(
740.             lead_default=Window(
741.                 expression=Lead(expression="salary", offset=5, default=60000),
742.                 partition_by=F("department"),
743.                 order_by=F("department").asc(),
744.             )
745.         )
746.         self.assertEqual(
747.             list(qs.values_list("lead_default", flat=True).distinct()), [60000]
748.         )
749. 
750.     def test_ntile(self):
751.         """
752.         Compute the group for each of the employees across the entire company,
753.         based on how high the salary is for them. There are twelve employees
754.         so it divides evenly into four groups.
755.         """
756.         qs = Employee.objects.annotate(
757.             ntile=Window(
758.                 expression=Ntile(num_buckets=4),
759.                 order_by="-salary",
760.             )
761.         ).order_by("ntile", "-salary", "name")
762.         self.assertQuerySetEqual(
763.             qs,
764.             [
765.                 ("Miller", "Management", 100000, 1),
766.                 ("Johnson", "Management", 80000, 1),
767.                 ("Wilkinson", "IT", 60000, 1),
768.                 ("Smith", "Sales", 55000, 2),
769.                 ("Brown", "Sales", 53000, 2),
770.                 ("Adams", "Accounting", 50000, 2),
771.                 ("Jenson", "Accounting", 45000, 3),
772.                 ("Jones", "Accounting", 45000, 3),
773.                 ("Johnson", "Marketing", 40000, 3),
774.                 ("Smith", "Marketing", 38000, 4),
775.                 ("Williams", "Accounting", 37000, 4),
776.                 ("Moore", "IT", 34000, 4),
777.             ],
778.             lambda x: (x.name, x.department, x.salary, x.ntile),
779.         )
780. 
781.     def test_percent_rank(self):
782.         """
783.         Calculate the percentage rank of the employees across the entire
784.         company based on salary and name (in case of ambiguity).
785.         """
786.         qs = Employee.objects.annotate(
787.             percent_rank=Window(
788.                 expression=PercentRank(),
789.                 order_by=[F("salary").asc(), F("name").asc()],
790.             )
791.         ).order_by("percent_rank")
792.         # Round to account for precision differences among databases.
793.         self.assertQuerySetEqual(
794.             qs,
795.             [
796.                 ("Moore", "IT", 34000, 0.0),
797.                 ("Williams", "Accounting", 37000, 0.0909090909),
798.                 ("Smith", "Marketing", 38000, 0.1818181818),
799.                 ("Johnson", "Marketing", 40000, 0.2727272727),
800.                 ("Jenson", "Accounting", 45000, 0.3636363636),
801.                 ("Jones", "Accounting", 45000, 0.4545454545),
802.                 ("Adams", "Accounting", 50000, 0.5454545455),
803.                 ("Brown", "Sales", 53000, 0.6363636364),
804.                 ("Smith", "Sales", 55000, 0.7272727273),
805.                 ("Wilkinson", "IT", 60000, 0.8181818182),
806.                 ("Johnson", "Management", 80000, 0.9090909091),
807.                 ("Miller", "Management", 100000, 1.0),
808.             ],
809.             transform=lambda row: (
810.                 row.name,
811.                 row.department,
812.                 row.salary,
813.                 round(row.percent_rank, 10),
814.             ),
815.         )
816. 
817.     def test_nth_returns_null(self):
818.         """
819.         Find the nth row of the data set. None is returned since there are
820.         fewer than 20 rows in the test data.
821.         """
822.         qs = Employee.objects.annotate(
823.             nth_value=Window(
824.                 expression=NthValue("salary", nth=20), order_by=F("salary").asc()
825.             )
826.         )
827.         self.assertEqual(
828.             list(qs.values_list("nth_value", flat=True).distinct()), [None]
829.         )
830. 
831.     def test_multiple_partitioning(self):
832.         """
833.         Find the maximum salary for each department for people hired in the
834.         same year.
835.         """
836.         qs = Employee.objects.annotate(
837.             max=Window(
838.                 expression=Max("salary"),
839.                 partition_by=[F("department"), F("hire_date__year")],
840.             )
841.         ).order_by("department", "hire_date", "name")
842.         self.assertQuerySetEqual(
843.             qs,
844.             [
845.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
846.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 45000),
847.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 37000),
848.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 50000),
849.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
850.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 34000),
851.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
852.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 100000),
853.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
854.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 40000),
855.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
856.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 53000),
857.             ],
858.             transform=lambda row: (
859.                 row.name,
860.                 row.salary,
861.                 row.department,
862.                 row.hire_date,
863.                 row.max,
864.             ),
865.         )
866. 
867.     def test_multiple_ordering(self):
868.         """
869.         Accumulate the salaries over the departments based on hire_date.
870.         If two people were hired on the same date in the same department, the
871.         ordering clause will render a different result for those people.
872.         """
873.         qs = Employee.objects.annotate(
874.             sum=Window(
875.                 expression=Sum("salary"),
876.                 partition_by="department",
877.                 order_by=[F("hire_date").asc(), F("name").asc()],
878.             )
879.         ).order_by("department", "sum")
880.         self.assertQuerySetEqual(
881.             qs,
882.             [
883.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
884.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 90000),
885.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 127000),
886.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 177000),
887.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
888.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 94000),
889.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
890.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 180000),
891.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
892.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 78000),
893.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
894.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 108000),
895.             ],
896.             transform=lambda row: (
897.                 row.name,
898.                 row.salary,
899.                 row.department,
900.                 row.hire_date,
901.                 row.sum,
902.             ),
903.         )
904. 
905.     def test_related_ordering_with_count(self):
906.         qs = Employee.objects.annotate(
907.             department_sum=Window(
908.                 expression=Sum("salary"),
909.                 partition_by=F("department"),
910.                 order_by=["classification__code"],
911.             )
912.         )
913.         self.assertEqual(qs.count(), 12)
914. 
915.     def test_filter(self):
916.         qs = Employee.objects.annotate(
917.             department_salary_rank=Window(
918.                 Rank(), partition_by="department", order_by="-salary"
919.             ),
920.             department_avg_age_diff=(
921.                 Window(Avg("age"), partition_by="department") - F("age")
922.             ),
923.         ).order_by("department", "name")
924.         # Direct window reference.
925.         self.assertQuerySetEqual(
926.             qs.filter(department_salary_rank=1),
927.             ["Adams", "Wilkinson", "Miller", "Johnson", "Smith"],
928.             lambda employee: employee.name,
929.         )
930.         # Through a combined expression containing a window.
931.         self.assertQuerySetEqual(
932.             qs.filter(department_avg_age_diff__gt=0),
933.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
934.             lambda employee: employee.name,
935.         )
936.         # Intersection of multiple windows.
937.         self.assertQuerySetEqual(
938.             qs.filter(department_salary_rank=1, department_avg_age_diff__gt=0),
939.             ["Miller"],
940.             lambda employee: employee.name,
941.         )
942.         # Union of multiple windows.
943.         self.assertQuerySetEqual(
944.             qs.filter(Q(department_salary_rank=1) | Q(department_avg_age_diff__gt=0)),
945.             [
946.                 "Adams",
947.                 "Jenson",
948.                 "Jones",
949.                 "Williams",
950.                 "Wilkinson",
951.                 "Miller",
952.                 "Johnson",
953.                 "Smith",
954.                 "Smith",
955.             ],
956.             lambda employee: employee.name,
957.         )
958. 
959.     def test_filter_conditional_annotation(self):
960.         qs = (
961.             Employee.objects.annotate(
962.                 rank=Window(Rank(), partition_by="department", order_by="-salary"),
963.                 case_first_rank=Case(
964.                     When(rank=1, then=True),
965.                     default=False,
966.                 ),
967.                 q_first_rank=Q(rank=1),
968.             )
969.             .order_by("name")
970.             .values_list("name", flat=True)
971.         )
972.         for annotation in ["case_first_rank", "q_first_rank"]:
973.             with self.subTest(annotation=annotation):
974.                 self.assertSequenceEqual(
975.                     qs.filter(**{annotation: True}),
976.                     ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"],
977.                 )
978. 
979.     def test_filter_conditional_expression(self):
980.         qs = (
981.             Employee.objects.filter(
982.                 Exact(Window(Rank(), partition_by="department", order_by="-salary"), 1)
983.             )
984.             .order_by("name")
985.             .values_list("name", flat=True)
986.         )
987.         self.assertSequenceEqual(
988.             qs, ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"]
989.         )
990. 
991.     def test_filter_column_ref_rhs(self):
992.         qs = (
993.             Employee.objects.annotate(
994.                 max_dept_salary=Window(Max("salary"), partition_by="department")
995.             )
996.             .filter(max_dept_salary=F("salary"))
997.             .order_by("name")
998.             .values_list("name", flat=True)
999.         )
1000.         self.assertSequenceEqual(
1001.             qs, ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"]
1002.         )
1003. 
1004.     def test_filter_values(self):
1005.         qs = (
1006.             Employee.objects.annotate(
1007.                 department_salary_rank=Window(
1008.                     Rank(), partition_by="department", order_by="-salary"
1009.                 ),
1010.             )
1011.             .order_by("department", "name")
1012.             .values_list(Upper("name"), flat=True)
1013.         )
1014.         self.assertSequenceEqual(
1015.             qs.filter(department_salary_rank=1),
1016.             ["ADAMS", "WILKINSON", "MILLER", "JOHNSON", "SMITH"],
1017.         )
1018. 
1019.     def test_filter_alias(self):
1020.         qs = Employee.objects.alias(
1021.             department_avg_age_diff=(
1022.                 Window(Avg("age"), partition_by="department") - F("age")
1023.             ),
1024.         ).order_by("department", "name")
1025.         self.assertQuerySetEqual(
1026.             qs.filter(department_avg_age_diff__gt=0),
1027.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1028.             lambda employee: employee.name,
1029.         )
1030. 
1031.     def test_filter_select_related(self):
1032.         qs = (
1033.             Employee.objects.alias(
1034.                 department_avg_age_diff=(
1035.                     Window(Avg("age"), partition_by="department") - F("age")
1036.                 ),
1037.             )
1038.             .select_related("classification")
1039.             .filter(department_avg_age_diff__gt=0)
1040.             .order_by("department", "name")
1041.         )
1042.         self.assertQuerySetEqual(
1043.             qs,
1044.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1045.             lambda employee: employee.name,
1046.         )
1047.         with self.assertNumQueries(0):
1048.             qs[0].classification
1049. 
1050.     def test_exclude(self):
1051.         qs = Employee.objects.annotate(
1052.             department_salary_rank=Window(
1053.                 Rank(), partition_by="department", order_by="-salary"
1054.             ),
1055.             department_avg_age_diff=(
1056.                 Window(Avg("age"), partition_by="department") - F("age")
1057.             ),
1058.         ).order_by("department", "name")
1059.         # Direct window reference.
1060.         self.assertQuerySetEqual(
1061.             qs.exclude(department_salary_rank__gt=1),
1062.             ["Adams", "Wilkinson", "Miller", "Johnson", "Smith"],
1063.             lambda employee: employee.name,
1064.         )
1065.         # Through a combined expression containing a window.
1066.         self.assertQuerySetEqual(
1067.             qs.exclude(department_avg_age_diff__lte=0),
1068.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1069.             lambda employee: employee.name,
1070.         )
1071.         # Union of multiple windows.
1072.         self.assertQuerySetEqual(
1073.             qs.exclude(
1074.                 Q(department_salary_rank__gt=1) | Q(department_avg_age_diff__lte=0)
1075.             ),
1076.             ["Miller"],
1077.             lambda employee: employee.name,
1078.         )
1079.         # Intersection of multiple windows.
1080.         self.assertQuerySetEqual(
1081.             qs.exclude(department_salary_rank__gt=1, department_avg_age_diff__lte=0),
1082.             [
1083.                 "Adams",
1084.                 "Jenson",
1085.                 "Jones",
1086.                 "Williams",
1087.                 "Wilkinson",
1088.                 "Miller",
1089.                 "Johnson",
1090.                 "Smith",
1091.                 "Smith",
1092.             ],
1093.             lambda employee: employee.name,
1094.         )
1095. 
1096.     def test_heterogeneous_filter(self):
1097.         qs = (
1098.             Employee.objects.annotate(
1099.                 department_salary_rank=Window(
1100.                     Rank(), partition_by="department", order_by="-salary"
1101.                 ),
1102.             )
1103.             .order_by("name")
1104.             .values_list("name", flat=True)
1105.         )
1106.         # Heterogeneous filter between window function and aggregates pushes
1107.         # the WHERE clause to the QUALIFY outer query.
1108.         self.assertSequenceEqual(
1109.             qs.filter(
1110.                 department_salary_rank=1, department__in=["Accounting", "Management"]
1111.             ),
1112.             ["Adams", "Miller"],
1113.         )
1114.         self.assertSequenceEqual(
1115.             qs.filter(
1116.                 Q(department_salary_rank=1)
1117.                 | Q(department__in=["Accounting", "Management"])
1118.             ),
1119.             [
1120.                 "Adams",
1121.                 "Jenson",
1122.                 "Johnson",
1123.                 "Johnson",
1124.                 "Jones",
1125.                 "Miller",
1126.                 "Smith",
1127.                 "Wilkinson",
1128.                 "Williams",
1129.             ],
1130.         )
1131.         # Heterogeneous filter between window function and aggregates pushes
1132.         # the HAVING clause to the QUALIFY outer query.
1133.         qs = qs.annotate(past_department_count=Count("past_departments"))
1134.         self.assertSequenceEqual(
1135.             qs.filter(department_salary_rank=1, past_department_count__gte=1),
1136.             ["Johnson", "Miller"],
1137.         )
1138.         self.assertSequenceEqual(
1139.             qs.filter(Q(department_salary_rank=1) | Q(past_department_count__gte=1)),
1140.             ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"],
1141.         )
1142. 
1143.     def test_limited_filter(self):
1144.         """
1145.         A query filtering against a window function have its limit applied
1146.         after window filtering takes place.
1147.         """
1148.         self.assertQuerySetEqual(
1149.             Employee.objects.annotate(
1150.                 department_salary_rank=Window(
1151.                     Rank(), partition_by="department", order_by="-salary"
1152.                 )
1153.             )
1154.             .filter(department_salary_rank=1)
1155.             .order_by("department")[0:3],
1156.             ["Adams", "Wilkinson", "Miller"],
1157.             lambda employee: employee.name,
1158.         )
1159. 
1160.     def test_filter_count(self):
1161.         with CaptureQueriesContext(connection) as ctx:
1162.             self.assertEqual(
1163.                 Employee.objects.annotate(
1164.                     department_salary_rank=Window(
1165.                         Rank(), partition_by="department", order_by="-salary"
1166.                     )
1167.                 )
1168.                 .filter(department_salary_rank=1)
1169.                 .count(),
1170.                 5,
1171.             )
1172.         self.assertEqual(len(ctx.captured_queries), 1)
1173.         sql = ctx.captured_queries[0]["sql"].lower()
1174.         self.assertEqual(sql.count("select"), 3)
1175.         self.assertNotIn("group by", sql)
1176. 
1177.     @skipUnlessDBFeature("supports_frame_range_fixed_distance")
1178.     def test_range_n_preceding_and_following(self):
1179.         qs = Employee.objects.annotate(
1180.             sum=Window(
1181.                 expression=Sum("salary"),
1182.                 order_by=F("salary").asc(),
1183.                 partition_by="department",
1184.                 frame=ValueRange(start=-2, end=2),
1185.             )
1186.         )
1187.         self.assertIn("RANGE BETWEEN 2 PRECEDING AND 2 FOLLOWING", str(qs.query))
1188.         self.assertQuerySetEqual(
1189.             qs,
1190.             [
1191.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 37000),
1192.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 90000),
1193.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 90000),
1194.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 50000),
1195.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 53000),
1196.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
1197.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 40000),
1198.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
1199.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
1200.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 34000),
1201.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
1202.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 80000),
1203.             ],
1204.             transform=lambda row: (
1205.                 row.name,
1206.                 row.salary,
1207.                 row.department,
1208.                 row.hire_date,
1209.                 row.sum,
1210.             ),
1211.             ordered=False,
1212.         )
1213. 
1214.     def test_range_unbound(self):
1215.         """A query with RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING."""
1216.         qs = Employee.objects.annotate(
1217.             sum=Window(
1218.                 expression=Sum("salary"),
1219.                 partition_by="age",
1220.                 order_by=[F("age").asc()],
1221.                 frame=ValueRange(start=None, end=None),
1222.             )
1223.         ).order_by("department", "hire_date", "name")
1224.         self.assertIn(
1225.             "RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING", str(qs.query)
1226.         )
1227.         self.assertQuerySetEqual(
1228.             qs,
1229.             [
1230.                 ("Jones", "Accounting", 45000, datetime.date(2005, 11, 1), 165000),
1231.                 ("Jenson", "Accounting", 45000, datetime.date(2008, 4, 1), 165000),
1232.                 ("Williams", "Accounting", 37000, datetime.date(2009, 6, 1), 165000),
1233.                 ("Adams", "Accounting", 50000, datetime.date(2013, 7, 1), 130000),
1234.                 ("Wilkinson", "IT", 60000, datetime.date(2011, 3, 1), 194000),
1235.                 ("Moore", "IT", 34000, datetime.date(2013, 8, 1), 194000),
1236.                 ("Miller", "Management", 100000, datetime.date(2005, 6, 1), 194000),
1237.                 ("Johnson", "Management", 80000, datetime.date(2005, 7, 1), 130000),
1238.                 ("Smith", "Marketing", 38000, datetime.date(2009, 10, 1), 165000),
1239.                 ("Johnson", "Marketing", 40000, datetime.date(2012, 3, 1), 148000),
1240.                 ("Smith", "Sales", 55000, datetime.date(2007, 6, 1), 148000),
1241.                 ("Brown", "Sales", 53000, datetime.date(2009, 9, 1), 148000),
1242.             ],
1243.             transform=lambda row: (
1244.                 row.name,
1245.                 row.department,
1246.                 row.salary,
1247.                 row.hire_date,
1248.                 row.sum,
1249.             ),
1250.         )
1251. 
1252.     def test_subquery_row_range_rank(self):
1253.         qs = Employee.objects.annotate(
1254.             highest_avg_salary_date=Subquery(
1255.                 Employee.objects.filter(
1256.                     department=OuterRef("department"),
1257.                 )
1258.                 .annotate(
1259.                     avg_salary=Window(
1260.                         expression=Avg("salary"),
1261.                         order_by=[F("hire_date").asc()],
1262.                         frame=RowRange(start=-1, end=1),
1263.                     ),
1264.                 )
1265.                 .order_by("-avg_salary", "hire_date")
1266.                 .values("hire_date")[:1],
1267.             ),
1268.         ).order_by("department", "name")
1269.         self.assertQuerySetEqual(
1270.             qs,
1271.             [
1272.                 ("Adams", "Accounting", datetime.date(2005, 11, 1)),
1273.                 ("Jenson", "Accounting", datetime.date(2005, 11, 1)),
1274.                 ("Jones", "Accounting", datetime.date(2005, 11, 1)),
1275.                 ("Williams", "Accounting", datetime.date(2005, 11, 1)),
1276.                 ("Moore", "IT", datetime.date(2011, 3, 1)),
1277.                 ("Wilkinson", "IT", datetime.date(2011, 3, 1)),
1278.                 ("Johnson", "Management", datetime.date(2005, 6, 1)),
1279.                 ("Miller", "Management", datetime.date(2005, 6, 1)),
1280.                 ("Johnson", "Marketing", datetime.date(2009, 10, 1)),
1281.                 ("Smith", "Marketing", datetime.date(2009, 10, 1)),
1282.                 ("Brown", "Sales", datetime.date(2007, 6, 1)),
1283.                 ("Smith", "Sales", datetime.date(2007, 6, 1)),
1284.             ],
1285.             transform=lambda row: (
1286.                 row.name,
1287.                 row.department,
1288.                 row.highest_avg_salary_date,
1289.             ),
1290.         )
1291. 
1292.     def test_row_range_rank(self):
1293.         """
1294.         A query with ROWS BETWEEN UNBOUNDED PRECEDING AND 3 FOLLOWING.
1295.         The resulting sum is the sum of the three next (if they exist) and all
1296.         previous rows according to the ordering clause.
1297.         """
1298.         qs = Employee.objects.annotate(
1299.             sum=Window(
1300.                 expression=Sum("salary"),
1301.                 order_by=[F("hire_date").asc(), F("name").desc()],
1302.                 frame=RowRange(start=None, end=3),
1303.             )
1304.         ).order_by("sum", "hire_date")
1305.         self.assertIn("ROWS BETWEEN UNBOUNDED PRECEDING AND 3 FOLLOWING", str(qs.query))
1306.         self.assertQuerySetEqual(
1307.             qs,
1308.             [
1309.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 280000),
1310.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 325000),
1311.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 362000),
1312.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 415000),
1313.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 453000),
1314.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 513000),
1315.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 553000),
1316.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 603000),
1317.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 637000),
1318.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 637000),
1319.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 637000),
1320.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 637000),
1321.             ],
1322.             transform=lambda row: (
1323.                 row.name,
1324.                 row.salary,
1325.                 row.department,
1326.                 row.hire_date,
1327.                 row.sum,
1328.             ),
1329.         )
1330. 
1331.     @skipUnlessDBFeature("can_distinct_on_fields")
1332.     def test_distinct_window_function(self):
1333.         """
1334.         Window functions are not aggregates, and hence a query to filter out
1335.         duplicates may be useful.
1336.         """
1337.         qs = (
1338.             Employee.objects.annotate(
1339.                 sum=Window(
1340.                     expression=Sum("salary"),
1341.                     partition_by=ExtractYear("hire_date"),
1342.                     order_by=ExtractYear("hire_date"),
1343.                 ),
1344.                 year=ExtractYear("hire_date"),
1345.             )
1346.             .filter(sum__gte=45000)
1347.             .values("year", "sum")
1348.             .distinct("year")
1349.             .order_by("year")
1350.         )
1351.         results = [
1352.             {"year": 2005, "sum": 225000},
1353.             {"year": 2007, "sum": 55000},
1354.             {"year": 2008, "sum": 45000},
1355.             {"year": 2009, "sum": 128000},
1356.             {"year": 2011, "sum": 60000},
1357.             {"year": 2013, "sum": 84000},
1358.         ]
1359.         for idx, val in zip(range(len(results)), results):
1360.             with self.subTest(result=val):
1361.                 self.assertEqual(qs[idx], val)
1362. 
1363.     def test_fail_update(self):
1364.         """Window expressions can't be used in an UPDATE statement."""
1365.         msg = (
1366.             "Window expressions are not allowed in this query (salary=<Window: "
1367.             "Max(Col(expressions_window_employee, expressions_window.Employee.salary)) "
1368.             "OVER (PARTITION BY Col(expressions_window_employee, "
1369.             "expressions_window.Employee.department))>)."
1370.         )
1371.         with self.assertRaisesMessage(FieldError, msg):
1372.             Employee.objects.filter(department="Management").update(
1373.                 salary=Window(expression=Max("salary"), partition_by="department"),
1374.             )
1375. 
1376.     def test_fail_insert(self):
1377.         """Window expressions can't be used in an INSERT statement."""
1378.         msg = (
1379.             "Window expressions are not allowed in this query (salary=<Window: "
1380.             "Sum(Value(10000), order_by=OrderBy(F(pk), descending=False)) OVER ()"
1381.         )
1382.         with self.assertRaisesMessage(FieldError, msg):
1383.             Employee.objects.create(
1384.                 name="Jameson",
1385.                 department="Management",
1386.                 hire_date=datetime.date(2007, 7, 1),
1387.                 salary=Window(expression=Sum(Value(10000), order_by=F("pk").asc())),
1388.             )
1389. 
1390.     def test_window_expression_within_subquery(self):
1391.         subquery_qs = Employee.objects.annotate(
1392.             highest=Window(
1393.                 FirstValue("id"),
1394.                 partition_by=F("department"),
1395.                 order_by=F("salary").desc(),
1396.             )
1397.         ).values("highest")
1398.         highest_salary = Employee.objects.filter(pk__in=subquery_qs)
1399.         self.assertCountEqual(
1400.             highest_salary.values("department", "salary"),
1401.             [
1402.                 {"department": "Accounting", "salary": 50000},
1403.                 {"department": "Sales", "salary": 55000},
1404.                 {"department": "Marketing", "salary": 40000},
1405.                 {"department": "IT", "salary": 60000},
1406.                 {"department": "Management", "salary": 100000},
1407.             ],
1408.         )
1409. 
1410.     @skipUnlessDBFeature("supports_json_field")
1411.     def test_key_transform(self):
1412.         Detail.objects.bulk_create(
1413.             [
1414.                 Detail(value={"department": "IT", "name": "Smith", "salary": 37000}),
1415.                 Detail(value={"department": "IT", "name": "Nowak", "salary": 32000}),
1416.                 Detail(value={"department": "HR", "name": "Brown", "salary": 50000}),
1417.                 Detail(value={"department": "HR", "name": "Smith", "salary": 55000}),
1418.                 Detail(value={"department": "PR", "name": "Moore", "salary": 90000}),
1419.             ]
1420.         )
1421.         tests = [
1422.             (KeyTransform("department", "value"), KeyTransform("name", "value")),
1423.             (F("value__department"), F("value__name")),
1424.         ]
1425.         for partition_by, order_by in tests:
1426.             with self.subTest(partition_by=partition_by, order_by=order_by):
1427.                 qs = Detail.objects.annotate(
1428.                     department_sum=Window(
1429.                         expression=Sum(
1430.                             Cast(
1431.                                 KeyTextTransform("salary", "value"),
1432.                                 output_field=IntegerField(),
1433.                             )
1434.                         ),
1435.                         partition_by=[partition_by],
1436.                         order_by=[order_by],
1437.                     )
1438.                 ).order_by("value__department", "department_sum")
1439.                 self.assertQuerySetEqual(
1440.                     qs,
1441.                     [
1442.                         ("Brown", "HR", 50000, 50000),
1443.                         ("Smith", "HR", 55000, 105000),
1444.                         ("Nowak", "IT", 32000, 32000),
1445.                         ("Smith", "IT", 37000, 69000),
1446.                         ("Moore", "PR", 90000, 90000),
1447.                     ],
1448.                     lambda entry: (
1449.                         entry.value["name"],
1450.                         entry.value["department"],
1451.                         entry.value["salary"],
1452.                         entry.department_sum,
1453.                     ),
1454.                 )
1455. 
1456.     def test_invalid_start_value_range(self):
1457.         msg = "start argument must be a negative integer, zero, or None, but got '3'."
1458.         with self.assertRaisesMessage(ValueError, msg):
1459.             list(
1460.                 Employee.objects.annotate(
1461.                     test=Window(
1462.                         expression=Sum("salary"),
1463.                         order_by=F("hire_date").asc(),
1464.                         frame=ValueRange(start=3),
1465.                     )
1466.                 )
1467.             )
1468. 
1469.     def test_invalid_end_value_range(self):
1470.         msg = "end argument must be a positive integer, zero, or None, but got '-3'."
1471.         with self.assertRaisesMessage(ValueError, msg):
1472.             list(
1473.                 Employee.objects.annotate(
1474.                     test=Window(
1475.                         expression=Sum("salary"),
1476.                         order_by=F("hire_date").asc(),
1477.                         frame=ValueRange(end=-3),
1478.                     )
1479.                 )
1480.             )
1481. 
1482.     def test_invalid_type_end_value_range(self):
1483.         msg = "end argument must be a positive integer, zero, or None, but got 'a'."
1484.         with self.assertRaisesMessage(ValueError, msg):
1485.             list(
1486.                 Employee.objects.annotate(
1487.                     test=Window(
1488.                         expression=Sum("salary"),
1489.                         order_by=F("hire_date").asc(),
1490.                         frame=ValueRange(end="a"),
1491.                     )
1492.                 )
1493.             )
1494. 
1495.     def test_invalid_type_start_value_range(self):
1496.         msg = "start argument must be a negative integer, zero, or None, but got 'a'."
1497.         with self.assertRaisesMessage(ValueError, msg):
1498.             list(
1499.                 Employee.objects.annotate(
1500.                     test=Window(
1501.                         expression=Sum("salary"),
1502.                         frame=ValueRange(start="a"),
1503.                     )
1504.                 )
1505.             )
1506. 
1507.     def test_invalid_type_end_row_range(self):
1508.         msg = "end argument must be a positive integer, zero, or None, but got 'a'."
1509.         with self.assertRaisesMessage(ValueError, msg):
1510.             list(
1511.                 Employee.objects.annotate(
1512.                     test=Window(
1513.                         expression=Sum("salary"),
1514.                         frame=RowRange(end="a"),
1515.                     )
1516.                 )
1517.             )
1518. 
1519.     @skipUnlessDBFeature("only_supports_unbounded_with_preceding_and_following")
1520.     def test_unsupported_range_frame_start(self):
1521.         msg = (
1522.             "%s only supports UNBOUNDED together with PRECEDING and FOLLOWING."
1523.             % connection.display_name
1524.         )
1525.         with self.assertRaisesMessage(NotSupportedError, msg):
1526.             list(
1527.                 Employee.objects.annotate(
1528.                     test=Window(
1529.                         expression=Sum("salary"),
1530.                         order_by=F("hire_date").asc(),
1531.                         frame=ValueRange(start=-1),
1532.                     )
1533.                 )
1534.             )
1535. 
1536.     @skipUnlessDBFeature("only_supports_unbounded_with_preceding_and_following")
1537.     def test_unsupported_range_frame_end(self):
1538.         msg = (
1539.             "%s only supports UNBOUNDED together with PRECEDING and FOLLOWING."
1540.             % connection.display_name
1541.         )
1542.         with self.assertRaisesMessage(NotSupportedError, msg):
1543.             list(
1544.                 Employee.objects.annotate(
1545.                     test=Window(
1546.                         expression=Sum("salary"),
1547.                         order_by=F("hire_date").asc(),
1548.                         frame=ValueRange(end=1),
1549.                     )
1550.                 )
1551.             )
1552. 
1553.     def test_invalid_type_start_row_range(self):
1554.         msg = "start argument must be a negative integer, zero, or None, but got 'a'."
1555.         with self.assertRaisesMessage(ValueError, msg):
1556.             list(
1557.                 Employee.objects.annotate(
1558.                     test=Window(
1559.                         expression=Sum("salary"),
1560.                         order_by=F("hire_date").asc(),
1561.                         frame=RowRange(start="a"),
1562.                     )
1563.                 )
1564.             )
1565. 
1566.     def test_invalid_filter(self):
1567.         msg = (
1568.             "Heterogeneous disjunctive predicates against window functions are not "
1569.             "implemented when performing conditional aggregation."
1570.         )
1571.         qs = Employee.objects.annotate(
1572.             window=Window(Rank()),
1573.             past_dept_cnt=Count("past_departments"),
1574.         )
1575.         with self.assertRaisesMessage(NotImplementedError, msg):
1576.             list(qs.filter(Q(window=1) | Q(department="Accounting")))
1577.         with self.assertRaisesMessage(NotImplementedError, msg):
1578.             list(qs.exclude(window=1, department="Accounting"))
1579. 
1580. 
1581. class WindowUnsupportedTests(TestCase):
1582.     def test_unsupported_backend(self):
1583.         msg = "This backend does not support window expressions."
1584.         with mock.patch.object(connection.features, "supports_over_clause", False):
1585.             with self.assertRaisesMessage(NotSupportedError, msg):
1586.                 Employee.objects.annotate(
1587.                     dense_rank=Window(expression=DenseRank())
1588.                 ).get()
1589. 
1590.     def test_filter_subquery(self):
1591.         qs = Employee.objects.annotate(
1592.             department_salary_rank=Window(
1593.                 Rank(), partition_by="department", order_by="-salary"
1594.             )
1595.         )
1596.         msg = (
1597.             "Referencing outer query window expression is not supported: "
1598.             "department_salary_rank."
1599.         )
1600.         with self.assertRaisesMessage(NotSupportedError, msg):
1601.             qs.annotate(
1602.                 employee_name=Subquery(
1603.                     Employee.objects.filter(
1604.                         age=OuterRef("department_salary_rank")
1605.                     ).values("name")[:1]
1606.                 )
1607.             )
1608. 
1609. 
1610. class NonQueryWindowTests(SimpleTestCase):
1611.     def test_window_repr(self):
1612.         self.assertEqual(
1613.             repr(Window(expression=Sum("salary"), partition_by="department")),
1614.             "<Window: Sum(F(salary)) OVER (PARTITION BY F(department))>",
1615.         )
1616.         self.assertEqual(
1617.             repr(Window(expression=Avg("salary"), order_by=F("department").asc())),
1618.             "<Window: Avg(F(salary)) OVER (OrderByList(OrderBy(F(department), "
1619.             "descending=False)))>",
1620.         )
1621. 
1622.     def test_window_frame_repr(self):
1623.         self.assertEqual(
1624.             repr(RowRange(start=-1)),
1625.             "<RowRange: ROWS BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING>",
1626.         )
1627.         self.assertEqual(
1628.             repr(ValueRange(start=None, end=1)),
1629.             "<ValueRange: RANGE BETWEEN UNBOUNDED PRECEDING AND 1 FOLLOWING>",
1630.         )
1631.         self.assertEqual(
1632.             repr(ValueRange(start=0, end=0)),
1633.             "<ValueRange: RANGE BETWEEN CURRENT ROW AND CURRENT ROW>",
1634.         )
1635.         self.assertEqual(
1636.             repr(RowRange(start=0, end=0)),
1637.             "<RowRange: ROWS BETWEEN CURRENT ROW AND CURRENT ROW>",
1638.         )
1639. 
1640.     def test_empty_group_by_cols(self):
1641.         window = Window(expression=Sum("pk"))
1642.         self.assertEqual(window.get_group_by_cols(), [])
1643.         self.assertFalse(window.contains_aggregate)
1644. 
1645.     def test_frame_empty_group_by_cols(self):
1646.         frame = WindowFrame()
1647.         self.assertEqual(frame.get_group_by_cols(), [])
1648. 
1649.     def test_frame_window_frame_notimplemented(self):
1650.         frame = WindowFrame()
1651.         msg = "Subclasses must implement window_frame_start_end()."
1652.         with self.assertRaisesMessage(NotImplementedError, msg):
1653.             frame.window_frame_start_end(None, None, None)
1654. 
1655.     def test_invalid_order_by(self):
1656.         msg = (
1657.             "Window.order_by must be either a string reference to a field, an "
1658.             "expression, or a list or tuple of them."
1659.         )
1660.         with self.assertRaisesMessage(ValueError, msg):
1661.             Window(expression=Sum("power"), order_by={"-horse"})
1662. 
1663.     def test_invalid_source_expression(self):
1664.         msg = "Expression 'Upper' isn't compatible with OVER clauses."
1665.         with self.assertRaisesMessage(ValueError, msg):
1666.             Window(expression=Upper("name"))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 01:45:33,203 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases for aggregating over window functions. The previously provided context from `tests/expressions_window/tests.py` contains tests for window functions, but it lacks tests that perform aggregations on the results of these window function annotations. The core of the bug is the interaction between `annotate()` with a `Window` function and a subsequent `.aggregate()` call. To find relevant test cases, I need to examine tests that cover aggregation, especially aggregation over annotated fields. The file `tests/aggregation/tests.py` is the most logical place to find such tests.' query='Please provide the full content of tests/aggregation/tests.py.' extra_requirements='' purpose='This file is expected to contain the main aggregation tests, and I will search it for test cases that perform aggregation over annotated fields, which is the scenario described in the bug report.'
2025-12-23 01:45:33,204 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/aggregation/tests.py.
2025-12-23 01:45:33,204 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 01:45:33,205 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 01:45:33,205 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 01:45:33,205 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/aggregation/tests.py.
Purpose: This file is expected to contain the main aggregation tests, and I will search it for test cases that perform aggregation over annotated fields, which is the scenario described in the bug report.
2025-12-23 01:45:35,126 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of `tests/aggregation/tests.py`. This file likely contains the main aggregation tests, which I will examine for test cases related to aggregation over annotated fields, as mentioned in the bug report.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2110, 'candidates_token_count': 67, 'total_token_count': 2290, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2110}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 67}], 'thoughts_token_count': 113, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10572666908378031, 'model_name': 'gemini-2.5-pro'} id='run--56f733e7-3ecb-4269-9653-58aaeb3265af-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/aggregation/tests.py'}, 'id': 'b8280989-2bcb-49d9-838c-4f906d31e3e2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2110, 'output_tokens': 67, 'total_tokens': 2290, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 113}}
2025-12-23 01:45:39,785 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the entirety of `tests/aggregation/tests.py`, which contains numerous aggregation-related test cases. My next step is to pinpoint the specific tests that demonstrate aggregation over annotated fields. I will now search for test cases within this file that use both `annotate()` and `aggregate()` methods together, which should lead me to the relevant examples.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_basename', 'arguments': '{"basename": "tests.py", "text": "test_annotation_with_aggregation"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9430, 'candidates_token_count': 101, 'total_token_count': 9741, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9430}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 101}], 'thoughts_token_count': 210, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4101006158507696, 'model_name': 'gemini-2.5-pro'} id='run--26cd4422-b73c-4db6-93f3-043a3063956f-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'basename': 'tests.py', 'text': 'test_annotation_with_aggregation'}, 'id': 'd0c19099-5e00-452f-b0fe-02eeff026976', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9430, 'output_tokens': 101, 'total_tokens': 9741, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 210}}
2025-12-23 01:46:01,833 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="After failing to find the test case `test_annotation_with_aggregation` in my initial attempt, I will now try to locate it again, this time searching for a function definition. I'll also broaden my search to include any related tests that might be relevant to the bug report. This will help me gather the necessary context to understand how aggregation over annotated fields is being tested." additional_kwargs={'function_call': {'name': 'find_ast_node_with_type_in_file_with_basename', 'arguments': '{"basename": "tests.py", "type": "function_definition"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9561, 'candidates_token_count': 103, 'total_token_count': 11900, 'cached_content_token_count': 9129, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9561}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9129}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 103}], 'thoughts_token_count': 2236}, 'finish_reason': 'STOP', 'avg_logprobs': -1.945548789015094, 'model_name': 'gemini-2.5-pro'} id='run--e3c11814-c6f8-46fb-add0-58d17bbbc372-0' tool_calls=[{'name': 'find_ast_node_with_type_in_file_with_basename', 'args': {'basename': 'tests.py', 'type': 'function_definition'}, 'id': '9b51774e-0bd2-452f-898f-663882ed9c3b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9561, 'output_tokens': 103, 'total_tokens': 11900, 'input_token_details': {'cache_read': 9129}, 'output_token_details': {'reasoning': 2236}}
2025-12-23 01:46:05,097 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have so far been unsuccessful in finding the specific test case `test_annotation_with_aggregation` and my subsequent broader search for function definitions yielded results from irrelevant files. To correct this, I will now specifically target `tests/aggregation/tests.py` and list all of its function definitions. This will allow me to identify all the test functions within that file and narrow down my search to the ones relevant to aggregation over annotated fields.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_type_in_file_with_relative_path', 'arguments': '{"type": "function_definition", "relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10201, 'candidates_token_count': 122, 'total_token_count': 10413, 'cached_content_token_count': 9092, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10201}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9092}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 122}], 'thoughts_token_count': 90}, 'finish_reason': 'STOP', 'avg_logprobs': -0.21206527459816854, 'model_name': 'gemini-2.5-pro'} id='run--f48bf746-aeec-444b-9616-47d1d0297b13-0' tool_calls=[{'name': 'find_ast_node_with_type_in_file_with_relative_path', 'args': {'type': 'function_definition', 'relative_path': 'tests/aggregation/tests.py'}, 'id': '36667a56-fc1a-4a67-b252-f61ed77fc77c', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10201, 'output_tokens': 122, 'total_tokens': 10413, 'input_token_details': {'cache_read': 9092}, 'output_token_details': {'reasoning': 90}}
2025-12-23 01:46:07,332 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have been unable to find the specific test case I was looking for, and my attempts to list all function definitions in `tests/aggregation/tests.py` have also failed. It appears there might be an issue with how I'm querying the AST. To get a better understanding of the file's structure and contents, I will now read the entire file again, but this time I will focus on identifying the class that contains the aggregation tests. This will help me to manually inspect the test cases and find the one that is relevant to the bug report." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10355, 'candidates_token_count': 135, 'total_token_count': 10490, 'cached_content_token_count': 9079, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10355}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9079}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 135}], 'thoughts_token_count': 0}, 'finish_reason': 'STOP', 'avg_logprobs': -0.15037741484465422, 'model_name': 'gemini-2.5-pro'} id='run--834e0167-3810-4d83-9af8-7491f346acde-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/aggregation/tests.py'}, 'id': '2e09ca20-4161-4c5e-bf0d-ee0b17a7a6d5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10355, 'output_tokens': 135, 'total_tokens': 10490, 'input_token_details': {'cache_read': 9079}}
2025-12-23 01:46:22,434 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After my previous attempts to locate the `test_annotation_with_aggregation` test case were unsuccessful, I manually re-examined the contents of `tests/aggregation/tests.py`. I discovered a test case named `test_annotation_and_aggregation`, which seems to be the one I was looking for. To confirm this, I will now read the code of this specific test case to verify that it does indeed perform aggregation over an annotated field.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 704.0, "end_line": 719.0, "relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 17743, 'candidates_token_count': 119, 'total_token_count': 19316, 'cached_content_token_count': 9387, 'prompt_tokens_details': [{'modality': 1, 'token_count': 17743}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9387}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 119}], 'thoughts_token_count': 1454}, 'finish_reason': 'STOP', 'avg_logprobs': -1.2638515183905594, 'model_name': 'gemini-2.5-pro'} id='run--5f95257b-e424-401e-acbb-8dd4a8b4ca99-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 704.0, 'end_line': 719.0, 'relative_path': 'tests/aggregation/tests.py'}, 'id': '98ab4929-3d39-4eb9-ad33-00c33fe1dd44', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17743, 'output_tokens': 119, 'total_tokens': 19316, 'input_token_details': {'cache_read': 9387}, 'output_token_details': {'reasoning': 1454}}
2025-12-23 01:46:27,378 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After a few unsuccessful attempts to find the correct test case, I have now located and read the code for `test_annotation_and_aggregation` in `tests/aggregation/tests.py`. This test case is highly relevant as it demonstrates the use of `annotate()` to add a `num_books` field and then filters on this annotated field. While this is a good starting point, I will now broaden my search to find a test case that performs aggregation over an annotated field, which is the specific scenario described in the bug report.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "annotate().aggregate()", "relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18153, 'candidates_token_count': 144, 'total_token_count': 18438, 'cached_content_token_count': 16876, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18153}], 'cache_tokens_details': [{'modality': 1, 'token_count': 16876}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 144}], 'thoughts_token_count': 141}, 'finish_reason': 'STOP', 'avg_logprobs': -0.22234797477722168, 'model_name': 'gemini-2.5-pro'} id='run--95ae4b5d-c736-4679-8ea0-4f9938f46fa2-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'annotate().aggregate()', 'relative_path': 'tests/aggregation/tests.py'}, 'id': '7d898dbc-a958-421d-be0d-ed33558a0804', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18153, 'output_tokens': 144, 'total_tokens': 18438, 'input_token_details': {'cache_read': 16876}, 'output_token_details': {'reasoning': 141}}
2025-12-23 01:46:31,354 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='My previous search for `annotate().aggregate()` was too specific. I will now search for a more likely test case name, `test_aggregate_over_annotation`, within `tests/aggregation/tests.py`. This should help me find the test case that demonstrates aggregation over an annotated field, which is the scenario described in the bug report.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "test_aggregate_over_annotation", "relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18329, 'candidates_token_count': 107, 'total_token_count': 18585, 'cached_content_token_count': 16860, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18329}], 'cache_tokens_details': [{'modality': 1, 'token_count': 16860}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 107}], 'thoughts_token_count': 149}, 'finish_reason': 'STOP', 'avg_logprobs': -0.36428900745427495, 'model_name': 'gemini-2.5-pro'} id='run--9ced7bc1-782c-4ca3-aef5-e12f6230413b-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'test_aggregate_over_annotation', 'relative_path': 'tests/aggregation/tests.py'}, 'id': '05c98807-ea62-4b6d-8e7a-4fe9d86729e7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18329, 'output_tokens': 107, 'total_tokens': 18585, 'input_token_details': {'cache_read': 16860}, 'output_token_details': {'reasoning': 149}}
2025-12-23 01:46:35,259 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='My previous attempts to find a specific test case have been unsuccessful. I will now try a broader approach by searching for any test that uses both `annotate` and `aggregate` in `tests/aggregation/tests.py`. This will help me identify the relevant test case that demonstrates aggregation over an annotated field, as described in the bug report.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "annotate", "relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18468, 'candidates_token_count': 100, 'total_token_count': 18767, 'cached_content_token_count': 16842, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18468}], 'cache_tokens_details': [{'modality': 1, 'token_count': 16842}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 100}], 'thoughts_token_count': 199}, 'finish_reason': 'STOP', 'avg_logprobs': -0.32886615753173826, 'model_name': 'gemini-2.5-pro'} id='run--f6044646-aff5-4778-8dbb-0cff1aa2d227-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'annotate', 'relative_path': 'tests/aggregation/tests.py'}, 'id': 'e7f6566b-6d53-4101-81a8-187d3b0ab915', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18468, 'output_tokens': 100, 'total_tokens': 18767, 'input_token_details': {'cache_read': 16842}, 'output_token_details': {'reasoning': 199}}
2025-12-23 01:46:44,319 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After a series of unsuccessful attempts to locate the specific test case, I have finally identified the relevant sections within `tests/aggregation/tests.py`. I have now retrieved the complete content of the `AggregateTestCase` and `AggregateAnnotationPruningTests` classes, which contain the test cases for aggregation over annotated fields. This will allow me to analyze the tests and understand how aggregation is performed on annotated fields in the codebase.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 1.0, "end_line": 2210.0, "relative_path": "tests/aggregation/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 42381, 'candidates_token_count': 112, 'total_token_count': 43206, 'cached_content_token_count': 17145, 'prompt_tokens_details': [{'modality': 1, 'token_count': 42381}], 'cache_tokens_details': [{'modality': 1, 'token_count': 17145}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 112}], 'thoughts_token_count': 713}, 'finish_reason': 'STOP', 'avg_logprobs': -1.156750270298549, 'model_name': 'gemini-2.5-pro'} id='run--a3697e32-c5a1-495b-9097-3be0797568fd-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 1.0, 'end_line': 2210.0, 'relative_path': 'tests/aggregation/tests.py'}, 'id': '5a428763-252b-47c0-be66-38cd5890eb95', 'type': 'tool_call'}] usage_metadata={'input_tokens': 42381, 'output_tokens': 112, 'total_tokens': 43206, 'input_token_details': {'cache_read': 17145}, 'output_token_details': {'reasoning': 713}}
2025-12-23 01:46:58,063 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='After a few attempts to narrow down the specific test case, I have now retrieved the entire content of `tests/aggregation/tests.py`. This file contains the `AggregateTestCase` and `AggregateAnnotationPruningTests` classes, which are essential for understanding the aggregation logic. By examining the `setUpTestData` methods, I have also gained insight into the data used for testing, which will be crucial for analyzing the test cases related to aggregation over annotated fields.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 76507, 'candidates_token_count': 93, 'total_token_count': 77471, 'prompt_tokens_details': [{'modality': 1, 'token_count': 76507}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 93}], 'thoughts_token_count': 871, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.5167214998634913, 'model_name': 'gemini-2.5-pro'} id='run--7887170e-4ff9-4451-ab93-e42568c53793-0' usage_metadata={'input_tokens': 76507, 'output_tokens': 93, 'total_tokens': 77471, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 871}}
2025-12-23 01:46:58,066 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/aggregation/tests.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is expected to contain the main aggregation tests, and I will search it for test cases that perform aggregation over annotated fields, which is the scenario described in the bug report.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/aggregation/tests.py
Line number range: 1 - 2210
Content:
1. import datetime
2. import math
3. import re
4. from decimal import Decimal
5. 
6. from django.core.exceptions import FieldError
7. from django.db import connection
8. from django.db.models import (
9.     Avg,
10.     Case,
11.     Count,
12.     DateField,
13.     DateTimeField,
14.     DecimalField,
15.     DurationField,
16.     Exists,
17.     F,
18.     FloatField,
19.     IntegerField,
20.     Max,
21.     Min,
22.     OuterRef,
23.     Q,
24.     StdDev,
25.     Subquery,
26.     Sum,
27.     TimeField,
28.     Value,
29.     Variance,
30.     When,
31. )
32. from django.db.models.expressions import Func, RawSQL
33. from django.db.models.functions import (
34.     Cast,
35.     Coalesce,
36.     Greatest,
37.     Least,
38.     Lower,
39.     Mod,
40.     Now,
41.     Pi,
42.     TruncDate,
43.     TruncHour,
44. )
45. from django.test import TestCase
46. from django.test.testcases import skipUnlessDBFeature
47. from django.test.utils import Approximate, CaptureQueriesContext
48. from django.utils import timezone
49. 
50. from .models import Author, Book, Publisher, Store
51. 
52. 
53. class NowUTC(Now):
54.     template = "CURRENT_TIMESTAMP"
55.     output_field = DateTimeField()
56. 
57.     def as_sql(self, compiler, connection, **extra_context):
58.         if connection.features.test_now_utc_template:
59.             extra_context["template"] = connection.features.test_now_utc_template
60.         return super().as_sql(compiler, connection, **extra_context)
61. 
62. 
63. class AggregateTestCase(TestCase):
64.     @classmethod
65.     def setUpTestData(cls):
66.         cls.a1 = Author.objects.create(name="Adrian Holovaty", age=34)
67.         cls.a2 = Author.objects.create(name="Jacob Kaplan-Moss", age=35)
68.         cls.a3 = Author.objects.create(name="Brad Dayley", age=45)
69.         cls.a4 = Author.objects.create(name="James Bennett", age=29)
70.         cls.a5 = Author.objects.create(name="Jeffrey Forcier", age=37)
71.         cls.a6 = Author.objects.create(name="Paul Bissex", age=29)
72.         cls.a7 = Author.objects.create(name="Wesley J. Chun", age=25)
73.         cls.a8 = Author.objects.create(name="Peter Norvig", age=57)
74.         cls.a9 = Author.objects.create(name="Stuart Russell", age=46)
75.         cls.a1.friends.add(cls.a2, cls.a4)
76.         cls.a2.friends.add(cls.a1, cls.a7)
77.         cls.a4.friends.add(cls.a1)
78.         cls.a5.friends.add(cls.a6, cls.a7)
79.         cls.a6.friends.add(cls.a5, cls.a7)
80.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
81.         cls.a8.friends.add(cls.a9)
82.         cls.a9.friends.add(cls.a8)
83. 
84.         cls.p1 = Publisher.objects.create(
85.             name="Apress", num_awards=3, duration=datetime.timedelta(days=1)
86.         )
87.         cls.p2 = Publisher.objects.create(
88.             name="Sams", num_awards=1, duration=datetime.timedelta(days=2)
89.         )
90.         cls.p3 = Publisher.objects.create(name="Prentice Hall", num_awards=7)
91.         cls.p4 = Publisher.objects.create(name="Morgan Kaufmann", num_awards=9)
92.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
93. 
94.         cls.b1 = Book.objects.create(
95.             isbn="159059725",
96.             name="The Definitive Guide to Django: Web Development Done Right",
97.             pages=447,
98.             rating=4.5,
99.             price=Decimal("30.00"),
100.             contact=cls.a1,
101.             publisher=cls.p1,
102.             pubdate=datetime.date(2007, 12, 6),
103.         )
104.         cls.b2 = Book.objects.create(
105.             isbn="067232959",
106.             name="Sams Teach Yourself Django in 24 Hours",
107.             pages=528,
108.             rating=3.0,
109.             price=Decimal("23.09"),
110.             contact=cls.a3,
111.             publisher=cls.p2,
112.             pubdate=datetime.date(2008, 3, 3),
113.         )
114.         cls.b3 = Book.objects.create(
115.             isbn="159059996",
116.             name="Practical Django Projects",
117.             pages=300,
118.             rating=4.0,
119.             price=Decimal("29.69"),
120.             contact=cls.a4,
121.             publisher=cls.p1,
122.             pubdate=datetime.date(2008, 6, 23),
123.         )
124.         cls.b4 = Book.objects.create(
125.             isbn="013235613",
126.             name="Python Web Development with Django",
127.             pages=350,
128.             rating=4.0,
129.             price=Decimal("29.69"),
130.             contact=cls.a5,
131.             publisher=cls.p3,
132.             pubdate=datetime.date(2008, 11, 3),
133.         )
134.         cls.b5 = Book.objects.create(
135.             isbn="013790395",
136.             name="Artificial Intelligence: A Modern Approach",
137.             pages=1132,
138.             rating=4.0,
139.             price=Decimal("82.80"),
140.             contact=cls.a8,
141.             publisher=cls.p3,
142.             pubdate=datetime.date(1995, 1, 15),
143.         )
144.         cls.b6 = Book.objects.create(
145.             isbn="155860191",
146.             name=(
147.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
148.                 "Common Lisp"
149.             ),
150.             pages=946,
151.             rating=5.0,
152.             price=Decimal("75.00"),
153.             contact=cls.a8,
154.             publisher=cls.p4,
155.             pubdate=datetime.date(1991, 10, 15),
156.         )
157.         cls.b1.authors.add(cls.a1, cls.a2)
158.         cls.b2.authors.add(cls.a3)
159.         cls.b3.authors.add(cls.a4)
160.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
161.         cls.b5.authors.add(cls.a8, cls.a9)
162.         cls.b6.authors.add(cls.a8)
163. 
164.         s1 = Store.objects.create(
165.             name="Amazon.com",
166.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
167.             friday_night_closing=datetime.time(23, 59, 59),
168.         )
169.         s2 = Store.objects.create(
170.             name="Books.com",
171.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
172.             friday_night_closing=datetime.time(23, 59, 59),
173.         )
174.         s3 = Store.objects.create(
175.             name="Mamma and Pappa's Books",
176.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
177.             friday_night_closing=datetime.time(21, 30),
178.         )
179.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
180.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
181.         s3.books.add(cls.b3, cls.b4, cls.b6)
182. 
183.     def test_empty_aggregate(self):
184.         self.assertEqual(Author.objects.aggregate(), {})
185. 
186.     def test_aggregate_in_order_by(self):
187.         msg = (
188.             "Using an aggregate in order_by() without also including it in "
189.             "annotate() is not allowed: Avg(F(book__rating)"
190.         )
191.         with self.assertRaisesMessage(FieldError, msg):
192.             Author.objects.values("age").order_by(Avg("book__rating"))
193. 
194.     def test_single_aggregate(self):
195.         vals = Author.objects.aggregate(Avg("age"))
196.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
197. 
198.     def test_multiple_aggregates(self):
199.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
200.         self.assertEqual(
201.             vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)}
202.         )
203. 
204.     def test_filter_aggregate(self):
205.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
206.         self.assertEqual(vals, {"age__sum": 254})
207. 
208.     def test_related_aggregate(self):
209.         vals = Author.objects.aggregate(Avg("friends__age"))
210.         self.assertEqual(vals, {"friends__age__avg": Approximate(34.07, places=2)})
211. 
212.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
213.         self.assertEqual(vals, {"authors__age__avg": Approximate(38.2857, places=2)})
214. 
215.         vals = Author.objects.filter(name__contains="a").aggregate(Avg("book__rating"))
216.         self.assertEqual(vals, {"book__rating__avg": 4.0})
217. 
218.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
219.         self.assertEqual(vals, {"publisher__num_awards__sum": 30})
220. 
221.         vals = Publisher.objects.aggregate(Sum("book__price"))
222.         self.assertEqual(vals, {"book__price__sum": Decimal("270.27")})
223. 
224.     def test_aggregate_multi_join(self):
225.         vals = Store.objects.aggregate(Max("books__authors__age"))
226.         self.assertEqual(vals, {"books__authors__age__max": 57})
227. 
228.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
229.         self.assertEqual(vals, {"book__publisher__num_awards__min": 1})
230. 
231.     def test_aggregate_alias(self):
232.         vals = Store.objects.filter(name="Amazon.com").aggregate(
233.             amazon_mean=Avg("books__rating")
234.         )
235.         self.assertEqual(vals, {"amazon_mean": Approximate(4.08, places=2)})
236. 
237.     def test_aggregate_transform(self):
238.         vals = Store.objects.aggregate(min_month=Min("original_opening__month"))
239.         self.assertEqual(vals, {"min_month": 3})
240. 
241.     def test_aggregate_join_transform(self):
242.         vals = Publisher.objects.aggregate(min_year=Min("book__pubdate__year"))
243.         self.assertEqual(vals, {"min_year": 1991})
244. 
245.     def test_annotate_basic(self):
246.         self.assertQuerySetEqual(
247.             Book.objects.annotate().order_by("pk"),
248.             [
249.                 "The Definitive Guide to Django: Web Development Done Right",
250.                 "Sams Teach Yourself Django in 24 Hours",
251.                 "Practical Django Projects",
252.                 "Python Web Development with Django",
253.                 "Artificial Intelligence: A Modern Approach",
254.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
255.                 "Common Lisp",
256.             ],
257.             lambda b: b.name,
258.         )
259. 
260.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
261.         b = books.get(pk=self.b1.pk)
262.         self.assertEqual(
263.             b.name, "The Definitive Guide to Django: Web Development Done Right"
264.         )
265.         self.assertEqual(b.mean_age, 34.5)
266. 
267.     def test_annotate_defer(self):
268.         qs = (
269.             Book.objects.annotate(page_sum=Sum("pages"))
270.             .defer("name")
271.             .filter(pk=self.b1.pk)
272.         )
273. 
274.         rows = [
275.             (
276.                 self.b1.id,
277.                 "159059725",
278.                 447,
279.                 "The Definitive Guide to Django: Web Development Done Right",
280.             )
281.         ]
282.         self.assertQuerySetEqual(
283.             qs.order_by("pk"), rows, lambda r: (r.id, r.isbn, r.page_sum, r.name)
284.         )
285. 
286.     def test_annotate_defer_select_related(self):
287.         qs = (
288.             Book.objects.select_related("contact")
289.             .annotate(page_sum=Sum("pages"))
290.             .defer("name")
291.             .filter(pk=self.b1.pk)
292.         )
293. 
294.         rows = [
295.             (
296.                 self.b1.id,
297.                 "159059725",
298.                 447,
299.                 "Adrian Holovaty",
300.                 "The Definitive Guide to Django: Web Development Done Right",
301.             )
302.         ]
303.         self.assertQuerySetEqual(
304.             qs.order_by("pk"),
305.             rows,
306.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name),
307.         )
308. 
309.     def test_annotate_m2m(self):
310.         books = (
311.             Book.objects.filter(rating__lt=4.5)
312.             .annotate(Avg("authors__age"))
313.             .order_by("name")
314.         )
315.         self.assertQuerySetEqual(
316.             books,
317.             [
318.                 ("Artificial Intelligence: A Modern Approach", 51.5),
319.                 ("Practical Django Projects", 29.0),
320.                 ("Python Web Development with Django", Approximate(30.3, places=1)),
321.                 ("Sams Teach Yourself Django in 24 Hours", 45.0),
322.             ],
323.             lambda b: (b.name, b.authors__age__avg),
324.         )
325. 
326.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
327.         self.assertQuerySetEqual(
328.             books,
329.             [
330.                 ("Artificial Intelligence: A Modern Approach", 2),
331.                 (
332.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
333.                     "Common Lisp",
334.                     1,
335.                 ),
336.                 ("Practical Django Projects", 1),
337.                 ("Python Web Development with Django", 3),
338.                 ("Sams Teach Yourself Django in 24 Hours", 1),
339.                 ("The Definitive Guide to Django: Web Development Done Right", 2),
340.             ],
341.             lambda b: (b.name, b.num_authors),
342.         )
343. 
344.     def test_backwards_m2m_annotate(self):
345.         authors = (
346.             Author.objects.filter(name__contains="a")
347.             .annotate(Avg("book__rating"))
348.             .order_by("name")
349.         )
350.         self.assertQuerySetEqual(
351.             authors,
352.             [
353.                 ("Adrian Holovaty", 4.5),
354.                 ("Brad Dayley", 3.0),
355.                 ("Jacob Kaplan-Moss", 4.5),
356.                 ("James Bennett", 4.0),
357.                 ("Paul Bissex", 4.0),
358.                 ("Stuart Russell", 4.0),
359.             ],
360.             lambda a: (a.name, a.book__rating__avg),
361.         )
362. 
363.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
364.         self.assertQuerySetEqual(
365.             authors,
366.             [
367.                 ("Adrian Holovaty", 1),
368.                 ("Brad Dayley", 1),
369.                 ("Jacob Kaplan-Moss", 1),
370.                 ("James Bennett", 1),
371.                 ("Jeffrey Forcier", 1),
372.                 ("Paul Bissex", 1),
373.                 ("Peter Norvig", 2),
374.                 ("Stuart Russell", 1),
375.                 ("Wesley J. Chun", 1),
376.             ],
377.             lambda a: (a.name, a.num_books),
378.         )
379. 
380.     def test_reverse_fkey_annotate(self):
381.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
382.         self.assertQuerySetEqual(
383.             books,
384.             [
385.                 ("Artificial Intelligence: A Modern Approach", 7),
386.                 (
387.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
388.                     "Common Lisp",
389.                     9,
390.                 ),
391.                 ("Practical Django Projects", 3),
392.                 ("Python Web Development with Django", 7),
393.                 ("Sams Teach Yourself Django in 24 Hours", 1),
394.                 ("The Definitive Guide to Django: Web Development Done Right", 3),
395.             ],
396.             lambda b: (b.name, b.publisher__num_awards__sum),
397.         )
398. 
399.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
400.         self.assertQuerySetEqual(
401.             publishers,
402.             [
403.                 ("Apress", Decimal("59.69")),
404.                 ("Jonno's House of Books", None),
405.                 ("Morgan Kaufmann", Decimal("75.00")),
406.                 ("Prentice Hall", Decimal("112.49")),
407.                 ("Sams", Decimal("23.09")),
408.             ],
409.             lambda p: (p.name, p.book__price__sum),
410.         )
411. 
412.     def test_annotate_values(self):
413.         books = list(
414.             Book.objects.filter(pk=self.b1.pk)
415.             .annotate(mean_age=Avg("authors__age"))
416.             .values()
417.         )
418.         self.assertEqual(
419.             books,
420.             [
421.                 {
422.                     "contact_id": self.a1.id,
423.                     "id": self.b1.id,
424.                     "isbn": "159059725",
425.                     "mean_age": 34.5,
426.                     "name": (
427.                         "The Definitive Guide to Django: Web Development Done Right"
428.                     ),
429.                     "pages": 447,
430.                     "price": Approximate(Decimal("30")),
431.                     "pubdate": datetime.date(2007, 12, 6),
432.                     "publisher_id": self.p1.id,
433.                     "rating": 4.5,
434.                 }
435.             ],
436.         )
437. 
438.         books = (
439.             Book.objects.filter(pk=self.b1.pk)
440.             .annotate(mean_age=Avg("authors__age"))
441.             .values("pk", "isbn", "mean_age")
442.         )
443.         self.assertEqual(
444.             list(books),
445.             [
446.                 {
447.                     "pk": self.b1.pk,
448.                     "isbn": "159059725",
449.                     "mean_age": 34.5,
450.                 }
451.             ],
452.         )
453. 
454.         books = (
455.             Book.objects.filter(pk=self.b1.pk)
456.             .annotate(mean_age=Avg("authors__age"))
457.             .values("name")
458.         )
459.         self.assertEqual(
460.             list(books),
461.             [{"name": "The Definitive Guide to Django: Web Development Done Right"}],
462.         )
463. 
464.         books = (
465.             Book.objects.filter(pk=self.b1.pk)
466.             .values()
467.             .annotate(mean_age=Avg("authors__age"))
468.         )
469.         self.assertEqual(
470.             list(books),
471.             [
472.                 {
473.                     "contact_id": self.a1.id,
474.                     "id": self.b1.id,
475.                     "isbn": "159059725",
476.                     "mean_age": 34.5,
477.                     "name": (
478.                         "The Definitive Guide to Django: Web Development Done Right"
479.                     ),
480.                     "pages": 447,
481.                     "price": Approximate(Decimal("30")),
482.                     "pubdate": datetime.date(2007, 12, 6),
483.                     "publisher_id": self.p1.id,
484.                     "rating": 4.5,
485.                 }
486.             ],
487.         )
488. 
489.         books = (
490.             Book.objects.values("rating")
491.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
492.             .order_by("rating")
493.         )
494.         self.assertEqual(
495.             list(books),
496.             [
497.                 {
498.                     "rating": 3.0,
499.                     "n_authors": 1,
500.                     "mean_age": 45.0,
501.                 },
502.                 {
503.                     "rating": 4.0,
504.                     "n_authors": 6,
505.                     "mean_age": Approximate(37.16, places=1),
506.                 },
507.                 {
508.                     "rating": 4.5,
509.                     "n_authors": 2,
510.                     "mean_age": 34.5,
511.                 },
512.                 {
513.                     "rating": 5.0,
514.                     "n_authors": 1,
515.                     "mean_age": 57.0,
516.                 },
517.             ],
518.         )
519. 
520.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
521.         self.assertQuerySetEqual(
522.             authors,
523.             [
524.                 ("Adrian Holovaty", 32.0),
525.                 ("Brad Dayley", None),
526.                 ("Jacob Kaplan-Moss", 29.5),
527.                 ("James Bennett", 34.0),
528.                 ("Jeffrey Forcier", 27.0),
529.                 ("Paul Bissex", 31.0),
530.                 ("Peter Norvig", 46.0),
531.                 ("Stuart Russell", 57.0),
532.                 ("Wesley J. Chun", Approximate(33.66, places=1)),
533.             ],
534.             lambda a: (a.name, a.friends__age__avg),
535.         )
536. 
537.     def test_count(self):
538.         vals = Book.objects.aggregate(Count("rating"))
539.         self.assertEqual(vals, {"rating__count": 6})
540. 
541.     def test_count_star(self):
542.         with self.assertNumQueries(1) as ctx:
543.             Book.objects.aggregate(n=Count("*"))
544.         sql = ctx.captured_queries[0]["sql"]
545.         self.assertIn("SELECT COUNT(*) ", sql)
546. 
547.     def test_count_distinct_expression(self):
548.         aggs = Book.objects.aggregate(
549.             distinct_ratings=Count(
550.                 Case(When(pages__gt=300, then="rating")), distinct=True
551.             ),
552.         )
553.         self.assertEqual(aggs["distinct_ratings"], 4)
554. 
555.     def test_distinct_on_aggregate(self):
556.         for aggregate, expected_result in (
557.             (Avg, 4.125),
558.             (Count, 4),
559.             (Sum, 16.5),
560.         ):
561.             with self.subTest(aggregate=aggregate.__name__):
562.                 books = Book.objects.aggregate(
563.                     ratings=aggregate("rating", distinct=True)
564.                 )
565.                 self.assertEqual(books["ratings"], expected_result)
566. 
567.     def test_non_grouped_annotation_not_in_group_by(self):
568.         """
569.         An annotation not included in values() before an aggregate should be
570.         excluded from the group by clause.
571.         """
572.         qs = (
573.             Book.objects.annotate(xprice=F("price"))
574.             .filter(rating=4.0)
575.             .values("rating")
576.             .annotate(count=Count("publisher_id", distinct=True))
577.             .values("count", "rating")
578.             .order_by("count")
579.         )
580.         self.assertEqual(list(qs), [{"rating": 4.0, "count": 2}])
581. 
582.     def test_grouped_annotation_in_group_by(self):
583.         """
584.         An annotation included in values() before an aggregate should be
585.         included in the group by clause.
586.         """
587.         qs = (
588.             Book.objects.annotate(xprice=F("price"))
589.             .filter(rating=4.0)
590.             .values("rating", "xprice")
591.             .annotate(count=Count("publisher_id", distinct=True))
592.             .values("count", "rating")
593.             .order_by("count")
594.         )
595.         self.assertEqual(
596.             list(qs),
597.             [
598.                 {"rating": 4.0, "count": 1},
599.                 {"rating": 4.0, "count": 2},
600.             ],
601.         )
602. 
603.     def test_fkey_aggregate(self):
604.         explicit = list(Author.objects.annotate(Count("book__id")))
605.         implicit = list(Author.objects.annotate(Count("book")))
606.         self.assertCountEqual(explicit, implicit)
607. 
608.     def test_annotate_ordering(self):
609.         books = (
610.             Book.objects.values("rating")
611.             .annotate(oldest=Max("authors__age"))
612.             .order_by("oldest", "rating")
613.         )
614.         self.assertEqual(
615.             list(books),
616.             [
617.                 {"rating": 4.5, "oldest": 35},
618.                 {"rating": 3.0, "oldest": 45},
619.                 {"rating": 4.0, "oldest": 57},
620.                 {"rating": 5.0, "oldest": 57},
621.             ],
622.         )
623. 
624.         books = (
625.             Book.objects.values("rating")
626.             .annotate(oldest=Max("authors__age"))
627.             .order_by("-oldest", "-rating")
628.         )
629.         self.assertEqual(
630.             list(books),
631.             [
632.                 {"rating": 5.0, "oldest": 57},
633.                 {"rating": 4.0, "oldest": 57},
634.                 {"rating": 3.0, "oldest": 45},
635.                 {"rating": 4.5, "oldest": 35},
636.             ],
637.         )
638. 
639.     def test_aggregate_annotation(self):
640.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(
641.             Avg("num_authors")
642.         )
643.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
644. 
645.     def test_avg_duration_field(self):
646.         # Explicit `output_field`.
647.         self.assertEqual(
648.             Publisher.objects.aggregate(Avg("duration", output_field=DurationField())),
649.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
650.         )
651.         # Implicit `output_field`.
652.         self.assertEqual(
653.             Publisher.objects.aggregate(Avg("duration")),
654.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
655.         )
656. 
657.     def test_sum_duration_field(self):
658.         self.assertEqual(
659.             Publisher.objects.aggregate(Sum("duration", output_field=DurationField())),
660.             {"duration__sum": datetime.timedelta(days=3)},
661.         )
662. 
663.     def test_sum_distinct_aggregate(self):
664.         """
665.         Sum on a distinct() QuerySet should aggregate only the distinct items.
666.         """
667.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
668.         self.assertEqual(authors.count(), 3)
669. 
670.         distinct_authors = authors.distinct()
671.         self.assertEqual(distinct_authors.count(), 2)
672. 
673.         # Selected author ages are 57 and 46
674.         age_sum = distinct_authors.aggregate(Sum("age"))
675.         self.assertEqual(age_sum["age__sum"], 103)
676. 
677.     def test_filtering(self):
678.         p = Publisher.objects.create(name="Expensive Publisher", num_awards=0)
679.         Book.objects.create(
680.             name="ExpensiveBook1",
681.             pages=1,
682.             isbn="111",
683.             rating=3.5,
684.             price=Decimal("1000"),
685.             publisher=p,
686.             contact_id=self.a1.id,
687.             pubdate=datetime.date(2008, 12, 1),
688.         )
689.         Book.objects.create(
690.             name="ExpensiveBook2",
691.             pages=1,
692.             isbn="222",
693.             rating=4.0,
694.             price=Decimal("1000"),
695.             publisher=p,
696.             contact_id=self.a1.id,
697.             pubdate=datetime.date(2008, 12, 2),
698.         )
699.         Book.objects.create(
700.             name="ExpensiveBook3",
701.             pages=1,
702.             isbn="333",
703.             rating=4.5,
704.             price=Decimal("35"),
705.             publisher=p,
706.             contact_id=self.a1.id,
707.             pubdate=datetime.date(2008, 12, 3),
708.         )
709. 
710.         publishers = (
711.             Publisher.objects.annotate(num_books=Count("book__id"))
712.             .filter(num_books__gt=1)
713.             .order_by("pk")
714.         )
715.         self.assertQuerySetEqual(
716.             publishers,
717.             ["Apress", "Prentice Hall", "Expensive Publisher"],
718.             lambda p: p.name,
719.         )
720. 
721.         publishers = Publisher.objects.filter(book__price__lt=Decimal("40.0")).order_by(
722.             "pk"
723.         )
724.         self.assertQuerySetEqual(
725.             publishers,
726.             [
727.                 "Apress",
728.                 "Apress",
729.                 "Sams",
730.                 "Prentice Hall",
731.                 "Expensive Publisher",
732.             ],
733.             lambda p: p.name,
734.         )
735. 
736.         publishers = (
737.             Publisher.objects.annotate(num_books=Count("book__id"))
738.             .filter(num_books__gt=1, book__price__lt=Decimal("40.0"))
739.             .order_by("pk")
740.         )
741.         self.assertQuerySetEqual(
742.             publishers,
743.             ["Apress", "Prentice Hall", "Expensive Publisher"],
744.             lambda p: p.name,
745.         )
746. 
747.         publishers = (
748.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
749.             .annotate(num_books=Count("book__id"))
750.             .filter(num_books__gt=1)
751.             .order_by("pk")
752.         )
753.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
754. 
755.         publishers = (
756.             Publisher.objects.annotate(num_books=Count("book"))
757.             .filter(num_books__range=[1, 3])
758.             .order_by("pk")
759.         )
760.         self.assertQuerySetEqual(
761.             publishers,
762.             [
763.                 "Apress",
764.                 "Sams",
765.                 "Prentice Hall",
766.                 "Morgan Kaufmann",
767.                 "Expensive Publisher",
768.             ],
769.             lambda p: p.name,
770.         )
771. 
772.         publishers = (
773.             Publisher.objects.annotate(num_books=Count("book"))
774.             .filter(num_books__range=[1, 2])
775.             .order_by("pk")
776.         )
777.         self.assertQuerySetEqual(
778.             publishers,
779.             ["Apress", "Sams", "Prentice Hall", "Morgan Kaufmann"],
780.             lambda p: p.name,
781.         )
782. 
783.         publishers = (
784.             Publisher.objects.annotate(num_books=Count("book"))
785.             .filter(num_books__in=[1, 3])
786.             .order_by("pk")
787.         )
788.         self.assertQuerySetEqual(
789.             publishers,
790.             ["Sams", "Morgan Kaufmann", "Expensive Publisher"],
791.             lambda p: p.name,
792.         )
793. 
794.         publishers = Publisher.objects.annotate(num_books=Count("book")).filter(
795.             num_books__isnull=True
796.         )
797.         self.assertEqual(len(publishers), 0)
798. 
799.     def test_annotation(self):
800.         vals = Author.objects.filter(pk=self.a1.pk).aggregate(Count("friends__id"))
801.         self.assertEqual(vals, {"friends__id__count": 2})
802. 
803.         books = (
804.             Book.objects.annotate(num_authors=Count("authors__name"))
805.             .filter(num_authors__exact=2)
806.             .order_by("pk")
807.         )
808.         self.assertQuerySetEqual(
809.             books,
810.             [
811.                 "The Definitive Guide to Django: Web Development Done Right",
812.                 "Artificial Intelligence: A Modern Approach",
813.             ],
814.             lambda b: b.name,
815.         )
816. 
817.         authors = (
818.             Author.objects.annotate(num_friends=Count("friends__id", distinct=True))
819.             .filter(num_friends=0)
820.             .order_by("pk")
821.         )
822.         self.assertQuerySetEqual(authors, ["Brad Dayley"], lambda a: a.name)
823. 
824.         publishers = (
825.             Publisher.objects.annotate(num_books=Count("book__id"))
826.             .filter(num_books__gt=1)
827.             .order_by("pk")
828.         )
829.         self.assertQuerySetEqual(
830.             publishers, ["Apress", "Prentice Hall"], lambda p: p.name
831.         )
832. 
833.         publishers = (
834.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
835.             .annotate(num_books=Count("book__id"))
836.             .filter(num_books__gt=1)
837.         )
838.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
839. 
840.         books = Book.objects.annotate(num_authors=Count("authors__id")).filter(
841.             authors__name__contains="Norvig", num_authors__gt=1
842.         )
843.         self.assertQuerySetEqual(
844.             books, ["Artificial Intelligence: A Modern Approach"], lambda b: b.name
845.         )
846. 
847.     def test_more_aggregation(self):
848.         a = Author.objects.get(name__contains="Norvig")
849.         b = Book.objects.get(name__contains="Done Right")
850.         b.authors.add(a)
851.         b.save()
852. 
853.         vals = (
854.             Book.objects.annotate(num_authors=Count("authors__id"))
855.             .filter(authors__name__contains="Norvig", num_authors__gt=1)
856.             .aggregate(Avg("rating"))
857.         )
858.         self.assertEqual(vals, {"rating__avg": 4.25})
859. 
860.     def test_even_more_aggregate(self):
861.         publishers = (
862.             Publisher.objects.annotate(
863.                 earliest_book=Min("book__pubdate"),
864.             )
865.             .exclude(earliest_book=None)
866.             .order_by("earliest_book")
867.             .values(
868.                 "earliest_book",
869.                 "num_awards",
870.                 "id",
871.                 "name",
872.             )
873.         )
874.         self.assertEqual(
875.             list(publishers),
876.             [
877.                 {
878.                     "earliest_book": datetime.date(1991, 10, 15),
879.                     "num_awards": 9,
880.                     "id": self.p4.id,
881.                     "name": "Morgan Kaufmann",
882.                 },
883.                 {
884.                     "earliest_book": datetime.date(1995, 1, 15),
885.                     "num_awards": 7,
886.                     "id": self.p3.id,
887.                     "name": "Prentice Hall",
888.                 },
889.                 {
890.                     "earliest_book": datetime.date(2007, 12, 6),
891.                     "num_awards": 3,
892.                     "id": self.p1.id,
893.                     "name": "Apress",
894.                 },
895.                 {
896.                     "earliest_book": datetime.date(2008, 3, 3),
897.                     "num_awards": 1,
898.                     "id": self.p2.id,
899.                     "name": "Sams",
900.                 },
901.             ],
902.         )
903. 
904.         vals = Store.objects.aggregate(
905.             Max("friday_night_closing"), Min("original_opening")
906.         )
907.         self.assertEqual(
908.             vals,
909.             {
910.                 "friday_night_closing__max": datetime.time(23, 59, 59),
911.                 "original_opening__min": datetime.datetime(1945, 4, 25, 16, 24, 14),
912.             },
913.         )
914. 
915.     def test_annotate_values_list(self):
916.         books = (
917.             Book.objects.filter(pk=self.b1.pk)
918.             .annotate(mean_age=Avg("authors__age"))
919.             .values_list("pk", "isbn", "mean_age")
920.         )
921.         self.assertEqual(list(books), [(self.b1.id, "159059725", 34.5)])
922. 
923.         books = (
924.             Book.objects.filter(pk=self.b1.pk)
925.             .annotate(mean_age=Avg("authors__age"))
926.             .values_list("isbn")
927.         )
928.         self.assertEqual(list(books), [("159059725",)])
929. 
930.         books = (
931.             Book.objects.filter(pk=self.b1.pk)
932.             .annotate(mean_age=Avg("authors__age"))
933.             .values_list("mean_age")
934.         )
935.         self.assertEqual(list(books), [(34.5,)])
936. 
937.         books = (
938.             Book.objects.filter(pk=self.b1.pk)
939.             .annotate(mean_age=Avg("authors__age"))
940.             .values_list("mean_age", flat=True)
941.         )
942.         self.assertEqual(list(books), [34.5])
943. 
944.         books = (
945.             Book.objects.values_list("price")
946.             .annotate(count=Count("price"))
947.             .order_by("-count", "price")
948.         )
949.         self.assertEqual(
950.             list(books),
951.             [
952.                 (Decimal("29.69"), 2),
953.                 (Decimal("23.09"), 1),
954.                 (Decimal("30"), 1),
955.                 (Decimal("75"), 1),
956.                 (Decimal("82.8"), 1),
957.             ],
958.         )
959. 
960.     def test_dates_with_aggregation(self):
961.         """
962.         .dates() returns a distinct set of dates when applied to a
963.         QuerySet with aggregation.
964. 
965.         Refs #18056. Previously, .dates() would return distinct (date_kind,
966.         aggregation) sets, in this case (year, num_authors), so 2008 would be
967.         returned twice because there are books from 2008 with a different
968.         number of authors.
969.         """
970.         dates = Book.objects.annotate(num_authors=Count("authors")).dates(
971.             "pubdate", "year"
972.         )
973.         self.assertSequenceEqual(
974.             dates,
975.             [
976.                 datetime.date(1991, 1, 1),
977.                 datetime.date(1995, 1, 1),
978.                 datetime.date(2007, 1, 1),
979.                 datetime.date(2008, 1, 1),
980.             ],
981.         )
982. 
983.     def test_values_aggregation(self):
984.         # Refs #20782
985.         max_rating = Book.objects.values("rating").aggregate(max_rating=Max("rating"))
986.         self.assertEqual(max_rating["max_rating"], 5)
987.         max_books_per_rating = (
988.             Book.objects.values("rating")
989.             .annotate(books_per_rating=Count("id"))
990.             .aggregate(Max("books_per_rating"))
991.         )
992.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3})
993. 
994.     def test_ticket17424(self):
995.         """
996.         Doing exclude() on a foreign model after annotate() doesn't crash.
997.         """
998.         all_books = list(Book.objects.values_list("pk", flat=True).order_by("pk"))
999.         annotated_books = Book.objects.order_by("pk").annotate(one=Count("id"))
1000. 
1001.         # The value doesn't matter, we just need any negative
1002.         # constraint on a related model that's a noop.
1003.         excluded_books = annotated_books.exclude(publisher__name="__UNLIKELY_VALUE__")
1004. 
1005.         # Try to generate query tree
1006.         str(excluded_books.query)
1007. 
1008.         self.assertQuerySetEqual(excluded_books, all_books, lambda x: x.pk)
1009. 
1010.         # Check internal state
1011.         self.assertIsNone(annotated_books.query.alias_map["aggregation_book"].join_type)
1012.         self.assertIsNone(excluded_books.query.alias_map["aggregation_book"].join_type)
1013. 
1014.     def test_ticket12886(self):
1015.         """
1016.         Aggregation over sliced queryset works correctly.
1017.         """
1018.         qs = Book.objects.order_by("-rating")[0:3]
1019.         vals = qs.aggregate(average_top3_rating=Avg("rating"))["average_top3_rating"]
1020.         self.assertAlmostEqual(vals, 4.5, places=2)
1021. 
1022.     def test_ticket11881(self):
1023.         """
1024.         Subqueries do not needlessly contain ORDER BY, SELECT FOR UPDATE or
1025.         select_related() stuff.
1026.         """
1027.         qs = (
1028.             Book.objects.select_for_update()
1029.             .order_by("pk")
1030.             .select_related("publisher")
1031.             .annotate(max_pk=Max("pk"))
1032.         )
1033.         with CaptureQueriesContext(connection) as captured_queries:
1034.             qs.aggregate(avg_pk=Avg("max_pk"))
1035.             self.assertEqual(len(captured_queries), 1)
1036.             qstr = captured_queries[0]["sql"].lower()
1037.             self.assertNotIn("for update", qstr)
1038.             forced_ordering = connection.ops.force_no_ordering()
1039.             if forced_ordering:
1040.                 # If the backend needs to force an ordering we make sure it's
1041.                 # the only "ORDER BY" clause present in the query.
1042.                 self.assertEqual(
1043.                     re.findall(r"order by (\w+)", qstr),
1044.                     [", ".join(f[1][0] for f in forced_ordering).lower()],
1045.                 )
1046.             else:
1047.                 self.assertNotIn("order by", qstr)
1048.             self.assertEqual(qstr.count(" join "), 0)
1049. 
1050.     def test_decimal_max_digits_has_no_effect(self):
1051.         Book.objects.all().delete()
1052.         a1 = Author.objects.first()
1053.         p1 = Publisher.objects.first()
1054.         thedate = timezone.now()
1055.         for i in range(10):
1056.             Book.objects.create(
1057.                 isbn="abcde{}".format(i),
1058.                 name="none",
1059.                 pages=10,
1060.                 rating=4.0,
1061.                 price=9999.98,
1062.                 contact=a1,
1063.                 publisher=p1,
1064.                 pubdate=thedate,
1065.             )
1066. 
1067.         book = Book.objects.aggregate(price_sum=Sum("price"))
1068.         self.assertEqual(book["price_sum"], Decimal("99999.80"))
1069. 
1070.     def test_nonaggregate_aggregation_throws(self):
1071.         with self.assertRaisesMessage(TypeError, "fail is not an aggregate expression"):
1072.             Book.objects.aggregate(fail=F("price"))
1073. 
1074.     def test_nonfield_annotation(self):
1075.         book = Book.objects.annotate(val=Max(Value(2))).first()
1076.         self.assertEqual(book.val, 2)
1077.         book = Book.objects.annotate(
1078.             val=Max(Value(2), output_field=IntegerField())
1079.         ).first()
1080.         self.assertEqual(book.val, 2)
1081.         book = Book.objects.annotate(val=Max(2, output_field=IntegerField())).first()
1082.         self.assertEqual(book.val, 2)
1083. 
1084.     def test_annotation_expressions(self):
1085.         authors = Author.objects.annotate(
1086.             combined_ages=Sum(F("age") + F("friends__age"))
1087.         ).order_by("name")
1088.         authors2 = Author.objects.annotate(
1089.             combined_ages=Sum("age") + Sum("friends__age")
1090.         ).order_by("name")
1091.         for qs in (authors, authors2):
1092.             self.assertQuerySetEqual(
1093.                 qs,
1094.                 [
1095.                     ("Adrian Holovaty", 132),
1096.                     ("Brad Dayley", None),
1097.                     ("Jacob Kaplan-Moss", 129),
1098.                     ("James Bennett", 63),
1099.                     ("Jeffrey Forcier", 128),
1100.                     ("Paul Bissex", 120),
1101.                     ("Peter Norvig", 103),
1102.                     ("Stuart Russell", 103),
1103.                     ("Wesley J. Chun", 176),
1104.                 ],
1105.                 lambda a: (a.name, a.combined_ages),
1106.             )
1107. 
1108.     def test_aggregation_expressions(self):
1109.         a1 = Author.objects.aggregate(av_age=Sum("age") / Count("*"))
1110.         a2 = Author.objects.aggregate(av_age=Sum("age") / Count("age"))
1111.         a3 = Author.objects.aggregate(av_age=Avg("age"))
1112.         self.assertEqual(a1, {"av_age": 37})
1113.         self.assertEqual(a2, {"av_age": 37})
1114.         self.assertEqual(a3, {"av_age": Approximate(37.4, places=1)})
1115. 
1116.     def test_avg_decimal_field(self):
1117.         v = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price")))[
1118.             "avg_price"
1119.         ]
1120.         self.assertIsInstance(v, Decimal)
1121.         self.assertEqual(v, Approximate(Decimal("47.39"), places=2))
1122. 
1123.     def test_order_of_precedence(self):
1124.         p1 = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price") + 2) * 3)
1125.         self.assertEqual(p1, {"avg_price": Approximate(Decimal("148.18"), places=2)})
1126. 
1127.         p2 = Book.objects.filter(rating=4).aggregate(avg_price=Avg("price") + 2 * 3)
1128.         self.assertEqual(p2, {"avg_price": Approximate(Decimal("53.39"), places=2)})
1129. 
1130.     def test_combine_different_types(self):
1131.         msg = (
1132.             "Cannot infer type of '+' expression involving these types: FloatField, "
1133.             "DecimalField. You must set output_field."
1134.         )
1135.         qs = Book.objects.annotate(sums=Sum("rating") + Sum("pages") + Sum("price"))
1136.         with self.assertRaisesMessage(FieldError, msg):
1137.             qs.first()
1138.         with self.assertRaisesMessage(FieldError, msg):
1139.             qs.first()
1140. 
1141.         b1 = Book.objects.annotate(
1142.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=IntegerField())
1143.         ).get(pk=self.b4.pk)
1144.         self.assertEqual(b1.sums, 383)
1145. 
1146.         b2 = Book.objects.annotate(
1147.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=FloatField())
1148.         ).get(pk=self.b4.pk)
1149.         self.assertEqual(b2.sums, 383.69)
1150. 
1151.         b3 = Book.objects.annotate(
1152.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=DecimalField())
1153.         ).get(pk=self.b4.pk)
1154.         self.assertEqual(b3.sums, Approximate(Decimal("383.69"), places=2))
1155. 
1156.     def test_complex_aggregations_require_kwarg(self):
1157.         with self.assertRaisesMessage(
1158.             TypeError, "Complex annotations require an alias"
1159.         ):
1160.             Author.objects.annotate(Sum(F("age") + F("friends__age")))
1161.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1162.             Author.objects.aggregate(Sum("age") / Count("age"))
1163.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1164.             Author.objects.aggregate(Sum(1))
1165. 
1166.     def test_aggregate_over_complex_annotation(self):
1167.         qs = Author.objects.annotate(combined_ages=Sum(F("age") + F("friends__age")))
1168. 
1169.         age = qs.aggregate(max_combined_age=Max("combined_ages"))
1170.         self.assertEqual(age["max_combined_age"], 176)
1171. 
1172.         age = qs.aggregate(max_combined_age_doubled=Max("combined_ages") * 2)
1173.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1174. 
1175.         age = qs.aggregate(
1176.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages")
1177.         )
1178.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1179. 
1180.         age = qs.aggregate(
1181.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1182.             sum_combined_age=Sum("combined_ages"),
1183.         )
1184.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1185.         self.assertEqual(age["sum_combined_age"], 954)
1186. 
1187.         age = qs.aggregate(
1188.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1189.             sum_combined_age_doubled=Sum("combined_ages") + Sum("combined_ages"),
1190.         )
1191.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1192.         self.assertEqual(age["sum_combined_age_doubled"], 954 * 2)
1193. 
1194.     def test_values_annotation_with_expression(self):
1195.         # ensure the F() is promoted to the group by clause
1196.         qs = Author.objects.values("name").annotate(another_age=Sum("age") + F("age"))
1197.         a = qs.get(name="Adrian Holovaty")
1198.         self.assertEqual(a["another_age"], 68)
1199. 
1200.         qs = qs.annotate(friend_count=Count("friends"))
1201.         a = qs.get(name="Adrian Holovaty")
1202.         self.assertEqual(a["friend_count"], 2)
1203. 
1204.         qs = (
1205.             qs.annotate(combined_age=Sum("age") + F("friends__age"))
1206.             .filter(name="Adrian Holovaty")
1207.             .order_by("-combined_age")
1208.         )
1209.         self.assertEqual(
1210.             list(qs),
1211.             [
1212.                 {
1213.                     "name": "Adrian Holovaty",
1214.                     "another_age": 68,
1215.                     "friend_count": 1,
1216.                     "combined_age": 69,
1217.                 },
1218.                 {
1219.                     "name": "Adrian Holovaty",
1220.                     "another_age": 68,
1221.                     "friend_count": 1,
1222.                     "combined_age": 63,
1223.                 },
1224.             ],
1225.         )
1226. 
1227.         vals = qs.values("name", "combined_age")
1228.         self.assertEqual(
1229.             list(vals),
1230.             [
1231.                 {"name": "Adrian Holovaty", "combined_age": 69},
1232.                 {"name": "Adrian Holovaty", "combined_age": 63},
1233.             ],
1234.         )
1235. 
1236.     def test_annotate_values_aggregate(self):
1237.         alias_age = (
1238.             Author.objects.annotate(age_alias=F("age"))
1239.             .values(
1240.                 "age_alias",
1241.             )
1242.             .aggregate(sum_age=Sum("age_alias"))
1243.         )
1244. 
1245.         age = Author.objects.values("age").aggregate(sum_age=Sum("age"))
1246. 
1247.         self.assertEqual(alias_age["sum_age"], age["sum_age"])
1248. 
1249.     def test_annotate_over_annotate(self):
1250.         author = (
1251.             Author.objects.annotate(age_alias=F("age"))
1252.             .annotate(sum_age=Sum("age_alias"))
1253.             .get(name="Adrian Holovaty")
1254.         )
1255. 
1256.         other_author = Author.objects.annotate(sum_age=Sum("age")).get(
1257.             name="Adrian Holovaty"
1258.         )
1259. 
1260.         self.assertEqual(author.sum_age, other_author.sum_age)
1261. 
1262.     def test_aggregate_over_aggregate(self):
1263.         msg = "Cannot compute Avg('age_agg'): 'age_agg' is an aggregate"
1264.         with self.assertRaisesMessage(FieldError, msg):
1265.             Author.objects.aggregate(
1266.                 age_agg=Sum(F("age")),
1267.                 avg_age=Avg(F("age_agg")),
1268.             )
1269. 
1270.     def test_annotated_aggregate_over_annotated_aggregate(self):
1271.         with self.assertRaisesMessage(
1272.             FieldError, "Cannot compute Sum('id__max'): 'id__max' is an aggregate"
1273.         ):
1274.             Book.objects.annotate(Max("id")).annotate(Sum("id__max"))
1275. 
1276.         class MyMax(Max):
1277.             def as_sql(self, compiler, connection):
1278.                 self.set_source_expressions(self.get_source_expressions()[0:1])
1279.                 return super().as_sql(compiler, connection)
1280. 
1281.         with self.assertRaisesMessage(
1282.             FieldError, "Cannot compute Max('id__max'): 'id__max' is an aggregate"
1283.         ):
1284.             Book.objects.annotate(Max("id")).annotate(my_max=MyMax("id__max", "price"))
1285. 
1286.     def test_multi_arg_aggregate(self):
1287.         class MyMax(Max):
1288.             output_field = DecimalField()
1289. 
1290.             def as_sql(self, compiler, connection):
1291.                 copy = self.copy()
1292.                 copy.set_source_expressions(copy.get_source_expressions()[0:1])
1293.                 return super(MyMax, copy).as_sql(compiler, connection)
1294. 
1295.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1296.             Book.objects.aggregate(MyMax("pages", "price"))
1297. 
1298.         with self.assertRaisesMessage(
1299.             TypeError, "Complex annotations require an alias"
1300.         ):
1301.             Book.objects.annotate(MyMax("pages", "price"))
1302. 
1303.         Book.objects.aggregate(max_field=MyMax("pages", "price"))
1304. 
1305.     def test_add_implementation(self):
1306.         class MySum(Sum):
1307.             pass
1308. 
1309.         # test completely changing how the output is rendered
1310.         def lower_case_function_override(self, compiler, connection):
1311.             sql, params = compiler.compile(self.source_expressions[0])
1312.             substitutions = {
1313.                 "function": self.function.lower(),
1314.                 "expressions": sql,
1315.                 "distinct": "",
1316.             }
1317.             substitutions.update(self.extra)
1318.             return self.template % substitutions, params
1319. 
1320.         setattr(MySum, "as_" + connection.vendor, lower_case_function_override)
1321. 
1322.         qs = Book.objects.annotate(
1323.             sums=MySum(
1324.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1325.             )
1326.         )
1327.         self.assertEqual(str(qs.query).count("sum("), 1)
1328.         b1 = qs.get(pk=self.b4.pk)
1329.         self.assertEqual(b1.sums, 383)
1330. 
1331.         # test changing the dict and delegating
1332.         def lower_case_function_super(self, compiler, connection):
1333.             self.extra["function"] = self.function.lower()
1334.             return super(MySum, self).as_sql(compiler, connection)
1335. 
1336.         setattr(MySum, "as_" + connection.vendor, lower_case_function_super)
1337. 
1338.         qs = Book.objects.annotate(
1339.             sums=MySum(
1340.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1341.             )
1342.         )
1343.         self.assertEqual(str(qs.query).count("sum("), 1)
1344.         b1 = qs.get(pk=self.b4.pk)
1345.         self.assertEqual(b1.sums, 383)
1346. 
1347.         # test overriding all parts of the template
1348.         def be_evil(self, compiler, connection):
1349.             substitutions = {"function": "MAX", "expressions": "2", "distinct": ""}
1350.             substitutions.update(self.extra)
1351.             return self.template % substitutions, ()
1352. 
1353.         setattr(MySum, "as_" + connection.vendor, be_evil)
1354. 
1355.         qs = Book.objects.annotate(
1356.             sums=MySum(
1357.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1358.             )
1359.         )
1360.         self.assertEqual(str(qs.query).count("MAX("), 1)
1361.         b1 = qs.get(pk=self.b4.pk)
1362.         self.assertEqual(b1.sums, 2)
1363. 
1364.     def test_complex_values_aggregation(self):
1365.         max_rating = Book.objects.values("rating").aggregate(
1366.             double_max_rating=Max("rating") + Max("rating")
1367.         )
1368.         self.assertEqual(max_rating["double_max_rating"], 5 * 2)
1369. 
1370.         max_books_per_rating = (
1371.             Book.objects.values("rating")
1372.             .annotate(books_per_rating=Count("id") + 5)
1373.             .aggregate(Max("books_per_rating"))
1374.         )
1375.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3 + 5})
1376. 
1377.     def test_expression_on_aggregation(self):
1378.         qs = (
1379.             Publisher.objects.annotate(
1380.                 price_or_median=Greatest(
1381.                     Avg("book__rating", output_field=DecimalField()), Avg("book__price")
1382.                 )
1383.             )
1384.             .filter(price_or_median__gte=F("num_awards"))
1385.             .order_by("num_awards")
1386.         )
1387.         self.assertQuerySetEqual(qs, [1, 3, 7, 9], lambda v: v.num_awards)
1388. 
1389.         qs2 = (
1390.             Publisher.objects.annotate(
1391.                 rating_or_num_awards=Greatest(
1392.                     Avg("book__rating"), F("num_awards"), output_field=FloatField()
1393.                 )
1394.             )
1395.             .filter(rating_or_num_awards__gt=F("num_awards"))
1396.             .order_by("num_awards")
1397.         )
1398.         self.assertQuerySetEqual(qs2, [1, 3], lambda v: v.num_awards)
1399. 
1400.     def test_arguments_must_be_expressions(self):
1401.         msg = "QuerySet.aggregate() received non-expression(s): %s."
1402.         with self.assertRaisesMessage(TypeError, msg % FloatField()):
1403.             Book.objects.aggregate(FloatField())
1404.         with self.assertRaisesMessage(TypeError, msg % True):
1405.             Book.objects.aggregate(is_book=True)
1406.         with self.assertRaisesMessage(
1407.             TypeError, msg % ", ".join([str(FloatField()), "True"])
1408.         ):
1409.             Book.objects.aggregate(FloatField(), Avg("price"), is_book=True)
1410. 
1411.     def test_aggregation_subquery_annotation(self):
1412.         """Subquery annotations are excluded from the GROUP BY if they are
1413.         not explicitly grouped against."""
1414.         latest_book_pubdate_qs = (
1415.             Book.objects.filter(publisher=OuterRef("pk"))
1416.             .order_by("-pubdate")
1417.             .values("pubdate")[:1]
1418.         )
1419.         publisher_qs = Publisher.objects.annotate(
1420.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1421.         ).annotate(count=Count("book"))
1422.         with self.assertNumQueries(1) as ctx:
1423.             list(publisher_qs)
1424.         self.assertEqual(ctx[0]["sql"].count("SELECT"), 2)
1425.         # The GROUP BY should not be by alias either.
1426.         self.assertEqual(ctx[0]["sql"].lower().count("latest_book_pubdate"), 1)
1427. 
1428.     def test_aggregation_subquery_annotation_exists(self):
1429.         latest_book_pubdate_qs = (
1430.             Book.objects.filter(publisher=OuterRef("pk"))
1431.             .order_by("-pubdate")
1432.             .values("pubdate")[:1]
1433.         )
1434.         publisher_qs = Publisher.objects.annotate(
1435.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1436.             count=Count("book"),
1437.         )
1438.         self.assertTrue(publisher_qs.exists())
1439. 
1440.     def test_aggregation_filter_exists(self):
1441.         publishers_having_more_than_one_book_qs = (
1442.             Book.objects.values("publisher")
1443.             .annotate(cnt=Count("isbn"))
1444.             .filter(cnt__gt=1)
1445.         )
1446.         query = publishers_having_more_than_one_book_qs.query.exists()
1447.         _, _, group_by = query.get_compiler(connection=connection).pre_sql_setup()
1448.         self.assertEqual(len(group_by), 1)
1449. 
1450.     def test_aggregation_exists_annotation(self):
1451.         published_books = Book.objects.filter(publisher=OuterRef("pk"))
1452.         publisher_qs = Publisher.objects.annotate(
1453.             published_book=Exists(published_books),
1454.             count=Count("book"),
1455.         ).values_list("name", flat=True)
1456.         self.assertCountEqual(
1457.             list(publisher_qs),
1458.             [
1459.                 "Apress",
1460.                 "Morgan Kaufmann",
1461.                 "Jonno's House of Books",
1462.                 "Prentice Hall",
1463.                 "Sams",
1464.             ],
1465.         )
1466. 
1467.     def test_aggregation_subquery_annotation_values(self):
1468.         """
1469.         Subquery annotations and external aliases are excluded from the GROUP
1470.         BY if they are not selected.
1471.         """
1472.         books_qs = (
1473.             Book.objects.annotate(
1474.                 first_author_the_same_age=Subquery(
1475.                     Author.objects.filter(
1476.                         age=OuterRef("contact__friends__age"),
1477.                     )
1478.                     .order_by("age")
1479.                     .values("id")[:1],
1480.                 )
1481.             )
1482.             .filter(
1483.                 publisher=self.p1,
1484.                 first_author_the_same_age__isnull=False,
1485.             )
1486.             .annotate(
1487.                 min_age=Min("contact__friends__age"),
1488.             )
1489.             .values("name", "min_age")
1490.             .order_by("name")
1491.         )
1492.         self.assertEqual(
1493.             list(books_qs),
1494.             [
1495.                 {"name": "Practical Django Projects", "min_age": 34},
1496.                 {
1497.                     "name": (
1498.                         "The Definitive Guide to Django: Web Development Done Right"
1499.                     ),
1500.                     "min_age": 29,
1501.                 },
1502.             ],
1503.         )
1504. 
1505.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1506.     def test_aggregation_subquery_annotation_values_collision(self):
1507.         books_rating_qs = Book.objects.filter(
1508.             pk=OuterRef("book"),
1509.         ).values("rating")
1510.         publisher_qs = (
1511.             Publisher.objects.filter(
1512.                 book__contact__age__gt=20,
1513.             )
1514.             .annotate(
1515.                 rating=Subquery(books_rating_qs),
1516.             )
1517.             .values("rating")
1518.             .annotate(total_count=Count("*"))
1519.             .order_by("rating")
1520.         )
1521.         self.assertEqual(
1522.             list(publisher_qs),
1523.             [
1524.                 {"rating": 3.0, "total_count": 1},
1525.                 {"rating": 4.0, "total_count": 3},
1526.                 {"rating": 4.5, "total_count": 1},
1527.                 {"rating": 5.0, "total_count": 1},
1528.             ],
1529.         )
1530. 
1531.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1532.     def test_aggregation_subquery_annotation_multivalued(self):
1533.         """
1534.         Subquery annotations must be included in the GROUP BY if they use
1535.         potentially multivalued relations (contain the LOOKUP_SEP).
1536.         """
1537.         subquery_qs = Author.objects.filter(
1538.             pk=OuterRef("pk"),
1539.             book__name=OuterRef("book__name"),
1540.         ).values("pk")
1541.         author_qs = Author.objects.annotate(
1542.             subquery_id=Subquery(subquery_qs),
1543.         ).annotate(count=Count("book"))
1544.         self.assertEqual(author_qs.count(), Author.objects.count())
1545. 
1546.     def test_aggregation_order_by_not_selected_annotation_values(self):
1547.         result_asc = [
1548.             self.b4.pk,
1549.             self.b3.pk,
1550.             self.b1.pk,
1551.             self.b2.pk,
1552.             self.b5.pk,
1553.             self.b6.pk,
1554.         ]
1555.         result_desc = result_asc[::-1]
1556.         tests = [
1557.             ("min_related_age", result_asc),
1558.             ("-min_related_age", result_desc),
1559.             (F("min_related_age"), result_asc),
1560.             (F("min_related_age").asc(), result_asc),
1561.             (F("min_related_age").desc(), result_desc),
1562.         ]
1563.         for ordering, expected_result in tests:
1564.             with self.subTest(ordering=ordering):
1565.                 books_qs = (
1566.                     Book.objects.annotate(
1567.                         min_age=Min("authors__age"),
1568.                     )
1569.                     .annotate(
1570.                         min_related_age=Coalesce("min_age", "contact__age"),
1571.                     )
1572.                     .order_by(ordering)
1573.                     .values_list("pk", flat=True)
1574.                 )
1575.                 self.assertEqual(list(books_qs), expected_result)
1576. 
1577.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1578.     def test_group_by_subquery_annotation(self):
1579.         """
1580.         Subquery annotations are included in the GROUP BY if they are
1581.         grouped against.
1582.         """
1583.         long_books_count_qs = (
1584.             Book.objects.filter(
1585.                 publisher=OuterRef("pk"),
1586.                 pages__gt=400,
1587.             )
1588.             .values("publisher")
1589.             .annotate(count=Count("pk"))
1590.             .values("count")
1591.         )
1592.         groups = [
1593.             Subquery(long_books_count_qs),
1594.             long_books_count_qs,
1595.             long_books_count_qs.query,
1596.         ]
1597.         for group in groups:
1598.             with self.subTest(group=group.__class__.__name__):
1599.                 long_books_count_breakdown = Publisher.objects.values_list(
1600.                     group,
1601.                 ).annotate(total=Count("*"))
1602.                 self.assertEqual(dict(long_books_count_breakdown), {None: 1, 1: 4})
1603. 
1604.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1605.     def test_group_by_exists_annotation(self):
1606.         """
1607.         Exists annotations are included in the GROUP BY if they are
1608.         grouped against.
1609.         """
1610.         long_books_qs = Book.objects.filter(
1611.             publisher=OuterRef("pk"),
1612.             pages__gt=800,
1613.         )
1614.         has_long_books_breakdown = Publisher.objects.values_list(
1615.             Exists(long_books_qs),
1616.         ).annotate(total=Count("*"))
1617.         self.assertEqual(dict(has_long_books_breakdown), {True: 2, False: 3})
1618. 
1619.     def test_group_by_nested_expression_with_params(self):
1620.         books_qs = (
1621.             Book.objects.annotate(greatest_pages=Greatest("pages", Value(600)))
1622.             .values(
1623.                 "greatest_pages",
1624.             )
1625.             .annotate(
1626.                 min_pages=Min("pages"),
1627.                 least=Least("min_pages", "greatest_pages"),
1628.             )
1629.             .values_list("least", flat=True)
1630.         )
1631.         self.assertCountEqual(books_qs, [300, 946, 1132])
1632. 
1633.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1634.     def test_aggregation_subquery_annotation_related_field(self):
1635.         publisher = Publisher.objects.create(name=self.a9.name, num_awards=2)
1636.         book = Book.objects.create(
1637.             isbn="159059999",
1638.             name="Test book.",
1639.             pages=819,
1640.             rating=2.5,
1641.             price=Decimal("14.44"),
1642.             contact=self.a9,
1643.             publisher=publisher,
1644.             pubdate=datetime.date(2019, 12, 6),
1645.         )
1646.         book.authors.add(self.a5, self.a6, self.a7)
1647.         books_qs = (
1648.             Book.objects.annotate(
1649.                 contact_publisher=Subquery(
1650.                     Publisher.objects.filter(
1651.                         pk=OuterRef("publisher"),
1652.                         name=OuterRef("contact__name"),
1653.                     ).values("name")[:1],
1654.                 )
1655.             )
1656.             .filter(
1657.                 contact_publisher__isnull=False,
1658.             )
1659.             .annotate(count=Count("authors"))
1660.         )
1661.         with self.assertNumQueries(1) as ctx:
1662.             self.assertSequenceEqual(books_qs, [book])
1663.         if connection.features.allows_group_by_select_index:
1664.             self.assertEqual(ctx[0]["sql"].count("SELECT"), 3)
1665. 
1666.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1667.     def test_aggregation_nested_subquery_outerref(self):
1668.         publisher_with_same_name = Publisher.objects.filter(
1669.             id__in=Subquery(
1670.                 Publisher.objects.filter(
1671.                     name=OuterRef(OuterRef("publisher__name")),
1672.                 ).values("id"),
1673.             ),
1674.         ).values(publisher_count=Count("id"))[:1]
1675.         books_breakdown = Book.objects.annotate(
1676.             publisher_count=Subquery(publisher_with_same_name),
1677.             authors_count=Count("authors"),
1678.         ).values_list("publisher_count", flat=True)
1679.         self.assertSequenceEqual(books_breakdown, [1] * 6)
1680. 
1681.     def test_aggregation_exists_multivalued_outeref(self):
1682.         self.assertCountEqual(
1683.             Publisher.objects.annotate(
1684.                 books_exists=Exists(
1685.                     Book.objects.filter(publisher=OuterRef("book__publisher"))
1686.                 ),
1687.                 books_count=Count("book"),
1688.             ),
1689.             Publisher.objects.all(),
1690.         )
1691. 
1692.     def test_filter_in_subquery_or_aggregation(self):
1693.         """
1694.         Filtering against an aggregate requires the usage of the HAVING clause.
1695. 
1696.         If such a filter is unionized to a non-aggregate one the latter will
1697.         also need to be moved to the HAVING clause and have its grouping
1698.         columns used in the GROUP BY.
1699. 
1700.         When this is done with a subquery the specialized logic in charge of
1701.         using outer reference columns to group should be used instead of the
1702.         subquery itself as the latter might return multiple rows.
1703.         """
1704.         authors = Author.objects.annotate(
1705.             Count("book"),
1706.         ).filter(Q(book__count__gt=0) | Q(pk__in=Book.objects.values("authors")))
1707.         self.assertCountEqual(authors, Author.objects.all())
1708. 
1709.     def test_aggregation_random_ordering(self):
1710.         """Random() is not included in the GROUP BY when used for ordering."""
1711.         authors = Author.objects.annotate(contact_count=Count("book")).order_by("?")
1712.         self.assertQuerySetEqual(
1713.             authors,
1714.             [
1715.                 ("Adrian Holovaty", 1),
1716.                 ("Jacob Kaplan-Moss", 1),
1717.                 ("Brad Dayley", 1),
1718.                 ("James Bennett", 1),
1719.                 ("Jeffrey Forcier", 1),
1720.                 ("Paul Bissex", 1),
1721.                 ("Wesley J. Chun", 1),
1722.                 ("Stuart Russell", 1),
1723.                 ("Peter Norvig", 2),
1724.             ],
1725.             lambda a: (a.name, a.contact_count),
1726.             ordered=False,
1727.         )
1728. 
1729.     def test_empty_result_optimization(self):
1730.         with self.assertNumQueries(0):
1731.             self.assertEqual(
1732.                 Publisher.objects.none().aggregate(
1733.                     sum_awards=Sum("num_awards"),
1734.                     books_count=Count("book"),
1735.                 ),
1736.                 {
1737.                     "sum_awards": None,
1738.                     "books_count": 0,
1739.                 },
1740.             )
1741.         # Expression without empty_result_set_value forces queries to be
1742.         # executed even if they would return an empty result set.
1743.         raw_books_count = Func("book", function="COUNT")
1744.         raw_books_count.contains_aggregate = True
1745.         with self.assertNumQueries(1):
1746.             self.assertEqual(
1747.                 Publisher.objects.none().aggregate(
1748.                     sum_awards=Sum("num_awards"),
1749.                     books_count=raw_books_count,
1750.                 ),
1751.                 {
1752.                     "sum_awards": None,
1753.                     "books_count": 0,
1754.                 },
1755.             )
1756. 
1757.     def test_coalesced_empty_result_set(self):
1758.         with self.assertNumQueries(0):
1759.             self.assertEqual(
1760.                 Publisher.objects.none().aggregate(
1761.                     sum_awards=Coalesce(Sum("num_awards"), 0),
1762.                 )["sum_awards"],
1763.                 0,
1764.             )
1765.         # Multiple expressions.
1766.         with self.assertNumQueries(0):
1767.             self.assertEqual(
1768.                 Publisher.objects.none().aggregate(
1769.                     sum_awards=Coalesce(Sum("num_awards"), None, 0),
1770.                 )["sum_awards"],
1771.                 0,
1772.             )
1773.         # Nested coalesce.
1774.         with self.assertNumQueries(0):
1775.             self.assertEqual(
1776.                 Publisher.objects.none().aggregate(
1777.                     sum_awards=Coalesce(Coalesce(Sum("num_awards"), None), 0),
1778.                 )["sum_awards"],
1779.                 0,
1780.             )
1781.         # Expression coalesce.
1782.         with self.assertNumQueries(1):
1783.             self.assertIsInstance(
1784.                 Store.objects.none().aggregate(
1785.                     latest_opening=Coalesce(
1786.                         Max("original_opening"),
1787.                         RawSQL("CURRENT_TIMESTAMP", []),
1788.                     ),
1789.                 )["latest_opening"],
1790.                 datetime.datetime,
1791.             )
1792. 
1793.     def test_aggregation_default_unsupported_by_count(self):
1794.         msg = "Count does not allow default."
1795.         with self.assertRaisesMessage(TypeError, msg):
1796.             Count("age", default=0)
1797. 
1798.     def test_aggregation_default_unset(self):
1799.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1800.             with self.subTest(Aggregate):
1801.                 result = Author.objects.filter(age__gt=100).aggregate(
1802.                     value=Aggregate("age"),
1803.                 )
1804.                 self.assertIsNone(result["value"])
1805. 
1806.     def test_aggregation_default_zero(self):
1807.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1808.             with self.subTest(Aggregate):
1809.                 result = Author.objects.filter(age__gt=100).aggregate(
1810.                     value=Aggregate("age", default=0),
1811.                 )
1812.                 self.assertEqual(result["value"], 0)
1813. 
1814.     def test_aggregation_default_integer(self):
1815.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1816.             with self.subTest(Aggregate):
1817.                 result = Author.objects.filter(age__gt=100).aggregate(
1818.                     value=Aggregate("age", default=21),
1819.                 )
1820.                 self.assertEqual(result["value"], 21)
1821. 
1822.     def test_aggregation_default_expression(self):
1823.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1824.             with self.subTest(Aggregate):
1825.                 result = Author.objects.filter(age__gt=100).aggregate(
1826.                     value=Aggregate("age", default=Value(5) * Value(7)),
1827.                 )
1828.                 self.assertEqual(result["value"], 35)
1829. 
1830.     def test_aggregation_default_group_by(self):
1831.         qs = (
1832.             Publisher.objects.values("name")
1833.             .annotate(
1834.                 books=Count("book"),
1835.                 pages=Sum("book__pages", default=0),
1836.             )
1837.             .filter(books=0)
1838.         )
1839.         self.assertSequenceEqual(
1840.             qs,
1841.             [{"name": "Jonno's House of Books", "books": 0, "pages": 0}],
1842.         )
1843. 
1844.     def test_aggregation_default_compound_expression(self):
1845.         # Scale rating to a percentage; default to 50% if no books published.
1846.         formula = Avg("book__rating", default=2.5) * 20.0
1847.         queryset = Publisher.objects.annotate(rating=formula).order_by("name")
1848.         self.assertSequenceEqual(
1849.             queryset.values("name", "rating"),
1850.             [
1851.                 {"name": "Apress", "rating": 85.0},
1852.                 {"name": "Jonno's House of Books", "rating": 50.0},
1853.                 {"name": "Morgan Kaufmann", "rating": 100.0},
1854.                 {"name": "Prentice Hall", "rating": 80.0},
1855.                 {"name": "Sams", "rating": 60.0},
1856.             ],
1857.         )
1858. 
1859.     def test_aggregation_default_using_time_from_python(self):
1860.         expr = Min(
1861.             "store__friday_night_closing",
1862.             filter=~Q(store__name="Amazon.com"),
1863.             default=datetime.time(17),
1864.         )
1865.         if connection.vendor == "mysql":
1866.             # Workaround for #30224 for MySQL & MariaDB.
1867.             expr.default = Cast(expr.default, TimeField())
1868.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1869.         self.assertSequenceEqual(
1870.             queryset.values("isbn", "oldest_store_opening"),
1871.             [
1872.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1873.                 {
1874.                     "isbn": "013790395",
1875.                     "oldest_store_opening": datetime.time(23, 59, 59),
1876.                 },
1877.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(17)},
1878.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1879.                 {
1880.                     "isbn": "159059725",
1881.                     "oldest_store_opening": datetime.time(23, 59, 59),
1882.                 },
1883.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1884.             ],
1885.         )
1886. 
1887.     def test_aggregation_default_using_time_from_database(self):
1888.         now = timezone.now().astimezone(datetime.timezone.utc)
1889.         expr = Min(
1890.             "store__friday_night_closing",
1891.             filter=~Q(store__name="Amazon.com"),
1892.             default=TruncHour(NowUTC(), output_field=TimeField()),
1893.         )
1894.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1895.         self.assertSequenceEqual(
1896.             queryset.values("isbn", "oldest_store_opening"),
1897.             [
1898.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1899.                 {
1900.                     "isbn": "013790395",
1901.                     "oldest_store_opening": datetime.time(23, 59, 59),
1902.                 },
1903.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(now.hour)},
1904.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1905.                 {
1906.                     "isbn": "159059725",
1907.                     "oldest_store_opening": datetime.time(23, 59, 59),
1908.                 },
1909.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1910.             ],
1911.         )
1912. 
1913.     def test_aggregation_default_using_date_from_python(self):
1914.         expr = Min("book__pubdate", default=datetime.date(1970, 1, 1))
1915.         if connection.vendor == "mysql":
1916.             # Workaround for #30224 for MySQL & MariaDB.
1917.             expr.default = Cast(expr.default, DateField())
1918.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1919.         self.assertSequenceEqual(
1920.             queryset.values("name", "earliest_pubdate"),
1921.             [
1922.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1923.                 {
1924.                     "name": "Jonno's House of Books",
1925.                     "earliest_pubdate": datetime.date(1970, 1, 1),
1926.                 },
1927.                 {
1928.                     "name": "Morgan Kaufmann",
1929.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1930.                 },
1931.                 {
1932.                     "name": "Prentice Hall",
1933.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1934.                 },
1935.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1936.             ],
1937.         )
1938. 
1939.     def test_aggregation_default_using_date_from_database(self):
1940.         now = timezone.now().astimezone(datetime.timezone.utc)
1941.         expr = Min("book__pubdate", default=TruncDate(NowUTC()))
1942.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1943.         self.assertSequenceEqual(
1944.             queryset.values("name", "earliest_pubdate"),
1945.             [
1946.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1947.                 {"name": "Jonno's House of Books", "earliest_pubdate": now.date()},
1948.                 {
1949.                     "name": "Morgan Kaufmann",
1950.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1951.                 },
1952.                 {
1953.                     "name": "Prentice Hall",
1954.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1955.                 },
1956.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1957.             ],
1958.         )
1959. 
1960.     def test_aggregation_default_using_datetime_from_python(self):
1961.         expr = Min(
1962.             "store__original_opening",
1963.             filter=~Q(store__name="Amazon.com"),
1964.             default=datetime.datetime(1970, 1, 1),
1965.         )
1966.         if connection.vendor == "mysql":
1967.             # Workaround for #30224 for MySQL & MariaDB.
1968.             expr.default = Cast(expr.default, DateTimeField())
1969.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1970.         self.assertSequenceEqual(
1971.             queryset.values("isbn", "oldest_store_opening"),
1972.             [
1973.                 {
1974.                     "isbn": "013235613",
1975.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1976.                 },
1977.                 {
1978.                     "isbn": "013790395",
1979.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1980.                 },
1981.                 {
1982.                     "isbn": "067232959",
1983.                     "oldest_store_opening": datetime.datetime(1970, 1, 1),
1984.                 },
1985.                 {
1986.                     "isbn": "155860191",
1987.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1988.                 },
1989.                 {
1990.                     "isbn": "159059725",
1991.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1992.                 },
1993.                 {
1994.                     "isbn": "159059996",
1995.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1996.                 },
1997.             ],
1998.         )
1999. 
2000.     def test_aggregation_default_using_datetime_from_database(self):
2001.         now = timezone.now().astimezone(datetime.timezone.utc)
2002.         expr = Min(
2003.             "store__original_opening",
2004.             filter=~Q(store__name="Amazon.com"),
2005.             default=TruncHour(NowUTC(), output_field=DateTimeField()),
2006.         )
2007.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
2008.         self.assertSequenceEqual(
2009.             queryset.values("isbn", "oldest_store_opening"),
2010.             [
2011.                 {
2012.                     "isbn": "013235613",
2013.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2014.                 },
2015.                 {
2016.                     "isbn": "013790395",
2017.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2018.                 },
2019.                 {
2020.                     "isbn": "067232959",
2021.                     "oldest_store_opening": now.replace(
2022.                         minute=0, second=0, microsecond=0, tzinfo=None
2023.                     ),
2024.                 },
2025.                 {
2026.                     "isbn": "155860191",
2027.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2028.                 },
2029.                 {
2030.                     "isbn": "159059725",
2031.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2032.                 },
2033.                 {
2034.                     "isbn": "159059996",
2035.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2036.                 },
2037.             ],
2038.         )
2039. 
2040.     def test_aggregation_default_using_duration_from_python(self):
2041.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2042.             value=Sum("duration", default=datetime.timedelta(0)),
2043.         )
2044.         self.assertEqual(result["value"], datetime.timedelta(0))
2045. 
2046.     def test_aggregation_default_using_duration_from_database(self):
2047.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2048.             value=Sum("duration", default=Now() - Now()),
2049.         )
2050.         self.assertEqual(result["value"], datetime.timedelta(0))
2051. 
2052.     def test_aggregation_default_using_decimal_from_python(self):
2053.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2054.             value=Sum("price", default=Decimal("0.00")),
2055.         )
2056.         self.assertEqual(result["value"], Decimal("0.00"))
2057. 
2058.     def test_aggregation_default_using_decimal_from_database(self):
2059.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2060.             value=Sum("price", default=Pi()),
2061.         )
2062.         self.assertAlmostEqual(result["value"], Decimal.from_float(math.pi), places=6)
2063. 
2064.     def test_aggregation_default_passed_another_aggregate(self):
2065.         result = Book.objects.aggregate(
2066.             value=Sum("price", filter=Q(rating__lt=3.0), default=Avg("pages") / 10.0),
2067.         )
2068.         self.assertAlmostEqual(result["value"], Decimal("61.72"), places=2)
2069. 
2070.     def test_aggregation_default_after_annotation(self):
2071.         result = Publisher.objects.annotate(
2072.             double_num_awards=F("num_awards") * 2,
2073.         ).aggregate(value=Sum("double_num_awards", default=0))
2074.         self.assertEqual(result["value"], 40)
2075. 
2076.     def test_aggregation_default_not_in_aggregate(self):
2077.         result = Publisher.objects.annotate(
2078.             avg_rating=Avg("book__rating", default=2.5),
2079.         ).aggregate(Sum("num_awards"))
2080.         self.assertEqual(result["num_awards__sum"], 20)
2081. 
2082.     def test_exists_none_with_aggregate(self):
2083.         qs = Book.objects.annotate(
2084.             count=Count("id"),
2085.             exists=Exists(Author.objects.none()),
2086.         )
2087.         self.assertEqual(len(qs), 6)
2088. 
2089.     def test_alias_sql_injection(self):
2090.         crafted_alias = """injected_name" from "aggregation_author"; --"""
2091.         msg = (
2092.             "Column aliases cannot contain whitespace characters, quotation marks, "
2093.             "semicolons, or SQL comments."
2094.         )
2095.         with self.assertRaisesMessage(ValueError, msg):
2096.             Author.objects.aggregate(**{crafted_alias: Avg("age")})
2097. 
2098.     def test_exists_extra_where_with_aggregate(self):
2099.         qs = Book.objects.annotate(
2100.             count=Count("id"),
2101.             exists=Exists(Author.objects.extra(where=["1=0"])),
2102.         )
2103.         self.assertEqual(len(qs), 6)
2104. 
2105.     def test_multiple_aggregate_references(self):
2106.         aggregates = Author.objects.aggregate(
2107.             total_books=Count("book"),
2108.             coalesced_total_books=Coalesce("total_books", 0),
2109.         )
2110.         self.assertEqual(
2111.             aggregates,
2112.             {
2113.                 "total_books": 10,
2114.                 "coalesced_total_books": 10,
2115.             },
2116.         )
2117. 
2118. 
2119. class AggregateAnnotationPruningTests(TestCase):
2120.     @classmethod
2121.     def setUpTestData(cls):
2122.         cls.a1 = Author.objects.create(age=1)
2123.         cls.a2 = Author.objects.create(age=2)
2124.         cls.p1 = Publisher.objects.create(num_awards=1)
2125.         cls.p2 = Publisher.objects.create(num_awards=0)
2126.         cls.b1 = Book.objects.create(
2127.             name="b1",
2128.             publisher=cls.p1,
2129.             pages=100,
2130.             rating=4.5,
2131.             price=10,
2132.             contact=cls.a1,
2133.             pubdate=datetime.date.today(),
2134.         )
2135.         cls.b1.authors.add(cls.a1)
2136.         cls.b2 = Book.objects.create(
2137.             name="b2",
2138.             publisher=cls.p2,
2139.             pages=1000,
2140.             rating=3.2,
2141.             price=50,
2142.             contact=cls.a2,
2143.             pubdate=datetime.date.today(),
2144.         )
2145.         cls.b2.authors.add(cls.a1, cls.a2)
2146. 
2147.     def test_unused_aliased_aggregate_pruned(self):
2148.         with CaptureQueriesContext(connection) as ctx:
2149.             cnt = Book.objects.alias(
2150.                 authors_count=Count("authors"),
2151.             ).count()
2152.         self.assertEqual(cnt, 2)
2153.         sql = ctx.captured_queries[0]["sql"].lower()
2154.         self.assertEqual(sql.count("select"), 2, "Subquery wrapping required")
2155.         self.assertNotIn("authors_count", sql)
2156. 
2157.     def test_non_aggregate_annotation_pruned(self):
2158.         with CaptureQueriesContext(connection) as ctx:
2159.             Book.objects.annotate(
2160.                 name_lower=Lower("name"),
2161.             ).count()
2162.         sql = ctx.captured_queries[0]["sql"].lower()
2163.         self.assertEqual(sql.count("select"), 1, "No subquery wrapping required")
2164.         self.assertNotIn("name_lower", sql)
2165. 
2166.     def test_unreferenced_aggregate_annotation_pruned(self):
2167.         with CaptureQueriesContext(connection) as ctx:
2168.             cnt = Book.objects.annotate(
2169.                 authors_count=Count("authors"),
2170.             ).count()
2171.         self.assertEqual(cnt, 2)
2172.         sql = ctx.captured_queries[0]["sql"].lower()
2173.         self.assertEqual(sql.count("select"), 2, "Subquery wrapping required")
2174.         self.assertNotIn("authors_count", sql)
2175. 
2176.     def test_referenced_aggregate_annotation_kept(self):
2177.         with CaptureQueriesContext(connection) as ctx:
2178.             Book.objects.annotate(
2179.                 authors_count=Count("authors"),
2180.             ).aggregate(Avg("authors_count"))
2181.         sql = ctx.captured_queries[0]["sql"].lower()
2182.         self.assertEqual(sql.count("select"), 2, "Subquery wrapping required")
2183.         self.assertEqual(sql.count("authors_count"), 2)
2184. 
2185.     def test_referenced_group_by_annotation_kept(self):
2186.         queryset = Book.objects.values(pages_mod=Mod("pages", 10)).annotate(
2187.             mod_count=Count("*")
2188.         )
2189.         self.assertEqual(queryset.count(), 1)
2190. 
2191.     def test_referenced_subquery_requires_wrapping(self):
2192.         total_books_qs = (
2193.             Author.book_set.through.objects.values("author")
2194.             .filter(author=OuterRef("pk"))
2195.             .annotate(total=Count("book"))
2196.         )
2197.         with self.assertNumQueries(1) as ctx:
2198.             aggregate = (
2199.                 Author.objects.annotate(
2200.                     total_books=Subquery(total_books_qs.values("total"))
2201.                 )
2202.                 .values("pk", "total_books")
2203.                 .aggregate(
2204.                     sum_total_books=Sum("total_books"),
2205.                 )
2206.             )
2207.         sql = ctx.captured_queries[0]["sql"].lower()
2208.         self.assertEqual(sql.count("select"), 3, "Subquery wrapping required")
2209.         self.assertEqual(aggregate, {"sum_total_books": 3})


File: tests/cache/tests.py
Line number range: 69 - 70
Content:
def f():
    return 42


File: tests/cache/tests.py
Line number range: 83 - 84
Content:
def empty_response(request):
    return HttpResponse()


File: tests/dispatch/tests.py
Line number range: 23 - 24
Content:
def receiver_1_arg(val, **kwargs):
    return val


File: tests/handlers/tests.py
Line number range: 179 - 180
Content:
def empty_middleware(get_response):
    pass


File: tests/logging_tests/tests.py
Line number range: 500 - 501
Content:
def dictConfig(config):
    dictConfig.called = True

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 01:47:02,152 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'tests/aggregation/tests.py'. The provided context contains the entire content of this file, from line 1 to 2210. Therefore, the entire file is selected to fulfill the user's request.", relative_path='tests/aggregation/tests.py', start_line=1, end_line=2210)]
2025-12-23 01:47:02,156 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of tests/aggregation/tests.py.
2025-12-23 01:47:02,156 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 01:47:02,156 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 01:47:02,157 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-23 01:47:02,157 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-23 01:47:02,158 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── benchmark.yml
|       ├── data
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       ├── schedule_tests.yml
|       ├── schedules.yml
|       ├── selenium.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ckb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_IE
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   └── options.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── ckb
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── filesystem.py
|   |   |   |   ├── handler.py
|   |   |   |   ├── memory.py
|   |   |   |   └── mixins.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── optimizemigration.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── psycopg_any.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── csrf_403.html
|           ├── default_urlconf.html
|           ├── directory_index.html
|           ├── i18n_catalog.js
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── csrf.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── delete-app.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   ├── tutorial08.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.27.txt
|   |   ├── 2.2.28.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.12.txt
|   |   ├── 3.2.13.txt
|   |   ├── 3.2.14.txt
|   |   ├── 3.2.15.txt
|   |   ├── 3.2.16.txt
|   |   ├── 3.2.17.txt
|   |   ├── 3.2.18.txt
|   |   ├── 3.2.19.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.20.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.10.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.3.txt
|   |   ├── 4.0.4.txt
|   |   ├── 4.0.5.txt
|   |   ├── 4.0.6.txt
|   |   ├── 4.0.7.txt
|   |   ├── 4.0.8.txt
|   |   ├── 4.0.9.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.1.txt
|   |   ├── 4.1.10.txt
|   |   ├── 4.1.2.txt
|   |   ├── 4.1.3.txt
|   |   ├── 4.1.4.txt
|   |   ├── 4.1.5.txt
|   |   ├── 4.1.6.txt
|   |   ├── 4.1.7.txt
|   |   ├── 4.1.8.txt
|   |   ├── 4.1.9.txt
|   |   ├── 4.1.txt
|   |   ├── 4.2.1.txt
|   |   ├── 4.2.2.txt
|   |   ├── 4.2.3.txt
|   |   ├── 4.2.4.txt
|   |   ├── 4.2.txt
|   |   ├── 5.0.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── fixtures.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_breadcrumbs.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_related_object_lookups.py
    |   ├── test_skip_link_to_content.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_async_auth.py
    |   ├── test_async_model_methods.py
    |   ├── test_async_queryset.py
    |   ├── test_async_related_managers.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   ├── with_many_to_many.py
    |   |   └── with_unique_constraint.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   ├── ending_with_dollar.py
    |       |   ├── matched_angle_brackets.py
    |       |   └── unmatched_angle_brackets.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_migrations.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   ├── test_cache.py
    |   ├── test_clickjacking.py
    |   ├── test_common.py
    |   ├── test_csrf.py
    |   ├── test_http.py
    |   ├── test_vary.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_middleware_mixin.py
    |   ├── test_storages.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── test_inmemory_storage.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_field.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       ├── legend_test.html
    |   |       └── use_fieldset.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── obsolete_translations
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_noop
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_no_replaces
    |   |   ├── 0001_squashed_0002.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests_tests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   └── urls
    |       ├── __init__.py
    |       ├── http.py
    |       └── https.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── absolute_root.js
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── nonutf8
    |   |   |   └── nonutf8.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_escapeseq.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Cannot use aggregate over window functions since 4.2

Description: Description
	 
		(last modified by younes-chaoui)
	 
After upgrading to Django 4.2, I encountered an exception when executing ORM queries that involve aggregates over Window functions. The specific error was psycopg2.errors.GroupingError: aggregate function calls cannot contain window function calls
Dependencies :
psycopg2 version: 2.9.3
django version: 4.2.3
PostgreSQL version: 13.4
Example Code:
queryset = queryset.annotate(
	cumul_DJR=Coalesce(Window(Sum("DJR"), order_by=F("date").asc()), 0.0)
)
aggregate = queryset.aggregate(
	DJR_total=Sum("DJR"),
	cumul_DJR_total=Sum("cumul_DJR")
)

Patch information:
diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py
index 13a6809dd8..514a6b36ce 100644
--- a/django/db/models/sql/query.py
+++ b/django/db/models/sql/query.py
@@ -454,6 +454,9 @@ class Query(BaseExpression):
             or qualify
             or self.distinct
             or self.combinator
+            or any(
+                aggregate.contains_over_clause for aggregate in aggregates.values()
+            )
         ):
             from django.db.models.sql.subqueries import AggregateQuery
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of tests/expressions_window/tests.py.
Extra Requirements: 
Purpose: This file is expected to contain test cases for window functions, which are at the core of the reported bug. I will analyze it to find tests that aggregate over window function annotations.

Previous refined query 2:
Essential Query: Please provide the full content of tests/aggregation/tests.py.
Extra Requirements: 
Purpose: This file is expected to contain the main aggregation tests, and I will search it for test cases that perform aggregation over annotated fields, which is the scenario described in the bug report.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/aggregation/tests.py
Line number range: 1 - 2210
Content:
1. import datetime
2. import math
3. import re
4. from decimal import Decimal
5. 
6. from django.core.exceptions import FieldError
7. from django.db import connection
8. from django.db.models import (
9.     Avg,
10.     Case,
11.     Count,
12.     DateField,
13.     DateTimeField,
14.     DecimalField,
15.     DurationField,
16.     Exists,
17.     F,
18.     FloatField,
19.     IntegerField,
20.     Max,
21.     Min,
22.     OuterRef,
23.     Q,
24.     StdDev,
25.     Subquery,
26.     Sum,
27.     TimeField,
28.     Value,
29.     Variance,
30.     When,
31. )
32. from django.db.models.expressions import Func, RawSQL
33. from django.db.models.functions import (
34.     Cast,
35.     Coalesce,
36.     Greatest,
37.     Least,
38.     Lower,
39.     Mod,
40.     Now,
41.     Pi,
42.     TruncDate,
43.     TruncHour,
44. )
45. from django.test import TestCase
46. from django.test.testcases import skipUnlessDBFeature
47. from django.test.utils import Approximate, CaptureQueriesContext
48. from django.utils import timezone
49. 
50. from .models import Author, Book, Publisher, Store
51. 
52. 
53. class NowUTC(Now):
54.     template = "CURRENT_TIMESTAMP"
55.     output_field = DateTimeField()
56. 
57.     def as_sql(self, compiler, connection, **extra_context):
58.         if connection.features.test_now_utc_template:
59.             extra_context["template"] = connection.features.test_now_utc_template
60.         return super().as_sql(compiler, connection, **extra_context)
61. 
62. 
63. class AggregateTestCase(TestCase):
64.     @classmethod
65.     def setUpTestData(cls):
66.         cls.a1 = Author.objects.create(name="Adrian Holovaty", age=34)
67.         cls.a2 = Author.objects.create(name="Jacob Kaplan-Moss", age=35)
68.         cls.a3 = Author.objects.create(name="Brad Dayley", age=45)
69.         cls.a4 = Author.objects.create(name="James Bennett", age=29)
70.         cls.a5 = Author.objects.create(name="Jeffrey Forcier", age=37)
71.         cls.a6 = Author.objects.create(name="Paul Bissex", age=29)
72.         cls.a7 = Author.objects.create(name="Wesley J. Chun", age=25)
73.         cls.a8 = Author.objects.create(name="Peter Norvig", age=57)
74.         cls.a9 = Author.objects.create(name="Stuart Russell", age=46)
75.         cls.a1.friends.add(cls.a2, cls.a4)
76.         cls.a2.friends.add(cls.a1, cls.a7)
77.         cls.a4.friends.add(cls.a1)
78.         cls.a5.friends.add(cls.a6, cls.a7)
79.         cls.a6.friends.add(cls.a5, cls.a7)
80.         cls.a7.friends.add(cls.a2, cls.a5, cls.a6)
81.         cls.a8.friends.add(cls.a9)
82.         cls.a9.friends.add(cls.a8)
83. 
84.         cls.p1 = Publisher.objects.create(
85.             name="Apress", num_awards=3, duration=datetime.timedelta(days=1)
86.         )
87.         cls.p2 = Publisher.objects.create(
88.             name="Sams", num_awards=1, duration=datetime.timedelta(days=2)
89.         )
90.         cls.p3 = Publisher.objects.create(name="Prentice Hall", num_awards=7)
91.         cls.p4 = Publisher.objects.create(name="Morgan Kaufmann", num_awards=9)
92.         cls.p5 = Publisher.objects.create(name="Jonno's House of Books", num_awards=0)
93. 
94.         cls.b1 = Book.objects.create(
95.             isbn="159059725",
96.             name="The Definitive Guide to Django: Web Development Done Right",
97.             pages=447,
98.             rating=4.5,
99.             price=Decimal("30.00"),
100.             contact=cls.a1,
101.             publisher=cls.p1,
102.             pubdate=datetime.date(2007, 12, 6),
103.         )
104.         cls.b2 = Book.objects.create(
105.             isbn="067232959",
106.             name="Sams Teach Yourself Django in 24 Hours",
107.             pages=528,
108.             rating=3.0,
109.             price=Decimal("23.09"),
110.             contact=cls.a3,
111.             publisher=cls.p2,
112.             pubdate=datetime.date(2008, 3, 3),
113.         )
114.         cls.b3 = Book.objects.create(
115.             isbn="159059996",
116.             name="Practical Django Projects",
117.             pages=300,
118.             rating=4.0,
119.             price=Decimal("29.69"),
120.             contact=cls.a4,
121.             publisher=cls.p1,
122.             pubdate=datetime.date(2008, 6, 23),
123.         )
124.         cls.b4 = Book.objects.create(
125.             isbn="013235613",
126.             name="Python Web Development with Django",
127.             pages=350,
128.             rating=4.0,
129.             price=Decimal("29.69"),
130.             contact=cls.a5,
131.             publisher=cls.p3,
132.             pubdate=datetime.date(2008, 11, 3),
133.         )
134.         cls.b5 = Book.objects.create(
135.             isbn="013790395",
136.             name="Artificial Intelligence: A Modern Approach",
137.             pages=1132,
138.             rating=4.0,
139.             price=Decimal("82.80"),
140.             contact=cls.a8,
141.             publisher=cls.p3,
142.             pubdate=datetime.date(1995, 1, 15),
143.         )
144.         cls.b6 = Book.objects.create(
145.             isbn="155860191",
146.             name=(
147.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
148.                 "Common Lisp"
149.             ),
150.             pages=946,
151.             rating=5.0,
152.             price=Decimal("75.00"),
153.             contact=cls.a8,
154.             publisher=cls.p4,
155.             pubdate=datetime.date(1991, 10, 15),
156.         )
157.         cls.b1.authors.add(cls.a1, cls.a2)
158.         cls.b2.authors.add(cls.a3)
159.         cls.b3.authors.add(cls.a4)
160.         cls.b4.authors.add(cls.a5, cls.a6, cls.a7)
161.         cls.b5.authors.add(cls.a8, cls.a9)
162.         cls.b6.authors.add(cls.a8)
163. 
164.         s1 = Store.objects.create(
165.             name="Amazon.com",
166.             original_opening=datetime.datetime(1994, 4, 23, 9, 17, 42),
167.             friday_night_closing=datetime.time(23, 59, 59),
168.         )
169.         s2 = Store.objects.create(
170.             name="Books.com",
171.             original_opening=datetime.datetime(2001, 3, 15, 11, 23, 37),
172.             friday_night_closing=datetime.time(23, 59, 59),
173.         )
174.         s3 = Store.objects.create(
175.             name="Mamma and Pappa's Books",
176.             original_opening=datetime.datetime(1945, 4, 25, 16, 24, 14),
177.             friday_night_closing=datetime.time(21, 30),
178.         )
179.         s1.books.add(cls.b1, cls.b2, cls.b3, cls.b4, cls.b5, cls.b6)
180.         s2.books.add(cls.b1, cls.b3, cls.b5, cls.b6)
181.         s3.books.add(cls.b3, cls.b4, cls.b6)
182. 
183.     def test_empty_aggregate(self):
184.         self.assertEqual(Author.objects.aggregate(), {})
185. 
186.     def test_aggregate_in_order_by(self):
187.         msg = (
188.             "Using an aggregate in order_by() without also including it in "
189.             "annotate() is not allowed: Avg(F(book__rating)"
190.         )
191.         with self.assertRaisesMessage(FieldError, msg):
192.             Author.objects.values("age").order_by(Avg("book__rating"))
193. 
194.     def test_single_aggregate(self):
195.         vals = Author.objects.aggregate(Avg("age"))
196.         self.assertEqual(vals, {"age__avg": Approximate(37.4, places=1)})
197. 
198.     def test_multiple_aggregates(self):
199.         vals = Author.objects.aggregate(Sum("age"), Avg("age"))
200.         self.assertEqual(
201.             vals, {"age__sum": 337, "age__avg": Approximate(37.4, places=1)}
202.         )
203. 
204.     def test_filter_aggregate(self):
205.         vals = Author.objects.filter(age__gt=29).aggregate(Sum("age"))
206.         self.assertEqual(vals, {"age__sum": 254})
207. 
208.     def test_related_aggregate(self):
209.         vals = Author.objects.aggregate(Avg("friends__age"))
210.         self.assertEqual(vals, {"friends__age__avg": Approximate(34.07, places=2)})
211. 
212.         vals = Book.objects.filter(rating__lt=4.5).aggregate(Avg("authors__age"))
213.         self.assertEqual(vals, {"authors__age__avg": Approximate(38.2857, places=2)})
214. 
215.         vals = Author.objects.filter(name__contains="a").aggregate(Avg("book__rating"))
216.         self.assertEqual(vals, {"book__rating__avg": 4.0})
217. 
218.         vals = Book.objects.aggregate(Sum("publisher__num_awards"))
219.         self.assertEqual(vals, {"publisher__num_awards__sum": 30})
220. 
221.         vals = Publisher.objects.aggregate(Sum("book__price"))
222.         self.assertEqual(vals, {"book__price__sum": Decimal("270.27")})
223. 
224.     def test_aggregate_multi_join(self):
225.         vals = Store.objects.aggregate(Max("books__authors__age"))
226.         self.assertEqual(vals, {"books__authors__age__max": 57})
227. 
228.         vals = Author.objects.aggregate(Min("book__publisher__num_awards"))
229.         self.assertEqual(vals, {"book__publisher__num_awards__min": 1})
230. 
231.     def test_aggregate_alias(self):
232.         vals = Store.objects.filter(name="Amazon.com").aggregate(
233.             amazon_mean=Avg("books__rating")
234.         )
235.         self.assertEqual(vals, {"amazon_mean": Approximate(4.08, places=2)})
236. 
237.     def test_aggregate_transform(self):
238.         vals = Store.objects.aggregate(min_month=Min("original_opening__month"))
239.         self.assertEqual(vals, {"min_month": 3})
240. 
241.     def test_aggregate_join_transform(self):
242.         vals = Publisher.objects.aggregate(min_year=Min("book__pubdate__year"))
243.         self.assertEqual(vals, {"min_year": 1991})
244. 
245.     def test_annotate_basic(self):
246.         self.assertQuerySetEqual(
247.             Book.objects.annotate().order_by("pk"),
248.             [
249.                 "The Definitive Guide to Django: Web Development Done Right",
250.                 "Sams Teach Yourself Django in 24 Hours",
251.                 "Practical Django Projects",
252.                 "Python Web Development with Django",
253.                 "Artificial Intelligence: A Modern Approach",
254.                 "Paradigms of Artificial Intelligence Programming: Case Studies in "
255.                 "Common Lisp",
256.             ],
257.             lambda b: b.name,
258.         )
259. 
260.         books = Book.objects.annotate(mean_age=Avg("authors__age"))
261.         b = books.get(pk=self.b1.pk)
262.         self.assertEqual(
263.             b.name, "The Definitive Guide to Django: Web Development Done Right"
264.         )
265.         self.assertEqual(b.mean_age, 34.5)
266. 
267.     def test_annotate_defer(self):
268.         qs = (
269.             Book.objects.annotate(page_sum=Sum("pages"))
270.             .defer("name")
271.             .filter(pk=self.b1.pk)
272.         )
273. 
274.         rows = [
275.             (
276.                 self.b1.id,
277.                 "159059725",
278.                 447,
279.                 "The Definitive Guide to Django: Web Development Done Right",
280.             )
281.         ]
282.         self.assertQuerySetEqual(
283.             qs.order_by("pk"), rows, lambda r: (r.id, r.isbn, r.page_sum, r.name)
284.         )
285. 
286.     def test_annotate_defer_select_related(self):
287.         qs = (
288.             Book.objects.select_related("contact")
289.             .annotate(page_sum=Sum("pages"))
290.             .defer("name")
291.             .filter(pk=self.b1.pk)
292.         )
293. 
294.         rows = [
295.             (
296.                 self.b1.id,
297.                 "159059725",
298.                 447,
299.                 "Adrian Holovaty",
300.                 "The Definitive Guide to Django: Web Development Done Right",
301.             )
302.         ]
303.         self.assertQuerySetEqual(
304.             qs.order_by("pk"),
305.             rows,
306.             lambda r: (r.id, r.isbn, r.page_sum, r.contact.name, r.name),
307.         )
308. 
309.     def test_annotate_m2m(self):
310.         books = (
311.             Book.objects.filter(rating__lt=4.5)
312.             .annotate(Avg("authors__age"))
313.             .order_by("name")
314.         )
315.         self.assertQuerySetEqual(
316.             books,
317.             [
318.                 ("Artificial Intelligence: A Modern Approach", 51.5),
319.                 ("Practical Django Projects", 29.0),
320.                 ("Python Web Development with Django", Approximate(30.3, places=1)),
321.                 ("Sams Teach Yourself Django in 24 Hours", 45.0),
322.             ],
323.             lambda b: (b.name, b.authors__age__avg),
324.         )
325. 
326.         books = Book.objects.annotate(num_authors=Count("authors")).order_by("name")
327.         self.assertQuerySetEqual(
328.             books,
329.             [
330.                 ("Artificial Intelligence: A Modern Approach", 2),
331.                 (
332.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
333.                     "Common Lisp",
334.                     1,
335.                 ),
336.                 ("Practical Django Projects", 1),
337.                 ("Python Web Development with Django", 3),
338.                 ("Sams Teach Yourself Django in 24 Hours", 1),
339.                 ("The Definitive Guide to Django: Web Development Done Right", 2),
340.             ],
341.             lambda b: (b.name, b.num_authors),
342.         )
343. 
344.     def test_backwards_m2m_annotate(self):
345.         authors = (
346.             Author.objects.filter(name__contains="a")
347.             .annotate(Avg("book__rating"))
348.             .order_by("name")
349.         )
350.         self.assertQuerySetEqual(
351.             authors,
352.             [
353.                 ("Adrian Holovaty", 4.5),
354.                 ("Brad Dayley", 3.0),
355.                 ("Jacob Kaplan-Moss", 4.5),
356.                 ("James Bennett", 4.0),
357.                 ("Paul Bissex", 4.0),
358.                 ("Stuart Russell", 4.0),
359.             ],
360.             lambda a: (a.name, a.book__rating__avg),
361.         )
362. 
363.         authors = Author.objects.annotate(num_books=Count("book")).order_by("name")
364.         self.assertQuerySetEqual(
365.             authors,
366.             [
367.                 ("Adrian Holovaty", 1),
368.                 ("Brad Dayley", 1),
369.                 ("Jacob Kaplan-Moss", 1),
370.                 ("James Bennett", 1),
371.                 ("Jeffrey Forcier", 1),
372.                 ("Paul Bissex", 1),
373.                 ("Peter Norvig", 2),
374.                 ("Stuart Russell", 1),
375.                 ("Wesley J. Chun", 1),
376.             ],
377.             lambda a: (a.name, a.num_books),
378.         )
379. 
380.     def test_reverse_fkey_annotate(self):
381.         books = Book.objects.annotate(Sum("publisher__num_awards")).order_by("name")
382.         self.assertQuerySetEqual(
383.             books,
384.             [
385.                 ("Artificial Intelligence: A Modern Approach", 7),
386.                 (
387.                     "Paradigms of Artificial Intelligence Programming: Case Studies in "
388.                     "Common Lisp",
389.                     9,
390.                 ),
391.                 ("Practical Django Projects", 3),
392.                 ("Python Web Development with Django", 7),
393.                 ("Sams Teach Yourself Django in 24 Hours", 1),
394.                 ("The Definitive Guide to Django: Web Development Done Right", 3),
395.             ],
396.             lambda b: (b.name, b.publisher__num_awards__sum),
397.         )
398. 
399.         publishers = Publisher.objects.annotate(Sum("book__price")).order_by("name")
400.         self.assertQuerySetEqual(
401.             publishers,
402.             [
403.                 ("Apress", Decimal("59.69")),
404.                 ("Jonno's House of Books", None),
405.                 ("Morgan Kaufmann", Decimal("75.00")),
406.                 ("Prentice Hall", Decimal("112.49")),
407.                 ("Sams", Decimal("23.09")),
408.             ],
409.             lambda p: (p.name, p.book__price__sum),
410.         )
411. 
412.     def test_annotate_values(self):
413.         books = list(
414.             Book.objects.filter(pk=self.b1.pk)
415.             .annotate(mean_age=Avg("authors__age"))
416.             .values()
417.         )
418.         self.assertEqual(
419.             books,
420.             [
421.                 {
422.                     "contact_id": self.a1.id,
423.                     "id": self.b1.id,
424.                     "isbn": "159059725",
425.                     "mean_age": 34.5,
426.                     "name": (
427.                         "The Definitive Guide to Django: Web Development Done Right"
428.                     ),
429.                     "pages": 447,
430.                     "price": Approximate(Decimal("30")),
431.                     "pubdate": datetime.date(2007, 12, 6),
432.                     "publisher_id": self.p1.id,
433.                     "rating": 4.5,
434.                 }
435.             ],
436.         )
437. 
438.         books = (
439.             Book.objects.filter(pk=self.b1.pk)
440.             .annotate(mean_age=Avg("authors__age"))
441.             .values("pk", "isbn", "mean_age")
442.         )
443.         self.assertEqual(
444.             list(books),
445.             [
446.                 {
447.                     "pk": self.b1.pk,
448.                     "isbn": "159059725",
449.                     "mean_age": 34.5,
450.                 }
451.             ],
452.         )
453. 
454.         books = (
455.             Book.objects.filter(pk=self.b1.pk)
456.             .annotate(mean_age=Avg("authors__age"))
457.             .values("name")
458.         )
459.         self.assertEqual(
460.             list(books),
461.             [{"name": "The Definitive Guide to Django: Web Development Done Right"}],
462.         )
463. 
464.         books = (
465.             Book.objects.filter(pk=self.b1.pk)
466.             .values()
467.             .annotate(mean_age=Avg("authors__age"))
468.         )
469.         self.assertEqual(
470.             list(books),
471.             [
472.                 {
473.                     "contact_id": self.a1.id,
474.                     "id": self.b1.id,
475.                     "isbn": "159059725",
476.                     "mean_age": 34.5,
477.                     "name": (
478.                         "The Definitive Guide to Django: Web Development Done Right"
479.                     ),
480.                     "pages": 447,
481.                     "price": Approximate(Decimal("30")),
482.                     "pubdate": datetime.date(2007, 12, 6),
483.                     "publisher_id": self.p1.id,
484.                     "rating": 4.5,
485.                 }
486.             ],
487.         )
488. 
489.         books = (
490.             Book.objects.values("rating")
491.             .annotate(n_authors=Count("authors__id"), mean_age=Avg("authors__age"))
492.             .order_by("rating")
493.         )
494.         self.assertEqual(
495.             list(books),
496.             [
497.                 {
498.                     "rating": 3.0,
499.                     "n_authors": 1,
500.                     "mean_age": 45.0,
501.                 },
502.                 {
503.                     "rating": 4.0,
504.                     "n_authors": 6,
505.                     "mean_age": Approximate(37.16, places=1),
506.                 },
507.                 {
508.                     "rating": 4.5,
509.                     "n_authors": 2,
510.                     "mean_age": 34.5,
511.                 },
512.                 {
513.                     "rating": 5.0,
514.                     "n_authors": 1,
515.                     "mean_age": 57.0,
516.                 },
517.             ],
518.         )
519. 
520.         authors = Author.objects.annotate(Avg("friends__age")).order_by("name")
521.         self.assertQuerySetEqual(
522.             authors,
523.             [
524.                 ("Adrian Holovaty", 32.0),
525.                 ("Brad Dayley", None),
526.                 ("Jacob Kaplan-Moss", 29.5),
527.                 ("James Bennett", 34.0),
528.                 ("Jeffrey Forcier", 27.0),
529.                 ("Paul Bissex", 31.0),
530.                 ("Peter Norvig", 46.0),
531.                 ("Stuart Russell", 57.0),
532.                 ("Wesley J. Chun", Approximate(33.66, places=1)),
533.             ],
534.             lambda a: (a.name, a.friends__age__avg),
535.         )
536. 
537.     def test_count(self):
538.         vals = Book.objects.aggregate(Count("rating"))
539.         self.assertEqual(vals, {"rating__count": 6})
540. 
541.     def test_count_star(self):
542.         with self.assertNumQueries(1) as ctx:
543.             Book.objects.aggregate(n=Count("*"))
544.         sql = ctx.captured_queries[0]["sql"]
545.         self.assertIn("SELECT COUNT(*) ", sql)
546. 
547.     def test_count_distinct_expression(self):
548.         aggs = Book.objects.aggregate(
549.             distinct_ratings=Count(
550.                 Case(When(pages__gt=300, then="rating")), distinct=True
551.             ),
552.         )
553.         self.assertEqual(aggs["distinct_ratings"], 4)
554. 
555.     def test_distinct_on_aggregate(self):
556.         for aggregate, expected_result in (
557.             (Avg, 4.125),
558.             (Count, 4),
559.             (Sum, 16.5),
560.         ):
561.             with self.subTest(aggregate=aggregate.__name__):
562.                 books = Book.objects.aggregate(
563.                     ratings=aggregate("rating", distinct=True)
564.                 )
565.                 self.assertEqual(books["ratings"], expected_result)
566. 
567.     def test_non_grouped_annotation_not_in_group_by(self):
568.         """
569.         An annotation not included in values() before an aggregate should be
570.         excluded from the group by clause.
571.         """
572.         qs = (
573.             Book.objects.annotate(xprice=F("price"))
574.             .filter(rating=4.0)
575.             .values("rating")
576.             .annotate(count=Count("publisher_id", distinct=True))
577.             .values("count", "rating")
578.             .order_by("count")
579.         )
580.         self.assertEqual(list(qs), [{"rating": 4.0, "count": 2}])
581. 
582.     def test_grouped_annotation_in_group_by(self):
583.         """
584.         An annotation included in values() before an aggregate should be
585.         included in the group by clause.
586.         """
587.         qs = (
588.             Book.objects.annotate(xprice=F("price"))
589.             .filter(rating=4.0)
590.             .values("rating", "xprice")
591.             .annotate(count=Count("publisher_id", distinct=True))
592.             .values("count", "rating")
593.             .order_by("count")
594.         )
595.         self.assertEqual(
596.             list(qs),
597.             [
598.                 {"rating": 4.0, "count": 1},
599.                 {"rating": 4.0, "count": 2},
600.             ],
601.         )
602. 
603.     def test_fkey_aggregate(self):
604.         explicit = list(Author.objects.annotate(Count("book__id")))
605.         implicit = list(Author.objects.annotate(Count("book")))
606.         self.assertCountEqual(explicit, implicit)
607. 
608.     def test_annotate_ordering(self):
609.         books = (
610.             Book.objects.values("rating")
611.             .annotate(oldest=Max("authors__age"))
612.             .order_by("oldest", "rating")
613.         )
614.         self.assertEqual(
615.             list(books),
616.             [
617.                 {"rating": 4.5, "oldest": 35},
618.                 {"rating": 3.0, "oldest": 45},
619.                 {"rating": 4.0, "oldest": 57},
620.                 {"rating": 5.0, "oldest": 57},
621.             ],
622.         )
623. 
624.         books = (
625.             Book.objects.values("rating")
626.             .annotate(oldest=Max("authors__age"))
627.             .order_by("-oldest", "-rating")
628.         )
629.         self.assertEqual(
630.             list(books),
631.             [
632.                 {"rating": 5.0, "oldest": 57},
633.                 {"rating": 4.0, "oldest": 57},
634.                 {"rating": 3.0, "oldest": 45},
635.                 {"rating": 4.5, "oldest": 35},
636.             ],
637.         )
638. 
639.     def test_aggregate_annotation(self):
640.         vals = Book.objects.annotate(num_authors=Count("authors__id")).aggregate(
641.             Avg("num_authors")
642.         )
643.         self.assertEqual(vals, {"num_authors__avg": Approximate(1.66, places=1)})
644. 
645.     def test_avg_duration_field(self):
646.         # Explicit `output_field`.
647.         self.assertEqual(
648.             Publisher.objects.aggregate(Avg("duration", output_field=DurationField())),
649.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
650.         )
651.         # Implicit `output_field`.
652.         self.assertEqual(
653.             Publisher.objects.aggregate(Avg("duration")),
654.             {"duration__avg": datetime.timedelta(days=1, hours=12)},
655.         )
656. 
657.     def test_sum_duration_field(self):
658.         self.assertEqual(
659.             Publisher.objects.aggregate(Sum("duration", output_field=DurationField())),
660.             {"duration__sum": datetime.timedelta(days=3)},
661.         )
662. 
663.     def test_sum_distinct_aggregate(self):
664.         """
665.         Sum on a distinct() QuerySet should aggregate only the distinct items.
666.         """
667.         authors = Author.objects.filter(book__in=[self.b5, self.b6])
668.         self.assertEqual(authors.count(), 3)
669. 
670.         distinct_authors = authors.distinct()
671.         self.assertEqual(distinct_authors.count(), 2)
672. 
673.         # Selected author ages are 57 and 46
674.         age_sum = distinct_authors.aggregate(Sum("age"))
675.         self.assertEqual(age_sum["age__sum"], 103)
676. 
677.     def test_filtering(self):
678.         p = Publisher.objects.create(name="Expensive Publisher", num_awards=0)
679.         Book.objects.create(
680.             name="ExpensiveBook1",
681.             pages=1,
682.             isbn="111",
683.             rating=3.5,
684.             price=Decimal("1000"),
685.             publisher=p,
686.             contact_id=self.a1.id,
687.             pubdate=datetime.date(2008, 12, 1),
688.         )
689.         Book.objects.create(
690.             name="ExpensiveBook2",
691.             pages=1,
692.             isbn="222",
693.             rating=4.0,
694.             price=Decimal("1000"),
695.             publisher=p,
696.             contact_id=self.a1.id,
697.             pubdate=datetime.date(2008, 12, 2),
698.         )
699.         Book.objects.create(
700.             name="ExpensiveBook3",
701.             pages=1,
702.             isbn="333",
703.             rating=4.5,
704.             price=Decimal("35"),
705.             publisher=p,
706.             contact_id=self.a1.id,
707.             pubdate=datetime.date(2008, 12, 3),
708.         )
709. 
710.         publishers = (
711.             Publisher.objects.annotate(num_books=Count("book__id"))
712.             .filter(num_books__gt=1)
713.             .order_by("pk")
714.         )
715.         self.assertQuerySetEqual(
716.             publishers,
717.             ["Apress", "Prentice Hall", "Expensive Publisher"],
718.             lambda p: p.name,
719.         )
720. 
721.         publishers = Publisher.objects.filter(book__price__lt=Decimal("40.0")).order_by(
722.             "pk"
723.         )
724.         self.assertQuerySetEqual(
725.             publishers,
726.             [
727.                 "Apress",
728.                 "Apress",
729.                 "Sams",
730.                 "Prentice Hall",
731.                 "Expensive Publisher",
732.             ],
733.             lambda p: p.name,
734.         )
735. 
736.         publishers = (
737.             Publisher.objects.annotate(num_books=Count("book__id"))
738.             .filter(num_books__gt=1, book__price__lt=Decimal("40.0"))
739.             .order_by("pk")
740.         )
741.         self.assertQuerySetEqual(
742.             publishers,
743.             ["Apress", "Prentice Hall", "Expensive Publisher"],
744.             lambda p: p.name,
745.         )
746. 
747.         publishers = (
748.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
749.             .annotate(num_books=Count("book__id"))
750.             .filter(num_books__gt=1)
751.             .order_by("pk")
752.         )
753.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
754. 
755.         publishers = (
756.             Publisher.objects.annotate(num_books=Count("book"))
757.             .filter(num_books__range=[1, 3])
758.             .order_by("pk")
759.         )
760.         self.assertQuerySetEqual(
761.             publishers,
762.             [
763.                 "Apress",
764.                 "Sams",
765.                 "Prentice Hall",
766.                 "Morgan Kaufmann",
767.                 "Expensive Publisher",
768.             ],
769.             lambda p: p.name,
770.         )
771. 
772.         publishers = (
773.             Publisher.objects.annotate(num_books=Count("book"))
774.             .filter(num_books__range=[1, 2])
775.             .order_by("pk")
776.         )
777.         self.assertQuerySetEqual(
778.             publishers,
779.             ["Apress", "Sams", "Prentice Hall", "Morgan Kaufmann"],
780.             lambda p: p.name,
781.         )
782. 
783.         publishers = (
784.             Publisher.objects.annotate(num_books=Count("book"))
785.             .filter(num_books__in=[1, 3])
786.             .order_by("pk")
787.         )
788.         self.assertQuerySetEqual(
789.             publishers,
790.             ["Sams", "Morgan Kaufmann", "Expensive Publisher"],
791.             lambda p: p.name,
792.         )
793. 
794.         publishers = Publisher.objects.annotate(num_books=Count("book")).filter(
795.             num_books__isnull=True
796.         )
797.         self.assertEqual(len(publishers), 0)
798. 
799.     def test_annotation(self):
800.         vals = Author.objects.filter(pk=self.a1.pk).aggregate(Count("friends__id"))
801.         self.assertEqual(vals, {"friends__id__count": 2})
802. 
803.         books = (
804.             Book.objects.annotate(num_authors=Count("authors__name"))
805.             .filter(num_authors__exact=2)
806.             .order_by("pk")
807.         )
808.         self.assertQuerySetEqual(
809.             books,
810.             [
811.                 "The Definitive Guide to Django: Web Development Done Right",
812.                 "Artificial Intelligence: A Modern Approach",
813.             ],
814.             lambda b: b.name,
815.         )
816. 
817.         authors = (
818.             Author.objects.annotate(num_friends=Count("friends__id", distinct=True))
819.             .filter(num_friends=0)
820.             .order_by("pk")
821.         )
822.         self.assertQuerySetEqual(authors, ["Brad Dayley"], lambda a: a.name)
823. 
824.         publishers = (
825.             Publisher.objects.annotate(num_books=Count("book__id"))
826.             .filter(num_books__gt=1)
827.             .order_by("pk")
828.         )
829.         self.assertQuerySetEqual(
830.             publishers, ["Apress", "Prentice Hall"], lambda p: p.name
831.         )
832. 
833.         publishers = (
834.             Publisher.objects.filter(book__price__lt=Decimal("40.0"))
835.             .annotate(num_books=Count("book__id"))
836.             .filter(num_books__gt=1)
837.         )
838.         self.assertQuerySetEqual(publishers, ["Apress"], lambda p: p.name)
839. 
840.         books = Book.objects.annotate(num_authors=Count("authors__id")).filter(
841.             authors__name__contains="Norvig", num_authors__gt=1
842.         )
843.         self.assertQuerySetEqual(
844.             books, ["Artificial Intelligence: A Modern Approach"], lambda b: b.name
845.         )
846. 
847.     def test_more_aggregation(self):
848.         a = Author.objects.get(name__contains="Norvig")
849.         b = Book.objects.get(name__contains="Done Right")
850.         b.authors.add(a)
851.         b.save()
852. 
853.         vals = (
854.             Book.objects.annotate(num_authors=Count("authors__id"))
855.             .filter(authors__name__contains="Norvig", num_authors__gt=1)
856.             .aggregate(Avg("rating"))
857.         )
858.         self.assertEqual(vals, {"rating__avg": 4.25})
859. 
860.     def test_even_more_aggregate(self):
861.         publishers = (
862.             Publisher.objects.annotate(
863.                 earliest_book=Min("book__pubdate"),
864.             )
865.             .exclude(earliest_book=None)
866.             .order_by("earliest_book")
867.             .values(
868.                 "earliest_book",
869.                 "num_awards",
870.                 "id",
871.                 "name",
872.             )
873.         )
874.         self.assertEqual(
875.             list(publishers),
876.             [
877.                 {
878.                     "earliest_book": datetime.date(1991, 10, 15),
879.                     "num_awards": 9,
880.                     "id": self.p4.id,
881.                     "name": "Morgan Kaufmann",
882.                 },
883.                 {
884.                     "earliest_book": datetime.date(1995, 1, 15),
885.                     "num_awards": 7,
886.                     "id": self.p3.id,
887.                     "name": "Prentice Hall",
888.                 },
889.                 {
890.                     "earliest_book": datetime.date(2007, 12, 6),
891.                     "num_awards": 3,
892.                     "id": self.p1.id,
893.                     "name": "Apress",
894.                 },
895.                 {
896.                     "earliest_book": datetime.date(2008, 3, 3),
897.                     "num_awards": 1,
898.                     "id": self.p2.id,
899.                     "name": "Sams",
900.                 },
901.             ],
902.         )
903. 
904.         vals = Store.objects.aggregate(
905.             Max("friday_night_closing"), Min("original_opening")
906.         )
907.         self.assertEqual(
908.             vals,
909.             {
910.                 "friday_night_closing__max": datetime.time(23, 59, 59),
911.                 "original_opening__min": datetime.datetime(1945, 4, 25, 16, 24, 14),
912.             },
913.         )
914. 
915.     def test_annotate_values_list(self):
916.         books = (
917.             Book.objects.filter(pk=self.b1.pk)
918.             .annotate(mean_age=Avg("authors__age"))
919.             .values_list("pk", "isbn", "mean_age")
920.         )
921.         self.assertEqual(list(books), [(self.b1.id, "159059725", 34.5)])
922. 
923.         books = (
924.             Book.objects.filter(pk=self.b1.pk)
925.             .annotate(mean_age=Avg("authors__age"))
926.             .values_list("isbn")
927.         )
928.         self.assertEqual(list(books), [("159059725",)])
929. 
930.         books = (
931.             Book.objects.filter(pk=self.b1.pk)
932.             .annotate(mean_age=Avg("authors__age"))
933.             .values_list("mean_age")
934.         )
935.         self.assertEqual(list(books), [(34.5,)])
936. 
937.         books = (
938.             Book.objects.filter(pk=self.b1.pk)
939.             .annotate(mean_age=Avg("authors__age"))
940.             .values_list("mean_age", flat=True)
941.         )
942.         self.assertEqual(list(books), [34.5])
943. 
944.         books = (
945.             Book.objects.values_list("price")
946.             .annotate(count=Count("price"))
947.             .order_by("-count", "price")
948.         )
949.         self.assertEqual(
950.             list(books),
951.             [
952.                 (Decimal("29.69"), 2),
953.                 (Decimal("23.09"), 1),
954.                 (Decimal("30"), 1),
955.                 (Decimal("75"), 1),
956.                 (Decimal("82.8"), 1),
957.             ],
958.         )
959. 
960.     def test_dates_with_aggregation(self):
961.         """
962.         .dates() returns a distinct set of dates when applied to a
963.         QuerySet with aggregation.
964. 
965.         Refs #18056. Previously, .dates() would return distinct (date_kind,
966.         aggregation) sets, in this case (year, num_authors), so 2008 would be
967.         returned twice because there are books from 2008 with a different
968.         number of authors.
969.         """
970.         dates = Book.objects.annotate(num_authors=Count("authors")).dates(
971.             "pubdate", "year"
972.         )
973.         self.assertSequenceEqual(
974.             dates,
975.             [
976.                 datetime.date(1991, 1, 1),
977.                 datetime.date(1995, 1, 1),
978.                 datetime.date(2007, 1, 1),
979.                 datetime.date(2008, 1, 1),
980.             ],
981.         )
982. 
983.     def test_values_aggregation(self):
984.         # Refs #20782
985.         max_rating = Book.objects.values("rating").aggregate(max_rating=Max("rating"))
986.         self.assertEqual(max_rating["max_rating"], 5)
987.         max_books_per_rating = (
988.             Book.objects.values("rating")
989.             .annotate(books_per_rating=Count("id"))
990.             .aggregate(Max("books_per_rating"))
991.         )
992.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3})
993. 
994.     def test_ticket17424(self):
995.         """
996.         Doing exclude() on a foreign model after annotate() doesn't crash.
997.         """
998.         all_books = list(Book.objects.values_list("pk", flat=True).order_by("pk"))
999.         annotated_books = Book.objects.order_by("pk").annotate(one=Count("id"))
1000. 
1001.         # The value doesn't matter, we just need any negative
1002.         # constraint on a related model that's a noop.
1003.         excluded_books = annotated_books.exclude(publisher__name="__UNLIKELY_VALUE__")
1004. 
1005.         # Try to generate query tree
1006.         str(excluded_books.query)
1007. 
1008.         self.assertQuerySetEqual(excluded_books, all_books, lambda x: x.pk)
1009. 
1010.         # Check internal state
1011.         self.assertIsNone(annotated_books.query.alias_map["aggregation_book"].join_type)
1012.         self.assertIsNone(excluded_books.query.alias_map["aggregation_book"].join_type)
1013. 
1014.     def test_ticket12886(self):
1015.         """
1016.         Aggregation over sliced queryset works correctly.
1017.         """
1018.         qs = Book.objects.order_by("-rating")[0:3]
1019.         vals = qs.aggregate(average_top3_rating=Avg("rating"))["average_top3_rating"]
1020.         self.assertAlmostEqual(vals, 4.5, places=2)
1021. 
1022.     def test_ticket11881(self):
1023.         """
1024.         Subqueries do not needlessly contain ORDER BY, SELECT FOR UPDATE or
1025.         select_related() stuff.
1026.         """
1027.         qs = (
1028.             Book.objects.select_for_update()
1029.             .order_by("pk")
1030.             .select_related("publisher")
1031.             .annotate(max_pk=Max("pk"))
1032.         )
1033.         with CaptureQueriesContext(connection) as captured_queries:
1034.             qs.aggregate(avg_pk=Avg("max_pk"))
1035.             self.assertEqual(len(captured_queries), 1)
1036.             qstr = captured_queries[0]["sql"].lower()
1037.             self.assertNotIn("for update", qstr)
1038.             forced_ordering = connection.ops.force_no_ordering()
1039.             if forced_ordering:
1040.                 # If the backend needs to force an ordering we make sure it's
1041.                 # the only "ORDER BY" clause present in the query.
1042.                 self.assertEqual(
1043.                     re.findall(r"order by (\w+)", qstr),
1044.                     [", ".join(f[1][0] for f in forced_ordering).lower()],
1045.                 )
1046.             else:
1047.                 self.assertNotIn("order by", qstr)
1048.             self.assertEqual(qstr.count(" join "), 0)
1049. 
1050.     def test_decimal_max_digits_has_no_effect(self):
1051.         Book.objects.all().delete()
1052.         a1 = Author.objects.first()
1053.         p1 = Publisher.objects.first()
1054.         thedate = timezone.now()
1055.         for i in range(10):
1056.             Book.objects.create(
1057.                 isbn="abcde{}".format(i),
1058.                 name="none",
1059.                 pages=10,
1060.                 rating=4.0,
1061.                 price=9999.98,
1062.                 contact=a1,
1063.                 publisher=p1,
1064.                 pubdate=thedate,
1065.             )
1066. 
1067.         book = Book.objects.aggregate(price_sum=Sum("price"))
1068.         self.assertEqual(book["price_sum"], Decimal("99999.80"))
1069. 
1070.     def test_nonaggregate_aggregation_throws(self):
1071.         with self.assertRaisesMessage(TypeError, "fail is not an aggregate expression"):
1072.             Book.objects.aggregate(fail=F("price"))
1073. 
1074.     def test_nonfield_annotation(self):
1075.         book = Book.objects.annotate(val=Max(Value(2))).first()
1076.         self.assertEqual(book.val, 2)
1077.         book = Book.objects.annotate(
1078.             val=Max(Value(2), output_field=IntegerField())
1079.         ).first()
1080.         self.assertEqual(book.val, 2)
1081.         book = Book.objects.annotate(val=Max(2, output_field=IntegerField())).first()
1082.         self.assertEqual(book.val, 2)
1083. 
1084.     def test_annotation_expressions(self):
1085.         authors = Author.objects.annotate(
1086.             combined_ages=Sum(F("age") + F("friends__age"))
1087.         ).order_by("name")
1088.         authors2 = Author.objects.annotate(
1089.             combined_ages=Sum("age") + Sum("friends__age")
1090.         ).order_by("name")
1091.         for qs in (authors, authors2):
1092.             self.assertQuerySetEqual(
1093.                 qs,
1094.                 [
1095.                     ("Adrian Holovaty", 132),
1096.                     ("Brad Dayley", None),
1097.                     ("Jacob Kaplan-Moss", 129),
1098.                     ("James Bennett", 63),
1099.                     ("Jeffrey Forcier", 128),
1100.                     ("Paul Bissex", 120),
1101.                     ("Peter Norvig", 103),
1102.                     ("Stuart Russell", 103),
1103.                     ("Wesley J. Chun", 176),
1104.                 ],
1105.                 lambda a: (a.name, a.combined_ages),
1106.             )
1107. 
1108.     def test_aggregation_expressions(self):
1109.         a1 = Author.objects.aggregate(av_age=Sum("age") / Count("*"))
1110.         a2 = Author.objects.aggregate(av_age=Sum("age") / Count("age"))
1111.         a3 = Author.objects.aggregate(av_age=Avg("age"))
1112.         self.assertEqual(a1, {"av_age": 37})
1113.         self.assertEqual(a2, {"av_age": 37})
1114.         self.assertEqual(a3, {"av_age": Approximate(37.4, places=1)})
1115. 
1116.     def test_avg_decimal_field(self):
1117.         v = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price")))[
1118.             "avg_price"
1119.         ]
1120.         self.assertIsInstance(v, Decimal)
1121.         self.assertEqual(v, Approximate(Decimal("47.39"), places=2))
1122. 
1123.     def test_order_of_precedence(self):
1124.         p1 = Book.objects.filter(rating=4).aggregate(avg_price=(Avg("price") + 2) * 3)
1125.         self.assertEqual(p1, {"avg_price": Approximate(Decimal("148.18"), places=2)})
1126. 
1127.         p2 = Book.objects.filter(rating=4).aggregate(avg_price=Avg("price") + 2 * 3)
1128.         self.assertEqual(p2, {"avg_price": Approximate(Decimal("53.39"), places=2)})
1129. 
1130.     def test_combine_different_types(self):
1131.         msg = (
1132.             "Cannot infer type of '+' expression involving these types: FloatField, "
1133.             "DecimalField. You must set output_field."
1134.         )
1135.         qs = Book.objects.annotate(sums=Sum("rating") + Sum("pages") + Sum("price"))
1136.         with self.assertRaisesMessage(FieldError, msg):
1137.             qs.first()
1138.         with self.assertRaisesMessage(FieldError, msg):
1139.             qs.first()
1140. 
1141.         b1 = Book.objects.annotate(
1142.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=IntegerField())
1143.         ).get(pk=self.b4.pk)
1144.         self.assertEqual(b1.sums, 383)
1145. 
1146.         b2 = Book.objects.annotate(
1147.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=FloatField())
1148.         ).get(pk=self.b4.pk)
1149.         self.assertEqual(b2.sums, 383.69)
1150. 
1151.         b3 = Book.objects.annotate(
1152.             sums=Sum(F("rating") + F("pages") + F("price"), output_field=DecimalField())
1153.         ).get(pk=self.b4.pk)
1154.         self.assertEqual(b3.sums, Approximate(Decimal("383.69"), places=2))
1155. 
1156.     def test_complex_aggregations_require_kwarg(self):
1157.         with self.assertRaisesMessage(
1158.             TypeError, "Complex annotations require an alias"
1159.         ):
1160.             Author.objects.annotate(Sum(F("age") + F("friends__age")))
1161.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1162.             Author.objects.aggregate(Sum("age") / Count("age"))
1163.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1164.             Author.objects.aggregate(Sum(1))
1165. 
1166.     def test_aggregate_over_complex_annotation(self):
1167.         qs = Author.objects.annotate(combined_ages=Sum(F("age") + F("friends__age")))
1168. 
1169.         age = qs.aggregate(max_combined_age=Max("combined_ages"))
1170.         self.assertEqual(age["max_combined_age"], 176)
1171. 
1172.         age = qs.aggregate(max_combined_age_doubled=Max("combined_ages") * 2)
1173.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1174. 
1175.         age = qs.aggregate(
1176.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages")
1177.         )
1178.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1179. 
1180.         age = qs.aggregate(
1181.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1182.             sum_combined_age=Sum("combined_ages"),
1183.         )
1184.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1185.         self.assertEqual(age["sum_combined_age"], 954)
1186. 
1187.         age = qs.aggregate(
1188.             max_combined_age_doubled=Max("combined_ages") + Max("combined_ages"),
1189.             sum_combined_age_doubled=Sum("combined_ages") + Sum("combined_ages"),
1190.         )
1191.         self.assertEqual(age["max_combined_age_doubled"], 176 * 2)
1192.         self.assertEqual(age["sum_combined_age_doubled"], 954 * 2)
1193. 
1194.     def test_values_annotation_with_expression(self):
1195.         # ensure the F() is promoted to the group by clause
1196.         qs = Author.objects.values("name").annotate(another_age=Sum("age") + F("age"))
1197.         a = qs.get(name="Adrian Holovaty")
1198.         self.assertEqual(a["another_age"], 68)
1199. 
1200.         qs = qs.annotate(friend_count=Count("friends"))
1201.         a = qs.get(name="Adrian Holovaty")
1202.         self.assertEqual(a["friend_count"], 2)
1203. 
1204.         qs = (
1205.             qs.annotate(combined_age=Sum("age") + F("friends__age"))
1206.             .filter(name="Adrian Holovaty")
1207.             .order_by("-combined_age")
1208.         )
1209.         self.assertEqual(
1210.             list(qs),
1211.             [
1212.                 {
1213.                     "name": "Adrian Holovaty",
1214.                     "another_age": 68,
1215.                     "friend_count": 1,
1216.                     "combined_age": 69,
1217.                 },
1218.                 {
1219.                     "name": "Adrian Holovaty",
1220.                     "another_age": 68,
1221.                     "friend_count": 1,
1222.                     "combined_age": 63,
1223.                 },
1224.             ],
1225.         )
1226. 
1227.         vals = qs.values("name", "combined_age")
1228.         self.assertEqual(
1229.             list(vals),
1230.             [
1231.                 {"name": "Adrian Holovaty", "combined_age": 69},
1232.                 {"name": "Adrian Holovaty", "combined_age": 63},
1233.             ],
1234.         )
1235. 
1236.     def test_annotate_values_aggregate(self):
1237.         alias_age = (
1238.             Author.objects.annotate(age_alias=F("age"))
1239.             .values(
1240.                 "age_alias",
1241.             )
1242.             .aggregate(sum_age=Sum("age_alias"))
1243.         )
1244. 
1245.         age = Author.objects.values("age").aggregate(sum_age=Sum("age"))
1246. 
1247.         self.assertEqual(alias_age["sum_age"], age["sum_age"])
1248. 
1249.     def test_annotate_over_annotate(self):
1250.         author = (
1251.             Author.objects.annotate(age_alias=F("age"))
1252.             .annotate(sum_age=Sum("age_alias"))
1253.             .get(name="Adrian Holovaty")
1254.         )
1255. 
1256.         other_author = Author.objects.annotate(sum_age=Sum("age")).get(
1257.             name="Adrian Holovaty"
1258.         )
1259. 
1260.         self.assertEqual(author.sum_age, other_author.sum_age)
1261. 
1262.     def test_aggregate_over_aggregate(self):
1263.         msg = "Cannot compute Avg('age_agg'): 'age_agg' is an aggregate"
1264.         with self.assertRaisesMessage(FieldError, msg):
1265.             Author.objects.aggregate(
1266.                 age_agg=Sum(F("age")),
1267.                 avg_age=Avg(F("age_agg")),
1268.             )
1269. 
1270.     def test_annotated_aggregate_over_annotated_aggregate(self):
1271.         with self.assertRaisesMessage(
1272.             FieldError, "Cannot compute Sum('id__max'): 'id__max' is an aggregate"
1273.         ):
1274.             Book.objects.annotate(Max("id")).annotate(Sum("id__max"))
1275. 
1276.         class MyMax(Max):
1277.             def as_sql(self, compiler, connection):
1278.                 self.set_source_expressions(self.get_source_expressions()[0:1])
1279.                 return super().as_sql(compiler, connection)
1280. 
1281.         with self.assertRaisesMessage(
1282.             FieldError, "Cannot compute Max('id__max'): 'id__max' is an aggregate"
1283.         ):
1284.             Book.objects.annotate(Max("id")).annotate(my_max=MyMax("id__max", "price"))
1285. 
1286.     def test_multi_arg_aggregate(self):
1287.         class MyMax(Max):
1288.             output_field = DecimalField()
1289. 
1290.             def as_sql(self, compiler, connection):
1291.                 copy = self.copy()
1292.                 copy.set_source_expressions(copy.get_source_expressions()[0:1])
1293.                 return super(MyMax, copy).as_sql(compiler, connection)
1294. 
1295.         with self.assertRaisesMessage(TypeError, "Complex aggregates require an alias"):
1296.             Book.objects.aggregate(MyMax("pages", "price"))
1297. 
1298.         with self.assertRaisesMessage(
1299.             TypeError, "Complex annotations require an alias"
1300.         ):
1301.             Book.objects.annotate(MyMax("pages", "price"))
1302. 
1303.         Book.objects.aggregate(max_field=MyMax("pages", "price"))
1304. 
1305.     def test_add_implementation(self):
1306.         class MySum(Sum):
1307.             pass
1308. 
1309.         # test completely changing how the output is rendered
1310.         def lower_case_function_override(self, compiler, connection):
1311.             sql, params = compiler.compile(self.source_expressions[0])
1312.             substitutions = {
1313.                 "function": self.function.lower(),
1314.                 "expressions": sql,
1315.                 "distinct": "",
1316.             }
1317.             substitutions.update(self.extra)
1318.             return self.template % substitutions, params
1319. 
1320.         setattr(MySum, "as_" + connection.vendor, lower_case_function_override)
1321. 
1322.         qs = Book.objects.annotate(
1323.             sums=MySum(
1324.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1325.             )
1326.         )
1327.         self.assertEqual(str(qs.query).count("sum("), 1)
1328.         b1 = qs.get(pk=self.b4.pk)
1329.         self.assertEqual(b1.sums, 383)
1330. 
1331.         # test changing the dict and delegating
1332.         def lower_case_function_super(self, compiler, connection):
1333.             self.extra["function"] = self.function.lower()
1334.             return super(MySum, self).as_sql(compiler, connection)
1335. 
1336.         setattr(MySum, "as_" + connection.vendor, lower_case_function_super)
1337. 
1338.         qs = Book.objects.annotate(
1339.             sums=MySum(
1340.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1341.             )
1342.         )
1343.         self.assertEqual(str(qs.query).count("sum("), 1)
1344.         b1 = qs.get(pk=self.b4.pk)
1345.         self.assertEqual(b1.sums, 383)
1346. 
1347.         # test overriding all parts of the template
1348.         def be_evil(self, compiler, connection):
1349.             substitutions = {"function": "MAX", "expressions": "2", "distinct": ""}
1350.             substitutions.update(self.extra)
1351.             return self.template % substitutions, ()
1352. 
1353.         setattr(MySum, "as_" + connection.vendor, be_evil)
1354. 
1355.         qs = Book.objects.annotate(
1356.             sums=MySum(
1357.                 F("rating") + F("pages") + F("price"), output_field=IntegerField()
1358.             )
1359.         )
1360.         self.assertEqual(str(qs.query).count("MAX("), 1)
1361.         b1 = qs.get(pk=self.b4.pk)
1362.         self.assertEqual(b1.sums, 2)
1363. 
1364.     def test_complex_values_aggregation(self):
1365.         max_rating = Book.objects.values("rating").aggregate(
1366.             double_max_rating=Max("rating") + Max("rating")
1367.         )
1368.         self.assertEqual(max_rating["double_max_rating"], 5 * 2)
1369. 
1370.         max_books_per_rating = (
1371.             Book.objects.values("rating")
1372.             .annotate(books_per_rating=Count("id") + 5)
1373.             .aggregate(Max("books_per_rating"))
1374.         )
1375.         self.assertEqual(max_books_per_rating, {"books_per_rating__max": 3 + 5})
1376. 
1377.     def test_expression_on_aggregation(self):
1378.         qs = (
1379.             Publisher.objects.annotate(
1380.                 price_or_median=Greatest(
1381.                     Avg("book__rating", output_field=DecimalField()), Avg("book__price")
1382.                 )
1383.             )
1384.             .filter(price_or_median__gte=F("num_awards"))
1385.             .order_by("num_awards")
1386.         )
1387.         self.assertQuerySetEqual(qs, [1, 3, 7, 9], lambda v: v.num_awards)
1388. 
1389.         qs2 = (
1390.             Publisher.objects.annotate(
1391.                 rating_or_num_awards=Greatest(
1392.                     Avg("book__rating"), F("num_awards"), output_field=FloatField()
1393.                 )
1394.             )
1395.             .filter(rating_or_num_awards__gt=F("num_awards"))
1396.             .order_by("num_awards")
1397.         )
1398.         self.assertQuerySetEqual(qs2, [1, 3], lambda v: v.num_awards)
1399. 
1400.     def test_arguments_must_be_expressions(self):
1401.         msg = "QuerySet.aggregate() received non-expression(s): %s."
1402.         with self.assertRaisesMessage(TypeError, msg % FloatField()):
1403.             Book.objects.aggregate(FloatField())
1404.         with self.assertRaisesMessage(TypeError, msg % True):
1405.             Book.objects.aggregate(is_book=True)
1406.         with self.assertRaisesMessage(
1407.             TypeError, msg % ", ".join([str(FloatField()), "True"])
1408.         ):
1409.             Book.objects.aggregate(FloatField(), Avg("price"), is_book=True)
1410. 
1411.     def test_aggregation_subquery_annotation(self):
1412.         """Subquery annotations are excluded from the GROUP BY if they are
1413.         not explicitly grouped against."""
1414.         latest_book_pubdate_qs = (
1415.             Book.objects.filter(publisher=OuterRef("pk"))
1416.             .order_by("-pubdate")
1417.             .values("pubdate")[:1]
1418.         )
1419.         publisher_qs = Publisher.objects.annotate(
1420.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1421.         ).annotate(count=Count("book"))
1422.         with self.assertNumQueries(1) as ctx:
1423.             list(publisher_qs)
1424.         self.assertEqual(ctx[0]["sql"].count("SELECT"), 2)
1425.         # The GROUP BY should not be by alias either.
1426.         self.assertEqual(ctx[0]["sql"].lower().count("latest_book_pubdate"), 1)
1427. 
1428.     def test_aggregation_subquery_annotation_exists(self):
1429.         latest_book_pubdate_qs = (
1430.             Book.objects.filter(publisher=OuterRef("pk"))
1431.             .order_by("-pubdate")
1432.             .values("pubdate")[:1]
1433.         )
1434.         publisher_qs = Publisher.objects.annotate(
1435.             latest_book_pubdate=Subquery(latest_book_pubdate_qs),
1436.             count=Count("book"),
1437.         )
1438.         self.assertTrue(publisher_qs.exists())
1439. 
1440.     def test_aggregation_filter_exists(self):
1441.         publishers_having_more_than_one_book_qs = (
1442.             Book.objects.values("publisher")
1443.             .annotate(cnt=Count("isbn"))
1444.             .filter(cnt__gt=1)
1445.         )
1446.         query = publishers_having_more_than_one_book_qs.query.exists()
1447.         _, _, group_by = query.get_compiler(connection=connection).pre_sql_setup()
1448.         self.assertEqual(len(group_by), 1)
1449. 
1450.     def test_aggregation_exists_annotation(self):
1451.         published_books = Book.objects.filter(publisher=OuterRef("pk"))
1452.         publisher_qs = Publisher.objects.annotate(
1453.             published_book=Exists(published_books),
1454.             count=Count("book"),
1455.         ).values_list("name", flat=True)
1456.         self.assertCountEqual(
1457.             list(publisher_qs),
1458.             [
1459.                 "Apress",
1460.                 "Morgan Kaufmann",
1461.                 "Jonno's House of Books",
1462.                 "Prentice Hall",
1463.                 "Sams",
1464.             ],
1465.         )
1466. 
1467.     def test_aggregation_subquery_annotation_values(self):
1468.         """
1469.         Subquery annotations and external aliases are excluded from the GROUP
1470.         BY if they are not selected.
1471.         """
1472.         books_qs = (
1473.             Book.objects.annotate(
1474.                 first_author_the_same_age=Subquery(
1475.                     Author.objects.filter(
1476.                         age=OuterRef("contact__friends__age"),
1477.                     )
1478.                     .order_by("age")
1479.                     .values("id")[:1],
1480.                 )
1481.             )
1482.             .filter(
1483.                 publisher=self.p1,
1484.                 first_author_the_same_age__isnull=False,
1485.             )
1486.             .annotate(
1487.                 min_age=Min("contact__friends__age"),
1488.             )
1489.             .values("name", "min_age")
1490.             .order_by("name")
1491.         )
1492.         self.assertEqual(
1493.             list(books_qs),
1494.             [
1495.                 {"name": "Practical Django Projects", "min_age": 34},
1496.                 {
1497.                     "name": (
1498.                         "The Definitive Guide to Django: Web Development Done Right"
1499.                     ),
1500.                     "min_age": 29,
1501.                 },
1502.             ],
1503.         )
1504. 
1505.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1506.     def test_aggregation_subquery_annotation_values_collision(self):
1507.         books_rating_qs = Book.objects.filter(
1508.             pk=OuterRef("book"),
1509.         ).values("rating")
1510.         publisher_qs = (
1511.             Publisher.objects.filter(
1512.                 book__contact__age__gt=20,
1513.             )
1514.             .annotate(
1515.                 rating=Subquery(books_rating_qs),
1516.             )
1517.             .values("rating")
1518.             .annotate(total_count=Count("*"))
1519.             .order_by("rating")
1520.         )
1521.         self.assertEqual(
1522.             list(publisher_qs),
1523.             [
1524.                 {"rating": 3.0, "total_count": 1},
1525.                 {"rating": 4.0, "total_count": 3},
1526.                 {"rating": 4.5, "total_count": 1},
1527.                 {"rating": 5.0, "total_count": 1},
1528.             ],
1529.         )
1530. 
1531.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1532.     def test_aggregation_subquery_annotation_multivalued(self):
1533.         """
1534.         Subquery annotations must be included in the GROUP BY if they use
1535.         potentially multivalued relations (contain the LOOKUP_SEP).
1536.         """
1537.         subquery_qs = Author.objects.filter(
1538.             pk=OuterRef("pk"),
1539.             book__name=OuterRef("book__name"),
1540.         ).values("pk")
1541.         author_qs = Author.objects.annotate(
1542.             subquery_id=Subquery(subquery_qs),
1543.         ).annotate(count=Count("book"))
1544.         self.assertEqual(author_qs.count(), Author.objects.count())
1545. 
1546.     def test_aggregation_order_by_not_selected_annotation_values(self):
1547.         result_asc = [
1548.             self.b4.pk,
1549.             self.b3.pk,
1550.             self.b1.pk,
1551.             self.b2.pk,
1552.             self.b5.pk,
1553.             self.b6.pk,
1554.         ]
1555.         result_desc = result_asc[::-1]
1556.         tests = [
1557.             ("min_related_age", result_asc),
1558.             ("-min_related_age", result_desc),
1559.             (F("min_related_age"), result_asc),
1560.             (F("min_related_age").asc(), result_asc),
1561.             (F("min_related_age").desc(), result_desc),
1562.         ]
1563.         for ordering, expected_result in tests:
1564.             with self.subTest(ordering=ordering):
1565.                 books_qs = (
1566.                     Book.objects.annotate(
1567.                         min_age=Min("authors__age"),
1568.                     )
1569.                     .annotate(
1570.                         min_related_age=Coalesce("min_age", "contact__age"),
1571.                     )
1572.                     .order_by(ordering)
1573.                     .values_list("pk", flat=True)
1574.                 )
1575.                 self.assertEqual(list(books_qs), expected_result)
1576. 
1577.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1578.     def test_group_by_subquery_annotation(self):
1579.         """
1580.         Subquery annotations are included in the GROUP BY if they are
1581.         grouped against.
1582.         """
1583.         long_books_count_qs = (
1584.             Book.objects.filter(
1585.                 publisher=OuterRef("pk"),
1586.                 pages__gt=400,
1587.             )
1588.             .values("publisher")
1589.             .annotate(count=Count("pk"))
1590.             .values("count")
1591.         )
1592.         groups = [
1593.             Subquery(long_books_count_qs),
1594.             long_books_count_qs,
1595.             long_books_count_qs.query,
1596.         ]
1597.         for group in groups:
1598.             with self.subTest(group=group.__class__.__name__):
1599.                 long_books_count_breakdown = Publisher.objects.values_list(
1600.                     group,
1601.                 ).annotate(total=Count("*"))
1602.                 self.assertEqual(dict(long_books_count_breakdown), {None: 1, 1: 4})
1603. 
1604.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1605.     def test_group_by_exists_annotation(self):
1606.         """
1607.         Exists annotations are included in the GROUP BY if they are
1608.         grouped against.
1609.         """
1610.         long_books_qs = Book.objects.filter(
1611.             publisher=OuterRef("pk"),
1612.             pages__gt=800,
1613.         )
1614.         has_long_books_breakdown = Publisher.objects.values_list(
1615.             Exists(long_books_qs),
1616.         ).annotate(total=Count("*"))
1617.         self.assertEqual(dict(has_long_books_breakdown), {True: 2, False: 3})
1618. 
1619.     def test_group_by_nested_expression_with_params(self):
1620.         books_qs = (
1621.             Book.objects.annotate(greatest_pages=Greatest("pages", Value(600)))
1622.             .values(
1623.                 "greatest_pages",
1624.             )
1625.             .annotate(
1626.                 min_pages=Min("pages"),
1627.                 least=Least("min_pages", "greatest_pages"),
1628.             )
1629.             .values_list("least", flat=True)
1630.         )
1631.         self.assertCountEqual(books_qs, [300, 946, 1132])
1632. 
1633.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1634.     def test_aggregation_subquery_annotation_related_field(self):
1635.         publisher = Publisher.objects.create(name=self.a9.name, num_awards=2)
1636.         book = Book.objects.create(
1637.             isbn="159059999",
1638.             name="Test book.",
1639.             pages=819,
1640.             rating=2.5,
1641.             price=Decimal("14.44"),
1642.             contact=self.a9,
1643.             publisher=publisher,
1644.             pubdate=datetime.date(2019, 12, 6),
1645.         )
1646.         book.authors.add(self.a5, self.a6, self.a7)
1647.         books_qs = (
1648.             Book.objects.annotate(
1649.                 contact_publisher=Subquery(
1650.                     Publisher.objects.filter(
1651.                         pk=OuterRef("publisher"),
1652.                         name=OuterRef("contact__name"),
1653.                     ).values("name")[:1],
1654.                 )
1655.             )
1656.             .filter(
1657.                 contact_publisher__isnull=False,
1658.             )
1659.             .annotate(count=Count("authors"))
1660.         )
1661.         with self.assertNumQueries(1) as ctx:
1662.             self.assertSequenceEqual(books_qs, [book])
1663.         if connection.features.allows_group_by_select_index:
1664.             self.assertEqual(ctx[0]["sql"].count("SELECT"), 3)
1665. 
1666.     @skipUnlessDBFeature("supports_subqueries_in_group_by")
1667.     def test_aggregation_nested_subquery_outerref(self):
1668.         publisher_with_same_name = Publisher.objects.filter(
1669.             id__in=Subquery(
1670.                 Publisher.objects.filter(
1671.                     name=OuterRef(OuterRef("publisher__name")),
1672.                 ).values("id"),
1673.             ),
1674.         ).values(publisher_count=Count("id"))[:1]
1675.         books_breakdown = Book.objects.annotate(
1676.             publisher_count=Subquery(publisher_with_same_name),
1677.             authors_count=Count("authors"),
1678.         ).values_list("publisher_count", flat=True)
1679.         self.assertSequenceEqual(books_breakdown, [1] * 6)
1680. 
1681.     def test_aggregation_exists_multivalued_outeref(self):
1682.         self.assertCountEqual(
1683.             Publisher.objects.annotate(
1684.                 books_exists=Exists(
1685.                     Book.objects.filter(publisher=OuterRef("book__publisher"))
1686.                 ),
1687.                 books_count=Count("book"),
1688.             ),
1689.             Publisher.objects.all(),
1690.         )
1691. 
1692.     def test_filter_in_subquery_or_aggregation(self):
1693.         """
1694.         Filtering against an aggregate requires the usage of the HAVING clause.
1695. 
1696.         If such a filter is unionized to a non-aggregate one the latter will
1697.         also need to be moved to the HAVING clause and have its grouping
1698.         columns used in the GROUP BY.
1699. 
1700.         When this is done with a subquery the specialized logic in charge of
1701.         using outer reference columns to group should be used instead of the
1702.         subquery itself as the latter might return multiple rows.
1703.         """
1704.         authors = Author.objects.annotate(
1705.             Count("book"),
1706.         ).filter(Q(book__count__gt=0) | Q(pk__in=Book.objects.values("authors")))
1707.         self.assertCountEqual(authors, Author.objects.all())
1708. 
1709.     def test_aggregation_random_ordering(self):
1710.         """Random() is not included in the GROUP BY when used for ordering."""
1711.         authors = Author.objects.annotate(contact_count=Count("book")).order_by("?")
1712.         self.assertQuerySetEqual(
1713.             authors,
1714.             [
1715.                 ("Adrian Holovaty", 1),
1716.                 ("Jacob Kaplan-Moss", 1),
1717.                 ("Brad Dayley", 1),
1718.                 ("James Bennett", 1),
1719.                 ("Jeffrey Forcier", 1),
1720.                 ("Paul Bissex", 1),
1721.                 ("Wesley J. Chun", 1),
1722.                 ("Stuart Russell", 1),
1723.                 ("Peter Norvig", 2),
1724.             ],
1725.             lambda a: (a.name, a.contact_count),
1726.             ordered=False,
1727.         )
1728. 
1729.     def test_empty_result_optimization(self):
1730.         with self.assertNumQueries(0):
1731.             self.assertEqual(
1732.                 Publisher.objects.none().aggregate(
1733.                     sum_awards=Sum("num_awards"),
1734.                     books_count=Count("book"),
1735.                 ),
1736.                 {
1737.                     "sum_awards": None,
1738.                     "books_count": 0,
1739.                 },
1740.             )
1741.         # Expression without empty_result_set_value forces queries to be
1742.         # executed even if they would return an empty result set.
1743.         raw_books_count = Func("book", function="COUNT")
1744.         raw_books_count.contains_aggregate = True
1745.         with self.assertNumQueries(1):
1746.             self.assertEqual(
1747.                 Publisher.objects.none().aggregate(
1748.                     sum_awards=Sum("num_awards"),
1749.                     books_count=raw_books_count,
1750.                 ),
1751.                 {
1752.                     "sum_awards": None,
1753.                     "books_count": 0,
1754.                 },
1755.             )
1756. 
1757.     def test_coalesced_empty_result_set(self):
1758.         with self.assertNumQueries(0):
1759.             self.assertEqual(
1760.                 Publisher.objects.none().aggregate(
1761.                     sum_awards=Coalesce(Sum("num_awards"), 0),
1762.                 )["sum_awards"],
1763.                 0,
1764.             )
1765.         # Multiple expressions.
1766.         with self.assertNumQueries(0):
1767.             self.assertEqual(
1768.                 Publisher.objects.none().aggregate(
1769.                     sum_awards=Coalesce(Sum("num_awards"), None, 0),
1770.                 )["sum_awards"],
1771.                 0,
1772.             )
1773.         # Nested coalesce.
1774.         with self.assertNumQueries(0):
1775.             self.assertEqual(
1776.                 Publisher.objects.none().aggregate(
1777.                     sum_awards=Coalesce(Coalesce(Sum("num_awards"), None), 0),
1778.                 )["sum_awards"],
1779.                 0,
1780.             )
1781.         # Expression coalesce.
1782.         with self.assertNumQueries(1):
1783.             self.assertIsInstance(
1784.                 Store.objects.none().aggregate(
1785.                     latest_opening=Coalesce(
1786.                         Max("original_opening"),
1787.                         RawSQL("CURRENT_TIMESTAMP", []),
1788.                     ),
1789.                 )["latest_opening"],
1790.                 datetime.datetime,
1791.             )
1792. 
1793.     def test_aggregation_default_unsupported_by_count(self):
1794.         msg = "Count does not allow default."
1795.         with self.assertRaisesMessage(TypeError, msg):
1796.             Count("age", default=0)
1797. 
1798.     def test_aggregation_default_unset(self):
1799.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1800.             with self.subTest(Aggregate):
1801.                 result = Author.objects.filter(age__gt=100).aggregate(
1802.                     value=Aggregate("age"),
1803.                 )
1804.                 self.assertIsNone(result["value"])
1805. 
1806.     def test_aggregation_default_zero(self):
1807.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1808.             with self.subTest(Aggregate):
1809.                 result = Author.objects.filter(age__gt=100).aggregate(
1810.                     value=Aggregate("age", default=0),
1811.                 )
1812.                 self.assertEqual(result["value"], 0)
1813. 
1814.     def test_aggregation_default_integer(self):
1815.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1816.             with self.subTest(Aggregate):
1817.                 result = Author.objects.filter(age__gt=100).aggregate(
1818.                     value=Aggregate("age", default=21),
1819.                 )
1820.                 self.assertEqual(result["value"], 21)
1821. 
1822.     def test_aggregation_default_expression(self):
1823.         for Aggregate in [Avg, Max, Min, StdDev, Sum, Variance]:
1824.             with self.subTest(Aggregate):
1825.                 result = Author.objects.filter(age__gt=100).aggregate(
1826.                     value=Aggregate("age", default=Value(5) * Value(7)),
1827.                 )
1828.                 self.assertEqual(result["value"], 35)
1829. 
1830.     def test_aggregation_default_group_by(self):
1831.         qs = (
1832.             Publisher.objects.values("name")
1833.             .annotate(
1834.                 books=Count("book"),
1835.                 pages=Sum("book__pages", default=0),
1836.             )
1837.             .filter(books=0)
1838.         )
1839.         self.assertSequenceEqual(
1840.             qs,
1841.             [{"name": "Jonno's House of Books", "books": 0, "pages": 0}],
1842.         )
1843. 
1844.     def test_aggregation_default_compound_expression(self):
1845.         # Scale rating to a percentage; default to 50% if no books published.
1846.         formula = Avg("book__rating", default=2.5) * 20.0
1847.         queryset = Publisher.objects.annotate(rating=formula).order_by("name")
1848.         self.assertSequenceEqual(
1849.             queryset.values("name", "rating"),
1850.             [
1851.                 {"name": "Apress", "rating": 85.0},
1852.                 {"name": "Jonno's House of Books", "rating": 50.0},
1853.                 {"name": "Morgan Kaufmann", "rating": 100.0},
1854.                 {"name": "Prentice Hall", "rating": 80.0},
1855.                 {"name": "Sams", "rating": 60.0},
1856.             ],
1857.         )
1858. 
1859.     def test_aggregation_default_using_time_from_python(self):
1860.         expr = Min(
1861.             "store__friday_night_closing",
1862.             filter=~Q(store__name="Amazon.com"),
1863.             default=datetime.time(17),
1864.         )
1865.         if connection.vendor == "mysql":
1866.             # Workaround for #30224 for MySQL & MariaDB.
1867.             expr.default = Cast(expr.default, TimeField())
1868.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1869.         self.assertSequenceEqual(
1870.             queryset.values("isbn", "oldest_store_opening"),
1871.             [
1872.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1873.                 {
1874.                     "isbn": "013790395",
1875.                     "oldest_store_opening": datetime.time(23, 59, 59),
1876.                 },
1877.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(17)},
1878.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1879.                 {
1880.                     "isbn": "159059725",
1881.                     "oldest_store_opening": datetime.time(23, 59, 59),
1882.                 },
1883.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1884.             ],
1885.         )
1886. 
1887.     def test_aggregation_default_using_time_from_database(self):
1888.         now = timezone.now().astimezone(datetime.timezone.utc)
1889.         expr = Min(
1890.             "store__friday_night_closing",
1891.             filter=~Q(store__name="Amazon.com"),
1892.             default=TruncHour(NowUTC(), output_field=TimeField()),
1893.         )
1894.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1895.         self.assertSequenceEqual(
1896.             queryset.values("isbn", "oldest_store_opening"),
1897.             [
1898.                 {"isbn": "013235613", "oldest_store_opening": datetime.time(21, 30)},
1899.                 {
1900.                     "isbn": "013790395",
1901.                     "oldest_store_opening": datetime.time(23, 59, 59),
1902.                 },
1903.                 {"isbn": "067232959", "oldest_store_opening": datetime.time(now.hour)},
1904.                 {"isbn": "155860191", "oldest_store_opening": datetime.time(21, 30)},
1905.                 {
1906.                     "isbn": "159059725",
1907.                     "oldest_store_opening": datetime.time(23, 59, 59),
1908.                 },
1909.                 {"isbn": "159059996", "oldest_store_opening": datetime.time(21, 30)},
1910.             ],
1911.         )
1912. 
1913.     def test_aggregation_default_using_date_from_python(self):
1914.         expr = Min("book__pubdate", default=datetime.date(1970, 1, 1))
1915.         if connection.vendor == "mysql":
1916.             # Workaround for #30224 for MySQL & MariaDB.
1917.             expr.default = Cast(expr.default, DateField())
1918.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1919.         self.assertSequenceEqual(
1920.             queryset.values("name", "earliest_pubdate"),
1921.             [
1922.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1923.                 {
1924.                     "name": "Jonno's House of Books",
1925.                     "earliest_pubdate": datetime.date(1970, 1, 1),
1926.                 },
1927.                 {
1928.                     "name": "Morgan Kaufmann",
1929.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1930.                 },
1931.                 {
1932.                     "name": "Prentice Hall",
1933.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1934.                 },
1935.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1936.             ],
1937.         )
1938. 
1939.     def test_aggregation_default_using_date_from_database(self):
1940.         now = timezone.now().astimezone(datetime.timezone.utc)
1941.         expr = Min("book__pubdate", default=TruncDate(NowUTC()))
1942.         queryset = Publisher.objects.annotate(earliest_pubdate=expr).order_by("name")
1943.         self.assertSequenceEqual(
1944.             queryset.values("name", "earliest_pubdate"),
1945.             [
1946.                 {"name": "Apress", "earliest_pubdate": datetime.date(2007, 12, 6)},
1947.                 {"name": "Jonno's House of Books", "earliest_pubdate": now.date()},
1948.                 {
1949.                     "name": "Morgan Kaufmann",
1950.                     "earliest_pubdate": datetime.date(1991, 10, 15),
1951.                 },
1952.                 {
1953.                     "name": "Prentice Hall",
1954.                     "earliest_pubdate": datetime.date(1995, 1, 15),
1955.                 },
1956.                 {"name": "Sams", "earliest_pubdate": datetime.date(2008, 3, 3)},
1957.             ],
1958.         )
1959. 
1960.     def test_aggregation_default_using_datetime_from_python(self):
1961.         expr = Min(
1962.             "store__original_opening",
1963.             filter=~Q(store__name="Amazon.com"),
1964.             default=datetime.datetime(1970, 1, 1),
1965.         )
1966.         if connection.vendor == "mysql":
1967.             # Workaround for #30224 for MySQL & MariaDB.
1968.             expr.default = Cast(expr.default, DateTimeField())
1969.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
1970.         self.assertSequenceEqual(
1971.             queryset.values("isbn", "oldest_store_opening"),
1972.             [
1973.                 {
1974.                     "isbn": "013235613",
1975.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1976.                 },
1977.                 {
1978.                     "isbn": "013790395",
1979.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1980.                 },
1981.                 {
1982.                     "isbn": "067232959",
1983.                     "oldest_store_opening": datetime.datetime(1970, 1, 1),
1984.                 },
1985.                 {
1986.                     "isbn": "155860191",
1987.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1988.                 },
1989.                 {
1990.                     "isbn": "159059725",
1991.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
1992.                 },
1993.                 {
1994.                     "isbn": "159059996",
1995.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
1996.                 },
1997.             ],
1998.         )
1999. 
2000.     def test_aggregation_default_using_datetime_from_database(self):
2001.         now = timezone.now().astimezone(datetime.timezone.utc)
2002.         expr = Min(
2003.             "store__original_opening",
2004.             filter=~Q(store__name="Amazon.com"),
2005.             default=TruncHour(NowUTC(), output_field=DateTimeField()),
2006.         )
2007.         queryset = Book.objects.annotate(oldest_store_opening=expr).order_by("isbn")
2008.         self.assertSequenceEqual(
2009.             queryset.values("isbn", "oldest_store_opening"),
2010.             [
2011.                 {
2012.                     "isbn": "013235613",
2013.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2014.                 },
2015.                 {
2016.                     "isbn": "013790395",
2017.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2018.                 },
2019.                 {
2020.                     "isbn": "067232959",
2021.                     "oldest_store_opening": now.replace(
2022.                         minute=0, second=0, microsecond=0, tzinfo=None
2023.                     ),
2024.                 },
2025.                 {
2026.                     "isbn": "155860191",
2027.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2028.                 },
2029.                 {
2030.                     "isbn": "159059725",
2031.                     "oldest_store_opening": datetime.datetime(2001, 3, 15, 11, 23, 37),
2032.                 },
2033.                 {
2034.                     "isbn": "159059996",
2035.                     "oldest_store_opening": datetime.datetime(1945, 4, 25, 16, 24, 14),
2036.                 },
2037.             ],
2038.         )
2039. 
2040.     def test_aggregation_default_using_duration_from_python(self):
2041.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2042.             value=Sum("duration", default=datetime.timedelta(0)),
2043.         )
2044.         self.assertEqual(result["value"], datetime.timedelta(0))
2045. 
2046.     def test_aggregation_default_using_duration_from_database(self):
2047.         result = Publisher.objects.filter(num_awards__gt=3).aggregate(
2048.             value=Sum("duration", default=Now() - Now()),
2049.         )
2050.         self.assertEqual(result["value"], datetime.timedelta(0))
2051. 
2052.     def test_aggregation_default_using_decimal_from_python(self):
2053.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2054.             value=Sum("price", default=Decimal("0.00")),
2055.         )
2056.         self.assertEqual(result["value"], Decimal("0.00"))
2057. 
2058.     def test_aggregation_default_using_decimal_from_database(self):
2059.         result = Book.objects.filter(rating__lt=3.0).aggregate(
2060.             value=Sum("price", default=Pi()),
2061.         )
2062.         self.assertAlmostEqual(result["value"], Decimal.from_float(math.pi), places=6)
2063. 
2064.     def test_aggregation_default_passed_another_aggregate(self):
2065.         result = Book.objects.aggregate(
2066.             value=Sum("price", filter=Q(rating__lt=3.0), default=Avg("pages") / 10.0),
2067.         )
2068.         self.assertAlmostEqual(result["value"], Decimal("61.72"), places=2)
2069. 
2070.     def test_aggregation_default_after_annotation(self):
2071.         result = Publisher.objects.annotate(
2072.             double_num_awards=F("num_awards") * 2,
2073.         ).aggregate(value=Sum("double_num_awards", default=0))
2074.         self.assertEqual(result["value"], 40)
2075. 
2076.     def test_aggregation_default_not_in_aggregate(self):
2077.         result = Publisher.objects.annotate(
2078.             avg_rating=Avg("book__rating", default=2.5),
2079.         ).aggregate(Sum("num_awards"))
2080.         self.assertEqual(result["num_awards__sum"], 20)
2081. 
2082.     def test_exists_none_with_aggregate(self):
2083.         qs = Book.objects.annotate(
2084.             count=Count("id"),
2085.             exists=Exists(Author.objects.none()),
2086.         )
2087.         self.assertEqual(len(qs), 6)
2088. 
2089.     def test_alias_sql_injection(self):
2090.         crafted_alias = """injected_name" from "aggregation_author"; --"""
2091.         msg = (
2092.             "Column aliases cannot contain whitespace characters, quotation marks, "
2093.             "semicolons, or SQL comments."
2094.         )
2095.         with self.assertRaisesMessage(ValueError, msg):
2096.             Author.objects.aggregate(**{crafted_alias: Avg("age")})
2097. 
2098.     def test_exists_extra_where_with_aggregate(self):
2099.         qs = Book.objects.annotate(
2100.             count=Count("id"),
2101.             exists=Exists(Author.objects.extra(where=["1=0"])),
2102.         )
2103.         self.assertEqual(len(qs), 6)
2104. 
2105.     def test_multiple_aggregate_references(self):
2106.         aggregates = Author.objects.aggregate(
2107.             total_books=Count("book"),
2108.             coalesced_total_books=Coalesce("total_books", 0),
2109.         )
2110.         self.assertEqual(
2111.             aggregates,
2112.             {
2113.                 "total_books": 10,
2114.                 "coalesced_total_books": 10,
2115.             },
2116.         )
2117. 
2118. 
2119. class AggregateAnnotationPruningTests(TestCase):
2120.     @classmethod
2121.     def setUpTestData(cls):
2122.         cls.a1 = Author.objects.create(age=1)
2123.         cls.a2 = Author.objects.create(age=2)
2124.         cls.p1 = Publisher.objects.create(num_awards=1)
2125.         cls.p2 = Publisher.objects.create(num_awards=0)
2126.         cls.b1 = Book.objects.create(
2127.             name="b1",
2128.             publisher=cls.p1,
2129.             pages=100,
2130.             rating=4.5,
2131.             price=10,
2132.             contact=cls.a1,
2133.             pubdate=datetime.date.today(),
2134.         )
2135.         cls.b1.authors.add(cls.a1)
2136.         cls.b2 = Book.objects.create(
2137.             name="b2",
2138.             publisher=cls.p2,
2139.             pages=1000,
2140.             rating=3.2,
2141.             price=50,
2142.             contact=cls.a2,
2143.             pubdate=datetime.date.today(),
2144.         )
2145.         cls.b2.authors.add(cls.a1, cls.a2)
2146. 
2147.     def test_unused_aliased_aggregate_pruned(self):
2148.         with CaptureQueriesContext(connection) as ctx:
2149.             cnt = Book.objects.alias(
2150.                 authors_count=Count("authors"),
2151.             ).count()
2152.         self.assertEqual(cnt, 2)
2153.         sql = ctx.captured_queries[0]["sql"].lower()
2154.         self.assertEqual(sql.count("select"), 2, "Subquery wrapping required")
2155.         self.assertNotIn("authors_count", sql)
2156. 
2157.     def test_non_aggregate_annotation_pruned(self):
2158.         with CaptureQueriesContext(connection) as ctx:
2159.             Book.objects.annotate(
2160.                 name_lower=Lower("name"),
2161.             ).count()
2162.         sql = ctx.captured_queries[0]["sql"].lower()
2163.         self.assertEqual(sql.count("select"), 1, "No subquery wrapping required")
2164.         self.assertNotIn("name_lower", sql)
2165. 
2166.     def test_unreferenced_aggregate_annotation_pruned(self):
2167.         with CaptureQueriesContext(connection) as ctx:
2168.             cnt = Book.objects.annotate(
2169.                 authors_count=Count("authors"),
2170.             ).count()
2171.         self.assertEqual(cnt, 2)
2172.         sql = ctx.captured_queries[0]["sql"].lower()
2173.         self.assertEqual(sql.count("select"), 2, "Subquery wrapping required")
2174.         self.assertNotIn("authors_count", sql)
2175. 
2176.     def test_referenced_aggregate_annotation_kept(self):
2177.         with CaptureQueriesContext(connection) as ctx:
2178.             Book.objects.annotate(
2179.                 authors_count=Count("authors"),
2180.             ).aggregate(Avg("authors_count"))
2181.         sql = ctx.captured_queries[0]["sql"].lower()
2182.         self.assertEqual(sql.count("select"), 2, "Subquery wrapping required")
2183.         self.assertEqual(sql.count("authors_count"), 2)
2184. 
2185.     def test_referenced_group_by_annotation_kept(self):
2186.         queryset = Book.objects.values(pages_mod=Mod("pages", 10)).annotate(
2187.             mod_count=Count("*")
2188.         )
2189.         self.assertEqual(queryset.count(), 1)
2190. 
2191.     def test_referenced_subquery_requires_wrapping(self):
2192.         total_books_qs = (
2193.             Author.book_set.through.objects.values("author")
2194.             .filter(author=OuterRef("pk"))
2195.             .annotate(total=Count("book"))
2196.         )
2197.         with self.assertNumQueries(1) as ctx:
2198.             aggregate = (
2199.                 Author.objects.annotate(
2200.                     total_books=Subquery(total_books_qs.values("total"))
2201.                 )
2202.                 .values("pk", "total_books")
2203.                 .aggregate(
2204.                     sum_total_books=Sum("total_books"),
2205.                 )
2206.             )
2207.         sql = ctx.captured_queries[0]["sql"].lower()
2208.         self.assertEqual(sql.count("select"), 3, "Subquery wrapping required")
2209.         self.assertEqual(aggregate, {"sum_total_books": 3})


File: tests/expressions_window/tests.py
Line number range: 1 - 1666
Content:
1. import datetime
2. from decimal import Decimal
3. from unittest import mock
4. 
5. from django.core.exceptions import FieldError
6. from django.db import NotSupportedError, connection
7. from django.db.models import (
8.     Avg,
9.     Case,
10.     Count,
11.     F,
12.     IntegerField,
13.     Max,
14.     Min,
15.     OuterRef,
16.     Q,
17.     RowRange,
18.     Subquery,
19.     Sum,
20.     Value,
21.     ValueRange,
22.     When,
23.     Window,
24.     WindowFrame,
25. )
26. from django.db.models.fields.json import KeyTextTransform, KeyTransform
27. from django.db.models.functions import (
28.     Cast,
29.     CumeDist,
30.     DenseRank,
31.     ExtractYear,
32.     FirstValue,
33.     Lag,
34.     LastValue,
35.     Lead,
36.     NthValue,
37.     Ntile,
38.     PercentRank,
39.     Rank,
40.     RowNumber,
41.     Upper,
42. )
43. from django.db.models.lookups import Exact
44. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
45. from django.test.utils import CaptureQueriesContext
46. 
47. from .models import Classification, Detail, Employee, PastEmployeeDepartment
48. 
49. 
50. @skipUnlessDBFeature("supports_over_clause")
51. class WindowFunctionTests(TestCase):
52.     @classmethod
53.     def setUpTestData(cls):
54.         classification = Classification.objects.create()
55.         Employee.objects.bulk_create(
56.             [
57.                 Employee(
58.                     name=e[0],
59.                     salary=e[1],
60.                     department=e[2],
61.                     hire_date=e[3],
62.                     age=e[4],
63.                     bonus=Decimal(e[1]) / 400,
64.                     classification=classification,
65.                 )
66.                 for e in [
67.                     ("Jones", 45000, "Accounting", datetime.datetime(2005, 11, 1), 20),
68.                     (
69.                         "Williams",
70.                         37000,
71.                         "Accounting",
72.                         datetime.datetime(2009, 6, 1),
73.                         20,
74.                     ),
75.                     ("Jenson", 45000, "Accounting", datetime.datetime(2008, 4, 1), 20),
76.                     ("Adams", 50000, "Accounting", datetime.datetime(2013, 7, 1), 50),
77.                     ("Smith", 55000, "Sales", datetime.datetime(2007, 6, 1), 30),
78.                     ("Brown", 53000, "Sales", datetime.datetime(2009, 9, 1), 30),
79.                     ("Johnson", 40000, "Marketing", datetime.datetime(2012, 3, 1), 30),
80.                     ("Smith", 38000, "Marketing", datetime.datetime(2009, 10, 1), 20),
81.                     ("Wilkinson", 60000, "IT", datetime.datetime(2011, 3, 1), 40),
82.                     ("Moore", 34000, "IT", datetime.datetime(2013, 8, 1), 40),
83.                     ("Miller", 100000, "Management", datetime.datetime(2005, 6, 1), 40),
84.                     ("Johnson", 80000, "Management", datetime.datetime(2005, 7, 1), 50),
85.                 ]
86.             ]
87.         )
88.         employees = list(Employee.objects.order_by("pk"))
89.         PastEmployeeDepartment.objects.bulk_create(
90.             [
91.                 PastEmployeeDepartment(employee=employees[6], department="Sales"),
92.                 PastEmployeeDepartment(employee=employees[10], department="IT"),
93.             ]
94.         )
95. 
96.     def test_dense_rank(self):
97.         tests = [
98.             ExtractYear(F("hire_date")).asc(),
99.             F("hire_date__year").asc(),
100.             "hire_date__year",
101.         ]
102.         for order_by in tests:
103.             with self.subTest(order_by=order_by):
104.                 qs = Employee.objects.annotate(
105.                     rank=Window(expression=DenseRank(), order_by=order_by),
106.                 )
107.                 self.assertQuerySetEqual(
108.                     qs,
109.                     [
110.                         ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 1),
111.                         ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 1),
112.                         ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 1),
113.                         ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 2),
114.                         ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 3),
115.                         ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 4),
116.                         ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 4),
117.                         ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 4),
118.                         ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 5),
119.                         ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 6),
120.                         ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 7),
121.                         ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 7),
122.                     ],
123.                     lambda entry: (
124.                         entry.name,
125.                         entry.salary,
126.                         entry.department,
127.                         entry.hire_date,
128.                         entry.rank,
129.                     ),
130.                     ordered=False,
131.                 )
132. 
133.     def test_department_salary(self):
134.         qs = Employee.objects.annotate(
135.             department_sum=Window(
136.                 expression=Sum("salary"),
137.                 partition_by=F("department"),
138.                 order_by=[F("hire_date").asc()],
139.             )
140.         ).order_by("department", "department_sum")
141.         self.assertQuerySetEqual(
142.             qs,
143.             [
144.                 ("Jones", "Accounting", 45000, 45000),
145.                 ("Jenson", "Accounting", 45000, 90000),
146.                 ("Williams", "Accounting", 37000, 127000),
147.                 ("Adams", "Accounting", 50000, 177000),
148.                 ("Wilkinson", "IT", 60000, 60000),
149.                 ("Moore", "IT", 34000, 94000),
150.                 ("Miller", "Management", 100000, 100000),
151.                 ("Johnson", "Management", 80000, 180000),
152.                 ("Smith", "Marketing", 38000, 38000),
153.                 ("Johnson", "Marketing", 40000, 78000),
154.                 ("Smith", "Sales", 55000, 55000),
155.                 ("Brown", "Sales", 53000, 108000),
156.             ],
157.             lambda entry: (
158.                 entry.name,
159.                 entry.department,
160.                 entry.salary,
161.                 entry.department_sum,
162.             ),
163.         )
164. 
165.     def test_rank(self):
166.         """
167.         Rank the employees based on the year they're were hired. Since there
168.         are multiple employees hired in different years, this will contain
169.         gaps.
170.         """
171.         qs = Employee.objects.annotate(
172.             rank=Window(
173.                 expression=Rank(),
174.                 order_by=F("hire_date__year").asc(),
175.             )
176.         )
177.         self.assertQuerySetEqual(
178.             qs,
179.             [
180.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 1),
181.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 1),
182.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 1),
183.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 4),
184.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 5),
185.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 6),
186.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 6),
187.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 6),
188.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 9),
189.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 10),
190.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 11),
191.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 11),
192.             ],
193.             lambda entry: (
194.                 entry.name,
195.                 entry.salary,
196.                 entry.department,
197.                 entry.hire_date,
198.                 entry.rank,
199.             ),
200.             ordered=False,
201.         )
202. 
203.     def test_row_number(self):
204.         """
205.         The row number window function computes the number based on the order
206.         in which the tuples were inserted. Depending on the backend,
207. 
208.         Oracle requires an ordering-clause in the Window expression.
209.         """
210.         qs = Employee.objects.annotate(
211.             row_number=Window(
212.                 expression=RowNumber(),
213.                 order_by=F("pk").asc(),
214.             )
215.         ).order_by("pk")
216.         self.assertQuerySetEqual(
217.             qs,
218.             [
219.                 ("Jones", "Accounting", 1),
220.                 ("Williams", "Accounting", 2),
221.                 ("Jenson", "Accounting", 3),
222.                 ("Adams", "Accounting", 4),
223.                 ("Smith", "Sales", 5),
224.                 ("Brown", "Sales", 6),
225.                 ("Johnson", "Marketing", 7),
226.                 ("Smith", "Marketing", 8),
227.                 ("Wilkinson", "IT", 9),
228.                 ("Moore", "IT", 10),
229.                 ("Miller", "Management", 11),
230.                 ("Johnson", "Management", 12),
231.             ],
232.             lambda entry: (entry.name, entry.department, entry.row_number),
233.         )
234. 
235.     def test_row_number_no_ordering(self):
236.         """
237.         The row number window function computes the number based on the order
238.         in which the tuples were inserted.
239.         """
240.         # Add a default ordering for consistent results across databases.
241.         qs = Employee.objects.annotate(
242.             row_number=Window(
243.                 expression=RowNumber(),
244.             )
245.         ).order_by("pk")
246.         self.assertQuerySetEqual(
247.             qs,
248.             [
249.                 ("Jones", "Accounting", 1),
250.                 ("Williams", "Accounting", 2),
251.                 ("Jenson", "Accounting", 3),
252.                 ("Adams", "Accounting", 4),
253.                 ("Smith", "Sales", 5),
254.                 ("Brown", "Sales", 6),
255.                 ("Johnson", "Marketing", 7),
256.                 ("Smith", "Marketing", 8),
257.                 ("Wilkinson", "IT", 9),
258.                 ("Moore", "IT", 10),
259.                 ("Miller", "Management", 11),
260.                 ("Johnson", "Management", 12),
261.             ],
262.             lambda entry: (entry.name, entry.department, entry.row_number),
263.         )
264. 
265.     def test_avg_salary_department(self):
266.         qs = Employee.objects.annotate(
267.             avg_salary=Window(
268.                 expression=Avg("salary"),
269.                 order_by=F("department").asc(),
270.                 partition_by="department",
271.             )
272.         ).order_by("department", "-salary", "name")
273.         self.assertQuerySetEqual(
274.             qs,
275.             [
276.                 ("Adams", 50000, "Accounting", 44250.00),
277.                 ("Jenson", 45000, "Accounting", 44250.00),
278.                 ("Jones", 45000, "Accounting", 44250.00),
279.                 ("Williams", 37000, "Accounting", 44250.00),
280.                 ("Wilkinson", 60000, "IT", 47000.00),
281.                 ("Moore", 34000, "IT", 47000.00),
282.                 ("Miller", 100000, "Management", 90000.00),
283.                 ("Johnson", 80000, "Management", 90000.00),
284.                 ("Johnson", 40000, "Marketing", 39000.00),
285.                 ("Smith", 38000, "Marketing", 39000.00),
286.                 ("Smith", 55000, "Sales", 54000.00),
287.                 ("Brown", 53000, "Sales", 54000.00),
288.             ],
289.             transform=lambda row: (
290.                 row.name,
291.                 row.salary,
292.                 row.department,
293.                 row.avg_salary,
294.             ),
295.         )
296. 
297.     def test_lag(self):
298.         """
299.         Compute the difference between an employee's salary and the next
300.         highest salary in the employee's department. Return None if the
301.         employee has the lowest salary.
302.         """
303.         qs = Employee.objects.annotate(
304.             lag=Window(
305.                 expression=Lag(expression="salary", offset=1),
306.                 partition_by=F("department"),
307.                 order_by=[F("salary").asc(), F("name").asc()],
308.             )
309.         ).order_by("department", F("salary").asc(), F("name").asc())
310.         self.assertQuerySetEqual(
311.             qs,
312.             [
313.                 ("Williams", 37000, "Accounting", None),
314.                 ("Jenson", 45000, "Accounting", 37000),
315.                 ("Jones", 45000, "Accounting", 45000),
316.                 ("Adams", 50000, "Accounting", 45000),
317.                 ("Moore", 34000, "IT", None),
318.                 ("Wilkinson", 60000, "IT", 34000),
319.                 ("Johnson", 80000, "Management", None),
320.                 ("Miller", 100000, "Management", 80000),
321.                 ("Smith", 38000, "Marketing", None),
322.                 ("Johnson", 40000, "Marketing", 38000),
323.                 ("Brown", 53000, "Sales", None),
324.                 ("Smith", 55000, "Sales", 53000),
325.             ],
326.             transform=lambda row: (row.name, row.salary, row.department, row.lag),
327.         )
328. 
329.     def test_lag_decimalfield(self):
330.         qs = Employee.objects.annotate(
331.             lag=Window(
332.                 expression=Lag(expression="bonus", offset=1),
333.                 partition_by=F("department"),
334.                 order_by=[F("bonus").asc(), F("name").asc()],
335.             )
336.         ).order_by("department", F("bonus").asc(), F("name").asc())
337.         self.assertQuerySetEqual(
338.             qs,
339.             [
340.                 ("Williams", 92.5, "Accounting", None),
341.                 ("Jenson", 112.5, "Accounting", 92.5),
342.                 ("Jones", 112.5, "Accounting", 112.5),
343.                 ("Adams", 125, "Accounting", 112.5),
344.                 ("Moore", 85, "IT", None),
345.                 ("Wilkinson", 150, "IT", 85),
346.                 ("Johnson", 200, "Management", None),
347.                 ("Miller", 250, "Management", 200),
348.                 ("Smith", 95, "Marketing", None),
349.                 ("Johnson", 100, "Marketing", 95),
350.                 ("Brown", 132.5, "Sales", None),
351.                 ("Smith", 137.5, "Sales", 132.5),
352.             ],
353.             transform=lambda row: (row.name, row.bonus, row.department, row.lag),
354.         )
355. 
356.     def test_first_value(self):
357.         qs = Employee.objects.annotate(
358.             first_value=Window(
359.                 expression=FirstValue("salary"),
360.                 partition_by=F("department"),
361.                 order_by=F("hire_date").asc(),
362.             )
363.         ).order_by("department", "hire_date")
364.         self.assertQuerySetEqual(
365.             qs,
366.             [
367.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
368.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 45000),
369.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 45000),
370.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 45000),
371.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
372.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 60000),
373.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
374.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 100000),
375.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
376.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 38000),
377.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
378.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 55000),
379.             ],
380.             lambda row: (
381.                 row.name,
382.                 row.salary,
383.                 row.department,
384.                 row.hire_date,
385.                 row.first_value,
386.             ),
387.         )
388. 
389.     def test_last_value(self):
390.         qs = Employee.objects.annotate(
391.             last_value=Window(
392.                 expression=LastValue("hire_date"),
393.                 partition_by=F("department"),
394.                 order_by=F("hire_date").asc(),
395.             )
396.         )
397.         self.assertQuerySetEqual(
398.             qs,
399.             [
400.                 (
401.                     "Adams",
402.                     "Accounting",
403.                     datetime.date(2013, 7, 1),
404.                     50000,
405.                     datetime.date(2013, 7, 1),
406.                 ),
407.                 (
408.                     "Jenson",
409.                     "Accounting",
410.                     datetime.date(2008, 4, 1),
411.                     45000,
412.                     datetime.date(2008, 4, 1),
413.                 ),
414.                 (
415.                     "Jones",
416.                     "Accounting",
417.                     datetime.date(2005, 11, 1),
418.                     45000,
419.                     datetime.date(2005, 11, 1),
420.                 ),
421.                 (
422.                     "Williams",
423.                     "Accounting",
424.                     datetime.date(2009, 6, 1),
425.                     37000,
426.                     datetime.date(2009, 6, 1),
427.                 ),
428.                 (
429.                     "Moore",
430.                     "IT",
431.                     datetime.date(2013, 8, 1),
432.                     34000,
433.                     datetime.date(2013, 8, 1),
434.                 ),
435.                 (
436.                     "Wilkinson",
437.                     "IT",
438.                     datetime.date(2011, 3, 1),
439.                     60000,
440.                     datetime.date(2011, 3, 1),
441.                 ),
442.                 (
443.                     "Miller",
444.                     "Management",
445.                     datetime.date(2005, 6, 1),
446.                     100000,
447.                     datetime.date(2005, 6, 1),
448.                 ),
449.                 (
450.                     "Johnson",
451.                     "Management",
452.                     datetime.date(2005, 7, 1),
453.                     80000,
454.                     datetime.date(2005, 7, 1),
455.                 ),
456.                 (
457.                     "Johnson",
458.                     "Marketing",
459.                     datetime.date(2012, 3, 1),
460.                     40000,
461.                     datetime.date(2012, 3, 1),
462.                 ),
463.                 (
464.                     "Smith",
465.                     "Marketing",
466.                     datetime.date(2009, 10, 1),
467.                     38000,
468.                     datetime.date(2009, 10, 1),
469.                 ),
470.                 (
471.                     "Brown",
472.                     "Sales",
473.                     datetime.date(2009, 9, 1),
474.                     53000,
475.                     datetime.date(2009, 9, 1),
476.                 ),
477.                 (
478.                     "Smith",
479.                     "Sales",
480.                     datetime.date(2007, 6, 1),
481.                     55000,
482.                     datetime.date(2007, 6, 1),
483.                 ),
484.             ],
485.             transform=lambda row: (
486.                 row.name,
487.                 row.department,
488.                 row.hire_date,
489.                 row.salary,
490.                 row.last_value,
491.             ),
492.             ordered=False,
493.         )
494. 
495.     def test_function_list_of_values(self):
496.         qs = (
497.             Employee.objects.annotate(
498.                 lead=Window(
499.                     expression=Lead(expression="salary"),
500.                     order_by=[F("hire_date").asc(), F("name").desc()],
501.                     partition_by="department",
502.                 )
503.             )
504.             .values_list("name", "salary", "department", "hire_date", "lead")
505.             .order_by("department", F("hire_date").asc(), F("name").desc())
506.         )
507.         self.assertNotIn("GROUP BY", str(qs.query))
508.         self.assertSequenceEqual(
509.             qs,
510.             [
511.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
512.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 37000),
513.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 50000),
514.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
515.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 34000),
516.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
517.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 80000),
518.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
519.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 40000),
520.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
521.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 53000),
522.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
523.             ],
524.         )
525. 
526.     def test_min_department(self):
527.         """An alternative way to specify a query for FirstValue."""
528.         qs = Employee.objects.annotate(
529.             min_salary=Window(
530.                 expression=Min("salary"),
531.                 partition_by=F("department"),
532.                 order_by=[F("salary").asc(), F("name").asc()],
533.             )
534.         ).order_by("department", "salary", "name")
535.         self.assertQuerySetEqual(
536.             qs,
537.             [
538.                 ("Williams", "Accounting", 37000, 37000),
539.                 ("Jenson", "Accounting", 45000, 37000),
540.                 ("Jones", "Accounting", 45000, 37000),
541.                 ("Adams", "Accounting", 50000, 37000),
542.                 ("Moore", "IT", 34000, 34000),
543.                 ("Wilkinson", "IT", 60000, 34000),
544.                 ("Johnson", "Management", 80000, 80000),
545.                 ("Miller", "Management", 100000, 80000),
546.                 ("Smith", "Marketing", 38000, 38000),
547.                 ("Johnson", "Marketing", 40000, 38000),
548.                 ("Brown", "Sales", 53000, 53000),
549.                 ("Smith", "Sales", 55000, 53000),
550.             ],
551.             lambda row: (row.name, row.department, row.salary, row.min_salary),
552.         )
553. 
554.     def test_max_per_year(self):
555.         """
556.         Find the maximum salary awarded in the same year as the
557.         employee was hired, regardless of the department.
558.         """
559.         qs = Employee.objects.annotate(
560.             max_salary_year=Window(
561.                 expression=Max("salary"),
562.                 order_by=ExtractYear("hire_date").asc(),
563.                 partition_by=ExtractYear("hire_date"),
564.             )
565.         ).order_by(ExtractYear("hire_date"), "salary")
566.         self.assertQuerySetEqual(
567.             qs,
568.             [
569.                 ("Jones", "Accounting", 45000, 2005, 100000),
570.                 ("Johnson", "Management", 80000, 2005, 100000),
571.                 ("Miller", "Management", 100000, 2005, 100000),
572.                 ("Smith", "Sales", 55000, 2007, 55000),
573.                 ("Jenson", "Accounting", 45000, 2008, 45000),
574.                 ("Williams", "Accounting", 37000, 2009, 53000),
575.                 ("Smith", "Marketing", 38000, 2009, 53000),
576.                 ("Brown", "Sales", 53000, 2009, 53000),
577.                 ("Wilkinson", "IT", 60000, 2011, 60000),
578.                 ("Johnson", "Marketing", 40000, 2012, 40000),
579.                 ("Moore", "IT", 34000, 2013, 50000),
580.                 ("Adams", "Accounting", 50000, 2013, 50000),
581.             ],
582.             lambda row: (
583.                 row.name,
584.                 row.department,
585.                 row.salary,
586.                 row.hire_date.year,
587.                 row.max_salary_year,
588.             ),
589.         )
590. 
591.     def test_cume_dist(self):
592.         """
593.         Compute the cumulative distribution for the employees based on the
594.         salary in increasing order. Equal to rank/total number of rows (12).
595.         """
596.         qs = Employee.objects.annotate(
597.             cume_dist=Window(
598.                 expression=CumeDist(),
599.                 order_by=F("salary").asc(),
600.             )
601.         ).order_by("salary", "name")
602.         # Round result of cume_dist because Oracle uses greater precision.
603.         self.assertQuerySetEqual(
604.             qs,
605.             [
606.                 ("Moore", "IT", 34000, 0.0833333333),
607.                 ("Williams", "Accounting", 37000, 0.1666666667),
608.                 ("Smith", "Marketing", 38000, 0.25),
609.                 ("Johnson", "Marketing", 40000, 0.3333333333),
610.                 ("Jenson", "Accounting", 45000, 0.5),
611.                 ("Jones", "Accounting", 45000, 0.5),
612.                 ("Adams", "Accounting", 50000, 0.5833333333),
613.                 ("Brown", "Sales", 53000, 0.6666666667),
614.                 ("Smith", "Sales", 55000, 0.75),
615.                 ("Wilkinson", "IT", 60000, 0.8333333333),
616.                 ("Johnson", "Management", 80000, 0.9166666667),
617.                 ("Miller", "Management", 100000, 1),
618.             ],
619.             lambda row: (
620.                 row.name,
621.                 row.department,
622.                 row.salary,
623.                 round(row.cume_dist, 10),
624.             ),
625.         )
626. 
627.     def test_nthvalue(self):
628.         qs = Employee.objects.annotate(
629.             nth_value=Window(
630.                 expression=NthValue(expression="salary", nth=2),
631.                 order_by=[F("hire_date").asc(), F("name").desc()],
632.                 partition_by=F("department"),
633.             )
634.         ).order_by("department", "hire_date", "name")
635.         self.assertQuerySetEqual(
636.             qs,
637.             [
638.                 ("Jones", "Accounting", datetime.date(2005, 11, 1), 45000, None),
639.                 ("Jenson", "Accounting", datetime.date(2008, 4, 1), 45000, 45000),
640.                 ("Williams", "Accounting", datetime.date(2009, 6, 1), 37000, 45000),
641.                 ("Adams", "Accounting", datetime.date(2013, 7, 1), 50000, 45000),
642.                 ("Wilkinson", "IT", datetime.date(2011, 3, 1), 60000, None),
643.                 ("Moore", "IT", datetime.date(2013, 8, 1), 34000, 34000),
644.                 ("Miller", "Management", datetime.date(2005, 6, 1), 100000, None),
645.                 ("Johnson", "Management", datetime.date(2005, 7, 1), 80000, 80000),
646.                 ("Smith", "Marketing", datetime.date(2009, 10, 1), 38000, None),
647.                 ("Johnson", "Marketing", datetime.date(2012, 3, 1), 40000, 40000),
648.                 ("Smith", "Sales", datetime.date(2007, 6, 1), 55000, None),
649.                 ("Brown", "Sales", datetime.date(2009, 9, 1), 53000, 53000),
650.             ],
651.             lambda row: (
652.                 row.name,
653.                 row.department,
654.                 row.hire_date,
655.                 row.salary,
656.                 row.nth_value,
657.             ),
658.         )
659. 
660.     def test_lead(self):
661.         """
662.         Determine what the next person hired in the same department makes.
663.         Because the dataset is ambiguous, the name is also part of the
664.         ordering clause. No default is provided, so None/NULL should be
665.         returned.
666.         """
667.         qs = Employee.objects.annotate(
668.             lead=Window(
669.                 expression=Lead(expression="salary"),
670.                 order_by=[F("hire_date").asc(), F("name").desc()],
671.                 partition_by="department",
672.             )
673.         ).order_by("department", F("hire_date").asc(), F("name").desc())
674.         self.assertQuerySetEqual(
675.             qs,
676.             [
677.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
678.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 37000),
679.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 50000),
680.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
681.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 34000),
682.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
683.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 80000),
684.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
685.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 40000),
686.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
687.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 53000),
688.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
689.             ],
690.             transform=lambda row: (
691.                 row.name,
692.                 row.salary,
693.                 row.department,
694.                 row.hire_date,
695.                 row.lead,
696.             ),
697.         )
698. 
699.     def test_lead_offset(self):
700.         """
701.         Determine what the person hired after someone makes. Due to
702.         ambiguity, the name is also included in the ordering.
703.         """
704.         qs = Employee.objects.annotate(
705.             lead=Window(
706.                 expression=Lead("salary", offset=2),
707.                 partition_by="department",
708.                 order_by=F("hire_date").asc(),
709.             )
710.         )
711.         self.assertQuerySetEqual(
712.             qs,
713.             [
714.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 37000),
715.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 50000),
716.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), None),
717.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), None),
718.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), None),
719.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), None),
720.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), None),
721.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), None),
722.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), None),
723.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), None),
724.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), None),
725.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), None),
726.             ],
727.             transform=lambda row: (
728.                 row.name,
729.                 row.salary,
730.                 row.department,
731.                 row.hire_date,
732.                 row.lead,
733.             ),
734.             ordered=False,
735.         )
736. 
737.     @skipUnlessDBFeature("supports_default_in_lead_lag")
738.     def test_lead_default(self):
739.         qs = Employee.objects.annotate(
740.             lead_default=Window(
741.                 expression=Lead(expression="salary", offset=5, default=60000),
742.                 partition_by=F("department"),
743.                 order_by=F("department").asc(),
744.             )
745.         )
746.         self.assertEqual(
747.             list(qs.values_list("lead_default", flat=True).distinct()), [60000]
748.         )
749. 
750.     def test_ntile(self):
751.         """
752.         Compute the group for each of the employees across the entire company,
753.         based on how high the salary is for them. There are twelve employees
754.         so it divides evenly into four groups.
755.         """
756.         qs = Employee.objects.annotate(
757.             ntile=Window(
758.                 expression=Ntile(num_buckets=4),
759.                 order_by="-salary",
760.             )
761.         ).order_by("ntile", "-salary", "name")
762.         self.assertQuerySetEqual(
763.             qs,
764.             [
765.                 ("Miller", "Management", 100000, 1),
766.                 ("Johnson", "Management", 80000, 1),
767.                 ("Wilkinson", "IT", 60000, 1),
768.                 ("Smith", "Sales", 55000, 2),
769.                 ("Brown", "Sales", 53000, 2),
770.                 ("Adams", "Accounting", 50000, 2),
771.                 ("Jenson", "Accounting", 45000, 3),
772.                 ("Jones", "Accounting", 45000, 3),
773.                 ("Johnson", "Marketing", 40000, 3),
774.                 ("Smith", "Marketing", 38000, 4),
775.                 ("Williams", "Accounting", 37000, 4),
776.                 ("Moore", "IT", 34000, 4),
777.             ],
778.             lambda x: (x.name, x.department, x.salary, x.ntile),
779.         )
780. 
781.     def test_percent_rank(self):
782.         """
783.         Calculate the percentage rank of the employees across the entire
784.         company based on salary and name (in case of ambiguity).
785.         """
786.         qs = Employee.objects.annotate(
787.             percent_rank=Window(
788.                 expression=PercentRank(),
789.                 order_by=[F("salary").asc(), F("name").asc()],
790.             )
791.         ).order_by("percent_rank")
792.         # Round to account for precision differences among databases.
793.         self.assertQuerySetEqual(
794.             qs,
795.             [
796.                 ("Moore", "IT", 34000, 0.0),
797.                 ("Williams", "Accounting", 37000, 0.0909090909),
798.                 ("Smith", "Marketing", 38000, 0.1818181818),
799.                 ("Johnson", "Marketing", 40000, 0.2727272727),
800.                 ("Jenson", "Accounting", 45000, 0.3636363636),
801.                 ("Jones", "Accounting", 45000, 0.4545454545),
802.                 ("Adams", "Accounting", 50000, 0.5454545455),
803.                 ("Brown", "Sales", 53000, 0.6363636364),
804.                 ("Smith", "Sales", 55000, 0.7272727273),
805.                 ("Wilkinson", "IT", 60000, 0.8181818182),
806.                 ("Johnson", "Management", 80000, 0.9090909091),
807.                 ("Miller", "Management", 100000, 1.0),
808.             ],
809.             transform=lambda row: (
810.                 row.name,
811.                 row.department,
812.                 row.salary,
813.                 round(row.percent_rank, 10),
814.             ),
815.         )
816. 
817.     def test_nth_returns_null(self):
818.         """
819.         Find the nth row of the data set. None is returned since there are
820.         fewer than 20 rows in the test data.
821.         """
822.         qs = Employee.objects.annotate(
823.             nth_value=Window(
824.                 expression=NthValue("salary", nth=20), order_by=F("salary").asc()
825.             )
826.         )
827.         self.assertEqual(
828.             list(qs.values_list("nth_value", flat=True).distinct()), [None]
829.         )
830. 
831.     def test_multiple_partitioning(self):
832.         """
833.         Find the maximum salary for each department for people hired in the
834.         same year.
835.         """
836.         qs = Employee.objects.annotate(
837.             max=Window(
838.                 expression=Max("salary"),
839.                 partition_by=[F("department"), F("hire_date__year")],
840.             )
841.         ).order_by("department", "hire_date", "name")
842.         self.assertQuerySetEqual(
843.             qs,
844.             [
845.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
846.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 45000),
847.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 37000),
848.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 50000),
849.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
850.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 34000),
851.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
852.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 100000),
853.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
854.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 40000),
855.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
856.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 53000),
857.             ],
858.             transform=lambda row: (
859.                 row.name,
860.                 row.salary,
861.                 row.department,
862.                 row.hire_date,
863.                 row.max,
864.             ),
865.         )
866. 
867.     def test_multiple_ordering(self):
868.         """
869.         Accumulate the salaries over the departments based on hire_date.
870.         If two people were hired on the same date in the same department, the
871.         ordering clause will render a different result for those people.
872.         """
873.         qs = Employee.objects.annotate(
874.             sum=Window(
875.                 expression=Sum("salary"),
876.                 partition_by="department",
877.                 order_by=[F("hire_date").asc(), F("name").asc()],
878.             )
879.         ).order_by("department", "sum")
880.         self.assertQuerySetEqual(
881.             qs,
882.             [
883.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 45000),
884.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 90000),
885.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 127000),
886.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 177000),
887.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
888.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 94000),
889.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
890.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 180000),
891.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
892.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 78000),
893.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
894.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 108000),
895.             ],
896.             transform=lambda row: (
897.                 row.name,
898.                 row.salary,
899.                 row.department,
900.                 row.hire_date,
901.                 row.sum,
902.             ),
903.         )
904. 
905.     def test_related_ordering_with_count(self):
906.         qs = Employee.objects.annotate(
907.             department_sum=Window(
908.                 expression=Sum("salary"),
909.                 partition_by=F("department"),
910.                 order_by=["classification__code"],
911.             )
912.         )
913.         self.assertEqual(qs.count(), 12)
914. 
915.     def test_filter(self):
916.         qs = Employee.objects.annotate(
917.             department_salary_rank=Window(
918.                 Rank(), partition_by="department", order_by="-salary"
919.             ),
920.             department_avg_age_diff=(
921.                 Window(Avg("age"), partition_by="department") - F("age")
922.             ),
923.         ).order_by("department", "name")
924.         # Direct window reference.
925.         self.assertQuerySetEqual(
926.             qs.filter(department_salary_rank=1),
927.             ["Adams", "Wilkinson", "Miller", "Johnson", "Smith"],
928.             lambda employee: employee.name,
929.         )
930.         # Through a combined expression containing a window.
931.         self.assertQuerySetEqual(
932.             qs.filter(department_avg_age_diff__gt=0),
933.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
934.             lambda employee: employee.name,
935.         )
936.         # Intersection of multiple windows.
937.         self.assertQuerySetEqual(
938.             qs.filter(department_salary_rank=1, department_avg_age_diff__gt=0),
939.             ["Miller"],
940.             lambda employee: employee.name,
941.         )
942.         # Union of multiple windows.
943.         self.assertQuerySetEqual(
944.             qs.filter(Q(department_salary_rank=1) | Q(department_avg_age_diff__gt=0)),
945.             [
946.                 "Adams",
947.                 "Jenson",
948.                 "Jones",
949.                 "Williams",
950.                 "Wilkinson",
951.                 "Miller",
952.                 "Johnson",
953.                 "Smith",
954.                 "Smith",
955.             ],
956.             lambda employee: employee.name,
957.         )
958. 
959.     def test_filter_conditional_annotation(self):
960.         qs = (
961.             Employee.objects.annotate(
962.                 rank=Window(Rank(), partition_by="department", order_by="-salary"),
963.                 case_first_rank=Case(
964.                     When(rank=1, then=True),
965.                     default=False,
966.                 ),
967.                 q_first_rank=Q(rank=1),
968.             )
969.             .order_by("name")
970.             .values_list("name", flat=True)
971.         )
972.         for annotation in ["case_first_rank", "q_first_rank"]:
973.             with self.subTest(annotation=annotation):
974.                 self.assertSequenceEqual(
975.                     qs.filter(**{annotation: True}),
976.                     ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"],
977.                 )
978. 
979.     def test_filter_conditional_expression(self):
980.         qs = (
981.             Employee.objects.filter(
982.                 Exact(Window(Rank(), partition_by="department", order_by="-salary"), 1)
983.             )
984.             .order_by("name")
985.             .values_list("name", flat=True)
986.         )
987.         self.assertSequenceEqual(
988.             qs, ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"]
989.         )
990. 
991.     def test_filter_column_ref_rhs(self):
992.         qs = (
993.             Employee.objects.annotate(
994.                 max_dept_salary=Window(Max("salary"), partition_by="department")
995.             )
996.             .filter(max_dept_salary=F("salary"))
997.             .order_by("name")
998.             .values_list("name", flat=True)
999.         )
1000.         self.assertSequenceEqual(
1001.             qs, ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"]
1002.         )
1003. 
1004.     def test_filter_values(self):
1005.         qs = (
1006.             Employee.objects.annotate(
1007.                 department_salary_rank=Window(
1008.                     Rank(), partition_by="department", order_by="-salary"
1009.                 ),
1010.             )
1011.             .order_by("department", "name")
1012.             .values_list(Upper("name"), flat=True)
1013.         )
1014.         self.assertSequenceEqual(
1015.             qs.filter(department_salary_rank=1),
1016.             ["ADAMS", "WILKINSON", "MILLER", "JOHNSON", "SMITH"],
1017.         )
1018. 
1019.     def test_filter_alias(self):
1020.         qs = Employee.objects.alias(
1021.             department_avg_age_diff=(
1022.                 Window(Avg("age"), partition_by="department") - F("age")
1023.             ),
1024.         ).order_by("department", "name")
1025.         self.assertQuerySetEqual(
1026.             qs.filter(department_avg_age_diff__gt=0),
1027.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1028.             lambda employee: employee.name,
1029.         )
1030. 
1031.     def test_filter_select_related(self):
1032.         qs = (
1033.             Employee.objects.alias(
1034.                 department_avg_age_diff=(
1035.                     Window(Avg("age"), partition_by="department") - F("age")
1036.                 ),
1037.             )
1038.             .select_related("classification")
1039.             .filter(department_avg_age_diff__gt=0)
1040.             .order_by("department", "name")
1041.         )
1042.         self.assertQuerySetEqual(
1043.             qs,
1044.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1045.             lambda employee: employee.name,
1046.         )
1047.         with self.assertNumQueries(0):
1048.             qs[0].classification
1049. 
1050.     def test_exclude(self):
1051.         qs = Employee.objects.annotate(
1052.             department_salary_rank=Window(
1053.                 Rank(), partition_by="department", order_by="-salary"
1054.             ),
1055.             department_avg_age_diff=(
1056.                 Window(Avg("age"), partition_by="department") - F("age")
1057.             ),
1058.         ).order_by("department", "name")
1059.         # Direct window reference.
1060.         self.assertQuerySetEqual(
1061.             qs.exclude(department_salary_rank__gt=1),
1062.             ["Adams", "Wilkinson", "Miller", "Johnson", "Smith"],
1063.             lambda employee: employee.name,
1064.         )
1065.         # Through a combined expression containing a window.
1066.         self.assertQuerySetEqual(
1067.             qs.exclude(department_avg_age_diff__lte=0),
1068.             ["Jenson", "Jones", "Williams", "Miller", "Smith"],
1069.             lambda employee: employee.name,
1070.         )
1071.         # Union of multiple windows.
1072.         self.assertQuerySetEqual(
1073.             qs.exclude(
1074.                 Q(department_salary_rank__gt=1) | Q(department_avg_age_diff__lte=0)
1075.             ),
1076.             ["Miller"],
1077.             lambda employee: employee.name,
1078.         )
1079.         # Intersection of multiple windows.
1080.         self.assertQuerySetEqual(
1081.             qs.exclude(department_salary_rank__gt=1, department_avg_age_diff__lte=0),
1082.             [
1083.                 "Adams",
1084.                 "Jenson",
1085.                 "Jones",
1086.                 "Williams",
1087.                 "Wilkinson",
1088.                 "Miller",
1089.                 "Johnson",
1090.                 "Smith",
1091.                 "Smith",
1092.             ],
1093.             lambda employee: employee.name,
1094.         )
1095. 
1096.     def test_heterogeneous_filter(self):
1097.         qs = (
1098.             Employee.objects.annotate(
1099.                 department_salary_rank=Window(
1100.                     Rank(), partition_by="department", order_by="-salary"
1101.                 ),
1102.             )
1103.             .order_by("name")
1104.             .values_list("name", flat=True)
1105.         )
1106.         # Heterogeneous filter between window function and aggregates pushes
1107.         # the WHERE clause to the QUALIFY outer query.
1108.         self.assertSequenceEqual(
1109.             qs.filter(
1110.                 department_salary_rank=1, department__in=["Accounting", "Management"]
1111.             ),
1112.             ["Adams", "Miller"],
1113.         )
1114.         self.assertSequenceEqual(
1115.             qs.filter(
1116.                 Q(department_salary_rank=1)
1117.                 | Q(department__in=["Accounting", "Management"])
1118.             ),
1119.             [
1120.                 "Adams",
1121.                 "Jenson",
1122.                 "Johnson",
1123.                 "Johnson",
1124.                 "Jones",
1125.                 "Miller",
1126.                 "Smith",
1127.                 "Wilkinson",
1128.                 "Williams",
1129.             ],
1130.         )
1131.         # Heterogeneous filter between window function and aggregates pushes
1132.         # the HAVING clause to the QUALIFY outer query.
1133.         qs = qs.annotate(past_department_count=Count("past_departments"))
1134.         self.assertSequenceEqual(
1135.             qs.filter(department_salary_rank=1, past_department_count__gte=1),
1136.             ["Johnson", "Miller"],
1137.         )
1138.         self.assertSequenceEqual(
1139.             qs.filter(Q(department_salary_rank=1) | Q(past_department_count__gte=1)),
1140.             ["Adams", "Johnson", "Miller", "Smith", "Wilkinson"],
1141.         )
1142. 
1143.     def test_limited_filter(self):
1144.         """
1145.         A query filtering against a window function have its limit applied
1146.         after window filtering takes place.
1147.         """
1148.         self.assertQuerySetEqual(
1149.             Employee.objects.annotate(
1150.                 department_salary_rank=Window(
1151.                     Rank(), partition_by="department", order_by="-salary"
1152.                 )
1153.             )
1154.             .filter(department_salary_rank=1)
1155.             .order_by("department")[0:3],
1156.             ["Adams", "Wilkinson", "Miller"],
1157.             lambda employee: employee.name,
1158.         )
1159. 
1160.     def test_filter_count(self):
1161.         with CaptureQueriesContext(connection) as ctx:
1162.             self.assertEqual(
1163.                 Employee.objects.annotate(
1164.                     department_salary_rank=Window(
1165.                         Rank(), partition_by="department", order_by="-salary"
1166.                     )
1167.                 )
1168.                 .filter(department_salary_rank=1)
1169.                 .count(),
1170.                 5,
1171.             )
1172.         self.assertEqual(len(ctx.captured_queries), 1)
1173.         sql = ctx.captured_queries[0]["sql"].lower()
1174.         self.assertEqual(sql.count("select"), 3)
1175.         self.assertNotIn("group by", sql)
1176. 
1177.     @skipUnlessDBFeature("supports_frame_range_fixed_distance")
1178.     def test_range_n_preceding_and_following(self):
1179.         qs = Employee.objects.annotate(
1180.             sum=Window(
1181.                 expression=Sum("salary"),
1182.                 order_by=F("salary").asc(),
1183.                 partition_by="department",
1184.                 frame=ValueRange(start=-2, end=2),
1185.             )
1186.         )
1187.         self.assertIn("RANGE BETWEEN 2 PRECEDING AND 2 FOLLOWING", str(qs.query))
1188.         self.assertQuerySetEqual(
1189.             qs,
1190.             [
1191.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 37000),
1192.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 90000),
1193.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 90000),
1194.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 50000),
1195.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 53000),
1196.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 55000),
1197.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 40000),
1198.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 38000),
1199.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 60000),
1200.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 34000),
1201.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 100000),
1202.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 80000),
1203.             ],
1204.             transform=lambda row: (
1205.                 row.name,
1206.                 row.salary,
1207.                 row.department,
1208.                 row.hire_date,
1209.                 row.sum,
1210.             ),
1211.             ordered=False,
1212.         )
1213. 
1214.     def test_range_unbound(self):
1215.         """A query with RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING."""
1216.         qs = Employee.objects.annotate(
1217.             sum=Window(
1218.                 expression=Sum("salary"),
1219.                 partition_by="age",
1220.                 order_by=[F("age").asc()],
1221.                 frame=ValueRange(start=None, end=None),
1222.             )
1223.         ).order_by("department", "hire_date", "name")
1224.         self.assertIn(
1225.             "RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING", str(qs.query)
1226.         )
1227.         self.assertQuerySetEqual(
1228.             qs,
1229.             [
1230.                 ("Jones", "Accounting", 45000, datetime.date(2005, 11, 1), 165000),
1231.                 ("Jenson", "Accounting", 45000, datetime.date(2008, 4, 1), 165000),
1232.                 ("Williams", "Accounting", 37000, datetime.date(2009, 6, 1), 165000),
1233.                 ("Adams", "Accounting", 50000, datetime.date(2013, 7, 1), 130000),
1234.                 ("Wilkinson", "IT", 60000, datetime.date(2011, 3, 1), 194000),
1235.                 ("Moore", "IT", 34000, datetime.date(2013, 8, 1), 194000),
1236.                 ("Miller", "Management", 100000, datetime.date(2005, 6, 1), 194000),
1237.                 ("Johnson", "Management", 80000, datetime.date(2005, 7, 1), 130000),
1238.                 ("Smith", "Marketing", 38000, datetime.date(2009, 10, 1), 165000),
1239.                 ("Johnson", "Marketing", 40000, datetime.date(2012, 3, 1), 148000),
1240.                 ("Smith", "Sales", 55000, datetime.date(2007, 6, 1), 148000),
1241.                 ("Brown", "Sales", 53000, datetime.date(2009, 9, 1), 148000),
1242.             ],
1243.             transform=lambda row: (
1244.                 row.name,
1245.                 row.department,
1246.                 row.salary,
1247.                 row.hire_date,
1248.                 row.sum,
1249.             ),
1250.         )
1251. 
1252.     def test_subquery_row_range_rank(self):
1253.         qs = Employee.objects.annotate(
1254.             highest_avg_salary_date=Subquery(
1255.                 Employee.objects.filter(
1256.                     department=OuterRef("department"),
1257.                 )
1258.                 .annotate(
1259.                     avg_salary=Window(
1260.                         expression=Avg("salary"),
1261.                         order_by=[F("hire_date").asc()],
1262.                         frame=RowRange(start=-1, end=1),
1263.                     ),
1264.                 )
1265.                 .order_by("-avg_salary", "hire_date")
1266.                 .values("hire_date")[:1],
1267.             ),
1268.         ).order_by("department", "name")
1269.         self.assertQuerySetEqual(
1270.             qs,
1271.             [
1272.                 ("Adams", "Accounting", datetime.date(2005, 11, 1)),
1273.                 ("Jenson", "Accounting", datetime.date(2005, 11, 1)),
1274.                 ("Jones", "Accounting", datetime.date(2005, 11, 1)),
1275.                 ("Williams", "Accounting", datetime.date(2005, 11, 1)),
1276.                 ("Moore", "IT", datetime.date(2011, 3, 1)),
1277.                 ("Wilkinson", "IT", datetime.date(2011, 3, 1)),
1278.                 ("Johnson", "Management", datetime.date(2005, 6, 1)),
1279.                 ("Miller", "Management", datetime.date(2005, 6, 1)),
1280.                 ("Johnson", "Marketing", datetime.date(2009, 10, 1)),
1281.                 ("Smith", "Marketing", datetime.date(2009, 10, 1)),
1282.                 ("Brown", "Sales", datetime.date(2007, 6, 1)),
1283.                 ("Smith", "Sales", datetime.date(2007, 6, 1)),
1284.             ],
1285.             transform=lambda row: (
1286.                 row.name,
1287.                 row.department,
1288.                 row.highest_avg_salary_date,
1289.             ),
1290.         )
1291. 
1292.     def test_row_range_rank(self):
1293.         """
1294.         A query with ROWS BETWEEN UNBOUNDED PRECEDING AND 3 FOLLOWING.
1295.         The resulting sum is the sum of the three next (if they exist) and all
1296.         previous rows according to the ordering clause.
1297.         """
1298.         qs = Employee.objects.annotate(
1299.             sum=Window(
1300.                 expression=Sum("salary"),
1301.                 order_by=[F("hire_date").asc(), F("name").desc()],
1302.                 frame=RowRange(start=None, end=3),
1303.             )
1304.         ).order_by("sum", "hire_date")
1305.         self.assertIn("ROWS BETWEEN UNBOUNDED PRECEDING AND 3 FOLLOWING", str(qs.query))
1306.         self.assertQuerySetEqual(
1307.             qs,
1308.             [
1309.                 ("Miller", 100000, "Management", datetime.date(2005, 6, 1), 280000),
1310.                 ("Johnson", 80000, "Management", datetime.date(2005, 7, 1), 325000),
1311.                 ("Jones", 45000, "Accounting", datetime.date(2005, 11, 1), 362000),
1312.                 ("Smith", 55000, "Sales", datetime.date(2007, 6, 1), 415000),
1313.                 ("Jenson", 45000, "Accounting", datetime.date(2008, 4, 1), 453000),
1314.                 ("Williams", 37000, "Accounting", datetime.date(2009, 6, 1), 513000),
1315.                 ("Brown", 53000, "Sales", datetime.date(2009, 9, 1), 553000),
1316.                 ("Smith", 38000, "Marketing", datetime.date(2009, 10, 1), 603000),
1317.                 ("Wilkinson", 60000, "IT", datetime.date(2011, 3, 1), 637000),
1318.                 ("Johnson", 40000, "Marketing", datetime.date(2012, 3, 1), 637000),
1319.                 ("Adams", 50000, "Accounting", datetime.date(2013, 7, 1), 637000),
1320.                 ("Moore", 34000, "IT", datetime.date(2013, 8, 1), 637000),
1321.             ],
1322.             transform=lambda row: (
1323.                 row.name,
1324.                 row.salary,
1325.                 row.department,
1326.                 row.hire_date,
1327.                 row.sum,
1328.             ),
1329.         )
1330. 
1331.     @skipUnlessDBFeature("can_distinct_on_fields")
1332.     def test_distinct_window_function(self):
1333.         """
1334.         Window functions are not aggregates, and hence a query to filter out
1335.         duplicates may be useful.
1336.         """
1337.         qs = (
1338.             Employee.objects.annotate(
1339.                 sum=Window(
1340.                     expression=Sum("salary"),
1341.                     partition_by=ExtractYear("hire_date"),
1342.                     order_by=ExtractYear("hire_date"),
1343.                 ),
1344.                 year=ExtractYear("hire_date"),
1345.             )
1346.             .filter(sum__gte=45000)
1347.             .values("year", "sum")
1348.             .distinct("year")
1349.             .order_by("year")
1350.         )
1351.         results = [
1352.             {"year": 2005, "sum": 225000},
1353.             {"year": 2007, "sum": 55000},
1354.             {"year": 2008, "sum": 45000},
1355.             {"year": 2009, "sum": 128000},
1356.             {"year": 2011, "sum": 60000},
1357.             {"year": 2013, "sum": 84000},
1358.         ]
1359.         for idx, val in zip(range(len(results)), results):
1360.             with self.subTest(result=val):
1361.                 self.assertEqual(qs[idx], val)
1362. 
1363.     def test_fail_update(self):
1364.         """Window expressions can't be used in an UPDATE statement."""
1365.         msg = (
1366.             "Window expressions are not allowed in this query (salary=<Window: "
1367.             "Max(Col(expressions_window_employee, expressions_window.Employee.salary)) "
1368.             "OVER (PARTITION BY Col(expressions_window_employee, "
1369.             "expressions_window.Employee.department))>)."
1370.         )
1371.         with self.assertRaisesMessage(FieldError, msg):
1372.             Employee.objects.filter(department="Management").update(
1373.                 salary=Window(expression=Max("salary"), partition_by="department"),
1374.             )
1375. 
1376.     def test_fail_insert(self):
1377.         """Window expressions can't be used in an INSERT statement."""
1378.         msg = (
1379.             "Window expressions are not allowed in this query (salary=<Window: "
1380.             "Sum(Value(10000), order_by=OrderBy(F(pk), descending=False)) OVER ()"
1381.         )
1382.         with self.assertRaisesMessage(FieldError, msg):
1383.             Employee.objects.create(
1384.                 name="Jameson",
1385.                 department="Management",
1386.                 hire_date=datetime.date(2007, 7, 1),
1387.                 salary=Window(expression=Sum(Value(10000), order_by=F("pk").asc())),
1388.             )
1389. 
1390.     def test_window_expression_within_subquery(self):
1391.         subquery_qs = Employee.objects.annotate(
1392.             highest=Window(
1393.                 FirstValue("id"),
1394.                 partition_by=F("department"),
1395.                 order_by=F("salary").desc(),
1396.             )
1397.         ).values("highest")
1398.         highest_salary = Employee.objects.filter(pk__in=subquery_qs)
1399.         self.assertCountEqual(
1400.             highest_salary.values("department", "salary"),
1401.             [
1402.                 {"department": "Accounting", "salary": 50000},
1403.                 {"department": "Sales", "salary": 55000},
1404.                 {"department": "Marketing", "salary": 40000},
1405.                 {"department": "IT", "salary": 60000},
1406.                 {"department": "Management", "salary": 100000},
1407.             ],
1408.         )
1409. 
1410.     @skipUnlessDBFeature("supports_json_field")
1411.     def test_key_transform(self):
1412.         Detail.objects.bulk_create(
1413.             [
1414.                 Detail(value={"department": "IT", "name": "Smith", "salary": 37000}),
1415.                 Detail(value={"department": "IT", "name": "Nowak", "salary": 32000}),
1416.                 Detail(value={"department": "HR", "name": "Brown", "salary": 50000}),
1417.                 Detail(value={"department": "HR", "name": "Smith", "salary": 55000}),
1418.                 Detail(value={"department": "PR", "name": "Moore", "salary": 90000}),
1419.             ]
1420.         )
1421.         tests = [
1422.             (KeyTransform("department", "value"), KeyTransform("name", "value")),
1423.             (F("value__department"), F("value__name")),
1424.         ]
1425.         for partition_by, order_by in tests:
1426.             with self.subTest(partition_by=partition_by, order_by=order_by):
1427.                 qs = Detail.objects.annotate(
1428.                     department_sum=Window(
1429.                         expression=Sum(
1430.                             Cast(
1431.                                 KeyTextTransform("salary", "value"),
1432.                                 output_field=IntegerField(),
1433.                             )
1434.                         ),
1435.                         partition_by=[partition_by],
1436.                         order_by=[order_by],
1437.                     )
1438.                 ).order_by("value__department", "department_sum")
1439.                 self.assertQuerySetEqual(
1440.                     qs,
1441.                     [
1442.                         ("Brown", "HR", 50000, 50000),
1443.                         ("Smith", "HR", 55000, 105000),
1444.                         ("Nowak", "IT", 32000, 32000),
1445.                         ("Smith", "IT", 37000, 69000),
1446.                         ("Moore", "PR", 90000, 90000),
1447.                     ],
1448.                     lambda entry: (
1449.                         entry.value["name"],
1450.                         entry.value["department"],
1451.                         entry.value["salary"],
1452.                         entry.department_sum,
1453.                     ),
1454.                 )
1455. 
1456.     def test_invalid_start_value_range(self):
1457.         msg = "start argument must be a negative integer, zero, or None, but got '3'."
1458.         with self.assertRaisesMessage(ValueError, msg):
1459.             list(
1460.                 Employee.objects.annotate(
1461.                     test=Window(
1462.                         expression=Sum("salary"),
1463.                         order_by=F("hire_date").asc(),
1464.                         frame=ValueRange(start=3),
1465.                     )
1466.                 )
1467.             )
1468. 
1469.     def test_invalid_end_value_range(self):
1470.         msg = "end argument must be a positive integer, zero, or None, but got '-3'."
1471.         with self.assertRaisesMessage(ValueError, msg):
1472.             list(
1473.                 Employee.objects.annotate(
1474.                     test=Window(
1475.                         expression=Sum("salary"),
1476.                         order_by=F("hire_date").asc(),
1477.                         frame=ValueRange(end=-3),
1478.                     )
1479.                 )
1480.             )
1481. 
1482.     def test_invalid_type_end_value_range(self):
1483.         msg = "end argument must be a positive integer, zero, or None, but got 'a'."
1484.         with self.assertRaisesMessage(ValueError, msg):
1485.             list(
1486.                 Employee.objects.annotate(
1487.                     test=Window(
1488.                         expression=Sum("salary"),
1489.                         order_by=F("hire_date").asc(),
1490.                         frame=ValueRange(end="a"),
1491.                     )
1492.                 )
1493.             )
1494. 
1495.     def test_invalid_type_start_value_range(self):
1496.         msg = "start argument must be a negative integer, zero, or None, but got 'a'."
1497.         with self.assertRaisesMessage(ValueError, msg):
1498.             list(
1499.                 Employee.objects.annotate(
1500.                     test=Window(
1501.                         expression=Sum("salary"),
1502.                         frame=ValueRange(start="a"),
1503.                     )
1504.                 )
1505.             )
1506. 
1507.     def test_invalid_type_end_row_range(self):
1508.         msg = "end argument must be a positive integer, zero, or None, but got 'a'."
1509.         with self.assertRaisesMessage(ValueError, msg):
1510.             list(
1511.                 Employee.objects.annotate(
1512.                     test=Window(
1513.                         expression=Sum("salary"),
1514.                         frame=RowRange(end="a"),
1515.                     )
1516.                 )
1517.             )
1518. 
1519.     @skipUnlessDBFeature("only_supports_unbounded_with_preceding_and_following")
1520.     def test_unsupported_range_frame_start(self):
1521.         msg = (
1522.             "%s only supports UNBOUNDED together with PRECEDING and FOLLOWING."
1523.             % connection.display_name
1524.         )
1525.         with self.assertRaisesMessage(NotSupportedError, msg):
1526.             list(
1527.                 Employee.objects.annotate(
1528.                     test=Window(
1529.                         expression=Sum("salary"),
1530.                         order_by=F("hire_date").asc(),
1531.                         frame=ValueRange(start=-1),
1532.                     )
1533.                 )
1534.             )
1535. 
1536.     @skipUnlessDBFeature("only_supports_unbounded_with_preceding_and_following")
1537.     def test_unsupported_range_frame_end(self):
1538.         msg = (
1539.             "%s only supports UNBOUNDED together with PRECEDING and FOLLOWING."
1540.             % connection.display_name
1541.         )
1542.         with self.assertRaisesMessage(NotSupportedError, msg):
1543.             list(
1544.                 Employee.objects.annotate(
1545.                     test=Window(
1546.                         expression=Sum("salary"),
1547.                         order_by=F("hire_date").asc(),
1548.                         frame=ValueRange(end=1),
1549.                     )
1550.                 )
1551.             )
1552. 
1553.     def test_invalid_type_start_row_range(self):
1554.         msg = "start argument must be a negative integer, zero, or None, but got 'a'."
1555.         with self.assertRaisesMessage(ValueError, msg):
1556.             list(
1557.                 Employee.objects.annotate(
1558.                     test=Window(
1559.                         expression=Sum("salary"),
1560.                         order_by=F("hire_date").asc(),
1561.                         frame=RowRange(start="a"),
1562.                     )
1563.                 )
1564.             )
1565. 
1566.     def test_invalid_filter(self):
1567.         msg = (
1568.             "Heterogeneous disjunctive predicates against window functions are not "
1569.             "implemented when performing conditional aggregation."
1570.         )
1571.         qs = Employee.objects.annotate(
1572.             window=Window(Rank()),
1573.             past_dept_cnt=Count("past_departments"),
1574.         )
1575.         with self.assertRaisesMessage(NotImplementedError, msg):
1576.             list(qs.filter(Q(window=1) | Q(department="Accounting")))
1577.         with self.assertRaisesMessage(NotImplementedError, msg):
1578.             list(qs.exclude(window=1, department="Accounting"))
1579. 
1580. 
1581. class WindowUnsupportedTests(TestCase):
1582.     def test_unsupported_backend(self):
1583.         msg = "This backend does not support window expressions."
1584.         with mock.patch.object(connection.features, "supports_over_clause", False):
1585.             with self.assertRaisesMessage(NotSupportedError, msg):
1586.                 Employee.objects.annotate(
1587.                     dense_rank=Window(expression=DenseRank())
1588.                 ).get()
1589. 
1590.     def test_filter_subquery(self):
1591.         qs = Employee.objects.annotate(
1592.             department_salary_rank=Window(
1593.                 Rank(), partition_by="department", order_by="-salary"
1594.             )
1595.         )
1596.         msg = (
1597.             "Referencing outer query window expression is not supported: "
1598.             "department_salary_rank."
1599.         )
1600.         with self.assertRaisesMessage(NotSupportedError, msg):
1601.             qs.annotate(
1602.                 employee_name=Subquery(
1603.                     Employee.objects.filter(
1604.                         age=OuterRef("department_salary_rank")
1605.                     ).values("name")[:1]
1606.                 )
1607.             )
1608. 
1609. 
1610. class NonQueryWindowTests(SimpleTestCase):
1611.     def test_window_repr(self):
1612.         self.assertEqual(
1613.             repr(Window(expression=Sum("salary"), partition_by="department")),
1614.             "<Window: Sum(F(salary)) OVER (PARTITION BY F(department))>",
1615.         )
1616.         self.assertEqual(
1617.             repr(Window(expression=Avg("salary"), order_by=F("department").asc())),
1618.             "<Window: Avg(F(salary)) OVER (OrderByList(OrderBy(F(department), "
1619.             "descending=False)))>",
1620.         )
1621. 
1622.     def test_window_frame_repr(self):
1623.         self.assertEqual(
1624.             repr(RowRange(start=-1)),
1625.             "<RowRange: ROWS BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING>",
1626.         )
1627.         self.assertEqual(
1628.             repr(ValueRange(start=None, end=1)),
1629.             "<ValueRange: RANGE BETWEEN UNBOUNDED PRECEDING AND 1 FOLLOWING>",
1630.         )
1631.         self.assertEqual(
1632.             repr(ValueRange(start=0, end=0)),
1633.             "<ValueRange: RANGE BETWEEN CURRENT ROW AND CURRENT ROW>",
1634.         )
1635.         self.assertEqual(
1636.             repr(RowRange(start=0, end=0)),
1637.             "<RowRange: ROWS BETWEEN CURRENT ROW AND CURRENT ROW>",
1638.         )
1639. 
1640.     def test_empty_group_by_cols(self):
1641.         window = Window(expression=Sum("pk"))
1642.         self.assertEqual(window.get_group_by_cols(), [])
1643.         self.assertFalse(window.contains_aggregate)
1644. 
1645.     def test_frame_empty_group_by_cols(self):
1646.         frame = WindowFrame()
1647.         self.assertEqual(frame.get_group_by_cols(), [])
1648. 
1649.     def test_frame_window_frame_notimplemented(self):
1650.         frame = WindowFrame()
1651.         msg = "Subclasses must implement window_frame_start_end()."
1652.         with self.assertRaisesMessage(NotImplementedError, msg):
1653.             frame.window_frame_start_end(None, None, None)
1654. 
1655.     def test_invalid_order_by(self):
1656.         msg = (
1657.             "Window.order_by must be either a string reference to a field, an "
1658.             "expression, or a list or tuple of them."
1659.         )
1660.         with self.assertRaisesMessage(ValueError, msg):
1661.             Window(expression=Sum("power"), order_by={"-horse"})
1662. 
1663.     def test_invalid_source_expression(self):
1664.         msg = "Expression 'Upper' isn't compatible with OVER clauses."
1665.         with self.assertRaisesMessage(ValueError, msg):
1666.             Window(expression=Upper("name"))

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-23 01:47:36,408 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases that demonstrate a bug where aggregating over a window function fails. The provided context from `tests/aggregation/tests.py` and `tests/expressions_window/tests.py` shows tests for aggregation over annotations and tests for window functions separately, but not combined. The bug fix is in `django/db/models/sql/query.py`. The corresponding test file `tests/queries/tests.py` is likely to contain tests for complex query constructions, including aggregation over window functions, and may even contain the regression test for this specific bug.' query='Please provide the full content of tests/queries/tests.py.' extra_requirements='' purpose='This file is the most likely place to find test cases that specifically target the interaction between aggregation and window functions at the query construction level, which is where the bug occurs.'
2025-12-23 01:47:36,409 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/queries/tests.py.
2025-12-23 01:47:36,409 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-23 01:47:36,410 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-23 01:47:36,411 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-23 01:47:36,411 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/queries/tests.py.
Purpose: This file is the most likely place to find test cases that specifically target the interaction between aggregation and window functions at the query construction level, which is where the bug occurs.
2025-12-23 01:47:39,388 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of the `tests/queries/tests.py` file. This file likely contains the test cases that are relevant to the bug you are investigating, specifically those that involve both aggregation and window functions. I will now analyze the content of this file to identify the specific tests that can help us understand and fix the bug.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/queries/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2108, 'candidates_token_count': 91, 'total_token_count': 2319, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2108}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 91}], 'thoughts_token_count': 120, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.10910654591990042, 'model_name': 'gemini-2.5-pro'} id='run--f1f55c4d-1ecb-4897-8222-35b10391dc69-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/queries/tests.py'}, 'id': '8fcfe871-0284-45ff-8506-b8d2da1bf160', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2108, 'output_tokens': 91, 'total_tokens': 2319, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 120}}
2025-12-23 01:47:42,393 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have successfully retrieved the content of `tests/queries/tests.py`, which appears to contain a comprehensive set of tests for Django's query functionality. My next step is to locate the specific tests that are most relevant to the user's issue, which involves the interaction of aggregation and window functions. To do this, I will now search for occurrences of `Count` within the file to identify test cases that utilize aggregation." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "Count", "relative_path": "tests/queries/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9903, 'candidates_token_count': 118, 'total_token_count': 10106, 'cached_content_token_count': 1853, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9903}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1853}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 118}], 'thoughts_token_count': 85}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2375908706147792, 'model_name': 'gemini-2.5-pro'} id='run--f87faa48-ca31-410a-8fc7-d90e547e9f75-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'Count', 'relative_path': 'tests/queries/tests.py'}, 'id': 'f180adb9-d536-46b5-bf57-2562db572ffa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9903, 'output_tokens': 118, 'total_tokens': 10106, 'input_token_details': {'cache_read': 1853}, 'output_token_details': {'reasoning': 85}}
2025-12-23 01:47:46,840 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I've located several test classes that use `Count` for aggregation, including `QuerysetOrderedTests`, which seems particularly relevant as it tests ordering after annotation. To get a clearer picture, I am now retrieving the full code for the `QuerysetOrderedTests` class. This will help determine if these tests are close to what is needed or if they need to be modified." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 2302.0, "end_line": 2337.0, "relative_path": "tests/queries/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12005, 'candidates_token_count': 106, 'total_token_count': 12307, 'cached_content_token_count': 9270, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12005}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9270}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 106}], 'thoughts_token_count': 196}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3250665844611402, 'model_name': 'gemini-2.5-pro'} id='run--1f567375-01af-4dca-acac-adf74c79b5ea-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 2302.0, 'end_line': 2337.0, 'relative_path': 'tests/queries/tests.py'}, 'id': 'c9eda882-c4c4-4340-a4bb-51478330b2ee', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12005, 'output_tokens': 106, 'total_tokens': 12307, 'input_token_details': {'cache_read': 9270}, 'output_token_details': {'reasoning': 196}}
2025-12-23 01:47:50,928 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have examined the `QuerysetOrderedTests` and determined that while it tests aggregation, it does not include window functions. To find tests that cover both aggregation and window functions, I will now search the same file, `tests/queries/tests.py`, for the keyword "Window" to locate any relevant test cases. This will help us pinpoint the exact tests needed to address the bug.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "Window", "relative_path": "tests/queries/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12795, 'candidates_token_count': 112, 'total_token_count': 13121, 'cached_content_token_count': 11121, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12795}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11121}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 112}], 'thoughts_token_count': 214}, 'finish_reason': 'STOP', 'avg_logprobs': -0.28817871638706755, 'model_name': 'gemini-2.5-pro'} id='run--f9b53545-d5aa-46ea-a8ed-9cd73177cad7-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'Window', 'relative_path': 'tests/queries/tests.py'}, 'id': '7526bd43-8d97-49c2-9100-189dd91a18c8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12795, 'output_tokens': 112, 'total_tokens': 13121, 'input_token_details': {'cache_read': 11121}, 'output_token_details': {'reasoning': 214}}
2025-12-23 01:47:54,814 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have searched for "Window" in `tests/queries/tests.py` and found no results, which suggests there are no tests for window functions in that file. To find the required tests, I will now broaden my search to the entire codebase. I will start by looking for any files that mention "Window" to identify potential candidates that might contain the tests I need.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12939, 'candidates_token_count': 77, 'total_token_count': 13203, 'cached_content_token_count': 11106, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12939}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11106}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 77}], 'thoughts_token_count': 187}, 'finish_reason': 'STOP', 'avg_logprobs': -0.37859872099641084, 'model_name': 'gemini-2.5-pro'} id='run--9d428a9c-be34-4cba-b1bb-902207f51edd-0' usage_metadata={'input_tokens': 12939, 'output_tokens': 77, 'total_tokens': 13203, 'input_token_details': {'cache_read': 11106}, 'output_token_details': {'reasoning': 187}}
2025-12-23 01:47:54,817 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/queries/tests.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
This file is the most likely place to find test cases that specifically target the interaction between aggregation and window functions at the query construction level, which is where the bug occurs.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/queries/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. import sys
4. import unittest
5. from operator import attrgetter
6. from threading import Lock
7. 
8. from django.core.exceptions import EmptyResultSet, FieldError, FullResultSet
9. from django.db import DEFAULT_DB_ALIAS, connection
10. from django.db.models import CharField, Count, Exists, F, Max, OuterRef, Q
11. from django.db.models.expressions import RawSQL
12. from django.db.models.functions import ExtractYear, Length, LTrim
13. from django.db.models.sql.constants import LOUTER
14. from django.db.models.sql.where import AND, OR, NothingNode, WhereNode
15. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
16. from django.test.utils import CaptureQueriesContext, register_lookup
17. 
18. from .models import (
19.     FK1,
20.     Annotation,
21.     Article,
22.     Author,
23.     BaseA,
24.     BaseUser,
25.     Book,
26.     CategoryItem,
27.     CategoryRelationship,
28.     Celebrity,
29.     Channel,
30.     Chapter,
31.     Child,
32.     ChildObjectA,
33.     Classroom,
34.     CommonMixedCaseForeignKeys,
35.     Company,
36.     Cover,
37.     CustomPk,
38.     CustomPkTag,
39.     DateTimePK,
40.     Detail,
41.     DumbCategory,
42.     Eaten,
43.     Employment,
44.     ExtraInfo,
45.     Fan,
46.     Food,
47.     Identifier,
48.     Individual,
49.     Item,
50.     Job,
51.     JobResponsibilities,
52.     Join,
53.     LeafA,
54.     LeafB,
55.     LoopX,
56.     LoopZ,
57.     ManagedModel,
58.     Member,
59.     MixedCaseDbColumnCategoryItem,
60.     MixedCaseFieldCategoryItem,
61.     ModelA,
62.     ModelB,
63.     ModelC,
64.     ModelD,
65.     MyObject,
66.     NamedCategory,
67.     Node,
68.     Note,
69.     NullableName,
70.     Number,
71.     ObjectA,
72.     ObjectB,
73.     ObjectC,
74.     OneToOneCategory,
75.     Order,
76.     OrderItem,
77.     Page,
78.     Paragraph,
79.     Person,
80.     Plaything,
81.     PointerA,
82.     Program,
83.     ProxyCategory,
84.     ProxyObjectA,
85.     ProxyObjectB,
86.     Ranking,
87.     Related,
88.     RelatedIndividual,
89.     RelatedObject,
90.     Report,
91.     ReportComment,
92.     ReservedName,
93.     Responsibility,
94.     School,
95.     SharedConnection,
96.     SimpleCategory,
97.     SingleObject,
98.     SpecialCategory,
99.     Staff,
100.     StaffUser,
101.     Student,
102.     Tag,
103.     Task,
104.     Teacher,
105.     Ticket21203Child,
106.     Ticket21203Parent,
107.     Ticket23605A,
108.     Ticket23605B,
109.     Ticket23605C,
110.     TvChef,
111.     Valid,
112.     X,
113. )
114. 
115. 
116. class Queries1Tests(TestCase):
117.     @classmethod
118.     def setUpTestData(cls):
119.         cls.nc1 = generic = NamedCategory.objects.create(name="Generic")
120.         cls.t1 = Tag.objects.create(name="t1", category=generic)
121.         cls.t2 = Tag.objects.create(name="t2", parent=cls.t1, category=generic)
122.         cls.t3 = Tag.objects.create(name="t3", parent=cls.t1)
123.         cls.t4 = Tag.objects.create(name="t4", parent=cls.t3)
124.         cls.t5 = Tag.objects.create(name="t5", parent=cls.t3)
125. 
126.         cls.n1 = Note.objects.create(note="n1", misc="foo", id=1)
127.         cls.n2 = Note.objects.create(note="n2", misc="bar", id=2)
128.         cls.n3 = Note.objects.create(note="n3", misc="foo", id=3, negate=False)
129. 
130.         cls.ann1 = Annotation.objects.create(name="a1", tag=cls.t1)
131.         cls.ann1.notes.add(cls.n1)
132.         ann2 = Annotation.objects.create(name="a2", tag=cls.t4)
133.         ann2.notes.add(cls.n2, cls.n3)
134. 
135.         # Create these out of order so that sorting by 'id' will be different to sorting
136.         # by 'info'. Helps detect some problems later.
137.         cls.e2 = ExtraInfo.objects.create(
138.             info="e2", note=cls.n2, value=41, filterable=False
139.         )
140.         e1 = ExtraInfo.objects.create(info="e1", note=cls.n1, value=42)
141. 
142.         cls.a1 = Author.objects.create(name="a1", num=1001, extra=e1)
143.         cls.a2 = Author.objects.create(name="a2", num=2002, extra=e1)
144.         cls.a3 = Author.objects.create(name="a3", num=3003, extra=cls.e2)
145.         cls.a4 = Author.objects.create(name="a4", num=4004, extra=cls.e2)
146. 
147.         cls.time1 = datetime.datetime(2007, 12, 19, 22, 25, 0)
148.         cls.time2 = datetime.datetime(2007, 12, 19, 21, 0, 0)
149.         time3 = datetime.datetime(2007, 12, 20, 22, 25, 0)
150.         time4 = datetime.datetime(2007, 12, 20, 21, 0, 0)
151.         cls.i1 = Item.objects.create(
152.             name="one",
153.             created=cls.time1,
154.             modified=cls.time1,
155.             creator=cls.a1,
156.             note=cls.n3,
157.         )
158.         cls.i1.tags.set([cls.t1, cls.t2])
159.         cls.i2 = Item.objects.create(
160.             name="two", created=cls.time2, creator=cls.a2, note=cls.n2
161.         )
162.         cls.i2.tags.set([cls.t1, cls.t3])
163.         cls.i3 = Item.objects.create(
164.             name="three", created=time3, creator=cls.a2, note=cls.n3
165.         )
166.         cls.i4 = Item.objects.create(
167.             name="four", created=time4, creator=cls.a4, note=cls.n3
168.         )
169.         cls.i4.tags.set([cls.t4])
170. 
171.         cls.r1 = Report.objects.create(name="r1", creator=cls.a1)
172.         cls.r2 = Report.objects.create(name="r2", creator=cls.a3)
173.         cls.r3 = Report.objects.create(name="r3")
174. 
175.         # Ordering by 'rank' gives us rank2, rank1, rank3. Ordering by the Meta.ordering
176.         # will be rank3, rank2, rank1.
177.         cls.rank1 = Ranking.objects.create(rank=2, author=cls.a2)
178. 
179.         cls.c1 = Cover.objects.create(title="first", item=cls.i4)
180.         cls.c2 = Cover.objects.create(title="second", item=cls.i2)
181. 
182.     def test_subquery_condition(self):
183.         qs1 = Tag.objects.filter(pk__lte=0)
184.         qs2 = Tag.objects.filter(parent__in=qs1)
185.         qs3 = Tag.objects.filter(parent__in=qs2)
186.         self.assertEqual(qs3.query.subq_aliases, {"T", "U", "V"})
187.         self.assertIn("v0", str(qs3.query).lower())
188.         qs4 = qs3.filter(parent__in=qs1)
189.         self.assertEqual(qs4.query.subq_aliases, {"T", "U", "V"})
190.         # It is possible to reuse U for the second subquery, no need to use W.
191.         self.assertNotIn("w0", str(qs4.query).lower())
192.         # So, 'U0."id"' is referenced in SELECT and WHERE twice.
193.         self.assertEqual(str(qs4.query).lower().count("u0."), 4)
194. 
195.     def test_ticket1050(self):
196.         self.assertSequenceEqual(
197.             Item.objects.filter(tags__isnull=True),
198.             [self.i3],
199.         )
200.         self.assertSequenceEqual(
201.             Item.objects.filter(tags__id__isnull=True),
202.             [self.i3],
203.         )
204. 
205.     def test_ticket1801(self):
206.         self.assertSequenceEqual(
207.             Author.objects.filter(item=self.i2),
208.             [self.a2],
209.         )
210.         self.assertSequenceEqual(
211.             Author.objects.filter(item=self.i3),
212.             [self.a2],
213.         )
214.         self.assertSequenceEqual(
215.             Author.objects.filter(item=self.i2) & Author.objects.filter(item=self.i3),
216.             [self.a2],
217.         )
218. 
219.     def test_ticket2306(self):
220.         # Checking that no join types are "left outer" joins.
221.         query = Item.objects.filter(tags=self.t2).query
222.         self.assertNotIn(LOUTER, [x.join_type for x in query.alias_map.values()])
223. 
224.         self.assertSequenceEqual(
225.             Item.objects.filter(Q(tags=self.t1)).order_by("name"),
226.             [self.i1, self.i2],
227.         )
228.         self.assertSequenceEqual(
229.             Item.objects.filter(Q(tags=self.t1)).filter(Q(tags=self.t2)),
230.             [self.i1],
231.         )
232.         self.assertSequenceEqual(
233.             Item.objects.filter(Q(tags=self.t1)).filter(
234.                 Q(creator__name="fred") | Q(tags=self.t2)
235.             ),
236.             [self.i1],
237.         )
238. 
239.         # Each filter call is processed "at once" against a single table, so this is
240.         # different from the previous example as it tries to find tags that are two
241.         # things at once (rather than two tags).
242.         self.assertSequenceEqual(
243.             Item.objects.filter(Q(tags=self.t1) & Q(tags=self.t2)), []
244.         )
245.         self.assertSequenceEqual(
246.             Item.objects.filter(
247.                 Q(tags=self.t1), Q(creator__name="fred") | Q(tags=self.t2)
248.             ),
249.             [],
250.         )
251. 
252.         qs = Author.objects.filter(ranking__rank=2, ranking__id=self.rank1.id)
253.         self.assertSequenceEqual(list(qs), [self.a2])
254.         self.assertEqual(2, qs.query.count_active_tables(), 2)
255.         qs = Author.objects.filter(ranking__rank=2).filter(ranking__id=self.rank1.id)
256.         self.assertEqual(qs.query.count_active_tables(), 3)
257. 
258.     def test_ticket4464(self):
259.         self.assertSequenceEqual(
260.             Item.objects.filter(tags=self.t1).filter(tags=self.t2),
261.             [self.i1],
262.         )
263.         self.assertSequenceEqual(
264.             Item.objects.filter(tags__in=[self.t1, self.t2])
265.             .distinct()
266.             .order_by("name"),
267.             [self.i1, self.i2],
268.         )
269.         self.assertSequenceEqual(
270.             Item.objects.filter(tags__in=[self.t1, self.t2]).filter(tags=self.t3),
271.             [self.i2],
272.         )
273. 
274.         # Make sure .distinct() works with slicing (this was broken in Oracle).
275.         self.assertSequenceEqual(
276.             Item.objects.filter(tags__in=[self.t1, self.t2]).order_by("name")[:3],
277.             [self.i1, self.i1, self.i2],
278.         )
279.         self.assertSequenceEqual(
280.             Item.objects.filter(tags__in=[self.t1, self.t2])
281.             .distinct()
282.             .order_by("name")[:3],
283.             [self.i1, self.i2],
284.         )
285. 
286.     def test_tickets_2080_3592(self):
287.         self.assertSequenceEqual(
288.             Author.objects.filter(item__name="one") | Author.objects.filter(name="a3"),
289.             [self.a1, self.a3],
290.         )
291.         self.assertSequenceEqual(
292.             Author.objects.filter(Q(item__name="one") | Q(name="a3")),
293.             [self.a1, self.a3],
294.         )
295.         self.assertSequenceEqual(
296.             Author.objects.filter(Q(name="a3") | Q(item__name="one")),
297.             [self.a1, self.a3],
298.         )
299.         self.assertSequenceEqual(
300.             Author.objects.filter(Q(item__name="three") | Q(report__name="r3")),
301.             [self.a2],
302.         )
303. 
304.     def test_ticket6074(self):
305.         # Merging two empty result sets shouldn't leave a queryset with no constraints
306.         # (which would match everything).
307.         self.assertSequenceEqual(Author.objects.filter(Q(id__in=[])), [])
308.         self.assertSequenceEqual(Author.objects.filter(Q(id__in=[]) | Q(id__in=[])), [])
309. 
310.     def test_tickets_1878_2939(self):
311.         self.assertEqual(Item.objects.values("creator").distinct().count(), 3)
312. 
313.         # Create something with a duplicate 'name' so that we can test multi-column
314.         # cases (which require some tricky SQL transformations under the covers).
315.         xx = Item(name="four", created=self.time1, creator=self.a2, note=self.n1)
316.         xx.save()
317.         self.assertEqual(
318.             Item.objects.exclude(name="two")
319.             .values("creator", "name")
320.             .distinct()
321.             .count(),
322.             4,
323.         )
324.         self.assertEqual(
325.             (
326.                 Item.objects.exclude(name="two")
327.                 .extra(select={"foo": "%s"}, select_params=(1,))
328.                 .values("creator", "name", "foo")
329.                 .distinct()
330.                 .count()
331.             ),
332.             4,
333.         )
334.         self.assertEqual(
335.             (
336.                 Item.objects.exclude(name="two")
337.                 .extra(select={"foo": "%s"}, select_params=(1,))
338.                 .values("creator", "name")
339.                 .distinct()
340.                 .count()
341.             ),
342.             4,
343.         )
344.         xx.delete()
345. 
346.     def test_ticket7323(self):
347.         self.assertEqual(Item.objects.values("creator", "name").count(), 4)
348. 
349.     def test_ticket2253(self):
350.         q1 = Item.objects.order_by("name")
351.         q2 = Item.objects.filter(id=self.i1.id)
352.         self.assertSequenceEqual(q1, [self.i4, self.i1, self.i3, self.i2])
353.         self.assertSequenceEqual(q2, [self.i1])
354.         self.assertSequenceEqual(
355.             (q1 | q2).order_by("name"),
356.             [self.i4, self.i1, self.i3, self.i2],
357.         )
358.         self.assertSequenceEqual((q1 & q2).order_by("name"), [self.i1])
359. 
360.         q1 = Item.objects.filter(tags=self.t1)
361.         q2 = Item.objects.filter(note=self.n3, tags=self.t2)
362.         q3 = Item.objects.filter(creator=self.a4)
363.         self.assertSequenceEqual(
364.             ((q1 & q2) | q3).order_by("name"),
365.             [self.i4, self.i1],
366.         )
367. 
368.     def test_order_by_tables(self):
369.         q1 = Item.objects.order_by("name")
370.         q2 = Item.objects.filter(id=self.i1.id)
371.         list(q2)
372.         combined_query = (q1 & q2).order_by("name").query
373.         self.assertEqual(
374.             len(
375.                 [
376.                     t
377.                     for t in combined_query.alias_map
378.                     if combined_query.alias_refcount[t]
379.                 ]
380.             ),
381.             1,
382.         )
383. 
384.     def test_order_by_join_unref(self):
385.         """
386.         This test is related to the above one, testing that there aren't
387.         old JOINs in the query.
388.         """
389.         qs = Celebrity.objects.order_by("greatest_fan__fan_of")
390.         self.assertIn("OUTER JOIN", str(qs.query))
391.         qs = qs.order_by("id")
392.         self.assertNotIn("OUTER JOIN", str(qs.query))
393. 
394.     def test_order_by_related_field_transform(self):
395.         extra_12 = ExtraInfo.objects.create(
396.             info="extra 12",
397.             date=DateTimePK.objects.create(date=datetime.datetime(2021, 12, 10)),
398.         )
399.         extra_11 = ExtraInfo.objects.create(
400.             info="extra 11",
401.             date=DateTimePK.objects.create(date=datetime.datetime(2022, 11, 10)),
402.         )
403.         self.assertSequenceEqual(
404.             ExtraInfo.objects.filter(date__isnull=False).order_by("date__month"),
405.             [extra_11, extra_12],
406.         )
407. 
408.     def test_filter_by_related_field_transform(self):
409.         extra_old = ExtraInfo.objects.create(
410.             info="extra 12",
411.             date=DateTimePK.objects.create(date=datetime.datetime(2020, 12, 10)),
412.         )
413.         ExtraInfo.objects.create(info="extra 11", date=DateTimePK.objects.create())
414.         a5 = Author.objects.create(name="a5", num=5005, extra=extra_old)
415. 
416.         fk_field = ExtraInfo._meta.get_field("date")
417.         with register_lookup(fk_field, ExtractYear):
418.             self.assertSequenceEqual(
419.                 ExtraInfo.objects.filter(date__year=2020),
420.                 [extra_old],
421.             )
422.             self.assertSequenceEqual(
423.                 Author.objects.filter(extra__date__year=2020), [a5]
424.             )
425. 
426.     def test_filter_by_related_field_nested_transforms(self):
427.         extra = ExtraInfo.objects.create(info=" extra")
428.         a5 = Author.objects.create(name="a5", num=5005, extra=extra)
429.         info_field = ExtraInfo._meta.get_field("info")
430.         with register_lookup(info_field, Length), register_lookup(CharField, LTrim):
431.             self.assertSequenceEqual(
432.                 Author.objects.filter(extra__info__ltrim__length=5), [a5]
433.             )
434. 
435.     def test_get_clears_ordering(self):
436.         """
437.         get() should clear ordering for optimization purposes.
438.         """
439.         with CaptureQueriesContext(connection) as captured_queries:
440.             Author.objects.order_by("name").get(pk=self.a1.pk)
441.         self.assertNotIn("order by", captured_queries[0]["sql"].lower())
442. 
443.     def test_tickets_4088_4306(self):
444.         self.assertSequenceEqual(Report.objects.filter(creator=1001), [self.r1])
445.         self.assertSequenceEqual(Report.objects.filter(creator__num=1001), [self.r1])
446.         self.assertSequenceEqual(Report.objects.filter(creator__id=1001), [])
447.         self.assertSequenceEqual(
448.             Report.objects.filter(creator__id=self.a1.id), [self.r1]
449.         )
450.         self.assertSequenceEqual(Report.objects.filter(creator__name="a1"), [self.r1])
451. 
452.     def test_ticket4510(self):
453.         self.assertSequenceEqual(
454.             Author.objects.filter(report__name="r1"),
455.             [self.a1],
456.         )
457. 
458.     def test_ticket7378(self):
459.         self.assertSequenceEqual(self.a1.report_set.all(), [self.r1])
460. 
461.     def test_tickets_5324_6704(self):
462.         self.assertSequenceEqual(
463.             Item.objects.filter(tags__name="t4"),
464.             [self.i4],
465.         )
466.         self.assertSequenceEqual(
467.             Item.objects.exclude(tags__name="t4").order_by("name").distinct(),
468.             [self.i1, self.i3, self.i2],
469.         )
470.         self.assertSequenceEqual(
471.             Item.objects.exclude(tags__name="t4").order_by("name").distinct().reverse(),
472.             [self.i2, self.i3, self.i1],
473.         )
474.         self.assertSequenceEqual(
475.             Author.objects.exclude(item__name="one").distinct().order_by("name"),
476.             [self.a2, self.a3, self.a4],
477.         )
478. 
479.         # Excluding across a m2m relation when there is more than one related
480.         # object associated was problematic.
481.         self.assertSequenceEqual(
482.             Item.objects.exclude(tags__name="t1").order_by("name"),
483.             [self.i4, self.i3],
484.         )
485.         self.assertSequenceEqual(
486.             Item.objects.exclude(tags__name="t1").exclude(tags__name="t4"),
487.             [self.i3],
488.         )
489. 
490.         # Excluding from a relation that cannot be NULL should not use outer joins.
491.         query = Item.objects.exclude(creator__in=[self.a1, self.a2]).query
492.         self.assertNotIn(LOUTER, [x.join_type for x in query.alias_map.values()])
493. 
494.         # Similarly, when one of the joins cannot possibly, ever, involve NULL
495.         # values (Author -> ExtraInfo, in the following), it should never be
496.         # promoted to a left outer join. So the following query should only
497.         # involve one "left outer" join (Author -> Item is 0-to-many).
498.         qs = Author.objects.filter(id=self.a1.id).filter(
499.             Q(extra__note=self.n1) | Q(item__note=self.n3)
500.         )


File: tests/queries/tests.py
Line number range: 2216 - 2220
Content:
class GeneratorExpressionTests(SimpleTestCase):
    def test_ticket10432(self):
        # Using an empty iterator as the rvalue for an "__in"
        # lookup is legal.
        self.assertCountEqual(Note.objects.filter(pk__in=iter(())), [])


File: tests/queries/tests.py
Line number range: 2302 - 2337
Content:
2302. class QuerysetOrderedTests(unittest.TestCase):
2303.     """
2304.     Tests for the Queryset.ordered attribute.
2305.     """
2306. 
2307.     def test_no_default_or_explicit_ordering(self):
2308.         self.assertIs(Annotation.objects.all().ordered, False)
2309. 
2310.     def test_cleared_default_ordering(self):
2311.         self.assertIs(Tag.objects.all().ordered, True)
2312.         self.assertIs(Tag.objects.order_by().ordered, False)
2313. 
2314.     def test_explicit_ordering(self):
2315.         self.assertIs(Annotation.objects.order_by("id").ordered, True)
2316. 
2317.     def test_empty_queryset(self):
2318.         self.assertIs(Annotation.objects.none().ordered, True)
2319. 
2320.     def test_order_by_extra(self):
2321.         self.assertIs(Annotation.objects.extra(order_by=["id"]).ordered, True)
2322. 
2323.     def test_annotated_ordering(self):
2324.         qs = Annotation.objects.annotate(num_notes=Count("notes"))
2325.         self.assertIs(qs.ordered, False)
2326.         self.assertIs(qs.order_by("num_notes").ordered, True)
2327. 
2328.     def test_annotated_default_ordering(self):
2329.         qs = Tag.objects.annotate(num_notes=Count("pk"))
2330.         self.assertIs(qs.ordered, False)
2331.         self.assertIs(qs.order_by("name").ordered, True)
2332. 
2333.     def test_annotated_values_default_ordering(self):
2334.         qs = Tag.objects.values("name").annotate(num_notes=Count("pk"))
2335.         self.assertIs(qs.ordered, False)
2336.         self.assertIs(qs.order_by("name").ordered, True)


File: tests/queries/tests.py
Line number range: 2620 - 2639
Content:
class EmptyQuerySetTests(SimpleTestCase):
    def test_emptyqueryset_values(self):
        # #14366 -- Calling .values() on an empty QuerySet and then cloning
        # that should not cause an error
        self.assertCountEqual(Number.objects.none().values("num").order_by("num"), [])

    def test_values_subquery(self):
        self.assertCountEqual(
            Number.objects.filter(pk__in=Number.objects.none().values("pk")), []
        )
        self.assertCountEqual(
            Number.objects.filter(pk__in=Number.objects.none().values_list("pk")), []
        )

    def test_ticket_19151(self):
        # #19151 -- Calling .values() or .values_list() on an empty QuerySet
        # should return an empty QuerySet and not cause an error.
        q = Author.objects.none()
        self.assertCountEqual(q.values(), [])
        self.assertCountEqual(q.values_list(), [])


File: tests/queries/tests.py
Line number range: 3828 - 3882
Content:
class JoinReuseTest(TestCase):
    """
    The queries reuse joins sensibly (for example, direct joins
    are always reused).
    """

    def test_fk_reuse(self):
        qs = Annotation.objects.filter(tag__name="foo").filter(tag__name="bar")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_select_related(self):
        qs = Annotation.objects.filter(tag__name="foo").select_related("tag")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_annotation(self):
        qs = Annotation.objects.filter(tag__name="foo").annotate(cnt=Count("tag__name"))
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_disjunction(self):
        qs = Annotation.objects.filter(Q(tag__name="foo") | Q(tag__name="bar"))
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_fk_reuse_order_by(self):
        qs = Annotation.objects.filter(tag__name="foo").order_by("tag__name")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_revo2o_reuse(self):
        qs = Detail.objects.filter(member__name="foo").filter(member__name="foo")
        self.assertEqual(str(qs.query).count("JOIN"), 1)

    def test_revfk_noreuse(self):
        qs = Author.objects.filter(report__name="r4").filter(report__name="r1")
        self.assertEqual(str(qs.query).count("JOIN"), 2)

    def test_inverted_q_across_relations(self):
        """
        When a trimmable join is specified in the query (here school__), the
        ORM detects it and removes unnecessary joins. The set of reusable joins
        are updated after trimming the query so that other lookups don't
        consider that the outer query's filters are in effect for the subquery
        (#26551).
        """
        springfield_elementary = School.objects.create()
        hogward = School.objects.create()
        Student.objects.create(school=springfield_elementary)
        hp = Student.objects.create(school=hogward)
        Classroom.objects.create(school=hogward, name="Potion")
        Classroom.objects.create(school=springfield_elementary, name="Main")
        qs = Student.objects.filter(
            ~(
                Q(school__classroom__name="Main")
                & Q(school__classroom__has_blackboard=None)
            )
        )
        self.assertSequenceEqual(qs, [hp])

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-23 01:48:20,557 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of 'tests/queries/tests.py'.\n2. Extended relevance:\n   - This context is a part of the requested file. Providing all available parts of the file is necessary to fulfill the request for the 'full content' as completely as possible.", relative_path='tests/queries/tests.py', start_line=1, end_line=500), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of 'tests/queries/tests.py'.\n2. Extended relevance:\n   - This context is a part of the requested file. Providing all available parts of the file is necessary to fulfill the request for the 'full content' as completely as possible.", relative_path='tests/queries/tests.py', start_line=2216, end_line=2220), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of 'tests/queries/tests.py'.\n2. Extended relevance:\n   - This context is a part of the requested file. Providing all available parts of the file is necessary to fulfill the request for the 'full content' as completely as possible.", relative_path='tests/queries/tests.py', start_line=2302, end_line=2337), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of 'tests/queries/tests.py'.\n2. Extended relevance:\n   - This context is a part of the requested file. Providing all available parts of the file is necessary to fulfill the request for the 'full content' as completely as possible.", relative_path='tests/queries/tests.py', start_line=2620, end_line=2639), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user explicitly asked for the full content of 'tests/queries/tests.py'.\n2. Extended relevance:\n   - This context is a part of the requested file. Providing all available parts of the file is necessary to fulfill the request for the 'full content' as completely as possible.", relative_path='tests/queries/tests.py', start_line=3828, end_line=3882)]
2025-12-23 01:48:20,563 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 5 contexts to memory for query: Please provide the full content of tests/queries/tests.py.
2025-12-23 01:48:20,563 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-23 01:48:20,563 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-23 01:48:20,564 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 5 new contexts to 2 existing contexts
2025-12-23 01:48:20,564 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 7 total contexts (removed 0 duplicates)
2025-12-23 01:48:20,564 - thread-137747478062784.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-23 01:48:20,565 - thread-137747478062784.prometheus_context_collector - INFO - Successfully retrieved 7 context snippets
