2025-12-22 23:48:58,954 - thread-127860744382144.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Use simplified paths for deconstruct of expressions

Description: Description
	
Previously F() deconstructed to: django.db.models.expressions.F(). But since it can also be imported from django.db.models, ​PR #14047 changed it to deconstruct to django.db.models.F(). This simplifies generated migration code where it will be referenced only as from django.db import models / models.F().
As Mariusz pointed out on the PR, the same technique can be applied to other expressions, further simplifying generated migrations.

Patch information:
diff --git a/django/db/models/expressions.py b/django/db/models/expressions.py
index 8642e1f151..9705863917 100644
--- a/django/db/models/expressions.py
+++ b/django/db/models/expressions.py
@@ -390,7 +390,7 @@ class BaseExpression:
         return sql, params
 
 
-@deconstructible
+@deconstructible(path='django.db.models.Expression')
 class Expression(BaseExpression, Combinable):
     """An expression that can be combined with other expressions."""
 
@@ -639,6 +639,7 @@ class ResolvedOuterRef(F):
         return []
 
 
+@deconstructible(path='django.db.models.OuterRef')
 class OuterRef(F):
     contains_aggregate = False
 
@@ -651,6 +652,7 @@ class OuterRef(F):
         return self
 
 
+@deconstructible(path='django.db.models.Func')
 class Func(SQLiteNumericMixin, Expression):
     """An SQL function call."""
     function = None
@@ -731,6 +733,7 @@ class Func(SQLiteNumericMixin, Expression):
         return copy
 
 
+@deconstructible(path='django.db.models.Value')
 class Value(SQLiteNumericMixin, Expression):
     """Represent a wrapped value as a node within an expression."""
     # Provide a default value for `for_save` in order to allow unresolved
@@ -912,6 +915,7 @@ class Ref(Expression):
         return [self]
 
 
+@deconstructible(path='django.db.models.ExpressionList')
 class ExpressionList(Func):
     """
     An expression containing multiple expressions. Can be used to provide a
@@ -953,6 +957,7 @@ class OrderByList(Func):
         return super().as_sql(*args, **kwargs)
 
 
+@deconstructible(path='django.db.models.ExpressionWrapper')
 class ExpressionWrapper(SQLiteNumericMixin, Expression):
     """
     An expression that can wrap another expression so that it can provide
@@ -985,6 +990,7 @@ class ExpressionWrapper(SQLiteNumericMixin, Expression):
         return "{}({})".format(self.__class__.__name__, self.expression)
 
 
+@deconstructible(path='django.db.models.When')
 class When(Expression):
     template = 'WHEN %(condition)s THEN %(result)s'
     # This isn't a complete conditional expression, must be used in Case().
@@ -1052,6 +1058,7 @@ class When(Expression):
         return cols
 
 
+@deconstructible(path='django.db.models.Case')
 class Case(SQLiteNumericMixin, Expression):
     """
     An SQL searched CASE expression:
@@ -1133,6 +1140,7 @@ class Case(SQLiteNumericMixin, Expression):
         return super().get_group_by_cols(alias)
 
 
+@deconstructible(path='django.db.models.Subquery')
 class Subquery(BaseExpression, Combinable):
     """
     An explicit subquery. It may contain OuterRef() references to the outer
@@ -1190,6 +1198,7 @@ class Subquery(BaseExpression, Combinable):
         return self.query.get_group_by_cols()
 
 
+@deconstructible(path='django.db.models.Exists')
 class Exists(Subquery):
     template = 'EXISTS(%(subquery)s)'
     output_field = fields.BooleanField()
@@ -1225,6 +1234,7 @@ class Exists(Subquery):
         return sql, params
 
 
+@deconstructible(path='django.db.models.OrderBy')
 class OrderBy(Expression):
     template = '%(expression)s %(ordering)s'
     conditional = False
@@ -1307,6 +1317,7 @@ class OrderBy(Expression):
         self.descending = True
 
 
+@deconstructible(path='django.db.models.Window')
 class Window(SQLiteNumericMixin, Expression):
     template = '%(expression)s OVER (%(window)s)'
     # Although the main expression may either be an aggregate or an
@@ -1412,6 +1423,7 @@ class Window(SQLiteNumericMixin, Expression):
         return []
 
 
+@deconstructible(path='django.db.models.WindowFrame')
 class WindowFrame(Expression):
     """
     Model the frame clause in window expressions. There are two types of frame
@@ -1471,6 +1483,7 @@ class WindowFrame(Expression):
         raise NotImplementedError('Subclasses must implement window_frame_start_end().')
 
 
+@deconstructible(path='django.db.models.RowRange')
 class RowRange(WindowFrame):
     frame_type = 'ROWS'
 
@@ -1478,6 +1491,7 @@ class RowRange(WindowFrame):
         return connection.ops.window_frame_rows_start_end(start, end)
 
 
+@deconstructible(path='django.db.models.ValueRange')
 class ValueRange(WindowFrame):
     frame_type = 'RANGE'
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-22 23:48:59,047 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       └── legend_test.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   ├── custom_sitemap_index.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Use simplified paths for deconstruct of expressions

Description: Description
	
Previously F() deconstructed to: django.db.models.expressions.F(). But since it can also be imported from django.db.models, ​PR #14047 changed it to deconstruct to django.db.models.F(). This simplifies generated migration code where it will be referenced only as from django.db import models / models.F().
As Mariusz pointed out on the PR, the same technique can be applied to other expressions, further simplifying generated migrations.

Patch information:
diff --git a/django/db/models/expressions.py b/django/db/models/expressions.py
index 8642e1f151..9705863917 100644
--- a/django/db/models/expressions.py
+++ b/django/db/models/expressions.py
@@ -390,7 +390,7 @@ class BaseExpression:
         return sql, params
 
 
-@deconstructible
+@deconstructible(path='django.db.models.Expression')
 class Expression(BaseExpression, Combinable):
     """An expression that can be combined with other expressions."""
 
@@ -639,6 +639,7 @@ class ResolvedOuterRef(F):
         return []
 
 
+@deconstructible(path='django.db.models.OuterRef')
 class OuterRef(F):
     contains_aggregate = False
 
@@ -651,6 +652,7 @@ class OuterRef(F):
         return self
 
 
+@deconstructible(path='django.db.models.Func')
 class Func(SQLiteNumericMixin, Expression):
     """An SQL function call."""
     function = None
@@ -731,6 +733,7 @@ class Func(SQLiteNumericMixin, Expression):
         return copy
 
 
+@deconstructible(path='django.db.models.Value')
 class Value(SQLiteNumericMixin, Expression):
     """Represent a wrapped value as a node within an expression."""
     # Provide a default value for `for_save` in order to allow unresolved
@@ -912,6 +915,7 @@ class Ref(Expression):
         return [self]
 
 
+@deconstructible(path='django.db.models.ExpressionList')
 class ExpressionList(Func):
     """
     An expression containing multiple expressions. Can be used to provide a
@@ -953,6 +957,7 @@ class OrderByList(Func):
         return super().as_sql(*args, **kwargs)
 
 
+@deconstructible(path='django.db.models.ExpressionWrapper')
 class ExpressionWrapper(SQLiteNumericMixin, Expression):
     """
     An expression that can wrap another expression so that it can provide
@@ -985,6 +990,7 @@ class ExpressionWrapper(SQLiteNumericMixin, Expression):
         return "{}({})".format(self.__class__.__name__, self.expression)
 
 
+@deconstructible(path='django.db.models.When')
 class When(Expression):
     template = 'WHEN %(condition)s THEN %(result)s'
     # This isn't a complete conditional expression, must be used in Case().
@@ -1052,6 +1058,7 @@ class When(Expression):
         return cols
 
 
+@deconstructible(path='django.db.models.Case')
 class Case(SQLiteNumericMixin, Expression):
     """
     An SQL searched CASE expression:
@@ -1133,6 +1140,7 @@ class Case(SQLiteNumericMixin, Expression):
         return super().get_group_by_cols(alias)
 
 
+@deconstructible(path='django.db.models.Subquery')
 class Subquery(BaseExpression, Combinable):
     """
     An explicit subquery. It may contain OuterRef() references to the outer
@@ -1190,6 +1198,7 @@ class Subquery(BaseExpression, Combinable):
         return self.query.get_group_by_cols()
 
 
+@deconstructible(path='django.db.models.Exists')
 class Exists(Subquery):
     template = 'EXISTS(%(subquery)s)'
     output_field = fields.BooleanField()
@@ -1225,6 +1234,7 @@ class Exists(Subquery):
         return sql, params
 
 
+@deconstructible(path='django.db.models.OrderBy')
 class OrderBy(Expression):
     template = '%(expression)s %(ordering)s'
     conditional = False
@@ -1307,6 +1317,7 @@ class OrderBy(Expression):
         self.descending = True
 
 
+@deconstructible(path='django.db.models.Window')
 class Window(SQLiteNumericMixin, Expression):
     template = '%(expression)s OVER (%(window)s)'
     # Although the main expression may either be an aggregate or an
@@ -1412,6 +1423,7 @@ class Window(SQLiteNumericMixin, Expression):
         return []
 
 
+@deconstructible(path='django.db.models.WindowFrame')
 class WindowFrame(Expression):
     """
     Model the frame clause in window expressions. There are two types of frame
@@ -1471,6 +1483,7 @@ class WindowFrame(Expression):
         raise NotImplementedError('Subclasses must implement window_frame_start_end().')
 
 
+@deconstructible(path='django.db.models.RowRange')
 class RowRange(WindowFrame):
     frame_type = 'ROWS'
 
@@ -1478,6 +1491,7 @@ class RowRange(WindowFrame):
         return connection.ops.window_frame_rows_start_end(start, end)
 
 
+@deconstructible(path='django.db.models.ValueRange')
 class ValueRange(WindowFrame):
     frame_type = 'RANGE'
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-22 23:49:27,609 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find relevant test cases for a patch that simplifies the deconstruction path of expression classes. The goal is to simplify generated migration files. Therefore, I need to examine tests that cover the deconstruction of these expressions during migration generation. The file `tests/migrations/test_autodetector.py` is the most likely place to find such tests, as it tests the component responsible for deconstructing model fields to generate migrations. I need the content of this file to find 3 relevant test cases.' query='Please provide the full content of `tests/migrations/test_autodetector.py`.' extra_requirements='' purpose='I need the content of this file to identify relevant test cases that demonstrate the deconstruction of expression classes in the context of migrations.'
2025-12-22 23:49:27,610 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/migrations/test_autodetector.py`.
2025-12-22 23:49:27,610 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-22 23:49:27,611 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-22 23:49:27,612 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-22 23:49:27,612 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/migrations/test_autodetector.py`.
Purpose: I need the content of this file to identify relevant test cases that demonstrate the deconstruction of expression classes in the context of migrations.
2025-12-22 23:49:30,092 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of `tests/migrations/test_autodetector.py` to help you identify test cases related to the deconstruction of expression classes.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/migrations/test_autodetector.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2101, 'candidates_token_count': 60, 'total_token_count': 2290, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2101}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 60}], 'thoughts_token_count': 129, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.1147674560546875, 'model_name': 'gemini-2.5-pro'} id='run--0a82feec-178b-4114-8e14-664a6b657825-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/migrations/test_autodetector.py'}, 'id': '5665deed-f35e-4e94-b201-95e01a3b6dcd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2101, 'output_tokens': 60, 'total_tokens': 2290, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 129}}
2025-12-22 23:49:33,888 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have read the first 500 lines of the requested file. As the file is longer, I will now retrieve the remaining content to provide you with the complete file.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "end_line": 5000.0, "relative_path": "tests/migrations/test_autodetector.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 11579, 'candidates_token_count': 67, 'total_token_count': 11871, 'cached_content_token_count': 1828, 'prompt_tokens_details': [{'modality': 1, 'token_count': 11579}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1828}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 67}], 'thoughts_token_count': 225}, 'finish_reason': 'STOP', 'avg_logprobs': -0.43848806352757697, 'model_name': 'gemini-2.5-pro'} id='run--a670a2f5-17ff-422a-8b10-1a56ae036f63-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'end_line': 5000.0, 'relative_path': 'tests/migrations/test_autodetector.py'}, 'id': 'e0c0a0b5-27d4-496c-9a82-25961c1d45ca', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11579, 'output_tokens': 67, 'total_tokens': 11871, 'input_token_details': {'cache_read': 1828}, 'output_token_details': {'reasoning': 225}}
2025-12-22 23:49:44,309 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have successfully retrieved the entire content of `tests/migrations/test_autodetector.py`. This file contains a comprehensive suite of tests for Django's migration autodetector, and I have identified several test cases that are directly relevant to your interest in the deconstruction of expression classes. The tests `test_custom_deconstructible`, `test_deconstructible_list`, `test_deconstructible_tuple`, `test_deconstructible_dict`, and `test_nested_deconstructible_objects` will be particularly useful for your purpose." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 60302, 'candidates_token_count': 118, 'total_token_count': 61247, 'cached_content_token_count': 11641, 'prompt_tokens_details': [{'modality': 1, 'token_count': 60302}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11641}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 118}], 'thoughts_token_count': 827}, 'finish_reason': 'STOP', 'avg_logprobs': -0.8240363557459944, 'model_name': 'gemini-2.5-pro'} id='run--e60fb621-cdb0-4769-bbc8-48b00821cc7e-0' usage_metadata={'input_tokens': 60302, 'output_tokens': 118, 'total_tokens': 61247, 'input_token_details': {'cache_read': 11641}, 'output_token_details': {'reasoning': 827}}
2025-12-22 23:49:44,311 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/migrations/test_autodetector.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need the content of this file to identify relevant test cases that demonstrate the deconstruction of expression classes in the context of migrations.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/migrations/test_autodetector.py
Line number range: 1 - 500
Content:
1. import functools
2. import re
3. from unittest import mock
4. 
5. from django.apps import apps
6. from django.conf import settings
7. from django.contrib.auth.models import AbstractBaseUser
8. from django.core.validators import RegexValidator, validate_slug
9. from django.db import connection, migrations, models
10. from django.db.migrations.autodetector import MigrationAutodetector
11. from django.db.migrations.graph import MigrationGraph
12. from django.db.migrations.loader import MigrationLoader
13. from django.db.migrations.questioner import MigrationQuestioner
14. from django.db.migrations.state import ModelState, ProjectState
15. from django.test import SimpleTestCase, TestCase, override_settings
16. from django.test.utils import isolate_lru_cache
17. 
18. from .models import FoodManager, FoodQuerySet
19. 
20. 
21. class DeconstructibleObject:
22.     """
23.     A custom deconstructible object.
24.     """
25. 
26.     def __init__(self, *args, **kwargs):
27.         self.args = args
28.         self.kwargs = kwargs
29. 
30.     def deconstruct(self):
31.         return (
32.             self.__module__ + '.' + self.__class__.__name__,
33.             self.args,
34.             self.kwargs
35.         )
36. 
37. 
38. class AutodetectorTests(TestCase):
39.     """
40.     Tests the migration autodetector.
41.     """
42. 
43.     author_empty = ModelState("testapp", "Author", [("id", models.AutoField(primary_key=True))])
44.     author_name = ModelState("testapp", "Author", [
45.         ("id", models.AutoField(primary_key=True)),
46.         ("name", models.CharField(max_length=200)),
47.     ])
48.     author_name_null = ModelState("testapp", "Author", [
49.         ("id", models.AutoField(primary_key=True)),
50.         ("name", models.CharField(max_length=200, null=True)),
51.     ])
52.     author_name_longer = ModelState("testapp", "Author", [
53.         ("id", models.AutoField(primary_key=True)),
54.         ("name", models.CharField(max_length=400)),
55.     ])
56.     author_name_renamed = ModelState("testapp", "Author", [
57.         ("id", models.AutoField(primary_key=True)),
58.         ("names", models.CharField(max_length=200)),
59.     ])
60.     author_name_default = ModelState("testapp", "Author", [
61.         ("id", models.AutoField(primary_key=True)),
62.         ("name", models.CharField(max_length=200, default='Ada Lovelace')),
63.     ])
64.     author_name_check_constraint = ModelState("testapp", "Author", [
65.         ("id", models.AutoField(primary_key=True)),
66.         ("name", models.CharField(max_length=200)),
67.     ],
68.         {'constraints': [models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')]},
69.     )
70.     author_dates_of_birth_auto_now = ModelState("testapp", "Author", [
71.         ("id", models.AutoField(primary_key=True)),
72.         ("date_of_birth", models.DateField(auto_now=True)),
73.         ("date_time_of_birth", models.DateTimeField(auto_now=True)),
74.         ("time_of_birth", models.TimeField(auto_now=True)),
75.     ])
76.     author_dates_of_birth_auto_now_add = ModelState("testapp", "Author", [
77.         ("id", models.AutoField(primary_key=True)),
78.         ("date_of_birth", models.DateField(auto_now_add=True)),
79.         ("date_time_of_birth", models.DateTimeField(auto_now_add=True)),
80.         ("time_of_birth", models.TimeField(auto_now_add=True)),
81.     ])
82.     author_name_deconstructible_1 = ModelState("testapp", "Author", [
83.         ("id", models.AutoField(primary_key=True)),
84.         ("name", models.CharField(max_length=200, default=DeconstructibleObject())),
85.     ])
86.     author_name_deconstructible_2 = ModelState("testapp", "Author", [
87.         ("id", models.AutoField(primary_key=True)),
88.         ("name", models.CharField(max_length=200, default=DeconstructibleObject())),
89.     ])
90.     author_name_deconstructible_3 = ModelState("testapp", "Author", [
91.         ("id", models.AutoField(primary_key=True)),
92.         ("name", models.CharField(max_length=200, default=models.IntegerField())),
93.     ])
94.     author_name_deconstructible_4 = ModelState("testapp", "Author", [
95.         ("id", models.AutoField(primary_key=True)),
96.         ("name", models.CharField(max_length=200, default=models.IntegerField())),
97.     ])
98.     author_name_deconstructible_list_1 = ModelState("testapp", "Author", [
99.         ("id", models.AutoField(primary_key=True)),
100.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 123])),
101.     ])
102.     author_name_deconstructible_list_2 = ModelState("testapp", "Author", [
103.         ("id", models.AutoField(primary_key=True)),
104.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 123])),
105.     ])
106.     author_name_deconstructible_list_3 = ModelState("testapp", "Author", [
107.         ("id", models.AutoField(primary_key=True)),
108.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 999])),
109.     ])
110.     author_name_deconstructible_tuple_1 = ModelState("testapp", "Author", [
111.         ("id", models.AutoField(primary_key=True)),
112.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 123))),
113.     ])
114.     author_name_deconstructible_tuple_2 = ModelState("testapp", "Author", [
115.         ("id", models.AutoField(primary_key=True)),
116.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 123))),
117.     ])
118.     author_name_deconstructible_tuple_3 = ModelState("testapp", "Author", [
119.         ("id", models.AutoField(primary_key=True)),
120.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 999))),
121.     ])
122.     author_name_deconstructible_dict_1 = ModelState("testapp", "Author", [
123.         ("id", models.AutoField(primary_key=True)),
124.         ("name", models.CharField(max_length=200, default={
125.             'item': DeconstructibleObject(), 'otheritem': 123
126.         })),
127.     ])
128.     author_name_deconstructible_dict_2 = ModelState("testapp", "Author", [
129.         ("id", models.AutoField(primary_key=True)),
130.         ("name", models.CharField(max_length=200, default={
131.             'item': DeconstructibleObject(), 'otheritem': 123
132.         })),
133.     ])
134.     author_name_deconstructible_dict_3 = ModelState("testapp", "Author", [
135.         ("id", models.AutoField(primary_key=True)),
136.         ("name", models.CharField(max_length=200, default={
137.             'item': DeconstructibleObject(), 'otheritem': 999
138.         })),
139.     ])
140.     author_name_nested_deconstructible_1 = ModelState("testapp", "Author", [
141.         ("id", models.AutoField(primary_key=True)),
142.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
143.             DeconstructibleObject(1),
144.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
145.             a=DeconstructibleObject('A'),
146.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
147.         ))),
148.     ])
149.     author_name_nested_deconstructible_2 = ModelState("testapp", "Author", [
150.         ("id", models.AutoField(primary_key=True)),
151.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
152.             DeconstructibleObject(1),
153.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
154.             a=DeconstructibleObject('A'),
155.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
156.         ))),
157.     ])
158.     author_name_nested_deconstructible_changed_arg = ModelState("testapp", "Author", [
159.         ("id", models.AutoField(primary_key=True)),
160.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
161.             DeconstructibleObject(1),
162.             (DeconstructibleObject('t1'), DeconstructibleObject('t2-changed'),),
163.             a=DeconstructibleObject('A'),
164.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
165.         ))),
166.     ])
167.     author_name_nested_deconstructible_extra_arg = ModelState("testapp", "Author", [
168.         ("id", models.AutoField(primary_key=True)),
169.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
170.             DeconstructibleObject(1),
171.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
172.             None,
173.             a=DeconstructibleObject('A'),
174.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
175.         ))),
176.     ])
177.     author_name_nested_deconstructible_changed_kwarg = ModelState("testapp", "Author", [
178.         ("id", models.AutoField(primary_key=True)),
179.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
180.             DeconstructibleObject(1),
181.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
182.             a=DeconstructibleObject('A'),
183.             b=DeconstructibleObject(B=DeconstructibleObject('c-changed')),
184.         ))),
185.     ])
186.     author_name_nested_deconstructible_extra_kwarg = ModelState("testapp", "Author", [
187.         ("id", models.AutoField(primary_key=True)),
188.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
189.             DeconstructibleObject(1),
190.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
191.             a=DeconstructibleObject('A'),
192.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
193.             c=None,
194.         ))),
195.     ])
196.     author_custom_pk = ModelState("testapp", "Author", [("pk_field", models.IntegerField(primary_key=True))])
197.     author_with_biography_non_blank = ModelState("testapp", "Author", [
198.         ("id", models.AutoField(primary_key=True)),
199.         ("name", models.CharField()),
200.         ("biography", models.TextField()),
201.     ])
202.     author_with_biography_blank = ModelState("testapp", "Author", [
203.         ("id", models.AutoField(primary_key=True)),
204.         ("name", models.CharField(blank=True)),
205.         ("biography", models.TextField(blank=True)),
206.     ])
207.     author_with_book = ModelState("testapp", "Author", [
208.         ("id", models.AutoField(primary_key=True)),
209.         ("name", models.CharField(max_length=200)),
210.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
211.     ])
212.     author_with_book_order_wrt = ModelState("testapp", "Author", [
213.         ("id", models.AutoField(primary_key=True)),
214.         ("name", models.CharField(max_length=200)),
215.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
216.     ], options={"order_with_respect_to": "book"})
217.     author_renamed_with_book = ModelState("testapp", "Writer", [
218.         ("id", models.AutoField(primary_key=True)),
219.         ("name", models.CharField(max_length=200)),
220.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
221.     ])
222.     author_with_publisher_string = ModelState("testapp", "Author", [
223.         ("id", models.AutoField(primary_key=True)),
224.         ("name", models.CharField(max_length=200)),
225.         ("publisher_name", models.CharField(max_length=200)),
226.     ])
227.     author_with_publisher = ModelState("testapp", "Author", [
228.         ("id", models.AutoField(primary_key=True)),
229.         ("name", models.CharField(max_length=200)),
230.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
231.     ])
232.     author_with_user = ModelState("testapp", "Author", [
233.         ("id", models.AutoField(primary_key=True)),
234.         ("name", models.CharField(max_length=200)),
235.         ("user", models.ForeignKey("auth.User", models.CASCADE)),
236.     ])
237.     author_with_custom_user = ModelState("testapp", "Author", [
238.         ("id", models.AutoField(primary_key=True)),
239.         ("name", models.CharField(max_length=200)),
240.         ("user", models.ForeignKey("thirdapp.CustomUser", models.CASCADE)),
241.     ])
242.     author_proxy = ModelState("testapp", "AuthorProxy", [], {"proxy": True}, ("testapp.author",))
243.     author_proxy_options = ModelState("testapp", "AuthorProxy", [], {
244.         "proxy": True,
245.         "verbose_name": "Super Author",
246.     }, ("testapp.author",))
247.     author_proxy_notproxy = ModelState("testapp", "AuthorProxy", [], {}, ("testapp.author",))
248.     author_proxy_third = ModelState("thirdapp", "AuthorProxy", [], {"proxy": True}, ("testapp.author",))
249.     author_proxy_third_notproxy = ModelState("thirdapp", "AuthorProxy", [], {}, ("testapp.author",))
250.     author_proxy_proxy = ModelState("testapp", "AAuthorProxyProxy", [], {"proxy": True}, ("testapp.authorproxy",))
251.     author_unmanaged = ModelState("testapp", "AuthorUnmanaged", [], {"managed": False}, ("testapp.author",))
252.     author_unmanaged_managed = ModelState("testapp", "AuthorUnmanaged", [], {}, ("testapp.author",))
253.     author_unmanaged_default_pk = ModelState("testapp", "Author", [("id", models.AutoField(primary_key=True))])
254.     author_unmanaged_custom_pk = ModelState("testapp", "Author", [
255.         ("pk_field", models.IntegerField(primary_key=True)),
256.     ])
257.     author_with_m2m = ModelState("testapp", "Author", [
258.         ("id", models.AutoField(primary_key=True)),
259.         ("publishers", models.ManyToManyField("testapp.Publisher")),
260.     ])
261.     author_with_m2m_blank = ModelState("testapp", "Author", [
262.         ("id", models.AutoField(primary_key=True)),
263.         ("publishers", models.ManyToManyField("testapp.Publisher", blank=True)),
264.     ])
265.     author_with_m2m_through = ModelState("testapp", "Author", [
266.         ("id", models.AutoField(primary_key=True)),
267.         ("publishers", models.ManyToManyField("testapp.Publisher", through="testapp.Contract")),
268.     ])
269.     author_with_renamed_m2m_through = ModelState("testapp", "Author", [
270.         ("id", models.AutoField(primary_key=True)),
271.         ("publishers", models.ManyToManyField("testapp.Publisher", through="testapp.Deal")),
272.     ])
273.     author_with_former_m2m = ModelState("testapp", "Author", [
274.         ("id", models.AutoField(primary_key=True)),
275.         ("publishers", models.CharField(max_length=100)),
276.     ])
277.     author_with_options = ModelState("testapp", "Author", [
278.         ("id", models.AutoField(primary_key=True)),
279.     ], {
280.         "permissions": [('can_hire', 'Can hire')],
281.         "verbose_name": "Authi",
282.     })
283.     author_with_db_table_options = ModelState("testapp", "Author", [
284.         ("id", models.AutoField(primary_key=True)),
285.     ], {"db_table": "author_one"})
286.     author_with_new_db_table_options = ModelState("testapp", "Author", [
287.         ("id", models.AutoField(primary_key=True)),
288.     ], {"db_table": "author_two"})
289.     author_renamed_with_db_table_options = ModelState("testapp", "NewAuthor", [
290.         ("id", models.AutoField(primary_key=True)),
291.     ], {"db_table": "author_one"})
292.     author_renamed_with_new_db_table_options = ModelState("testapp", "NewAuthor", [
293.         ("id", models.AutoField(primary_key=True)),
294.     ], {"db_table": "author_three"})
295.     contract = ModelState("testapp", "Contract", [
296.         ("id", models.AutoField(primary_key=True)),
297.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
298.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
299.     ])
300.     contract_renamed = ModelState("testapp", "Deal", [
301.         ("id", models.AutoField(primary_key=True)),
302.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
303.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
304.     ])
305.     publisher = ModelState("testapp", "Publisher", [
306.         ("id", models.AutoField(primary_key=True)),
307.         ("name", models.CharField(max_length=100)),
308.     ])
309.     publisher_with_author = ModelState("testapp", "Publisher", [
310.         ("id", models.AutoField(primary_key=True)),
311.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
312.         ("name", models.CharField(max_length=100)),
313.     ])
314.     publisher_with_aardvark_author = ModelState("testapp", "Publisher", [
315.         ("id", models.AutoField(primary_key=True)),
316.         ("author", models.ForeignKey("testapp.Aardvark", models.CASCADE)),
317.         ("name", models.CharField(max_length=100)),
318.     ])
319.     publisher_with_book = ModelState("testapp", "Publisher", [
320.         ("id", models.AutoField(primary_key=True)),
321.         ("author", models.ForeignKey("otherapp.Book", models.CASCADE)),
322.         ("name", models.CharField(max_length=100)),
323.     ])
324.     other_pony = ModelState("otherapp", "Pony", [
325.         ("id", models.AutoField(primary_key=True)),
326.     ])
327.     other_pony_food = ModelState("otherapp", "Pony", [
328.         ("id", models.AutoField(primary_key=True)),
329.     ], managers=[
330.         ('food_qs', FoodQuerySet.as_manager()),
331.         ('food_mgr', FoodManager('a', 'b')),
332.         ('food_mgr_kwargs', FoodManager('x', 'y', 3, 4)),
333.     ])
334.     other_stable = ModelState("otherapp", "Stable", [("id", models.AutoField(primary_key=True))])
335.     third_thing = ModelState("thirdapp", "Thing", [("id", models.AutoField(primary_key=True))])
336.     book = ModelState("otherapp", "Book", [
337.         ("id", models.AutoField(primary_key=True)),
338.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
339.         ("title", models.CharField(max_length=200)),
340.     ])
341.     book_proxy_fk = ModelState("otherapp", "Book", [
342.         ("id", models.AutoField(primary_key=True)),
343.         ("author", models.ForeignKey("thirdapp.AuthorProxy", models.CASCADE)),
344.         ("title", models.CharField(max_length=200)),
345.     ])
346.     book_proxy_proxy_fk = ModelState("otherapp", "Book", [
347.         ("id", models.AutoField(primary_key=True)),
348.         ("author", models.ForeignKey("testapp.AAuthorProxyProxy", models.CASCADE)),
349.     ])
350.     book_migrations_fk = ModelState("otherapp", "Book", [
351.         ("id", models.AutoField(primary_key=True)),
352.         ("author", models.ForeignKey("migrations.UnmigratedModel", models.CASCADE)),
353.         ("title", models.CharField(max_length=200)),
354.     ])
355.     book_with_no_author_fk = ModelState("otherapp", "Book", [
356.         ("id", models.AutoField(primary_key=True)),
357.         ("author", models.IntegerField()),
358.         ("title", models.CharField(max_length=200)),
359.     ])
360.     book_with_no_author = ModelState("otherapp", "Book", [
361.         ("id", models.AutoField(primary_key=True)),
362.         ("title", models.CharField(max_length=200)),
363.     ])
364.     book_with_author_renamed = ModelState("otherapp", "Book", [
365.         ("id", models.AutoField(primary_key=True)),
366.         ("author", models.ForeignKey("testapp.Writer", models.CASCADE)),
367.         ("title", models.CharField(max_length=200)),
368.     ])
369.     book_with_field_and_author_renamed = ModelState("otherapp", "Book", [
370.         ("id", models.AutoField(primary_key=True)),
371.         ("writer", models.ForeignKey("testapp.Writer", models.CASCADE)),
372.         ("title", models.CharField(max_length=200)),
373.     ])
374.     book_with_multiple_authors = ModelState("otherapp", "Book", [
375.         ("id", models.AutoField(primary_key=True)),
376.         ("authors", models.ManyToManyField("testapp.Author")),
377.         ("title", models.CharField(max_length=200)),
378.     ])
379.     book_with_multiple_authors_through_attribution = ModelState("otherapp", "Book", [
380.         ("id", models.AutoField(primary_key=True)),
381.         ("authors", models.ManyToManyField("testapp.Author", through="otherapp.Attribution")),
382.         ("title", models.CharField(max_length=200)),
383.     ])
384.     book_indexes = ModelState("otherapp", "Book", [
385.         ("id", models.AutoField(primary_key=True)),
386.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
387.         ("title", models.CharField(max_length=200)),
388.     ], {
389.         "indexes": [models.Index(fields=["author", "title"], name="book_title_author_idx")],
390.     })
391.     book_unordered_indexes = ModelState("otherapp", "Book", [
392.         ("id", models.AutoField(primary_key=True)),
393.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
394.         ("title", models.CharField(max_length=200)),
395.     ], {
396.         "indexes": [models.Index(fields=["title", "author"], name="book_author_title_idx")],
397.     })
398.     book_foo_together = ModelState("otherapp", "Book", [
399.         ("id", models.AutoField(primary_key=True)),
400.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
401.         ("title", models.CharField(max_length=200)),
402.     ], {
403.         "index_together": {("author", "title")},
404.         "unique_together": {("author", "title")},
405.     })
406.     book_foo_together_2 = ModelState("otherapp", "Book", [
407.         ("id", models.AutoField(primary_key=True)),
408.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
409.         ("title", models.CharField(max_length=200)),
410.     ], {
411.         "index_together": {("title", "author")},
412.         "unique_together": {("title", "author")},
413.     })
414.     book_foo_together_3 = ModelState("otherapp", "Book", [
415.         ("id", models.AutoField(primary_key=True)),
416.         ("newfield", models.IntegerField()),
417.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
418.         ("title", models.CharField(max_length=200)),
419.     ], {
420.         "index_together": {("title", "newfield")},
421.         "unique_together": {("title", "newfield")},
422.     })
423.     book_foo_together_4 = ModelState("otherapp", "Book", [
424.         ("id", models.AutoField(primary_key=True)),
425.         ("newfield2", models.IntegerField()),
426.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
427.         ("title", models.CharField(max_length=200)),
428.     ], {
429.         "index_together": {("title", "newfield2")},
430.         "unique_together": {("title", "newfield2")},
431.     })
432.     attribution = ModelState("otherapp", "Attribution", [
433.         ("id", models.AutoField(primary_key=True)),
434.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
435.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
436.     ])
437.     edition = ModelState("thirdapp", "Edition", [
438.         ("id", models.AutoField(primary_key=True)),
439.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
440.     ])
441.     custom_user = ModelState("thirdapp", "CustomUser", [
442.         ("id", models.AutoField(primary_key=True)),
443.         ("username", models.CharField(max_length=255)),
444.     ], bases=(AbstractBaseUser,))
445.     custom_user_no_inherit = ModelState("thirdapp", "CustomUser", [
446.         ("id", models.AutoField(primary_key=True)),
447.         ("username", models.CharField(max_length=255)),
448.     ])
449.     aardvark = ModelState("thirdapp", "Aardvark", [("id", models.AutoField(primary_key=True))])
450.     aardvark_testapp = ModelState("testapp", "Aardvark", [("id", models.AutoField(primary_key=True))])
451.     aardvark_based_on_author = ModelState("testapp", "Aardvark", [], bases=("testapp.Author",))
452.     aardvark_pk_fk_author = ModelState("testapp", "Aardvark", [
453.         ("id", models.OneToOneField("testapp.Author", models.CASCADE, primary_key=True)),
454.     ])
455.     knight = ModelState("eggs", "Knight", [("id", models.AutoField(primary_key=True))])
456.     rabbit = ModelState("eggs", "Rabbit", [
457.         ("id", models.AutoField(primary_key=True)),
458.         ("knight", models.ForeignKey("eggs.Knight", models.CASCADE)),
459.         ("parent", models.ForeignKey("eggs.Rabbit", models.CASCADE)),
460.     ], {
461.         "unique_together": {("parent", "knight")},
462.         "indexes": [models.Index(fields=["parent", "knight"], name='rabbit_circular_fk_index')],
463.     })
464. 
465.     def repr_changes(self, changes, include_dependencies=False):
466.         output = ""
467.         for app_label, migrations_ in sorted(changes.items()):
468.             output += "  %s:\n" % app_label
469.             for migration in migrations_:
470.                 output += "    %s\n" % migration.name
471.                 for operation in migration.operations:
472.                     output += "      %s\n" % operation
473.                 if include_dependencies:
474.                     output += "      Dependencies:\n"
475.                     if migration.dependencies:
476.                         for dep in migration.dependencies:
477.                             output += "        %s\n" % (dep,)
478.                     else:
479.                         output += "        None\n"
480.         return output
481. 
482.     def assertNumberMigrations(self, changes, app_label, number):
483.         if len(changes.get(app_label, [])) != number:
484.             self.fail("Incorrect number of migrations (%s) for %s (expected %s)\n%s" % (
485.                 len(changes.get(app_label, [])),
486.                 app_label,
487.                 number,
488.                 self.repr_changes(changes),
489.             ))
490. 
491.     def assertMigrationDependencies(self, changes, app_label, position, dependencies):
492.         if not changes.get(app_label):
493.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
494.         if len(changes[app_label]) < position + 1:
495.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
496.         migration = changes[app_label][position]
497.         if set(migration.dependencies) != set(dependencies):
498.             self.fail("Migration dependencies mismatch for %s.%s (expected %s):\n%s" % (
499.                 app_label,
500.                 migration.name,


File: tests/migrations/test_autodetector.py
Line number range: 501 - 5000
Content:
501.                 dependencies,
502.                 self.repr_changes(changes, include_dependencies=True),
503.             ))
504. 
505.     def assertOperationTypes(self, changes, app_label, position, types):
506.         if not changes.get(app_label):
507.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
508.         if len(changes[app_label]) < position + 1:
509.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
510.         migration = changes[app_label][position]
511.         real_types = [operation.__class__.__name__ for operation in migration.operations]
512.         if types != real_types:
513.             self.fail("Operation type mismatch for %s.%s (expected %s):\n%s" % (
514.                 app_label,
515.                 migration.name,
516.                 types,
517.                 self.repr_changes(changes),
518.             ))
519. 
520.     def assertOperationAttributes(self, changes, app_label, position, operation_position, **attrs):
521.         if not changes.get(app_label):
522.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
523.         if len(changes[app_label]) < position + 1:
524.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
525.         migration = changes[app_label][position]
526.         if len(changes[app_label]) < position + 1:
527.             self.fail("No operation at index %s for %s.%s\n%s" % (
528.                 operation_position,
529.                 app_label,
530.                 migration.name,
531.                 self.repr_changes(changes),
532.             ))
533.         operation = migration.operations[operation_position]
534.         for attr, value in attrs.items():
535.             if getattr(operation, attr, None) != value:
536.                 self.fail("Attribute mismatch for %s.%s op #%s, %s (expected %r, got %r):\n%s" % (
537.                     app_label,
538.                     migration.name,
539.                     operation_position,
540.                     attr,
541.                     value,
542.                     getattr(operation, attr, None),
543.                     self.repr_changes(changes),
544.                 ))
545. 
546.     def assertOperationFieldAttributes(self, changes, app_label, position, operation_position, **attrs):
547.         if not changes.get(app_label):
548.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
549.         if len(changes[app_label]) < position + 1:
550.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
551.         migration = changes[app_label][position]
552.         if len(changes[app_label]) < position + 1:
553.             self.fail("No operation at index %s for %s.%s\n%s" % (
554.                 operation_position,
555.                 app_label,
556.                 migration.name,
557.                 self.repr_changes(changes),
558.             ))
559.         operation = migration.operations[operation_position]
560.         if not hasattr(operation, 'field'):
561.             self.fail("No field attribute for %s.%s op #%s." % (
562.                 app_label,
563.                 migration.name,
564.                 operation_position,
565.             ))
566.         field = operation.field
567.         for attr, value in attrs.items():
568.             if getattr(field, attr, None) != value:
569.                 self.fail("Field attribute mismatch for %s.%s op #%s, field.%s (expected %r, got %r):\n%s" % (
570.                     app_label,
571.                     migration.name,
572.                     operation_position,
573.                     attr,
574.                     value,
575.                     getattr(field, attr, None),
576.                     self.repr_changes(changes),
577.                 ))
578. 
579.     def make_project_state(self, model_states):
580.         "Shortcut to make ProjectStates from lists of predefined models"
581.         project_state = ProjectState()
582.         for model_state in model_states:
583.             project_state.add_model(model_state.clone())
584.         return project_state
585. 
586.     def get_changes(self, before_states, after_states, questioner=None):
587.         if not isinstance(before_states, ProjectState):
588.             before_states = self.make_project_state(before_states)
589.         if not isinstance(after_states, ProjectState):
590.             after_states = self.make_project_state(after_states)
591.         return MigrationAutodetector(
592.             before_states,
593.             after_states,
594.             questioner,
595.         )._detect_changes()
596. 
597.     def test_arrange_for_graph(self):
598.         """Tests auto-naming of migrations for graph matching."""
599.         # Make a fake graph
600.         graph = MigrationGraph()
601.         graph.add_node(("testapp", "0001_initial"), None)
602.         graph.add_node(("testapp", "0002_foobar"), None)
603.         graph.add_node(("otherapp", "0001_initial"), None)
604.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("testapp", "0001_initial"))
605.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("otherapp", "0001_initial"))
606.         # Use project state to make a new migration change set
607.         before = self.make_project_state([self.publisher, self.other_pony])
608.         after = self.make_project_state([
609.             self.author_empty, self.publisher, self.other_pony, self.other_stable,
610.         ])
611.         autodetector = MigrationAutodetector(before, after)
612.         changes = autodetector._detect_changes()
613.         # Run through arrange_for_graph
614.         changes = autodetector.arrange_for_graph(changes, graph)
615.         # Make sure there's a new name, deps match, etc.
616.         self.assertEqual(changes["testapp"][0].name, "0003_author")
617.         self.assertEqual(changes["testapp"][0].dependencies, [("testapp", "0002_foobar")])
618.         self.assertEqual(changes["otherapp"][0].name, '0002_stable')
619.         self.assertEqual(changes["otherapp"][0].dependencies, [("otherapp", "0001_initial")])
620. 
621.     def test_arrange_for_graph_with_multiple_initial(self):
622.         # Make a fake graph.
623.         graph = MigrationGraph()
624.         # Use project state to make a new migration change set.
625.         before = self.make_project_state([])
626.         after = self.make_project_state([self.author_with_book, self.book, self.attribution])
627.         autodetector = MigrationAutodetector(before, after, MigrationQuestioner({'ask_initial': True}))
628.         changes = autodetector._detect_changes()
629.         changes = autodetector.arrange_for_graph(changes, graph)
630. 
631.         self.assertEqual(changes['otherapp'][0].name, '0001_initial')
632.         self.assertEqual(changes['otherapp'][0].dependencies, [])
633.         self.assertEqual(changes['otherapp'][1].name, '0002_initial')
634.         self.assertCountEqual(
635.             changes['otherapp'][1].dependencies,
636.             [('testapp', '0001_initial'), ('otherapp', '0001_initial')],
637.         )
638.         self.assertEqual(changes['testapp'][0].name, '0001_initial')
639.         self.assertEqual(changes['testapp'][0].dependencies, [('otherapp', '0001_initial')])
640. 
641.     def test_trim_apps(self):
642.         """
643.         Trim does not remove dependencies but does remove unwanted apps.
644.         """
645.         # Use project state to make a new migration change set
646.         before = self.make_project_state([])
647.         after = self.make_project_state([self.author_empty, self.other_pony, self.other_stable, self.third_thing])
648.         autodetector = MigrationAutodetector(before, after, MigrationQuestioner({"ask_initial": True}))
649.         changes = autodetector._detect_changes()
650.         # Run through arrange_for_graph
651.         graph = MigrationGraph()
652.         changes = autodetector.arrange_for_graph(changes, graph)
653.         changes["testapp"][0].dependencies.append(("otherapp", "0001_initial"))
654.         changes = autodetector._trim_to_apps(changes, {"testapp"})
655.         # Make sure there's the right set of migrations
656.         self.assertEqual(changes["testapp"][0].name, "0001_initial")
657.         self.assertEqual(changes["otherapp"][0].name, "0001_initial")
658.         self.assertNotIn("thirdapp", changes)
659. 
660.     def test_custom_migration_name(self):
661.         """Tests custom naming of migrations for graph matching."""
662.         # Make a fake graph
663.         graph = MigrationGraph()
664.         graph.add_node(("testapp", "0001_initial"), None)
665.         graph.add_node(("testapp", "0002_foobar"), None)
666.         graph.add_node(("otherapp", "0001_initial"), None)
667.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("testapp", "0001_initial"))
668. 
669.         # Use project state to make a new migration change set
670.         before = self.make_project_state([])
671.         after = self.make_project_state([self.author_empty, self.other_pony, self.other_stable])
672.         autodetector = MigrationAutodetector(before, after)
673.         changes = autodetector._detect_changes()
674. 
675.         # Run through arrange_for_graph
676.         migration_name = 'custom_name'
677.         changes = autodetector.arrange_for_graph(changes, graph, migration_name)
678. 
679.         # Make sure there's a new name, deps match, etc.
680.         self.assertEqual(changes["testapp"][0].name, "0003_%s" % migration_name)
681.         self.assertEqual(changes["testapp"][0].dependencies, [("testapp", "0002_foobar")])
682.         self.assertEqual(changes["otherapp"][0].name, "0002_%s" % migration_name)
683.         self.assertEqual(changes["otherapp"][0].dependencies, [("otherapp", "0001_initial")])
684. 
685.     def test_new_model(self):
686.         """Tests autodetection of new models."""
687.         changes = self.get_changes([], [self.other_pony_food])
688.         # Right number/type of migrations?
689.         self.assertNumberMigrations(changes, 'otherapp', 1)
690.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
691.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="Pony")
692.         self.assertEqual([name for name, mgr in changes['otherapp'][0].operations[0].managers],
693.                          ['food_qs', 'food_mgr', 'food_mgr_kwargs'])
694. 
695.     def test_old_model(self):
696.         """Tests deletion of old models."""
697.         changes = self.get_changes([self.author_empty], [])
698.         # Right number/type of migrations?
699.         self.assertNumberMigrations(changes, 'testapp', 1)
700.         self.assertOperationTypes(changes, 'testapp', 0, ["DeleteModel"])
701.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Author")
702. 
703.     def test_add_field(self):
704.         """Tests autodetection of new fields."""
705.         changes = self.get_changes([self.author_empty], [self.author_name])
706.         # Right number/type of migrations?
707.         self.assertNumberMigrations(changes, 'testapp', 1)
708.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
709.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name")
710. 
711.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
712.                 side_effect=AssertionError("Should not have prompted for not null addition"))
713.     def test_add_date_fields_with_auto_now_not_asking_for_default(self, mocked_ask_method):
714.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now])
715.         # Right number/type of migrations?
716.         self.assertNumberMigrations(changes, 'testapp', 1)
717.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
718.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now=True)
719.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now=True)
720.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now=True)
721. 
722.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
723.                 side_effect=AssertionError("Should not have prompted for not null addition"))
724.     def test_add_date_fields_with_auto_now_add_not_asking_for_null_addition(self, mocked_ask_method):
725.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now_add])
726.         # Right number/type of migrations?
727.         self.assertNumberMigrations(changes, 'testapp', 1)
728.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
729.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now_add=True)
730.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now_add=True)
731.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now_add=True)
732. 
733.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_auto_now_add_addition')
734.     def test_add_date_fields_with_auto_now_add_asking_for_default(self, mocked_ask_method):
735.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now_add])
736.         # Right number/type of migrations?
737.         self.assertNumberMigrations(changes, 'testapp', 1)
738.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
739.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now_add=True)
740.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now_add=True)
741.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now_add=True)
742.         self.assertEqual(mocked_ask_method.call_count, 3)
743. 
744.     def test_remove_field(self):
745.         """Tests autodetection of removed fields."""
746.         changes = self.get_changes([self.author_name], [self.author_empty])
747.         # Right number/type of migrations?
748.         self.assertNumberMigrations(changes, 'testapp', 1)
749.         self.assertOperationTypes(changes, 'testapp', 0, ["RemoveField"])
750.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name")
751. 
752.     def test_alter_field(self):
753.         """Tests autodetection of new fields."""
754.         changes = self.get_changes([self.author_name], [self.author_name_longer])
755.         # Right number/type of migrations?
756.         self.assertNumberMigrations(changes, 'testapp', 1)
757.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
758.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
759. 
760.     def test_supports_functools_partial(self):
761.         def _content_file_name(instance, filename, key, **kwargs):
762.             return '{}/{}'.format(instance, filename)
763. 
764.         def content_file_name(key, **kwargs):
765.             return functools.partial(_content_file_name, key, **kwargs)
766. 
767.         # An unchanged partial reference.
768.         before = [ModelState("testapp", "Author", [
769.             ("id", models.AutoField(primary_key=True)),
770.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file'))),
771.         ])]
772.         after = [ModelState("testapp", "Author", [
773.             ("id", models.AutoField(primary_key=True)),
774.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file'))),
775.         ])]
776.         changes = self.get_changes(before, after)
777.         self.assertNumberMigrations(changes, 'testapp', 0)
778. 
779.         # A changed partial reference.
780.         args_changed = [ModelState("testapp", "Author", [
781.             ("id", models.AutoField(primary_key=True)),
782.             ("file", models.FileField(max_length=200, upload_to=content_file_name('other-file'))),
783.         ])]
784.         changes = self.get_changes(before, args_changed)
785.         self.assertNumberMigrations(changes, 'testapp', 1)
786.         self.assertOperationTypes(changes, 'testapp', 0, ['AlterField'])
787.         # Can't use assertOperationFieldAttributes because we need the
788.         # deconstructed version, i.e., the exploded func/args/keywords rather
789.         # than the partial: we don't care if it's not the same instance of the
790.         # partial, only if it's the same source function, args, and keywords.
791.         value = changes['testapp'][0].operations[0].field.upload_to
792.         self.assertEqual(
793.             (_content_file_name, ('other-file',), {}),
794.             (value.func, value.args, value.keywords)
795.         )
796. 
797.         kwargs_changed = [ModelState("testapp", "Author", [
798.             ("id", models.AutoField(primary_key=True)),
799.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file', spam='eggs'))),
800.         ])]
801.         changes = self.get_changes(before, kwargs_changed)
802.         self.assertNumberMigrations(changes, 'testapp', 1)
803.         self.assertOperationTypes(changes, 'testapp', 0, ['AlterField'])
804.         value = changes['testapp'][0].operations[0].field.upload_to
805.         self.assertEqual(
806.             (_content_file_name, ('file',), {'spam': 'eggs'}),
807.             (value.func, value.args, value.keywords)
808.         )
809. 
810.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
811.                 side_effect=AssertionError("Should not have prompted for not null addition"))
812.     def test_alter_field_to_not_null_with_default(self, mocked_ask_method):
813.         """
814.         #23609 - Tests autodetection of nullable to non-nullable alterations.
815.         """
816.         changes = self.get_changes([self.author_name_null], [self.author_name_default])
817.         # Right number/type of migrations?
818.         self.assertNumberMigrations(changes, 'testapp', 1)
819.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
820.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
821.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default='Ada Lovelace')
822. 
823.     @mock.patch(
824.         'django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
825.         return_value=models.NOT_PROVIDED,
826.     )
827.     def test_alter_field_to_not_null_without_default(self, mocked_ask_method):
828.         """
829.         #23609 - Tests autodetection of nullable to non-nullable alterations.
830.         """
831.         changes = self.get_changes([self.author_name_null], [self.author_name])
832.         self.assertEqual(mocked_ask_method.call_count, 1)
833.         # Right number/type of migrations?
834.         self.assertNumberMigrations(changes, 'testapp', 1)
835.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
836.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
837.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default=models.NOT_PROVIDED)
838. 
839.     @mock.patch(
840.         'django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
841.         return_value='Some Name',
842.     )
843.     def test_alter_field_to_not_null_oneoff_default(self, mocked_ask_method):
844.         """
845.         #23609 - Tests autodetection of nullable to non-nullable alterations.
846.         """
847.         changes = self.get_changes([self.author_name_null], [self.author_name])
848.         self.assertEqual(mocked_ask_method.call_count, 1)
849.         # Right number/type of migrations?
850.         self.assertNumberMigrations(changes, 'testapp', 1)
851.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
852.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=False)
853.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default="Some Name")
854. 
855.     def test_rename_field(self):
856.         """Tests autodetection of renamed fields."""
857.         changes = self.get_changes(
858.             [self.author_name], [self.author_name_renamed], MigrationQuestioner({"ask_rename": True})
859.         )
860.         # Right number/type of migrations?
861.         self.assertNumberMigrations(changes, 'testapp', 1)
862.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameField"])
863.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="name", new_name="names")
864. 
865.     def test_rename_field_foreign_key_to_field(self):
866.         before = [
867.             ModelState('app', 'Foo', [
868.                 ('id', models.AutoField(primary_key=True)),
869.                 ('field', models.IntegerField(unique=True)),
870.             ]),
871.             ModelState('app', 'Bar', [
872.                 ('id', models.AutoField(primary_key=True)),
873.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE, to_field='field')),
874.             ]),
875.         ]
876.         after = [
877.             ModelState('app', 'Foo', [
878.                 ('id', models.AutoField(primary_key=True)),
879.                 ('renamed_field', models.IntegerField(unique=True)),
880.             ]),
881.             ModelState('app', 'Bar', [
882.                 ('id', models.AutoField(primary_key=True)),
883.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE, to_field='renamed_field')),
884.             ]),
885.         ]
886.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
887.         # Right number/type of migrations?
888.         self.assertNumberMigrations(changes, 'app', 1)
889.         self.assertOperationTypes(changes, 'app', 0, ['RenameField'])
890.         self.assertOperationAttributes(changes, 'app', 0, 0, old_name='field', new_name='renamed_field')
891. 
892.     def test_rename_foreign_object_fields(self):
893.         fields = ('first', 'second')
894.         renamed_fields = ('first_renamed', 'second_renamed')
895.         before = [
896.             ModelState('app', 'Foo', [
897.                 ('id', models.AutoField(primary_key=True)),
898.                 ('first', models.IntegerField()),
899.                 ('second', models.IntegerField()),
900.             ], options={'unique_together': {fields}}),
901.             ModelState('app', 'Bar', [
902.                 ('id', models.AutoField(primary_key=True)),
903.                 ('first', models.IntegerField()),
904.                 ('second', models.IntegerField()),
905.                 ('foo', models.ForeignObject(
906.                     'app.Foo', models.CASCADE, from_fields=fields, to_fields=fields,
907.                 )),
908.             ]),
909.         ]
910.         # Case 1: to_fields renames.
911.         after = [
912.             ModelState('app', 'Foo', [
913.                 ('id', models.AutoField(primary_key=True)),
914.                 ('first_renamed', models.IntegerField()),
915.                 ('second_renamed', models.IntegerField()),
916.             ], options={'unique_together': {renamed_fields}}),
917.             ModelState('app', 'Bar', [
918.                 ('id', models.AutoField(primary_key=True)),
919.                 ('first', models.IntegerField()),
920.                 ('second', models.IntegerField()),
921.                 ('foo', models.ForeignObject(
922.                     'app.Foo', models.CASCADE, from_fields=fields, to_fields=renamed_fields,
923.                 )),
924.             ]),
925.         ]
926.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
927.         self.assertNumberMigrations(changes, 'app', 1)
928.         self.assertOperationTypes(changes, 'app', 0, ['RenameField', 'RenameField', 'AlterUniqueTogether'])
929.         self.assertOperationAttributes(
930.             changes, 'app', 0, 0, model_name='foo', old_name='first', new_name='first_renamed',
931.         )
932.         self.assertOperationAttributes(
933.             changes, 'app', 0, 1, model_name='foo', old_name='second', new_name='second_renamed',
934.         )
935.         # Case 2: from_fields renames.
936.         after = [
937.             ModelState('app', 'Foo', [
938.                 ('id', models.AutoField(primary_key=True)),
939.                 ('first', models.IntegerField()),
940.                 ('second', models.IntegerField()),
941.             ], options={'unique_together': {fields}}),
942.             ModelState('app', 'Bar', [
943.                 ('id', models.AutoField(primary_key=True)),
944.                 ('first_renamed', models.IntegerField()),
945.                 ('second_renamed', models.IntegerField()),
946.                 ('foo', models.ForeignObject(
947.                     'app.Foo', models.CASCADE, from_fields=renamed_fields, to_fields=fields,
948.                 )),
949.             ]),
950.         ]
951.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
952.         self.assertNumberMigrations(changes, 'app', 1)
953.         self.assertOperationTypes(changes, 'app', 0, ['RenameField', 'RenameField'])
954.         self.assertOperationAttributes(
955.             changes, 'app', 0, 0, model_name='bar', old_name='first', new_name='first_renamed',
956.         )
957.         self.assertOperationAttributes(
958.             changes, 'app', 0, 1, model_name='bar', old_name='second', new_name='second_renamed',
959.         )
960. 
961.     def test_rename_referenced_primary_key(self):
962.         before = [
963.             ModelState('app', 'Foo', [
964.                 ('id', models.CharField(primary_key=True, serialize=False)),
965.             ]),
966.             ModelState('app', 'Bar', [
967.                 ('id', models.AutoField(primary_key=True)),
968.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
969.             ]),
970.         ]
971.         after = [
972.             ModelState('app', 'Foo', [
973.                 ('renamed_id', models.CharField(primary_key=True, serialize=False))
974.             ]),
975.             ModelState('app', 'Bar', [
976.                 ('id', models.AutoField(primary_key=True)),
977.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
978.             ]),
979.         ]
980.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
981.         self.assertNumberMigrations(changes, 'app', 1)
982.         self.assertOperationTypes(changes, 'app', 0, ['RenameField'])
983.         self.assertOperationAttributes(changes, 'app', 0, 0, old_name='id', new_name='renamed_id')
984. 
985.     def test_rename_field_preserved_db_column(self):
986.         """
987.         RenameField is used if a field is renamed and db_column equal to the
988.         old field's column is added.
989.         """
990.         before = [
991.             ModelState('app', 'Foo', [
992.                 ('id', models.AutoField(primary_key=True)),
993.                 ('field', models.IntegerField()),
994.             ]),
995.         ]
996.         after = [
997.             ModelState('app', 'Foo', [
998.                 ('id', models.AutoField(primary_key=True)),
999.                 ('renamed_field', models.IntegerField(db_column='field')),
1000.             ]),
1001.         ]
1002.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
1003.         self.assertNumberMigrations(changes, 'app', 1)
1004.         self.assertOperationTypes(changes, 'app', 0, ['AlterField', 'RenameField'])
1005.         self.assertOperationAttributes(
1006.             changes, 'app', 0, 0, model_name='foo', name='field',
1007.         )
1008.         self.assertEqual(changes['app'][0].operations[0].field.deconstruct(), (
1009.             'field', 'django.db.models.IntegerField', [], {'db_column': 'field'},
1010.         ))
1011.         self.assertOperationAttributes(
1012.             changes, 'app', 0, 1, model_name='foo', old_name='field',
1013.             new_name='renamed_field',
1014.         )
1015. 
1016.     def test_rename_related_field_preserved_db_column(self):
1017.         before = [
1018.             ModelState('app', 'Foo', [
1019.                 ('id', models.AutoField(primary_key=True)),
1020.             ]),
1021.             ModelState('app', 'Bar', [
1022.                 ('id', models.AutoField(primary_key=True)),
1023.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
1024.             ]),
1025.         ]
1026.         after = [
1027.             ModelState('app', 'Foo', [
1028.                 ('id', models.AutoField(primary_key=True)),
1029.             ]),
1030.             ModelState('app', 'Bar', [
1031.                 ('id', models.AutoField(primary_key=True)),
1032.                 ('renamed_foo', models.ForeignKey('app.Foo', models.CASCADE, db_column='foo_id')),
1033.             ]),
1034.         ]
1035.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
1036.         self.assertNumberMigrations(changes, 'app', 1)
1037.         self.assertOperationTypes(changes, 'app', 0, ['AlterField', 'RenameField'])
1038.         self.assertOperationAttributes(
1039.             changes, 'app', 0, 0, model_name='bar', name='foo',
1040.         )
1041.         self.assertEqual(changes['app'][0].operations[0].field.deconstruct(), (
1042.             'foo',
1043.             'django.db.models.ForeignKey',
1044.             [],
1045.             {'to': 'app.foo', 'on_delete': models.CASCADE, 'db_column': 'foo_id'},
1046.         ))
1047.         self.assertOperationAttributes(
1048.             changes, 'app', 0, 1, model_name='bar', old_name='foo',
1049.             new_name='renamed_foo',
1050.         )
1051. 
1052.     def test_rename_model(self):
1053.         """Tests autodetection of renamed models."""
1054.         changes = self.get_changes(
1055.             [self.author_with_book, self.book],
1056.             [self.author_renamed_with_book, self.book_with_author_renamed],
1057.             MigrationQuestioner({"ask_rename_model": True}),
1058.         )
1059.         # Right number/type of migrations?
1060.         self.assertNumberMigrations(changes, 'testapp', 1)
1061.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1062.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="Author", new_name="Writer")
1063.         # Now that RenameModel handles related fields too, there should be
1064.         # no AlterField for the related field.
1065.         self.assertNumberMigrations(changes, 'otherapp', 0)
1066. 
1067.     def test_rename_model_case(self):
1068.         """
1069.         Model name is case-insensitive. Changing case doesn't lead to any
1070.         autodetected operations.
1071.         """
1072.         author_renamed = ModelState('testapp', 'author', [
1073.             ('id', models.AutoField(primary_key=True)),
1074.         ])
1075.         changes = self.get_changes(
1076.             [self.author_empty, self.book],
1077.             [author_renamed, self.book],
1078.             questioner=MigrationQuestioner({'ask_rename_model': True}),
1079.         )
1080.         self.assertNumberMigrations(changes, 'testapp', 0)
1081.         self.assertNumberMigrations(changes, 'otherapp', 0)
1082. 
1083.     def test_renamed_referenced_m2m_model_case(self):
1084.         publisher_renamed = ModelState('testapp', 'publisher', [
1085.             ('id', models.AutoField(primary_key=True)),
1086.             ('name', models.CharField(max_length=100)),
1087.         ])
1088.         changes = self.get_changes(
1089.             [self.publisher, self.author_with_m2m],
1090.             [publisher_renamed, self.author_with_m2m],
1091.             questioner=MigrationQuestioner({'ask_rename_model': True}),
1092.         )
1093.         self.assertNumberMigrations(changes, 'testapp', 0)
1094.         self.assertNumberMigrations(changes, 'otherapp', 0)
1095. 
1096.     def test_rename_m2m_through_model(self):
1097.         """
1098.         Tests autodetection of renamed models that are used in M2M relations as
1099.         through models.
1100.         """
1101.         changes = self.get_changes(
1102.             [self.author_with_m2m_through, self.publisher, self.contract],
1103.             [self.author_with_renamed_m2m_through, self.publisher, self.contract_renamed],
1104.             MigrationQuestioner({'ask_rename_model': True})
1105.         )
1106.         # Right number/type of migrations?
1107.         self.assertNumberMigrations(changes, 'testapp', 1)
1108.         self.assertOperationTypes(changes, 'testapp', 0, ['RenameModel'])
1109.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name='Contract', new_name='Deal')
1110. 
1111.     def test_rename_model_with_renamed_rel_field(self):
1112.         """
1113.         Tests autodetection of renamed models while simultaneously renaming one
1114.         of the fields that relate to the renamed model.
1115.         """
1116.         changes = self.get_changes(
1117.             [self.author_with_book, self.book],
1118.             [self.author_renamed_with_book, self.book_with_field_and_author_renamed],
1119.             MigrationQuestioner({"ask_rename": True, "ask_rename_model": True}),
1120.         )
1121.         # Right number/type of migrations?
1122.         self.assertNumberMigrations(changes, 'testapp', 1)
1123.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1124.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="Author", new_name="Writer")
1125.         # Right number/type of migrations for related field rename?
1126.         # Alter is already taken care of.
1127.         self.assertNumberMigrations(changes, 'otherapp', 1)
1128.         self.assertOperationTypes(changes, 'otherapp', 0, ["RenameField"])
1129.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, old_name="author", new_name="writer")
1130. 
1131.     def test_rename_model_with_fks_in_different_position(self):
1132.         """
1133.         #24537 - The order of fields in a model does not influence
1134.         the RenameModel detection.
1135.         """
1136.         before = [
1137.             ModelState("testapp", "EntityA", [
1138.                 ("id", models.AutoField(primary_key=True)),
1139.             ]),
1140.             ModelState("testapp", "EntityB", [
1141.                 ("id", models.AutoField(primary_key=True)),
1142.                 ("some_label", models.CharField(max_length=255)),
1143.                 ("entity_a", models.ForeignKey("testapp.EntityA", models.CASCADE)),
1144.             ]),
1145.         ]
1146.         after = [
1147.             ModelState("testapp", "EntityA", [
1148.                 ("id", models.AutoField(primary_key=True)),
1149.             ]),
1150.             ModelState("testapp", "RenamedEntityB", [
1151.                 ("id", models.AutoField(primary_key=True)),
1152.                 ("entity_a", models.ForeignKey("testapp.EntityA", models.CASCADE)),
1153.                 ("some_label", models.CharField(max_length=255)),
1154.             ]),
1155.         ]
1156.         changes = self.get_changes(before, after, MigrationQuestioner({"ask_rename_model": True}))
1157.         self.assertNumberMigrations(changes, "testapp", 1)
1158.         self.assertOperationTypes(changes, "testapp", 0, ["RenameModel"])
1159.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="EntityB", new_name="RenamedEntityB")
1160. 
1161.     def test_rename_model_reverse_relation_dependencies(self):
1162.         """
1163.         The migration to rename a model pointed to by a foreign key in another
1164.         app must run after the other app's migration that adds the foreign key
1165.         with model's original name. Therefore, the renaming migration has a
1166.         dependency on that other migration.
1167.         """
1168.         before = [
1169.             ModelState('testapp', 'EntityA', [
1170.                 ('id', models.AutoField(primary_key=True)),
1171.             ]),
1172.             ModelState('otherapp', 'EntityB', [
1173.                 ('id', models.AutoField(primary_key=True)),
1174.                 ('entity_a', models.ForeignKey('testapp.EntityA', models.CASCADE)),
1175.             ]),
1176.         ]
1177.         after = [
1178.             ModelState('testapp', 'RenamedEntityA', [
1179.                 ('id', models.AutoField(primary_key=True)),
1180.             ]),
1181.             ModelState('otherapp', 'EntityB', [
1182.                 ('id', models.AutoField(primary_key=True)),
1183.                 ('entity_a', models.ForeignKey('testapp.RenamedEntityA', models.CASCADE)),
1184.             ]),
1185.         ]
1186.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename_model': True}))
1187.         self.assertNumberMigrations(changes, 'testapp', 1)
1188.         self.assertMigrationDependencies(changes, 'testapp', 0, [('otherapp', '__first__')])
1189.         self.assertOperationTypes(changes, 'testapp', 0, ['RenameModel'])
1190.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name='EntityA', new_name='RenamedEntityA')
1191. 
1192.     def test_fk_dependency(self):
1193.         """Having a ForeignKey automatically adds a dependency."""
1194.         # Note that testapp (author) has no dependencies,
1195.         # otherapp (book) depends on testapp (author),
1196.         # thirdapp (edition) depends on otherapp (book)
1197.         changes = self.get_changes([], [self.author_name, self.book, self.edition])
1198.         # Right number/type of migrations?
1199.         self.assertNumberMigrations(changes, 'testapp', 1)
1200.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1201.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1202.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1203.         # Right number/type of migrations?
1204.         self.assertNumberMigrations(changes, 'otherapp', 1)
1205.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1206.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
1207.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("testapp", "auto_1")])
1208.         # Right number/type of migrations?
1209.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1210.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel"])
1211.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="Edition")
1212.         self.assertMigrationDependencies(changes, 'thirdapp', 0, [("otherapp", "auto_1")])
1213. 
1214.     def test_proxy_fk_dependency(self):
1215.         """FK dependencies still work on proxy models."""
1216.         # Note that testapp (author) has no dependencies,
1217.         # otherapp (book) depends on testapp (authorproxy)
1218.         changes = self.get_changes([], [self.author_empty, self.author_proxy_third, self.book_proxy_fk])
1219.         # Right number/type of migrations?
1220.         self.assertNumberMigrations(changes, 'testapp', 1)
1221.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1222.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1223.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1224.         # Right number/type of migrations?
1225.         self.assertNumberMigrations(changes, 'otherapp', 1)
1226.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1227.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
1228.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("thirdapp", "auto_1")])
1229.         # Right number/type of migrations?
1230.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1231.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel"])
1232.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="AuthorProxy")
1233.         self.assertMigrationDependencies(changes, 'thirdapp', 0, [("testapp", "auto_1")])
1234. 
1235.     def test_same_app_no_fk_dependency(self):
1236.         """
1237.         A migration with a FK between two models of the same app
1238.         does not have a dependency to itself.
1239.         """
1240.         changes = self.get_changes([], [self.author_with_publisher, self.publisher])
1241.         # Right number/type of migrations?
1242.         self.assertNumberMigrations(changes, 'testapp', 1)
1243.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
1244.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Publisher")
1245.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
1246.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1247. 
1248.     def test_circular_fk_dependency(self):
1249.         """
1250.         Having a circular ForeignKey dependency automatically
1251.         resolves the situation into 2 migrations on one side and 1 on the other.
1252.         """
1253.         changes = self.get_changes([], [self.author_with_book, self.book, self.publisher_with_book])
1254.         # Right number/type of migrations?
1255.         self.assertNumberMigrations(changes, 'testapp', 1)
1256.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
1257.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Publisher")
1258.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
1259.         self.assertMigrationDependencies(changes, 'testapp', 0, [("otherapp", "auto_1")])
1260.         # Right number/type of migrations?
1261.         self.assertNumberMigrations(changes, 'otherapp', 2)
1262.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1263.         self.assertOperationTypes(changes, 'otherapp', 1, ["AddField"])
1264.         self.assertMigrationDependencies(changes, 'otherapp', 0, [])
1265.         self.assertMigrationDependencies(changes, 'otherapp', 1, [("otherapp", "auto_1"), ("testapp", "auto_1")])
1266.         # both split migrations should be `initial`
1267.         self.assertTrue(changes['otherapp'][0].initial)
1268.         self.assertTrue(changes['otherapp'][1].initial)
1269. 
1270.     def test_same_app_circular_fk_dependency(self):
1271.         """
1272.         A migration with a FK between two models of the same app does
1273.         not have a dependency to itself.
1274.         """
1275.         changes = self.get_changes([], [self.author_with_publisher, self.publisher_with_author])
1276.         # Right number/type of migrations?
1277.         self.assertNumberMigrations(changes, 'testapp', 1)
1278.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel", "AddField"])
1279.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Author")
1280.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Publisher")
1281.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="publisher")
1282.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1283. 
1284.     def test_same_app_circular_fk_dependency_with_unique_together_and_indexes(self):
1285.         """
1286.         #22275 - A migration with circular FK dependency does not try
1287.         to create unique together constraint and indexes before creating all
1288.         required fields first.
1289.         """
1290.         changes = self.get_changes([], [self.knight, self.rabbit])
1291.         # Right number/type of migrations?
1292.         self.assertNumberMigrations(changes, 'eggs', 1)
1293.         self.assertOperationTypes(
1294.             changes, 'eggs', 0, ["CreateModel", "CreateModel", "AddIndex", "AlterUniqueTogether"]
1295.         )
1296.         self.assertNotIn("unique_together", changes['eggs'][0].operations[0].options)
1297.         self.assertNotIn("unique_together", changes['eggs'][0].operations[1].options)
1298.         self.assertMigrationDependencies(changes, 'eggs', 0, [])
1299. 
1300.     def test_alter_db_table_add(self):
1301.         """Tests detection for adding db_table in model's options."""
1302.         changes = self.get_changes([self.author_empty], [self.author_with_db_table_options])
1303.         # Right number/type of migrations?
1304.         self.assertNumberMigrations(changes, 'testapp', 1)
1305.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1306.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table="author_one")
1307. 
1308.     def test_alter_db_table_change(self):
1309.         """Tests detection for changing db_table in model's options'."""
1310.         changes = self.get_changes([self.author_with_db_table_options], [self.author_with_new_db_table_options])
1311.         # Right number/type of migrations?
1312.         self.assertNumberMigrations(changes, 'testapp', 1)
1313.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1314.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table="author_two")
1315. 
1316.     def test_alter_db_table_remove(self):
1317.         """Tests detection for removing db_table in model's options."""
1318.         changes = self.get_changes([self.author_with_db_table_options], [self.author_empty])
1319.         # Right number/type of migrations?
1320.         self.assertNumberMigrations(changes, 'testapp', 1)
1321.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1322.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table=None)
1323. 
1324.     def test_alter_db_table_no_changes(self):
1325.         """
1326.         Alter_db_table doesn't generate a migration if no changes have been made.
1327.         """
1328.         changes = self.get_changes([self.author_with_db_table_options], [self.author_with_db_table_options])
1329.         # Right number of migrations?
1330.         self.assertEqual(len(changes), 0)
1331. 
1332.     def test_keep_db_table_with_model_change(self):
1333.         """
1334.         Tests when model changes but db_table stays as-is, autodetector must not
1335.         create more than one operation.
1336.         """
1337.         changes = self.get_changes(
1338.             [self.author_with_db_table_options],
1339.             [self.author_renamed_with_db_table_options],
1340.             MigrationQuestioner({"ask_rename_model": True}),
1341.         )
1342.         # Right number/type of migrations?
1343.         self.assertNumberMigrations(changes, 'testapp', 1)
1344.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1345.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="Author", new_name="NewAuthor")
1346. 
1347.     def test_alter_db_table_with_model_change(self):
1348.         """
1349.         Tests when model and db_table changes, autodetector must create two
1350.         operations.
1351.         """
1352.         changes = self.get_changes(
1353.             [self.author_with_db_table_options],
1354.             [self.author_renamed_with_new_db_table_options],
1355.             MigrationQuestioner({"ask_rename_model": True}),
1356.         )
1357.         # Right number/type of migrations?
1358.         self.assertNumberMigrations(changes, 'testapp', 1)
1359.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel", "AlterModelTable"])
1360.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="Author", new_name="NewAuthor")
1361.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="newauthor", table="author_three")
1362. 
1363.     def test_identical_regex_doesnt_alter(self):
1364.         from_state = ModelState(
1365.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[
1366.                 RegexValidator(
1367.                     re.compile('^[-a-zA-Z0-9_]+\\Z'),
1368.                     'Enter a valid “slug” consisting of letters, numbers, underscores or hyphens.',
1369.                     'invalid'
1370.                 )
1371.             ]))]
1372.         )
1373.         to_state = ModelState(
1374.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[validate_slug]))]
1375.         )
1376.         changes = self.get_changes([from_state], [to_state])
1377.         # Right number/type of migrations?
1378.         self.assertNumberMigrations(changes, "testapp", 0)
1379. 
1380.     def test_different_regex_does_alter(self):
1381.         from_state = ModelState(
1382.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[
1383.                 RegexValidator(
1384.                     re.compile('^[a-z]+\\Z', 32),
1385.                     'Enter a valid “slug” consisting of letters, numbers, underscores or hyphens.',
1386.                     'invalid'
1387.                 )
1388.             ]))]
1389.         )
1390.         to_state = ModelState(
1391.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[validate_slug]))]
1392.         )
1393.         changes = self.get_changes([from_state], [to_state])
1394.         self.assertNumberMigrations(changes, "testapp", 1)
1395.         self.assertOperationTypes(changes, "testapp", 0, ["AlterField"])
1396. 
1397.     def test_empty_foo_together(self):
1398.         """
1399.         #23452 - Empty unique/index_together shouldn't generate a migration.
1400.         """
1401.         # Explicitly testing for not specified, since this is the case after
1402.         # a CreateModel operation w/o any definition on the original model
1403.         model_state_not_specified = ModelState("a", "model", [("id", models.AutoField(primary_key=True))])
1404.         # Explicitly testing for None, since this was the issue in #23452 after
1405.         # an AlterFooTogether operation with e.g. () as value
1406.         model_state_none = ModelState("a", "model", [
1407.             ("id", models.AutoField(primary_key=True))
1408.         ], {
1409.             "index_together": None,
1410.             "unique_together": None,
1411.         })
1412.         # Explicitly testing for the empty set, since we now always have sets.
1413.         # During removal (('col1', 'col2'),) --> () this becomes set([])
1414.         model_state_empty = ModelState("a", "model", [
1415.             ("id", models.AutoField(primary_key=True))
1416.         ], {
1417.             "index_together": set(),
1418.             "unique_together": set(),
1419.         })
1420. 
1421.         def test(from_state, to_state, msg):
1422.             changes = self.get_changes([from_state], [to_state])
1423.             if changes:
1424.                 ops = ', '.join(o.__class__.__name__ for o in changes['a'][0].operations)
1425.                 self.fail('Created operation(s) %s from %s' % (ops, msg))
1426. 
1427.         tests = (
1428.             (model_state_not_specified, model_state_not_specified, '"not specified" to "not specified"'),
1429.             (model_state_not_specified, model_state_none, '"not specified" to "None"'),
1430.             (model_state_not_specified, model_state_empty, '"not specified" to "empty"'),
1431.             (model_state_none, model_state_not_specified, '"None" to "not specified"'),
1432.             (model_state_none, model_state_none, '"None" to "None"'),
1433.             (model_state_none, model_state_empty, '"None" to "empty"'),
1434.             (model_state_empty, model_state_not_specified, '"empty" to "not specified"'),
1435.             (model_state_empty, model_state_none, '"empty" to "None"'),
1436.             (model_state_empty, model_state_empty, '"empty" to "empty"'),
1437.         )
1438. 
1439.         for t in tests:
1440.             test(*t)
1441. 
1442.     def test_create_model_with_indexes(self):
1443.         """Test creation of new model with indexes already defined."""
1444.         author = ModelState('otherapp', 'Author', [
1445.             ('id', models.AutoField(primary_key=True)),
1446.             ('name', models.CharField(max_length=200)),
1447.         ], {'indexes': [models.Index(fields=['name'], name='create_model_with_indexes_idx')]})
1448.         changes = self.get_changes([], [author])
1449.         added_index = models.Index(fields=['name'], name='create_model_with_indexes_idx')
1450.         # Right number of migrations?
1451.         self.assertEqual(len(changes['otherapp']), 1)
1452.         # Right number of actions?
1453.         migration = changes['otherapp'][0]
1454.         self.assertEqual(len(migration.operations), 2)
1455.         # Right actions order?
1456.         self.assertOperationTypes(changes, 'otherapp', 0, ['CreateModel', 'AddIndex'])
1457.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='Author')
1458.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='author', index=added_index)
1459. 
1460.     def test_add_indexes(self):
1461.         """Test change detection of new indexes."""
1462.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_indexes])
1463.         self.assertNumberMigrations(changes, 'otherapp', 1)
1464.         self.assertOperationTypes(changes, 'otherapp', 0, ['AddIndex'])
1465.         added_index = models.Index(fields=['author', 'title'], name='book_title_author_idx')
1466.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', index=added_index)
1467. 
1468.     def test_remove_indexes(self):
1469.         """Test change detection of removed indexes."""
1470.         changes = self.get_changes([self.author_empty, self.book_indexes], [self.author_empty, self.book])
1471.         # Right number/type of migrations?
1472.         self.assertNumberMigrations(changes, 'otherapp', 1)
1473.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveIndex'])
1474.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', name='book_title_author_idx')
1475. 
1476.     def test_order_fields_indexes(self):
1477.         """Test change detection of reordering of fields in indexes."""
1478.         changes = self.get_changes(
1479.             [self.author_empty, self.book_indexes], [self.author_empty, self.book_unordered_indexes]
1480.         )
1481.         self.assertNumberMigrations(changes, 'otherapp', 1)
1482.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveIndex', 'AddIndex'])
1483.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', name='book_title_author_idx')
1484.         added_index = models.Index(fields=['title', 'author'], name='book_author_title_idx')
1485.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='book', index=added_index)
1486. 
1487.     def test_create_model_with_check_constraint(self):
1488.         """Test creation of new model with constraints already defined."""
1489.         author = ModelState('otherapp', 'Author', [
1490.             ('id', models.AutoField(primary_key=True)),
1491.             ('name', models.CharField(max_length=200)),
1492.         ], {'constraints': [models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')]})
1493.         changes = self.get_changes([], [author])
1494.         added_constraint = models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')
1495.         # Right number of migrations?
1496.         self.assertEqual(len(changes['otherapp']), 1)
1497.         # Right number of actions?
1498.         migration = changes['otherapp'][0]
1499.         self.assertEqual(len(migration.operations), 2)
1500.         # Right actions order?
1501.         self.assertOperationTypes(changes, 'otherapp', 0, ['CreateModel', 'AddConstraint'])
1502.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='Author')
1503.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='author', constraint=added_constraint)
1504. 
1505.     def test_add_constraints(self):
1506.         """Test change detection of new constraints."""
1507.         changes = self.get_changes([self.author_name], [self.author_name_check_constraint])
1508.         self.assertNumberMigrations(changes, 'testapp', 1)
1509.         self.assertOperationTypes(changes, 'testapp', 0, ['AddConstraint'])
1510.         added_constraint = models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')
1511.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name='author', constraint=added_constraint)
1512. 
1513.     def test_remove_constraints(self):
1514.         """Test change detection of removed constraints."""
1515.         changes = self.get_changes([self.author_name_check_constraint], [self.author_name])
1516.         # Right number/type of migrations?
1517.         self.assertNumberMigrations(changes, 'testapp', 1)
1518.         self.assertOperationTypes(changes, 'testapp', 0, ['RemoveConstraint'])
1519.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name='author', name='name_contains_bob')
1520. 
1521.     def test_add_foo_together(self):
1522.         """Tests index/unique_together detection."""
1523.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_foo_together])
1524.         # Right number/type of migrations?
1525.         self.assertNumberMigrations(changes, "otherapp", 1)
1526.         self.assertOperationTypes(changes, "otherapp", 0, ["AlterUniqueTogether", "AlterIndexTogether"])
1527.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together={("author", "title")})
1528.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together={("author", "title")})
1529. 
1530.     def test_remove_foo_together(self):
1531.         """Tests index/unique_together detection."""
1532.         changes = self.get_changes([self.author_empty, self.book_foo_together], [self.author_empty, self.book])
1533.         # Right number/type of migrations?
1534.         self.assertNumberMigrations(changes, "otherapp", 1)
1535.         self.assertOperationTypes(changes, "otherapp", 0, ["AlterUniqueTogether", "AlterIndexTogether"])
1536.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together=set())
1537.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together=set())
1538. 
1539.     def test_foo_together_remove_fk(self):
1540.         """Tests unique_together and field removal detection & ordering"""
1541.         changes = self.get_changes(
1542.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_with_no_author]
1543.         )
1544.         # Right number/type of migrations?
1545.         self.assertNumberMigrations(changes, "otherapp", 1)
1546.         self.assertOperationTypes(changes, "otherapp", 0, [
1547.             "AlterUniqueTogether", "AlterIndexTogether", "RemoveField"
1548.         ])
1549.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together=set())
1550.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together=set())
1551.         self.assertOperationAttributes(changes, "otherapp", 0, 2, model_name="book", name="author")
1552. 
1553.     def test_foo_together_no_changes(self):
1554.         """
1555.         index/unique_together doesn't generate a migration if no
1556.         changes have been made.
1557.         """
1558.         changes = self.get_changes(
1559.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_foo_together]
1560.         )
1561.         # Right number of migrations?
1562.         self.assertEqual(len(changes), 0)
1563. 
1564.     def test_foo_together_ordering(self):
1565.         """
1566.         index/unique_together also triggers on ordering changes.
1567.         """
1568.         changes = self.get_changes(
1569.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_foo_together_2]
1570.         )
1571.         # Right number/type of migrations?
1572.         self.assertNumberMigrations(changes, "otherapp", 1)
1573.         self.assertOperationTypes(changes, 'otherapp', 0, [
1574.             'AlterUniqueTogether',
1575.             'AlterIndexTogether',
1576.         ])
1577.         self.assertOperationAttributes(
1578.             changes, 'otherapp', 0, 0, name='book',
1579.             unique_together={('title', 'author')},
1580.         )
1581.         self.assertOperationAttributes(
1582.             changes, 'otherapp', 0, 1, name='book',
1583.             index_together={('title', 'author')},
1584.         )
1585. 
1586.     def test_add_field_and_foo_together(self):
1587.         """
1588.         Added fields will be created before using them in index/unique_together.
1589.         """
1590.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_foo_together_3])
1591.         # Right number/type of migrations?
1592.         self.assertNumberMigrations(changes, "otherapp", 1)
1593.         self.assertOperationTypes(changes, "otherapp", 0, ["AddField", "AlterUniqueTogether", "AlterIndexTogether"])
1594.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", unique_together={("title", "newfield")})
1595.         self.assertOperationAttributes(changes, "otherapp", 0, 2, name="book", index_together={("title", "newfield")})
1596. 
1597.     def test_create_model_and_unique_together(self):
1598.         author = ModelState("otherapp", "Author", [
1599.             ("id", models.AutoField(primary_key=True)),
1600.             ("name", models.CharField(max_length=200)),
1601.         ])
1602.         book_with_author = ModelState("otherapp", "Book", [
1603.             ("id", models.AutoField(primary_key=True)),
1604.             ("author", models.ForeignKey("otherapp.Author", models.CASCADE)),
1605.             ("title", models.CharField(max_length=200)),
1606.         ], {
1607.             "index_together": {("title", "author")},
1608.             "unique_together": {("title", "author")},
1609.         })
1610.         changes = self.get_changes([self.book_with_no_author], [author, book_with_author])
1611.         # Right number of migrations?
1612.         self.assertEqual(len(changes['otherapp']), 1)
1613.         # Right number of actions?
1614.         migration = changes['otherapp'][0]
1615.         self.assertEqual(len(migration.operations), 4)
1616.         # Right actions order?
1617.         self.assertOperationTypes(
1618.             changes, 'otherapp', 0,
1619.             ['CreateModel', 'AddField', 'AlterUniqueTogether', 'AlterIndexTogether']
1620.         )
1621. 
1622.     def test_remove_field_and_foo_together(self):
1623.         """
1624.         Removed fields will be removed after updating index/unique_together.
1625.         """
1626.         changes = self.get_changes(
1627.             [self.author_empty, self.book_foo_together_3], [self.author_empty, self.book_foo_together]
1628.         )
1629.         # Right number/type of migrations?
1630.         self.assertNumberMigrations(changes, "otherapp", 1)
1631.         self.assertOperationTypes(changes, 'otherapp', 0, [
1632.             'AlterUniqueTogether',
1633.             'AlterIndexTogether',
1634.             'RemoveField',
1635.         ])
1636.         self.assertOperationAttributes(
1637.             changes, 'otherapp', 0, 0, name='book',
1638.             unique_together={('author', 'title')},
1639.         )
1640.         self.assertOperationAttributes(
1641.             changes, 'otherapp', 0, 1, name='book',
1642.             index_together={('author', 'title')},
1643.         )
1644.         self.assertOperationAttributes(
1645.             changes, 'otherapp', 0, 2, model_name='book', name='newfield',
1646.         )
1647. 
1648.     def test_alter_field_and_foo_together(self):
1649.         """Fields are altered after deleting some index/unique_together."""
1650.         initial_author = ModelState('testapp', 'Author', [
1651.             ('id', models.AutoField(primary_key=True)),
1652.             ('name', models.CharField(max_length=200)),
1653.             ('age', models.IntegerField(db_index=True)),
1654.         ], {
1655.             'unique_together': {('name',)},
1656.         })
1657.         author_reversed_constraints = ModelState('testapp', 'Author', [
1658.             ('id', models.AutoField(primary_key=True)),
1659.             ('name', models.CharField(max_length=200, unique=True)),
1660.             ('age', models.IntegerField()),
1661.         ], {
1662.             'index_together': {('age',)},
1663.         })
1664.         changes = self.get_changes([initial_author], [author_reversed_constraints])
1665. 
1666.         self.assertNumberMigrations(changes, 'testapp', 1)
1667.         self.assertOperationTypes(changes, 'testapp', 0, [
1668.             'AlterUniqueTogether',
1669.             'AlterField',
1670.             'AlterField',
1671.             'AlterIndexTogether',
1672.         ])
1673.         self.assertOperationAttributes(
1674.             changes, 'testapp', 0, 0, name='author', unique_together=set(),
1675.         )
1676.         self.assertOperationAttributes(
1677.             changes, 'testapp', 0, 1, model_name='author', name='age',
1678.         )
1679.         self.assertOperationAttributes(
1680.             changes, 'testapp', 0, 2, model_name='author', name='name',
1681.         )
1682.         self.assertOperationAttributes(
1683.             changes, 'testapp', 0, 3, name='author', index_together={('age',)},
1684.         )
1685. 
1686.     def test_partly_alter_foo_together(self):
1687.         initial_author = ModelState('testapp', 'Author', [
1688.             ('id', models.AutoField(primary_key=True)),
1689.             ('name', models.CharField(max_length=200)),
1690.             ('age', models.IntegerField()),
1691.         ], {
1692.             'unique_together': {('name',), ('age',)},
1693.             'index_together': {('name',)},
1694.         })
1695.         author_reversed_constraints = ModelState('testapp', 'Author', [
1696.             ('id', models.AutoField(primary_key=True)),
1697.             ('name', models.CharField(max_length=200)),
1698.             ('age', models.IntegerField()),
1699.         ], {
1700.             'unique_together': {('age',)},
1701.             'index_together': {('name',), ('age',)},
1702.         })
1703.         changes = self.get_changes([initial_author], [author_reversed_constraints])
1704. 
1705.         self.assertNumberMigrations(changes, 'testapp', 1)
1706.         self.assertOperationTypes(changes, 'testapp', 0, [
1707.             'AlterUniqueTogether',
1708.             'AlterIndexTogether',
1709.         ])
1710.         self.assertOperationAttributes(
1711.             changes, 'testapp', 0, 0, name='author', unique_together={('age',)},
1712.         )
1713.         self.assertOperationAttributes(
1714.             changes, 'testapp', 0, 1, name='author',
1715.             index_together={('name',), ('age',)},
1716.         )
1717. 
1718.     def test_rename_field_and_foo_together(self):
1719.         """Fields are renamed before updating index/unique_together."""
1720.         changes = self.get_changes(
1721.             [self.author_empty, self.book_foo_together_3],
1722.             [self.author_empty, self.book_foo_together_4],
1723.             MigrationQuestioner({"ask_rename": True}),
1724.         )
1725.         # Right number/type of migrations?
1726.         self.assertNumberMigrations(changes, "otherapp", 1)
1727.         self.assertOperationTypes(changes, 'otherapp', 0, [
1728.             'RenameField',
1729.             'AlterUniqueTogether',
1730.             'AlterIndexTogether',
1731.         ])
1732.         self.assertOperationAttributes(
1733.             changes, 'otherapp', 0, 1, name='book',
1734.             unique_together={('title', 'newfield2')},
1735.         )
1736.         self.assertOperationAttributes(
1737.             changes, 'otherapp', 0, 2, name='book',
1738.             index_together={('title', 'newfield2')},
1739.         )
1740. 
1741.     def test_proxy(self):
1742.         """The autodetector correctly deals with proxy models."""
1743.         # First, we test adding a proxy model
1744.         changes = self.get_changes([self.author_empty], [self.author_empty, self.author_proxy])
1745.         # Right number/type of migrations?
1746.         self.assertNumberMigrations(changes, "testapp", 1)
1747.         self.assertOperationTypes(changes, "testapp", 0, ["CreateModel"])
1748.         self.assertOperationAttributes(
1749.             changes, "testapp", 0, 0, name="AuthorProxy", options={"proxy": True, "indexes": [], "constraints": []}
1750.         )
1751.         # Now, we test turning a proxy model into a non-proxy model
1752.         # It should delete the proxy then make the real one
1753.         changes = self.get_changes(
1754.             [self.author_empty, self.author_proxy], [self.author_empty, self.author_proxy_notproxy]
1755.         )
1756.         # Right number/type of migrations?
1757.         self.assertNumberMigrations(changes, "testapp", 1)
1758.         self.assertOperationTypes(changes, "testapp", 0, ["DeleteModel", "CreateModel"])
1759.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="AuthorProxy")
1760.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="AuthorProxy", options={})
1761. 
1762.     def test_proxy_non_model_parent(self):
1763.         class Mixin:
1764.             pass
1765. 
1766.         author_proxy_non_model_parent = ModelState(
1767.             'testapp',
1768.             'AuthorProxy',
1769.             [],
1770.             {'proxy': True},
1771.             (Mixin, 'testapp.author'),
1772.         )
1773.         changes = self.get_changes(
1774.             [self.author_empty],
1775.             [self.author_empty, author_proxy_non_model_parent],
1776.         )
1777.         self.assertNumberMigrations(changes, 'testapp', 1)
1778.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
1779.         self.assertOperationAttributes(
1780.             changes, 'testapp', 0, 0, name='AuthorProxy',
1781.             options={'proxy': True, 'indexes': [], 'constraints': []},
1782.             bases=(Mixin, 'testapp.author'),
1783.         )
1784. 
1785.     def test_proxy_custom_pk(self):
1786.         """
1787.         #23415 - The autodetector must correctly deal with custom FK on proxy
1788.         models.
1789.         """
1790.         # First, we test the default pk field name
1791.         changes = self.get_changes([], [self.author_empty, self.author_proxy_third, self.book_proxy_fk])
1792.         # The model the FK is pointing from and to.
1793.         self.assertEqual(
1794.             changes['otherapp'][0].operations[0].fields[2][1].remote_field.model,
1795.             'thirdapp.AuthorProxy',
1796.         )
1797.         # Now, we test the custom pk field name
1798.         changes = self.get_changes([], [self.author_custom_pk, self.author_proxy_third, self.book_proxy_fk])
1799.         # The model the FK is pointing from and to.
1800.         self.assertEqual(
1801.             changes['otherapp'][0].operations[0].fields[2][1].remote_field.model,
1802.             'thirdapp.AuthorProxy',
1803.         )
1804. 
1805.     def test_proxy_to_mti_with_fk_to_proxy(self):
1806.         # First, test the pk table and field name.
1807.         to_state = self.make_project_state(
1808.             [self.author_empty, self.author_proxy_third, self.book_proxy_fk],
1809.         )
1810.         changes = self.get_changes([], to_state)
1811.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1812.         self.assertEqual(
1813.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1814.             ('testapp', 'author'),
1815.         )
1816.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.AuthorProxy')
1817. 
1818.         # Change AuthorProxy to use MTI.
1819.         from_state = to_state.clone()
1820.         to_state = self.make_project_state(
1821.             [self.author_empty, self.author_proxy_third_notproxy, self.book_proxy_fk],
1822.         )
1823.         changes = self.get_changes(from_state, to_state)
1824.         # Right number/type of migrations for the AuthorProxy model?
1825.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1826.         self.assertOperationTypes(changes, 'thirdapp', 0, ['DeleteModel', 'CreateModel'])
1827.         # Right number/type of migrations for the Book model with a FK to
1828.         # AuthorProxy?
1829.         self.assertNumberMigrations(changes, 'otherapp', 1)
1830.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
1831.         # otherapp should depend on thirdapp.
1832.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('thirdapp', 'auto_1')])
1833.         # Now, test the pk table and field name.
1834.         fk_field = changes['otherapp'][0].operations[0].field
1835.         self.assertEqual(
1836.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1837.             ('thirdapp', 'authorproxy'),
1838.         )
1839.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.AuthorProxy')
1840. 
1841.     def test_proxy_to_mti_with_fk_to_proxy_proxy(self):
1842.         # First, test the pk table and field name.
1843.         to_state = self.make_project_state([
1844.             self.author_empty,
1845.             self.author_proxy,
1846.             self.author_proxy_proxy,
1847.             self.book_proxy_proxy_fk,
1848.         ])
1849.         changes = self.get_changes([], to_state)
1850.         fk_field = changes['otherapp'][0].operations[0].fields[1][1]
1851.         self.assertEqual(
1852.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1853.             ('testapp', 'author'),
1854.         )
1855.         self.assertEqual(fk_field.remote_field.model, 'testapp.AAuthorProxyProxy')
1856. 
1857.         # Change AuthorProxy to use MTI. FK still points to AAuthorProxyProxy,
1858.         # a proxy of AuthorProxy.
1859.         from_state = to_state.clone()
1860.         to_state = self.make_project_state([
1861.             self.author_empty,
1862.             self.author_proxy_notproxy,
1863.             self.author_proxy_proxy,
1864.             self.book_proxy_proxy_fk,
1865.         ])
1866.         changes = self.get_changes(from_state, to_state)
1867.         # Right number/type of migrations for the AuthorProxy model?
1868.         self.assertNumberMigrations(changes, 'testapp', 1)
1869.         self.assertOperationTypes(changes, 'testapp', 0, ['DeleteModel', 'CreateModel'])
1870.         # Right number/type of migrations for the Book model with a FK to
1871.         # AAuthorProxyProxy?
1872.         self.assertNumberMigrations(changes, 'otherapp', 1)
1873.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
1874.         # otherapp should depend on testapp.
1875.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('testapp', 'auto_1')])
1876.         # Now, test the pk table and field name.
1877.         fk_field = changes['otherapp'][0].operations[0].field
1878.         self.assertEqual(
1879.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1880.             ('testapp', 'authorproxy'),
1881.         )
1882.         self.assertEqual(fk_field.remote_field.model, 'testapp.AAuthorProxyProxy')
1883. 
1884.     def test_unmanaged_create(self):
1885.         """The autodetector correctly deals with managed models."""
1886.         # First, we test adding an unmanaged model
1887.         changes = self.get_changes([self.author_empty], [self.author_empty, self.author_unmanaged])
1888.         # Right number/type of migrations?
1889.         self.assertNumberMigrations(changes, 'testapp', 1)
1890.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1891.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="AuthorUnmanaged", options={"managed": False})
1892. 
1893.     def test_unmanaged_delete(self):
1894.         changes = self.get_changes([self.author_empty, self.author_unmanaged], [self.author_empty])
1895.         self.assertNumberMigrations(changes, 'testapp', 1)
1896.         self.assertOperationTypes(changes, 'testapp', 0, ['DeleteModel'])
1897. 
1898.     def test_unmanaged_to_managed(self):
1899.         # Now, we test turning an unmanaged model into a managed model
1900.         changes = self.get_changes(
1901.             [self.author_empty, self.author_unmanaged], [self.author_empty, self.author_unmanaged_managed]
1902.         )
1903.         # Right number/type of migrations?
1904.         self.assertNumberMigrations(changes, 'testapp', 1)
1905.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelOptions"])
1906.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="authorunmanaged", options={})
1907. 
1908.     def test_managed_to_unmanaged(self):
1909.         # Now, we turn managed to unmanaged.
1910.         changes = self.get_changes(
1911.             [self.author_empty, self.author_unmanaged_managed], [self.author_empty, self.author_unmanaged]
1912.         )
1913.         # Right number/type of migrations?
1914.         self.assertNumberMigrations(changes, 'testapp', 1)
1915.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
1916.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="authorunmanaged", options={"managed": False})
1917. 
1918.     def test_unmanaged_custom_pk(self):
1919.         """
1920.         #23415 - The autodetector must correctly deal with custom FK on
1921.         unmanaged models.
1922.         """
1923.         # First, we test the default pk field name
1924.         changes = self.get_changes([], [self.author_unmanaged_default_pk, self.book])
1925.         # The model the FK on the book model points to.
1926.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1927.         self.assertEqual(fk_field.remote_field.model, 'testapp.Author')
1928.         # Now, we test the custom pk field name
1929.         changes = self.get_changes([], [self.author_unmanaged_custom_pk, self.book])
1930.         # The model the FK on the book model points to.
1931.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1932.         self.assertEqual(fk_field.remote_field.model, 'testapp.Author')
1933. 
1934.     @override_settings(AUTH_USER_MODEL="thirdapp.CustomUser")
1935.     def test_swappable(self):
1936.         with isolate_lru_cache(apps.get_swappable_settings_name):
1937.             changes = self.get_changes([self.custom_user], [self.custom_user, self.author_with_custom_user])
1938.         # Right number/type of migrations?
1939.         self.assertNumberMigrations(changes, 'testapp', 1)
1940.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1941.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1942.         self.assertMigrationDependencies(changes, 'testapp', 0, [("__setting__", "AUTH_USER_MODEL")])
1943. 
1944.     def test_swappable_lowercase(self):
1945.         model_state = ModelState('testapp', 'Document', [
1946.             ('id', models.AutoField(primary_key=True)),
1947.             ('owner', models.ForeignKey(
1948.                 settings.AUTH_USER_MODEL.lower(), models.CASCADE,
1949.             )),
1950.         ])
1951.         with isolate_lru_cache(apps.get_swappable_settings_name):
1952.             changes = self.get_changes([], [model_state])
1953.         self.assertNumberMigrations(changes, 'testapp', 1)
1954.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
1955.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Document')
1956.         self.assertMigrationDependencies(
1957.             changes, 'testapp', 0, [('__setting__', 'AUTH_USER_MODEL')],
1958.         )
1959. 
1960.     def test_swappable_changed(self):
1961.         with isolate_lru_cache(apps.get_swappable_settings_name):
1962.             before = self.make_project_state([self.custom_user, self.author_with_user])
1963.             with override_settings(AUTH_USER_MODEL="thirdapp.CustomUser"):
1964.                 after = self.make_project_state([self.custom_user, self.author_with_custom_user])
1965.             autodetector = MigrationAutodetector(before, after)
1966.             changes = autodetector._detect_changes()
1967.         # Right number/type of migrations?
1968.         self.assertNumberMigrations(changes, 'testapp', 1)
1969.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
1970.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name="author", name='user')
1971.         fk_field = changes['testapp'][0].operations[0].field
1972.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.CustomUser')
1973. 
1974.     def test_add_field_with_default(self):
1975.         """#22030 - Adding a field with a default should work."""
1976.         changes = self.get_changes([self.author_empty], [self.author_name_default])
1977.         # Right number/type of migrations?
1978.         self.assertNumberMigrations(changes, 'testapp', 1)
1979.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
1980.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="name")
1981. 
1982.     def test_custom_deconstructible(self):
1983.         """
1984.         Two instances which deconstruct to the same value aren't considered a
1985.         change.
1986.         """
1987.         changes = self.get_changes([self.author_name_deconstructible_1], [self.author_name_deconstructible_2])
1988.         # Right number of migrations?
1989.         self.assertEqual(len(changes), 0)
1990. 
1991.     def test_deconstruct_field_kwarg(self):
1992.         """Field instances are handled correctly by nested deconstruction."""
1993.         changes = self.get_changes([self.author_name_deconstructible_3], [self.author_name_deconstructible_4])
1994.         self.assertEqual(changes, {})
1995. 
1996.     def test_deconstructible_list(self):
1997.         """Nested deconstruction descends into lists."""
1998.         # When lists contain items that deconstruct to identical values, those lists
1999.         # should be considered equal for the purpose of detecting state changes
2000.         # (even if the original items are unequal).
2001.         changes = self.get_changes(
2002.             [self.author_name_deconstructible_list_1], [self.author_name_deconstructible_list_2]
2003.         )
2004.         self.assertEqual(changes, {})
2005.         # Legitimate differences within the deconstructed lists should be reported
2006.         # as a change
2007.         changes = self.get_changes(
2008.             [self.author_name_deconstructible_list_1], [self.author_name_deconstructible_list_3]
2009.         )
2010.         self.assertEqual(len(changes), 1)
2011. 
2012.     def test_deconstructible_tuple(self):
2013.         """Nested deconstruction descends into tuples."""
2014.         # When tuples contain items that deconstruct to identical values, those tuples
2015.         # should be considered equal for the purpose of detecting state changes
2016.         # (even if the original items are unequal).
2017.         changes = self.get_changes(
2018.             [self.author_name_deconstructible_tuple_1], [self.author_name_deconstructible_tuple_2]
2019.         )
2020.         self.assertEqual(changes, {})
2021.         # Legitimate differences within the deconstructed tuples should be reported
2022.         # as a change
2023.         changes = self.get_changes(
2024.             [self.author_name_deconstructible_tuple_1], [self.author_name_deconstructible_tuple_3]
2025.         )
2026.         self.assertEqual(len(changes), 1)
2027. 
2028.     def test_deconstructible_dict(self):
2029.         """Nested deconstruction descends into dict values."""
2030.         # When dicts contain items whose values deconstruct to identical values,
2031.         # those dicts should be considered equal for the purpose of detecting
2032.         # state changes (even if the original values are unequal).
2033.         changes = self.get_changes(
2034.             [self.author_name_deconstructible_dict_1], [self.author_name_deconstructible_dict_2]
2035.         )
2036.         self.assertEqual(changes, {})
2037.         # Legitimate differences within the deconstructed dicts should be reported
2038.         # as a change
2039.         changes = self.get_changes(
2040.             [self.author_name_deconstructible_dict_1], [self.author_name_deconstructible_dict_3]
2041.         )
2042.         self.assertEqual(len(changes), 1)
2043. 
2044.     def test_nested_deconstructible_objects(self):
2045.         """
2046.         Nested deconstruction is applied recursively to the args/kwargs of
2047.         deconstructed objects.
2048.         """
2049.         # If the items within a deconstructed object's args/kwargs have the same
2050.         # deconstructed values - whether or not the items themselves are different
2051.         # instances - then the object as a whole is regarded as unchanged.
2052.         changes = self.get_changes(
2053.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_2]
2054.         )
2055.         self.assertEqual(changes, {})
2056.         # Differences that exist solely within the args list of a deconstructed object
2057.         # should be reported as changes
2058.         changes = self.get_changes(
2059.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_changed_arg]
2060.         )
2061.         self.assertEqual(len(changes), 1)
2062.         # Additional args should also be reported as a change
2063.         changes = self.get_changes(
2064.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_extra_arg]
2065.         )
2066.         self.assertEqual(len(changes), 1)
2067.         # Differences that exist solely within the kwargs dict of a deconstructed object
2068.         # should be reported as changes
2069.         changes = self.get_changes(
2070.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_changed_kwarg]
2071.         )
2072.         self.assertEqual(len(changes), 1)
2073.         # Additional kwargs should also be reported as a change
2074.         changes = self.get_changes(
2075.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_extra_kwarg]
2076.         )
2077.         self.assertEqual(len(changes), 1)
2078. 
2079.     def test_deconstruct_type(self):
2080.         """
2081.         #22951 -- Uninstantiated classes with deconstruct are correctly returned
2082.         by deep_deconstruct during serialization.
2083.         """
2084.         author = ModelState(
2085.             "testapp",
2086.             "Author",
2087.             [
2088.                 ("id", models.AutoField(primary_key=True)),
2089.                 ("name", models.CharField(
2090.                     max_length=200,
2091.                     # IntegerField intentionally not instantiated.
2092.                     default=models.IntegerField,
2093.                 ))
2094.             ],
2095.         )
2096.         changes = self.get_changes([], [author])
2097.         # Right number/type of migrations?
2098.         self.assertNumberMigrations(changes, 'testapp', 1)
2099.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
2100. 
2101.     def test_replace_string_with_foreignkey(self):
2102.         """
2103.         #22300 - Adding an FK in the same "spot" as a deleted CharField should
2104.         work.
2105.         """
2106.         changes = self.get_changes([self.author_with_publisher_string], [self.author_with_publisher, self.publisher])
2107.         # Right number/type of migrations?
2108.         self.assertNumberMigrations(changes, 'testapp', 1)
2109.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "RemoveField", "AddField"])
2110.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Publisher")
2111.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publisher_name")
2112.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="publisher")
2113. 
2114.     def test_foreign_key_removed_before_target_model(self):
2115.         """
2116.         Removing an FK and the model it targets in the same change must remove
2117.         the FK field before the model to maintain consistency.
2118.         """
2119.         changes = self.get_changes(
2120.             [self.author_with_publisher, self.publisher], [self.author_name]
2121.         )  # removes both the model and FK
2122.         # Right number/type of migrations?
2123.         self.assertNumberMigrations(changes, 'testapp', 1)
2124.         self.assertOperationTypes(changes, 'testapp', 0, ["RemoveField", "DeleteModel"])
2125.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publisher")
2126.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Publisher")
2127. 
2128.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
2129.                 side_effect=AssertionError("Should not have prompted for not null addition"))
2130.     def test_add_many_to_many(self, mocked_ask_method):
2131.         """#22435 - Adding a ManyToManyField should not prompt for a default."""
2132.         changes = self.get_changes([self.author_empty, self.publisher], [self.author_with_m2m, self.publisher])
2133.         # Right number/type of migrations?
2134.         self.assertNumberMigrations(changes, 'testapp', 1)
2135.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
2136.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers")
2137. 
2138.     def test_alter_many_to_many(self):
2139.         changes = self.get_changes(
2140.             [self.author_with_m2m, self.publisher], [self.author_with_m2m_blank, self.publisher]
2141.         )
2142.         # Right number/type of migrations?
2143.         self.assertNumberMigrations(changes, 'testapp', 1)
2144.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
2145.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers")
2146. 
2147.     def test_create_with_through_model(self):
2148.         """
2149.         Adding a m2m with a through model and the models that use it should be
2150.         ordered correctly.
2151.         """
2152.         changes = self.get_changes([], [self.author_with_m2m_through, self.publisher, self.contract])
2153.         # Right number/type of migrations?
2154.         self.assertNumberMigrations(changes, "testapp", 1)
2155.         self.assertOperationTypes(changes, "testapp", 0, [
2156.             'CreateModel', 'CreateModel', 'CreateModel', 'AddField',
2157.         ])
2158.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Author')
2159.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name='Publisher')
2160.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name='Contract')
2161.         self.assertOperationAttributes(changes, 'testapp', 0, 3, model_name='author', name='publishers')
2162. 
2163.     def test_many_to_many_removed_before_through_model(self):
2164.         """
2165.         Removing a ManyToManyField and the "through" model in the same change
2166.         must remove the field before the model to maintain consistency.
2167.         """
2168.         changes = self.get_changes(
2169.             [self.book_with_multiple_authors_through_attribution, self.author_name, self.attribution],
2170.             [self.book_with_no_author, self.author_name],
2171.         )
2172.         # Remove both the through model and ManyToMany
2173.         # Right number/type of migrations?
2174.         self.assertNumberMigrations(changes, "otherapp", 1)
2175.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveField', 'DeleteModel'])
2176.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='authors', model_name='book')
2177.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, name='Attribution')
2178. 
2179.     def test_many_to_many_removed_before_through_model_2(self):
2180.         """
2181.         Removing a model that contains a ManyToManyField and the "through" model
2182.         in the same change must remove the field before the model to maintain
2183.         consistency.
2184.         """
2185.         changes = self.get_changes(
2186.             [self.book_with_multiple_authors_through_attribution, self.author_name, self.attribution],
2187.             [self.author_name],
2188.         )
2189.         # Remove both the through model and ManyToMany
2190.         # Right number/type of migrations?
2191.         self.assertNumberMigrations(changes, "otherapp", 1)
2192.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveField', 'DeleteModel', 'DeleteModel'])
2193.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='authors', model_name='book')
2194.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, name='Attribution')
2195.         self.assertOperationAttributes(changes, 'otherapp', 0, 2, name='Book')
2196. 
2197.     def test_m2m_w_through_multistep_remove(self):
2198.         """
2199.         A model with a m2m field that specifies a "through" model cannot be
2200.         removed in the same migration as that through model as the schema will
2201.         pass through an inconsistent state. The autodetector should produce two
2202.         migrations to avoid this issue.
2203.         """
2204.         changes = self.get_changes([self.author_with_m2m_through, self.publisher, self.contract], [self.publisher])
2205.         # Right number/type of migrations?
2206.         self.assertNumberMigrations(changes, "testapp", 1)
2207.         self.assertOperationTypes(changes, "testapp", 0, [
2208.             "RemoveField", "RemoveField", "DeleteModel", "DeleteModel"
2209.         ])
2210.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", model_name='contract')
2211.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="publisher", model_name='contract')
2212.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="Author")
2213.         self.assertOperationAttributes(changes, "testapp", 0, 3, name="Contract")
2214. 
2215.     def test_concrete_field_changed_to_many_to_many(self):
2216.         """
2217.         #23938 - Changing a concrete field into a ManyToManyField
2218.         first removes the concrete field and then adds the m2m field.
2219.         """
2220.         changes = self.get_changes([self.author_with_former_m2m], [self.author_with_m2m, self.publisher])
2221.         # Right number/type of migrations?
2222.         self.assertNumberMigrations(changes, "testapp", 1)
2223.         self.assertOperationTypes(changes, "testapp", 0, ["CreateModel", "RemoveField", "AddField"])
2224.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Publisher')
2225.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publishers", model_name='author')
2226.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="publishers", model_name='author')
2227. 
2228.     def test_many_to_many_changed_to_concrete_field(self):
2229.         """
2230.         #23938 - Changing a ManyToManyField into a concrete field
2231.         first removes the m2m field and then adds the concrete field.
2232.         """
2233.         changes = self.get_changes([self.author_with_m2m, self.publisher], [self.author_with_former_m2m])
2234.         # Right number/type of migrations?
2235.         self.assertNumberMigrations(changes, "testapp", 1)
2236.         self.assertOperationTypes(changes, "testapp", 0, ["RemoveField", "AddField", "DeleteModel"])
2237.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers", model_name='author')
2238.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publishers", model_name='author')
2239.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name='Publisher')
2240.         self.assertOperationFieldAttributes(changes, 'testapp', 0, 1, max_length=100)
2241. 
2242.     def test_non_circular_foreignkey_dependency_removal(self):
2243.         """
2244.         If two models with a ForeignKey from one to the other are removed at the
2245.         same time, the autodetector should remove them in the correct order.
2246.         """
2247.         changes = self.get_changes([self.author_with_publisher, self.publisher_with_author], [])
2248.         # Right number/type of migrations?
2249.         self.assertNumberMigrations(changes, "testapp", 1)
2250.         self.assertOperationTypes(changes, "testapp", 0, ["RemoveField", "DeleteModel", "DeleteModel"])
2251.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", model_name='publisher')
2252.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
2253.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="Publisher")
2254. 
2255.     def test_alter_model_options(self):
2256.         """Changing a model's options should make a change."""
2257.         changes = self.get_changes([self.author_empty], [self.author_with_options])
2258.         # Right number/type of migrations?
2259.         self.assertNumberMigrations(changes, "testapp", 1)
2260.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2261.         self.assertOperationAttributes(changes, "testapp", 0, 0, options={
2262.             "permissions": [('can_hire', 'Can hire')],
2263.             "verbose_name": "Authi",
2264.         })
2265. 
2266.         # Changing them back to empty should also make a change
2267.         changes = self.get_changes([self.author_with_options], [self.author_empty])
2268.         # Right number/type of migrations?
2269.         self.assertNumberMigrations(changes, "testapp", 1)
2270.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2271.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", options={})
2272. 
2273.     def test_alter_model_options_proxy(self):
2274.         """Changing a proxy model's options should also make a change."""
2275.         changes = self.get_changes(
2276.             [self.author_proxy, self.author_empty], [self.author_proxy_options, self.author_empty]
2277.         )
2278.         # Right number/type of migrations?
2279.         self.assertNumberMigrations(changes, "testapp", 1)
2280.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2281.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="authorproxy", options={
2282.             "verbose_name": "Super Author"
2283.         })
2284. 
2285.     def test_set_alter_order_with_respect_to(self):
2286.         """Setting order_with_respect_to adds a field."""
2287.         changes = self.get_changes([self.book, self.author_with_book], [self.book, self.author_with_book_order_wrt])
2288.         # Right number/type of migrations?
2289.         self.assertNumberMigrations(changes, 'testapp', 1)
2290.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterOrderWithRespectTo"])
2291.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="author", order_with_respect_to="book")
2292. 
2293.     def test_add_alter_order_with_respect_to(self):
2294.         """
2295.         Setting order_with_respect_to when adding the FK too does
2296.         things in the right order.
2297.         """
2298.         changes = self.get_changes([self.author_name], [self.book, self.author_with_book_order_wrt])
2299.         # Right number/type of migrations?
2300.         self.assertNumberMigrations(changes, 'testapp', 1)
2301.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AlterOrderWithRespectTo"])
2302.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name="author", name="book")
2303.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="author", order_with_respect_to="book")
2304. 
2305.     def test_remove_alter_order_with_respect_to(self):
2306.         """
2307.         Removing order_with_respect_to when removing the FK too does
2308.         things in the right order.
2309.         """
2310.         changes = self.get_changes([self.book, self.author_with_book_order_wrt], [self.author_name])
2311.         # Right number/type of migrations?
2312.         self.assertNumberMigrations(changes, 'testapp', 1)
2313.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterOrderWithRespectTo", "RemoveField"])
2314.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="author", order_with_respect_to=None)
2315.         self.assertOperationAttributes(changes, 'testapp', 0, 1, model_name="author", name="book")
2316. 
2317.     def test_add_model_order_with_respect_to(self):
2318.         """
2319.         Setting order_with_respect_to when adding the whole model
2320.         does things in the right order.
2321.         """
2322.         changes = self.get_changes([], [self.book, self.author_with_book_order_wrt])
2323.         # Right number/type of migrations?
2324.         self.assertNumberMigrations(changes, 'testapp', 1)
2325.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
2326.         self.assertOperationAttributes(
2327.             changes, 'testapp', 0, 0, name="Author", options={'order_with_respect_to': 'book'}
2328.         )
2329.         self.assertNotIn("_order", [name for name, field in changes['testapp'][0].operations[0].fields])
2330. 
2331.     def test_add_model_order_with_respect_to_index_foo_together(self):
2332.         changes = self.get_changes([], [
2333.             self.book,
2334.             ModelState('testapp', 'Author', [
2335.                 ('id', models.AutoField(primary_key=True)),
2336.                 ('name', models.CharField(max_length=200)),
2337.                 ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2338.             ], options={
2339.                 'order_with_respect_to': 'book',
2340.                 'index_together': {('name', '_order')},
2341.                 'unique_together': {('id', '_order')},
2342.             }),
2343.         ])
2344.         self.assertNumberMigrations(changes, 'testapp', 1)
2345.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
2346.         self.assertOperationAttributes(
2347.             changes,
2348.             'testapp',
2349.             0,
2350.             0,
2351.             name='Author',
2352.             options={
2353.                 'order_with_respect_to': 'book',
2354.                 'index_together': {('name', '_order')},
2355.                 'unique_together': {('id', '_order')},
2356.             },
2357.         )
2358. 
2359.     def test_add_model_order_with_respect_to_index_constraint(self):
2360.         tests = [
2361.             (
2362.                 'AddIndex',
2363.                 {'indexes': [
2364.                     models.Index(fields=['_order'], name='book_order_idx'),
2365.                 ]},
2366.             ),
2367.             (
2368.                 'AddConstraint',
2369.                 {'constraints': [
2370.                     models.CheckConstraint(
2371.                         check=models.Q(_order__gt=1),
2372.                         name='book_order_gt_1',
2373.                     ),
2374.                 ]},
2375.             ),
2376.         ]
2377.         for operation, extra_option in tests:
2378.             with self.subTest(operation=operation):
2379.                 after = ModelState('testapp', 'Author', [
2380.                     ('id', models.AutoField(primary_key=True)),
2381.                     ('name', models.CharField(max_length=200)),
2382.                     ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2383.                 ], options={
2384.                     'order_with_respect_to': 'book',
2385.                     **extra_option,
2386.                 })
2387.                 changes = self.get_changes([], [self.book, after])
2388.                 self.assertNumberMigrations(changes, 'testapp', 1)
2389.                 self.assertOperationTypes(changes, 'testapp', 0, [
2390.                     'CreateModel', operation,
2391.                 ])
2392.                 self.assertOperationAttributes(
2393.                     changes,
2394.                     'testapp',
2395.                     0,
2396.                     0,
2397.                     name='Author',
2398.                     options={'order_with_respect_to': 'book'},
2399.                 )
2400. 
2401.     def test_set_alter_order_with_respect_to_index_constraint_foo_together(self):
2402.         tests = [
2403.             (
2404.                 'AddIndex',
2405.                 {'indexes': [
2406.                     models.Index(fields=['_order'], name='book_order_idx'),
2407.                 ]},
2408.             ),
2409.             (
2410.                 'AddConstraint',
2411.                 {'constraints': [
2412.                     models.CheckConstraint(
2413.                         check=models.Q(_order__gt=1),
2414.                         name='book_order_gt_1',
2415.                     ),
2416.                 ]},
2417.             ),
2418.             ('AlterIndexTogether', {'index_together': {('name', '_order')}}),
2419.             ('AlterUniqueTogether', {'unique_together': {('id', '_order')}}),
2420.         ]
2421.         for operation, extra_option in tests:
2422.             with self.subTest(operation=operation):
2423.                 after = ModelState('testapp', 'Author', [
2424.                     ('id', models.AutoField(primary_key=True)),
2425.                     ('name', models.CharField(max_length=200)),
2426.                     ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2427.                 ], options={
2428.                     'order_with_respect_to': 'book',
2429.                     **extra_option,
2430.                 })
2431.                 changes = self.get_changes(
2432.                     [self.book, self.author_with_book],
2433.                     [self.book, after],
2434.                 )
2435.                 self.assertNumberMigrations(changes, 'testapp', 1)
2436.                 self.assertOperationTypes(changes, 'testapp', 0, [
2437.                     'AlterOrderWithRespectTo', operation,
2438.                 ])
2439. 
2440.     def test_alter_model_managers(self):
2441.         """
2442.         Changing the model managers adds a new operation.
2443.         """
2444.         changes = self.get_changes([self.other_pony], [self.other_pony_food])
2445.         # Right number/type of migrations?
2446.         self.assertNumberMigrations(changes, 'otherapp', 1)
2447.         self.assertOperationTypes(changes, 'otherapp', 0, ["AlterModelManagers"])
2448.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="pony")
2449.         self.assertEqual([name for name, mgr in changes['otherapp'][0].operations[0].managers],
2450.                          ['food_qs', 'food_mgr', 'food_mgr_kwargs'])
2451.         self.assertEqual(changes['otherapp'][0].operations[0].managers[1][1].args, ('a', 'b', 1, 2))
2452.         self.assertEqual(changes['otherapp'][0].operations[0].managers[2][1].args, ('x', 'y', 3, 4))
2453. 
2454.     def test_swappable_first_inheritance(self):
2455.         """Swappable models get their CreateModel first."""
2456.         changes = self.get_changes([], [self.custom_user, self.aardvark])
2457.         # Right number/type of migrations?
2458.         self.assertNumberMigrations(changes, 'thirdapp', 1)
2459.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel", "CreateModel"])
2460.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="CustomUser")
2461.         self.assertOperationAttributes(changes, 'thirdapp', 0, 1, name="Aardvark")
2462. 
2463.     def test_default_related_name_option(self):
2464.         model_state = ModelState('app', 'model', [
2465.             ('id', models.AutoField(primary_key=True)),
2466.         ], options={'default_related_name': 'related_name'})
2467.         changes = self.get_changes([], [model_state])
2468.         self.assertNumberMigrations(changes, 'app', 1)
2469.         self.assertOperationTypes(changes, 'app', 0, ['CreateModel'])
2470.         self.assertOperationAttributes(
2471.             changes, 'app', 0, 0, name='model',
2472.             options={'default_related_name': 'related_name'},
2473.         )
2474.         altered_model_state = ModelState('app', 'Model', [
2475.             ('id', models.AutoField(primary_key=True)),
2476.         ])
2477.         changes = self.get_changes([model_state], [altered_model_state])
2478.         self.assertNumberMigrations(changes, 'app', 1)
2479.         self.assertOperationTypes(changes, 'app', 0, ['AlterModelOptions'])
2480.         self.assertOperationAttributes(changes, 'app', 0, 0, name='model', options={})
2481. 
2482.     @override_settings(AUTH_USER_MODEL="thirdapp.CustomUser")
2483.     def test_swappable_first_setting(self):
2484.         """Swappable models get their CreateModel first."""
2485.         with isolate_lru_cache(apps.get_swappable_settings_name):
2486.             changes = self.get_changes([], [self.custom_user_no_inherit, self.aardvark])
2487.         # Right number/type of migrations?
2488.         self.assertNumberMigrations(changes, 'thirdapp', 1)
2489.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel", "CreateModel"])
2490.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="CustomUser")
2491.         self.assertOperationAttributes(changes, 'thirdapp', 0, 1, name="Aardvark")
2492. 
2493.     def test_bases_first(self):
2494.         """Bases of other models come first."""
2495.         changes = self.get_changes([], [self.aardvark_based_on_author, self.author_name])
2496.         # Right number/type of migrations?
2497.         self.assertNumberMigrations(changes, 'testapp', 1)
2498.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
2499.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2500.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Aardvark")
2501. 
2502.     def test_bases_first_mixed_case_app_label(self):
2503.         app_label = 'MiXedCaseApp'
2504.         changes = self.get_changes([], [
2505.             ModelState(app_label, 'owner', [
2506.                 ('id', models.AutoField(primary_key=True)),
2507.             ]),
2508.             ModelState(app_label, 'place', [
2509.                 ('id', models.AutoField(primary_key=True)),
2510.                 ('owner', models.ForeignKey('MiXedCaseApp.owner', models.CASCADE)),
2511.             ]),
2512.             ModelState(app_label, 'restaurant', [], bases=('MiXedCaseApp.place',)),
2513.         ])
2514.         self.assertNumberMigrations(changes, app_label, 1)
2515.         self.assertOperationTypes(changes, app_label, 0, [
2516.             'CreateModel', 'CreateModel', 'CreateModel',
2517.         ])
2518.         self.assertOperationAttributes(changes, app_label, 0, 0, name='owner')
2519.         self.assertOperationAttributes(changes, app_label, 0, 1, name='place')
2520.         self.assertOperationAttributes(changes, app_label, 0, 2, name='restaurant')
2521. 
2522.     def test_multiple_bases(self):
2523.         """#23956 - Inheriting models doesn't move *_ptr fields into AddField operations."""
2524.         A = ModelState("app", "A", [("a_id", models.AutoField(primary_key=True))])
2525.         B = ModelState("app", "B", [("b_id", models.AutoField(primary_key=True))])
2526.         C = ModelState("app", "C", [], bases=("app.A", "app.B"))
2527.         D = ModelState("app", "D", [], bases=("app.A", "app.B"))
2528.         E = ModelState("app", "E", [], bases=("app.A", "app.B"))
2529.         changes = self.get_changes([], [A, B, C, D, E])
2530.         # Right number/type of migrations?
2531.         self.assertNumberMigrations(changes, "app", 1)
2532.         self.assertOperationTypes(changes, "app", 0, [
2533.             "CreateModel", "CreateModel", "CreateModel", "CreateModel", "CreateModel"
2534.         ])
2535.         self.assertOperationAttributes(changes, "app", 0, 0, name="A")
2536.         self.assertOperationAttributes(changes, "app", 0, 1, name="B")
2537.         self.assertOperationAttributes(changes, "app", 0, 2, name="C")
2538.         self.assertOperationAttributes(changes, "app", 0, 3, name="D")
2539.         self.assertOperationAttributes(changes, "app", 0, 4, name="E")
2540. 
2541.     def test_proxy_bases_first(self):
2542.         """Bases of proxies come first."""
2543.         changes = self.get_changes([], [self.author_empty, self.author_proxy, self.author_proxy_proxy])
2544.         # Right number/type of migrations?
2545.         self.assertNumberMigrations(changes, 'testapp', 1)
2546.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel", "CreateModel"])
2547.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2548.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="AuthorProxy")
2549.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="AAuthorProxyProxy")
2550. 
2551.     def test_pk_fk_included(self):
2552.         """
2553.         A relation used as the primary key is kept as part of CreateModel.
2554.         """
2555.         changes = self.get_changes([], [self.aardvark_pk_fk_author, self.author_name])
2556.         # Right number/type of migrations?
2557.         self.assertNumberMigrations(changes, 'testapp', 1)
2558.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
2559.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2560.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Aardvark")
2561. 
2562.     def test_first_dependency(self):
2563.         """
2564.         A dependency to an app with no migrations uses __first__.
2565.         """
2566.         # Load graph
2567.         loader = MigrationLoader(connection)
2568.         before = self.make_project_state([])
2569.         after = self.make_project_state([self.book_migrations_fk])
2570.         after.real_apps = {'migrations'}
2571.         autodetector = MigrationAutodetector(before, after)
2572.         changes = autodetector._detect_changes(graph=loader.graph)
2573.         # Right number/type of migrations?
2574.         self.assertNumberMigrations(changes, 'otherapp', 1)
2575.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
2576.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
2577.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("migrations", "__first__")])
2578. 
2579.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
2580.     def test_last_dependency(self):
2581.         """
2582.         A dependency to an app with existing migrations uses the
2583.         last migration of that app.
2584.         """
2585.         # Load graph
2586.         loader = MigrationLoader(connection)
2587.         before = self.make_project_state([])
2588.         after = self.make_project_state([self.book_migrations_fk])
2589.         after.real_apps = {'migrations'}
2590.         autodetector = MigrationAutodetector(before, after)
2591.         changes = autodetector._detect_changes(graph=loader.graph)
2592.         # Right number/type of migrations?
2593.         self.assertNumberMigrations(changes, 'otherapp', 1)
2594.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
2595.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
2596.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("migrations", "0002_second")])
2597. 
2598.     def test_alter_fk_before_model_deletion(self):
2599.         """
2600.         ForeignKeys are altered _before_ the model they used to
2601.         refer to are deleted.
2602.         """
2603.         changes = self.get_changes(
2604.             [self.author_name, self.publisher_with_author],
2605.             [self.aardvark_testapp, self.publisher_with_aardvark_author]
2606.         )
2607.         # Right number/type of migrations?
2608.         self.assertNumberMigrations(changes, 'testapp', 1)
2609.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "AlterField", "DeleteModel"])
2610.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Aardvark")
2611.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="author")
2612.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="Author")
2613. 
2614.     def test_fk_dependency_other_app(self):
2615.         """
2616.         #23100 - ForeignKeys correctly depend on other apps' models.
2617.         """
2618.         changes = self.get_changes([self.author_name, self.book], [self.author_with_book, self.book])
2619.         # Right number/type of migrations?
2620.         self.assertNumberMigrations(changes, 'testapp', 1)
2621.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
2622.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="book")
2623.         self.assertMigrationDependencies(changes, 'testapp', 0, [("otherapp", "__first__")])
2624. 
2625.     def test_alter_field_to_fk_dependency_other_app(self):
2626.         changes = self.get_changes(
2627.             [self.author_empty, self.book_with_no_author_fk],
2628.             [self.author_empty, self.book],
2629.         )
2630.         self.assertNumberMigrations(changes, 'otherapp', 1)
2631.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
2632.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('testapp', '__first__')])
2633. 
2634.     def test_circular_dependency_mixed_addcreate(self):
2635.         """
2636.         #23315 - The dependency resolver knows to put all CreateModel
2637.         before AddField and not become unsolvable.
2638.         """
2639.         address = ModelState("a", "Address", [
2640.             ("id", models.AutoField(primary_key=True)),
2641.             ("country", models.ForeignKey("b.DeliveryCountry", models.CASCADE)),
2642.         ])
2643.         person = ModelState("a", "Person", [
2644.             ("id", models.AutoField(primary_key=True)),
2645.         ])
2646.         apackage = ModelState("b", "APackage", [
2647.             ("id", models.AutoField(primary_key=True)),
2648.             ("person", models.ForeignKey("a.Person", models.CASCADE)),
2649.         ])
2650.         country = ModelState("b", "DeliveryCountry", [
2651.             ("id", models.AutoField(primary_key=True)),
2652.         ])
2653.         changes = self.get_changes([], [address, person, apackage, country])
2654.         # Right number/type of migrations?
2655.         self.assertNumberMigrations(changes, 'a', 2)
2656.         self.assertNumberMigrations(changes, 'b', 1)
2657.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel", "CreateModel"])
2658.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2659.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel", "CreateModel"])
2660. 
2661.     @override_settings(AUTH_USER_MODEL="a.Tenant")
2662.     def test_circular_dependency_swappable(self):
2663.         """
2664.         #23322 - The dependency resolver knows to explicitly resolve
2665.         swappable models.
2666.         """
2667.         with isolate_lru_cache(apps.get_swappable_settings_name):
2668.             tenant = ModelState("a", "Tenant", [
2669.                 ("id", models.AutoField(primary_key=True)),
2670.                 ("primary_address", models.ForeignKey("b.Address", models.CASCADE))],
2671.                 bases=(AbstractBaseUser,)
2672.             )
2673.             address = ModelState("b", "Address", [
2674.                 ("id", models.AutoField(primary_key=True)),
2675.                 ("tenant", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE)),
2676.             ])
2677.             changes = self.get_changes([], [address, tenant])
2678. 
2679.         # Right number/type of migrations?
2680.         self.assertNumberMigrations(changes, 'a', 2)
2681.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2682.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2683.         self.assertMigrationDependencies(changes, 'a', 0, [])
2684.         self.assertMigrationDependencies(changes, 'a', 1, [('a', 'auto_1'), ('b', 'auto_1')])
2685.         # Right number/type of migrations?
2686.         self.assertNumberMigrations(changes, 'b', 1)
2687.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel"])
2688.         self.assertMigrationDependencies(changes, 'b', 0, [('__setting__', 'AUTH_USER_MODEL')])
2689. 
2690.     @override_settings(AUTH_USER_MODEL="b.Tenant")
2691.     def test_circular_dependency_swappable2(self):
2692.         """
2693.         #23322 - The dependency resolver knows to explicitly resolve
2694.         swappable models but with the swappable not being the first migrated
2695.         model.
2696.         """
2697.         with isolate_lru_cache(apps.get_swappable_settings_name):
2698.             address = ModelState("a", "Address", [
2699.                 ("id", models.AutoField(primary_key=True)),
2700.                 ("tenant", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE)),
2701.             ])
2702.             tenant = ModelState("b", "Tenant", [
2703.                 ("id", models.AutoField(primary_key=True)),
2704.                 ("primary_address", models.ForeignKey("a.Address", models.CASCADE))],
2705.                 bases=(AbstractBaseUser,)
2706.             )
2707.             changes = self.get_changes([], [address, tenant])
2708.         # Right number/type of migrations?
2709.         self.assertNumberMigrations(changes, 'a', 2)
2710.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2711.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2712.         self.assertMigrationDependencies(changes, 'a', 0, [])
2713.         self.assertMigrationDependencies(changes, 'a', 1, [('__setting__', 'AUTH_USER_MODEL'), ('a', 'auto_1')])
2714.         # Right number/type of migrations?
2715.         self.assertNumberMigrations(changes, 'b', 1)
2716.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel"])
2717.         self.assertMigrationDependencies(changes, 'b', 0, [('a', 'auto_1')])
2718. 
2719.     @override_settings(AUTH_USER_MODEL="a.Person")
2720.     def test_circular_dependency_swappable_self(self):
2721.         """
2722.         #23322 - The dependency resolver knows to explicitly resolve
2723.         swappable models.
2724.         """
2725.         with isolate_lru_cache(apps.get_swappable_settings_name):
2726.             person = ModelState("a", "Person", [
2727.                 ("id", models.AutoField(primary_key=True)),
2728.                 ("parent1", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE, related_name='children'))
2729.             ])
2730.             changes = self.get_changes([], [person])
2731.         # Right number/type of migrations?
2732.         self.assertNumberMigrations(changes, 'a', 1)
2733.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2734.         self.assertMigrationDependencies(changes, 'a', 0, [])
2735. 
2736.     @override_settings(AUTH_USER_MODEL='a.User')
2737.     def test_swappable_circular_multi_mti(self):
2738.         with isolate_lru_cache(apps.get_swappable_settings_name):
2739.             parent = ModelState('a', 'Parent', [
2740.                 ('user', models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE))
2741.             ])
2742.             child = ModelState('a', 'Child', [], bases=('a.Parent',))
2743.             user = ModelState('a', 'User', [], bases=(AbstractBaseUser, 'a.Child'))
2744.             changes = self.get_changes([], [parent, child, user])
2745.         self.assertNumberMigrations(changes, 'a', 1)
2746.         self.assertOperationTypes(changes, 'a', 0, ['CreateModel', 'CreateModel', 'CreateModel', 'AddField'])
2747. 
2748.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
2749.                 side_effect=AssertionError("Should not have prompted for not null addition"))
2750.     def test_add_blank_textfield_and_charfield(self, mocked_ask_method):
2751.         """
2752.         #23405 - Adding a NOT NULL and blank `CharField` or `TextField`
2753.         without default should not prompt for a default.
2754.         """
2755.         changes = self.get_changes([self.author_empty], [self.author_with_biography_blank])
2756.         # Right number/type of migrations?
2757.         self.assertNumberMigrations(changes, 'testapp', 1)
2758.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField"])
2759.         self.assertOperationAttributes(changes, 'testapp', 0, 0)
2760. 
2761.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition')
2762.     def test_add_non_blank_textfield_and_charfield(self, mocked_ask_method):
2763.         """
2764.         #23405 - Adding a NOT NULL and non-blank `CharField` or `TextField`
2765.         without default should prompt for a default.
2766.         """
2767.         changes = self.get_changes([self.author_empty], [self.author_with_biography_non_blank])
2768.         self.assertEqual(mocked_ask_method.call_count, 2)
2769.         # Right number/type of migrations?
2770.         self.assertNumberMigrations(changes, 'testapp', 1)
2771.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField"])
2772.         self.assertOperationAttributes(changes, 'testapp', 0, 0)
2773. 
2774.     def test_mti_inheritance_model_removal(self):
2775.         Animal = ModelState('app', 'Animal', [
2776.             ("id", models.AutoField(primary_key=True)),
2777.         ])
2778.         Dog = ModelState('app', 'Dog', [], bases=('app.Animal',))
2779.         changes = self.get_changes([Animal, Dog], [Animal])
2780.         self.assertNumberMigrations(changes, 'app', 1)
2781.         self.assertOperationTypes(changes, 'app', 0, ['DeleteModel'])
2782.         self.assertOperationAttributes(changes, 'app', 0, 0, name='Dog')
2783. 
2784.     def test_add_model_with_field_removed_from_base_model(self):
2785.         """
2786.         Removing a base field takes place before adding a new inherited model
2787.         that has a field with the same name.
2788.         """
2789.         before = [
2790.             ModelState('app', 'readable', [
2791.                 ('id', models.AutoField(primary_key=True)),
2792.                 ('title', models.CharField(max_length=200)),
2793.             ]),
2794.         ]
2795.         after = [
2796.             ModelState('app', 'readable', [
2797.                 ('id', models.AutoField(primary_key=True)),
2798.             ]),
2799.             ModelState('app', 'book', [
2800.                 ('title', models.CharField(max_length=200)),
2801.             ], bases=('app.readable',)),
2802.         ]
2803.         changes = self.get_changes(before, after)
2804.         self.assertNumberMigrations(changes, 'app', 1)
2805.         self.assertOperationTypes(changes, 'app', 0, ['RemoveField', 'CreateModel'])
2806.         self.assertOperationAttributes(changes, 'app', 0, 0, name='title', model_name='readable')
2807.         self.assertOperationAttributes(changes, 'app', 0, 1, name='book')
2808. 
2809.     def test_parse_number(self):
2810.         tests = [
2811.             ('no_number', None),
2812.             ('0001_initial', 1),
2813.             ('0002_model3', 2),
2814.             ('0002_auto_20380101_1112', 2),
2815.             ('0002_squashed_0003', 3),
2816.             ('0002_model2_squashed_0003_other4', 3),
2817.             ('0002_squashed_0003_squashed_0004', 4),
2818.             ('0002_model2_squashed_0003_other4_squashed_0005_other6', 5),
2819.             ('0002_custom_name_20380101_1112_squashed_0003_model', 3),
2820.             ('2_squashed_4', 4),
2821.         ]
2822.         for migration_name, expected_number in tests:
2823.             with self.subTest(migration_name=migration_name):
2824.                 self.assertEqual(
2825.                     MigrationAutodetector.parse_number(migration_name),
2826.                     expected_number,
2827.                 )
2828. 
2829.     def test_add_custom_fk_with_hardcoded_to(self):
2830.         class HardcodedForeignKey(models.ForeignKey):
2831.             def __init__(self, *args, **kwargs):
2832.                 kwargs['to'] = 'testapp.Author'
2833.                 super().__init__(*args, **kwargs)
2834. 
2835.             def deconstruct(self):
2836.                 name, path, args, kwargs = super().deconstruct()
2837.                 del kwargs['to']
2838.                 return name, path, args, kwargs
2839. 
2840.         book_hardcoded_fk_to = ModelState('testapp', 'Book', [
2841.             ('author', HardcodedForeignKey(on_delete=models.CASCADE)),
2842.         ])
2843.         changes = self.get_changes(
2844.             [self.author_empty],
2845.             [self.author_empty, book_hardcoded_fk_to],
2846.         )
2847.         self.assertNumberMigrations(changes, 'testapp', 1)
2848.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
2849.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Book')
2850. 
2851. 
2852. class MigrationSuggestNameTests(SimpleTestCase):
2853.     def test_no_operations(self):
2854.         class Migration(migrations.Migration):
2855.             operations = []
2856. 
2857.         migration = Migration('some_migration', 'test_app')
2858.         self.assertIs(migration.suggest_name().startswith('auto_'), True)
2859. 
2860.     def test_no_operations_initial(self):
2861.         class Migration(migrations.Migration):
2862.             initial = True
2863.             operations = []
2864. 
2865.         migration = Migration('some_migration', 'test_app')
2866.         self.assertEqual(migration.suggest_name(), 'initial')
2867. 
2868.     def test_single_operation(self):
2869.         class Migration(migrations.Migration):
2870.             operations = [migrations.CreateModel('Person', fields=[])]
2871. 
2872.         migration = Migration('0001_initial', 'test_app')
2873.         self.assertEqual(migration.suggest_name(), 'person')
2874. 
2875.         class Migration(migrations.Migration):
2876.             operations = [migrations.DeleteModel('Person')]
2877. 
2878.         migration = Migration('0002_initial', 'test_app')
2879.         self.assertEqual(migration.suggest_name(), 'delete_person')
2880. 
2881.     def test_single_operation_long_name(self):
2882.         class Migration(migrations.Migration):
2883.             operations = [migrations.CreateModel('A' * 53, fields=[])]
2884. 
2885.         migration = Migration('some_migration', 'test_app')
2886.         self.assertEqual(migration.suggest_name(), 'a' * 53)
2887. 
2888.     def test_two_operations(self):
2889.         class Migration(migrations.Migration):
2890.             operations = [
2891.                 migrations.CreateModel('Person', fields=[]),
2892.                 migrations.DeleteModel('Animal'),
2893.             ]
2894. 
2895.         migration = Migration('some_migration', 'test_app')
2896.         self.assertEqual(migration.suggest_name(), 'person_delete_animal')
2897. 
2898.     def test_two_create_models(self):
2899.         class Migration(migrations.Migration):
2900.             operations = [
2901.                 migrations.CreateModel('Person', fields=[]),
2902.                 migrations.CreateModel('Animal', fields=[]),
2903.             ]
2904. 
2905.         migration = Migration('0001_initial', 'test_app')
2906.         self.assertEqual(migration.suggest_name(), 'person_animal')
2907. 
2908.     def test_two_create_models_with_initial_true(self):
2909.         class Migration(migrations.Migration):
2910.             initial = True
2911.             operations = [
2912.                 migrations.CreateModel('Person', fields=[]),
2913.                 migrations.CreateModel('Animal', fields=[]),
2914.             ]
2915. 
2916.         migration = Migration('0001_initial', 'test_app')
2917.         self.assertEqual(migration.suggest_name(), 'initial')
2918. 
2919.     def test_many_operations_suffix(self):
2920.         class Migration(migrations.Migration):
2921.             operations = [
2922.                 migrations.CreateModel('Person1', fields=[]),
2923.                 migrations.CreateModel('Person2', fields=[]),
2924.                 migrations.CreateModel('Person3', fields=[]),
2925.                 migrations.DeleteModel('Person4'),
2926.                 migrations.DeleteModel('Person5'),
2927.             ]
2928. 
2929.         migration = Migration('some_migration', 'test_app')
2930.         self.assertEqual(
2931.             migration.suggest_name(),
2932.             'person1_person2_person3_delete_person4_and_more',
2933.         )
2934. 
2935.     def test_operation_with_no_suggested_name(self):
2936.         class Migration(migrations.Migration):
2937.             operations = [
2938.                 migrations.CreateModel('Person', fields=[]),
2939.                 migrations.RunSQL('SELECT 1 FROM person;'),
2940.             ]
2941. 
2942.         migration = Migration('some_migration', 'test_app')
2943.         self.assertIs(migration.suggest_name().startswith('auto_'), True)
2944. 
2945.     def test_none_name(self):
2946.         class Migration(migrations.Migration):
2947.             operations = [migrations.RunSQL('SELECT 1 FROM person;')]
2948. 
2949.         migration = Migration('0001_initial', 'test_app')
2950.         suggest_name = migration.suggest_name()
2951.         self.assertIs(suggest_name.startswith('auto_'), True)
2952. 
2953.     def test_none_name_with_initial_true(self):
2954.         class Migration(migrations.Migration):
2955.             initial = True
2956.             operations = [migrations.RunSQL('SELECT 1 FROM person;')]
2957. 
2958.         migration = Migration('0001_initial', 'test_app')
2959.         self.assertEqual(migration.suggest_name(), 'initial')
2960. 
2961.     def test_auto(self):
2962.         migration = migrations.Migration('0001_initial', 'test_app')
2963.         suggest_name = migration.suggest_name()
2964.         self.assertIs(suggest_name.startswith('auto_'), True)

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-22 23:49:55,689 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'tests/migrations/test_autodetector.py'. The provided context contains the file's content from line 1 to 2964. Therefore, to fulfill the request, the entire file content is extracted.", relative_path='tests/migrations/test_autodetector.py', start_line=1, end_line=2964)]
2025-12-22 23:49:55,695 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/migrations/test_autodetector.py`.
2025-12-22 23:49:55,695 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-22 23:49:55,696 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-22 23:49:55,696 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 0 existing contexts
2025-12-22 23:49:55,696 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 1 total contexts (removed 0 duplicates)
2025-12-22 23:49:55,697 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       └── legend_test.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   ├── custom_sitemap_index.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Use simplified paths for deconstruct of expressions

Description: Description
	
Previously F() deconstructed to: django.db.models.expressions.F(). But since it can also be imported from django.db.models, ​PR #14047 changed it to deconstruct to django.db.models.F(). This simplifies generated migration code where it will be referenced only as from django.db import models / models.F().
As Mariusz pointed out on the PR, the same technique can be applied to other expressions, further simplifying generated migrations.

Patch information:
diff --git a/django/db/models/expressions.py b/django/db/models/expressions.py
index 8642e1f151..9705863917 100644
--- a/django/db/models/expressions.py
+++ b/django/db/models/expressions.py
@@ -390,7 +390,7 @@ class BaseExpression:
         return sql, params
 
 
-@deconstructible
+@deconstructible(path='django.db.models.Expression')
 class Expression(BaseExpression, Combinable):
     """An expression that can be combined with other expressions."""
 
@@ -639,6 +639,7 @@ class ResolvedOuterRef(F):
         return []
 
 
+@deconstructible(path='django.db.models.OuterRef')
 class OuterRef(F):
     contains_aggregate = False
 
@@ -651,6 +652,7 @@ class OuterRef(F):
         return self
 
 
+@deconstructible(path='django.db.models.Func')
 class Func(SQLiteNumericMixin, Expression):
     """An SQL function call."""
     function = None
@@ -731,6 +733,7 @@ class Func(SQLiteNumericMixin, Expression):
         return copy
 
 
+@deconstructible(path='django.db.models.Value')
 class Value(SQLiteNumericMixin, Expression):
     """Represent a wrapped value as a node within an expression."""
     # Provide a default value for `for_save` in order to allow unresolved
@@ -912,6 +915,7 @@ class Ref(Expression):
         return [self]
 
 
+@deconstructible(path='django.db.models.ExpressionList')
 class ExpressionList(Func):
     """
     An expression containing multiple expressions. Can be used to provide a
@@ -953,6 +957,7 @@ class OrderByList(Func):
         return super().as_sql(*args, **kwargs)
 
 
+@deconstructible(path='django.db.models.ExpressionWrapper')
 class ExpressionWrapper(SQLiteNumericMixin, Expression):
     """
     An expression that can wrap another expression so that it can provide
@@ -985,6 +990,7 @@ class ExpressionWrapper(SQLiteNumericMixin, Expression):
         return "{}({})".format(self.__class__.__name__, self.expression)
 
 
+@deconstructible(path='django.db.models.When')
 class When(Expression):
     template = 'WHEN %(condition)s THEN %(result)s'
     # This isn't a complete conditional expression, must be used in Case().
@@ -1052,6 +1058,7 @@ class When(Expression):
         return cols
 
 
+@deconstructible(path='django.db.models.Case')
 class Case(SQLiteNumericMixin, Expression):
     """
     An SQL searched CASE expression:
@@ -1133,6 +1140,7 @@ class Case(SQLiteNumericMixin, Expression):
         return super().get_group_by_cols(alias)
 
 
+@deconstructible(path='django.db.models.Subquery')
 class Subquery(BaseExpression, Combinable):
     """
     An explicit subquery. It may contain OuterRef() references to the outer
@@ -1190,6 +1198,7 @@ class Subquery(BaseExpression, Combinable):
         return self.query.get_group_by_cols()
 
 
+@deconstructible(path='django.db.models.Exists')
 class Exists(Subquery):
     template = 'EXISTS(%(subquery)s)'
     output_field = fields.BooleanField()
@@ -1225,6 +1234,7 @@ class Exists(Subquery):
         return sql, params
 
 
+@deconstructible(path='django.db.models.OrderBy')
 class OrderBy(Expression):
     template = '%(expression)s %(ordering)s'
     conditional = False
@@ -1307,6 +1317,7 @@ class OrderBy(Expression):
         self.descending = True
 
 
+@deconstructible(path='django.db.models.Window')
 class Window(SQLiteNumericMixin, Expression):
     template = '%(expression)s OVER (%(window)s)'
     # Although the main expression may either be an aggregate or an
@@ -1412,6 +1423,7 @@ class Window(SQLiteNumericMixin, Expression):
         return []
 
 
+@deconstructible(path='django.db.models.WindowFrame')
 class WindowFrame(Expression):
     """
     Model the frame clause in window expressions. There are two types of frame
@@ -1471,6 +1483,7 @@ class WindowFrame(Expression):
         raise NotImplementedError('Subclasses must implement window_frame_start_end().')
 
 
+@deconstructible(path='django.db.models.RowRange')
 class RowRange(WindowFrame):
     frame_type = 'ROWS'
 
@@ -1478,6 +1491,7 @@ class RowRange(WindowFrame):
         return connection.ops.window_frame_rows_start_end(start, end)
 
 
+@deconstructible(path='django.db.models.ValueRange')
 class ValueRange(WindowFrame):
     frame_type = 'RANGE'
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/migrations/test_autodetector.py`.
Extra Requirements: 
Purpose: I need the content of this file to identify relevant test cases that demonstrate the deconstruction of expression classes in the context of migrations.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/migrations/test_autodetector.py
Line number range: 1 - 2964
Content:
1. import functools
2. import re
3. from unittest import mock
4. 
5. from django.apps import apps
6. from django.conf import settings
7. from django.contrib.auth.models import AbstractBaseUser
8. from django.core.validators import RegexValidator, validate_slug
9. from django.db import connection, migrations, models
10. from django.db.migrations.autodetector import MigrationAutodetector
11. from django.db.migrations.graph import MigrationGraph
12. from django.db.migrations.loader import MigrationLoader
13. from django.db.migrations.questioner import MigrationQuestioner
14. from django.db.migrations.state import ModelState, ProjectState
15. from django.test import SimpleTestCase, TestCase, override_settings
16. from django.test.utils import isolate_lru_cache
17. 
18. from .models import FoodManager, FoodQuerySet
19. 
20. 
21. class DeconstructibleObject:
22.     """
23.     A custom deconstructible object.
24.     """
25. 
26.     def __init__(self, *args, **kwargs):
27.         self.args = args
28.         self.kwargs = kwargs
29. 
30.     def deconstruct(self):
31.         return (
32.             self.__module__ + '.' + self.__class__.__name__,
33.             self.args,
34.             self.kwargs
35.         )
36. 
37. 
38. class AutodetectorTests(TestCase):
39.     """
40.     Tests the migration autodetector.
41.     """
42. 
43.     author_empty = ModelState("testapp", "Author", [("id", models.AutoField(primary_key=True))])
44.     author_name = ModelState("testapp", "Author", [
45.         ("id", models.AutoField(primary_key=True)),
46.         ("name", models.CharField(max_length=200)),
47.     ])
48.     author_name_null = ModelState("testapp", "Author", [
49.         ("id", models.AutoField(primary_key=True)),
50.         ("name", models.CharField(max_length=200, null=True)),
51.     ])
52.     author_name_longer = ModelState("testapp", "Author", [
53.         ("id", models.AutoField(primary_key=True)),
54.         ("name", models.CharField(max_length=400)),
55.     ])
56.     author_name_renamed = ModelState("testapp", "Author", [
57.         ("id", models.AutoField(primary_key=True)),
58.         ("names", models.CharField(max_length=200)),
59.     ])
60.     author_name_default = ModelState("testapp", "Author", [
61.         ("id", models.AutoField(primary_key=True)),
62.         ("name", models.CharField(max_length=200, default='Ada Lovelace')),
63.     ])
64.     author_name_check_constraint = ModelState("testapp", "Author", [
65.         ("id", models.AutoField(primary_key=True)),
66.         ("name", models.CharField(max_length=200)),
67.     ],
68.         {'constraints': [models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')]},
69.     )
70.     author_dates_of_birth_auto_now = ModelState("testapp", "Author", [
71.         ("id", models.AutoField(primary_key=True)),
72.         ("date_of_birth", models.DateField(auto_now=True)),
73.         ("date_time_of_birth", models.DateTimeField(auto_now=True)),
74.         ("time_of_birth", models.TimeField(auto_now=True)),
75.     ])
76.     author_dates_of_birth_auto_now_add = ModelState("testapp", "Author", [
77.         ("id", models.AutoField(primary_key=True)),
78.         ("date_of_birth", models.DateField(auto_now_add=True)),
79.         ("date_time_of_birth", models.DateTimeField(auto_now_add=True)),
80.         ("time_of_birth", models.TimeField(auto_now_add=True)),
81.     ])
82.     author_name_deconstructible_1 = ModelState("testapp", "Author", [
83.         ("id", models.AutoField(primary_key=True)),
84.         ("name", models.CharField(max_length=200, default=DeconstructibleObject())),
85.     ])
86.     author_name_deconstructible_2 = ModelState("testapp", "Author", [
87.         ("id", models.AutoField(primary_key=True)),
88.         ("name", models.CharField(max_length=200, default=DeconstructibleObject())),
89.     ])
90.     author_name_deconstructible_3 = ModelState("testapp", "Author", [
91.         ("id", models.AutoField(primary_key=True)),
92.         ("name", models.CharField(max_length=200, default=models.IntegerField())),
93.     ])
94.     author_name_deconstructible_4 = ModelState("testapp", "Author", [
95.         ("id", models.AutoField(primary_key=True)),
96.         ("name", models.CharField(max_length=200, default=models.IntegerField())),
97.     ])
98.     author_name_deconstructible_list_1 = ModelState("testapp", "Author", [
99.         ("id", models.AutoField(primary_key=True)),
100.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 123])),
101.     ])
102.     author_name_deconstructible_list_2 = ModelState("testapp", "Author", [
103.         ("id", models.AutoField(primary_key=True)),
104.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 123])),
105.     ])
106.     author_name_deconstructible_list_3 = ModelState("testapp", "Author", [
107.         ("id", models.AutoField(primary_key=True)),
108.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 999])),
109.     ])
110.     author_name_deconstructible_tuple_1 = ModelState("testapp", "Author", [
111.         ("id", models.AutoField(primary_key=True)),
112.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 123))),
113.     ])
114.     author_name_deconstructible_tuple_2 = ModelState("testapp", "Author", [
115.         ("id", models.AutoField(primary_key=True)),
116.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 123))),
117.     ])
118.     author_name_deconstructible_tuple_3 = ModelState("testapp", "Author", [
119.         ("id", models.AutoField(primary_key=True)),
120.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 999))),
121.     ])
122.     author_name_deconstructible_dict_1 = ModelState("testapp", "Author", [
123.         ("id", models.AutoField(primary_key=True)),
124.         ("name", models.CharField(max_length=200, default={
125.             'item': DeconstructibleObject(), 'otheritem': 123
126.         })),
127.     ])
128.     author_name_deconstructible_dict_2 = ModelState("testapp", "Author", [
129.         ("id", models.AutoField(primary_key=True)),
130.         ("name", models.CharField(max_length=200, default={
131.             'item': DeconstructibleObject(), 'otheritem': 123
132.         })),
133.     ])
134.     author_name_deconstructible_dict_3 = ModelState("testapp", "Author", [
135.         ("id", models.AutoField(primary_key=True)),
136.         ("name", models.CharField(max_length=200, default={
137.             'item': DeconstructibleObject(), 'otheritem': 999
138.         })),
139.     ])
140.     author_name_nested_deconstructible_1 = ModelState("testapp", "Author", [
141.         ("id", models.AutoField(primary_key=True)),
142.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
143.             DeconstructibleObject(1),
144.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
145.             a=DeconstructibleObject('A'),
146.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
147.         ))),
148.     ])
149.     author_name_nested_deconstructible_2 = ModelState("testapp", "Author", [
150.         ("id", models.AutoField(primary_key=True)),
151.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
152.             DeconstructibleObject(1),
153.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
154.             a=DeconstructibleObject('A'),
155.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
156.         ))),
157.     ])
158.     author_name_nested_deconstructible_changed_arg = ModelState("testapp", "Author", [
159.         ("id", models.AutoField(primary_key=True)),
160.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
161.             DeconstructibleObject(1),
162.             (DeconstructibleObject('t1'), DeconstructibleObject('t2-changed'),),
163.             a=DeconstructibleObject('A'),
164.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
165.         ))),
166.     ])
167.     author_name_nested_deconstructible_extra_arg = ModelState("testapp", "Author", [
168.         ("id", models.AutoField(primary_key=True)),
169.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
170.             DeconstructibleObject(1),
171.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
172.             None,
173.             a=DeconstructibleObject('A'),
174.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
175.         ))),
176.     ])
177.     author_name_nested_deconstructible_changed_kwarg = ModelState("testapp", "Author", [
178.         ("id", models.AutoField(primary_key=True)),
179.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
180.             DeconstructibleObject(1),
181.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
182.             a=DeconstructibleObject('A'),
183.             b=DeconstructibleObject(B=DeconstructibleObject('c-changed')),
184.         ))),
185.     ])
186.     author_name_nested_deconstructible_extra_kwarg = ModelState("testapp", "Author", [
187.         ("id", models.AutoField(primary_key=True)),
188.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
189.             DeconstructibleObject(1),
190.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
191.             a=DeconstructibleObject('A'),
192.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
193.             c=None,
194.         ))),
195.     ])
196.     author_custom_pk = ModelState("testapp", "Author", [("pk_field", models.IntegerField(primary_key=True))])
197.     author_with_biography_non_blank = ModelState("testapp", "Author", [
198.         ("id", models.AutoField(primary_key=True)),
199.         ("name", models.CharField()),
200.         ("biography", models.TextField()),
201.     ])
202.     author_with_biography_blank = ModelState("testapp", "Author", [
203.         ("id", models.AutoField(primary_key=True)),
204.         ("name", models.CharField(blank=True)),
205.         ("biography", models.TextField(blank=True)),
206.     ])
207.     author_with_book = ModelState("testapp", "Author", [
208.         ("id", models.AutoField(primary_key=True)),
209.         ("name", models.CharField(max_length=200)),
210.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
211.     ])
212.     author_with_book_order_wrt = ModelState("testapp", "Author", [
213.         ("id", models.AutoField(primary_key=True)),
214.         ("name", models.CharField(max_length=200)),
215.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
216.     ], options={"order_with_respect_to": "book"})
217.     author_renamed_with_book = ModelState("testapp", "Writer", [
218.         ("id", models.AutoField(primary_key=True)),
219.         ("name", models.CharField(max_length=200)),
220.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
221.     ])
222.     author_with_publisher_string = ModelState("testapp", "Author", [
223.         ("id", models.AutoField(primary_key=True)),
224.         ("name", models.CharField(max_length=200)),
225.         ("publisher_name", models.CharField(max_length=200)),
226.     ])
227.     author_with_publisher = ModelState("testapp", "Author", [
228.         ("id", models.AutoField(primary_key=True)),
229.         ("name", models.CharField(max_length=200)),
230.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
231.     ])
232.     author_with_user = ModelState("testapp", "Author", [
233.         ("id", models.AutoField(primary_key=True)),
234.         ("name", models.CharField(max_length=200)),
235.         ("user", models.ForeignKey("auth.User", models.CASCADE)),
236.     ])
237.     author_with_custom_user = ModelState("testapp", "Author", [
238.         ("id", models.AutoField(primary_key=True)),
239.         ("name", models.CharField(max_length=200)),
240.         ("user", models.ForeignKey("thirdapp.CustomUser", models.CASCADE)),
241.     ])
242.     author_proxy = ModelState("testapp", "AuthorProxy", [], {"proxy": True}, ("testapp.author",))
243.     author_proxy_options = ModelState("testapp", "AuthorProxy", [], {
244.         "proxy": True,
245.         "verbose_name": "Super Author",
246.     }, ("testapp.author",))
247.     author_proxy_notproxy = ModelState("testapp", "AuthorProxy", [], {}, ("testapp.author",))
248.     author_proxy_third = ModelState("thirdapp", "AuthorProxy", [], {"proxy": True}, ("testapp.author",))
249.     author_proxy_third_notproxy = ModelState("thirdapp", "AuthorProxy", [], {}, ("testapp.author",))
250.     author_proxy_proxy = ModelState("testapp", "AAuthorProxyProxy", [], {"proxy": True}, ("testapp.authorproxy",))
251.     author_unmanaged = ModelState("testapp", "AuthorUnmanaged", [], {"managed": False}, ("testapp.author",))
252.     author_unmanaged_managed = ModelState("testapp", "AuthorUnmanaged", [], {}, ("testapp.author",))
253.     author_unmanaged_default_pk = ModelState("testapp", "Author", [("id", models.AutoField(primary_key=True))])
254.     author_unmanaged_custom_pk = ModelState("testapp", "Author", [
255.         ("pk_field", models.IntegerField(primary_key=True)),
256.     ])
257.     author_with_m2m = ModelState("testapp", "Author", [
258.         ("id", models.AutoField(primary_key=True)),
259.         ("publishers", models.ManyToManyField("testapp.Publisher")),
260.     ])
261.     author_with_m2m_blank = ModelState("testapp", "Author", [
262.         ("id", models.AutoField(primary_key=True)),
263.         ("publishers", models.ManyToManyField("testapp.Publisher", blank=True)),
264.     ])
265.     author_with_m2m_through = ModelState("testapp", "Author", [
266.         ("id", models.AutoField(primary_key=True)),
267.         ("publishers", models.ManyToManyField("testapp.Publisher", through="testapp.Contract")),
268.     ])
269.     author_with_renamed_m2m_through = ModelState("testapp", "Author", [
270.         ("id", models.AutoField(primary_key=True)),
271.         ("publishers", models.ManyToManyField("testapp.Publisher", through="testapp.Deal")),
272.     ])
273.     author_with_former_m2m = ModelState("testapp", "Author", [
274.         ("id", models.AutoField(primary_key=True)),
275.         ("publishers", models.CharField(max_length=100)),
276.     ])
277.     author_with_options = ModelState("testapp", "Author", [
278.         ("id", models.AutoField(primary_key=True)),
279.     ], {
280.         "permissions": [('can_hire', 'Can hire')],
281.         "verbose_name": "Authi",
282.     })
283.     author_with_db_table_options = ModelState("testapp", "Author", [
284.         ("id", models.AutoField(primary_key=True)),
285.     ], {"db_table": "author_one"})
286.     author_with_new_db_table_options = ModelState("testapp", "Author", [
287.         ("id", models.AutoField(primary_key=True)),
288.     ], {"db_table": "author_two"})
289.     author_renamed_with_db_table_options = ModelState("testapp", "NewAuthor", [
290.         ("id", models.AutoField(primary_key=True)),
291.     ], {"db_table": "author_one"})
292.     author_renamed_with_new_db_table_options = ModelState("testapp", "NewAuthor", [
293.         ("id", models.AutoField(primary_key=True)),
294.     ], {"db_table": "author_three"})
295.     contract = ModelState("testapp", "Contract", [
296.         ("id", models.AutoField(primary_key=True)),
297.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
298.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
299.     ])
300.     contract_renamed = ModelState("testapp", "Deal", [
301.         ("id", models.AutoField(primary_key=True)),
302.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
303.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
304.     ])
305.     publisher = ModelState("testapp", "Publisher", [
306.         ("id", models.AutoField(primary_key=True)),
307.         ("name", models.CharField(max_length=100)),
308.     ])
309.     publisher_with_author = ModelState("testapp", "Publisher", [
310.         ("id", models.AutoField(primary_key=True)),
311.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
312.         ("name", models.CharField(max_length=100)),
313.     ])
314.     publisher_with_aardvark_author = ModelState("testapp", "Publisher", [
315.         ("id", models.AutoField(primary_key=True)),
316.         ("author", models.ForeignKey("testapp.Aardvark", models.CASCADE)),
317.         ("name", models.CharField(max_length=100)),
318.     ])
319.     publisher_with_book = ModelState("testapp", "Publisher", [
320.         ("id", models.AutoField(primary_key=True)),
321.         ("author", models.ForeignKey("otherapp.Book", models.CASCADE)),
322.         ("name", models.CharField(max_length=100)),
323.     ])
324.     other_pony = ModelState("otherapp", "Pony", [
325.         ("id", models.AutoField(primary_key=True)),
326.     ])
327.     other_pony_food = ModelState("otherapp", "Pony", [
328.         ("id", models.AutoField(primary_key=True)),
329.     ], managers=[
330.         ('food_qs', FoodQuerySet.as_manager()),
331.         ('food_mgr', FoodManager('a', 'b')),
332.         ('food_mgr_kwargs', FoodManager('x', 'y', 3, 4)),
333.     ])
334.     other_stable = ModelState("otherapp", "Stable", [("id", models.AutoField(primary_key=True))])
335.     third_thing = ModelState("thirdapp", "Thing", [("id", models.AutoField(primary_key=True))])
336.     book = ModelState("otherapp", "Book", [
337.         ("id", models.AutoField(primary_key=True)),
338.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
339.         ("title", models.CharField(max_length=200)),
340.     ])
341.     book_proxy_fk = ModelState("otherapp", "Book", [
342.         ("id", models.AutoField(primary_key=True)),
343.         ("author", models.ForeignKey("thirdapp.AuthorProxy", models.CASCADE)),
344.         ("title", models.CharField(max_length=200)),
345.     ])
346.     book_proxy_proxy_fk = ModelState("otherapp", "Book", [
347.         ("id", models.AutoField(primary_key=True)),
348.         ("author", models.ForeignKey("testapp.AAuthorProxyProxy", models.CASCADE)),
349.     ])
350.     book_migrations_fk = ModelState("otherapp", "Book", [
351.         ("id", models.AutoField(primary_key=True)),
352.         ("author", models.ForeignKey("migrations.UnmigratedModel", models.CASCADE)),
353.         ("title", models.CharField(max_length=200)),
354.     ])
355.     book_with_no_author_fk = ModelState("otherapp", "Book", [
356.         ("id", models.AutoField(primary_key=True)),
357.         ("author", models.IntegerField()),
358.         ("title", models.CharField(max_length=200)),
359.     ])
360.     book_with_no_author = ModelState("otherapp", "Book", [
361.         ("id", models.AutoField(primary_key=True)),
362.         ("title", models.CharField(max_length=200)),
363.     ])
364.     book_with_author_renamed = ModelState("otherapp", "Book", [
365.         ("id", models.AutoField(primary_key=True)),
366.         ("author", models.ForeignKey("testapp.Writer", models.CASCADE)),
367.         ("title", models.CharField(max_length=200)),
368.     ])
369.     book_with_field_and_author_renamed = ModelState("otherapp", "Book", [
370.         ("id", models.AutoField(primary_key=True)),
371.         ("writer", models.ForeignKey("testapp.Writer", models.CASCADE)),
372.         ("title", models.CharField(max_length=200)),
373.     ])
374.     book_with_multiple_authors = ModelState("otherapp", "Book", [
375.         ("id", models.AutoField(primary_key=True)),
376.         ("authors", models.ManyToManyField("testapp.Author")),
377.         ("title", models.CharField(max_length=200)),
378.     ])
379.     book_with_multiple_authors_through_attribution = ModelState("otherapp", "Book", [
380.         ("id", models.AutoField(primary_key=True)),
381.         ("authors", models.ManyToManyField("testapp.Author", through="otherapp.Attribution")),
382.         ("title", models.CharField(max_length=200)),
383.     ])
384.     book_indexes = ModelState("otherapp", "Book", [
385.         ("id", models.AutoField(primary_key=True)),
386.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
387.         ("title", models.CharField(max_length=200)),
388.     ], {
389.         "indexes": [models.Index(fields=["author", "title"], name="book_title_author_idx")],
390.     })
391.     book_unordered_indexes = ModelState("otherapp", "Book", [
392.         ("id", models.AutoField(primary_key=True)),
393.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
394.         ("title", models.CharField(max_length=200)),
395.     ], {
396.         "indexes": [models.Index(fields=["title", "author"], name="book_author_title_idx")],
397.     })
398.     book_foo_together = ModelState("otherapp", "Book", [
399.         ("id", models.AutoField(primary_key=True)),
400.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
401.         ("title", models.CharField(max_length=200)),
402.     ], {
403.         "index_together": {("author", "title")},
404.         "unique_together": {("author", "title")},
405.     })
406.     book_foo_together_2 = ModelState("otherapp", "Book", [
407.         ("id", models.AutoField(primary_key=True)),
408.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
409.         ("title", models.CharField(max_length=200)),
410.     ], {
411.         "index_together": {("title", "author")},
412.         "unique_together": {("title", "author")},
413.     })
414.     book_foo_together_3 = ModelState("otherapp", "Book", [
415.         ("id", models.AutoField(primary_key=True)),
416.         ("newfield", models.IntegerField()),
417.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
418.         ("title", models.CharField(max_length=200)),
419.     ], {
420.         "index_together": {("title", "newfield")},
421.         "unique_together": {("title", "newfield")},
422.     })
423.     book_foo_together_4 = ModelState("otherapp", "Book", [
424.         ("id", models.AutoField(primary_key=True)),
425.         ("newfield2", models.IntegerField()),
426.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
427.         ("title", models.CharField(max_length=200)),
428.     ], {
429.         "index_together": {("title", "newfield2")},
430.         "unique_together": {("title", "newfield2")},
431.     })
432.     attribution = ModelState("otherapp", "Attribution", [
433.         ("id", models.AutoField(primary_key=True)),
434.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
435.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
436.     ])
437.     edition = ModelState("thirdapp", "Edition", [
438.         ("id", models.AutoField(primary_key=True)),
439.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
440.     ])
441.     custom_user = ModelState("thirdapp", "CustomUser", [
442.         ("id", models.AutoField(primary_key=True)),
443.         ("username", models.CharField(max_length=255)),
444.     ], bases=(AbstractBaseUser,))
445.     custom_user_no_inherit = ModelState("thirdapp", "CustomUser", [
446.         ("id", models.AutoField(primary_key=True)),
447.         ("username", models.CharField(max_length=255)),
448.     ])
449.     aardvark = ModelState("thirdapp", "Aardvark", [("id", models.AutoField(primary_key=True))])
450.     aardvark_testapp = ModelState("testapp", "Aardvark", [("id", models.AutoField(primary_key=True))])
451.     aardvark_based_on_author = ModelState("testapp", "Aardvark", [], bases=("testapp.Author",))
452.     aardvark_pk_fk_author = ModelState("testapp", "Aardvark", [
453.         ("id", models.OneToOneField("testapp.Author", models.CASCADE, primary_key=True)),
454.     ])
455.     knight = ModelState("eggs", "Knight", [("id", models.AutoField(primary_key=True))])
456.     rabbit = ModelState("eggs", "Rabbit", [
457.         ("id", models.AutoField(primary_key=True)),
458.         ("knight", models.ForeignKey("eggs.Knight", models.CASCADE)),
459.         ("parent", models.ForeignKey("eggs.Rabbit", models.CASCADE)),
460.     ], {
461.         "unique_together": {("parent", "knight")},
462.         "indexes": [models.Index(fields=["parent", "knight"], name='rabbit_circular_fk_index')],
463.     })
464. 
465.     def repr_changes(self, changes, include_dependencies=False):
466.         output = ""
467.         for app_label, migrations_ in sorted(changes.items()):
468.             output += "  %s:\n" % app_label
469.             for migration in migrations_:
470.                 output += "    %s\n" % migration.name
471.                 for operation in migration.operations:
472.                     output += "      %s\n" % operation
473.                 if include_dependencies:
474.                     output += "      Dependencies:\n"
475.                     if migration.dependencies:
476.                         for dep in migration.dependencies:
477.                             output += "        %s\n" % (dep,)
478.                     else:
479.                         output += "        None\n"
480.         return output
481. 
482.     def assertNumberMigrations(self, changes, app_label, number):
483.         if len(changes.get(app_label, [])) != number:
484.             self.fail("Incorrect number of migrations (%s) for %s (expected %s)\n%s" % (
485.                 len(changes.get(app_label, [])),
486.                 app_label,
487.                 number,
488.                 self.repr_changes(changes),
489.             ))
490. 
491.     def assertMigrationDependencies(self, changes, app_label, position, dependencies):
492.         if not changes.get(app_label):
493.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
494.         if len(changes[app_label]) < position + 1:
495.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
496.         migration = changes[app_label][position]
497.         if set(migration.dependencies) != set(dependencies):
498.             self.fail("Migration dependencies mismatch for %s.%s (expected %s):\n%s" % (
499.                 app_label,
500.                 migration.name,
501.                 dependencies,
502.                 self.repr_changes(changes, include_dependencies=True),
503.             ))
504. 
505.     def assertOperationTypes(self, changes, app_label, position, types):
506.         if not changes.get(app_label):
507.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
508.         if len(changes[app_label]) < position + 1:
509.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
510.         migration = changes[app_label][position]
511.         real_types = [operation.__class__.__name__ for operation in migration.operations]
512.         if types != real_types:
513.             self.fail("Operation type mismatch for %s.%s (expected %s):\n%s" % (
514.                 app_label,
515.                 migration.name,
516.                 types,
517.                 self.repr_changes(changes),
518.             ))
519. 
520.     def assertOperationAttributes(self, changes, app_label, position, operation_position, **attrs):
521.         if not changes.get(app_label):
522.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
523.         if len(changes[app_label]) < position + 1:
524.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
525.         migration = changes[app_label][position]
526.         if len(changes[app_label]) < position + 1:
527.             self.fail("No operation at index %s for %s.%s\n%s" % (
528.                 operation_position,
529.                 app_label,
530.                 migration.name,
531.                 self.repr_changes(changes),
532.             ))
533.         operation = migration.operations[operation_position]
534.         for attr, value in attrs.items():
535.             if getattr(operation, attr, None) != value:
536.                 self.fail("Attribute mismatch for %s.%s op #%s, %s (expected %r, got %r):\n%s" % (
537.                     app_label,
538.                     migration.name,
539.                     operation_position,
540.                     attr,
541.                     value,
542.                     getattr(operation, attr, None),
543.                     self.repr_changes(changes),
544.                 ))
545. 
546.     def assertOperationFieldAttributes(self, changes, app_label, position, operation_position, **attrs):
547.         if not changes.get(app_label):
548.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
549.         if len(changes[app_label]) < position + 1:
550.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
551.         migration = changes[app_label][position]
552.         if len(changes[app_label]) < position + 1:
553.             self.fail("No operation at index %s for %s.%s\n%s" % (
554.                 operation_position,
555.                 app_label,
556.                 migration.name,
557.                 self.repr_changes(changes),
558.             ))
559.         operation = migration.operations[operation_position]
560.         if not hasattr(operation, 'field'):
561.             self.fail("No field attribute for %s.%s op #%s." % (
562.                 app_label,
563.                 migration.name,
564.                 operation_position,
565.             ))
566.         field = operation.field
567.         for attr, value in attrs.items():
568.             if getattr(field, attr, None) != value:
569.                 self.fail("Field attribute mismatch for %s.%s op #%s, field.%s (expected %r, got %r):\n%s" % (
570.                     app_label,
571.                     migration.name,
572.                     operation_position,
573.                     attr,
574.                     value,
575.                     getattr(field, attr, None),
576.                     self.repr_changes(changes),
577.                 ))
578. 
579.     def make_project_state(self, model_states):
580.         "Shortcut to make ProjectStates from lists of predefined models"
581.         project_state = ProjectState()
582.         for model_state in model_states:
583.             project_state.add_model(model_state.clone())
584.         return project_state
585. 
586.     def get_changes(self, before_states, after_states, questioner=None):
587.         if not isinstance(before_states, ProjectState):
588.             before_states = self.make_project_state(before_states)
589.         if not isinstance(after_states, ProjectState):
590.             after_states = self.make_project_state(after_states)
591.         return MigrationAutodetector(
592.             before_states,
593.             after_states,
594.             questioner,
595.         )._detect_changes()
596. 
597.     def test_arrange_for_graph(self):
598.         """Tests auto-naming of migrations for graph matching."""
599.         # Make a fake graph
600.         graph = MigrationGraph()
601.         graph.add_node(("testapp", "0001_initial"), None)
602.         graph.add_node(("testapp", "0002_foobar"), None)
603.         graph.add_node(("otherapp", "0001_initial"), None)
604.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("testapp", "0001_initial"))
605.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("otherapp", "0001_initial"))
606.         # Use project state to make a new migration change set
607.         before = self.make_project_state([self.publisher, self.other_pony])
608.         after = self.make_project_state([
609.             self.author_empty, self.publisher, self.other_pony, self.other_stable,
610.         ])
611.         autodetector = MigrationAutodetector(before, after)
612.         changes = autodetector._detect_changes()
613.         # Run through arrange_for_graph
614.         changes = autodetector.arrange_for_graph(changes, graph)
615.         # Make sure there's a new name, deps match, etc.
616.         self.assertEqual(changes["testapp"][0].name, "0003_author")
617.         self.assertEqual(changes["testapp"][0].dependencies, [("testapp", "0002_foobar")])
618.         self.assertEqual(changes["otherapp"][0].name, '0002_stable')
619.         self.assertEqual(changes["otherapp"][0].dependencies, [("otherapp", "0001_initial")])
620. 
621.     def test_arrange_for_graph_with_multiple_initial(self):
622.         # Make a fake graph.
623.         graph = MigrationGraph()
624.         # Use project state to make a new migration change set.
625.         before = self.make_project_state([])
626.         after = self.make_project_state([self.author_with_book, self.book, self.attribution])
627.         autodetector = MigrationAutodetector(before, after, MigrationQuestioner({'ask_initial': True}))
628.         changes = autodetector._detect_changes()
629.         changes = autodetector.arrange_for_graph(changes, graph)
630. 
631.         self.assertEqual(changes['otherapp'][0].name, '0001_initial')
632.         self.assertEqual(changes['otherapp'][0].dependencies, [])
633.         self.assertEqual(changes['otherapp'][1].name, '0002_initial')
634.         self.assertCountEqual(
635.             changes['otherapp'][1].dependencies,
636.             [('testapp', '0001_initial'), ('otherapp', '0001_initial')],
637.         )
638.         self.assertEqual(changes['testapp'][0].name, '0001_initial')
639.         self.assertEqual(changes['testapp'][0].dependencies, [('otherapp', '0001_initial')])
640. 
641.     def test_trim_apps(self):
642.         """
643.         Trim does not remove dependencies but does remove unwanted apps.
644.         """
645.         # Use project state to make a new migration change set
646.         before = self.make_project_state([])
647.         after = self.make_project_state([self.author_empty, self.other_pony, self.other_stable, self.third_thing])
648.         autodetector = MigrationAutodetector(before, after, MigrationQuestioner({"ask_initial": True}))
649.         changes = autodetector._detect_changes()
650.         # Run through arrange_for_graph
651.         graph = MigrationGraph()
652.         changes = autodetector.arrange_for_graph(changes, graph)
653.         changes["testapp"][0].dependencies.append(("otherapp", "0001_initial"))
654.         changes = autodetector._trim_to_apps(changes, {"testapp"})
655.         # Make sure there's the right set of migrations
656.         self.assertEqual(changes["testapp"][0].name, "0001_initial")
657.         self.assertEqual(changes["otherapp"][0].name, "0001_initial")
658.         self.assertNotIn("thirdapp", changes)
659. 
660.     def test_custom_migration_name(self):
661.         """Tests custom naming of migrations for graph matching."""
662.         # Make a fake graph
663.         graph = MigrationGraph()
664.         graph.add_node(("testapp", "0001_initial"), None)
665.         graph.add_node(("testapp", "0002_foobar"), None)
666.         graph.add_node(("otherapp", "0001_initial"), None)
667.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("testapp", "0001_initial"))
668. 
669.         # Use project state to make a new migration change set
670.         before = self.make_project_state([])
671.         after = self.make_project_state([self.author_empty, self.other_pony, self.other_stable])
672.         autodetector = MigrationAutodetector(before, after)
673.         changes = autodetector._detect_changes()
674. 
675.         # Run through arrange_for_graph
676.         migration_name = 'custom_name'
677.         changes = autodetector.arrange_for_graph(changes, graph, migration_name)
678. 
679.         # Make sure there's a new name, deps match, etc.
680.         self.assertEqual(changes["testapp"][0].name, "0003_%s" % migration_name)
681.         self.assertEqual(changes["testapp"][0].dependencies, [("testapp", "0002_foobar")])
682.         self.assertEqual(changes["otherapp"][0].name, "0002_%s" % migration_name)
683.         self.assertEqual(changes["otherapp"][0].dependencies, [("otherapp", "0001_initial")])
684. 
685.     def test_new_model(self):
686.         """Tests autodetection of new models."""
687.         changes = self.get_changes([], [self.other_pony_food])
688.         # Right number/type of migrations?
689.         self.assertNumberMigrations(changes, 'otherapp', 1)
690.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
691.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="Pony")
692.         self.assertEqual([name for name, mgr in changes['otherapp'][0].operations[0].managers],
693.                          ['food_qs', 'food_mgr', 'food_mgr_kwargs'])
694. 
695.     def test_old_model(self):
696.         """Tests deletion of old models."""
697.         changes = self.get_changes([self.author_empty], [])
698.         # Right number/type of migrations?
699.         self.assertNumberMigrations(changes, 'testapp', 1)
700.         self.assertOperationTypes(changes, 'testapp', 0, ["DeleteModel"])
701.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Author")
702. 
703.     def test_add_field(self):
704.         """Tests autodetection of new fields."""
705.         changes = self.get_changes([self.author_empty], [self.author_name])
706.         # Right number/type of migrations?
707.         self.assertNumberMigrations(changes, 'testapp', 1)
708.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
709.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name")
710. 
711.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
712.                 side_effect=AssertionError("Should not have prompted for not null addition"))
713.     def test_add_date_fields_with_auto_now_not_asking_for_default(self, mocked_ask_method):
714.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now])
715.         # Right number/type of migrations?
716.         self.assertNumberMigrations(changes, 'testapp', 1)
717.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
718.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now=True)
719.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now=True)
720.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now=True)
721. 
722.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
723.                 side_effect=AssertionError("Should not have prompted for not null addition"))
724.     def test_add_date_fields_with_auto_now_add_not_asking_for_null_addition(self, mocked_ask_method):
725.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now_add])
726.         # Right number/type of migrations?
727.         self.assertNumberMigrations(changes, 'testapp', 1)
728.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
729.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now_add=True)
730.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now_add=True)
731.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now_add=True)
732. 
733.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_auto_now_add_addition')
734.     def test_add_date_fields_with_auto_now_add_asking_for_default(self, mocked_ask_method):
735.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now_add])
736.         # Right number/type of migrations?
737.         self.assertNumberMigrations(changes, 'testapp', 1)
738.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
739.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now_add=True)
740.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now_add=True)
741.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now_add=True)
742.         self.assertEqual(mocked_ask_method.call_count, 3)
743. 
744.     def test_remove_field(self):
745.         """Tests autodetection of removed fields."""
746.         changes = self.get_changes([self.author_name], [self.author_empty])
747.         # Right number/type of migrations?
748.         self.assertNumberMigrations(changes, 'testapp', 1)
749.         self.assertOperationTypes(changes, 'testapp', 0, ["RemoveField"])
750.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name")
751. 
752.     def test_alter_field(self):
753.         """Tests autodetection of new fields."""
754.         changes = self.get_changes([self.author_name], [self.author_name_longer])
755.         # Right number/type of migrations?
756.         self.assertNumberMigrations(changes, 'testapp', 1)
757.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
758.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
759. 
760.     def test_supports_functools_partial(self):
761.         def _content_file_name(instance, filename, key, **kwargs):
762.             return '{}/{}'.format(instance, filename)
763. 
764.         def content_file_name(key, **kwargs):
765.             return functools.partial(_content_file_name, key, **kwargs)
766. 
767.         # An unchanged partial reference.
768.         before = [ModelState("testapp", "Author", [
769.             ("id", models.AutoField(primary_key=True)),
770.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file'))),
771.         ])]
772.         after = [ModelState("testapp", "Author", [
773.             ("id", models.AutoField(primary_key=True)),
774.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file'))),
775.         ])]
776.         changes = self.get_changes(before, after)
777.         self.assertNumberMigrations(changes, 'testapp', 0)
778. 
779.         # A changed partial reference.
780.         args_changed = [ModelState("testapp", "Author", [
781.             ("id", models.AutoField(primary_key=True)),
782.             ("file", models.FileField(max_length=200, upload_to=content_file_name('other-file'))),
783.         ])]
784.         changes = self.get_changes(before, args_changed)
785.         self.assertNumberMigrations(changes, 'testapp', 1)
786.         self.assertOperationTypes(changes, 'testapp', 0, ['AlterField'])
787.         # Can't use assertOperationFieldAttributes because we need the
788.         # deconstructed version, i.e., the exploded func/args/keywords rather
789.         # than the partial: we don't care if it's not the same instance of the
790.         # partial, only if it's the same source function, args, and keywords.
791.         value = changes['testapp'][0].operations[0].field.upload_to
792.         self.assertEqual(
793.             (_content_file_name, ('other-file',), {}),
794.             (value.func, value.args, value.keywords)
795.         )
796. 
797.         kwargs_changed = [ModelState("testapp", "Author", [
798.             ("id", models.AutoField(primary_key=True)),
799.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file', spam='eggs'))),
800.         ])]
801.         changes = self.get_changes(before, kwargs_changed)
802.         self.assertNumberMigrations(changes, 'testapp', 1)
803.         self.assertOperationTypes(changes, 'testapp', 0, ['AlterField'])
804.         value = changes['testapp'][0].operations[0].field.upload_to
805.         self.assertEqual(
806.             (_content_file_name, ('file',), {'spam': 'eggs'}),
807.             (value.func, value.args, value.keywords)
808.         )
809. 
810.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
811.                 side_effect=AssertionError("Should not have prompted for not null addition"))
812.     def test_alter_field_to_not_null_with_default(self, mocked_ask_method):
813.         """
814.         #23609 - Tests autodetection of nullable to non-nullable alterations.
815.         """
816.         changes = self.get_changes([self.author_name_null], [self.author_name_default])
817.         # Right number/type of migrations?
818.         self.assertNumberMigrations(changes, 'testapp', 1)
819.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
820.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
821.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default='Ada Lovelace')
822. 
823.     @mock.patch(
824.         'django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
825.         return_value=models.NOT_PROVIDED,
826.     )
827.     def test_alter_field_to_not_null_without_default(self, mocked_ask_method):
828.         """
829.         #23609 - Tests autodetection of nullable to non-nullable alterations.
830.         """
831.         changes = self.get_changes([self.author_name_null], [self.author_name])
832.         self.assertEqual(mocked_ask_method.call_count, 1)
833.         # Right number/type of migrations?
834.         self.assertNumberMigrations(changes, 'testapp', 1)
835.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
836.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
837.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default=models.NOT_PROVIDED)
838. 
839.     @mock.patch(
840.         'django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
841.         return_value='Some Name',
842.     )
843.     def test_alter_field_to_not_null_oneoff_default(self, mocked_ask_method):
844.         """
845.         #23609 - Tests autodetection of nullable to non-nullable alterations.
846.         """
847.         changes = self.get_changes([self.author_name_null], [self.author_name])
848.         self.assertEqual(mocked_ask_method.call_count, 1)
849.         # Right number/type of migrations?
850.         self.assertNumberMigrations(changes, 'testapp', 1)
851.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
852.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=False)
853.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default="Some Name")
854. 
855.     def test_rename_field(self):
856.         """Tests autodetection of renamed fields."""
857.         changes = self.get_changes(
858.             [self.author_name], [self.author_name_renamed], MigrationQuestioner({"ask_rename": True})
859.         )
860.         # Right number/type of migrations?
861.         self.assertNumberMigrations(changes, 'testapp', 1)
862.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameField"])
863.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="name", new_name="names")
864. 
865.     def test_rename_field_foreign_key_to_field(self):
866.         before = [
867.             ModelState('app', 'Foo', [
868.                 ('id', models.AutoField(primary_key=True)),
869.                 ('field', models.IntegerField(unique=True)),
870.             ]),
871.             ModelState('app', 'Bar', [
872.                 ('id', models.AutoField(primary_key=True)),
873.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE, to_field='field')),
874.             ]),
875.         ]
876.         after = [
877.             ModelState('app', 'Foo', [
878.                 ('id', models.AutoField(primary_key=True)),
879.                 ('renamed_field', models.IntegerField(unique=True)),
880.             ]),
881.             ModelState('app', 'Bar', [
882.                 ('id', models.AutoField(primary_key=True)),
883.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE, to_field='renamed_field')),
884.             ]),
885.         ]
886.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
887.         # Right number/type of migrations?
888.         self.assertNumberMigrations(changes, 'app', 1)
889.         self.assertOperationTypes(changes, 'app', 0, ['RenameField'])
890.         self.assertOperationAttributes(changes, 'app', 0, 0, old_name='field', new_name='renamed_field')
891. 
892.     def test_rename_foreign_object_fields(self):
893.         fields = ('first', 'second')
894.         renamed_fields = ('first_renamed', 'second_renamed')
895.         before = [
896.             ModelState('app', 'Foo', [
897.                 ('id', models.AutoField(primary_key=True)),
898.                 ('first', models.IntegerField()),
899.                 ('second', models.IntegerField()),
900.             ], options={'unique_together': {fields}}),
901.             ModelState('app', 'Bar', [
902.                 ('id', models.AutoField(primary_key=True)),
903.                 ('first', models.IntegerField()),
904.                 ('second', models.IntegerField()),
905.                 ('foo', models.ForeignObject(
906.                     'app.Foo', models.CASCADE, from_fields=fields, to_fields=fields,
907.                 )),
908.             ]),
909.         ]
910.         # Case 1: to_fields renames.
911.         after = [
912.             ModelState('app', 'Foo', [
913.                 ('id', models.AutoField(primary_key=True)),
914.                 ('first_renamed', models.IntegerField()),
915.                 ('second_renamed', models.IntegerField()),
916.             ], options={'unique_together': {renamed_fields}}),
917.             ModelState('app', 'Bar', [
918.                 ('id', models.AutoField(primary_key=True)),
919.                 ('first', models.IntegerField()),
920.                 ('second', models.IntegerField()),
921.                 ('foo', models.ForeignObject(
922.                     'app.Foo', models.CASCADE, from_fields=fields, to_fields=renamed_fields,
923.                 )),
924.             ]),
925.         ]
926.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
927.         self.assertNumberMigrations(changes, 'app', 1)
928.         self.assertOperationTypes(changes, 'app', 0, ['RenameField', 'RenameField', 'AlterUniqueTogether'])
929.         self.assertOperationAttributes(
930.             changes, 'app', 0, 0, model_name='foo', old_name='first', new_name='first_renamed',
931.         )
932.         self.assertOperationAttributes(
933.             changes, 'app', 0, 1, model_name='foo', old_name='second', new_name='second_renamed',
934.         )
935.         # Case 2: from_fields renames.
936.         after = [
937.             ModelState('app', 'Foo', [
938.                 ('id', models.AutoField(primary_key=True)),
939.                 ('first', models.IntegerField()),
940.                 ('second', models.IntegerField()),
941.             ], options={'unique_together': {fields}}),
942.             ModelState('app', 'Bar', [
943.                 ('id', models.AutoField(primary_key=True)),
944.                 ('first_renamed', models.IntegerField()),
945.                 ('second_renamed', models.IntegerField()),
946.                 ('foo', models.ForeignObject(
947.                     'app.Foo', models.CASCADE, from_fields=renamed_fields, to_fields=fields,
948.                 )),
949.             ]),
950.         ]
951.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
952.         self.assertNumberMigrations(changes, 'app', 1)
953.         self.assertOperationTypes(changes, 'app', 0, ['RenameField', 'RenameField'])
954.         self.assertOperationAttributes(
955.             changes, 'app', 0, 0, model_name='bar', old_name='first', new_name='first_renamed',
956.         )
957.         self.assertOperationAttributes(
958.             changes, 'app', 0, 1, model_name='bar', old_name='second', new_name='second_renamed',
959.         )
960. 
961.     def test_rename_referenced_primary_key(self):
962.         before = [
963.             ModelState('app', 'Foo', [
964.                 ('id', models.CharField(primary_key=True, serialize=False)),
965.             ]),
966.             ModelState('app', 'Bar', [
967.                 ('id', models.AutoField(primary_key=True)),
968.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
969.             ]),
970.         ]
971.         after = [
972.             ModelState('app', 'Foo', [
973.                 ('renamed_id', models.CharField(primary_key=True, serialize=False))
974.             ]),
975.             ModelState('app', 'Bar', [
976.                 ('id', models.AutoField(primary_key=True)),
977.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
978.             ]),
979.         ]
980.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
981.         self.assertNumberMigrations(changes, 'app', 1)
982.         self.assertOperationTypes(changes, 'app', 0, ['RenameField'])
983.         self.assertOperationAttributes(changes, 'app', 0, 0, old_name='id', new_name='renamed_id')
984. 
985.     def test_rename_field_preserved_db_column(self):
986.         """
987.         RenameField is used if a field is renamed and db_column equal to the
988.         old field's column is added.
989.         """
990.         before = [
991.             ModelState('app', 'Foo', [
992.                 ('id', models.AutoField(primary_key=True)),
993.                 ('field', models.IntegerField()),
994.             ]),
995.         ]
996.         after = [
997.             ModelState('app', 'Foo', [
998.                 ('id', models.AutoField(primary_key=True)),
999.                 ('renamed_field', models.IntegerField(db_column='field')),
1000.             ]),
1001.         ]
1002.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
1003.         self.assertNumberMigrations(changes, 'app', 1)
1004.         self.assertOperationTypes(changes, 'app', 0, ['AlterField', 'RenameField'])
1005.         self.assertOperationAttributes(
1006.             changes, 'app', 0, 0, model_name='foo', name='field',
1007.         )
1008.         self.assertEqual(changes['app'][0].operations[0].field.deconstruct(), (
1009.             'field', 'django.db.models.IntegerField', [], {'db_column': 'field'},
1010.         ))
1011.         self.assertOperationAttributes(
1012.             changes, 'app', 0, 1, model_name='foo', old_name='field',
1013.             new_name='renamed_field',
1014.         )
1015. 
1016.     def test_rename_related_field_preserved_db_column(self):
1017.         before = [
1018.             ModelState('app', 'Foo', [
1019.                 ('id', models.AutoField(primary_key=True)),
1020.             ]),
1021.             ModelState('app', 'Bar', [
1022.                 ('id', models.AutoField(primary_key=True)),
1023.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
1024.             ]),
1025.         ]
1026.         after = [
1027.             ModelState('app', 'Foo', [
1028.                 ('id', models.AutoField(primary_key=True)),
1029.             ]),
1030.             ModelState('app', 'Bar', [
1031.                 ('id', models.AutoField(primary_key=True)),
1032.                 ('renamed_foo', models.ForeignKey('app.Foo', models.CASCADE, db_column='foo_id')),
1033.             ]),
1034.         ]
1035.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
1036.         self.assertNumberMigrations(changes, 'app', 1)
1037.         self.assertOperationTypes(changes, 'app', 0, ['AlterField', 'RenameField'])
1038.         self.assertOperationAttributes(
1039.             changes, 'app', 0, 0, model_name='bar', name='foo',
1040.         )
1041.         self.assertEqual(changes['app'][0].operations[0].field.deconstruct(), (
1042.             'foo',
1043.             'django.db.models.ForeignKey',
1044.             [],
1045.             {'to': 'app.foo', 'on_delete': models.CASCADE, 'db_column': 'foo_id'},
1046.         ))
1047.         self.assertOperationAttributes(
1048.             changes, 'app', 0, 1, model_name='bar', old_name='foo',
1049.             new_name='renamed_foo',
1050.         )
1051. 
1052.     def test_rename_model(self):
1053.         """Tests autodetection of renamed models."""
1054.         changes = self.get_changes(
1055.             [self.author_with_book, self.book],
1056.             [self.author_renamed_with_book, self.book_with_author_renamed],
1057.             MigrationQuestioner({"ask_rename_model": True}),
1058.         )
1059.         # Right number/type of migrations?
1060.         self.assertNumberMigrations(changes, 'testapp', 1)
1061.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1062.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="Author", new_name="Writer")
1063.         # Now that RenameModel handles related fields too, there should be
1064.         # no AlterField for the related field.
1065.         self.assertNumberMigrations(changes, 'otherapp', 0)
1066. 
1067.     def test_rename_model_case(self):
1068.         """
1069.         Model name is case-insensitive. Changing case doesn't lead to any
1070.         autodetected operations.
1071.         """
1072.         author_renamed = ModelState('testapp', 'author', [
1073.             ('id', models.AutoField(primary_key=True)),
1074.         ])
1075.         changes = self.get_changes(
1076.             [self.author_empty, self.book],
1077.             [author_renamed, self.book],
1078.             questioner=MigrationQuestioner({'ask_rename_model': True}),
1079.         )
1080.         self.assertNumberMigrations(changes, 'testapp', 0)
1081.         self.assertNumberMigrations(changes, 'otherapp', 0)
1082. 
1083.     def test_renamed_referenced_m2m_model_case(self):
1084.         publisher_renamed = ModelState('testapp', 'publisher', [
1085.             ('id', models.AutoField(primary_key=True)),
1086.             ('name', models.CharField(max_length=100)),
1087.         ])
1088.         changes = self.get_changes(
1089.             [self.publisher, self.author_with_m2m],
1090.             [publisher_renamed, self.author_with_m2m],
1091.             questioner=MigrationQuestioner({'ask_rename_model': True}),
1092.         )
1093.         self.assertNumberMigrations(changes, 'testapp', 0)
1094.         self.assertNumberMigrations(changes, 'otherapp', 0)
1095. 
1096.     def test_rename_m2m_through_model(self):
1097.         """
1098.         Tests autodetection of renamed models that are used in M2M relations as
1099.         through models.
1100.         """
1101.         changes = self.get_changes(
1102.             [self.author_with_m2m_through, self.publisher, self.contract],
1103.             [self.author_with_renamed_m2m_through, self.publisher, self.contract_renamed],
1104.             MigrationQuestioner({'ask_rename_model': True})
1105.         )
1106.         # Right number/type of migrations?
1107.         self.assertNumberMigrations(changes, 'testapp', 1)
1108.         self.assertOperationTypes(changes, 'testapp', 0, ['RenameModel'])
1109.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name='Contract', new_name='Deal')
1110. 
1111.     def test_rename_model_with_renamed_rel_field(self):
1112.         """
1113.         Tests autodetection of renamed models while simultaneously renaming one
1114.         of the fields that relate to the renamed model.
1115.         """
1116.         changes = self.get_changes(
1117.             [self.author_with_book, self.book],
1118.             [self.author_renamed_with_book, self.book_with_field_and_author_renamed],
1119.             MigrationQuestioner({"ask_rename": True, "ask_rename_model": True}),
1120.         )
1121.         # Right number/type of migrations?
1122.         self.assertNumberMigrations(changes, 'testapp', 1)
1123.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1124.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="Author", new_name="Writer")
1125.         # Right number/type of migrations for related field rename?
1126.         # Alter is already taken care of.
1127.         self.assertNumberMigrations(changes, 'otherapp', 1)
1128.         self.assertOperationTypes(changes, 'otherapp', 0, ["RenameField"])
1129.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, old_name="author", new_name="writer")
1130. 
1131.     def test_rename_model_with_fks_in_different_position(self):
1132.         """
1133.         #24537 - The order of fields in a model does not influence
1134.         the RenameModel detection.
1135.         """
1136.         before = [
1137.             ModelState("testapp", "EntityA", [
1138.                 ("id", models.AutoField(primary_key=True)),
1139.             ]),
1140.             ModelState("testapp", "EntityB", [
1141.                 ("id", models.AutoField(primary_key=True)),
1142.                 ("some_label", models.CharField(max_length=255)),
1143.                 ("entity_a", models.ForeignKey("testapp.EntityA", models.CASCADE)),
1144.             ]),
1145.         ]
1146.         after = [
1147.             ModelState("testapp", "EntityA", [
1148.                 ("id", models.AutoField(primary_key=True)),
1149.             ]),
1150.             ModelState("testapp", "RenamedEntityB", [
1151.                 ("id", models.AutoField(primary_key=True)),
1152.                 ("entity_a", models.ForeignKey("testapp.EntityA", models.CASCADE)),
1153.                 ("some_label", models.CharField(max_length=255)),
1154.             ]),
1155.         ]
1156.         changes = self.get_changes(before, after, MigrationQuestioner({"ask_rename_model": True}))
1157.         self.assertNumberMigrations(changes, "testapp", 1)
1158.         self.assertOperationTypes(changes, "testapp", 0, ["RenameModel"])
1159.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="EntityB", new_name="RenamedEntityB")
1160. 
1161.     def test_rename_model_reverse_relation_dependencies(self):
1162.         """
1163.         The migration to rename a model pointed to by a foreign key in another
1164.         app must run after the other app's migration that adds the foreign key
1165.         with model's original name. Therefore, the renaming migration has a
1166.         dependency on that other migration.
1167.         """
1168.         before = [
1169.             ModelState('testapp', 'EntityA', [
1170.                 ('id', models.AutoField(primary_key=True)),
1171.             ]),
1172.             ModelState('otherapp', 'EntityB', [
1173.                 ('id', models.AutoField(primary_key=True)),
1174.                 ('entity_a', models.ForeignKey('testapp.EntityA', models.CASCADE)),
1175.             ]),
1176.         ]
1177.         after = [
1178.             ModelState('testapp', 'RenamedEntityA', [
1179.                 ('id', models.AutoField(primary_key=True)),
1180.             ]),
1181.             ModelState('otherapp', 'EntityB', [
1182.                 ('id', models.AutoField(primary_key=True)),
1183.                 ('entity_a', models.ForeignKey('testapp.RenamedEntityA', models.CASCADE)),
1184.             ]),
1185.         ]
1186.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename_model': True}))
1187.         self.assertNumberMigrations(changes, 'testapp', 1)
1188.         self.assertMigrationDependencies(changes, 'testapp', 0, [('otherapp', '__first__')])
1189.         self.assertOperationTypes(changes, 'testapp', 0, ['RenameModel'])
1190.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name='EntityA', new_name='RenamedEntityA')
1191. 
1192.     def test_fk_dependency(self):
1193.         """Having a ForeignKey automatically adds a dependency."""
1194.         # Note that testapp (author) has no dependencies,
1195.         # otherapp (book) depends on testapp (author),
1196.         # thirdapp (edition) depends on otherapp (book)
1197.         changes = self.get_changes([], [self.author_name, self.book, self.edition])
1198.         # Right number/type of migrations?
1199.         self.assertNumberMigrations(changes, 'testapp', 1)
1200.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1201.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1202.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1203.         # Right number/type of migrations?
1204.         self.assertNumberMigrations(changes, 'otherapp', 1)
1205.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1206.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
1207.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("testapp", "auto_1")])
1208.         # Right number/type of migrations?
1209.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1210.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel"])
1211.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="Edition")
1212.         self.assertMigrationDependencies(changes, 'thirdapp', 0, [("otherapp", "auto_1")])
1213. 
1214.     def test_proxy_fk_dependency(self):
1215.         """FK dependencies still work on proxy models."""
1216.         # Note that testapp (author) has no dependencies,
1217.         # otherapp (book) depends on testapp (authorproxy)
1218.         changes = self.get_changes([], [self.author_empty, self.author_proxy_third, self.book_proxy_fk])
1219.         # Right number/type of migrations?
1220.         self.assertNumberMigrations(changes, 'testapp', 1)
1221.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1222.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1223.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1224.         # Right number/type of migrations?
1225.         self.assertNumberMigrations(changes, 'otherapp', 1)
1226.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1227.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
1228.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("thirdapp", "auto_1")])
1229.         # Right number/type of migrations?
1230.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1231.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel"])
1232.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="AuthorProxy")
1233.         self.assertMigrationDependencies(changes, 'thirdapp', 0, [("testapp", "auto_1")])
1234. 
1235.     def test_same_app_no_fk_dependency(self):
1236.         """
1237.         A migration with a FK between two models of the same app
1238.         does not have a dependency to itself.
1239.         """
1240.         changes = self.get_changes([], [self.author_with_publisher, self.publisher])
1241.         # Right number/type of migrations?
1242.         self.assertNumberMigrations(changes, 'testapp', 1)
1243.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
1244.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Publisher")
1245.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
1246.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1247. 
1248.     def test_circular_fk_dependency(self):
1249.         """
1250.         Having a circular ForeignKey dependency automatically
1251.         resolves the situation into 2 migrations on one side and 1 on the other.
1252.         """
1253.         changes = self.get_changes([], [self.author_with_book, self.book, self.publisher_with_book])
1254.         # Right number/type of migrations?
1255.         self.assertNumberMigrations(changes, 'testapp', 1)
1256.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
1257.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Publisher")
1258.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
1259.         self.assertMigrationDependencies(changes, 'testapp', 0, [("otherapp", "auto_1")])
1260.         # Right number/type of migrations?
1261.         self.assertNumberMigrations(changes, 'otherapp', 2)
1262.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1263.         self.assertOperationTypes(changes, 'otherapp', 1, ["AddField"])
1264.         self.assertMigrationDependencies(changes, 'otherapp', 0, [])
1265.         self.assertMigrationDependencies(changes, 'otherapp', 1, [("otherapp", "auto_1"), ("testapp", "auto_1")])
1266.         # both split migrations should be `initial`
1267.         self.assertTrue(changes['otherapp'][0].initial)
1268.         self.assertTrue(changes['otherapp'][1].initial)
1269. 
1270.     def test_same_app_circular_fk_dependency(self):
1271.         """
1272.         A migration with a FK between two models of the same app does
1273.         not have a dependency to itself.
1274.         """
1275.         changes = self.get_changes([], [self.author_with_publisher, self.publisher_with_author])
1276.         # Right number/type of migrations?
1277.         self.assertNumberMigrations(changes, 'testapp', 1)
1278.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel", "AddField"])
1279.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Author")
1280.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Publisher")
1281.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="publisher")
1282.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1283. 
1284.     def test_same_app_circular_fk_dependency_with_unique_together_and_indexes(self):
1285.         """
1286.         #22275 - A migration with circular FK dependency does not try
1287.         to create unique together constraint and indexes before creating all
1288.         required fields first.
1289.         """
1290.         changes = self.get_changes([], [self.knight, self.rabbit])
1291.         # Right number/type of migrations?
1292.         self.assertNumberMigrations(changes, 'eggs', 1)
1293.         self.assertOperationTypes(
1294.             changes, 'eggs', 0, ["CreateModel", "CreateModel", "AddIndex", "AlterUniqueTogether"]
1295.         )
1296.         self.assertNotIn("unique_together", changes['eggs'][0].operations[0].options)
1297.         self.assertNotIn("unique_together", changes['eggs'][0].operations[1].options)
1298.         self.assertMigrationDependencies(changes, 'eggs', 0, [])
1299. 
1300.     def test_alter_db_table_add(self):
1301.         """Tests detection for adding db_table in model's options."""
1302.         changes = self.get_changes([self.author_empty], [self.author_with_db_table_options])
1303.         # Right number/type of migrations?
1304.         self.assertNumberMigrations(changes, 'testapp', 1)
1305.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1306.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table="author_one")
1307. 
1308.     def test_alter_db_table_change(self):
1309.         """Tests detection for changing db_table in model's options'."""
1310.         changes = self.get_changes([self.author_with_db_table_options], [self.author_with_new_db_table_options])
1311.         # Right number/type of migrations?
1312.         self.assertNumberMigrations(changes, 'testapp', 1)
1313.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1314.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table="author_two")
1315. 
1316.     def test_alter_db_table_remove(self):
1317.         """Tests detection for removing db_table in model's options."""
1318.         changes = self.get_changes([self.author_with_db_table_options], [self.author_empty])
1319.         # Right number/type of migrations?
1320.         self.assertNumberMigrations(changes, 'testapp', 1)
1321.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1322.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table=None)
1323. 
1324.     def test_alter_db_table_no_changes(self):
1325.         """
1326.         Alter_db_table doesn't generate a migration if no changes have been made.
1327.         """
1328.         changes = self.get_changes([self.author_with_db_table_options], [self.author_with_db_table_options])
1329.         # Right number of migrations?
1330.         self.assertEqual(len(changes), 0)
1331. 
1332.     def test_keep_db_table_with_model_change(self):
1333.         """
1334.         Tests when model changes but db_table stays as-is, autodetector must not
1335.         create more than one operation.
1336.         """
1337.         changes = self.get_changes(
1338.             [self.author_with_db_table_options],
1339.             [self.author_renamed_with_db_table_options],
1340.             MigrationQuestioner({"ask_rename_model": True}),
1341.         )
1342.         # Right number/type of migrations?
1343.         self.assertNumberMigrations(changes, 'testapp', 1)
1344.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1345.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="Author", new_name="NewAuthor")
1346. 
1347.     def test_alter_db_table_with_model_change(self):
1348.         """
1349.         Tests when model and db_table changes, autodetector must create two
1350.         operations.
1351.         """
1352.         changes = self.get_changes(
1353.             [self.author_with_db_table_options],
1354.             [self.author_renamed_with_new_db_table_options],
1355.             MigrationQuestioner({"ask_rename_model": True}),
1356.         )
1357.         # Right number/type of migrations?
1358.         self.assertNumberMigrations(changes, 'testapp', 1)
1359.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel", "AlterModelTable"])
1360.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="Author", new_name="NewAuthor")
1361.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="newauthor", table="author_three")
1362. 
1363.     def test_identical_regex_doesnt_alter(self):
1364.         from_state = ModelState(
1365.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[
1366.                 RegexValidator(
1367.                     re.compile('^[-a-zA-Z0-9_]+\\Z'),
1368.                     'Enter a valid “slug” consisting of letters, numbers, underscores or hyphens.',
1369.                     'invalid'
1370.                 )
1371.             ]))]
1372.         )
1373.         to_state = ModelState(
1374.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[validate_slug]))]
1375.         )
1376.         changes = self.get_changes([from_state], [to_state])
1377.         # Right number/type of migrations?
1378.         self.assertNumberMigrations(changes, "testapp", 0)
1379. 
1380.     def test_different_regex_does_alter(self):
1381.         from_state = ModelState(
1382.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[
1383.                 RegexValidator(
1384.                     re.compile('^[a-z]+\\Z', 32),
1385.                     'Enter a valid “slug” consisting of letters, numbers, underscores or hyphens.',
1386.                     'invalid'
1387.                 )
1388.             ]))]
1389.         )
1390.         to_state = ModelState(
1391.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[validate_slug]))]
1392.         )
1393.         changes = self.get_changes([from_state], [to_state])
1394.         self.assertNumberMigrations(changes, "testapp", 1)
1395.         self.assertOperationTypes(changes, "testapp", 0, ["AlterField"])
1396. 
1397.     def test_empty_foo_together(self):
1398.         """
1399.         #23452 - Empty unique/index_together shouldn't generate a migration.
1400.         """
1401.         # Explicitly testing for not specified, since this is the case after
1402.         # a CreateModel operation w/o any definition on the original model
1403.         model_state_not_specified = ModelState("a", "model", [("id", models.AutoField(primary_key=True))])
1404.         # Explicitly testing for None, since this was the issue in #23452 after
1405.         # an AlterFooTogether operation with e.g. () as value
1406.         model_state_none = ModelState("a", "model", [
1407.             ("id", models.AutoField(primary_key=True))
1408.         ], {
1409.             "index_together": None,
1410.             "unique_together": None,
1411.         })
1412.         # Explicitly testing for the empty set, since we now always have sets.
1413.         # During removal (('col1', 'col2'),) --> () this becomes set([])
1414.         model_state_empty = ModelState("a", "model", [
1415.             ("id", models.AutoField(primary_key=True))
1416.         ], {
1417.             "index_together": set(),
1418.             "unique_together": set(),
1419.         })
1420. 
1421.         def test(from_state, to_state, msg):
1422.             changes = self.get_changes([from_state], [to_state])
1423.             if changes:
1424.                 ops = ', '.join(o.__class__.__name__ for o in changes['a'][0].operations)
1425.                 self.fail('Created operation(s) %s from %s' % (ops, msg))
1426. 
1427.         tests = (
1428.             (model_state_not_specified, model_state_not_specified, '"not specified" to "not specified"'),
1429.             (model_state_not_specified, model_state_none, '"not specified" to "None"'),
1430.             (model_state_not_specified, model_state_empty, '"not specified" to "empty"'),
1431.             (model_state_none, model_state_not_specified, '"None" to "not specified"'),
1432.             (model_state_none, model_state_none, '"None" to "None"'),
1433.             (model_state_none, model_state_empty, '"None" to "empty"'),
1434.             (model_state_empty, model_state_not_specified, '"empty" to "not specified"'),
1435.             (model_state_empty, model_state_none, '"empty" to "None"'),
1436.             (model_state_empty, model_state_empty, '"empty" to "empty"'),
1437.         )
1438. 
1439.         for t in tests:
1440.             test(*t)
1441. 
1442.     def test_create_model_with_indexes(self):
1443.         """Test creation of new model with indexes already defined."""
1444.         author = ModelState('otherapp', 'Author', [
1445.             ('id', models.AutoField(primary_key=True)),
1446.             ('name', models.CharField(max_length=200)),
1447.         ], {'indexes': [models.Index(fields=['name'], name='create_model_with_indexes_idx')]})
1448.         changes = self.get_changes([], [author])
1449.         added_index = models.Index(fields=['name'], name='create_model_with_indexes_idx')
1450.         # Right number of migrations?
1451.         self.assertEqual(len(changes['otherapp']), 1)
1452.         # Right number of actions?
1453.         migration = changes['otherapp'][0]
1454.         self.assertEqual(len(migration.operations), 2)
1455.         # Right actions order?
1456.         self.assertOperationTypes(changes, 'otherapp', 0, ['CreateModel', 'AddIndex'])
1457.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='Author')
1458.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='author', index=added_index)
1459. 
1460.     def test_add_indexes(self):
1461.         """Test change detection of new indexes."""
1462.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_indexes])
1463.         self.assertNumberMigrations(changes, 'otherapp', 1)
1464.         self.assertOperationTypes(changes, 'otherapp', 0, ['AddIndex'])
1465.         added_index = models.Index(fields=['author', 'title'], name='book_title_author_idx')
1466.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', index=added_index)
1467. 
1468.     def test_remove_indexes(self):
1469.         """Test change detection of removed indexes."""
1470.         changes = self.get_changes([self.author_empty, self.book_indexes], [self.author_empty, self.book])
1471.         # Right number/type of migrations?
1472.         self.assertNumberMigrations(changes, 'otherapp', 1)
1473.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveIndex'])
1474.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', name='book_title_author_idx')
1475. 
1476.     def test_order_fields_indexes(self):
1477.         """Test change detection of reordering of fields in indexes."""
1478.         changes = self.get_changes(
1479.             [self.author_empty, self.book_indexes], [self.author_empty, self.book_unordered_indexes]
1480.         )
1481.         self.assertNumberMigrations(changes, 'otherapp', 1)
1482.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveIndex', 'AddIndex'])
1483.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', name='book_title_author_idx')
1484.         added_index = models.Index(fields=['title', 'author'], name='book_author_title_idx')
1485.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='book', index=added_index)
1486. 
1487.     def test_create_model_with_check_constraint(self):
1488.         """Test creation of new model with constraints already defined."""
1489.         author = ModelState('otherapp', 'Author', [
1490.             ('id', models.AutoField(primary_key=True)),
1491.             ('name', models.CharField(max_length=200)),
1492.         ], {'constraints': [models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')]})
1493.         changes = self.get_changes([], [author])
1494.         added_constraint = models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')
1495.         # Right number of migrations?
1496.         self.assertEqual(len(changes['otherapp']), 1)
1497.         # Right number of actions?
1498.         migration = changes['otherapp'][0]
1499.         self.assertEqual(len(migration.operations), 2)
1500.         # Right actions order?
1501.         self.assertOperationTypes(changes, 'otherapp', 0, ['CreateModel', 'AddConstraint'])
1502.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='Author')
1503.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='author', constraint=added_constraint)
1504. 
1505.     def test_add_constraints(self):
1506.         """Test change detection of new constraints."""
1507.         changes = self.get_changes([self.author_name], [self.author_name_check_constraint])
1508.         self.assertNumberMigrations(changes, 'testapp', 1)
1509.         self.assertOperationTypes(changes, 'testapp', 0, ['AddConstraint'])
1510.         added_constraint = models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')
1511.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name='author', constraint=added_constraint)
1512. 
1513.     def test_remove_constraints(self):
1514.         """Test change detection of removed constraints."""
1515.         changes = self.get_changes([self.author_name_check_constraint], [self.author_name])
1516.         # Right number/type of migrations?
1517.         self.assertNumberMigrations(changes, 'testapp', 1)
1518.         self.assertOperationTypes(changes, 'testapp', 0, ['RemoveConstraint'])
1519.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name='author', name='name_contains_bob')
1520. 
1521.     def test_add_foo_together(self):
1522.         """Tests index/unique_together detection."""
1523.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_foo_together])
1524.         # Right number/type of migrations?
1525.         self.assertNumberMigrations(changes, "otherapp", 1)
1526.         self.assertOperationTypes(changes, "otherapp", 0, ["AlterUniqueTogether", "AlterIndexTogether"])
1527.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together={("author", "title")})
1528.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together={("author", "title")})
1529. 
1530.     def test_remove_foo_together(self):
1531.         """Tests index/unique_together detection."""
1532.         changes = self.get_changes([self.author_empty, self.book_foo_together], [self.author_empty, self.book])
1533.         # Right number/type of migrations?
1534.         self.assertNumberMigrations(changes, "otherapp", 1)
1535.         self.assertOperationTypes(changes, "otherapp", 0, ["AlterUniqueTogether", "AlterIndexTogether"])
1536.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together=set())
1537.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together=set())
1538. 
1539.     def test_foo_together_remove_fk(self):
1540.         """Tests unique_together and field removal detection & ordering"""
1541.         changes = self.get_changes(
1542.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_with_no_author]
1543.         )
1544.         # Right number/type of migrations?
1545.         self.assertNumberMigrations(changes, "otherapp", 1)
1546.         self.assertOperationTypes(changes, "otherapp", 0, [
1547.             "AlterUniqueTogether", "AlterIndexTogether", "RemoveField"
1548.         ])
1549.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together=set())
1550.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together=set())
1551.         self.assertOperationAttributes(changes, "otherapp", 0, 2, model_name="book", name="author")
1552. 
1553.     def test_foo_together_no_changes(self):
1554.         """
1555.         index/unique_together doesn't generate a migration if no
1556.         changes have been made.
1557.         """
1558.         changes = self.get_changes(
1559.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_foo_together]
1560.         )
1561.         # Right number of migrations?
1562.         self.assertEqual(len(changes), 0)
1563. 
1564.     def test_foo_together_ordering(self):
1565.         """
1566.         index/unique_together also triggers on ordering changes.
1567.         """
1568.         changes = self.get_changes(
1569.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_foo_together_2]
1570.         )
1571.         # Right number/type of migrations?
1572.         self.assertNumberMigrations(changes, "otherapp", 1)
1573.         self.assertOperationTypes(changes, 'otherapp', 0, [
1574.             'AlterUniqueTogether',
1575.             'AlterIndexTogether',
1576.         ])
1577.         self.assertOperationAttributes(
1578.             changes, 'otherapp', 0, 0, name='book',
1579.             unique_together={('title', 'author')},
1580.         )
1581.         self.assertOperationAttributes(
1582.             changes, 'otherapp', 0, 1, name='book',
1583.             index_together={('title', 'author')},
1584.         )
1585. 
1586.     def test_add_field_and_foo_together(self):
1587.         """
1588.         Added fields will be created before using them in index/unique_together.
1589.         """
1590.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_foo_together_3])
1591.         # Right number/type of migrations?
1592.         self.assertNumberMigrations(changes, "otherapp", 1)
1593.         self.assertOperationTypes(changes, "otherapp", 0, ["AddField", "AlterUniqueTogether", "AlterIndexTogether"])
1594.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", unique_together={("title", "newfield")})
1595.         self.assertOperationAttributes(changes, "otherapp", 0, 2, name="book", index_together={("title", "newfield")})
1596. 
1597.     def test_create_model_and_unique_together(self):
1598.         author = ModelState("otherapp", "Author", [
1599.             ("id", models.AutoField(primary_key=True)),
1600.             ("name", models.CharField(max_length=200)),
1601.         ])
1602.         book_with_author = ModelState("otherapp", "Book", [
1603.             ("id", models.AutoField(primary_key=True)),
1604.             ("author", models.ForeignKey("otherapp.Author", models.CASCADE)),
1605.             ("title", models.CharField(max_length=200)),
1606.         ], {
1607.             "index_together": {("title", "author")},
1608.             "unique_together": {("title", "author")},
1609.         })
1610.         changes = self.get_changes([self.book_with_no_author], [author, book_with_author])
1611.         # Right number of migrations?
1612.         self.assertEqual(len(changes['otherapp']), 1)
1613.         # Right number of actions?
1614.         migration = changes['otherapp'][0]
1615.         self.assertEqual(len(migration.operations), 4)
1616.         # Right actions order?
1617.         self.assertOperationTypes(
1618.             changes, 'otherapp', 0,
1619.             ['CreateModel', 'AddField', 'AlterUniqueTogether', 'AlterIndexTogether']
1620.         )
1621. 
1622.     def test_remove_field_and_foo_together(self):
1623.         """
1624.         Removed fields will be removed after updating index/unique_together.
1625.         """
1626.         changes = self.get_changes(
1627.             [self.author_empty, self.book_foo_together_3], [self.author_empty, self.book_foo_together]
1628.         )
1629.         # Right number/type of migrations?
1630.         self.assertNumberMigrations(changes, "otherapp", 1)
1631.         self.assertOperationTypes(changes, 'otherapp', 0, [
1632.             'AlterUniqueTogether',
1633.             'AlterIndexTogether',
1634.             'RemoveField',
1635.         ])
1636.         self.assertOperationAttributes(
1637.             changes, 'otherapp', 0, 0, name='book',
1638.             unique_together={('author', 'title')},
1639.         )
1640.         self.assertOperationAttributes(
1641.             changes, 'otherapp', 0, 1, name='book',
1642.             index_together={('author', 'title')},
1643.         )
1644.         self.assertOperationAttributes(
1645.             changes, 'otherapp', 0, 2, model_name='book', name='newfield',
1646.         )
1647. 
1648.     def test_alter_field_and_foo_together(self):
1649.         """Fields are altered after deleting some index/unique_together."""
1650.         initial_author = ModelState('testapp', 'Author', [
1651.             ('id', models.AutoField(primary_key=True)),
1652.             ('name', models.CharField(max_length=200)),
1653.             ('age', models.IntegerField(db_index=True)),
1654.         ], {
1655.             'unique_together': {('name',)},
1656.         })
1657.         author_reversed_constraints = ModelState('testapp', 'Author', [
1658.             ('id', models.AutoField(primary_key=True)),
1659.             ('name', models.CharField(max_length=200, unique=True)),
1660.             ('age', models.IntegerField()),
1661.         ], {
1662.             'index_together': {('age',)},
1663.         })
1664.         changes = self.get_changes([initial_author], [author_reversed_constraints])
1665. 
1666.         self.assertNumberMigrations(changes, 'testapp', 1)
1667.         self.assertOperationTypes(changes, 'testapp', 0, [
1668.             'AlterUniqueTogether',
1669.             'AlterField',
1670.             'AlterField',
1671.             'AlterIndexTogether',
1672.         ])
1673.         self.assertOperationAttributes(
1674.             changes, 'testapp', 0, 0, name='author', unique_together=set(),
1675.         )
1676.         self.assertOperationAttributes(
1677.             changes, 'testapp', 0, 1, model_name='author', name='age',
1678.         )
1679.         self.assertOperationAttributes(
1680.             changes, 'testapp', 0, 2, model_name='author', name='name',
1681.         )
1682.         self.assertOperationAttributes(
1683.             changes, 'testapp', 0, 3, name='author', index_together={('age',)},
1684.         )
1685. 
1686.     def test_partly_alter_foo_together(self):
1687.         initial_author = ModelState('testapp', 'Author', [
1688.             ('id', models.AutoField(primary_key=True)),
1689.             ('name', models.CharField(max_length=200)),
1690.             ('age', models.IntegerField()),
1691.         ], {
1692.             'unique_together': {('name',), ('age',)},
1693.             'index_together': {('name',)},
1694.         })
1695.         author_reversed_constraints = ModelState('testapp', 'Author', [
1696.             ('id', models.AutoField(primary_key=True)),
1697.             ('name', models.CharField(max_length=200)),
1698.             ('age', models.IntegerField()),
1699.         ], {
1700.             'unique_together': {('age',)},
1701.             'index_together': {('name',), ('age',)},
1702.         })
1703.         changes = self.get_changes([initial_author], [author_reversed_constraints])
1704. 
1705.         self.assertNumberMigrations(changes, 'testapp', 1)
1706.         self.assertOperationTypes(changes, 'testapp', 0, [
1707.             'AlterUniqueTogether',
1708.             'AlterIndexTogether',
1709.         ])
1710.         self.assertOperationAttributes(
1711.             changes, 'testapp', 0, 0, name='author', unique_together={('age',)},
1712.         )
1713.         self.assertOperationAttributes(
1714.             changes, 'testapp', 0, 1, name='author',
1715.             index_together={('name',), ('age',)},
1716.         )
1717. 
1718.     def test_rename_field_and_foo_together(self):
1719.         """Fields are renamed before updating index/unique_together."""
1720.         changes = self.get_changes(
1721.             [self.author_empty, self.book_foo_together_3],
1722.             [self.author_empty, self.book_foo_together_4],
1723.             MigrationQuestioner({"ask_rename": True}),
1724.         )
1725.         # Right number/type of migrations?
1726.         self.assertNumberMigrations(changes, "otherapp", 1)
1727.         self.assertOperationTypes(changes, 'otherapp', 0, [
1728.             'RenameField',
1729.             'AlterUniqueTogether',
1730.             'AlterIndexTogether',
1731.         ])
1732.         self.assertOperationAttributes(
1733.             changes, 'otherapp', 0, 1, name='book',
1734.             unique_together={('title', 'newfield2')},
1735.         )
1736.         self.assertOperationAttributes(
1737.             changes, 'otherapp', 0, 2, name='book',
1738.             index_together={('title', 'newfield2')},
1739.         )
1740. 
1741.     def test_proxy(self):
1742.         """The autodetector correctly deals with proxy models."""
1743.         # First, we test adding a proxy model
1744.         changes = self.get_changes([self.author_empty], [self.author_empty, self.author_proxy])
1745.         # Right number/type of migrations?
1746.         self.assertNumberMigrations(changes, "testapp", 1)
1747.         self.assertOperationTypes(changes, "testapp", 0, ["CreateModel"])
1748.         self.assertOperationAttributes(
1749.             changes, "testapp", 0, 0, name="AuthorProxy", options={"proxy": True, "indexes": [], "constraints": []}
1750.         )
1751.         # Now, we test turning a proxy model into a non-proxy model
1752.         # It should delete the proxy then make the real one
1753.         changes = self.get_changes(
1754.             [self.author_empty, self.author_proxy], [self.author_empty, self.author_proxy_notproxy]
1755.         )
1756.         # Right number/type of migrations?
1757.         self.assertNumberMigrations(changes, "testapp", 1)
1758.         self.assertOperationTypes(changes, "testapp", 0, ["DeleteModel", "CreateModel"])
1759.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="AuthorProxy")
1760.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="AuthorProxy", options={})
1761. 
1762.     def test_proxy_non_model_parent(self):
1763.         class Mixin:
1764.             pass
1765. 
1766.         author_proxy_non_model_parent = ModelState(
1767.             'testapp',
1768.             'AuthorProxy',
1769.             [],
1770.             {'proxy': True},
1771.             (Mixin, 'testapp.author'),
1772.         )
1773.         changes = self.get_changes(
1774.             [self.author_empty],
1775.             [self.author_empty, author_proxy_non_model_parent],
1776.         )
1777.         self.assertNumberMigrations(changes, 'testapp', 1)
1778.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
1779.         self.assertOperationAttributes(
1780.             changes, 'testapp', 0, 0, name='AuthorProxy',
1781.             options={'proxy': True, 'indexes': [], 'constraints': []},
1782.             bases=(Mixin, 'testapp.author'),
1783.         )
1784. 
1785.     def test_proxy_custom_pk(self):
1786.         """
1787.         #23415 - The autodetector must correctly deal with custom FK on proxy
1788.         models.
1789.         """
1790.         # First, we test the default pk field name
1791.         changes = self.get_changes([], [self.author_empty, self.author_proxy_third, self.book_proxy_fk])
1792.         # The model the FK is pointing from and to.
1793.         self.assertEqual(
1794.             changes['otherapp'][0].operations[0].fields[2][1].remote_field.model,
1795.             'thirdapp.AuthorProxy',
1796.         )
1797.         # Now, we test the custom pk field name
1798.         changes = self.get_changes([], [self.author_custom_pk, self.author_proxy_third, self.book_proxy_fk])
1799.         # The model the FK is pointing from and to.
1800.         self.assertEqual(
1801.             changes['otherapp'][0].operations[0].fields[2][1].remote_field.model,
1802.             'thirdapp.AuthorProxy',
1803.         )
1804. 
1805.     def test_proxy_to_mti_with_fk_to_proxy(self):
1806.         # First, test the pk table and field name.
1807.         to_state = self.make_project_state(
1808.             [self.author_empty, self.author_proxy_third, self.book_proxy_fk],
1809.         )
1810.         changes = self.get_changes([], to_state)
1811.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1812.         self.assertEqual(
1813.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1814.             ('testapp', 'author'),
1815.         )
1816.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.AuthorProxy')
1817. 
1818.         # Change AuthorProxy to use MTI.
1819.         from_state = to_state.clone()
1820.         to_state = self.make_project_state(
1821.             [self.author_empty, self.author_proxy_third_notproxy, self.book_proxy_fk],
1822.         )
1823.         changes = self.get_changes(from_state, to_state)
1824.         # Right number/type of migrations for the AuthorProxy model?
1825.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1826.         self.assertOperationTypes(changes, 'thirdapp', 0, ['DeleteModel', 'CreateModel'])
1827.         # Right number/type of migrations for the Book model with a FK to
1828.         # AuthorProxy?
1829.         self.assertNumberMigrations(changes, 'otherapp', 1)
1830.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
1831.         # otherapp should depend on thirdapp.
1832.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('thirdapp', 'auto_1')])
1833.         # Now, test the pk table and field name.
1834.         fk_field = changes['otherapp'][0].operations[0].field
1835.         self.assertEqual(
1836.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1837.             ('thirdapp', 'authorproxy'),
1838.         )
1839.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.AuthorProxy')
1840. 
1841.     def test_proxy_to_mti_with_fk_to_proxy_proxy(self):
1842.         # First, test the pk table and field name.
1843.         to_state = self.make_project_state([
1844.             self.author_empty,
1845.             self.author_proxy,
1846.             self.author_proxy_proxy,
1847.             self.book_proxy_proxy_fk,
1848.         ])
1849.         changes = self.get_changes([], to_state)
1850.         fk_field = changes['otherapp'][0].operations[0].fields[1][1]
1851.         self.assertEqual(
1852.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1853.             ('testapp', 'author'),
1854.         )
1855.         self.assertEqual(fk_field.remote_field.model, 'testapp.AAuthorProxyProxy')
1856. 
1857.         # Change AuthorProxy to use MTI. FK still points to AAuthorProxyProxy,
1858.         # a proxy of AuthorProxy.
1859.         from_state = to_state.clone()
1860.         to_state = self.make_project_state([
1861.             self.author_empty,
1862.             self.author_proxy_notproxy,
1863.             self.author_proxy_proxy,
1864.             self.book_proxy_proxy_fk,
1865.         ])
1866.         changes = self.get_changes(from_state, to_state)
1867.         # Right number/type of migrations for the AuthorProxy model?
1868.         self.assertNumberMigrations(changes, 'testapp', 1)
1869.         self.assertOperationTypes(changes, 'testapp', 0, ['DeleteModel', 'CreateModel'])
1870.         # Right number/type of migrations for the Book model with a FK to
1871.         # AAuthorProxyProxy?
1872.         self.assertNumberMigrations(changes, 'otherapp', 1)
1873.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
1874.         # otherapp should depend on testapp.
1875.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('testapp', 'auto_1')])
1876.         # Now, test the pk table and field name.
1877.         fk_field = changes['otherapp'][0].operations[0].field
1878.         self.assertEqual(
1879.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1880.             ('testapp', 'authorproxy'),
1881.         )
1882.         self.assertEqual(fk_field.remote_field.model, 'testapp.AAuthorProxyProxy')
1883. 
1884.     def test_unmanaged_create(self):
1885.         """The autodetector correctly deals with managed models."""
1886.         # First, we test adding an unmanaged model
1887.         changes = self.get_changes([self.author_empty], [self.author_empty, self.author_unmanaged])
1888.         # Right number/type of migrations?
1889.         self.assertNumberMigrations(changes, 'testapp', 1)
1890.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1891.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="AuthorUnmanaged", options={"managed": False})
1892. 
1893.     def test_unmanaged_delete(self):
1894.         changes = self.get_changes([self.author_empty, self.author_unmanaged], [self.author_empty])
1895.         self.assertNumberMigrations(changes, 'testapp', 1)
1896.         self.assertOperationTypes(changes, 'testapp', 0, ['DeleteModel'])
1897. 
1898.     def test_unmanaged_to_managed(self):
1899.         # Now, we test turning an unmanaged model into a managed model
1900.         changes = self.get_changes(
1901.             [self.author_empty, self.author_unmanaged], [self.author_empty, self.author_unmanaged_managed]
1902.         )
1903.         # Right number/type of migrations?
1904.         self.assertNumberMigrations(changes, 'testapp', 1)
1905.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelOptions"])
1906.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="authorunmanaged", options={})
1907. 
1908.     def test_managed_to_unmanaged(self):
1909.         # Now, we turn managed to unmanaged.
1910.         changes = self.get_changes(
1911.             [self.author_empty, self.author_unmanaged_managed], [self.author_empty, self.author_unmanaged]
1912.         )
1913.         # Right number/type of migrations?
1914.         self.assertNumberMigrations(changes, 'testapp', 1)
1915.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
1916.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="authorunmanaged", options={"managed": False})
1917. 
1918.     def test_unmanaged_custom_pk(self):
1919.         """
1920.         #23415 - The autodetector must correctly deal with custom FK on
1921.         unmanaged models.
1922.         """
1923.         # First, we test the default pk field name
1924.         changes = self.get_changes([], [self.author_unmanaged_default_pk, self.book])
1925.         # The model the FK on the book model points to.
1926.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1927.         self.assertEqual(fk_field.remote_field.model, 'testapp.Author')
1928.         # Now, we test the custom pk field name
1929.         changes = self.get_changes([], [self.author_unmanaged_custom_pk, self.book])
1930.         # The model the FK on the book model points to.
1931.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1932.         self.assertEqual(fk_field.remote_field.model, 'testapp.Author')
1933. 
1934.     @override_settings(AUTH_USER_MODEL="thirdapp.CustomUser")
1935.     def test_swappable(self):
1936.         with isolate_lru_cache(apps.get_swappable_settings_name):
1937.             changes = self.get_changes([self.custom_user], [self.custom_user, self.author_with_custom_user])
1938.         # Right number/type of migrations?
1939.         self.assertNumberMigrations(changes, 'testapp', 1)
1940.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1941.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1942.         self.assertMigrationDependencies(changes, 'testapp', 0, [("__setting__", "AUTH_USER_MODEL")])
1943. 
1944.     def test_swappable_lowercase(self):
1945.         model_state = ModelState('testapp', 'Document', [
1946.             ('id', models.AutoField(primary_key=True)),
1947.             ('owner', models.ForeignKey(
1948.                 settings.AUTH_USER_MODEL.lower(), models.CASCADE,
1949.             )),
1950.         ])
1951.         with isolate_lru_cache(apps.get_swappable_settings_name):
1952.             changes = self.get_changes([], [model_state])
1953.         self.assertNumberMigrations(changes, 'testapp', 1)
1954.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
1955.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Document')
1956.         self.assertMigrationDependencies(
1957.             changes, 'testapp', 0, [('__setting__', 'AUTH_USER_MODEL')],
1958.         )
1959. 
1960.     def test_swappable_changed(self):
1961.         with isolate_lru_cache(apps.get_swappable_settings_name):
1962.             before = self.make_project_state([self.custom_user, self.author_with_user])
1963.             with override_settings(AUTH_USER_MODEL="thirdapp.CustomUser"):
1964.                 after = self.make_project_state([self.custom_user, self.author_with_custom_user])
1965.             autodetector = MigrationAutodetector(before, after)
1966.             changes = autodetector._detect_changes()
1967.         # Right number/type of migrations?
1968.         self.assertNumberMigrations(changes, 'testapp', 1)
1969.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
1970.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name="author", name='user')
1971.         fk_field = changes['testapp'][0].operations[0].field
1972.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.CustomUser')
1973. 
1974.     def test_add_field_with_default(self):
1975.         """#22030 - Adding a field with a default should work."""
1976.         changes = self.get_changes([self.author_empty], [self.author_name_default])
1977.         # Right number/type of migrations?
1978.         self.assertNumberMigrations(changes, 'testapp', 1)
1979.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
1980.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="name")
1981. 
1982.     def test_custom_deconstructible(self):
1983.         """
1984.         Two instances which deconstruct to the same value aren't considered a
1985.         change.
1986.         """
1987.         changes = self.get_changes([self.author_name_deconstructible_1], [self.author_name_deconstructible_2])
1988.         # Right number of migrations?
1989.         self.assertEqual(len(changes), 0)
1990. 
1991.     def test_deconstruct_field_kwarg(self):
1992.         """Field instances are handled correctly by nested deconstruction."""
1993.         changes = self.get_changes([self.author_name_deconstructible_3], [self.author_name_deconstructible_4])
1994.         self.assertEqual(changes, {})
1995. 
1996.     def test_deconstructible_list(self):
1997.         """Nested deconstruction descends into lists."""
1998.         # When lists contain items that deconstruct to identical values, those lists
1999.         # should be considered equal for the purpose of detecting state changes
2000.         # (even if the original items are unequal).
2001.         changes = self.get_changes(
2002.             [self.author_name_deconstructible_list_1], [self.author_name_deconstructible_list_2]
2003.         )
2004.         self.assertEqual(changes, {})
2005.         # Legitimate differences within the deconstructed lists should be reported
2006.         # as a change
2007.         changes = self.get_changes(
2008.             [self.author_name_deconstructible_list_1], [self.author_name_deconstructible_list_3]
2009.         )
2010.         self.assertEqual(len(changes), 1)
2011. 
2012.     def test_deconstructible_tuple(self):
2013.         """Nested deconstruction descends into tuples."""
2014.         # When tuples contain items that deconstruct to identical values, those tuples
2015.         # should be considered equal for the purpose of detecting state changes
2016.         # (even if the original items are unequal).
2017.         changes = self.get_changes(
2018.             [self.author_name_deconstructible_tuple_1], [self.author_name_deconstructible_tuple_2]
2019.         )
2020.         self.assertEqual(changes, {})
2021.         # Legitimate differences within the deconstructed tuples should be reported
2022.         # as a change
2023.         changes = self.get_changes(
2024.             [self.author_name_deconstructible_tuple_1], [self.author_name_deconstructible_tuple_3]
2025.         )
2026.         self.assertEqual(len(changes), 1)
2027. 
2028.     def test_deconstructible_dict(self):
2029.         """Nested deconstruction descends into dict values."""
2030.         # When dicts contain items whose values deconstruct to identical values,
2031.         # those dicts should be considered equal for the purpose of detecting
2032.         # state changes (even if the original values are unequal).
2033.         changes = self.get_changes(
2034.             [self.author_name_deconstructible_dict_1], [self.author_name_deconstructible_dict_2]
2035.         )
2036.         self.assertEqual(changes, {})
2037.         # Legitimate differences within the deconstructed dicts should be reported
2038.         # as a change
2039.         changes = self.get_changes(
2040.             [self.author_name_deconstructible_dict_1], [self.author_name_deconstructible_dict_3]
2041.         )
2042.         self.assertEqual(len(changes), 1)
2043. 
2044.     def test_nested_deconstructible_objects(self):
2045.         """
2046.         Nested deconstruction is applied recursively to the args/kwargs of
2047.         deconstructed objects.
2048.         """
2049.         # If the items within a deconstructed object's args/kwargs have the same
2050.         # deconstructed values - whether or not the items themselves are different
2051.         # instances - then the object as a whole is regarded as unchanged.
2052.         changes = self.get_changes(
2053.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_2]
2054.         )
2055.         self.assertEqual(changes, {})
2056.         # Differences that exist solely within the args list of a deconstructed object
2057.         # should be reported as changes
2058.         changes = self.get_changes(
2059.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_changed_arg]
2060.         )
2061.         self.assertEqual(len(changes), 1)
2062.         # Additional args should also be reported as a change
2063.         changes = self.get_changes(
2064.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_extra_arg]
2065.         )
2066.         self.assertEqual(len(changes), 1)
2067.         # Differences that exist solely within the kwargs dict of a deconstructed object
2068.         # should be reported as changes
2069.         changes = self.get_changes(
2070.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_changed_kwarg]
2071.         )
2072.         self.assertEqual(len(changes), 1)
2073.         # Additional kwargs should also be reported as a change
2074.         changes = self.get_changes(
2075.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_extra_kwarg]
2076.         )
2077.         self.assertEqual(len(changes), 1)
2078. 
2079.     def test_deconstruct_type(self):
2080.         """
2081.         #22951 -- Uninstantiated classes with deconstruct are correctly returned
2082.         by deep_deconstruct during serialization.
2083.         """
2084.         author = ModelState(
2085.             "testapp",
2086.             "Author",
2087.             [
2088.                 ("id", models.AutoField(primary_key=True)),
2089.                 ("name", models.CharField(
2090.                     max_length=200,
2091.                     # IntegerField intentionally not instantiated.
2092.                     default=models.IntegerField,
2093.                 ))
2094.             ],
2095.         )
2096.         changes = self.get_changes([], [author])
2097.         # Right number/type of migrations?
2098.         self.assertNumberMigrations(changes, 'testapp', 1)
2099.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
2100. 
2101.     def test_replace_string_with_foreignkey(self):
2102.         """
2103.         #22300 - Adding an FK in the same "spot" as a deleted CharField should
2104.         work.
2105.         """
2106.         changes = self.get_changes([self.author_with_publisher_string], [self.author_with_publisher, self.publisher])
2107.         # Right number/type of migrations?
2108.         self.assertNumberMigrations(changes, 'testapp', 1)
2109.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "RemoveField", "AddField"])
2110.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Publisher")
2111.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publisher_name")
2112.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="publisher")
2113. 
2114.     def test_foreign_key_removed_before_target_model(self):
2115.         """
2116.         Removing an FK and the model it targets in the same change must remove
2117.         the FK field before the model to maintain consistency.
2118.         """
2119.         changes = self.get_changes(
2120.             [self.author_with_publisher, self.publisher], [self.author_name]
2121.         )  # removes both the model and FK
2122.         # Right number/type of migrations?
2123.         self.assertNumberMigrations(changes, 'testapp', 1)
2124.         self.assertOperationTypes(changes, 'testapp', 0, ["RemoveField", "DeleteModel"])
2125.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publisher")
2126.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Publisher")
2127. 
2128.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
2129.                 side_effect=AssertionError("Should not have prompted for not null addition"))
2130.     def test_add_many_to_many(self, mocked_ask_method):
2131.         """#22435 - Adding a ManyToManyField should not prompt for a default."""
2132.         changes = self.get_changes([self.author_empty, self.publisher], [self.author_with_m2m, self.publisher])
2133.         # Right number/type of migrations?
2134.         self.assertNumberMigrations(changes, 'testapp', 1)
2135.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
2136.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers")
2137. 
2138.     def test_alter_many_to_many(self):
2139.         changes = self.get_changes(
2140.             [self.author_with_m2m, self.publisher], [self.author_with_m2m_blank, self.publisher]
2141.         )
2142.         # Right number/type of migrations?
2143.         self.assertNumberMigrations(changes, 'testapp', 1)
2144.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
2145.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers")
2146. 
2147.     def test_create_with_through_model(self):
2148.         """
2149.         Adding a m2m with a through model and the models that use it should be
2150.         ordered correctly.
2151.         """
2152.         changes = self.get_changes([], [self.author_with_m2m_through, self.publisher, self.contract])
2153.         # Right number/type of migrations?
2154.         self.assertNumberMigrations(changes, "testapp", 1)
2155.         self.assertOperationTypes(changes, "testapp", 0, [
2156.             'CreateModel', 'CreateModel', 'CreateModel', 'AddField',
2157.         ])
2158.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Author')
2159.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name='Publisher')
2160.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name='Contract')
2161.         self.assertOperationAttributes(changes, 'testapp', 0, 3, model_name='author', name='publishers')
2162. 
2163.     def test_many_to_many_removed_before_through_model(self):
2164.         """
2165.         Removing a ManyToManyField and the "through" model in the same change
2166.         must remove the field before the model to maintain consistency.
2167.         """
2168.         changes = self.get_changes(
2169.             [self.book_with_multiple_authors_through_attribution, self.author_name, self.attribution],
2170.             [self.book_with_no_author, self.author_name],
2171.         )
2172.         # Remove both the through model and ManyToMany
2173.         # Right number/type of migrations?
2174.         self.assertNumberMigrations(changes, "otherapp", 1)
2175.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveField', 'DeleteModel'])
2176.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='authors', model_name='book')
2177.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, name='Attribution')
2178. 
2179.     def test_many_to_many_removed_before_through_model_2(self):
2180.         """
2181.         Removing a model that contains a ManyToManyField and the "through" model
2182.         in the same change must remove the field before the model to maintain
2183.         consistency.
2184.         """
2185.         changes = self.get_changes(
2186.             [self.book_with_multiple_authors_through_attribution, self.author_name, self.attribution],
2187.             [self.author_name],
2188.         )
2189.         # Remove both the through model and ManyToMany
2190.         # Right number/type of migrations?
2191.         self.assertNumberMigrations(changes, "otherapp", 1)
2192.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveField', 'DeleteModel', 'DeleteModel'])
2193.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='authors', model_name='book')
2194.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, name='Attribution')
2195.         self.assertOperationAttributes(changes, 'otherapp', 0, 2, name='Book')
2196. 
2197.     def test_m2m_w_through_multistep_remove(self):
2198.         """
2199.         A model with a m2m field that specifies a "through" model cannot be
2200.         removed in the same migration as that through model as the schema will
2201.         pass through an inconsistent state. The autodetector should produce two
2202.         migrations to avoid this issue.
2203.         """
2204.         changes = self.get_changes([self.author_with_m2m_through, self.publisher, self.contract], [self.publisher])
2205.         # Right number/type of migrations?
2206.         self.assertNumberMigrations(changes, "testapp", 1)
2207.         self.assertOperationTypes(changes, "testapp", 0, [
2208.             "RemoveField", "RemoveField", "DeleteModel", "DeleteModel"
2209.         ])
2210.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", model_name='contract')
2211.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="publisher", model_name='contract')
2212.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="Author")
2213.         self.assertOperationAttributes(changes, "testapp", 0, 3, name="Contract")
2214. 
2215.     def test_concrete_field_changed_to_many_to_many(self):
2216.         """
2217.         #23938 - Changing a concrete field into a ManyToManyField
2218.         first removes the concrete field and then adds the m2m field.
2219.         """
2220.         changes = self.get_changes([self.author_with_former_m2m], [self.author_with_m2m, self.publisher])
2221.         # Right number/type of migrations?
2222.         self.assertNumberMigrations(changes, "testapp", 1)
2223.         self.assertOperationTypes(changes, "testapp", 0, ["CreateModel", "RemoveField", "AddField"])
2224.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Publisher')
2225.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publishers", model_name='author')
2226.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="publishers", model_name='author')
2227. 
2228.     def test_many_to_many_changed_to_concrete_field(self):
2229.         """
2230.         #23938 - Changing a ManyToManyField into a concrete field
2231.         first removes the m2m field and then adds the concrete field.
2232.         """
2233.         changes = self.get_changes([self.author_with_m2m, self.publisher], [self.author_with_former_m2m])
2234.         # Right number/type of migrations?
2235.         self.assertNumberMigrations(changes, "testapp", 1)
2236.         self.assertOperationTypes(changes, "testapp", 0, ["RemoveField", "AddField", "DeleteModel"])
2237.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers", model_name='author')
2238.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publishers", model_name='author')
2239.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name='Publisher')
2240.         self.assertOperationFieldAttributes(changes, 'testapp', 0, 1, max_length=100)
2241. 
2242.     def test_non_circular_foreignkey_dependency_removal(self):
2243.         """
2244.         If two models with a ForeignKey from one to the other are removed at the
2245.         same time, the autodetector should remove them in the correct order.
2246.         """
2247.         changes = self.get_changes([self.author_with_publisher, self.publisher_with_author], [])
2248.         # Right number/type of migrations?
2249.         self.assertNumberMigrations(changes, "testapp", 1)
2250.         self.assertOperationTypes(changes, "testapp", 0, ["RemoveField", "DeleteModel", "DeleteModel"])
2251.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", model_name='publisher')
2252.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
2253.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="Publisher")
2254. 
2255.     def test_alter_model_options(self):
2256.         """Changing a model's options should make a change."""
2257.         changes = self.get_changes([self.author_empty], [self.author_with_options])
2258.         # Right number/type of migrations?
2259.         self.assertNumberMigrations(changes, "testapp", 1)
2260.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2261.         self.assertOperationAttributes(changes, "testapp", 0, 0, options={
2262.             "permissions": [('can_hire', 'Can hire')],
2263.             "verbose_name": "Authi",
2264.         })
2265. 
2266.         # Changing them back to empty should also make a change
2267.         changes = self.get_changes([self.author_with_options], [self.author_empty])
2268.         # Right number/type of migrations?
2269.         self.assertNumberMigrations(changes, "testapp", 1)
2270.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2271.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", options={})
2272. 
2273.     def test_alter_model_options_proxy(self):
2274.         """Changing a proxy model's options should also make a change."""
2275.         changes = self.get_changes(
2276.             [self.author_proxy, self.author_empty], [self.author_proxy_options, self.author_empty]
2277.         )
2278.         # Right number/type of migrations?
2279.         self.assertNumberMigrations(changes, "testapp", 1)
2280.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2281.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="authorproxy", options={
2282.             "verbose_name": "Super Author"
2283.         })
2284. 
2285.     def test_set_alter_order_with_respect_to(self):
2286.         """Setting order_with_respect_to adds a field."""
2287.         changes = self.get_changes([self.book, self.author_with_book], [self.book, self.author_with_book_order_wrt])
2288.         # Right number/type of migrations?
2289.         self.assertNumberMigrations(changes, 'testapp', 1)
2290.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterOrderWithRespectTo"])
2291.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="author", order_with_respect_to="book")
2292. 
2293.     def test_add_alter_order_with_respect_to(self):
2294.         """
2295.         Setting order_with_respect_to when adding the FK too does
2296.         things in the right order.
2297.         """
2298.         changes = self.get_changes([self.author_name], [self.book, self.author_with_book_order_wrt])
2299.         # Right number/type of migrations?
2300.         self.assertNumberMigrations(changes, 'testapp', 1)
2301.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AlterOrderWithRespectTo"])
2302.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name="author", name="book")
2303.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="author", order_with_respect_to="book")
2304. 
2305.     def test_remove_alter_order_with_respect_to(self):
2306.         """
2307.         Removing order_with_respect_to when removing the FK too does
2308.         things in the right order.
2309.         """
2310.         changes = self.get_changes([self.book, self.author_with_book_order_wrt], [self.author_name])
2311.         # Right number/type of migrations?
2312.         self.assertNumberMigrations(changes, 'testapp', 1)
2313.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterOrderWithRespectTo", "RemoveField"])
2314.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="author", order_with_respect_to=None)
2315.         self.assertOperationAttributes(changes, 'testapp', 0, 1, model_name="author", name="book")
2316. 
2317.     def test_add_model_order_with_respect_to(self):
2318.         """
2319.         Setting order_with_respect_to when adding the whole model
2320.         does things in the right order.
2321.         """
2322.         changes = self.get_changes([], [self.book, self.author_with_book_order_wrt])
2323.         # Right number/type of migrations?
2324.         self.assertNumberMigrations(changes, 'testapp', 1)
2325.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
2326.         self.assertOperationAttributes(
2327.             changes, 'testapp', 0, 0, name="Author", options={'order_with_respect_to': 'book'}
2328.         )
2329.         self.assertNotIn("_order", [name for name, field in changes['testapp'][0].operations[0].fields])
2330. 
2331.     def test_add_model_order_with_respect_to_index_foo_together(self):
2332.         changes = self.get_changes([], [
2333.             self.book,
2334.             ModelState('testapp', 'Author', [
2335.                 ('id', models.AutoField(primary_key=True)),
2336.                 ('name', models.CharField(max_length=200)),
2337.                 ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2338.             ], options={
2339.                 'order_with_respect_to': 'book',
2340.                 'index_together': {('name', '_order')},
2341.                 'unique_together': {('id', '_order')},
2342.             }),
2343.         ])
2344.         self.assertNumberMigrations(changes, 'testapp', 1)
2345.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
2346.         self.assertOperationAttributes(
2347.             changes,
2348.             'testapp',
2349.             0,
2350.             0,
2351.             name='Author',
2352.             options={
2353.                 'order_with_respect_to': 'book',
2354.                 'index_together': {('name', '_order')},
2355.                 'unique_together': {('id', '_order')},
2356.             },
2357.         )
2358. 
2359.     def test_add_model_order_with_respect_to_index_constraint(self):
2360.         tests = [
2361.             (
2362.                 'AddIndex',
2363.                 {'indexes': [
2364.                     models.Index(fields=['_order'], name='book_order_idx'),
2365.                 ]},
2366.             ),
2367.             (
2368.                 'AddConstraint',
2369.                 {'constraints': [
2370.                     models.CheckConstraint(
2371.                         check=models.Q(_order__gt=1),
2372.                         name='book_order_gt_1',
2373.                     ),
2374.                 ]},
2375.             ),
2376.         ]
2377.         for operation, extra_option in tests:
2378.             with self.subTest(operation=operation):
2379.                 after = ModelState('testapp', 'Author', [
2380.                     ('id', models.AutoField(primary_key=True)),
2381.                     ('name', models.CharField(max_length=200)),
2382.                     ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2383.                 ], options={
2384.                     'order_with_respect_to': 'book',
2385.                     **extra_option,
2386.                 })
2387.                 changes = self.get_changes([], [self.book, after])
2388.                 self.assertNumberMigrations(changes, 'testapp', 1)
2389.                 self.assertOperationTypes(changes, 'testapp', 0, [
2390.                     'CreateModel', operation,
2391.                 ])
2392.                 self.assertOperationAttributes(
2393.                     changes,
2394.                     'testapp',
2395.                     0,
2396.                     0,
2397.                     name='Author',
2398.                     options={'order_with_respect_to': 'book'},
2399.                 )
2400. 
2401.     def test_set_alter_order_with_respect_to_index_constraint_foo_together(self):
2402.         tests = [
2403.             (
2404.                 'AddIndex',
2405.                 {'indexes': [
2406.                     models.Index(fields=['_order'], name='book_order_idx'),
2407.                 ]},
2408.             ),
2409.             (
2410.                 'AddConstraint',
2411.                 {'constraints': [
2412.                     models.CheckConstraint(
2413.                         check=models.Q(_order__gt=1),
2414.                         name='book_order_gt_1',
2415.                     ),
2416.                 ]},
2417.             ),
2418.             ('AlterIndexTogether', {'index_together': {('name', '_order')}}),
2419.             ('AlterUniqueTogether', {'unique_together': {('id', '_order')}}),
2420.         ]
2421.         for operation, extra_option in tests:
2422.             with self.subTest(operation=operation):
2423.                 after = ModelState('testapp', 'Author', [
2424.                     ('id', models.AutoField(primary_key=True)),
2425.                     ('name', models.CharField(max_length=200)),
2426.                     ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2427.                 ], options={
2428.                     'order_with_respect_to': 'book',
2429.                     **extra_option,
2430.                 })
2431.                 changes = self.get_changes(
2432.                     [self.book, self.author_with_book],
2433.                     [self.book, after],
2434.                 )
2435.                 self.assertNumberMigrations(changes, 'testapp', 1)
2436.                 self.assertOperationTypes(changes, 'testapp', 0, [
2437.                     'AlterOrderWithRespectTo', operation,
2438.                 ])
2439. 
2440.     def test_alter_model_managers(self):
2441.         """
2442.         Changing the model managers adds a new operation.
2443.         """
2444.         changes = self.get_changes([self.other_pony], [self.other_pony_food])
2445.         # Right number/type of migrations?
2446.         self.assertNumberMigrations(changes, 'otherapp', 1)
2447.         self.assertOperationTypes(changes, 'otherapp', 0, ["AlterModelManagers"])
2448.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="pony")
2449.         self.assertEqual([name for name, mgr in changes['otherapp'][0].operations[0].managers],
2450.                          ['food_qs', 'food_mgr', 'food_mgr_kwargs'])
2451.         self.assertEqual(changes['otherapp'][0].operations[0].managers[1][1].args, ('a', 'b', 1, 2))
2452.         self.assertEqual(changes['otherapp'][0].operations[0].managers[2][1].args, ('x', 'y', 3, 4))
2453. 
2454.     def test_swappable_first_inheritance(self):
2455.         """Swappable models get their CreateModel first."""
2456.         changes = self.get_changes([], [self.custom_user, self.aardvark])
2457.         # Right number/type of migrations?
2458.         self.assertNumberMigrations(changes, 'thirdapp', 1)
2459.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel", "CreateModel"])
2460.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="CustomUser")
2461.         self.assertOperationAttributes(changes, 'thirdapp', 0, 1, name="Aardvark")
2462. 
2463.     def test_default_related_name_option(self):
2464.         model_state = ModelState('app', 'model', [
2465.             ('id', models.AutoField(primary_key=True)),
2466.         ], options={'default_related_name': 'related_name'})
2467.         changes = self.get_changes([], [model_state])
2468.         self.assertNumberMigrations(changes, 'app', 1)
2469.         self.assertOperationTypes(changes, 'app', 0, ['CreateModel'])
2470.         self.assertOperationAttributes(
2471.             changes, 'app', 0, 0, name='model',
2472.             options={'default_related_name': 'related_name'},
2473.         )
2474.         altered_model_state = ModelState('app', 'Model', [
2475.             ('id', models.AutoField(primary_key=True)),
2476.         ])
2477.         changes = self.get_changes([model_state], [altered_model_state])
2478.         self.assertNumberMigrations(changes, 'app', 1)
2479.         self.assertOperationTypes(changes, 'app', 0, ['AlterModelOptions'])
2480.         self.assertOperationAttributes(changes, 'app', 0, 0, name='model', options={})
2481. 
2482.     @override_settings(AUTH_USER_MODEL="thirdapp.CustomUser")
2483.     def test_swappable_first_setting(self):
2484.         """Swappable models get their CreateModel first."""
2485.         with isolate_lru_cache(apps.get_swappable_settings_name):
2486.             changes = self.get_changes([], [self.custom_user_no_inherit, self.aardvark])
2487.         # Right number/type of migrations?
2488.         self.assertNumberMigrations(changes, 'thirdapp', 1)
2489.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel", "CreateModel"])
2490.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="CustomUser")
2491.         self.assertOperationAttributes(changes, 'thirdapp', 0, 1, name="Aardvark")
2492. 
2493.     def test_bases_first(self):
2494.         """Bases of other models come first."""
2495.         changes = self.get_changes([], [self.aardvark_based_on_author, self.author_name])
2496.         # Right number/type of migrations?
2497.         self.assertNumberMigrations(changes, 'testapp', 1)
2498.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
2499.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2500.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Aardvark")
2501. 
2502.     def test_bases_first_mixed_case_app_label(self):
2503.         app_label = 'MiXedCaseApp'
2504.         changes = self.get_changes([], [
2505.             ModelState(app_label, 'owner', [
2506.                 ('id', models.AutoField(primary_key=True)),
2507.             ]),
2508.             ModelState(app_label, 'place', [
2509.                 ('id', models.AutoField(primary_key=True)),
2510.                 ('owner', models.ForeignKey('MiXedCaseApp.owner', models.CASCADE)),
2511.             ]),
2512.             ModelState(app_label, 'restaurant', [], bases=('MiXedCaseApp.place',)),
2513.         ])
2514.         self.assertNumberMigrations(changes, app_label, 1)
2515.         self.assertOperationTypes(changes, app_label, 0, [
2516.             'CreateModel', 'CreateModel', 'CreateModel',
2517.         ])
2518.         self.assertOperationAttributes(changes, app_label, 0, 0, name='owner')
2519.         self.assertOperationAttributes(changes, app_label, 0, 1, name='place')
2520.         self.assertOperationAttributes(changes, app_label, 0, 2, name='restaurant')
2521. 
2522.     def test_multiple_bases(self):
2523.         """#23956 - Inheriting models doesn't move *_ptr fields into AddField operations."""
2524.         A = ModelState("app", "A", [("a_id", models.AutoField(primary_key=True))])
2525.         B = ModelState("app", "B", [("b_id", models.AutoField(primary_key=True))])
2526.         C = ModelState("app", "C", [], bases=("app.A", "app.B"))
2527.         D = ModelState("app", "D", [], bases=("app.A", "app.B"))
2528.         E = ModelState("app", "E", [], bases=("app.A", "app.B"))
2529.         changes = self.get_changes([], [A, B, C, D, E])
2530.         # Right number/type of migrations?
2531.         self.assertNumberMigrations(changes, "app", 1)
2532.         self.assertOperationTypes(changes, "app", 0, [
2533.             "CreateModel", "CreateModel", "CreateModel", "CreateModel", "CreateModel"
2534.         ])
2535.         self.assertOperationAttributes(changes, "app", 0, 0, name="A")
2536.         self.assertOperationAttributes(changes, "app", 0, 1, name="B")
2537.         self.assertOperationAttributes(changes, "app", 0, 2, name="C")
2538.         self.assertOperationAttributes(changes, "app", 0, 3, name="D")
2539.         self.assertOperationAttributes(changes, "app", 0, 4, name="E")
2540. 
2541.     def test_proxy_bases_first(self):
2542.         """Bases of proxies come first."""
2543.         changes = self.get_changes([], [self.author_empty, self.author_proxy, self.author_proxy_proxy])
2544.         # Right number/type of migrations?
2545.         self.assertNumberMigrations(changes, 'testapp', 1)
2546.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel", "CreateModel"])
2547.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2548.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="AuthorProxy")
2549.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="AAuthorProxyProxy")
2550. 
2551.     def test_pk_fk_included(self):
2552.         """
2553.         A relation used as the primary key is kept as part of CreateModel.
2554.         """
2555.         changes = self.get_changes([], [self.aardvark_pk_fk_author, self.author_name])
2556.         # Right number/type of migrations?
2557.         self.assertNumberMigrations(changes, 'testapp', 1)
2558.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
2559.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2560.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Aardvark")
2561. 
2562.     def test_first_dependency(self):
2563.         """
2564.         A dependency to an app with no migrations uses __first__.
2565.         """
2566.         # Load graph
2567.         loader = MigrationLoader(connection)
2568.         before = self.make_project_state([])
2569.         after = self.make_project_state([self.book_migrations_fk])
2570.         after.real_apps = {'migrations'}
2571.         autodetector = MigrationAutodetector(before, after)
2572.         changes = autodetector._detect_changes(graph=loader.graph)
2573.         # Right number/type of migrations?
2574.         self.assertNumberMigrations(changes, 'otherapp', 1)
2575.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
2576.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
2577.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("migrations", "__first__")])
2578. 
2579.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
2580.     def test_last_dependency(self):
2581.         """
2582.         A dependency to an app with existing migrations uses the
2583.         last migration of that app.
2584.         """
2585.         # Load graph
2586.         loader = MigrationLoader(connection)
2587.         before = self.make_project_state([])
2588.         after = self.make_project_state([self.book_migrations_fk])
2589.         after.real_apps = {'migrations'}
2590.         autodetector = MigrationAutodetector(before, after)
2591.         changes = autodetector._detect_changes(graph=loader.graph)
2592.         # Right number/type of migrations?
2593.         self.assertNumberMigrations(changes, 'otherapp', 1)
2594.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
2595.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
2596.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("migrations", "0002_second")])
2597. 
2598.     def test_alter_fk_before_model_deletion(self):
2599.         """
2600.         ForeignKeys are altered _before_ the model they used to
2601.         refer to are deleted.
2602.         """
2603.         changes = self.get_changes(
2604.             [self.author_name, self.publisher_with_author],
2605.             [self.aardvark_testapp, self.publisher_with_aardvark_author]
2606.         )
2607.         # Right number/type of migrations?
2608.         self.assertNumberMigrations(changes, 'testapp', 1)
2609.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "AlterField", "DeleteModel"])
2610.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Aardvark")
2611.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="author")
2612.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="Author")
2613. 
2614.     def test_fk_dependency_other_app(self):
2615.         """
2616.         #23100 - ForeignKeys correctly depend on other apps' models.
2617.         """
2618.         changes = self.get_changes([self.author_name, self.book], [self.author_with_book, self.book])
2619.         # Right number/type of migrations?
2620.         self.assertNumberMigrations(changes, 'testapp', 1)
2621.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
2622.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="book")
2623.         self.assertMigrationDependencies(changes, 'testapp', 0, [("otherapp", "__first__")])
2624. 
2625.     def test_alter_field_to_fk_dependency_other_app(self):
2626.         changes = self.get_changes(
2627.             [self.author_empty, self.book_with_no_author_fk],
2628.             [self.author_empty, self.book],
2629.         )
2630.         self.assertNumberMigrations(changes, 'otherapp', 1)
2631.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
2632.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('testapp', '__first__')])
2633. 
2634.     def test_circular_dependency_mixed_addcreate(self):
2635.         """
2636.         #23315 - The dependency resolver knows to put all CreateModel
2637.         before AddField and not become unsolvable.
2638.         """
2639.         address = ModelState("a", "Address", [
2640.             ("id", models.AutoField(primary_key=True)),
2641.             ("country", models.ForeignKey("b.DeliveryCountry", models.CASCADE)),
2642.         ])
2643.         person = ModelState("a", "Person", [
2644.             ("id", models.AutoField(primary_key=True)),
2645.         ])
2646.         apackage = ModelState("b", "APackage", [
2647.             ("id", models.AutoField(primary_key=True)),
2648.             ("person", models.ForeignKey("a.Person", models.CASCADE)),
2649.         ])
2650.         country = ModelState("b", "DeliveryCountry", [
2651.             ("id", models.AutoField(primary_key=True)),
2652.         ])
2653.         changes = self.get_changes([], [address, person, apackage, country])
2654.         # Right number/type of migrations?
2655.         self.assertNumberMigrations(changes, 'a', 2)
2656.         self.assertNumberMigrations(changes, 'b', 1)
2657.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel", "CreateModel"])
2658.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2659.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel", "CreateModel"])
2660. 
2661.     @override_settings(AUTH_USER_MODEL="a.Tenant")
2662.     def test_circular_dependency_swappable(self):
2663.         """
2664.         #23322 - The dependency resolver knows to explicitly resolve
2665.         swappable models.
2666.         """
2667.         with isolate_lru_cache(apps.get_swappable_settings_name):
2668.             tenant = ModelState("a", "Tenant", [
2669.                 ("id", models.AutoField(primary_key=True)),
2670.                 ("primary_address", models.ForeignKey("b.Address", models.CASCADE))],
2671.                 bases=(AbstractBaseUser,)
2672.             )
2673.             address = ModelState("b", "Address", [
2674.                 ("id", models.AutoField(primary_key=True)),
2675.                 ("tenant", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE)),
2676.             ])
2677.             changes = self.get_changes([], [address, tenant])
2678. 
2679.         # Right number/type of migrations?
2680.         self.assertNumberMigrations(changes, 'a', 2)
2681.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2682.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2683.         self.assertMigrationDependencies(changes, 'a', 0, [])
2684.         self.assertMigrationDependencies(changes, 'a', 1, [('a', 'auto_1'), ('b', 'auto_1')])
2685.         # Right number/type of migrations?
2686.         self.assertNumberMigrations(changes, 'b', 1)
2687.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel"])
2688.         self.assertMigrationDependencies(changes, 'b', 0, [('__setting__', 'AUTH_USER_MODEL')])
2689. 
2690.     @override_settings(AUTH_USER_MODEL="b.Tenant")
2691.     def test_circular_dependency_swappable2(self):
2692.         """
2693.         #23322 - The dependency resolver knows to explicitly resolve
2694.         swappable models but with the swappable not being the first migrated
2695.         model.
2696.         """
2697.         with isolate_lru_cache(apps.get_swappable_settings_name):
2698.             address = ModelState("a", "Address", [
2699.                 ("id", models.AutoField(primary_key=True)),
2700.                 ("tenant", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE)),
2701.             ])
2702.             tenant = ModelState("b", "Tenant", [
2703.                 ("id", models.AutoField(primary_key=True)),
2704.                 ("primary_address", models.ForeignKey("a.Address", models.CASCADE))],
2705.                 bases=(AbstractBaseUser,)
2706.             )
2707.             changes = self.get_changes([], [address, tenant])
2708.         # Right number/type of migrations?
2709.         self.assertNumberMigrations(changes, 'a', 2)
2710.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2711.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2712.         self.assertMigrationDependencies(changes, 'a', 0, [])
2713.         self.assertMigrationDependencies(changes, 'a', 1, [('__setting__', 'AUTH_USER_MODEL'), ('a', 'auto_1')])
2714.         # Right number/type of migrations?
2715.         self.assertNumberMigrations(changes, 'b', 1)
2716.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel"])
2717.         self.assertMigrationDependencies(changes, 'b', 0, [('a', 'auto_1')])
2718. 
2719.     @override_settings(AUTH_USER_MODEL="a.Person")
2720.     def test_circular_dependency_swappable_self(self):
2721.         """
2722.         #23322 - The dependency resolver knows to explicitly resolve
2723.         swappable models.
2724.         """
2725.         with isolate_lru_cache(apps.get_swappable_settings_name):
2726.             person = ModelState("a", "Person", [
2727.                 ("id", models.AutoField(primary_key=True)),
2728.                 ("parent1", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE, related_name='children'))
2729.             ])
2730.             changes = self.get_changes([], [person])
2731.         # Right number/type of migrations?
2732.         self.assertNumberMigrations(changes, 'a', 1)
2733.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2734.         self.assertMigrationDependencies(changes, 'a', 0, [])
2735. 
2736.     @override_settings(AUTH_USER_MODEL='a.User')
2737.     def test_swappable_circular_multi_mti(self):
2738.         with isolate_lru_cache(apps.get_swappable_settings_name):
2739.             parent = ModelState('a', 'Parent', [
2740.                 ('user', models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE))
2741.             ])
2742.             child = ModelState('a', 'Child', [], bases=('a.Parent',))
2743.             user = ModelState('a', 'User', [], bases=(AbstractBaseUser, 'a.Child'))
2744.             changes = self.get_changes([], [parent, child, user])
2745.         self.assertNumberMigrations(changes, 'a', 1)
2746.         self.assertOperationTypes(changes, 'a', 0, ['CreateModel', 'CreateModel', 'CreateModel', 'AddField'])
2747. 
2748.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
2749.                 side_effect=AssertionError("Should not have prompted for not null addition"))
2750.     def test_add_blank_textfield_and_charfield(self, mocked_ask_method):
2751.         """
2752.         #23405 - Adding a NOT NULL and blank `CharField` or `TextField`
2753.         without default should not prompt for a default.
2754.         """
2755.         changes = self.get_changes([self.author_empty], [self.author_with_biography_blank])
2756.         # Right number/type of migrations?
2757.         self.assertNumberMigrations(changes, 'testapp', 1)
2758.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField"])
2759.         self.assertOperationAttributes(changes, 'testapp', 0, 0)
2760. 
2761.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition')
2762.     def test_add_non_blank_textfield_and_charfield(self, mocked_ask_method):
2763.         """
2764.         #23405 - Adding a NOT NULL and non-blank `CharField` or `TextField`
2765.         without default should prompt for a default.
2766.         """
2767.         changes = self.get_changes([self.author_empty], [self.author_with_biography_non_blank])
2768.         self.assertEqual(mocked_ask_method.call_count, 2)
2769.         # Right number/type of migrations?
2770.         self.assertNumberMigrations(changes, 'testapp', 1)
2771.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField"])
2772.         self.assertOperationAttributes(changes, 'testapp', 0, 0)
2773. 
2774.     def test_mti_inheritance_model_removal(self):
2775.         Animal = ModelState('app', 'Animal', [
2776.             ("id", models.AutoField(primary_key=True)),
2777.         ])
2778.         Dog = ModelState('app', 'Dog', [], bases=('app.Animal',))
2779.         changes = self.get_changes([Animal, Dog], [Animal])
2780.         self.assertNumberMigrations(changes, 'app', 1)
2781.         self.assertOperationTypes(changes, 'app', 0, ['DeleteModel'])
2782.         self.assertOperationAttributes(changes, 'app', 0, 0, name='Dog')
2783. 
2784.     def test_add_model_with_field_removed_from_base_model(self):
2785.         """
2786.         Removing a base field takes place before adding a new inherited model
2787.         that has a field with the same name.
2788.         """
2789.         before = [
2790.             ModelState('app', 'readable', [
2791.                 ('id', models.AutoField(primary_key=True)),
2792.                 ('title', models.CharField(max_length=200)),
2793.             ]),
2794.         ]
2795.         after = [
2796.             ModelState('app', 'readable', [
2797.                 ('id', models.AutoField(primary_key=True)),
2798.             ]),
2799.             ModelState('app', 'book', [
2800.                 ('title', models.CharField(max_length=200)),
2801.             ], bases=('app.readable',)),
2802.         ]
2803.         changes = self.get_changes(before, after)
2804.         self.assertNumberMigrations(changes, 'app', 1)
2805.         self.assertOperationTypes(changes, 'app', 0, ['RemoveField', 'CreateModel'])
2806.         self.assertOperationAttributes(changes, 'app', 0, 0, name='title', model_name='readable')
2807.         self.assertOperationAttributes(changes, 'app', 0, 1, name='book')
2808. 
2809.     def test_parse_number(self):
2810.         tests = [
2811.             ('no_number', None),
2812.             ('0001_initial', 1),
2813.             ('0002_model3', 2),
2814.             ('0002_auto_20380101_1112', 2),
2815.             ('0002_squashed_0003', 3),
2816.             ('0002_model2_squashed_0003_other4', 3),
2817.             ('0002_squashed_0003_squashed_0004', 4),
2818.             ('0002_model2_squashed_0003_other4_squashed_0005_other6', 5),
2819.             ('0002_custom_name_20380101_1112_squashed_0003_model', 3),
2820.             ('2_squashed_4', 4),
2821.         ]
2822.         for migration_name, expected_number in tests:
2823.             with self.subTest(migration_name=migration_name):
2824.                 self.assertEqual(
2825.                     MigrationAutodetector.parse_number(migration_name),
2826.                     expected_number,
2827.                 )
2828. 
2829.     def test_add_custom_fk_with_hardcoded_to(self):
2830.         class HardcodedForeignKey(models.ForeignKey):
2831.             def __init__(self, *args, **kwargs):
2832.                 kwargs['to'] = 'testapp.Author'
2833.                 super().__init__(*args, **kwargs)
2834. 
2835.             def deconstruct(self):
2836.                 name, path, args, kwargs = super().deconstruct()
2837.                 del kwargs['to']
2838.                 return name, path, args, kwargs
2839. 
2840.         book_hardcoded_fk_to = ModelState('testapp', 'Book', [
2841.             ('author', HardcodedForeignKey(on_delete=models.CASCADE)),
2842.         ])
2843.         changes = self.get_changes(
2844.             [self.author_empty],
2845.             [self.author_empty, book_hardcoded_fk_to],
2846.         )
2847.         self.assertNumberMigrations(changes, 'testapp', 1)
2848.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
2849.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Book')
2850. 
2851. 
2852. class MigrationSuggestNameTests(SimpleTestCase):
2853.     def test_no_operations(self):
2854.         class Migration(migrations.Migration):
2855.             operations = []
2856. 
2857.         migration = Migration('some_migration', 'test_app')
2858.         self.assertIs(migration.suggest_name().startswith('auto_'), True)
2859. 
2860.     def test_no_operations_initial(self):
2861.         class Migration(migrations.Migration):
2862.             initial = True
2863.             operations = []
2864. 
2865.         migration = Migration('some_migration', 'test_app')
2866.         self.assertEqual(migration.suggest_name(), 'initial')
2867. 
2868.     def test_single_operation(self):
2869.         class Migration(migrations.Migration):
2870.             operations = [migrations.CreateModel('Person', fields=[])]
2871. 
2872.         migration = Migration('0001_initial', 'test_app')
2873.         self.assertEqual(migration.suggest_name(), 'person')
2874. 
2875.         class Migration(migrations.Migration):
2876.             operations = [migrations.DeleteModel('Person')]
2877. 
2878.         migration = Migration('0002_initial', 'test_app')
2879.         self.assertEqual(migration.suggest_name(), 'delete_person')
2880. 
2881.     def test_single_operation_long_name(self):
2882.         class Migration(migrations.Migration):
2883.             operations = [migrations.CreateModel('A' * 53, fields=[])]
2884. 
2885.         migration = Migration('some_migration', 'test_app')
2886.         self.assertEqual(migration.suggest_name(), 'a' * 53)
2887. 
2888.     def test_two_operations(self):
2889.         class Migration(migrations.Migration):
2890.             operations = [
2891.                 migrations.CreateModel('Person', fields=[]),
2892.                 migrations.DeleteModel('Animal'),
2893.             ]
2894. 
2895.         migration = Migration('some_migration', 'test_app')
2896.         self.assertEqual(migration.suggest_name(), 'person_delete_animal')
2897. 
2898.     def test_two_create_models(self):
2899.         class Migration(migrations.Migration):
2900.             operations = [
2901.                 migrations.CreateModel('Person', fields=[]),
2902.                 migrations.CreateModel('Animal', fields=[]),
2903.             ]
2904. 
2905.         migration = Migration('0001_initial', 'test_app')
2906.         self.assertEqual(migration.suggest_name(), 'person_animal')
2907. 
2908.     def test_two_create_models_with_initial_true(self):
2909.         class Migration(migrations.Migration):
2910.             initial = True
2911.             operations = [
2912.                 migrations.CreateModel('Person', fields=[]),
2913.                 migrations.CreateModel('Animal', fields=[]),
2914.             ]
2915. 
2916.         migration = Migration('0001_initial', 'test_app')
2917.         self.assertEqual(migration.suggest_name(), 'initial')
2918. 
2919.     def test_many_operations_suffix(self):
2920.         class Migration(migrations.Migration):
2921.             operations = [
2922.                 migrations.CreateModel('Person1', fields=[]),
2923.                 migrations.CreateModel('Person2', fields=[]),
2924.                 migrations.CreateModel('Person3', fields=[]),
2925.                 migrations.DeleteModel('Person4'),
2926.                 migrations.DeleteModel('Person5'),
2927.             ]
2928. 
2929.         migration = Migration('some_migration', 'test_app')
2930.         self.assertEqual(
2931.             migration.suggest_name(),
2932.             'person1_person2_person3_delete_person4_and_more',
2933.         )
2934. 
2935.     def test_operation_with_no_suggested_name(self):
2936.         class Migration(migrations.Migration):
2937.             operations = [
2938.                 migrations.CreateModel('Person', fields=[]),
2939.                 migrations.RunSQL('SELECT 1 FROM person;'),
2940.             ]
2941. 
2942.         migration = Migration('some_migration', 'test_app')
2943.         self.assertIs(migration.suggest_name().startswith('auto_'), True)
2944. 
2945.     def test_none_name(self):
2946.         class Migration(migrations.Migration):
2947.             operations = [migrations.RunSQL('SELECT 1 FROM person;')]
2948. 
2949.         migration = Migration('0001_initial', 'test_app')
2950.         suggest_name = migration.suggest_name()
2951.         self.assertIs(suggest_name.startswith('auto_'), True)
2952. 
2953.     def test_none_name_with_initial_true(self):
2954.         class Migration(migrations.Migration):
2955.             initial = True
2956.             operations = [migrations.RunSQL('SELECT 1 FROM person;')]
2957. 
2958.         migration = Migration('0001_initial', 'test_app')
2959.         self.assertEqual(migration.suggest_name(), 'initial')
2960. 
2961.     def test_auto(self):
2962.         migration = migrations.Migration('0001_initial', 'test_app')
2963.         suggest_name = migration.suggest_name()
2964.         self.assertIs(suggest_name.startswith('auto_'), True)

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-22 23:50:47,205 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases related to the deconstruction of Django expression classes in migrations. The provided patch simplifies the deconstruction path of classes like `Func`, `Value`, `F`, and `ExpressionWrapper`. The current context from `tests/migrations/test_autodetector.py` is useful as it shows how `Q` objects are tested in `CheckConstraint`, but it does not contain tests for the specific expression classes from the patch. To find relevant tests, I need to look into files that test the serialization of migration operations, as this is where deconstruction paths are used. `tests/migrations/test_writer.py` is the most likely place to find tests that verify the string representation of deconstructed objects in migration files.' query='Please provide the full content of `tests/migrations/test_writer.py`.' extra_requirements='' purpose="I need this file to find test cases that check the serialized output of deconstructed expression objects in migration files, which is directly related to the user's issue."
2025-12-22 23:50:47,206 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/migrations/test_writer.py`.
2025-12-22 23:50:47,206 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-22 23:50:47,207 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-22 23:50:47,207 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-22 23:50:47,207 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/migrations/test_writer.py`.
Purpose: I need this file to find test cases that check the serialized output of deconstructed expression objects in migration files, which is directly related to the user's issue.
2025-12-22 23:50:49,465 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the entire content of the file `tests/migrations/test_writer.py` as you requested. This will allow you to examine the test cases related to the serialized output of deconstructed expression objects in migration files.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/migrations/test_writer.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2106, 'candidates_token_count': 70, 'total_token_count': 2262, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2106}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 70}], 'thoughts_token_count': 86, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.08868585995265416, 'model_name': 'gemini-2.5-pro'} id='run--9c643ce9-332d-4719-9f1a-43f01fe36c13-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/migrations/test_writer.py'}, 'id': '90dc75c4-aa0a-484e-ab30-6ad3962ecbf3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2106, 'output_tokens': 70, 'total_tokens': 2262, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 86}}
2025-12-22 23:50:54,752 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have reviewed the initial content of `tests/migrations/test_writer.py` and see that it contains many relevant tests for serialization. To ensure I don't miss any crucial test cases, especially those that might appear later in the file, I am now reading the remainder of the file to get the complete picture." additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "end_line": 1000.0, "relative_path": "tests/migrations/test_writer.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 10022, 'candidates_token_count': 95, 'total_token_count': 10467, 'cached_content_token_count': 1813, 'prompt_tokens_details': [{'modality': 1, 'token_count': 10022}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1813}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 95}], 'thoughts_token_count': 350}, 'finish_reason': 'STOP', 'avg_logprobs': -0.8241520931846217, 'model_name': 'gemini-2.5-pro'} id='run--d88f2820-6eb7-49dd-b72a-1077ab4c6356-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'end_line': 1000.0, 'relative_path': 'tests/migrations/test_writer.py'}, 'id': '02755c23-a4c9-4509-bfcb-9bba59d93f4a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10022, 'output_tokens': 95, 'total_tokens': 10467, 'input_token_details': {'cache_read': 1813}, 'output_token_details': {'reasoning': 350}}
2025-12-22 23:51:03,299 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have successfully retrieved the entire content of the file `tests/migrations/test_writer.py`. After analyzing its contents, I have identified several test cases within the `WriterTests` class that are highly relevant to your query. These tests specifically examine the serialized output of deconstructed expression objects in migration files, which should provide the necessary context to address the user's issue." additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 15771, 'candidates_token_count': 77, 'total_token_count': 16640, 'cached_content_token_count': 9292, 'prompt_tokens_details': [{'modality': 1, 'token_count': 15771}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9292}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 77}], 'thoughts_token_count': 792}, 'finish_reason': 'STOP', 'avg_logprobs': -1.2756114811092227, 'model_name': 'gemini-2.5-pro'} id='run--89bc0990-3a1b-47e5-a5e8-04a494f65a0d-0' usage_metadata={'input_tokens': 15771, 'output_tokens': 77, 'total_tokens': 16640, 'input_token_details': {'cache_read': 9292}, 'output_token_details': {'reasoning': 792}}
2025-12-22 23:51:03,301 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/migrations/test_writer.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need this file to find test cases that check the serialized output of deconstructed expression objects in migration files, which is directly related to the user's issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/migrations/test_writer.py
Line number range: 1 - 500
Content:
1. import datetime
2. import decimal
3. import enum
4. import functools
5. import math
6. import os
7. import pathlib
8. import re
9. import sys
10. import uuid
11. from unittest import mock
12. 
13. try:
14.     import zoneinfo
15. except ImportError:
16.     from backports import zoneinfo
17. 
18. try:
19.     import pytz
20. except ImportError:
21.     pytz = None
22. 
23. import custom_migration_operations.more_operations
24. import custom_migration_operations.operations
25. 
26. from django import get_version
27. from django.conf import SettingsReference, settings
28. from django.core.validators import EmailValidator, RegexValidator
29. from django.db import migrations, models
30. from django.db.migrations.serializer import BaseSerializer
31. from django.db.migrations.writer import MigrationWriter, OperationWriter
32. from django.test import SimpleTestCase
33. from django.utils.deconstruct import deconstructible
34. from django.utils.functional import SimpleLazyObject
35. from django.utils.timezone import get_default_timezone, get_fixed_timezone, utc
36. from django.utils.translation import gettext_lazy as _
37. 
38. from .models import FoodManager, FoodQuerySet
39. 
40. 
41. class DeconstructibleInstances:
42.     def deconstruct(self):
43.         return ('DeconstructibleInstances', [], {})
44. 
45. 
46. class Money(decimal.Decimal):
47.     def deconstruct(self):
48.         return (
49.             '%s.%s' % (self.__class__.__module__, self.__class__.__name__),
50.             [str(self)],
51.             {}
52.         )
53. 
54. 
55. class TestModel1:
56.     def upload_to(self):
57.         return '/somewhere/dynamic/'
58.     thing = models.FileField(upload_to=upload_to)
59. 
60. 
61. class TextEnum(enum.Enum):
62.     A = 'a-value'
63.     B = 'value-b'
64. 
65. 
66. class TextTranslatedEnum(enum.Enum):
67.     A = _('a-value')
68.     B = _('value-b')
69. 
70. 
71. class BinaryEnum(enum.Enum):
72.     A = b'a-value'
73.     B = b'value-b'
74. 
75. 
76. class IntEnum(enum.IntEnum):
77.     A = 1
78.     B = 2
79. 
80. 
81. class OperationWriterTests(SimpleTestCase):
82. 
83.     def test_empty_signature(self):
84.         operation = custom_migration_operations.operations.TestOperation()
85.         buff, imports = OperationWriter(operation, indentation=0).serialize()
86.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
87.         self.assertEqual(
88.             buff,
89.             'custom_migration_operations.operations.TestOperation(\n'
90.             '),'
91.         )
92. 
93.     def test_args_signature(self):
94.         operation = custom_migration_operations.operations.ArgsOperation(1, 2)
95.         buff, imports = OperationWriter(operation, indentation=0).serialize()
96.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
97.         self.assertEqual(
98.             buff,
99.             'custom_migration_operations.operations.ArgsOperation(\n'
100.             '    arg1=1,\n'
101.             '    arg2=2,\n'
102.             '),'
103.         )
104. 
105.     def test_kwargs_signature(self):
106.         operation = custom_migration_operations.operations.KwargsOperation(kwarg1=1)
107.         buff, imports = OperationWriter(operation, indentation=0).serialize()
108.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
109.         self.assertEqual(
110.             buff,
111.             'custom_migration_operations.operations.KwargsOperation(\n'
112.             '    kwarg1=1,\n'
113.             '),'
114.         )
115. 
116.     def test_args_kwargs_signature(self):
117.         operation = custom_migration_operations.operations.ArgsKwargsOperation(1, 2, kwarg2=4)
118.         buff, imports = OperationWriter(operation, indentation=0).serialize()
119.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
120.         self.assertEqual(
121.             buff,
122.             'custom_migration_operations.operations.ArgsKwargsOperation(\n'
123.             '    arg1=1,\n'
124.             '    arg2=2,\n'
125.             '    kwarg2=4,\n'
126.             '),'
127.         )
128. 
129.     def test_nested_args_signature(self):
130.         operation = custom_migration_operations.operations.ArgsOperation(
131.             custom_migration_operations.operations.ArgsOperation(1, 2),
132.             custom_migration_operations.operations.KwargsOperation(kwarg1=3, kwarg2=4)
133.         )
134.         buff, imports = OperationWriter(operation, indentation=0).serialize()
135.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
136.         self.assertEqual(
137.             buff,
138.             'custom_migration_operations.operations.ArgsOperation(\n'
139.             '    arg1=custom_migration_operations.operations.ArgsOperation(\n'
140.             '        arg1=1,\n'
141.             '        arg2=2,\n'
142.             '    ),\n'
143.             '    arg2=custom_migration_operations.operations.KwargsOperation(\n'
144.             '        kwarg1=3,\n'
145.             '        kwarg2=4,\n'
146.             '    ),\n'
147.             '),'
148.         )
149. 
150.     def test_multiline_args_signature(self):
151.         operation = custom_migration_operations.operations.ArgsOperation("test\n    arg1", "test\narg2")
152.         buff, imports = OperationWriter(operation, indentation=0).serialize()
153.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
154.         self.assertEqual(
155.             buff,
156.             "custom_migration_operations.operations.ArgsOperation(\n"
157.             "    arg1='test\\n    arg1',\n"
158.             "    arg2='test\\narg2',\n"
159.             "),"
160.         )
161. 
162.     def test_expand_args_signature(self):
163.         operation = custom_migration_operations.operations.ExpandArgsOperation([1, 2])
164.         buff, imports = OperationWriter(operation, indentation=0).serialize()
165.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
166.         self.assertEqual(
167.             buff,
168.             'custom_migration_operations.operations.ExpandArgsOperation(\n'
169.             '    arg=[\n'
170.             '        1,\n'
171.             '        2,\n'
172.             '    ],\n'
173.             '),'
174.         )
175. 
176.     def test_nested_operation_expand_args_signature(self):
177.         operation = custom_migration_operations.operations.ExpandArgsOperation(
178.             arg=[
179.                 custom_migration_operations.operations.KwargsOperation(
180.                     kwarg1=1,
181.                     kwarg2=2,
182.                 ),
183.             ]
184.         )
185.         buff, imports = OperationWriter(operation, indentation=0).serialize()
186.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
187.         self.assertEqual(
188.             buff,
189.             'custom_migration_operations.operations.ExpandArgsOperation(\n'
190.             '    arg=[\n'
191.             '        custom_migration_operations.operations.KwargsOperation(\n'
192.             '            kwarg1=1,\n'
193.             '            kwarg2=2,\n'
194.             '        ),\n'
195.             '    ],\n'
196.             '),'
197.         )
198. 
199. 
200. class WriterTests(SimpleTestCase):
201.     """
202.     Tests the migration writer (makes migration files from Migration instances)
203.     """
204.     class NestedEnum(enum.IntEnum):
205.         A = 1
206.         B = 2
207. 
208.     class NestedChoices(models.TextChoices):
209.         X = 'X', 'X value'
210.         Y = 'Y', 'Y value'
211. 
212.     def safe_exec(self, string, value=None):
213.         d = {}
214.         try:
215.             exec(string, globals(), d)
216.         except Exception as e:
217.             if value:
218.                 self.fail("Could not exec %r (from value %r): %s" % (string.strip(), value, e))
219.             else:
220.                 self.fail("Could not exec %r: %s" % (string.strip(), e))
221.         return d
222. 
223.     def serialize_round_trip(self, value):
224.         string, imports = MigrationWriter.serialize(value)
225.         return self.safe_exec("%s\ntest_value_result = %s" % ("\n".join(imports), string), value)['test_value_result']
226. 
227.     def assertSerializedEqual(self, value):
228.         self.assertEqual(self.serialize_round_trip(value), value)
229. 
230.     def assertSerializedResultEqual(self, value, target):
231.         self.assertEqual(MigrationWriter.serialize(value), target)
232. 
233.     def assertSerializedFieldEqual(self, value):
234.         new_value = self.serialize_round_trip(value)
235.         self.assertEqual(value.__class__, new_value.__class__)
236.         self.assertEqual(value.max_length, new_value.max_length)
237.         self.assertEqual(value.null, new_value.null)
238.         self.assertEqual(value.unique, new_value.unique)
239. 
240.     def test_serialize_numbers(self):
241.         self.assertSerializedEqual(1)
242.         self.assertSerializedEqual(1.2)
243.         self.assertTrue(math.isinf(self.serialize_round_trip(float("inf"))))
244.         self.assertTrue(math.isinf(self.serialize_round_trip(float("-inf"))))
245.         self.assertTrue(math.isnan(self.serialize_round_trip(float("nan"))))
246. 
247.         self.assertSerializedEqual(decimal.Decimal('1.3'))
248.         self.assertSerializedResultEqual(
249.             decimal.Decimal('1.3'),
250.             ("Decimal('1.3')", {'from decimal import Decimal'})
251.         )
252. 
253.         self.assertSerializedEqual(Money('1.3'))
254.         self.assertSerializedResultEqual(
255.             Money('1.3'),
256.             ("migrations.test_writer.Money('1.3')", {'import migrations.test_writer'})
257.         )
258. 
259.     def test_serialize_constants(self):
260.         self.assertSerializedEqual(None)
261.         self.assertSerializedEqual(True)
262.         self.assertSerializedEqual(False)
263. 
264.     def test_serialize_strings(self):
265.         self.assertSerializedEqual(b"foobar")
266.         string, imports = MigrationWriter.serialize(b"foobar")
267.         self.assertEqual(string, "b'foobar'")
268.         self.assertSerializedEqual("föobár")
269.         string, imports = MigrationWriter.serialize("foobar")
270.         self.assertEqual(string, "'foobar'")
271. 
272.     def test_serialize_multiline_strings(self):
273.         self.assertSerializedEqual(b"foo\nbar")
274.         string, imports = MigrationWriter.serialize(b"foo\nbar")
275.         self.assertEqual(string, "b'foo\\nbar'")
276.         self.assertSerializedEqual("föo\nbár")
277.         string, imports = MigrationWriter.serialize("foo\nbar")
278.         self.assertEqual(string, "'foo\\nbar'")
279. 
280.     def test_serialize_collections(self):
281.         self.assertSerializedEqual({1: 2})
282.         self.assertSerializedEqual(["a", 2, True, None])
283.         self.assertSerializedEqual({2, 3, "eighty"})
284.         self.assertSerializedEqual({"lalalala": ["yeah", "no", "maybe"]})
285.         self.assertSerializedEqual(_('Hello'))
286. 
287.     def test_serialize_builtin_types(self):
288.         self.assertSerializedEqual([list, tuple, dict, set, frozenset])
289.         self.assertSerializedResultEqual(
290.             [list, tuple, dict, set, frozenset],
291.             ("[list, tuple, dict, set, frozenset]", set())
292.         )
293. 
294.     def test_serialize_lazy_objects(self):
295.         pattern = re.compile(r'^foo$')
296.         lazy_pattern = SimpleLazyObject(lambda: pattern)
297.         self.assertEqual(self.serialize_round_trip(lazy_pattern), pattern)
298. 
299.     def test_serialize_enums(self):
300.         self.assertSerializedResultEqual(
301.             TextEnum.A,
302.             ("migrations.test_writer.TextEnum['A']", {'import migrations.test_writer'})
303.         )
304.         self.assertSerializedResultEqual(
305.             TextTranslatedEnum.A,
306.             ("migrations.test_writer.TextTranslatedEnum['A']", {'import migrations.test_writer'})
307.         )
308.         self.assertSerializedResultEqual(
309.             BinaryEnum.A,
310.             ("migrations.test_writer.BinaryEnum['A']", {'import migrations.test_writer'})
311.         )
312.         self.assertSerializedResultEqual(
313.             IntEnum.B,
314.             ("migrations.test_writer.IntEnum['B']", {'import migrations.test_writer'})
315.         )
316.         self.assertSerializedResultEqual(
317.             self.NestedEnum.A,
318.             (
319.                 "migrations.test_writer.WriterTests.NestedEnum['A']",
320.                 {'import migrations.test_writer'},
321.             ),
322.         )
323.         self.assertSerializedEqual(self.NestedEnum.A)
324. 
325.         field = models.CharField(default=TextEnum.B, choices=[(m.value, m) for m in TextEnum])
326.         string = MigrationWriter.serialize(field)[0]
327.         self.assertEqual(
328.             string,
329.             "models.CharField(choices=["
330.             "('a-value', migrations.test_writer.TextEnum['A']), "
331.             "('value-b', migrations.test_writer.TextEnum['B'])], "
332.             "default=migrations.test_writer.TextEnum['B'])"
333.         )
334.         field = models.CharField(
335.             default=TextTranslatedEnum.A,
336.             choices=[(m.value, m) for m in TextTranslatedEnum],
337.         )
338.         string = MigrationWriter.serialize(field)[0]
339.         self.assertEqual(
340.             string,
341.             "models.CharField(choices=["
342.             "('a-value', migrations.test_writer.TextTranslatedEnum['A']), "
343.             "('value-b', migrations.test_writer.TextTranslatedEnum['B'])], "
344.             "default=migrations.test_writer.TextTranslatedEnum['A'])"
345.         )
346.         field = models.CharField(default=BinaryEnum.B, choices=[(m.value, m) for m in BinaryEnum])
347.         string = MigrationWriter.serialize(field)[0]
348.         self.assertEqual(
349.             string,
350.             "models.CharField(choices=["
351.             "(b'a-value', migrations.test_writer.BinaryEnum['A']), "
352.             "(b'value-b', migrations.test_writer.BinaryEnum['B'])], "
353.             "default=migrations.test_writer.BinaryEnum['B'])"
354.         )
355.         field = models.IntegerField(default=IntEnum.A, choices=[(m.value, m) for m in IntEnum])
356.         string = MigrationWriter.serialize(field)[0]
357.         self.assertEqual(
358.             string,
359.             "models.IntegerField(choices=["
360.             "(1, migrations.test_writer.IntEnum['A']), "
361.             "(2, migrations.test_writer.IntEnum['B'])], "
362.             "default=migrations.test_writer.IntEnum['A'])"
363.         )
364. 
365.     def test_serialize_choices(self):
366.         class TextChoices(models.TextChoices):
367.             A = 'A', 'A value'
368.             B = 'B', 'B value'
369. 
370.         class IntegerChoices(models.IntegerChoices):
371.             A = 1, 'One'
372.             B = 2, 'Two'
373. 
374.         class DateChoices(datetime.date, models.Choices):
375.             DATE_1 = 1969, 7, 20, 'First date'
376.             DATE_2 = 1969, 11, 19, 'Second date'
377. 
378.         self.assertSerializedResultEqual(TextChoices.A, ("'A'", set()))
379.         self.assertSerializedResultEqual(IntegerChoices.A, ('1', set()))
380.         self.assertSerializedResultEqual(
381.             DateChoices.DATE_1,
382.             ('datetime.date(1969, 7, 20)', {'import datetime'}),
383.         )
384.         field = models.CharField(default=TextChoices.B, choices=TextChoices.choices)
385.         string = MigrationWriter.serialize(field)[0]
386.         self.assertEqual(
387.             string,
388.             "models.CharField(choices=[('A', 'A value'), ('B', 'B value')], "
389.             "default='B')",
390.         )
391.         field = models.IntegerField(default=IntegerChoices.B, choices=IntegerChoices.choices)
392.         string = MigrationWriter.serialize(field)[0]
393.         self.assertEqual(
394.             string,
395.             "models.IntegerField(choices=[(1, 'One'), (2, 'Two')], default=2)",
396.         )
397.         field = models.DateField(default=DateChoices.DATE_2, choices=DateChoices.choices)
398.         string = MigrationWriter.serialize(field)[0]
399.         self.assertEqual(
400.             string,
401.             "models.DateField(choices=["
402.             "(datetime.date(1969, 7, 20), 'First date'), "
403.             "(datetime.date(1969, 11, 19), 'Second date')], "
404.             "default=datetime.date(1969, 11, 19))"
405.         )
406. 
407.     def test_serialize_nested_class(self):
408.         for nested_cls in [self.NestedEnum, self.NestedChoices]:
409.             cls_name = nested_cls.__name__
410.             with self.subTest(cls_name):
411.                 self.assertSerializedResultEqual(
412.                     nested_cls,
413.                     (
414.                         "migrations.test_writer.WriterTests.%s" % cls_name,
415.                         {'import migrations.test_writer'},
416.                     ),
417.                 )
418. 
419.     def test_serialize_uuid(self):
420.         self.assertSerializedEqual(uuid.uuid1())
421.         self.assertSerializedEqual(uuid.uuid4())
422. 
423.         uuid_a = uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8')
424.         uuid_b = uuid.UUID('c7853ec1-2ea3-4359-b02d-b54e8f1bcee2')
425.         self.assertSerializedResultEqual(
426.             uuid_a,
427.             ("uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8')", {'import uuid'})
428.         )
429.         self.assertSerializedResultEqual(
430.             uuid_b,
431.             ("uuid.UUID('c7853ec1-2ea3-4359-b02d-b54e8f1bcee2')", {'import uuid'})
432.         )
433. 
434.         field = models.UUIDField(choices=((uuid_a, 'UUID A'), (uuid_b, 'UUID B')), default=uuid_a)
435.         string = MigrationWriter.serialize(field)[0]
436.         self.assertEqual(
437.             string,
438.             "models.UUIDField(choices=["
439.             "(uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8'), 'UUID A'), "
440.             "(uuid.UUID('c7853ec1-2ea3-4359-b02d-b54e8f1bcee2'), 'UUID B')], "
441.             "default=uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8'))"
442.         )
443. 
444.     def test_serialize_pathlib(self):
445.         # Pure path objects work in all platforms.
446.         self.assertSerializedEqual(pathlib.PurePosixPath())
447.         self.assertSerializedEqual(pathlib.PureWindowsPath())
448.         path = pathlib.PurePosixPath('/path/file.txt')
449.         expected = ("pathlib.PurePosixPath('/path/file.txt')", {'import pathlib'})
450.         self.assertSerializedResultEqual(path, expected)
451.         path = pathlib.PureWindowsPath('A:\\File.txt')
452.         expected = ("pathlib.PureWindowsPath('A:/File.txt')", {'import pathlib'})
453.         self.assertSerializedResultEqual(path, expected)
454.         # Concrete path objects work on supported platforms.
455.         if sys.platform == 'win32':
456.             self.assertSerializedEqual(pathlib.WindowsPath.cwd())
457.             path = pathlib.WindowsPath('A:\\File.txt')
458.             expected = ("pathlib.PureWindowsPath('A:/File.txt')", {'import pathlib'})
459.             self.assertSerializedResultEqual(path, expected)
460.         else:
461.             self.assertSerializedEqual(pathlib.PosixPath.cwd())
462.             path = pathlib.PosixPath('/path/file.txt')
463.             expected = ("pathlib.PurePosixPath('/path/file.txt')", {'import pathlib'})
464.             self.assertSerializedResultEqual(path, expected)
465. 
466.         field = models.FilePathField(path=pathlib.PurePosixPath('/home/user'))
467.         string, imports = MigrationWriter.serialize(field)
468.         self.assertEqual(
469.             string,
470.             "models.FilePathField(path=pathlib.PurePosixPath('/home/user'))",
471.         )
472.         self.assertIn('import pathlib', imports)
473. 
474.     def test_serialize_path_like(self):
475.         with os.scandir(os.path.dirname(__file__)) as entries:
476.             path_like = list(entries)[0]
477.         expected = (repr(path_like.path), {})
478.         self.assertSerializedResultEqual(path_like, expected)
479. 
480.         field = models.FilePathField(path=path_like)
481.         string = MigrationWriter.serialize(field)[0]
482.         self.assertEqual(string, 'models.FilePathField(path=%r)' % path_like.path)
483. 
484.     def test_serialize_functions(self):
485.         with self.assertRaisesMessage(ValueError, 'Cannot serialize function: lambda'):
486.             self.assertSerializedEqual(lambda x: 42)
487.         self.assertSerializedEqual(models.SET_NULL)
488.         string, imports = MigrationWriter.serialize(models.SET(42))
489.         self.assertEqual(string, 'models.SET(42)')
490.         self.serialize_round_trip(models.SET(42))
491. 
492.     def test_serialize_datetime(self):
493.         self.assertSerializedEqual(datetime.datetime.now())
494.         self.assertSerializedEqual(datetime.datetime.now)
495.         self.assertSerializedEqual(datetime.datetime.today())
496.         self.assertSerializedEqual(datetime.datetime.today)
497.         self.assertSerializedEqual(datetime.date.today())
498.         self.assertSerializedEqual(datetime.date.today)
499.         self.assertSerializedEqual(datetime.datetime.now().time())
500.         self.assertSerializedEqual(datetime.datetime(2014, 1, 1, 1, 1, tzinfo=get_default_timezone()))


File: tests/migrations/test_writer.py
Line number range: 501 - 1000
Content:
501.         self.assertSerializedEqual(datetime.datetime(2013, 12, 31, 22, 1, tzinfo=get_fixed_timezone(180)))
502.         self.assertSerializedResultEqual(
503.             datetime.datetime(2014, 1, 1, 1, 1),
504.             ("datetime.datetime(2014, 1, 1, 1, 1)", {'import datetime'})
505.         )
506.         for tzinfo in (utc, datetime.timezone.utc):
507.             with self.subTest(tzinfo=tzinfo):
508.                 self.assertSerializedResultEqual(
509.                     datetime.datetime(2012, 1, 1, 1, 1, tzinfo=tzinfo),
510.                     (
511.                         "datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc)",
512.                         {'import datetime', 'from django.utils.timezone import utc'},
513.                     )
514.                 )
515. 
516.         self.assertSerializedResultEqual(
517.             datetime.datetime(2012, 1, 1, 2, 1, tzinfo=zoneinfo.ZoneInfo('Europe/Paris')),
518.             (
519.                 "datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc)",
520.                 {'import datetime', 'from django.utils.timezone import utc'},
521.             )
522.         )
523.         if pytz:
524.             self.assertSerializedResultEqual(
525.                 pytz.timezone('Europe/Paris').localize(datetime.datetime(2012, 1, 1, 2, 1)),
526.                 (
527.                     "datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc)",
528.                     {'import datetime', 'from django.utils.timezone import utc'},
529.                 )
530.             )
531. 
532.     def test_serialize_fields(self):
533.         self.assertSerializedFieldEqual(models.CharField(max_length=255))
534.         self.assertSerializedResultEqual(
535.             models.CharField(max_length=255),
536.             ("models.CharField(max_length=255)", {"from django.db import models"})
537.         )
538.         self.assertSerializedFieldEqual(models.TextField(null=True, blank=True))
539.         self.assertSerializedResultEqual(
540.             models.TextField(null=True, blank=True),
541.             ("models.TextField(blank=True, null=True)", {'from django.db import models'})
542.         )
543. 
544.     def test_serialize_settings(self):
545.         self.assertSerializedEqual(SettingsReference(settings.AUTH_USER_MODEL, "AUTH_USER_MODEL"))
546.         self.assertSerializedResultEqual(
547.             SettingsReference("someapp.model", "AUTH_USER_MODEL"),
548.             ("settings.AUTH_USER_MODEL", {"from django.conf import settings"})
549.         )
550. 
551.     def test_serialize_iterators(self):
552.         self.assertSerializedResultEqual(
553.             ((x, x * x) for x in range(3)),
554.             ("((0, 0), (1, 1), (2, 4))", set())
555.         )
556. 
557.     def test_serialize_compiled_regex(self):
558.         """
559.         Make sure compiled regex can be serialized.
560.         """
561.         regex = re.compile(r'^\w+$')
562.         self.assertSerializedEqual(regex)
563. 
564.     def test_serialize_class_based_validators(self):
565.         """
566.         Ticket #22943: Test serialization of class-based validators, including
567.         compiled regexes.
568.         """
569.         validator = RegexValidator(message="hello")
570.         string = MigrationWriter.serialize(validator)[0]
571.         self.assertEqual(string, "django.core.validators.RegexValidator(message='hello')")
572.         self.serialize_round_trip(validator)
573. 
574.         # Test with a compiled regex.
575.         validator = RegexValidator(regex=re.compile(r'^\w+$'))
576.         string = MigrationWriter.serialize(validator)[0]
577.         self.assertEqual(string, "django.core.validators.RegexValidator(regex=re.compile('^\\\\w+$'))")
578.         self.serialize_round_trip(validator)
579. 
580.         # Test a string regex with flag
581.         validator = RegexValidator(r'^[0-9]+$', flags=re.S)
582.         string = MigrationWriter.serialize(validator)[0]
583.         self.assertEqual(string, "django.core.validators.RegexValidator('^[0-9]+$', flags=re.RegexFlag['DOTALL'])")
584.         self.serialize_round_trip(validator)
585. 
586.         # Test message and code
587.         validator = RegexValidator('^[-a-zA-Z0-9_]+$', 'Invalid', 'invalid')
588.         string = MigrationWriter.serialize(validator)[0]
589.         self.assertEqual(string, "django.core.validators.RegexValidator('^[-a-zA-Z0-9_]+$', 'Invalid', 'invalid')")
590.         self.serialize_round_trip(validator)
591. 
592.         # Test with a subclass.
593.         validator = EmailValidator(message="hello")
594.         string = MigrationWriter.serialize(validator)[0]
595.         self.assertEqual(string, "django.core.validators.EmailValidator(message='hello')")
596.         self.serialize_round_trip(validator)
597. 
598.         validator = deconstructible(path="migrations.test_writer.EmailValidator")(EmailValidator)(message="hello")
599.         string = MigrationWriter.serialize(validator)[0]
600.         self.assertEqual(string, "migrations.test_writer.EmailValidator(message='hello')")
601. 
602.         validator = deconstructible(path="custom.EmailValidator")(EmailValidator)(message="hello")
603.         with self.assertRaisesMessage(ImportError, "No module named 'custom'"):
604.             MigrationWriter.serialize(validator)
605. 
606.         validator = deconstructible(path="django.core.validators.EmailValidator2")(EmailValidator)(message="hello")
607.         with self.assertRaisesMessage(ValueError, "Could not find object EmailValidator2 in django.core.validators."):
608.             MigrationWriter.serialize(validator)
609. 
610.     def test_serialize_empty_nonempty_tuple(self):
611.         """
612.         Ticket #22679: makemigrations generates invalid code for (an empty
613.         tuple) default_permissions = ()
614.         """
615.         empty_tuple = ()
616.         one_item_tuple = ('a',)
617.         many_items_tuple = ('a', 'b', 'c')
618.         self.assertSerializedEqual(empty_tuple)
619.         self.assertSerializedEqual(one_item_tuple)
620.         self.assertSerializedEqual(many_items_tuple)
621. 
622.     def test_serialize_range(self):
623.         string, imports = MigrationWriter.serialize(range(1, 5))
624.         self.assertEqual(string, 'range(1, 5)')
625.         self.assertEqual(imports, set())
626. 
627.     def test_serialize_builtins(self):
628.         string, imports = MigrationWriter.serialize(range)
629.         self.assertEqual(string, 'range')
630.         self.assertEqual(imports, set())
631. 
632.     def test_serialize_unbound_method_reference(self):
633.         """An unbound method used within a class body can be serialized."""
634.         self.serialize_round_trip(TestModel1.thing)
635. 
636.     def test_serialize_local_function_reference(self):
637.         """A reference in a local scope can't be serialized."""
638.         class TestModel2:
639.             def upload_to(self):
640.                 return "somewhere dynamic"
641.             thing = models.FileField(upload_to=upload_to)
642. 
643.         with self.assertRaisesMessage(ValueError, 'Could not find function upload_to in migrations.test_writer'):
644.             self.serialize_round_trip(TestModel2.thing)
645. 
646.     def test_serialize_managers(self):
647.         self.assertSerializedEqual(models.Manager())
648.         self.assertSerializedResultEqual(
649.             FoodQuerySet.as_manager(),
650.             ('migrations.models.FoodQuerySet.as_manager()', {'import migrations.models'})
651.         )
652.         self.assertSerializedEqual(FoodManager('a', 'b'))
653.         self.assertSerializedEqual(FoodManager('x', 'y', c=3, d=4))
654. 
655.     def test_serialize_frozensets(self):
656.         self.assertSerializedEqual(frozenset())
657.         self.assertSerializedEqual(frozenset("let it go"))
658. 
659.     def test_serialize_set(self):
660.         self.assertSerializedEqual(set())
661.         self.assertSerializedResultEqual(set(), ('set()', set()))
662.         self.assertSerializedEqual({'a'})
663.         self.assertSerializedResultEqual({'a'}, ("{'a'}", set()))
664. 
665.     def test_serialize_timedelta(self):
666.         self.assertSerializedEqual(datetime.timedelta())
667.         self.assertSerializedEqual(datetime.timedelta(minutes=42))
668. 
669.     def test_serialize_functools_partial(self):
670.         value = functools.partial(datetime.timedelta, 1, seconds=2)
671.         result = self.serialize_round_trip(value)
672.         self.assertEqual(result.func, value.func)
673.         self.assertEqual(result.args, value.args)
674.         self.assertEqual(result.keywords, value.keywords)
675. 
676.     def test_serialize_functools_partialmethod(self):
677.         value = functools.partialmethod(datetime.timedelta, 1, seconds=2)
678.         result = self.serialize_round_trip(value)
679.         self.assertIsInstance(result, functools.partialmethod)
680.         self.assertEqual(result.func, value.func)
681.         self.assertEqual(result.args, value.args)
682.         self.assertEqual(result.keywords, value.keywords)
683. 
684.     def test_serialize_type_none(self):
685.         self.assertSerializedEqual(type(None))
686. 
687.     def test_serialize_type_model(self):
688.         self.assertSerializedEqual(models.Model)
689.         self.assertSerializedResultEqual(
690.             MigrationWriter.serialize(models.Model),
691.             ("('models.Model', {'from django.db import models'})", set()),
692.         )
693. 
694.     def test_simple_migration(self):
695.         """
696.         Tests serializing a simple migration.
697.         """
698.         fields = {
699.             'charfield': models.DateTimeField(default=datetime.datetime.now),
700.             'datetimefield': models.DateTimeField(default=datetime.datetime.now),
701.         }
702. 
703.         options = {
704.             'verbose_name': 'My model',
705.             'verbose_name_plural': 'My models',
706.         }
707. 
708.         migration = type("Migration", (migrations.Migration,), {
709.             "operations": [
710.                 migrations.CreateModel("MyModel", tuple(fields.items()), options, (models.Model,)),
711.                 migrations.CreateModel("MyModel2", tuple(fields.items()), bases=(models.Model,)),
712.                 migrations.CreateModel(
713.                     name="MyModel3", fields=tuple(fields.items()), options=options, bases=(models.Model,)
714.                 ),
715.                 migrations.DeleteModel("MyModel"),
716.                 migrations.AddField("OtherModel", "datetimefield", fields["datetimefield"]),
717.             ],
718.             "dependencies": [("testapp", "some_other_one")],
719.         })
720.         writer = MigrationWriter(migration)
721.         output = writer.as_string()
722.         # We don't test the output formatting - that's too fragile.
723.         # Just make sure it runs for now, and that things look alright.
724.         result = self.safe_exec(output)
725.         self.assertIn("Migration", result)
726. 
727.     def test_migration_path(self):
728.         test_apps = [
729.             'migrations.migrations_test_apps.normal',
730.             'migrations.migrations_test_apps.with_package_model',
731.             'migrations.migrations_test_apps.without_init_file',
732.         ]
733. 
734.         base_dir = os.path.dirname(os.path.dirname(__file__))
735. 
736.         for app in test_apps:
737.             with self.modify_settings(INSTALLED_APPS={'append': app}):
738.                 migration = migrations.Migration('0001_initial', app.split('.')[-1])
739.                 expected_path = os.path.join(base_dir, *(app.split('.') + ['migrations', '0001_initial.py']))
740.                 writer = MigrationWriter(migration)
741.                 self.assertEqual(writer.path, expected_path)
742. 
743.     def test_custom_operation(self):
744.         migration = type("Migration", (migrations.Migration,), {
745.             "operations": [
746.                 custom_migration_operations.operations.TestOperation(),
747.                 custom_migration_operations.operations.CreateModel(),
748.                 migrations.CreateModel("MyModel", (), {}, (models.Model,)),
749.                 custom_migration_operations.more_operations.TestOperation()
750.             ],
751.             "dependencies": []
752.         })
753.         writer = MigrationWriter(migration)
754.         output = writer.as_string()
755.         result = self.safe_exec(output)
756.         self.assertIn("custom_migration_operations", result)
757.         self.assertNotEqual(
758.             result['custom_migration_operations'].operations.TestOperation,
759.             result['custom_migration_operations'].more_operations.TestOperation
760.         )
761. 
762.     def test_sorted_imports(self):
763.         """
764.         #24155 - Tests ordering of imports.
765.         """
766.         migration = type("Migration", (migrations.Migration,), {
767.             "operations": [
768.                 migrations.AddField("mymodel", "myfield", models.DateTimeField(
769.                     default=datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc),
770.                 )),
771.             ]
772.         })
773.         writer = MigrationWriter(migration)
774.         output = writer.as_string()
775.         self.assertIn(
776.             "import datetime\n"
777.             "from django.db import migrations, models\n"
778.             "from django.utils.timezone import utc\n",
779.             output
780.         )
781. 
782.     def test_migration_file_header_comments(self):
783.         """
784.         Test comments at top of file.
785.         """
786.         migration = type("Migration", (migrations.Migration,), {
787.             "operations": []
788.         })
789.         dt = datetime.datetime(2015, 7, 31, 4, 40, 0, 0, tzinfo=utc)
790.         with mock.patch('django.db.migrations.writer.now', lambda: dt):
791.             for include_header in (True, False):
792.                 with self.subTest(include_header=include_header):
793.                     writer = MigrationWriter(migration, include_header)
794.                     output = writer.as_string()
795. 
796.                     self.assertEqual(
797.                         include_header,
798.                         output.startswith(
799.                             "# Generated by Django %s on 2015-07-31 04:40\n\n" % get_version()
800.                         )
801.                     )
802.                     if not include_header:
803.                         # Make sure the output starts with something that's not
804.                         # a comment or indentation or blank line
805.                         self.assertRegex(output.splitlines(keepends=True)[0], r"^[^#\s]+")
806. 
807.     def test_models_import_omitted(self):
808.         """
809.         django.db.models shouldn't be imported if unused.
810.         """
811.         migration = type("Migration", (migrations.Migration,), {
812.             "operations": [
813.                 migrations.AlterModelOptions(
814.                     name='model',
815.                     options={'verbose_name': 'model', 'verbose_name_plural': 'models'},
816.                 ),
817.             ]
818.         })
819.         writer = MigrationWriter(migration)
820.         output = writer.as_string()
821.         self.assertIn("from django.db import migrations\n", output)
822. 
823.     def test_deconstruct_class_arguments(self):
824.         # Yes, it doesn't make sense to use a class as a default for a
825.         # CharField. It does make sense for custom fields though, for example
826.         # an enumfield that takes the enum class as an argument.
827.         string = MigrationWriter.serialize(models.CharField(default=DeconstructibleInstances))[0]
828.         self.assertEqual(string, "models.CharField(default=migrations.test_writer.DeconstructibleInstances)")
829. 
830.     def test_register_serializer(self):
831.         class ComplexSerializer(BaseSerializer):
832.             def serialize(self):
833.                 return 'complex(%r)' % self.value, {}
834. 
835.         MigrationWriter.register_serializer(complex, ComplexSerializer)
836.         self.assertSerializedEqual(complex(1, 2))
837.         MigrationWriter.unregister_serializer(complex)
838.         with self.assertRaisesMessage(ValueError, 'Cannot serialize: (1+2j)'):
839.             self.assertSerializedEqual(complex(1, 2))
840. 
841.     def test_register_non_serializer(self):
842.         with self.assertRaisesMessage(ValueError, "'TestModel1' must inherit from 'BaseSerializer'."):
843.             MigrationWriter.register_serializer(complex, TestModel1)

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-22 23:51:08,715 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user has requested the full content of the file `tests/migrations/test_writer.py`. The provided context contains the content of this file from line 1 to 843, which I will return as a single block.', relative_path='tests/migrations/test_writer.py', start_line=1, end_line=843)]
2025-12-22 23:51:08,717 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/migrations/test_writer.py`.
2025-12-22 23:51:08,717 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-22 23:51:08,717 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-22 23:51:08,718 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 1 existing contexts
2025-12-22 23:51:08,718 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 2 total contexts (removed 0 duplicates)
2025-12-22 23:51:08,719 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
django
├── .github
|   ├── CODE_OF_CONDUCT.md
|   ├── FUNDING.yml
|   ├── SECURITY.md
|   └── workflows
|       ├── docs.yml
|       ├── linters.yml
|       ├── new_contributor_pr.yml
|       └── tests.yml
├── .pre-commit-config.yaml
├── .readthedocs.yml
├── .tx
├── CONTRIBUTING.rst
├── Gruntfile.js
├── README.rst
├── django
|   ├── __init__.py
|   ├── __main__.py
|   ├── apps
|   |   ├── __init__.py
|   |   ├── config.py
|   |   └── registry.py
|   ├── conf
|   |   ├── __init__.py
|   |   ├── app_template
|   |   |   └── migrations
|   |   ├── global_settings.py
|   |   ├── locale
|   |   |   ├── __init__.py
|   |   |   ├── af
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ar
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ar_DZ
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ast
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── az
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── be
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── bn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── br
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── bs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ca
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cs
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── cy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── da
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── de_CH
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── dsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── el
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_AU
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── en_GB
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eo
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_AR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_CO
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_MX
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_NI
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_PR
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── es_VE
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── et
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── eu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fa
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── fy
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ga
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gd
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── gl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── he
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hsb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── hu
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── hy
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ia
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── id
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ig
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── io
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── is
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── it
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ja
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ka
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kab
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── kk
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── km
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── kn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ko
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ky
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lb
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── lt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── lv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ml
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── mr
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ms
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── my
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nb
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ne
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── nl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── nn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── os
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pa
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── pl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── pt_BR
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ro
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ru
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sl
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sq
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sr_Latn
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sv
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── sw
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── ta
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── te
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tg
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── th
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tr
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── tt
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── udm
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uk
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── ur
|   |   |   |   └── LC_MESSAGES
|   |   |   ├── uz
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── vi
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   ├── zh_Hans
|   |   |   |   ├── LC_MESSAGES
|   |   |   |   ├── __init__.py
|   |   |   |   └── formats.py
|   |   |   └── zh_Hant
|   |   |       ├── LC_MESSAGES
|   |   |       ├── __init__.py
|   |   |       └── formats.py
|   |   ├── project_template
|   |   |   └── project_name
|   |   └── urls
|   |       ├── __init__.py
|   |       ├── i18n.py
|   |       └── static.py
|   ├── contrib
|   |   ├── __init__.py
|   |   ├── admin
|   |   |   ├── __init__.py
|   |   |   ├── actions.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── decorators.py
|   |   |   ├── exceptions.py
|   |   |   ├── filters.py
|   |   |   ├── forms.py
|   |   |   ├── helpers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── am
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_logentry_remove_auto_add.py
|   |   |   |   ├── 0003_logentry_add_action_flag_choices.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── options.py
|   |   |   ├── sites.py
|   |   |   ├── static
|   |   |   |   └── admin
|   |   |   ├── templates
|   |   |   |   ├── admin
|   |   |   |   └── registration
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   ├── admin_list.py
|   |   |   |   ├── admin_modify.py
|   |   |   |   ├── admin_urls.py
|   |   |   |   ├── base.py
|   |   |   |   └── log.py
|   |   |   ├── tests.py
|   |   |   ├── utils.py
|   |   |   ├── views
|   |   |   |   ├── __init__.py
|   |   |   |   ├── autocomplete.py
|   |   |   |   ├── decorators.py
|   |   |   |   └── main.py
|   |   |   └── widgets.py
|   |   ├── admindocs
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── templates
|   |   |   |   └── admin_doc
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── auth
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── backends.py
|   |   |   ├── base_user.py
|   |   |   ├── checks.py
|   |   |   ├── context_processors.py
|   |   |   ├── decorators.py
|   |   |   ├── forms.py
|   |   |   ├── handlers
|   |   |   |   ├── __init__.py
|   |   |   |   └── modwsgi.py
|   |   |   ├── hashers.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_permission_name_max_length.py
|   |   |   |   ├── 0003_alter_user_email_max_length.py
|   |   |   |   ├── 0004_alter_user_username_opts.py
|   |   |   |   ├── 0005_alter_user_last_login_null.py
|   |   |   |   ├── 0006_require_contenttypes_0002.py
|   |   |   |   ├── 0007_alter_validators_add_error_messages.py
|   |   |   |   ├── 0008_alter_user_username_max_length.py
|   |   |   |   ├── 0009_alter_user_last_name_max_length.py
|   |   |   |   ├── 0010_alter_group_name_max_length.py
|   |   |   |   ├── 0011_update_proxy_permissions.py
|   |   |   |   ├── 0012_alter_user_first_name_max_length.py
|   |   |   |   └── __init__.py
|   |   |   ├── mixins.py
|   |   |   ├── models.py
|   |   |   ├── password_validation.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   ├── auth
|   |   |   |   └── registration
|   |   |   ├── tokens.py
|   |   |   ├── urls.py
|   |   |   ├── validators.py
|   |   |   └── views.py
|   |   ├── contenttypes
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── fields.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_remove_content_type_name.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── views.py
|   |   ├── flatpages
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── forms.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── sitemaps.py
|   |   |   ├── templatetags
|   |   |   |   ├── __init__.py
|   |   |   |   └── flatpages.py
|   |   |   ├── urls.py
|   |   |   └── views.py
|   |   ├── gis
|   |   |   ├── __init__.py
|   |   |   ├── admin
|   |   |   |   ├── __init__.py
|   |   |   |   ├── options.py
|   |   |   |   └── widgets.py
|   |   |   ├── apps.py
|   |   |   ├── db
|   |   |   |   ├── __init__.py
|   |   |   |   ├── backends
|   |   |   |   └── models
|   |   |   ├── feeds.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── fields.py
|   |   |   |   └── widgets.py
|   |   |   ├── gdal
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── datasource.py
|   |   |   |   ├── driver.py
|   |   |   |   ├── envelope.py
|   |   |   |   ├── error.py
|   |   |   |   ├── feature.py
|   |   |   |   ├── field.py
|   |   |   |   ├── geometries.py
|   |   |   |   ├── geomtype.py
|   |   |   |   ├── layer.py
|   |   |   |   ├── libgdal.py
|   |   |   |   ├── prototypes
|   |   |   |   ├── raster
|   |   |   |   └── srs.py
|   |   |   ├── geoip2
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── resources.py
|   |   |   ├── geometry.py
|   |   |   ├── geos
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── collections.py
|   |   |   |   ├── coordseq.py
|   |   |   |   ├── error.py
|   |   |   |   ├── factory.py
|   |   |   |   ├── geometry.py
|   |   |   |   ├── io.py
|   |   |   |   ├── libgeos.py
|   |   |   |   ├── linestring.py
|   |   |   |   ├── mutable_list.py
|   |   |   |   ├── point.py
|   |   |   |   ├── polygon.py
|   |   |   |   ├── prepared.py
|   |   |   |   └── prototypes
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── measure.py
|   |   |   ├── ptr.py
|   |   |   ├── serializers
|   |   |   |   ├── __init__.py
|   |   |   |   └── geojson.py
|   |   |   ├── shortcuts.py
|   |   |   ├── sitemaps
|   |   |   |   ├── __init__.py
|   |   |   |   ├── kml.py
|   |   |   |   └── views.py
|   |   |   ├── static
|   |   |   |   └── gis
|   |   |   ├── templates
|   |   |   |   └── gis
|   |   |   ├── utils
|   |   |   |   ├── __init__.py
|   |   |   |   ├── layermapping.py
|   |   |   |   ├── ogrinfo.py
|   |   |   |   ├── ogrinspect.py
|   |   |   |   └── srs.py
|   |   |   └── views.py
|   |   ├── humanize
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   └── templatetags
|   |   |       ├── __init__.py
|   |   |       └── humanize.py
|   |   ├── messages
|   |   |   ├── __init__.py
|   |   |   ├── api.py
|   |   |   ├── apps.py
|   |   |   ├── constants.py
|   |   |   ├── context_processors.py
|   |   |   ├── middleware.py
|   |   |   ├── storage
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cookie.py
|   |   |   |   ├── fallback.py
|   |   |   |   └── session.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   ├── postgres
|   |   |   ├── __init__.py
|   |   |   ├── aggregates
|   |   |   |   ├── __init__.py
|   |   |   |   ├── general.py
|   |   |   |   ├── mixins.py
|   |   |   |   └── statistics.py
|   |   |   ├── apps.py
|   |   |   ├── constraints.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── citext.py
|   |   |   |   ├── hstore.py
|   |   |   |   ├── jsonb.py
|   |   |   |   ├── ranges.py
|   |   |   |   └── utils.py
|   |   |   ├── forms
|   |   |   |   ├── __init__.py
|   |   |   |   ├── array.py
|   |   |   |   ├── hstore.py
|   |   |   |   └── ranges.py
|   |   |   ├── functions.py
|   |   |   ├── indexes.py
|   |   |   ├── jinja2
|   |   |   |   └── postgres
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kk
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── ms
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── tg
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── uk
|   |   |   |   ├── uz
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── lookups.py
|   |   |   ├── operations.py
|   |   |   ├── search.py
|   |   |   ├── serializers.py
|   |   |   ├── signals.py
|   |   |   ├── templates
|   |   |   |   └── postgres
|   |   |   ├── utils.py
|   |   |   └── validators.py
|   |   ├── redirects
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_redirect_new_path_help_text.py
|   |   |   |   └── __init__.py
|   |   |   └── models.py
|   |   ├── sessions
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── cache.py
|   |   |   |   ├── cached_db.py
|   |   |   |   ├── db.py
|   |   |   |   ├── file.py
|   |   |   |   └── signed_cookies.py
|   |   |   ├── base_session.py
|   |   |   ├── exceptions.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   └── serializers.py
|   |   ├── sitemaps
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── templates
|   |   |   |   ├── sitemap.xml
|   |   |   |   └── sitemap_index.xml
|   |   |   └── views.py
|   |   ├── sites
|   |   |   ├── __init__.py
|   |   |   ├── admin.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── locale
|   |   |   |   ├── af
|   |   |   |   ├── ar
|   |   |   |   ├── ar_DZ
|   |   |   |   ├── ast
|   |   |   |   ├── az
|   |   |   |   ├── be
|   |   |   |   ├── bg
|   |   |   |   ├── bn
|   |   |   |   ├── br
|   |   |   |   ├── bs
|   |   |   |   ├── ca
|   |   |   |   ├── cs
|   |   |   |   ├── cy
|   |   |   |   ├── da
|   |   |   |   ├── de
|   |   |   |   ├── dsb
|   |   |   |   ├── el
|   |   |   |   ├── en
|   |   |   |   ├── en_AU
|   |   |   |   ├── en_GB
|   |   |   |   ├── eo
|   |   |   |   ├── es
|   |   |   |   ├── es_AR
|   |   |   |   ├── es_CO
|   |   |   |   ├── es_MX
|   |   |   |   ├── es_VE
|   |   |   |   ├── et
|   |   |   |   ├── eu
|   |   |   |   ├── fa
|   |   |   |   ├── fi
|   |   |   |   ├── fr
|   |   |   |   ├── fy
|   |   |   |   ├── ga
|   |   |   |   ├── gd
|   |   |   |   ├── gl
|   |   |   |   ├── he
|   |   |   |   ├── hi
|   |   |   |   ├── hr
|   |   |   |   ├── hsb
|   |   |   |   ├── hu
|   |   |   |   ├── hy
|   |   |   |   ├── ia
|   |   |   |   ├── id
|   |   |   |   ├── io
|   |   |   |   ├── is
|   |   |   |   ├── it
|   |   |   |   ├── ja
|   |   |   |   ├── ka
|   |   |   |   ├── kab
|   |   |   |   ├── kk
|   |   |   |   ├── km
|   |   |   |   ├── kn
|   |   |   |   ├── ko
|   |   |   |   ├── ky
|   |   |   |   ├── lb
|   |   |   |   ├── lt
|   |   |   |   ├── lv
|   |   |   |   ├── mk
|   |   |   |   ├── ml
|   |   |   |   ├── mn
|   |   |   |   ├── mr
|   |   |   |   ├── ms
|   |   |   |   ├── my
|   |   |   |   ├── nb
|   |   |   |   ├── ne
|   |   |   |   ├── nl
|   |   |   |   ├── nn
|   |   |   |   ├── os
|   |   |   |   ├── pa
|   |   |   |   ├── pl
|   |   |   |   ├── pt
|   |   |   |   ├── pt_BR
|   |   |   |   ├── ro
|   |   |   |   ├── ru
|   |   |   |   ├── sk
|   |   |   |   ├── sl
|   |   |   |   ├── sq
|   |   |   |   ├── sr
|   |   |   |   ├── sr_Latn
|   |   |   |   ├── sv
|   |   |   |   ├── sw
|   |   |   |   ├── ta
|   |   |   |   ├── te
|   |   |   |   ├── tg
|   |   |   |   ├── th
|   |   |   |   ├── tk
|   |   |   |   ├── tr
|   |   |   |   ├── tt
|   |   |   |   ├── udm
|   |   |   |   ├── uk
|   |   |   |   ├── ur
|   |   |   |   ├── uz
|   |   |   |   ├── vi
|   |   |   |   ├── zh_Hans
|   |   |   |   └── zh_Hant
|   |   |   ├── management.py
|   |   |   ├── managers.py
|   |   |   ├── middleware.py
|   |   |   ├── migrations
|   |   |   |   ├── 0001_initial.py
|   |   |   |   ├── 0002_alter_domain_unique.py
|   |   |   |   └── __init__.py
|   |   |   ├── models.py
|   |   |   ├── requests.py
|   |   |   └── shortcuts.py
|   |   ├── staticfiles
|   |   |   ├── __init__.py
|   |   |   ├── apps.py
|   |   |   ├── checks.py
|   |   |   ├── finders.py
|   |   |   ├── handlers.py
|   |   |   ├── management
|   |   |   |   ├── __init__.py
|   |   |   |   └── commands
|   |   |   ├── storage.py
|   |   |   ├── testing.py
|   |   |   ├── urls.py
|   |   |   ├── utils.py
|   |   |   └── views.py
|   |   └── syndication
|   |       ├── __init__.py
|   |       ├── apps.py
|   |       └── views.py
|   ├── core
|   |   ├── __init__.py
|   |   ├── asgi.py
|   |   ├── cache
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── db.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   ├── memcached.py
|   |   |   |   └── redis.py
|   |   |   └── utils.py
|   |   ├── checks
|   |   |   ├── __init__.py
|   |   |   ├── async_checks.py
|   |   |   ├── caches.py
|   |   |   ├── compatibility
|   |   |   |   ├── __init__.py
|   |   |   |   └── django_4_0.py
|   |   |   ├── database.py
|   |   |   ├── files.py
|   |   |   ├── messages.py
|   |   |   ├── model_checks.py
|   |   |   ├── registry.py
|   |   |   ├── security
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── csrf.py
|   |   |   |   └── sessions.py
|   |   |   ├── templates.py
|   |   |   ├── translation.py
|   |   |   └── urls.py
|   |   ├── exceptions.py
|   |   ├── files
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── images.py
|   |   |   ├── locks.py
|   |   |   ├── move.py
|   |   |   ├── storage.py
|   |   |   ├── temp.py
|   |   |   ├── uploadedfile.py
|   |   |   ├── uploadhandler.py
|   |   |   └── utils.py
|   |   ├── handlers
|   |   |   ├── __init__.py
|   |   |   ├── asgi.py
|   |   |   ├── base.py
|   |   |   ├── exception.py
|   |   |   └── wsgi.py
|   |   ├── mail
|   |   |   ├── __init__.py
|   |   |   ├── backends
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── console.py
|   |   |   |   ├── dummy.py
|   |   |   |   ├── filebased.py
|   |   |   |   ├── locmem.py
|   |   |   |   └── smtp.py
|   |   |   ├── message.py
|   |   |   └── utils.py
|   |   ├── management
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── color.py
|   |   |   ├── commands
|   |   |   |   ├── __init__.py
|   |   |   |   ├── check.py
|   |   |   |   ├── compilemessages.py
|   |   |   |   ├── createcachetable.py
|   |   |   |   ├── dbshell.py
|   |   |   |   ├── diffsettings.py
|   |   |   |   ├── dumpdata.py
|   |   |   |   ├── flush.py
|   |   |   |   ├── inspectdb.py
|   |   |   |   ├── loaddata.py
|   |   |   |   ├── makemessages.py
|   |   |   |   ├── makemigrations.py
|   |   |   |   ├── migrate.py
|   |   |   |   ├── runserver.py
|   |   |   |   ├── sendtestemail.py
|   |   |   |   ├── shell.py
|   |   |   |   ├── showmigrations.py
|   |   |   |   ├── sqlflush.py
|   |   |   |   ├── sqlmigrate.py
|   |   |   |   ├── sqlsequencereset.py
|   |   |   |   ├── squashmigrations.py
|   |   |   |   ├── startapp.py
|   |   |   |   ├── startproject.py
|   |   |   |   ├── test.py
|   |   |   |   └── testserver.py
|   |   |   ├── sql.py
|   |   |   ├── templates.py
|   |   |   └── utils.py
|   |   ├── paginator.py
|   |   ├── serializers
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── json.py
|   |   |   ├── jsonl.py
|   |   |   ├── python.py
|   |   |   ├── pyyaml.py
|   |   |   └── xml_serializer.py
|   |   ├── servers
|   |   |   ├── __init__.py
|   |   |   └── basehttp.py
|   |   ├── signals.py
|   |   ├── signing.py
|   |   ├── validators.py
|   |   └── wsgi.py
|   ├── db
|   |   ├── __init__.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── ddl_references.py
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   └── features.py
|   |   |   ├── mysql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   └── validation.py
|   |   |   ├── oracle
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── functions.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   ├── schema.py
|   |   |   |   ├── utils.py
|   |   |   |   └── validation.py
|   |   |   ├── postgresql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   ├── signals.py
|   |   |   ├── sqlite3
|   |   |   |   ├── __init__.py
|   |   |   |   ├── _functions.py
|   |   |   |   ├── base.py
|   |   |   |   ├── client.py
|   |   |   |   ├── creation.py
|   |   |   |   ├── features.py
|   |   |   |   ├── introspection.py
|   |   |   |   ├── operations.py
|   |   |   |   └── schema.py
|   |   |   └── utils.py
|   |   ├── migrations
|   |   |   ├── __init__.py
|   |   |   ├── autodetector.py
|   |   |   ├── exceptions.py
|   |   |   ├── executor.py
|   |   |   ├── graph.py
|   |   |   ├── loader.py
|   |   |   ├── migration.py
|   |   |   ├── operations
|   |   |   |   ├── __init__.py
|   |   |   |   ├── base.py
|   |   |   |   ├── fields.py
|   |   |   |   ├── models.py
|   |   |   |   └── special.py
|   |   |   ├── optimizer.py
|   |   |   ├── questioner.py
|   |   |   ├── recorder.py
|   |   |   ├── serializer.py
|   |   |   ├── state.py
|   |   |   ├── utils.py
|   |   |   └── writer.py
|   |   ├── models
|   |   |   ├── __init__.py
|   |   |   ├── aggregates.py
|   |   |   ├── base.py
|   |   |   ├── constants.py
|   |   |   ├── constraints.py
|   |   |   ├── deletion.py
|   |   |   ├── enums.py
|   |   |   ├── expressions.py
|   |   |   ├── fields
|   |   |   |   ├── __init__.py
|   |   |   |   ├── files.py
|   |   |   |   ├── json.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── proxy.py
|   |   |   |   ├── related.py
|   |   |   |   ├── related_descriptors.py
|   |   |   |   ├── related_lookups.py
|   |   |   |   └── reverse_related.py
|   |   |   ├── functions
|   |   |   |   ├── __init__.py
|   |   |   |   ├── comparison.py
|   |   |   |   ├── datetime.py
|   |   |   |   ├── math.py
|   |   |   |   ├── mixins.py
|   |   |   |   ├── text.py
|   |   |   |   └── window.py
|   |   |   ├── indexes.py
|   |   |   ├── lookups.py
|   |   |   ├── manager.py
|   |   |   ├── options.py
|   |   |   ├── query.py
|   |   |   ├── query_utils.py
|   |   |   ├── signals.py
|   |   |   ├── sql
|   |   |   |   ├── __init__.py
|   |   |   |   ├── compiler.py
|   |   |   |   ├── constants.py
|   |   |   |   ├── datastructures.py
|   |   |   |   ├── query.py
|   |   |   |   ├── subqueries.py
|   |   |   |   └── where.py
|   |   |   └── utils.py
|   |   ├── transaction.py
|   |   └── utils.py
|   ├── dispatch
|   |   ├── __init__.py
|   |   ├── dispatcher.py
|   |   └── license.txt
|   ├── forms
|   |   ├── __init__.py
|   |   ├── boundfield.py
|   |   ├── fields.py
|   |   ├── forms.py
|   |   ├── formsets.py
|   |   ├── jinja2
|   |   |   └── django
|   |   |       └── forms
|   |   ├── models.py
|   |   ├── renderers.py
|   |   ├── templates
|   |   |   └── django
|   |   |       └── forms
|   |   ├── utils.py
|   |   └── widgets.py
|   ├── http
|   |   ├── __init__.py
|   |   ├── cookie.py
|   |   ├── multipartparser.py
|   |   ├── request.py
|   |   └── response.py
|   ├── middleware
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── clickjacking.py
|   |   ├── common.py
|   |   ├── csrf.py
|   |   ├── gzip.py
|   |   ├── http.py
|   |   ├── locale.py
|   |   └── security.py
|   ├── shortcuts.py
|   ├── template
|   |   ├── __init__.py
|   |   ├── autoreload.py
|   |   ├── backends
|   |   |   ├── __init__.py
|   |   |   ├── base.py
|   |   |   ├── django.py
|   |   |   ├── dummy.py
|   |   |   ├── jinja2.py
|   |   |   └── utils.py
|   |   ├── base.py
|   |   ├── context.py
|   |   ├── context_processors.py
|   |   ├── defaultfilters.py
|   |   ├── defaulttags.py
|   |   ├── engine.py
|   |   ├── exceptions.py
|   |   ├── library.py
|   |   ├── loader.py
|   |   ├── loader_tags.py
|   |   ├── loaders
|   |   |   ├── __init__.py
|   |   |   ├── app_directories.py
|   |   |   ├── base.py
|   |   |   ├── cached.py
|   |   |   ├── filesystem.py
|   |   |   └── locmem.py
|   |   ├── response.py
|   |   ├── smartif.py
|   |   └── utils.py
|   ├── templatetags
|   |   ├── __init__.py
|   |   ├── cache.py
|   |   ├── i18n.py
|   |   ├── l10n.py
|   |   ├── static.py
|   |   └── tz.py
|   ├── test
|   |   ├── __init__.py
|   |   ├── client.py
|   |   ├── html.py
|   |   ├── runner.py
|   |   ├── selenium.py
|   |   ├── signals.py
|   |   ├── testcases.py
|   |   └── utils.py
|   ├── urls
|   |   ├── __init__.py
|   |   ├── base.py
|   |   ├── conf.py
|   |   ├── converters.py
|   |   ├── exceptions.py
|   |   ├── resolvers.py
|   |   └── utils.py
|   ├── utils
|   |   ├── __init__.py
|   |   ├── _os.py
|   |   ├── archive.py
|   |   ├── asyncio.py
|   |   ├── autoreload.py
|   |   ├── baseconv.py
|   |   ├── cache.py
|   |   ├── connection.py
|   |   ├── crypto.py
|   |   ├── datastructures.py
|   |   ├── dateformat.py
|   |   ├── dateparse.py
|   |   ├── dates.py
|   |   ├── datetime_safe.py
|   |   ├── deconstruct.py
|   |   ├── decorators.py
|   |   ├── deprecation.py
|   |   ├── duration.py
|   |   ├── encoding.py
|   |   ├── feedgenerator.py
|   |   ├── formats.py
|   |   ├── functional.py
|   |   ├── hashable.py
|   |   ├── html.py
|   |   ├── http.py
|   |   ├── inspect.py
|   |   ├── ipv6.py
|   |   ├── itercompat.py
|   |   ├── jslex.py
|   |   ├── log.py
|   |   ├── lorem_ipsum.py
|   |   ├── module_loading.py
|   |   ├── numberformat.py
|   |   ├── regex_helper.py
|   |   ├── safestring.py
|   |   ├── termcolors.py
|   |   ├── text.py
|   |   ├── timesince.py
|   |   ├── timezone.py
|   |   ├── topological_sort.py
|   |   ├── translation
|   |   |   ├── __init__.py
|   |   |   ├── reloader.py
|   |   |   ├── template.py
|   |   |   ├── trans_null.py
|   |   |   └── trans_real.py
|   |   ├── tree.py
|   |   ├── version.py
|   |   └── xmlutils.py
|   └── views
|       ├── __init__.py
|       ├── csrf.py
|       ├── debug.py
|       ├── decorators
|       |   ├── __init__.py
|       |   ├── cache.py
|       |   ├── clickjacking.py
|       |   ├── common.py
|       |   ├── csrf.py
|       |   ├── debug.py
|       |   ├── gzip.py
|       |   ├── http.py
|       |   └── vary.py
|       ├── defaults.py
|       ├── generic
|       |   ├── __init__.py
|       |   ├── base.py
|       |   ├── dates.py
|       |   ├── detail.py
|       |   ├── edit.py
|       |   └── list.py
|       ├── i18n.py
|       ├── static.py
|       └── templates
|           ├── default_urlconf.html
|           ├── technical_404.html
|           ├── technical_500.html
|           └── technical_500.txt
├── docs
|   ├── README.rst
|   ├── _ext
|   |   └── djangodocs.py
|   ├── _theme
|   |   ├── djangodocs
|   |   |   ├── genindex.html
|   |   |   ├── layout.html
|   |   |   ├── modindex.html
|   |   |   ├── search.html
|   |   |   └── static
|   |   |       ├── console-tabs.css
|   |   |       ├── default.css
|   |   |       ├── djangodocs.css
|   |   |       ├── fontawesome
|   |   |       ├── homepage.css
|   |   |       └── reset-fonts-grids.css
|   |   └── djangodocs-epub
|   |       ├── epub-cover.html
|   |       └── static
|   |           └── epub.css
|   ├── conf.py
|   ├── contents.txt
|   ├── faq
|   |   ├── admin.txt
|   |   ├── contributing.txt
|   |   ├── general.txt
|   |   ├── help.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── models.txt
|   |   ├── troubleshooting.txt
|   |   └── usage.txt
|   ├── glossary.txt
|   ├── howto
|   |   ├── _images
|   |   ├── auth-remote-user.txt
|   |   ├── custom-file-storage.txt
|   |   ├── custom-lookups.txt
|   |   ├── custom-management-commands.txt
|   |   ├── custom-model-fields.txt
|   |   ├── custom-template-backend.txt
|   |   ├── custom-template-tags.txt
|   |   ├── deployment
|   |   |   ├── asgi
|   |   |   |   ├── daphne.txt
|   |   |   |   ├── hypercorn.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── uvicorn.txt
|   |   |   ├── checklist.txt
|   |   |   ├── index.txt
|   |   |   └── wsgi
|   |   |       ├── apache-auth.txt
|   |   |       ├── gunicorn.txt
|   |   |       ├── index.txt
|   |   |       ├── modwsgi.txt
|   |   |       └── uwsgi.txt
|   |   ├── error-reporting.txt
|   |   ├── index.txt
|   |   ├── initial-data.txt
|   |   ├── legacy-databases.txt
|   |   ├── logging.txt
|   |   ├── outputting-csv.txt
|   |   ├── outputting-pdf.txt
|   |   ├── overriding-templates.txt
|   |   ├── static-files
|   |   |   ├── deployment.txt
|   |   |   └── index.txt
|   |   ├── upgrade-version.txt
|   |   ├── windows.txt
|   |   └── writing-migrations.txt
|   ├── index.txt
|   ├── internals
|   |   ├── _images
|   |   ├── contributing
|   |   |   ├── bugs-and-features.txt
|   |   |   ├── committing-code.txt
|   |   |   ├── index.txt
|   |   |   ├── localizing.txt
|   |   |   ├── new-contributors.txt
|   |   |   ├── triaging-tickets.txt
|   |   |   ├── writing-code
|   |   |   |   ├── coding-style.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── javascript.txt
|   |   |   |   ├── submitting-patches.txt
|   |   |   |   ├── unit-tests.txt
|   |   |   |   └── working-with-git.txt
|   |   |   └── writing-documentation.txt
|   |   ├── deprecation.txt
|   |   ├── git.txt
|   |   ├── howto-release-django.txt
|   |   ├── index.txt
|   |   ├── mailing-lists.txt
|   |   ├── organization.txt
|   |   ├── release-process.txt
|   |   └── security.txt
|   ├── intro
|   |   ├── _images
|   |   ├── contributing.txt
|   |   ├── index.txt
|   |   ├── install.txt
|   |   ├── overview.txt
|   |   ├── reusable-apps.txt
|   |   ├── tutorial01.txt
|   |   ├── tutorial02.txt
|   |   ├── tutorial03.txt
|   |   ├── tutorial04.txt
|   |   ├── tutorial05.txt
|   |   ├── tutorial06.txt
|   |   ├── tutorial07.txt
|   |   └── whatsnext.txt
|   ├── man
|   ├── misc
|   |   ├── api-stability.txt
|   |   ├── design-philosophies.txt
|   |   ├── distributions.txt
|   |   └── index.txt
|   ├── ref
|   |   ├── applications.txt
|   |   ├── checks.txt
|   |   ├── class-based-views
|   |   |   ├── base.txt
|   |   |   ├── flattened-index.txt
|   |   |   ├── generic-date-based.txt
|   |   |   ├── generic-display.txt
|   |   |   ├── generic-editing.txt
|   |   |   ├── index.txt
|   |   |   ├── mixins-date-based.txt
|   |   |   ├── mixins-editing.txt
|   |   |   ├── mixins-multiple-object.txt
|   |   |   ├── mixins-simple.txt
|   |   |   ├── mixins-single-object.txt
|   |   |   └── mixins.txt
|   |   ├── clickjacking.txt
|   |   ├── contrib
|   |   |   ├── admin
|   |   |   |   ├── _images
|   |   |   |   ├── actions.txt
|   |   |   |   ├── admindocs.txt
|   |   |   |   ├── filters.txt
|   |   |   |   ├── index.txt
|   |   |   |   └── javascript.txt
|   |   |   ├── auth.txt
|   |   |   ├── contenttypes.txt
|   |   |   ├── flatpages.txt
|   |   |   ├── gis
|   |   |   |   ├── admin.txt
|   |   |   |   ├── commands.txt
|   |   |   |   ├── db-api.txt
|   |   |   |   ├── deployment.txt
|   |   |   |   ├── feeds.txt
|   |   |   |   ├── forms-api.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── gdal.txt
|   |   |   |   ├── geoip2.txt
|   |   |   |   ├── geoquerysets.txt
|   |   |   |   ├── geos.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── install
|   |   |   |   ├── layermapping.txt
|   |   |   |   ├── measure.txt
|   |   |   |   ├── model-api.txt
|   |   |   |   ├── ogrinspect.txt
|   |   |   |   ├── serializers.txt
|   |   |   |   ├── sitemaps.txt
|   |   |   |   ├── testing.txt
|   |   |   |   ├── tutorial.txt
|   |   |   |   └── utils.txt
|   |   |   ├── humanize.txt
|   |   |   ├── index.txt
|   |   |   ├── messages.txt
|   |   |   ├── postgres
|   |   |   |   ├── aggregates.txt
|   |   |   |   ├── constraints.txt
|   |   |   |   ├── expressions.txt
|   |   |   |   ├── fields.txt
|   |   |   |   ├── forms.txt
|   |   |   |   ├── functions.txt
|   |   |   |   ├── index.txt
|   |   |   |   ├── indexes.txt
|   |   |   |   ├── lookups.txt
|   |   |   |   ├── operations.txt
|   |   |   |   ├── search.txt
|   |   |   |   └── validators.txt
|   |   |   ├── redirects.txt
|   |   |   ├── sitemaps.txt
|   |   |   ├── sites.txt
|   |   |   ├── staticfiles.txt
|   |   |   └── syndication.txt
|   |   ├── csrf.txt
|   |   ├── databases.txt
|   |   ├── django-admin.txt
|   |   ├── exceptions.txt
|   |   ├── files
|   |   |   ├── file.txt
|   |   |   ├── index.txt
|   |   |   ├── storage.txt
|   |   |   └── uploads.txt
|   |   ├── forms
|   |   |   ├── api.txt
|   |   |   ├── fields.txt
|   |   |   ├── formsets.txt
|   |   |   ├── index.txt
|   |   |   ├── models.txt
|   |   |   ├── renderers.txt
|   |   |   ├── validation.txt
|   |   |   └── widgets.txt
|   |   ├── index.txt
|   |   ├── logging.txt
|   |   ├── middleware.txt
|   |   ├── migration-operations.txt
|   |   ├── models
|   |   |   ├── class.txt
|   |   |   ├── conditional-expressions.txt
|   |   |   ├── constraints.txt
|   |   |   ├── database-functions.txt
|   |   |   ├── expressions.txt
|   |   |   ├── fields.txt
|   |   |   ├── index.txt
|   |   |   ├── indexes.txt
|   |   |   ├── instances.txt
|   |   |   ├── lookups.txt
|   |   |   ├── meta.txt
|   |   |   ├── options.txt
|   |   |   ├── querysets.txt
|   |   |   └── relations.txt
|   |   ├── paginator.txt
|   |   ├── request-response.txt
|   |   ├── schema-editor.txt
|   |   ├── settings.txt
|   |   ├── signals.txt
|   |   ├── template-response.txt
|   |   ├── templates
|   |   |   ├── api.txt
|   |   |   ├── builtins.txt
|   |   |   ├── index.txt
|   |   |   └── language.txt
|   |   ├── unicode.txt
|   |   ├── urlresolvers.txt
|   |   ├── urls.txt
|   |   ├── utils.txt
|   |   ├── validators.txt
|   |   └── views.txt
|   ├── releases
|   |   ├── 0.95.txt
|   |   ├── 0.96.txt
|   |   ├── 1.0-porting-guide.txt
|   |   ├── 1.0.1.txt
|   |   ├── 1.0.2.txt
|   |   ├── 1.0.txt
|   |   ├── 1.1.2.txt
|   |   ├── 1.1.3.txt
|   |   ├── 1.1.4.txt
|   |   ├── 1.1.txt
|   |   ├── 1.10.1.txt
|   |   ├── 1.10.2.txt
|   |   ├── 1.10.3.txt
|   |   ├── 1.10.4.txt
|   |   ├── 1.10.5.txt
|   |   ├── 1.10.6.txt
|   |   ├── 1.10.7.txt
|   |   ├── 1.10.8.txt
|   |   ├── 1.10.txt
|   |   ├── 1.11.1.txt
|   |   ├── 1.11.10.txt
|   |   ├── 1.11.11.txt
|   |   ├── 1.11.12.txt
|   |   ├── 1.11.13.txt
|   |   ├── 1.11.14.txt
|   |   ├── 1.11.15.txt
|   |   ├── 1.11.16.txt
|   |   ├── 1.11.17.txt
|   |   ├── 1.11.18.txt
|   |   ├── 1.11.19.txt
|   |   ├── 1.11.2.txt
|   |   ├── 1.11.20.txt
|   |   ├── 1.11.21.txt
|   |   ├── 1.11.22.txt
|   |   ├── 1.11.23.txt
|   |   ├── 1.11.24.txt
|   |   ├── 1.11.25.txt
|   |   ├── 1.11.26.txt
|   |   ├── 1.11.27.txt
|   |   ├── 1.11.28.txt
|   |   ├── 1.11.29.txt
|   |   ├── 1.11.3.txt
|   |   ├── 1.11.4.txt
|   |   ├── 1.11.5.txt
|   |   ├── 1.11.6.txt
|   |   ├── 1.11.7.txt
|   |   ├── 1.11.8.txt
|   |   ├── 1.11.9.txt
|   |   ├── 1.11.txt
|   |   ├── 1.2.1.txt
|   |   ├── 1.2.2.txt
|   |   ├── 1.2.3.txt
|   |   ├── 1.2.4.txt
|   |   ├── 1.2.5.txt
|   |   ├── 1.2.6.txt
|   |   ├── 1.2.7.txt
|   |   ├── 1.2.txt
|   |   ├── 1.3.1.txt
|   |   ├── 1.3.2.txt
|   |   ├── 1.3.3.txt
|   |   ├── 1.3.4.txt
|   |   ├── 1.3.5.txt
|   |   ├── 1.3.6.txt
|   |   ├── 1.3.7.txt
|   |   ├── 1.3.txt
|   |   ├── 1.4.1.txt
|   |   ├── 1.4.10.txt
|   |   ├── 1.4.11.txt
|   |   ├── 1.4.12.txt
|   |   ├── 1.4.13.txt
|   |   ├── 1.4.14.txt
|   |   ├── 1.4.15.txt
|   |   ├── 1.4.16.txt
|   |   ├── 1.4.17.txt
|   |   ├── 1.4.18.txt
|   |   ├── 1.4.19.txt
|   |   ├── 1.4.2.txt
|   |   ├── 1.4.20.txt
|   |   ├── 1.4.21.txt
|   |   ├── 1.4.22.txt
|   |   ├── 1.4.3.txt
|   |   ├── 1.4.4.txt
|   |   ├── 1.4.5.txt
|   |   ├── 1.4.6.txt
|   |   ├── 1.4.7.txt
|   |   ├── 1.4.8.txt
|   |   ├── 1.4.9.txt
|   |   ├── 1.4.txt
|   |   ├── 1.5.1.txt
|   |   ├── 1.5.10.txt
|   |   ├── 1.5.11.txt
|   |   ├── 1.5.12.txt
|   |   ├── 1.5.2.txt
|   |   ├── 1.5.3.txt
|   |   ├── 1.5.4.txt
|   |   ├── 1.5.5.txt
|   |   ├── 1.5.6.txt
|   |   ├── 1.5.7.txt
|   |   ├── 1.5.8.txt
|   |   ├── 1.5.9.txt
|   |   ├── 1.5.txt
|   |   ├── 1.6.1.txt
|   |   ├── 1.6.10.txt
|   |   ├── 1.6.11.txt
|   |   ├── 1.6.2.txt
|   |   ├── 1.6.3.txt
|   |   ├── 1.6.4.txt
|   |   ├── 1.6.5.txt
|   |   ├── 1.6.6.txt
|   |   ├── 1.6.7.txt
|   |   ├── 1.6.8.txt
|   |   ├── 1.6.9.txt
|   |   ├── 1.6.txt
|   |   ├── 1.7.1.txt
|   |   ├── 1.7.10.txt
|   |   ├── 1.7.11.txt
|   |   ├── 1.7.2.txt
|   |   ├── 1.7.3.txt
|   |   ├── 1.7.4.txt
|   |   ├── 1.7.5.txt
|   |   ├── 1.7.6.txt
|   |   ├── 1.7.7.txt
|   |   ├── 1.7.8.txt
|   |   ├── 1.7.9.txt
|   |   ├── 1.7.txt
|   |   ├── 1.8.1.txt
|   |   ├── 1.8.10.txt
|   |   ├── 1.8.11.txt
|   |   ├── 1.8.12.txt
|   |   ├── 1.8.13.txt
|   |   ├── 1.8.14.txt
|   |   ├── 1.8.15.txt
|   |   ├── 1.8.16.txt
|   |   ├── 1.8.17.txt
|   |   ├── 1.8.18.txt
|   |   ├── 1.8.19.txt
|   |   ├── 1.8.2.txt
|   |   ├── 1.8.3.txt
|   |   ├── 1.8.4.txt
|   |   ├── 1.8.5.txt
|   |   ├── 1.8.6.txt
|   |   ├── 1.8.7.txt
|   |   ├── 1.8.8.txt
|   |   ├── 1.8.9.txt
|   |   ├── 1.8.txt
|   |   ├── 1.9.1.txt
|   |   ├── 1.9.10.txt
|   |   ├── 1.9.11.txt
|   |   ├── 1.9.12.txt
|   |   ├── 1.9.13.txt
|   |   ├── 1.9.2.txt
|   |   ├── 1.9.3.txt
|   |   ├── 1.9.4.txt
|   |   ├── 1.9.5.txt
|   |   ├── 1.9.6.txt
|   |   ├── 1.9.7.txt
|   |   ├── 1.9.8.txt
|   |   ├── 1.9.9.txt
|   |   ├── 1.9.txt
|   |   ├── 2.0.1.txt
|   |   ├── 2.0.10.txt
|   |   ├── 2.0.11.txt
|   |   ├── 2.0.12.txt
|   |   ├── 2.0.13.txt
|   |   ├── 2.0.2.txt
|   |   ├── 2.0.3.txt
|   |   ├── 2.0.4.txt
|   |   ├── 2.0.5.txt
|   |   ├── 2.0.6.txt
|   |   ├── 2.0.7.txt
|   |   ├── 2.0.8.txt
|   |   ├── 2.0.9.txt
|   |   ├── 2.0.txt
|   |   ├── 2.1.1.txt
|   |   ├── 2.1.10.txt
|   |   ├── 2.1.11.txt
|   |   ├── 2.1.12.txt
|   |   ├── 2.1.13.txt
|   |   ├── 2.1.14.txt
|   |   ├── 2.1.15.txt
|   |   ├── 2.1.2.txt
|   |   ├── 2.1.3.txt
|   |   ├── 2.1.4.txt
|   |   ├── 2.1.5.txt
|   |   ├── 2.1.6.txt
|   |   ├── 2.1.7.txt
|   |   ├── 2.1.8.txt
|   |   ├── 2.1.9.txt
|   |   ├── 2.1.txt
|   |   ├── 2.2.1.txt
|   |   ├── 2.2.10.txt
|   |   ├── 2.2.11.txt
|   |   ├── 2.2.12.txt
|   |   ├── 2.2.13.txt
|   |   ├── 2.2.14.txt
|   |   ├── 2.2.15.txt
|   |   ├── 2.2.16.txt
|   |   ├── 2.2.17.txt
|   |   ├── 2.2.18.txt
|   |   ├── 2.2.19.txt
|   |   ├── 2.2.2.txt
|   |   ├── 2.2.20.txt
|   |   ├── 2.2.21.txt
|   |   ├── 2.2.22.txt
|   |   ├── 2.2.23.txt
|   |   ├── 2.2.24.txt
|   |   ├── 2.2.25.txt
|   |   ├── 2.2.26.txt
|   |   ├── 2.2.3.txt
|   |   ├── 2.2.4.txt
|   |   ├── 2.2.5.txt
|   |   ├── 2.2.6.txt
|   |   ├── 2.2.7.txt
|   |   ├── 2.2.8.txt
|   |   ├── 2.2.9.txt
|   |   ├── 2.2.txt
|   |   ├── 3.0.1.txt
|   |   ├── 3.0.10.txt
|   |   ├── 3.0.11.txt
|   |   ├── 3.0.12.txt
|   |   ├── 3.0.13.txt
|   |   ├── 3.0.14.txt
|   |   ├── 3.0.2.txt
|   |   ├── 3.0.3.txt
|   |   ├── 3.0.4.txt
|   |   ├── 3.0.5.txt
|   |   ├── 3.0.6.txt
|   |   ├── 3.0.7.txt
|   |   ├── 3.0.8.txt
|   |   ├── 3.0.9.txt
|   |   ├── 3.0.txt
|   |   ├── 3.1.1.txt
|   |   ├── 3.1.10.txt
|   |   ├── 3.1.11.txt
|   |   ├── 3.1.12.txt
|   |   ├── 3.1.13.txt
|   |   ├── 3.1.14.txt
|   |   ├── 3.1.2.txt
|   |   ├── 3.1.3.txt
|   |   ├── 3.1.4.txt
|   |   ├── 3.1.5.txt
|   |   ├── 3.1.6.txt
|   |   ├── 3.1.7.txt
|   |   ├── 3.1.8.txt
|   |   ├── 3.1.9.txt
|   |   ├── 3.1.txt
|   |   ├── 3.2.1.txt
|   |   ├── 3.2.10.txt
|   |   ├── 3.2.11.txt
|   |   ├── 3.2.2.txt
|   |   ├── 3.2.3.txt
|   |   ├── 3.2.4.txt
|   |   ├── 3.2.5.txt
|   |   ├── 3.2.6.txt
|   |   ├── 3.2.7.txt
|   |   ├── 3.2.8.txt
|   |   ├── 3.2.9.txt
|   |   ├── 3.2.txt
|   |   ├── 4.0.1.txt
|   |   ├── 4.0.2.txt
|   |   ├── 4.0.txt
|   |   ├── 4.1.txt
|   |   ├── index.txt
|   |   └── security.txt
|   ├── requirements.txt
|   └── topics
|       ├── async.txt
|       ├── auth
|       |   ├── customizing.txt
|       |   ├── default.txt
|       |   ├── index.txt
|       |   └── passwords.txt
|       ├── cache.txt
|       ├── checks.txt
|       ├── class-based-views
|       |   ├── generic-display.txt
|       |   ├── generic-editing.txt
|       |   ├── index.txt
|       |   ├── intro.txt
|       |   └── mixins.txt
|       ├── conditional-view-processing.txt
|       ├── db
|       |   ├── aggregation.txt
|       |   ├── examples
|       |   |   ├── index.txt
|       |   |   ├── many_to_many.txt
|       |   |   ├── many_to_one.txt
|       |   |   └── one_to_one.txt
|       |   ├── index.txt
|       |   ├── instrumentation.txt
|       |   ├── managers.txt
|       |   ├── models.txt
|       |   ├── multi-db.txt
|       |   ├── optimization.txt
|       |   ├── queries.txt
|       |   ├── search.txt
|       |   ├── sql.txt
|       |   ├── tablespaces.txt
|       |   └── transactions.txt
|       ├── email.txt
|       ├── external-packages.txt
|       ├── files.txt
|       ├── forms
|       |   ├── formsets.txt
|       |   ├── index.txt
|       |   ├── media.txt
|       |   └── modelforms.txt
|       ├── http
|       |   ├── _images
|       |   ├── decorators.txt
|       |   ├── file-uploads.txt
|       |   ├── generic-views.txt
|       |   ├── index.txt
|       |   ├── middleware.txt
|       |   ├── sessions.txt
|       |   ├── shortcuts.txt
|       |   ├── urls.txt
|       |   └── views.txt
|       ├── i18n
|       |   ├── formatting.txt
|       |   ├── index.txt
|       |   ├── timezones.txt
|       |   └── translation.txt
|       ├── index.txt
|       ├── install.txt
|       ├── logging.txt
|       ├── migrations.txt
|       ├── pagination.txt
|       ├── performance.txt
|       ├── security.txt
|       ├── serialization.txt
|       ├── settings.txt
|       ├── signals.txt
|       ├── signing.txt
|       ├── templates.txt
|       └── testing
|           ├── _images
|           ├── advanced.txt
|           ├── index.txt
|           ├── overview.txt
|           └── tools.txt
├── extras
├── js_tests
|   ├── admin
|   |   ├── DateTimeShortcuts.test.js
|   |   ├── SelectBox.test.js
|   |   ├── SelectFilter2.test.js
|   |   ├── URLify.test.js
|   |   ├── actions.test.js
|   |   ├── core.test.js
|   |   ├── inlines.test.js
|   |   ├── jsi18n-mocks.test.js
|   |   └── navigation.test.js
|   ├── gis
|   |   └── mapwidget.test.js
|   └── tests.html
├── scripts
|   ├── manage_translations.py
|   └── rpm-install.sh
├── setup.py
└── tests
    ├── README.rst
    ├── absolute_url_overrides
    |   ├── __init__.py
    |   └── tests.py
    ├── admin_autodiscover
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_changelist
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_date_hierarchy.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_checks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_custom_urls
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_default_site
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── sites.py
    |   └── tests.py
    ├── admin_docs
    |   ├── __init__.py
    |   ├── evilfile.txt
    |   ├── models.py
    |   ├── namespace_urls.py
    |   ├── test_middleware.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_filters
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_inlines
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_templates.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_registration
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── admin_scripts
    |   ├── __init__.py
    |   ├── another_app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_raising_messages
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_raising_warning
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app_waiting_migration
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── models.py
    |   ├── app_with_import
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── broken_app
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── complex_app
    |   |   ├── __init__.py
    |   |   ├── admin
    |   |   |   ├── __init__.py
    |   |   |   └── foo.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models
    |   |       ├── __init__.py
    |   |       ├── bar.py
    |   |       └── foo.py
    |   ├── configured_dynamic_settings_manage.py
    |   ├── configured_settings_manage.py
    |   ├── custom_templates
    |   |   ├── app_template
    |   |   |   ├── __init__.py
    |   |   |   └── api.py
    |   |   └── project_template
    |   |       ├── .hidden
    |   |       ├── additional_dir
    |   |       ├── project_name
    |   |       └── ticket-18091-non-ascii-template.txt
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       ├── app_command.py
    |   |       ├── base_command.py
    |   |       ├── custom_startproject.py
    |   |       ├── label_command.py
    |   |       ├── noargs_command.py
    |   |       └── suppress_base_options_command.py
    |   ├── simple_app
    |   |   ├── __init__.py
    |   |   ├── management
    |   |   |   ├── __init__.py
    |   |   |   └── commands
    |   |   └── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_utils
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── test_logentry.py
    |   ├── tests.py
    |   └── urls.py
    ├── admin_views
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── custom_has_permission_admin.py
    |   ├── customadmin.py
    |   ├── forms.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── admin
    |   |   |   ├── admin_views
    |   |   |   └── base_site.html
    |   |   └── custom_filter_template.html
    |   ├── test_actions.py
    |   ├── test_adminsite.py
    |   ├── test_autocomplete_view.py
    |   ├── test_forms.py
    |   ├── test_history_view.py
    |   ├── test_multidb.py
    |   ├── test_nav_sidebar.py
    |   ├── test_templatetags.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── admin_widgets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autocomplete_widget.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── widgetadmin.py
    ├── aggregation
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_filter_argument.py
    |   └── tests.py
    ├── aggregation_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── annotations
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── app_loading
    |   ├── __init__.py
    |   ├── eggs
    |   ├── not_installed
    |   |   ├── __init__.py
    |   |   └── models.py
    |   └── tests.py
    ├── apps
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── namespace_package_base
    |   |   └── nsapp
    |   |       └── apps.py
    |   ├── namespace_package_other_base
    |   |   └── nsapp
    |   ├── no_config_app
    |   |   └── __init__.py
    |   ├── one_config_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── tests.py
    |   ├── two_configs_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   ├── two_configs_one_default_app
    |   |   ├── __init__.py
    |   |   └── apps.py
    |   └── two_default_configs_app
    |       ├── __init__.py
    |       └── apps.py
    ├── asgi
    |   ├── __init__.py
    |   ├── project
    |   |   └── static
    |   |       └── file.txt
    |   ├── tests.py
    |   └── urls.py
    ├── async
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── auth_tests
    |   ├── __init__.py
    |   ├── backend_alias.py
    |   ├── client.py
    |   ├── common-passwords-custom.txt
    |   ├── fixtures
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── custom_permissions.py
    |   |   ├── custom_user.py
    |   |   ├── invalid_models.py
    |   |   ├── is_active.py
    |   |   ├── minimal.py
    |   |   ├── no_password.py
    |   |   ├── proxy.py
    |   |   ├── uuid_pk.py
    |   |   ├── with_custom_email_field.py
    |   |   ├── with_foreign_key.py
    |   |   ├── with_integer_username.py
    |   |   ├── with_last_login_attr.py
    |   |   └── with_many_to_many.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── context_processors
    |   |   |   ├── auth_attrs_access.html
    |   |   |   ├── auth_attrs_messages.html
    |   |   |   ├── auth_attrs_no_access.html
    |   |   |   ├── auth_attrs_perm_in_perms.html
    |   |   |   ├── auth_attrs_perms.html
    |   |   |   ├── auth_attrs_test_access.html
    |   |   |   └── auth_attrs_user.html
    |   |   └── registration
    |   |       ├── html_password_reset_email.html
    |   |       ├── logged_out.html
    |   |       ├── login.html
    |   |       ├── password_change_form.html
    |   |       ├── password_reset_complete.html
    |   |       ├── password_reset_confirm.html
    |   |       ├── password_reset_done.html
    |   |       ├── password_reset_email.html
    |   |       ├── password_reset_form.html
    |   |       └── password_reset_subject.txt
    |   ├── test_admin_multidb.py
    |   ├── test_auth_backends.py
    |   ├── test_basic.py
    |   ├── test_checks.py
    |   ├── test_context_processors.py
    |   ├── test_decorators.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_hashers.py
    |   ├── test_management.py
    |   ├── test_middleware.py
    |   ├── test_migrations.py
    |   ├── test_mixins.py
    |   ├── test_models.py
    |   ├── test_remote_user.py
    |   ├── test_signals.py
    |   ├── test_templates.py
    |   ├── test_tokens.py
    |   ├── test_validators.py
    |   ├── test_views.py
    |   ├── urls.py
    |   ├── urls_admin.py
    |   └── urls_custom_user_admin.py
    ├── backends
    |   ├── __init__.py
    |   ├── base
    |   |   ├── __init__.py
    |   |   ├── app_unmigrated
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── test_base.py
    |   |   ├── test_client.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── test_schema.py
    |   ├── models.py
    |   ├── mysql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_schema.py
    |   |   └── tests.py
    |   ├── oracle
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── postgresql
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   ├── test_server_side_cursors.py
    |   |   └── tests.py
    |   ├── sqlite
    |   |   ├── __init__.py
    |   |   ├── test_creation.py
    |   |   ├── test_features.py
    |   |   ├── test_functions.py
    |   |   ├── test_introspection.py
    |   |   ├── test_operations.py
    |   |   └── tests.py
    |   ├── test_ddl_references.py
    |   ├── test_utils.py
    |   └── tests.py
    ├── base
    |   ├── __init__.py
    |   └── models.py
    ├── bash_completion
    |   ├── __init__.py
    |   ├── management
    |   |   ├── __init__.py
    |   |   └── commands
    |   |       ├── __init__.py
    |   |       └── test_command.py
    |   └── tests.py
    ├── basic
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── builtin_server
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── bulk_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── cache
    |   ├── __init__.py
    |   ├── closeable_cache.py
    |   ├── liberal_backend.py
    |   ├── models.py
    |   ├── tests.py
    |   └── tests_async.py
    ├── check_framework
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models.py
    |   ├── template_test_apps
    |   |   ├── __init__.py
    |   |   ├── different_tags_app
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   ├── same_tags_app_1
    |   |   |   ├── __init__.py
    |   |   |   ├── apps.py
    |   |   |   └── templatetags
    |   |   └── same_tags_app_2
    |   |       ├── __init__.py
    |   |       ├── apps.py
    |   |       └── templatetags
    |   ├── test_4_0_compatibility.py
    |   ├── test_async_checks.py
    |   ├── test_caches.py
    |   ├── test_database.py
    |   ├── test_files.py
    |   ├── test_model_checks.py
    |   ├── test_model_field_deprecation.py
    |   ├── test_multi_db.py
    |   ├── test_security.py
    |   ├── test_templates.py
    |   ├── test_translation.py
    |   ├── test_urls.py
    |   ├── tests.py
    |   └── urls
    |       ├── __init__.py
    |       ├── bad_class_based_error_handlers.py
    |       ├── bad_error_handlers_invalid_path.py
    |       ├── bad_function_based_error_handlers.py
    |       ├── beginning_with_slash.py
    |       ├── cbv_as_view.py
    |       ├── contains_tuple.py
    |       ├── good_class_based_error_handlers.py
    |       ├── good_function_based_error_handlers.py
    |       ├── include_contains_tuple.py
    |       ├── include_with_dollar.py
    |       ├── name_with_colon.py
    |       ├── no_warnings.py
    |       ├── no_warnings_i18n.py
    |       ├── non_unique_namespaces.py
    |       ├── path_compatibility
    |       |   ├── __init__.py
    |       |   ├── beginning_with_caret.py
    |       |   ├── contains_re_named_group.py
    |       |   └── ending_with_dollar.py
    |       ├── unique_namespaces.py
    |       └── warning_in_include.py
    ├── conditional_processing
    |   ├── __init__.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── constraints
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── contenttypes_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── operations_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_rename_foo.py
    |   |   └── __init__.py
    |   ├── test_checks.py
    |   ├── test_fields.py
    |   ├── test_management.py
    |   ├── test_models.py
    |   ├── test_operations.py
    |   ├── test_order_with_respect_to.py
    |   ├── test_views.py
    |   └── urls.py
    ├── context_processors
    |   ├── __init__.py
    |   ├── models.py
    |   ├── templates
    |   |   └── context_processors
    |   |       ├── debug.html
    |   |       └── request_attrs.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── csrf_tests
    |   ├── __init__.py
    |   ├── csrf_token_error_handler_urls.py
    |   ├── test_context_processor.py
    |   ├── tests.py
    |   └── views.py
    ├── custom_columns
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_managers
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_methods
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── custom_migration_operations
    |   ├── __init__.py
    |   ├── more_operations.py
    |   └── operations.py
    ├── custom_pk
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   └── tests.py
    ├── datatypes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── dates
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── datetimes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── db_functions
    |   ├── __init__.py
    |   ├── comparison
    |   |   ├── __init__.py
    |   |   ├── test_cast.py
    |   |   ├── test_coalesce.py
    |   |   ├── test_collate.py
    |   |   ├── test_greatest.py
    |   |   ├── test_json_object.py
    |   |   ├── test_least.py
    |   |   └── test_nullif.py
    |   ├── datetime
    |   |   ├── __init__.py
    |   |   ├── test_extract_trunc.py
    |   |   └── test_now.py
    |   ├── math
    |   |   ├── __init__.py
    |   |   ├── test_abs.py
    |   |   ├── test_acos.py
    |   |   ├── test_asin.py
    |   |   ├── test_atan.py
    |   |   ├── test_atan2.py
    |   |   ├── test_ceil.py
    |   |   ├── test_cos.py
    |   |   ├── test_cot.py
    |   |   ├── test_degrees.py
    |   |   ├── test_exp.py
    |   |   ├── test_floor.py
    |   |   ├── test_ln.py
    |   |   ├── test_log.py
    |   |   ├── test_mod.py
    |   |   ├── test_pi.py
    |   |   ├── test_power.py
    |   |   ├── test_radians.py
    |   |   ├── test_random.py
    |   |   ├── test_round.py
    |   |   ├── test_sign.py
    |   |   ├── test_sin.py
    |   |   ├── test_sqrt.py
    |   |   └── test_tan.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── text
    |   |   ├── __init__.py
    |   |   ├── test_chr.py
    |   |   ├── test_concat.py
    |   |   ├── test_left.py
    |   |   ├── test_length.py
    |   |   ├── test_lower.py
    |   |   ├── test_md5.py
    |   |   ├── test_ord.py
    |   |   ├── test_pad.py
    |   |   ├── test_repeat.py
    |   |   ├── test_replace.py
    |   |   ├── test_reverse.py
    |   |   ├── test_right.py
    |   |   ├── test_sha1.py
    |   |   ├── test_sha224.py
    |   |   ├── test_sha256.py
    |   |   ├── test_sha384.py
    |   |   ├── test_sha512.py
    |   |   ├── test_strindex.py
    |   |   ├── test_substr.py
    |   |   ├── test_trim.py
    |   |   └── test_upper.py
    |   └── window
    |       ├── __init__.py
    |       └── test_validation.py
    ├── db_typecasts
    |   ├── __init__.py
    |   └── tests.py
    ├── db_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── dbshell
    |   ├── __init__.py
    |   ├── fake_client.py
    |   ├── test_mysql.py
    |   ├── test_oracle.py
    |   ├── test_postgresql.py
    |   ├── test_sqlite.py
    |   └── tests.py
    ├── decorators
    |   ├── __init__.py
    |   └── tests.py
    ├── defer
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── defer_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── delete_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── deprecation
    |   ├── __init__.py
    |   ├── test_csrf_cookie_masked.py
    |   ├── test_middleware_mixin.py
    |   ├── test_use_l10n.py
    |   └── tests.py
    ├── dispatch
    |   ├── __init__.py
    |   └── tests.py
    ├── distinct_on_fields
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── empty
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_models
    |   |   └── __init__.py
    |   └── tests.py
    ├── empty_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── test_commands.py
    ├── expressions
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_queryset_values.py
    |   └── tests.py
    ├── expressions_case
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── expressions_window
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── extra_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_deconstruction
    |   ├── __init__.py
    |   └── tests.py
    ├── field_defaults
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── field_subclassing
    |   ├── __init__.py
    |   ├── fields.py
    |   └── tests.py
    ├── file_storage
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_generate_filename.py
    |   ├── tests.py
    |   └── urls.py
    ├── file_uploads
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   ├── uploadhandler.py
    |   ├── urls.py
    |   └── views.py
    ├── files
    |   ├── __init__.py
    |   └── tests.py
    ├── filtered_relation
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── fixtures
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── fixture2.xml
    |   |   ├── fixture3.xml
    |   |   ├── fixture7.xml
    |   |   └── fixture9.xml
    |   ├── models.py
    |   └── tests.py
    ├── fixtures_model_package
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models
    |   |   └── __init__.py
    |   └── tests.py
    ├── fixtures_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   |   ├── animal.xml
    |   |   ├── bad_fixture2.xml
    |   |   ├── nk-inheritance2.xml
    |   |   ├── non_natural_2.xml
    |   |   ├── pretty.xml
    |   |   └── sequence_extra_xml.xml
    |   ├── fixtures_1
    |   |   └── inner
    |   ├── fixtures_2
    |   ├── models.py
    |   └── tests.py
    ├── flatpages_tests
    |   ├── __init__.py
    |   ├── absolute_urls.py
    |   ├── no_slash_urls.py
    |   ├── settings.py
    |   ├── templates
    |   |   ├── flatpages
    |   |   |   └── default.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_csrf.py
    |   ├── test_forms.py
    |   ├── test_middleware.py
    |   ├── test_models.py
    |   ├── test_sitemaps.py
    |   ├── test_templatetags.py
    |   ├── test_views.py
    |   └── urls.py
    ├── force_insert_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── foreign_object
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   ├── customers.py
    |   |   ├── empty_join.py
    |   |   └── person.py
    |   ├── test_agnostic_order_trimjoin.py
    |   ├── test_empty_join.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── forms_tests
    |   ├── __init__.py
    |   ├── field_tests
    |   |   ├── __init__.py
    |   |   ├── filepathfield_test_dir
    |   |   |   ├── __init__.py
    |   |   |   ├── a.py
    |   |   |   ├── ab.py
    |   |   |   ├── b.py
    |   |   |   ├── c
    |   |   |   ├── h
    |   |   |   └── j
    |   |   ├── test_base.py
    |   |   ├── test_booleanfield.py
    |   |   ├── test_charfield.py
    |   |   ├── test_choicefield.py
    |   |   ├── test_combofield.py
    |   |   ├── test_datefield.py
    |   |   ├── test_datetimefield.py
    |   |   ├── test_decimalfield.py
    |   |   ├── test_durationfield.py
    |   |   ├── test_emailfield.py
    |   |   ├── test_filefield.py
    |   |   ├── test_filepathfield.py
    |   |   ├── test_floatfield.py
    |   |   ├── test_genericipaddressfield.py
    |   |   ├── test_imagefield.py
    |   |   ├── test_integerfield.py
    |   |   ├── test_jsonfield.py
    |   |   ├── test_multiplechoicefield.py
    |   |   ├── test_multivaluefield.py
    |   |   ├── test_nullbooleanfield.py
    |   |   ├── test_regexfield.py
    |   |   ├── test_slugfield.py
    |   |   ├── test_splitdatetimefield.py
    |   |   ├── test_timefield.py
    |   |   ├── test_typedchoicefield.py
    |   |   ├── test_typedmultiplechoicefield.py
    |   |   ├── test_urlfield.py
    |   |   └── test_uuidfield.py
    |   ├── jinja2
    |   |   └── forms_tests
    |   |       └── custom_widget.html
    |   ├── models.py
    |   ├── templates
    |   |   └── forms_tests
    |   |       ├── article_form.html
    |   |       ├── custom_widget.html
    |   |       ├── cyclic_context_boundfield_render.html
    |   |       ├── error.html
    |   |       ├── form_snippet.html
    |   |       └── legend_test.html
    |   ├── templatetags
    |   |   ├── __init__.py
    |   |   └── tags.py
    |   ├── tests
    |   |   ├── __init__.py
    |   |   ├── filepath_test_files
    |   |   |   ├── directory
    |   |   |   └── real-text-file.txt
    |   |   ├── test_deprecation_forms.py
    |   |   ├── test_error_messages.py
    |   |   ├── test_forms.py
    |   |   ├── test_formsets.py
    |   |   ├── test_i18n.py
    |   |   ├── test_input_formats.py
    |   |   ├── test_media.py
    |   |   ├── test_renderers.py
    |   |   ├── test_utils.py
    |   |   ├── test_validators.py
    |   |   ├── test_widgets.py
    |   |   └── tests.py
    |   ├── urls.py
    |   ├── views.py
    |   └── widget_tests
    |       ├── __init__.py
    |       ├── base.py
    |       ├── test_checkboxinput.py
    |       ├── test_checkboxselectmultiple.py
    |       ├── test_clearablefileinput.py
    |       ├── test_dateinput.py
    |       ├── test_datetimeinput.py
    |       ├── test_fileinput.py
    |       ├── test_hiddeninput.py
    |       ├── test_input.py
    |       ├── test_multiplehiddeninput.py
    |       ├── test_multiwidget.py
    |       ├── test_nullbooleanselect.py
    |       ├── test_numberinput.py
    |       ├── test_passwordinput.py
    |       ├── test_radioselect.py
    |       ├── test_select.py
    |       ├── test_selectdatewidget.py
    |       ├── test_selectmultiple.py
    |       ├── test_splitdatetimewidget.py
    |       ├── test_splithiddendatetimewidget.py
    |       ├── test_textarea.py
    |       ├── test_textinput.py
    |       ├── test_timeinput.py
    |       └── test_widget.py
    ├── from_db_value
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_inline_admin
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── generic_relations
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_forms.py
    |   └── tests.py
    ├── generic_relations_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── generic_views
    |   ├── __init__.py
    |   ├── forms.py
    |   ├── jinja2
    |   |   └── generic_views
    |   |       └── using.html
    |   ├── models.py
    |   ├── templates
    |   |   ├── generic_views
    |   |   |   ├── about.html
    |   |   |   ├── apple_detail.html
    |   |   |   ├── artist_detail.html
    |   |   |   ├── artist_form.html
    |   |   |   ├── author_confirm_delete.html
    |   |   |   ├── author_detail.html
    |   |   |   ├── author_form.html
    |   |   |   ├── author_list.html
    |   |   |   ├── author_objects.html
    |   |   |   ├── author_view.html
    |   |   |   ├── book_archive.html
    |   |   |   ├── book_archive_day.html
    |   |   |   ├── book_archive_month.html
    |   |   |   ├── book_archive_week.html
    |   |   |   ├── book_archive_year.html
    |   |   |   ├── book_detail.html
    |   |   |   ├── book_list.html
    |   |   |   ├── confirm_delete.html
    |   |   |   ├── detail.html
    |   |   |   ├── form.html
    |   |   |   ├── list.html
    |   |   |   ├── page_template.html
    |   |   |   ├── robots.txt
    |   |   |   └── using.html
    |   |   └── registration
    |   |       └── login.html
    |   ├── test_base.py
    |   ├── test_dates.py
    |   ├── test_detail.py
    |   ├── test_edit.py
    |   ├── test_list.py
    |   ├── urls.py
    |   └── views.py
    ├── get_earliest_or_latest
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_object_or_404
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── get_or_create
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── gis_tests
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── data
    |   |   ├── __init__.py
    |   |   ├── ch-city
    |   |   ├── cities
    |   |   ├── counties
    |   |   ├── gas_lines
    |   |   ├── has_nulls
    |   |   ├── interstates
    |   |   ├── invalid
    |   |   ├── rasters
    |   |   |   ├── __init__.py
    |   |   |   ├── raster.numpy.txt
    |   |   |   └── textrasters.py
    |   |   ├── test_point
    |   |   ├── test_poly
    |   |   └── test_vrt
    |   ├── distapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── gdal_tests
    |   |   ├── __init__.py
    |   |   ├── test_driver.py
    |   |   ├── test_ds.py
    |   |   ├── test_envelope.py
    |   |   ├── test_geom.py
    |   |   ├── test_raster.py
    |   |   ├── test_srs.py
    |   |   └── tests.py
    |   ├── geo3d
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── views.py
    |   ├── geoadmin
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoadmin_deprecated
    |   |   ├── __init__.py
    |   |   ├── admin.py
    |   |   ├── models.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geoapp
    |   |   ├── __init__.py
    |   |   ├── feeds.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   ├── sitemaps.py
    |   |   ├── test_expressions.py
    |   |   ├── test_feeds.py
    |   |   ├── test_functions.py
    |   |   ├── test_indexes.py
    |   |   ├── test_regress.py
    |   |   ├── test_serializers.py
    |   |   ├── test_sitemaps.py
    |   |   ├── tests.py
    |   |   └── urls.py
    |   ├── geogapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── geos_tests
    |   |   ├── __init__.py
    |   |   ├── test_coordseq.py
    |   |   ├── test_geos.py
    |   |   ├── test_geos_mutation.py
    |   |   ├── test_io.py
    |   |   └── test_mutable_list.py
    |   ├── gis_migrations
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_create_models.py
    |   |   |   └── __init__.py
    |   |   ├── test_commands.py
    |   |   └── test_operations.py
    |   ├── inspectapp
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── layermap
    |   |   ├── __init__.py
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── models.py
    |   ├── rasterapp
    |   |   ├── __init__.py
    |   |   ├── migrations
    |   |   |   ├── 0001_setup_extensions.py
    |   |   |   ├── 0002_rastermodels.py
    |   |   |   └── __init__.py
    |   |   ├── models.py
    |   |   └── test_rasterfield.py
    |   ├── relatedapp
    |   |   ├── __init__.py
    |   |   ├── fixtures
    |   |   ├── models.py
    |   |   └── tests.py
    |   ├── test_data.py
    |   ├── test_fields.py
    |   ├── test_geoforms.py
    |   ├── test_geoip2.py
    |   ├── test_gis_tests_utils.py
    |   ├── test_measure.py
    |   ├── test_ptr.py
    |   ├── test_spatialrefsys.py
    |   ├── tests.py
    |   └── utils.py
    ├── handlers
    |   ├── __init__.py
    |   ├── templates
    |   |   └── test_handler.html
    |   ├── test_exception.py
    |   ├── tests.py
    |   ├── tests_custom_error_handlers.py
    |   ├── urls.py
    |   └── views.py
    ├── httpwrappers
    |   ├── __init__.py
    |   ├── abc.txt
    |   └── tests.py
    ├── humanize_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── i18n
    |   ├── __init__.py
    |   ├── commands
    |   |   ├── __init__.py
    |   |   ├── app_with_locale
    |   |   |   └── locale
    |   |   ├── ignore_dir
    |   |   |   └── ignored.html
    |   |   ├── javascript.js
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── es_AR
    |   |   |   ├── fr
    |   |   |   ├── hr
    |   |   |   ├── ja
    |   |   |   ├── ko
    |   |   |   ├── pt_BR
    |   |   |   ├── ru
    |   |   |   └── xxx
    |   |   ├── media_root
    |   |   |   └── media_ignored.html
    |   |   ├── someapp
    |   |   |   └── static
    |   |   ├── static
    |   |   |   ├── javascript_ignored.js
    |   |   |   └── static_ignored.html
    |   |   └── templates
    |   |       ├── empty.html
    |   |       ├── subdir
    |   |       ├── test.html
    |   |       └── xxx_ignored.html
    |   ├── contenttypes
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   └── fr
    |   |   └── tests.py
    |   ├── exclude
    |   |   ├── __init__.py
    |   |   └── canned_locale
    |   |       ├── en
    |   |       ├── fr
    |   |       └── it
    |   ├── forms.py
    |   ├── loading
    |   |   ├── en
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_AU
    |   |   |   └── LC_MESSAGES
    |   |   ├── en_CA
    |   |   |   └── LC_MESSAGES
    |   |   └── en_NZ
    |   |       └── LC_MESSAGES
    |   ├── loading_app
    |   |   ├── __init__.py
    |   |   ├── apps.py
    |   |   └── locale
    |   |       └── en
    |   ├── models.py
    |   ├── other
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       ├── de
    |   |       └── fr
    |   ├── other2
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── __init__.py
    |   |       └── de
    |   ├── patterns
    |   |   ├── __init__.py
    |   |   ├── locale
    |   |   |   ├── en
    |   |   |   ├── nl
    |   |   |   └── pt_BR
    |   |   ├── templates
    |   |   |   ├── 404.html
    |   |   |   └── dummy.html
    |   |   ├── tests.py
    |   |   └── urls
    |   |       ├── __init__.py
    |   |       ├── default.py
    |   |       ├── disabled.py
    |   |       ├── included.py
    |   |       ├── namespace.py
    |   |       ├── path_unused.py
    |   |       ├── wrong.py
    |   |       └── wrong_namespace.py
    |   ├── project_dir
    |   |   ├── __init__.py
    |   |   ├── app_no_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── models.py
    |   |   |   └── test.html
    |   |   ├── app_with_locale
    |   |   |   ├── __init__.py
    |   |   |   ├── locale
    |   |   |   └── models.py
    |   |   └── project_locale
    |   ├── resolution
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── sampleproject
    |   |   ├── locale
    |   |   |   └── fr
    |   |   ├── manage.py
    |   |   ├── sampleproject
    |   |   |   ├── __init__.py
    |   |   |   └── settings.py
    |   |   ├── templates
    |   |   |   └── percents.html
    |   |   └── update_catalogs.py
    |   ├── territorial_fallback
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       ├── de
    |   |       └── de_DE
    |   ├── test_compilation.py
    |   ├── test_extraction.py
    |   ├── test_management.py
    |   ├── test_percents.py
    |   ├── tests.py
    |   ├── unchanged
    |   |   ├── __init__.py
    |   |   └── locale
    |   |       └── de
    |   ├── urls.py
    |   ├── urls_default_unprefixed.py
    |   └── utils.py
    ├── import_error_package
    |   └── __init__.py
    ├── indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inline_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── inspectdb
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── introspection
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── invalid_models_tests
    |   ├── __init__.py
    |   ├── test_backend_specific.py
    |   ├── test_custom_fields.py
    |   ├── test_deprecated_fields.py
    |   ├── test_models.py
    |   ├── test_ordinary_fields.py
    |   └── test_relative_fields.py
    ├── known_related_objects
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── logging_tests
    |   ├── __init__.py
    |   ├── logconfig.py
    |   ├── tests.py
    |   ├── urls.py
    |   ├── urls_i18n.py
    |   └── views.py
    ├── lookup
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_decimalfield.py
    |   ├── test_lookups.py
    |   ├── test_timefield.py
    |   └── tests.py
    ├── m2m_and_m2o
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_intermediary
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_multiple
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── m2m_through_regress
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── test_multitable.py
    |   └── tests.py
    ├── m2o_recursive
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── mail
    |   ├── __init__.py
    |   ├── attachments
    |   |   ├── file.txt
    |   |   └── file_png.txt
    |   ├── custombackend.py
    |   ├── test_sendtestemail.py
    |   └── tests.py
    ├── managers_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_many
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── many_to_one_null
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── max_lengths
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── messages_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── test_api.py
    |   ├── test_cookie.py
    |   ├── test_fallback.py
    |   ├── test_middleware.py
    |   ├── test_mixins.py
    |   ├── test_session.py
    |   ├── tests.py
    |   └── urls.py
    ├── middleware
    |   ├── __init__.py
    |   ├── cond_get_urls.py
    |   ├── extra_urls.py
    |   ├── test_security.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── middleware_exceptions
    |   ├── __init__.py
    |   ├── middleware.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── migrate_signals
    |   ├── __init__.py
    |   ├── custom_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migration_test_data_persistence
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_add_book.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── migrations
    |   ├── __init__.py
    |   ├── deprecated_field_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_remove_ipaddressfield_ip.py
    |   |   └── __init__.py
    |   ├── faulty_migrations
    |   |   ├── __init__.py
    |   |   ├── file.py
    |   |   └── namespace
    |   |       └── foo
    |   ├── migrations_test_apps
    |   |   ├── __init__.py
    |   |   ├── alter_fk
    |   |   |   ├── __init__.py
    |   |   |   ├── author_app
    |   |   |   └── book_app
    |   |   ├── conflicting_app_with_dependencies
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── lookuperror_a
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_b
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── lookuperror_c
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── migrated_unapplied_app
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── mutate_state_a
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── mutate_state_b
    |   |   |   ├── __init__.py
    |   |   |   └── migrations
    |   |   ├── normal
    |   |   |   └── __init__.py
    |   |   ├── unmigrated_app
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_simple
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unmigrated_app_syncdb
    |   |   |   ├── __init__.py
    |   |   |   └── models.py
    |   |   ├── unspecified_app_with_conflict
    |   |   |   ├── __init__.py
    |   |   |   ├── migrations
    |   |   |   └── models.py
    |   |   ├── with_package_model
    |   |   |   ├── __init__.py
    |   |   |   └── models
    |   |   └── without_init_file
    |   |       ├── __init__.py
    |   |       └── migrations
    |   ├── models.py
    |   ├── related_models_app
    |   |   └── __init__.py
    |   ├── routers.py
    |   ├── test_add_many_to_many_field_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_initial.py
    |   |   └── __init__.py
    |   ├── test_auto_now_add
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_autodetector.py
    |   ├── test_base.py
    |   ├── test_commands.py
    |   ├── test_deprecated_fields.py
    |   ├── test_exceptions.py
    |   ├── test_executor.py
    |   ├── test_fake_initial_case_insensitive
    |   |   ├── fake_initial
    |   |   |   ├── 0001_initial.py
    |   |   |   └── __init__.py
    |   |   └── initial
    |   |       ├── 0001_initial.py
    |   |       └── __init__.py
    |   ├── test_graph.py
    |   ├── test_loader.py
    |   ├── test_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_atomic_operation
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_backwards_deps_1
    |   |   ├── 0001_initial.py
    |   |   └── 0002_second.py
    |   ├── test_migrations_bad_pyc
    |   |   └── __init__.py
    |   ├── test_migrations_clashing_prefix
    |   |   ├── __init__.py
    |   |   ├── a.py
    |   |   └── ab.py
    |   ├── test_migrations_conflict
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_conflict_long_name
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second_migration_with_long_name.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_custom_user
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_empty
    |   |   └── __init__.py
    |   ├── test_migrations_fake_split_initial
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_first
    |   |   ├── __init__.py
    |   |   ├── second.py
    |   |   └── thefirst.py
    |   ├── test_migrations_initial_false
    |   |   ├── 0001_not_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_manual_porting
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_namespace_package
    |   |   └── 0001_initial.py
    |   ├── test_migrations_no_ancestor
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_conflicting_second.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_changes
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_default
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_no_init
    |   ├── test_migrations_no_operations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_non_atomic
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_order
    |   |   ├── 0001.py
    |   |   └── __init__.py
    |   ├── test_migrations_plan
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   ├── 0004_fourth.py
    |   |   ├── 0005_fifth.py
    |   |   └── __init__.py
    |   ├── test_migrations_private
    |   |   ├── .util.py
    |   |   ├── 0001_initial.py
    |   |   ├── __init__.py
    |   |   ├── _util.py
    |   |   └── ~util.py
    |   ├── test_migrations_run_before
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 4_auto.py
    |   |   ├── 5_auto.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_complex_multi_apps
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_squashed_erroneous
    |   |   ├── 1_auto.py
    |   |   ├── 2_auto.py
    |   |   ├── 3_squashed_5.py
    |   |   ├── 6_auto.py
    |   |   ├── 7_auto.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_extra
    |   |   ├── 0001_initial.py
    |   |   ├── 0001_squashed_0002.py
    |   |   ├── 0002_second.py
    |   |   ├── 0003_third.py
    |   |   └── __init__.py
    |   ├── test_migrations_squashed_ref_squashed
    |   |   ├── __init__.py
    |   |   ├── app1
    |   |   |   ├── 1_auto.py
    |   |   |   ├── 2_auto.py
    |   |   |   ├── 2_squashed_3.py
    |   |   |   ├── 3_auto.py
    |   |   |   ├── 4_auto.py
    |   |   |   └── __init__.py
    |   |   └── app2
    |   |       ├── 1_auto.py
    |   |       ├── 1_squashed_2.py
    |   |       ├── 2_auto.py
    |   |       └── __init__.py
    |   ├── test_migrations_unmigdep
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_multidb.py
    |   ├── test_operations.py
    |   ├── test_optimizer.py
    |   ├── test_questioner.py
    |   ├── test_state.py
    |   └── test_writer.py
    ├── migrations2
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_migrations_2
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── test_migrations_2_first
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_second.py
    |   |   └── __init__.py
    |   └── test_migrations_2_no_deps
    |       ├── 0001_initial.py
    |       └── __init__.py
    ├── model_enums
    |   ├── __init__.py
    |   └── tests.py
    ├── model_fields
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_autofield.py
    |   ├── test_binaryfield.py
    |   ├── test_booleanfield.py
    |   ├── test_charfield.py
    |   ├── test_datetimefield.py
    |   ├── test_decimalfield.py
    |   ├── test_durationfield.py
    |   ├── test_field_flags.py
    |   ├── test_filefield.py
    |   ├── test_filepathfield.py
    |   ├── test_floatfield.py
    |   ├── test_foreignkey.py
    |   ├── test_genericipaddressfield.py
    |   ├── test_imagefield.py
    |   ├── test_integerfield.py
    |   ├── test_jsonfield.py
    |   ├── test_manytomanyfield.py
    |   ├── test_promises.py
    |   ├── test_slugfield.py
    |   ├── test_textfield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_forms
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_modelchoicefield.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── model_formsets_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_indexes
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_inheritance
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_abstract_inheritance.py
    |   └── tests.py
    ├── model_inheritance_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── model_meta
    |   ├── __init__.py
    |   ├── models.py
    |   ├── results.py
    |   └── tests.py
    ├── model_options
    |   ├── __init__.py
    |   ├── apps.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── default_related_name.py
    |   |   └── tablespaces.py
    |   ├── test_default_pk.py
    |   ├── test_default_related_name.py
    |   └── test_tablespaces.py
    ├── model_package
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── article.py
    |   |   └── publication.py
    |   └── tests.py
    ├── model_regress
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_pickle.py
    |   ├── test_state.py
    |   └── tests.py
    ├── model_utils
    |   ├── __init__.py
    |   └── tests.py
    ├── modeladmin
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_actions.py
    |   ├── test_checks.py
    |   └── tests.py
    ├── multiple_database
    |   ├── __init__.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── routers.py
    |   └── tests.py
    ├── mutually_referential
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── nested_foreign_keys
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── no_models
    |   ├── __init__.py
    |   └── tests.py
    ├── null_fk
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_fk_ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── null_queries
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── one_to_one
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── or_lookups
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── order_with_respect_to
    |   ├── __init__.py
    |   ├── base_tests.py
    |   ├── models.py
    |   └── tests.py
    ├── ordering
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── pagination
    |   ├── __init__.py
    |   ├── custom.py
    |   ├── models.py
    |   └── tests.py
    ├── postgres_tests
    |   ├── __init__.py
    |   ├── array_default_migrations
    |   |   ├── 0001_initial.py
    |   |   ├── 0002_integerarraymodel_field_2.py
    |   |   └── __init__.py
    |   ├── array_index_migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── fields.py
    |   ├── integration_settings.py
    |   ├── migrations
    |   |   ├── 0001_setup_extensions.py
    |   |   ├── 0002_create_test_models.py
    |   |   └── __init__.py
    |   ├── models.py
    |   ├── test_aggregates.py
    |   ├── test_apps.py
    |   ├── test_array.py
    |   ├── test_bulk_update.py
    |   ├── test_citext.py
    |   ├── test_constraints.py
    |   ├── test_functions.py
    |   ├── test_hstore.py
    |   ├── test_indexes.py
    |   ├── test_integration.py
    |   ├── test_introspection.py
    |   ├── test_operations.py
    |   ├── test_ranges.py
    |   ├── test_search.py
    |   ├── test_signals.py
    |   ├── test_trigram.py
    |   └── test_unaccent.py
    ├── prefetch_related
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_prefetch_related_objects.py
    |   ├── test_uuid.py
    |   └── tests.py
    ├── project_template
    |   ├── __init__.py
    |   ├── test_settings.py
    |   ├── urls.py
    |   └── views.py
    ├── properties
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_model_inheritance
    |   ├── __init__.py
    |   ├── app1
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── app2
    |   |   ├── __init__.py
    |   |   └── models.py
    |   ├── models.py
    |   └── tests.py
    ├── proxy_models
    |   ├── __init__.py
    |   ├── admin.py
    |   ├── fixtures
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── queries
    |   ├── __init__.py
    |   ├── models.py
    |   ├── test_bulk_update.py
    |   ├── test_contains.py
    |   ├── test_db_returning.py
    |   ├── test_explain.py
    |   ├── test_iterator.py
    |   ├── test_q.py
    |   ├── test_qs_combinators.py
    |   ├── test_query.py
    |   ├── test_sqlcompiler.py
    |   └── tests.py
    ├── queryset_pickle
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── raw_query
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── redirects_tests
    |   ├── __init__.py
    |   ├── tests.py
    |   └── urls.py
    ├── requests
    |   ├── __init__.py
    |   ├── test_accept_header.py
    |   ├── test_data_upload_settings.py
    |   └── tests.py
    ├── requirements
    |   ├── mysql.txt
    |   ├── oracle.txt
    |   ├── postgres.txt
    |   └── py3.txt
    ├── reserved_names
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── resolve_url
    |   ├── __init__.py
    |   ├── models.py
    |   ├── tests.py
    |   └── urls.py
    ├── responses
    |   ├── __init__.py
    |   ├── test_cookie.py
    |   ├── test_fileresponse.py
    |   └── tests.py
    ├── reverse_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── runtests.py
    ├── save_delete_hooks
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── schema
    |   ├── __init__.py
    |   ├── fields.py
    |   ├── models.py
    |   ├── test_logging.py
    |   └── tests.py
    ├── select_for_update
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_onetoone
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── select_related_regress
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── serializers
    |   ├── __init__.py
    |   ├── models
    |   |   ├── __init__.py
    |   |   ├── base.py
    |   |   ├── data.py
    |   |   ├── multi_table.py
    |   |   └── natural.py
    |   ├── test_data.py
    |   ├── test_deserializedobject.py
    |   ├── test_json.py
    |   ├── test_jsonl.py
    |   ├── test_natural.py
    |   ├── test_xml.py
    |   ├── test_yaml.py
    |   └── tests.py
    ├── servers
    |   ├── __init__.py
    |   ├── another_app
    |   |   ├── __init__.py
    |   |   └── static
    |   |       └── another_app
    |   ├── fixtures
    |   ├── media
    |   |   └── example_media_file.txt
    |   ├── models.py
    |   ├── static
    |   |   └── example_static_file.txt
    |   ├── test_basehttp.py
    |   ├── test_liveserverthread.py
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── sessions_tests
    |   ├── __init__.py
    |   ├── models.py
    |   ├── no_clear_expired.py
    |   └── tests.py
    ├── settings_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── shell
    |   ├── __init__.py
    |   └── tests.py
    ├── shortcuts
    |   ├── __init__.py
    |   ├── jinja2
    |   |   └── shortcuts
    |   |       └── using.html
    |   ├── templates
    |   |   └── shortcuts
    |   |       ├── render_test.html
    |   |       └── using.html
    |   ├── tests.py
    |   ├── urls.py
    |   └── views.py
    ├── signals
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── signed_cookies_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── signing
    |   ├── __init__.py
    |   └── tests.py
    ├── sitemaps_tests
    |   ├── __init__.py
    |   ├── base.py
    |   ├── models.py
    |   ├── templates
    |   |   ├── custom_sitemap.xml
    |   |   ├── custom_sitemap_index.xml
    |   |   └── custom_sitemap_lastmod_index.xml
    |   ├── test_generic.py
    |   ├── test_http.py
    |   ├── test_https.py
    |   ├── test_management.py
    |   ├── test_utils.py
    |   └── urls
    |       ├── __init__.py
    |       ├── empty.py
    |       ├── http.py
    |       ├── https.py
    |       ├── index_only.py
    |       └── sitemap_only.py
    ├── sites_framework
    |   ├── __init__.py
    |   ├── migrations
    |   |   ├── 0001_initial.py
    |   |   └── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── sites_tests
    |   ├── __init__.py
    |   └── tests.py
    ├── staticfiles_tests
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── no_label
    |   |   |   ├── __init__.py
    |   |   |   └── static
    |   |   ├── staticfiles_config.py
    |   |   └── test
    |   |       ├── __init__.py
    |   |       ├── otherdir
    |   |       └── static
    |   ├── cases.py
    |   ├── project
    |   |   ├── documents
    |   |   |   ├── absolute_root.css
    |   |   |   ├── cached
    |   |   |   ├── nested
    |   |   |   ├── styles_root.css
    |   |   |   ├── subdir
    |   |   |   ├── test
    |   |   |   └── test.txt
    |   |   ├── faulty
    |   |   |   └── faulty.css
    |   |   ├── loop
    |   |   |   ├── bar.css
    |   |   |   └── foo.css
    |   |   ├── pathlib
    |   |   |   └── pathlib.txt
    |   |   ├── prefixed
    |   |   |   └── test.txt
    |   |   └── site_media
    |   |       ├── media
    |   |       └── static
    |   ├── settings.py
    |   ├── storage.py
    |   ├── test_checks.py
    |   ├── test_finders.py
    |   ├── test_forms.py
    |   ├── test_handlers.py
    |   ├── test_liveserver.py
    |   ├── test_management.py
    |   ├── test_storage.py
    |   ├── test_templatetags.py
    |   ├── test_utils.py
    |   ├── test_views.py
    |   └── urls
    |       ├── __init__.py
    |       ├── default.py
    |       └── helper.py
    ├── str
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── string_lookup
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── swappable_models
    |   ├── __init__.py
    |   ├── models.py
    |   └── tests.py
    ├── syndication_tests
    |   ├── __init__.py
    |   ├── feeds.py
    |   ├── models.py
    |   ├── templates
    |   |   └── syndication
    |   |       ├── description.html
    |   |       ├── description_context.html
    |   |       ├── title.html
    |   |       └── title_context.html
    |   ├── tests.py
    |   └── urls.py
    ├── template_backends
    |   ├── __init__.py
    |   ├── apps
    |   |   ├── __init__.py
    |   |   ├── good
    |   |   |   ├── __init__.py
    |   |   |   └── templatetags
    |   |   └── importerror
    |   |       ├── __init__.py
    |   |       └── templatetags
    |   ├── forbidden
    |   |   └── template_backends
    |   |       └── hello.html
    |   ├── jinja2
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       ├── syntax_error.html
    |   |       ├── syntax_error2.html
    |   |       └── syntax_error_include.html
    |   ├── template_strings
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_backends
    |   |       ├── csrf.html
    |   |       ├── django_escaping.html
    |   |       ├── hello.html
    |   |       └── syntax_error.html
    |   ├── test_django.py
    |   ├── test_dummy.py
    |   ├── test_jinja2.py
    |   └── test_utils.py
    ├── template_loader
    |   ├── __init__.py
    |   ├── template_strings
    |   |   └── template_loader
    |   |       └── hello.html
    |   ├── templates
    |   |   └── template_loader
    |   |       ├── goodbye.html
    |   |       ├── hello.html
    |   |       └── request.html
    |   └── tests.py
    ├── template_tests
    |   ├── __init__.py
    |   ├── alternate_urls.py
    |   ├── annotated_tag_function.py
    |   ├── broken_tag.py
    |   ├── eggs
    |   ├── filter_tests
    |   |   ├── __init__.py
    |   |   ├── test_add.py
    |   |   ├── test_addslashes.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_capfirst.py
    |   |   ├── test_center.py
    |   |   ├── test_chaining.py
    |   |   ├── test_cut.py
    |   |   ├── test_date.py
    |   |   ├── test_default.py
    |   |   ├── test_default_if_none.py
    |   |   ├── test_dictsort.py
    |   |   ├── test_dictsortreversed.py
    |   |   ├── test_divisibleby.py
    |   |   ├── test_escape.py
    |   |   ├── test_escapejs.py
    |   |   ├── test_filesizeformat.py
    |   |   ├── test_first.py
    |   |   ├── test_floatformat.py
    |   |   ├── test_force_escape.py
    |   |   ├── test_get_digit.py
    |   |   ├── test_iriencode.py
    |   |   ├── test_join.py
    |   |   ├── test_json_script.py
    |   |   ├── test_last.py
    |   |   ├── test_length.py
    |   |   ├── test_length_is.py
    |   |   ├── test_linebreaks.py
    |   |   ├── test_linebreaksbr.py
    |   |   ├── test_linenumbers.py
    |   |   ├── test_ljust.py
    |   |   ├── test_lower.py
    |   |   ├── test_make_list.py
    |   |   ├── test_phone2numeric.py
    |   |   ├── test_pluralize.py
    |   |   ├── test_random.py
    |   |   ├── test_rjust.py
    |   |   ├── test_safe.py
    |   |   ├── test_safeseq.py
    |   |   ├── test_slice.py
    |   |   ├── test_slugify.py
    |   |   ├── test_stringformat.py
    |   |   ├── test_striptags.py
    |   |   ├── test_time.py
    |   |   ├── test_timesince.py
    |   |   ├── test_timeuntil.py
    |   |   ├── test_title.py
    |   |   ├── test_truncatechars.py
    |   |   ├── test_truncatechars_html.py
    |   |   ├── test_truncatewords.py
    |   |   ├── test_truncatewords_html.py
    |   |   ├── test_unordered_list.py
    |   |   ├── test_upper.py
    |   |   ├── test_urlencode.py
    |   |   ├── test_urlize.py
    |   |   ├── test_urlizetrunc.py
    |   |   ├── test_wordcount.py
    |   |   ├── test_wordwrap.py
    |   |   ├── test_yesno.py
    |   |   └── timezone_utils.py
    |   ├── jinja2
    |   |   └── template_tests
    |   |       └── using.html
    |   ├── other_templates
    |   |   ├── priority
    |   |   |   └── foo.html
    |   |   └── test_dirs.html
    |   ├── recursive_templates
    |   |   ├── fs
    |   |   |   ├── extend-missing.html
    |   |   |   ├── one.html
    |   |   |   ├── other-recursive.html
    |   |   |   ├── recursive.html
    |   |   |   ├── self.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── fs2
    |   |   |   └── recursive.html
    |   |   └── fs3
    |   |       └── recursive.html
    |   ├── relative_templates
    |   |   ├── dir1
    |   |   |   ├── dir2
    |   |   |   ├── looped.html
    |   |   |   ├── one.html
    |   |   |   ├── one1.html
    |   |   |   ├── one2.html
    |   |   |   ├── one3.html
    |   |   |   ├── three.html
    |   |   |   └── two.html
    |   |   ├── error_extends.html
    |   |   ├── error_include.html
    |   |   ├── one.html
    |   |   ├── one_var.html
    |   |   ├── three.html
    |   |   └── two.html
    |   ├── syntax_tests
    |   |   ├── __init__.py
    |   |   ├── i18n
    |   |   |   ├── __init__.py
    |   |   |   ├── base.py
    |   |   |   ├── test_blocktranslate.py
    |   |   |   ├── test_filters.py
    |   |   |   ├── test_get_available_languages.py
    |   |   |   ├── test_get_current_language.py
    |   |   |   ├── test_get_current_language_bidi.py
    |   |   |   ├── test_get_language_info.py
    |   |   |   ├── test_get_language_info_list.py
    |   |   |   ├── test_language.py
    |   |   |   ├── test_translate.py
    |   |   |   └── test_underscore_syntax.py
    |   |   ├── test_autoescape.py
    |   |   ├── test_basic.py
    |   |   ├── test_builtins.py
    |   |   ├── test_cache.py
    |   |   ├── test_comment.py
    |   |   ├── test_cycle.py
    |   |   ├── test_exceptions.py
    |   |   ├── test_extends.py
    |   |   ├── test_filter_syntax.py
    |   |   ├── test_filter_tag.py
    |   |   ├── test_firstof.py
    |   |   ├── test_for.py
    |   |   ├── test_if.py
    |   |   ├── test_if_changed.py
    |   |   ├── test_include.py
    |   |   ├── test_invalid_string.py
    |   |   ├── test_list_index.py
    |   |   ├── test_load.py
    |   |   ├── test_lorem.py
    |   |   ├── test_multiline.py
    |   |   ├── test_named_endblock.py
    |   |   ├── test_now.py
    |   |   ├── test_numpy.py
    |   |   ├── test_regroup.py
    |   |   ├── test_resetcycle.py
    |   |   ├── test_setup.py
    |   |   ├── test_simple_tag.py
    |   |   ├── test_spaceless.py
    |   |   ├── test_static.py
    |   |   ├── test_template_tag.py
    |   |   ├── test_url.py
    |   |   ├── test_verbatim.py
    |   |   ├── test_width_ratio.py
    |   |   └── test_with.py
    |   ├── templates
    |   |   ├── 27584_child.html
    |   |   ├── 27584_parent.html
    |   |   ├── 27956_child.html
    |   |   ├── 27956_parent.html
    |   |   ├── broken_base.html
    |   |   ├── first
    |   |   |   └── test.html
    |   |   ├── include_tpl.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Use simplified paths for deconstruct of expressions

Description: Description
	
Previously F() deconstructed to: django.db.models.expressions.F(). But since it can also be imported from django.db.models, ​PR #14047 changed it to deconstruct to django.db.models.F(). This simplifies generated migration code where it will be referenced only as from django.db import models / models.F().
As Mariusz pointed out on the PR, the same technique can be applied to other expressions, further simplifying generated migrations.

Patch information:
diff --git a/django/db/models/expressions.py b/django/db/models/expressions.py
index 8642e1f151..9705863917 100644
--- a/django/db/models/expressions.py
+++ b/django/db/models/expressions.py
@@ -390,7 +390,7 @@ class BaseExpression:
         return sql, params
 
 
-@deconstructible
+@deconstructible(path='django.db.models.Expression')
 class Expression(BaseExpression, Combinable):
     """An expression that can be combined with other expressions."""
 
@@ -639,6 +639,7 @@ class ResolvedOuterRef(F):
         return []
 
 
+@deconstructible(path='django.db.models.OuterRef')
 class OuterRef(F):
     contains_aggregate = False
 
@@ -651,6 +652,7 @@ class OuterRef(F):
         return self
 
 
+@deconstructible(path='django.db.models.Func')
 class Func(SQLiteNumericMixin, Expression):
     """An SQL function call."""
     function = None
@@ -731,6 +733,7 @@ class Func(SQLiteNumericMixin, Expression):
         return copy
 
 
+@deconstructible(path='django.db.models.Value')
 class Value(SQLiteNumericMixin, Expression):
     """Represent a wrapped value as a node within an expression."""
     # Provide a default value for `for_save` in order to allow unresolved
@@ -912,6 +915,7 @@ class Ref(Expression):
         return [self]
 
 
+@deconstructible(path='django.db.models.ExpressionList')
 class ExpressionList(Func):
     """
     An expression containing multiple expressions. Can be used to provide a
@@ -953,6 +957,7 @@ class OrderByList(Func):
         return super().as_sql(*args, **kwargs)
 
 
+@deconstructible(path='django.db.models.ExpressionWrapper')
 class ExpressionWrapper(SQLiteNumericMixin, Expression):
     """
     An expression that can wrap another expression so that it can provide
@@ -985,6 +990,7 @@ class ExpressionWrapper(SQLiteNumericMixin, Expression):
         return "{}({})".format(self.__class__.__name__, self.expression)
 
 
+@deconstructible(path='django.db.models.When')
 class When(Expression):
     template = 'WHEN %(condition)s THEN %(result)s'
     # This isn't a complete conditional expression, must be used in Case().
@@ -1052,6 +1058,7 @@ class When(Expression):
         return cols
 
 
+@deconstructible(path='django.db.models.Case')
 class Case(SQLiteNumericMixin, Expression):
     """
     An SQL searched CASE expression:
@@ -1133,6 +1140,7 @@ class Case(SQLiteNumericMixin, Expression):
         return super().get_group_by_cols(alias)
 
 
+@deconstructible(path='django.db.models.Subquery')
 class Subquery(BaseExpression, Combinable):
     """
     An explicit subquery. It may contain OuterRef() references to the outer
@@ -1190,6 +1198,7 @@ class Subquery(BaseExpression, Combinable):
         return self.query.get_group_by_cols()
 
 
+@deconstructible(path='django.db.models.Exists')
 class Exists(Subquery):
     template = 'EXISTS(%(subquery)s)'
     output_field = fields.BooleanField()
@@ -1225,6 +1234,7 @@ class Exists(Subquery):
         return sql, params
 
 
+@deconstructible(path='django.db.models.OrderBy')
 class OrderBy(Expression):
     template = '%(expression)s %(ordering)s'
     conditional = False
@@ -1307,6 +1317,7 @@ class OrderBy(Expression):
         self.descending = True
 
 
+@deconstructible(path='django.db.models.Window')
 class Window(SQLiteNumericMixin, Expression):
     template = '%(expression)s OVER (%(window)s)'
     # Although the main expression may either be an aggregate or an
@@ -1412,6 +1423,7 @@ class Window(SQLiteNumericMixin, Expression):
         return []
 
 
+@deconstructible(path='django.db.models.WindowFrame')
 class WindowFrame(Expression):
     """
     Model the frame clause in window expressions. There are two types of frame
@@ -1471,6 +1483,7 @@ class WindowFrame(Expression):
         raise NotImplementedError('Subclasses must implement window_frame_start_end().')
 
 
+@deconstructible(path='django.db.models.RowRange')
 class RowRange(WindowFrame):
     frame_type = 'ROWS'
 
@@ -1478,6 +1491,7 @@ class RowRange(WindowFrame):
         return connection.ops.window_frame_rows_start_end(start, end)
 
 
+@deconstructible(path='django.db.models.ValueRange')
 class ValueRange(WindowFrame):
     frame_type = 'RANGE'
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/migrations/test_autodetector.py`.
Extra Requirements: 
Purpose: I need the content of this file to identify relevant test cases that demonstrate the deconstruction of expression classes in the context of migrations.

Previous refined query 2:
Essential Query: Please provide the full content of `tests/migrations/test_writer.py`.
Extra Requirements: 
Purpose: I need this file to find test cases that check the serialized output of deconstructed expression objects in migration files, which is directly related to the user's issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: tests/migrations/test_autodetector.py
Line number range: 1 - 2964
Content:
1. import functools
2. import re
3. from unittest import mock
4. 
5. from django.apps import apps
6. from django.conf import settings
7. from django.contrib.auth.models import AbstractBaseUser
8. from django.core.validators import RegexValidator, validate_slug
9. from django.db import connection, migrations, models
10. from django.db.migrations.autodetector import MigrationAutodetector
11. from django.db.migrations.graph import MigrationGraph
12. from django.db.migrations.loader import MigrationLoader
13. from django.db.migrations.questioner import MigrationQuestioner
14. from django.db.migrations.state import ModelState, ProjectState
15. from django.test import SimpleTestCase, TestCase, override_settings
16. from django.test.utils import isolate_lru_cache
17. 
18. from .models import FoodManager, FoodQuerySet
19. 
20. 
21. class DeconstructibleObject:
22.     """
23.     A custom deconstructible object.
24.     """
25. 
26.     def __init__(self, *args, **kwargs):
27.         self.args = args
28.         self.kwargs = kwargs
29. 
30.     def deconstruct(self):
31.         return (
32.             self.__module__ + '.' + self.__class__.__name__,
33.             self.args,
34.             self.kwargs
35.         )
36. 
37. 
38. class AutodetectorTests(TestCase):
39.     """
40.     Tests the migration autodetector.
41.     """
42. 
43.     author_empty = ModelState("testapp", "Author", [("id", models.AutoField(primary_key=True))])
44.     author_name = ModelState("testapp", "Author", [
45.         ("id", models.AutoField(primary_key=True)),
46.         ("name", models.CharField(max_length=200)),
47.     ])
48.     author_name_null = ModelState("testapp", "Author", [
49.         ("id", models.AutoField(primary_key=True)),
50.         ("name", models.CharField(max_length=200, null=True)),
51.     ])
52.     author_name_longer = ModelState("testapp", "Author", [
53.         ("id", models.AutoField(primary_key=True)),
54.         ("name", models.CharField(max_length=400)),
55.     ])
56.     author_name_renamed = ModelState("testapp", "Author", [
57.         ("id", models.AutoField(primary_key=True)),
58.         ("names", models.CharField(max_length=200)),
59.     ])
60.     author_name_default = ModelState("testapp", "Author", [
61.         ("id", models.AutoField(primary_key=True)),
62.         ("name", models.CharField(max_length=200, default='Ada Lovelace')),
63.     ])
64.     author_name_check_constraint = ModelState("testapp", "Author", [
65.         ("id", models.AutoField(primary_key=True)),
66.         ("name", models.CharField(max_length=200)),
67.     ],
68.         {'constraints': [models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')]},
69.     )
70.     author_dates_of_birth_auto_now = ModelState("testapp", "Author", [
71.         ("id", models.AutoField(primary_key=True)),
72.         ("date_of_birth", models.DateField(auto_now=True)),
73.         ("date_time_of_birth", models.DateTimeField(auto_now=True)),
74.         ("time_of_birth", models.TimeField(auto_now=True)),
75.     ])
76.     author_dates_of_birth_auto_now_add = ModelState("testapp", "Author", [
77.         ("id", models.AutoField(primary_key=True)),
78.         ("date_of_birth", models.DateField(auto_now_add=True)),
79.         ("date_time_of_birth", models.DateTimeField(auto_now_add=True)),
80.         ("time_of_birth", models.TimeField(auto_now_add=True)),
81.     ])
82.     author_name_deconstructible_1 = ModelState("testapp", "Author", [
83.         ("id", models.AutoField(primary_key=True)),
84.         ("name", models.CharField(max_length=200, default=DeconstructibleObject())),
85.     ])
86.     author_name_deconstructible_2 = ModelState("testapp", "Author", [
87.         ("id", models.AutoField(primary_key=True)),
88.         ("name", models.CharField(max_length=200, default=DeconstructibleObject())),
89.     ])
90.     author_name_deconstructible_3 = ModelState("testapp", "Author", [
91.         ("id", models.AutoField(primary_key=True)),
92.         ("name", models.CharField(max_length=200, default=models.IntegerField())),
93.     ])
94.     author_name_deconstructible_4 = ModelState("testapp", "Author", [
95.         ("id", models.AutoField(primary_key=True)),
96.         ("name", models.CharField(max_length=200, default=models.IntegerField())),
97.     ])
98.     author_name_deconstructible_list_1 = ModelState("testapp", "Author", [
99.         ("id", models.AutoField(primary_key=True)),
100.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 123])),
101.     ])
102.     author_name_deconstructible_list_2 = ModelState("testapp", "Author", [
103.         ("id", models.AutoField(primary_key=True)),
104.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 123])),
105.     ])
106.     author_name_deconstructible_list_3 = ModelState("testapp", "Author", [
107.         ("id", models.AutoField(primary_key=True)),
108.         ("name", models.CharField(max_length=200, default=[DeconstructibleObject(), 999])),
109.     ])
110.     author_name_deconstructible_tuple_1 = ModelState("testapp", "Author", [
111.         ("id", models.AutoField(primary_key=True)),
112.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 123))),
113.     ])
114.     author_name_deconstructible_tuple_2 = ModelState("testapp", "Author", [
115.         ("id", models.AutoField(primary_key=True)),
116.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 123))),
117.     ])
118.     author_name_deconstructible_tuple_3 = ModelState("testapp", "Author", [
119.         ("id", models.AutoField(primary_key=True)),
120.         ("name", models.CharField(max_length=200, default=(DeconstructibleObject(), 999))),
121.     ])
122.     author_name_deconstructible_dict_1 = ModelState("testapp", "Author", [
123.         ("id", models.AutoField(primary_key=True)),
124.         ("name", models.CharField(max_length=200, default={
125.             'item': DeconstructibleObject(), 'otheritem': 123
126.         })),
127.     ])
128.     author_name_deconstructible_dict_2 = ModelState("testapp", "Author", [
129.         ("id", models.AutoField(primary_key=True)),
130.         ("name", models.CharField(max_length=200, default={
131.             'item': DeconstructibleObject(), 'otheritem': 123
132.         })),
133.     ])
134.     author_name_deconstructible_dict_3 = ModelState("testapp", "Author", [
135.         ("id", models.AutoField(primary_key=True)),
136.         ("name", models.CharField(max_length=200, default={
137.             'item': DeconstructibleObject(), 'otheritem': 999
138.         })),
139.     ])
140.     author_name_nested_deconstructible_1 = ModelState("testapp", "Author", [
141.         ("id", models.AutoField(primary_key=True)),
142.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
143.             DeconstructibleObject(1),
144.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
145.             a=DeconstructibleObject('A'),
146.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
147.         ))),
148.     ])
149.     author_name_nested_deconstructible_2 = ModelState("testapp", "Author", [
150.         ("id", models.AutoField(primary_key=True)),
151.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
152.             DeconstructibleObject(1),
153.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
154.             a=DeconstructibleObject('A'),
155.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
156.         ))),
157.     ])
158.     author_name_nested_deconstructible_changed_arg = ModelState("testapp", "Author", [
159.         ("id", models.AutoField(primary_key=True)),
160.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
161.             DeconstructibleObject(1),
162.             (DeconstructibleObject('t1'), DeconstructibleObject('t2-changed'),),
163.             a=DeconstructibleObject('A'),
164.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
165.         ))),
166.     ])
167.     author_name_nested_deconstructible_extra_arg = ModelState("testapp", "Author", [
168.         ("id", models.AutoField(primary_key=True)),
169.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
170.             DeconstructibleObject(1),
171.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
172.             None,
173.             a=DeconstructibleObject('A'),
174.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
175.         ))),
176.     ])
177.     author_name_nested_deconstructible_changed_kwarg = ModelState("testapp", "Author", [
178.         ("id", models.AutoField(primary_key=True)),
179.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
180.             DeconstructibleObject(1),
181.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
182.             a=DeconstructibleObject('A'),
183.             b=DeconstructibleObject(B=DeconstructibleObject('c-changed')),
184.         ))),
185.     ])
186.     author_name_nested_deconstructible_extra_kwarg = ModelState("testapp", "Author", [
187.         ("id", models.AutoField(primary_key=True)),
188.         ("name", models.CharField(max_length=200, default=DeconstructibleObject(
189.             DeconstructibleObject(1),
190.             (DeconstructibleObject('t1'), DeconstructibleObject('t2'),),
191.             a=DeconstructibleObject('A'),
192.             b=DeconstructibleObject(B=DeconstructibleObject('c')),
193.             c=None,
194.         ))),
195.     ])
196.     author_custom_pk = ModelState("testapp", "Author", [("pk_field", models.IntegerField(primary_key=True))])
197.     author_with_biography_non_blank = ModelState("testapp", "Author", [
198.         ("id", models.AutoField(primary_key=True)),
199.         ("name", models.CharField()),
200.         ("biography", models.TextField()),
201.     ])
202.     author_with_biography_blank = ModelState("testapp", "Author", [
203.         ("id", models.AutoField(primary_key=True)),
204.         ("name", models.CharField(blank=True)),
205.         ("biography", models.TextField(blank=True)),
206.     ])
207.     author_with_book = ModelState("testapp", "Author", [
208.         ("id", models.AutoField(primary_key=True)),
209.         ("name", models.CharField(max_length=200)),
210.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
211.     ])
212.     author_with_book_order_wrt = ModelState("testapp", "Author", [
213.         ("id", models.AutoField(primary_key=True)),
214.         ("name", models.CharField(max_length=200)),
215.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
216.     ], options={"order_with_respect_to": "book"})
217.     author_renamed_with_book = ModelState("testapp", "Writer", [
218.         ("id", models.AutoField(primary_key=True)),
219.         ("name", models.CharField(max_length=200)),
220.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
221.     ])
222.     author_with_publisher_string = ModelState("testapp", "Author", [
223.         ("id", models.AutoField(primary_key=True)),
224.         ("name", models.CharField(max_length=200)),
225.         ("publisher_name", models.CharField(max_length=200)),
226.     ])
227.     author_with_publisher = ModelState("testapp", "Author", [
228.         ("id", models.AutoField(primary_key=True)),
229.         ("name", models.CharField(max_length=200)),
230.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
231.     ])
232.     author_with_user = ModelState("testapp", "Author", [
233.         ("id", models.AutoField(primary_key=True)),
234.         ("name", models.CharField(max_length=200)),
235.         ("user", models.ForeignKey("auth.User", models.CASCADE)),
236.     ])
237.     author_with_custom_user = ModelState("testapp", "Author", [
238.         ("id", models.AutoField(primary_key=True)),
239.         ("name", models.CharField(max_length=200)),
240.         ("user", models.ForeignKey("thirdapp.CustomUser", models.CASCADE)),
241.     ])
242.     author_proxy = ModelState("testapp", "AuthorProxy", [], {"proxy": True}, ("testapp.author",))
243.     author_proxy_options = ModelState("testapp", "AuthorProxy", [], {
244.         "proxy": True,
245.         "verbose_name": "Super Author",
246.     }, ("testapp.author",))
247.     author_proxy_notproxy = ModelState("testapp", "AuthorProxy", [], {}, ("testapp.author",))
248.     author_proxy_third = ModelState("thirdapp", "AuthorProxy", [], {"proxy": True}, ("testapp.author",))
249.     author_proxy_third_notproxy = ModelState("thirdapp", "AuthorProxy", [], {}, ("testapp.author",))
250.     author_proxy_proxy = ModelState("testapp", "AAuthorProxyProxy", [], {"proxy": True}, ("testapp.authorproxy",))
251.     author_unmanaged = ModelState("testapp", "AuthorUnmanaged", [], {"managed": False}, ("testapp.author",))
252.     author_unmanaged_managed = ModelState("testapp", "AuthorUnmanaged", [], {}, ("testapp.author",))
253.     author_unmanaged_default_pk = ModelState("testapp", "Author", [("id", models.AutoField(primary_key=True))])
254.     author_unmanaged_custom_pk = ModelState("testapp", "Author", [
255.         ("pk_field", models.IntegerField(primary_key=True)),
256.     ])
257.     author_with_m2m = ModelState("testapp", "Author", [
258.         ("id", models.AutoField(primary_key=True)),
259.         ("publishers", models.ManyToManyField("testapp.Publisher")),
260.     ])
261.     author_with_m2m_blank = ModelState("testapp", "Author", [
262.         ("id", models.AutoField(primary_key=True)),
263.         ("publishers", models.ManyToManyField("testapp.Publisher", blank=True)),
264.     ])
265.     author_with_m2m_through = ModelState("testapp", "Author", [
266.         ("id", models.AutoField(primary_key=True)),
267.         ("publishers", models.ManyToManyField("testapp.Publisher", through="testapp.Contract")),
268.     ])
269.     author_with_renamed_m2m_through = ModelState("testapp", "Author", [
270.         ("id", models.AutoField(primary_key=True)),
271.         ("publishers", models.ManyToManyField("testapp.Publisher", through="testapp.Deal")),
272.     ])
273.     author_with_former_m2m = ModelState("testapp", "Author", [
274.         ("id", models.AutoField(primary_key=True)),
275.         ("publishers", models.CharField(max_length=100)),
276.     ])
277.     author_with_options = ModelState("testapp", "Author", [
278.         ("id", models.AutoField(primary_key=True)),
279.     ], {
280.         "permissions": [('can_hire', 'Can hire')],
281.         "verbose_name": "Authi",
282.     })
283.     author_with_db_table_options = ModelState("testapp", "Author", [
284.         ("id", models.AutoField(primary_key=True)),
285.     ], {"db_table": "author_one"})
286.     author_with_new_db_table_options = ModelState("testapp", "Author", [
287.         ("id", models.AutoField(primary_key=True)),
288.     ], {"db_table": "author_two"})
289.     author_renamed_with_db_table_options = ModelState("testapp", "NewAuthor", [
290.         ("id", models.AutoField(primary_key=True)),
291.     ], {"db_table": "author_one"})
292.     author_renamed_with_new_db_table_options = ModelState("testapp", "NewAuthor", [
293.         ("id", models.AutoField(primary_key=True)),
294.     ], {"db_table": "author_three"})
295.     contract = ModelState("testapp", "Contract", [
296.         ("id", models.AutoField(primary_key=True)),
297.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
298.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
299.     ])
300.     contract_renamed = ModelState("testapp", "Deal", [
301.         ("id", models.AutoField(primary_key=True)),
302.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
303.         ("publisher", models.ForeignKey("testapp.Publisher", models.CASCADE)),
304.     ])
305.     publisher = ModelState("testapp", "Publisher", [
306.         ("id", models.AutoField(primary_key=True)),
307.         ("name", models.CharField(max_length=100)),
308.     ])
309.     publisher_with_author = ModelState("testapp", "Publisher", [
310.         ("id", models.AutoField(primary_key=True)),
311.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
312.         ("name", models.CharField(max_length=100)),
313.     ])
314.     publisher_with_aardvark_author = ModelState("testapp", "Publisher", [
315.         ("id", models.AutoField(primary_key=True)),
316.         ("author", models.ForeignKey("testapp.Aardvark", models.CASCADE)),
317.         ("name", models.CharField(max_length=100)),
318.     ])
319.     publisher_with_book = ModelState("testapp", "Publisher", [
320.         ("id", models.AutoField(primary_key=True)),
321.         ("author", models.ForeignKey("otherapp.Book", models.CASCADE)),
322.         ("name", models.CharField(max_length=100)),
323.     ])
324.     other_pony = ModelState("otherapp", "Pony", [
325.         ("id", models.AutoField(primary_key=True)),
326.     ])
327.     other_pony_food = ModelState("otherapp", "Pony", [
328.         ("id", models.AutoField(primary_key=True)),
329.     ], managers=[
330.         ('food_qs', FoodQuerySet.as_manager()),
331.         ('food_mgr', FoodManager('a', 'b')),
332.         ('food_mgr_kwargs', FoodManager('x', 'y', 3, 4)),
333.     ])
334.     other_stable = ModelState("otherapp", "Stable", [("id", models.AutoField(primary_key=True))])
335.     third_thing = ModelState("thirdapp", "Thing", [("id", models.AutoField(primary_key=True))])
336.     book = ModelState("otherapp", "Book", [
337.         ("id", models.AutoField(primary_key=True)),
338.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
339.         ("title", models.CharField(max_length=200)),
340.     ])
341.     book_proxy_fk = ModelState("otherapp", "Book", [
342.         ("id", models.AutoField(primary_key=True)),
343.         ("author", models.ForeignKey("thirdapp.AuthorProxy", models.CASCADE)),
344.         ("title", models.CharField(max_length=200)),
345.     ])
346.     book_proxy_proxy_fk = ModelState("otherapp", "Book", [
347.         ("id", models.AutoField(primary_key=True)),
348.         ("author", models.ForeignKey("testapp.AAuthorProxyProxy", models.CASCADE)),
349.     ])
350.     book_migrations_fk = ModelState("otherapp", "Book", [
351.         ("id", models.AutoField(primary_key=True)),
352.         ("author", models.ForeignKey("migrations.UnmigratedModel", models.CASCADE)),
353.         ("title", models.CharField(max_length=200)),
354.     ])
355.     book_with_no_author_fk = ModelState("otherapp", "Book", [
356.         ("id", models.AutoField(primary_key=True)),
357.         ("author", models.IntegerField()),
358.         ("title", models.CharField(max_length=200)),
359.     ])
360.     book_with_no_author = ModelState("otherapp", "Book", [
361.         ("id", models.AutoField(primary_key=True)),
362.         ("title", models.CharField(max_length=200)),
363.     ])
364.     book_with_author_renamed = ModelState("otherapp", "Book", [
365.         ("id", models.AutoField(primary_key=True)),
366.         ("author", models.ForeignKey("testapp.Writer", models.CASCADE)),
367.         ("title", models.CharField(max_length=200)),
368.     ])
369.     book_with_field_and_author_renamed = ModelState("otherapp", "Book", [
370.         ("id", models.AutoField(primary_key=True)),
371.         ("writer", models.ForeignKey("testapp.Writer", models.CASCADE)),
372.         ("title", models.CharField(max_length=200)),
373.     ])
374.     book_with_multiple_authors = ModelState("otherapp", "Book", [
375.         ("id", models.AutoField(primary_key=True)),
376.         ("authors", models.ManyToManyField("testapp.Author")),
377.         ("title", models.CharField(max_length=200)),
378.     ])
379.     book_with_multiple_authors_through_attribution = ModelState("otherapp", "Book", [
380.         ("id", models.AutoField(primary_key=True)),
381.         ("authors", models.ManyToManyField("testapp.Author", through="otherapp.Attribution")),
382.         ("title", models.CharField(max_length=200)),
383.     ])
384.     book_indexes = ModelState("otherapp", "Book", [
385.         ("id", models.AutoField(primary_key=True)),
386.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
387.         ("title", models.CharField(max_length=200)),
388.     ], {
389.         "indexes": [models.Index(fields=["author", "title"], name="book_title_author_idx")],
390.     })
391.     book_unordered_indexes = ModelState("otherapp", "Book", [
392.         ("id", models.AutoField(primary_key=True)),
393.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
394.         ("title", models.CharField(max_length=200)),
395.     ], {
396.         "indexes": [models.Index(fields=["title", "author"], name="book_author_title_idx")],
397.     })
398.     book_foo_together = ModelState("otherapp", "Book", [
399.         ("id", models.AutoField(primary_key=True)),
400.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
401.         ("title", models.CharField(max_length=200)),
402.     ], {
403.         "index_together": {("author", "title")},
404.         "unique_together": {("author", "title")},
405.     })
406.     book_foo_together_2 = ModelState("otherapp", "Book", [
407.         ("id", models.AutoField(primary_key=True)),
408.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
409.         ("title", models.CharField(max_length=200)),
410.     ], {
411.         "index_together": {("title", "author")},
412.         "unique_together": {("title", "author")},
413.     })
414.     book_foo_together_3 = ModelState("otherapp", "Book", [
415.         ("id", models.AutoField(primary_key=True)),
416.         ("newfield", models.IntegerField()),
417.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
418.         ("title", models.CharField(max_length=200)),
419.     ], {
420.         "index_together": {("title", "newfield")},
421.         "unique_together": {("title", "newfield")},
422.     })
423.     book_foo_together_4 = ModelState("otherapp", "Book", [
424.         ("id", models.AutoField(primary_key=True)),
425.         ("newfield2", models.IntegerField()),
426.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
427.         ("title", models.CharField(max_length=200)),
428.     ], {
429.         "index_together": {("title", "newfield2")},
430.         "unique_together": {("title", "newfield2")},
431.     })
432.     attribution = ModelState("otherapp", "Attribution", [
433.         ("id", models.AutoField(primary_key=True)),
434.         ("author", models.ForeignKey("testapp.Author", models.CASCADE)),
435.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
436.     ])
437.     edition = ModelState("thirdapp", "Edition", [
438.         ("id", models.AutoField(primary_key=True)),
439.         ("book", models.ForeignKey("otherapp.Book", models.CASCADE)),
440.     ])
441.     custom_user = ModelState("thirdapp", "CustomUser", [
442.         ("id", models.AutoField(primary_key=True)),
443.         ("username", models.CharField(max_length=255)),
444.     ], bases=(AbstractBaseUser,))
445.     custom_user_no_inherit = ModelState("thirdapp", "CustomUser", [
446.         ("id", models.AutoField(primary_key=True)),
447.         ("username", models.CharField(max_length=255)),
448.     ])
449.     aardvark = ModelState("thirdapp", "Aardvark", [("id", models.AutoField(primary_key=True))])
450.     aardvark_testapp = ModelState("testapp", "Aardvark", [("id", models.AutoField(primary_key=True))])
451.     aardvark_based_on_author = ModelState("testapp", "Aardvark", [], bases=("testapp.Author",))
452.     aardvark_pk_fk_author = ModelState("testapp", "Aardvark", [
453.         ("id", models.OneToOneField("testapp.Author", models.CASCADE, primary_key=True)),
454.     ])
455.     knight = ModelState("eggs", "Knight", [("id", models.AutoField(primary_key=True))])
456.     rabbit = ModelState("eggs", "Rabbit", [
457.         ("id", models.AutoField(primary_key=True)),
458.         ("knight", models.ForeignKey("eggs.Knight", models.CASCADE)),
459.         ("parent", models.ForeignKey("eggs.Rabbit", models.CASCADE)),
460.     ], {
461.         "unique_together": {("parent", "knight")},
462.         "indexes": [models.Index(fields=["parent", "knight"], name='rabbit_circular_fk_index')],
463.     })
464. 
465.     def repr_changes(self, changes, include_dependencies=False):
466.         output = ""
467.         for app_label, migrations_ in sorted(changes.items()):
468.             output += "  %s:\n" % app_label
469.             for migration in migrations_:
470.                 output += "    %s\n" % migration.name
471.                 for operation in migration.operations:
472.                     output += "      %s\n" % operation
473.                 if include_dependencies:
474.                     output += "      Dependencies:\n"
475.                     if migration.dependencies:
476.                         for dep in migration.dependencies:
477.                             output += "        %s\n" % (dep,)
478.                     else:
479.                         output += "        None\n"
480.         return output
481. 
482.     def assertNumberMigrations(self, changes, app_label, number):
483.         if len(changes.get(app_label, [])) != number:
484.             self.fail("Incorrect number of migrations (%s) for %s (expected %s)\n%s" % (
485.                 len(changes.get(app_label, [])),
486.                 app_label,
487.                 number,
488.                 self.repr_changes(changes),
489.             ))
490. 
491.     def assertMigrationDependencies(self, changes, app_label, position, dependencies):
492.         if not changes.get(app_label):
493.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
494.         if len(changes[app_label]) < position + 1:
495.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
496.         migration = changes[app_label][position]
497.         if set(migration.dependencies) != set(dependencies):
498.             self.fail("Migration dependencies mismatch for %s.%s (expected %s):\n%s" % (
499.                 app_label,
500.                 migration.name,
501.                 dependencies,
502.                 self.repr_changes(changes, include_dependencies=True),
503.             ))
504. 
505.     def assertOperationTypes(self, changes, app_label, position, types):
506.         if not changes.get(app_label):
507.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
508.         if len(changes[app_label]) < position + 1:
509.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
510.         migration = changes[app_label][position]
511.         real_types = [operation.__class__.__name__ for operation in migration.operations]
512.         if types != real_types:
513.             self.fail("Operation type mismatch for %s.%s (expected %s):\n%s" % (
514.                 app_label,
515.                 migration.name,
516.                 types,
517.                 self.repr_changes(changes),
518.             ))
519. 
520.     def assertOperationAttributes(self, changes, app_label, position, operation_position, **attrs):
521.         if not changes.get(app_label):
522.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
523.         if len(changes[app_label]) < position + 1:
524.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
525.         migration = changes[app_label][position]
526.         if len(changes[app_label]) < position + 1:
527.             self.fail("No operation at index %s for %s.%s\n%s" % (
528.                 operation_position,
529.                 app_label,
530.                 migration.name,
531.                 self.repr_changes(changes),
532.             ))
533.         operation = migration.operations[operation_position]
534.         for attr, value in attrs.items():
535.             if getattr(operation, attr, None) != value:
536.                 self.fail("Attribute mismatch for %s.%s op #%s, %s (expected %r, got %r):\n%s" % (
537.                     app_label,
538.                     migration.name,
539.                     operation_position,
540.                     attr,
541.                     value,
542.                     getattr(operation, attr, None),
543.                     self.repr_changes(changes),
544.                 ))
545. 
546.     def assertOperationFieldAttributes(self, changes, app_label, position, operation_position, **attrs):
547.         if not changes.get(app_label):
548.             self.fail("No migrations found for %s\n%s" % (app_label, self.repr_changes(changes)))
549.         if len(changes[app_label]) < position + 1:
550.             self.fail("No migration at index %s for %s\n%s" % (position, app_label, self.repr_changes(changes)))
551.         migration = changes[app_label][position]
552.         if len(changes[app_label]) < position + 1:
553.             self.fail("No operation at index %s for %s.%s\n%s" % (
554.                 operation_position,
555.                 app_label,
556.                 migration.name,
557.                 self.repr_changes(changes),
558.             ))
559.         operation = migration.operations[operation_position]
560.         if not hasattr(operation, 'field'):
561.             self.fail("No field attribute for %s.%s op #%s." % (
562.                 app_label,
563.                 migration.name,
564.                 operation_position,
565.             ))
566.         field = operation.field
567.         for attr, value in attrs.items():
568.             if getattr(field, attr, None) != value:
569.                 self.fail("Field attribute mismatch for %s.%s op #%s, field.%s (expected %r, got %r):\n%s" % (
570.                     app_label,
571.                     migration.name,
572.                     operation_position,
573.                     attr,
574.                     value,
575.                     getattr(field, attr, None),
576.                     self.repr_changes(changes),
577.                 ))
578. 
579.     def make_project_state(self, model_states):
580.         "Shortcut to make ProjectStates from lists of predefined models"
581.         project_state = ProjectState()
582.         for model_state in model_states:
583.             project_state.add_model(model_state.clone())
584.         return project_state
585. 
586.     def get_changes(self, before_states, after_states, questioner=None):
587.         if not isinstance(before_states, ProjectState):
588.             before_states = self.make_project_state(before_states)
589.         if not isinstance(after_states, ProjectState):
590.             after_states = self.make_project_state(after_states)
591.         return MigrationAutodetector(
592.             before_states,
593.             after_states,
594.             questioner,
595.         )._detect_changes()
596. 
597.     def test_arrange_for_graph(self):
598.         """Tests auto-naming of migrations for graph matching."""
599.         # Make a fake graph
600.         graph = MigrationGraph()
601.         graph.add_node(("testapp", "0001_initial"), None)
602.         graph.add_node(("testapp", "0002_foobar"), None)
603.         graph.add_node(("otherapp", "0001_initial"), None)
604.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("testapp", "0001_initial"))
605.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("otherapp", "0001_initial"))
606.         # Use project state to make a new migration change set
607.         before = self.make_project_state([self.publisher, self.other_pony])
608.         after = self.make_project_state([
609.             self.author_empty, self.publisher, self.other_pony, self.other_stable,
610.         ])
611.         autodetector = MigrationAutodetector(before, after)
612.         changes = autodetector._detect_changes()
613.         # Run through arrange_for_graph
614.         changes = autodetector.arrange_for_graph(changes, graph)
615.         # Make sure there's a new name, deps match, etc.
616.         self.assertEqual(changes["testapp"][0].name, "0003_author")
617.         self.assertEqual(changes["testapp"][0].dependencies, [("testapp", "0002_foobar")])
618.         self.assertEqual(changes["otherapp"][0].name, '0002_stable')
619.         self.assertEqual(changes["otherapp"][0].dependencies, [("otherapp", "0001_initial")])
620. 
621.     def test_arrange_for_graph_with_multiple_initial(self):
622.         # Make a fake graph.
623.         graph = MigrationGraph()
624.         # Use project state to make a new migration change set.
625.         before = self.make_project_state([])
626.         after = self.make_project_state([self.author_with_book, self.book, self.attribution])
627.         autodetector = MigrationAutodetector(before, after, MigrationQuestioner({'ask_initial': True}))
628.         changes = autodetector._detect_changes()
629.         changes = autodetector.arrange_for_graph(changes, graph)
630. 
631.         self.assertEqual(changes['otherapp'][0].name, '0001_initial')
632.         self.assertEqual(changes['otherapp'][0].dependencies, [])
633.         self.assertEqual(changes['otherapp'][1].name, '0002_initial')
634.         self.assertCountEqual(
635.             changes['otherapp'][1].dependencies,
636.             [('testapp', '0001_initial'), ('otherapp', '0001_initial')],
637.         )
638.         self.assertEqual(changes['testapp'][0].name, '0001_initial')
639.         self.assertEqual(changes['testapp'][0].dependencies, [('otherapp', '0001_initial')])
640. 
641.     def test_trim_apps(self):
642.         """
643.         Trim does not remove dependencies but does remove unwanted apps.
644.         """
645.         # Use project state to make a new migration change set
646.         before = self.make_project_state([])
647.         after = self.make_project_state([self.author_empty, self.other_pony, self.other_stable, self.third_thing])
648.         autodetector = MigrationAutodetector(before, after, MigrationQuestioner({"ask_initial": True}))
649.         changes = autodetector._detect_changes()
650.         # Run through arrange_for_graph
651.         graph = MigrationGraph()
652.         changes = autodetector.arrange_for_graph(changes, graph)
653.         changes["testapp"][0].dependencies.append(("otherapp", "0001_initial"))
654.         changes = autodetector._trim_to_apps(changes, {"testapp"})
655.         # Make sure there's the right set of migrations
656.         self.assertEqual(changes["testapp"][0].name, "0001_initial")
657.         self.assertEqual(changes["otherapp"][0].name, "0001_initial")
658.         self.assertNotIn("thirdapp", changes)
659. 
660.     def test_custom_migration_name(self):
661.         """Tests custom naming of migrations for graph matching."""
662.         # Make a fake graph
663.         graph = MigrationGraph()
664.         graph.add_node(("testapp", "0001_initial"), None)
665.         graph.add_node(("testapp", "0002_foobar"), None)
666.         graph.add_node(("otherapp", "0001_initial"), None)
667.         graph.add_dependency("testapp.0002_foobar", ("testapp", "0002_foobar"), ("testapp", "0001_initial"))
668. 
669.         # Use project state to make a new migration change set
670.         before = self.make_project_state([])
671.         after = self.make_project_state([self.author_empty, self.other_pony, self.other_stable])
672.         autodetector = MigrationAutodetector(before, after)
673.         changes = autodetector._detect_changes()
674. 
675.         # Run through arrange_for_graph
676.         migration_name = 'custom_name'
677.         changes = autodetector.arrange_for_graph(changes, graph, migration_name)
678. 
679.         # Make sure there's a new name, deps match, etc.
680.         self.assertEqual(changes["testapp"][0].name, "0003_%s" % migration_name)
681.         self.assertEqual(changes["testapp"][0].dependencies, [("testapp", "0002_foobar")])
682.         self.assertEqual(changes["otherapp"][0].name, "0002_%s" % migration_name)
683.         self.assertEqual(changes["otherapp"][0].dependencies, [("otherapp", "0001_initial")])
684. 
685.     def test_new_model(self):
686.         """Tests autodetection of new models."""
687.         changes = self.get_changes([], [self.other_pony_food])
688.         # Right number/type of migrations?
689.         self.assertNumberMigrations(changes, 'otherapp', 1)
690.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
691.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="Pony")
692.         self.assertEqual([name for name, mgr in changes['otherapp'][0].operations[0].managers],
693.                          ['food_qs', 'food_mgr', 'food_mgr_kwargs'])
694. 
695.     def test_old_model(self):
696.         """Tests deletion of old models."""
697.         changes = self.get_changes([self.author_empty], [])
698.         # Right number/type of migrations?
699.         self.assertNumberMigrations(changes, 'testapp', 1)
700.         self.assertOperationTypes(changes, 'testapp', 0, ["DeleteModel"])
701.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Author")
702. 
703.     def test_add_field(self):
704.         """Tests autodetection of new fields."""
705.         changes = self.get_changes([self.author_empty], [self.author_name])
706.         # Right number/type of migrations?
707.         self.assertNumberMigrations(changes, 'testapp', 1)
708.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
709.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name")
710. 
711.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
712.                 side_effect=AssertionError("Should not have prompted for not null addition"))
713.     def test_add_date_fields_with_auto_now_not_asking_for_default(self, mocked_ask_method):
714.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now])
715.         # Right number/type of migrations?
716.         self.assertNumberMigrations(changes, 'testapp', 1)
717.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
718.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now=True)
719.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now=True)
720.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now=True)
721. 
722.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
723.                 side_effect=AssertionError("Should not have prompted for not null addition"))
724.     def test_add_date_fields_with_auto_now_add_not_asking_for_null_addition(self, mocked_ask_method):
725.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now_add])
726.         # Right number/type of migrations?
727.         self.assertNumberMigrations(changes, 'testapp', 1)
728.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
729.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now_add=True)
730.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now_add=True)
731.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now_add=True)
732. 
733.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_auto_now_add_addition')
734.     def test_add_date_fields_with_auto_now_add_asking_for_default(self, mocked_ask_method):
735.         changes = self.get_changes([self.author_empty], [self.author_dates_of_birth_auto_now_add])
736.         # Right number/type of migrations?
737.         self.assertNumberMigrations(changes, 'testapp', 1)
738.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField", "AddField"])
739.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, auto_now_add=True)
740.         self.assertOperationFieldAttributes(changes, "testapp", 0, 1, auto_now_add=True)
741.         self.assertOperationFieldAttributes(changes, "testapp", 0, 2, auto_now_add=True)
742.         self.assertEqual(mocked_ask_method.call_count, 3)
743. 
744.     def test_remove_field(self):
745.         """Tests autodetection of removed fields."""
746.         changes = self.get_changes([self.author_name], [self.author_empty])
747.         # Right number/type of migrations?
748.         self.assertNumberMigrations(changes, 'testapp', 1)
749.         self.assertOperationTypes(changes, 'testapp', 0, ["RemoveField"])
750.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name")
751. 
752.     def test_alter_field(self):
753.         """Tests autodetection of new fields."""
754.         changes = self.get_changes([self.author_name], [self.author_name_longer])
755.         # Right number/type of migrations?
756.         self.assertNumberMigrations(changes, 'testapp', 1)
757.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
758.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
759. 
760.     def test_supports_functools_partial(self):
761.         def _content_file_name(instance, filename, key, **kwargs):
762.             return '{}/{}'.format(instance, filename)
763. 
764.         def content_file_name(key, **kwargs):
765.             return functools.partial(_content_file_name, key, **kwargs)
766. 
767.         # An unchanged partial reference.
768.         before = [ModelState("testapp", "Author", [
769.             ("id", models.AutoField(primary_key=True)),
770.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file'))),
771.         ])]
772.         after = [ModelState("testapp", "Author", [
773.             ("id", models.AutoField(primary_key=True)),
774.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file'))),
775.         ])]
776.         changes = self.get_changes(before, after)
777.         self.assertNumberMigrations(changes, 'testapp', 0)
778. 
779.         # A changed partial reference.
780.         args_changed = [ModelState("testapp", "Author", [
781.             ("id", models.AutoField(primary_key=True)),
782.             ("file", models.FileField(max_length=200, upload_to=content_file_name('other-file'))),
783.         ])]
784.         changes = self.get_changes(before, args_changed)
785.         self.assertNumberMigrations(changes, 'testapp', 1)
786.         self.assertOperationTypes(changes, 'testapp', 0, ['AlterField'])
787.         # Can't use assertOperationFieldAttributes because we need the
788.         # deconstructed version, i.e., the exploded func/args/keywords rather
789.         # than the partial: we don't care if it's not the same instance of the
790.         # partial, only if it's the same source function, args, and keywords.
791.         value = changes['testapp'][0].operations[0].field.upload_to
792.         self.assertEqual(
793.             (_content_file_name, ('other-file',), {}),
794.             (value.func, value.args, value.keywords)
795.         )
796. 
797.         kwargs_changed = [ModelState("testapp", "Author", [
798.             ("id", models.AutoField(primary_key=True)),
799.             ("file", models.FileField(max_length=200, upload_to=content_file_name('file', spam='eggs'))),
800.         ])]
801.         changes = self.get_changes(before, kwargs_changed)
802.         self.assertNumberMigrations(changes, 'testapp', 1)
803.         self.assertOperationTypes(changes, 'testapp', 0, ['AlterField'])
804.         value = changes['testapp'][0].operations[0].field.upload_to
805.         self.assertEqual(
806.             (_content_file_name, ('file',), {'spam': 'eggs'}),
807.             (value.func, value.args, value.keywords)
808.         )
809. 
810.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
811.                 side_effect=AssertionError("Should not have prompted for not null addition"))
812.     def test_alter_field_to_not_null_with_default(self, mocked_ask_method):
813.         """
814.         #23609 - Tests autodetection of nullable to non-nullable alterations.
815.         """
816.         changes = self.get_changes([self.author_name_null], [self.author_name_default])
817.         # Right number/type of migrations?
818.         self.assertNumberMigrations(changes, 'testapp', 1)
819.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
820.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
821.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default='Ada Lovelace')
822. 
823.     @mock.patch(
824.         'django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
825.         return_value=models.NOT_PROVIDED,
826.     )
827.     def test_alter_field_to_not_null_without_default(self, mocked_ask_method):
828.         """
829.         #23609 - Tests autodetection of nullable to non-nullable alterations.
830.         """
831.         changes = self.get_changes([self.author_name_null], [self.author_name])
832.         self.assertEqual(mocked_ask_method.call_count, 1)
833.         # Right number/type of migrations?
834.         self.assertNumberMigrations(changes, 'testapp', 1)
835.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
836.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=True)
837.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default=models.NOT_PROVIDED)
838. 
839.     @mock.patch(
840.         'django.db.migrations.questioner.MigrationQuestioner.ask_not_null_alteration',
841.         return_value='Some Name',
842.     )
843.     def test_alter_field_to_not_null_oneoff_default(self, mocked_ask_method):
844.         """
845.         #23609 - Tests autodetection of nullable to non-nullable alterations.
846.         """
847.         changes = self.get_changes([self.author_name_null], [self.author_name])
848.         self.assertEqual(mocked_ask_method.call_count, 1)
849.         # Right number/type of migrations?
850.         self.assertNumberMigrations(changes, 'testapp', 1)
851.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
852.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="name", preserve_default=False)
853.         self.assertOperationFieldAttributes(changes, "testapp", 0, 0, default="Some Name")
854. 
855.     def test_rename_field(self):
856.         """Tests autodetection of renamed fields."""
857.         changes = self.get_changes(
858.             [self.author_name], [self.author_name_renamed], MigrationQuestioner({"ask_rename": True})
859.         )
860.         # Right number/type of migrations?
861.         self.assertNumberMigrations(changes, 'testapp', 1)
862.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameField"])
863.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="name", new_name="names")
864. 
865.     def test_rename_field_foreign_key_to_field(self):
866.         before = [
867.             ModelState('app', 'Foo', [
868.                 ('id', models.AutoField(primary_key=True)),
869.                 ('field', models.IntegerField(unique=True)),
870.             ]),
871.             ModelState('app', 'Bar', [
872.                 ('id', models.AutoField(primary_key=True)),
873.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE, to_field='field')),
874.             ]),
875.         ]
876.         after = [
877.             ModelState('app', 'Foo', [
878.                 ('id', models.AutoField(primary_key=True)),
879.                 ('renamed_field', models.IntegerField(unique=True)),
880.             ]),
881.             ModelState('app', 'Bar', [
882.                 ('id', models.AutoField(primary_key=True)),
883.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE, to_field='renamed_field')),
884.             ]),
885.         ]
886.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
887.         # Right number/type of migrations?
888.         self.assertNumberMigrations(changes, 'app', 1)
889.         self.assertOperationTypes(changes, 'app', 0, ['RenameField'])
890.         self.assertOperationAttributes(changes, 'app', 0, 0, old_name='field', new_name='renamed_field')
891. 
892.     def test_rename_foreign_object_fields(self):
893.         fields = ('first', 'second')
894.         renamed_fields = ('first_renamed', 'second_renamed')
895.         before = [
896.             ModelState('app', 'Foo', [
897.                 ('id', models.AutoField(primary_key=True)),
898.                 ('first', models.IntegerField()),
899.                 ('second', models.IntegerField()),
900.             ], options={'unique_together': {fields}}),
901.             ModelState('app', 'Bar', [
902.                 ('id', models.AutoField(primary_key=True)),
903.                 ('first', models.IntegerField()),
904.                 ('second', models.IntegerField()),
905.                 ('foo', models.ForeignObject(
906.                     'app.Foo', models.CASCADE, from_fields=fields, to_fields=fields,
907.                 )),
908.             ]),
909.         ]
910.         # Case 1: to_fields renames.
911.         after = [
912.             ModelState('app', 'Foo', [
913.                 ('id', models.AutoField(primary_key=True)),
914.                 ('first_renamed', models.IntegerField()),
915.                 ('second_renamed', models.IntegerField()),
916.             ], options={'unique_together': {renamed_fields}}),
917.             ModelState('app', 'Bar', [
918.                 ('id', models.AutoField(primary_key=True)),
919.                 ('first', models.IntegerField()),
920.                 ('second', models.IntegerField()),
921.                 ('foo', models.ForeignObject(
922.                     'app.Foo', models.CASCADE, from_fields=fields, to_fields=renamed_fields,
923.                 )),
924.             ]),
925.         ]
926.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
927.         self.assertNumberMigrations(changes, 'app', 1)
928.         self.assertOperationTypes(changes, 'app', 0, ['RenameField', 'RenameField', 'AlterUniqueTogether'])
929.         self.assertOperationAttributes(
930.             changes, 'app', 0, 0, model_name='foo', old_name='first', new_name='first_renamed',
931.         )
932.         self.assertOperationAttributes(
933.             changes, 'app', 0, 1, model_name='foo', old_name='second', new_name='second_renamed',
934.         )
935.         # Case 2: from_fields renames.
936.         after = [
937.             ModelState('app', 'Foo', [
938.                 ('id', models.AutoField(primary_key=True)),
939.                 ('first', models.IntegerField()),
940.                 ('second', models.IntegerField()),
941.             ], options={'unique_together': {fields}}),
942.             ModelState('app', 'Bar', [
943.                 ('id', models.AutoField(primary_key=True)),
944.                 ('first_renamed', models.IntegerField()),
945.                 ('second_renamed', models.IntegerField()),
946.                 ('foo', models.ForeignObject(
947.                     'app.Foo', models.CASCADE, from_fields=renamed_fields, to_fields=fields,
948.                 )),
949.             ]),
950.         ]
951.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
952.         self.assertNumberMigrations(changes, 'app', 1)
953.         self.assertOperationTypes(changes, 'app', 0, ['RenameField', 'RenameField'])
954.         self.assertOperationAttributes(
955.             changes, 'app', 0, 0, model_name='bar', old_name='first', new_name='first_renamed',
956.         )
957.         self.assertOperationAttributes(
958.             changes, 'app', 0, 1, model_name='bar', old_name='second', new_name='second_renamed',
959.         )
960. 
961.     def test_rename_referenced_primary_key(self):
962.         before = [
963.             ModelState('app', 'Foo', [
964.                 ('id', models.CharField(primary_key=True, serialize=False)),
965.             ]),
966.             ModelState('app', 'Bar', [
967.                 ('id', models.AutoField(primary_key=True)),
968.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
969.             ]),
970.         ]
971.         after = [
972.             ModelState('app', 'Foo', [
973.                 ('renamed_id', models.CharField(primary_key=True, serialize=False))
974.             ]),
975.             ModelState('app', 'Bar', [
976.                 ('id', models.AutoField(primary_key=True)),
977.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
978.             ]),
979.         ]
980.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
981.         self.assertNumberMigrations(changes, 'app', 1)
982.         self.assertOperationTypes(changes, 'app', 0, ['RenameField'])
983.         self.assertOperationAttributes(changes, 'app', 0, 0, old_name='id', new_name='renamed_id')
984. 
985.     def test_rename_field_preserved_db_column(self):
986.         """
987.         RenameField is used if a field is renamed and db_column equal to the
988.         old field's column is added.
989.         """
990.         before = [
991.             ModelState('app', 'Foo', [
992.                 ('id', models.AutoField(primary_key=True)),
993.                 ('field', models.IntegerField()),
994.             ]),
995.         ]
996.         after = [
997.             ModelState('app', 'Foo', [
998.                 ('id', models.AutoField(primary_key=True)),
999.                 ('renamed_field', models.IntegerField(db_column='field')),
1000.             ]),
1001.         ]
1002.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
1003.         self.assertNumberMigrations(changes, 'app', 1)
1004.         self.assertOperationTypes(changes, 'app', 0, ['AlterField', 'RenameField'])
1005.         self.assertOperationAttributes(
1006.             changes, 'app', 0, 0, model_name='foo', name='field',
1007.         )
1008.         self.assertEqual(changes['app'][0].operations[0].field.deconstruct(), (
1009.             'field', 'django.db.models.IntegerField', [], {'db_column': 'field'},
1010.         ))
1011.         self.assertOperationAttributes(
1012.             changes, 'app', 0, 1, model_name='foo', old_name='field',
1013.             new_name='renamed_field',
1014.         )
1015. 
1016.     def test_rename_related_field_preserved_db_column(self):
1017.         before = [
1018.             ModelState('app', 'Foo', [
1019.                 ('id', models.AutoField(primary_key=True)),
1020.             ]),
1021.             ModelState('app', 'Bar', [
1022.                 ('id', models.AutoField(primary_key=True)),
1023.                 ('foo', models.ForeignKey('app.Foo', models.CASCADE)),
1024.             ]),
1025.         ]
1026.         after = [
1027.             ModelState('app', 'Foo', [
1028.                 ('id', models.AutoField(primary_key=True)),
1029.             ]),
1030.             ModelState('app', 'Bar', [
1031.                 ('id', models.AutoField(primary_key=True)),
1032.                 ('renamed_foo', models.ForeignKey('app.Foo', models.CASCADE, db_column='foo_id')),
1033.             ]),
1034.         ]
1035.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename': True}))
1036.         self.assertNumberMigrations(changes, 'app', 1)
1037.         self.assertOperationTypes(changes, 'app', 0, ['AlterField', 'RenameField'])
1038.         self.assertOperationAttributes(
1039.             changes, 'app', 0, 0, model_name='bar', name='foo',
1040.         )
1041.         self.assertEqual(changes['app'][0].operations[0].field.deconstruct(), (
1042.             'foo',
1043.             'django.db.models.ForeignKey',
1044.             [],
1045.             {'to': 'app.foo', 'on_delete': models.CASCADE, 'db_column': 'foo_id'},
1046.         ))
1047.         self.assertOperationAttributes(
1048.             changes, 'app', 0, 1, model_name='bar', old_name='foo',
1049.             new_name='renamed_foo',
1050.         )
1051. 
1052.     def test_rename_model(self):
1053.         """Tests autodetection of renamed models."""
1054.         changes = self.get_changes(
1055.             [self.author_with_book, self.book],
1056.             [self.author_renamed_with_book, self.book_with_author_renamed],
1057.             MigrationQuestioner({"ask_rename_model": True}),
1058.         )
1059.         # Right number/type of migrations?
1060.         self.assertNumberMigrations(changes, 'testapp', 1)
1061.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1062.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="Author", new_name="Writer")
1063.         # Now that RenameModel handles related fields too, there should be
1064.         # no AlterField for the related field.
1065.         self.assertNumberMigrations(changes, 'otherapp', 0)
1066. 
1067.     def test_rename_model_case(self):
1068.         """
1069.         Model name is case-insensitive. Changing case doesn't lead to any
1070.         autodetected operations.
1071.         """
1072.         author_renamed = ModelState('testapp', 'author', [
1073.             ('id', models.AutoField(primary_key=True)),
1074.         ])
1075.         changes = self.get_changes(
1076.             [self.author_empty, self.book],
1077.             [author_renamed, self.book],
1078.             questioner=MigrationQuestioner({'ask_rename_model': True}),
1079.         )
1080.         self.assertNumberMigrations(changes, 'testapp', 0)
1081.         self.assertNumberMigrations(changes, 'otherapp', 0)
1082. 
1083.     def test_renamed_referenced_m2m_model_case(self):
1084.         publisher_renamed = ModelState('testapp', 'publisher', [
1085.             ('id', models.AutoField(primary_key=True)),
1086.             ('name', models.CharField(max_length=100)),
1087.         ])
1088.         changes = self.get_changes(
1089.             [self.publisher, self.author_with_m2m],
1090.             [publisher_renamed, self.author_with_m2m],
1091.             questioner=MigrationQuestioner({'ask_rename_model': True}),
1092.         )
1093.         self.assertNumberMigrations(changes, 'testapp', 0)
1094.         self.assertNumberMigrations(changes, 'otherapp', 0)
1095. 
1096.     def test_rename_m2m_through_model(self):
1097.         """
1098.         Tests autodetection of renamed models that are used in M2M relations as
1099.         through models.
1100.         """
1101.         changes = self.get_changes(
1102.             [self.author_with_m2m_through, self.publisher, self.contract],
1103.             [self.author_with_renamed_m2m_through, self.publisher, self.contract_renamed],
1104.             MigrationQuestioner({'ask_rename_model': True})
1105.         )
1106.         # Right number/type of migrations?
1107.         self.assertNumberMigrations(changes, 'testapp', 1)
1108.         self.assertOperationTypes(changes, 'testapp', 0, ['RenameModel'])
1109.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name='Contract', new_name='Deal')
1110. 
1111.     def test_rename_model_with_renamed_rel_field(self):
1112.         """
1113.         Tests autodetection of renamed models while simultaneously renaming one
1114.         of the fields that relate to the renamed model.
1115.         """
1116.         changes = self.get_changes(
1117.             [self.author_with_book, self.book],
1118.             [self.author_renamed_with_book, self.book_with_field_and_author_renamed],
1119.             MigrationQuestioner({"ask_rename": True, "ask_rename_model": True}),
1120.         )
1121.         # Right number/type of migrations?
1122.         self.assertNumberMigrations(changes, 'testapp', 1)
1123.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1124.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name="Author", new_name="Writer")
1125.         # Right number/type of migrations for related field rename?
1126.         # Alter is already taken care of.
1127.         self.assertNumberMigrations(changes, 'otherapp', 1)
1128.         self.assertOperationTypes(changes, 'otherapp', 0, ["RenameField"])
1129.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, old_name="author", new_name="writer")
1130. 
1131.     def test_rename_model_with_fks_in_different_position(self):
1132.         """
1133.         #24537 - The order of fields in a model does not influence
1134.         the RenameModel detection.
1135.         """
1136.         before = [
1137.             ModelState("testapp", "EntityA", [
1138.                 ("id", models.AutoField(primary_key=True)),
1139.             ]),
1140.             ModelState("testapp", "EntityB", [
1141.                 ("id", models.AutoField(primary_key=True)),
1142.                 ("some_label", models.CharField(max_length=255)),
1143.                 ("entity_a", models.ForeignKey("testapp.EntityA", models.CASCADE)),
1144.             ]),
1145.         ]
1146.         after = [
1147.             ModelState("testapp", "EntityA", [
1148.                 ("id", models.AutoField(primary_key=True)),
1149.             ]),
1150.             ModelState("testapp", "RenamedEntityB", [
1151.                 ("id", models.AutoField(primary_key=True)),
1152.                 ("entity_a", models.ForeignKey("testapp.EntityA", models.CASCADE)),
1153.                 ("some_label", models.CharField(max_length=255)),
1154.             ]),
1155.         ]
1156.         changes = self.get_changes(before, after, MigrationQuestioner({"ask_rename_model": True}))
1157.         self.assertNumberMigrations(changes, "testapp", 1)
1158.         self.assertOperationTypes(changes, "testapp", 0, ["RenameModel"])
1159.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="EntityB", new_name="RenamedEntityB")
1160. 
1161.     def test_rename_model_reverse_relation_dependencies(self):
1162.         """
1163.         The migration to rename a model pointed to by a foreign key in another
1164.         app must run after the other app's migration that adds the foreign key
1165.         with model's original name. Therefore, the renaming migration has a
1166.         dependency on that other migration.
1167.         """
1168.         before = [
1169.             ModelState('testapp', 'EntityA', [
1170.                 ('id', models.AutoField(primary_key=True)),
1171.             ]),
1172.             ModelState('otherapp', 'EntityB', [
1173.                 ('id', models.AutoField(primary_key=True)),
1174.                 ('entity_a', models.ForeignKey('testapp.EntityA', models.CASCADE)),
1175.             ]),
1176.         ]
1177.         after = [
1178.             ModelState('testapp', 'RenamedEntityA', [
1179.                 ('id', models.AutoField(primary_key=True)),
1180.             ]),
1181.             ModelState('otherapp', 'EntityB', [
1182.                 ('id', models.AutoField(primary_key=True)),
1183.                 ('entity_a', models.ForeignKey('testapp.RenamedEntityA', models.CASCADE)),
1184.             ]),
1185.         ]
1186.         changes = self.get_changes(before, after, MigrationQuestioner({'ask_rename_model': True}))
1187.         self.assertNumberMigrations(changes, 'testapp', 1)
1188.         self.assertMigrationDependencies(changes, 'testapp', 0, [('otherapp', '__first__')])
1189.         self.assertOperationTypes(changes, 'testapp', 0, ['RenameModel'])
1190.         self.assertOperationAttributes(changes, 'testapp', 0, 0, old_name='EntityA', new_name='RenamedEntityA')
1191. 
1192.     def test_fk_dependency(self):
1193.         """Having a ForeignKey automatically adds a dependency."""
1194.         # Note that testapp (author) has no dependencies,
1195.         # otherapp (book) depends on testapp (author),
1196.         # thirdapp (edition) depends on otherapp (book)
1197.         changes = self.get_changes([], [self.author_name, self.book, self.edition])
1198.         # Right number/type of migrations?
1199.         self.assertNumberMigrations(changes, 'testapp', 1)
1200.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1201.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1202.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1203.         # Right number/type of migrations?
1204.         self.assertNumberMigrations(changes, 'otherapp', 1)
1205.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1206.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
1207.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("testapp", "auto_1")])
1208.         # Right number/type of migrations?
1209.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1210.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel"])
1211.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="Edition")
1212.         self.assertMigrationDependencies(changes, 'thirdapp', 0, [("otherapp", "auto_1")])
1213. 
1214.     def test_proxy_fk_dependency(self):
1215.         """FK dependencies still work on proxy models."""
1216.         # Note that testapp (author) has no dependencies,
1217.         # otherapp (book) depends on testapp (authorproxy)
1218.         changes = self.get_changes([], [self.author_empty, self.author_proxy_third, self.book_proxy_fk])
1219.         # Right number/type of migrations?
1220.         self.assertNumberMigrations(changes, 'testapp', 1)
1221.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1222.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1223.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1224.         # Right number/type of migrations?
1225.         self.assertNumberMigrations(changes, 'otherapp', 1)
1226.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1227.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
1228.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("thirdapp", "auto_1")])
1229.         # Right number/type of migrations?
1230.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1231.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel"])
1232.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="AuthorProxy")
1233.         self.assertMigrationDependencies(changes, 'thirdapp', 0, [("testapp", "auto_1")])
1234. 
1235.     def test_same_app_no_fk_dependency(self):
1236.         """
1237.         A migration with a FK between two models of the same app
1238.         does not have a dependency to itself.
1239.         """
1240.         changes = self.get_changes([], [self.author_with_publisher, self.publisher])
1241.         # Right number/type of migrations?
1242.         self.assertNumberMigrations(changes, 'testapp', 1)
1243.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
1244.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Publisher")
1245.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
1246.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1247. 
1248.     def test_circular_fk_dependency(self):
1249.         """
1250.         Having a circular ForeignKey dependency automatically
1251.         resolves the situation into 2 migrations on one side and 1 on the other.
1252.         """
1253.         changes = self.get_changes([], [self.author_with_book, self.book, self.publisher_with_book])
1254.         # Right number/type of migrations?
1255.         self.assertNumberMigrations(changes, 'testapp', 1)
1256.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
1257.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Publisher")
1258.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
1259.         self.assertMigrationDependencies(changes, 'testapp', 0, [("otherapp", "auto_1")])
1260.         # Right number/type of migrations?
1261.         self.assertNumberMigrations(changes, 'otherapp', 2)
1262.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
1263.         self.assertOperationTypes(changes, 'otherapp', 1, ["AddField"])
1264.         self.assertMigrationDependencies(changes, 'otherapp', 0, [])
1265.         self.assertMigrationDependencies(changes, 'otherapp', 1, [("otherapp", "auto_1"), ("testapp", "auto_1")])
1266.         # both split migrations should be `initial`
1267.         self.assertTrue(changes['otherapp'][0].initial)
1268.         self.assertTrue(changes['otherapp'][1].initial)
1269. 
1270.     def test_same_app_circular_fk_dependency(self):
1271.         """
1272.         A migration with a FK between two models of the same app does
1273.         not have a dependency to itself.
1274.         """
1275.         changes = self.get_changes([], [self.author_with_publisher, self.publisher_with_author])
1276.         # Right number/type of migrations?
1277.         self.assertNumberMigrations(changes, 'testapp', 1)
1278.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel", "AddField"])
1279.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="Author")
1280.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Publisher")
1281.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="publisher")
1282.         self.assertMigrationDependencies(changes, 'testapp', 0, [])
1283. 
1284.     def test_same_app_circular_fk_dependency_with_unique_together_and_indexes(self):
1285.         """
1286.         #22275 - A migration with circular FK dependency does not try
1287.         to create unique together constraint and indexes before creating all
1288.         required fields first.
1289.         """
1290.         changes = self.get_changes([], [self.knight, self.rabbit])
1291.         # Right number/type of migrations?
1292.         self.assertNumberMigrations(changes, 'eggs', 1)
1293.         self.assertOperationTypes(
1294.             changes, 'eggs', 0, ["CreateModel", "CreateModel", "AddIndex", "AlterUniqueTogether"]
1295.         )
1296.         self.assertNotIn("unique_together", changes['eggs'][0].operations[0].options)
1297.         self.assertNotIn("unique_together", changes['eggs'][0].operations[1].options)
1298.         self.assertMigrationDependencies(changes, 'eggs', 0, [])
1299. 
1300.     def test_alter_db_table_add(self):
1301.         """Tests detection for adding db_table in model's options."""
1302.         changes = self.get_changes([self.author_empty], [self.author_with_db_table_options])
1303.         # Right number/type of migrations?
1304.         self.assertNumberMigrations(changes, 'testapp', 1)
1305.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1306.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table="author_one")
1307. 
1308.     def test_alter_db_table_change(self):
1309.         """Tests detection for changing db_table in model's options'."""
1310.         changes = self.get_changes([self.author_with_db_table_options], [self.author_with_new_db_table_options])
1311.         # Right number/type of migrations?
1312.         self.assertNumberMigrations(changes, 'testapp', 1)
1313.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1314.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table="author_two")
1315. 
1316.     def test_alter_db_table_remove(self):
1317.         """Tests detection for removing db_table in model's options."""
1318.         changes = self.get_changes([self.author_with_db_table_options], [self.author_empty])
1319.         # Right number/type of migrations?
1320.         self.assertNumberMigrations(changes, 'testapp', 1)
1321.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelTable"])
1322.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", table=None)
1323. 
1324.     def test_alter_db_table_no_changes(self):
1325.         """
1326.         Alter_db_table doesn't generate a migration if no changes have been made.
1327.         """
1328.         changes = self.get_changes([self.author_with_db_table_options], [self.author_with_db_table_options])
1329.         # Right number of migrations?
1330.         self.assertEqual(len(changes), 0)
1331. 
1332.     def test_keep_db_table_with_model_change(self):
1333.         """
1334.         Tests when model changes but db_table stays as-is, autodetector must not
1335.         create more than one operation.
1336.         """
1337.         changes = self.get_changes(
1338.             [self.author_with_db_table_options],
1339.             [self.author_renamed_with_db_table_options],
1340.             MigrationQuestioner({"ask_rename_model": True}),
1341.         )
1342.         # Right number/type of migrations?
1343.         self.assertNumberMigrations(changes, 'testapp', 1)
1344.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel"])
1345.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="Author", new_name="NewAuthor")
1346. 
1347.     def test_alter_db_table_with_model_change(self):
1348.         """
1349.         Tests when model and db_table changes, autodetector must create two
1350.         operations.
1351.         """
1352.         changes = self.get_changes(
1353.             [self.author_with_db_table_options],
1354.             [self.author_renamed_with_new_db_table_options],
1355.             MigrationQuestioner({"ask_rename_model": True}),
1356.         )
1357.         # Right number/type of migrations?
1358.         self.assertNumberMigrations(changes, 'testapp', 1)
1359.         self.assertOperationTypes(changes, 'testapp', 0, ["RenameModel", "AlterModelTable"])
1360.         self.assertOperationAttributes(changes, "testapp", 0, 0, old_name="Author", new_name="NewAuthor")
1361.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="newauthor", table="author_three")
1362. 
1363.     def test_identical_regex_doesnt_alter(self):
1364.         from_state = ModelState(
1365.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[
1366.                 RegexValidator(
1367.                     re.compile('^[-a-zA-Z0-9_]+\\Z'),
1368.                     'Enter a valid “slug” consisting of letters, numbers, underscores or hyphens.',
1369.                     'invalid'
1370.                 )
1371.             ]))]
1372.         )
1373.         to_state = ModelState(
1374.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[validate_slug]))]
1375.         )
1376.         changes = self.get_changes([from_state], [to_state])
1377.         # Right number/type of migrations?
1378.         self.assertNumberMigrations(changes, "testapp", 0)
1379. 
1380.     def test_different_regex_does_alter(self):
1381.         from_state = ModelState(
1382.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[
1383.                 RegexValidator(
1384.                     re.compile('^[a-z]+\\Z', 32),
1385.                     'Enter a valid “slug” consisting of letters, numbers, underscores or hyphens.',
1386.                     'invalid'
1387.                 )
1388.             ]))]
1389.         )
1390.         to_state = ModelState(
1391.             "testapp", "model", [("id", models.AutoField(primary_key=True, validators=[validate_slug]))]
1392.         )
1393.         changes = self.get_changes([from_state], [to_state])
1394.         self.assertNumberMigrations(changes, "testapp", 1)
1395.         self.assertOperationTypes(changes, "testapp", 0, ["AlterField"])
1396. 
1397.     def test_empty_foo_together(self):
1398.         """
1399.         #23452 - Empty unique/index_together shouldn't generate a migration.
1400.         """
1401.         # Explicitly testing for not specified, since this is the case after
1402.         # a CreateModel operation w/o any definition on the original model
1403.         model_state_not_specified = ModelState("a", "model", [("id", models.AutoField(primary_key=True))])
1404.         # Explicitly testing for None, since this was the issue in #23452 after
1405.         # an AlterFooTogether operation with e.g. () as value
1406.         model_state_none = ModelState("a", "model", [
1407.             ("id", models.AutoField(primary_key=True))
1408.         ], {
1409.             "index_together": None,
1410.             "unique_together": None,
1411.         })
1412.         # Explicitly testing for the empty set, since we now always have sets.
1413.         # During removal (('col1', 'col2'),) --> () this becomes set([])
1414.         model_state_empty = ModelState("a", "model", [
1415.             ("id", models.AutoField(primary_key=True))
1416.         ], {
1417.             "index_together": set(),
1418.             "unique_together": set(),
1419.         })
1420. 
1421.         def test(from_state, to_state, msg):
1422.             changes = self.get_changes([from_state], [to_state])
1423.             if changes:
1424.                 ops = ', '.join(o.__class__.__name__ for o in changes['a'][0].operations)
1425.                 self.fail('Created operation(s) %s from %s' % (ops, msg))
1426. 
1427.         tests = (
1428.             (model_state_not_specified, model_state_not_specified, '"not specified" to "not specified"'),
1429.             (model_state_not_specified, model_state_none, '"not specified" to "None"'),
1430.             (model_state_not_specified, model_state_empty, '"not specified" to "empty"'),
1431.             (model_state_none, model_state_not_specified, '"None" to "not specified"'),
1432.             (model_state_none, model_state_none, '"None" to "None"'),
1433.             (model_state_none, model_state_empty, '"None" to "empty"'),
1434.             (model_state_empty, model_state_not_specified, '"empty" to "not specified"'),
1435.             (model_state_empty, model_state_none, '"empty" to "None"'),
1436.             (model_state_empty, model_state_empty, '"empty" to "empty"'),
1437.         )
1438. 
1439.         for t in tests:
1440.             test(*t)
1441. 
1442.     def test_create_model_with_indexes(self):
1443.         """Test creation of new model with indexes already defined."""
1444.         author = ModelState('otherapp', 'Author', [
1445.             ('id', models.AutoField(primary_key=True)),
1446.             ('name', models.CharField(max_length=200)),
1447.         ], {'indexes': [models.Index(fields=['name'], name='create_model_with_indexes_idx')]})
1448.         changes = self.get_changes([], [author])
1449.         added_index = models.Index(fields=['name'], name='create_model_with_indexes_idx')
1450.         # Right number of migrations?
1451.         self.assertEqual(len(changes['otherapp']), 1)
1452.         # Right number of actions?
1453.         migration = changes['otherapp'][0]
1454.         self.assertEqual(len(migration.operations), 2)
1455.         # Right actions order?
1456.         self.assertOperationTypes(changes, 'otherapp', 0, ['CreateModel', 'AddIndex'])
1457.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='Author')
1458.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='author', index=added_index)
1459. 
1460.     def test_add_indexes(self):
1461.         """Test change detection of new indexes."""
1462.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_indexes])
1463.         self.assertNumberMigrations(changes, 'otherapp', 1)
1464.         self.assertOperationTypes(changes, 'otherapp', 0, ['AddIndex'])
1465.         added_index = models.Index(fields=['author', 'title'], name='book_title_author_idx')
1466.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', index=added_index)
1467. 
1468.     def test_remove_indexes(self):
1469.         """Test change detection of removed indexes."""
1470.         changes = self.get_changes([self.author_empty, self.book_indexes], [self.author_empty, self.book])
1471.         # Right number/type of migrations?
1472.         self.assertNumberMigrations(changes, 'otherapp', 1)
1473.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveIndex'])
1474.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', name='book_title_author_idx')
1475. 
1476.     def test_order_fields_indexes(self):
1477.         """Test change detection of reordering of fields in indexes."""
1478.         changes = self.get_changes(
1479.             [self.author_empty, self.book_indexes], [self.author_empty, self.book_unordered_indexes]
1480.         )
1481.         self.assertNumberMigrations(changes, 'otherapp', 1)
1482.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveIndex', 'AddIndex'])
1483.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, model_name='book', name='book_title_author_idx')
1484.         added_index = models.Index(fields=['title', 'author'], name='book_author_title_idx')
1485.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='book', index=added_index)
1486. 
1487.     def test_create_model_with_check_constraint(self):
1488.         """Test creation of new model with constraints already defined."""
1489.         author = ModelState('otherapp', 'Author', [
1490.             ('id', models.AutoField(primary_key=True)),
1491.             ('name', models.CharField(max_length=200)),
1492.         ], {'constraints': [models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')]})
1493.         changes = self.get_changes([], [author])
1494.         added_constraint = models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')
1495.         # Right number of migrations?
1496.         self.assertEqual(len(changes['otherapp']), 1)
1497.         # Right number of actions?
1498.         migration = changes['otherapp'][0]
1499.         self.assertEqual(len(migration.operations), 2)
1500.         # Right actions order?
1501.         self.assertOperationTypes(changes, 'otherapp', 0, ['CreateModel', 'AddConstraint'])
1502.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='Author')
1503.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, model_name='author', constraint=added_constraint)
1504. 
1505.     def test_add_constraints(self):
1506.         """Test change detection of new constraints."""
1507.         changes = self.get_changes([self.author_name], [self.author_name_check_constraint])
1508.         self.assertNumberMigrations(changes, 'testapp', 1)
1509.         self.assertOperationTypes(changes, 'testapp', 0, ['AddConstraint'])
1510.         added_constraint = models.CheckConstraint(check=models.Q(name__contains='Bob'), name='name_contains_bob')
1511.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name='author', constraint=added_constraint)
1512. 
1513.     def test_remove_constraints(self):
1514.         """Test change detection of removed constraints."""
1515.         changes = self.get_changes([self.author_name_check_constraint], [self.author_name])
1516.         # Right number/type of migrations?
1517.         self.assertNumberMigrations(changes, 'testapp', 1)
1518.         self.assertOperationTypes(changes, 'testapp', 0, ['RemoveConstraint'])
1519.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name='author', name='name_contains_bob')
1520. 
1521.     def test_add_foo_together(self):
1522.         """Tests index/unique_together detection."""
1523.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_foo_together])
1524.         # Right number/type of migrations?
1525.         self.assertNumberMigrations(changes, "otherapp", 1)
1526.         self.assertOperationTypes(changes, "otherapp", 0, ["AlterUniqueTogether", "AlterIndexTogether"])
1527.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together={("author", "title")})
1528.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together={("author", "title")})
1529. 
1530.     def test_remove_foo_together(self):
1531.         """Tests index/unique_together detection."""
1532.         changes = self.get_changes([self.author_empty, self.book_foo_together], [self.author_empty, self.book])
1533.         # Right number/type of migrations?
1534.         self.assertNumberMigrations(changes, "otherapp", 1)
1535.         self.assertOperationTypes(changes, "otherapp", 0, ["AlterUniqueTogether", "AlterIndexTogether"])
1536.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together=set())
1537.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together=set())
1538. 
1539.     def test_foo_together_remove_fk(self):
1540.         """Tests unique_together and field removal detection & ordering"""
1541.         changes = self.get_changes(
1542.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_with_no_author]
1543.         )
1544.         # Right number/type of migrations?
1545.         self.assertNumberMigrations(changes, "otherapp", 1)
1546.         self.assertOperationTypes(changes, "otherapp", 0, [
1547.             "AlterUniqueTogether", "AlterIndexTogether", "RemoveField"
1548.         ])
1549.         self.assertOperationAttributes(changes, "otherapp", 0, 0, name="book", unique_together=set())
1550.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", index_together=set())
1551.         self.assertOperationAttributes(changes, "otherapp", 0, 2, model_name="book", name="author")
1552. 
1553.     def test_foo_together_no_changes(self):
1554.         """
1555.         index/unique_together doesn't generate a migration if no
1556.         changes have been made.
1557.         """
1558.         changes = self.get_changes(
1559.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_foo_together]
1560.         )
1561.         # Right number of migrations?
1562.         self.assertEqual(len(changes), 0)
1563. 
1564.     def test_foo_together_ordering(self):
1565.         """
1566.         index/unique_together also triggers on ordering changes.
1567.         """
1568.         changes = self.get_changes(
1569.             [self.author_empty, self.book_foo_together], [self.author_empty, self.book_foo_together_2]
1570.         )
1571.         # Right number/type of migrations?
1572.         self.assertNumberMigrations(changes, "otherapp", 1)
1573.         self.assertOperationTypes(changes, 'otherapp', 0, [
1574.             'AlterUniqueTogether',
1575.             'AlterIndexTogether',
1576.         ])
1577.         self.assertOperationAttributes(
1578.             changes, 'otherapp', 0, 0, name='book',
1579.             unique_together={('title', 'author')},
1580.         )
1581.         self.assertOperationAttributes(
1582.             changes, 'otherapp', 0, 1, name='book',
1583.             index_together={('title', 'author')},
1584.         )
1585. 
1586.     def test_add_field_and_foo_together(self):
1587.         """
1588.         Added fields will be created before using them in index/unique_together.
1589.         """
1590.         changes = self.get_changes([self.author_empty, self.book], [self.author_empty, self.book_foo_together_3])
1591.         # Right number/type of migrations?
1592.         self.assertNumberMigrations(changes, "otherapp", 1)
1593.         self.assertOperationTypes(changes, "otherapp", 0, ["AddField", "AlterUniqueTogether", "AlterIndexTogether"])
1594.         self.assertOperationAttributes(changes, "otherapp", 0, 1, name="book", unique_together={("title", "newfield")})
1595.         self.assertOperationAttributes(changes, "otherapp", 0, 2, name="book", index_together={("title", "newfield")})
1596. 
1597.     def test_create_model_and_unique_together(self):
1598.         author = ModelState("otherapp", "Author", [
1599.             ("id", models.AutoField(primary_key=True)),
1600.             ("name", models.CharField(max_length=200)),
1601.         ])
1602.         book_with_author = ModelState("otherapp", "Book", [
1603.             ("id", models.AutoField(primary_key=True)),
1604.             ("author", models.ForeignKey("otherapp.Author", models.CASCADE)),
1605.             ("title", models.CharField(max_length=200)),
1606.         ], {
1607.             "index_together": {("title", "author")},
1608.             "unique_together": {("title", "author")},
1609.         })
1610.         changes = self.get_changes([self.book_with_no_author], [author, book_with_author])
1611.         # Right number of migrations?
1612.         self.assertEqual(len(changes['otherapp']), 1)
1613.         # Right number of actions?
1614.         migration = changes['otherapp'][0]
1615.         self.assertEqual(len(migration.operations), 4)
1616.         # Right actions order?
1617.         self.assertOperationTypes(
1618.             changes, 'otherapp', 0,
1619.             ['CreateModel', 'AddField', 'AlterUniqueTogether', 'AlterIndexTogether']
1620.         )
1621. 
1622.     def test_remove_field_and_foo_together(self):
1623.         """
1624.         Removed fields will be removed after updating index/unique_together.
1625.         """
1626.         changes = self.get_changes(
1627.             [self.author_empty, self.book_foo_together_3], [self.author_empty, self.book_foo_together]
1628.         )
1629.         # Right number/type of migrations?
1630.         self.assertNumberMigrations(changes, "otherapp", 1)
1631.         self.assertOperationTypes(changes, 'otherapp', 0, [
1632.             'AlterUniqueTogether',
1633.             'AlterIndexTogether',
1634.             'RemoveField',
1635.         ])
1636.         self.assertOperationAttributes(
1637.             changes, 'otherapp', 0, 0, name='book',
1638.             unique_together={('author', 'title')},
1639.         )
1640.         self.assertOperationAttributes(
1641.             changes, 'otherapp', 0, 1, name='book',
1642.             index_together={('author', 'title')},
1643.         )
1644.         self.assertOperationAttributes(
1645.             changes, 'otherapp', 0, 2, model_name='book', name='newfield',
1646.         )
1647. 
1648.     def test_alter_field_and_foo_together(self):
1649.         """Fields are altered after deleting some index/unique_together."""
1650.         initial_author = ModelState('testapp', 'Author', [
1651.             ('id', models.AutoField(primary_key=True)),
1652.             ('name', models.CharField(max_length=200)),
1653.             ('age', models.IntegerField(db_index=True)),
1654.         ], {
1655.             'unique_together': {('name',)},
1656.         })
1657.         author_reversed_constraints = ModelState('testapp', 'Author', [
1658.             ('id', models.AutoField(primary_key=True)),
1659.             ('name', models.CharField(max_length=200, unique=True)),
1660.             ('age', models.IntegerField()),
1661.         ], {
1662.             'index_together': {('age',)},
1663.         })
1664.         changes = self.get_changes([initial_author], [author_reversed_constraints])
1665. 
1666.         self.assertNumberMigrations(changes, 'testapp', 1)
1667.         self.assertOperationTypes(changes, 'testapp', 0, [
1668.             'AlterUniqueTogether',
1669.             'AlterField',
1670.             'AlterField',
1671.             'AlterIndexTogether',
1672.         ])
1673.         self.assertOperationAttributes(
1674.             changes, 'testapp', 0, 0, name='author', unique_together=set(),
1675.         )
1676.         self.assertOperationAttributes(
1677.             changes, 'testapp', 0, 1, model_name='author', name='age',
1678.         )
1679.         self.assertOperationAttributes(
1680.             changes, 'testapp', 0, 2, model_name='author', name='name',
1681.         )
1682.         self.assertOperationAttributes(
1683.             changes, 'testapp', 0, 3, name='author', index_together={('age',)},
1684.         )
1685. 
1686.     def test_partly_alter_foo_together(self):
1687.         initial_author = ModelState('testapp', 'Author', [
1688.             ('id', models.AutoField(primary_key=True)),
1689.             ('name', models.CharField(max_length=200)),
1690.             ('age', models.IntegerField()),
1691.         ], {
1692.             'unique_together': {('name',), ('age',)},
1693.             'index_together': {('name',)},
1694.         })
1695.         author_reversed_constraints = ModelState('testapp', 'Author', [
1696.             ('id', models.AutoField(primary_key=True)),
1697.             ('name', models.CharField(max_length=200)),
1698.             ('age', models.IntegerField()),
1699.         ], {
1700.             'unique_together': {('age',)},
1701.             'index_together': {('name',), ('age',)},
1702.         })
1703.         changes = self.get_changes([initial_author], [author_reversed_constraints])
1704. 
1705.         self.assertNumberMigrations(changes, 'testapp', 1)
1706.         self.assertOperationTypes(changes, 'testapp', 0, [
1707.             'AlterUniqueTogether',
1708.             'AlterIndexTogether',
1709.         ])
1710.         self.assertOperationAttributes(
1711.             changes, 'testapp', 0, 0, name='author', unique_together={('age',)},
1712.         )
1713.         self.assertOperationAttributes(
1714.             changes, 'testapp', 0, 1, name='author',
1715.             index_together={('name',), ('age',)},
1716.         )
1717. 
1718.     def test_rename_field_and_foo_together(self):
1719.         """Fields are renamed before updating index/unique_together."""
1720.         changes = self.get_changes(
1721.             [self.author_empty, self.book_foo_together_3],
1722.             [self.author_empty, self.book_foo_together_4],
1723.             MigrationQuestioner({"ask_rename": True}),
1724.         )
1725.         # Right number/type of migrations?
1726.         self.assertNumberMigrations(changes, "otherapp", 1)
1727.         self.assertOperationTypes(changes, 'otherapp', 0, [
1728.             'RenameField',
1729.             'AlterUniqueTogether',
1730.             'AlterIndexTogether',
1731.         ])
1732.         self.assertOperationAttributes(
1733.             changes, 'otherapp', 0, 1, name='book',
1734.             unique_together={('title', 'newfield2')},
1735.         )
1736.         self.assertOperationAttributes(
1737.             changes, 'otherapp', 0, 2, name='book',
1738.             index_together={('title', 'newfield2')},
1739.         )
1740. 
1741.     def test_proxy(self):
1742.         """The autodetector correctly deals with proxy models."""
1743.         # First, we test adding a proxy model
1744.         changes = self.get_changes([self.author_empty], [self.author_empty, self.author_proxy])
1745.         # Right number/type of migrations?
1746.         self.assertNumberMigrations(changes, "testapp", 1)
1747.         self.assertOperationTypes(changes, "testapp", 0, ["CreateModel"])
1748.         self.assertOperationAttributes(
1749.             changes, "testapp", 0, 0, name="AuthorProxy", options={"proxy": True, "indexes": [], "constraints": []}
1750.         )
1751.         # Now, we test turning a proxy model into a non-proxy model
1752.         # It should delete the proxy then make the real one
1753.         changes = self.get_changes(
1754.             [self.author_empty, self.author_proxy], [self.author_empty, self.author_proxy_notproxy]
1755.         )
1756.         # Right number/type of migrations?
1757.         self.assertNumberMigrations(changes, "testapp", 1)
1758.         self.assertOperationTypes(changes, "testapp", 0, ["DeleteModel", "CreateModel"])
1759.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="AuthorProxy")
1760.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="AuthorProxy", options={})
1761. 
1762.     def test_proxy_non_model_parent(self):
1763.         class Mixin:
1764.             pass
1765. 
1766.         author_proxy_non_model_parent = ModelState(
1767.             'testapp',
1768.             'AuthorProxy',
1769.             [],
1770.             {'proxy': True},
1771.             (Mixin, 'testapp.author'),
1772.         )
1773.         changes = self.get_changes(
1774.             [self.author_empty],
1775.             [self.author_empty, author_proxy_non_model_parent],
1776.         )
1777.         self.assertNumberMigrations(changes, 'testapp', 1)
1778.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
1779.         self.assertOperationAttributes(
1780.             changes, 'testapp', 0, 0, name='AuthorProxy',
1781.             options={'proxy': True, 'indexes': [], 'constraints': []},
1782.             bases=(Mixin, 'testapp.author'),
1783.         )
1784. 
1785.     def test_proxy_custom_pk(self):
1786.         """
1787.         #23415 - The autodetector must correctly deal with custom FK on proxy
1788.         models.
1789.         """
1790.         # First, we test the default pk field name
1791.         changes = self.get_changes([], [self.author_empty, self.author_proxy_third, self.book_proxy_fk])
1792.         # The model the FK is pointing from and to.
1793.         self.assertEqual(
1794.             changes['otherapp'][0].operations[0].fields[2][1].remote_field.model,
1795.             'thirdapp.AuthorProxy',
1796.         )
1797.         # Now, we test the custom pk field name
1798.         changes = self.get_changes([], [self.author_custom_pk, self.author_proxy_third, self.book_proxy_fk])
1799.         # The model the FK is pointing from and to.
1800.         self.assertEqual(
1801.             changes['otherapp'][0].operations[0].fields[2][1].remote_field.model,
1802.             'thirdapp.AuthorProxy',
1803.         )
1804. 
1805.     def test_proxy_to_mti_with_fk_to_proxy(self):
1806.         # First, test the pk table and field name.
1807.         to_state = self.make_project_state(
1808.             [self.author_empty, self.author_proxy_third, self.book_proxy_fk],
1809.         )
1810.         changes = self.get_changes([], to_state)
1811.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1812.         self.assertEqual(
1813.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1814.             ('testapp', 'author'),
1815.         )
1816.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.AuthorProxy')
1817. 
1818.         # Change AuthorProxy to use MTI.
1819.         from_state = to_state.clone()
1820.         to_state = self.make_project_state(
1821.             [self.author_empty, self.author_proxy_third_notproxy, self.book_proxy_fk],
1822.         )
1823.         changes = self.get_changes(from_state, to_state)
1824.         # Right number/type of migrations for the AuthorProxy model?
1825.         self.assertNumberMigrations(changes, 'thirdapp', 1)
1826.         self.assertOperationTypes(changes, 'thirdapp', 0, ['DeleteModel', 'CreateModel'])
1827.         # Right number/type of migrations for the Book model with a FK to
1828.         # AuthorProxy?
1829.         self.assertNumberMigrations(changes, 'otherapp', 1)
1830.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
1831.         # otherapp should depend on thirdapp.
1832.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('thirdapp', 'auto_1')])
1833.         # Now, test the pk table and field name.
1834.         fk_field = changes['otherapp'][0].operations[0].field
1835.         self.assertEqual(
1836.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1837.             ('thirdapp', 'authorproxy'),
1838.         )
1839.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.AuthorProxy')
1840. 
1841.     def test_proxy_to_mti_with_fk_to_proxy_proxy(self):
1842.         # First, test the pk table and field name.
1843.         to_state = self.make_project_state([
1844.             self.author_empty,
1845.             self.author_proxy,
1846.             self.author_proxy_proxy,
1847.             self.book_proxy_proxy_fk,
1848.         ])
1849.         changes = self.get_changes([], to_state)
1850.         fk_field = changes['otherapp'][0].operations[0].fields[1][1]
1851.         self.assertEqual(
1852.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1853.             ('testapp', 'author'),
1854.         )
1855.         self.assertEqual(fk_field.remote_field.model, 'testapp.AAuthorProxyProxy')
1856. 
1857.         # Change AuthorProxy to use MTI. FK still points to AAuthorProxyProxy,
1858.         # a proxy of AuthorProxy.
1859.         from_state = to_state.clone()
1860.         to_state = self.make_project_state([
1861.             self.author_empty,
1862.             self.author_proxy_notproxy,
1863.             self.author_proxy_proxy,
1864.             self.book_proxy_proxy_fk,
1865.         ])
1866.         changes = self.get_changes(from_state, to_state)
1867.         # Right number/type of migrations for the AuthorProxy model?
1868.         self.assertNumberMigrations(changes, 'testapp', 1)
1869.         self.assertOperationTypes(changes, 'testapp', 0, ['DeleteModel', 'CreateModel'])
1870.         # Right number/type of migrations for the Book model with a FK to
1871.         # AAuthorProxyProxy?
1872.         self.assertNumberMigrations(changes, 'otherapp', 1)
1873.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
1874.         # otherapp should depend on testapp.
1875.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('testapp', 'auto_1')])
1876.         # Now, test the pk table and field name.
1877.         fk_field = changes['otherapp'][0].operations[0].field
1878.         self.assertEqual(
1879.             to_state.get_concrete_model_key(fk_field.remote_field.model),
1880.             ('testapp', 'authorproxy'),
1881.         )
1882.         self.assertEqual(fk_field.remote_field.model, 'testapp.AAuthorProxyProxy')
1883. 
1884.     def test_unmanaged_create(self):
1885.         """The autodetector correctly deals with managed models."""
1886.         # First, we test adding an unmanaged model
1887.         changes = self.get_changes([self.author_empty], [self.author_empty, self.author_unmanaged])
1888.         # Right number/type of migrations?
1889.         self.assertNumberMigrations(changes, 'testapp', 1)
1890.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1891.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="AuthorUnmanaged", options={"managed": False})
1892. 
1893.     def test_unmanaged_delete(self):
1894.         changes = self.get_changes([self.author_empty, self.author_unmanaged], [self.author_empty])
1895.         self.assertNumberMigrations(changes, 'testapp', 1)
1896.         self.assertOperationTypes(changes, 'testapp', 0, ['DeleteModel'])
1897. 
1898.     def test_unmanaged_to_managed(self):
1899.         # Now, we test turning an unmanaged model into a managed model
1900.         changes = self.get_changes(
1901.             [self.author_empty, self.author_unmanaged], [self.author_empty, self.author_unmanaged_managed]
1902.         )
1903.         # Right number/type of migrations?
1904.         self.assertNumberMigrations(changes, 'testapp', 1)
1905.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterModelOptions"])
1906.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="authorunmanaged", options={})
1907. 
1908.     def test_managed_to_unmanaged(self):
1909.         # Now, we turn managed to unmanaged.
1910.         changes = self.get_changes(
1911.             [self.author_empty, self.author_unmanaged_managed], [self.author_empty, self.author_unmanaged]
1912.         )
1913.         # Right number/type of migrations?
1914.         self.assertNumberMigrations(changes, 'testapp', 1)
1915.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
1916.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="authorunmanaged", options={"managed": False})
1917. 
1918.     def test_unmanaged_custom_pk(self):
1919.         """
1920.         #23415 - The autodetector must correctly deal with custom FK on
1921.         unmanaged models.
1922.         """
1923.         # First, we test the default pk field name
1924.         changes = self.get_changes([], [self.author_unmanaged_default_pk, self.book])
1925.         # The model the FK on the book model points to.
1926.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1927.         self.assertEqual(fk_field.remote_field.model, 'testapp.Author')
1928.         # Now, we test the custom pk field name
1929.         changes = self.get_changes([], [self.author_unmanaged_custom_pk, self.book])
1930.         # The model the FK on the book model points to.
1931.         fk_field = changes['otherapp'][0].operations[0].fields[2][1]
1932.         self.assertEqual(fk_field.remote_field.model, 'testapp.Author')
1933. 
1934.     @override_settings(AUTH_USER_MODEL="thirdapp.CustomUser")
1935.     def test_swappable(self):
1936.         with isolate_lru_cache(apps.get_swappable_settings_name):
1937.             changes = self.get_changes([self.custom_user], [self.custom_user, self.author_with_custom_user])
1938.         # Right number/type of migrations?
1939.         self.assertNumberMigrations(changes, 'testapp', 1)
1940.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
1941.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
1942.         self.assertMigrationDependencies(changes, 'testapp', 0, [("__setting__", "AUTH_USER_MODEL")])
1943. 
1944.     def test_swappable_lowercase(self):
1945.         model_state = ModelState('testapp', 'Document', [
1946.             ('id', models.AutoField(primary_key=True)),
1947.             ('owner', models.ForeignKey(
1948.                 settings.AUTH_USER_MODEL.lower(), models.CASCADE,
1949.             )),
1950.         ])
1951.         with isolate_lru_cache(apps.get_swappable_settings_name):
1952.             changes = self.get_changes([], [model_state])
1953.         self.assertNumberMigrations(changes, 'testapp', 1)
1954.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
1955.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Document')
1956.         self.assertMigrationDependencies(
1957.             changes, 'testapp', 0, [('__setting__', 'AUTH_USER_MODEL')],
1958.         )
1959. 
1960.     def test_swappable_changed(self):
1961.         with isolate_lru_cache(apps.get_swappable_settings_name):
1962.             before = self.make_project_state([self.custom_user, self.author_with_user])
1963.             with override_settings(AUTH_USER_MODEL="thirdapp.CustomUser"):
1964.                 after = self.make_project_state([self.custom_user, self.author_with_custom_user])
1965.             autodetector = MigrationAutodetector(before, after)
1966.             changes = autodetector._detect_changes()
1967.         # Right number/type of migrations?
1968.         self.assertNumberMigrations(changes, 'testapp', 1)
1969.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
1970.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name="author", name='user')
1971.         fk_field = changes['testapp'][0].operations[0].field
1972.         self.assertEqual(fk_field.remote_field.model, 'thirdapp.CustomUser')
1973. 
1974.     def test_add_field_with_default(self):
1975.         """#22030 - Adding a field with a default should work."""
1976.         changes = self.get_changes([self.author_empty], [self.author_name_default])
1977.         # Right number/type of migrations?
1978.         self.assertNumberMigrations(changes, 'testapp', 1)
1979.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
1980.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="name")
1981. 
1982.     def test_custom_deconstructible(self):
1983.         """
1984.         Two instances which deconstruct to the same value aren't considered a
1985.         change.
1986.         """
1987.         changes = self.get_changes([self.author_name_deconstructible_1], [self.author_name_deconstructible_2])
1988.         # Right number of migrations?
1989.         self.assertEqual(len(changes), 0)
1990. 
1991.     def test_deconstruct_field_kwarg(self):
1992.         """Field instances are handled correctly by nested deconstruction."""
1993.         changes = self.get_changes([self.author_name_deconstructible_3], [self.author_name_deconstructible_4])
1994.         self.assertEqual(changes, {})
1995. 
1996.     def test_deconstructible_list(self):
1997.         """Nested deconstruction descends into lists."""
1998.         # When lists contain items that deconstruct to identical values, those lists
1999.         # should be considered equal for the purpose of detecting state changes
2000.         # (even if the original items are unequal).
2001.         changes = self.get_changes(
2002.             [self.author_name_deconstructible_list_1], [self.author_name_deconstructible_list_2]
2003.         )
2004.         self.assertEqual(changes, {})
2005.         # Legitimate differences within the deconstructed lists should be reported
2006.         # as a change
2007.         changes = self.get_changes(
2008.             [self.author_name_deconstructible_list_1], [self.author_name_deconstructible_list_3]
2009.         )
2010.         self.assertEqual(len(changes), 1)
2011. 
2012.     def test_deconstructible_tuple(self):
2013.         """Nested deconstruction descends into tuples."""
2014.         # When tuples contain items that deconstruct to identical values, those tuples
2015.         # should be considered equal for the purpose of detecting state changes
2016.         # (even if the original items are unequal).
2017.         changes = self.get_changes(
2018.             [self.author_name_deconstructible_tuple_1], [self.author_name_deconstructible_tuple_2]
2019.         )
2020.         self.assertEqual(changes, {})
2021.         # Legitimate differences within the deconstructed tuples should be reported
2022.         # as a change
2023.         changes = self.get_changes(
2024.             [self.author_name_deconstructible_tuple_1], [self.author_name_deconstructible_tuple_3]
2025.         )
2026.         self.assertEqual(len(changes), 1)
2027. 
2028.     def test_deconstructible_dict(self):
2029.         """Nested deconstruction descends into dict values."""
2030.         # When dicts contain items whose values deconstruct to identical values,
2031.         # those dicts should be considered equal for the purpose of detecting
2032.         # state changes (even if the original values are unequal).
2033.         changes = self.get_changes(
2034.             [self.author_name_deconstructible_dict_1], [self.author_name_deconstructible_dict_2]
2035.         )
2036.         self.assertEqual(changes, {})
2037.         # Legitimate differences within the deconstructed dicts should be reported
2038.         # as a change
2039.         changes = self.get_changes(
2040.             [self.author_name_deconstructible_dict_1], [self.author_name_deconstructible_dict_3]
2041.         )
2042.         self.assertEqual(len(changes), 1)
2043. 
2044.     def test_nested_deconstructible_objects(self):
2045.         """
2046.         Nested deconstruction is applied recursively to the args/kwargs of
2047.         deconstructed objects.
2048.         """
2049.         # If the items within a deconstructed object's args/kwargs have the same
2050.         # deconstructed values - whether or not the items themselves are different
2051.         # instances - then the object as a whole is regarded as unchanged.
2052.         changes = self.get_changes(
2053.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_2]
2054.         )
2055.         self.assertEqual(changes, {})
2056.         # Differences that exist solely within the args list of a deconstructed object
2057.         # should be reported as changes
2058.         changes = self.get_changes(
2059.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_changed_arg]
2060.         )
2061.         self.assertEqual(len(changes), 1)
2062.         # Additional args should also be reported as a change
2063.         changes = self.get_changes(
2064.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_extra_arg]
2065.         )
2066.         self.assertEqual(len(changes), 1)
2067.         # Differences that exist solely within the kwargs dict of a deconstructed object
2068.         # should be reported as changes
2069.         changes = self.get_changes(
2070.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_changed_kwarg]
2071.         )
2072.         self.assertEqual(len(changes), 1)
2073.         # Additional kwargs should also be reported as a change
2074.         changes = self.get_changes(
2075.             [self.author_name_nested_deconstructible_1], [self.author_name_nested_deconstructible_extra_kwarg]
2076.         )
2077.         self.assertEqual(len(changes), 1)
2078. 
2079.     def test_deconstruct_type(self):
2080.         """
2081.         #22951 -- Uninstantiated classes with deconstruct are correctly returned
2082.         by deep_deconstruct during serialization.
2083.         """
2084.         author = ModelState(
2085.             "testapp",
2086.             "Author",
2087.             [
2088.                 ("id", models.AutoField(primary_key=True)),
2089.                 ("name", models.CharField(
2090.                     max_length=200,
2091.                     # IntegerField intentionally not instantiated.
2092.                     default=models.IntegerField,
2093.                 ))
2094.             ],
2095.         )
2096.         changes = self.get_changes([], [author])
2097.         # Right number/type of migrations?
2098.         self.assertNumberMigrations(changes, 'testapp', 1)
2099.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
2100. 
2101.     def test_replace_string_with_foreignkey(self):
2102.         """
2103.         #22300 - Adding an FK in the same "spot" as a deleted CharField should
2104.         work.
2105.         """
2106.         changes = self.get_changes([self.author_with_publisher_string], [self.author_with_publisher, self.publisher])
2107.         # Right number/type of migrations?
2108.         self.assertNumberMigrations(changes, 'testapp', 1)
2109.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "RemoveField", "AddField"])
2110.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Publisher")
2111.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publisher_name")
2112.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="publisher")
2113. 
2114.     def test_foreign_key_removed_before_target_model(self):
2115.         """
2116.         Removing an FK and the model it targets in the same change must remove
2117.         the FK field before the model to maintain consistency.
2118.         """
2119.         changes = self.get_changes(
2120.             [self.author_with_publisher, self.publisher], [self.author_name]
2121.         )  # removes both the model and FK
2122.         # Right number/type of migrations?
2123.         self.assertNumberMigrations(changes, 'testapp', 1)
2124.         self.assertOperationTypes(changes, 'testapp', 0, ["RemoveField", "DeleteModel"])
2125.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publisher")
2126.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Publisher")
2127. 
2128.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
2129.                 side_effect=AssertionError("Should not have prompted for not null addition"))
2130.     def test_add_many_to_many(self, mocked_ask_method):
2131.         """#22435 - Adding a ManyToManyField should not prompt for a default."""
2132.         changes = self.get_changes([self.author_empty, self.publisher], [self.author_with_m2m, self.publisher])
2133.         # Right number/type of migrations?
2134.         self.assertNumberMigrations(changes, 'testapp', 1)
2135.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
2136.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers")
2137. 
2138.     def test_alter_many_to_many(self):
2139.         changes = self.get_changes(
2140.             [self.author_with_m2m, self.publisher], [self.author_with_m2m_blank, self.publisher]
2141.         )
2142.         # Right number/type of migrations?
2143.         self.assertNumberMigrations(changes, 'testapp', 1)
2144.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterField"])
2145.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers")
2146. 
2147.     def test_create_with_through_model(self):
2148.         """
2149.         Adding a m2m with a through model and the models that use it should be
2150.         ordered correctly.
2151.         """
2152.         changes = self.get_changes([], [self.author_with_m2m_through, self.publisher, self.contract])
2153.         # Right number/type of migrations?
2154.         self.assertNumberMigrations(changes, "testapp", 1)
2155.         self.assertOperationTypes(changes, "testapp", 0, [
2156.             'CreateModel', 'CreateModel', 'CreateModel', 'AddField',
2157.         ])
2158.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Author')
2159.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name='Publisher')
2160.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name='Contract')
2161.         self.assertOperationAttributes(changes, 'testapp', 0, 3, model_name='author', name='publishers')
2162. 
2163.     def test_many_to_many_removed_before_through_model(self):
2164.         """
2165.         Removing a ManyToManyField and the "through" model in the same change
2166.         must remove the field before the model to maintain consistency.
2167.         """
2168.         changes = self.get_changes(
2169.             [self.book_with_multiple_authors_through_attribution, self.author_name, self.attribution],
2170.             [self.book_with_no_author, self.author_name],
2171.         )
2172.         # Remove both the through model and ManyToMany
2173.         # Right number/type of migrations?
2174.         self.assertNumberMigrations(changes, "otherapp", 1)
2175.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveField', 'DeleteModel'])
2176.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='authors', model_name='book')
2177.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, name='Attribution')
2178. 
2179.     def test_many_to_many_removed_before_through_model_2(self):
2180.         """
2181.         Removing a model that contains a ManyToManyField and the "through" model
2182.         in the same change must remove the field before the model to maintain
2183.         consistency.
2184.         """
2185.         changes = self.get_changes(
2186.             [self.book_with_multiple_authors_through_attribution, self.author_name, self.attribution],
2187.             [self.author_name],
2188.         )
2189.         # Remove both the through model and ManyToMany
2190.         # Right number/type of migrations?
2191.         self.assertNumberMigrations(changes, "otherapp", 1)
2192.         self.assertOperationTypes(changes, 'otherapp', 0, ['RemoveField', 'DeleteModel', 'DeleteModel'])
2193.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name='authors', model_name='book')
2194.         self.assertOperationAttributes(changes, 'otherapp', 0, 1, name='Attribution')
2195.         self.assertOperationAttributes(changes, 'otherapp', 0, 2, name='Book')
2196. 
2197.     def test_m2m_w_through_multistep_remove(self):
2198.         """
2199.         A model with a m2m field that specifies a "through" model cannot be
2200.         removed in the same migration as that through model as the schema will
2201.         pass through an inconsistent state. The autodetector should produce two
2202.         migrations to avoid this issue.
2203.         """
2204.         changes = self.get_changes([self.author_with_m2m_through, self.publisher, self.contract], [self.publisher])
2205.         # Right number/type of migrations?
2206.         self.assertNumberMigrations(changes, "testapp", 1)
2207.         self.assertOperationTypes(changes, "testapp", 0, [
2208.             "RemoveField", "RemoveField", "DeleteModel", "DeleteModel"
2209.         ])
2210.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", model_name='contract')
2211.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="publisher", model_name='contract')
2212.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="Author")
2213.         self.assertOperationAttributes(changes, "testapp", 0, 3, name="Contract")
2214. 
2215.     def test_concrete_field_changed_to_many_to_many(self):
2216.         """
2217.         #23938 - Changing a concrete field into a ManyToManyField
2218.         first removes the concrete field and then adds the m2m field.
2219.         """
2220.         changes = self.get_changes([self.author_with_former_m2m], [self.author_with_m2m, self.publisher])
2221.         # Right number/type of migrations?
2222.         self.assertNumberMigrations(changes, "testapp", 1)
2223.         self.assertOperationTypes(changes, "testapp", 0, ["CreateModel", "RemoveField", "AddField"])
2224.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Publisher')
2225.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publishers", model_name='author')
2226.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="publishers", model_name='author')
2227. 
2228.     def test_many_to_many_changed_to_concrete_field(self):
2229.         """
2230.         #23938 - Changing a ManyToManyField into a concrete field
2231.         first removes the m2m field and then adds the concrete field.
2232.         """
2233.         changes = self.get_changes([self.author_with_m2m, self.publisher], [self.author_with_former_m2m])
2234.         # Right number/type of migrations?
2235.         self.assertNumberMigrations(changes, "testapp", 1)
2236.         self.assertOperationTypes(changes, "testapp", 0, ["RemoveField", "AddField", "DeleteModel"])
2237.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="publishers", model_name='author')
2238.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="publishers", model_name='author')
2239.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name='Publisher')
2240.         self.assertOperationFieldAttributes(changes, 'testapp', 0, 1, max_length=100)
2241. 
2242.     def test_non_circular_foreignkey_dependency_removal(self):
2243.         """
2244.         If two models with a ForeignKey from one to the other are removed at the
2245.         same time, the autodetector should remove them in the correct order.
2246.         """
2247.         changes = self.get_changes([self.author_with_publisher, self.publisher_with_author], [])
2248.         # Right number/type of migrations?
2249.         self.assertNumberMigrations(changes, "testapp", 1)
2250.         self.assertOperationTypes(changes, "testapp", 0, ["RemoveField", "DeleteModel", "DeleteModel"])
2251.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", model_name='publisher')
2252.         self.assertOperationAttributes(changes, "testapp", 0, 1, name="Author")
2253.         self.assertOperationAttributes(changes, "testapp", 0, 2, name="Publisher")
2254. 
2255.     def test_alter_model_options(self):
2256.         """Changing a model's options should make a change."""
2257.         changes = self.get_changes([self.author_empty], [self.author_with_options])
2258.         # Right number/type of migrations?
2259.         self.assertNumberMigrations(changes, "testapp", 1)
2260.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2261.         self.assertOperationAttributes(changes, "testapp", 0, 0, options={
2262.             "permissions": [('can_hire', 'Can hire')],
2263.             "verbose_name": "Authi",
2264.         })
2265. 
2266.         # Changing them back to empty should also make a change
2267.         changes = self.get_changes([self.author_with_options], [self.author_empty])
2268.         # Right number/type of migrations?
2269.         self.assertNumberMigrations(changes, "testapp", 1)
2270.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2271.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="author", options={})
2272. 
2273.     def test_alter_model_options_proxy(self):
2274.         """Changing a proxy model's options should also make a change."""
2275.         changes = self.get_changes(
2276.             [self.author_proxy, self.author_empty], [self.author_proxy_options, self.author_empty]
2277.         )
2278.         # Right number/type of migrations?
2279.         self.assertNumberMigrations(changes, "testapp", 1)
2280.         self.assertOperationTypes(changes, "testapp", 0, ["AlterModelOptions"])
2281.         self.assertOperationAttributes(changes, "testapp", 0, 0, name="authorproxy", options={
2282.             "verbose_name": "Super Author"
2283.         })
2284. 
2285.     def test_set_alter_order_with_respect_to(self):
2286.         """Setting order_with_respect_to adds a field."""
2287.         changes = self.get_changes([self.book, self.author_with_book], [self.book, self.author_with_book_order_wrt])
2288.         # Right number/type of migrations?
2289.         self.assertNumberMigrations(changes, 'testapp', 1)
2290.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterOrderWithRespectTo"])
2291.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="author", order_with_respect_to="book")
2292. 
2293.     def test_add_alter_order_with_respect_to(self):
2294.         """
2295.         Setting order_with_respect_to when adding the FK too does
2296.         things in the right order.
2297.         """
2298.         changes = self.get_changes([self.author_name], [self.book, self.author_with_book_order_wrt])
2299.         # Right number/type of migrations?
2300.         self.assertNumberMigrations(changes, 'testapp', 1)
2301.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AlterOrderWithRespectTo"])
2302.         self.assertOperationAttributes(changes, 'testapp', 0, 0, model_name="author", name="book")
2303.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="author", order_with_respect_to="book")
2304. 
2305.     def test_remove_alter_order_with_respect_to(self):
2306.         """
2307.         Removing order_with_respect_to when removing the FK too does
2308.         things in the right order.
2309.         """
2310.         changes = self.get_changes([self.book, self.author_with_book_order_wrt], [self.author_name])
2311.         # Right number/type of migrations?
2312.         self.assertNumberMigrations(changes, 'testapp', 1)
2313.         self.assertOperationTypes(changes, 'testapp', 0, ["AlterOrderWithRespectTo", "RemoveField"])
2314.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="author", order_with_respect_to=None)
2315.         self.assertOperationAttributes(changes, 'testapp', 0, 1, model_name="author", name="book")
2316. 
2317.     def test_add_model_order_with_respect_to(self):
2318.         """
2319.         Setting order_with_respect_to when adding the whole model
2320.         does things in the right order.
2321.         """
2322.         changes = self.get_changes([], [self.book, self.author_with_book_order_wrt])
2323.         # Right number/type of migrations?
2324.         self.assertNumberMigrations(changes, 'testapp', 1)
2325.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel"])
2326.         self.assertOperationAttributes(
2327.             changes, 'testapp', 0, 0, name="Author", options={'order_with_respect_to': 'book'}
2328.         )
2329.         self.assertNotIn("_order", [name for name, field in changes['testapp'][0].operations[0].fields])
2330. 
2331.     def test_add_model_order_with_respect_to_index_foo_together(self):
2332.         changes = self.get_changes([], [
2333.             self.book,
2334.             ModelState('testapp', 'Author', [
2335.                 ('id', models.AutoField(primary_key=True)),
2336.                 ('name', models.CharField(max_length=200)),
2337.                 ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2338.             ], options={
2339.                 'order_with_respect_to': 'book',
2340.                 'index_together': {('name', '_order')},
2341.                 'unique_together': {('id', '_order')},
2342.             }),
2343.         ])
2344.         self.assertNumberMigrations(changes, 'testapp', 1)
2345.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
2346.         self.assertOperationAttributes(
2347.             changes,
2348.             'testapp',
2349.             0,
2350.             0,
2351.             name='Author',
2352.             options={
2353.                 'order_with_respect_to': 'book',
2354.                 'index_together': {('name', '_order')},
2355.                 'unique_together': {('id', '_order')},
2356.             },
2357.         )
2358. 
2359.     def test_add_model_order_with_respect_to_index_constraint(self):
2360.         tests = [
2361.             (
2362.                 'AddIndex',
2363.                 {'indexes': [
2364.                     models.Index(fields=['_order'], name='book_order_idx'),
2365.                 ]},
2366.             ),
2367.             (
2368.                 'AddConstraint',
2369.                 {'constraints': [
2370.                     models.CheckConstraint(
2371.                         check=models.Q(_order__gt=1),
2372.                         name='book_order_gt_1',
2373.                     ),
2374.                 ]},
2375.             ),
2376.         ]
2377.         for operation, extra_option in tests:
2378.             with self.subTest(operation=operation):
2379.                 after = ModelState('testapp', 'Author', [
2380.                     ('id', models.AutoField(primary_key=True)),
2381.                     ('name', models.CharField(max_length=200)),
2382.                     ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2383.                 ], options={
2384.                     'order_with_respect_to': 'book',
2385.                     **extra_option,
2386.                 })
2387.                 changes = self.get_changes([], [self.book, after])
2388.                 self.assertNumberMigrations(changes, 'testapp', 1)
2389.                 self.assertOperationTypes(changes, 'testapp', 0, [
2390.                     'CreateModel', operation,
2391.                 ])
2392.                 self.assertOperationAttributes(
2393.                     changes,
2394.                     'testapp',
2395.                     0,
2396.                     0,
2397.                     name='Author',
2398.                     options={'order_with_respect_to': 'book'},
2399.                 )
2400. 
2401.     def test_set_alter_order_with_respect_to_index_constraint_foo_together(self):
2402.         tests = [
2403.             (
2404.                 'AddIndex',
2405.                 {'indexes': [
2406.                     models.Index(fields=['_order'], name='book_order_idx'),
2407.                 ]},
2408.             ),
2409.             (
2410.                 'AddConstraint',
2411.                 {'constraints': [
2412.                     models.CheckConstraint(
2413.                         check=models.Q(_order__gt=1),
2414.                         name='book_order_gt_1',
2415.                     ),
2416.                 ]},
2417.             ),
2418.             ('AlterIndexTogether', {'index_together': {('name', '_order')}}),
2419.             ('AlterUniqueTogether', {'unique_together': {('id', '_order')}}),
2420.         ]
2421.         for operation, extra_option in tests:
2422.             with self.subTest(operation=operation):
2423.                 after = ModelState('testapp', 'Author', [
2424.                     ('id', models.AutoField(primary_key=True)),
2425.                     ('name', models.CharField(max_length=200)),
2426.                     ('book', models.ForeignKey('otherapp.Book', models.CASCADE)),
2427.                 ], options={
2428.                     'order_with_respect_to': 'book',
2429.                     **extra_option,
2430.                 })
2431.                 changes = self.get_changes(
2432.                     [self.book, self.author_with_book],
2433.                     [self.book, after],
2434.                 )
2435.                 self.assertNumberMigrations(changes, 'testapp', 1)
2436.                 self.assertOperationTypes(changes, 'testapp', 0, [
2437.                     'AlterOrderWithRespectTo', operation,
2438.                 ])
2439. 
2440.     def test_alter_model_managers(self):
2441.         """
2442.         Changing the model managers adds a new operation.
2443.         """
2444.         changes = self.get_changes([self.other_pony], [self.other_pony_food])
2445.         # Right number/type of migrations?
2446.         self.assertNumberMigrations(changes, 'otherapp', 1)
2447.         self.assertOperationTypes(changes, 'otherapp', 0, ["AlterModelManagers"])
2448.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="pony")
2449.         self.assertEqual([name for name, mgr in changes['otherapp'][0].operations[0].managers],
2450.                          ['food_qs', 'food_mgr', 'food_mgr_kwargs'])
2451.         self.assertEqual(changes['otherapp'][0].operations[0].managers[1][1].args, ('a', 'b', 1, 2))
2452.         self.assertEqual(changes['otherapp'][0].operations[0].managers[2][1].args, ('x', 'y', 3, 4))
2453. 
2454.     def test_swappable_first_inheritance(self):
2455.         """Swappable models get their CreateModel first."""
2456.         changes = self.get_changes([], [self.custom_user, self.aardvark])
2457.         # Right number/type of migrations?
2458.         self.assertNumberMigrations(changes, 'thirdapp', 1)
2459.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel", "CreateModel"])
2460.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="CustomUser")
2461.         self.assertOperationAttributes(changes, 'thirdapp', 0, 1, name="Aardvark")
2462. 
2463.     def test_default_related_name_option(self):
2464.         model_state = ModelState('app', 'model', [
2465.             ('id', models.AutoField(primary_key=True)),
2466.         ], options={'default_related_name': 'related_name'})
2467.         changes = self.get_changes([], [model_state])
2468.         self.assertNumberMigrations(changes, 'app', 1)
2469.         self.assertOperationTypes(changes, 'app', 0, ['CreateModel'])
2470.         self.assertOperationAttributes(
2471.             changes, 'app', 0, 0, name='model',
2472.             options={'default_related_name': 'related_name'},
2473.         )
2474.         altered_model_state = ModelState('app', 'Model', [
2475.             ('id', models.AutoField(primary_key=True)),
2476.         ])
2477.         changes = self.get_changes([model_state], [altered_model_state])
2478.         self.assertNumberMigrations(changes, 'app', 1)
2479.         self.assertOperationTypes(changes, 'app', 0, ['AlterModelOptions'])
2480.         self.assertOperationAttributes(changes, 'app', 0, 0, name='model', options={})
2481. 
2482.     @override_settings(AUTH_USER_MODEL="thirdapp.CustomUser")
2483.     def test_swappable_first_setting(self):
2484.         """Swappable models get their CreateModel first."""
2485.         with isolate_lru_cache(apps.get_swappable_settings_name):
2486.             changes = self.get_changes([], [self.custom_user_no_inherit, self.aardvark])
2487.         # Right number/type of migrations?
2488.         self.assertNumberMigrations(changes, 'thirdapp', 1)
2489.         self.assertOperationTypes(changes, 'thirdapp', 0, ["CreateModel", "CreateModel"])
2490.         self.assertOperationAttributes(changes, 'thirdapp', 0, 0, name="CustomUser")
2491.         self.assertOperationAttributes(changes, 'thirdapp', 0, 1, name="Aardvark")
2492. 
2493.     def test_bases_first(self):
2494.         """Bases of other models come first."""
2495.         changes = self.get_changes([], [self.aardvark_based_on_author, self.author_name])
2496.         # Right number/type of migrations?
2497.         self.assertNumberMigrations(changes, 'testapp', 1)
2498.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
2499.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2500.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Aardvark")
2501. 
2502.     def test_bases_first_mixed_case_app_label(self):
2503.         app_label = 'MiXedCaseApp'
2504.         changes = self.get_changes([], [
2505.             ModelState(app_label, 'owner', [
2506.                 ('id', models.AutoField(primary_key=True)),
2507.             ]),
2508.             ModelState(app_label, 'place', [
2509.                 ('id', models.AutoField(primary_key=True)),
2510.                 ('owner', models.ForeignKey('MiXedCaseApp.owner', models.CASCADE)),
2511.             ]),
2512.             ModelState(app_label, 'restaurant', [], bases=('MiXedCaseApp.place',)),
2513.         ])
2514.         self.assertNumberMigrations(changes, app_label, 1)
2515.         self.assertOperationTypes(changes, app_label, 0, [
2516.             'CreateModel', 'CreateModel', 'CreateModel',
2517.         ])
2518.         self.assertOperationAttributes(changes, app_label, 0, 0, name='owner')
2519.         self.assertOperationAttributes(changes, app_label, 0, 1, name='place')
2520.         self.assertOperationAttributes(changes, app_label, 0, 2, name='restaurant')
2521. 
2522.     def test_multiple_bases(self):
2523.         """#23956 - Inheriting models doesn't move *_ptr fields into AddField operations."""
2524.         A = ModelState("app", "A", [("a_id", models.AutoField(primary_key=True))])
2525.         B = ModelState("app", "B", [("b_id", models.AutoField(primary_key=True))])
2526.         C = ModelState("app", "C", [], bases=("app.A", "app.B"))
2527.         D = ModelState("app", "D", [], bases=("app.A", "app.B"))
2528.         E = ModelState("app", "E", [], bases=("app.A", "app.B"))
2529.         changes = self.get_changes([], [A, B, C, D, E])
2530.         # Right number/type of migrations?
2531.         self.assertNumberMigrations(changes, "app", 1)
2532.         self.assertOperationTypes(changes, "app", 0, [
2533.             "CreateModel", "CreateModel", "CreateModel", "CreateModel", "CreateModel"
2534.         ])
2535.         self.assertOperationAttributes(changes, "app", 0, 0, name="A")
2536.         self.assertOperationAttributes(changes, "app", 0, 1, name="B")
2537.         self.assertOperationAttributes(changes, "app", 0, 2, name="C")
2538.         self.assertOperationAttributes(changes, "app", 0, 3, name="D")
2539.         self.assertOperationAttributes(changes, "app", 0, 4, name="E")
2540. 
2541.     def test_proxy_bases_first(self):
2542.         """Bases of proxies come first."""
2543.         changes = self.get_changes([], [self.author_empty, self.author_proxy, self.author_proxy_proxy])
2544.         # Right number/type of migrations?
2545.         self.assertNumberMigrations(changes, 'testapp', 1)
2546.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel", "CreateModel"])
2547.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2548.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="AuthorProxy")
2549.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="AAuthorProxyProxy")
2550. 
2551.     def test_pk_fk_included(self):
2552.         """
2553.         A relation used as the primary key is kept as part of CreateModel.
2554.         """
2555.         changes = self.get_changes([], [self.aardvark_pk_fk_author, self.author_name])
2556.         # Right number/type of migrations?
2557.         self.assertNumberMigrations(changes, 'testapp', 1)
2558.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "CreateModel"])
2559.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Author")
2560.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="Aardvark")
2561. 
2562.     def test_first_dependency(self):
2563.         """
2564.         A dependency to an app with no migrations uses __first__.
2565.         """
2566.         # Load graph
2567.         loader = MigrationLoader(connection)
2568.         before = self.make_project_state([])
2569.         after = self.make_project_state([self.book_migrations_fk])
2570.         after.real_apps = {'migrations'}
2571.         autodetector = MigrationAutodetector(before, after)
2572.         changes = autodetector._detect_changes(graph=loader.graph)
2573.         # Right number/type of migrations?
2574.         self.assertNumberMigrations(changes, 'otherapp', 1)
2575.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
2576.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
2577.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("migrations", "__first__")])
2578. 
2579.     @override_settings(MIGRATION_MODULES={"migrations": "migrations.test_migrations"})
2580.     def test_last_dependency(self):
2581.         """
2582.         A dependency to an app with existing migrations uses the
2583.         last migration of that app.
2584.         """
2585.         # Load graph
2586.         loader = MigrationLoader(connection)
2587.         before = self.make_project_state([])
2588.         after = self.make_project_state([self.book_migrations_fk])
2589.         after.real_apps = {'migrations'}
2590.         autodetector = MigrationAutodetector(before, after)
2591.         changes = autodetector._detect_changes(graph=loader.graph)
2592.         # Right number/type of migrations?
2593.         self.assertNumberMigrations(changes, 'otherapp', 1)
2594.         self.assertOperationTypes(changes, 'otherapp', 0, ["CreateModel"])
2595.         self.assertOperationAttributes(changes, 'otherapp', 0, 0, name="Book")
2596.         self.assertMigrationDependencies(changes, 'otherapp', 0, [("migrations", "0002_second")])
2597. 
2598.     def test_alter_fk_before_model_deletion(self):
2599.         """
2600.         ForeignKeys are altered _before_ the model they used to
2601.         refer to are deleted.
2602.         """
2603.         changes = self.get_changes(
2604.             [self.author_name, self.publisher_with_author],
2605.             [self.aardvark_testapp, self.publisher_with_aardvark_author]
2606.         )
2607.         # Right number/type of migrations?
2608.         self.assertNumberMigrations(changes, 'testapp', 1)
2609.         self.assertOperationTypes(changes, 'testapp', 0, ["CreateModel", "AlterField", "DeleteModel"])
2610.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="Aardvark")
2611.         self.assertOperationAttributes(changes, 'testapp', 0, 1, name="author")
2612.         self.assertOperationAttributes(changes, 'testapp', 0, 2, name="Author")
2613. 
2614.     def test_fk_dependency_other_app(self):
2615.         """
2616.         #23100 - ForeignKeys correctly depend on other apps' models.
2617.         """
2618.         changes = self.get_changes([self.author_name, self.book], [self.author_with_book, self.book])
2619.         # Right number/type of migrations?
2620.         self.assertNumberMigrations(changes, 'testapp', 1)
2621.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField"])
2622.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name="book")
2623.         self.assertMigrationDependencies(changes, 'testapp', 0, [("otherapp", "__first__")])
2624. 
2625.     def test_alter_field_to_fk_dependency_other_app(self):
2626.         changes = self.get_changes(
2627.             [self.author_empty, self.book_with_no_author_fk],
2628.             [self.author_empty, self.book],
2629.         )
2630.         self.assertNumberMigrations(changes, 'otherapp', 1)
2631.         self.assertOperationTypes(changes, 'otherapp', 0, ['AlterField'])
2632.         self.assertMigrationDependencies(changes, 'otherapp', 0, [('testapp', '__first__')])
2633. 
2634.     def test_circular_dependency_mixed_addcreate(self):
2635.         """
2636.         #23315 - The dependency resolver knows to put all CreateModel
2637.         before AddField and not become unsolvable.
2638.         """
2639.         address = ModelState("a", "Address", [
2640.             ("id", models.AutoField(primary_key=True)),
2641.             ("country", models.ForeignKey("b.DeliveryCountry", models.CASCADE)),
2642.         ])
2643.         person = ModelState("a", "Person", [
2644.             ("id", models.AutoField(primary_key=True)),
2645.         ])
2646.         apackage = ModelState("b", "APackage", [
2647.             ("id", models.AutoField(primary_key=True)),
2648.             ("person", models.ForeignKey("a.Person", models.CASCADE)),
2649.         ])
2650.         country = ModelState("b", "DeliveryCountry", [
2651.             ("id", models.AutoField(primary_key=True)),
2652.         ])
2653.         changes = self.get_changes([], [address, person, apackage, country])
2654.         # Right number/type of migrations?
2655.         self.assertNumberMigrations(changes, 'a', 2)
2656.         self.assertNumberMigrations(changes, 'b', 1)
2657.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel", "CreateModel"])
2658.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2659.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel", "CreateModel"])
2660. 
2661.     @override_settings(AUTH_USER_MODEL="a.Tenant")
2662.     def test_circular_dependency_swappable(self):
2663.         """
2664.         #23322 - The dependency resolver knows to explicitly resolve
2665.         swappable models.
2666.         """
2667.         with isolate_lru_cache(apps.get_swappable_settings_name):
2668.             tenant = ModelState("a", "Tenant", [
2669.                 ("id", models.AutoField(primary_key=True)),
2670.                 ("primary_address", models.ForeignKey("b.Address", models.CASCADE))],
2671.                 bases=(AbstractBaseUser,)
2672.             )
2673.             address = ModelState("b", "Address", [
2674.                 ("id", models.AutoField(primary_key=True)),
2675.                 ("tenant", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE)),
2676.             ])
2677.             changes = self.get_changes([], [address, tenant])
2678. 
2679.         # Right number/type of migrations?
2680.         self.assertNumberMigrations(changes, 'a', 2)
2681.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2682.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2683.         self.assertMigrationDependencies(changes, 'a', 0, [])
2684.         self.assertMigrationDependencies(changes, 'a', 1, [('a', 'auto_1'), ('b', 'auto_1')])
2685.         # Right number/type of migrations?
2686.         self.assertNumberMigrations(changes, 'b', 1)
2687.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel"])
2688.         self.assertMigrationDependencies(changes, 'b', 0, [('__setting__', 'AUTH_USER_MODEL')])
2689. 
2690.     @override_settings(AUTH_USER_MODEL="b.Tenant")
2691.     def test_circular_dependency_swappable2(self):
2692.         """
2693.         #23322 - The dependency resolver knows to explicitly resolve
2694.         swappable models but with the swappable not being the first migrated
2695.         model.
2696.         """
2697.         with isolate_lru_cache(apps.get_swappable_settings_name):
2698.             address = ModelState("a", "Address", [
2699.                 ("id", models.AutoField(primary_key=True)),
2700.                 ("tenant", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE)),
2701.             ])
2702.             tenant = ModelState("b", "Tenant", [
2703.                 ("id", models.AutoField(primary_key=True)),
2704.                 ("primary_address", models.ForeignKey("a.Address", models.CASCADE))],
2705.                 bases=(AbstractBaseUser,)
2706.             )
2707.             changes = self.get_changes([], [address, tenant])
2708.         # Right number/type of migrations?
2709.         self.assertNumberMigrations(changes, 'a', 2)
2710.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2711.         self.assertOperationTypes(changes, 'a', 1, ["AddField"])
2712.         self.assertMigrationDependencies(changes, 'a', 0, [])
2713.         self.assertMigrationDependencies(changes, 'a', 1, [('__setting__', 'AUTH_USER_MODEL'), ('a', 'auto_1')])
2714.         # Right number/type of migrations?
2715.         self.assertNumberMigrations(changes, 'b', 1)
2716.         self.assertOperationTypes(changes, 'b', 0, ["CreateModel"])
2717.         self.assertMigrationDependencies(changes, 'b', 0, [('a', 'auto_1')])
2718. 
2719.     @override_settings(AUTH_USER_MODEL="a.Person")
2720.     def test_circular_dependency_swappable_self(self):
2721.         """
2722.         #23322 - The dependency resolver knows to explicitly resolve
2723.         swappable models.
2724.         """
2725.         with isolate_lru_cache(apps.get_swappable_settings_name):
2726.             person = ModelState("a", "Person", [
2727.                 ("id", models.AutoField(primary_key=True)),
2728.                 ("parent1", models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE, related_name='children'))
2729.             ])
2730.             changes = self.get_changes([], [person])
2731.         # Right number/type of migrations?
2732.         self.assertNumberMigrations(changes, 'a', 1)
2733.         self.assertOperationTypes(changes, 'a', 0, ["CreateModel"])
2734.         self.assertMigrationDependencies(changes, 'a', 0, [])
2735. 
2736.     @override_settings(AUTH_USER_MODEL='a.User')
2737.     def test_swappable_circular_multi_mti(self):
2738.         with isolate_lru_cache(apps.get_swappable_settings_name):
2739.             parent = ModelState('a', 'Parent', [
2740.                 ('user', models.ForeignKey(settings.AUTH_USER_MODEL, models.CASCADE))
2741.             ])
2742.             child = ModelState('a', 'Child', [], bases=('a.Parent',))
2743.             user = ModelState('a', 'User', [], bases=(AbstractBaseUser, 'a.Child'))
2744.             changes = self.get_changes([], [parent, child, user])
2745.         self.assertNumberMigrations(changes, 'a', 1)
2746.         self.assertOperationTypes(changes, 'a', 0, ['CreateModel', 'CreateModel', 'CreateModel', 'AddField'])
2747. 
2748.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition',
2749.                 side_effect=AssertionError("Should not have prompted for not null addition"))
2750.     def test_add_blank_textfield_and_charfield(self, mocked_ask_method):
2751.         """
2752.         #23405 - Adding a NOT NULL and blank `CharField` or `TextField`
2753.         without default should not prompt for a default.
2754.         """
2755.         changes = self.get_changes([self.author_empty], [self.author_with_biography_blank])
2756.         # Right number/type of migrations?
2757.         self.assertNumberMigrations(changes, 'testapp', 1)
2758.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField"])
2759.         self.assertOperationAttributes(changes, 'testapp', 0, 0)
2760. 
2761.     @mock.patch('django.db.migrations.questioner.MigrationQuestioner.ask_not_null_addition')
2762.     def test_add_non_blank_textfield_and_charfield(self, mocked_ask_method):
2763.         """
2764.         #23405 - Adding a NOT NULL and non-blank `CharField` or `TextField`
2765.         without default should prompt for a default.
2766.         """
2767.         changes = self.get_changes([self.author_empty], [self.author_with_biography_non_blank])
2768.         self.assertEqual(mocked_ask_method.call_count, 2)
2769.         # Right number/type of migrations?
2770.         self.assertNumberMigrations(changes, 'testapp', 1)
2771.         self.assertOperationTypes(changes, 'testapp', 0, ["AddField", "AddField"])
2772.         self.assertOperationAttributes(changes, 'testapp', 0, 0)
2773. 
2774.     def test_mti_inheritance_model_removal(self):
2775.         Animal = ModelState('app', 'Animal', [
2776.             ("id", models.AutoField(primary_key=True)),
2777.         ])
2778.         Dog = ModelState('app', 'Dog', [], bases=('app.Animal',))
2779.         changes = self.get_changes([Animal, Dog], [Animal])
2780.         self.assertNumberMigrations(changes, 'app', 1)
2781.         self.assertOperationTypes(changes, 'app', 0, ['DeleteModel'])
2782.         self.assertOperationAttributes(changes, 'app', 0, 0, name='Dog')
2783. 
2784.     def test_add_model_with_field_removed_from_base_model(self):
2785.         """
2786.         Removing a base field takes place before adding a new inherited model
2787.         that has a field with the same name.
2788.         """
2789.         before = [
2790.             ModelState('app', 'readable', [
2791.                 ('id', models.AutoField(primary_key=True)),
2792.                 ('title', models.CharField(max_length=200)),
2793.             ]),
2794.         ]
2795.         after = [
2796.             ModelState('app', 'readable', [
2797.                 ('id', models.AutoField(primary_key=True)),
2798.             ]),
2799.             ModelState('app', 'book', [
2800.                 ('title', models.CharField(max_length=200)),
2801.             ], bases=('app.readable',)),
2802.         ]
2803.         changes = self.get_changes(before, after)
2804.         self.assertNumberMigrations(changes, 'app', 1)
2805.         self.assertOperationTypes(changes, 'app', 0, ['RemoveField', 'CreateModel'])
2806.         self.assertOperationAttributes(changes, 'app', 0, 0, name='title', model_name='readable')
2807.         self.assertOperationAttributes(changes, 'app', 0, 1, name='book')
2808. 
2809.     def test_parse_number(self):
2810.         tests = [
2811.             ('no_number', None),
2812.             ('0001_initial', 1),
2813.             ('0002_model3', 2),
2814.             ('0002_auto_20380101_1112', 2),
2815.             ('0002_squashed_0003', 3),
2816.             ('0002_model2_squashed_0003_other4', 3),
2817.             ('0002_squashed_0003_squashed_0004', 4),
2818.             ('0002_model2_squashed_0003_other4_squashed_0005_other6', 5),
2819.             ('0002_custom_name_20380101_1112_squashed_0003_model', 3),
2820.             ('2_squashed_4', 4),
2821.         ]
2822.         for migration_name, expected_number in tests:
2823.             with self.subTest(migration_name=migration_name):
2824.                 self.assertEqual(
2825.                     MigrationAutodetector.parse_number(migration_name),
2826.                     expected_number,
2827.                 )
2828. 
2829.     def test_add_custom_fk_with_hardcoded_to(self):
2830.         class HardcodedForeignKey(models.ForeignKey):
2831.             def __init__(self, *args, **kwargs):
2832.                 kwargs['to'] = 'testapp.Author'
2833.                 super().__init__(*args, **kwargs)
2834. 
2835.             def deconstruct(self):
2836.                 name, path, args, kwargs = super().deconstruct()
2837.                 del kwargs['to']
2838.                 return name, path, args, kwargs
2839. 
2840.         book_hardcoded_fk_to = ModelState('testapp', 'Book', [
2841.             ('author', HardcodedForeignKey(on_delete=models.CASCADE)),
2842.         ])
2843.         changes = self.get_changes(
2844.             [self.author_empty],
2845.             [self.author_empty, book_hardcoded_fk_to],
2846.         )
2847.         self.assertNumberMigrations(changes, 'testapp', 1)
2848.         self.assertOperationTypes(changes, 'testapp', 0, ['CreateModel'])
2849.         self.assertOperationAttributes(changes, 'testapp', 0, 0, name='Book')
2850. 
2851. 
2852. class MigrationSuggestNameTests(SimpleTestCase):
2853.     def test_no_operations(self):
2854.         class Migration(migrations.Migration):
2855.             operations = []
2856. 
2857.         migration = Migration('some_migration', 'test_app')
2858.         self.assertIs(migration.suggest_name().startswith('auto_'), True)
2859. 
2860.     def test_no_operations_initial(self):
2861.         class Migration(migrations.Migration):
2862.             initial = True
2863.             operations = []
2864. 
2865.         migration = Migration('some_migration', 'test_app')
2866.         self.assertEqual(migration.suggest_name(), 'initial')
2867. 
2868.     def test_single_operation(self):
2869.         class Migration(migrations.Migration):
2870.             operations = [migrations.CreateModel('Person', fields=[])]
2871. 
2872.         migration = Migration('0001_initial', 'test_app')
2873.         self.assertEqual(migration.suggest_name(), 'person')
2874. 
2875.         class Migration(migrations.Migration):
2876.             operations = [migrations.DeleteModel('Person')]
2877. 
2878.         migration = Migration('0002_initial', 'test_app')
2879.         self.assertEqual(migration.suggest_name(), 'delete_person')
2880. 
2881.     def test_single_operation_long_name(self):
2882.         class Migration(migrations.Migration):
2883.             operations = [migrations.CreateModel('A' * 53, fields=[])]
2884. 
2885.         migration = Migration('some_migration', 'test_app')
2886.         self.assertEqual(migration.suggest_name(), 'a' * 53)
2887. 
2888.     def test_two_operations(self):
2889.         class Migration(migrations.Migration):
2890.             operations = [
2891.                 migrations.CreateModel('Person', fields=[]),
2892.                 migrations.DeleteModel('Animal'),
2893.             ]
2894. 
2895.         migration = Migration('some_migration', 'test_app')
2896.         self.assertEqual(migration.suggest_name(), 'person_delete_animal')
2897. 
2898.     def test_two_create_models(self):
2899.         class Migration(migrations.Migration):
2900.             operations = [
2901.                 migrations.CreateModel('Person', fields=[]),
2902.                 migrations.CreateModel('Animal', fields=[]),
2903.             ]
2904. 
2905.         migration = Migration('0001_initial', 'test_app')
2906.         self.assertEqual(migration.suggest_name(), 'person_animal')
2907. 
2908.     def test_two_create_models_with_initial_true(self):
2909.         class Migration(migrations.Migration):
2910.             initial = True
2911.             operations = [
2912.                 migrations.CreateModel('Person', fields=[]),
2913.                 migrations.CreateModel('Animal', fields=[]),
2914.             ]
2915. 
2916.         migration = Migration('0001_initial', 'test_app')
2917.         self.assertEqual(migration.suggest_name(), 'initial')
2918. 
2919.     def test_many_operations_suffix(self):
2920.         class Migration(migrations.Migration):
2921.             operations = [
2922.                 migrations.CreateModel('Person1', fields=[]),
2923.                 migrations.CreateModel('Person2', fields=[]),
2924.                 migrations.CreateModel('Person3', fields=[]),
2925.                 migrations.DeleteModel('Person4'),
2926.                 migrations.DeleteModel('Person5'),
2927.             ]
2928. 
2929.         migration = Migration('some_migration', 'test_app')
2930.         self.assertEqual(
2931.             migration.suggest_name(),
2932.             'person1_person2_person3_delete_person4_and_more',
2933.         )
2934. 
2935.     def test_operation_with_no_suggested_name(self):
2936.         class Migration(migrations.Migration):
2937.             operations = [
2938.                 migrations.CreateModel('Person', fields=[]),
2939.                 migrations.RunSQL('SELECT 1 FROM person;'),
2940.             ]
2941. 
2942.         migration = Migration('some_migration', 'test_app')
2943.         self.assertIs(migration.suggest_name().startswith('auto_'), True)
2944. 
2945.     def test_none_name(self):
2946.         class Migration(migrations.Migration):
2947.             operations = [migrations.RunSQL('SELECT 1 FROM person;')]
2948. 
2949.         migration = Migration('0001_initial', 'test_app')
2950.         suggest_name = migration.suggest_name()
2951.         self.assertIs(suggest_name.startswith('auto_'), True)
2952. 
2953.     def test_none_name_with_initial_true(self):
2954.         class Migration(migrations.Migration):
2955.             initial = True
2956.             operations = [migrations.RunSQL('SELECT 1 FROM person;')]
2957. 
2958.         migration = Migration('0001_initial', 'test_app')
2959.         self.assertEqual(migration.suggest_name(), 'initial')
2960. 
2961.     def test_auto(self):
2962.         migration = migrations.Migration('0001_initial', 'test_app')
2963.         suggest_name = migration.suggest_name()
2964.         self.assertIs(suggest_name.startswith('auto_'), True)


File: tests/migrations/test_writer.py
Line number range: 1 - 843
Content:
1. import datetime
2. import decimal
3. import enum
4. import functools
5. import math
6. import os
7. import pathlib
8. import re
9. import sys
10. import uuid
11. from unittest import mock
12. 
13. try:
14.     import zoneinfo
15. except ImportError:
16.     from backports import zoneinfo
17. 
18. try:
19.     import pytz
20. except ImportError:
21.     pytz = None
22. 
23. import custom_migration_operations.more_operations
24. import custom_migration_operations.operations
25. 
26. from django import get_version
27. from django.conf import SettingsReference, settings
28. from django.core.validators import EmailValidator, RegexValidator
29. from django.db import migrations, models
30. from django.db.migrations.serializer import BaseSerializer
31. from django.db.migrations.writer import MigrationWriter, OperationWriter
32. from django.test import SimpleTestCase
33. from django.utils.deconstruct import deconstructible
34. from django.utils.functional import SimpleLazyObject
35. from django.utils.timezone import get_default_timezone, get_fixed_timezone, utc
36. from django.utils.translation import gettext_lazy as _
37. 
38. from .models import FoodManager, FoodQuerySet
39. 
40. 
41. class DeconstructibleInstances:
42.     def deconstruct(self):
43.         return ('DeconstructibleInstances', [], {})
44. 
45. 
46. class Money(decimal.Decimal):
47.     def deconstruct(self):
48.         return (
49.             '%s.%s' % (self.__class__.__module__, self.__class__.__name__),
50.             [str(self)],
51.             {}
52.         )
53. 
54. 
55. class TestModel1:
56.     def upload_to(self):
57.         return '/somewhere/dynamic/'
58.     thing = models.FileField(upload_to=upload_to)
59. 
60. 
61. class TextEnum(enum.Enum):
62.     A = 'a-value'
63.     B = 'value-b'
64. 
65. 
66. class TextTranslatedEnum(enum.Enum):
67.     A = _('a-value')
68.     B = _('value-b')
69. 
70. 
71. class BinaryEnum(enum.Enum):
72.     A = b'a-value'
73.     B = b'value-b'
74. 
75. 
76. class IntEnum(enum.IntEnum):
77.     A = 1
78.     B = 2
79. 
80. 
81. class OperationWriterTests(SimpleTestCase):
82. 
83.     def test_empty_signature(self):
84.         operation = custom_migration_operations.operations.TestOperation()
85.         buff, imports = OperationWriter(operation, indentation=0).serialize()
86.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
87.         self.assertEqual(
88.             buff,
89.             'custom_migration_operations.operations.TestOperation(\n'
90.             '),'
91.         )
92. 
93.     def test_args_signature(self):
94.         operation = custom_migration_operations.operations.ArgsOperation(1, 2)
95.         buff, imports = OperationWriter(operation, indentation=0).serialize()
96.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
97.         self.assertEqual(
98.             buff,
99.             'custom_migration_operations.operations.ArgsOperation(\n'
100.             '    arg1=1,\n'
101.             '    arg2=2,\n'
102.             '),'
103.         )
104. 
105.     def test_kwargs_signature(self):
106.         operation = custom_migration_operations.operations.KwargsOperation(kwarg1=1)
107.         buff, imports = OperationWriter(operation, indentation=0).serialize()
108.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
109.         self.assertEqual(
110.             buff,
111.             'custom_migration_operations.operations.KwargsOperation(\n'
112.             '    kwarg1=1,\n'
113.             '),'
114.         )
115. 
116.     def test_args_kwargs_signature(self):
117.         operation = custom_migration_operations.operations.ArgsKwargsOperation(1, 2, kwarg2=4)
118.         buff, imports = OperationWriter(operation, indentation=0).serialize()
119.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
120.         self.assertEqual(
121.             buff,
122.             'custom_migration_operations.operations.ArgsKwargsOperation(\n'
123.             '    arg1=1,\n'
124.             '    arg2=2,\n'
125.             '    kwarg2=4,\n'
126.             '),'
127.         )
128. 
129.     def test_nested_args_signature(self):
130.         operation = custom_migration_operations.operations.ArgsOperation(
131.             custom_migration_operations.operations.ArgsOperation(1, 2),
132.             custom_migration_operations.operations.KwargsOperation(kwarg1=3, kwarg2=4)
133.         )
134.         buff, imports = OperationWriter(operation, indentation=0).serialize()
135.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
136.         self.assertEqual(
137.             buff,
138.             'custom_migration_operations.operations.ArgsOperation(\n'
139.             '    arg1=custom_migration_operations.operations.ArgsOperation(\n'
140.             '        arg1=1,\n'
141.             '        arg2=2,\n'
142.             '    ),\n'
143.             '    arg2=custom_migration_operations.operations.KwargsOperation(\n'
144.             '        kwarg1=3,\n'
145.             '        kwarg2=4,\n'
146.             '    ),\n'
147.             '),'
148.         )
149. 
150.     def test_multiline_args_signature(self):
151.         operation = custom_migration_operations.operations.ArgsOperation("test\n    arg1", "test\narg2")
152.         buff, imports = OperationWriter(operation, indentation=0).serialize()
153.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
154.         self.assertEqual(
155.             buff,
156.             "custom_migration_operations.operations.ArgsOperation(\n"
157.             "    arg1='test\\n    arg1',\n"
158.             "    arg2='test\\narg2',\n"
159.             "),"
160.         )
161. 
162.     def test_expand_args_signature(self):
163.         operation = custom_migration_operations.operations.ExpandArgsOperation([1, 2])
164.         buff, imports = OperationWriter(operation, indentation=0).serialize()
165.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
166.         self.assertEqual(
167.             buff,
168.             'custom_migration_operations.operations.ExpandArgsOperation(\n'
169.             '    arg=[\n'
170.             '        1,\n'
171.             '        2,\n'
172.             '    ],\n'
173.             '),'
174.         )
175. 
176.     def test_nested_operation_expand_args_signature(self):
177.         operation = custom_migration_operations.operations.ExpandArgsOperation(
178.             arg=[
179.                 custom_migration_operations.operations.KwargsOperation(
180.                     kwarg1=1,
181.                     kwarg2=2,
182.                 ),
183.             ]
184.         )
185.         buff, imports = OperationWriter(operation, indentation=0).serialize()
186.         self.assertEqual(imports, {'import custom_migration_operations.operations'})
187.         self.assertEqual(
188.             buff,
189.             'custom_migration_operations.operations.ExpandArgsOperation(\n'
190.             '    arg=[\n'
191.             '        custom_migration_operations.operations.KwargsOperation(\n'
192.             '            kwarg1=1,\n'
193.             '            kwarg2=2,\n'
194.             '        ),\n'
195.             '    ],\n'
196.             '),'
197.         )
198. 
199. 
200. class WriterTests(SimpleTestCase):
201.     """
202.     Tests the migration writer (makes migration files from Migration instances)
203.     """
204.     class NestedEnum(enum.IntEnum):
205.         A = 1
206.         B = 2
207. 
208.     class NestedChoices(models.TextChoices):
209.         X = 'X', 'X value'
210.         Y = 'Y', 'Y value'
211. 
212.     def safe_exec(self, string, value=None):
213.         d = {}
214.         try:
215.             exec(string, globals(), d)
216.         except Exception as e:
217.             if value:
218.                 self.fail("Could not exec %r (from value %r): %s" % (string.strip(), value, e))
219.             else:
220.                 self.fail("Could not exec %r: %s" % (string.strip(), e))
221.         return d
222. 
223.     def serialize_round_trip(self, value):
224.         string, imports = MigrationWriter.serialize(value)
225.         return self.safe_exec("%s\ntest_value_result = %s" % ("\n".join(imports), string), value)['test_value_result']
226. 
227.     def assertSerializedEqual(self, value):
228.         self.assertEqual(self.serialize_round_trip(value), value)
229. 
230.     def assertSerializedResultEqual(self, value, target):
231.         self.assertEqual(MigrationWriter.serialize(value), target)
232. 
233.     def assertSerializedFieldEqual(self, value):
234.         new_value = self.serialize_round_trip(value)
235.         self.assertEqual(value.__class__, new_value.__class__)
236.         self.assertEqual(value.max_length, new_value.max_length)
237.         self.assertEqual(value.null, new_value.null)
238.         self.assertEqual(value.unique, new_value.unique)
239. 
240.     def test_serialize_numbers(self):
241.         self.assertSerializedEqual(1)
242.         self.assertSerializedEqual(1.2)
243.         self.assertTrue(math.isinf(self.serialize_round_trip(float("inf"))))
244.         self.assertTrue(math.isinf(self.serialize_round_trip(float("-inf"))))
245.         self.assertTrue(math.isnan(self.serialize_round_trip(float("nan"))))
246. 
247.         self.assertSerializedEqual(decimal.Decimal('1.3'))
248.         self.assertSerializedResultEqual(
249.             decimal.Decimal('1.3'),
250.             ("Decimal('1.3')", {'from decimal import Decimal'})
251.         )
252. 
253.         self.assertSerializedEqual(Money('1.3'))
254.         self.assertSerializedResultEqual(
255.             Money('1.3'),
256.             ("migrations.test_writer.Money('1.3')", {'import migrations.test_writer'})
257.         )
258. 
259.     def test_serialize_constants(self):
260.         self.assertSerializedEqual(None)
261.         self.assertSerializedEqual(True)
262.         self.assertSerializedEqual(False)
263. 
264.     def test_serialize_strings(self):
265.         self.assertSerializedEqual(b"foobar")
266.         string, imports = MigrationWriter.serialize(b"foobar")
267.         self.assertEqual(string, "b'foobar'")
268.         self.assertSerializedEqual("föobár")
269.         string, imports = MigrationWriter.serialize("foobar")
270.         self.assertEqual(string, "'foobar'")
271. 
272.     def test_serialize_multiline_strings(self):
273.         self.assertSerializedEqual(b"foo\nbar")
274.         string, imports = MigrationWriter.serialize(b"foo\nbar")
275.         self.assertEqual(string, "b'foo\\nbar'")
276.         self.assertSerializedEqual("föo\nbár")
277.         string, imports = MigrationWriter.serialize("foo\nbar")
278.         self.assertEqual(string, "'foo\\nbar'")
279. 
280.     def test_serialize_collections(self):
281.         self.assertSerializedEqual({1: 2})
282.         self.assertSerializedEqual(["a", 2, True, None])
283.         self.assertSerializedEqual({2, 3, "eighty"})
284.         self.assertSerializedEqual({"lalalala": ["yeah", "no", "maybe"]})
285.         self.assertSerializedEqual(_('Hello'))
286. 
287.     def test_serialize_builtin_types(self):
288.         self.assertSerializedEqual([list, tuple, dict, set, frozenset])
289.         self.assertSerializedResultEqual(
290.             [list, tuple, dict, set, frozenset],
291.             ("[list, tuple, dict, set, frozenset]", set())
292.         )
293. 
294.     def test_serialize_lazy_objects(self):
295.         pattern = re.compile(r'^foo$')
296.         lazy_pattern = SimpleLazyObject(lambda: pattern)
297.         self.assertEqual(self.serialize_round_trip(lazy_pattern), pattern)
298. 
299.     def test_serialize_enums(self):
300.         self.assertSerializedResultEqual(
301.             TextEnum.A,
302.             ("migrations.test_writer.TextEnum['A']", {'import migrations.test_writer'})
303.         )
304.         self.assertSerializedResultEqual(
305.             TextTranslatedEnum.A,
306.             ("migrations.test_writer.TextTranslatedEnum['A']", {'import migrations.test_writer'})
307.         )
308.         self.assertSerializedResultEqual(
309.             BinaryEnum.A,
310.             ("migrations.test_writer.BinaryEnum['A']", {'import migrations.test_writer'})
311.         )
312.         self.assertSerializedResultEqual(
313.             IntEnum.B,
314.             ("migrations.test_writer.IntEnum['B']", {'import migrations.test_writer'})
315.         )
316.         self.assertSerializedResultEqual(
317.             self.NestedEnum.A,
318.             (
319.                 "migrations.test_writer.WriterTests.NestedEnum['A']",
320.                 {'import migrations.test_writer'},
321.             ),
322.         )
323.         self.assertSerializedEqual(self.NestedEnum.A)
324. 
325.         field = models.CharField(default=TextEnum.B, choices=[(m.value, m) for m in TextEnum])
326.         string = MigrationWriter.serialize(field)[0]
327.         self.assertEqual(
328.             string,
329.             "models.CharField(choices=["
330.             "('a-value', migrations.test_writer.TextEnum['A']), "
331.             "('value-b', migrations.test_writer.TextEnum['B'])], "
332.             "default=migrations.test_writer.TextEnum['B'])"
333.         )
334.         field = models.CharField(
335.             default=TextTranslatedEnum.A,
336.             choices=[(m.value, m) for m in TextTranslatedEnum],
337.         )
338.         string = MigrationWriter.serialize(field)[0]
339.         self.assertEqual(
340.             string,
341.             "models.CharField(choices=["
342.             "('a-value', migrations.test_writer.TextTranslatedEnum['A']), "
343.             "('value-b', migrations.test_writer.TextTranslatedEnum['B'])], "
344.             "default=migrations.test_writer.TextTranslatedEnum['A'])"
345.         )
346.         field = models.CharField(default=BinaryEnum.B, choices=[(m.value, m) for m in BinaryEnum])
347.         string = MigrationWriter.serialize(field)[0]
348.         self.assertEqual(
349.             string,
350.             "models.CharField(choices=["
351.             "(b'a-value', migrations.test_writer.BinaryEnum['A']), "
352.             "(b'value-b', migrations.test_writer.BinaryEnum['B'])], "
353.             "default=migrations.test_writer.BinaryEnum['B'])"
354.         )
355.         field = models.IntegerField(default=IntEnum.A, choices=[(m.value, m) for m in IntEnum])
356.         string = MigrationWriter.serialize(field)[0]
357.         self.assertEqual(
358.             string,
359.             "models.IntegerField(choices=["
360.             "(1, migrations.test_writer.IntEnum['A']), "
361.             "(2, migrations.test_writer.IntEnum['B'])], "
362.             "default=migrations.test_writer.IntEnum['A'])"
363.         )
364. 
365.     def test_serialize_choices(self):
366.         class TextChoices(models.TextChoices):
367.             A = 'A', 'A value'
368.             B = 'B', 'B value'
369. 
370.         class IntegerChoices(models.IntegerChoices):
371.             A = 1, 'One'
372.             B = 2, 'Two'
373. 
374.         class DateChoices(datetime.date, models.Choices):
375.             DATE_1 = 1969, 7, 20, 'First date'
376.             DATE_2 = 1969, 11, 19, 'Second date'
377. 
378.         self.assertSerializedResultEqual(TextChoices.A, ("'A'", set()))
379.         self.assertSerializedResultEqual(IntegerChoices.A, ('1', set()))
380.         self.assertSerializedResultEqual(
381.             DateChoices.DATE_1,
382.             ('datetime.date(1969, 7, 20)', {'import datetime'}),
383.         )
384.         field = models.CharField(default=TextChoices.B, choices=TextChoices.choices)
385.         string = MigrationWriter.serialize(field)[0]
386.         self.assertEqual(
387.             string,
388.             "models.CharField(choices=[('A', 'A value'), ('B', 'B value')], "
389.             "default='B')",
390.         )
391.         field = models.IntegerField(default=IntegerChoices.B, choices=IntegerChoices.choices)
392.         string = MigrationWriter.serialize(field)[0]
393.         self.assertEqual(
394.             string,
395.             "models.IntegerField(choices=[(1, 'One'), (2, 'Two')], default=2)",
396.         )
397.         field = models.DateField(default=DateChoices.DATE_2, choices=DateChoices.choices)
398.         string = MigrationWriter.serialize(field)[0]
399.         self.assertEqual(
400.             string,
401.             "models.DateField(choices=["
402.             "(datetime.date(1969, 7, 20), 'First date'), "
403.             "(datetime.date(1969, 11, 19), 'Second date')], "
404.             "default=datetime.date(1969, 11, 19))"
405.         )
406. 
407.     def test_serialize_nested_class(self):
408.         for nested_cls in [self.NestedEnum, self.NestedChoices]:
409.             cls_name = nested_cls.__name__
410.             with self.subTest(cls_name):
411.                 self.assertSerializedResultEqual(
412.                     nested_cls,
413.                     (
414.                         "migrations.test_writer.WriterTests.%s" % cls_name,
415.                         {'import migrations.test_writer'},
416.                     ),
417.                 )
418. 
419.     def test_serialize_uuid(self):
420.         self.assertSerializedEqual(uuid.uuid1())
421.         self.assertSerializedEqual(uuid.uuid4())
422. 
423.         uuid_a = uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8')
424.         uuid_b = uuid.UUID('c7853ec1-2ea3-4359-b02d-b54e8f1bcee2')
425.         self.assertSerializedResultEqual(
426.             uuid_a,
427.             ("uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8')", {'import uuid'})
428.         )
429.         self.assertSerializedResultEqual(
430.             uuid_b,
431.             ("uuid.UUID('c7853ec1-2ea3-4359-b02d-b54e8f1bcee2')", {'import uuid'})
432.         )
433. 
434.         field = models.UUIDField(choices=((uuid_a, 'UUID A'), (uuid_b, 'UUID B')), default=uuid_a)
435.         string = MigrationWriter.serialize(field)[0]
436.         self.assertEqual(
437.             string,
438.             "models.UUIDField(choices=["
439.             "(uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8'), 'UUID A'), "
440.             "(uuid.UUID('c7853ec1-2ea3-4359-b02d-b54e8f1bcee2'), 'UUID B')], "
441.             "default=uuid.UUID('5c859437-d061-4847-b3f7-e6b78852f8c8'))"
442.         )
443. 
444.     def test_serialize_pathlib(self):
445.         # Pure path objects work in all platforms.
446.         self.assertSerializedEqual(pathlib.PurePosixPath())
447.         self.assertSerializedEqual(pathlib.PureWindowsPath())
448.         path = pathlib.PurePosixPath('/path/file.txt')
449.         expected = ("pathlib.PurePosixPath('/path/file.txt')", {'import pathlib'})
450.         self.assertSerializedResultEqual(path, expected)
451.         path = pathlib.PureWindowsPath('A:\\File.txt')
452.         expected = ("pathlib.PureWindowsPath('A:/File.txt')", {'import pathlib'})
453.         self.assertSerializedResultEqual(path, expected)
454.         # Concrete path objects work on supported platforms.
455.         if sys.platform == 'win32':
456.             self.assertSerializedEqual(pathlib.WindowsPath.cwd())
457.             path = pathlib.WindowsPath('A:\\File.txt')
458.             expected = ("pathlib.PureWindowsPath('A:/File.txt')", {'import pathlib'})
459.             self.assertSerializedResultEqual(path, expected)
460.         else:
461.             self.assertSerializedEqual(pathlib.PosixPath.cwd())
462.             path = pathlib.PosixPath('/path/file.txt')
463.             expected = ("pathlib.PurePosixPath('/path/file.txt')", {'import pathlib'})
464.             self.assertSerializedResultEqual(path, expected)
465. 
466.         field = models.FilePathField(path=pathlib.PurePosixPath('/home/user'))
467.         string, imports = MigrationWriter.serialize(field)
468.         self.assertEqual(
469.             string,
470.             "models.FilePathField(path=pathlib.PurePosixPath('/home/user'))",
471.         )
472.         self.assertIn('import pathlib', imports)
473. 
474.     def test_serialize_path_like(self):
475.         with os.scandir(os.path.dirname(__file__)) as entries:
476.             path_like = list(entries)[0]
477.         expected = (repr(path_like.path), {})
478.         self.assertSerializedResultEqual(path_like, expected)
479. 
480.         field = models.FilePathField(path=path_like)
481.         string = MigrationWriter.serialize(field)[0]
482.         self.assertEqual(string, 'models.FilePathField(path=%r)' % path_like.path)
483. 
484.     def test_serialize_functions(self):
485.         with self.assertRaisesMessage(ValueError, 'Cannot serialize function: lambda'):
486.             self.assertSerializedEqual(lambda x: 42)
487.         self.assertSerializedEqual(models.SET_NULL)
488.         string, imports = MigrationWriter.serialize(models.SET(42))
489.         self.assertEqual(string, 'models.SET(42)')
490.         self.serialize_round_trip(models.SET(42))
491. 
492.     def test_serialize_datetime(self):
493.         self.assertSerializedEqual(datetime.datetime.now())
494.         self.assertSerializedEqual(datetime.datetime.now)
495.         self.assertSerializedEqual(datetime.datetime.today())
496.         self.assertSerializedEqual(datetime.datetime.today)
497.         self.assertSerializedEqual(datetime.date.today())
498.         self.assertSerializedEqual(datetime.date.today)
499.         self.assertSerializedEqual(datetime.datetime.now().time())
500.         self.assertSerializedEqual(datetime.datetime(2014, 1, 1, 1, 1, tzinfo=get_default_timezone()))
501.         self.assertSerializedEqual(datetime.datetime(2013, 12, 31, 22, 1, tzinfo=get_fixed_timezone(180)))
502.         self.assertSerializedResultEqual(
503.             datetime.datetime(2014, 1, 1, 1, 1),
504.             ("datetime.datetime(2014, 1, 1, 1, 1)", {'import datetime'})
505.         )
506.         for tzinfo in (utc, datetime.timezone.utc):
507.             with self.subTest(tzinfo=tzinfo):
508.                 self.assertSerializedResultEqual(
509.                     datetime.datetime(2012, 1, 1, 1, 1, tzinfo=tzinfo),
510.                     (
511.                         "datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc)",
512.                         {'import datetime', 'from django.utils.timezone import utc'},
513.                     )
514.                 )
515. 
516.         self.assertSerializedResultEqual(
517.             datetime.datetime(2012, 1, 1, 2, 1, tzinfo=zoneinfo.ZoneInfo('Europe/Paris')),
518.             (
519.                 "datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc)",
520.                 {'import datetime', 'from django.utils.timezone import utc'},
521.             )
522.         )
523.         if pytz:
524.             self.assertSerializedResultEqual(
525.                 pytz.timezone('Europe/Paris').localize(datetime.datetime(2012, 1, 1, 2, 1)),
526.                 (
527.                     "datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc)",
528.                     {'import datetime', 'from django.utils.timezone import utc'},
529.                 )
530.             )
531. 
532.     def test_serialize_fields(self):
533.         self.assertSerializedFieldEqual(models.CharField(max_length=255))
534.         self.assertSerializedResultEqual(
535.             models.CharField(max_length=255),
536.             ("models.CharField(max_length=255)", {"from django.db import models"})
537.         )
538.         self.assertSerializedFieldEqual(models.TextField(null=True, blank=True))
539.         self.assertSerializedResultEqual(
540.             models.TextField(null=True, blank=True),
541.             ("models.TextField(blank=True, null=True)", {'from django.db import models'})
542.         )
543. 
544.     def test_serialize_settings(self):
545.         self.assertSerializedEqual(SettingsReference(settings.AUTH_USER_MODEL, "AUTH_USER_MODEL"))
546.         self.assertSerializedResultEqual(
547.             SettingsReference("someapp.model", "AUTH_USER_MODEL"),
548.             ("settings.AUTH_USER_MODEL", {"from django.conf import settings"})
549.         )
550. 
551.     def test_serialize_iterators(self):
552.         self.assertSerializedResultEqual(
553.             ((x, x * x) for x in range(3)),
554.             ("((0, 0), (1, 1), (2, 4))", set())
555.         )
556. 
557.     def test_serialize_compiled_regex(self):
558.         """
559.         Make sure compiled regex can be serialized.
560.         """
561.         regex = re.compile(r'^\w+$')
562.         self.assertSerializedEqual(regex)
563. 
564.     def test_serialize_class_based_validators(self):
565.         """
566.         Ticket #22943: Test serialization of class-based validators, including
567.         compiled regexes.
568.         """
569.         validator = RegexValidator(message="hello")
570.         string = MigrationWriter.serialize(validator)[0]
571.         self.assertEqual(string, "django.core.validators.RegexValidator(message='hello')")
572.         self.serialize_round_trip(validator)
573. 
574.         # Test with a compiled regex.
575.         validator = RegexValidator(regex=re.compile(r'^\w+$'))
576.         string = MigrationWriter.serialize(validator)[0]
577.         self.assertEqual(string, "django.core.validators.RegexValidator(regex=re.compile('^\\\\w+$'))")
578.         self.serialize_round_trip(validator)
579. 
580.         # Test a string regex with flag
581.         validator = RegexValidator(r'^[0-9]+$', flags=re.S)
582.         string = MigrationWriter.serialize(validator)[0]
583.         self.assertEqual(string, "django.core.validators.RegexValidator('^[0-9]+$', flags=re.RegexFlag['DOTALL'])")
584.         self.serialize_round_trip(validator)
585. 
586.         # Test message and code
587.         validator = RegexValidator('^[-a-zA-Z0-9_]+$', 'Invalid', 'invalid')
588.         string = MigrationWriter.serialize(validator)[0]
589.         self.assertEqual(string, "django.core.validators.RegexValidator('^[-a-zA-Z0-9_]+$', 'Invalid', 'invalid')")
590.         self.serialize_round_trip(validator)
591. 
592.         # Test with a subclass.
593.         validator = EmailValidator(message="hello")
594.         string = MigrationWriter.serialize(validator)[0]
595.         self.assertEqual(string, "django.core.validators.EmailValidator(message='hello')")
596.         self.serialize_round_trip(validator)
597. 
598.         validator = deconstructible(path="migrations.test_writer.EmailValidator")(EmailValidator)(message="hello")
599.         string = MigrationWriter.serialize(validator)[0]
600.         self.assertEqual(string, "migrations.test_writer.EmailValidator(message='hello')")
601. 
602.         validator = deconstructible(path="custom.EmailValidator")(EmailValidator)(message="hello")
603.         with self.assertRaisesMessage(ImportError, "No module named 'custom'"):
604.             MigrationWriter.serialize(validator)
605. 
606.         validator = deconstructible(path="django.core.validators.EmailValidator2")(EmailValidator)(message="hello")
607.         with self.assertRaisesMessage(ValueError, "Could not find object EmailValidator2 in django.core.validators."):
608.             MigrationWriter.serialize(validator)
609. 
610.     def test_serialize_empty_nonempty_tuple(self):
611.         """
612.         Ticket #22679: makemigrations generates invalid code for (an empty
613.         tuple) default_permissions = ()
614.         """
615.         empty_tuple = ()
616.         one_item_tuple = ('a',)
617.         many_items_tuple = ('a', 'b', 'c')
618.         self.assertSerializedEqual(empty_tuple)
619.         self.assertSerializedEqual(one_item_tuple)
620.         self.assertSerializedEqual(many_items_tuple)
621. 
622.     def test_serialize_range(self):
623.         string, imports = MigrationWriter.serialize(range(1, 5))
624.         self.assertEqual(string, 'range(1, 5)')
625.         self.assertEqual(imports, set())
626. 
627.     def test_serialize_builtins(self):
628.         string, imports = MigrationWriter.serialize(range)
629.         self.assertEqual(string, 'range')
630.         self.assertEqual(imports, set())
631. 
632.     def test_serialize_unbound_method_reference(self):
633.         """An unbound method used within a class body can be serialized."""
634.         self.serialize_round_trip(TestModel1.thing)
635. 
636.     def test_serialize_local_function_reference(self):
637.         """A reference in a local scope can't be serialized."""
638.         class TestModel2:
639.             def upload_to(self):
640.                 return "somewhere dynamic"
641.             thing = models.FileField(upload_to=upload_to)
642. 
643.         with self.assertRaisesMessage(ValueError, 'Could not find function upload_to in migrations.test_writer'):
644.             self.serialize_round_trip(TestModel2.thing)
645. 
646.     def test_serialize_managers(self):
647.         self.assertSerializedEqual(models.Manager())
648.         self.assertSerializedResultEqual(
649.             FoodQuerySet.as_manager(),
650.             ('migrations.models.FoodQuerySet.as_manager()', {'import migrations.models'})
651.         )
652.         self.assertSerializedEqual(FoodManager('a', 'b'))
653.         self.assertSerializedEqual(FoodManager('x', 'y', c=3, d=4))
654. 
655.     def test_serialize_frozensets(self):
656.         self.assertSerializedEqual(frozenset())
657.         self.assertSerializedEqual(frozenset("let it go"))
658. 
659.     def test_serialize_set(self):
660.         self.assertSerializedEqual(set())
661.         self.assertSerializedResultEqual(set(), ('set()', set()))
662.         self.assertSerializedEqual({'a'})
663.         self.assertSerializedResultEqual({'a'}, ("{'a'}", set()))
664. 
665.     def test_serialize_timedelta(self):
666.         self.assertSerializedEqual(datetime.timedelta())
667.         self.assertSerializedEqual(datetime.timedelta(minutes=42))
668. 
669.     def test_serialize_functools_partial(self):
670.         value = functools.partial(datetime.timedelta, 1, seconds=2)
671.         result = self.serialize_round_trip(value)
672.         self.assertEqual(result.func, value.func)
673.         self.assertEqual(result.args, value.args)
674.         self.assertEqual(result.keywords, value.keywords)
675. 
676.     def test_serialize_functools_partialmethod(self):
677.         value = functools.partialmethod(datetime.timedelta, 1, seconds=2)
678.         result = self.serialize_round_trip(value)
679.         self.assertIsInstance(result, functools.partialmethod)
680.         self.assertEqual(result.func, value.func)
681.         self.assertEqual(result.args, value.args)
682.         self.assertEqual(result.keywords, value.keywords)
683. 
684.     def test_serialize_type_none(self):
685.         self.assertSerializedEqual(type(None))
686. 
687.     def test_serialize_type_model(self):
688.         self.assertSerializedEqual(models.Model)
689.         self.assertSerializedResultEqual(
690.             MigrationWriter.serialize(models.Model),
691.             ("('models.Model', {'from django.db import models'})", set()),
692.         )
693. 
694.     def test_simple_migration(self):
695.         """
696.         Tests serializing a simple migration.
697.         """
698.         fields = {
699.             'charfield': models.DateTimeField(default=datetime.datetime.now),
700.             'datetimefield': models.DateTimeField(default=datetime.datetime.now),
701.         }
702. 
703.         options = {
704.             'verbose_name': 'My model',
705.             'verbose_name_plural': 'My models',
706.         }
707. 
708.         migration = type("Migration", (migrations.Migration,), {
709.             "operations": [
710.                 migrations.CreateModel("MyModel", tuple(fields.items()), options, (models.Model,)),
711.                 migrations.CreateModel("MyModel2", tuple(fields.items()), bases=(models.Model,)),
712.                 migrations.CreateModel(
713.                     name="MyModel3", fields=tuple(fields.items()), options=options, bases=(models.Model,)
714.                 ),
715.                 migrations.DeleteModel("MyModel"),
716.                 migrations.AddField("OtherModel", "datetimefield", fields["datetimefield"]),
717.             ],
718.             "dependencies": [("testapp", "some_other_one")],
719.         })
720.         writer = MigrationWriter(migration)
721.         output = writer.as_string()
722.         # We don't test the output formatting - that's too fragile.
723.         # Just make sure it runs for now, and that things look alright.
724.         result = self.safe_exec(output)
725.         self.assertIn("Migration", result)
726. 
727.     def test_migration_path(self):
728.         test_apps = [
729.             'migrations.migrations_test_apps.normal',
730.             'migrations.migrations_test_apps.with_package_model',
731.             'migrations.migrations_test_apps.without_init_file',
732.         ]
733. 
734.         base_dir = os.path.dirname(os.path.dirname(__file__))
735. 
736.         for app in test_apps:
737.             with self.modify_settings(INSTALLED_APPS={'append': app}):
738.                 migration = migrations.Migration('0001_initial', app.split('.')[-1])
739.                 expected_path = os.path.join(base_dir, *(app.split('.') + ['migrations', '0001_initial.py']))
740.                 writer = MigrationWriter(migration)
741.                 self.assertEqual(writer.path, expected_path)
742. 
743.     def test_custom_operation(self):
744.         migration = type("Migration", (migrations.Migration,), {
745.             "operations": [
746.                 custom_migration_operations.operations.TestOperation(),
747.                 custom_migration_operations.operations.CreateModel(),
748.                 migrations.CreateModel("MyModel", (), {}, (models.Model,)),
749.                 custom_migration_operations.more_operations.TestOperation()
750.             ],
751.             "dependencies": []
752.         })
753.         writer = MigrationWriter(migration)
754.         output = writer.as_string()
755.         result = self.safe_exec(output)
756.         self.assertIn("custom_migration_operations", result)
757.         self.assertNotEqual(
758.             result['custom_migration_operations'].operations.TestOperation,
759.             result['custom_migration_operations'].more_operations.TestOperation
760.         )
761. 
762.     def test_sorted_imports(self):
763.         """
764.         #24155 - Tests ordering of imports.
765.         """
766.         migration = type("Migration", (migrations.Migration,), {
767.             "operations": [
768.                 migrations.AddField("mymodel", "myfield", models.DateTimeField(
769.                     default=datetime.datetime(2012, 1, 1, 1, 1, tzinfo=utc),
770.                 )),
771.             ]
772.         })
773.         writer = MigrationWriter(migration)
774.         output = writer.as_string()
775.         self.assertIn(
776.             "import datetime\n"
777.             "from django.db import migrations, models\n"
778.             "from django.utils.timezone import utc\n",
779.             output
780.         )
781. 
782.     def test_migration_file_header_comments(self):
783.         """
784.         Test comments at top of file.
785.         """
786.         migration = type("Migration", (migrations.Migration,), {
787.             "operations": []
788.         })
789.         dt = datetime.datetime(2015, 7, 31, 4, 40, 0, 0, tzinfo=utc)
790.         with mock.patch('django.db.migrations.writer.now', lambda: dt):
791.             for include_header in (True, False):
792.                 with self.subTest(include_header=include_header):
793.                     writer = MigrationWriter(migration, include_header)
794.                     output = writer.as_string()
795. 
796.                     self.assertEqual(
797.                         include_header,
798.                         output.startswith(
799.                             "# Generated by Django %s on 2015-07-31 04:40\n\n" % get_version()
800.                         )
801.                     )
802.                     if not include_header:
803.                         # Make sure the output starts with something that's not
804.                         # a comment or indentation or blank line
805.                         self.assertRegex(output.splitlines(keepends=True)[0], r"^[^#\s]+")
806. 
807.     def test_models_import_omitted(self):
808.         """
809.         django.db.models shouldn't be imported if unused.
810.         """
811.         migration = type("Migration", (migrations.Migration,), {
812.             "operations": [
813.                 migrations.AlterModelOptions(
814.                     name='model',
815.                     options={'verbose_name': 'model', 'verbose_name_plural': 'models'},
816.                 ),
817.             ]
818.         })
819.         writer = MigrationWriter(migration)
820.         output = writer.as_string()
821.         self.assertIn("from django.db import migrations\n", output)
822. 
823.     def test_deconstruct_class_arguments(self):
824.         # Yes, it doesn't make sense to use a class as a default for a
825.         # CharField. It does make sense for custom fields though, for example
826.         # an enumfield that takes the enum class as an argument.
827.         string = MigrationWriter.serialize(models.CharField(default=DeconstructibleInstances))[0]
828.         self.assertEqual(string, "models.CharField(default=migrations.test_writer.DeconstructibleInstances)")
829. 
830.     def test_register_serializer(self):
831.         class ComplexSerializer(BaseSerializer):
832.             def serialize(self):
833.                 return 'complex(%r)' % self.value, {}
834. 
835.         MigrationWriter.register_serializer(complex, ComplexSerializer)
836.         self.assertSerializedEqual(complex(1, 2))
837.         MigrationWriter.unregister_serializer(complex)
838.         with self.assertRaisesMessage(ValueError, 'Cannot serialize: (1+2j)'):
839.             self.assertSerializedEqual(complex(1, 2))
840. 
841.     def test_register_non_serializer(self):
842.         with self.assertRaisesMessage(ValueError, "'TestModel1' must inherit from 'BaseSerializer'."):
843.             MigrationWriter.register_serializer(complex, TestModel1)

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-22 23:51:53,110 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The user's patch modifies the deconstruct behavior of several expression classes in `django.db.models.expressions.py` to simplify their serialization path in migrations. To find relevant test cases, I need to look for tests that verify the deconstruction of these expression classes (`Func`, `Value`, `ExpressionWrapper`, etc.). The previously fetched files (`tests/migrations/test_autodetector.py` and `tests/migrations/test_writer.py`) do not contain specific tests for the deconstruction of these expression objects. The file `tests/expressions/tests.py` is dedicated to testing database expressions and is therefore the most probable location for tests that cover their deconstruction and serialization behavior. Getting this file will allow me to identify test cases that I can adapt to verify the user's changes, as requested in the prompt." query='Please provide the full content of tests/expressions/tests.py.' extra_requirements='' purpose="I need this file to find test cases that verify the deconstruction of database expression classes, which is the core of the user's issue."
2025-12-22 23:51:53,111 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of tests/expressions/tests.py.
2025-12-22 23:51:53,112 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-22 23:51:53,116 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-22 23:51:53,117 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-22 23:51:53,121 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of tests/expressions/tests.py.
Purpose: I need this file to find test cases that verify the deconstruction of database expression classes, which is the core of the user's issue.
2025-12-22 23:51:55,290 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I will read the full content of the file `tests/expressions/tests.py`. This will allow me to examine the test cases and understand how database expression classes are deconstructed, which is crucial for addressing the user's issue." additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/expressions/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2099, 'candidates_token_count': 69, 'total_token_count': 2254, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2099}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 69}], 'thoughts_token_count': 86, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.08286762237548828, 'model_name': 'gemini-2.5-pro'} id='run--4c9fb77d-ba97-41c0-a22b-4b8d8d033624-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/expressions/tests.py'}, 'id': 'e935d5c4-f229-4aba-9dd6-71803b672909', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2099, 'output_tokens': 69, 'total_tokens': 2254, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 86}}
2025-12-22 23:51:57,688 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have retrieved the content of `tests/expressions/tests.py` to understand how database expression classes are deconstructed. Now, I will search for tests that use `deconstruct()` to pinpoint the exact test cases that verify the deconstruction of these classes, which is the key to resolving the user's issue." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "deconstruct", "relative_path": "tests/expressions/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9996, 'candidates_token_count': 97, 'total_token_count': 10135, 'cached_content_token_count': 1836, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9996}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1836}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 97}], 'thoughts_token_count': 42}, 'finish_reason': 'STOP', 'avg_logprobs': -0.18024041480624797, 'model_name': 'gemini-2.5-pro'} id='run--13f4a5ff-4a8a-46a1-a448-70fd9fd5ffd5-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'deconstruct', 'relative_path': 'tests/expressions/tests.py'}, 'id': '6b375b76-c3f8-4751-9183-9bfc30fd109e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9996, 'output_tokens': 97, 'total_tokens': 10135, 'input_token_details': {'cache_read': 1836}, 'output_token_details': {'reasoning': 42}}
2025-12-22 23:52:00,224 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have successfully identified test cases for deconstructing `F` and `Value` expressions within `tests/expressions/tests.py`. To further my investigation, I will now look for tests specifically related to the `ExpressionWrapper` class, as understanding its deconstruction is also pertinent to the user's issue." additional_kwargs={'function_call': {'name': 'find_ast_node_with_type_in_file_with_relative_path', 'arguments': '{"type": "class_definition", "relative_path": "tests/expressions/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 12236, 'candidates_token_count': 96, 'total_token_count': 12401, 'cached_content_token_count': 9259, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12236}], 'cache_tokens_details': [{'modality': 1, 'token_count': 9259}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 96}], 'thoughts_token_count': 69}, 'finish_reason': 'STOP', 'avg_logprobs': -0.13755695025126138, 'model_name': 'gemini-2.5-pro'} id='run--a0efdee6-93ea-4981-8550-b061d788b93f-0' tool_calls=[{'name': 'find_ast_node_with_type_in_file_with_relative_path', 'args': {'type': 'class_definition', 'relative_path': 'tests/expressions/tests.py'}, 'id': '35794721-d5e5-4604-b094-ec7166f0c20a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12236, 'output_tokens': 96, 'total_tokens': 12401, 'input_token_details': {'cache_read': 9259}, 'output_token_details': {'reasoning': 69}}
2025-12-22 23:52:02,848 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have located the `ExpressionWrapperTests` class and will now examine its contents to find the `deconstruct` method. This will reveal the specific implementation of the deconstruction test for `ExpressionWrapper` instances.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "deconstruct", "relative_path": "tests/expressions/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 13928, 'candidates_token_count': 75, 'total_token_count': 14067, 'cached_content_token_count': 11110, 'prompt_tokens_details': [{'modality': 1, 'token_count': 13928}], 'cache_tokens_details': [{'modality': 1, 'token_count': 11110}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 75}], 'thoughts_token_count': 64}, 'finish_reason': 'STOP', 'avg_logprobs': -0.21825698852539063, 'model_name': 'gemini-2.5-pro'} id='run--7b25bb74-5c39-46fe-bc0e-df558ef9c9e1-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'deconstruct', 'relative_path': 'tests/expressions/tests.py'}, 'id': '1bba3b34-551a-44f9-82b7-0c0411481e36', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13928, 'output_tokens': 75, 'total_tokens': 14067, 'input_token_details': {'cache_read': 11110}, 'output_token_details': {'reasoning': 64}}
2025-12-22 23:52:07,166 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content="I have already found the deconstruction tests for `F` and `Value` expressions, and I've also located the `ExpressionWrapperTests` class. To ensure a comprehensive understanding of expression deconstruction, I will now check for deconstruction tests related to other relevant expression classes, such as `CombinedExpression` and `RawSQL`, within the same test file." additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "deconstruct", "relative_path": "tests/expressions/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16146, 'candidates_token_count': 106, 'total_token_count': 16526, 'cached_content_token_count': 13026, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16146}], 'cache_tokens_details': [{'modality': 1, 'token_count': 13026}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 106}], 'thoughts_token_count': 274}, 'finish_reason': 'STOP', 'avg_logprobs': -0.4520971550131744, 'model_name': 'gemini-2.5-pro'} id='run--cbc3e676-4f92-4a7b-8e53-2190be54e221-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'deconstruct', 'relative_path': 'tests/expressions/tests.py'}, 'id': '39efc7f8-0bac-4999-a216-0bf1e0ddc9ee', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16146, 'output_tokens': 106, 'total_tokens': 16526, 'input_token_details': {'cache_read': 13026}, 'output_token_details': {'reasoning': 274}}
2025-12-22 23:52:13,310 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have already examined the deconstruction tests for `F` and `Value` expressions. My previous searches also located the `ExpressionWrapperTests` class, but it did not contain a `deconstruct` test. To find the deconstruction test for `ExpressionWrapper`, I will now search for text "ExpressionWrapper" and "deconstruct" in the file `tests/expressions/tests.py`.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"text": "deconstruct", "relative_path": "tests/expressions/tests.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 18395, 'candidates_token_count': 145, 'total_token_count': 18998, 'cached_content_token_count': 14945, 'prompt_tokens_details': [{'modality': 1, 'token_count': 18395}], 'cache_tokens_details': [{'modality': 1, 'token_count': 14945}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 145}], 'thoughts_token_count': 458}, 'finish_reason': 'STOP', 'avg_logprobs': -0.3109776200919316, 'model_name': 'gemini-2.5-pro'} id='run--79b3b715-513d-4388-90cd-60d4e54c2db7-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'ExpressionWrapper', 'relative_path': 'tests/expressions/tests.py'}, 'id': '5c585626-b484-404c-8199-65aa3b8ebd15', 'type': 'tool_call'}, {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'deconstruct', 'relative_path': 'tests/expressions/tests.py'}, 'id': '153d1dcb-980a-42c6-8363-76e53dede966', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18395, 'output_tokens': 145, 'total_tokens': 18998, 'input_token_details': {'cache_read': 14945}, 'output_token_details': {'reasoning': 458}}
2025-12-22 23:52:19,601 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have thoroughly examined the `tests/expressions/tests.py` file to find test cases related to the deconstruction of database expression classes. I located specific deconstruction tests for `F` and `Value` objects within the `FTests` and `ValueTests` classes, respectively. While I found several uses of `ExpressionWrapper` in other test classes such as `ExpressionWrapperTests` and `ReprTests`, there is no explicit deconstruction test for `ExpressionWrapper` itself in this file.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 28813, 'candidates_token_count': 102, 'total_token_count': 29337, 'cached_content_token_count': 17026, 'prompt_tokens_details': [{'modality': 1, 'token_count': 28813}], 'cache_tokens_details': [{'modality': 1, 'token_count': 17026}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 102}], 'thoughts_token_count': 422}, 'finish_reason': 'STOP', 'avg_logprobs': -0.775759079877068, 'model_name': 'gemini-2.5-pro'} id='run--afeb7304-da9d-4db6-8419-fa7b7c24e67b-0' usage_metadata={'input_tokens': 28813, 'output_tokens': 102, 'total_tokens': 29337, 'input_token_details': {'cache_read': 17026}, 'output_token_details': {'reasoning': 422}}
2025-12-22 23:52:19,605 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of tests/expressions/tests.py.
--- END QUERY ---



--- BEGIN PURPOSE ---
I need this file to find test cases that verify the deconstruction of database expression classes, which is the core of the user's issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/expressions/tests.py
Line number range: 1 - 500
Content:
1. import datetime
2. import pickle
3. import unittest
4. import uuid
5. from collections import namedtuple
6. from copy import deepcopy
7. from decimal import Decimal
8. from unittest import mock
9. 
10. from django.core.exceptions import FieldError
11. from django.db import DatabaseError, NotSupportedError, connection
12. from django.db.models import (
13.     AutoField, Avg, BinaryField, BooleanField, Case, CharField, Count,
14.     DateField, DateTimeField, DecimalField, DurationField, Exists, Expression,
15.     ExpressionList, ExpressionWrapper, F, FloatField, Func, IntegerField, Max,
16.     Min, Model, OrderBy, OuterRef, Q, StdDev, Subquery, Sum, TimeField,
17.     UUIDField, Value, Variance, When,
18. )
19. from django.db.models.expressions import (
20.     Col, Combinable, CombinedExpression, RawSQL, Ref,
21. )
22. from django.db.models.functions import (
23.     Coalesce, Concat, Left, Length, Lower, Substr, Upper,
24. )
25. from django.db.models.sql import constants
26. from django.db.models.sql.datastructures import Join
27. from django.test import SimpleTestCase, TestCase, skipUnlessDBFeature
28. from django.test.utils import (
29.     Approximate, CaptureQueriesContext, isolate_apps, register_lookup,
30. )
31. from django.utils.functional import SimpleLazyObject
32. 
33. from .models import (
34.     UUID, UUIDPK, Company, Employee, Experiment, Manager, Number,
35.     RemoteEmployee, Result, SimulationRun, Time,
36. )
37. 
38. 
39. class BasicExpressionsTests(TestCase):
40.     @classmethod
41.     def setUpTestData(cls):
42.         cls.example_inc = Company.objects.create(
43.             name="Example Inc.", num_employees=2300, num_chairs=5,
44.             ceo=Employee.objects.create(firstname="Joe", lastname="Smith", salary=10)
45.         )
46.         cls.foobar_ltd = Company.objects.create(
47.             name="Foobar Ltd.", num_employees=3, num_chairs=4, based_in_eu=True,
48.             ceo=Employee.objects.create(firstname="Frank", lastname="Meyer", salary=20)
49.         )
50.         cls.max = Employee.objects.create(firstname='Max', lastname='Mustermann', salary=30)
51.         cls.gmbh = Company.objects.create(name='Test GmbH', num_employees=32, num_chairs=1, ceo=cls.max)
52. 
53.     def setUp(self):
54.         self.company_query = Company.objects.values(
55.             "name", "num_employees", "num_chairs"
56.         ).order_by(
57.             "name", "num_employees", "num_chairs"
58.         )
59. 
60.     def test_annotate_values_aggregate(self):
61.         companies = Company.objects.annotate(
62.             salaries=F('ceo__salary'),
63.         ).values('num_employees', 'salaries').aggregate(
64.             result=Sum(
65.                 F('salaries') + F('num_employees'),
66.                 output_field=IntegerField()
67.             ),
68.         )
69.         self.assertEqual(companies['result'], 2395)
70. 
71.     def test_annotate_values_filter(self):
72.         companies = Company.objects.annotate(
73.             foo=RawSQL('%s', ['value']),
74.         ).filter(foo='value').order_by('name')
75.         self.assertSequenceEqual(
76.             companies,
77.             [self.example_inc, self.foobar_ltd, self.gmbh],
78.         )
79. 
80.     def test_annotate_values_count(self):
81.         companies = Company.objects.annotate(foo=RawSQL('%s', ['value']))
82.         self.assertEqual(companies.count(), 3)
83. 
84.     @skipUnlessDBFeature('supports_boolean_expr_in_select_clause')
85.     def test_filtering_on_annotate_that_uses_q(self):
86.         self.assertEqual(
87.             Company.objects.annotate(
88.                 num_employees_check=ExpressionWrapper(Q(num_employees__gt=3), output_field=BooleanField())
89.             ).filter(num_employees_check=True).count(),
90.             2,
91.         )
92. 
93.     def test_filtering_on_q_that_is_boolean(self):
94.         self.assertEqual(
95.             Company.objects.filter(
96.                 ExpressionWrapper(Q(num_employees__gt=3), output_field=BooleanField())
97.             ).count(),
98.             2,
99.         )
100. 
101.     def test_filtering_on_rawsql_that_is_boolean(self):
102.         self.assertEqual(
103.             Company.objects.filter(
104.                 RawSQL('num_employees > %s', (3,), output_field=BooleanField()),
105.             ).count(),
106.             2,
107.         )
108. 
109.     def test_filter_inter_attribute(self):
110.         # We can filter on attribute relationships on same model obj, e.g.
111.         # find companies where the number of employees is greater
112.         # than the number of chairs.
113.         self.assertSequenceEqual(
114.             self.company_query.filter(num_employees__gt=F("num_chairs")), [
115.                 {
116.                     "num_chairs": 5,
117.                     "name": "Example Inc.",
118.                     "num_employees": 2300,
119.                 },
120.                 {
121.                     "num_chairs": 1,
122.                     "name": "Test GmbH",
123.                     "num_employees": 32
124.                 },
125.             ],
126.         )
127. 
128.     def test_update(self):
129.         # We can set one field to have the value of another field
130.         # Make sure we have enough chairs
131.         self.company_query.update(num_chairs=F("num_employees"))
132.         self.assertSequenceEqual(
133.             self.company_query, [
134.                 {
135.                     "num_chairs": 2300,
136.                     "name": "Example Inc.",
137.                     "num_employees": 2300
138.                 },
139.                 {
140.                     "num_chairs": 3,
141.                     "name": "Foobar Ltd.",
142.                     "num_employees": 3
143.                 },
144.                 {
145.                     "num_chairs": 32,
146.                     "name": "Test GmbH",
147.                     "num_employees": 32
148.                 }
149.             ],
150.         )
151. 
152.     def test_arithmetic(self):
153.         # We can perform arithmetic operations in expressions
154.         # Make sure we have 2 spare chairs
155.         self.company_query.update(num_chairs=F("num_employees") + 2)
156.         self.assertSequenceEqual(
157.             self.company_query, [
158.                 {
159.                     'num_chairs': 2302,
160.                     'name': 'Example Inc.',
161.                     'num_employees': 2300
162.                 },
163.                 {
164.                     'num_chairs': 5,
165.                     'name': 'Foobar Ltd.',
166.                     'num_employees': 3
167.                 },
168.                 {
169.                     'num_chairs': 34,
170.                     'name': 'Test GmbH',
171.                     'num_employees': 32
172.                 }
173.             ],
174.         )
175. 
176.     def test_order_of_operations(self):
177.         # Law of order of operations is followed
178.         self.company_query.update(num_chairs=F('num_employees') + 2 * F('num_employees'))
179.         self.assertSequenceEqual(
180.             self.company_query, [
181.                 {
182.                     'num_chairs': 6900,
183.                     'name': 'Example Inc.',
184.                     'num_employees': 2300
185.                 },
186.                 {
187.                     'num_chairs': 9,
188.                     'name': 'Foobar Ltd.',
189.                     'num_employees': 3
190.                 },
191.                 {
192.                     'num_chairs': 96,
193.                     'name': 'Test GmbH',
194.                     'num_employees': 32
195.                 }
196.             ],
197.         )
198. 
199.     def test_parenthesis_priority(self):
200.         # Law of order of operations can be overridden by parentheses
201.         self.company_query.update(num_chairs=(F('num_employees') + 2) * F('num_employees'))
202.         self.assertSequenceEqual(
203.             self.company_query, [
204.                 {
205.                     'num_chairs': 5294600,
206.                     'name': 'Example Inc.',
207.                     'num_employees': 2300
208.                 },
209.                 {
210.                     'num_chairs': 15,
211.                     'name': 'Foobar Ltd.',
212.                     'num_employees': 3
213.                 },
214.                 {
215.                     'num_chairs': 1088,
216.                     'name': 'Test GmbH',
217.                     'num_employees': 32
218.                 }
219.             ],
220.         )
221. 
222.     def test_update_with_fk(self):
223.         # ForeignKey can become updated with the value of another ForeignKey.
224.         self.assertEqual(Company.objects.update(point_of_contact=F('ceo')), 3)
225.         self.assertQuerysetEqual(
226.             Company.objects.all(),
227.             ['Joe Smith', 'Frank Meyer', 'Max Mustermann'],
228.             lambda c: str(c.point_of_contact),
229.             ordered=False
230.         )
231. 
232.     def test_update_with_none(self):
233.         Number.objects.create(integer=1, float=1.0)
234.         Number.objects.create(integer=2)
235.         Number.objects.filter(float__isnull=False).update(float=Value(None))
236.         self.assertQuerysetEqual(
237.             Number.objects.all(),
238.             [None, None],
239.             lambda n: n.float,
240.             ordered=False
241.         )
242. 
243.     def test_filter_with_join(self):
244.         # F Expressions can also span joins
245.         Company.objects.update(point_of_contact=F('ceo'))
246.         c = Company.objects.first()
247.         c.point_of_contact = Employee.objects.create(firstname="Guido", lastname="van Rossum")
248.         c.save()
249. 
250.         self.assertQuerysetEqual(
251.             Company.objects.filter(ceo__firstname=F('point_of_contact__firstname')),
252.             ['Foobar Ltd.', 'Test GmbH'],
253.             lambda c: c.name,
254.             ordered=False
255.         )
256. 
257.         Company.objects.exclude(
258.             ceo__firstname=F("point_of_contact__firstname")
259.         ).update(name="foo")
260.         self.assertEqual(
261.             Company.objects.exclude(
262.                 ceo__firstname=F('point_of_contact__firstname')
263.             ).get().name,
264.             "foo",
265.         )
266. 
267.         msg = "Joined field references are not permitted in this query"
268.         with self.assertRaisesMessage(FieldError, msg):
269.             Company.objects.exclude(
270.                 ceo__firstname=F('point_of_contact__firstname')
271.             ).update(name=F('point_of_contact__lastname'))
272. 
273.     def test_object_update(self):
274.         # F expressions can be used to update attributes on single objects
275.         self.gmbh.num_employees = F('num_employees') + 4
276.         self.gmbh.save()
277.         self.gmbh.refresh_from_db()
278.         self.assertEqual(self.gmbh.num_employees, 36)
279. 
280.     def test_new_object_save(self):
281.         # We should be able to use Funcs when inserting new data
282.         test_co = Company(name=Lower(Value('UPPER')), num_employees=32, num_chairs=1, ceo=self.max)
283.         test_co.save()
284.         test_co.refresh_from_db()
285.         self.assertEqual(test_co.name, "upper")
286. 
287.     def test_new_object_create(self):
288.         test_co = Company.objects.create(name=Lower(Value('UPPER')), num_employees=32, num_chairs=1, ceo=self.max)
289.         test_co.refresh_from_db()
290.         self.assertEqual(test_co.name, "upper")
291. 
292.     def test_object_create_with_aggregate(self):
293.         # Aggregates are not allowed when inserting new data
294.         msg = 'Aggregate functions are not allowed in this query (num_employees=Max(Value(1))).'
295.         with self.assertRaisesMessage(FieldError, msg):
296.             Company.objects.create(
297.                 name='Company', num_employees=Max(Value(1)), num_chairs=1,
298.                 ceo=Employee.objects.create(firstname="Just", lastname="Doit", salary=30),
299.             )
300. 
301.     def test_object_update_fk(self):
302.         # F expressions cannot be used to update attributes which are foreign
303.         # keys, or attributes which involve joins.
304.         test_gmbh = Company.objects.get(pk=self.gmbh.pk)
305.         msg = 'F(ceo)": "Company.point_of_contact" must be a "Employee" instance.'
306.         with self.assertRaisesMessage(ValueError, msg):
307.             test_gmbh.point_of_contact = F('ceo')
308. 
309.         test_gmbh.point_of_contact = self.gmbh.ceo
310.         test_gmbh.save()
311.         test_gmbh.name = F('ceo__lastname')
312.         msg = 'Joined field references are not permitted in this query'
313.         with self.assertRaisesMessage(FieldError, msg):
314.             test_gmbh.save()
315. 
316.     def test_update_inherited_field_value(self):
317.         msg = 'Joined field references are not permitted in this query'
318.         with self.assertRaisesMessage(FieldError, msg):
319.             RemoteEmployee.objects.update(adjusted_salary=F('salary') * 5)
320. 
321.     def test_object_update_unsaved_objects(self):
322.         # F expressions cannot be used to update attributes on objects which do
323.         # not yet exist in the database
324.         acme = Company(name='The Acme Widget Co.', num_employees=12, num_chairs=5, ceo=self.max)
325.         acme.num_employees = F("num_employees") + 16
326.         msg = (
327.             'Failed to insert expression "Col(expressions_company, '
328.             'expressions.Company.num_employees) + Value(16)" on '
329.             'expressions.Company.num_employees. F() expressions can only be '
330.             'used to update, not to insert.'
331.         )
332.         with self.assertRaisesMessage(ValueError, msg):
333.             acme.save()
334. 
335.         acme.num_employees = 12
336.         acme.name = Lower(F('name'))
337.         msg = (
338.             'Failed to insert expression "Lower(Col(expressions_company, '
339.             'expressions.Company.name))" on expressions.Company.name. F() '
340.             'expressions can only be used to update, not to insert.'
341.         )
342.         with self.assertRaisesMessage(ValueError, msg):
343.             acme.save()
344. 
345.     def test_ticket_11722_iexact_lookup(self):
346.         Employee.objects.create(firstname="John", lastname="Doe")
347.         test = Employee.objects.create(firstname="Test", lastname="test")
348. 
349.         queryset = Employee.objects.filter(firstname__iexact=F('lastname'))
350.         self.assertSequenceEqual(queryset, [test])
351. 
352.     def test_ticket_16731_startswith_lookup(self):
353.         Employee.objects.create(firstname="John", lastname="Doe")
354.         e2 = Employee.objects.create(firstname="Jack", lastname="Jackson")
355.         e3 = Employee.objects.create(firstname="Jack", lastname="jackson")
356.         self.assertSequenceEqual(
357.             Employee.objects.filter(lastname__startswith=F('firstname')),
358.             [e2, e3] if connection.features.has_case_insensitive_like else [e2]
359.         )
360.         qs = Employee.objects.filter(lastname__istartswith=F('firstname')).order_by('pk')
361.         self.assertSequenceEqual(qs, [e2, e3])
362. 
363.     def test_ticket_18375_join_reuse(self):
364.         # Reverse multijoin F() references and the lookup target the same join.
365.         # Pre #18375 the F() join was generated first and the lookup couldn't
366.         # reuse that join.
367.         qs = Employee.objects.filter(company_ceo_set__num_chairs=F('company_ceo_set__num_employees'))
368.         self.assertEqual(str(qs.query).count('JOIN'), 1)
369. 
370.     def test_ticket_18375_kwarg_ordering(self):
371.         # The next query was dict-randomization dependent - if the "gte=1"
372.         # was seen first, then the F() will reuse the join generated by the
373.         # gte lookup, if F() was seen first, then it generated a join the
374.         # other lookups could not reuse.
375.         qs = Employee.objects.filter(
376.             company_ceo_set__num_chairs=F('company_ceo_set__num_employees'),
377.             company_ceo_set__num_chairs__gte=1,
378.         )
379.         self.assertEqual(str(qs.query).count('JOIN'), 1)
380. 
381.     def test_ticket_18375_kwarg_ordering_2(self):
382.         # Another similar case for F() than above. Now we have the same join
383.         # in two filter kwargs, one in the lhs lookup, one in F. Here pre
384.         # #18375 the amount of joins generated was random if dict
385.         # randomization was enabled, that is the generated query dependent
386.         # on which clause was seen first.
387.         qs = Employee.objects.filter(
388.             company_ceo_set__num_employees=F('pk'),
389.             pk=F('company_ceo_set__num_employees')
390.         )
391.         self.assertEqual(str(qs.query).count('JOIN'), 1)
392. 
393.     def test_ticket_18375_chained_filters(self):
394.         # F() expressions do not reuse joins from previous filter.
395.         qs = Employee.objects.filter(
396.             company_ceo_set__num_employees=F('pk')
397.         ).filter(
398.             company_ceo_set__num_employees=F('company_ceo_set__num_employees')
399.         )
400.         self.assertEqual(str(qs.query).count('JOIN'), 2)
401. 
402.     def test_order_by_exists(self):
403.         mary = Employee.objects.create(firstname='Mary', lastname='Mustermann', salary=20)
404.         mustermanns_by_seniority = Employee.objects.filter(lastname='Mustermann').order_by(
405.             # Order by whether the employee is the CEO of a company
406.             Exists(Company.objects.filter(ceo=OuterRef('pk'))).desc()
407.         )
408.         self.assertSequenceEqual(mustermanns_by_seniority, [self.max, mary])
409. 
410.     def test_order_by_multiline_sql(self):
411.         raw_order_by = (
412.             RawSQL('''
413.                 CASE WHEN num_employees > 1000
414.                      THEN num_chairs
415.                      ELSE 0 END
416.             ''', []).desc(),
417.             RawSQL('''
418.                 CASE WHEN num_chairs > 1
419.                      THEN 1
420.                      ELSE 0 END
421.             ''', []).asc()
422.         )
423.         for qs in (
424.             Company.objects.all(),
425.             Company.objects.distinct(),
426.         ):
427.             with self.subTest(qs=qs):
428.                 self.assertSequenceEqual(
429.                     qs.order_by(*raw_order_by),
430.                     [self.example_inc, self.gmbh, self.foobar_ltd],
431.                 )
432. 
433.     def test_outerref(self):
434.         inner = Company.objects.filter(point_of_contact=OuterRef('pk'))
435.         msg = (
436.             'This queryset contains a reference to an outer query and may only '
437.             'be used in a subquery.'
438.         )
439.         with self.assertRaisesMessage(ValueError, msg):
440.             inner.exists()
441. 
442.         outer = Employee.objects.annotate(is_point_of_contact=Exists(inner))
443.         self.assertIs(outer.exists(), True)
444. 
445.     def test_exist_single_field_output_field(self):
446.         queryset = Company.objects.values('pk')
447.         self.assertIsInstance(Exists(queryset).output_field, BooleanField)
448. 
449.     def test_subquery(self):
450.         Company.objects.filter(name='Example Inc.').update(
451.             point_of_contact=Employee.objects.get(firstname='Joe', lastname='Smith'),
452.             ceo=self.max,
453.         )
454.         Employee.objects.create(firstname='Bob', lastname='Brown', salary=40)
455.         qs = Employee.objects.annotate(
456.             is_point_of_contact=Exists(Company.objects.filter(point_of_contact=OuterRef('pk'))),
457.             is_not_point_of_contact=~Exists(Company.objects.filter(point_of_contact=OuterRef('pk'))),
458.             is_ceo_of_small_company=Exists(Company.objects.filter(num_employees__lt=200, ceo=OuterRef('pk'))),
459.             is_ceo_small_2=~~Exists(Company.objects.filter(num_employees__lt=200, ceo=OuterRef('pk'))),
460.             largest_company=Subquery(Company.objects.order_by('-num_employees').filter(
461.                 Q(ceo=OuterRef('pk')) | Q(point_of_contact=OuterRef('pk'))
462.             ).values('name')[:1], output_field=CharField())
463.         ).values(
464.             'firstname',
465.             'is_point_of_contact',
466.             'is_not_point_of_contact',
467.             'is_ceo_of_small_company',
468.             'is_ceo_small_2',
469.             'largest_company',
470.         ).order_by('firstname')
471. 
472.         results = list(qs)
473.         # Could use Coalesce(subq, Value('')) instead except for the bug in
474.         # cx_Oracle mentioned in #23843.
475.         bob = results[0]
476.         if bob['largest_company'] == '' and connection.features.interprets_empty_strings_as_nulls:
477.             bob['largest_company'] = None
478. 
479.         self.assertEqual(results, [
480.             {
481.                 'firstname': 'Bob',
482.                 'is_point_of_contact': False,
483.                 'is_not_point_of_contact': True,
484.                 'is_ceo_of_small_company': False,
485.                 'is_ceo_small_2': False,
486.                 'largest_company': None,
487.             },
488.             {
489.                 'firstname': 'Frank',
490.                 'is_point_of_contact': False,
491.                 'is_not_point_of_contact': True,
492.                 'is_ceo_of_small_company': True,
493.                 'is_ceo_small_2': True,
494.                 'largest_company': 'Foobar Ltd.',
495.             },
496.             {
497.                 'firstname': 'Joe',
498.                 'is_point_of_contact': True,
499.                 'is_not_point_of_contact': False,
500.                 'is_ceo_of_small_company': False,


File: tests/expressions/tests.py
Line number range: 979 - 1009
Content:
class FTests(SimpleTestCase):

    def test_deepcopy(self):
        f = F("foo")
        g = deepcopy(f)
        self.assertEqual(f.name, g.name)

    def test_deconstruct(self):
        f = F('name')
        path, args, kwargs = f.deconstruct()
        self.assertEqual(path, 'django.db.models.F')
        self.assertEqual(args, (f.name,))
        self.assertEqual(kwargs, {})

    def test_equal(self):
        f = F('name')
        same_f = F('name')
        other_f = F('username')
        self.assertEqual(f, same_f)
        self.assertNotEqual(f, other_f)

    def test_hash(self):
        d = {F('name'): 'Bob'}
        self.assertIn(F('name'), d)
        self.assertEqual(d[F('name')], 'Bob')

    def test_not_equal_Value(self):
        f = F('name')
        value = Value('name')
        self.assertNotEqual(f, value)
        self.assertNotEqual(value, f)


File: tests/expressions/tests.py
Line number range: 1135 - 1204
Content:
class ExpressionsNumericTests(TestCase):

    @classmethod
    def setUpTestData(cls):
        Number(integer=-1).save()
        Number(integer=42).save()
        Number(integer=1337).save()
        Number.objects.update(float=F('integer'))

    def test_fill_with_value_from_same_object(self):
        """
        We can fill a value in all objects with an other value of the
        same object.
        """
        self.assertQuerysetEqual(
            Number.objects.all(),
            [(-1, -1), (42, 42), (1337, 1337)],
            lambda n: (n.integer, round(n.float)),
            ordered=False
        )

    def test_increment_value(self):
        """
        We can increment a value of all objects in a query set.
        """
        self.assertEqual(Number.objects.filter(integer__gt=0).update(integer=F('integer') + 1), 2)
        self.assertQuerysetEqual(
            Number.objects.all(),
            [(-1, -1), (43, 42), (1338, 1337)],
            lambda n: (n.integer, round(n.float)),
            ordered=False
        )

    def test_filter_not_equals_other_field(self):
        """
        We can filter for objects, where a value is not equals the value
        of an other field.
        """
        self.assertEqual(Number.objects.filter(integer__gt=0).update(integer=F('integer') + 1), 2)
        self.assertQuerysetEqual(
            Number.objects.exclude(float=F('integer')),
            [(43, 42), (1338, 1337)],
            lambda n: (n.integer, round(n.float)),
            ordered=False
        )

    def test_filter_decimal_expression(self):
        obj = Number.objects.create(integer=0, float=1, decimal_value=Decimal('1'))
        qs = Number.objects.annotate(
            x=ExpressionWrapper(Value(1), output_field=DecimalField()),
        ).filter(Q(x=1, integer=0) & Q(x=Decimal('1')))
        self.assertSequenceEqual(qs, [obj])

    def test_complex_expressions(self):
        """
        Complex expressions of different connection types are possible.
        """
        n = Number.objects.create(integer=10, float=123.45)
        self.assertEqual(Number.objects.filter(pk=n.pk).update(
            float=F('integer') + F('float') * 2), 1)

        self.assertEqual(Number.objects.get(pk=n.pk).integer, 10)
        self.assertEqual(Number.objects.get(pk=n.pk).float, Approximate(256.900, places=3))

    def test_decimal_expression(self):
        n = Number.objects.create(integer=1, decimal_value=Decimal('0.5'))
        n.decimal_value = F('decimal_value') - Decimal('0.4')
        n.save()
        n.refresh_from_db()
        self.assertEqual(n.decimal_value, Decimal('0.1'))


File: tests/expressions/tests.py
Line number range: 1357 - 1749
Content:
class FTimeDeltaTests(TestCase):

    @classmethod
    def setUpTestData(cls):
        cls.sday = sday = datetime.date(2010, 6, 25)
        cls.stime = stime = datetime.datetime(2010, 6, 25, 12, 15, 30, 747000)
        midnight = datetime.time(0)

        delta0 = datetime.timedelta(0)
        delta1 = datetime.timedelta(microseconds=253000)
        delta2 = datetime.timedelta(seconds=44)
        delta3 = datetime.timedelta(hours=21, minutes=8)
        delta4 = datetime.timedelta(days=10)
        delta5 = datetime.timedelta(days=90)

        # Test data is set so that deltas and delays will be
        # strictly increasing.
        cls.deltas = []
        cls.delays = []
        cls.days_long = []

        # e0: started same day as assigned, zero duration
        end = stime + delta0
        cls.e0 = Experiment.objects.create(
            name='e0', assigned=sday, start=stime, end=end,
            completed=end.date(), estimated_time=delta0,
        )
        cls.deltas.append(delta0)
        cls.delays.append(cls.e0.start - datetime.datetime.combine(cls.e0.assigned, midnight))
        cls.days_long.append(cls.e0.completed - cls.e0.assigned)

        # e1: started one day after assigned, tiny duration, data
        # set so that end time has no fractional seconds, which
        # tests an edge case on sqlite.
        delay = datetime.timedelta(1)
        end = stime + delay + delta1
        e1 = Experiment.objects.create(
            name='e1', assigned=sday, start=stime + delay, end=end,
            completed=end.date(), estimated_time=delta1,
        )
        cls.deltas.append(delta1)
        cls.delays.append(e1.start - datetime.datetime.combine(e1.assigned, midnight))
        cls.days_long.append(e1.completed - e1.assigned)

        # e2: started three days after assigned, small duration
        end = stime + delta2
        e2 = Experiment.objects.create(
            name='e2', assigned=sday - datetime.timedelta(3), start=stime,
            end=end, completed=end.date(), estimated_time=datetime.timedelta(hours=1),
        )
        cls.deltas.append(delta2)
        cls.delays.append(e2.start - datetime.datetime.combine(e2.assigned, midnight))
        cls.days_long.append(e2.completed - e2.assigned)

        # e3: started four days after assigned, medium duration
        delay = datetime.timedelta(4)
        end = stime + delay + delta3
        e3 = Experiment.objects.create(
            name='e3', assigned=sday, start=stime + delay, end=end,
            completed=end.date(), estimated_time=delta3,
        )
        cls.deltas.append(delta3)
        cls.delays.append(e3.start - datetime.datetime.combine(e3.assigned, midnight))
        cls.days_long.append(e3.completed - e3.assigned)

        # e4: started 10 days after assignment, long duration
        end = stime + delta4
        e4 = Experiment.objects.create(
            name='e4', assigned=sday - datetime.timedelta(10), start=stime,
            end=end, completed=end.date(), estimated_time=delta4 - datetime.timedelta(1),
        )
        cls.deltas.append(delta4)
        cls.delays.append(e4.start - datetime.datetime.combine(e4.assigned, midnight))
        cls.days_long.append(e4.completed - e4.assigned)

        # e5: started a month after assignment, very long duration
        delay = datetime.timedelta(30)
        end = stime + delay + delta5
        e5 = Experiment.objects.create(
            name='e5', assigned=sday, start=stime + delay, end=end,
            completed=end.date(), estimated_time=delta5,
        )
        cls.deltas.append(delta5)
        cls.delays.append(e5.start - datetime.datetime.combine(e5.assigned, midnight))
        cls.days_long.append(e5.completed - e5.assigned)

        cls.expnames = [e.name for e in Experiment.objects.all()]

    def test_multiple_query_compilation(self):
        # Ticket #21643
        queryset = Experiment.objects.filter(end__lt=F('start') + datetime.timedelta(hours=1))
        q1 = str(queryset.query)
        q2 = str(queryset.query)
        self.assertEqual(q1, q2)

    def test_query_clone(self):
        # Ticket #21643 - Crash when compiling query more than once
        qs = Experiment.objects.filter(end__lt=F('start') + datetime.timedelta(hours=1))
        qs2 = qs.all()
        list(qs)
        list(qs2)
        # Intentionally no assert

    def test_delta_add(self):
        for i, delta in enumerate(self.deltas):
            test_set = [e.name for e in Experiment.objects.filter(end__lt=F('start') + delta)]
            self.assertEqual(test_set, self.expnames[:i])

            test_set = [e.name for e in Experiment.objects.filter(end__lt=delta + F('start'))]
            self.assertEqual(test_set, self.expnames[:i])

            test_set = [e.name for e in Experiment.objects.filter(end__lte=F('start') + delta)]
            self.assertEqual(test_set, self.expnames[:i + 1])

    def test_delta_subtract(self):
        for i, delta in enumerate(self.deltas):
            test_set = [e.name for e in Experiment.objects.filter(start__gt=F('end') - delta)]
            self.assertEqual(test_set, self.expnames[:i])

            test_set = [e.name for e in Experiment.objects.filter(start__gte=F('end') - delta)]
            self.assertEqual(test_set, self.expnames[:i + 1])

    def test_exclude(self):
        for i, delta in enumerate(self.deltas):
            test_set = [e.name for e in Experiment.objects.exclude(end__lt=F('start') + delta)]
            self.assertEqual(test_set, self.expnames[i:])

            test_set = [e.name for e in Experiment.objects.exclude(end__lte=F('start') + delta)]
            self.assertEqual(test_set, self.expnames[i + 1:])

    def test_date_comparison(self):
        for i, days in enumerate(self.days_long):
            test_set = [e.name for e in Experiment.objects.filter(completed__lt=F('assigned') + days)]
            self.assertEqual(test_set, self.expnames[:i])

            test_set = [e.name for e in Experiment.objects.filter(completed__lte=F('assigned') + days)]
            self.assertEqual(test_set, self.expnames[:i + 1])

    def test_mixed_comparisons1(self):
        for i, delay in enumerate(self.delays):
            test_set = [e.name for e in Experiment.objects.filter(assigned__gt=F('start') - delay)]
            self.assertEqual(test_set, self.expnames[:i])

            test_set = [e.name for e in Experiment.objects.filter(assigned__gte=F('start') - delay)]
            self.assertEqual(test_set, self.expnames[:i + 1])

    def test_mixed_comparisons2(self):
        for i, delay in enumerate(self.delays):
            delay = datetime.timedelta(delay.days)
            test_set = [e.name for e in Experiment.objects.filter(start__lt=F('assigned') + delay)]
            self.assertEqual(test_set, self.expnames[:i])

            test_set = [
                e.name for e in Experiment.objects.filter(start__lte=F('assigned') + delay + datetime.timedelta(1))
            ]
            self.assertEqual(test_set, self.expnames[:i + 1])

    def test_delta_update(self):
        for delta in self.deltas:
            exps = Experiment.objects.all()
            expected_durations = [e.duration() for e in exps]
            expected_starts = [e.start + delta for e in exps]
            expected_ends = [e.end + delta for e in exps]

            Experiment.objects.update(start=F('start') + delta, end=F('end') + delta)
            exps = Experiment.objects.all()
            new_starts = [e.start for e in exps]
            new_ends = [e.end for e in exps]
            new_durations = [e.duration() for e in exps]
            self.assertEqual(expected_starts, new_starts)
            self.assertEqual(expected_ends, new_ends)
            self.assertEqual(expected_durations, new_durations)

    def test_invalid_operator(self):
        with self.assertRaises(DatabaseError):
            list(Experiment.objects.filter(start=F('start') * datetime.timedelta(0)))

    def test_durationfield_add(self):
        zeros = [e.name for e in Experiment.objects.filter(start=F('start') + F('estimated_time'))]
        self.assertEqual(zeros, ['e0'])

        end_less = [e.name for e in Experiment.objects.filter(end__lt=F('start') + F('estimated_time'))]
        self.assertEqual(end_less, ['e2'])

        delta_math = [
            e.name for e in
            Experiment.objects.filter(end__gte=F('start') + F('estimated_time') + datetime.timedelta(hours=1))
        ]
        self.assertEqual(delta_math, ['e4'])

        queryset = Experiment.objects.annotate(shifted=ExpressionWrapper(
            F('start') + Value(None, output_field=DurationField()),
            output_field=DateTimeField(),
        ))
        self.assertIsNone(queryset.first().shifted)

    def test_durationfield_multiply_divide(self):
        Experiment.objects.update(scalar=2)
        tests = [
            (Decimal('2'), 2),
            (F('scalar'), 2),
            (2, 2),
            (3.2, 3.2),
        ]
        for expr, scalar in tests:
            with self.subTest(expr=expr):
                qs = Experiment.objects.annotate(
                    multiplied=ExpressionWrapper(
                        expr * F('estimated_time'),
                        output_field=DurationField(),
                    ),
                    divided=ExpressionWrapper(
                        F('estimated_time') / expr,
                        output_field=DurationField(),
                    ),
                )
                for experiment in qs:
                    self.assertEqual(
                        experiment.multiplied,
                        experiment.estimated_time * scalar,
                    )
                    self.assertEqual(
                        experiment.divided,
                        experiment.estimated_time / scalar,
                    )

    def test_duration_expressions(self):
        for delta in self.deltas:
            qs = Experiment.objects.annotate(duration=F('estimated_time') + delta)
            for obj in qs:
                self.assertEqual(obj.duration, obj.estimated_time + delta)

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_date_subtraction(self):
        queryset = Experiment.objects.annotate(
            completion_duration=F('completed') - F('assigned'),
        )

        at_least_5_days = {e.name for e in queryset.filter(completion_duration__gte=datetime.timedelta(days=5))}
        self.assertEqual(at_least_5_days, {'e3', 'e4', 'e5'})

        at_least_120_days = {e.name for e in queryset.filter(completion_duration__gte=datetime.timedelta(days=120))}
        self.assertEqual(at_least_120_days, {'e5'})

        less_than_5_days = {e.name for e in queryset.filter(completion_duration__lt=datetime.timedelta(days=5))}
        self.assertEqual(less_than_5_days, {'e0', 'e1', 'e2'})

        queryset = Experiment.objects.annotate(
            difference=F('completed') - Value(None, output_field=DateField()),
        )
        self.assertIsNone(queryset.first().difference)

        queryset = Experiment.objects.annotate(shifted=ExpressionWrapper(
            F('completed') - Value(None, output_field=DurationField()),
            output_field=DateField(),
        ))
        self.assertIsNone(queryset.first().shifted)

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_date_subquery_subtraction(self):
        subquery = Experiment.objects.filter(pk=OuterRef('pk')).values('completed')
        queryset = Experiment.objects.annotate(
            difference=subquery - F('completed'),
        ).filter(difference=datetime.timedelta())
        self.assertTrue(queryset.exists())

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_date_case_subtraction(self):
        queryset = Experiment.objects.annotate(
            date_case=Case(
                When(Q(name='e0'), then=F('completed')),
                output_field=DateField(),
            ),
            completed_value=Value(
                self.e0.completed,
                output_field=DateField(),
            ),
            difference=F('date_case') - F('completed_value'),
        ).filter(difference=datetime.timedelta())
        self.assertEqual(queryset.get(), self.e0)

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_time_subtraction(self):
        Time.objects.create(time=datetime.time(12, 30, 15, 2345))
        queryset = Time.objects.annotate(
            difference=F('time') - Value(datetime.time(11, 15, 0)),
        )
        self.assertEqual(
            queryset.get().difference,
            datetime.timedelta(hours=1, minutes=15, seconds=15, microseconds=2345)
        )

        queryset = Time.objects.annotate(
            difference=F('time') - Value(None, output_field=TimeField()),
        )
        self.assertIsNone(queryset.first().difference)

        queryset = Time.objects.annotate(shifted=ExpressionWrapper(
            F('time') - Value(None, output_field=DurationField()),
            output_field=TimeField(),
        ))
        self.assertIsNone(queryset.first().shifted)

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_time_subquery_subtraction(self):
        Time.objects.create(time=datetime.time(12, 30, 15, 2345))
        subquery = Time.objects.filter(pk=OuterRef('pk')).values('time')
        queryset = Time.objects.annotate(
            difference=subquery - F('time'),
        ).filter(difference=datetime.timedelta())
        self.assertTrue(queryset.exists())

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_datetime_subtraction(self):
        under_estimate = [
            e.name for e in Experiment.objects.filter(estimated_time__gt=F('end') - F('start'))
        ]
        self.assertEqual(under_estimate, ['e2'])

        over_estimate = [
            e.name for e in Experiment.objects.filter(estimated_time__lt=F('end') - F('start'))
        ]
        self.assertEqual(over_estimate, ['e4'])

        queryset = Experiment.objects.annotate(
            difference=F('start') - Value(None, output_field=DateTimeField()),
        )
        self.assertIsNone(queryset.first().difference)

        queryset = Experiment.objects.annotate(shifted=ExpressionWrapper(
            F('start') - Value(None, output_field=DurationField()),
            output_field=DateTimeField(),
        ))
        self.assertIsNone(queryset.first().shifted)

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_datetime_subquery_subtraction(self):
        subquery = Experiment.objects.filter(pk=OuterRef('pk')).values('start')
        queryset = Experiment.objects.annotate(
            difference=subquery - F('start'),
        ).filter(difference=datetime.timedelta())
        self.assertTrue(queryset.exists())

    @skipUnlessDBFeature('supports_temporal_subtraction')
    def test_datetime_subtraction_microseconds(self):
        delta = datetime.timedelta(microseconds=8999999999999999)
        Experiment.objects.update(end=F('start') + delta)
        qs = Experiment.objects.annotate(delta=F('end') - F('start'))
        for e in qs:
            self.assertEqual(e.delta, delta)

    def test_duration_with_datetime(self):
        # Exclude e1 which has very high precision so we can test this on all
        # backends regardless of whether or not it supports
        # microsecond_precision.
        over_estimate = Experiment.objects.exclude(name='e1').filter(
            completed__gt=self.stime + F('estimated_time'),
        ).order_by('name')
        self.assertQuerysetEqual(over_estimate, ['e3', 'e4', 'e5'], lambda e: e.name)

    def test_duration_with_datetime_microseconds(self):
        delta = datetime.timedelta(microseconds=8999999999999999)
        qs = Experiment.objects.annotate(dt=ExpressionWrapper(
            F('start') + delta,
            output_field=DateTimeField(),
        ))
        for e in qs:
            self.assertEqual(e.dt, e.start + delta)

    def test_date_minus_duration(self):
        more_than_4_days = Experiment.objects.filter(
            assigned__lt=F('completed') - Value(datetime.timedelta(days=4))
        )
        self.assertQuerysetEqual(more_than_4_days, ['e3', 'e4', 'e5'], lambda e: e.name)

    def test_negative_timedelta_update(self):
        # subtract 30 seconds, 30 minutes, 2 hours and 2 days
        experiments = Experiment.objects.filter(name='e0').annotate(
            start_sub_seconds=F('start') + datetime.timedelta(seconds=-30),
        ).annotate(
            start_sub_minutes=F('start_sub_seconds') + datetime.timedelta(minutes=-30),
        ).annotate(
            start_sub_hours=F('start_sub_minutes') + datetime.timedelta(hours=-2),
        ).annotate(
            new_start=F('start_sub_hours') + datetime.timedelta(days=-2),
        )
        expected_start = datetime.datetime(2010, 6, 23, 9, 45, 0)
        # subtract 30 microseconds
        experiments = experiments.annotate(new_start=F('new_start') + datetime.timedelta(microseconds=-30))
        expected_start += datetime.timedelta(microseconds=+746970)
        experiments.update(start=F('new_start'))
        e0 = Experiment.objects.get(name='e0')
        self.assertEqual(e0.start, expected_start)


File: tests/expressions/tests.py
Line number range: 1752 - 1877
Content:
class ValueTests(TestCase):
    def test_update_TimeField_using_Value(self):
        Time.objects.create()
        Time.objects.update(time=Value(datetime.time(1), output_field=TimeField()))
        self.assertEqual(Time.objects.get().time, datetime.time(1))

    def test_update_UUIDField_using_Value(self):
        UUID.objects.create()
        UUID.objects.update(uuid=Value(uuid.UUID('12345678901234567890123456789012'), output_field=UUIDField()))
        self.assertEqual(UUID.objects.get().uuid, uuid.UUID('12345678901234567890123456789012'))

    def test_deconstruct(self):
        value = Value('name')
        path, args, kwargs = value.deconstruct()
        self.assertEqual(path, 'django.db.models.expressions.Value')
        self.assertEqual(args, (value.value,))
        self.assertEqual(kwargs, {})

    def test_deconstruct_output_field(self):
        value = Value('name', output_field=CharField())
        path, args, kwargs = value.deconstruct()
        self.assertEqual(path, 'django.db.models.expressions.Value')
        self.assertEqual(args, (value.value,))
        self.assertEqual(len(kwargs), 1)
        self.assertEqual(kwargs['output_field'].deconstruct(), CharField().deconstruct())

    def test_repr(self):
        tests = [
            (None, 'Value(None)'),
            ('str', "Value('str')"),
            (True, 'Value(True)'),
            (42, 'Value(42)'),
            (
                datetime.datetime(2019, 5, 15),
                'Value(datetime.datetime(2019, 5, 15, 0, 0))',
            ),
            (Decimal('3.14'), "Value(Decimal('3.14'))"),
        ]
        for value, expected in tests:
            with self.subTest(value=value):
                self.assertEqual(repr(Value(value)), expected)

    def test_equal(self):
        value = Value('name')
        self.assertEqual(value, Value('name'))
        self.assertNotEqual(value, Value('username'))

    def test_hash(self):
        d = {Value('name'): 'Bob'}
        self.assertIn(Value('name'), d)
        self.assertEqual(d[Value('name')], 'Bob')

    def test_equal_output_field(self):
        value = Value('name', output_field=CharField())
        same_value = Value('name', output_field=CharField())
        other_value = Value('name', output_field=TimeField())
        no_output_field = Value('name')
        self.assertEqual(value, same_value)
        self.assertNotEqual(value, other_value)
        self.assertNotEqual(value, no_output_field)

    def test_raise_empty_expressionlist(self):
        msg = 'ExpressionList requires at least one expression'
        with self.assertRaisesMessage(ValueError, msg):
            ExpressionList()

    def test_compile_unresolved(self):
        # This test might need to be revisited later on if #25425 is enforced.
        compiler = Time.objects.all().query.get_compiler(connection=connection)
        value = Value('foo')
        self.assertEqual(value.as_sql(compiler, connection), ('%s', ['foo']))
        value = Value('foo', output_field=CharField())
        self.assertEqual(value.as_sql(compiler, connection), ('%s', ['foo']))

    def test_output_field_decimalfield(self):
        Time.objects.create()
        time = Time.objects.annotate(one=Value(1, output_field=DecimalField())).first()
        self.assertEqual(time.one, 1)

    def test_resolve_output_field(self):
        value_types = [
            ('str', CharField),
            (True, BooleanField),
            (42, IntegerField),
            (3.14, FloatField),
            (datetime.date(2019, 5, 15), DateField),
            (datetime.datetime(2019, 5, 15), DateTimeField),
            (datetime.time(3, 16), TimeField),
            (datetime.timedelta(1), DurationField),
            (Decimal('3.14'), DecimalField),
            (b'', BinaryField),
            (uuid.uuid4(), UUIDField),
        ]
        for value, output_field_type in value_types:
            with self.subTest(type=type(value)):
                expr = Value(value)
                self.assertIsInstance(expr.output_field, output_field_type)

    def test_resolve_output_field_failure(self):
        msg = 'Cannot resolve expression type, unknown output_field'
        with self.assertRaisesMessage(FieldError, msg):
            Value(object()).output_field

    def test_output_field_does_not_create_broken_validators(self):
        """
        The output field for a given Value doesn't get cleaned & validated,
        however validators may still be instantiated for a given field type
        and this demonstrates that they don't throw an exception.
        """
        value_types = [
            'str',
            True,
            42,
            3.14,
            datetime.date(2019, 5, 15),
            datetime.datetime(2019, 5, 15),
            datetime.time(3, 16),
            datetime.timedelta(1),
            Decimal('3.14'),
            b'',
            uuid.uuid4(),
        ]
        for value in value_types:
            with self.subTest(type=type(value)):
                field = Value(value)._resolve_output_field()
                field.clean(value, model_instance=None)


File: tests/expressions/tests.py
Line number range: 1880 - 1897
Content:
class ExistsTests(TestCase):
    def test_optimizations(self):
        with CaptureQueriesContext(connection) as context:
            list(Experiment.objects.values(exists=Exists(
                Experiment.objects.order_by('pk'),
            )).order_by())
        captured_queries = context.captured_queries
        self.assertEqual(len(captured_queries), 1)
        captured_sql = captured_queries[0]['sql']
        self.assertNotIn(
            connection.ops.quote_name(Experiment._meta.pk.column),
            captured_sql,
        )
        self.assertIn(
            connection.ops.limit_offset_sql(None, 1),
            captured_sql,
        )
        self.assertNotIn('ORDER BY', captured_sql)


File: tests/expressions/tests.py
Line number range: 1934 - 2002
Content:
class ReprTests(SimpleTestCase):

    def test_expressions(self):
        self.assertEqual(
            repr(Case(When(a=1))),
            "<Case: CASE WHEN <Q: (AND: ('a', 1))> THEN Value(None), ELSE Value(None)>"
        )
        self.assertEqual(
            repr(When(Q(age__gte=18), then=Value('legal'))),
            "<When: WHEN <Q: (AND: ('age__gte', 18))> THEN Value('legal')>"
        )
        self.assertEqual(repr(Col('alias', 'field')), "Col(alias, field)")
        self.assertEqual(repr(F('published')), "F(published)")
        self.assertEqual(repr(F('cost') + F('tax')), "<CombinedExpression: F(cost) + F(tax)>")
        self.assertEqual(
            repr(ExpressionWrapper(F('cost') + F('tax'), IntegerField())),
            "ExpressionWrapper(F(cost) + F(tax))"
        )
        self.assertEqual(repr(Func('published', function='TO_CHAR')), "Func(F(published), function=TO_CHAR)")
        self.assertEqual(repr(OrderBy(Value(1))), 'OrderBy(Value(1), descending=False)')
        self.assertEqual(repr(RawSQL('table.col', [])), "RawSQL(table.col, [])")
        self.assertEqual(repr(Ref('sum_cost', Sum('cost'))), "Ref(sum_cost, Sum(F(cost)))")
        self.assertEqual(repr(Value(1)), "Value(1)")
        self.assertEqual(
            repr(ExpressionList(F('col'), F('anothercol'))),
            'ExpressionList(F(col), F(anothercol))'
        )
        self.assertEqual(
            repr(ExpressionList(OrderBy(F('col'), descending=False))),
            'ExpressionList(OrderBy(F(col), descending=False))'
        )

    def test_functions(self):
        self.assertEqual(repr(Coalesce('a', 'b')), "Coalesce(F(a), F(b))")
        self.assertEqual(repr(Concat('a', 'b')), "Concat(ConcatPair(F(a), F(b)))")
        self.assertEqual(repr(Length('a')), "Length(F(a))")
        self.assertEqual(repr(Lower('a')), "Lower(F(a))")
        self.assertEqual(repr(Substr('a', 1, 3)), "Substr(F(a), Value(1), Value(3))")
        self.assertEqual(repr(Upper('a')), "Upper(F(a))")

    def test_aggregates(self):
        self.assertEqual(repr(Avg('a')), "Avg(F(a))")
        self.assertEqual(repr(Count('a')), "Count(F(a))")
        self.assertEqual(repr(Count('*')), "Count('*')")
        self.assertEqual(repr(Max('a')), "Max(F(a))")
        self.assertEqual(repr(Min('a')), "Min(F(a))")
        self.assertEqual(repr(StdDev('a')), "StdDev(F(a), sample=False)")
        self.assertEqual(repr(Sum('a')), "Sum(F(a))")
        self.assertEqual(repr(Variance('a', sample=True)), "Variance(F(a), sample=True)")

    def test_distinct_aggregates(self):
        self.assertEqual(repr(Count('a', distinct=True)), "Count(F(a), distinct=True)")
        self.assertEqual(repr(Count('*', distinct=True)), "Count('*', distinct=True)")

    def test_filtered_aggregates(self):
        filter = Q(a=1)
        self.assertEqual(repr(Avg('a', filter=filter)), "Avg(F(a), filter=(AND: ('a', 1)))")
        self.assertEqual(repr(Count('a', filter=filter)), "Count(F(a), filter=(AND: ('a', 1)))")
        self.assertEqual(repr(Max('a', filter=filter)), "Max(F(a), filter=(AND: ('a', 1)))")
        self.assertEqual(repr(Min('a', filter=filter)), "Min(F(a), filter=(AND: ('a', 1)))")
        self.assertEqual(repr(StdDev('a', filter=filter)), "StdDev(F(a), filter=(AND: ('a', 1)), sample=False)")
        self.assertEqual(repr(Sum('a', filter=filter)), "Sum(F(a), filter=(AND: ('a', 1)))")
        self.assertEqual(
            repr(Variance('a', sample=True, filter=filter)),
            "Variance(F(a), filter=(AND: ('a', 1)), sample=True)"
        )
        self.assertEqual(
            repr(Count('a', filter=filter, distinct=True)), "Count(F(a), distinct=True, filter=(AND: ('a', 1)))"
        )


File: tests/expressions/tests.py
Line number range: 2005 - 2026
Content:
class CombinableTests(SimpleTestCase):
    bitwise_msg = 'Use .bitand() and .bitor() for bitwise logical operations.'

    def test_negation(self):
        c = Combinable()
        self.assertEqual(-c, c * -1)

    def test_and(self):
        with self.assertRaisesMessage(NotImplementedError, self.bitwise_msg):
            Combinable() & Combinable()

    def test_or(self):
        with self.assertRaisesMessage(NotImplementedError, self.bitwise_msg):
            Combinable() | Combinable()

    def test_reversed_and(self):
        with self.assertRaisesMessage(NotImplementedError, self.bitwise_msg):
            object() & Combinable()

    def test_reversed_or(self):
        with self.assertRaisesMessage(NotImplementedError, self.bitwise_msg):
            object() | Combinable()


File: tests/expressions/tests.py
Line number range: 2051 - 2062
Content:
class ExpressionWrapperTests(SimpleTestCase):
    def test_empty_group_by(self):
        expr = ExpressionWrapper(Value(3), output_field=IntegerField())
        self.assertEqual(expr.get_group_by_cols(alias=None), [])

    def test_non_empty_group_by(self):
        value = Value('f')
        value.output_field = None
        expr = ExpressionWrapper(Lower(value), output_field=IntegerField())
        group_by_cols = expr.get_group_by_cols(alias=None)
        self.assertEqual(group_by_cols, [expr.expression])
        self.assertEqual(group_by_cols[0].output_field, expr.output_field)


File: tests/expressions/tests.py
Line number range: 2065 - 2084
Content:
class OrderByTests(SimpleTestCase):
    def test_equal(self):
        self.assertEqual(
            OrderBy(F('field'), nulls_last=True),
            OrderBy(F('field'), nulls_last=True),
        )
        self.assertNotEqual(
            OrderBy(F('field'), nulls_last=True),
            OrderBy(F('field'), nulls_last=False),
        )

    def test_hash(self):
        self.assertEqual(
            hash(OrderBy(F('field'), nulls_last=True)),
            hash(OrderBy(F('field'), nulls_last=True)),
        )
        self.assertNotEqual(
            hash(OrderBy(F('field'), nulls_last=True)),
            hash(OrderBy(F('field'), nulls_last=False)),
        )

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-22 23:52:31,968 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is the first part of that file.", relative_path='tests/expressions/tests.py', start_line=1, end_line=500), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=979, end_line=1009), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=1135, end_line=1204), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=1357, end_line=1749), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=1752, end_line=1877), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=1880, end_line=1897), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=1934, end_line=2002), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=2005, end_line=2026), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=2051, end_line=2062), ContextOutput(reasoning="The user requested the full content of the file 'tests/expressions/tests.py'. This context block is a part of that file.", relative_path='tests/expressions/tests.py', start_line=2065, end_line=2084)]
2025-12-22 23:52:31,975 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 10 contexts to memory for query: Please provide the full content of tests/expressions/tests.py.
2025-12-22 23:52:31,975 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-22 23:52:31,975 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-22 23:52:31,975 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 10 new contexts to 2 existing contexts
2025-12-22 23:52:31,976 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 12 total contexts (removed 0 duplicates)
2025-12-22 23:52:31,977 - thread-127860744382144.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-22 23:52:31,977 - thread-127860744382144.prometheus_context_collector - INFO - Successfully retrieved 12 context snippets
