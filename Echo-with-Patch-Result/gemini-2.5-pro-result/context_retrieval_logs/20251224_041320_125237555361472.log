2025-12-24 04:13:20,956 - thread-125237555361472.prometheus_context_collector - INFO - Starting context retrieval for query: 
Issue: Inherited classes not correctly documented when mocked

Description: ### Describe the bug

We're experiencing an issue when documenting classes that inherit mocked classes. However, classes which inherit other classes from our own package are ok.

This issue appears to be dependent on the `sphinx` version:

- `sphinx<3.0`: Everything is OK. 
- `sphinx>=3.0 < 3.4.2`: Classes that inherit mocked classes are not documented. (see [sphinx #8164](https://github.com/sphinx-doc/sphinx/issues/8164)). This is fixed in `sphinx 3.4.2`. 
- `sphinx>=3.4.2`: The previously missing classes are now documented, but there is a problem with the "Bases" section in the docs. 
 
Example: In the docs for `alibi_detect.utils.pytorch.kernels.DeepKernel` in this readthedocs build https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html, the base class is listed as "Bases: `torch.nn.`" instead of "Bases: `torch.nn.Module`". 


### How to Reproduce

```
$ git clone https://github.com/ascillitoe/alibi-detect.git
$ cd alibi-detect
$ pip install -r requirements/docs.txt
$ make build_docs
$ # open doc/_build/html/api/alibi_detect.utils.pytorch.kernels.html and see "Bases" section.
```


### Expected behavior

The "Bases" section should report `torch.nn.Module` not `torch.nn.`. 

i.e. see
https://seldon--325.org.readthedocs.build/projects/alibi-detect/en/325/api/alibi_detect.utils.pytorch.kernels.html

### Your project

https://github.com/ascillitoe/alibi-detect/tree/feature_sphinx4

### Screenshots

### Screenshot with `sphinx==4.2`
![sphinx_problem](https://user-images.githubusercontent.com/32061685/133816582-ca162b07-41c7-4b8e-98ea-781e7c659229.png)

### Screenshot with `sphinx<3.0`
![sphinx_working](https://user-images.githubusercontent.com/32061685/133816065-6291ce1b-96cf-4b0f-9648-7f993fc15611.png)



### OS

Ubuntu 18.04 (used by readthedocs/build:6.0)

### Python version

3.8.11

### Sphinx version

`>=3.4.2`

### Sphinx extensions

    ["sphinx.ext.autodoc",
    "sphinx.ext.doctest",
    "sphinx.ext.intersphinx",
    "sphinx.ext.todo",
    "sphinx.ext.coverage",
    "sphinx.ext.mathjax",
    "sphinx.ext.ifconfig",
    "sphinx.ext.viewcode",
    "sphinx.ext.napoleon",
    "sphinx_autodoc_typehints",
    "sphinxcontrib.apidoc", 
    "nbsphinx",
    "nbsphinx_link",  
    "myst_parser"]


### Extra tools

_No response_

### Additional context

demo PR:
https://github.com/SeldonIO/alibi-detect/pull/338

readthedocs demo build:
https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html



Patch information:
diff --git a/doc/usage/extensions/autodoc.rst b/doc/usage/extensions/autodoc.rst
index 5ac3cd171..717981aab 100644
--- a/doc/usage/extensions/autodoc.rst
+++ b/doc/usage/extensions/autodoc.rst
@@ -773,6 +773,11 @@ needed docstring processing in event :event:`autodoc-process-docstring`:
    modify **in place** to change what Sphinx puts into the output.  It's
    emitted only if ``show-inheritance`` option given.
 
+   The list is normalized to contain class objects (or strings) even when
+   modules are mocked via ``autodoc_mock_imports``. In particular, mocked
+   base entries are converted to their classes for consistent downstream
+   processing and correct display in the "Bases" section.
+
    :param app: the Sphinx application object
    :param name: the fully qualified name of the object
    :param obj: the object itself
diff --git a/sphinx/ext/autodoc/__init__.py b/sphinx/ext/autodoc/__init__.py
index a255c0691..e2243134a 100644
--- a/sphinx/ext/autodoc/__init__.py
+++ b/sphinx/ext/autodoc/__init__.py
@@ -1661,6 +1661,9 @@ class ClassDocumenter(DocstringSignatureMixin, ModuleLevelDocumenter):  # type:
             else:
                 bases = []
 
+            # Normalize mocked base entries to their classes for display
+            bases = [b.__class__ if ismock(b) else b for b in bases]
+
             self.env.events.emit('autodoc-process-bases',
                                  self.fullname, self.object, self.options, bases)
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-12-24 04:13:21,018 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Inherited classes not correctly documented when mocked

Description: ### Describe the bug

We're experiencing an issue when documenting classes that inherit mocked classes. However, classes which inherit other classes from our own package are ok.

This issue appears to be dependent on the `sphinx` version:

- `sphinx<3.0`: Everything is OK. 
- `sphinx>=3.0 < 3.4.2`: Classes that inherit mocked classes are not documented. (see [sphinx #8164](https://github.com/sphinx-doc/sphinx/issues/8164)). This is fixed in `sphinx 3.4.2`. 
- `sphinx>=3.4.2`: The previously missing classes are now documented, but there is a problem with the "Bases" section in the docs. 
 
Example: In the docs for `alibi_detect.utils.pytorch.kernels.DeepKernel` in this readthedocs build https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html, the base class is listed as "Bases: `torch.nn.`" instead of "Bases: `torch.nn.Module`". 


### How to Reproduce

```
$ git clone https://github.com/ascillitoe/alibi-detect.git
$ cd alibi-detect
$ pip install -r requirements/docs.txt
$ make build_docs
$ # open doc/_build/html/api/alibi_detect.utils.pytorch.kernels.html and see "Bases" section.
```


### Expected behavior

The "Bases" section should report `torch.nn.Module` not `torch.nn.`. 

i.e. see
https://seldon--325.org.readthedocs.build/projects/alibi-detect/en/325/api/alibi_detect.utils.pytorch.kernels.html

### Your project

https://github.com/ascillitoe/alibi-detect/tree/feature_sphinx4

### Screenshots

### Screenshot with `sphinx==4.2`
![sphinx_problem](https://user-images.githubusercontent.com/32061685/133816582-ca162b07-41c7-4b8e-98ea-781e7c659229.png)

### Screenshot with `sphinx<3.0`
![sphinx_working](https://user-images.githubusercontent.com/32061685/133816065-6291ce1b-96cf-4b0f-9648-7f993fc15611.png)



### OS

Ubuntu 18.04 (used by readthedocs/build:6.0)

### Python version

3.8.11

### Sphinx version

`>=3.4.2`

### Sphinx extensions

    ["sphinx.ext.autodoc",
    "sphinx.ext.doctest",
    "sphinx.ext.intersphinx",
    "sphinx.ext.todo",
    "sphinx.ext.coverage",
    "sphinx.ext.mathjax",
    "sphinx.ext.ifconfig",
    "sphinx.ext.viewcode",
    "sphinx.ext.napoleon",
    "sphinx_autodoc_typehints",
    "sphinxcontrib.apidoc", 
    "nbsphinx",
    "nbsphinx_link",  
    "myst_parser"]


### Extra tools

_No response_

### Additional context

demo PR:
https://github.com/SeldonIO/alibi-detect/pull/338

readthedocs demo build:
https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html



Patch information:
diff --git a/doc/usage/extensions/autodoc.rst b/doc/usage/extensions/autodoc.rst
index 5ac3cd171..717981aab 100644
--- a/doc/usage/extensions/autodoc.rst
+++ b/doc/usage/extensions/autodoc.rst
@@ -773,6 +773,11 @@ needed docstring processing in event :event:`autodoc-process-docstring`:
    modify **in place** to change what Sphinx puts into the output.  It's
    emitted only if ``show-inheritance`` option given.
 
+   The list is normalized to contain class objects (or strings) even when
+   modules are mocked via ``autodoc_mock_imports``. In particular, mocked
+   base entries are converted to their classes for consistent downstream
+   processing and correct display in the "Bases" section.
+
    :param app: the Sphinx application object
    :param name: the fully qualified name of the object
    :param obj: the object itself
diff --git a/sphinx/ext/autodoc/__init__.py b/sphinx/ext/autodoc/__init__.py
index a255c0691..e2243134a 100644
--- a/sphinx/ext/autodoc/__init__.py
+++ b/sphinx/ext/autodoc/__init__.py
@@ -1661,6 +1661,9 @@ class ClassDocumenter(DocstringSignatureMixin, ModuleLevelDocumenter):  # type:
             else:
                 bases = []
 
+            # Normalize mocked base entries to their classes for display
+            bases = [b.__class__ if ismock(b) else b for b in bases]
+
             self.env.events.emit('autodoc-process-bases',
                                  self.fullname, self.object, self.options, bases)
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 04:14:13,326 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user wants to find test cases for a bug involving `autodoc` and mocked inherited classes. To identify the most relevant tests, I need to analyze the test files that specifically cover mocking in `autodoc` and the `autoclass` directive, which is responsible for documenting classes. Understanding the mocking implementation is also crucial for comprehending the tests and the bug.' query='Please provide the full content of `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`.' extra_requirements='' purpose="This context will enable me to find 3 relevant test cases that cover the user's scenario of documenting classes with mocked base classes, mocked base classes, including setup, mocking, and assertions."
2025-12-24 04:14:13,327 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`.
2025-12-24 04:14:13,331 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 04:14:13,332 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 04:14:13,333 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 04:14:13,333 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`.
Purpose: This context will enable me to find 3 relevant test cases that cover the user's scenario of documenting classes with mocked base classes, mocked base classes, including setup, mocking, and assertions.
2025-12-24 04:14:15,755 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of the three requested files: `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`. This provides the necessary context to identify relevant test cases for documenting classes with mocked base classes.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sphinx/ext/autodoc/mock.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2124, 'candidates_token_count': 150, 'total_token_count': 2311, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2124}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 150}], 'thoughts_token_count': 37, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.04884577751159668, 'model_name': 'gemini-2.5-pro'} id='run--705b8db9-f892-4450-baf0-cb825f4cc432-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc_mock.py'}, 'id': 'ec50f367-2487-4a24-9abd-f28439b344af', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc_autoclass.py'}, 'id': '03b0d71c-88d3-4838-b8a4-f428fb30a13e', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sphinx/ext/autodoc/mock.py'}, 'id': 'deeab02e-e460-4e39-b8ef-7b26b561a295', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2124, 'output_tokens': 150, 'total_tokens': 2311, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 37}}
2025-12-24 04:14:41,860 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of the three requested files: `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`. This provides the necessary context to identify relevant test cases for documenting classes with mocked base classes.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 2875, 'end_index': 3284, 'uri': 'https://sources.debian.org/src/sphinx/3.2.1-1/tests/test_ext_autodoc_mock.py/', 'title': '', 'license_': ''}, {'start_index': 3490, 'end_index': 3945, 'uri': 'https://sources.debian.org/src/sphinx/3.2.1-1/tests/test_ext_autodoc_mock.py/', 'title': '', 'license_': ''}, {'start_index': 4288, 'end_index': 4621, 'uri': 'https://github.com/Adix82/sphinx', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 12668, 'candidates_token_count': 72, 'total_token_count': 15557, 'cached_content_token_count': 1806, 'prompt_tokens_details': [{'modality': 1, 'token_count': 12668}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1806}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 72}], 'thoughts_token_count': 2817}, 'finish_reason': 'STOP', 'avg_logprobs': -4.310109032524957, 'model_name': 'gemini-2.5-pro'} id='run--7fcd08fe-b0ca-4e39-9d57-65379537d388-0' usage_metadata={'input_tokens': 12668, 'output_tokens': 72, 'total_tokens': 15557, 'input_token_details': {'cache_read': 1806}, 'output_token_details': {'reasoning': 2817}}
2025-12-24 04:14:41,862 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
This context will enable me to find 3 relevant test cases that cover the user's scenario of documenting classes with mocked base classes, mocked base classes, including setup, mocking, and assertions.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sphinx/ext/autodoc/mock.py
Line number range: 1 - 187
Content:
1. """
2.     sphinx.ext.autodoc.mock
3.     ~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     mock for autodoc
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import contextlib
12. import os
13. import sys
14. from importlib.abc import Loader, MetaPathFinder
15. from importlib.machinery import ModuleSpec
16. from types import ModuleType
17. from typing import Any, Generator, Iterator, List, Optional, Sequence, Tuple, Union
18. 
19. from sphinx.util import logging
20. from sphinx.util.inspect import safe_getattr
21. 
22. logger = logging.getLogger(__name__)
23. 
24. 
25. class _MockObject:
26.     """Used by autodoc_mock_imports."""
27. 
28.     __display_name__ = '_MockObject'
29.     __sphinx_mock__ = True
30.     __sphinx_decorator_args__: Tuple[Any, ...] = ()
31. 
32.     def __new__(cls, *args: Any, **kwargs: Any) -> Any:
33.         if len(args) == 3 and isinstance(args[1], tuple):
34.             superclass = args[1][-1].__class__
35.             if superclass is cls:
36.                 # subclassing MockObject
37.                 return _make_subclass(args[0], superclass.__display_name__,
38.                                       superclass=superclass, attributes=args[2])
39. 
40.         return super().__new__(cls)
41. 
42.     def __init__(self, *args: Any, **kwargs: Any) -> None:
43.         self.__qualname__ = ''
44. 
45.     def __len__(self) -> int:
46.         return 0
47. 
48.     def __contains__(self, key: str) -> bool:
49.         return False
50. 
51.     def __iter__(self) -> Iterator:
52.         return iter([])
53. 
54.     def __mro_entries__(self, bases: Tuple) -> Tuple:
55.         return (self.__class__,)
56. 
57.     def __getitem__(self, key: Any) -> "_MockObject":
58.         return _make_subclass(str(key), self.__display_name__, self.__class__)()
59. 
60.     def __getattr__(self, key: str) -> "_MockObject":
61.         return _make_subclass(key, self.__display_name__, self.__class__)()
62. 
63.     def __call__(self, *args: Any, **kwargs: Any) -> Any:
64.         call = self.__class__()
65.         call.__sphinx_decorator_args__ = args
66.         return call
67. 
68.     def __repr__(self) -> str:
69.         return self.__display_name__
70. 
71. 
72. def _make_subclass(name: str, module: str, superclass: Any = _MockObject,
73.                    attributes: Any = None, decorator_args: Tuple = ()) -> Any:
74.     attrs = {'__module__': module,
75.              '__display_name__': module + '.' + name,
76.              '__sphinx_decorator_args__': decorator_args}
77.     attrs.update(attributes or {})
78. 
79.     return type(name, (superclass,), attrs)
80. 
81. 
82. class _MockModule(ModuleType):
83.     """Used by autodoc_mock_imports."""
84.     __file__ = os.devnull
85.     __sphinx_mock__ = True
86. 
87.     def __init__(self, name: str) -> None:
88.         super().__init__(name)
89.         self.__all__: List[str] = []
90.         self.__path__: List[str] = []
91. 
92.     def __getattr__(self, name: str) -> _MockObject:
93.         return _make_subclass(name, self.__name__)()
94. 
95.     def __repr__(self) -> str:
96.         return self.__name__
97. 
98. 
99. class MockLoader(Loader):
100.     """A loader for mocking."""
101.     def __init__(self, finder: "MockFinder") -> None:
102.         super().__init__()
103.         self.finder = finder
104. 
105.     def create_module(self, spec: ModuleSpec) -> ModuleType:
106.         logger.debug('[autodoc] adding a mock module as %s!', spec.name)
107.         self.finder.mocked_modules.append(spec.name)
108.         return _MockModule(spec.name)
109. 
110.     def exec_module(self, module: ModuleType) -> None:
111.         pass  # nothing to do
112. 
113. 
114. class MockFinder(MetaPathFinder):
115.     """A finder for mocking."""
116. 
117.     def __init__(self, modnames: List[str]) -> None:
118.         super().__init__()
119.         self.modnames = modnames
120.         self.loader = MockLoader(self)
121.         self.mocked_modules: List[str] = []
122. 
123.     def find_spec(self, fullname: str, path: Optional[Sequence[Union[bytes, str]]],
124.                   target: ModuleType = None) -> Optional[ModuleSpec]:
125.         for modname in self.modnames:
126.             # check if fullname is (or is a descendant of) one of our targets
127.             if modname == fullname or fullname.startswith(modname + '.'):
128.                 return ModuleSpec(fullname, self.loader)
129. 
130.         return None
131. 
132.     def invalidate_caches(self) -> None:
133.         """Invalidate mocked modules on sys.modules."""
134.         for modname in self.mocked_modules:
135.             sys.modules.pop(modname, None)
136. 
137. 
138. @contextlib.contextmanager
139. def mock(modnames: List[str]) -> Generator[None, None, None]:
140.     """Insert mock modules during context::
141. 
142.         with mock(['target.module.name']):
143.             # mock modules are enabled here
144.             ...
145.     """
146.     try:
147.         finder = MockFinder(modnames)
148.         sys.meta_path.insert(0, finder)
149.         yield
150.     finally:
151.         sys.meta_path.remove(finder)
152.         finder.invalidate_caches()
153. 
154. 
155. def ismock(subject: Any) -> bool:
156.     """Check if the object is mocked."""
157.     # check the object has '__sphinx_mock__' attribute
158.     try:
159.         if safe_getattr(subject, '__sphinx_mock__', None) is None:
160.             return False
161.     except AttributeError:
162.         return False
163. 
164.     # check the object is mocked module
165.     if isinstance(subject, _MockModule):
166.         return True
167. 
168.     try:
169.         # check the object is mocked object
170.         __mro__ = safe_getattr(type(subject), '__mro__', [])
171.         if len(__mro__) > 2 and __mro__[1] is _MockObject:
172.             return True
173.     except AttributeError:
174.         pass
175. 
176.     return False
177. 
178. 
179. def undecorate(subject: _MockObject) -> Any:
180.     """Unwrap mock if *subject* is decorated by mocked object.
181. 
182.     If not decorated, returns given *subject* itself.
183.     """
184.     if ismock(subject) and subject.__sphinx_decorator_args__:
185.         return subject.__sphinx_decorator_args__[0]
186.     else:
187.         return subject


File: tests/test_ext_autodoc_autoclass.py
Line number range: 1 - 433
Content:
1. """
2.     test_ext_autodoc_autoclass
3.     ~~~~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from typing import List, Union
14. 
15. import pytest
16. 
17. from .test_ext_autodoc import do_autodoc
18. 
19. 
20. @pytest.mark.sphinx('html', testroot='ext-autodoc')
21. def test_classes(app):
22.     actual = do_autodoc(app, 'function', 'target.classes.Foo')
23.     assert list(actual) == [
24.         '',
25.         '.. py:function:: Foo()',
26.         '   :module: target.classes',
27.         '',
28.     ]
29. 
30.     actual = do_autodoc(app, 'function', 'target.classes.Bar')
31.     assert list(actual) == [
32.         '',
33.         '.. py:function:: Bar(x, y)',
34.         '   :module: target.classes',
35.         '',
36.     ]
37. 
38.     actual = do_autodoc(app, 'function', 'target.classes.Baz')
39.     assert list(actual) == [
40.         '',
41.         '.. py:function:: Baz(x, y)',
42.         '   :module: target.classes',
43.         '',
44.     ]
45. 
46.     actual = do_autodoc(app, 'function', 'target.classes.Qux')
47.     assert list(actual) == [
48.         '',
49.         '.. py:function:: Qux(foo, bar)',
50.         '   :module: target.classes',
51.         '',
52.     ]
53. 
54. 
55. @pytest.mark.sphinx('html', testroot='ext-autodoc')
56. def test_instance_variable(app):
57.     options = {'members': None}
58.     actual = do_autodoc(app, 'class', 'target.instance_variable.Bar', options)
59.     assert list(actual) == [
60.         '',
61.         '.. py:class:: Bar()',
62.         '   :module: target.instance_variable',
63.         '',
64.         '',
65.         '   .. py:attribute:: Bar.attr2',
66.         '      :module: target.instance_variable',
67.         '',
68.         '      docstring bar',
69.         '',
70.         '',
71.         '   .. py:attribute:: Bar.attr3',
72.         '      :module: target.instance_variable',
73.         '',
74.         '      docstring bar',
75.         '',
76.     ]
77. 
78. 
79. @pytest.mark.sphinx('html', testroot='ext-autodoc')
80. def test_inherited_instance_variable(app):
81.     options = {'members': None,
82.                'inherited-members': None}
83.     actual = do_autodoc(app, 'class', 'target.instance_variable.Bar', options)
84.     assert list(actual) == [
85.         '',
86.         '.. py:class:: Bar()',
87.         '   :module: target.instance_variable',
88.         '',
89.         '',
90.         '   .. py:attribute:: Bar.attr1',
91.         '      :module: target.instance_variable',
92.         '',
93.         '      docstring foo',
94.         '',
95.         '',
96.         '   .. py:attribute:: Bar.attr2',
97.         '      :module: target.instance_variable',
98.         '',
99.         '      docstring bar',
100.         '',
101.         '',
102.         '   .. py:attribute:: Bar.attr3',
103.         '      :module: target.instance_variable',
104.         '',
105.         '      docstring bar',
106.         '',
107.     ]
108. 
109. 
110. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
111. @pytest.mark.sphinx('html', testroot='ext-autodoc')
112. def test_uninitialized_attributes(app):
113.     options = {"members": None,
114.                "inherited-members": None}
115.     actual = do_autodoc(app, 'class', 'target.uninitialized_attributes.Derived', options)
116.     assert list(actual) == [
117.         '',
118.         '.. py:class:: Derived()',
119.         '   :module: target.uninitialized_attributes',
120.         '',
121.         '',
122.         '   .. py:attribute:: Derived.attr1',
123.         '      :module: target.uninitialized_attributes',
124.         '      :type: int',
125.         '',
126.         '      docstring',
127.         '',
128.         '',
129.         '   .. py:attribute:: Derived.attr3',
130.         '      :module: target.uninitialized_attributes',
131.         '      :type: int',
132.         '',
133.         '      docstring',
134.         '',
135.     ]
136. 
137. 
138. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
139. @pytest.mark.sphinx('html', testroot='ext-autodoc')
140. def test_undocumented_uninitialized_attributes(app):
141.     options = {"members": None,
142.                "inherited-members": None,
143.                "undoc-members": None}
144.     actual = do_autodoc(app, 'class', 'target.uninitialized_attributes.Derived', options)
145.     assert list(actual) == [
146.         '',
147.         '.. py:class:: Derived()',
148.         '   :module: target.uninitialized_attributes',
149.         '',
150.         '',
151.         '   .. py:attribute:: Derived.attr1',
152.         '      :module: target.uninitialized_attributes',
153.         '      :type: int',
154.         '',
155.         '      docstring',
156.         '',
157.         '',
158.         '   .. py:attribute:: Derived.attr2',
159.         '      :module: target.uninitialized_attributes',
160.         '      :type: str',
161.         '',
162.         '',
163.         '   .. py:attribute:: Derived.attr3',
164.         '      :module: target.uninitialized_attributes',
165.         '      :type: int',
166.         '',
167.         '      docstring',
168.         '',
169.         '',
170.         '   .. py:attribute:: Derived.attr4',
171.         '      :module: target.uninitialized_attributes',
172.         '      :type: str',
173.         '',
174.     ]
175. 
176. 
177. def test_decorators(app):
178.     actual = do_autodoc(app, 'class', 'target.decorator.Baz')
179.     assert list(actual) == [
180.         '',
181.         '.. py:class:: Baz(name=None, age=None)',
182.         '   :module: target.decorator',
183.         '',
184.     ]
185. 
186.     actual = do_autodoc(app, 'class', 'target.decorator.Qux')
187.     assert list(actual) == [
188.         '',
189.         '.. py:class:: Qux(name=None, age=None)',
190.         '   :module: target.decorator',
191.         '',
192.     ]
193. 
194.     actual = do_autodoc(app, 'class', 'target.decorator.Quux')
195.     assert list(actual) == [
196.         '',
197.         '.. py:class:: Quux(name=None, age=None)',
198.         '   :module: target.decorator',
199.         '',
200.     ]
201. 
202. 
203. @pytest.mark.sphinx('html', testroot='ext-autodoc')
204. def test_properties(app):
205.     options = {"members": None}
206.     actual = do_autodoc(app, 'class', 'target.properties.Foo', options)
207.     assert list(actual) == [
208.         '',
209.         '.. py:class:: Foo()',
210.         '   :module: target.properties',
211.         '',
212.         '   docstring',
213.         '',
214.         '',
215.         '   .. py:property:: Foo.prop1',
216.         '      :module: target.properties',
217.         '      :type: int',
218.         '',
219.         '      docstring',
220.         '',
221.         '',
222.         '   .. py:property:: Foo.prop2',
223.         '      :module: target.properties',
224.         '      :classmethod:',
225.         '      :type: int',
226.         '',
227.         '      docstring',
228.         '',
229.     ]
230. 
231. 
232. @pytest.mark.sphinx('html', testroot='ext-autodoc')
233. def test_slots_attribute(app):
234.     options = {"members": None}
235.     actual = do_autodoc(app, 'class', 'target.slots.Bar', options)
236.     assert list(actual) == [
237.         '',
238.         '.. py:class:: Bar()',
239.         '   :module: target.slots',
240.         '',
241.         '   docstring',
242.         '',
243.         '',
244.         '   .. py:attribute:: Bar.attr1',
245.         '      :module: target.slots',
246.         '',
247.         '      docstring of attr1',
248.         '',
249.         '',
250.         '   .. py:attribute:: Bar.attr2',
251.         '      :module: target.slots',
252.         '',
253.         '      docstring of instance attr2',
254.         '',
255.     ]
256. 
257. 
258. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
259. @pytest.mark.sphinx('html', testroot='ext-autodoc')
260. def test_show_inheritance_for_subclass_of_generic_type(app):
261.     options = {'show-inheritance': None}
262.     actual = do_autodoc(app, 'class', 'target.classes.Quux', options)
263.     assert list(actual) == [
264.         '',
265.         '.. py:class:: Quux(iterable=(), /)',
266.         '   :module: target.classes',
267.         '',
268.         '   Bases: :py:class:`~typing.List`\\ '
269.         '[:py:obj:`~typing.Union`\\ [:py:class:`int`, :py:class:`float`]]',
270.         '',
271.         '   A subclass of List[Union[int, float]]',
272.         '',
273.     ]
274. 
275. 
276. @pytest.mark.sphinx('html', testroot='ext-autodoc')
277. def test_autodoc_process_bases(app):
278.     def autodoc_process_bases(app, name, obj, options, bases):
279.         assert name == 'target.classes.Quux'
280.         assert obj.__module__ == 'target.classes'
281.         assert obj.__name__ == 'Quux'
282.         assert options == {'show-inheritance': True,
283.                            'members': []}
284.         assert bases == [List[Union[int, float]]]
285. 
286.         bases.pop()
287.         bases.extend([int, str])
288. 
289.     app.connect('autodoc-process-bases', autodoc_process_bases)
290. 
291.     options = {'show-inheritance': None}
292.     actual = do_autodoc(app, 'class', 'target.classes.Quux', options)
293.     if sys.version_info < (3, 7):
294.         assert list(actual) == [
295.             '',
296.             '.. py:class:: Quux(*args, **kwds)',
297.             '   :module: target.classes',
298.             '',
299.             '   Bases: :py:class:`int`, :py:class:`str`',
300.             '',
301.             '   A subclass of List[Union[int, float]]',
302.             '',
303.         ]
304.     else:
305.         assert list(actual) == [
306.             '',
307.             '.. py:class:: Quux(iterable=(), /)',
308.             '   :module: target.classes',
309.             '',
310.             '   Bases: :py:class:`int`, :py:class:`str`',
311.             '',
312.             '   A subclass of List[Union[int, float]]',
313.             '',
314.         ]
315. 
316. 
317. @pytest.mark.sphinx('html', testroot='ext-autodoc')
318. def test_class_doc_from_class(app):
319.     options = {"members": None,
320.                "class-doc-from": "class"}
321.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
322.     assert list(actual) == [
323.         '',
324.         '.. py:class:: C()',
325.         '   :module: target.autoclass_content',
326.         '',
327.         '   A class having __init__, no __new__',
328.         '',
329.     ]
330. 
331. 
332. @pytest.mark.sphinx('html', testroot='ext-autodoc')
333. def test_class_doc_from_init(app):
334.     options = {"members": None,
335.                "class-doc-from": "init"}
336.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
337.     assert list(actual) == [
338.         '',
339.         '.. py:class:: C()',
340.         '   :module: target.autoclass_content',
341.         '',
342.         '   __init__ docstring',
343.         '',
344.     ]
345. 
346. 
347. @pytest.mark.sphinx('html', testroot='ext-autodoc')
348. def test_class_doc_from_both(app):
349.     options = {"members": None,
350.                "class-doc-from": "both"}
351.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
352.     assert list(actual) == [
353.         '',
354.         '.. py:class:: C()',
355.         '   :module: target.autoclass_content',
356.         '',
357.         '   A class having __init__, no __new__',
358.         '',
359.         '   __init__ docstring',
360.         '',
361.     ]
362. 
363. 
364. def test_class_alias(app):
365.     def autodoc_process_docstring(*args):
366.         """A handler always raises an error.
367.         This confirms this handler is never called for class aliases.
368.         """
369.         raise
370. 
371.     app.connect('autodoc-process-docstring', autodoc_process_docstring)
372.     actual = do_autodoc(app, 'class', 'target.classes.Alias')
373.     assert list(actual) == [
374.         '',
375.         '.. py:attribute:: Alias',
376.         '   :module: target.classes',
377.         '',
378.         '   alias of :py:class:`target.classes.Foo`',
379.     ]
380. 
381. 
382. def test_class_alias_having_doccomment(app):
383.     actual = do_autodoc(app, 'class', 'target.classes.OtherAlias')
384.     assert list(actual) == [
385.         '',
386.         '.. py:attribute:: OtherAlias',
387.         '   :module: target.classes',
388.         '',
389.         '   docstring',
390.         '',
391.     ]
392. 
393. 
394. @pytest.mark.sphinx('html', testroot='ext-autodoc')
395. def test_coroutine(app):
396.     options = {"members": None}
397.     actual = do_autodoc(app, 'class', 'target.coroutine.AsyncClass', options)
398.     assert list(actual) == [
399.         '',
400.         '.. py:class:: AsyncClass()',
401.         '   :module: target.coroutine',
402.         '',
403.         '',
404.         '   .. py:method:: AsyncClass.do_asyncgen()',
405.         '      :module: target.coroutine',
406.         '      :async:',
407.         '',
408.         '      A documented async generator',
409.         '',
410.         '',
411.         '   .. py:method:: AsyncClass.do_coroutine()',
412.         '      :module: target.coroutine',
413.         '      :async:',
414.         '',
415.         '      A documented coroutine function',
416.         '',
417.         '',
418.         '   .. py:method:: AsyncClass.do_coroutine2()',
419.         '      :module: target.coroutine',
420.         '      :async:',
421.         '      :classmethod:',
422.         '',
423.         '      A documented coroutine classmethod',
424.         '',
425.         '',
426.         '   .. py:method:: AsyncClass.do_coroutine3()',
427.         '      :module: target.coroutine',
428.         '      :async:',
429.         '      :staticmethod:',
430.         '',
431.         '      A documented coroutine staticmethod',
432.         '',
433.     ]


File: tests/test_ext_autodoc_mock.py
Line number range: 1 - 152
Content:
1. """
2.     test_ext_autodoc_mock
3.     ~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import abc
12. import sys
13. from importlib import import_module
14. from typing import TypeVar
15. 
16. import pytest
17. 
18. from sphinx.ext.autodoc.mock import _MockModule, _MockObject, ismock, mock, undecorate
19. 
20. 
21. def test_MockModule():
22.     mock = _MockModule('mocked_module')
23.     assert isinstance(mock.some_attr, _MockObject)
24.     assert isinstance(mock.some_method, _MockObject)
25.     assert isinstance(mock.attr1.attr2, _MockObject)
26.     assert isinstance(mock.attr1.attr2.meth(), _MockObject)
27. 
28.     assert repr(mock.some_attr) == 'mocked_module.some_attr'
29.     assert repr(mock.some_method) == 'mocked_module.some_method'
30.     assert repr(mock.attr1.attr2) == 'mocked_module.attr1.attr2'
31.     assert repr(mock.attr1.attr2.meth) == 'mocked_module.attr1.attr2.meth'
32. 
33.     assert repr(mock) == 'mocked_module'
34. 
35. 
36. def test_MockObject():
37.     mock = _MockObject()
38.     assert isinstance(mock.some_attr, _MockObject)
39.     assert isinstance(mock.some_method, _MockObject)
40.     assert isinstance(mock.attr1.attr2, _MockObject)
41.     assert isinstance(mock.attr1.attr2.meth(), _MockObject)
42. 
43.     # subclassing
44.     class SubClass(mock.SomeClass):
45.         """docstring of SubClass"""
46. 
47.         def method(self):
48.             return "string"
49. 
50.     obj = SubClass()
51.     assert SubClass.__doc__ == "docstring of SubClass"
52.     assert isinstance(obj, SubClass)
53.     assert obj.method() == "string"
54.     assert isinstance(obj.other_method(), SubClass)
55. 
56.     # parametrized type
57.     T = TypeVar('T')
58. 
59.     class SubClass2(mock.SomeClass[T]):
60.         """docstring of SubClass"""
61. 
62.     obj2 = SubClass2()
63.     assert SubClass2.__doc__ == "docstring of SubClass"
64.     assert isinstance(obj2, SubClass2)
65. 
66. 
67. def test_mock():
68.     modname = 'sphinx.unknown'
69.     submodule = modname + '.submodule'
70.     assert modname not in sys.modules
71.     with pytest.raises(ImportError):
72.         import_module(modname)
73. 
74.     with mock([modname]):
75.         import_module(modname)
76.         assert modname in sys.modules
77.         assert isinstance(sys.modules[modname], _MockModule)
78. 
79.         # submodules are also mocked
80.         import_module(submodule)
81.         assert submodule in sys.modules
82.         assert isinstance(sys.modules[submodule], _MockModule)
83. 
84.     assert modname not in sys.modules
85.     with pytest.raises(ImportError):
86.         import_module(modname)
87. 
88. 
89. def test_mock_does_not_follow_upper_modules():
90.     with mock(['sphinx.unknown.module']):
91.         with pytest.raises(ImportError):
92.             import_module('sphinx.unknown')
93. 
94. 
95. @pytest.mark.skipif(sys.version_info < (3, 7), reason='Only for py37 or above')
96. def test_abc_MockObject():
97.     mock = _MockObject()
98. 
99.     class Base:
100.         @abc.abstractmethod
101.         def __init__(self):
102.             pass
103. 
104.     class Derived(Base, mock.SubClass):
105.         pass
106. 
107.     obj = Derived()
108.     assert isinstance(obj, Base)
109.     assert isinstance(obj, _MockObject)
110.     assert isinstance(obj.some_method(), Derived)
111. 
112. 
113. def test_mock_decorator():
114.     mock = _MockObject()
115. 
116.     @mock.function_deco
117.     def func():
118.         pass
119. 
120.     class Foo:
121.         @mock.method_deco
122.         def meth(self):
123.             pass
124. 
125.     @mock.class_deco
126.     class Bar:
127.         pass
128. 
129.     @mock.funcion_deco(Foo)
130.     class Baz:
131.         pass
132. 
133.     assert undecorate(func).__name__ == "func"
134.     assert undecorate(Foo.meth).__name__ == "meth"
135.     assert undecorate(Bar).__name__ == "Bar"
136.     assert undecorate(Baz).__name__ == "Baz"
137. 
138. 
139. def test_ismock():
140.     with mock(['sphinx.unknown']):
141.         mod1 = import_module('sphinx.unknown')
142.         mod2 = import_module('sphinx.application')
143. 
144.         class Inherited(mod1.Class):
145.             pass
146. 
147.         assert ismock(mod1) is True
148.         assert ismock(mod1.Class) is True
149.         assert ismock(Inherited) is False
150. 
151.         assert ismock(mod2) is False
152.         assert ismock(mod2.Sphinx) is False

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 04:14:50,077 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query explicitly asks for the full content of `sphinx/ext/autodoc/mock.py`.\n   - The provided context contains the entire file content.\n2. Extended relevance:\n   - This file is essential as it's one of the three files requested by the user.", relative_path='sphinx/ext/autodoc/mock.py', start_line=1, end_line=187), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query explicitly asks for the full content of `tests/test_ext_autodoc_autoclass.py`.\n   - The provided context contains the entire file content.\n2. Extended relevance:\n   - This file is essential as it's one of the three files requested by the user.", relative_path='tests/test_ext_autodoc_autoclass.py', start_line=1, end_line=433), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user query explicitly asks for the full content of `tests/test_ext_autodoc_mock.py`.\n   - The provided context contains the entire file content.\n2. Extended relevance:\n   - This file is essential as it's one of the three files requested by the user.", relative_path='tests/test_ext_autodoc_mock.py', start_line=1, end_line=152)]
2025-12-24 04:14:50,079 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 3 contexts to memory for query: Please provide the full content of `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`.
2025-12-24 04:14:50,079 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 04:14:50,079 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 04:14:50,079 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 3 new contexts to 0 existing contexts
2025-12-24 04:14:50,080 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 3 total contexts (removed 0 duplicates)
2025-12-24 04:14:50,080 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Inherited classes not correctly documented when mocked

Description: ### Describe the bug

We're experiencing an issue when documenting classes that inherit mocked classes. However, classes which inherit other classes from our own package are ok.

This issue appears to be dependent on the `sphinx` version:

- `sphinx<3.0`: Everything is OK. 
- `sphinx>=3.0 < 3.4.2`: Classes that inherit mocked classes are not documented. (see [sphinx #8164](https://github.com/sphinx-doc/sphinx/issues/8164)). This is fixed in `sphinx 3.4.2`. 
- `sphinx>=3.4.2`: The previously missing classes are now documented, but there is a problem with the "Bases" section in the docs. 
 
Example: In the docs for `alibi_detect.utils.pytorch.kernels.DeepKernel` in this readthedocs build https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html, the base class is listed as "Bases: `torch.nn.`" instead of "Bases: `torch.nn.Module`". 


### How to Reproduce

```
$ git clone https://github.com/ascillitoe/alibi-detect.git
$ cd alibi-detect
$ pip install -r requirements/docs.txt
$ make build_docs
$ # open doc/_build/html/api/alibi_detect.utils.pytorch.kernels.html and see "Bases" section.
```


### Expected behavior

The "Bases" section should report `torch.nn.Module` not `torch.nn.`. 

i.e. see
https://seldon--325.org.readthedocs.build/projects/alibi-detect/en/325/api/alibi_detect.utils.pytorch.kernels.html

### Your project

https://github.com/ascillitoe/alibi-detect/tree/feature_sphinx4

### Screenshots

### Screenshot with `sphinx==4.2`
![sphinx_problem](https://user-images.githubusercontent.com/32061685/133816582-ca162b07-41c7-4b8e-98ea-781e7c659229.png)

### Screenshot with `sphinx<3.0`
![sphinx_working](https://user-images.githubusercontent.com/32061685/133816065-6291ce1b-96cf-4b0f-9648-7f993fc15611.png)



### OS

Ubuntu 18.04 (used by readthedocs/build:6.0)

### Python version

3.8.11

### Sphinx version

`>=3.4.2`

### Sphinx extensions

    ["sphinx.ext.autodoc",
    "sphinx.ext.doctest",
    "sphinx.ext.intersphinx",
    "sphinx.ext.todo",
    "sphinx.ext.coverage",
    "sphinx.ext.mathjax",
    "sphinx.ext.ifconfig",
    "sphinx.ext.viewcode",
    "sphinx.ext.napoleon",
    "sphinx_autodoc_typehints",
    "sphinxcontrib.apidoc", 
    "nbsphinx",
    "nbsphinx_link",  
    "myst_parser"]


### Extra tools

_No response_

### Additional context

demo PR:
https://github.com/SeldonIO/alibi-detect/pull/338

readthedocs demo build:
https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html



Patch information:
diff --git a/doc/usage/extensions/autodoc.rst b/doc/usage/extensions/autodoc.rst
index 5ac3cd171..717981aab 100644
--- a/doc/usage/extensions/autodoc.rst
+++ b/doc/usage/extensions/autodoc.rst
@@ -773,6 +773,11 @@ needed docstring processing in event :event:`autodoc-process-docstring`:
    modify **in place** to change what Sphinx puts into the output.  It's
    emitted only if ``show-inheritance`` option given.
 
+   The list is normalized to contain class objects (or strings) even when
+   modules are mocked via ``autodoc_mock_imports``. In particular, mocked
+   base entries are converted to their classes for consistent downstream
+   processing and correct display in the "Bases" section.
+
    :param app: the Sphinx application object
    :param name: the fully qualified name of the object
    :param obj: the object itself
diff --git a/sphinx/ext/autodoc/__init__.py b/sphinx/ext/autodoc/__init__.py
index a255c0691..e2243134a 100644
--- a/sphinx/ext/autodoc/__init__.py
+++ b/sphinx/ext/autodoc/__init__.py
@@ -1661,6 +1661,9 @@ class ClassDocumenter(DocstringSignatureMixin, ModuleLevelDocumenter):  # type:
             else:
                 bases = []
 
+            # Normalize mocked base entries to their classes for display
+            bases = [b.__class__ if ismock(b) else b for b in bases]
+
             self.env.events.emit('autodoc-process-bases',
                                  self.fullname, self.object, self.options, bases)
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`.
Extra Requirements: 
Purpose: This context will enable me to find 3 relevant test cases that cover the user's scenario of documenting classes with mocked base classes, mocked base classes, including setup, mocking, and assertions.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sphinx/ext/autodoc/mock.py
Line number range: 1 - 187
Content:
1. """
2.     sphinx.ext.autodoc.mock
3.     ~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     mock for autodoc
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import contextlib
12. import os
13. import sys
14. from importlib.abc import Loader, MetaPathFinder
15. from importlib.machinery import ModuleSpec
16. from types import ModuleType
17. from typing import Any, Generator, Iterator, List, Optional, Sequence, Tuple, Union
18. 
19. from sphinx.util import logging
20. from sphinx.util.inspect import safe_getattr
21. 
22. logger = logging.getLogger(__name__)
23. 
24. 
25. class _MockObject:
26.     """Used by autodoc_mock_imports."""
27. 
28.     __display_name__ = '_MockObject'
29.     __sphinx_mock__ = True
30.     __sphinx_decorator_args__: Tuple[Any, ...] = ()
31. 
32.     def __new__(cls, *args: Any, **kwargs: Any) -> Any:
33.         if len(args) == 3 and isinstance(args[1], tuple):
34.             superclass = args[1][-1].__class__
35.             if superclass is cls:
36.                 # subclassing MockObject
37.                 return _make_subclass(args[0], superclass.__display_name__,
38.                                       superclass=superclass, attributes=args[2])
39. 
40.         return super().__new__(cls)
41. 
42.     def __init__(self, *args: Any, **kwargs: Any) -> None:
43.         self.__qualname__ = ''
44. 
45.     def __len__(self) -> int:
46.         return 0
47. 
48.     def __contains__(self, key: str) -> bool:
49.         return False
50. 
51.     def __iter__(self) -> Iterator:
52.         return iter([])
53. 
54.     def __mro_entries__(self, bases: Tuple) -> Tuple:
55.         return (self.__class__,)
56. 
57.     def __getitem__(self, key: Any) -> "_MockObject":
58.         return _make_subclass(str(key), self.__display_name__, self.__class__)()
59. 
60.     def __getattr__(self, key: str) -> "_MockObject":
61.         return _make_subclass(key, self.__display_name__, self.__class__)()
62. 
63.     def __call__(self, *args: Any, **kwargs: Any) -> Any:
64.         call = self.__class__()
65.         call.__sphinx_decorator_args__ = args
66.         return call
67. 
68.     def __repr__(self) -> str:
69.         return self.__display_name__
70. 
71. 
72. def _make_subclass(name: str, module: str, superclass: Any = _MockObject,
73.                    attributes: Any = None, decorator_args: Tuple = ()) -> Any:
74.     attrs = {'__module__': module,
75.              '__display_name__': module + '.' + name,
76.              '__sphinx_decorator_args__': decorator_args}
77.     attrs.update(attributes or {})
78. 
79.     return type(name, (superclass,), attrs)
80. 
81. 
82. class _MockModule(ModuleType):
83.     """Used by autodoc_mock_imports."""
84.     __file__ = os.devnull
85.     __sphinx_mock__ = True
86. 
87.     def __init__(self, name: str) -> None:
88.         super().__init__(name)
89.         self.__all__: List[str] = []
90.         self.__path__: List[str] = []
91. 
92.     def __getattr__(self, name: str) -> _MockObject:
93.         return _make_subclass(name, self.__name__)()
94. 
95.     def __repr__(self) -> str:
96.         return self.__name__
97. 
98. 
99. class MockLoader(Loader):
100.     """A loader for mocking."""
101.     def __init__(self, finder: "MockFinder") -> None:
102.         super().__init__()
103.         self.finder = finder
104. 
105.     def create_module(self, spec: ModuleSpec) -> ModuleType:
106.         logger.debug('[autodoc] adding a mock module as %s!', spec.name)
107.         self.finder.mocked_modules.append(spec.name)
108.         return _MockModule(spec.name)
109. 
110.     def exec_module(self, module: ModuleType) -> None:
111.         pass  # nothing to do
112. 
113. 
114. class MockFinder(MetaPathFinder):
115.     """A finder for mocking."""
116. 
117.     def __init__(self, modnames: List[str]) -> None:
118.         super().__init__()
119.         self.modnames = modnames
120.         self.loader = MockLoader(self)
121.         self.mocked_modules: List[str] = []
122. 
123.     def find_spec(self, fullname: str, path: Optional[Sequence[Union[bytes, str]]],
124.                   target: ModuleType = None) -> Optional[ModuleSpec]:
125.         for modname in self.modnames:
126.             # check if fullname is (or is a descendant of) one of our targets
127.             if modname == fullname or fullname.startswith(modname + '.'):
128.                 return ModuleSpec(fullname, self.loader)
129. 
130.         return None
131. 
132.     def invalidate_caches(self) -> None:
133.         """Invalidate mocked modules on sys.modules."""
134.         for modname in self.mocked_modules:
135.             sys.modules.pop(modname, None)
136. 
137. 
138. @contextlib.contextmanager
139. def mock(modnames: List[str]) -> Generator[None, None, None]:
140.     """Insert mock modules during context::
141. 
142.         with mock(['target.module.name']):
143.             # mock modules are enabled here
144.             ...
145.     """
146.     try:
147.         finder = MockFinder(modnames)
148.         sys.meta_path.insert(0, finder)
149.         yield
150.     finally:
151.         sys.meta_path.remove(finder)
152.         finder.invalidate_caches()
153. 
154. 
155. def ismock(subject: Any) -> bool:
156.     """Check if the object is mocked."""
157.     # check the object has '__sphinx_mock__' attribute
158.     try:
159.         if safe_getattr(subject, '__sphinx_mock__', None) is None:
160.             return False
161.     except AttributeError:
162.         return False
163. 
164.     # check the object is mocked module
165.     if isinstance(subject, _MockModule):
166.         return True
167. 
168.     try:
169.         # check the object is mocked object
170.         __mro__ = safe_getattr(type(subject), '__mro__', [])
171.         if len(__mro__) > 2 and __mro__[1] is _MockObject:
172.             return True
173.     except AttributeError:
174.         pass
175. 
176.     return False
177. 
178. 
179. def undecorate(subject: _MockObject) -> Any:
180.     """Unwrap mock if *subject* is decorated by mocked object.
181. 
182.     If not decorated, returns given *subject* itself.
183.     """
184.     if ismock(subject) and subject.__sphinx_decorator_args__:
185.         return subject.__sphinx_decorator_args__[0]
186.     else:
187.         return subject


File: tests/test_ext_autodoc_autoclass.py
Line number range: 1 - 433
Content:
1. """
2.     test_ext_autodoc_autoclass
3.     ~~~~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from typing import List, Union
14. 
15. import pytest
16. 
17. from .test_ext_autodoc import do_autodoc
18. 
19. 
20. @pytest.mark.sphinx('html', testroot='ext-autodoc')
21. def test_classes(app):
22.     actual = do_autodoc(app, 'function', 'target.classes.Foo')
23.     assert list(actual) == [
24.         '',
25.         '.. py:function:: Foo()',
26.         '   :module: target.classes',
27.         '',
28.     ]
29. 
30.     actual = do_autodoc(app, 'function', 'target.classes.Bar')
31.     assert list(actual) == [
32.         '',
33.         '.. py:function:: Bar(x, y)',
34.         '   :module: target.classes',
35.         '',
36.     ]
37. 
38.     actual = do_autodoc(app, 'function', 'target.classes.Baz')
39.     assert list(actual) == [
40.         '',
41.         '.. py:function:: Baz(x, y)',
42.         '   :module: target.classes',
43.         '',
44.     ]
45. 
46.     actual = do_autodoc(app, 'function', 'target.classes.Qux')
47.     assert list(actual) == [
48.         '',
49.         '.. py:function:: Qux(foo, bar)',
50.         '   :module: target.classes',
51.         '',
52.     ]
53. 
54. 
55. @pytest.mark.sphinx('html', testroot='ext-autodoc')
56. def test_instance_variable(app):
57.     options = {'members': None}
58.     actual = do_autodoc(app, 'class', 'target.instance_variable.Bar', options)
59.     assert list(actual) == [
60.         '',
61.         '.. py:class:: Bar()',
62.         '   :module: target.instance_variable',
63.         '',
64.         '',
65.         '   .. py:attribute:: Bar.attr2',
66.         '      :module: target.instance_variable',
67.         '',
68.         '      docstring bar',
69.         '',
70.         '',
71.         '   .. py:attribute:: Bar.attr3',
72.         '      :module: target.instance_variable',
73.         '',
74.         '      docstring bar',
75.         '',
76.     ]
77. 
78. 
79. @pytest.mark.sphinx('html', testroot='ext-autodoc')
80. def test_inherited_instance_variable(app):
81.     options = {'members': None,
82.                'inherited-members': None}
83.     actual = do_autodoc(app, 'class', 'target.instance_variable.Bar', options)
84.     assert list(actual) == [
85.         '',
86.         '.. py:class:: Bar()',
87.         '   :module: target.instance_variable',
88.         '',
89.         '',
90.         '   .. py:attribute:: Bar.attr1',
91.         '      :module: target.instance_variable',
92.         '',
93.         '      docstring foo',
94.         '',
95.         '',
96.         '   .. py:attribute:: Bar.attr2',
97.         '      :module: target.instance_variable',
98.         '',
99.         '      docstring bar',
100.         '',
101.         '',
102.         '   .. py:attribute:: Bar.attr3',
103.         '      :module: target.instance_variable',
104.         '',
105.         '      docstring bar',
106.         '',
107.     ]
108. 
109. 
110. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
111. @pytest.mark.sphinx('html', testroot='ext-autodoc')
112. def test_uninitialized_attributes(app):
113.     options = {"members": None,
114.                "inherited-members": None}
115.     actual = do_autodoc(app, 'class', 'target.uninitialized_attributes.Derived', options)
116.     assert list(actual) == [
117.         '',
118.         '.. py:class:: Derived()',
119.         '   :module: target.uninitialized_attributes',
120.         '',
121.         '',
122.         '   .. py:attribute:: Derived.attr1',
123.         '      :module: target.uninitialized_attributes',
124.         '      :type: int',
125.         '',
126.         '      docstring',
127.         '',
128.         '',
129.         '   .. py:attribute:: Derived.attr3',
130.         '      :module: target.uninitialized_attributes',
131.         '      :type: int',
132.         '',
133.         '      docstring',
134.         '',
135.     ]
136. 
137. 
138. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
139. @pytest.mark.sphinx('html', testroot='ext-autodoc')
140. def test_undocumented_uninitialized_attributes(app):
141.     options = {"members": None,
142.                "inherited-members": None,
143.                "undoc-members": None}
144.     actual = do_autodoc(app, 'class', 'target.uninitialized_attributes.Derived', options)
145.     assert list(actual) == [
146.         '',
147.         '.. py:class:: Derived()',
148.         '   :module: target.uninitialized_attributes',
149.         '',
150.         '',
151.         '   .. py:attribute:: Derived.attr1',
152.         '      :module: target.uninitialized_attributes',
153.         '      :type: int',
154.         '',
155.         '      docstring',
156.         '',
157.         '',
158.         '   .. py:attribute:: Derived.attr2',
159.         '      :module: target.uninitialized_attributes',
160.         '      :type: str',
161.         '',
162.         '',
163.         '   .. py:attribute:: Derived.attr3',
164.         '      :module: target.uninitialized_attributes',
165.         '      :type: int',
166.         '',
167.         '      docstring',
168.         '',
169.         '',
170.         '   .. py:attribute:: Derived.attr4',
171.         '      :module: target.uninitialized_attributes',
172.         '      :type: str',
173.         '',
174.     ]
175. 
176. 
177. def test_decorators(app):
178.     actual = do_autodoc(app, 'class', 'target.decorator.Baz')
179.     assert list(actual) == [
180.         '',
181.         '.. py:class:: Baz(name=None, age=None)',
182.         '   :module: target.decorator',
183.         '',
184.     ]
185. 
186.     actual = do_autodoc(app, 'class', 'target.decorator.Qux')
187.     assert list(actual) == [
188.         '',
189.         '.. py:class:: Qux(name=None, age=None)',
190.         '   :module: target.decorator',
191.         '',
192.     ]
193. 
194.     actual = do_autodoc(app, 'class', 'target.decorator.Quux')
195.     assert list(actual) == [
196.         '',
197.         '.. py:class:: Quux(name=None, age=None)',
198.         '   :module: target.decorator',
199.         '',
200.     ]
201. 
202. 
203. @pytest.mark.sphinx('html', testroot='ext-autodoc')
204. def test_properties(app):
205.     options = {"members": None}
206.     actual = do_autodoc(app, 'class', 'target.properties.Foo', options)
207.     assert list(actual) == [
208.         '',
209.         '.. py:class:: Foo()',
210.         '   :module: target.properties',
211.         '',
212.         '   docstring',
213.         '',
214.         '',
215.         '   .. py:property:: Foo.prop1',
216.         '      :module: target.properties',
217.         '      :type: int',
218.         '',
219.         '      docstring',
220.         '',
221.         '',
222.         '   .. py:property:: Foo.prop2',
223.         '      :module: target.properties',
224.         '      :classmethod:',
225.         '      :type: int',
226.         '',
227.         '      docstring',
228.         '',
229.     ]
230. 
231. 
232. @pytest.mark.sphinx('html', testroot='ext-autodoc')
233. def test_slots_attribute(app):
234.     options = {"members": None}
235.     actual = do_autodoc(app, 'class', 'target.slots.Bar', options)
236.     assert list(actual) == [
237.         '',
238.         '.. py:class:: Bar()',
239.         '   :module: target.slots',
240.         '',
241.         '   docstring',
242.         '',
243.         '',
244.         '   .. py:attribute:: Bar.attr1',
245.         '      :module: target.slots',
246.         '',
247.         '      docstring of attr1',
248.         '',
249.         '',
250.         '   .. py:attribute:: Bar.attr2',
251.         '      :module: target.slots',
252.         '',
253.         '      docstring of instance attr2',
254.         '',
255.     ]
256. 
257. 
258. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
259. @pytest.mark.sphinx('html', testroot='ext-autodoc')
260. def test_show_inheritance_for_subclass_of_generic_type(app):
261.     options = {'show-inheritance': None}
262.     actual = do_autodoc(app, 'class', 'target.classes.Quux', options)
263.     assert list(actual) == [
264.         '',
265.         '.. py:class:: Quux(iterable=(), /)',
266.         '   :module: target.classes',
267.         '',
268.         '   Bases: :py:class:`~typing.List`\\ '
269.         '[:py:obj:`~typing.Union`\\ [:py:class:`int`, :py:class:`float`]]',
270.         '',
271.         '   A subclass of List[Union[int, float]]',
272.         '',
273.     ]
274. 
275. 
276. @pytest.mark.sphinx('html', testroot='ext-autodoc')
277. def test_autodoc_process_bases(app):
278.     def autodoc_process_bases(app, name, obj, options, bases):
279.         assert name == 'target.classes.Quux'
280.         assert obj.__module__ == 'target.classes'
281.         assert obj.__name__ == 'Quux'
282.         assert options == {'show-inheritance': True,
283.                            'members': []}
284.         assert bases == [List[Union[int, float]]]
285. 
286.         bases.pop()
287.         bases.extend([int, str])
288. 
289.     app.connect('autodoc-process-bases', autodoc_process_bases)
290. 
291.     options = {'show-inheritance': None}
292.     actual = do_autodoc(app, 'class', 'target.classes.Quux', options)
293.     if sys.version_info < (3, 7):
294.         assert list(actual) == [
295.             '',
296.             '.. py:class:: Quux(*args, **kwds)',
297.             '   :module: target.classes',
298.             '',
299.             '   Bases: :py:class:`int`, :py:class:`str`',
300.             '',
301.             '   A subclass of List[Union[int, float]]',
302.             '',
303.         ]
304.     else:
305.         assert list(actual) == [
306.             '',
307.             '.. py:class:: Quux(iterable=(), /)',
308.             '   :module: target.classes',
309.             '',
310.             '   Bases: :py:class:`int`, :py:class:`str`',
311.             '',
312.             '   A subclass of List[Union[int, float]]',
313.             '',
314.         ]
315. 
316. 
317. @pytest.mark.sphinx('html', testroot='ext-autodoc')
318. def test_class_doc_from_class(app):
319.     options = {"members": None,
320.                "class-doc-from": "class"}
321.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
322.     assert list(actual) == [
323.         '',
324.         '.. py:class:: C()',
325.         '   :module: target.autoclass_content',
326.         '',
327.         '   A class having __init__, no __new__',
328.         '',
329.     ]
330. 
331. 
332. @pytest.mark.sphinx('html', testroot='ext-autodoc')
333. def test_class_doc_from_init(app):
334.     options = {"members": None,
335.                "class-doc-from": "init"}
336.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
337.     assert list(actual) == [
338.         '',
339.         '.. py:class:: C()',
340.         '   :module: target.autoclass_content',
341.         '',
342.         '   __init__ docstring',
343.         '',
344.     ]
345. 
346. 
347. @pytest.mark.sphinx('html', testroot='ext-autodoc')
348. def test_class_doc_from_both(app):
349.     options = {"members": None,
350.                "class-doc-from": "both"}
351.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
352.     assert list(actual) == [
353.         '',
354.         '.. py:class:: C()',
355.         '   :module: target.autoclass_content',
356.         '',
357.         '   A class having __init__, no __new__',
358.         '',
359.         '   __init__ docstring',
360.         '',
361.     ]
362. 
363. 
364. def test_class_alias(app):
365.     def autodoc_process_docstring(*args):
366.         """A handler always raises an error.
367.         This confirms this handler is never called for class aliases.
368.         """
369.         raise
370. 
371.     app.connect('autodoc-process-docstring', autodoc_process_docstring)
372.     actual = do_autodoc(app, 'class', 'target.classes.Alias')
373.     assert list(actual) == [
374.         '',
375.         '.. py:attribute:: Alias',
376.         '   :module: target.classes',
377.         '',
378.         '   alias of :py:class:`target.classes.Foo`',
379.     ]
380. 
381. 
382. def test_class_alias_having_doccomment(app):
383.     actual = do_autodoc(app, 'class', 'target.classes.OtherAlias')
384.     assert list(actual) == [
385.         '',
386.         '.. py:attribute:: OtherAlias',
387.         '   :module: target.classes',
388.         '',
389.         '   docstring',
390.         '',
391.     ]
392. 
393. 
394. @pytest.mark.sphinx('html', testroot='ext-autodoc')
395. def test_coroutine(app):
396.     options = {"members": None}
397.     actual = do_autodoc(app, 'class', 'target.coroutine.AsyncClass', options)
398.     assert list(actual) == [
399.         '',
400.         '.. py:class:: AsyncClass()',
401.         '   :module: target.coroutine',
402.         '',
403.         '',
404.         '   .. py:method:: AsyncClass.do_asyncgen()',
405.         '      :module: target.coroutine',
406.         '      :async:',
407.         '',
408.         '      A documented async generator',
409.         '',
410.         '',
411.         '   .. py:method:: AsyncClass.do_coroutine()',
412.         '      :module: target.coroutine',
413.         '      :async:',
414.         '',
415.         '      A documented coroutine function',
416.         '',
417.         '',
418.         '   .. py:method:: AsyncClass.do_coroutine2()',
419.         '      :module: target.coroutine',
420.         '      :async:',
421.         '      :classmethod:',
422.         '',
423.         '      A documented coroutine classmethod',
424.         '',
425.         '',
426.         '   .. py:method:: AsyncClass.do_coroutine3()',
427.         '      :module: target.coroutine',
428.         '      :async:',
429.         '      :staticmethod:',
430.         '',
431.         '      A documented coroutine staticmethod',
432.         '',
433.     ]


File: tests/test_ext_autodoc_mock.py
Line number range: 1 - 152
Content:
1. """
2.     test_ext_autodoc_mock
3.     ~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import abc
12. import sys
13. from importlib import import_module
14. from typing import TypeVar
15. 
16. import pytest
17. 
18. from sphinx.ext.autodoc.mock import _MockModule, _MockObject, ismock, mock, undecorate
19. 
20. 
21. def test_MockModule():
22.     mock = _MockModule('mocked_module')
23.     assert isinstance(mock.some_attr, _MockObject)
24.     assert isinstance(mock.some_method, _MockObject)
25.     assert isinstance(mock.attr1.attr2, _MockObject)
26.     assert isinstance(mock.attr1.attr2.meth(), _MockObject)
27. 
28.     assert repr(mock.some_attr) == 'mocked_module.some_attr'
29.     assert repr(mock.some_method) == 'mocked_module.some_method'
30.     assert repr(mock.attr1.attr2) == 'mocked_module.attr1.attr2'
31.     assert repr(mock.attr1.attr2.meth) == 'mocked_module.attr1.attr2.meth'
32. 
33.     assert repr(mock) == 'mocked_module'
34. 
35. 
36. def test_MockObject():
37.     mock = _MockObject()
38.     assert isinstance(mock.some_attr, _MockObject)
39.     assert isinstance(mock.some_method, _MockObject)
40.     assert isinstance(mock.attr1.attr2, _MockObject)
41.     assert isinstance(mock.attr1.attr2.meth(), _MockObject)
42. 
43.     # subclassing
44.     class SubClass(mock.SomeClass):
45.         """docstring of SubClass"""
46. 
47.         def method(self):
48.             return "string"
49. 
50.     obj = SubClass()
51.     assert SubClass.__doc__ == "docstring of SubClass"
52.     assert isinstance(obj, SubClass)
53.     assert obj.method() == "string"
54.     assert isinstance(obj.other_method(), SubClass)
55. 
56.     # parametrized type
57.     T = TypeVar('T')
58. 
59.     class SubClass2(mock.SomeClass[T]):
60.         """docstring of SubClass"""
61. 
62.     obj2 = SubClass2()
63.     assert SubClass2.__doc__ == "docstring of SubClass"
64.     assert isinstance(obj2, SubClass2)
65. 
66. 
67. def test_mock():
68.     modname = 'sphinx.unknown'
69.     submodule = modname + '.submodule'
70.     assert modname not in sys.modules
71.     with pytest.raises(ImportError):
72.         import_module(modname)
73. 
74.     with mock([modname]):
75.         import_module(modname)
76.         assert modname in sys.modules
77.         assert isinstance(sys.modules[modname], _MockModule)
78. 
79.         # submodules are also mocked
80.         import_module(submodule)
81.         assert submodule in sys.modules
82.         assert isinstance(sys.modules[submodule], _MockModule)
83. 
84.     assert modname not in sys.modules
85.     with pytest.raises(ImportError):
86.         import_module(modname)
87. 
88. 
89. def test_mock_does_not_follow_upper_modules():
90.     with mock(['sphinx.unknown.module']):
91.         with pytest.raises(ImportError):
92.             import_module('sphinx.unknown')
93. 
94. 
95. @pytest.mark.skipif(sys.version_info < (3, 7), reason='Only for py37 or above')
96. def test_abc_MockObject():
97.     mock = _MockObject()
98. 
99.     class Base:
100.         @abc.abstractmethod
101.         def __init__(self):
102.             pass
103. 
104.     class Derived(Base, mock.SubClass):
105.         pass
106. 
107.     obj = Derived()
108.     assert isinstance(obj, Base)
109.     assert isinstance(obj, _MockObject)
110.     assert isinstance(obj.some_method(), Derived)
111. 
112. 
113. def test_mock_decorator():
114.     mock = _MockObject()
115. 
116.     @mock.function_deco
117.     def func():
118.         pass
119. 
120.     class Foo:
121.         @mock.method_deco
122.         def meth(self):
123.             pass
124. 
125.     @mock.class_deco
126.     class Bar:
127.         pass
128. 
129.     @mock.funcion_deco(Foo)
130.     class Baz:
131.         pass
132. 
133.     assert undecorate(func).__name__ == "func"
134.     assert undecorate(Foo.meth).__name__ == "meth"
135.     assert undecorate(Bar).__name__ == "Bar"
136.     assert undecorate(Baz).__name__ == "Baz"
137. 
138. 
139. def test_ismock():
140.     with mock(['sphinx.unknown']):
141.         mod1 = import_module('sphinx.unknown')
142.         mod2 = import_module('sphinx.application')
143. 
144.         class Inherited(mod1.Class):
145.             pass
146. 
147.         assert ismock(mod1) is True
148.         assert ismock(mod1.Class) is True
149.         assert ismock(Inherited) is False
150. 
151.         assert ismock(mod2) is False
152.         assert ismock(mod2.Sphinx) is False

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 04:15:32,782 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The current context contains tests for autodoc on classes and for the mocking utility separately, but lacks a test case that combines these to replicate the user's bug scenario. Specifically, there's no test that autodocuments a class inheriting from a mocked base class and checks the `:show-inheritance:` output. Additionally, the full implementation of `sphinx/ext/autodoc/__init__.py`, where the patch is applied, is needed to understand the `ClassDocumenter`'s logic for handling base classes." query='Please provide the full content of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py`.' extra_requirements='' purpose='This will allow me to find a test case that covers inheritance from mocked objects and to examine the code in `ClassDocumenter` that generates the "Bases" list, which is directly related to the bug.'
2025-12-24 04:15:32,783 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py`.
2025-12-24 04:15:32,783 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 04:15:32,784 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 04:15:32,785 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 04:15:32,785 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py`.
Purpose: This will allow me to find a test case that covers inheritance from mocked objects and to examine the code in `ClassDocumenter` that generates the "Bases" list, which is directly related to the bug.
2025-12-24 04:15:35,427 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the full content of both `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py` as you requested. This will allow you to analyze the test cases and the implementation of `ClassDocumenter` to understand the bug related to the "Bases" list generation for mocked objects.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "sphinx/ext/autodoc/__init__.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2110, 'candidates_token_count': 120, 'total_token_count': 2364, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2110}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 120}], 'thoughts_token_count': 134, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.06915691693623861, 'model_name': 'gemini-2.5-pro'} id='run--1847dc03-cd70-429d-8585-49191d84e408-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc.py'}, 'id': '2c2585d9-8f57-4be8-aae6-f89abd6b9403', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'sphinx/ext/autodoc/__init__.py'}, 'id': '86b0c72e-acff-480d-89a7-b23368d81fce', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2110, 'output_tokens': 120, 'total_tokens': 2364, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 134}}
2025-12-24 04:15:39,169 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the contents of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py`. Now, I will proceed to find the relevant sections within these files to address the user\'s query about inheritance from mocked objects and the "Bases" list generation in `ClassDocumenter`. I will start by searching for the term "Bases" within the `sphinx/ext/autodoc/__init__.py` file to locate the code responsible for generating the "Bases" list.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "sphinx/ext/autodoc/__init__.py", "text": "Bases"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 16828, 'candidates_token_count': 147, 'total_token_count': 17197, 'cached_content_token_count': 1876, 'prompt_tokens_details': [{'modality': 1, 'token_count': 16828}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1876}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 147}], 'thoughts_token_count': 222}, 'finish_reason': 'STOP', 'avg_logprobs': -0.14791514597782474, 'model_name': 'gemini-2.5-pro'} id='run--f045dfaf-7e60-40ac-9f5c-a1fec8a65952-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'sphinx/ext/autodoc/__init__.py', 'text': 'Bases'}, 'id': 'bc453627-0000-4d39-8829-4699cc0d0431', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16828, 'output_tokens': 147, 'total_tokens': 17197, 'input_token_details': {'cache_read': 1876}, 'output_token_details': {'reasoning': 222}}
2025-12-24 04:15:43,097 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I\'ve located the `ClassDocumenter` in `sphinx/ext/autodoc/__init__.py` and its `add_directive_header` method, which handles the "Bases" list. This method uses `__orig_bases__` and `__bases__` to determine the inheritance hierarchy. Now I will search `tests/test_ext_autodoc.py` for "mock" and "inheritance" to find a relevant test case for mocked object inheritance.' additional_kwargs={'function_call': {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'arguments': '{"relative_path": "tests/test_ext_autodoc.py", "text": "inheritance"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 21292, 'candidates_token_count': 168, 'total_token_count': 21629, 'prompt_tokens_details': [{'modality': 1, 'token_count': 21292}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 168}], 'thoughts_token_count': 169, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.14826214881170363, 'model_name': 'gemini-2.5-pro'} id='run--1dc044c7-86ed-4c18-bbec-2540ad6a5691-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/test_ext_autodoc.py', 'text': 'mock'}, 'id': '4c514490-d8c6-48ac-92e3-ebee6f8674c0', 'type': 'tool_call'}, {'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'relative_path': 'tests/test_ext_autodoc.py', 'text': 'inheritance'}, 'id': 'e648a832-38d4-46af-b8e3-678c1afb27b1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21292, 'output_tokens': 168, 'total_tokens': 21629, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 169}}
2025-12-24 04:15:47,679 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the `ClassDocumenter` and its `add_directive_header` method, which is responsible for generating the "Bases" list. I have also examined the existing test cases in `tests/test_ext_autodoc.py` but found that none of them specifically cover inheritance from mocked objects. To properly investigate the bug, I will now add a new test case to `tests/test_ext_autodoc.py` that creates a class inheriting from a mocked object and documents it, which will allow me to observe and debug the "Bases" list generation.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/test_ext_autodoc.py"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 22802, 'candidates_token_count': 146, 'total_token_count': 23177, 'cached_content_token_count': 15112, 'prompt_tokens_details': [{'modality': 1, 'token_count': 22802}], 'cache_tokens_details': [{'modality': 1, 'token_count': 15112}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 146}], 'thoughts_token_count': 229}, 'finish_reason': 'STOP', 'avg_logprobs': -0.2807036099368579, 'model_name': 'gemini-2.5-pro'} id='run--c381dba5-ae94-46ac-ae42-4b3b2e6d0407-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc.py'}, 'id': '30834775-fd8f-4cbb-b09b-35e2f86ab610', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22802, 'output_tokens': 146, 'total_tokens': 23177, 'input_token_details': {'cache_read': 15112}, 'output_token_details': {'reasoning': 229}}
2025-12-24 04:17:08,974 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have analyzed the provided files, locating the `ClassDocumenter` and confirming the absence of a test for inheritance from mocked objects. To address this, I will now retrieve the full content of `tests/test_ext_autodoc.py` so I can add a new test case to reproduce the bug.' additional_kwargs={'function_call': {'name': 'read_code_with_relative_path', 'arguments': '{"start_line": 501.0, "relative_path": "tests/test_ext_autodoc.py", "end_line": 4000.0}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 2382, 'end_index': 2893, 'uri': 'https://github.com/timoludwig/sphinxcontrib-django2', 'license_': 'Apache-2.0', 'title': ''}, {'start_index': 4920, 'end_index': 5310, 'uri': 'https://github.com/makinteract/vscode-microbit-micropython', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 30383, 'candidates_token_count': 94, 'total_token_count': 39009, 'cached_content_token_count': 22800, 'prompt_tokens_details': [{'modality': 1, 'token_count': 30383}], 'cache_tokens_details': [{'modality': 1, 'token_count': 22800}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 94}], 'thoughts_token_count': 8532}, 'finish_reason': 'STOP', 'avg_logprobs': -14.325474515874335, 'model_name': 'gemini-2.5-pro'} id='run--6a567cdf-d91f-41b7-a0de-0ab76d3c3813-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'start_line': 501.0, 'relative_path': 'tests/test_ext_autodoc.py', 'end_line': 4000.0}, 'id': 'b9061964-d6f8-4fb1-8157-8f8f6b37ad47', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30383, 'output_tokens': 94, 'total_tokens': 39009, 'input_token_details': {'cache_read': 22800}, 'output_token_details': {'reasoning': 8532}}
2025-12-24 04:17:25,004 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have successfully retrieved the full content of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py` as you requested. I located the `ClassDocumenter` and its `add_directive_header` method, which is responsible for generating the "Bases" list. I also confirmed that there are no existing test cases in `tests/test_ext_autodoc.py` that specifically cover inheritance from mocked objects, which will be necessary to reproduce and fix the bug.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'citation_metadata': {'citations': [{'start_index': 1980, 'end_index': 2481, 'uri': 'https://github.com/makinteract/vscode-microbit-micropython', 'title': '', 'license_': ''}]}, 'usage_metadata': {'prompt_token_count': 61494, 'candidates_token_count': 110, 'total_token_count': 62759, 'prompt_tokens_details': [{'modality': 1, 'token_count': 61494}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 110}], 'thoughts_token_count': 1155, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -1.0715262673117898, 'model_name': 'gemini-2.5-pro'} id='run--5bf344b8-8a31-4694-8a8e-f4a4256b3a21-0' usage_metadata={'input_tokens': 61494, 'output_tokens': 110, 'total_tokens': 62759, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 1155}}
2025-12-24 04:17:25,007 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py`.
--- END QUERY ---



--- BEGIN PURPOSE ---
This will allow me to find a test case that covers inheritance from mocked objects and to examine the code in `ClassDocumenter` that generates the "Bases" list, which is directly related to the bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: sphinx/ext/autodoc/__init__.py
Line number range: 1 - 500
Content:
1. """
2.     sphinx.ext.autodoc
3.     ~~~~~~~~~~~~~~~~~~
4. 
5.     Automatically insert docstrings for functions, classes or whole modules into
6.     the doctree, thus avoiding duplication between docstrings and documentation
7.     for those who like elaborate docstrings.
8. 
9.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
10.     :license: BSD, see LICENSE for details.
11. """
12. 
13. import re
14. import warnings
15. from inspect import Parameter, Signature
16. from types import ModuleType
17. from typing import (TYPE_CHECKING, Any, Callable, Dict, Iterator, List, Optional, Sequence,
18.                     Set, Tuple, Type, TypeVar, Union)
19. 
20. from docutils.statemachine import StringList
21. 
22. import sphinx
23. from sphinx.application import Sphinx
24. from sphinx.config import ENUM, Config
25. from sphinx.deprecation import RemovedInSphinx50Warning, RemovedInSphinx60Warning
26. from sphinx.environment import BuildEnvironment
27. from sphinx.ext.autodoc.importer import (get_class_members, get_object_members, import_module,
28.                                          import_object)
29. from sphinx.ext.autodoc.mock import ismock, mock, undecorate
30. from sphinx.locale import _, __
31. from sphinx.pycode import ModuleAnalyzer, PycodeError
32. from sphinx.util import inspect, logging
33. from sphinx.util.docstrings import prepare_docstring, separate_metadata
34. from sphinx.util.inspect import (evaluate_signature, getdoc, object_description, safe_getattr,
35.                                  stringify_signature)
36. from sphinx.util.typing import OptionSpec, get_type_hints, restify
37. from sphinx.util.typing import stringify as stringify_typehint
38. 
39. if TYPE_CHECKING:
40.     from sphinx.ext.autodoc.directive import DocumenterBridge
41. 
42. 
43. logger = logging.getLogger(__name__)
44. 
45. 
46. # This type isn't exposed directly in any modules, but can be found
47. # here in most Python versions
48. MethodDescriptorType = type(type.__subclasses__)
49. 
50. 
51. #: extended signature RE: with explicit module name separated by ::
52. py_ext_sig_re = re.compile(
53.     r'''^ ([\w.]+::)?            # explicit module name
54.           ([\w.]+\.)?            # module and/or class name(s)
55.           (\w+)  \s*             # thing name
56.           (?: \((.*)\)           # optional: arguments
57.            (?:\s* -> \s* (.*))?  #           return annotation
58.           )? $                   # and nothing more
59.           ''', re.VERBOSE)
60. special_member_re = re.compile(r'^__\S+__$')
61. 
62. 
63. def identity(x: Any) -> Any:
64.     return x
65. 
66. 
67. class _All:
68.     """A special value for :*-members: that matches to any member."""
69. 
70.     def __contains__(self, item: Any) -> bool:
71.         return True
72. 
73.     def append(self, item: Any) -> None:
74.         pass  # nothing
75. 
76. 
77. class _Empty:
78.     """A special value for :exclude-members: that never matches to any member."""
79. 
80.     def __contains__(self, item: Any) -> bool:
81.         return False
82. 
83. 
84. ALL = _All()
85. EMPTY = _Empty()
86. UNINITIALIZED_ATTR = object()
87. INSTANCEATTR = object()
88. SLOTSATTR = object()
89. 
90. 
91. def members_option(arg: Any) -> Union[object, List[str]]:
92.     """Used to convert the :members: option to auto directives."""
93.     if arg in (None, True):
94.         return ALL
95.     elif arg is False:
96.         return None
97.     else:
98.         return [x.strip() for x in arg.split(',') if x.strip()]
99. 
100. 
101. def members_set_option(arg: Any) -> Union[object, Set[str]]:
102.     """Used to convert the :members: option to auto directives."""
103.     warnings.warn("members_set_option() is deprecated.",
104.                   RemovedInSphinx50Warning, stacklevel=2)
105.     if arg is None:
106.         return ALL
107.     return {x.strip() for x in arg.split(',') if x.strip()}
108. 
109. 
110. def exclude_members_option(arg: Any) -> Union[object, Set[str]]:
111.     """Used to convert the :exclude-members: option."""
112.     if arg in (None, True):
113.         return EMPTY
114.     return {x.strip() for x in arg.split(',') if x.strip()}
115. 
116. 
117. def inherited_members_option(arg: Any) -> Union[object, Set[str]]:
118.     """Used to convert the :members: option to auto directives."""
119.     if arg in (None, True):
120.         return 'object'
121.     else:
122.         return arg
123. 
124. 
125. def member_order_option(arg: Any) -> Optional[str]:
126.     """Used to convert the :members: option to auto directives."""
127.     if arg in (None, True):
128.         return None
129.     elif arg in ('alphabetical', 'bysource', 'groupwise'):
130.         return arg
131.     else:
132.         raise ValueError(__('invalid value for member-order option: %s') % arg)
133. 
134. 
135. def class_doc_from_option(arg: Any) -> Optional[str]:
136.     """Used to convert the :class-doc-from: option to autoclass directives."""
137.     if arg in ('both', 'class', 'init'):
138.         return arg
139.     else:
140.         raise ValueError(__('invalid value for class-doc-from option: %s') % arg)
141. 
142. 
143. SUPPRESS = object()
144. 
145. 
146. def annotation_option(arg: Any) -> Any:
147.     if arg in (None, True):
148.         # suppress showing the representation of the object
149.         return SUPPRESS
150.     else:
151.         return arg
152. 
153. 
154. def bool_option(arg: Any) -> bool:
155.     """Used to convert flag options to auto directives.  (Instead of
156.     directives.flag(), which returns None).
157.     """
158.     return True
159. 
160. 
161. def merge_special_members_option(options: Dict) -> None:
162.     """Merge :special-members: option to :members: option."""
163.     warnings.warn("merge_special_members_option() is deprecated.",
164.                   RemovedInSphinx50Warning, stacklevel=2)
165.     if 'special-members' in options and options['special-members'] is not ALL:
166.         if options.get('members') is ALL:
167.             pass
168.         elif options.get('members'):
169.             for member in options['special-members']:
170.                 if member not in options['members']:
171.                     options['members'].append(member)
172.         else:
173.             options['members'] = options['special-members']
174. 
175. 
176. def merge_members_option(options: Dict) -> None:
177.     """Merge :*-members: option to the :members: option."""
178.     if options.get('members') is ALL:
179.         # merging is not needed when members: ALL
180.         return
181. 
182.     members = options.setdefault('members', [])
183.     for key in {'private-members', 'special-members'}:
184.         if key in options and options[key] not in (ALL, None):
185.             for member in options[key]:
186.                 if member not in members:
187.                     members.append(member)
188. 
189. 
190. # Some useful event listener factories for autodoc-process-docstring.
191. 
192. def cut_lines(pre: int, post: int = 0, what: str = None) -> Callable:
193.     """Return a listener that removes the first *pre* and last *post*
194.     lines of every docstring.  If *what* is a sequence of strings,
195.     only docstrings of a type in *what* will be processed.
196. 
197.     Use like this (e.g. in the ``setup()`` function of :file:`conf.py`)::
198. 
199.        from sphinx.ext.autodoc import cut_lines
200.        app.connect('autodoc-process-docstring', cut_lines(4, what=['module']))
201. 
202.     This can (and should) be used in place of :confval:`automodule_skip_lines`.
203.     """
204.     def process(app: Sphinx, what_: str, name: str, obj: Any, options: Any, lines: List[str]
205.                 ) -> None:
206.         if what and what_ not in what:
207.             return
208.         del lines[:pre]
209.         if post:
210.             # remove one trailing blank line.
211.             if lines and not lines[-1]:
212.                 lines.pop(-1)
213.             del lines[-post:]
214.         # make sure there is a blank line at the end
215.         if lines and lines[-1]:
216.             lines.append('')
217.     return process
218. 
219. 
220. def between(marker: str, what: Sequence[str] = None, keepempty: bool = False,
221.             exclude: bool = False) -> Callable:
222.     """Return a listener that either keeps, or if *exclude* is True excludes,
223.     lines between lines that match the *marker* regular expression.  If no line
224.     matches, the resulting docstring would be empty, so no change will be made
225.     unless *keepempty* is true.
226. 
227.     If *what* is a sequence of strings, only docstrings of a type in *what* will
228.     be processed.
229.     """
230.     marker_re = re.compile(marker)
231. 
232.     def process(app: Sphinx, what_: str, name: str, obj: Any, options: Any, lines: List[str]
233.                 ) -> None:
234.         if what and what_ not in what:
235.             return
236.         deleted = 0
237.         delete = not exclude
238.         orig_lines = lines[:]
239.         for i, line in enumerate(orig_lines):
240.             if delete:
241.                 lines.pop(i - deleted)
242.                 deleted += 1
243.             if marker_re.match(line):
244.                 delete = not delete
245.                 if delete:
246.                     lines.pop(i - deleted)
247.                     deleted += 1
248.         if not lines and not keepempty:
249.             lines[:] = orig_lines
250.         # make sure there is a blank line at the end
251.         if lines and lines[-1]:
252.             lines.append('')
253.     return process
254. 
255. 
256. # This class is used only in ``sphinx.ext.autodoc.directive``,
257. # But we define this class here to keep compatibility (see #4538)
258. class Options(dict):
259.     """A dict/attribute hybrid that returns None on nonexisting keys."""
260.     def copy(self) -> "Options":
261.         return Options(super().copy())
262. 
263.     def __getattr__(self, name: str) -> Any:
264.         try:
265.             return self[name.replace('_', '-')]
266.         except KeyError:
267.             return None
268. 
269. 
270. class ObjectMember(tuple):
271.     """A member of object.
272. 
273.     This is used for the result of `Documenter.get_object_members()` to
274.     represent each member of the object.
275. 
276.     .. Note::
277. 
278.        An instance of this class behaves as a tuple of (name, object)
279.        for compatibility to old Sphinx.  The behavior will be dropped
280.        in the future.  Therefore extensions should not use the tuple
281.        interface.
282.     """
283. 
284.     def __new__(cls, name: str, obj: Any, **kwargs: Any) -> Any:
285.         return super().__new__(cls, (name, obj))  # type: ignore
286. 
287.     def __init__(self, name: str, obj: Any, docstring: Optional[str] = None,
288.                  class_: Any = None, skipped: bool = False) -> None:
289.         self.__name__ = name
290.         self.object = obj
291.         self.docstring = docstring
292.         self.skipped = skipped
293.         self.class_ = class_
294. 
295. 
296. ObjectMembers = Union[List[ObjectMember], List[Tuple[str, Any]]]
297. 
298. 
299. class Documenter:
300.     """
301.     A Documenter knows how to autodocument a single object type.  When
302.     registered with the AutoDirective, it will be used to document objects
303.     of that type when needed by autodoc.
304. 
305.     Its *objtype* attribute selects what auto directive it is assigned to
306.     (the directive name is 'auto' + objtype), and what directive it generates
307.     by default, though that can be overridden by an attribute called
308.     *directivetype*.
309. 
310.     A Documenter has an *option_spec* that works like a docutils directive's;
311.     in fact, it will be used to parse an auto directive's options that matches
312.     the Documenter.
313.     """
314.     #: name by which the directive is called (auto...) and the default
315.     #: generated directive name
316.     objtype = 'object'
317.     #: indentation by which to indent the directive content
318.     content_indent = '   '
319.     #: priority if multiple documenters return True from can_document_member
320.     priority = 0
321.     #: order if autodoc_member_order is set to 'groupwise'
322.     member_order = 0
323.     #: true if the generated content may contain titles
324.     titles_allowed = False
325. 
326.     option_spec: OptionSpec = {
327.         'noindex': bool_option
328.     }
329. 
330.     def get_attr(self, obj: Any, name: str, *defargs: Any) -> Any:
331.         """getattr() override for types such as Zope interfaces."""
332.         return autodoc_attrgetter(self.env.app, obj, name, *defargs)
333. 
334.     @classmethod
335.     def can_document_member(cls, member: Any, membername: str, isattr: bool, parent: Any
336.                             ) -> bool:
337.         """Called to see if a member can be documented by this Documenter."""
338.         raise NotImplementedError('must be implemented in subclasses')
339. 
340.     def __init__(self, directive: "DocumenterBridge", name: str, indent: str = '') -> None:
341.         self.directive = directive
342.         self.config: Config = directive.env.config
343.         self.env: BuildEnvironment = directive.env
344.         self.options = directive.genopt
345.         self.name = name
346.         self.indent = indent
347.         # the module and object path within the module, and the fully
348.         # qualified name (all set after resolve_name succeeds)
349.         self.modname: str = None
350.         self.module: ModuleType = None
351.         self.objpath: List[str] = None
352.         self.fullname: str = None
353.         # extra signature items (arguments and return annotation,
354.         # also set after resolve_name succeeds)
355.         self.args: str = None
356.         self.retann: str = None
357.         # the object to document (set after import_object succeeds)
358.         self.object: Any = None
359.         self.object_name: str = None
360.         # the parent/owner of the object to document
361.         self.parent: Any = None
362.         # the module analyzer to get at attribute docs, or None
363.         self.analyzer: ModuleAnalyzer = None
364. 
365.     @property
366.     def documenters(self) -> Dict[str, Type["Documenter"]]:
367.         """Returns registered Documenter classes"""
368.         return self.env.app.registry.documenters
369. 
370.     def add_line(self, line: str, source: str, *lineno: int) -> None:
371.         """Append one line of generated reST to the output."""
372.         if line.strip():  # not a blank line
373.             self.directive.result.append(self.indent + line, source, *lineno)
374.         else:
375.             self.directive.result.append('', source, *lineno)
376. 
377.     def resolve_name(self, modname: str, parents: Any, path: str, base: Any
378.                      ) -> Tuple[str, List[str]]:
379.         """Resolve the module and name of the object to document given by the
380.         arguments and the current module/class.
381. 
382.         Must return a pair of the module name and a chain of attributes; for
383.         example, it would return ``('zipfile', ['ZipFile', 'open'])`` for the
384.         ``zipfile.ZipFile.open`` method.
385.         """
386.         raise NotImplementedError('must be implemented in subclasses')
387. 
388.     def parse_name(self) -> bool:
389.         """Determine what module to import and what attribute to document.
390. 
391.         Returns True and sets *self.modname*, *self.objpath*, *self.fullname*,
392.         *self.args* and *self.retann* if parsing and resolving was successful.
393.         """
394.         # first, parse the definition -- auto directives for classes and
395.         # functions can contain a signature which is then used instead of
396.         # an autogenerated one
397.         try:
398.             matched = py_ext_sig_re.match(self.name)
399.             explicit_modname, path, base, args, retann = matched.groups()
400.         except AttributeError:
401.             logger.warning(__('invalid signature for auto%s (%r)') % (self.objtype, self.name),
402.                            type='autodoc')
403.             return False
404. 
405.         # support explicit module and class name separation via ::
406.         if explicit_modname is not None:
407.             modname = explicit_modname[:-2]
408.             parents = path.rstrip('.').split('.') if path else []
409.         else:
410.             modname = None
411.             parents = []
412. 
413.         with mock(self.config.autodoc_mock_imports):
414.             self.modname, self.objpath = self.resolve_name(modname, parents, path, base)
415. 
416.         if not self.modname:
417.             return False
418. 
419.         self.args = args
420.         self.retann = retann
421.         self.fullname = ((self.modname or '') +
422.                          ('.' + '.'.join(self.objpath) if self.objpath else ''))
423.         return True
424. 
425.     def import_object(self, raiseerror: bool = False) -> bool:
426.         """Import the object given by *self.modname* and *self.objpath* and set
427.         it as *self.object*.
428. 
429.         Returns True if successful, False if an error occurred.
430.         """
431.         with mock(self.config.autodoc_mock_imports):
432.             try:
433.                 ret = import_object(self.modname, self.objpath, self.objtype,
434.                                     attrgetter=self.get_attr,
435.                                     warningiserror=self.config.autodoc_warningiserror)
436.                 self.module, self.parent, self.object_name, self.object = ret
437.                 if ismock(self.object):
438.                     self.object = undecorate(self.object)
439.                 return True
440.             except ImportError as exc:
441.                 if raiseerror:
442.                     raise
443.                 else:
444.                     logger.warning(exc.args[0], type='autodoc', subtype='import_object')
445.                     self.env.note_reread()
446.                     return False
447. 
448.     def get_real_modname(self) -> str:
449.         """Get the real module name of an object to document.
450. 
451.         It can differ from the name of the module through which the object was
452.         imported.
453.         """
454.         return self.get_attr(self.object, '__module__', None) or self.modname
455. 
456.     def check_module(self) -> bool:
457.         """Check if *self.object* is really defined in the module given by
458.         *self.modname*.
459.         """
460.         if self.options.imported_members:
461.             return True
462. 
463.         subject = inspect.unpartial(self.object)
464.         modname = self.get_attr(subject, '__module__', None)
465.         if modname and modname != self.modname:
466.             return False
467.         return True
468. 
469.     def format_args(self, **kwargs: Any) -> str:
470.         """Format the argument signature of *self.object*.
471. 
472.         Should return None if the object does not have a signature.
473.         """
474.         return None
475. 
476.     def format_name(self) -> str:
477.         """Format the name of *self.object*.
478. 
479.         This normally should be something that can be parsed by the generated
480.         directive, but doesn't need to be (Sphinx will display it unparsed
481.         then).
482.         """
483.         # normally the name doesn't contain the module (except for module
484.         # directives of course)
485.         return '.'.join(self.objpath) or self.modname
486. 
487.     def _call_format_args(self, **kwargs: Any) -> str:
488.         if kwargs:
489.             try:
490.                 return self.format_args(**kwargs)
491.             except TypeError:
492.                 # avoid chaining exceptions, by putting nothing here
493.                 pass
494. 
495.         # retry without arguments for old documenters
496.         return self.format_args()
497. 
498.     def format_signature(self, **kwargs: Any) -> str:
499.         """Format the signature (arguments and return annotation) of the object.
500.


File: sphinx/ext/autodoc/__init__.py
Line number range: 1434 - 1776
Content:
class ClassDocumenter(DocstringSignatureMixin, ModuleLevelDocumenter):  # type: ignore
    """
    Specialized Documenter subclass for classes.
    """
    objtype = 'class'
    member_order = 20
    option_spec: OptionSpec = {
        'members': members_option, 'undoc-members': bool_option,
        'noindex': bool_option, 'inherited-members': inherited_members_option,
        'show-inheritance': bool_option, 'member-order': member_order_option,
        'exclude-members': exclude_members_option,
        'private-members': members_option, 'special-members': members_option,
        'class-doc-from': class_doc_from_option,
    }

    _signature_class: Any = None
    _signature_method_name: str = None

    def __init__(self, *args: Any) -> None:
        super().__init__(*args)

        if self.config.autodoc_class_signature == 'separated':
            self.options = self.options.copy()

            # show __init__() method
            if self.options.special_members is None:
                self.options['special-members'] = ['__new__', '__init__']
            else:
                self.options.special_members.append('__new__')
                self.options.special_members.append('__init__')

        merge_members_option(self.options)

    @classmethod
    def can_document_member(cls, member: Any, membername: str, isattr: bool, parent: Any
                            ) -> bool:
        return isinstance(member, type)

    def import_object(self, raiseerror: bool = False) -> bool:
        ret = super().import_object(raiseerror)
        # if the class is documented under another name, document it
        # as data/attribute
        if ret:
            if hasattr(self.object, '__name__'):
                self.doc_as_attr = (self.objpath[-1] != self.object.__name__)
            else:
                self.doc_as_attr = True
        return ret

    def _get_signature(self) -> Tuple[Optional[Any], Optional[str], Optional[Signature]]:
        def get_user_defined_function_or_method(obj: Any, attr: str) -> Any:
            """ Get the `attr` function or method from `obj`, if it is user-defined. """
            if inspect.is_builtin_class_method(obj, attr):
                return None
            attr = self.get_attr(obj, attr, None)
            if not (inspect.ismethod(attr) or inspect.isfunction(attr)):
                return None
            return attr

        # This sequence is copied from inspect._signature_from_callable.
        # ValueError means that no signature could be found, so we keep going.

        # First, we check the obj has a __signature__ attribute
        if (hasattr(self.object, '__signature__') and
                isinstance(self.object.__signature__, Signature)):
            return None, None, self.object.__signature__

        # Next, let's see if it has an overloaded __call__ defined
        # in its metaclass
        call = get_user_defined_function_or_method(type(self.object), '__call__')

        if call is not None:
            if "{0.__module__}.{0.__qualname__}".format(call) in _METACLASS_CALL_BLACKLIST:
                call = None

        if call is not None:
            self.env.app.emit('autodoc-before-process-signature', call, True)
            try:
                sig = inspect.signature(call, bound_method=True,
                                        type_aliases=self.config.autodoc_type_aliases)
                return type(self.object), '__call__', sig
            except ValueError:
                pass

        # Now we check if the 'obj' class has a '__new__' method
        new = get_user_defined_function_or_method(self.object, '__new__')

        if new is not None:
            if "{0.__module__}.{0.__qualname__}".format(new) in _CLASS_NEW_BLACKLIST:
                new = None

        if new is not None:
            self.env.app.emit('autodoc-before-process-signature', new, True)
            try:
                sig = inspect.signature(new, bound_method=True,
                                        type_aliases=self.config.autodoc_type_aliases)
                return self.object, '__new__', sig
            except ValueError:
                pass

        # Finally, we should have at least __init__ implemented
        init = get_user_defined_function_or_method(self.object, '__init__')
        if init is not None:
            self.env.app.emit('autodoc-before-process-signature', init, True)
            try:
                sig = inspect.signature(init, bound_method=True,
                                        type_aliases=self.config.autodoc_type_aliases)
                return self.object, '__init__', sig
            except ValueError:
                pass

        # None of the attributes are user-defined, so fall back to let inspect
        # handle it.
        # We don't know the exact method that inspect.signature will read
        # the signature from, so just pass the object itself to our hook.
        self.env.app.emit('autodoc-before-process-signature', self.object, False)
        try:
            sig = inspect.signature(self.object, bound_method=False,
                                    type_aliases=self.config.autodoc_type_aliases)
            return None, None, sig
        except ValueError:
            pass

        # Still no signature: happens e.g. for old-style classes
        # with __init__ in C and no `__text_signature__`.
        return None, None, None

    def format_args(self, **kwargs: Any) -> str:
        if self.config.autodoc_typehints in ('none', 'description'):
            kwargs.setdefault('show_annotation', False)

        try:
            self._signature_class, self._signature_method_name, sig = self._get_signature()
        except TypeError as exc:
            # __signature__ attribute contained junk
            logger.warning(__("Failed to get a constructor signature for %s: %s"),
                           self.fullname, exc)
            return None

        if sig is None:
            return None

        return stringify_signature(sig, show_return_annotation=False, **kwargs)

    def format_signature(self, **kwargs: Any) -> str:
        if self.doc_as_attr:
            return ''
        if self.config.autodoc_class_signature == 'separated':
            # do not show signatures
            return ''

        sig = super().format_signature()
        sigs = []

        overloads = self.get_overloaded_signatures()
        if overloads and self.config.autodoc_typehints != 'none':
            # Use signatures for overloaded methods instead of the implementation method.
            method = safe_getattr(self._signature_class, self._signature_method_name, None)
            __globals__ = safe_getattr(method, '__globals__', {})
            for overload in overloads:
                overload = evaluate_signature(overload, __globals__,
                                              self.config.autodoc_type_aliases)

                parameters = list(overload.parameters.values())
                overload = overload.replace(parameters=parameters[1:],
                                            return_annotation=Parameter.empty)
                sig = stringify_signature(overload, **kwargs)
                sigs.append(sig)
        else:
            sigs.append(sig)

        return "\n".join(sigs)

    def get_overloaded_signatures(self) -> List[Signature]:
        if self._signature_class and self._signature_method_name:
            for cls in self._signature_class.__mro__:
                try:
                    analyzer = ModuleAnalyzer.for_module(cls.__module__)
                    analyzer.analyze()
                    qualname = '.'.join([cls.__qualname__, self._signature_method_name])
                    if qualname in analyzer.overloads:
                        return analyzer.overloads.get(qualname)
                    elif qualname in analyzer.tagorder:
                        # the constructor is defined in the class, but not overridden.
                        return []
                except PycodeError:
                    pass

        return []

    def get_canonical_fullname(self) -> Optional[str]:
        __modname__ = safe_getattr(self.object, '__module__', self.modname)
        __qualname__ = safe_getattr(self.object, '__qualname__', None)
        if __qualname__ is None:
            __qualname__ = safe_getattr(self.object, '__name__', None)
        if __qualname__ and '<locals>' in __qualname__:
            # No valid qualname found if the object is defined as locals
            __qualname__ = None

        if __modname__ and __qualname__:
            return '.'.join([__modname__, __qualname__])
        else:
            return None

    def add_directive_header(self, sig: str) -> None:
        sourcename = self.get_sourcename()

        if self.doc_as_attr:
            self.directivetype = 'attribute'
        super().add_directive_header(sig)

        if self.analyzer and '.'.join(self.objpath) in self.analyzer.finals:
            self.add_line('   :final:', sourcename)

        canonical_fullname = self.get_canonical_fullname()
        if not self.doc_as_attr and canonical_fullname and self.fullname != canonical_fullname:
            self.add_line('   :canonical: %s' % canonical_fullname, sourcename)

        # add inheritance info, if wanted
        if not self.doc_as_attr and self.options.show_inheritance:
            if hasattr(self.object, '__orig_bases__') and len(self.object.__orig_bases__):
                # A subclass of generic types
                # refs: PEP-560 <https://www.python.org/dev/peps/pep-0560/>
                bases = list(self.object.__orig_bases__)
            elif hasattr(self.object, '__bases__') and len(self.object.__bases__):
                # A normal class
                bases = list(self.object.__bases__)
            else:
                bases = []

            self.env.events.emit('autodoc-process-bases',
                                 self.fullname, self.object, self.options, bases)

            base_classes = [restify(cls) for cls in bases]
            sourcename = self.get_sourcename()
            self.add_line('', sourcename)
            self.add_line('   ' + _('Bases: %s') % ', '.join(base_classes), sourcename)

    def get_object_members(self, want_all: bool) -> Tuple[bool, ObjectMembers]:
        members = get_class_members(self.object, self.objpath, self.get_attr)
        if not want_all:
            if not self.options.members:
                return False, []  # type: ignore
            # specific members given
            selected = []
            for name in self.options.members:  # type: str
                if name in members:
                    selected.append(members[name])
                else:
                    logger.warning(__('missing attribute %s in object %s') %
                                   (name, self.fullname), type='autodoc')
            return False, selected
        elif self.options.inherited_members:
            return False, list(members.values())
        else:
            return False, [m for m in members.values() if m.class_ == self.object]

    def get_doc(self, ignore: int = None) -> Optional[List[List[str]]]:
        if self.doc_as_attr:
            # Don't show the docstring of the class when it is an alias.
            comment = self.get_variable_comment()
            if comment:
                return []
            else:
                return None

        lines = getattr(self, '_new_docstrings', None)
        if lines is not None:
            return lines

        classdoc_from = self.options.get('class-doc-from', self.config.autoclass_content)

        docstrings = []
        attrdocstring = self.get_attr(self.object, '__doc__', None)
        if attrdocstring:
            docstrings.append(attrdocstring)

        # for classes, what the "docstring" is can be controlled via a
        # config value; the default is only the class docstring
        if classdoc_from in ('both', 'init'):
            __init__ = self.get_attr(self.object, '__init__', None)
            initdocstring = getdoc(__init__, self.get_attr,
                                   self.config.autodoc_inherit_docstrings,
                                   self.object, '__init__')
            # for new-style classes, no __init__ means default __init__
            if (initdocstring is not None and
                (initdocstring == object.__init__.__doc__ or  # for pypy
                 initdocstring.strip() == object.__init__.__doc__)):  # for !pypy
                initdocstring = None
            if not initdocstring:
                # try __new__
                __new__ = self.get_attr(self.object, '__new__', None)
                initdocstring = getdoc(__new__, self.get_attr,
                                       self.config.autodoc_inherit_docstrings,
                                       self.object, '__new__')
                # for new-style classes, no __new__ means default __new__
                if (initdocstring is not None and
                    (initdocstring == object.__new__.__doc__ or  # for pypy
                     initdocstring.strip() == object.__new__.__doc__)):  # for !pypy
                    initdocstring = None
            if initdocstring:
                if classdoc_from == 'init':
                    docstrings = [initdocstring]
                else:
                    docstrings.append(initdocstring)

        tab_width = self.directive.state.document.settings.tab_width
        return [prepare_docstring(docstring, ignore, tab_width) for docstring in docstrings]

    def get_variable_comment(self) -> Optional[List[str]]:
        try:
            key = ('', '.'.join(self.objpath))
            analyzer = ModuleAnalyzer.for_module(self.get_real_modname())
            analyzer.analyze()
            return list(self.analyzer.attr_docs.get(key, []))
        except PycodeError:
            return None

    def add_content(self, more_content: Optional[StringList], no_docstring: bool = False
                    ) -> None:
        if self.doc_as_attr and not self.get_variable_comment():
            try:
                more_content = StringList([_('alias of %s') % restify(self.object)], source='')
            except AttributeError:
                pass  # Invalid class object is passed.

        super().add_content(more_content)

    def document_members(self, all_members: bool = False) -> None:
        if self.doc_as_attr:
            return
        super().document_members(all_members)

    def generate(self, more_content: Optional[StringList] = None, real_modname: str = None,
                 check_module: bool = False, all_members: bool = False) -> None:
        # Do not pass real_modname and use the name from the __module__
        # attribute of the class.
        # If a class gets imported into the module real_modname
        # the analyzer won't find the source of the class, if
        # it looks in real_modname.
        return super().generate(more_content=more_content,
                                check_module=check_module,
                                all_members=all_members)


File: tests/test_ext_autodoc.py
Line number range: 1 - 500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',


File: tests/test_ext_autodoc.py
Line number range: 501 - 4000
Content:
501.         '   :module: target',
502.         '',
503.         '   My custom exception.',
504.         '',
505.     ]
506. 
507. 
508. @pytest.mark.sphinx('html', testroot='ext-autodoc')
509. def test_autodoc_warnings(app, warning):
510.     app.env.temp_data['docname'] = 'dummy'
511. 
512.     # can't import module
513.     do_autodoc(app, 'module', 'unknown')
514.     assert "failed to import module 'unknown'" in warning.getvalue()
515. 
516.     # missing function
517.     do_autodoc(app, 'function', 'unknown')
518.     assert "import for autodocumenting 'unknown'" in warning.getvalue()
519. 
520.     do_autodoc(app, 'function', 'target.unknown')
521.     assert "failed to import function 'unknown' from module 'target'" in warning.getvalue()
522. 
523.     # missing method
524.     do_autodoc(app, 'method', 'target.Class.unknown')
525.     assert "failed to import method 'Class.unknown' from module 'target'" in warning.getvalue()
526. 
527. 
528. @pytest.mark.sphinx('html', testroot='ext-autodoc')
529. def test_autodoc_attributes(app):
530.     options = {"synopsis": 'Synopsis',
531.                "platform": "Platform",
532.                "deprecated": None}
533.     actual = do_autodoc(app, 'module', 'target', options)
534.     assert list(actual) == [
535.         '',
536.         '.. py:module:: target',
537.         '   :synopsis: Synopsis',
538.         '   :platform: Platform',
539.         '   :deprecated:',
540.         ''
541.     ]
542. 
543. 
544. @pytest.mark.sphinx('html', testroot='ext-autodoc')
545. def test_autodoc_members(app):
546.     # default (no-members)
547.     actual = do_autodoc(app, 'class', 'target.inheritance.Base')
548.     assert list(filter(lambda l: '::' in l, actual)) == [
549.         '.. py:class:: Base()',
550.     ]
551. 
552.     # default ALL-members
553.     options = {"members": None}
554.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
555.     assert list(filter(lambda l: '::' in l, actual)) == [
556.         '.. py:class:: Base()',
557.         '   .. py:method:: Base.inheritedclassmeth()',
558.         '   .. py:method:: Base.inheritedmeth()',
559.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
560.     ]
561. 
562.     # default specific-members
563.     options = {"members": "inheritedmeth,inheritedstaticmeth"}
564.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
565.     assert list(filter(lambda l: '::' in l, actual)) == [
566.         '.. py:class:: Base()',
567.         '   .. py:method:: Base.inheritedmeth()',
568.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
569.     ]
570. 
571.     # ALL-members override autodoc_default_options
572.     options = {"members": None}
573.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
574.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
575.     assert list(filter(lambda l: '::' in l, actual)) == [
576.         '.. py:class:: Base()',
577.         '   .. py:method:: Base.inheritedclassmeth()',
578.         '   .. py:method:: Base.inheritedmeth()',
579.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
580.     ]
581. 
582.     # members override autodoc_default_options
583.     options = {"members": "inheritedmeth"}
584.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
585.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
586.     assert list(filter(lambda l: '::' in l, actual)) == [
587.         '.. py:class:: Base()',
588.         '   .. py:method:: Base.inheritedmeth()',
589.     ]
590. 
591.     # members extends autodoc_default_options
592.     options = {"members": "+inheritedmeth"}
593.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
594.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
595.     assert list(filter(lambda l: '::' in l, actual)) == [
596.         '.. py:class:: Base()',
597.         '   .. py:method:: Base.inheritedmeth()',
598.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
599.     ]
600. 
601. 
602. @pytest.mark.sphinx('html', testroot='ext-autodoc')
603. def test_autodoc_exclude_members(app):
604.     options = {"members": None,
605.                "exclude-members": "inheritedmeth,inheritedstaticmeth"}
606.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
607.     assert list(filter(lambda l: '::' in l, actual)) == [
608.         '.. py:class:: Base()',
609.         '   .. py:method:: Base.inheritedclassmeth()'
610.     ]
611. 
612.     # members vs exclude-members
613.     options = {"members": "inheritedmeth",
614.                "exclude-members": "inheritedmeth"}
615.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
616.     assert list(filter(lambda l: '::' in l, actual)) == [
617.         '.. py:class:: Base()',
618.     ]
619. 
620.     # + has no effect when autodoc_default_options are not present
621.     options = {"members": None,
622.                "exclude-members": "+inheritedmeth,inheritedstaticmeth"}
623.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
624.     assert list(filter(lambda l: '::' in l, actual)) == [
625.         '.. py:class:: Base()',
626.         '   .. py:method:: Base.inheritedclassmeth()'
627.     ]
628. 
629.     # exclude-members overrides autodoc_default_options
630.     options = {"members": None,
631.                "exclude-members": "inheritedmeth"}
632.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
633.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
634.     assert list(filter(lambda l: '::' in l, actual)) == [
635.         '.. py:class:: Base()',
636.         '   .. py:method:: Base.inheritedclassmeth()',
637.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
638.     ]
639. 
640.     # exclude-members extends autodoc_default_options
641.     options = {"members": None,
642.                "exclude-members": "+inheritedmeth"}
643.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
644.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
645.     assert list(filter(lambda l: '::' in l, actual)) == [
646.         '.. py:class:: Base()',
647.         '   .. py:method:: Base.inheritedclassmeth()',
648.     ]
649. 
650.     # no exclude-members causes use autodoc_default_options
651.     options = {"members": None}
652.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
653.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
654.     assert list(filter(lambda l: '::' in l, actual)) == [
655.         '.. py:class:: Base()',
656.         '   .. py:method:: Base.inheritedclassmeth()',
657.     ]
658. 
659.     # empty exclude-members cancels autodoc_default_options
660.     options = {"members": None,
661.                "exclude-members": None}
662.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
663.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
664.     assert list(filter(lambda l: '::' in l, actual)) == [
665.         '.. py:class:: Base()',
666.         '   .. py:method:: Base.inheritedclassmeth()',
667.         '   .. py:method:: Base.inheritedmeth()',
668.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
669.     ]
670. 
671. 
672. @pytest.mark.sphinx('html', testroot='ext-autodoc')
673. def test_autodoc_undoc_members(app):
674.     options = {"members": None,
675.                "undoc-members": None}
676.     actual = do_autodoc(app, 'class', 'target.Class', options)
677.     assert list(filter(lambda l: '::' in l, actual)) == [
678.         '.. py:class:: Class(arg)',
679.         '   .. py:attribute:: Class.attr',
680.         '   .. py:attribute:: Class.docattr',
681.         '   .. py:method:: Class.excludemeth()',
682.         '   .. py:attribute:: Class.inst_attr_comment',
683.         '   .. py:attribute:: Class.inst_attr_inline',
684.         '   .. py:attribute:: Class.inst_attr_string',
685.         '   .. py:attribute:: Class.mdocattr',
686.         '   .. py:method:: Class.meth()',
687.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
688.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
689.         '   .. py:attribute:: Class.skipattr',
690.         '   .. py:method:: Class.skipmeth()',
691.         '   .. py:attribute:: Class.udocattr',
692.         '   .. py:method:: Class.undocmeth()'
693.     ]
694. 
695.     # use autodoc_default_options
696.     options = {"members": None}
697.     app.config.autodoc_default_options["undoc-members"] = None
698.     actual = do_autodoc(app, 'class', 'target.Class', options)
699.     assert list(filter(lambda l: '::' in l, actual)) == [
700.         '.. py:class:: Class(arg)',
701.         '   .. py:attribute:: Class.attr',
702.         '   .. py:attribute:: Class.docattr',
703.         '   .. py:method:: Class.excludemeth()',
704.         '   .. py:attribute:: Class.inst_attr_comment',
705.         '   .. py:attribute:: Class.inst_attr_inline',
706.         '   .. py:attribute:: Class.inst_attr_string',
707.         '   .. py:attribute:: Class.mdocattr',
708.         '   .. py:method:: Class.meth()',
709.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
710.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
711.         '   .. py:attribute:: Class.skipattr',
712.         '   .. py:method:: Class.skipmeth()',
713.         '   .. py:attribute:: Class.udocattr',
714.         '   .. py:method:: Class.undocmeth()'
715.     ]
716. 
717.     # options negation work check
718.     options = {"members": None,
719.                "no-undoc-members": None}
720.     app.config.autodoc_default_options["undoc-members"] = None
721.     actual = do_autodoc(app, 'class', 'target.Class', options)
722.     assert list(filter(lambda l: '::' in l, actual)) == [
723.         '.. py:class:: Class(arg)',
724.         '   .. py:attribute:: Class.attr',
725.         '   .. py:attribute:: Class.docattr',
726.         '   .. py:method:: Class.excludemeth()',
727.         '   .. py:attribute:: Class.inst_attr_comment',
728.         '   .. py:attribute:: Class.inst_attr_inline',
729.         '   .. py:attribute:: Class.inst_attr_string',
730.         '   .. py:attribute:: Class.mdocattr',
731.         '   .. py:method:: Class.meth()',
732.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
733.         '   .. py:method:: Class.skipmeth()',
734.         '   .. py:attribute:: Class.udocattr',
735.     ]
736. 
737. 
738. @pytest.mark.sphinx('html', testroot='ext-autodoc')
739. def test_autodoc_undoc_members_for_metadata_only(app):
740.     # metadata only member is not displayed
741.     options = {"members": None}
742.     actual = do_autodoc(app, 'module', 'target.metadata', options)
743.     assert list(actual) == [
744.         '',
745.         '.. py:module:: target.metadata',
746.         '',
747.     ]
748. 
749.     # metadata only member is displayed when undoc-member given
750.     options = {"members": None,
751.                "undoc-members": None}
752.     actual = do_autodoc(app, 'module', 'target.metadata', options)
753.     assert list(actual) == [
754.         '',
755.         '.. py:module:: target.metadata',
756.         '',
757.         '',
758.         '.. py:function:: foo()',
759.         '   :module: target.metadata',
760.         '',
761.         '   :meta metadata-only-docstring:',
762.         '',
763.     ]
764. 
765. 
766. @pytest.mark.sphinx('html', testroot='ext-autodoc')
767. def test_autodoc_inherited_members(app):
768.     options = {"members": None,
769.                "inherited-members": None}
770.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
771.     assert list(filter(lambda l: 'method::' in l, actual)) == [
772.         '   .. py:method:: Derived.inheritedclassmeth()',
773.         '   .. py:method:: Derived.inheritedmeth()',
774.         '   .. py:method:: Derived.inheritedstaticmeth(cls)',
775.     ]
776. 
777. 
778. @pytest.mark.sphinx('html', testroot='ext-autodoc')
779. def test_autodoc_inherited_members_Base(app):
780.     options = {"members": None,
781.                "inherited-members": "Base",
782.                "special-members": None}
783. 
784.     # check methods for object class are shown
785.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
786.     assert '   .. py:method:: Derived.inheritedmeth()' in actual
787.     assert '   .. py:method:: Derived.inheritedclassmeth' not in actual
788. 
789. 
790. @pytest.mark.sphinx('html', testroot='ext-autodoc')
791. def test_autodoc_inherited_members_None(app):
792.     options = {"members": None,
793.                "inherited-members": "None",
794.                "special-members": None}
795. 
796.     # check methods for object class are shown
797.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
798.     assert '   .. py:method:: Derived.__init__()' in actual
799.     assert '   .. py:method:: Derived.__str__()' in actual
800. 
801. 
802. @pytest.mark.sphinx('html', testroot='ext-autodoc')
803. def test_autodoc_imported_members(app):
804.     options = {"members": None,
805.                "imported-members": None,
806.                "ignore-module-all": None}
807.     actual = do_autodoc(app, 'module', 'target', options)
808.     assert '.. py:function:: save_traceback(app: Sphinx) -> str' in actual
809. 
810. 
811. @pytest.mark.sphinx('html', testroot='ext-autodoc')
812. def test_autodoc_special_members(app):
813.     # specific special methods
814.     options = {"undoc-members": None,
815.                "special-members": "__init__,__special1__"}
816.     actual = do_autodoc(app, 'class', 'target.Class', options)
817.     assert list(filter(lambda l: '::' in l, actual)) == [
818.         '.. py:class:: Class(arg)',
819.         '   .. py:method:: Class.__init__(arg)',
820.         '   .. py:method:: Class.__special1__()',
821.     ]
822. 
823.     # combination with specific members
824.     options = {"members": "attr,docattr",
825.                "undoc-members": None,
826.                "special-members": "__init__,__special1__"}
827.     actual = do_autodoc(app, 'class', 'target.Class', options)
828.     assert list(filter(lambda l: '::' in l, actual)) == [
829.         '.. py:class:: Class(arg)',
830.         '   .. py:method:: Class.__init__(arg)',
831.         '   .. py:method:: Class.__special1__()',
832.         '   .. py:attribute:: Class.attr',
833.         '   .. py:attribute:: Class.docattr',
834.     ]
835. 
836.     # all special methods
837.     options = {"members": None,
838.                "undoc-members": None,
839.                "special-members": None}
840.     actual = do_autodoc(app, 'class', 'target.Class', options)
841.     assert list(filter(lambda l: '::' in l, actual)) == [
842.         '.. py:class:: Class(arg)',
843.         '   .. py:attribute:: Class.__annotations__',
844.         '   .. py:attribute:: Class.__dict__',
845.         '   .. py:method:: Class.__init__(arg)',
846.         '   .. py:attribute:: Class.__module__',
847.         '   .. py:method:: Class.__special1__()',
848.         '   .. py:method:: Class.__special2__()',
849.         '   .. py:attribute:: Class.__weakref__',
850.         '   .. py:attribute:: Class.attr',
851.         '   .. py:attribute:: Class.docattr',
852.         '   .. py:method:: Class.excludemeth()',
853.         '   .. py:attribute:: Class.inst_attr_comment',
854.         '   .. py:attribute:: Class.inst_attr_inline',
855.         '   .. py:attribute:: Class.inst_attr_string',
856.         '   .. py:attribute:: Class.mdocattr',
857.         '   .. py:method:: Class.meth()',
858.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
859.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
860.         '   .. py:attribute:: Class.skipattr',
861.         '   .. py:method:: Class.skipmeth()',
862.         '   .. py:attribute:: Class.udocattr',
863.         '   .. py:method:: Class.undocmeth()'
864.     ]
865. 
866.     # specific special methods from autodoc_default_options
867.     options = {"undoc-members": None}
868.     app.config.autodoc_default_options["special-members"] = "__special2__"
869.     actual = do_autodoc(app, 'class', 'target.Class', options)
870.     assert list(filter(lambda l: '::' in l, actual)) == [
871.         '.. py:class:: Class(arg)',
872.         '   .. py:method:: Class.__special2__()',
873.     ]
874. 
875.     # specific special methods option with autodoc_default_options
876.     options = {"undoc-members": None,
877.                "special-members": "__init__,__special1__"}
878.     app.config.autodoc_default_options["special-members"] = "__special2__"
879.     actual = do_autodoc(app, 'class', 'target.Class', options)
880.     assert list(filter(lambda l: '::' in l, actual)) == [
881.         '.. py:class:: Class(arg)',
882.         '   .. py:method:: Class.__init__(arg)',
883.         '   .. py:method:: Class.__special1__()',
884.     ]
885. 
886.     # specific special methods merge with autodoc_default_options
887.     options = {"undoc-members": None,
888.                "special-members": "+__init__,__special1__"}
889.     app.config.autodoc_default_options["special-members"] = "__special2__"
890.     actual = do_autodoc(app, 'class', 'target.Class', options)
891.     assert list(filter(lambda l: '::' in l, actual)) == [
892.         '.. py:class:: Class(arg)',
893.         '   .. py:method:: Class.__init__(arg)',
894.         '   .. py:method:: Class.__special1__()',
895.         '   .. py:method:: Class.__special2__()',
896.     ]
897. 
898. 
899. @pytest.mark.sphinx('html', testroot='ext-autodoc')
900. def test_autodoc_ignore_module_all(app):
901.     # default (no-ignore-module-all)
902.     options = {"members": None}
903.     actual = do_autodoc(app, 'module', 'target', options)
904.     assert list(filter(lambda l: 'class::' in l, actual)) == [
905.         '.. py:class:: Class(arg)',
906.     ]
907. 
908.     # ignore-module-all
909.     options = {"members": None,
910.                "ignore-module-all": None}
911.     actual = do_autodoc(app, 'module', 'target', options)
912.     assert list(filter(lambda l: 'class::' in l, actual)) == [
913.         '.. py:class:: Class(arg)',
914.         '.. py:class:: CustomDict',
915.         '.. py:class:: InnerChild()',
916.         '.. py:class:: InstAttCls()',
917.         '.. py:class:: Outer()',
918.         '   .. py:class:: Outer.Inner()',
919.         '.. py:class:: StrRepr'
920.     ]
921. 
922. 
923. @pytest.mark.sphinx('html', testroot='ext-autodoc')
924. def test_autodoc_noindex(app):
925.     options = {"noindex": None}
926.     actual = do_autodoc(app, 'module', 'target', options)
927.     assert list(actual) == [
928.         '',
929.         '.. py:module:: target',
930.         '   :noindex:',
931.         ''
932.     ]
933. 
934.     # TODO: :noindex: should be propagated to children of target item.
935. 
936.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
937.     assert list(actual) == [
938.         '',
939.         '.. py:class:: Base()',
940.         '   :noindex:',
941.         '   :module: target.inheritance',
942.         ''
943.     ]
944. 
945. 
946. @pytest.mark.sphinx('html', testroot='ext-autodoc')
947. def test_autodoc_subclass_of_builtin_class(app):
948.     options = {"members": None}
949.     actual = do_autodoc(app, 'class', 'target.CustomDict', options)
950.     assert list(actual) == [
951.         '',
952.         '.. py:class:: CustomDict',
953.         '   :module: target',
954.         '',
955.         '   Docstring.',
956.         '',
957.     ]
958. 
959. 
960. @pytest.mark.sphinx('html', testroot='ext-autodoc')
961. def test_autodoc_inner_class(app):
962.     options = {"members": None}
963.     actual = do_autodoc(app, 'class', 'target.Outer', options)
964.     assert list(actual) == [
965.         '',
966.         '.. py:class:: Outer()',
967.         '   :module: target',
968.         '',
969.         '   Foo',
970.         '',
971.         '',
972.         '   .. py:class:: Outer.Inner()',
973.         '      :module: target',
974.         '',
975.         '      Foo',
976.         '',
977.         '',
978.         '      .. py:method:: Outer.Inner.meth()',
979.         '         :module: target',
980.         '',
981.         '         Foo',
982.         '',
983.         '',
984.         '   .. py:attribute:: Outer.factory',
985.         '      :module: target',
986.         '',
987.         '      alias of :py:class:`dict`'
988.     ]
989. 
990.     actual = do_autodoc(app, 'class', 'target.Outer.Inner', options)
991.     assert list(actual) == [
992.         '',
993.         '.. py:class:: Inner()',
994.         '   :module: target.Outer',
995.         '',
996.         '   Foo',
997.         '',
998.         '',
999.         '   .. py:method:: Inner.meth()',
1000.         '      :module: target.Outer',
1001.         '',
1002.         '      Foo',
1003.         '',
1004.     ]
1005. 
1006.     options['show-inheritance'] = None
1007.     actual = do_autodoc(app, 'class', 'target.InnerChild', options)
1008.     assert list(actual) == [
1009.         '',
1010.         '.. py:class:: InnerChild()',
1011.         '   :module: target', '',
1012.         '   Bases: :py:class:`target.Outer.Inner`',
1013.         '',
1014.         '   InnerChild docstring',
1015.         '',
1016.     ]
1017. 
1018. 
1019. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1020. def test_autodoc_classmethod(app):
1021.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedclassmeth')
1022.     assert list(actual) == [
1023.         '',
1024.         '.. py:method:: Base.inheritedclassmeth()',
1025.         '   :module: target.inheritance',
1026.         '   :classmethod:',
1027.         '',
1028.         '   Inherited class method.',
1029.         '',
1030.     ]
1031. 
1032. 
1033. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1034. def test_autodoc_staticmethod(app):
1035.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedstaticmeth')
1036.     assert list(actual) == [
1037.         '',
1038.         '.. py:method:: Base.inheritedstaticmeth(cls)',
1039.         '   :module: target.inheritance',
1040.         '   :staticmethod:',
1041.         '',
1042.         '   Inherited static method.',
1043.         '',
1044.     ]
1045. 
1046. 
1047. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1048. def test_autodoc_descriptor(app):
1049.     options = {"members": None,
1050.                "undoc-members": None}
1051.     actual = do_autodoc(app, 'class', 'target.descriptor.Class', options)
1052.     assert list(actual) == [
1053.         '',
1054.         '.. py:class:: Class()',
1055.         '   :module: target.descriptor',
1056.         '',
1057.         '',
1058.         '   .. py:attribute:: Class.descr',
1059.         '      :module: target.descriptor',
1060.         '',
1061.         '      Descriptor instance docstring.',
1062.         '',
1063.         '',
1064.         '   .. py:property:: Class.prop',
1065.         '      :module: target.descriptor',
1066.         '',
1067.         '      Property.',
1068.         ''
1069.     ]
1070. 
1071. 
1072. @pytest.mark.skipif(sys.version_info < (3, 8),
1073.                     reason='cached_property is available since python3.8.')
1074. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1075. def test_autodoc_cached_property(app):
1076.     options = {"members": None,
1077.                "undoc-members": None}
1078.     actual = do_autodoc(app, 'class', 'target.cached_property.Foo', options)
1079.     assert list(actual) == [
1080.         '',
1081.         '.. py:class:: Foo()',
1082.         '   :module: target.cached_property',
1083.         '',
1084.         '',
1085.         '   .. py:property:: Foo.prop',
1086.         '      :module: target.cached_property',
1087.         '      :type: int',
1088.         '',
1089.     ]
1090. 
1091. 
1092. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1093. def test_autodoc_member_order(app):
1094.     # case member-order='bysource'
1095.     options = {"members": None,
1096.                'member-order': 'bysource',
1097.                "undoc-members": None,
1098.                'private-members': None}
1099.     actual = do_autodoc(app, 'class', 'target.Class', options)
1100.     assert list(filter(lambda l: '::' in l, actual)) == [
1101.         '.. py:class:: Class(arg)',
1102.         '   .. py:method:: Class.meth()',
1103.         '   .. py:method:: Class.undocmeth()',
1104.         '   .. py:method:: Class.skipmeth()',
1105.         '   .. py:method:: Class.excludemeth()',
1106.         '   .. py:attribute:: Class.skipattr',
1107.         '   .. py:attribute:: Class.attr',
1108.         '   .. py:attribute:: Class.docattr',
1109.         '   .. py:attribute:: Class.udocattr',
1110.         '   .. py:attribute:: Class.mdocattr',
1111.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1112.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1113.         '   .. py:attribute:: Class.inst_attr_inline',
1114.         '   .. py:attribute:: Class.inst_attr_comment',
1115.         '   .. py:attribute:: Class.inst_attr_string',
1116.         '   .. py:attribute:: Class._private_inst_attr'
1117.     ]
1118. 
1119.     # case member-order='groupwise'
1120.     options = {"members": None,
1121.                'member-order': 'groupwise',
1122.                "undoc-members": None,
1123.                'private-members': None}
1124.     actual = do_autodoc(app, 'class', 'target.Class', options)
1125.     assert list(filter(lambda l: '::' in l, actual)) == [
1126.         '.. py:class:: Class(arg)',
1127.         '   .. py:method:: Class.excludemeth()',
1128.         '   .. py:method:: Class.meth()',
1129.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1130.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1131.         '   .. py:method:: Class.skipmeth()',
1132.         '   .. py:method:: Class.undocmeth()',
1133.         '   .. py:attribute:: Class._private_inst_attr',
1134.         '   .. py:attribute:: Class.attr',
1135.         '   .. py:attribute:: Class.docattr',
1136.         '   .. py:attribute:: Class.inst_attr_comment',
1137.         '   .. py:attribute:: Class.inst_attr_inline',
1138.         '   .. py:attribute:: Class.inst_attr_string',
1139.         '   .. py:attribute:: Class.mdocattr',
1140.         '   .. py:attribute:: Class.skipattr',
1141.         '   .. py:attribute:: Class.udocattr'
1142.     ]
1143. 
1144.     # case member-order=None
1145.     options = {"members": None,
1146.                "undoc-members": None,
1147.                'private-members': None}
1148.     actual = do_autodoc(app, 'class', 'target.Class', options)
1149.     assert list(filter(lambda l: '::' in l, actual)) == [
1150.         '.. py:class:: Class(arg)',
1151.         '   .. py:attribute:: Class._private_inst_attr',
1152.         '   .. py:attribute:: Class.attr',
1153.         '   .. py:attribute:: Class.docattr',
1154.         '   .. py:method:: Class.excludemeth()',
1155.         '   .. py:attribute:: Class.inst_attr_comment',
1156.         '   .. py:attribute:: Class.inst_attr_inline',
1157.         '   .. py:attribute:: Class.inst_attr_string',
1158.         '   .. py:attribute:: Class.mdocattr',
1159.         '   .. py:method:: Class.meth()',
1160.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1161.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1162.         '   .. py:attribute:: Class.skipattr',
1163.         '   .. py:method:: Class.skipmeth()',
1164.         '   .. py:attribute:: Class.udocattr',
1165.         '   .. py:method:: Class.undocmeth()'
1166.     ]
1167. 
1168. 
1169. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1170. def test_autodoc_module_member_order(app):
1171.     # case member-order='bysource'
1172.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1173.                'member-order': 'bysource',
1174.                "undoc-members": None}
1175.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1176.     assert list(filter(lambda l: '::' in l, actual)) == [
1177.         '.. py:module:: target.sort_by_all',
1178.         '.. py:function:: baz()',
1179.         '.. py:function:: foo()',
1180.         '.. py:class:: Bar()',
1181.         '.. py:class:: Quux()',
1182.         '.. py:function:: foobar()',
1183.         '.. py:function:: qux()',
1184.     ]
1185. 
1186.     # case member-order='bysource' and ignore-module-all
1187.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1188.                'member-order': 'bysource',
1189.                "undoc-members": None,
1190.                "ignore-module-all": None}
1191.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1192.     assert list(filter(lambda l: '::' in l, actual)) == [
1193.         '.. py:module:: target.sort_by_all',
1194.         '.. py:function:: foo()',
1195.         '.. py:class:: Bar()',
1196.         '.. py:function:: baz()',
1197.         '.. py:function:: qux()',
1198.         '.. py:class:: Quux()',
1199.         '.. py:function:: foobar()',
1200.     ]
1201. 
1202. 
1203. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1204. def test_autodoc_module_scope(app):
1205.     app.env.temp_data['autodoc:module'] = 'target'
1206.     actual = do_autodoc(app, 'attribute', 'Class.mdocattr')
1207.     assert list(actual) == [
1208.         '',
1209.         '.. py:attribute:: Class.mdocattr',
1210.         '   :module: target',
1211.         '   :value: <_io.StringIO object>',
1212.         '',
1213.         '   should be documented as well - süß',
1214.         '',
1215.     ]
1216. 
1217. 
1218. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1219. def test_autodoc_class_scope(app):
1220.     app.env.temp_data['autodoc:module'] = 'target'
1221.     app.env.temp_data['autodoc:class'] = 'Class'
1222.     actual = do_autodoc(app, 'attribute', 'mdocattr')
1223.     assert list(actual) == [
1224.         '',
1225.         '.. py:attribute:: Class.mdocattr',
1226.         '   :module: target',
1227.         '   :value: <_io.StringIO object>',
1228.         '',
1229.         '   should be documented as well - süß',
1230.         '',
1231.     ]
1232. 
1233. 
1234. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1235. def test_class_attributes(app):
1236.     options = {"members": None,
1237.                "undoc-members": None}
1238.     actual = do_autodoc(app, 'class', 'target.AttCls', options)
1239.     assert list(actual) == [
1240.         '',
1241.         '.. py:class:: AttCls()',
1242.         '   :module: target',
1243.         '',
1244.         '',
1245.         '   .. py:attribute:: AttCls.a1',
1246.         '      :module: target',
1247.         '      :value: hello world',
1248.         '',
1249.         '',
1250.         '   .. py:attribute:: AttCls.a2',
1251.         '      :module: target',
1252.         '      :value: None',
1253.         ''
1254.     ]
1255. 
1256. 
1257. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1258. def test_autoclass_instance_attributes(app):
1259.     options = {"members": None}
1260.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1261.     assert list(actual) == [
1262.         '',
1263.         '.. py:class:: InstAttCls()',
1264.         '   :module: target',
1265.         '',
1266.         '   Class with documented class and instance attributes.',
1267.         '',
1268.         '',
1269.         '   .. py:attribute:: InstAttCls.ca1',
1270.         '      :module: target',
1271.         "      :value: 'a'",
1272.         '',
1273.         '      Doc comment for class attribute InstAttCls.ca1.',
1274.         '      It can have multiple lines.',
1275.         '',
1276.         '',
1277.         '   .. py:attribute:: InstAttCls.ca2',
1278.         '      :module: target',
1279.         "      :value: 'b'",
1280.         '',
1281.         '      Doc comment for InstAttCls.ca2. One line only.',
1282.         '',
1283.         '',
1284.         '   .. py:attribute:: InstAttCls.ca3',
1285.         '      :module: target',
1286.         "      :value: 'c'",
1287.         '',
1288.         '      Docstring for class attribute InstAttCls.ca3.',
1289.         '',
1290.         '',
1291.         '   .. py:attribute:: InstAttCls.ia1',
1292.         '      :module: target',
1293.         '',
1294.         '      Doc comment for instance attribute InstAttCls.ia1',
1295.         '',
1296.         '',
1297.         '   .. py:attribute:: InstAttCls.ia2',
1298.         '      :module: target',
1299.         '',
1300.         '      Docstring for instance attribute InstAttCls.ia2.',
1301.         ''
1302.     ]
1303. 
1304.     # pick up arbitrary attributes
1305.     options = {"members": 'ca1,ia1'}
1306.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1307.     assert list(actual) == [
1308.         '',
1309.         '.. py:class:: InstAttCls()',
1310.         '   :module: target',
1311.         '',
1312.         '   Class with documented class and instance attributes.',
1313.         '',
1314.         '',
1315.         '   .. py:attribute:: InstAttCls.ca1',
1316.         '      :module: target',
1317.         "      :value: 'a'",
1318.         '',
1319.         '      Doc comment for class attribute InstAttCls.ca1.',
1320.         '      It can have multiple lines.',
1321.         '',
1322.         '',
1323.         '   .. py:attribute:: InstAttCls.ia1',
1324.         '      :module: target',
1325.         '',
1326.         '      Doc comment for instance attribute InstAttCls.ia1',
1327.         ''
1328.     ]
1329. 
1330. 
1331. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1332. def test_autoattribute_instance_attributes(app):
1333.     actual = do_autodoc(app, 'attribute', 'target.InstAttCls.ia1')
1334.     assert list(actual) == [
1335.         '',
1336.         '.. py:attribute:: InstAttCls.ia1',
1337.         '   :module: target',
1338.         '',
1339.         '   Doc comment for instance attribute InstAttCls.ia1',
1340.         ''
1341.     ]
1342. 
1343. 
1344. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1345. def test_slots(app):
1346.     options = {"members": None,
1347.                "undoc-members": None}
1348.     actual = do_autodoc(app, 'module', 'target.slots', options)
1349.     assert list(actual) == [
1350.         '',
1351.         '.. py:module:: target.slots',
1352.         '',
1353.         '',
1354.         '.. py:class:: Bar()',
1355.         '   :module: target.slots',
1356.         '',
1357.         '   docstring',
1358.         '',
1359.         '',
1360.         '   .. py:attribute:: Bar.attr1',
1361.         '      :module: target.slots',
1362.         '',
1363.         '      docstring of attr1',
1364.         '',
1365.         '',
1366.         '   .. py:attribute:: Bar.attr2',
1367.         '      :module: target.slots',
1368.         '',
1369.         '      docstring of instance attr2',
1370.         '',
1371.         '',
1372.         '   .. py:attribute:: Bar.attr3',
1373.         '      :module: target.slots',
1374.         '',
1375.         '',
1376.         '.. py:class:: Baz()',
1377.         '   :module: target.slots',
1378.         '',
1379.         '   docstring',
1380.         '',
1381.         '',
1382.         '   .. py:attribute:: Baz.attr',
1383.         '      :module: target.slots',
1384.         '',
1385.         '',
1386.         '.. py:class:: Foo()',
1387.         '   :module: target.slots',
1388.         '',
1389.         '   docstring',
1390.         '',
1391.         '',
1392.         '   .. py:attribute:: Foo.attr',
1393.         '      :module: target.slots',
1394.         '',
1395.     ]
1396. 
1397. 
1398. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1399. def test_enum_class(app):
1400.     options = {"members": None}
1401.     actual = do_autodoc(app, 'class', 'target.enums.EnumCls', options)
1402.     assert list(actual) == [
1403.         '',
1404.         '.. py:class:: EnumCls(value)',
1405.         '   :module: target.enums',
1406.         '',
1407.         '   this is enum class',
1408.         '',
1409.         '',
1410.         '   .. py:method:: EnumCls.say_goodbye()',
1411.         '      :module: target.enums',
1412.         '      :classmethod:',
1413.         '',
1414.         '      a classmethod says good-bye to you.',
1415.         '',
1416.         '',
1417.         '   .. py:method:: EnumCls.say_hello()',
1418.         '      :module: target.enums',
1419.         '',
1420.         '      a method says hello to you.',
1421.         '',
1422.         '',
1423.         '   .. py:attribute:: EnumCls.val1',
1424.         '      :module: target.enums',
1425.         '      :value: 12',
1426.         '',
1427.         '      doc for val1',
1428.         '',
1429.         '',
1430.         '   .. py:attribute:: EnumCls.val2',
1431.         '      :module: target.enums',
1432.         '      :value: 23',
1433.         '',
1434.         '      doc for val2',
1435.         '',
1436.         '',
1437.         '   .. py:attribute:: EnumCls.val3',
1438.         '      :module: target.enums',
1439.         '      :value: 34',
1440.         '',
1441.         '      doc for val3',
1442.         '',
1443.     ]
1444. 
1445.     # checks for an attribute of EnumClass
1446.     actual = do_autodoc(app, 'attribute', 'target.enums.EnumCls.val1')
1447.     assert list(actual) == [
1448.         '',
1449.         '.. py:attribute:: EnumCls.val1',
1450.         '   :module: target.enums',
1451.         '   :value: 12',
1452.         '',
1453.         '   doc for val1',
1454.         ''
1455.     ]
1456. 
1457. 
1458. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1459. def test_descriptor_class(app):
1460.     options = {"members": 'CustomDataDescriptor,CustomDataDescriptor2'}
1461.     actual = do_autodoc(app, 'module', 'target.descriptor', options)
1462.     assert list(actual) == [
1463.         '',
1464.         '.. py:module:: target.descriptor',
1465.         '',
1466.         '',
1467.         '.. py:class:: CustomDataDescriptor(doc)',
1468.         '   :module: target.descriptor',
1469.         '',
1470.         '   Descriptor class docstring.',
1471.         '',
1472.         '',
1473.         '   .. py:method:: CustomDataDescriptor.meth()',
1474.         '      :module: target.descriptor',
1475.         '',
1476.         '      Function.',
1477.         '',
1478.         '',
1479.         '.. py:class:: CustomDataDescriptor2(doc)',
1480.         '   :module: target.descriptor',
1481.         '',
1482.         '   Descriptor class with custom metaclass docstring.',
1483.         '',
1484.     ]
1485. 
1486. 
1487. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1488. def test_automethod_for_builtin(app):
1489.     actual = do_autodoc(app, 'method', 'builtins.int.__add__')
1490.     assert list(actual) == [
1491.         '',
1492.         '.. py:method:: int.__add__(value, /)',
1493.         '   :module: builtins',
1494.         '',
1495.         '   Return self+value.',
1496.         '',
1497.     ]
1498. 
1499. 
1500. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1501. def test_automethod_for_decorated(app):
1502.     actual = do_autodoc(app, 'method', 'target.decorator.Bar.meth')
1503.     assert list(actual) == [
1504.         '',
1505.         '.. py:method:: Bar.meth(name=None, age=None)',
1506.         '   :module: target.decorator',
1507.         '',
1508.     ]
1509. 
1510. 
1511. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1512. def test_abstractmethods(app):
1513.     options = {"members": None,
1514.                "undoc-members": None}
1515.     actual = do_autodoc(app, 'module', 'target.abstractmethods', options)
1516.     assert list(actual) == [
1517.         '',
1518.         '.. py:module:: target.abstractmethods',
1519.         '',
1520.         '',
1521.         '.. py:class:: Base()',
1522.         '   :module: target.abstractmethods',
1523.         '',
1524.         '',
1525.         '   .. py:method:: Base.abstractmeth()',
1526.         '      :module: target.abstractmethods',
1527.         '      :abstractmethod:',
1528.         '',
1529.         '',
1530.         '   .. py:method:: Base.classmeth()',
1531.         '      :module: target.abstractmethods',
1532.         '      :abstractmethod:',
1533.         '      :classmethod:',
1534.         '',
1535.         '',
1536.         '   .. py:method:: Base.coroutinemeth()',
1537.         '      :module: target.abstractmethods',
1538.         '      :abstractmethod:',
1539.         '      :async:',
1540.         '',
1541.         '',
1542.         '   .. py:method:: Base.meth()',
1543.         '      :module: target.abstractmethods',
1544.         '',
1545.         '',
1546.         '   .. py:property:: Base.prop',
1547.         '      :module: target.abstractmethods',
1548.         '      :abstractmethod:',
1549.         '',
1550.         '',
1551.         '   .. py:method:: Base.staticmeth()',
1552.         '      :module: target.abstractmethods',
1553.         '      :abstractmethod:',
1554.         '      :staticmethod:',
1555.         '',
1556.     ]
1557. 
1558. 
1559. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1560. def test_partialfunction(app):
1561.     options = {"members": None}
1562.     actual = do_autodoc(app, 'module', 'target.partialfunction', options)
1563.     assert list(actual) == [
1564.         '',
1565.         '.. py:module:: target.partialfunction',
1566.         '',
1567.         '',
1568.         '.. py:function:: func1(a, b, c)',
1569.         '   :module: target.partialfunction',
1570.         '',
1571.         '   docstring of func1',
1572.         '',
1573.         '',
1574.         '.. py:function:: func2(b, c)',
1575.         '   :module: target.partialfunction',
1576.         '',
1577.         '   docstring of func1',
1578.         '',
1579.         '',
1580.         '.. py:function:: func3(c)',
1581.         '   :module: target.partialfunction',
1582.         '',
1583.         '   docstring of func3',
1584.         '',
1585.         '',
1586.         '.. py:function:: func4()',
1587.         '   :module: target.partialfunction',
1588.         '',
1589.         '   docstring of func3',
1590.         '',
1591.     ]
1592. 
1593. 
1594. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1595. def test_imported_partialfunction_should_not_shown_without_imported_members(app):
1596.     options = {"members": None}
1597.     actual = do_autodoc(app, 'module', 'target.imported_members', options)
1598.     assert list(actual) == [
1599.         '',
1600.         '.. py:module:: target.imported_members',
1601.         ''
1602.     ]
1603. 
1604. 
1605. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1606. def test_bound_method(app):
1607.     options = {"members": None}
1608.     actual = do_autodoc(app, 'module', 'target.bound_method', options)
1609.     assert list(actual) == [
1610.         '',
1611.         '.. py:module:: target.bound_method',
1612.         '',
1613.         '',
1614.         '.. py:function:: bound_method()',
1615.         '   :module: target.bound_method',
1616.         '',
1617.         '   Method docstring',
1618.         '',
1619.     ]
1620. 
1621. 
1622. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1623. def test_partialmethod(app):
1624.     expected = [
1625.         '',
1626.         '.. py:class:: Cell()',
1627.         '   :module: target.partialmethod',
1628.         '',
1629.         '   An example for partialmethod.',
1630.         '',
1631.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1632.         '',
1633.         '',
1634.         '   .. py:method:: Cell.set_alive()',
1635.         '      :module: target.partialmethod',
1636.         '',
1637.         '      Make a cell alive.',
1638.         '',
1639.         '',
1640.         '   .. py:method:: Cell.set_state(state)',
1641.         '      :module: target.partialmethod',
1642.         '',
1643.         '      Update state of cell to *state*.',
1644.         '',
1645.     ]
1646. 
1647.     options = {"members": None}
1648.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1649.     assert list(actual) == expected
1650. 
1651. 
1652. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1653. def test_partialmethod_undoc_members(app):
1654.     expected = [
1655.         '',
1656.         '.. py:class:: Cell()',
1657.         '   :module: target.partialmethod',
1658.         '',
1659.         '   An example for partialmethod.',
1660.         '',
1661.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1662.         '',
1663.         '',
1664.         '   .. py:method:: Cell.set_alive()',
1665.         '      :module: target.partialmethod',
1666.         '',
1667.         '      Make a cell alive.',
1668.         '',
1669.         '',
1670.         '   .. py:method:: Cell.set_dead()',
1671.         '      :module: target.partialmethod',
1672.         '',
1673.         '',
1674.         '   .. py:method:: Cell.set_state(state)',
1675.         '      :module: target.partialmethod',
1676.         '',
1677.         '      Update state of cell to *state*.',
1678.         '',
1679.     ]
1680. 
1681.     options = {"members": None,
1682.                "undoc-members": None}
1683.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1684.     assert list(actual) == expected
1685. 
1686. 
1687. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1688. def test_autodoc_typed_instance_variables(app):
1689.     options = {"members": None,
1690.                "undoc-members": None}
1691.     actual = do_autodoc(app, 'module', 'target.typed_vars', options)
1692.     assert list(actual) == [
1693.         '',
1694.         '.. py:module:: target.typed_vars',
1695.         '',
1696.         '',
1697.         '.. py:attribute:: Alias',
1698.         '   :module: target.typed_vars',
1699.         '',
1700.         '   alias of :py:class:`target.typed_vars.Derived`',
1701.         '',
1702.         '.. py:class:: Class()',
1703.         '   :module: target.typed_vars',
1704.         '',
1705.         '',
1706.         '   .. py:attribute:: Class.attr1',
1707.         '      :module: target.typed_vars',
1708.         '      :type: int',
1709.         '      :value: 0',
1710.         '',
1711.         '',
1712.         '   .. py:attribute:: Class.attr2',
1713.         '      :module: target.typed_vars',
1714.         '      :type: int',
1715.         '',
1716.         '',
1717.         '   .. py:attribute:: Class.attr3',
1718.         '      :module: target.typed_vars',
1719.         '      :type: int',
1720.         '      :value: 0',
1721.         '',
1722.         '',
1723.         '   .. py:attribute:: Class.attr4',
1724.         '      :module: target.typed_vars',
1725.         '      :type: int',
1726.         '',
1727.         '      attr4',
1728.         '',
1729.         '',
1730.         '   .. py:attribute:: Class.attr5',
1731.         '      :module: target.typed_vars',
1732.         '      :type: int',
1733.         '',
1734.         '      attr5',
1735.         '',
1736.         '',
1737.         '   .. py:attribute:: Class.attr6',
1738.         '      :module: target.typed_vars',
1739.         '      :type: int',
1740.         '',
1741.         '      attr6',
1742.         '',
1743.         '',
1744.         '   .. py:attribute:: Class.descr4',
1745.         '      :module: target.typed_vars',
1746.         '      :type: int',
1747.         '',
1748.         '      This is descr4',
1749.         '',
1750.         '',
1751.         '.. py:class:: Derived()',
1752.         '   :module: target.typed_vars',
1753.         '',
1754.         '',
1755.         '   .. py:attribute:: Derived.attr7',
1756.         '      :module: target.typed_vars',
1757.         '      :type: int',
1758.         '',
1759.         '',
1760.         '.. py:data:: attr1',
1761.         '   :module: target.typed_vars',
1762.         '   :type: str',
1763.         "   :value: ''",
1764.         '',
1765.         '   attr1',
1766.         '',
1767.         '',
1768.         '.. py:data:: attr2',
1769.         '   :module: target.typed_vars',
1770.         '   :type: str',
1771.         '',
1772.         '   attr2',
1773.         '',
1774.         '',
1775.         '.. py:data:: attr3',
1776.         '   :module: target.typed_vars',
1777.         '   :type: str',
1778.         "   :value: ''",
1779.         '',
1780.         '   attr3',
1781.         '',
1782.     ]
1783. 
1784. 
1785. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1786. def test_autodoc_typed_inherited_instance_variables(app):
1787.     options = {"members": None,
1788.                "undoc-members": None,
1789.                "inherited-members": None}
1790.     actual = do_autodoc(app, 'class', 'target.typed_vars.Derived', options)
1791.     assert list(actual) == [
1792.         '',
1793.         '.. py:class:: Derived()',
1794.         '   :module: target.typed_vars',
1795.         '',
1796.         '',
1797.         '   .. py:attribute:: Derived.attr1',
1798.         '      :module: target.typed_vars',
1799.         '      :type: int',
1800.         '      :value: 0',
1801.         '',
1802.         '',
1803.         '   .. py:attribute:: Derived.attr2',
1804.         '      :module: target.typed_vars',
1805.         '      :type: int',
1806.         '',
1807.         '',
1808.         '   .. py:attribute:: Derived.attr3',
1809.         '      :module: target.typed_vars',
1810.         '      :type: int',
1811.         '      :value: 0',
1812.         '',
1813.         '',
1814.         '   .. py:attribute:: Derived.attr4',
1815.         '      :module: target.typed_vars',
1816.         '      :type: int',
1817.         '',
1818.         '      attr4',
1819.         '',
1820.         '',
1821.         '   .. py:attribute:: Derived.attr5',
1822.         '      :module: target.typed_vars',
1823.         '      :type: int',
1824.         '',
1825.         '      attr5',
1826.         '',
1827.         '',
1828.         '   .. py:attribute:: Derived.attr6',
1829.         '      :module: target.typed_vars',
1830.         '      :type: int',
1831.         '',
1832.         '      attr6',
1833.         '',
1834.         '',
1835.         '   .. py:attribute:: Derived.attr7',
1836.         '      :module: target.typed_vars',
1837.         '      :type: int',
1838.         '',
1839.         '',
1840.         '   .. py:attribute:: Derived.descr4',
1841.         '      :module: target.typed_vars',
1842.         '      :type: int',
1843.         '',
1844.     ]
1845. 
1846. 
1847. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1848. def test_autodoc_GenericAlias(app):
1849.     options = {"members": None,
1850.                "undoc-members": None}
1851.     actual = do_autodoc(app, 'module', 'target.genericalias', options)
1852.     if sys.version_info < (3, 7):
1853.         assert list(actual) == [
1854.             '',
1855.             '.. py:module:: target.genericalias',
1856.             '',
1857.             '',
1858.             '.. py:class:: Class()',
1859.             '   :module: target.genericalias',
1860.             '',
1861.             '',
1862.             '   .. py:attribute:: Class.T',
1863.             '      :module: target.genericalias',
1864.             '',
1865.             '      alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1866.             '',
1867.             '.. py:attribute:: T',
1868.             '   :module: target.genericalias',
1869.             '',
1870.             '   alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1871.         ]
1872.     else:
1873.         assert list(actual) == [
1874.             '',
1875.             '.. py:module:: target.genericalias',
1876.             '',
1877.             '',
1878.             '.. py:class:: Class()',
1879.             '   :module: target.genericalias',
1880.             '',
1881.             '',
1882.             '   .. py:attribute:: Class.T',
1883.             '      :module: target.genericalias',
1884.             '',
1885.             '      A list of int',
1886.             '',
1887.             '      alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1888.             '',
1889.             '',
1890.             '.. py:data:: T',
1891.             '   :module: target.genericalias',
1892.             '',
1893.             '   A list of int',
1894.             '',
1895.             '   alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1896.             '',
1897.         ]
1898. 
1899. 
1900. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1901. def test_autodoc_TypeVar(app):
1902.     options = {"members": None,
1903.                "undoc-members": None}
1904.     actual = do_autodoc(app, 'module', 'target.typevar', options)
1905.     assert list(actual) == [
1906.         '',
1907.         '.. py:module:: target.typevar',
1908.         '',
1909.         '',
1910.         '.. py:class:: Class()',
1911.         '   :module: target.typevar',
1912.         '',
1913.         '',
1914.         '   .. py:attribute:: Class.T1',
1915.         '      :module: target.typevar',
1916.         '',
1917.         '      T1',
1918.         '',
1919.         "      alias of TypeVar('T1')",
1920.         '',
1921.         '',
1922.         '   .. py:attribute:: Class.T6',
1923.         '      :module: target.typevar',
1924.         '',
1925.         '      T6',
1926.         '',
1927.         '      alias of :py:class:`int`',
1928.         '',
1929.         '',
1930.         '.. py:data:: T1',
1931.         '   :module: target.typevar',
1932.         '',
1933.         '   T1',
1934.         '',
1935.         "   alias of TypeVar('T1')",
1936.         '',
1937.         '',
1938.         '.. py:data:: T3',
1939.         '   :module: target.typevar',
1940.         '',
1941.         '   T3',
1942.         '',
1943.         "   alias of TypeVar('T3', int, str)",
1944.         '',
1945.         '',
1946.         '.. py:data:: T4',
1947.         '   :module: target.typevar',
1948.         '',
1949.         '   T4',
1950.         '',
1951.         "   alias of TypeVar('T4', covariant=True)",
1952.         '',
1953.         '',
1954.         '.. py:data:: T5',
1955.         '   :module: target.typevar',
1956.         '',
1957.         '   T5',
1958.         '',
1959.         "   alias of TypeVar('T5', contravariant=True)",
1960.         '',
1961.         '',
1962.         '.. py:data:: T6',
1963.         '   :module: target.typevar',
1964.         '',
1965.         '   T6',
1966.         '',
1967.         '   alias of :py:class:`int`',
1968.         '',
1969.         '',
1970.         '.. py:data:: T7',
1971.         '   :module: target.typevar',
1972.         '',
1973.         '   T7',
1974.         '',
1975.         "   alias of TypeVar('T7', bound=\\ :py:class:`int`)",
1976.         '',
1977.     ]
1978. 
1979. 
1980. @pytest.mark.skipif(sys.version_info < (3, 9), reason='py39+ is required.')
1981. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1982. def test_autodoc_Annotated(app):
1983.     options = {"members": None}
1984.     actual = do_autodoc(app, 'module', 'target.annotated', options)
1985.     assert list(actual) == [
1986.         '',
1987.         '.. py:module:: target.annotated',
1988.         '',
1989.         '',
1990.         '.. py:function:: hello(name: str) -> None',
1991.         '   :module: target.annotated',
1992.         '',
1993.         '   docstring',
1994.         '',
1995.     ]
1996. 
1997. 
1998. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1999. def test_autodoc_TYPE_CHECKING(app):
2000.     options = {"members": None,
2001.                "undoc-members": None}
2002.     actual = do_autodoc(app, 'module', 'target.TYPE_CHECKING', options)
2003.     assert list(actual) == [
2004.         '',
2005.         '.. py:module:: target.TYPE_CHECKING',
2006.         '',
2007.         '',
2008.         '.. py:class:: Foo()',
2009.         '   :module: target.TYPE_CHECKING',
2010.         '',
2011.         '',
2012.         '   .. py:attribute:: Foo.attr1',
2013.         '      :module: target.TYPE_CHECKING',
2014.         '      :type: StringIO',
2015.         '',
2016.     ]
2017. 
2018. 
2019. @pytest.mark.sphinx('html', testroot='pycode-egg')
2020. def test_autodoc_for_egged_code(app):
2021.     options = {"members": None,
2022.                "undoc-members": None}
2023.     actual = do_autodoc(app, 'module', 'sample', options)
2024.     assert list(actual) == [
2025.         '',
2026.         '.. py:module:: sample',
2027.         '',
2028.         '',
2029.         '.. py:data:: CONSTANT',
2030.         '   :module: sample',
2031.         '   :value: 1',
2032.         '',
2033.         '   constant on sample.py',
2034.         '',
2035.         '',
2036.         '.. py:function:: hello(s)',
2037.         '   :module: sample',
2038.         ''
2039.     ]
2040. 
2041. 
2042. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2043. def test_singledispatch(app):
2044.     options = {"members": None}
2045.     actual = do_autodoc(app, 'module', 'target.singledispatch', options)
2046.     assert list(actual) == [
2047.         '',
2048.         '.. py:module:: target.singledispatch',
2049.         '',
2050.         '',
2051.         '.. py:function:: func(arg, kwarg=None)',
2052.         '                 func(arg: float, kwarg=None)',
2053.         '                 func(arg: int, kwarg=None)',
2054.         '                 func(arg: str, kwarg=None)',
2055.         '   :module: target.singledispatch',
2056.         '',
2057.         '   A function for general use.',
2058.         '',
2059.     ]
2060. 
2061. 
2062. @pytest.mark.skipif(sys.version_info < (3, 8),
2063.                     reason='singledispatchmethod is available since python3.8')
2064. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2065. def test_singledispatchmethod(app):
2066.     options = {"members": None}
2067.     actual = do_autodoc(app, 'module', 'target.singledispatchmethod', options)
2068.     assert list(actual) == [
2069.         '',
2070.         '.. py:module:: target.singledispatchmethod',
2071.         '',
2072.         '',
2073.         '.. py:class:: Foo()',
2074.         '   :module: target.singledispatchmethod',
2075.         '',
2076.         '   docstring',
2077.         '',
2078.         '',
2079.         '   .. py:method:: Foo.meth(arg, kwarg=None)',
2080.         '                  Foo.meth(arg: float, kwarg=None)',
2081.         '                  Foo.meth(arg: int, kwarg=None)',
2082.         '                  Foo.meth(arg: str, kwarg=None)',
2083.         '      :module: target.singledispatchmethod',
2084.         '',
2085.         '      A method for general use.',
2086.         '',
2087.     ]
2088. 
2089. 
2090. @pytest.mark.skipif(sys.version_info < (3, 8),
2091.                     reason='singledispatchmethod is available since python3.8')
2092. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2093. def test_singledispatchmethod_automethod(app):
2094.     options = {}
2095.     actual = do_autodoc(app, 'method', 'target.singledispatchmethod.Foo.meth', options)
2096.     assert list(actual) == [
2097.         '',
2098.         '.. py:method:: Foo.meth(arg, kwarg=None)',
2099.         '               Foo.meth(arg: float, kwarg=None)',
2100.         '               Foo.meth(arg: int, kwarg=None)',
2101.         '               Foo.meth(arg: str, kwarg=None)',
2102.         '   :module: target.singledispatchmethod',
2103.         '',
2104.         '   A method for general use.',
2105.         '',
2106.     ]
2107. 
2108. 
2109. @pytest.mark.skipif(pyximport is None, reason='cython is not installed')
2110. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2111. def test_cython(app):
2112.     options = {"members": None,
2113.                "undoc-members": None}
2114.     actual = do_autodoc(app, 'module', 'target.cython', options)
2115.     assert list(actual) == [
2116.         '',
2117.         '.. py:module:: target.cython',
2118.         '',
2119.         '',
2120.         '.. py:class:: Class()',
2121.         '   :module: target.cython',
2122.         '',
2123.         '   Docstring.',
2124.         '',
2125.         '',
2126.         '   .. py:method:: Class.meth(name: str, age: int = 0) -> None',
2127.         '      :module: target.cython',
2128.         '',
2129.         '      Docstring.',
2130.         '',
2131.         '',
2132.         '.. py:function:: foo(x: int, *args, y: str, **kwargs)',
2133.         '   :module: target.cython',
2134.         '',
2135.         '   Docstring.',
2136.         '',
2137.     ]
2138. 
2139. 
2140. @pytest.mark.skipif(sys.version_info < (3, 8),
2141.                     reason='typing.final is available since python3.8')
2142. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2143. def test_final(app):
2144.     options = {"members": None}
2145.     actual = do_autodoc(app, 'module', 'target.final', options)
2146.     assert list(actual) == [
2147.         '',
2148.         '.. py:module:: target.final',
2149.         '',
2150.         '',
2151.         '.. py:class:: Class()',
2152.         '   :module: target.final',
2153.         '   :final:',
2154.         '',
2155.         '   docstring',
2156.         '',
2157.         '',
2158.         '   .. py:method:: Class.meth1()',
2159.         '      :module: target.final',
2160.         '      :final:',
2161.         '',
2162.         '      docstring',
2163.         '',
2164.         '',
2165.         '   .. py:method:: Class.meth2()',
2166.         '      :module: target.final',
2167.         '',
2168.         '      docstring',
2169.         '',
2170.     ]
2171. 
2172. 
2173. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2174. def test_overload(app):
2175.     options = {"members": None}
2176.     actual = do_autodoc(app, 'module', 'target.overload', options)
2177.     assert list(actual) == [
2178.         '',
2179.         '.. py:module:: target.overload',
2180.         '',
2181.         '',
2182.         '.. py:class:: Bar(x: int, y: int)',
2183.         '              Bar(x: str, y: str)',
2184.         '   :module: target.overload',
2185.         '',
2186.         '   docstring',
2187.         '',
2188.         '',
2189.         '.. py:class:: Baz(x: int, y: int)',
2190.         '              Baz(x: str, y: str)',
2191.         '   :module: target.overload',
2192.         '',
2193.         '   docstring',
2194.         '',
2195.         '',
2196.         '.. py:class:: Foo(x: int, y: int)',
2197.         '              Foo(x: str, y: str)',
2198.         '   :module: target.overload',
2199.         '',
2200.         '   docstring',
2201.         '',
2202.         '',
2203.         '.. py:class:: Math()',
2204.         '   :module: target.overload',
2205.         '',
2206.         '   docstring',
2207.         '',
2208.         '',
2209.         '   .. py:method:: Math.sum(x: int, y: int = 0) -> int',
2210.         '                  Math.sum(x: float, y: float = 0.0) -> float',
2211.         '                  Math.sum(x: str, y: str = None) -> str',
2212.         '      :module: target.overload',
2213.         '',
2214.         '      docstring',
2215.         '',
2216.         '',
2217.         '.. py:function:: sum(x: int, y: int = 0) -> int',
2218.         '                 sum(x: float, y: float = 0.0) -> float',
2219.         '                 sum(x: str, y: str = None) -> str',
2220.         '   :module: target.overload',
2221.         '',
2222.         '   docstring',
2223.         '',
2224.     ]
2225. 
2226. 
2227. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2228. def test_overload2(app):
2229.     options = {"members": None}
2230.     actual = do_autodoc(app, 'module', 'target.overload2', options)
2231.     assert list(actual) == [
2232.         '',
2233.         '.. py:module:: target.overload2',
2234.         '',
2235.         '',
2236.         '.. py:class:: Baz(x: int, y: int)',
2237.         '              Baz(x: str, y: str)',
2238.         '   :module: target.overload2',
2239.         '',
2240.     ]
2241. 
2242. 
2243. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2244. def test_pymodule_for_ModuleLevelDocumenter(app):
2245.     app.env.ref_context['py:module'] = 'target.classes'
2246.     actual = do_autodoc(app, 'class', 'Foo')
2247.     assert list(actual) == [
2248.         '',
2249.         '.. py:class:: Foo()',
2250.         '   :module: target.classes',
2251.         '',
2252.     ]
2253. 
2254. 
2255. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2256. def test_pymodule_for_ClassLevelDocumenter(app):
2257.     app.env.ref_context['py:module'] = 'target.methods'
2258.     actual = do_autodoc(app, 'method', 'Base.meth')
2259.     assert list(actual) == [
2260.         '',
2261.         '.. py:method:: Base.meth()',
2262.         '   :module: target.methods',
2263.         '',
2264.     ]
2265. 
2266. 
2267. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2268. def test_pyclass_for_ClassLevelDocumenter(app):
2269.     app.env.ref_context['py:module'] = 'target.methods'
2270.     app.env.ref_context['py:class'] = 'Base'
2271.     actual = do_autodoc(app, 'method', 'meth')
2272.     assert list(actual) == [
2273.         '',
2274.         '.. py:method:: Base.meth()',
2275.         '   :module: target.methods',
2276.         '',
2277.     ]
2278. 
2279. 
2280. @pytest.mark.sphinx('dummy', testroot='ext-autodoc')
2281. def test_autodoc(app, status, warning):
2282.     app.builder.build_all()
2283. 
2284.     content = app.env.get_doctree('index')
2285.     assert isinstance(content[3], addnodes.desc)
2286.     assert content[3][0].astext() == 'autodoc_dummy_module.test()'
2287.     assert content[3][1].astext() == 'Dummy function using dummy.*'
2288. 
2289.     # issue sphinx-doc/sphinx#2437
2290.     assert content[11][-1].astext() == """Dummy class Bar with alias.
2291. 
2292. 
2293. 
2294. my_name
2295. 
2296. alias of bug2437.autodoc_dummy_foo.Foo"""
2297.     assert warning.getvalue() == ''
2298. 
2299. 
2300. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2301. def test_name_conflict(app):
2302.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo')
2303.     assert list(actual) == [
2304.         '',
2305.         '.. py:class:: foo()',
2306.         '   :module: target.name_conflict',
2307.         '',
2308.         '   docstring of target.name_conflict::foo.',
2309.         '',
2310.     ]
2311. 
2312.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo.bar')
2313.     assert list(actual) == [
2314.         '',
2315.         '.. py:class:: bar()',
2316.         '   :module: target.name_conflict.foo',
2317.         '',
2318.         '   docstring of target.name_conflict.foo::bar.',
2319.         '',
2320.     ]
2321. 
2322. 
2323. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2324. def test_name_mangling(app):
2325.     options = {"members": None,
2326.                "undoc-members": None,
2327.                "private-members": None}
2328.     actual = do_autodoc(app, 'module', 'target.name_mangling', options)
2329.     assert list(actual) == [
2330.         '',
2331.         '.. py:module:: target.name_mangling',
2332.         '',
2333.         '',
2334.         '.. py:class:: Bar()',
2335.         '   :module: target.name_mangling',
2336.         '',
2337.         '',
2338.         '   .. py:attribute:: Bar._Baz__email',
2339.         '      :module: target.name_mangling',
2340.         '      :value: None',
2341.         '',
2342.         '      a member having mangled-like name',
2343.         '',
2344.         '',
2345.         '   .. py:attribute:: Bar.__address',
2346.         '      :module: target.name_mangling',
2347.         '      :value: None',
2348.         '',
2349.         '',
2350.         '.. py:class:: Foo()',
2351.         '   :module: target.name_mangling',
2352.         '',
2353.         '',
2354.         '   .. py:attribute:: Foo.__age',
2355.         '      :module: target.name_mangling',
2356.         '      :value: None',
2357.         '',
2358.         '',
2359.         '   .. py:attribute:: Foo.__name',
2360.         '      :module: target.name_mangling',
2361.         '      :value: None',
2362.         '',
2363.         '      name of Foo',
2364.         '',
2365.     ]
2366. 
2367. 
2368. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
2369. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2370. def test_type_union_operator(app):
2371.     options = {'members': None}
2372.     actual = do_autodoc(app, 'module', 'target.pep604', options)
2373.     assert list(actual) == [
2374.         '',
2375.         '.. py:module:: target.pep604',
2376.         '',
2377.         '',
2378.         '.. py:class:: Foo()',
2379.         '   :module: target.pep604',
2380.         '',
2381.         '   docstring',
2382.         '',
2383.         '',
2384.         '   .. py:attribute:: Foo.attr',
2385.         '      :module: target.pep604',
2386.         '      :type: int | str',
2387.         '',
2388.         '      docstring',
2389.         '',
2390.         '',
2391.         '   .. py:method:: Foo.meth(x: int | str, y: int | str) -> int | str',
2392.         '      :module: target.pep604',
2393.         '',
2394.         '      docstring',
2395.         '',
2396.         '',
2397.         '.. py:data:: attr',
2398.         '   :module: target.pep604',
2399.         '   :type: int | str',
2400.         '',
2401.         '   docstring',
2402.         '',
2403.         '',
2404.         '.. py:function:: sum(x: int | str, y: int | str) -> int | str',
2405.         '   :module: target.pep604',
2406.         '',
2407.         '   docstring',
2408.         '',
2409.     ]
2410. 
2411. 
2412. @pytest.mark.skipif(sys.version_info < (3, 6), reason='python 3.6+ is required.')
2413. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2414. def test_hide_value(app):
2415.     options = {'members': None}
2416.     actual = do_autodoc(app, 'module', 'target.hide_value', options)
2417.     assert list(actual) == [
2418.         '',
2419.         '.. py:module:: target.hide_value',
2420.         '',
2421.         '',
2422.         '.. py:class:: Foo()',
2423.         '   :module: target.hide_value',
2424.         '',
2425.         '   docstring',
2426.         '',
2427.         '',
2428.         '   .. py:attribute:: Foo.SENTINEL1',
2429.         '      :module: target.hide_value',
2430.         '',
2431.         '      docstring',
2432.         '',
2433.         '      :meta hide-value:',
2434.         '',
2435.         '',
2436.         '   .. py:attribute:: Foo.SENTINEL2',
2437.         '      :module: target.hide_value',
2438.         '',
2439.         '      :meta hide-value:',
2440.         '',
2441.         '',
2442.         '.. py:data:: SENTINEL1',
2443.         '   :module: target.hide_value',
2444.         '',
2445.         '   docstring',
2446.         '',
2447.         '   :meta hide-value:',
2448.         '',
2449.         '',
2450.         '.. py:data:: SENTINEL2',
2451.         '   :module: target.hide_value',
2452.         '',
2453.         '   :meta hide-value:',
2454.         '',
2455.     ]
2456. 
2457. 
2458. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2459. def test_canonical(app):
2460.     options = {'members': None,
2461.                'imported-members': None}
2462.     actual = do_autodoc(app, 'module', 'target.canonical', options)
2463.     assert list(actual) == [
2464.         '',
2465.         '.. py:module:: target.canonical',
2466.         '',
2467.         '',
2468.         '.. py:class:: Bar()',
2469.         '   :module: target.canonical',
2470.         '',
2471.         '   docstring',
2472.         '',
2473.         '',
2474.         '.. py:class:: Foo()',
2475.         '   :module: target.canonical',
2476.         '   :canonical: target.canonical.original.Foo',
2477.         '',
2478.         '   docstring',
2479.         '',
2480.         '',
2481.         '   .. py:method:: Foo.meth()',
2482.         '      :module: target.canonical',
2483.         '',
2484.         '      docstring',
2485.         '',
2486.     ]

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 04:17:34,250 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user explicitly asked for the full content of `sphinx/ext/autodoc/__init__.py`. This context provides the first part of the file.', relative_path='sphinx/ext/autodoc/__init__.py', start_line=1, end_line=500), ContextOutput(reasoning='The user explicitly asked for the full content of `sphinx/ext/autodoc/__init__.py`. This context provides a later part of the file, including the `ClassDocumenter` which is mentioned in the purpose.', relative_path='sphinx/ext/autodoc/__init__.py', start_line=1434, end_line=1776), ContextOutput(reasoning='The user explicitly asked for the full content of `tests/test_ext_autodoc.py`. This context provides the first part of the file.', relative_path='tests/test_ext_autodoc.py', start_line=1, end_line=500), ContextOutput(reasoning='The user explicitly asked for the full content of `tests/test_ext_autodoc.py`. This context provides the second part of the file.', relative_path='tests/test_ext_autodoc.py', start_line=501, end_line=4000)]
2025-12-24 04:17:34,256 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 4 contexts to memory for query: Please provide the full content of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py`.
2025-12-24 04:17:34,256 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 04:17:34,256 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 04:17:34,257 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 4 new contexts to 3 existing contexts
2025-12-24 04:17:34,257 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 7 total contexts (removed 0 duplicates)
2025-12-24 04:17:34,258 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
sphinx
├── .circleci
|   └── config.yml
├── .codecov.yml
├── .github
|   ├── ISSUE_TEMPLATE
|   |   ├── bug-report.yml
|   |   ├── config.yml
|   |   └── feature_request.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   └── workflows
|       ├── builddoc.yml
|       ├── lint.yml
|       ├── lock.yml
|       ├── main.yml
|       ├── nodejs.yml
|       └── transifex.yml
├── .readthedocs.yml
├── CONTRIBUTING.rst
├── README.rst
├── bindep.txt
├── doc
|   ├── _static
|   |   ├── conf.py.txt
|   |   ├── themes
|   |   |   └── fullsize
|   |   └── tutorial
|   ├── _templates
|   |   ├── index.html
|   |   └── indexsidebar.html
|   ├── _themes
|   |   └── sphinx13
|   |       ├── layout.html
|   |       └── static
|   |           └── sphinx13.css
|   ├── changes.rst
|   ├── conf.py
|   ├── contents.rst
|   ├── development
|   |   ├── builders.rst
|   |   ├── index.rst
|   |   ├── overview.rst
|   |   ├── theming.rst
|   |   └── tutorials
|   |       ├── autodoc_ext.rst
|   |       ├── examples
|   |       |   ├── README.rst
|   |       |   ├── autodoc_intenum.py
|   |       |   ├── helloworld.py
|   |       |   ├── recipe.py
|   |       |   └── todo.py
|   |       ├── helloworld.rst
|   |       ├── index.rst
|   |       ├── recipe.rst
|   |       └── todo.rst
|   ├── examples.rst
|   ├── extdev
|   |   ├── appapi.rst
|   |   ├── builderapi.rst
|   |   ├── collectorapi.rst
|   |   ├── deprecated.rst
|   |   ├── domainapi.rst
|   |   ├── envapi.rst
|   |   ├── i18n.rst
|   |   ├── index.rst
|   |   ├── logging.rst
|   |   ├── markupapi.rst
|   |   ├── nodes.rst
|   |   ├── parserapi.rst
|   |   ├── projectapi.rst
|   |   └── utils.rst
|   ├── faq.rst
|   ├── glossary.rst
|   ├── internals
|   |   ├── authors.rst
|   |   ├── code-of-conduct.rst
|   |   ├── contributing.rst
|   |   ├── index.rst
|   |   ├── organization.rst
|   |   └── release-process.rst
|   ├── latex.rst
|   ├── man
|   |   ├── index.rst
|   |   ├── sphinx-apidoc.rst
|   |   ├── sphinx-autogen.rst
|   |   ├── sphinx-build.rst
|   |   └── sphinx-quickstart.rst
|   ├── templating.rst
|   ├── tutorial
|   |   ├── end.rst
|   |   ├── first-steps.rst
|   |   ├── getting-started.rst
|   |   ├── index.rst
|   |   ├── more-sphinx-customization.rst
|   |   └── narrative-documentation.rst
|   └── usage
|       ├── advanced
|       |   ├── intl.rst
|       |   ├── setuptools.rst
|       |   └── websupport
|       |       ├── api.rst
|       |       ├── index.rst
|       |       ├── quickstart.rst
|       |       ├── searchadapters.rst
|       |       └── storagebackends.rst
|       ├── builders
|       |   └── index.rst
|       ├── configuration.rst
|       ├── extensions
|       |   ├── autodoc.rst
|       |   ├── autosectionlabel.rst
|       |   ├── autosummary.rst
|       |   ├── coverage.rst
|       |   ├── doctest.rst
|       |   ├── duration.rst
|       |   ├── example_google.py
|       |   ├── example_google.rst
|       |   ├── example_numpy.py
|       |   ├── example_numpy.rst
|       |   ├── extlinks.rst
|       |   ├── githubpages.rst
|       |   ├── graphviz.rst
|       |   ├── ifconfig.rst
|       |   ├── imgconverter.rst
|       |   ├── index.rst
|       |   ├── inheritance.rst
|       |   ├── intersphinx.rst
|       |   ├── linkcode.rst
|       |   ├── math.rst
|       |   ├── napoleon.rst
|       |   ├── todo.rst
|       |   └── viewcode.rst
|       ├── index.rst
|       ├── installation.rst
|       ├── markdown.rst
|       ├── quickstart.rst
|       ├── restructuredtext
|       |   ├── basics.rst
|       |   ├── directives.rst
|       |   ├── domains.rst
|       |   ├── field-lists.rst
|       |   ├── index.rst
|       |   └── roles.rst
|       └── theming.rst
├── karma.conf.js
├── setup.py
├── sphinx
|   ├── __init__.py
|   ├── __main__.py
|   ├── addnodes.py
|   ├── application.py
|   ├── builders
|   |   ├── __init__.py
|   |   ├── _epub_base.py
|   |   ├── changes.py
|   |   ├── dirhtml.py
|   |   ├── dummy.py
|   |   ├── epub3.py
|   |   ├── gettext.py
|   |   ├── html
|   |   |   ├── __init__.py
|   |   |   └── transforms.py
|   |   ├── latex
|   |   |   ├── __init__.py
|   |   |   ├── constants.py
|   |   |   ├── nodes.py
|   |   |   ├── theming.py
|   |   |   ├── transforms.py
|   |   |   └── util.py
|   |   ├── linkcheck.py
|   |   ├── manpage.py
|   |   ├── singlehtml.py
|   |   ├── texinfo.py
|   |   ├── text.py
|   |   └── xml.py
|   ├── cmd
|   |   ├── __init__.py
|   |   ├── build.py
|   |   ├── make_mode.py
|   |   └── quickstart.py
|   ├── config.py
|   ├── deprecation.py
|   ├── directives
|   |   ├── __init__.py
|   |   ├── code.py
|   |   ├── other.py
|   |   └── patches.py
|   ├── domains
|   |   ├── __init__.py
|   |   ├── c.py
|   |   ├── changeset.py
|   |   ├── citation.py
|   |   ├── cpp.py
|   |   ├── index.py
|   |   ├── javascript.py
|   |   ├── math.py
|   |   ├── python.py
|   |   ├── rst.py
|   |   └── std.py
|   ├── environment
|   |   ├── __init__.py
|   |   ├── adapters
|   |   |   ├── __init__.py
|   |   |   ├── asset.py
|   |   |   ├── indexentries.py
|   |   |   └── toctree.py
|   |   └── collectors
|   |       ├── __init__.py
|   |       ├── asset.py
|   |       ├── dependencies.py
|   |       ├── metadata.py
|   |       ├── title.py
|   |       └── toctree.py
|   ├── errors.py
|   ├── events.py
|   ├── ext
|   |   ├── __init__.py
|   |   ├── apidoc.py
|   |   ├── autodoc
|   |   |   ├── __init__.py
|   |   |   ├── deprecated.py
|   |   |   ├── directive.py
|   |   |   ├── importer.py
|   |   |   ├── mock.py
|   |   |   ├── preserve_defaults.py
|   |   |   ├── type_comment.py
|   |   |   └── typehints.py
|   |   ├── autosectionlabel.py
|   |   ├── autosummary
|   |   |   ├── __init__.py
|   |   |   ├── generate.py
|   |   |   └── templates
|   |   |       └── autosummary
|   |   ├── coverage.py
|   |   ├── doctest.py
|   |   ├── duration.py
|   |   ├── extlinks.py
|   |   ├── githubpages.py
|   |   ├── graphviz.py
|   |   ├── ifconfig.py
|   |   ├── imgconverter.py
|   |   ├── imgmath.py
|   |   ├── inheritance_diagram.py
|   |   ├── intersphinx.py
|   |   ├── linkcode.py
|   |   ├── mathjax.py
|   |   ├── napoleon
|   |   |   ├── __init__.py
|   |   |   ├── docstring.py
|   |   |   └── iterators.py
|   |   ├── todo.py
|   |   └── viewcode.py
|   ├── extension.py
|   ├── highlighting.py
|   ├── io.py
|   ├── jinja2glue.py
|   ├── locale
|   |   ├── __init__.py
|   |   ├── ar
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bg
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── bn
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ca
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cak
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cs
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── cy
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── da
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── de
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── el
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_GB
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── en_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eo
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── es
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── et
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── eu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fa
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── fr_FR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── he
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hi_IN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── hu
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── id
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── is
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── it
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ja
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ko
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── lv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── mk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nb_NO
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ne
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── nl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_BR
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── pt_PT
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ro
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ru
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── si
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sk
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sl
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sq
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr@latin
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sr_RS
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── sv
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ta
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── te
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── tr
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── uk_UA
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── ur
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── vi
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── yue
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_CN
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_HK
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   ├── zh_TW
|   |   |   └── LC_MESSAGES
|   |   |       └── sphinx.js
|   |   └── zh_TW.Big5
|   |       └── LC_MESSAGES
|   |           └── sphinx.js
|   ├── parsers.py
|   ├── project.py
|   ├── pycode
|   |   ├── __init__.py
|   |   ├── ast.py
|   |   └── parser.py
|   ├── pygments_styles.py
|   ├── registry.py
|   ├── roles.py
|   ├── search
|   |   ├── __init__.py
|   |   ├── da.py
|   |   ├── de.py
|   |   ├── en.py
|   |   ├── es.py
|   |   ├── fi.py
|   |   ├── fr.py
|   |   ├── hu.py
|   |   ├── it.py
|   |   ├── ja.py
|   |   ├── jssplitter.py
|   |   ├── minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── nl.py
|   |   ├── no.py
|   |   ├── non-minified-js
|   |   |   ├── base-stemmer.js
|   |   |   ├── danish-stemmer.js
|   |   |   ├── dutch-stemmer.js
|   |   |   ├── finnish-stemmer.js
|   |   |   ├── french-stemmer.js
|   |   |   ├── german-stemmer.js
|   |   |   ├── hungarian-stemmer.js
|   |   |   ├── italian-stemmer.js
|   |   |   ├── norwegian-stemmer.js
|   |   |   ├── porter-stemmer.js
|   |   |   ├── portuguese-stemmer.js
|   |   |   ├── romanian-stemmer.js
|   |   |   ├── russian-stemmer.js
|   |   |   ├── spanish-stemmer.js
|   |   |   ├── swedish-stemmer.js
|   |   |   └── turkish-stemmer.js
|   |   ├── pt.py
|   |   ├── ro.py
|   |   ├── ru.py
|   |   ├── sv.py
|   |   ├── tr.py
|   |   └── zh.py
|   ├── setup_command.py
|   ├── templates
|   |   ├── apidoc
|   |   ├── epub3
|   |   |   └── container.xml
|   |   ├── gettext
|   |   ├── graphviz
|   |   |   └── graphviz.css
|   |   ├── htmlhelp
|   |   ├── imgmath
|   |   ├── latex
|   |   ├── quickstart
|   |   └── texinfo
|   ├── testing
|   |   ├── __init__.py
|   |   ├── comparer.py
|   |   ├── fixtures.py
|   |   ├── path.py
|   |   ├── restructuredtext.py
|   |   └── util.py
|   ├── texinputs
|   ├── texinputs_win
|   ├── themes
|   |   ├── agogo
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── basic
|   |   |   ├── changes
|   |   |   |   ├── frameset.html
|   |   |   |   ├── rstsource.html
|   |   |   |   └── versionchanges.html
|   |   |   ├── defindex.html
|   |   |   ├── domainindex.html
|   |   |   ├── genindex-single.html
|   |   |   ├── genindex-split.html
|   |   |   ├── genindex.html
|   |   |   ├── globaltoc.html
|   |   |   ├── layout.html
|   |   |   ├── localtoc.html
|   |   |   ├── opensearch.xml
|   |   |   ├── page.html
|   |   |   ├── relations.html
|   |   |   ├── search.html
|   |   |   ├── searchbox.html
|   |   |   ├── sourcelink.html
|   |   |   └── static
|   |   |       ├── doctools.js
|   |   |       ├── jquery-3.5.1.js
|   |   |       ├── jquery.js
|   |   |       ├── searchtools.js
|   |   |       ├── underscore-1.13.1.js
|   |   |       └── underscore.js
|   |   ├── bizstyle
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── css3-mediaqueries.js
|   |   |       └── css3-mediaqueries_src.js
|   |   ├── classic
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── default
|   |   |   └── static
|   |   |       └── default.css
|   |   ├── epub
|   |   |   ├── epub-cover.html
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── haiku
|   |   |   ├── layout.html
|   |   |   └── static
|   |   ├── nature
|   |   |   └── static
|   |   ├── nonav
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       └── nonav.css
|   |   ├── pyramid
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── epub.css
|   |   |       └── ie6.css
|   |   ├── scrolls
|   |   |   ├── artwork
|   |   |   ├── layout.html
|   |   |   └── static
|   |   |       ├── print.css
|   |   |       └── theme_extras.js
|   |   ├── sphinxdoc
|   |   |   └── static
|   |   └── traditional
|   |       └── static
|   ├── theming.py
|   ├── transforms
|   |   ├── __init__.py
|   |   ├── compact_bullet_list.py
|   |   ├── i18n.py
|   |   ├── post_transforms
|   |   |   ├── __init__.py
|   |   |   ├── code.py
|   |   |   └── images.py
|   |   └── references.py
|   ├── util
|   |   ├── __init__.py
|   |   ├── build_phase.py
|   |   ├── cfamily.py
|   |   ├── compat.py
|   |   ├── console.py
|   |   ├── docfields.py
|   |   ├── docstrings.py
|   |   ├── docutils.py
|   |   ├── fileutil.py
|   |   ├── i18n.py
|   |   ├── images.py
|   |   ├── inspect.py
|   |   ├── inventory.py
|   |   ├── jsdump.py
|   |   ├── logging.py
|   |   ├── matching.py
|   |   ├── math.py
|   |   ├── nodes.py
|   |   ├── osutil.py
|   |   ├── parallel.py
|   |   ├── png.py
|   |   ├── pycompat.py
|   |   ├── requests.py
|   |   ├── rst.py
|   |   ├── smartypants.py
|   |   ├── stemmer
|   |   |   ├── __init__.py
|   |   |   └── porter.py
|   |   ├── tags.py
|   |   ├── template.py
|   |   ├── texescape.py
|   |   └── typing.py
|   ├── versioning.py
|   └── writers
|       ├── __init__.py
|       ├── html.py
|       ├── html5.py
|       ├── latex.py
|       ├── manpage.py
|       ├── texinfo.py
|       ├── text.py
|       └── xml.py
├── tests
|   ├── __init__.py
|   ├── certs
|   ├── conftest.py
|   ├── ext_napoleon_pep526_data_google.py
|   ├── ext_napoleon_pep526_data_numpy.py
|   ├── js
|   |   ├── doctools.js
|   |   └── searchtools.js
|   ├── roots
|   |   ├── test-add_enumerable_node
|   |   |   ├── conf.py
|   |   |   ├── enumerable_node.py
|   |   |   └── index.rst
|   |   ├── test-add_source_parser
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-add_source_parser-conflicts-with-users-setting
|   |   |   ├── conf.py
|   |   |   └── source_parser.py
|   |   ├── test-api-set-translator
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nonext
|   |   |   |   └── conf.py
|   |   |   └── translator.py
|   |   ├── test-apidoc-pep420
|   |   |   └── a
|   |   |       └── b
|   |   ├── test-apidoc-subpackage-in-toc
|   |   |   └── parent
|   |   |       ├── __init__.py
|   |   |       └── child
|   |   ├── test-apidoc-toc
|   |   |   └── mypackage
|   |   |       ├── __init__.py
|   |   |       ├── main.py
|   |   |       ├── no_init
|   |   |       ├── resource
|   |   |       └── something
|   |   ├── test-apidoc-trailing-underscore
|   |   |   └── package_
|   |   |       ├── __init__.py
|   |   |       └── module_.py
|   |   ├── test-autosummary
|   |   |   ├── conf.py
|   |   |   ├── dummy_module.py
|   |   |   ├── index.rst
|   |   |   ├── sphinx.rst
|   |   |   └── underscore_module_.py
|   |   ├── test-basic
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-html-translator
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-build-text
|   |   |   ├── conf.py
|   |   |   ├── doc1.txt
|   |   |   ├── doc2.txt
|   |   |   ├── index.txt
|   |   |   ├── lineblock.txt
|   |   |   ├── listitems.txt
|   |   |   ├── maxwidth.txt
|   |   |   ├── nonascii_maxwidth.txt
|   |   |   ├── nonascii_table.txt
|   |   |   ├── nonascii_title.txt
|   |   |   ├── table.txt
|   |   |   ├── table_colspan.txt
|   |   |   ├── table_colspan_and_rowspan.txt
|   |   |   ├── table_colspan_left.txt
|   |   |   └── table_rowspan.txt
|   |   ├── test-builder-dirhtml
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo
|   |   |   |   ├── foo_1.rst
|   |   |   |   ├── foo_2.rst
|   |   |   |   └── index.rst
|   |   |   └── index.rst
|   |   ├── test-builder-gettext-dont-rebuild-mo
|   |   |   ├── bom.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-changes
|   |   |   ├── base.rst
|   |   |   ├── c-api.rst
|   |   |   ├── conf.py
|   |   |   ├── contents.rst
|   |   |   └── library
|   |   |       └── utils.rst
|   |   ├── test-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-config
|   |   |   └── conf.py
|   |   ├── test-correct-year
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-default_role
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-directive-code
|   |   |   ├── caption.rst
|   |   |   ├── classes.rst
|   |   |   ├── conf.py
|   |   |   ├── emphasize.rst
|   |   |   ├── force.rst
|   |   |   ├── highlight.rst
|   |   |   ├── index.rst
|   |   |   ├── linenos.rst
|   |   |   ├── linenothreshold.rst
|   |   |   ├── namedblocks.rst
|   |   |   ├── py-decorators.rst
|   |   |   ├── python.rst
|   |   |   └── target.py
|   |   ├── test-directive-csv-table
|   |   |   ├── conf.py
|   |   |   └── subdir
|   |   ├── test-directive-only
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── only.rst
|   |   ├── test-directives-raw
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-docutilsconf
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-c
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── function_param_target.rst
|   |   |   ├── index.rst
|   |   |   ├── namespace.rst
|   |   |   └── ns_lookup.rst
|   |   ├── test-domain-c-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-cpp
|   |   |   ├── anon-dup-decl.rst
|   |   |   ├── any-role.rst
|   |   |   ├── backslash.rst
|   |   |   ├── conf.py
|   |   |   ├── field-role.rst
|   |   |   ├── index.rst
|   |   |   ├── lookup-key-overload.rst
|   |   |   ├── multi-decl-lookup.rst
|   |   |   ├── roles-targets-ok.rst
|   |   |   ├── roles-targets-warn.rst
|   |   |   ├── roles.rst
|   |   |   ├── roles2.rst
|   |   |   ├── semicolon.rst
|   |   |   ├── warn-template-param-qualified-name.rst
|   |   |   └── xref_consistency.rst
|   |   ├── test-domain-cpp-intersphinx
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-js
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py
|   |   |   ├── abbr.rst
|   |   |   ├── canonical.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── module.rst
|   |   |   ├── module_option.rst
|   |   |   └── roles.rst
|   |   ├── test-domain-py-python_use_unqualified_type_names
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-domain-py-xref-warning
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-double-inheriting-theme
|   |   |   ├── base_themes_dir
|   |   |   |   ├── base_theme1
|   |   |   |   └── base_theme2
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-epub-anchor-id
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autodoc
|   |   |   ├── autodoc_dummy_bar.py
|   |   |   ├── autodoc_dummy_module.py
|   |   |   ├── bug2437
|   |   |   |   ├── __init__.py
|   |   |   |   └── autodoc_dummy_foo.py
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target
|   |   |       ├── TYPE_CHECKING.py
|   |   |       ├── __init__.py
|   |   |       ├── abstractmethods.py
|   |   |       ├── annotated.py
|   |   |       ├── autoclass_content.py
|   |   |       ├── autodoc_type_aliases.py
|   |   |       ├── bound_method.py
|   |   |       ├── cached_property.py
|   |   |       ├── callable.py
|   |   |       ├── canonical
|   |   |       ├── classes.py
|   |   |       ├── coroutine.py
|   |   |       ├── decorator.py
|   |   |       ├── descriptor.py
|   |   |       ├── docstring_signature.py
|   |   |       ├── empty_all.py
|   |   |       ├── enums.py
|   |   |       ├── final.py
|   |   |       ├── functions.py
|   |   |       ├── generic_class.py
|   |   |       ├── genericalias.py
|   |   |       ├── hide_value.py
|   |   |       ├── imported_members.py
|   |   |       ├── inheritance.py
|   |   |       ├── instance_variable.py
|   |   |       ├── metadata.py
|   |   |       ├── methods.py
|   |   |       ├── module.py
|   |   |       ├── name_conflict
|   |   |       ├── name_mangling.py
|   |   |       ├── need_mocks.py
|   |   |       ├── overload.py
|   |   |       ├── overload2.py
|   |   |       ├── partialfunction.py
|   |   |       ├── partialmethod.py
|   |   |       ├── pep570.py
|   |   |       ├── pep604.py
|   |   |       ├── preserve_defaults.py
|   |   |       ├── private.py
|   |   |       ├── process_docstring.py
|   |   |       ├── properties.py
|   |   |       ├── singledispatch.py
|   |   |       ├── singledispatchmethod.py
|   |   |       ├── slots.py
|   |   |       ├── sort_by_all.py
|   |   |       ├── typed_vars.py
|   |   |       ├── typehints.py
|   |   |       ├── typevar.py
|   |   |       ├── uninitialized_attributes.py
|   |   |       └── wrappedfunction.py
|   |   ├── test-ext-autosectionlabel
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosectionlabel-prefix-document
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── autosummary_importfail.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-filename-map
|   |   |   ├── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-imported_members
|   |   |   ├── autosummary_dummy_package
|   |   |   |   ├── __init__.py
|   |   |   |   └── autosummary_dummy_module.py
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-mock_imports
|   |   |   ├── conf.py
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-autosummary-recursive
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── package
|   |   |   |   ├── __init__.py
|   |   |   |   ├── module.py
|   |   |   |   ├── module_importfail.py
|   |   |   |   └── package
|   |   |   └── package2
|   |   |       ├── __init__.py
|   |   |       └── module.py
|   |   ├── test-ext-autosummary-skip-member
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-autosummary-template
|   |   |   ├── _templates
|   |   |   |   └── empty.rst
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── target.py
|   |   ├── test-ext-coverage
|   |   |   ├── conf.py
|   |   |   ├── coverage_ignored.py
|   |   |   ├── coverage_not_ignored.py
|   |   |   └── index.rst
|   |   ├── test-ext-doctest
|   |   |   ├── conf.py
|   |   |   └── doctest.txt
|   |   ├── test-ext-doctest-skipif
|   |   |   ├── conf.py
|   |   |   └── skipif.txt
|   |   ├── test-ext-doctest-with-autodoc
|   |   |   ├── conf.py
|   |   |   ├── dir
|   |   |   |   ├── __init__.py
|   |   |   |   ├── bar.py
|   |   |   |   └── inner.rst
|   |   |   ├── foo.py
|   |   |   └── index.rst
|   |   ├── test-ext-githubpages
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-graphviz
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-ifconfig
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-imgconverter
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-inheritance_diagram
|   |   |   ├── conf.py
|   |   |   ├── example
|   |   |   |   ├── __init__.py
|   |   |   |   └── sphinx.py
|   |   |   ├── index.rst
|   |   |   └── test.py
|   |   ├── test-ext-intersphinx-cppdomain
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── math.rst
|   |   |   ├── nomath.rst
|   |   |   └── page.rst
|   |   ├── test-ext-math-compat
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-math-simple
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-ext-todo
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-ext-viewcode
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── objects.rst
|   |   |   └── spam
|   |   |       ├── __init__.py
|   |   |       ├── mod1.py
|   |   |       ├── mod2.py
|   |   |       └── mod3.py
|   |   ├── test-ext-viewcode-find
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── not_a_package
|   |   |       ├── __init__.py
|   |   |       └── submodule.py
|   |   ├── test-extensions
|   |   |   ├── conf.py
|   |   |   ├── read_parallel.py
|   |   |   ├── read_serial.py
|   |   |   ├── write_parallel.py
|   |   |   └── write_serial.py
|   |   ├── test-footnotes
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-gettext-template
|   |   |   ├── _templates
|   |   |   |   ├── template1.html
|   |   |   |   └── template2.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-glossary
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-highlight_options
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_assets
|   |   |   ├── conf.py
|   |   |   ├── extra
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   └── subdir
|   |   |   ├── index.rst
|   |   |   ├── static
|   |   |   |   ├── css
|   |   |   |   ├── index.rst
|   |   |   |   ├── js
|   |   |   |   └── subdir
|   |   |   └── subdir
|   |   |       └── _build
|   |   ├── test-html_entity
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_scaled_image_link
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_signaturereturn_icon
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-html_style
|   |   |   ├── _static
|   |   |   |   └── default.css
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-parsed-literal
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-image-in-section
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-images
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── subdir
|   |   |       └── index.rst
|   |   ├── test-index_on_title
|   |   |   ├── conf.py
|   |   |   └── contents.rst
|   |   ├── test-inheritance
|   |   |   ├── basic_diagram.rst
|   |   |   ├── conf.py
|   |   |   ├── diagram_module_w_2_top_classes.rst
|   |   |   ├── diagram_w_1_top_class.rst
|   |   |   ├── diagram_w_2_top_classes.rst
|   |   |   ├── diagram_w_nested_classes.rst
|   |   |   ├── diagram_w_parts.rst
|   |   |   ├── dummy
|   |   |   |   ├── __init__.py
|   |   |   |   ├── test.py
|   |   |   |   └── test_nested.py
|   |   |   └── index.rst
|   |   ├── test-intl
|   |   |   ├── _templates
|   |   |   |   └── contents.html
|   |   |   ├── admonitions.txt
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── definition_terms.txt
|   |   |   ├── docfields.txt
|   |   |   ├── external_links.txt
|   |   |   ├── figure.txt
|   |   |   ├── footnote.txt
|   |   |   ├── glossary_terms.txt
|   |   |   ├── glossary_terms_inconsistency.txt
|   |   |   ├── index.txt
|   |   |   ├── index_entries.txt
|   |   |   ├── label_target.txt
|   |   |   ├── literalblock.txt
|   |   |   ├── only.txt
|   |   |   ├── raw.txt
|   |   |   ├── refs.txt
|   |   |   ├── refs_inconsistency.txt
|   |   |   ├── refs_python_domain.txt
|   |   |   ├── role_xref.txt
|   |   |   ├── rubric.txt
|   |   |   ├── section.txt
|   |   |   ├── seealso.txt
|   |   |   ├── subdir
|   |   |   |   └── index.txt
|   |   |   ├── table.txt
|   |   |   ├── toctree.txt
|   |   |   ├── topic.txt
|   |   |   ├── versionchange.txt
|   |   |   ├── warnings.txt
|   |   |   └── xx
|   |   |       └── LC_MESSAGES
|   |   ├── test-keep_warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-babel
|   |   |   ├── bar.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-latex-container
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-equations
|   |   |   ├── conf.py
|   |   |   ├── equations.rst
|   |   |   └── expects
|   |   ├── test-latex-figure-in-admonition
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-includegraphics
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-index
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-labels
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── otherdoc.rst
|   |   ├── test-latex-numfig
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── indexhowto.rst
|   |   |   └── indexmanual.rst
|   |   ├── test-latex-table
|   |   |   ├── _mytemplates
|   |   |   |   └── latex
|   |   |   ├── complex.rst
|   |   |   ├── conf.py
|   |   |   ├── expects
|   |   |   ├── index.rst
|   |   |   ├── longtable.rst
|   |   |   └── tabular.rst
|   |   ├── test-latex-theme
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── theme
|   |   |       └── custom
|   |   ├── test-latex-title
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-latex-unicode
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck
|   |   |   ├── conf.py
|   |   |   └── links.txt
|   |   ├── test-linkcheck-localserver
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-anchor
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-https
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-linkcheck-localserver-warn-redirects
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-local-logo
|   |   |   ├── conf.py
|   |   |   ├── images
|   |   |   └── index.rst
|   |   ├── test-locale
|   |   |   ├── locale1
|   |   |   |   └── en
|   |   |   └── locale2
|   |   |       └── en
|   |   ├── test-manpage_url
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-citation
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-markup-rubric
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-maxlistdepth
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-metadata
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-need-escaped
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux.rst
|   |   ├── test-nested-enumerated-list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nested-tables
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-nitpicky-warnings
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-numbered-circular
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── sub.rst
|   |   ├── test-numfig
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-productionlist
|   |   |   ├── Bare.rst
|   |   |   ├── Dup1.rst
|   |   |   ├── Dup2.rst
|   |   |   ├── LineContinuation.rst
|   |   |   ├── P1.rst
|   |   |   ├── P2.rst
|   |   |   ├── conf.py
|   |   |   ├── firstLineRule.rst
|   |   |   └── index.rst
|   |   ├── test-prolog
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── markdown.md
|   |   |   ├── prolog_markdown_parser.py
|   |   |   └── restructuredtext.rst
|   |   ├── test-pycode
|   |   |   └── cp_1251_coded.py
|   |   ├── test-pycode-egg
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── src
|   |   |       ├── sample.py
|   |   |       └── setup.py
|   |   ├── test-reST-code-block
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-refonly_bullet_list
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-remote-logo
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-roles-download
|   |   |   ├── another
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-root
|   |   |   ├── _templates
|   |   |   |   ├── contentssb.html
|   |   |   |   ├── customsb.html
|   |   |   |   └── layout.html
|   |   |   ├── autodoc.txt
|   |   |   ├── autodoc_target.py
|   |   |   ├── bom.txt
|   |   |   ├── conf.py
|   |   |   ├── extapi.txt
|   |   |   ├── extensions.txt
|   |   |   ├── footnote.txt
|   |   |   ├── images.txt
|   |   |   ├── includes.txt
|   |   |   ├── index.txt
|   |   |   ├── lists.txt
|   |   |   ├── markup.txt
|   |   |   ├── math.txt
|   |   |   ├── objects.txt
|   |   |   ├── parsermod.py
|   |   |   ├── special
|   |   |   |   └── code.py
|   |   |   └── subdir
|   |   |       ├── excluded.txt
|   |   |       ├── images.txt
|   |   |       └── includes.txt
|   |   ├── test-search
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── nosearch.rst
|   |   |   └── tocitem.rst
|   |   ├── test-setup
|   |   |   ├── doc
|   |   |   |   ├── conf.py
|   |   |   |   └── index.txt
|   |   |   └── setup.py
|   |   ├── test-smartquotes
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   └── literals.rst
|   |   ├── test-stylesheets
|   |   |   ├── _templates
|   |   |   |   └── layout.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-templating
|   |   |   ├── _templates
|   |   |   |   ├── autosummary
|   |   |   |   └── layout.html
|   |   |   ├── autosummary_templating.txt
|   |   |   ├── conf.py
|   |   |   └── index.txt
|   |   ├── test-theming
|   |   |   ├── conf.py
|   |   |   ├── index.rst
|   |   |   ├── setup.py
|   |   |   └── test_theme
|   |   |       ├── __init__.py
|   |   |       ├── staticfiles
|   |   |       └── test-theme
|   |   ├── test-tocdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   ├── qux.rst
|   |   |   └── tocdepth.rst
|   |   ├── test-toctree-duplicated
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   └── index.rst
|   |   ├── test-toctree-empty
|   |   |   ├── _templates
|   |   |   |   └── localtoc.html
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-toctree-glob
|   |   |   ├── bar
|   |   |   |   ├── bar_1.rst
|   |   |   |   ├── bar_2.rst
|   |   |   |   ├── bar_3.rst
|   |   |   |   ├── bar_4
|   |   |   |   └── index.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   ├── quux.rst
|   |   |   └── qux
|   |   |       ├── index.rst
|   |   |       ├── qux_1.rst
|   |   |       └── qux_2.rst
|   |   ├── test-toctree-maxdepth
|   |   |   ├── bar.rst
|   |   |   ├── baz.rst
|   |   |   ├── conf.py
|   |   |   ├── foo.rst
|   |   |   ├── index.rst
|   |   |   └── qux.rst
|   |   ├── test-transforms-post_transforms-missing-reference
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-trim_doctest_flags
|   |   |   ├── conf.py
|   |   |   └── index.rst
|   |   ├── test-versioning
|   |   |   ├── added.txt
|   |   |   ├── conf.py
|   |   |   ├── deleted.txt
|   |   |   ├── deleted_end.txt
|   |   |   ├── index.txt
|   |   |   ├── insert.txt
|   |   |   ├── insert_beginning.txt
|   |   |   ├── insert_similar.txt
|   |   |   ├── modified.txt
|   |   |   └── original.txt
|   |   └── test-warnings
|   |       ├── autodoc_fodder.py
|   |       ├── conf.py
|   |       ├── index.rst
|   |       └── undecodable.rst
|   ├── test_api_translator.py
|   ├── test_application.py
|   ├── test_build.py
|   ├── test_build_changes.py
|   ├── test_build_dirhtml.py
|   ├── test_build_epub.py
|   ├── test_build_gettext.py
|   ├── test_build_html.py
|   ├── test_build_latex.py
|   ├── test_build_linkcheck.py
|   ├── test_build_manpage.py
|   ├── test_build_texinfo.py
|   ├── test_build_text.py
|   ├── test_builder.py
|   ├── test_catalogs.py
|   ├── test_config.py
|   ├── test_correct_year.py
|   ├── test_directive_code.py
|   ├── test_directive_only.py
|   ├── test_directive_other.py
|   ├── test_directive_patch.py
|   ├── test_docutilsconf.py
|   ├── test_domain_c.py
|   ├── test_domain_cpp.py
|   ├── test_domain_js.py
|   ├── test_domain_py.py
|   ├── test_domain_rst.py
|   ├── test_domain_std.py
|   ├── test_environment.py
|   ├── test_environment_indexentries.py
|   ├── test_environment_toctree.py
|   ├── test_errors.py
|   ├── test_events.py
|   ├── test_ext_apidoc.py
|   ├── test_ext_autodoc.py
|   ├── test_ext_autodoc_autoattribute.py
|   ├── test_ext_autodoc_autoclass.py
|   ├── test_ext_autodoc_autodata.py
|   ├── test_ext_autodoc_autofunction.py
|   ├── test_ext_autodoc_automodule.py
|   ├── test_ext_autodoc_autoproperty.py
|   ├── test_ext_autodoc_configs.py
|   ├── test_ext_autodoc_events.py
|   ├── test_ext_autodoc_mock.py
|   ├── test_ext_autodoc_preserve_defaults.py
|   ├── test_ext_autodoc_private_members.py
|   ├── test_ext_autosectionlabel.py
|   ├── test_ext_autosummary.py
|   ├── test_ext_coverage.py
|   ├── test_ext_doctest.py
|   ├── test_ext_duration.py
|   ├── test_ext_githubpages.py
|   ├── test_ext_graphviz.py
|   ├── test_ext_ifconfig.py
|   ├── test_ext_imgconverter.py
|   ├── test_ext_inheritance_diagram.py
|   ├── test_ext_intersphinx.py
|   ├── test_ext_math.py
|   ├── test_ext_napoleon.py
|   ├── test_ext_napoleon_docstring.py
|   ├── test_ext_napoleon_iterators.py
|   ├── test_ext_todo.py
|   ├── test_ext_viewcode.py
|   ├── test_highlighting.py
|   ├── test_intl.py
|   ├── test_locale.py
|   ├── test_markup.py
|   ├── test_metadata.py
|   ├── test_parser.py
|   ├── test_project.py
|   ├── test_pycode.py
|   ├── test_pycode_ast.py
|   ├── test_pycode_parser.py
|   ├── test_quickstart.py
|   ├── test_roles.py
|   ├── test_search.py
|   ├── test_setup_command.py
|   ├── test_smartquotes.py
|   ├── test_templating.py
|   ├── test_theming.py
|   ├── test_toctree.py
|   ├── test_transforms_post_transforms.py
|   ├── test_transforms_post_transforms_code.py
|   ├── test_util.py
|   ├── test_util_docstrings.py
|   ├── test_util_docutils.py
|   ├── test_util_fileutil.py
|   ├── test_util_i18n.py
|   ├── test_util_images.py
|   ├── test_util_inspect.py
|   ├── test_util_inventory.py
|   ├── test_util_jsdump.py
|   ├── test_util_logging.py
|   ├── test_util_matching.py
|   ├── test_util_nodes.py
|   ├── test_util_rst.py
|   ├── test_util_template.py
|   ├── test_util_typing.py
|   ├── test_versioning.py
|   ├── test_writer_latex.py
|   ├── typing_test_data.py
|   └── utils.py
└── utils
    ├── __init__.py
    ├── bump_docker.sh
    ├── bump_version.py
    ├── checks.py
    ├── doclinter.py
    └── jssplitter_generator.py
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---

Issue: Inherited classes not correctly documented when mocked

Description: ### Describe the bug

We're experiencing an issue when documenting classes that inherit mocked classes. However, classes which inherit other classes from our own package are ok.

This issue appears to be dependent on the `sphinx` version:

- `sphinx<3.0`: Everything is OK. 
- `sphinx>=3.0 < 3.4.2`: Classes that inherit mocked classes are not documented. (see [sphinx #8164](https://github.com/sphinx-doc/sphinx/issues/8164)). This is fixed in `sphinx 3.4.2`. 
- `sphinx>=3.4.2`: The previously missing classes are now documented, but there is a problem with the "Bases" section in the docs. 
 
Example: In the docs for `alibi_detect.utils.pytorch.kernels.DeepKernel` in this readthedocs build https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html, the base class is listed as "Bases: `torch.nn.`" instead of "Bases: `torch.nn.Module`". 


### How to Reproduce

```
$ git clone https://github.com/ascillitoe/alibi-detect.git
$ cd alibi-detect
$ pip install -r requirements/docs.txt
$ make build_docs
$ # open doc/_build/html/api/alibi_detect.utils.pytorch.kernels.html and see "Bases" section.
```


### Expected behavior

The "Bases" section should report `torch.nn.Module` not `torch.nn.`. 

i.e. see
https://seldon--325.org.readthedocs.build/projects/alibi-detect/en/325/api/alibi_detect.utils.pytorch.kernels.html

### Your project

https://github.com/ascillitoe/alibi-detect/tree/feature_sphinx4

### Screenshots

### Screenshot with `sphinx==4.2`
![sphinx_problem](https://user-images.githubusercontent.com/32061685/133816582-ca162b07-41c7-4b8e-98ea-781e7c659229.png)

### Screenshot with `sphinx<3.0`
![sphinx_working](https://user-images.githubusercontent.com/32061685/133816065-6291ce1b-96cf-4b0f-9648-7f993fc15611.png)



### OS

Ubuntu 18.04 (used by readthedocs/build:6.0)

### Python version

3.8.11

### Sphinx version

`>=3.4.2`

### Sphinx extensions

    ["sphinx.ext.autodoc",
    "sphinx.ext.doctest",
    "sphinx.ext.intersphinx",
    "sphinx.ext.todo",
    "sphinx.ext.coverage",
    "sphinx.ext.mathjax",
    "sphinx.ext.ifconfig",
    "sphinx.ext.viewcode",
    "sphinx.ext.napoleon",
    "sphinx_autodoc_typehints",
    "sphinxcontrib.apidoc", 
    "nbsphinx",
    "nbsphinx_link",  
    "myst_parser"]


### Extra tools

_No response_

### Additional context

demo PR:
https://github.com/SeldonIO/alibi-detect/pull/338

readthedocs demo build:
https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html



Patch information:
diff --git a/doc/usage/extensions/autodoc.rst b/doc/usage/extensions/autodoc.rst
index 5ac3cd171..717981aab 100644
--- a/doc/usage/extensions/autodoc.rst
+++ b/doc/usage/extensions/autodoc.rst
@@ -773,6 +773,11 @@ needed docstring processing in event :event:`autodoc-process-docstring`:
    modify **in place** to change what Sphinx puts into the output.  It's
    emitted only if ``show-inheritance`` option given.
 
+   The list is normalized to contain class objects (or strings) even when
+   modules are mocked via ``autodoc_mock_imports``. In particular, mocked
+   base entries are converted to their classes for consistent downstream
+   processing and correct display in the "Bases" section.
+
    :param app: the Sphinx application object
    :param name: the fully qualified name of the object
    :param obj: the object itself
diff --git a/sphinx/ext/autodoc/__init__.py b/sphinx/ext/autodoc/__init__.py
index a255c0691..e2243134a 100644
--- a/sphinx/ext/autodoc/__init__.py
+++ b/sphinx/ext/autodoc/__init__.py
@@ -1661,6 +1661,9 @@ class ClassDocumenter(DocstringSignatureMixin, ModuleLevelDocumenter):  # type:
             else:
                 bases = []
 
+            # Normalize mocked base entries to their classes for display
+            bases = [b.__class__ if ismock(b) else b for b in bases]
+
             self.env.events.emit('autodoc-process-bases',
                                  self.fullname, self.object, self.options, bases)
 


OBJECTIVE: Find 3 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 3 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 3 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of `tests/test_ext_autodoc_mock.py`, `tests/test_ext_autodoc_autoclass.py`, and `sphinx/ext/autodoc/mock.py`.
Extra Requirements: 
Purpose: This context will enable me to find 3 relevant test cases that cover the user's scenario of documenting classes with mocked base classes, mocked base classes, including setup, mocking, and assertions.

Previous refined query 2:
Essential Query: Please provide the full content of `tests/test_ext_autodoc.py` and `sphinx/ext/autodoc/__init__.py`.
Extra Requirements: 
Purpose: This will allow me to find a test case that covers inheritance from mocked objects and to examine the code in `ClassDocumenter` that generates the "Bases" list, which is directly related to the bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: sphinx/ext/autodoc/__init__.py
Line number range: 1 - 500
Content:
1. """
2.     sphinx.ext.autodoc
3.     ~~~~~~~~~~~~~~~~~~
4. 
5.     Automatically insert docstrings for functions, classes or whole modules into
6.     the doctree, thus avoiding duplication between docstrings and documentation
7.     for those who like elaborate docstrings.
8. 
9.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
10.     :license: BSD, see LICENSE for details.
11. """
12. 
13. import re
14. import warnings
15. from inspect import Parameter, Signature
16. from types import ModuleType
17. from typing import (TYPE_CHECKING, Any, Callable, Dict, Iterator, List, Optional, Sequence,
18.                     Set, Tuple, Type, TypeVar, Union)
19. 
20. from docutils.statemachine import StringList
21. 
22. import sphinx
23. from sphinx.application import Sphinx
24. from sphinx.config import ENUM, Config
25. from sphinx.deprecation import RemovedInSphinx50Warning, RemovedInSphinx60Warning
26. from sphinx.environment import BuildEnvironment
27. from sphinx.ext.autodoc.importer import (get_class_members, get_object_members, import_module,
28.                                          import_object)
29. from sphinx.ext.autodoc.mock import ismock, mock, undecorate
30. from sphinx.locale import _, __
31. from sphinx.pycode import ModuleAnalyzer, PycodeError
32. from sphinx.util import inspect, logging
33. from sphinx.util.docstrings import prepare_docstring, separate_metadata
34. from sphinx.util.inspect import (evaluate_signature, getdoc, object_description, safe_getattr,
35.                                  stringify_signature)
36. from sphinx.util.typing import OptionSpec, get_type_hints, restify
37. from sphinx.util.typing import stringify as stringify_typehint
38. 
39. if TYPE_CHECKING:
40.     from sphinx.ext.autodoc.directive import DocumenterBridge
41. 
42. 
43. logger = logging.getLogger(__name__)
44. 
45. 
46. # This type isn't exposed directly in any modules, but can be found
47. # here in most Python versions
48. MethodDescriptorType = type(type.__subclasses__)
49. 
50. 
51. #: extended signature RE: with explicit module name separated by ::
52. py_ext_sig_re = re.compile(
53.     r'''^ ([\w.]+::)?            # explicit module name
54.           ([\w.]+\.)?            # module and/or class name(s)
55.           (\w+)  \s*             # thing name
56.           (?: \((.*)\)           # optional: arguments
57.            (?:\s* -> \s* (.*))?  #           return annotation
58.           )? $                   # and nothing more
59.           ''', re.VERBOSE)
60. special_member_re = re.compile(r'^__\S+__$')
61. 
62. 
63. def identity(x: Any) -> Any:
64.     return x
65. 
66. 
67. class _All:
68.     """A special value for :*-members: that matches to any member."""
69. 
70.     def __contains__(self, item: Any) -> bool:
71.         return True
72. 
73.     def append(self, item: Any) -> None:
74.         pass  # nothing
75. 
76. 
77. class _Empty:
78.     """A special value for :exclude-members: that never matches to any member."""
79. 
80.     def __contains__(self, item: Any) -> bool:
81.         return False
82. 
83. 
84. ALL = _All()
85. EMPTY = _Empty()
86. UNINITIALIZED_ATTR = object()
87. INSTANCEATTR = object()
88. SLOTSATTR = object()
89. 
90. 
91. def members_option(arg: Any) -> Union[object, List[str]]:
92.     """Used to convert the :members: option to auto directives."""
93.     if arg in (None, True):
94.         return ALL
95.     elif arg is False:
96.         return None
97.     else:
98.         return [x.strip() for x in arg.split(',') if x.strip()]
99. 
100. 
101. def members_set_option(arg: Any) -> Union[object, Set[str]]:
102.     """Used to convert the :members: option to auto directives."""
103.     warnings.warn("members_set_option() is deprecated.",
104.                   RemovedInSphinx50Warning, stacklevel=2)
105.     if arg is None:
106.         return ALL
107.     return {x.strip() for x in arg.split(',') if x.strip()}
108. 
109. 
110. def exclude_members_option(arg: Any) -> Union[object, Set[str]]:
111.     """Used to convert the :exclude-members: option."""
112.     if arg in (None, True):
113.         return EMPTY
114.     return {x.strip() for x in arg.split(',') if x.strip()}
115. 
116. 
117. def inherited_members_option(arg: Any) -> Union[object, Set[str]]:
118.     """Used to convert the :members: option to auto directives."""
119.     if arg in (None, True):
120.         return 'object'
121.     else:
122.         return arg
123. 
124. 
125. def member_order_option(arg: Any) -> Optional[str]:
126.     """Used to convert the :members: option to auto directives."""
127.     if arg in (None, True):
128.         return None
129.     elif arg in ('alphabetical', 'bysource', 'groupwise'):
130.         return arg
131.     else:
132.         raise ValueError(__('invalid value for member-order option: %s') % arg)
133. 
134. 
135. def class_doc_from_option(arg: Any) -> Optional[str]:
136.     """Used to convert the :class-doc-from: option to autoclass directives."""
137.     if arg in ('both', 'class', 'init'):
138.         return arg
139.     else:
140.         raise ValueError(__('invalid value for class-doc-from option: %s') % arg)
141. 
142. 
143. SUPPRESS = object()
144. 
145. 
146. def annotation_option(arg: Any) -> Any:
147.     if arg in (None, True):
148.         # suppress showing the representation of the object
149.         return SUPPRESS
150.     else:
151.         return arg
152. 
153. 
154. def bool_option(arg: Any) -> bool:
155.     """Used to convert flag options to auto directives.  (Instead of
156.     directives.flag(), which returns None).
157.     """
158.     return True
159. 
160. 
161. def merge_special_members_option(options: Dict) -> None:
162.     """Merge :special-members: option to :members: option."""
163.     warnings.warn("merge_special_members_option() is deprecated.",
164.                   RemovedInSphinx50Warning, stacklevel=2)
165.     if 'special-members' in options and options['special-members'] is not ALL:
166.         if options.get('members') is ALL:
167.             pass
168.         elif options.get('members'):
169.             for member in options['special-members']:
170.                 if member not in options['members']:
171.                     options['members'].append(member)
172.         else:
173.             options['members'] = options['special-members']
174. 
175. 
176. def merge_members_option(options: Dict) -> None:
177.     """Merge :*-members: option to the :members: option."""
178.     if options.get('members') is ALL:
179.         # merging is not needed when members: ALL
180.         return
181. 
182.     members = options.setdefault('members', [])
183.     for key in {'private-members', 'special-members'}:
184.         if key in options and options[key] not in (ALL, None):
185.             for member in options[key]:
186.                 if member not in members:
187.                     members.append(member)
188. 
189. 
190. # Some useful event listener factories for autodoc-process-docstring.
191. 
192. def cut_lines(pre: int, post: int = 0, what: str = None) -> Callable:
193.     """Return a listener that removes the first *pre* and last *post*
194.     lines of every docstring.  If *what* is a sequence of strings,
195.     only docstrings of a type in *what* will be processed.
196. 
197.     Use like this (e.g. in the ``setup()`` function of :file:`conf.py`)::
198. 
199.        from sphinx.ext.autodoc import cut_lines
200.        app.connect('autodoc-process-docstring', cut_lines(4, what=['module']))
201. 
202.     This can (and should) be used in place of :confval:`automodule_skip_lines`.
203.     """
204.     def process(app: Sphinx, what_: str, name: str, obj: Any, options: Any, lines: List[str]
205.                 ) -> None:
206.         if what and what_ not in what:
207.             return
208.         del lines[:pre]
209.         if post:
210.             # remove one trailing blank line.
211.             if lines and not lines[-1]:
212.                 lines.pop(-1)
213.             del lines[-post:]
214.         # make sure there is a blank line at the end
215.         if lines and lines[-1]:
216.             lines.append('')
217.     return process
218. 
219. 
220. def between(marker: str, what: Sequence[str] = None, keepempty: bool = False,
221.             exclude: bool = False) -> Callable:
222.     """Return a listener that either keeps, or if *exclude* is True excludes,
223.     lines between lines that match the *marker* regular expression.  If no line
224.     matches, the resulting docstring would be empty, so no change will be made
225.     unless *keepempty* is true.
226. 
227.     If *what* is a sequence of strings, only docstrings of a type in *what* will
228.     be processed.
229.     """
230.     marker_re = re.compile(marker)
231. 
232.     def process(app: Sphinx, what_: str, name: str, obj: Any, options: Any, lines: List[str]
233.                 ) -> None:
234.         if what and what_ not in what:
235.             return
236.         deleted = 0
237.         delete = not exclude
238.         orig_lines = lines[:]
239.         for i, line in enumerate(orig_lines):
240.             if delete:
241.                 lines.pop(i - deleted)
242.                 deleted += 1
243.             if marker_re.match(line):
244.                 delete = not delete
245.                 if delete:
246.                     lines.pop(i - deleted)
247.                     deleted += 1
248.         if not lines and not keepempty:
249.             lines[:] = orig_lines
250.         # make sure there is a blank line at the end
251.         if lines and lines[-1]:
252.             lines.append('')
253.     return process
254. 
255. 
256. # This class is used only in ``sphinx.ext.autodoc.directive``,
257. # But we define this class here to keep compatibility (see #4538)
258. class Options(dict):
259.     """A dict/attribute hybrid that returns None on nonexisting keys."""
260.     def copy(self) -> "Options":
261.         return Options(super().copy())
262. 
263.     def __getattr__(self, name: str) -> Any:
264.         try:
265.             return self[name.replace('_', '-')]
266.         except KeyError:
267.             return None
268. 
269. 
270. class ObjectMember(tuple):
271.     """A member of object.
272. 
273.     This is used for the result of `Documenter.get_object_members()` to
274.     represent each member of the object.
275. 
276.     .. Note::
277. 
278.        An instance of this class behaves as a tuple of (name, object)
279.        for compatibility to old Sphinx.  The behavior will be dropped
280.        in the future.  Therefore extensions should not use the tuple
281.        interface.
282.     """
283. 
284.     def __new__(cls, name: str, obj: Any, **kwargs: Any) -> Any:
285.         return super().__new__(cls, (name, obj))  # type: ignore
286. 
287.     def __init__(self, name: str, obj: Any, docstring: Optional[str] = None,
288.                  class_: Any = None, skipped: bool = False) -> None:
289.         self.__name__ = name
290.         self.object = obj
291.         self.docstring = docstring
292.         self.skipped = skipped
293.         self.class_ = class_
294. 
295. 
296. ObjectMembers = Union[List[ObjectMember], List[Tuple[str, Any]]]
297. 
298. 
299. class Documenter:
300.     """
301.     A Documenter knows how to autodocument a single object type.  When
302.     registered with the AutoDirective, it will be used to document objects
303.     of that type when needed by autodoc.
304. 
305.     Its *objtype* attribute selects what auto directive it is assigned to
306.     (the directive name is 'auto' + objtype), and what directive it generates
307.     by default, though that can be overridden by an attribute called
308.     *directivetype*.
309. 
310.     A Documenter has an *option_spec* that works like a docutils directive's;
311.     in fact, it will be used to parse an auto directive's options that matches
312.     the Documenter.
313.     """
314.     #: name by which the directive is called (auto...) and the default
315.     #: generated directive name
316.     objtype = 'object'
317.     #: indentation by which to indent the directive content
318.     content_indent = '   '
319.     #: priority if multiple documenters return True from can_document_member
320.     priority = 0
321.     #: order if autodoc_member_order is set to 'groupwise'
322.     member_order = 0
323.     #: true if the generated content may contain titles
324.     titles_allowed = False
325. 
326.     option_spec: OptionSpec = {
327.         'noindex': bool_option
328.     }
329. 
330.     def get_attr(self, obj: Any, name: str, *defargs: Any) -> Any:
331.         """getattr() override for types such as Zope interfaces."""
332.         return autodoc_attrgetter(self.env.app, obj, name, *defargs)
333. 
334.     @classmethod
335.     def can_document_member(cls, member: Any, membername: str, isattr: bool, parent: Any
336.                             ) -> bool:
337.         """Called to see if a member can be documented by this Documenter."""
338.         raise NotImplementedError('must be implemented in subclasses')
339. 
340.     def __init__(self, directive: "DocumenterBridge", name: str, indent: str = '') -> None:
341.         self.directive = directive
342.         self.config: Config = directive.env.config
343.         self.env: BuildEnvironment = directive.env
344.         self.options = directive.genopt
345.         self.name = name
346.         self.indent = indent
347.         # the module and object path within the module, and the fully
348.         # qualified name (all set after resolve_name succeeds)
349.         self.modname: str = None
350.         self.module: ModuleType = None
351.         self.objpath: List[str] = None
352.         self.fullname: str = None
353.         # extra signature items (arguments and return annotation,
354.         # also set after resolve_name succeeds)
355.         self.args: str = None
356.         self.retann: str = None
357.         # the object to document (set after import_object succeeds)
358.         self.object: Any = None
359.         self.object_name: str = None
360.         # the parent/owner of the object to document
361.         self.parent: Any = None
362.         # the module analyzer to get at attribute docs, or None
363.         self.analyzer: ModuleAnalyzer = None
364. 
365.     @property
366.     def documenters(self) -> Dict[str, Type["Documenter"]]:
367.         """Returns registered Documenter classes"""
368.         return self.env.app.registry.documenters
369. 
370.     def add_line(self, line: str, source: str, *lineno: int) -> None:
371.         """Append one line of generated reST to the output."""
372.         if line.strip():  # not a blank line
373.             self.directive.result.append(self.indent + line, source, *lineno)
374.         else:
375.             self.directive.result.append('', source, *lineno)
376. 
377.     def resolve_name(self, modname: str, parents: Any, path: str, base: Any
378.                      ) -> Tuple[str, List[str]]:
379.         """Resolve the module and name of the object to document given by the
380.         arguments and the current module/class.
381. 
382.         Must return a pair of the module name and a chain of attributes; for
383.         example, it would return ``('zipfile', ['ZipFile', 'open'])`` for the
384.         ``zipfile.ZipFile.open`` method.
385.         """
386.         raise NotImplementedError('must be implemented in subclasses')
387. 
388.     def parse_name(self) -> bool:
389.         """Determine what module to import and what attribute to document.
390. 
391.         Returns True and sets *self.modname*, *self.objpath*, *self.fullname*,
392.         *self.args* and *self.retann* if parsing and resolving was successful.
393.         """
394.         # first, parse the definition -- auto directives for classes and
395.         # functions can contain a signature which is then used instead of
396.         # an autogenerated one
397.         try:
398.             matched = py_ext_sig_re.match(self.name)
399.             explicit_modname, path, base, args, retann = matched.groups()
400.         except AttributeError:
401.             logger.warning(__('invalid signature for auto%s (%r)') % (self.objtype, self.name),
402.                            type='autodoc')
403.             return False
404. 
405.         # support explicit module and class name separation via ::
406.         if explicit_modname is not None:
407.             modname = explicit_modname[:-2]
408.             parents = path.rstrip('.').split('.') if path else []
409.         else:
410.             modname = None
411.             parents = []
412. 
413.         with mock(self.config.autodoc_mock_imports):
414.             self.modname, self.objpath = self.resolve_name(modname, parents, path, base)
415. 
416.         if not self.modname:
417.             return False
418. 
419.         self.args = args
420.         self.retann = retann
421.         self.fullname = ((self.modname or '') +
422.                          ('.' + '.'.join(self.objpath) if self.objpath else ''))
423.         return True
424. 
425.     def import_object(self, raiseerror: bool = False) -> bool:
426.         """Import the object given by *self.modname* and *self.objpath* and set
427.         it as *self.object*.
428. 
429.         Returns True if successful, False if an error occurred.
430.         """
431.         with mock(self.config.autodoc_mock_imports):
432.             try:
433.                 ret = import_object(self.modname, self.objpath, self.objtype,
434.                                     attrgetter=self.get_attr,
435.                                     warningiserror=self.config.autodoc_warningiserror)
436.                 self.module, self.parent, self.object_name, self.object = ret
437.                 if ismock(self.object):
438.                     self.object = undecorate(self.object)
439.                 return True
440.             except ImportError as exc:
441.                 if raiseerror:
442.                     raise
443.                 else:
444.                     logger.warning(exc.args[0], type='autodoc', subtype='import_object')
445.                     self.env.note_reread()
446.                     return False
447. 
448.     def get_real_modname(self) -> str:
449.         """Get the real module name of an object to document.
450. 
451.         It can differ from the name of the module through which the object was
452.         imported.
453.         """
454.         return self.get_attr(self.object, '__module__', None) or self.modname
455. 
456.     def check_module(self) -> bool:
457.         """Check if *self.object* is really defined in the module given by
458.         *self.modname*.
459.         """
460.         if self.options.imported_members:
461.             return True
462. 
463.         subject = inspect.unpartial(self.object)
464.         modname = self.get_attr(subject, '__module__', None)
465.         if modname and modname != self.modname:
466.             return False
467.         return True
468. 
469.     def format_args(self, **kwargs: Any) -> str:
470.         """Format the argument signature of *self.object*.
471. 
472.         Should return None if the object does not have a signature.
473.         """
474.         return None
475. 
476.     def format_name(self) -> str:
477.         """Format the name of *self.object*.
478. 
479.         This normally should be something that can be parsed by the generated
480.         directive, but doesn't need to be (Sphinx will display it unparsed
481.         then).
482.         """
483.         # normally the name doesn't contain the module (except for module
484.         # directives of course)
485.         return '.'.join(self.objpath) or self.modname
486. 
487.     def _call_format_args(self, **kwargs: Any) -> str:
488.         if kwargs:
489.             try:
490.                 return self.format_args(**kwargs)
491.             except TypeError:
492.                 # avoid chaining exceptions, by putting nothing here
493.                 pass
494. 
495.         # retry without arguments for old documenters
496.         return self.format_args()
497. 
498.     def format_signature(self, **kwargs: Any) -> str:
499.         """Format the signature (arguments and return annotation) of the object.
500. 


File: sphinx/ext/autodoc/__init__.py
Line number range: 1434 - 1776
Content:
1434. class ClassDocumenter(DocstringSignatureMixin, ModuleLevelDocumenter):  # type: ignore
1435.     """
1436.     Specialized Documenter subclass for classes.
1437.     """
1438.     objtype = 'class'
1439.     member_order = 20
1440.     option_spec: OptionSpec = {
1441.         'members': members_option, 'undoc-members': bool_option,
1442.         'noindex': bool_option, 'inherited-members': inherited_members_option,
1443.         'show-inheritance': bool_option, 'member-order': member_order_option,
1444.         'exclude-members': exclude_members_option,
1445.         'private-members': members_option, 'special-members': members_option,
1446.         'class-doc-from': class_doc_from_option,
1447.     }
1448. 
1449.     _signature_class: Any = None
1450.     _signature_method_name: str = None
1451. 
1452.     def __init__(self, *args: Any) -> None:
1453.         super().__init__(*args)
1454. 
1455.         if self.config.autodoc_class_signature == 'separated':
1456.             self.options = self.options.copy()
1457. 
1458.             # show __init__() method
1459.             if self.options.special_members is None:
1460.                 self.options['special-members'] = ['__new__', '__init__']
1461.             else:
1462.                 self.options.special_members.append('__new__')
1463.                 self.options.special_members.append('__init__')
1464. 
1465.         merge_members_option(self.options)
1466. 
1467.     @classmethod
1468.     def can_document_member(cls, member: Any, membername: str, isattr: bool, parent: Any
1469.                             ) -> bool:
1470.         return isinstance(member, type)
1471. 
1472.     def import_object(self, raiseerror: bool = False) -> bool:
1473.         ret = super().import_object(raiseerror)
1474.         # if the class is documented under another name, document it
1475.         # as data/attribute
1476.         if ret:
1477.             if hasattr(self.object, '__name__'):
1478.                 self.doc_as_attr = (self.objpath[-1] != self.object.__name__)
1479.             else:
1480.                 self.doc_as_attr = True
1481.         return ret
1482. 
1483.     def _get_signature(self) -> Tuple[Optional[Any], Optional[str], Optional[Signature]]:
1484.         def get_user_defined_function_or_method(obj: Any, attr: str) -> Any:
1485.             """ Get the `attr` function or method from `obj`, if it is user-defined. """
1486.             if inspect.is_builtin_class_method(obj, attr):
1487.                 return None
1488.             attr = self.get_attr(obj, attr, None)
1489.             if not (inspect.ismethod(attr) or inspect.isfunction(attr)):
1490.                 return None
1491.             return attr
1492. 
1493.         # This sequence is copied from inspect._signature_from_callable.
1494.         # ValueError means that no signature could be found, so we keep going.
1495. 
1496.         # First, we check the obj has a __signature__ attribute
1497.         if (hasattr(self.object, '__signature__') and
1498.                 isinstance(self.object.__signature__, Signature)):
1499.             return None, None, self.object.__signature__
1500. 
1501.         # Next, let's see if it has an overloaded __call__ defined
1502.         # in its metaclass
1503.         call = get_user_defined_function_or_method(type(self.object), '__call__')
1504. 
1505.         if call is not None:
1506.             if "{0.__module__}.{0.__qualname__}".format(call) in _METACLASS_CALL_BLACKLIST:
1507.                 call = None
1508. 
1509.         if call is not None:
1510.             self.env.app.emit('autodoc-before-process-signature', call, True)
1511.             try:
1512.                 sig = inspect.signature(call, bound_method=True,
1513.                                         type_aliases=self.config.autodoc_type_aliases)
1514.                 return type(self.object), '__call__', sig
1515.             except ValueError:
1516.                 pass
1517. 
1518.         # Now we check if the 'obj' class has a '__new__' method
1519.         new = get_user_defined_function_or_method(self.object, '__new__')
1520. 
1521.         if new is not None:
1522.             if "{0.__module__}.{0.__qualname__}".format(new) in _CLASS_NEW_BLACKLIST:
1523.                 new = None
1524. 
1525.         if new is not None:
1526.             self.env.app.emit('autodoc-before-process-signature', new, True)
1527.             try:
1528.                 sig = inspect.signature(new, bound_method=True,
1529.                                         type_aliases=self.config.autodoc_type_aliases)
1530.                 return self.object, '__new__', sig
1531.             except ValueError:
1532.                 pass
1533. 
1534.         # Finally, we should have at least __init__ implemented
1535.         init = get_user_defined_function_or_method(self.object, '__init__')
1536.         if init is not None:
1537.             self.env.app.emit('autodoc-before-process-signature', init, True)
1538.             try:
1539.                 sig = inspect.signature(init, bound_method=True,
1540.                                         type_aliases=self.config.autodoc_type_aliases)
1541.                 return self.object, '__init__', sig
1542.             except ValueError:
1543.                 pass
1544. 
1545.         # None of the attributes are user-defined, so fall back to let inspect
1546.         # handle it.
1547.         # We don't know the exact method that inspect.signature will read
1548.         # the signature from, so just pass the object itself to our hook.
1549.         self.env.app.emit('autodoc-before-process-signature', self.object, False)
1550.         try:
1551.             sig = inspect.signature(self.object, bound_method=False,
1552.                                     type_aliases=self.config.autodoc_type_aliases)
1553.             return None, None, sig
1554.         except ValueError:
1555.             pass
1556. 
1557.         # Still no signature: happens e.g. for old-style classes
1558.         # with __init__ in C and no `__text_signature__`.
1559.         return None, None, None
1560. 
1561.     def format_args(self, **kwargs: Any) -> str:
1562.         if self.config.autodoc_typehints in ('none', 'description'):
1563.             kwargs.setdefault('show_annotation', False)
1564. 
1565.         try:
1566.             self._signature_class, self._signature_method_name, sig = self._get_signature()
1567.         except TypeError as exc:
1568.             # __signature__ attribute contained junk
1569.             logger.warning(__("Failed to get a constructor signature for %s: %s"),
1570.                            self.fullname, exc)
1571.             return None
1572. 
1573.         if sig is None:
1574.             return None
1575. 
1576.         return stringify_signature(sig, show_return_annotation=False, **kwargs)
1577. 
1578.     def format_signature(self, **kwargs: Any) -> str:
1579.         if self.doc_as_attr:
1580.             return ''
1581.         if self.config.autodoc_class_signature == 'separated':
1582.             # do not show signatures
1583.             return ''
1584. 
1585.         sig = super().format_signature()
1586.         sigs = []
1587. 
1588.         overloads = self.get_overloaded_signatures()
1589.         if overloads and self.config.autodoc_typehints != 'none':
1590.             # Use signatures for overloaded methods instead of the implementation method.
1591.             method = safe_getattr(self._signature_class, self._signature_method_name, None)
1592.             __globals__ = safe_getattr(method, '__globals__', {})
1593.             for overload in overloads:
1594.                 overload = evaluate_signature(overload, __globals__,
1595.                                               self.config.autodoc_type_aliases)
1596. 
1597.                 parameters = list(overload.parameters.values())
1598.                 overload = overload.replace(parameters=parameters[1:],
1599.                                             return_annotation=Parameter.empty)
1600.                 sig = stringify_signature(overload, **kwargs)
1601.                 sigs.append(sig)
1602.         else:
1603.             sigs.append(sig)
1604. 
1605.         return "\n".join(sigs)
1606. 
1607.     def get_overloaded_signatures(self) -> List[Signature]:
1608.         if self._signature_class and self._signature_method_name:
1609.             for cls in self._signature_class.__mro__:
1610.                 try:
1611.                     analyzer = ModuleAnalyzer.for_module(cls.__module__)
1612.                     analyzer.analyze()
1613.                     qualname = '.'.join([cls.__qualname__, self._signature_method_name])
1614.                     if qualname in analyzer.overloads:
1615.                         return analyzer.overloads.get(qualname)
1616.                     elif qualname in analyzer.tagorder:
1617.                         # the constructor is defined in the class, but not overridden.
1618.                         return []
1619.                 except PycodeError:
1620.                     pass
1621. 
1622.         return []
1623. 
1624.     def get_canonical_fullname(self) -> Optional[str]:
1625.         __modname__ = safe_getattr(self.object, '__module__', self.modname)
1626.         __qualname__ = safe_getattr(self.object, '__qualname__', None)
1627.         if __qualname__ is None:
1628.             __qualname__ = safe_getattr(self.object, '__name__', None)
1629.         if __qualname__ and '<locals>' in __qualname__:
1630.             # No valid qualname found if the object is defined as locals
1631.             __qualname__ = None
1632. 
1633.         if __modname__ and __qualname__:
1634.             return '.'.join([__modname__, __qualname__])
1635.         else:
1636.             return None
1637. 
1638.     def add_directive_header(self, sig: str) -> None:
1639.         sourcename = self.get_sourcename()
1640. 
1641.         if self.doc_as_attr:
1642.             self.directivetype = 'attribute'
1643.         super().add_directive_header(sig)
1644. 
1645.         if self.analyzer and '.'.join(self.objpath) in self.analyzer.finals:
1646.             self.add_line('   :final:', sourcename)
1647. 
1648.         canonical_fullname = self.get_canonical_fullname()
1649.         if not self.doc_as_attr and canonical_fullname and self.fullname != canonical_fullname:
1650.             self.add_line('   :canonical: %s' % canonical_fullname, sourcename)
1651. 
1652.         # add inheritance info, if wanted
1653.         if not self.doc_as_attr and self.options.show_inheritance:
1654.             if hasattr(self.object, '__orig_bases__') and len(self.object.__orig_bases__):
1655.                 # A subclass of generic types
1656.                 # refs: PEP-560 <https://www.python.org/dev/peps/pep-0560/>
1657.                 bases = list(self.object.__orig_bases__)
1658.             elif hasattr(self.object, '__bases__') and len(self.object.__bases__):
1659.                 # A normal class
1660.                 bases = list(self.object.__bases__)
1661.             else:
1662.                 bases = []
1663. 
1664.             self.env.events.emit('autodoc-process-bases',
1665.                                  self.fullname, self.object, self.options, bases)
1666. 
1667.             base_classes = [restify(cls) for cls in bases]
1668.             sourcename = self.get_sourcename()
1669.             self.add_line('', sourcename)
1670.             self.add_line('   ' + _('Bases: %s') % ', '.join(base_classes), sourcename)
1671. 
1672.     def get_object_members(self, want_all: bool) -> Tuple[bool, ObjectMembers]:
1673.         members = get_class_members(self.object, self.objpath, self.get_attr)
1674.         if not want_all:
1675.             if not self.options.members:
1676.                 return False, []  # type: ignore
1677.             # specific members given
1678.             selected = []
1679.             for name in self.options.members:  # type: str
1680.                 if name in members:
1681.                     selected.append(members[name])
1682.                 else:
1683.                     logger.warning(__('missing attribute %s in object %s') %
1684.                                    (name, self.fullname), type='autodoc')
1685.             return False, selected
1686.         elif self.options.inherited_members:
1687.             return False, list(members.values())
1688.         else:
1689.             return False, [m for m in members.values() if m.class_ == self.object]
1690. 
1691.     def get_doc(self, ignore: int = None) -> Optional[List[List[str]]]:
1692.         if self.doc_as_attr:
1693.             # Don't show the docstring of the class when it is an alias.
1694.             comment = self.get_variable_comment()
1695.             if comment:
1696.                 return []
1697.             else:
1698.                 return None
1699. 
1700.         lines = getattr(self, '_new_docstrings', None)
1701.         if lines is not None:
1702.             return lines
1703. 
1704.         classdoc_from = self.options.get('class-doc-from', self.config.autoclass_content)
1705. 
1706.         docstrings = []
1707.         attrdocstring = self.get_attr(self.object, '__doc__', None)
1708.         if attrdocstring:
1709.             docstrings.append(attrdocstring)
1710. 
1711.         # for classes, what the "docstring" is can be controlled via a
1712.         # config value; the default is only the class docstring
1713.         if classdoc_from in ('both', 'init'):
1714.             __init__ = self.get_attr(self.object, '__init__', None)
1715.             initdocstring = getdoc(__init__, self.get_attr,
1716.                                    self.config.autodoc_inherit_docstrings,
1717.                                    self.object, '__init__')
1718.             # for new-style classes, no __init__ means default __init__
1719.             if (initdocstring is not None and
1720.                 (initdocstring == object.__init__.__doc__ or  # for pypy
1721.                  initdocstring.strip() == object.__init__.__doc__)):  # for !pypy
1722.                 initdocstring = None
1723.             if not initdocstring:
1724.                 # try __new__
1725.                 __new__ = self.get_attr(self.object, '__new__', None)
1726.                 initdocstring = getdoc(__new__, self.get_attr,
1727.                                        self.config.autodoc_inherit_docstrings,
1728.                                        self.object, '__new__')
1729.                 # for new-style classes, no __new__ means default __new__
1730.                 if (initdocstring is not None and
1731.                     (initdocstring == object.__new__.__doc__ or  # for pypy
1732.                      initdocstring.strip() == object.__new__.__doc__)):  # for !pypy
1733.                     initdocstring = None
1734.             if initdocstring:
1735.                 if classdoc_from == 'init':
1736.                     docstrings = [initdocstring]
1737.                 else:
1738.                     docstrings.append(initdocstring)
1739. 
1740.         tab_width = self.directive.state.document.settings.tab_width
1741.         return [prepare_docstring(docstring, ignore, tab_width) for docstring in docstrings]
1742. 
1743.     def get_variable_comment(self) -> Optional[List[str]]:
1744.         try:
1745.             key = ('', '.'.join(self.objpath))
1746.             analyzer = ModuleAnalyzer.for_module(self.get_real_modname())
1747.             analyzer.analyze()
1748.             return list(self.analyzer.attr_docs.get(key, []))
1749.         except PycodeError:
1750.             return None
1751. 
1752.     def add_content(self, more_content: Optional[StringList], no_docstring: bool = False
1753.                     ) -> None:
1754.         if self.doc_as_attr and not self.get_variable_comment():
1755.             try:
1756.                 more_content = StringList([_('alias of %s') % restify(self.object)], source='')
1757.             except AttributeError:
1758.                 pass  # Invalid class object is passed.
1759. 
1760.         super().add_content(more_content)
1761. 
1762.     def document_members(self, all_members: bool = False) -> None:
1763.         if self.doc_as_attr:
1764.             return
1765.         super().document_members(all_members)
1766. 
1767.     def generate(self, more_content: Optional[StringList] = None, real_modname: str = None,
1768.                  check_module: bool = False, all_members: bool = False) -> None:
1769.         # Do not pass real_modname and use the name from the __module__
1770.         # attribute of the class.
1771.         # If a class gets imported into the module real_modname
1772.         # the analyzer won't find the source of the class, if
1773.         # it looks in real_modname.
1774.         return super().generate(more_content=more_content,
1775.                                 check_module=check_module,
1776.                                 all_members=all_members)


File: sphinx/ext/autodoc/mock.py
Line number range: 1 - 187
Content:
1. """
2.     sphinx.ext.autodoc.mock
3.     ~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     mock for autodoc
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import contextlib
12. import os
13. import sys
14. from importlib.abc import Loader, MetaPathFinder
15. from importlib.machinery import ModuleSpec
16. from types import ModuleType
17. from typing import Any, Generator, Iterator, List, Optional, Sequence, Tuple, Union
18. 
19. from sphinx.util import logging
20. from sphinx.util.inspect import safe_getattr
21. 
22. logger = logging.getLogger(__name__)
23. 
24. 
25. class _MockObject:
26.     """Used by autodoc_mock_imports."""
27. 
28.     __display_name__ = '_MockObject'
29.     __sphinx_mock__ = True
30.     __sphinx_decorator_args__: Tuple[Any, ...] = ()
31. 
32.     def __new__(cls, *args: Any, **kwargs: Any) -> Any:
33.         if len(args) == 3 and isinstance(args[1], tuple):
34.             superclass = args[1][-1].__class__
35.             if superclass is cls:
36.                 # subclassing MockObject
37.                 return _make_subclass(args[0], superclass.__display_name__,
38.                                       superclass=superclass, attributes=args[2])
39. 
40.         return super().__new__(cls)
41. 
42.     def __init__(self, *args: Any, **kwargs: Any) -> None:
43.         self.__qualname__ = ''
44. 
45.     def __len__(self) -> int:
46.         return 0
47. 
48.     def __contains__(self, key: str) -> bool:
49.         return False
50. 
51.     def __iter__(self) -> Iterator:
52.         return iter([])
53. 
54.     def __mro_entries__(self, bases: Tuple) -> Tuple:
55.         return (self.__class__,)
56. 
57.     def __getitem__(self, key: Any) -> "_MockObject":
58.         return _make_subclass(str(key), self.__display_name__, self.__class__)()
59. 
60.     def __getattr__(self, key: str) -> "_MockObject":
61.         return _make_subclass(key, self.__display_name__, self.__class__)()
62. 
63.     def __call__(self, *args: Any, **kwargs: Any) -> Any:
64.         call = self.__class__()
65.         call.__sphinx_decorator_args__ = args
66.         return call
67. 
68.     def __repr__(self) -> str:
69.         return self.__display_name__
70. 
71. 
72. def _make_subclass(name: str, module: str, superclass: Any = _MockObject,
73.                    attributes: Any = None, decorator_args: Tuple = ()) -> Any:
74.     attrs = {'__module__': module,
75.              '__display_name__': module + '.' + name,
76.              '__sphinx_decorator_args__': decorator_args}
77.     attrs.update(attributes or {})
78. 
79.     return type(name, (superclass,), attrs)
80. 
81. 
82. class _MockModule(ModuleType):
83.     """Used by autodoc_mock_imports."""
84.     __file__ = os.devnull
85.     __sphinx_mock__ = True
86. 
87.     def __init__(self, name: str) -> None:
88.         super().__init__(name)
89.         self.__all__: List[str] = []
90.         self.__path__: List[str] = []
91. 
92.     def __getattr__(self, name: str) -> _MockObject:
93.         return _make_subclass(name, self.__name__)()
94. 
95.     def __repr__(self) -> str:
96.         return self.__name__
97. 
98. 
99. class MockLoader(Loader):
100.     """A loader for mocking."""
101.     def __init__(self, finder: "MockFinder") -> None:
102.         super().__init__()
103.         self.finder = finder
104. 
105.     def create_module(self, spec: ModuleSpec) -> ModuleType:
106.         logger.debug('[autodoc] adding a mock module as %s!', spec.name)
107.         self.finder.mocked_modules.append(spec.name)
108.         return _MockModule(spec.name)
109. 
110.     def exec_module(self, module: ModuleType) -> None:
111.         pass  # nothing to do
112. 
113. 
114. class MockFinder(MetaPathFinder):
115.     """A finder for mocking."""
116. 
117.     def __init__(self, modnames: List[str]) -> None:
118.         super().__init__()
119.         self.modnames = modnames
120.         self.loader = MockLoader(self)
121.         self.mocked_modules: List[str] = []
122. 
123.     def find_spec(self, fullname: str, path: Optional[Sequence[Union[bytes, str]]],
124.                   target: ModuleType = None) -> Optional[ModuleSpec]:
125.         for modname in self.modnames:
126.             # check if fullname is (or is a descendant of) one of our targets
127.             if modname == fullname or fullname.startswith(modname + '.'):
128.                 return ModuleSpec(fullname, self.loader)
129. 
130.         return None
131. 
132.     def invalidate_caches(self) -> None:
133.         """Invalidate mocked modules on sys.modules."""
134.         for modname in self.mocked_modules:
135.             sys.modules.pop(modname, None)
136. 
137. 
138. @contextlib.contextmanager
139. def mock(modnames: List[str]) -> Generator[None, None, None]:
140.     """Insert mock modules during context::
141. 
142.         with mock(['target.module.name']):
143.             # mock modules are enabled here
144.             ...
145.     """
146.     try:
147.         finder = MockFinder(modnames)
148.         sys.meta_path.insert(0, finder)
149.         yield
150.     finally:
151.         sys.meta_path.remove(finder)
152.         finder.invalidate_caches()
153. 
154. 
155. def ismock(subject: Any) -> bool:
156.     """Check if the object is mocked."""
157.     # check the object has '__sphinx_mock__' attribute
158.     try:
159.         if safe_getattr(subject, '__sphinx_mock__', None) is None:
160.             return False
161.     except AttributeError:
162.         return False
163. 
164.     # check the object is mocked module
165.     if isinstance(subject, _MockModule):
166.         return True
167. 
168.     try:
169.         # check the object is mocked object
170.         __mro__ = safe_getattr(type(subject), '__mro__', [])
171.         if len(__mro__) > 2 and __mro__[1] is _MockObject:
172.             return True
173.     except AttributeError:
174.         pass
175. 
176.     return False
177. 
178. 
179. def undecorate(subject: _MockObject) -> Any:
180.     """Unwrap mock if *subject* is decorated by mocked object.
181. 
182.     If not decorated, returns given *subject* itself.
183.     """
184.     if ismock(subject) and subject.__sphinx_decorator_args__:
185.         return subject.__sphinx_decorator_args__[0]
186.     else:
187.         return subject


File: tests/test_ext_autodoc.py
Line number range: 1 - 500
Content:
1. """
2.     test_ext_autodoc
3.     ~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from unittest.mock import Mock
14. from warnings import catch_warnings
15. 
16. import pytest
17. from docutils.statemachine import ViewList
18. 
19. from sphinx import addnodes
20. from sphinx.ext.autodoc import ALL, ModuleLevelDocumenter, Options
21. from sphinx.ext.autodoc.directive import DocumenterBridge, process_documenter_options
22. from sphinx.testing.util import SphinxTestApp, Struct  # NOQA
23. from sphinx.util.docutils import LoggingReporter
24. 
25. try:
26.     # Enable pyximport to test cython module
27.     import pyximport
28.     pyximport.install()
29. except ImportError:
30.     pyximport = None
31. 
32. 
33. def do_autodoc(app, objtype, name, options=None):
34.     if options is None:
35.         options = {}
36.     app.env.temp_data.setdefault('docname', 'index')  # set dummy docname
37.     doccls = app.registry.documenters[objtype]
38.     docoptions = process_documenter_options(doccls, app.config, options)
39.     state = Mock()
40.     state.document.settings.tab_width = 8
41.     bridge = DocumenterBridge(app.env, LoggingReporter(''), docoptions, 1, state)
42.     documenter = doccls(bridge, name)
43.     documenter.generate()
44. 
45.     return bridge.result
46. 
47. 
48. def make_directive_bridge(env):
49.     options = Options(
50.         inherited_members = False,
51.         undoc_members = False,
52.         private_members = False,
53.         special_members = False,
54.         imported_members = False,
55.         show_inheritance = False,
56.         noindex = False,
57.         annotation = None,
58.         synopsis = '',
59.         platform = '',
60.         deprecated = False,
61.         members = [],
62.         member_order = 'alphabetical',
63.         exclude_members = set(),
64.         ignore_module_all = False,
65.     )
66. 
67.     directive = Struct(
68.         env = env,
69.         genopt = options,
70.         result = ViewList(),
71.         record_dependencies = set(),
72.         state = Mock(),
73.     )
74.     directive.state.document.settings.tab_width = 8
75. 
76.     return directive
77. 
78. 
79. processed_signatures = []
80. 
81. 
82. def process_signature(app, what, name, obj, options, args, retann):
83.     processed_signatures.append((what, name))
84.     if name == 'bar':
85.         return '42', None
86. 
87. 
88. def skip_member(app, what, name, obj, skip, options):
89.     if name in ('__special1__', '__special2__'):
90.         return skip
91.     if name.startswith('__'):
92.         return True
93.     if name == 'skipmeth':
94.         return True
95. 
96. 
97. def test_parse_name(app):
98.     def verify(objtype, name, result):
99.         inst = app.registry.documenters[objtype](directive, name)
100.         assert inst.parse_name()
101.         assert (inst.modname, inst.objpath, inst.args, inst.retann) == result
102. 
103.     directive = make_directive_bridge(app.env)
104. 
105.     # for modules
106.     verify('module', 'test_ext_autodoc', ('test_ext_autodoc', [], None, None))
107.     verify('module', 'test.test_ext_autodoc', ('test.test_ext_autodoc', [], None, None))
108.     verify('module', 'test(arg)', ('test', [], 'arg', None))
109.     assert 'signature arguments' in app._warning.getvalue()
110. 
111.     # for functions/classes
112.     verify('function', 'test_ext_autodoc.raises',
113.            ('test_ext_autodoc', ['raises'], None, None))
114.     verify('function', 'test_ext_autodoc.raises(exc) -> None',
115.            ('test_ext_autodoc', ['raises'], 'exc', 'None'))
116.     directive.env.temp_data['autodoc:module'] = 'test_ext_autodoc'
117.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
118.     del directive.env.temp_data['autodoc:module']
119.     directive.env.ref_context['py:module'] = 'test_ext_autodoc'
120.     verify('function', 'raises', ('test_ext_autodoc', ['raises'], None, None))
121.     verify('class', 'Base', ('test_ext_autodoc', ['Base'], None, None))
122. 
123.     # for members
124.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
125.     verify('method', 'SphinxTestApp.cleanup',
126.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
127.     directive.env.ref_context['py:module'] = 'sphinx.testing.util'
128.     directive.env.ref_context['py:class'] = 'Foo'
129.     directive.env.temp_data['autodoc:class'] = 'SphinxTestApp'
130.     verify('method', 'cleanup',
131.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
132.     verify('method', 'SphinxTestApp.cleanup',
133.            ('sphinx.testing.util', ['SphinxTestApp', 'cleanup'], None, None))
134. 
135. 
136. def test_format_signature(app):
137.     app.connect('autodoc-process-signature', process_signature)
138.     app.connect('autodoc-skip-member', skip_member)
139. 
140.     directive = make_directive_bridge(app.env)
141. 
142.     def formatsig(objtype, name, obj, args, retann):
143.         inst = app.registry.documenters[objtype](directive, name)
144.         inst.fullname = name
145.         inst.doc_as_attr = False  # for class objtype
146.         inst.parent = object  # dummy
147.         inst.object = obj
148.         inst.objpath = [name]
149.         inst.args = args
150.         inst.retann = retann
151.         res = inst.format_signature()
152.         print(res)
153.         return res
154. 
155.     # no signatures for modules
156.     assert formatsig('module', 'test', None, None, None) == ''
157. 
158.     # test for functions
159.     def f(a, b, c=1, **d):
160.         pass
161. 
162.     def g(a='\n'):
163.         pass
164.     assert formatsig('function', 'f', f, None, None) == '(a, b, c=1, **d)'
165.     assert formatsig('function', 'f', f, 'a, b, c, d', None) == '(a, b, c, d)'
166.     assert formatsig('function', 'g', g, None, None) == r"(a='\n')"
167. 
168.     # test for classes
169.     class D:
170.         pass
171. 
172.     class E:
173.         def __init__(self):
174.             pass
175. 
176.     # an empty init and no init are the same
177.     for C in (D, E):
178.         assert formatsig('class', 'D', C, None, None) == '()'
179. 
180.     class SomeMeta(type):
181.         def __call__(cls, a, b=None):
182.             return type.__call__(cls, a, b)
183. 
184.     # these three are all equivalent
185.     class F:
186.         def __init__(self, a, b=None):
187.             pass
188. 
189.     class FNew:
190.         def __new__(cls, a, b=None):
191.             return super().__new__(cls)
192. 
193.     class FMeta(metaclass=SomeMeta):
194.         pass
195. 
196.     # and subclasses should always inherit
197.     class G(F):
198.         pass
199. 
200.     class GNew(FNew):
201.         pass
202. 
203.     class GMeta(FMeta):
204.         pass
205. 
206.     # subclasses inherit
207.     for C in (F, FNew, FMeta, G, GNew, GMeta):
208.         assert formatsig('class', 'C', C, None, None) == '(a, b=None)'
209.     assert formatsig('class', 'C', D, 'a, b', 'X') == '(a, b) -> X'
210. 
211.     class ListSubclass(list):
212.         pass
213. 
214.     # only supported if the python implementation decides to document it
215.     if getattr(list, '__text_signature__', None) is not None:
216.         assert formatsig('class', 'C', ListSubclass, None, None) == '(iterable=(), /)'
217.     else:
218.         assert formatsig('class', 'C', ListSubclass, None, None) == ''
219. 
220.     class ExceptionSubclass(Exception):
221.         pass
222. 
223.     # Exception has no __text_signature__ at least in Python 3.8
224.     if getattr(Exception, '__text_signature__', None) is None:
225.         assert formatsig('class', 'C', ExceptionSubclass, None, None) == ''
226. 
227.     # __init__ have signature at first line of docstring
228.     directive.env.config.autoclass_content = 'both'
229. 
230.     class F2:
231.         '''some docstring for F2.'''
232.         def __init__(self, *args, **kw):
233.             '''
234.             __init__(a1, a2, kw1=True, kw2=False)
235. 
236.             some docstring for __init__.
237.             '''
238.     class G2(F2):
239.         pass
240. 
241.     assert formatsig('class', 'F2', F2, None, None) == \
242.         '(a1, a2, kw1=True, kw2=False)'
243.     assert formatsig('class', 'G2', G2, None, None) == \
244.         '(a1, a2, kw1=True, kw2=False)'
245. 
246.     # test for methods
247.     class H:
248.         def foo1(self, b, *c):
249.             pass
250. 
251.         def foo2(b, *c):
252.             pass
253. 
254.         def foo3(self, d='\n'):
255.             pass
256.     assert formatsig('method', 'H.foo', H.foo1, None, None) == '(b, *c)'
257.     assert formatsig('method', 'H.foo', H.foo1, 'a', None) == '(a)'
258.     assert formatsig('method', 'H.foo', H.foo2, None, None) == '(*c)'
259.     assert formatsig('method', 'H.foo', H.foo3, None, None) == r"(d='\n')"
260. 
261.     # test bound methods interpreted as functions
262.     assert formatsig('function', 'foo', H().foo1, None, None) == '(b, *c)'
263.     assert formatsig('function', 'foo', H().foo2, None, None) == '(*c)'
264.     assert formatsig('function', 'foo', H().foo3, None, None) == r"(d='\n')"
265. 
266.     # test exception handling (exception is caught and args is '')
267.     directive.env.config.autodoc_docstring_signature = False
268.     assert formatsig('function', 'int', int, None, None) == ''
269. 
270.     # test processing by event handler
271.     assert formatsig('method', 'bar', H.foo1, None, None) == '42'
272. 
273.     # test functions created via functools.partial
274.     from functools import partial
275.     curried1 = partial(lambda a, b, c: None, 'A')
276.     assert formatsig('function', 'curried1', curried1, None, None) == \
277.         '(b, c)'
278.     curried2 = partial(lambda a, b, c=42: None, 'A')
279.     assert formatsig('function', 'curried2', curried2, None, None) == \
280.         '(b, c=42)'
281.     curried3 = partial(lambda a, b, *c: None, 'A')
282.     assert formatsig('function', 'curried3', curried3, None, None) == \
283.         '(b, *c)'
284.     curried4 = partial(lambda a, b, c=42, *d, **e: None, 'A')
285.     assert formatsig('function', 'curried4', curried4, None, None) == \
286.         '(b, c=42, *d, **e)'
287. 
288. 
289. @pytest.mark.sphinx('html', testroot='ext-autodoc')
290. def test_autodoc_process_signature_typing_generic(app):
291.     actual = do_autodoc(app, 'class', 'target.generic_class.A', {})
292. 
293.     assert list(actual) == [
294.         '',
295.         '.. py:class:: A(a, b=None)',
296.         '   :module: target.generic_class',
297.         '',
298.         '   docstring for A',
299.         '',
300.     ]
301. 
302. 
303. def test_autodoc_process_signature_typehints(app):
304.     captured = []
305. 
306.     def process_signature(*args):
307.         captured.append(args)
308. 
309.     app.connect('autodoc-process-signature', process_signature)
310. 
311.     def func(x: int, y: int) -> int:
312.         pass
313. 
314.     directive = make_directive_bridge(app.env)
315.     inst = app.registry.documenters['function'](directive, 'func')
316.     inst.fullname = 'func'
317.     inst.object = func
318.     inst.objpath = ['func']
319.     inst.format_signature()
320.     assert captured == [(app, 'function', 'func', func,
321.                          directive.genopt, '(x: int, y: int)', 'int')]
322. 
323. 
324. def test_get_doc(app):
325.     directive = make_directive_bridge(app.env)
326. 
327.     def getdocl(objtype, obj):
328.         inst = app.registry.documenters[objtype](directive, 'tmp')
329.         inst.parent = object  # dummy
330.         inst.object = obj
331.         inst.objpath = [obj.__name__]
332.         inst.doc_as_attr = False
333.         inst.format_signature()  # handle docstring signatures!
334.         ds = inst.get_doc()
335.         # for testing purposes, concat them and strip the empty line at the end
336.         res = sum(ds, [])[:-1]
337.         print(res)
338.         return res
339. 
340.     # objects without docstring
341.     def f():
342.         pass
343.     assert getdocl('function', f) == []
344. 
345.     # standard function, diverse docstring styles...
346.     def f():
347.         """Docstring"""
348.     def g():
349.         """
350.         Docstring
351.         """
352.     for func in (f, g):
353.         assert getdocl('function', func) == ['Docstring']
354. 
355.     # first line vs. other lines indentation
356.     def f():
357.         """First line
358. 
359.         Other
360.           lines
361.         """
362.     assert getdocl('function', f) == ['First line', '', 'Other', '  lines']
363. 
364.     # charset guessing (this module is encoded in utf-8)
365.     def f():
366.         """Döcstring"""
367.     assert getdocl('function', f) == ['Döcstring']
368. 
369.     # verify that method docstrings get extracted in both normal case
370.     # and in case of bound method posing as a function
371.     class J:  # NOQA
372.         def foo(self):
373.             """Method docstring"""
374.     assert getdocl('method', J.foo) == ['Method docstring']
375.     assert getdocl('function', J().foo) == ['Method docstring']
376. 
377. 
378. @pytest.mark.sphinx('html', testroot='ext-autodoc')
379. def test_new_documenter(app):
380.     class MyDocumenter(ModuleLevelDocumenter):
381.         objtype = 'integer'
382.         directivetype = 'integer'
383.         priority = 100
384. 
385.         @classmethod
386.         def can_document_member(cls, member, membername, isattr, parent):
387.             return isinstance(member, int)
388. 
389.         def document_members(self, all_members=False):
390.             return
391. 
392.     app.add_autodocumenter(MyDocumenter)
393. 
394.     options = {"members": 'integer'}
395.     actual = do_autodoc(app, 'module', 'target', options)
396.     assert list(actual) == [
397.         '',
398.         '.. py:module:: target',
399.         '',
400.         '',
401.         '.. py:integer:: integer',
402.         '   :module: target',
403.         '',
404.         '   documentation for the integer',
405.         '',
406.     ]
407. 
408. 
409. def test_attrgetter_using(app):
410.     from target import Class
411.     from target.inheritance import Derived
412. 
413.     directive = make_directive_bridge(app.env)
414. 
415.     def assert_getter_works(objtype, name, obj, attrs=[], **kw):
416.         getattr_spy = []
417. 
418.         def special_getattr(obj, name, *defargs):
419.             if name in attrs:
420.                 getattr_spy.append((obj, name))
421.                 return None
422.             return getattr(obj, name, *defargs)
423.         app.add_autodoc_attrgetter(type, special_getattr)
424. 
425.         del getattr_spy[:]
426.         inst = app.registry.documenters[objtype](directive, name)
427.         inst.generate(**kw)
428. 
429.         hooked_members = [s[1] for s in getattr_spy]
430.         documented_members = [s[1] for s in processed_signatures]
431.         for attr in attrs:
432.             fullname = '.'.join((name, attr))
433.             assert attr in hooked_members
434.             assert fullname not in documented_members, \
435.                 '%r was not hooked by special_attrgetter function' % fullname
436. 
437.     with catch_warnings(record=True):
438.         directive.genopt['members'] = ALL
439.         directive.genopt['inherited_members'] = False
440.         print(directive.genopt)
441.         assert_getter_works('class', 'target.Class', Class, ['meth'])
442. 
443.         directive.genopt['inherited_members'] = True
444.         assert_getter_works('class', 'target.inheritance.Derived', Derived, ['inheritedmeth'])
445. 
446. 
447. @pytest.mark.sphinx('html', testroot='ext-autodoc')
448. def test_py_module(app, warning):
449.     # without py:module
450.     actual = do_autodoc(app, 'method', 'Class.meth')
451.     assert list(actual) == []
452.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
453.             in warning.getvalue())
454. 
455.     # with py:module
456.     app.env.ref_context['py:module'] = 'target'
457.     warning.truncate(0)
458. 
459.     actual = do_autodoc(app, 'method', 'Class.meth')
460.     assert list(actual) == [
461.         '',
462.         '.. py:method:: Class.meth()',
463.         '   :module: target',
464.         '',
465.         '   Function.',
466.         '',
467.     ]
468.     assert ("don't know which module to import for autodocumenting 'Class.meth'"
469.             not in warning.getvalue())
470. 
471. 
472. @pytest.mark.sphinx('html', testroot='ext-autodoc')
473. def test_autodoc_decorator(app):
474.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco1')
475.     assert list(actual) == [
476.         '',
477.         '.. py:decorator:: deco1',
478.         '   :module: target.decorator',
479.         '',
480.         '   docstring for deco1',
481.         '',
482.     ]
483. 
484.     actual = do_autodoc(app, 'decorator', 'target.decorator.deco2')
485.     assert list(actual) == [
486.         '',
487.         '.. py:decorator:: deco2(condition, message)',
488.         '   :module: target.decorator',
489.         '',
490.         '   docstring for deco2',
491.         '',
492.     ]
493. 
494. 
495. @pytest.mark.sphinx('html', testroot='ext-autodoc')
496. def test_autodoc_exception(app):
497.     actual = do_autodoc(app, 'exception', 'target.CustomEx')
498.     assert list(actual) == [
499.         '',
500.         '.. py:exception:: CustomEx',


File: tests/test_ext_autodoc.py
Line number range: 501 - 4000
Content:
501.         '   :module: target',
502.         '',
503.         '   My custom exception.',
504.         '',
505.     ]
506. 
507. 
508. @pytest.mark.sphinx('html', testroot='ext-autodoc')
509. def test_autodoc_warnings(app, warning):
510.     app.env.temp_data['docname'] = 'dummy'
511. 
512.     # can't import module
513.     do_autodoc(app, 'module', 'unknown')
514.     assert "failed to import module 'unknown'" in warning.getvalue()
515. 
516.     # missing function
517.     do_autodoc(app, 'function', 'unknown')
518.     assert "import for autodocumenting 'unknown'" in warning.getvalue()
519. 
520.     do_autodoc(app, 'function', 'target.unknown')
521.     assert "failed to import function 'unknown' from module 'target'" in warning.getvalue()
522. 
523.     # missing method
524.     do_autodoc(app, 'method', 'target.Class.unknown')
525.     assert "failed to import method 'Class.unknown' from module 'target'" in warning.getvalue()
526. 
527. 
528. @pytest.mark.sphinx('html', testroot='ext-autodoc')
529. def test_autodoc_attributes(app):
530.     options = {"synopsis": 'Synopsis',
531.                "platform": "Platform",
532.                "deprecated": None}
533.     actual = do_autodoc(app, 'module', 'target', options)
534.     assert list(actual) == [
535.         '',
536.         '.. py:module:: target',
537.         '   :synopsis: Synopsis',
538.         '   :platform: Platform',
539.         '   :deprecated:',
540.         ''
541.     ]
542. 
543. 
544. @pytest.mark.sphinx('html', testroot='ext-autodoc')
545. def test_autodoc_members(app):
546.     # default (no-members)
547.     actual = do_autodoc(app, 'class', 'target.inheritance.Base')
548.     assert list(filter(lambda l: '::' in l, actual)) == [
549.         '.. py:class:: Base()',
550.     ]
551. 
552.     # default ALL-members
553.     options = {"members": None}
554.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
555.     assert list(filter(lambda l: '::' in l, actual)) == [
556.         '.. py:class:: Base()',
557.         '   .. py:method:: Base.inheritedclassmeth()',
558.         '   .. py:method:: Base.inheritedmeth()',
559.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
560.     ]
561. 
562.     # default specific-members
563.     options = {"members": "inheritedmeth,inheritedstaticmeth"}
564.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
565.     assert list(filter(lambda l: '::' in l, actual)) == [
566.         '.. py:class:: Base()',
567.         '   .. py:method:: Base.inheritedmeth()',
568.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
569.     ]
570. 
571.     # ALL-members override autodoc_default_options
572.     options = {"members": None}
573.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
574.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
575.     assert list(filter(lambda l: '::' in l, actual)) == [
576.         '.. py:class:: Base()',
577.         '   .. py:method:: Base.inheritedclassmeth()',
578.         '   .. py:method:: Base.inheritedmeth()',
579.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
580.     ]
581. 
582.     # members override autodoc_default_options
583.     options = {"members": "inheritedmeth"}
584.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
585.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
586.     assert list(filter(lambda l: '::' in l, actual)) == [
587.         '.. py:class:: Base()',
588.         '   .. py:method:: Base.inheritedmeth()',
589.     ]
590. 
591.     # members extends autodoc_default_options
592.     options = {"members": "+inheritedmeth"}
593.     app.config.autodoc_default_options["members"] = "inheritedstaticmeth"
594.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
595.     assert list(filter(lambda l: '::' in l, actual)) == [
596.         '.. py:class:: Base()',
597.         '   .. py:method:: Base.inheritedmeth()',
598.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
599.     ]
600. 
601. 
602. @pytest.mark.sphinx('html', testroot='ext-autodoc')
603. def test_autodoc_exclude_members(app):
604.     options = {"members": None,
605.                "exclude-members": "inheritedmeth,inheritedstaticmeth"}
606.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
607.     assert list(filter(lambda l: '::' in l, actual)) == [
608.         '.. py:class:: Base()',
609.         '   .. py:method:: Base.inheritedclassmeth()'
610.     ]
611. 
612.     # members vs exclude-members
613.     options = {"members": "inheritedmeth",
614.                "exclude-members": "inheritedmeth"}
615.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
616.     assert list(filter(lambda l: '::' in l, actual)) == [
617.         '.. py:class:: Base()',
618.     ]
619. 
620.     # + has no effect when autodoc_default_options are not present
621.     options = {"members": None,
622.                "exclude-members": "+inheritedmeth,inheritedstaticmeth"}
623.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
624.     assert list(filter(lambda l: '::' in l, actual)) == [
625.         '.. py:class:: Base()',
626.         '   .. py:method:: Base.inheritedclassmeth()'
627.     ]
628. 
629.     # exclude-members overrides autodoc_default_options
630.     options = {"members": None,
631.                "exclude-members": "inheritedmeth"}
632.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
633.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
634.     assert list(filter(lambda l: '::' in l, actual)) == [
635.         '.. py:class:: Base()',
636.         '   .. py:method:: Base.inheritedclassmeth()',
637.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
638.     ]
639. 
640.     # exclude-members extends autodoc_default_options
641.     options = {"members": None,
642.                "exclude-members": "+inheritedmeth"}
643.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth"
644.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
645.     assert list(filter(lambda l: '::' in l, actual)) == [
646.         '.. py:class:: Base()',
647.         '   .. py:method:: Base.inheritedclassmeth()',
648.     ]
649. 
650.     # no exclude-members causes use autodoc_default_options
651.     options = {"members": None}
652.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
653.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
654.     assert list(filter(lambda l: '::' in l, actual)) == [
655.         '.. py:class:: Base()',
656.         '   .. py:method:: Base.inheritedclassmeth()',
657.     ]
658. 
659.     # empty exclude-members cancels autodoc_default_options
660.     options = {"members": None,
661.                "exclude-members": None}
662.     app.config.autodoc_default_options["exclude-members"] = "inheritedstaticmeth,inheritedmeth"
663.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
664.     assert list(filter(lambda l: '::' in l, actual)) == [
665.         '.. py:class:: Base()',
666.         '   .. py:method:: Base.inheritedclassmeth()',
667.         '   .. py:method:: Base.inheritedmeth()',
668.         '   .. py:method:: Base.inheritedstaticmeth(cls)'
669.     ]
670. 
671. 
672. @pytest.mark.sphinx('html', testroot='ext-autodoc')
673. def test_autodoc_undoc_members(app):
674.     options = {"members": None,
675.                "undoc-members": None}
676.     actual = do_autodoc(app, 'class', 'target.Class', options)
677.     assert list(filter(lambda l: '::' in l, actual)) == [
678.         '.. py:class:: Class(arg)',
679.         '   .. py:attribute:: Class.attr',
680.         '   .. py:attribute:: Class.docattr',
681.         '   .. py:method:: Class.excludemeth()',
682.         '   .. py:attribute:: Class.inst_attr_comment',
683.         '   .. py:attribute:: Class.inst_attr_inline',
684.         '   .. py:attribute:: Class.inst_attr_string',
685.         '   .. py:attribute:: Class.mdocattr',
686.         '   .. py:method:: Class.meth()',
687.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
688.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
689.         '   .. py:attribute:: Class.skipattr',
690.         '   .. py:method:: Class.skipmeth()',
691.         '   .. py:attribute:: Class.udocattr',
692.         '   .. py:method:: Class.undocmeth()'
693.     ]
694. 
695.     # use autodoc_default_options
696.     options = {"members": None}
697.     app.config.autodoc_default_options["undoc-members"] = None
698.     actual = do_autodoc(app, 'class', 'target.Class', options)
699.     assert list(filter(lambda l: '::' in l, actual)) == [
700.         '.. py:class:: Class(arg)',
701.         '   .. py:attribute:: Class.attr',
702.         '   .. py:attribute:: Class.docattr',
703.         '   .. py:method:: Class.excludemeth()',
704.         '   .. py:attribute:: Class.inst_attr_comment',
705.         '   .. py:attribute:: Class.inst_attr_inline',
706.         '   .. py:attribute:: Class.inst_attr_string',
707.         '   .. py:attribute:: Class.mdocattr',
708.         '   .. py:method:: Class.meth()',
709.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
710.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
711.         '   .. py:attribute:: Class.skipattr',
712.         '   .. py:method:: Class.skipmeth()',
713.         '   .. py:attribute:: Class.udocattr',
714.         '   .. py:method:: Class.undocmeth()'
715.     ]
716. 
717.     # options negation work check
718.     options = {"members": None,
719.                "no-undoc-members": None}
720.     app.config.autodoc_default_options["undoc-members"] = None
721.     actual = do_autodoc(app, 'class', 'target.Class', options)
722.     assert list(filter(lambda l: '::' in l, actual)) == [
723.         '.. py:class:: Class(arg)',
724.         '   .. py:attribute:: Class.attr',
725.         '   .. py:attribute:: Class.docattr',
726.         '   .. py:method:: Class.excludemeth()',
727.         '   .. py:attribute:: Class.inst_attr_comment',
728.         '   .. py:attribute:: Class.inst_attr_inline',
729.         '   .. py:attribute:: Class.inst_attr_string',
730.         '   .. py:attribute:: Class.mdocattr',
731.         '   .. py:method:: Class.meth()',
732.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
733.         '   .. py:method:: Class.skipmeth()',
734.         '   .. py:attribute:: Class.udocattr',
735.     ]
736. 
737. 
738. @pytest.mark.sphinx('html', testroot='ext-autodoc')
739. def test_autodoc_undoc_members_for_metadata_only(app):
740.     # metadata only member is not displayed
741.     options = {"members": None}
742.     actual = do_autodoc(app, 'module', 'target.metadata', options)
743.     assert list(actual) == [
744.         '',
745.         '.. py:module:: target.metadata',
746.         '',
747.     ]
748. 
749.     # metadata only member is displayed when undoc-member given
750.     options = {"members": None,
751.                "undoc-members": None}
752.     actual = do_autodoc(app, 'module', 'target.metadata', options)
753.     assert list(actual) == [
754.         '',
755.         '.. py:module:: target.metadata',
756.         '',
757.         '',
758.         '.. py:function:: foo()',
759.         '   :module: target.metadata',
760.         '',
761.         '   :meta metadata-only-docstring:',
762.         '',
763.     ]
764. 
765. 
766. @pytest.mark.sphinx('html', testroot='ext-autodoc')
767. def test_autodoc_inherited_members(app):
768.     options = {"members": None,
769.                "inherited-members": None}
770.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
771.     assert list(filter(lambda l: 'method::' in l, actual)) == [
772.         '   .. py:method:: Derived.inheritedclassmeth()',
773.         '   .. py:method:: Derived.inheritedmeth()',
774.         '   .. py:method:: Derived.inheritedstaticmeth(cls)',
775.     ]
776. 
777. 
778. @pytest.mark.sphinx('html', testroot='ext-autodoc')
779. def test_autodoc_inherited_members_Base(app):
780.     options = {"members": None,
781.                "inherited-members": "Base",
782.                "special-members": None}
783. 
784.     # check methods for object class are shown
785.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
786.     assert '   .. py:method:: Derived.inheritedmeth()' in actual
787.     assert '   .. py:method:: Derived.inheritedclassmeth' not in actual
788. 
789. 
790. @pytest.mark.sphinx('html', testroot='ext-autodoc')
791. def test_autodoc_inherited_members_None(app):
792.     options = {"members": None,
793.                "inherited-members": "None",
794.                "special-members": None}
795. 
796.     # check methods for object class are shown
797.     actual = do_autodoc(app, 'class', 'target.inheritance.Derived', options)
798.     assert '   .. py:method:: Derived.__init__()' in actual
799.     assert '   .. py:method:: Derived.__str__()' in actual
800. 
801. 
802. @pytest.mark.sphinx('html', testroot='ext-autodoc')
803. def test_autodoc_imported_members(app):
804.     options = {"members": None,
805.                "imported-members": None,
806.                "ignore-module-all": None}
807.     actual = do_autodoc(app, 'module', 'target', options)
808.     assert '.. py:function:: save_traceback(app: Sphinx) -> str' in actual
809. 
810. 
811. @pytest.mark.sphinx('html', testroot='ext-autodoc')
812. def test_autodoc_special_members(app):
813.     # specific special methods
814.     options = {"undoc-members": None,
815.                "special-members": "__init__,__special1__"}
816.     actual = do_autodoc(app, 'class', 'target.Class', options)
817.     assert list(filter(lambda l: '::' in l, actual)) == [
818.         '.. py:class:: Class(arg)',
819.         '   .. py:method:: Class.__init__(arg)',
820.         '   .. py:method:: Class.__special1__()',
821.     ]
822. 
823.     # combination with specific members
824.     options = {"members": "attr,docattr",
825.                "undoc-members": None,
826.                "special-members": "__init__,__special1__"}
827.     actual = do_autodoc(app, 'class', 'target.Class', options)
828.     assert list(filter(lambda l: '::' in l, actual)) == [
829.         '.. py:class:: Class(arg)',
830.         '   .. py:method:: Class.__init__(arg)',
831.         '   .. py:method:: Class.__special1__()',
832.         '   .. py:attribute:: Class.attr',
833.         '   .. py:attribute:: Class.docattr',
834.     ]
835. 
836.     # all special methods
837.     options = {"members": None,
838.                "undoc-members": None,
839.                "special-members": None}
840.     actual = do_autodoc(app, 'class', 'target.Class', options)
841.     assert list(filter(lambda l: '::' in l, actual)) == [
842.         '.. py:class:: Class(arg)',
843.         '   .. py:attribute:: Class.__annotations__',
844.         '   .. py:attribute:: Class.__dict__',
845.         '   .. py:method:: Class.__init__(arg)',
846.         '   .. py:attribute:: Class.__module__',
847.         '   .. py:method:: Class.__special1__()',
848.         '   .. py:method:: Class.__special2__()',
849.         '   .. py:attribute:: Class.__weakref__',
850.         '   .. py:attribute:: Class.attr',
851.         '   .. py:attribute:: Class.docattr',
852.         '   .. py:method:: Class.excludemeth()',
853.         '   .. py:attribute:: Class.inst_attr_comment',
854.         '   .. py:attribute:: Class.inst_attr_inline',
855.         '   .. py:attribute:: Class.inst_attr_string',
856.         '   .. py:attribute:: Class.mdocattr',
857.         '   .. py:method:: Class.meth()',
858.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
859.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
860.         '   .. py:attribute:: Class.skipattr',
861.         '   .. py:method:: Class.skipmeth()',
862.         '   .. py:attribute:: Class.udocattr',
863.         '   .. py:method:: Class.undocmeth()'
864.     ]
865. 
866.     # specific special methods from autodoc_default_options
867.     options = {"undoc-members": None}
868.     app.config.autodoc_default_options["special-members"] = "__special2__"
869.     actual = do_autodoc(app, 'class', 'target.Class', options)
870.     assert list(filter(lambda l: '::' in l, actual)) == [
871.         '.. py:class:: Class(arg)',
872.         '   .. py:method:: Class.__special2__()',
873.     ]
874. 
875.     # specific special methods option with autodoc_default_options
876.     options = {"undoc-members": None,
877.                "special-members": "__init__,__special1__"}
878.     app.config.autodoc_default_options["special-members"] = "__special2__"
879.     actual = do_autodoc(app, 'class', 'target.Class', options)
880.     assert list(filter(lambda l: '::' in l, actual)) == [
881.         '.. py:class:: Class(arg)',
882.         '   .. py:method:: Class.__init__(arg)',
883.         '   .. py:method:: Class.__special1__()',
884.     ]
885. 
886.     # specific special methods merge with autodoc_default_options
887.     options = {"undoc-members": None,
888.                "special-members": "+__init__,__special1__"}
889.     app.config.autodoc_default_options["special-members"] = "__special2__"
890.     actual = do_autodoc(app, 'class', 'target.Class', options)
891.     assert list(filter(lambda l: '::' in l, actual)) == [
892.         '.. py:class:: Class(arg)',
893.         '   .. py:method:: Class.__init__(arg)',
894.         '   .. py:method:: Class.__special1__()',
895.         '   .. py:method:: Class.__special2__()',
896.     ]
897. 
898. 
899. @pytest.mark.sphinx('html', testroot='ext-autodoc')
900. def test_autodoc_ignore_module_all(app):
901.     # default (no-ignore-module-all)
902.     options = {"members": None}
903.     actual = do_autodoc(app, 'module', 'target', options)
904.     assert list(filter(lambda l: 'class::' in l, actual)) == [
905.         '.. py:class:: Class(arg)',
906.     ]
907. 
908.     # ignore-module-all
909.     options = {"members": None,
910.                "ignore-module-all": None}
911.     actual = do_autodoc(app, 'module', 'target', options)
912.     assert list(filter(lambda l: 'class::' in l, actual)) == [
913.         '.. py:class:: Class(arg)',
914.         '.. py:class:: CustomDict',
915.         '.. py:class:: InnerChild()',
916.         '.. py:class:: InstAttCls()',
917.         '.. py:class:: Outer()',
918.         '   .. py:class:: Outer.Inner()',
919.         '.. py:class:: StrRepr'
920.     ]
921. 
922. 
923. @pytest.mark.sphinx('html', testroot='ext-autodoc')
924. def test_autodoc_noindex(app):
925.     options = {"noindex": None}
926.     actual = do_autodoc(app, 'module', 'target', options)
927.     assert list(actual) == [
928.         '',
929.         '.. py:module:: target',
930.         '   :noindex:',
931.         ''
932.     ]
933. 
934.     # TODO: :noindex: should be propagated to children of target item.
935. 
936.     actual = do_autodoc(app, 'class', 'target.inheritance.Base', options)
937.     assert list(actual) == [
938.         '',
939.         '.. py:class:: Base()',
940.         '   :noindex:',
941.         '   :module: target.inheritance',
942.         ''
943.     ]
944. 
945. 
946. @pytest.mark.sphinx('html', testroot='ext-autodoc')
947. def test_autodoc_subclass_of_builtin_class(app):
948.     options = {"members": None}
949.     actual = do_autodoc(app, 'class', 'target.CustomDict', options)
950.     assert list(actual) == [
951.         '',
952.         '.. py:class:: CustomDict',
953.         '   :module: target',
954.         '',
955.         '   Docstring.',
956.         '',
957.     ]
958. 
959. 
960. @pytest.mark.sphinx('html', testroot='ext-autodoc')
961. def test_autodoc_inner_class(app):
962.     options = {"members": None}
963.     actual = do_autodoc(app, 'class', 'target.Outer', options)
964.     assert list(actual) == [
965.         '',
966.         '.. py:class:: Outer()',
967.         '   :module: target',
968.         '',
969.         '   Foo',
970.         '',
971.         '',
972.         '   .. py:class:: Outer.Inner()',
973.         '      :module: target',
974.         '',
975.         '      Foo',
976.         '',
977.         '',
978.         '      .. py:method:: Outer.Inner.meth()',
979.         '         :module: target',
980.         '',
981.         '         Foo',
982.         '',
983.         '',
984.         '   .. py:attribute:: Outer.factory',
985.         '      :module: target',
986.         '',
987.         '      alias of :py:class:`dict`'
988.     ]
989. 
990.     actual = do_autodoc(app, 'class', 'target.Outer.Inner', options)
991.     assert list(actual) == [
992.         '',
993.         '.. py:class:: Inner()',
994.         '   :module: target.Outer',
995.         '',
996.         '   Foo',
997.         '',
998.         '',
999.         '   .. py:method:: Inner.meth()',
1000.         '      :module: target.Outer',
1001.         '',
1002.         '      Foo',
1003.         '',
1004.     ]
1005. 
1006.     options['show-inheritance'] = None
1007.     actual = do_autodoc(app, 'class', 'target.InnerChild', options)
1008.     assert list(actual) == [
1009.         '',
1010.         '.. py:class:: InnerChild()',
1011.         '   :module: target', '',
1012.         '   Bases: :py:class:`target.Outer.Inner`',
1013.         '',
1014.         '   InnerChild docstring',
1015.         '',
1016.     ]
1017. 
1018. 
1019. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1020. def test_autodoc_classmethod(app):
1021.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedclassmeth')
1022.     assert list(actual) == [
1023.         '',
1024.         '.. py:method:: Base.inheritedclassmeth()',
1025.         '   :module: target.inheritance',
1026.         '   :classmethod:',
1027.         '',
1028.         '   Inherited class method.',
1029.         '',
1030.     ]
1031. 
1032. 
1033. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1034. def test_autodoc_staticmethod(app):
1035.     actual = do_autodoc(app, 'method', 'target.inheritance.Base.inheritedstaticmeth')
1036.     assert list(actual) == [
1037.         '',
1038.         '.. py:method:: Base.inheritedstaticmeth(cls)',
1039.         '   :module: target.inheritance',
1040.         '   :staticmethod:',
1041.         '',
1042.         '   Inherited static method.',
1043.         '',
1044.     ]
1045. 
1046. 
1047. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1048. def test_autodoc_descriptor(app):
1049.     options = {"members": None,
1050.                "undoc-members": None}
1051.     actual = do_autodoc(app, 'class', 'target.descriptor.Class', options)
1052.     assert list(actual) == [
1053.         '',
1054.         '.. py:class:: Class()',
1055.         '   :module: target.descriptor',
1056.         '',
1057.         '',
1058.         '   .. py:attribute:: Class.descr',
1059.         '      :module: target.descriptor',
1060.         '',
1061.         '      Descriptor instance docstring.',
1062.         '',
1063.         '',
1064.         '   .. py:property:: Class.prop',
1065.         '      :module: target.descriptor',
1066.         '',
1067.         '      Property.',
1068.         ''
1069.     ]
1070. 
1071. 
1072. @pytest.mark.skipif(sys.version_info < (3, 8),
1073.                     reason='cached_property is available since python3.8.')
1074. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1075. def test_autodoc_cached_property(app):
1076.     options = {"members": None,
1077.                "undoc-members": None}
1078.     actual = do_autodoc(app, 'class', 'target.cached_property.Foo', options)
1079.     assert list(actual) == [
1080.         '',
1081.         '.. py:class:: Foo()',
1082.         '   :module: target.cached_property',
1083.         '',
1084.         '',
1085.         '   .. py:property:: Foo.prop',
1086.         '      :module: target.cached_property',
1087.         '      :type: int',
1088.         '',
1089.     ]
1090. 
1091. 
1092. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1093. def test_autodoc_member_order(app):
1094.     # case member-order='bysource'
1095.     options = {"members": None,
1096.                'member-order': 'bysource',
1097.                "undoc-members": None,
1098.                'private-members': None}
1099.     actual = do_autodoc(app, 'class', 'target.Class', options)
1100.     assert list(filter(lambda l: '::' in l, actual)) == [
1101.         '.. py:class:: Class(arg)',
1102.         '   .. py:method:: Class.meth()',
1103.         '   .. py:method:: Class.undocmeth()',
1104.         '   .. py:method:: Class.skipmeth()',
1105.         '   .. py:method:: Class.excludemeth()',
1106.         '   .. py:attribute:: Class.skipattr',
1107.         '   .. py:attribute:: Class.attr',
1108.         '   .. py:attribute:: Class.docattr',
1109.         '   .. py:attribute:: Class.udocattr',
1110.         '   .. py:attribute:: Class.mdocattr',
1111.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1112.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1113.         '   .. py:attribute:: Class.inst_attr_inline',
1114.         '   .. py:attribute:: Class.inst_attr_comment',
1115.         '   .. py:attribute:: Class.inst_attr_string',
1116.         '   .. py:attribute:: Class._private_inst_attr'
1117.     ]
1118. 
1119.     # case member-order='groupwise'
1120.     options = {"members": None,
1121.                'member-order': 'groupwise',
1122.                "undoc-members": None,
1123.                'private-members': None}
1124.     actual = do_autodoc(app, 'class', 'target.Class', options)
1125.     assert list(filter(lambda l: '::' in l, actual)) == [
1126.         '.. py:class:: Class(arg)',
1127.         '   .. py:method:: Class.excludemeth()',
1128.         '   .. py:method:: Class.meth()',
1129.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1130.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1131.         '   .. py:method:: Class.skipmeth()',
1132.         '   .. py:method:: Class.undocmeth()',
1133.         '   .. py:attribute:: Class._private_inst_attr',
1134.         '   .. py:attribute:: Class.attr',
1135.         '   .. py:attribute:: Class.docattr',
1136.         '   .. py:attribute:: Class.inst_attr_comment',
1137.         '   .. py:attribute:: Class.inst_attr_inline',
1138.         '   .. py:attribute:: Class.inst_attr_string',
1139.         '   .. py:attribute:: Class.mdocattr',
1140.         '   .. py:attribute:: Class.skipattr',
1141.         '   .. py:attribute:: Class.udocattr'
1142.     ]
1143. 
1144.     # case member-order=None
1145.     options = {"members": None,
1146.                "undoc-members": None,
1147.                'private-members': None}
1148.     actual = do_autodoc(app, 'class', 'target.Class', options)
1149.     assert list(filter(lambda l: '::' in l, actual)) == [
1150.         '.. py:class:: Class(arg)',
1151.         '   .. py:attribute:: Class._private_inst_attr',
1152.         '   .. py:attribute:: Class.attr',
1153.         '   .. py:attribute:: Class.docattr',
1154.         '   .. py:method:: Class.excludemeth()',
1155.         '   .. py:attribute:: Class.inst_attr_comment',
1156.         '   .. py:attribute:: Class.inst_attr_inline',
1157.         '   .. py:attribute:: Class.inst_attr_string',
1158.         '   .. py:attribute:: Class.mdocattr',
1159.         '   .. py:method:: Class.meth()',
1160.         '   .. py:method:: Class.moore(a, e, f) -> happiness',
1161.         '   .. py:method:: Class.roger(a, *, b=2, c=3, d=4, e=5, f=6)',
1162.         '   .. py:attribute:: Class.skipattr',
1163.         '   .. py:method:: Class.skipmeth()',
1164.         '   .. py:attribute:: Class.udocattr',
1165.         '   .. py:method:: Class.undocmeth()'
1166.     ]
1167. 
1168. 
1169. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1170. def test_autodoc_module_member_order(app):
1171.     # case member-order='bysource'
1172.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1173.                'member-order': 'bysource',
1174.                "undoc-members": None}
1175.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1176.     assert list(filter(lambda l: '::' in l, actual)) == [
1177.         '.. py:module:: target.sort_by_all',
1178.         '.. py:function:: baz()',
1179.         '.. py:function:: foo()',
1180.         '.. py:class:: Bar()',
1181.         '.. py:class:: Quux()',
1182.         '.. py:function:: foobar()',
1183.         '.. py:function:: qux()',
1184.     ]
1185. 
1186.     # case member-order='bysource' and ignore-module-all
1187.     options = {"members": 'foo, Bar, baz, qux, Quux, foobar',
1188.                'member-order': 'bysource',
1189.                "undoc-members": None,
1190.                "ignore-module-all": None}
1191.     actual = do_autodoc(app, 'module', 'target.sort_by_all', options)
1192.     assert list(filter(lambda l: '::' in l, actual)) == [
1193.         '.. py:module:: target.sort_by_all',
1194.         '.. py:function:: foo()',
1195.         '.. py:class:: Bar()',
1196.         '.. py:function:: baz()',
1197.         '.. py:function:: qux()',
1198.         '.. py:class:: Quux()',
1199.         '.. py:function:: foobar()',
1200.     ]
1201. 
1202. 
1203. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1204. def test_autodoc_module_scope(app):
1205.     app.env.temp_data['autodoc:module'] = 'target'
1206.     actual = do_autodoc(app, 'attribute', 'Class.mdocattr')
1207.     assert list(actual) == [
1208.         '',
1209.         '.. py:attribute:: Class.mdocattr',
1210.         '   :module: target',
1211.         '   :value: <_io.StringIO object>',
1212.         '',
1213.         '   should be documented as well - süß',
1214.         '',
1215.     ]
1216. 
1217. 
1218. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1219. def test_autodoc_class_scope(app):
1220.     app.env.temp_data['autodoc:module'] = 'target'
1221.     app.env.temp_data['autodoc:class'] = 'Class'
1222.     actual = do_autodoc(app, 'attribute', 'mdocattr')
1223.     assert list(actual) == [
1224.         '',
1225.         '.. py:attribute:: Class.mdocattr',
1226.         '   :module: target',
1227.         '   :value: <_io.StringIO object>',
1228.         '',
1229.         '   should be documented as well - süß',
1230.         '',
1231.     ]
1232. 
1233. 
1234. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1235. def test_class_attributes(app):
1236.     options = {"members": None,
1237.                "undoc-members": None}
1238.     actual = do_autodoc(app, 'class', 'target.AttCls', options)
1239.     assert list(actual) == [
1240.         '',
1241.         '.. py:class:: AttCls()',
1242.         '   :module: target',
1243.         '',
1244.         '',
1245.         '   .. py:attribute:: AttCls.a1',
1246.         '      :module: target',
1247.         '      :value: hello world',
1248.         '',
1249.         '',
1250.         '   .. py:attribute:: AttCls.a2',
1251.         '      :module: target',
1252.         '      :value: None',
1253.         ''
1254.     ]
1255. 
1256. 
1257. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1258. def test_autoclass_instance_attributes(app):
1259.     options = {"members": None}
1260.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1261.     assert list(actual) == [
1262.         '',
1263.         '.. py:class:: InstAttCls()',
1264.         '   :module: target',
1265.         '',
1266.         '   Class with documented class and instance attributes.',
1267.         '',
1268.         '',
1269.         '   .. py:attribute:: InstAttCls.ca1',
1270.         '      :module: target',
1271.         "      :value: 'a'",
1272.         '',
1273.         '      Doc comment for class attribute InstAttCls.ca1.',
1274.         '      It can have multiple lines.',
1275.         '',
1276.         '',
1277.         '   .. py:attribute:: InstAttCls.ca2',
1278.         '      :module: target',
1279.         "      :value: 'b'",
1280.         '',
1281.         '      Doc comment for InstAttCls.ca2. One line only.',
1282.         '',
1283.         '',
1284.         '   .. py:attribute:: InstAttCls.ca3',
1285.         '      :module: target',
1286.         "      :value: 'c'",
1287.         '',
1288.         '      Docstring for class attribute InstAttCls.ca3.',
1289.         '',
1290.         '',
1291.         '   .. py:attribute:: InstAttCls.ia1',
1292.         '      :module: target',
1293.         '',
1294.         '      Doc comment for instance attribute InstAttCls.ia1',
1295.         '',
1296.         '',
1297.         '   .. py:attribute:: InstAttCls.ia2',
1298.         '      :module: target',
1299.         '',
1300.         '      Docstring for instance attribute InstAttCls.ia2.',
1301.         ''
1302.     ]
1303. 
1304.     # pick up arbitrary attributes
1305.     options = {"members": 'ca1,ia1'}
1306.     actual = do_autodoc(app, 'class', 'target.InstAttCls', options)
1307.     assert list(actual) == [
1308.         '',
1309.         '.. py:class:: InstAttCls()',
1310.         '   :module: target',
1311.         '',
1312.         '   Class with documented class and instance attributes.',
1313.         '',
1314.         '',
1315.         '   .. py:attribute:: InstAttCls.ca1',
1316.         '      :module: target',
1317.         "      :value: 'a'",
1318.         '',
1319.         '      Doc comment for class attribute InstAttCls.ca1.',
1320.         '      It can have multiple lines.',
1321.         '',
1322.         '',
1323.         '   .. py:attribute:: InstAttCls.ia1',
1324.         '      :module: target',
1325.         '',
1326.         '      Doc comment for instance attribute InstAttCls.ia1',
1327.         ''
1328.     ]
1329. 
1330. 
1331. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1332. def test_autoattribute_instance_attributes(app):
1333.     actual = do_autodoc(app, 'attribute', 'target.InstAttCls.ia1')
1334.     assert list(actual) == [
1335.         '',
1336.         '.. py:attribute:: InstAttCls.ia1',
1337.         '   :module: target',
1338.         '',
1339.         '   Doc comment for instance attribute InstAttCls.ia1',
1340.         ''
1341.     ]
1342. 
1343. 
1344. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1345. def test_slots(app):
1346.     options = {"members": None,
1347.                "undoc-members": None}
1348.     actual = do_autodoc(app, 'module', 'target.slots', options)
1349.     assert list(actual) == [
1350.         '',
1351.         '.. py:module:: target.slots',
1352.         '',
1353.         '',
1354.         '.. py:class:: Bar()',
1355.         '   :module: target.slots',
1356.         '',
1357.         '   docstring',
1358.         '',
1359.         '',
1360.         '   .. py:attribute:: Bar.attr1',
1361.         '      :module: target.slots',
1362.         '',
1363.         '      docstring of attr1',
1364.         '',
1365.         '',
1366.         '   .. py:attribute:: Bar.attr2',
1367.         '      :module: target.slots',
1368.         '',
1369.         '      docstring of instance attr2',
1370.         '',
1371.         '',
1372.         '   .. py:attribute:: Bar.attr3',
1373.         '      :module: target.slots',
1374.         '',
1375.         '',
1376.         '.. py:class:: Baz()',
1377.         '   :module: target.slots',
1378.         '',
1379.         '   docstring',
1380.         '',
1381.         '',
1382.         '   .. py:attribute:: Baz.attr',
1383.         '      :module: target.slots',
1384.         '',
1385.         '',
1386.         '.. py:class:: Foo()',
1387.         '   :module: target.slots',
1388.         '',
1389.         '   docstring',
1390.         '',
1391.         '',
1392.         '   .. py:attribute:: Foo.attr',
1393.         '      :module: target.slots',
1394.         '',
1395.     ]
1396. 
1397. 
1398. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1399. def test_enum_class(app):
1400.     options = {"members": None}
1401.     actual = do_autodoc(app, 'class', 'target.enums.EnumCls', options)
1402.     assert list(actual) == [
1403.         '',
1404.         '.. py:class:: EnumCls(value)',
1405.         '   :module: target.enums',
1406.         '',
1407.         '   this is enum class',
1408.         '',
1409.         '',
1410.         '   .. py:method:: EnumCls.say_goodbye()',
1411.         '      :module: target.enums',
1412.         '      :classmethod:',
1413.         '',
1414.         '      a classmethod says good-bye to you.',
1415.         '',
1416.         '',
1417.         '   .. py:method:: EnumCls.say_hello()',
1418.         '      :module: target.enums',
1419.         '',
1420.         '      a method says hello to you.',
1421.         '',
1422.         '',
1423.         '   .. py:attribute:: EnumCls.val1',
1424.         '      :module: target.enums',
1425.         '      :value: 12',
1426.         '',
1427.         '      doc for val1',
1428.         '',
1429.         '',
1430.         '   .. py:attribute:: EnumCls.val2',
1431.         '      :module: target.enums',
1432.         '      :value: 23',
1433.         '',
1434.         '      doc for val2',
1435.         '',
1436.         '',
1437.         '   .. py:attribute:: EnumCls.val3',
1438.         '      :module: target.enums',
1439.         '      :value: 34',
1440.         '',
1441.         '      doc for val3',
1442.         '',
1443.     ]
1444. 
1445.     # checks for an attribute of EnumClass
1446.     actual = do_autodoc(app, 'attribute', 'target.enums.EnumCls.val1')
1447.     assert list(actual) == [
1448.         '',
1449.         '.. py:attribute:: EnumCls.val1',
1450.         '   :module: target.enums',
1451.         '   :value: 12',
1452.         '',
1453.         '   doc for val1',
1454.         ''
1455.     ]
1456. 
1457. 
1458. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1459. def test_descriptor_class(app):
1460.     options = {"members": 'CustomDataDescriptor,CustomDataDescriptor2'}
1461.     actual = do_autodoc(app, 'module', 'target.descriptor', options)
1462.     assert list(actual) == [
1463.         '',
1464.         '.. py:module:: target.descriptor',
1465.         '',
1466.         '',
1467.         '.. py:class:: CustomDataDescriptor(doc)',
1468.         '   :module: target.descriptor',
1469.         '',
1470.         '   Descriptor class docstring.',
1471.         '',
1472.         '',
1473.         '   .. py:method:: CustomDataDescriptor.meth()',
1474.         '      :module: target.descriptor',
1475.         '',
1476.         '      Function.',
1477.         '',
1478.         '',
1479.         '.. py:class:: CustomDataDescriptor2(doc)',
1480.         '   :module: target.descriptor',
1481.         '',
1482.         '   Descriptor class with custom metaclass docstring.',
1483.         '',
1484.     ]
1485. 
1486. 
1487. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1488. def test_automethod_for_builtin(app):
1489.     actual = do_autodoc(app, 'method', 'builtins.int.__add__')
1490.     assert list(actual) == [
1491.         '',
1492.         '.. py:method:: int.__add__(value, /)',
1493.         '   :module: builtins',
1494.         '',
1495.         '   Return self+value.',
1496.         '',
1497.     ]
1498. 
1499. 
1500. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1501. def test_automethod_for_decorated(app):
1502.     actual = do_autodoc(app, 'method', 'target.decorator.Bar.meth')
1503.     assert list(actual) == [
1504.         '',
1505.         '.. py:method:: Bar.meth(name=None, age=None)',
1506.         '   :module: target.decorator',
1507.         '',
1508.     ]
1509. 
1510. 
1511. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1512. def test_abstractmethods(app):
1513.     options = {"members": None,
1514.                "undoc-members": None}
1515.     actual = do_autodoc(app, 'module', 'target.abstractmethods', options)
1516.     assert list(actual) == [
1517.         '',
1518.         '.. py:module:: target.abstractmethods',
1519.         '',
1520.         '',
1521.         '.. py:class:: Base()',
1522.         '   :module: target.abstractmethods',
1523.         '',
1524.         '',
1525.         '   .. py:method:: Base.abstractmeth()',
1526.         '      :module: target.abstractmethods',
1527.         '      :abstractmethod:',
1528.         '',
1529.         '',
1530.         '   .. py:method:: Base.classmeth()',
1531.         '      :module: target.abstractmethods',
1532.         '      :abstractmethod:',
1533.         '      :classmethod:',
1534.         '',
1535.         '',
1536.         '   .. py:method:: Base.coroutinemeth()',
1537.         '      :module: target.abstractmethods',
1538.         '      :abstractmethod:',
1539.         '      :async:',
1540.         '',
1541.         '',
1542.         '   .. py:method:: Base.meth()',
1543.         '      :module: target.abstractmethods',
1544.         '',
1545.         '',
1546.         '   .. py:property:: Base.prop',
1547.         '      :module: target.abstractmethods',
1548.         '      :abstractmethod:',
1549.         '',
1550.         '',
1551.         '   .. py:method:: Base.staticmeth()',
1552.         '      :module: target.abstractmethods',
1553.         '      :abstractmethod:',
1554.         '      :staticmethod:',
1555.         '',
1556.     ]
1557. 
1558. 
1559. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1560. def test_partialfunction(app):
1561.     options = {"members": None}
1562.     actual = do_autodoc(app, 'module', 'target.partialfunction', options)
1563.     assert list(actual) == [
1564.         '',
1565.         '.. py:module:: target.partialfunction',
1566.         '',
1567.         '',
1568.         '.. py:function:: func1(a, b, c)',
1569.         '   :module: target.partialfunction',
1570.         '',
1571.         '   docstring of func1',
1572.         '',
1573.         '',
1574.         '.. py:function:: func2(b, c)',
1575.         '   :module: target.partialfunction',
1576.         '',
1577.         '   docstring of func1',
1578.         '',
1579.         '',
1580.         '.. py:function:: func3(c)',
1581.         '   :module: target.partialfunction',
1582.         '',
1583.         '   docstring of func3',
1584.         '',
1585.         '',
1586.         '.. py:function:: func4()',
1587.         '   :module: target.partialfunction',
1588.         '',
1589.         '   docstring of func3',
1590.         '',
1591.     ]
1592. 
1593. 
1594. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1595. def test_imported_partialfunction_should_not_shown_without_imported_members(app):
1596.     options = {"members": None}
1597.     actual = do_autodoc(app, 'module', 'target.imported_members', options)
1598.     assert list(actual) == [
1599.         '',
1600.         '.. py:module:: target.imported_members',
1601.         ''
1602.     ]
1603. 
1604. 
1605. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1606. def test_bound_method(app):
1607.     options = {"members": None}
1608.     actual = do_autodoc(app, 'module', 'target.bound_method', options)
1609.     assert list(actual) == [
1610.         '',
1611.         '.. py:module:: target.bound_method',
1612.         '',
1613.         '',
1614.         '.. py:function:: bound_method()',
1615.         '   :module: target.bound_method',
1616.         '',
1617.         '   Method docstring',
1618.         '',
1619.     ]
1620. 
1621. 
1622. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1623. def test_partialmethod(app):
1624.     expected = [
1625.         '',
1626.         '.. py:class:: Cell()',
1627.         '   :module: target.partialmethod',
1628.         '',
1629.         '   An example for partialmethod.',
1630.         '',
1631.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1632.         '',
1633.         '',
1634.         '   .. py:method:: Cell.set_alive()',
1635.         '      :module: target.partialmethod',
1636.         '',
1637.         '      Make a cell alive.',
1638.         '',
1639.         '',
1640.         '   .. py:method:: Cell.set_state(state)',
1641.         '      :module: target.partialmethod',
1642.         '',
1643.         '      Update state of cell to *state*.',
1644.         '',
1645.     ]
1646. 
1647.     options = {"members": None}
1648.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1649.     assert list(actual) == expected
1650. 
1651. 
1652. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1653. def test_partialmethod_undoc_members(app):
1654.     expected = [
1655.         '',
1656.         '.. py:class:: Cell()',
1657.         '   :module: target.partialmethod',
1658.         '',
1659.         '   An example for partialmethod.',
1660.         '',
1661.         '   refs: https://docs.python.jp/3/library/functools.html#functools.partialmethod',
1662.         '',
1663.         '',
1664.         '   .. py:method:: Cell.set_alive()',
1665.         '      :module: target.partialmethod',
1666.         '',
1667.         '      Make a cell alive.',
1668.         '',
1669.         '',
1670.         '   .. py:method:: Cell.set_dead()',
1671.         '      :module: target.partialmethod',
1672.         '',
1673.         '',
1674.         '   .. py:method:: Cell.set_state(state)',
1675.         '      :module: target.partialmethod',
1676.         '',
1677.         '      Update state of cell to *state*.',
1678.         '',
1679.     ]
1680. 
1681.     options = {"members": None,
1682.                "undoc-members": None}
1683.     actual = do_autodoc(app, 'class', 'target.partialmethod.Cell', options)
1684.     assert list(actual) == expected
1685. 
1686. 
1687. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1688. def test_autodoc_typed_instance_variables(app):
1689.     options = {"members": None,
1690.                "undoc-members": None}
1691.     actual = do_autodoc(app, 'module', 'target.typed_vars', options)
1692.     assert list(actual) == [
1693.         '',
1694.         '.. py:module:: target.typed_vars',
1695.         '',
1696.         '',
1697.         '.. py:attribute:: Alias',
1698.         '   :module: target.typed_vars',
1699.         '',
1700.         '   alias of :py:class:`target.typed_vars.Derived`',
1701.         '',
1702.         '.. py:class:: Class()',
1703.         '   :module: target.typed_vars',
1704.         '',
1705.         '',
1706.         '   .. py:attribute:: Class.attr1',
1707.         '      :module: target.typed_vars',
1708.         '      :type: int',
1709.         '      :value: 0',
1710.         '',
1711.         '',
1712.         '   .. py:attribute:: Class.attr2',
1713.         '      :module: target.typed_vars',
1714.         '      :type: int',
1715.         '',
1716.         '',
1717.         '   .. py:attribute:: Class.attr3',
1718.         '      :module: target.typed_vars',
1719.         '      :type: int',
1720.         '      :value: 0',
1721.         '',
1722.         '',
1723.         '   .. py:attribute:: Class.attr4',
1724.         '      :module: target.typed_vars',
1725.         '      :type: int',
1726.         '',
1727.         '      attr4',
1728.         '',
1729.         '',
1730.         '   .. py:attribute:: Class.attr5',
1731.         '      :module: target.typed_vars',
1732.         '      :type: int',
1733.         '',
1734.         '      attr5',
1735.         '',
1736.         '',
1737.         '   .. py:attribute:: Class.attr6',
1738.         '      :module: target.typed_vars',
1739.         '      :type: int',
1740.         '',
1741.         '      attr6',
1742.         '',
1743.         '',
1744.         '   .. py:attribute:: Class.descr4',
1745.         '      :module: target.typed_vars',
1746.         '      :type: int',
1747.         '',
1748.         '      This is descr4',
1749.         '',
1750.         '',
1751.         '.. py:class:: Derived()',
1752.         '   :module: target.typed_vars',
1753.         '',
1754.         '',
1755.         '   .. py:attribute:: Derived.attr7',
1756.         '      :module: target.typed_vars',
1757.         '      :type: int',
1758.         '',
1759.         '',
1760.         '.. py:data:: attr1',
1761.         '   :module: target.typed_vars',
1762.         '   :type: str',
1763.         "   :value: ''",
1764.         '',
1765.         '   attr1',
1766.         '',
1767.         '',
1768.         '.. py:data:: attr2',
1769.         '   :module: target.typed_vars',
1770.         '   :type: str',
1771.         '',
1772.         '   attr2',
1773.         '',
1774.         '',
1775.         '.. py:data:: attr3',
1776.         '   :module: target.typed_vars',
1777.         '   :type: str',
1778.         "   :value: ''",
1779.         '',
1780.         '   attr3',
1781.         '',
1782.     ]
1783. 
1784. 
1785. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1786. def test_autodoc_typed_inherited_instance_variables(app):
1787.     options = {"members": None,
1788.                "undoc-members": None,
1789.                "inherited-members": None}
1790.     actual = do_autodoc(app, 'class', 'target.typed_vars.Derived', options)
1791.     assert list(actual) == [
1792.         '',
1793.         '.. py:class:: Derived()',
1794.         '   :module: target.typed_vars',
1795.         '',
1796.         '',
1797.         '   .. py:attribute:: Derived.attr1',
1798.         '      :module: target.typed_vars',
1799.         '      :type: int',
1800.         '      :value: 0',
1801.         '',
1802.         '',
1803.         '   .. py:attribute:: Derived.attr2',
1804.         '      :module: target.typed_vars',
1805.         '      :type: int',
1806.         '',
1807.         '',
1808.         '   .. py:attribute:: Derived.attr3',
1809.         '      :module: target.typed_vars',
1810.         '      :type: int',
1811.         '      :value: 0',
1812.         '',
1813.         '',
1814.         '   .. py:attribute:: Derived.attr4',
1815.         '      :module: target.typed_vars',
1816.         '      :type: int',
1817.         '',
1818.         '      attr4',
1819.         '',
1820.         '',
1821.         '   .. py:attribute:: Derived.attr5',
1822.         '      :module: target.typed_vars',
1823.         '      :type: int',
1824.         '',
1825.         '      attr5',
1826.         '',
1827.         '',
1828.         '   .. py:attribute:: Derived.attr6',
1829.         '      :module: target.typed_vars',
1830.         '      :type: int',
1831.         '',
1832.         '      attr6',
1833.         '',
1834.         '',
1835.         '   .. py:attribute:: Derived.attr7',
1836.         '      :module: target.typed_vars',
1837.         '      :type: int',
1838.         '',
1839.         '',
1840.         '   .. py:attribute:: Derived.descr4',
1841.         '      :module: target.typed_vars',
1842.         '      :type: int',
1843.         '',
1844.     ]
1845. 
1846. 
1847. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1848. def test_autodoc_GenericAlias(app):
1849.     options = {"members": None,
1850.                "undoc-members": None}
1851.     actual = do_autodoc(app, 'module', 'target.genericalias', options)
1852.     if sys.version_info < (3, 7):
1853.         assert list(actual) == [
1854.             '',
1855.             '.. py:module:: target.genericalias',
1856.             '',
1857.             '',
1858.             '.. py:class:: Class()',
1859.             '   :module: target.genericalias',
1860.             '',
1861.             '',
1862.             '   .. py:attribute:: Class.T',
1863.             '      :module: target.genericalias',
1864.             '',
1865.             '      alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1866.             '',
1867.             '.. py:attribute:: T',
1868.             '   :module: target.genericalias',
1869.             '',
1870.             '   alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1871.         ]
1872.     else:
1873.         assert list(actual) == [
1874.             '',
1875.             '.. py:module:: target.genericalias',
1876.             '',
1877.             '',
1878.             '.. py:class:: Class()',
1879.             '   :module: target.genericalias',
1880.             '',
1881.             '',
1882.             '   .. py:attribute:: Class.T',
1883.             '      :module: target.genericalias',
1884.             '',
1885.             '      A list of int',
1886.             '',
1887.             '      alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1888.             '',
1889.             '',
1890.             '.. py:data:: T',
1891.             '   :module: target.genericalias',
1892.             '',
1893.             '   A list of int',
1894.             '',
1895.             '   alias of :py:class:`~typing.List`\\ [:py:class:`int`]',
1896.             '',
1897.         ]
1898. 
1899. 
1900. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1901. def test_autodoc_TypeVar(app):
1902.     options = {"members": None,
1903.                "undoc-members": None}
1904.     actual = do_autodoc(app, 'module', 'target.typevar', options)
1905.     assert list(actual) == [
1906.         '',
1907.         '.. py:module:: target.typevar',
1908.         '',
1909.         '',
1910.         '.. py:class:: Class()',
1911.         '   :module: target.typevar',
1912.         '',
1913.         '',
1914.         '   .. py:attribute:: Class.T1',
1915.         '      :module: target.typevar',
1916.         '',
1917.         '      T1',
1918.         '',
1919.         "      alias of TypeVar('T1')",
1920.         '',
1921.         '',
1922.         '   .. py:attribute:: Class.T6',
1923.         '      :module: target.typevar',
1924.         '',
1925.         '      T6',
1926.         '',
1927.         '      alias of :py:class:`int`',
1928.         '',
1929.         '',
1930.         '.. py:data:: T1',
1931.         '   :module: target.typevar',
1932.         '',
1933.         '   T1',
1934.         '',
1935.         "   alias of TypeVar('T1')",
1936.         '',
1937.         '',
1938.         '.. py:data:: T3',
1939.         '   :module: target.typevar',
1940.         '',
1941.         '   T3',
1942.         '',
1943.         "   alias of TypeVar('T3', int, str)",
1944.         '',
1945.         '',
1946.         '.. py:data:: T4',
1947.         '   :module: target.typevar',
1948.         '',
1949.         '   T4',
1950.         '',
1951.         "   alias of TypeVar('T4', covariant=True)",
1952.         '',
1953.         '',
1954.         '.. py:data:: T5',
1955.         '   :module: target.typevar',
1956.         '',
1957.         '   T5',
1958.         '',
1959.         "   alias of TypeVar('T5', contravariant=True)",
1960.         '',
1961.         '',
1962.         '.. py:data:: T6',
1963.         '   :module: target.typevar',
1964.         '',
1965.         '   T6',
1966.         '',
1967.         '   alias of :py:class:`int`',
1968.         '',
1969.         '',
1970.         '.. py:data:: T7',
1971.         '   :module: target.typevar',
1972.         '',
1973.         '   T7',
1974.         '',
1975.         "   alias of TypeVar('T7', bound=\\ :py:class:`int`)",
1976.         '',
1977.     ]
1978. 
1979. 
1980. @pytest.mark.skipif(sys.version_info < (3, 9), reason='py39+ is required.')
1981. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1982. def test_autodoc_Annotated(app):
1983.     options = {"members": None}
1984.     actual = do_autodoc(app, 'module', 'target.annotated', options)
1985.     assert list(actual) == [
1986.         '',
1987.         '.. py:module:: target.annotated',
1988.         '',
1989.         '',
1990.         '.. py:function:: hello(name: str) -> None',
1991.         '   :module: target.annotated',
1992.         '',
1993.         '   docstring',
1994.         '',
1995.     ]
1996. 
1997. 
1998. @pytest.mark.sphinx('html', testroot='ext-autodoc')
1999. def test_autodoc_TYPE_CHECKING(app):
2000.     options = {"members": None,
2001.                "undoc-members": None}
2002.     actual = do_autodoc(app, 'module', 'target.TYPE_CHECKING', options)
2003.     assert list(actual) == [
2004.         '',
2005.         '.. py:module:: target.TYPE_CHECKING',
2006.         '',
2007.         '',
2008.         '.. py:class:: Foo()',
2009.         '   :module: target.TYPE_CHECKING',
2010.         '',
2011.         '',
2012.         '   .. py:attribute:: Foo.attr1',
2013.         '      :module: target.TYPE_CHECKING',
2014.         '      :type: StringIO',
2015.         '',
2016.     ]
2017. 
2018. 
2019. @pytest.mark.sphinx('html', testroot='pycode-egg')
2020. def test_autodoc_for_egged_code(app):
2021.     options = {"members": None,
2022.                "undoc-members": None}
2023.     actual = do_autodoc(app, 'module', 'sample', options)
2024.     assert list(actual) == [
2025.         '',
2026.         '.. py:module:: sample',
2027.         '',
2028.         '',
2029.         '.. py:data:: CONSTANT',
2030.         '   :module: sample',
2031.         '   :value: 1',
2032.         '',
2033.         '   constant on sample.py',
2034.         '',
2035.         '',
2036.         '.. py:function:: hello(s)',
2037.         '   :module: sample',
2038.         ''
2039.     ]
2040. 
2041. 
2042. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2043. def test_singledispatch(app):
2044.     options = {"members": None}
2045.     actual = do_autodoc(app, 'module', 'target.singledispatch', options)
2046.     assert list(actual) == [
2047.         '',
2048.         '.. py:module:: target.singledispatch',
2049.         '',
2050.         '',
2051.         '.. py:function:: func(arg, kwarg=None)',
2052.         '                 func(arg: float, kwarg=None)',
2053.         '                 func(arg: int, kwarg=None)',
2054.         '                 func(arg: str, kwarg=None)',
2055.         '   :module: target.singledispatch',
2056.         '',
2057.         '   A function for general use.',
2058.         '',
2059.     ]
2060. 
2061. 
2062. @pytest.mark.skipif(sys.version_info < (3, 8),
2063.                     reason='singledispatchmethod is available since python3.8')
2064. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2065. def test_singledispatchmethod(app):
2066.     options = {"members": None}
2067.     actual = do_autodoc(app, 'module', 'target.singledispatchmethod', options)
2068.     assert list(actual) == [
2069.         '',
2070.         '.. py:module:: target.singledispatchmethod',
2071.         '',
2072.         '',
2073.         '.. py:class:: Foo()',
2074.         '   :module: target.singledispatchmethod',
2075.         '',
2076.         '   docstring',
2077.         '',
2078.         '',
2079.         '   .. py:method:: Foo.meth(arg, kwarg=None)',
2080.         '                  Foo.meth(arg: float, kwarg=None)',
2081.         '                  Foo.meth(arg: int, kwarg=None)',
2082.         '                  Foo.meth(arg: str, kwarg=None)',
2083.         '      :module: target.singledispatchmethod',
2084.         '',
2085.         '      A method for general use.',
2086.         '',
2087.     ]
2088. 
2089. 
2090. @pytest.mark.skipif(sys.version_info < (3, 8),
2091.                     reason='singledispatchmethod is available since python3.8')
2092. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2093. def test_singledispatchmethod_automethod(app):
2094.     options = {}
2095.     actual = do_autodoc(app, 'method', 'target.singledispatchmethod.Foo.meth', options)
2096.     assert list(actual) == [
2097.         '',
2098.         '.. py:method:: Foo.meth(arg, kwarg=None)',
2099.         '               Foo.meth(arg: float, kwarg=None)',
2100.         '               Foo.meth(arg: int, kwarg=None)',
2101.         '               Foo.meth(arg: str, kwarg=None)',
2102.         '   :module: target.singledispatchmethod',
2103.         '',
2104.         '   A method for general use.',
2105.         '',
2106.     ]
2107. 
2108. 
2109. @pytest.mark.skipif(pyximport is None, reason='cython is not installed')
2110. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2111. def test_cython(app):
2112.     options = {"members": None,
2113.                "undoc-members": None}
2114.     actual = do_autodoc(app, 'module', 'target.cython', options)
2115.     assert list(actual) == [
2116.         '',
2117.         '.. py:module:: target.cython',
2118.         '',
2119.         '',
2120.         '.. py:class:: Class()',
2121.         '   :module: target.cython',
2122.         '',
2123.         '   Docstring.',
2124.         '',
2125.         '',
2126.         '   .. py:method:: Class.meth(name: str, age: int = 0) -> None',
2127.         '      :module: target.cython',
2128.         '',
2129.         '      Docstring.',
2130.         '',
2131.         '',
2132.         '.. py:function:: foo(x: int, *args, y: str, **kwargs)',
2133.         '   :module: target.cython',
2134.         '',
2135.         '   Docstring.',
2136.         '',
2137.     ]
2138. 
2139. 
2140. @pytest.mark.skipif(sys.version_info < (3, 8),
2141.                     reason='typing.final is available since python3.8')
2142. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2143. def test_final(app):
2144.     options = {"members": None}
2145.     actual = do_autodoc(app, 'module', 'target.final', options)
2146.     assert list(actual) == [
2147.         '',
2148.         '.. py:module:: target.final',
2149.         '',
2150.         '',
2151.         '.. py:class:: Class()',
2152.         '   :module: target.final',
2153.         '   :final:',
2154.         '',
2155.         '   docstring',
2156.         '',
2157.         '',
2158.         '   .. py:method:: Class.meth1()',
2159.         '      :module: target.final',
2160.         '      :final:',
2161.         '',
2162.         '      docstring',
2163.         '',
2164.         '',
2165.         '   .. py:method:: Class.meth2()',
2166.         '      :module: target.final',
2167.         '',
2168.         '      docstring',
2169.         '',
2170.     ]
2171. 
2172. 
2173. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2174. def test_overload(app):
2175.     options = {"members": None}
2176.     actual = do_autodoc(app, 'module', 'target.overload', options)
2177.     assert list(actual) == [
2178.         '',
2179.         '.. py:module:: target.overload',
2180.         '',
2181.         '',
2182.         '.. py:class:: Bar(x: int, y: int)',
2183.         '              Bar(x: str, y: str)',
2184.         '   :module: target.overload',
2185.         '',
2186.         '   docstring',
2187.         '',
2188.         '',
2189.         '.. py:class:: Baz(x: int, y: int)',
2190.         '              Baz(x: str, y: str)',
2191.         '   :module: target.overload',
2192.         '',
2193.         '   docstring',
2194.         '',
2195.         '',
2196.         '.. py:class:: Foo(x: int, y: int)',
2197.         '              Foo(x: str, y: str)',
2198.         '   :module: target.overload',
2199.         '',
2200.         '   docstring',
2201.         '',
2202.         '',
2203.         '.. py:class:: Math()',
2204.         '   :module: target.overload',
2205.         '',
2206.         '   docstring',
2207.         '',
2208.         '',
2209.         '   .. py:method:: Math.sum(x: int, y: int = 0) -> int',
2210.         '                  Math.sum(x: float, y: float = 0.0) -> float',
2211.         '                  Math.sum(x: str, y: str = None) -> str',
2212.         '      :module: target.overload',
2213.         '',
2214.         '      docstring',
2215.         '',
2216.         '',
2217.         '.. py:function:: sum(x: int, y: int = 0) -> int',
2218.         '                 sum(x: float, y: float = 0.0) -> float',
2219.         '                 sum(x: str, y: str = None) -> str',
2220.         '   :module: target.overload',
2221.         '',
2222.         '   docstring',
2223.         '',
2224.     ]
2225. 
2226. 
2227. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2228. def test_overload2(app):
2229.     options = {"members": None}
2230.     actual = do_autodoc(app, 'module', 'target.overload2', options)
2231.     assert list(actual) == [
2232.         '',
2233.         '.. py:module:: target.overload2',
2234.         '',
2235.         '',
2236.         '.. py:class:: Baz(x: int, y: int)',
2237.         '              Baz(x: str, y: str)',
2238.         '   :module: target.overload2',
2239.         '',
2240.     ]
2241. 
2242. 
2243. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2244. def test_pymodule_for_ModuleLevelDocumenter(app):
2245.     app.env.ref_context['py:module'] = 'target.classes'
2246.     actual = do_autodoc(app, 'class', 'Foo')
2247.     assert list(actual) == [
2248.         '',
2249.         '.. py:class:: Foo()',
2250.         '   :module: target.classes',
2251.         '',
2252.     ]
2253. 
2254. 
2255. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2256. def test_pymodule_for_ClassLevelDocumenter(app):
2257.     app.env.ref_context['py:module'] = 'target.methods'
2258.     actual = do_autodoc(app, 'method', 'Base.meth')
2259.     assert list(actual) == [
2260.         '',
2261.         '.. py:method:: Base.meth()',
2262.         '   :module: target.methods',
2263.         '',
2264.     ]
2265. 
2266. 
2267. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2268. def test_pyclass_for_ClassLevelDocumenter(app):
2269.     app.env.ref_context['py:module'] = 'target.methods'
2270.     app.env.ref_context['py:class'] = 'Base'
2271.     actual = do_autodoc(app, 'method', 'meth')
2272.     assert list(actual) == [
2273.         '',
2274.         '.. py:method:: Base.meth()',
2275.         '   :module: target.methods',
2276.         '',
2277.     ]
2278. 
2279. 
2280. @pytest.mark.sphinx('dummy', testroot='ext-autodoc')
2281. def test_autodoc(app, status, warning):
2282.     app.builder.build_all()
2283. 
2284.     content = app.env.get_doctree('index')
2285.     assert isinstance(content[3], addnodes.desc)
2286.     assert content[3][0].astext() == 'autodoc_dummy_module.test()'
2287.     assert content[3][1].astext() == 'Dummy function using dummy.*'
2288. 
2289.     # issue sphinx-doc/sphinx#2437
2290.     assert content[11][-1].astext() == """Dummy class Bar with alias.
2291. 
2292. 
2293. 
2294. my_name
2295. 
2296. alias of bug2437.autodoc_dummy_foo.Foo"""
2297.     assert warning.getvalue() == ''
2298. 
2299. 
2300. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2301. def test_name_conflict(app):
2302.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo')
2303.     assert list(actual) == [
2304.         '',
2305.         '.. py:class:: foo()',
2306.         '   :module: target.name_conflict',
2307.         '',
2308.         '   docstring of target.name_conflict::foo.',
2309.         '',
2310.     ]
2311. 
2312.     actual = do_autodoc(app, 'class', 'target.name_conflict.foo.bar')
2313.     assert list(actual) == [
2314.         '',
2315.         '.. py:class:: bar()',
2316.         '   :module: target.name_conflict.foo',
2317.         '',
2318.         '   docstring of target.name_conflict.foo::bar.',
2319.         '',
2320.     ]
2321. 
2322. 
2323. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2324. def test_name_mangling(app):
2325.     options = {"members": None,
2326.                "undoc-members": None,
2327.                "private-members": None}
2328.     actual = do_autodoc(app, 'module', 'target.name_mangling', options)
2329.     assert list(actual) == [
2330.         '',
2331.         '.. py:module:: target.name_mangling',
2332.         '',
2333.         '',
2334.         '.. py:class:: Bar()',
2335.         '   :module: target.name_mangling',
2336.         '',
2337.         '',
2338.         '   .. py:attribute:: Bar._Baz__email',
2339.         '      :module: target.name_mangling',
2340.         '      :value: None',
2341.         '',
2342.         '      a member having mangled-like name',
2343.         '',
2344.         '',
2345.         '   .. py:attribute:: Bar.__address',
2346.         '      :module: target.name_mangling',
2347.         '      :value: None',
2348.         '',
2349.         '',
2350.         '.. py:class:: Foo()',
2351.         '   :module: target.name_mangling',
2352.         '',
2353.         '',
2354.         '   .. py:attribute:: Foo.__age',
2355.         '      :module: target.name_mangling',
2356.         '      :value: None',
2357.         '',
2358.         '',
2359.         '   .. py:attribute:: Foo.__name',
2360.         '      :module: target.name_mangling',
2361.         '      :value: None',
2362.         '',
2363.         '      name of Foo',
2364.         '',
2365.     ]
2366. 
2367. 
2368. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
2369. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2370. def test_type_union_operator(app):
2371.     options = {'members': None}
2372.     actual = do_autodoc(app, 'module', 'target.pep604', options)
2373.     assert list(actual) == [
2374.         '',
2375.         '.. py:module:: target.pep604',
2376.         '',
2377.         '',
2378.         '.. py:class:: Foo()',
2379.         '   :module: target.pep604',
2380.         '',
2381.         '   docstring',
2382.         '',
2383.         '',
2384.         '   .. py:attribute:: Foo.attr',
2385.         '      :module: target.pep604',
2386.         '      :type: int | str',
2387.         '',
2388.         '      docstring',
2389.         '',
2390.         '',
2391.         '   .. py:method:: Foo.meth(x: int | str, y: int | str) -> int | str',
2392.         '      :module: target.pep604',
2393.         '',
2394.         '      docstring',
2395.         '',
2396.         '',
2397.         '.. py:data:: attr',
2398.         '   :module: target.pep604',
2399.         '   :type: int | str',
2400.         '',
2401.         '   docstring',
2402.         '',
2403.         '',
2404.         '.. py:function:: sum(x: int | str, y: int | str) -> int | str',
2405.         '   :module: target.pep604',
2406.         '',
2407.         '   docstring',
2408.         '',
2409.     ]
2410. 
2411. 
2412. @pytest.mark.skipif(sys.version_info < (3, 6), reason='python 3.6+ is required.')
2413. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2414. def test_hide_value(app):
2415.     options = {'members': None}
2416.     actual = do_autodoc(app, 'module', 'target.hide_value', options)
2417.     assert list(actual) == [
2418.         '',
2419.         '.. py:module:: target.hide_value',
2420.         '',
2421.         '',
2422.         '.. py:class:: Foo()',
2423.         '   :module: target.hide_value',
2424.         '',
2425.         '   docstring',
2426.         '',
2427.         '',
2428.         '   .. py:attribute:: Foo.SENTINEL1',
2429.         '      :module: target.hide_value',
2430.         '',
2431.         '      docstring',
2432.         '',
2433.         '      :meta hide-value:',
2434.         '',
2435.         '',
2436.         '   .. py:attribute:: Foo.SENTINEL2',
2437.         '      :module: target.hide_value',
2438.         '',
2439.         '      :meta hide-value:',
2440.         '',
2441.         '',
2442.         '.. py:data:: SENTINEL1',
2443.         '   :module: target.hide_value',
2444.         '',
2445.         '   docstring',
2446.         '',
2447.         '   :meta hide-value:',
2448.         '',
2449.         '',
2450.         '.. py:data:: SENTINEL2',
2451.         '   :module: target.hide_value',
2452.         '',
2453.         '   :meta hide-value:',
2454.         '',
2455.     ]
2456. 
2457. 
2458. @pytest.mark.sphinx('html', testroot='ext-autodoc')
2459. def test_canonical(app):
2460.     options = {'members': None,
2461.                'imported-members': None}
2462.     actual = do_autodoc(app, 'module', 'target.canonical', options)
2463.     assert list(actual) == [
2464.         '',
2465.         '.. py:module:: target.canonical',
2466.         '',
2467.         '',
2468.         '.. py:class:: Bar()',
2469.         '   :module: target.canonical',
2470.         '',
2471.         '   docstring',
2472.         '',
2473.         '',
2474.         '.. py:class:: Foo()',
2475.         '   :module: target.canonical',
2476.         '   :canonical: target.canonical.original.Foo',
2477.         '',
2478.         '   docstring',
2479.         '',
2480.         '',
2481.         '   .. py:method:: Foo.meth()',
2482.         '      :module: target.canonical',
2483.         '',
2484.         '      docstring',
2485.         '',
2486.     ]


File: tests/test_ext_autodoc_autoclass.py
Line number range: 1 - 433
Content:
1. """
2.     test_ext_autodoc_autoclass
3.     ~~~~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly the Documenters; the auto
6.     directives are tested in a test source file translated by test_build.
7. 
8.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
9.     :license: BSD, see LICENSE for details.
10. """
11. 
12. import sys
13. from typing import List, Union
14. 
15. import pytest
16. 
17. from .test_ext_autodoc import do_autodoc
18. 
19. 
20. @pytest.mark.sphinx('html', testroot='ext-autodoc')
21. def test_classes(app):
22.     actual = do_autodoc(app, 'function', 'target.classes.Foo')
23.     assert list(actual) == [
24.         '',
25.         '.. py:function:: Foo()',
26.         '   :module: target.classes',
27.         '',
28.     ]
29. 
30.     actual = do_autodoc(app, 'function', 'target.classes.Bar')
31.     assert list(actual) == [
32.         '',
33.         '.. py:function:: Bar(x, y)',
34.         '   :module: target.classes',
35.         '',
36.     ]
37. 
38.     actual = do_autodoc(app, 'function', 'target.classes.Baz')
39.     assert list(actual) == [
40.         '',
41.         '.. py:function:: Baz(x, y)',
42.         '   :module: target.classes',
43.         '',
44.     ]
45. 
46.     actual = do_autodoc(app, 'function', 'target.classes.Qux')
47.     assert list(actual) == [
48.         '',
49.         '.. py:function:: Qux(foo, bar)',
50.         '   :module: target.classes',
51.         '',
52.     ]
53. 
54. 
55. @pytest.mark.sphinx('html', testroot='ext-autodoc')
56. def test_instance_variable(app):
57.     options = {'members': None}
58.     actual = do_autodoc(app, 'class', 'target.instance_variable.Bar', options)
59.     assert list(actual) == [
60.         '',
61.         '.. py:class:: Bar()',
62.         '   :module: target.instance_variable',
63.         '',
64.         '',
65.         '   .. py:attribute:: Bar.attr2',
66.         '      :module: target.instance_variable',
67.         '',
68.         '      docstring bar',
69.         '',
70.         '',
71.         '   .. py:attribute:: Bar.attr3',
72.         '      :module: target.instance_variable',
73.         '',
74.         '      docstring bar',
75.         '',
76.     ]
77. 
78. 
79. @pytest.mark.sphinx('html', testroot='ext-autodoc')
80. def test_inherited_instance_variable(app):
81.     options = {'members': None,
82.                'inherited-members': None}
83.     actual = do_autodoc(app, 'class', 'target.instance_variable.Bar', options)
84.     assert list(actual) == [
85.         '',
86.         '.. py:class:: Bar()',
87.         '   :module: target.instance_variable',
88.         '',
89.         '',
90.         '   .. py:attribute:: Bar.attr1',
91.         '      :module: target.instance_variable',
92.         '',
93.         '      docstring foo',
94.         '',
95.         '',
96.         '   .. py:attribute:: Bar.attr2',
97.         '      :module: target.instance_variable',
98.         '',
99.         '      docstring bar',
100.         '',
101.         '',
102.         '   .. py:attribute:: Bar.attr3',
103.         '      :module: target.instance_variable',
104.         '',
105.         '      docstring bar',
106.         '',
107.     ]
108. 
109. 
110. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
111. @pytest.mark.sphinx('html', testroot='ext-autodoc')
112. def test_uninitialized_attributes(app):
113.     options = {"members": None,
114.                "inherited-members": None}
115.     actual = do_autodoc(app, 'class', 'target.uninitialized_attributes.Derived', options)
116.     assert list(actual) == [
117.         '',
118.         '.. py:class:: Derived()',
119.         '   :module: target.uninitialized_attributes',
120.         '',
121.         '',
122.         '   .. py:attribute:: Derived.attr1',
123.         '      :module: target.uninitialized_attributes',
124.         '      :type: int',
125.         '',
126.         '      docstring',
127.         '',
128.         '',
129.         '   .. py:attribute:: Derived.attr3',
130.         '      :module: target.uninitialized_attributes',
131.         '      :type: int',
132.         '',
133.         '      docstring',
134.         '',
135.     ]
136. 
137. 
138. @pytest.mark.skipif(sys.version_info < (3, 6), reason='py36+ is available since python3.6.')
139. @pytest.mark.sphinx('html', testroot='ext-autodoc')
140. def test_undocumented_uninitialized_attributes(app):
141.     options = {"members": None,
142.                "inherited-members": None,
143.                "undoc-members": None}
144.     actual = do_autodoc(app, 'class', 'target.uninitialized_attributes.Derived', options)
145.     assert list(actual) == [
146.         '',
147.         '.. py:class:: Derived()',
148.         '   :module: target.uninitialized_attributes',
149.         '',
150.         '',
151.         '   .. py:attribute:: Derived.attr1',
152.         '      :module: target.uninitialized_attributes',
153.         '      :type: int',
154.         '',
155.         '      docstring',
156.         '',
157.         '',
158.         '   .. py:attribute:: Derived.attr2',
159.         '      :module: target.uninitialized_attributes',
160.         '      :type: str',
161.         '',
162.         '',
163.         '   .. py:attribute:: Derived.attr3',
164.         '      :module: target.uninitialized_attributes',
165.         '      :type: int',
166.         '',
167.         '      docstring',
168.         '',
169.         '',
170.         '   .. py:attribute:: Derived.attr4',
171.         '      :module: target.uninitialized_attributes',
172.         '      :type: str',
173.         '',
174.     ]
175. 
176. 
177. def test_decorators(app):
178.     actual = do_autodoc(app, 'class', 'target.decorator.Baz')
179.     assert list(actual) == [
180.         '',
181.         '.. py:class:: Baz(name=None, age=None)',
182.         '   :module: target.decorator',
183.         '',
184.     ]
185. 
186.     actual = do_autodoc(app, 'class', 'target.decorator.Qux')
187.     assert list(actual) == [
188.         '',
189.         '.. py:class:: Qux(name=None, age=None)',
190.         '   :module: target.decorator',
191.         '',
192.     ]
193. 
194.     actual = do_autodoc(app, 'class', 'target.decorator.Quux')
195.     assert list(actual) == [
196.         '',
197.         '.. py:class:: Quux(name=None, age=None)',
198.         '   :module: target.decorator',
199.         '',
200.     ]
201. 
202. 
203. @pytest.mark.sphinx('html', testroot='ext-autodoc')
204. def test_properties(app):
205.     options = {"members": None}
206.     actual = do_autodoc(app, 'class', 'target.properties.Foo', options)
207.     assert list(actual) == [
208.         '',
209.         '.. py:class:: Foo()',
210.         '   :module: target.properties',
211.         '',
212.         '   docstring',
213.         '',
214.         '',
215.         '   .. py:property:: Foo.prop1',
216.         '      :module: target.properties',
217.         '      :type: int',
218.         '',
219.         '      docstring',
220.         '',
221.         '',
222.         '   .. py:property:: Foo.prop2',
223.         '      :module: target.properties',
224.         '      :classmethod:',
225.         '      :type: int',
226.         '',
227.         '      docstring',
228.         '',
229.     ]
230. 
231. 
232. @pytest.mark.sphinx('html', testroot='ext-autodoc')
233. def test_slots_attribute(app):
234.     options = {"members": None}
235.     actual = do_autodoc(app, 'class', 'target.slots.Bar', options)
236.     assert list(actual) == [
237.         '',
238.         '.. py:class:: Bar()',
239.         '   :module: target.slots',
240.         '',
241.         '   docstring',
242.         '',
243.         '',
244.         '   .. py:attribute:: Bar.attr1',
245.         '      :module: target.slots',
246.         '',
247.         '      docstring of attr1',
248.         '',
249.         '',
250.         '   .. py:attribute:: Bar.attr2',
251.         '      :module: target.slots',
252.         '',
253.         '      docstring of instance attr2',
254.         '',
255.     ]
256. 
257. 
258. @pytest.mark.skipif(sys.version_info < (3, 7), reason='python 3.7+ is required.')
259. @pytest.mark.sphinx('html', testroot='ext-autodoc')
260. def test_show_inheritance_for_subclass_of_generic_type(app):
261.     options = {'show-inheritance': None}
262.     actual = do_autodoc(app, 'class', 'target.classes.Quux', options)
263.     assert list(actual) == [
264.         '',
265.         '.. py:class:: Quux(iterable=(), /)',
266.         '   :module: target.classes',
267.         '',
268.         '   Bases: :py:class:`~typing.List`\\ '
269.         '[:py:obj:`~typing.Union`\\ [:py:class:`int`, :py:class:`float`]]',
270.         '',
271.         '   A subclass of List[Union[int, float]]',
272.         '',
273.     ]
274. 
275. 
276. @pytest.mark.sphinx('html', testroot='ext-autodoc')
277. def test_autodoc_process_bases(app):
278.     def autodoc_process_bases(app, name, obj, options, bases):
279.         assert name == 'target.classes.Quux'
280.         assert obj.__module__ == 'target.classes'
281.         assert obj.__name__ == 'Quux'
282.         assert options == {'show-inheritance': True,
283.                            'members': []}
284.         assert bases == [List[Union[int, float]]]
285. 
286.         bases.pop()
287.         bases.extend([int, str])
288. 
289.     app.connect('autodoc-process-bases', autodoc_process_bases)
290. 
291.     options = {'show-inheritance': None}
292.     actual = do_autodoc(app, 'class', 'target.classes.Quux', options)
293.     if sys.version_info < (3, 7):
294.         assert list(actual) == [
295.             '',
296.             '.. py:class:: Quux(*args, **kwds)',
297.             '   :module: target.classes',
298.             '',
299.             '   Bases: :py:class:`int`, :py:class:`str`',
300.             '',
301.             '   A subclass of List[Union[int, float]]',
302.             '',
303.         ]
304.     else:
305.         assert list(actual) == [
306.             '',
307.             '.. py:class:: Quux(iterable=(), /)',
308.             '   :module: target.classes',
309.             '',
310.             '   Bases: :py:class:`int`, :py:class:`str`',
311.             '',
312.             '   A subclass of List[Union[int, float]]',
313.             '',
314.         ]
315. 
316. 
317. @pytest.mark.sphinx('html', testroot='ext-autodoc')
318. def test_class_doc_from_class(app):
319.     options = {"members": None,
320.                "class-doc-from": "class"}
321.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
322.     assert list(actual) == [
323.         '',
324.         '.. py:class:: C()',
325.         '   :module: target.autoclass_content',
326.         '',
327.         '   A class having __init__, no __new__',
328.         '',
329.     ]
330. 
331. 
332. @pytest.mark.sphinx('html', testroot='ext-autodoc')
333. def test_class_doc_from_init(app):
334.     options = {"members": None,
335.                "class-doc-from": "init"}
336.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
337.     assert list(actual) == [
338.         '',
339.         '.. py:class:: C()',
340.         '   :module: target.autoclass_content',
341.         '',
342.         '   __init__ docstring',
343.         '',
344.     ]
345. 
346. 
347. @pytest.mark.sphinx('html', testroot='ext-autodoc')
348. def test_class_doc_from_both(app):
349.     options = {"members": None,
350.                "class-doc-from": "both"}
351.     actual = do_autodoc(app, 'class', 'target.autoclass_content.C', options)
352.     assert list(actual) == [
353.         '',
354.         '.. py:class:: C()',
355.         '   :module: target.autoclass_content',
356.         '',
357.         '   A class having __init__, no __new__',
358.         '',
359.         '   __init__ docstring',
360.         '',
361.     ]
362. 
363. 
364. def test_class_alias(app):
365.     def autodoc_process_docstring(*args):
366.         """A handler always raises an error.
367.         This confirms this handler is never called for class aliases.
368.         """
369.         raise
370. 
371.     app.connect('autodoc-process-docstring', autodoc_process_docstring)
372.     actual = do_autodoc(app, 'class', 'target.classes.Alias')
373.     assert list(actual) == [
374.         '',
375.         '.. py:attribute:: Alias',
376.         '   :module: target.classes',
377.         '',
378.         '   alias of :py:class:`target.classes.Foo`',
379.     ]
380. 
381. 
382. def test_class_alias_having_doccomment(app):
383.     actual = do_autodoc(app, 'class', 'target.classes.OtherAlias')
384.     assert list(actual) == [
385.         '',
386.         '.. py:attribute:: OtherAlias',
387.         '   :module: target.classes',
388.         '',
389.         '   docstring',
390.         '',
391.     ]
392. 
393. 
394. @pytest.mark.sphinx('html', testroot='ext-autodoc')
395. def test_coroutine(app):
396.     options = {"members": None}
397.     actual = do_autodoc(app, 'class', 'target.coroutine.AsyncClass', options)
398.     assert list(actual) == [
399.         '',
400.         '.. py:class:: AsyncClass()',
401.         '   :module: target.coroutine',
402.         '',
403.         '',
404.         '   .. py:method:: AsyncClass.do_asyncgen()',
405.         '      :module: target.coroutine',
406.         '      :async:',
407.         '',
408.         '      A documented async generator',
409.         '',
410.         '',
411.         '   .. py:method:: AsyncClass.do_coroutine()',
412.         '      :module: target.coroutine',
413.         '      :async:',
414.         '',
415.         '      A documented coroutine function',
416.         '',
417.         '',
418.         '   .. py:method:: AsyncClass.do_coroutine2()',
419.         '      :module: target.coroutine',
420.         '      :async:',
421.         '      :classmethod:',
422.         '',
423.         '      A documented coroutine classmethod',
424.         '',
425.         '',
426.         '   .. py:method:: AsyncClass.do_coroutine3()',
427.         '      :module: target.coroutine',
428.         '      :async:',
429.         '      :staticmethod:',
430.         '',
431.         '      A documented coroutine staticmethod',
432.         '',
433.     ]


File: tests/test_ext_autodoc_mock.py
Line number range: 1 - 152
Content:
1. """
2.     test_ext_autodoc_mock
3.     ~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import abc
12. import sys
13. from importlib import import_module
14. from typing import TypeVar
15. 
16. import pytest
17. 
18. from sphinx.ext.autodoc.mock import _MockModule, _MockObject, ismock, mock, undecorate
19. 
20. 
21. def test_MockModule():
22.     mock = _MockModule('mocked_module')
23.     assert isinstance(mock.some_attr, _MockObject)
24.     assert isinstance(mock.some_method, _MockObject)
25.     assert isinstance(mock.attr1.attr2, _MockObject)
26.     assert isinstance(mock.attr1.attr2.meth(), _MockObject)
27. 
28.     assert repr(mock.some_attr) == 'mocked_module.some_attr'
29.     assert repr(mock.some_method) == 'mocked_module.some_method'
30.     assert repr(mock.attr1.attr2) == 'mocked_module.attr1.attr2'
31.     assert repr(mock.attr1.attr2.meth) == 'mocked_module.attr1.attr2.meth'
32. 
33.     assert repr(mock) == 'mocked_module'
34. 
35. 
36. def test_MockObject():
37.     mock = _MockObject()
38.     assert isinstance(mock.some_attr, _MockObject)
39.     assert isinstance(mock.some_method, _MockObject)
40.     assert isinstance(mock.attr1.attr2, _MockObject)
41.     assert isinstance(mock.attr1.attr2.meth(), _MockObject)
42. 
43.     # subclassing
44.     class SubClass(mock.SomeClass):
45.         """docstring of SubClass"""
46. 
47.         def method(self):
48.             return "string"
49. 
50.     obj = SubClass()
51.     assert SubClass.__doc__ == "docstring of SubClass"
52.     assert isinstance(obj, SubClass)
53.     assert obj.method() == "string"
54.     assert isinstance(obj.other_method(), SubClass)
55. 
56.     # parametrized type
57.     T = TypeVar('T')
58. 
59.     class SubClass2(mock.SomeClass[T]):
60.         """docstring of SubClass"""
61. 
62.     obj2 = SubClass2()
63.     assert SubClass2.__doc__ == "docstring of SubClass"
64.     assert isinstance(obj2, SubClass2)
65. 
66. 
67. def test_mock():
68.     modname = 'sphinx.unknown'
69.     submodule = modname + '.submodule'
70.     assert modname not in sys.modules
71.     with pytest.raises(ImportError):
72.         import_module(modname)
73. 
74.     with mock([modname]):
75.         import_module(modname)
76.         assert modname in sys.modules
77.         assert isinstance(sys.modules[modname], _MockModule)
78. 
79.         # submodules are also mocked
80.         import_module(submodule)
81.         assert submodule in sys.modules
82.         assert isinstance(sys.modules[submodule], _MockModule)
83. 
84.     assert modname not in sys.modules
85.     with pytest.raises(ImportError):
86.         import_module(modname)
87. 
88. 
89. def test_mock_does_not_follow_upper_modules():
90.     with mock(['sphinx.unknown.module']):
91.         with pytest.raises(ImportError):
92.             import_module('sphinx.unknown')
93. 
94. 
95. @pytest.mark.skipif(sys.version_info < (3, 7), reason='Only for py37 or above')
96. def test_abc_MockObject():
97.     mock = _MockObject()
98. 
99.     class Base:
100.         @abc.abstractmethod
101.         def __init__(self):
102.             pass
103. 
104.     class Derived(Base, mock.SubClass):
105.         pass
106. 
107.     obj = Derived()
108.     assert isinstance(obj, Base)
109.     assert isinstance(obj, _MockObject)
110.     assert isinstance(obj.some_method(), Derived)
111. 
112. 
113. def test_mock_decorator():
114.     mock = _MockObject()
115. 
116.     @mock.function_deco
117.     def func():
118.         pass
119. 
120.     class Foo:
121.         @mock.method_deco
122.         def meth(self):
123.             pass
124. 
125.     @mock.class_deco
126.     class Bar:
127.         pass
128. 
129.     @mock.funcion_deco(Foo)
130.     class Baz:
131.         pass
132. 
133.     assert undecorate(func).__name__ == "func"
134.     assert undecorate(Foo.meth).__name__ == "meth"
135.     assert undecorate(Bar).__name__ == "Bar"
136.     assert undecorate(Baz).__name__ == "Baz"
137. 
138. 
139. def test_ismock():
140.     with mock(['sphinx.unknown']):
141.         mod1 = import_module('sphinx.unknown')
142.         mod2 = import_module('sphinx.application')
143. 
144.         class Inherited(mod1.Class):
145.             pass
146. 
147.         assert ismock(mod1) is True
148.         assert ismock(mod1.Class) is True
149.         assert ismock(Inherited) is False
150. 
151.         assert ismock(mod2) is False
152.         assert ismock(mod2.Sphinx) is False

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-12-24 04:18:34,249 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_refine_node - DEBUG - reasoning="I have analyzed the provided context, including `sphinx/ext/autodoc/__init__.py`, `sphinx/ext/autodoc/mock.py`, and several `autodoc` test files. While these files provide general information about autodoc and its mocking mechanism, they do not contain a specific test case that documents a class inheriting from a mocked class and then asserts the correctness of the 'Bases' output, which is the core of the user's bug report. The existing tests for mocking (`test_ext_autodoc_mock.py`) only check the mock objects themselves, not the generated documentation. The tests for class documentation (`test_ext_autodoc_autoclass.py`) do not involve mocked base classes. To find a relevant test, I need to examine tests related to autodoc configurations, specifically `autodoc_mock_imports`." query='Please provide the full content of `tests/test_ext_autodoc_configs.py` and the files within the `tests/roots/test-ext-autodoc-mock-imports/` directory.' extra_requirements='Please include the contents of `conf.py`, `foo.py`, and `index.rst` from the `test-ext-autodoc-mock-imports` directory.' purpose="These files are essential to find a test case that configures `autodoc_mock_imports` and documents a class inheriting from a mocked base class, which will allow me to identify a test that reproduces the user's issue."
2025-12-24 04:18:34,250 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of `tests/test_ext_autodoc_configs.py` and the files within the `tests/roots/test-ext-autodoc-mock-imports/` directory.
2025-12-24 04:18:34,250 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_retrieval_node - ERROR - Failed to retrieve from memory: Athena memory client is not configured.
2025-12-24 04:18:34,250 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-12-24 04:18:34,251 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-12-24 04:18:34,251 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of `tests/test_ext_autodoc_configs.py` and the files within the `tests/roots/test-ext-autodoc-mock-imports/` directory.
Extra requirements: Please include the contents of `conf.py`, `foo.py`, and `index.rst` from the `test-ext-autodoc-mock-imports` directory.
Purpose: These files are essential to find a test case that configures `autodoc_mock_imports` and documents a class inheriting from a mocked base class, which will allow me to identify a test that reproduces the user's issue.
2025-12-24 04:18:38,435 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of `tests/test_ext_autodoc_configs.py` and the specified files within the `tests/roots/test-ext-autodoc-mock-imports/` directory. This includes `conf.py`, `foo.py`, and `index.rst`. These files will help you identify the relevant test case for `autodoc_mock_imports`.' additional_kwargs={'function_call': {'name': 'read_file_with_knowledge_graph_data', 'arguments': '{"relative_path": "tests/roots/test-ext-autodoc-mock-imports/index.rst"}'}} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 2168, 'candidates_token_count': 204, 'total_token_count': 2509, 'prompt_tokens_details': [{'modality': 1, 'token_count': 2168}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 204}], 'thoughts_token_count': 137, 'cached_content_token_count': 0, 'cache_tokens_details': []}, 'finish_reason': 'STOP', 'avg_logprobs': -0.044357042686611996, 'model_name': 'gemini-2.5-pro'} id='run--cc4bf9a1-7c56-424d-b741-d28ac1fb9922-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/test_ext_autodoc_configs.py'}, 'id': 'b73e0581-ef68-45cd-ba18-df1ef0f72878', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-ext-autodoc-mock-imports/conf.py'}, 'id': '7fbff80a-a2a8-4b45-8082-3e5456b3f9ed', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-ext-autodoc-mock-imports/foo.py'}, 'id': '876e56e2-577c-4380-85a0-e2008e8632b6', 'type': 'tool_call'}, {'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'tests/roots/test-ext-autodoc-mock-imports/index.rst'}, 'id': '42e50255-5ba3-4220-a246-52ec215301ff', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2168, 'output_tokens': 204, 'total_tokens': 2509, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 137}}
2025-12-24 04:19:40,274 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_provider_node - DEBUG - content='I have retrieved the contents of `tests/test_ext_autodoc_configs.py` and the specified files within the `tests/roots/test-ext-autodoc-mock-imports/` directory. This includes `conf.py`, `foo.py`, and `index.rst`. These files will help you identify the relevant test case for `autodoc_mock_imports`.' additional_kwargs={} response_metadata={'is_blocked': False, 'safety_ratings': [], 'usage_metadata': {'prompt_token_count': 9518, 'candidates_token_count': 82, 'total_token_count': 15787, 'cached_content_token_count': 1721, 'prompt_tokens_details': [{'modality': 1, 'token_count': 9518}], 'cache_tokens_details': [{'modality': 1, 'token_count': 1721}], 'candidates_tokens_details': [{'modality': 1, 'token_count': 82}], 'thoughts_token_count': 6187}, 'finish_reason': 'STOP', 'avg_logprobs': -8.998674346179497, 'model_name': 'gemini-2.5-pro'} id='run--1c54d9d9-d6fc-48ca-92b1-b223b531c907-0' usage_metadata={'input_tokens': 9518, 'output_tokens': 82, 'total_tokens': 15787, 'input_token_details': {'cache_read': 1721}, 'output_token_details': {'reasoning': 6187}}
2025-12-24 04:19:40,276 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of `tests/test_ext_autodoc_configs.py` and the files within the `tests/roots/test-ext-autodoc-mock-imports/` directory.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
Please include the contents of `conf.py`, `foo.py`, and `index.rst` from the `test-ext-autodoc-mock-imports` directory.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files are essential to find a test case that configures `autodoc_mock_imports` and documents a class inheriting from a mocked base class, which will allow me to identify a test that reproduces the user's issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: tests/test_ext_autodoc_configs.py
Line number range: 1 - 500
Content:
1. """
2.     test_ext_autodoc_configs
3.     ~~~~~~~~~~~~~~~~~~~~~~~~
4. 
5.     Test the autodoc extension.  This tests mainly for config variables
6. 
7.     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.
8.     :license: BSD, see LICENSE for details.
9. """
10. 
11. import platform
12. import sys
13. 
14. import pytest
15. 
16. from sphinx.testing import restructuredtext
17. 
18. from .test_ext_autodoc import do_autodoc
19. 
20. IS_PYPY = platform.python_implementation() == 'PyPy'
21. 
22. 
23. @pytest.mark.sphinx('html', testroot='ext-autodoc')
24. def test_autoclass_content_class(app):
25.     app.config.autoclass_content = 'class'
26.     options = {"members": None}
27.     actual = do_autodoc(app, 'module', 'target.autoclass_content', options)
28.     assert list(actual) == [
29.         '',
30.         '.. py:module:: target.autoclass_content',
31.         '',
32.         '',
33.         '.. py:class:: A()',
34.         '   :module: target.autoclass_content',
35.         '',
36.         '   A class having no __init__, no __new__',
37.         '',
38.         '',
39.         '.. py:class:: B()',
40.         '   :module: target.autoclass_content',
41.         '',
42.         '   A class having __init__(no docstring), no __new__',
43.         '',
44.         '',
45.         '.. py:class:: C()',
46.         '   :module: target.autoclass_content',
47.         '',
48.         '   A class having __init__, no __new__',
49.         '',
50.         '',
51.         '.. py:class:: D()',
52.         '   :module: target.autoclass_content',
53.         '',
54.         '   A class having no __init__, __new__(no docstring)',
55.         '',
56.         '',
57.         '.. py:class:: E()',
58.         '   :module: target.autoclass_content',
59.         '',
60.         '   A class having no __init__, __new__',
61.         '',
62.         '',
63.         '.. py:class:: F()',
64.         '   :module: target.autoclass_content',
65.         '',
66.         '   A class having both __init__ and __new__',
67.         '',
68.         '',
69.         '.. py:class:: G()',
70.         '   :module: target.autoclass_content',
71.         '',
72.         '   A class inherits __init__ without docstring.',
73.         '',
74.         '',
75.         '.. py:class:: H()',
76.         '   :module: target.autoclass_content',
77.         '',
78.         '   A class inherits __new__ without docstring.',
79.         '',
80.     ]
81. 
82. 
83. @pytest.mark.sphinx('html', testroot='ext-autodoc')
84. def test_autoclass_content_init(app):
85.     app.config.autoclass_content = 'init'
86.     options = {"members": None}
87.     actual = do_autodoc(app, 'module', 'target.autoclass_content', options)
88.     assert list(actual) == [
89.         '',
90.         '.. py:module:: target.autoclass_content',
91.         '',
92.         '',
93.         '.. py:class:: A()',
94.         '   :module: target.autoclass_content',
95.         '',
96.         '   A class having no __init__, no __new__',
97.         '',
98.         '',
99.         '.. py:class:: B()',
100.         '   :module: target.autoclass_content',
101.         '',
102.         '   A class having __init__(no docstring), no __new__',
103.         '',
104.         '',
105.         '.. py:class:: C()',
106.         '   :module: target.autoclass_content',
107.         '',
108.         '   __init__ docstring',
109.         '',
110.         '',
111.         '.. py:class:: D()',
112.         '   :module: target.autoclass_content',
113.         '',
114.         '   A class having no __init__, __new__(no docstring)',
115.         '',
116.         '',
117.         '.. py:class:: E()',
118.         '   :module: target.autoclass_content',
119.         '',
120.         '   __new__ docstring',
121.         '',
122.         '',
123.         '.. py:class:: F()',
124.         '   :module: target.autoclass_content',
125.         '',
126.         '   __init__ docstring',
127.         '',
128.         '',
129.         '.. py:class:: G()',
130.         '   :module: target.autoclass_content',
131.         '',
132.         '   __init__ docstring',
133.         '',
134.         '',
135.         '.. py:class:: H()',
136.         '   :module: target.autoclass_content',
137.         '',
138.         '   __new__ docstring',
139.         '',
140.     ]
141. 
142. 
143. @pytest.mark.sphinx('html', testroot='ext-autodoc')
144. def test_autodoc_class_signature_mixed(app):
145.     app.config.autodoc_class_signature = 'mixed'
146.     options = {"members": None,
147.                "undoc-members": None}
148.     actual = do_autodoc(app, 'class', 'target.classes.Bar', options)
149.     assert list(actual) == [
150.         '',
151.         '.. py:class:: Bar(x, y)',
152.         '   :module: target.classes',
153.         '',
154.     ]
155. 
156. 
157. @pytest.mark.sphinx('html', testroot='ext-autodoc')
158. def test_autodoc_class_signature_separated_init(app):
159.     app.config.autodoc_class_signature = 'separated'
160.     options = {"members": None,
161.                "undoc-members": None}
162.     actual = do_autodoc(app, 'class', 'target.classes.Bar', options)
163.     assert list(actual) == [
164.         '',
165.         '.. py:class:: Bar',
166.         '   :module: target.classes',
167.         '',
168.         '',
169.         '   .. py:method:: Bar.__init__(x, y)',
170.         '      :module: target.classes',
171.         '',
172.     ]
173. 
174. 
175. @pytest.mark.sphinx('html', testroot='ext-autodoc')
176. def test_autodoc_class_signature_separated_new(app):
177.     app.config.autodoc_class_signature = 'separated'
178.     options = {"members": None,
179.                "undoc-members": None}
180.     actual = do_autodoc(app, 'class', 'target.classes.Baz', options)
181.     assert list(actual) == [
182.         '',
183.         '.. py:class:: Baz',
184.         '   :module: target.classes',
185.         '',
186.         '',
187.         '   .. py:method:: Baz.__new__(cls, x, y)',
188.         '      :module: target.classes',
189.         '      :staticmethod:',
190.         '',
191.     ]
192. 
193. 
194. @pytest.mark.sphinx('html', testroot='ext-autodoc')
195. def test_autoclass_content_both(app):
196.     app.config.autoclass_content = 'both'
197.     options = {"members": None}
198.     actual = do_autodoc(app, 'module', 'target.autoclass_content', options)
199.     assert list(actual) == [
200.         '',
201.         '.. py:module:: target.autoclass_content',
202.         '',
203.         '',
204.         '.. py:class:: A()',
205.         '   :module: target.autoclass_content',
206.         '',
207.         '   A class having no __init__, no __new__',
208.         '',
209.         '',
210.         '.. py:class:: B()',
211.         '   :module: target.autoclass_content',
212.         '',
213.         '   A class having __init__(no docstring), no __new__',
214.         '',
215.         '',
216.         '.. py:class:: C()',
217.         '   :module: target.autoclass_content',
218.         '',
219.         '   A class having __init__, no __new__',
220.         '',
221.         '   __init__ docstring',
222.         '',
223.         '',
224.         '.. py:class:: D()',
225.         '   :module: target.autoclass_content',
226.         '',
227.         '   A class having no __init__, __new__(no docstring)',
228.         '',
229.         '',
230.         '.. py:class:: E()',
231.         '   :module: target.autoclass_content',
232.         '',
233.         '   A class having no __init__, __new__',
234.         '',
235.         '   __new__ docstring',
236.         '',
237.         '',
238.         '.. py:class:: F()',
239.         '   :module: target.autoclass_content',
240.         '',
241.         '   A class having both __init__ and __new__',
242.         '',
243.         '   __init__ docstring',
244.         '',
245.         '',
246.         '.. py:class:: G()',
247.         '   :module: target.autoclass_content',
248.         '',
249.         '   A class inherits __init__ without docstring.',
250.         '',
251.         '   __init__ docstring',
252.         '',
253.         '',
254.         '.. py:class:: H()',
255.         '   :module: target.autoclass_content',
256.         '',
257.         '   A class inherits __new__ without docstring.',
258.         '',
259.         '   __new__ docstring',
260.         '',
261.     ]
262. 
263. 
264. @pytest.mark.sphinx('html', testroot='ext-autodoc')
265. def test_autodoc_inherit_docstrings(app):
266.     assert app.config.autodoc_inherit_docstrings is True  # default
267.     actual = do_autodoc(app, 'method', 'target.inheritance.Derived.inheritedmeth')
268.     assert list(actual) == [
269.         '',
270.         '.. py:method:: Derived.inheritedmeth()',
271.         '   :module: target.inheritance',
272.         '',
273.         '   Inherited function.',
274.         '',
275.     ]
276. 
277.     # disable autodoc_inherit_docstrings
278.     app.config.autodoc_inherit_docstrings = False
279.     actual = do_autodoc(app, 'method', 'target.inheritance.Derived.inheritedmeth')
280.     assert list(actual) == [
281.         '',
282.         '.. py:method:: Derived.inheritedmeth()',
283.         '   :module: target.inheritance',
284.         ''
285.     ]
286. 
287. 
288. @pytest.mark.sphinx('html', testroot='ext-autodoc')
289. def test_autodoc_docstring_signature(app):
290.     options = {"members": None, "special-members": "__init__, __new__"}
291.     actual = do_autodoc(app, 'class', 'target.DocstringSig', options)
292.     assert list(actual) == [
293.         '',
294.         # FIXME: Ideally this would instead be: `DocstringSig(d, e=1)` but
295.         # currently `ClassDocumenter` does not apply the docstring signature
296.         # logic when extracting a signature from a __new__ or __init__ method.
297.         '.. py:class:: DocstringSig(*new_args, **new_kwargs)',
298.         '   :module: target',
299.         '',
300.         '',
301.         '   .. py:method:: DocstringSig.__init__(self, a, b=1) -> None',
302.         '      :module: target',
303.         '',
304.         '      First line of docstring',
305.         '',
306.         '      rest of docstring',
307.         '',
308.         '',
309.         '   .. py:method:: DocstringSig.__new__(cls, d, e=1) -> DocstringSig',
310.         '      :module: target',
311.         '      :staticmethod:',
312.         '',
313.         '      First line of docstring',
314.         '',
315.         '      rest of docstring',
316.         '',
317.         '',
318.         '   .. py:method:: DocstringSig.meth(FOO, BAR=1) -> BAZ',
319.         '      :module: target',
320.         '',
321.         '      First line of docstring',
322.         '',
323.         '      rest of docstring',
324.         '',
325.         '',
326.         '   .. py:method:: DocstringSig.meth2()',
327.         '      :module: target',
328.         '',
329.         '      First line, no signature',
330.         '      Second line followed by indentation::',
331.         '',
332.         '          indented line',
333.         '',
334.         '',
335.         '   .. py:property:: DocstringSig.prop1',
336.         '      :module: target',
337.         '',
338.         '      First line of docstring',
339.         '',
340.         '',
341.         '   .. py:property:: DocstringSig.prop2',
342.         '      :module: target',
343.         '',
344.         '      First line of docstring',
345.         '      Second line of docstring',
346.         '',
347.     ]
348. 
349.     # disable autodoc_docstring_signature
350.     app.config.autodoc_docstring_signature = False
351.     actual = do_autodoc(app, 'class', 'target.DocstringSig', options)
352.     assert list(actual) == [
353.         '',
354.         '.. py:class:: DocstringSig(*new_args, **new_kwargs)',
355.         '   :module: target',
356.         '',
357.         '',
358.         '   .. py:method:: DocstringSig.__init__(*init_args, **init_kwargs)',
359.         '      :module: target',
360.         '',
361.         '      __init__(self, a, b=1) -> None',
362.         '      First line of docstring',
363.         '',
364.         '              rest of docstring',
365.         '',
366.         '',
367.         '',
368.         '   .. py:method:: DocstringSig.__new__(cls, *new_args, **new_kwargs)',
369.         '      :module: target',
370.         '      :staticmethod:',
371.         '',
372.         '      __new__(cls, d, e=1) -> DocstringSig',
373.         '      First line of docstring',
374.         '',
375.         '              rest of docstring',
376.         '',
377.         '',
378.         '',
379.         '   .. py:method:: DocstringSig.meth()',
380.         '      :module: target',
381.         '',
382.         '      meth(FOO, BAR=1) -> BAZ',
383.         '      First line of docstring',
384.         '',
385.         '              rest of docstring',
386.         '',
387.         '',
388.         '',
389.         '   .. py:method:: DocstringSig.meth2()',
390.         '      :module: target',
391.         '',
392.         '      First line, no signature',
393.         '      Second line followed by indentation::',
394.         '',
395.         '          indented line',
396.         '',
397.         '',
398.         '   .. py:property:: DocstringSig.prop1',
399.         '      :module: target',
400.         '',
401.         '      DocstringSig.prop1(self)',
402.         '      First line of docstring',
403.         '',
404.         '',
405.         '   .. py:property:: DocstringSig.prop2',
406.         '      :module: target',
407.         '',
408.         '      First line of docstring',
409.         '      Second line of docstring',
410.         '',
411.     ]
412. 
413. 
414. @pytest.mark.sphinx('html', testroot='ext-autodoc')
415. def test_autoclass_content_and_docstring_signature_class(app):
416.     app.config.autoclass_content = 'class'
417.     options = {"members": None,
418.                "undoc-members": None}
419.     actual = do_autodoc(app, 'module', 'target.docstring_signature', options)
420.     assert list(actual) == [
421.         '',
422.         '.. py:module:: target.docstring_signature',
423.         '',
424.         '',
425.         '.. py:class:: A(foo, bar)',
426.         '   :module: target.docstring_signature',
427.         '',
428.         '',
429.         '.. py:class:: B(foo, bar)',
430.         '   :module: target.docstring_signature',
431.         '',
432.         '',
433.         '.. py:class:: C(foo, bar)',
434.         '   :module: target.docstring_signature',
435.         '',
436.         '',
437.         '.. py:class:: D()',
438.         '   :module: target.docstring_signature',
439.         '',
440.         '',
441.         '.. py:class:: E()',
442.         '   :module: target.docstring_signature',
443.         '',
444.         '',
445.         '.. py:class:: F()',
446.         '   :module: target.docstring_signature',
447.         '',
448.     ]
449. 
450. 
451. @pytest.mark.sphinx('html', testroot='ext-autodoc')
452. def test_autoclass_content_and_docstring_signature_init(app):
453.     app.config.autoclass_content = 'init'
454.     options = {"members": None,
455.                "undoc-members": None}
456.     actual = do_autodoc(app, 'module', 'target.docstring_signature', options)
457.     assert list(actual) == [
458.         '',
459.         '.. py:module:: target.docstring_signature',
460.         '',
461.         '',
462.         '.. py:class:: A(foo, bar)',
463.         '   :module: target.docstring_signature',
464.         '',
465.         '',
466.         '.. py:class:: B(foo, bar, baz)',
467.         '   :module: target.docstring_signature',
468.         '',
469.         '',
470.         '.. py:class:: C(foo, bar, baz)',
471.         '   :module: target.docstring_signature',
472.         '',
473.         '',
474.         '.. py:class:: D(foo, bar, baz)',
475.         '   :module: target.docstring_signature',
476.         '',
477.         '',
478.         '.. py:class:: E(foo: int, bar: int, baz: int) -> None',
479.         '              E(foo: str, bar: str, baz: str) -> None',
480.         '   :module: target.docstring_signature',
481.         '',
482.         '',
483.         '.. py:class:: F(foo: int, bar: int, baz: int) -> None',
484.         '              F(foo: str, bar: str, baz: str) -> None',
485.         '   :module: target.docstring_signature',
486.         '',
487.     ]
488. 
489. 
490. @pytest.mark.sphinx('html', testroot='ext-autodoc')
491. def test_autoclass_content_and_docstring_signature_both(app):
492.     app.config.autoclass_content = 'both'
493.     options = {"members": None,
494.                "undoc-members": None}
495.     actual = do_autodoc(app, 'module', 'target.docstring_signature', options)
496.     assert list(actual) == [
497.         '',
498.         '.. py:module:: target.docstring_signature',
499.         '',
500.         '',

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-12-24 04:20:09,968 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The user's query explicitly asks for the full content of the file `tests/test_ext_autodoc_configs.py`.\n\n2. Extended relevance:\n   - This file contains tests for various `autodoc` configurations. Providing it fulfills the user's request and allows them to examine its contents to determine its relevance to their goal of finding a test case for `autodoc_mock_imports`. Although the file does not contain `autodoc_mock_imports`, it satisfies the user's explicit request for the file's content.", relative_path='tests/test_ext_autodoc_configs.py', start_line=1, end_line=500)]
2025-12-24 04:20:09,969 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Storing 1 contexts to memory for query: Please provide the full content of `tests/test_ext_autodoc_configs.py` and the files within the `tests/roots/test-ext-autodoc-mock-imports/` directory.
2025-12-24 04:20:09,969 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - ERROR - Failed to store to memory: Athena memory client is not configured.
2025-12-24 04:20:09,969 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-12-24 04:20:09,970 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - Adding 1 new contexts to 7 existing contexts
2025-12-24 04:20:09,970 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-12-24 04:20:09,971 - thread-125237555361472.prometheus_context_collector.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-12-24 04:20:09,972 - thread-125237555361472.prometheus_context_collector - INFO - Successfully retrieved 8 context snippets
